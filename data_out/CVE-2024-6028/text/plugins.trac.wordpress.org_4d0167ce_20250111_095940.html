

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fquiz-maker%2Ftags%2F6.5.7.5%2Fpublic%2Fclass-quiz-maker-public.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php)

---

# [source:](/browser?order=name "Go to repository root") [quiz-maker](/browser/quiz-maker?order=name "View quiz-maker")/[tags](/browser/quiz-maker/tags?order=name "View tags")/[6.5.7.5](/browser/quiz-maker/tags/6.5.7.5?order=name "View 6.5.7.5")/[public](/browser/quiz-maker/tags/6.5.7.5/public?order=name "View public")/[class-quiz-maker-public.php](/browser/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php?order=name "View class-quiz-maker-public.php")

View diff against:

View revision:

| [Last change](/changeset/3095486/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php "View differences") on this file was [3095486](/changeset/3095486/ "View changeset 3095486"), checked in by ays-pro, [8 months ago](/timeline?from=2024-05-31T06%3A29%3A54Z&precision=second "See timeline at 05/31/2024 06:29:54 AM") |
| --- |
| Import 6.5.7.5 version |
| **File size:** 353.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* The public-facing functionality of the plugin. |
| [5](#L5) | \* |
| [6](#L6) | \* @link       http://ays-pro.com/ |
| [7](#L7) | \* @since      1.0.0 |
| [8](#L8) | \* |
| [9](#L9) | \* @package    Quiz\_Maker |
| [10](#L10) | \* @subpackage Quiz\_Maker/public |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* The public-facing functionality of the plugin. |
| [15](#L15) | \* |
| [16](#L16) | \* Defines the plugin name, version, and two examples hooks for how to |
| [17](#L17) | \* enqueue the public-facing stylesheet and JavaScript. |
| [18](#L18) | \* |
| [19](#L19) | \* @package    Quiz\_Maker |
| [20](#L20) | \* @subpackage Quiz\_Maker/public |
| [21](#L21) | \* @author     AYS Pro LLC <info@ays-pro.com> |
| [22](#L22) | \*/ |
| [23](#L23) | class Quiz\_Maker\_Public |
| [24](#L24) | { |
| [25](#L25) |  |
| [26](#L26) | /\*\* |
| [27](#L27) | \* The ID of this plugin. |
| [28](#L28) | \* |
| [29](#L29) | \* @since    1.0.0 |
| [30](#L30) | \* @access   private |
| [31](#L31) | \* @var      string $plugin\_name The ID of this plugin. |
| [32](#L32) | \*/ |
| [33](#L33) | protected $plugin\_name; |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* The version of this plugin. |
| [37](#L37) | \* |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   private |
| [40](#L40) | \* @var      string $version The current version of this plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | protected $version; |
| [43](#L43) |  |
| [44](#L44) | protected $settings; |
| [45](#L45) |  |
| [46](#L46) | protected $buttons\_texts; |
| [47](#L47) | protected $fields\_placeholders; |
| [48](#L48) | protected $is\_training; |
| [49](#L49) | protected $category\_selective; |
| [50](#L50) | protected $title; |
| [51](#L51) |  |
| [52](#L52) | /\*\* |
| [53](#L53) | \* Initialize the class and set its properties. |
| [54](#L54) | \* |
| [55](#L55) | \* @since    1.0.0 |
| [56](#L56) | \* @param      string $plugin\_name The name of the plugin. |
| [57](#L57) | \* @param      string $version The version of this plugin. |
| [58](#L58) | \*/ |
| [59](#L59) | public function \_\_construct($plugin\_name, $version){ |
| [60](#L60) | $this->plugin\_name = $plugin\_name; |
| [61](#L61) | $this->version = $version; |
| [62](#L62) | $this->settings = new Quiz\_Maker\_Settings\_Actions($this->plugin\_name); |
| [63](#L63) |  |
| [64](#L64) | add\_shortcode('ays\_quiz', array($this, 'ays\_generate\_quiz\_method')); |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* Register the stylesheets for the public-facing side of the site. |
| [69](#L69) | \* |
| [70](#L70) | \* @since    1.0.0 |
| [71](#L71) | \*/ |
| [72](#L72) | public function enqueue\_styles(){ |
| [73](#L73) |  |
| [74](#L74) | /\*\* |
| [75](#L75) | \* This function is provided for demonstration purposes only. |
| [76](#L76) | \* |
| [77](#L77) | \* An instance of this class should be passed to the run() function |
| [78](#L78) | \* defined in Quiz\_Maker\_Loader as all of the hooks are defined |
| [79](#L79) | \* in that particular class. |
| [80](#L80) | \* |
| [81](#L81) | \* The Quiz\_Maker\_Loader will then create the relationship |
| [82](#L82) | \* between the defined hooks and the functions defined in this |
| [83](#L83) | \* class. |
| [84](#L84) | \*/ |
| [85](#L85) | wp\_enqueue\_style($this->plugin\_name.'-font-awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-font-awesome.min.css', array(), $this->version, 'all'); |
| [86](#L86) | wp\_enqueue\_style($this->plugin\_name.'-sweetalert-css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-sweetalert2.min.css', array(), $this->version, 'all' ); |
| [87](#L87) | wp\_enqueue\_style($this->plugin\_name.'-animate', plugin\_dir\_url(\_\_FILE\_\_) . 'css/animate.css', array(), $this->version, 'all'); |
| [88](#L88) | wp\_enqueue\_style($this->plugin\_name.'-animations', plugin\_dir\_url(\_\_FILE\_\_) . 'css/animations.css', array(), $this->version, 'all'); |
| [89](#L89) | wp\_enqueue\_style($this->plugin\_name.'-rating', plugin\_dir\_url(\_\_FILE\_\_) . 'css/rating.min.css', array(), $this->version, 'all'); |
| [90](#L90) | wp\_enqueue\_style($this->plugin\_name.'-select2', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-select2.min.css', array(), $this->version, 'all'); |
| [91](#L91) | wp\_enqueue\_style($this->plugin\_name.'-loaders', plugin\_dir\_url(\_\_FILE\_\_) . 'css/loaders.css', array(), $this->version, 'all'); |
| [92](#L92) | wp\_enqueue\_style($this->plugin\_name . '-dataTable-min', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-dataTables.min.css', array(), $this->version, 'all'); |
| [93](#L93) |  |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | public function enqueue\_styles\_early(){ |
| [97](#L97) |  |
| [98](#L98) | $settings\_options = $this->settings->ays\_get\_setting('options'); |
| [99](#L99) | if($settings\_options){ |
| [100](#L100) | $settings\_options = json\_decode(stripcslashes($settings\_options), true); |
| [101](#L101) | }else{ |
| [102](#L102) | $settings\_options = array(); |
| [103](#L103) | } |
| [104](#L104) |  |
| [105](#L105) | // General CSS File |
| [106](#L106) | $settings\_options['quiz\_exclude\_general\_css'] = isset($settings\_options['quiz\_exclude\_general\_css']) ? esc\_attr( $settings\_options['quiz\_exclude\_general\_css'] ) : 'off'; |
| [107](#L107) | $quiz\_exclude\_general\_css = (isset($settings\_options['quiz\_exclude\_general\_css']) && esc\_attr( $settings\_options['quiz\_exclude\_general\_css'] ) == "on") ? true : false; |
| [108](#L108) |  |
| [109](#L109) | if ( ! $quiz\_exclude\_general\_css ) { |
| [110](#L110) | wp\_enqueue\_style($this->plugin\_name, plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-public.css', array(), $this->version, 'all'); |
| [111](#L111) | }else { |
| [112](#L112) | if ( ! is\_front\_page() ) { |
| [113](#L113) | wp\_enqueue\_style($this->plugin\_name, plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-public.css', array(), $this->version, 'all'); |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | $is\_elementor\_exists = $this->ays\_quiz\_is\_elementor(); |
| [119](#L119) | if ( $is\_elementor\_exists ) { |
| [120](#L120) | wp\_enqueue\_style($this->plugin\_name.'-font-awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quiz-maker-font-awesome.min.css', array(), $this->version, 'all'); |
| [121](#L121) | } |
| [122](#L122) |  |
| [123](#L123) | } |
| [124](#L124) |  |
| [125](#L125) | /\*\* |
| [126](#L126) | \* Register the JavaScript for the public-facing side of the site. |
| [127](#L127) | \* |
| [128](#L128) | \* @since    1.0.0 |
| [129](#L129) | \*/ |
| [130](#L130) | public function enqueue\_scripts(){ |
| [131](#L131) |  |
| [132](#L132) | $is\_elementor\_exists = $this->ays\_quiz\_is\_elementor(); |
| [133](#L133) |  |
| [134](#L134) | /\*\* |
| [135](#L135) | \* This function is provided for demonstration purposes only. |
| [136](#L136) | \* |
| [137](#L137) | \* An instance of this class should be passed to the run() function |
| [138](#L138) | \* defined in Quiz\_Maker\_Loader as all of the hooks are defined |
| [139](#L139) | \* in that particular class. |
| [140](#L140) | \* |
| [141](#L141) | \* The Quiz\_Maker\_Loader will then create the relationship |
| [142](#L142) | \* between the defined hooks and the functions defined in this |
| [143](#L143) | \* class. |
| [144](#L144) | \*/ |
| [145](#L145) | if ( ! $is\_elementor\_exists ) { |
| [146](#L146) | wp\_enqueue\_script("jquery-effects-core"); |
| [147](#L147) | wp\_enqueue\_script($this->plugin\_name .'-select2js', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-select2.min.js', array('jquery'), $this->version, true); |
| [148](#L148) | wp\_enqueue\_script($this->plugin\_name .'-sweetalert-js', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-sweetalert2.all.min.js', array('jquery'), $this->version, true ); |
| [149](#L149) | wp\_enqueue\_script($this->plugin\_name .'-rate-quiz', plugin\_dir\_url(\_\_FILE\_\_) . 'js/rating.min.js', array('jquery'), $this->version, true); |
| [150](#L150) |  |
| [151](#L151) |  |
| [152](#L152) | wp\_enqueue\_script( $this->plugin\_name . '-datatable-min', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-datatable.min.js', array('jquery'), $this->version, true); |
| [153](#L153) |  |
| [154](#L154) | wp\_localize\_script( $this->plugin\_name . '-datatable-min', 'quizLangDataTableObj', array( |
| [155](#L155) | "sEmptyTable"           => \_\_( "No data available in table", $this->plugin\_name ), |
| [156](#L156) | "sInfo"                 => \_\_( "Showing \_START\_ to \_END\_ of \_TOTAL\_ entries", $this->plugin\_name ), |
| [157](#L157) | "sInfoEmpty"            => \_\_( "Showing 0 to 0 of 0 entries", $this->plugin\_name ), |
| [158](#L158) | "sInfoFiltered"         => \_\_( "(filtered from \_MAX\_ total entries)", $this->plugin\_name ), |
| [159](#L159) | // "sInfoPostFix":          => \_\_( "", $this->plugin\_name ), |
| [160](#L160) | // "sInfoThousands":        => \_\_( ",", $this->plugin\_name ), |
| [161](#L161) | "sLengthMenu"           => \_\_( "Show \_MENU\_ entries", $this->plugin\_name ), |
| [162](#L162) | "sLoadingRecords"       => \_\_( "Loading...", $this->plugin\_name ), |
| [163](#L163) | "sProcessing"           => \_\_( "Processing...", $this->plugin\_name ), |
| [164](#L164) | "sSearch"               => \_\_( "Search:", $this->plugin\_name ), |
| [165](#L165) | // "sUrl":                  => \_\_( "", $this->plugin\_name ), |
| [166](#L166) | "sZeroRecords"          => \_\_( "No matching records found", $this->plugin\_name ), |
| [167](#L167) | "sFirst"                => \_\_( "First", $this->plugin\_name ), |
| [168](#L168) | "sLast"                 => \_\_( "Last", $this->plugin\_name ), |
| [169](#L169) | "sNext"                 => \_\_( "Next", $this->plugin\_name ), |
| [170](#L170) | "sPrevious"             => \_\_( "Previous", $this->plugin\_name ), |
| [171](#L171) | "sSortAscending"        => \_\_( ": activate to sort column ascending", $this->plugin\_name ), |
| [172](#L172) | "sSortDescending"       => \_\_( ": activate to sort column descending", $this->plugin\_name ), |
| [173](#L173) | ) ); |
| [174](#L174) |  |
| [175](#L175) | wp\_enqueue\_script($this->plugin\_name .'-functions.js', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-functions.js', array('jquery'), $this->version, true); |
| [176](#L176) | wp\_enqueue\_script($this->plugin\_name .'-ajax-public', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-public-ajax.js', array('jquery'), time(), true); |
| [177](#L177) | wp\_enqueue\_script($this->plugin\_name, plugin\_dir\_url(\_\_FILE\_\_) . 'js/quiz-maker-public.js', array('jquery'), time(), true); |
| [178](#L178) | wp\_localize\_script($this->plugin\_name . '-ajax-public', 'quiz\_maker\_ajax\_public', array( |
| [179](#L179) | 'ajax\_url'      => admin\_url('admin-ajax.php'), |
| [180](#L180) | 'warningIcon'   => plugin\_dir\_url(\_\_FILE\_\_) . "images/warning.svg", |
| [181](#L181) | )); |
| [182](#L182) | wp\_localize\_script($this->plugin\_name, 'quizLangObj', array( |
| [183](#L183) | 'notAnsweredText'       => \_\_( 'You have not answered this question', $this->plugin\_name ), |
| [184](#L184) | 'areYouSure'            => \_\_( 'Do you want to finish the quiz? Are you sure?', $this->plugin\_name ), |
| [185](#L185) | 'selectPlaceholder'     => \_\_( 'Select an answer', $this->plugin\_name ), |
| [186](#L186) | 'correctAnswerVariants' => \_\_( 'Variants of the correct answer', $this->plugin\_name ), |
| [187](#L187) | 'shareDialog'           => \_\_( 'Share Dialog', $this->plugin\_name ), |
| [188](#L188) | 'expiredMessage'        => \_\_( 'The quiz has expired!', $this->plugin\_name ), |
| [189](#L189) | 'day'                   => \_\_( 'day', $this->plugin\_name ), |
| [190](#L190) | 'days'                  => \_\_( 'days', $this->plugin\_name ), |
| [191](#L191) | 'hour'                  => \_\_( 'hour', $this->plugin\_name ), |
| [192](#L192) | 'hours'                 => \_\_( 'hours', $this->plugin\_name ), |
| [193](#L193) | 'minute'                => \_\_( 'minute', $this->plugin\_name ), |
| [194](#L194) | 'minutes'               => \_\_( 'minutes', $this->plugin\_name ), |
| [195](#L195) | 'second'                => \_\_( 'second', $this->plugin\_name ), |
| [196](#L196) | 'seconds'               => \_\_( 'seconds', $this->plugin\_name ), |
| [197](#L197) | 'startButtonText'       => $this->buttons\_texts['startButton'], |
| [198](#L198) | 'defaultStartButtonText'=> \_\_( 'Start', $this->plugin\_name ), |
| [199](#L199) | 'loadResource'          => \_\_( "Can't load resource.", $this->plugin\_name ), |
| [200](#L200) | 'somethingWentWrong'    => \_\_( "Maybe something went wrong.", $this->plugin\_name ), |
| [201](#L201) | 'passwordIsWrong'       => \_\_( 'Password is wrong!', $this->plugin\_name ), |
| [202](#L202) | 'requiredError'         => \_\_( 'This is a required question', $this->plugin\_name ), |
| [203](#L203) | 'show'                  => \_\_( 'Show', $this->plugin\_name ), |
| [204](#L204) | 'hide'                  => \_\_( 'Hide', $this->plugin\_name ), |
| [205](#L205) | ) ); |
| [206](#L206) | } |
| [207](#L207) | } |
| [208](#L208) |  |
| [209](#L209) | public function ays\_generate\_quiz\_method($attr){ |
| [210](#L210) | $id = (isset($attr['id']) && $attr['id'] != '') ? absint(intval($attr['id'])) : null; |
| [211](#L211) |  |
| [212](#L212) | $is\_training = isset($attr['training']) && sanitize\_text\_field($attr['training']) === 'true' ? true : ' '; |
| [213](#L213) | $category\_selective = (isset($attr['category\_selective']) && sanitize\_text\_field($attr['category\_selective']) === 'true') ? true : ' '; |
| [214](#L214) | $title = isset($attr['title']) ? sanitize\_text\_field($attr['title']) : ' '; |
| [215](#L215) |  |
| [216](#L216) | $this->set\_prop( 'is\_training', $is\_training ); |
| [217](#L217) | $this->set\_prop( 'category\_selective', $category\_selective ); |
| [218](#L218) | $this->set\_prop( 'title', $title ); |
| [219](#L219) |  |
| [220](#L220) | if (is\_null($id)) { |
| [221](#L221) | $quiz\_content = "<p class='wrong\_shortcode\_text' style='color:red;'>" . \_\_('Wrong shortcode initialized', $this->plugin\_name) . "</p>"; |
| [222](#L222) | return str\_replace(array("\r\n", "\n", "\r"), "\n", $quiz\_content); |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | $this->buttons\_texts = $this->ays\_set\_quiz\_texts($id); |
| [226](#L226) |  |
| [227](#L227) | $this->enqueue\_styles(); |
| [228](#L228) | $this->enqueue\_scripts(); |
| [229](#L229) |  |
| [230](#L230) | $quiz\_content = $this->show\_quiz($id); |
| [231](#L231) | return str\_replace(array("\r\n", "\n", "\r"), '', $quiz\_content); |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) | public function ays\_set\_quiz\_texts($id){ |
| [235](#L235) |  |
| [236](#L236) | /\* |
| [237](#L237) | \* Get Quiz buttons texts from database |
| [238](#L238) | \*/ |
| [239](#L239) |  |
| [240](#L240) | $quiz = $this->get\_quiz\_by\_id($id); |
| [241](#L241) |  |
| [242](#L242) | $options = ( isset($quiz['options']) && ( json\_decode($quiz['options'], true) != null ) ) ? json\_decode($quiz['options'], true) : array(); |
| [243](#L243) |  |
| [244](#L244) | // Enable custom texts for buttons |
| [245](#L245) | $options['quiz\_enable\_custom\_texts\_for\_buttons'] = isset($options['quiz\_enable\_custom\_texts\_for\_buttons']) ? sanitize\_text\_field($options['quiz\_enable\_custom\_texts\_for\_buttons']) : 'off'; |
| [246](#L246) | $quiz\_enable\_custom\_texts\_for\_buttons = (isset($options['quiz\_enable\_custom\_texts\_for\_buttons']) && $options['quiz\_enable\_custom\_texts\_for\_buttons'] == 'on') ? true : false; |
| [247](#L247) |  |
| [248](#L248) | $settings\_buttons\_texts = $this->settings->ays\_get\_setting('buttons\_texts'); |
| [249](#L249) | if($settings\_buttons\_texts){ |
| [250](#L250) | $settings\_buttons\_texts = json\_decode(stripcslashes($settings\_buttons\_texts), true); |
| [251](#L251) | }else{ |
| [252](#L252) | $settings\_buttons\_texts = array(); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | $ays\_start\_button           = (isset($settings\_buttons\_texts['start\_button']) && $settings\_buttons\_texts['start\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['start\_button'] ) ) : 'Start' ; |
| [256](#L256) | $ays\_next\_button            = (isset($settings\_buttons\_texts['next\_button']) && $settings\_buttons\_texts['next\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['next\_button'] ) ) : 'Next' ; |
| [257](#L257) | $ays\_previous\_button        = (isset($settings\_buttons\_texts['previous\_button']) && $settings\_buttons\_texts['previous\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['previous\_button'] ) ) : 'Prev' ; |
| [258](#L258) | $ays\_clear\_button           = (isset($settings\_buttons\_texts['clear\_button']) && $settings\_buttons\_texts['clear\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['clear\_button'] ) ) : 'Clear' ; |
| [259](#L259) | $ays\_finish\_button          = (isset($settings\_buttons\_texts['finish\_button']) && $settings\_buttons\_texts['finish\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['finish\_button'] ) ) : 'Finish' ; |
| [260](#L260) | $ays\_see\_result\_button      = (isset($settings\_buttons\_texts['see\_result\_button']) && $settings\_buttons\_texts['see\_result\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['see\_result\_button'] ) ) : 'See Result' ; |
| [261](#L261) | $ays\_restart\_quiz\_button    = (isset($settings\_buttons\_texts['restart\_quiz\_button']) && $settings\_buttons\_texts['restart\_quiz\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['restart\_quiz\_button'] ) ) : 'Restart quiz' ; |
| [262](#L262) | $ays\_send\_feedback\_button   = (isset($settings\_buttons\_texts['send\_feedback\_button']) && $settings\_buttons\_texts['send\_feedback\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['send\_feedback\_button'] ) ) : 'Send feedback' ; |
| [263](#L263) | $ays\_load\_more\_button       = (isset($settings\_buttons\_texts['load\_more\_button']) && $settings\_buttons\_texts['load\_more\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['load\_more\_button'] ) ) : 'Load more' ; |
| [264](#L264) | $ays\_exit\_button            = (isset($settings\_buttons\_texts['exit\_button']) && $settings\_buttons\_texts['exit\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['exit\_button'] ) ) : 'Exit' ; |
| [265](#L265) | $ays\_check\_button           = (isset($settings\_buttons\_texts['check\_button']) && $settings\_buttons\_texts['check\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['check\_button'] ) ) : 'Check' ; |
| [266](#L266) | $ays\_login\_button           = (isset($settings\_buttons\_texts['login\_button']) && $settings\_buttons\_texts['login\_button'] != '') ? stripslashes( esc\_attr( $settings\_buttons\_texts['login\_button'] ) ) : 'Log In' ; |
| [267](#L267) |  |
| [268](#L268) |  |
| [269](#L269) | ////////////////////////// |
| [270](#L270) | ////////////////////////// |
| [271](#L271) | ////////////////////////// |
| [272](#L272) |  |
| [273](#L273) | // New Start button |
| [274](#L274) | $quiz\_custom\_texts\_start\_button         = (isset($options['quiz\_custom\_texts\_start\_button']) && $options['quiz\_custom\_texts\_start\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_start\_button'] ) ) : $ays\_start\_button; |
| [275](#L275) | $quiz\_custom\_texts\_next\_button          = (isset($options['quiz\_custom\_texts\_next\_button']) && $options['quiz\_custom\_texts\_next\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_next\_button'] ) ) : $ays\_next\_button; |
| [276](#L276) | $quiz\_custom\_texts\_prev\_button          = (isset($options['quiz\_custom\_texts\_prev\_button']) && $options['quiz\_custom\_texts\_prev\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_prev\_button'] ) ) : $ays\_previous\_button; |
| [277](#L277) | $quiz\_custom\_texts\_clear\_button         = (isset($options['quiz\_custom\_texts\_clear\_button']) && $options['quiz\_custom\_texts\_clear\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_clear\_button'] ) ) : $ays\_clear\_button; |
| [278](#L278) | $quiz\_custom\_texts\_finish\_button        = (isset($options['quiz\_custom\_texts\_finish\_button']) && $options['quiz\_custom\_texts\_finish\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_finish\_button'] ) ) : $ays\_finish\_button; |
| [279](#L279) | $quiz\_custom\_texts\_see\_results\_button   = (isset($options['quiz\_custom\_texts\_see\_results\_button']) && $options['quiz\_custom\_texts\_see\_results\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_see\_results\_button'] ) ) : $ays\_see\_result\_button; |
| [280](#L280) | $quiz\_custom\_texts\_restart\_quiz\_button  = (isset($options['quiz\_custom\_texts\_restart\_quiz\_button']) && $options['quiz\_custom\_texts\_restart\_quiz\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_restart\_quiz\_button'] ) ) : $ays\_restart\_quiz\_button; |
| [281](#L281) | $quiz\_custom\_texts\_send\_feedback\_button = (isset($options['quiz\_custom\_texts\_send\_feedback\_button']) && $options['quiz\_custom\_texts\_send\_feedback\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_send\_feedback\_button'] ) ) : $ays\_send\_feedback\_button; |
| [282](#L282) | $quiz\_custom\_texts\_load\_more\_button     = (isset($options['quiz\_custom\_texts\_load\_more\_button']) && $options['quiz\_custom\_texts\_load\_more\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_load\_more\_button'] ) ) : $ays\_load\_more\_button; |
| [283](#L283) | $quiz\_custom\_texts\_exit\_button          = (isset($options['quiz\_custom\_texts\_exit\_button']) && $options['quiz\_custom\_texts\_exit\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_exit\_button'] ) ) : $ays\_exit\_button; |
| [284](#L284) | $quiz\_custom\_texts\_check\_button         = (isset($options['quiz\_custom\_texts\_check\_button']) && $options['quiz\_custom\_texts\_check\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_check\_button'] ) ) : $ays\_check\_button; |
| [285](#L285) | $quiz\_custom\_texts\_login\_button         = (isset($options['quiz\_custom\_texts\_login\_button']) && $options['quiz\_custom\_texts\_login\_button'] != '') ? stripslashes( esc\_attr( $options['quiz\_custom\_texts\_login\_button'] ) ) : $ays\_login\_button; |
| [286](#L286) |  |
| [287](#L287) | if ($ays\_start\_button === 'Start') { |
| [288](#L288) | $ays\_start\_button\_text = \_\_('Start', 'quiz-maker'); |
| [289](#L289) | }else{ |
| [290](#L290) | $ays\_start\_button\_text = $ays\_start\_button; |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | if ($ays\_next\_button === 'Next') { |
| [294](#L294) | $ays\_next\_button\_text = \_\_('Next', 'quiz-maker'); |
| [295](#L295) | }else{ |
| [296](#L296) | $ays\_next\_button\_text = $ays\_next\_button; |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | if ($ays\_previous\_button === 'Prev') { |
| [300](#L300) | $ays\_previous\_button\_text = \_\_('Prev', 'quiz-maker'); |
| [301](#L301) | }else{ |
| [302](#L302) | $ays\_previous\_button\_text = $ays\_previous\_button; |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) | if ($ays\_clear\_button === 'Clear') { |
| [306](#L306) | $ays\_clear\_button\_text = \_\_('Clear', 'quiz-maker'); |
| [307](#L307) | }else{ |
| [308](#L308) | $ays\_clear\_button\_text = $ays\_clear\_button; |
| [309](#L309) | } |
| [310](#L310) |  |
| [311](#L311) | if ($ays\_finish\_button === 'Finish') { |
| [312](#L312) | $ays\_finish\_button\_text = \_\_('Finish', 'quiz-maker'); |
| [313](#L313) | }else{ |
| [314](#L314) | $ays\_finish\_button\_text = $ays\_finish\_button; |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | if ($ays\_see\_result\_button === 'See Result') { |
| [318](#L318) | $ays\_see\_result\_button\_text = \_\_('See Result', 'quiz-maker'); |
| [319](#L319) | }else{ |
| [320](#L320) | $ays\_see\_result\_button\_text = $ays\_see\_result\_button; |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | if ($ays\_restart\_quiz\_button === 'Restart quiz') { |
| [324](#L324) | $ays\_restart\_quiz\_button\_text = \_\_('Restart quiz', 'quiz-maker'); |
| [325](#L325) | }else{ |
| [326](#L326) | $ays\_restart\_quiz\_button\_text = $ays\_restart\_quiz\_button; |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | if ($ays\_send\_feedback\_button === 'Send feedback') { |
| [330](#L330) | $ays\_send\_feedback\_button\_text = \_\_('Send feedback', 'quiz-maker'); |
| [331](#L331) | }else{ |
| [332](#L332) | $ays\_send\_feedback\_button\_text = $ays\_send\_feedback\_button; |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | if ($ays\_load\_more\_button === 'Load more') { |
| [336](#L336) | $ays\_load\_more\_button\_text = \_\_('Load more', 'quiz-maker'); |
| [337](#L337) | }else{ |
| [338](#L338) | $ays\_load\_more\_button\_text = $ays\_load\_more\_button; |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | if ($ays\_exit\_button === 'Exit') { |
| [342](#L342) | $ays\_exit\_button\_text = \_\_('Exit', 'quiz-maker'); |
| [343](#L343) | }else{ |
| [344](#L344) | $ays\_exit\_button\_text = $ays\_exit\_button; |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | if ($ays\_check\_button === 'Check') { |
| [348](#L348) | $ays\_check\_button\_text = \_\_('Check', 'quiz-maker'); |
| [349](#L349) | }else{ |
| [350](#L350) | $ays\_check\_button\_text = $ays\_check\_button; |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | if ($ays\_login\_button === 'Log In') { |
| [354](#L354) | $ays\_login\_button\_text = \_\_('Log In', 'quiz-maker'); |
| [355](#L355) | }else{ |
| [356](#L356) | $ays\_login\_button\_text = $ays\_login\_button; |
| [357](#L357) | } |
| [358](#L358) |  |
| [359](#L359) | //////////////////////////////////////////// |
| [360](#L360) | //////////////////////////////////////////// |
| [361](#L361) | //////////////////////////////////////////// |
| [362](#L362) |  |
| [363](#L363) | if( $quiz\_enable\_custom\_texts\_for\_buttons ){ |
| [364](#L364) |  |
| [365](#L365) | if ($quiz\_custom\_texts\_start\_button === 'Start') { |
| [366](#L366) | $ays\_start\_button\_text = \_\_('Start', 'quiz-maker'); |
| [367](#L367) | }else{ |
| [368](#L368) | $ays\_start\_button\_text = $quiz\_custom\_texts\_start\_button; |
| [369](#L369) | } |
| [370](#L370) |  |
| [371](#L371) | if ($quiz\_custom\_texts\_next\_button === 'Next') { |
| [372](#L372) | $ays\_next\_button\_text = \_\_('Next', 'quiz-maker'); |
| [373](#L373) | }else{ |
| [374](#L374) | $ays\_next\_button\_text = $quiz\_custom\_texts\_next\_button; |
| [375](#L375) | } |
| [376](#L376) |  |
| [377](#L377) | if ($quiz\_custom\_texts\_prev\_button === 'Prev') { |
| [378](#L378) | $ays\_previous\_button\_text = \_\_('Prev', 'quiz-maker'); |
| [379](#L379) | }else{ |
| [380](#L380) | $ays\_previous\_button\_text = $quiz\_custom\_texts\_prev\_button; |
| [381](#L381) | } |
| [382](#L382) |  |
| [383](#L383) | if ($quiz\_custom\_texts\_clear\_button === 'Clear') { |
| [384](#L384) | $ays\_clear\_button\_text = \_\_('Clear', 'quiz-maker'); |
| [385](#L385) | }else{ |
| [386](#L386) | $ays\_clear\_button\_text = $quiz\_custom\_texts\_clear\_button; |
| [387](#L387) | } |
| [388](#L388) |  |
| [389](#L389) | if ($quiz\_custom\_texts\_finish\_button === 'Finish') { |
| [390](#L390) | $ays\_finish\_button\_text = \_\_('Finish', 'quiz-maker'); |
| [391](#L391) | }else{ |
| [392](#L392) | $ays\_finish\_button\_text = $quiz\_custom\_texts\_finish\_button; |
| [393](#L393) | } |
| [394](#L394) |  |
| [395](#L395) | if ($quiz\_custom\_texts\_see\_results\_button === 'See Result') { |
| [396](#L396) | $ays\_see\_result\_button\_text = \_\_('See Result', 'quiz-maker'); |
| [397](#L397) | }else{ |
| [398](#L398) | $ays\_see\_result\_button\_text = $quiz\_custom\_texts\_see\_results\_button; |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) | if ($quiz\_custom\_texts\_restart\_quiz\_button === 'Restart quiz') { |
| [402](#L402) | $ays\_restart\_quiz\_button\_text = \_\_('Restart quiz', 'quiz-maker'); |
| [403](#L403) | }else{ |
| [404](#L404) | $ays\_restart\_quiz\_button\_text = $quiz\_custom\_texts\_restart\_quiz\_button; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | if ($quiz\_custom\_texts\_send\_feedback\_button === 'Send feedback') { |
| [408](#L408) | $ays\_send\_feedback\_button\_text = \_\_('Send feedback', 'quiz-maker'); |
| [409](#L409) | }else{ |
| [410](#L410) | $ays\_send\_feedback\_button\_text = $quiz\_custom\_texts\_send\_feedback\_button; |
| [411](#L411) | } |
| [412](#L412) |  |
| [413](#L413) | if ($quiz\_custom\_texts\_load\_more\_button === 'Load more') { |
| [414](#L414) | $ays\_load\_more\_button\_text = \_\_('Load more', 'quiz-maker'); |
| [415](#L415) | }else{ |
| [416](#L416) | $ays\_load\_more\_button\_text = $quiz\_custom\_texts\_load\_more\_button; |
| [417](#L417) | } |
| [418](#L418) |  |
| [419](#L419) | if ($quiz\_custom\_texts\_exit\_button === 'Exit') { |
| [420](#L420) | $ays\_exit\_button\_text = \_\_('Exit', 'quiz-maker'); |
| [421](#L421) | }else{ |
| [422](#L422) | $ays\_exit\_button\_text = $quiz\_custom\_texts\_exit\_button; |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | if ($quiz\_custom\_texts\_check\_button === 'Check') { |
| [426](#L426) | $ays\_check\_button\_text = \_\_('Check', 'quiz-maker'); |
| [427](#L427) | }else{ |
| [428](#L428) | $ays\_check\_button\_text = $quiz\_custom\_texts\_check\_button; |
| [429](#L429) | } |
| [430](#L430) |  |
| [431](#L431) | if ($quiz\_custom\_texts\_login\_button === 'Log In') { |
| [432](#L432) | $ays\_login\_button\_text = \_\_('Log In', 'quiz-maker'); |
| [433](#L433) | }else{ |
| [434](#L434) | $ays\_login\_button\_text = $quiz\_custom\_texts\_login\_button; |
| [435](#L435) | } |
| [436](#L436) | } |
| [437](#L437) |  |
| [438](#L438) | $texts = array( |
| [439](#L439) | 'startButton'        => $ays\_start\_button\_text, |
| [440](#L440) | 'nextButton'         => $ays\_next\_button\_text, |
| [441](#L441) | 'previousButton'     => $ays\_previous\_button\_text, |
| [442](#L442) | 'clearButton'        => $ays\_clear\_button\_text, |
| [443](#L443) | 'finishButton'       => $ays\_finish\_button\_text, |
| [444](#L444) | 'seeResultButton'    => $ays\_see\_result\_button\_text, |
| [445](#L445) | 'restartQuizButton'  => $ays\_restart\_quiz\_button\_text, |
| [446](#L446) | 'sendFeedbackButton' => $ays\_send\_feedback\_button\_text, |
| [447](#L447) | 'loadMoreButton'     => $ays\_load\_more\_button\_text, |
| [448](#L448) | 'exitButton'         => $ays\_exit\_button\_text, |
| [449](#L449) | 'checkButton'        => $ays\_check\_button\_text, |
| [450](#L450) | 'loginButton'        => $ays\_login\_button\_text, |
| [451](#L451) | ); |
| [452](#L452) | return $texts; |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | public function ays\_set\_quiz\_fields\_placeholders\_texts(){ |
| [456](#L456) |  |
| [457](#L457) | /\* |
| [458](#L458) | \* Get Quiz fields placeholders from database |
| [459](#L459) | \*/ |
| [460](#L460) |  |
| [461](#L461) | $settings\_placeholders\_texts = $this->settings->ays\_get\_setting('fields\_placeholders'); |
| [462](#L462) | if($settings\_placeholders\_texts){ |
| [463](#L463) | $settings\_placeholders\_texts = json\_decode(stripcslashes($settings\_placeholders\_texts), true); |
| [464](#L464) | }else{ |
| [465](#L465) | $settings\_placeholders\_texts = array(); |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | $quiz\_fields\_placeholder\_name  = (isset($settings\_placeholders\_texts['quiz\_fields\_placeholder\_name']) && $settings\_placeholders\_texts['quiz\_fields\_placeholder\_name'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_placeholder\_name'] ) ) : 'Name'; |
| [469](#L469) |  |
| [470](#L470) | $quiz\_fields\_placeholder\_eamil = (isset($settings\_placeholders\_texts['quiz\_fields\_placeholder\_eamil']) && $settings\_placeholders\_texts['quiz\_fields\_placeholder\_eamil'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_placeholder\_eamil'] ) ) : 'Email'; |
| [471](#L471) |  |
| [472](#L472) | $quiz\_fields\_placeholder\_phone = (isset($settings\_placeholders\_texts['quiz\_fields\_placeholder\_phone']) && $settings\_placeholders\_texts['quiz\_fields\_placeholder\_phone'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_placeholder\_phone'] ) ) : 'Phone Number'; |
| [473](#L473) |  |
| [474](#L474) | $quiz\_fields\_label\_name  = (isset($settings\_placeholders\_texts['quiz\_fields\_label\_name']) && $settings\_placeholders\_texts['quiz\_fields\_label\_name'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_label\_name'] ) ) : 'Name'; |
| [475](#L475) |  |
| [476](#L476) | $quiz\_fields\_label\_eamil = (isset($settings\_placeholders\_texts['quiz\_fields\_label\_eamil']) && $settings\_placeholders\_texts['quiz\_fields\_label\_eamil'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_label\_eamil'] ) ) : 'Email'; |
| [477](#L477) |  |
| [478](#L478) | $quiz\_fields\_label\_phone = (isset($settings\_placeholders\_texts['quiz\_fields\_label\_phone']) && $settings\_placeholders\_texts['quiz\_fields\_label\_phone'] != '') ? stripslashes( esc\_attr( $settings\_placeholders\_texts['quiz\_fields\_label\_phone'] ) ) : 'Phone Number'; |
| [479](#L479) |  |
| [480](#L480) | if ($quiz\_fields\_placeholder\_name === 'Name') { |
| [481](#L481) | $quiz\_fields\_placeholder\_name\_text = \_\_('Name', $this->plugin\_name); |
| [482](#L482) | }else{ |
| [483](#L483) | $quiz\_fields\_placeholder\_name\_text = $quiz\_fields\_placeholder\_name; |
| [484](#L484) | } |
| [485](#L485) |  |
| [486](#L486) | if ($quiz\_fields\_placeholder\_eamil === 'Email') { |
| [487](#L487) | $quiz\_fields\_placeholder\_eamil\_text = \_\_('Email', $this->plugin\_name); |
| [488](#L488) | }else{ |
| [489](#L489) | $quiz\_fields\_placeholder\_eamil\_text = $quiz\_fields\_placeholder\_eamil; |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | if ($quiz\_fields\_placeholder\_phone === 'Phone Number') { |
| [493](#L493) | $quiz\_fields\_placeholder\_phone\_text = \_\_('Phone Number', $this->plugin\_name); |
| [494](#L494) | }else{ |
| [495](#L495) | $quiz\_fields\_placeholder\_phone\_text = $quiz\_fields\_placeholder\_phone; |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | if ($quiz\_fields\_label\_name === 'Name') { |
| [499](#L499) | $quiz\_fields\_label\_name\_text = \_\_('Name', $this->plugin\_name); |
| [500](#L500) | }else{ |
| [501](#L501) | $quiz\_fields\_label\_name\_text = $quiz\_fields\_label\_name; |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) | if ($quiz\_fields\_label\_eamil === 'Email') { |
| [505](#L505) | $quiz\_fields\_label\_eamil\_text = \_\_('Email', $this->plugin\_name); |
| [506](#L506) | }else{ |
| [507](#L507) | $quiz\_fields\_label\_eamil\_text = $quiz\_fields\_label\_eamil; |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | if ($quiz\_fields\_label\_phone === 'Phone Number') { |
| [511](#L511) | $quiz\_fields\_label\_phone\_text = \_\_('Phone Number', $this->plugin\_name); |
| [512](#L512) | }else{ |
| [513](#L513) | $quiz\_fields\_label\_phone\_text = $quiz\_fields\_label\_phone; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | $texts = array( |
| [517](#L517) | 'namePlaceholder'       => $quiz\_fields\_placeholder\_name\_text, |
| [518](#L518) | 'emailPlaceholder'      => $quiz\_fields\_placeholder\_eamil\_text, |
| [519](#L519) | 'phonePlaceholder'      => $quiz\_fields\_placeholder\_phone\_text, |
| [520](#L520) | 'nameLabel'             => $quiz\_fields\_label\_name\_text, |
| [521](#L521) | 'emailLabel'            => $quiz\_fields\_label\_eamil\_text, |
| [522](#L522) | 'phoneLabel'            => $quiz\_fields\_label\_phone\_text, |
| [523](#L523) | ); |
| [524](#L524) |  |
| [525](#L525) | return $texts; |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | public function ays\_set\_quiz\_message\_variables\_data( $id, $quiz ){ |
| [529](#L529) |  |
| [530](#L530) | /\* |
| [531](#L531) | \* Quiz message variables for Start Page |
| [532](#L532) | \*/ |
| [533](#L533) |  |
| [534](#L534) | // Quiz options |
| [535](#L535) | $options = ( json\_decode($quiz['options'], true) != null ) ? json\_decode($quiz['options'], true) : array(); |
| [536](#L536) |  |
| [537](#L537) |  |
| [538](#L538) | // General Setting's Options |
| [539](#L539) | $quiz\_settings = $this->settings; |
| [540](#L540) | $general\_settings\_options = ($quiz\_settings->ays\_get\_setting('options') === false) ? json\_encode(array()) : $quiz\_settings->ays\_get\_setting('options'); |
| [541](#L541) | $settings\_options = json\_decode(stripcslashes($general\_settings\_options), true); |
| [542](#L542) |  |
| [543](#L543) | // Do not store IP adressess |
| [544](#L544) | $disable\_user\_ip = (isset($settings\_options['disable\_user\_ip']) && $settings\_options['disable\_user\_ip'] == 'on') ? true : false; |
| [545](#L545) |  |
| [546](#L546) |  |
| [547](#L547) | // Quiz Timer |
| [548](#L548) | $quiz\_timer = (isset( $options['timer'] ) && intval($options['timer']) != 0 && $options['timer'] != "") ? absint( sanitize\_text\_field( $options['timer'] ) ) : 100; |
| [549](#L549) |  |
| [550](#L550) | // Quiz title |
| [551](#L551) | $quiz\_title = (isset( $quiz['title'] ) && $quiz['title'] != "") ? stripslashes($quiz['title']) : ""; |
| [552](#L552) |  |
| [553](#L553) | // Quiz create date |
| [554](#L554) | $quiz\_creation\_date = (isset($options['create\_date']) && $options['create\_date'] != '') ? sanitize\_text\_field( $options['create\_date'] ) : ""; |
| [555](#L555) | if( $quiz\_creation\_date != "" ){ |
| [556](#L556) | $quiz\_creation\_date = date\_i18n( get\_option( 'date\_format' ), strtotime( $quiz\_creation\_date ) ); |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) | // Quiz Author ID |
| [560](#L560) | if ( isset( $options['author'] ) && is\_string($options['author']) ) { |
| [561](#L561) | $quiz\_current\_author\_data = (isset( $options['author'] ) && $options['author'] != '') ? json\_decode($options['author'], true) : array(); |
| [562](#L562) | } else { |
| [563](#L563) | $options\_author = isset( $options['author'] ) ? (array)$options['author'] : array(); |
| [564](#L564) | $quiz\_current\_author\_data = (is\_array( $options\_author ) && empty( $options\_author )) ? $options\_author : array(); |
| [565](#L565) | } |
| [566](#L566) |  |
| [567](#L567) | if($disable\_user\_ip){ |
| [568](#L568) | $user\_ip = ''; |
| [569](#L569) | }else{ |
| [570](#L570) | $user\_ip = $this->get\_user\_ip(); |
| [571](#L571) | } |
| [572](#L572) |  |
| [573](#L573) | $current\_user\_ip = $user\_ip; |
| [574](#L574) |  |
| [575](#L575) | $question\_ids = $this->get\_quiz\_questions\_count($id); |
| [576](#L576) |  |
| [577](#L577) | $questions\_count = 0; |
| [578](#L578) | if ( ! empty( $question\_ids ) ) { |
| [579](#L579) | $questions\_count = count($question\_ids); |
| [580](#L580) | } |
| [581](#L581) |  |
| [582](#L582) | // WP home page url |
| [583](#L583) | $home\_main\_url = home\_url(); |
| [584](#L584) | $wp\_home\_page\_url = '<a href="'.$home\_main\_url.'" target="\_blank">'.$home\_main\_url.'</a>'; |
| [585](#L585) |  |
| [586](#L586) | $user\_first\_name        = ''; |
| [587](#L587) | $user\_last\_name         = ''; |
| [588](#L588) | $user\_nickname          = ''; |
| [589](#L589) | $user\_display\_name      = ''; |
| [590](#L590) | $user\_wordpress\_email   = ''; |
| [591](#L591) | $user\_wordpress\_roles   = ''; |
| [592](#L592) | $user\_id = get\_current\_user\_id(); |
| [593](#L593) | if($user\_id != 0){ |
| [594](#L594) | $usermeta = get\_user\_meta( $user\_id ); |
| [595](#L595) | if($usermeta !== null){ |
| [596](#L596) | $user\_first\_name = (isset($usermeta['first\_name'][0]) && sanitize\_text\_field( $usermeta['first\_name'][0] != '') ) ? sanitize\_text\_field( $usermeta['first\_name'][0] ) : ''; |
| [597](#L597) | $user\_last\_name  = (isset($usermeta['last\_name'][0]) && sanitize\_text\_field( $usermeta['last\_name'][0] != '') ) ? sanitize\_text\_field( $usermeta['last\_name'][0] ) : ''; |
| [598](#L598) | $user\_nickname   = (isset($usermeta['nickname'][0]) && sanitize\_text\_field( $usermeta['nickname'][0] != '') ) ? sanitize\_text\_field( $usermeta['nickname'][0] ) : ''; |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) | $current\_user\_data = get\_userdata( $user\_id ); |
| [602](#L602) | if ( ! is\_null( $current\_user\_data ) && $current\_user\_data ) { |
| [603](#L603) | $user\_display\_name = ( isset( $current\_user\_data->data->display\_name ) && $current\_user\_data->data->display\_name != '' ) ? sanitize\_text\_field( $current\_user\_data->data->display\_name ) : ""; |
| [604](#L604) |  |
| [605](#L605) | $user\_wordpress\_email = ( isset( $current\_user\_data->data->user\_email ) && $current\_user\_data->data->user\_email != '' ) ? sanitize\_text\_field( $current\_user\_data->data->user\_email ) : ""; |
| [606](#L606) |  |
| [607](#L607) | $user\_wordpress\_roles = ( isset( $current\_user\_data->roles ) && ! empty( $current\_user\_data->roles ) ) ? $current\_user\_data->roles : ""; |
| [608](#L608) |  |
| [609](#L609) | if ( !empty( $user\_wordpress\_roles ) && $user\_wordpress\_roles != "" ) { |
| [610](#L610) | if ( is\_array( $user\_wordpress\_roles ) ) { |
| [611](#L611) | $user\_wordpress\_roles = implode(",", $user\_wordpress\_roles); |
| [612](#L612) | } |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | $current\_quiz\_author = \_\_( "Unknown", $this->plugin\_name ); |
| [618](#L618) | $current\_quiz\_author\_email = ""; |
| [619](#L619) | $current\_quiz\_author\_nickname = ""; |
| [620](#L620) |  |
| [621](#L621) | $super\_admin\_email = get\_option('admin\_email'); |
| [622](#L622) |  |
| [623](#L623) | if( !empty($quiz\_current\_author\_data) ){ |
| [624](#L624) | if( !is\_array($quiz\_current\_author\_data) ){ |
| [625](#L625) | $quiz\_current\_author\_data = json\_decode($quiz\_current\_author\_data, true); |
| [626](#L626) | } |
| [627](#L627) |  |
| [628](#L628) | $quiz\_current\_author = (isset($quiz\_current\_author\_data['id']) && $quiz\_current\_author\_data['id'] != "") ? absint(sanitize\_text\_field( $quiz\_current\_author\_data['id'] )) : ""; |
| [629](#L629) |  |
| [630](#L630) | $current\_quiz\_user\_data = get\_userdata( $quiz\_current\_author ); |
| [631](#L631) | if ( ! is\_null( $current\_quiz\_user\_data ) && $current\_quiz\_user\_data ) { |
| [632](#L632) | $current\_quiz\_author            = ( isset( $current\_quiz\_user\_data->data->display\_name ) && $current\_quiz\_user\_data->data->display\_name != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->display\_name ) : ""; |
| [633](#L633) | $current\_quiz\_author\_email      = ( isset( $current\_quiz\_user\_data->data->user\_email ) && $current\_quiz\_user\_data->data->user\_email != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->user\_email ) : ""; |
| [634](#L634) | $current\_quiz\_author\_nickname   = ( isset( $current\_quiz\_user\_data->data->user\_nicename ) && $current\_quiz\_user\_data->data->user\_nicename != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->user\_nicename ) : ""; |
| [635](#L635) | } |
| [636](#L636) | } |
| [637](#L637) |  |
| [638](#L638) | $message\_data = array( |
| [639](#L639) | 'quiz\_name'                     => $quiz\_title, |
| [640](#L640) | 'time'                          => $this->secondsToWords($quiz\_timer), |
| [641](#L641) | 'user\_first\_name'               => $user\_first\_name, |
| [642](#L642) | 'user\_last\_name'                => $user\_last\_name, |
| [643](#L643) | 'questions\_count'               => $questions\_count, |
| [644](#L644) | 'user\_nickname'                 => $user\_nickname, |
| [645](#L645) | 'user\_display\_name'             => $user\_display\_name, |
| [646](#L646) | 'user\_wordpress\_email'          => $user\_wordpress\_email, |
| [647](#L647) | 'user\_wordpress\_roles'          => $user\_wordpress\_roles, |
| [648](#L648) | 'quiz\_creation\_date'            => $quiz\_creation\_date, |
| [649](#L649) | 'current\_quiz\_author'           => $current\_quiz\_author, |
| [650](#L650) | 'current\_user\_ip'               => $current\_user\_ip, |
| [651](#L651) | 'current\_quiz\_author\_email'     => $current\_quiz\_author\_email, |
| [652](#L652) | 'current\_quiz\_author\_nickname'  => $current\_quiz\_author\_nickname, |
| [653](#L653) | 'admin\_email'                   => $super\_admin\_email, |
| [654](#L654) | 'home\_page\_url'                 => $wp\_home\_page\_url, |
| [655](#L655) | 'quiz\_id'                       => $id, |
| [656](#L656) | 'user\_id'                       => $user\_id, |
| [657](#L657) | ); |
| [658](#L658) |  |
| [659](#L659) | return $message\_data; |
| [660](#L660) | } |
| [661](#L661) |  |
| [662](#L662) | public function show\_quiz($id){ |
| [663](#L663) | $quiz = $this->get\_quiz\_by\_id($id); |
| [664](#L664) | $content = ''; |
| [665](#L665) |  |
| [666](#L666) | if (is\_null($quiz)) { |
| [667](#L667) | $content = "<p class='wrong\_shortcode\_text' style='color:red;'>" . \_\_('Wrong shortcode initialized', $this->plugin\_name) . "</p>"; |
| [668](#L668) | return $content; |
| [669](#L669) | } |
| [670](#L670) | if (intval($quiz['published']) === 0) { |
| [671](#L671) | return $content; |
| [672](#L672) | } |
| [673](#L673) | $options = ( json\_decode($quiz['options'], true) != null ) ? json\_decode($quiz['options'], true) : array(); |
| [674](#L674) | $options['quiz\_theme'] = (array\_key\_exists('quiz\_theme', $options)) ? $options['quiz\_theme'] : ''; |
| [675](#L675) |  |
| [676](#L676) | // $this->buttons\_texts = $this->ays\_set\_quiz\_texts($id); |
| [677](#L677) | $this->fields\_placeholders = $this->ays\_set\_quiz\_fields\_placeholders\_texts(); |
| [678](#L678) | $quiz\_parts = $this->ays\_quiz\_parts($id); |
| [679](#L679) |  |
| [680](#L680) | $settings\_for\_theme = $this->settings; |
| [681](#L681) | $buttons\_texts\_for\_theme = $this->buttons\_texts; |
| [682](#L682) |  |
| [683](#L683) | switch ($options['quiz\_theme']) { |
| [684](#L684) | case 'elegant\_dark': |
| [685](#L685) | include\_once('partials/class-quiz-theme-elegant-dark.php'); |
| [686](#L686) | $theme\_obj = new Quiz\_Theme\_Elegant\_Dark(AYS\_QUIZ\_NAME, AYS\_QUIZ\_NAME\_VERSION, 'elegant\_dark', $settings\_for\_theme, $buttons\_texts\_for\_theme); |
| [687](#L687) | $content = $theme\_obj->ays\_generate\_quiz($quiz\_parts); |
| [688](#L688) | break; |
| [689](#L689) | case 'elegant\_light': |
| [690](#L690) | include\_once('partials/class-quiz-theme-elegant-light.php'); |
| [691](#L691) | $theme\_obj = new Quiz\_Theme\_Elegant\_Light(AYS\_QUIZ\_NAME, AYS\_QUIZ\_NAME\_VERSION, 'elegant\_light', $settings\_for\_theme, $buttons\_texts\_for\_theme); |
| [692](#L692) | $content = $theme\_obj->ays\_generate\_quiz($quiz\_parts); |
| [693](#L693) | break; |
| [694](#L694) | case 'rect\_light': |
| [695](#L695) | include\_once('partials/class-quiz-theme-rect-light.php'); |
| [696](#L696) | $theme\_obj = new Quiz\_Theme\_Rect\_Light(AYS\_QUIZ\_NAME, AYS\_QUIZ\_NAME\_VERSION, 'rect\_light', $settings\_for\_theme, $buttons\_texts\_for\_theme); |
| [697](#L697) | $content = $theme\_obj->ays\_generate\_quiz($quiz\_parts); |
| [698](#L698) | break; |
| [699](#L699) | case 'rect\_dark': |
| [700](#L700) | include\_once('partials/class-quiz-theme-rect-dark.php'); |
| [701](#L701) | $theme\_obj = new Quiz\_Theme\_Rect\_Dark(AYS\_QUIZ\_NAME, AYS\_QUIZ\_NAME\_VERSION, 'rect\_dark', $settings\_for\_theme, $buttons\_texts\_for\_theme); |
| [702](#L702) | $content = $theme\_obj->ays\_generate\_quiz($quiz\_parts); |
| [703](#L703) | break; |
| [704](#L704) | default: |
| [705](#L705) | $content = $this->ays\_generate\_quiz($quiz\_parts); |
| [706](#L706) | } |
| [707](#L707) | return $content; |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | public function ays\_quiz\_parts($id){ |
| [711](#L711) |  |
| [712](#L712) | global $wpdb; |
| [713](#L713) | global $wp\_embed; |
| [714](#L714) |  |
| [715](#L715) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [716](#L716) |  |
| [717](#L717) | /\* |
| [718](#L718) | \* Get Quiz data from database by id |
| [719](#L719) | \* Separation options from quiz data |
| [720](#L720) | \*/ |
| [721](#L721) | $quiz = $this->get\_quiz\_by\_id($id); |
| [722](#L722) | $options = json\_decode($quiz['options'], true); |
| [723](#L723) |  |
| [724](#L724) | $settings\_options = $this->settings->ays\_get\_setting('options'); |
| [725](#L725) | if($settings\_options){ |
| [726](#L726) | $settings\_options = json\_decode(stripcslashes($settings\_options), true); |
| [727](#L727) | }else{ |
| [728](#L728) | $settings\_options = array(); |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | /\* |
| [732](#L732) | \* Quiz message variables for Start Page |
| [733](#L733) | \*/ |
| [734](#L734) |  |
| [735](#L735) | $message\_variables\_data = $this->ays\_set\_quiz\_message\_variables\_data( $id, $quiz ); |
| [736](#L736) |  |
| [737](#L737) |  |
| [738](#L738) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [739](#L739) |  |
| [740](#L740) | $randomize\_answers = false; |
| [741](#L741) | $questions = null; |
| [742](#L742) | $randomize\_questions = false; |
| [743](#L743) | $questions\_ordering\_by\_cat = false; |
| [744](#L744) | $quiz\_questions\_ids = ""; |
| [745](#L745) | $question\_bank\_cats = array(); |
| [746](#L746) |  |
| [747](#L747) | $arr\_questions = ($quiz["question\_ids"] == "") ? array() : explode(',', $quiz["question\_ids"]); |
| [748](#L748) | $arr\_questions = (count($arr\_questions) == 1 && $arr\_questions[0] == '') ? array() : $arr\_questions; |
| [749](#L749) |  |
| [750](#L750) | if ( !empty($arr\_questions) ) { |
| [751](#L751) | $new\_arr\_questions = implode( ",", $arr\_questions ); |
| [752](#L752) | $arr\_questions = self::get\_published\_questions\_id\_arr($new\_arr\_questions); |
| [753](#L753) | } |
| [754](#L754) |  |
| [755](#L755) | if( $this->get\_prop( 'is\_training' ) === true ){ |
| [756](#L756) | $saved\_passed\_questions = apply\_filters( 'ays\_qm\_front\_end\_training\_passed\_questions', array(), $id ); |
| [757](#L757) | $saved\_wrong\_questions = apply\_filters( 'ays\_qm\_front\_end\_training\_wrong\_questions', array(), $id ); |
| [758](#L758) | $arr\_questions = array\_diff( $arr\_questions, $saved\_passed\_questions ); |
| [759](#L759) | $arr\_questions = array\_values( $arr\_questions ); |
| [760](#L760) | } |
| [761](#L761) |  |
| [762](#L762) | if (isset($\_COOKIE['ays\_quiz\_selected\_categories-'.$id])) { |
| [763](#L763) | $selected\_questions = apply\_filters( 'ays\_qm\_front\_end\_category\_selective\_get\_questions', array(), $id ); |
| [764](#L764) | $arr\_questions = $selected\_questions; |
| [765](#L765) | } |
| [766](#L766) |  |
| [767](#L767) | $quiz\_questions\_ids = implode(',', $arr\_questions); |
| [768](#L768) | if (isset($options['randomize\_questions']) && $options['randomize\_questions'] == 'on') { |
| [769](#L769) | $randomize\_questions = true; |
| [770](#L770) | shuffle($arr\_questions); |
| [771](#L771) | } |
| [772](#L772) | if (isset($options['enable\_question\_bank']) && $options['enable\_question\_bank'] == 'on' && |
| [773](#L773) | isset($options['questions\_count']) && intval($options['questions\_count']) > 0 && |
| [774](#L774) | $options['questions\_count'] <= count($arr\_questions)) { |
| [775](#L775) | $random\_questions = array\_rand($arr\_questions, intval($options['questions\_count'])); |
| [776](#L776) | if (!is\_array($random\_questions)) { |
| [777](#L777) | $random\_questions = array($random\_questions); |
| [778](#L778) | } |
| [779](#L779) |  |
| [780](#L780) | foreach ($random\_questions as $key => $question) { |
| [781](#L781) | $random\_questions[$key] = strval($arr\_questions[$question]); |
| [782](#L782) | } |
| [783](#L783) | $arr\_questions = $random\_questions; |
| [784](#L784) | $quiz\_questions\_ids = join(',', $random\_questions); |
| [785](#L785) | } |
| [786](#L786) |  |
| [787](#L787) | if(isset($options['enable\_questions\_ordering\_by\_cat']) && $options['enable\_questions\_ordering\_by\_cat'] == "on"){ |
| [788](#L788) | $questions\_ordering\_by\_cat = true; |
| [789](#L789) | } |
| [790](#L790) |  |
| [791](#L791) | $quest\_s = $this->get\_quiz\_questions\_by\_ids($arr\_questions); |
| [792](#L792) | $quests = array(); |
| [793](#L793) | foreach($quest\_s as $quest){ |
| [794](#L794) | $quests[$quest['id']] = $quest; |
| [795](#L795) | } |
| [796](#L796) |  |
| [797](#L797) | $question\_bank\_categories = $this->get\_question\_bank\_categories($quiz\_questions\_ids); |
| [798](#L798) |  |
| [799](#L799) | if(count($arr\_questions) > 0){ |
| [800](#L800) | if($questions\_ordering\_by\_cat){ |
| [801](#L801) | $question\_bank\_questions = array(); |
| [802](#L802) | $quiz\_questions\_ids = array(); |
| [803](#L803) |  |
| [804](#L804) | foreach($arr\_questions as $key => $val){ |
| [805](#L805) | $question\_bank\_questions[$val] = $quests[$val]; |
| [806](#L806) | if(isset($question\_bank\_categories[$quests[$val]['category\_id']])){ |
| [807](#L807) | $question\_bank\_cats[$quests[$val]['category\_id']][] = strval($val); |
| [808](#L808) | } |
| [809](#L809) | } |
| [810](#L810) |  |
| [811](#L811) | if ($randomize\_questions) { |
| [812](#L812) | $question\_bank\_cats = $this->ays\_shuffle\_assoc($question\_bank\_cats); |
| [813](#L813) |  |
| [814](#L814) | foreach ($question\_bank\_cats as $key => $value) { |
| [815](#L815) | shuffle($question\_bank\_cats[$key]); |
| [816](#L816) | } |
| [817](#L817) | } |
| [818](#L818) |  |
| [819](#L819) | $arr\_questions = array(); |
| [820](#L820) | foreach($question\_bank\_cats as $key => $value){ |
| [821](#L821) | $arr\_questions = array\_merge($arr\_questions, $value); |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | $quiz\_questions\_ids = implode(',', $arr\_questions); |
| [825](#L825) | } |
| [826](#L826) | } |
| [827](#L827) |  |
| [828](#L828) | $questions\_count = count($arr\_questions); |
| [829](#L829) |  |
| [830](#L830) | if (isset($options['randomize\_answers']) && $options['randomize\_answers'] == 'on') { |
| [831](#L831) | $randomize\_answers = true; |
| [832](#L832) | }else{ |
| [833](#L833) | $randomize\_answers = false; |
| [834](#L834) | } |
| [835](#L835) |  |
| [836](#L836) | if(isset($options['enable\_correction']) && $options['enable\_correction'] == "on"){ |
| [837](#L837) | $enable\_correction = true; |
| [838](#L838) | }else{ |
| [839](#L839) | $enable\_correction = false; |
| [840](#L840) | } |
| [841](#L841) |  |
| [842](#L842) | // Waiting time |
| [843](#L843) | $options['quiz\_waiting\_time'] = isset($options['quiz\_waiting\_time']) ? esc\_attr($options['quiz\_waiting\_time']) : 'off'; |
| [844](#L844) | $quiz\_waiting\_time = (isset($options['quiz\_waiting\_time']) && $options['quiz\_waiting\_time'] == 'on') ? true : false; |
| [845](#L845) |  |
| [846](#L846) |  |
| [847](#L847) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [848](#L848) |  |
| [849](#L849) | /\* |
| [850](#L850) | \* Quiz information form fields |
| [851](#L851) | \* |
| [852](#L852) | \* Checking required filelds |
| [853](#L853) | \* |
| [854](#L854) | \* Creating HTML code for printing |
| [855](#L855) | \*/ |
| [856](#L856) |  |
| [857](#L857) | $form\_inputs = null; |
| [858](#L858) | $show\_form = null; |
| [859](#L859) | $required\_fields = (array\_key\_exists('required\_fields', $options) && !is\_null($options['required\_fields'])) ? $options['required\_fields'] : array(); |
| [860](#L860) |  |
| [861](#L861) | $name\_required = (in\_array('ays\_user\_name', $required\_fields)) ? 'required' : ''; |
| [862](#L862) | $email\_required = (in\_array('ays\_user\_email', $required\_fields)) ? 'required' : ''; |
| [863](#L863) | $phone\_required = (in\_array('ays\_user\_phone', $required\_fields)) ? 'required' : ''; |
| [864](#L864) |  |
| [865](#L865) | $form\_title = ""; |
| [866](#L866) | if(isset($options['form\_title']) && $options['form\_title'] != ''){ |
| [867](#L867) | $form\_title = $this->replace\_message\_variables($options['form\_title'], $message\_variables\_data); |
| [868](#L868) | $form\_title = $this->ays\_autoembed($form\_title); |
| [869](#L869) | } |
| [870](#L870) |  |
| [871](#L871) | // Display form fields labels |
| [872](#L872) | $options['display\_fields\_labels'] = isset($options['display\_fields\_labels']) ? $options['display\_fields\_labels'] : 'on'; |
| [873](#L873) | $display\_fields\_labels = (isset($options['display\_fields\_labels']) && $options['display\_fields\_labels'] == 'on') ? true : false; |
| [874](#L874) |  |
| [875](#L875) | if($options['form\_name'] == "on"){ |
| [876](#L876) | $show\_form = "show"; |
| [877](#L877) | if( $display\_fields\_labels ){ |
| [878](#L878) | $form\_inputs .= "<label for='ays\_form\_field\_user\_name\_". $id ."'>". $this->fields\_placeholders['nameLabel'] ."</label>"; |
| [879](#L879) | } |
| [880](#L880) | $form\_inputs .= "<input type='text' id='ays\_form\_field\_user\_name\_". $id ."' name='ays\_user\_name' placeholder='". $this->fields\_placeholders['namePlaceholder'] ."' class='ays\_quiz\_form\_input ays\_animated\_x5ms' " . $name\_required . ">"; |
| [881](#L881) | }else{ |
| [882](#L882) | $form\_inputs .= "<input type='hidden' name='ays\_user\_name' placeholder='". $this->fields\_placeholders['namePlaceholder'] ."' value=''>"; |
| [883](#L883) | } |
| [884](#L884) | if($options['form\_email'] == "on"){ |
| [885](#L885) | $show\_form = "show"; |
| [886](#L886) | if( $display\_fields\_labels ){ |
| [887](#L887) | $form\_inputs .= "<label for='ays\_form\_field\_user\_email\_". $id ."'>". $this->fields\_placeholders['emailLabel'] ."</label>"; |
| [888](#L888) | } |
| [889](#L889) | $form\_inputs .= "<input type='text' id='ays\_form\_field\_user\_email\_". $id ."' name='ays\_user\_email' placeholder='". $this->fields\_placeholders['emailPlaceholder'] ."' class='ays\_quiz\_form\_input ays\_animated\_x5ms' " . $email\_required . ">"; |
| [890](#L890) | }else{ |
| [891](#L891) | $form\_inputs .= "<input type='hidden' name='ays\_user\_email' placeholder='". $this->fields\_placeholders['emailPlaceholder'] ."' value=''>"; |
| [892](#L892) | } |
| [893](#L893) | if($options['form\_phone'] == "on"){ |
| [894](#L894) | $show\_form = "show"; |
| [895](#L895) | if( $display\_fields\_labels ){ |
| [896](#L896) | $form\_inputs .= "<label for='ays\_form\_field\_user\_phone\_". $id ."'>". $this->fields\_placeholders['phoneLabel'] ."</label>"; |
| [897](#L897) | } |
| [898](#L898) | $form\_inputs .= "<input type='text' id='ays\_form\_field\_user\_phone\_". $id ."' name='ays\_user\_phone' placeholder='". $this->fields\_placeholders['phonePlaceholder'] ."' class='ays\_quiz\_form\_input ays\_animated\_x5ms' " . $phone\_required . ">"; |
| [899](#L899) | }else{ |
| [900](#L900) | $form\_inputs .= "<input type='hidden' name='ays\_user\_phone' placeholder='". $this->fields\_placeholders['phonePlaceholder'] ."' value=''>"; |
| [901](#L901) | } |
| [902](#L902) |  |
| [903](#L903) | // Show information form to logged in users |
| [904](#L904) | $options['show\_information\_form'] = isset($options['show\_information\_form']) ? $options['show\_information\_form'] : 'on'; |
| [905](#L905) | $show\_information\_form = (isset($options['show\_information\_form']) && $options['show\_information\_form'] == 'on') ? true : false; |
| [906](#L906) |  |
| [907](#L907) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [908](#L908) |  |
| [909](#L909) | /\* |
| [910](#L910) | \* Quiz colors |
| [911](#L911) | \* |
| [912](#L912) | \* Quiz container colors |
| [913](#L913) | \*/ |
| [914](#L914) |  |
| [915](#L915) | // Quiz container background color |
| [916](#L916) |  |
| [917](#L917) | if(isset($options['bg\_color']) && $options['bg\_color'] != ''){ |
| [918](#L918) | $bg\_color = $options['bg\_color']; |
| [919](#L919) | }else{ |
| [920](#L920) | $bg\_color = "#fff"; |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) | // Color of elements inside quiz container |
| [924](#L924) |  |
| [925](#L925) | if(isset($options['color']) && $options['color'] != ''){ |
| [926](#L926) | $color = $options['color']; |
| [927](#L927) | }else{ |
| [928](#L928) | $color = "#27ae60"; |
| [929](#L929) | } |
| [930](#L930) |  |
| [931](#L931) | // Color of text inside quiz container |
| [932](#L932) |  |
| [933](#L933) | if(isset($options['text\_color']) && $options['text\_color'] != ''){ |
| [934](#L934) | $text\_color = $options['text\_color']; |
| [935](#L935) | }else{ |
| [936](#L936) | $text\_color = "#333"; |
| [937](#L937) | } |
| [938](#L938) |  |
| [939](#L939) | // Color of text of buttons inside quiz container |
| [940](#L940) |  |
| [941](#L941) | if(isset($options['buttons\_text\_color']) && $options['buttons\_text\_color'] != ''){ |
| [942](#L942) | $buttons\_text\_color = $options['buttons\_text\_color']; |
| [943](#L943) | }else{ |
| [944](#L944) | $buttons\_text\_color = $text\_color; |
| [945](#L945) | } |
| [946](#L946) |  |
| [947](#L947) | // Quiz container shadow color |
| [948](#L948) |  |
| [949](#L949) | // CHecking exists box shadow option |
| [950](#L950) | $options['enable\_box\_shadow'] = (!isset($options['enable\_box\_shadow'])) ? 'on' : $options['enable\_box\_shadow']; |
| [951](#L951) |  |
| [952](#L952) | if(isset($options['box\_shadow\_color']) && $options['box\_shadow\_color'] != ''){ |
| [953](#L953) | $box\_shadow\_color = $options['box\_shadow\_color']; |
| [954](#L954) | }else{ |
| [955](#L955) | $box\_shadow\_color = "#333"; |
| [956](#L956) | } |
| [957](#L957) |  |
| [958](#L958) | // Quiz container border color |
| [959](#L959) |  |
| [960](#L960) | if(isset($options['quiz\_border\_color']) && $options['quiz\_border\_color'] != ''){ |
| [961](#L961) | $quiz\_border\_color = $options['quiz\_border\_color']; |
| [962](#L962) | }else{ |
| [963](#L963) | $quiz\_border\_color = '#000'; |
| [964](#L964) | } |
| [965](#L965) |  |
| [966](#L966) |  |
| [967](#L967) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [968](#L968) |  |
| [969](#L969) | /\* |
| [970](#L970) | \* Quiz styles |
| [971](#L971) | \* |
| [972](#L972) | \* Quiz container styles |
| [973](#L973) | \*/ |
| [974](#L974) |  |
| [975](#L975) |  |
| [976](#L976) | // Quiz container minimal height |
| [977](#L977) |  |
| [978](#L978) | if(isset($options['height']) && $options['height'] != ''){ |
| [979](#L979) | $quiz\_height = $options['height']; |
| [980](#L980) | }else{ |
| [981](#L981) | $quiz\_height = '400'; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | // Quiz container width |
| [985](#L985) |  |
| [986](#L986) | if(isset($options['width']) && $options['width'] != '' && absint( $options['width'] ) > 0){ |
| [987](#L987) | if (isset($options['quiz\_width\_by\_percentage\_px']) && $options['quiz\_width\_by\_percentage\_px'] == 'percentage') { |
| [988](#L988) | if (absint(intval($options['width'])) > 100 ) { |
| [989](#L989) | $quiz\_width = '100%'; |
| [990](#L990) | }else{ |
| [991](#L991) | $quiz\_width = $options['width'] . '%'; |
| [992](#L992) | } |
| [993](#L993) | }else{ |
| [994](#L994) | $quiz\_width = $options['width'] . 'px'; |
| [995](#L995) | } |
| [996](#L996) | }else{ |
| [997](#L997) | $quiz\_width = '100%'; |
| [998](#L998) | } |
| [999](#L999) |  |
| [1000](#L1000) |  |
| [1001](#L1001) | // Quiz container max-width for mobile |
| [1002](#L1002) | if(isset($options['mobile\_max\_width']) && $options['mobile\_max\_width'] != '' && absint( $options['mobile\_max\_width'] ) > 0){ |
| [1003](#L1003) | $mobile\_max\_width = $options['mobile\_max\_width'] . '%'; |
| [1004](#L1004) | }else{ |
| [1005](#L1005) | $mobile\_max\_width = '100%'; |
| [1006](#L1006) | } |
| [1007](#L1007) |  |
| [1008](#L1008) | // Quiz title transformation |
| [1009](#L1009) | $quiz\_title\_transformation = (isset($options['quiz\_title\_transformation']) && sanitize\_text\_field( $options['quiz\_title\_transformation'] ) != "") ? sanitize\_text\_field( $options['quiz\_title\_transformation'] ) : 'uppercase'; |
| [1010](#L1010) |  |
| [1011](#L1011) | // Quiz title font size |
| [1012](#L1012) | $quiz\_title\_font\_size = (isset($options['quiz\_title\_font\_size']) && ( $options['quiz\_title\_font\_size'] ) != '' && ( $options['quiz\_title\_font\_size'] ) != 0) ? esc\_attr( absint( $options['quiz\_title\_font\_size'] ) ) : 21; |
| [1013](#L1013) |  |
| [1014](#L1014) | // Quiz title font size | On mobile |
| [1015](#L1015) | $quiz\_title\_mobile\_font\_size = (isset($options['quiz\_title\_mobile\_font\_size']) && sanitize\_text\_field($options['quiz\_title\_mobile\_font\_size']) != '') ? esc\_attr( absint($options['quiz\_title\_mobile\_font\_size']) ) : 21; |
| [1016](#L1016) |  |
| [1017](#L1017) | // Quiz title text shadow |
| [1018](#L1018) | $options['quiz\_enable\_title\_text\_shadow'] = isset($options['quiz\_enable\_title\_text\_shadow']) ? esc\_attr($options['quiz\_enable\_title\_text\_shadow']) : 'off'; |
| [1019](#L1019) | $quiz\_enable\_title\_text\_shadow = (isset($options['quiz\_enable\_title\_text\_shadow']) && $options['quiz\_enable\_title\_text\_shadow'] == 'on') ? true : false; |
| [1020](#L1020) |  |
| [1021](#L1021) | // Quiz title text shadow color |
| [1022](#L1022) | $quiz\_title\_text\_shadow\_color = (isset($options['quiz\_title\_text\_shadow\_color']) && $options['quiz\_title\_text\_shadow\_color'] != '') ? esc\_attr($options['quiz\_title\_text\_shadow\_color']) : '#333'; |
| [1023](#L1023) |  |
| [1024](#L1024) | // Quiz Title Text Shadow X offset |
| [1025](#L1025) | $quiz\_title\_text\_shadow\_x\_offset = (isset($options['quiz\_title\_text\_shadow\_x\_offset']) && ( $options['quiz\_title\_text\_shadow\_x\_offset'] ) != '' && ( $options['quiz\_title\_text\_shadow\_x\_offset'] ) != 0) ? esc\_attr( intval( $options['quiz\_title\_text\_shadow\_x\_offset'] ) ) : 2; |
| [1026](#L1026) |  |
| [1027](#L1027) | // Quiz Title Text Shadow Y offset |
| [1028](#L1028) | $quiz\_title\_text\_shadow\_y\_offset = (isset($options['quiz\_title\_text\_shadow\_y\_offset']) && ( $options['quiz\_title\_text\_shadow\_y\_offset'] ) != '' && ( $options['quiz\_title\_text\_shadow\_y\_offset'] ) != 0) ? esc\_attr( intval( $options['quiz\_title\_text\_shadow\_y\_offset'] ) ) : 2; |
| [1029](#L1029) |  |
| [1030](#L1030) | // Quiz Title Text Shadow Z offset |
| [1031](#L1031) | $quiz\_title\_text\_shadow\_z\_offset = (isset($options['quiz\_title\_text\_shadow\_z\_offset']) && ( $options['quiz\_title\_text\_shadow\_z\_offset'] ) != '' && ( $options['quiz\_title\_text\_shadow\_z\_offset'] ) != 0) ? esc\_attr( intval( $options['quiz\_title\_text\_shadow\_z\_offset'] ) ) : 2; |
| [1032](#L1032) |  |
| [1033](#L1033) | $title\_text\_shadow\_offsets = $quiz\_title\_text\_shadow\_x\_offset . 'px ' . $quiz\_title\_text\_shadow\_y\_offset . 'px ' . $quiz\_title\_text\_shadow\_z\_offset . 'px '; |
| [1034](#L1034) |  |
| [1035](#L1035) | // Quiz image height |
| [1036](#L1036) | $quiz\_image\_height = (isset($options['quiz\_image\_height']) && sanitize\_text\_field( $options['quiz\_image\_height'] ) != '') ? absint( sanitize\_text\_field( $options['quiz\_image\_height'] ) ) : ''; |
| [1037](#L1037) |  |
| [1038](#L1038) |  |
| [1039](#L1039) | // Quiz container border radius |
| [1040](#L1040) |  |
| [1041](#L1041) | // Modified border radius for Pass count option and Rate avg option |
| [1042](#L1042) | $quiz\_modified\_border\_radius = ""; |
| [1043](#L1043) |  |
| [1044](#L1044) | if(isset($options['quiz\_border\_radius']) && $options['quiz\_border\_radius'] != ''){ |
| [1045](#L1045) | $quiz\_border\_radius = $options['quiz\_border\_radius']; |
| [1046](#L1046) | }else{ |
| [1047](#L1047) | $quiz\_border\_radius = '3px'; |
| [1048](#L1048) | } |
| [1049](#L1049) |  |
| [1050](#L1050) | // Quiz container shadow enabled/disabled |
| [1051](#L1051) |  |
| [1052](#L1052) | if(isset($options['enable\_box\_shadow']) && $options['enable\_box\_shadow'] == 'on'){ |
| [1053](#L1053) | $enable\_box\_shadow = true; |
| [1054](#L1054) | }else{ |
| [1055](#L1055) | $enable\_box\_shadow = false; |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | //  Box Shadow X offset |
| [1059](#L1059) | $quiz\_box\_shadow\_x\_offset = (isset($options['quiz\_box\_shadow\_x\_offset']) && sanitize\_text\_field( $options['quiz\_box\_shadow\_x\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_box\_shadow\_x\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_box\_shadow\_x\_offset'] ) ) : 0; |
| [1060](#L1060) |  |
| [1061](#L1061) | //  Box Shadow Y offset |
| [1062](#L1062) | $quiz\_box\_shadow\_y\_offset = (isset($options['quiz\_box\_shadow\_y\_offset']) && sanitize\_text\_field( $options['quiz\_box\_shadow\_y\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_box\_shadow\_y\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_box\_shadow\_y\_offset'] ) ) : 0; |
| [1063](#L1063) |  |
| [1064](#L1064) | //  Box Shadow Z offset |
| [1065](#L1065) | $quiz\_box\_shadow\_z\_offset = (isset($options['quiz\_box\_shadow\_z\_offset']) && sanitize\_text\_field( $options['quiz\_box\_shadow\_z\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_box\_shadow\_z\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_box\_shadow\_z\_offset'] ) ) : 15; |
| [1066](#L1066) |  |
| [1067](#L1067) | $box\_shadow\_offsets = $quiz\_box\_shadow\_x\_offset . 'px ' . $quiz\_box\_shadow\_y\_offset . 'px ' . $quiz\_box\_shadow\_z\_offset . 'px '; |
| [1068](#L1068) |  |
| [1069](#L1069) | // Quiz container background image |
| [1070](#L1070) |  |
| [1071](#L1071) | if(isset($options['quiz\_bg\_image']) && $options['quiz\_bg\_image'] != ''){ |
| [1072](#L1072) | $ays\_quiz\_bg\_image = $options['quiz\_bg\_image']; |
| [1073](#L1073) | }else{ |
| [1074](#L1074) | $ays\_quiz\_bg\_image = null; |
| [1075](#L1075) | } |
| [1076](#L1076) |  |
| [1077](#L1077) | // if( $ays\_quiz\_bg\_image != "" && !is\_null($ays\_quiz\_bg\_image) ){ |
| [1078](#L1078) | //     if ( !(filter\_var($ays\_quiz\_bg\_image, FILTER\_VALIDATE\_URL) && wp\_http\_validate\_url($ays\_quiz\_bg\_image)) ) { |
| [1079](#L1079) | //         // Invalid URL, handle accordingly |
| [1080](#L1080) | //         $ays\_quiz\_bg\_image = null; |
| [1081](#L1081) | //     } |
| [1082](#L1082) | // } |
| [1083](#L1083) |  |
| [1084](#L1084) | // if( $ays\_quiz\_bg\_image != "" && !is\_null($ays\_quiz\_bg\_image) ){ |
| [1085](#L1085) | //     $check\_if\_current\_image\_exists = Quiz\_Maker\_Admin::ays\_quiz\_check\_if\_current\_image\_exists($ays\_quiz\_bg\_image); |
| [1086](#L1086) |  |
| [1087](#L1087) | //     if( !$check\_if\_current\_image\_exists ){ |
| [1088](#L1088) | //         $ays\_quiz\_bg\_image = ""; |
| [1089](#L1089) | //     } |
| [1090](#L1090) | // } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Quiz container background image position |
| [1093](#L1093) | $quiz\_bg\_image\_position = "center center"; |
| [1094](#L1094) |  |
| [1095](#L1095) | if(isset($options['quiz\_bg\_image\_position']) && $options['quiz\_bg\_image\_position'] != ""){ |
| [1096](#L1096) | $quiz\_bg\_image\_position = $options['quiz\_bg\_image\_position']; |
| [1097](#L1097) | } |
| [1098](#L1098) |  |
| [1099](#L1099) | // Hide quiz background image on the result page |
| [1100](#L1100) | $quiz\_bg\_img\_in\_finish\_page = "false"; |
| [1101](#L1101) |  |
| [1102](#L1102) | if(isset($options['quiz\_bg\_img\_in\_finish\_page']) && $options['quiz\_bg\_img\_in\_finish\_page'] == "on"){ |
| [1103](#L1103) | $quiz\_bg\_img\_in\_finish\_page = "true"; |
| [1104](#L1104) | } |
| [1105](#L1105) |  |
| [1106](#L1106) | // Hide background image on start page |
| [1107](#L1107) | $options['quiz\_bg\_img\_on\_start\_page'] = isset($options['quiz\_bg\_img\_on\_start\_page']) ? $options['quiz\_bg\_img\_on\_start\_page'] : 'off'; |
| [1108](#L1108) | $quiz\_bg\_img\_on\_start\_page = (isset($options['quiz\_bg\_img\_on\_start\_page']) && $options['quiz\_bg\_img\_on\_start\_page'] == 'on') ? true : false; |
| [1109](#L1109) |  |
| [1110](#L1110) | $quiz\_bg\_img\_class = ''; |
| [1111](#L1111) | if ( $quiz\_bg\_img\_on\_start\_page ) { |
| [1112](#L1112) | $quiz\_bg\_img\_class = 'ays\_quiz\_hide\_bg\_on\_start\_page'; |
| [1113](#L1113) | } |
| [1114](#L1114) |  |
| [1115](#L1115) |  |
| [1116](#L1116) | /\* |
| [1117](#L1117) | \* Quiz container border enabled/disabled |
| [1118](#L1118) | \* |
| [1119](#L1119) | \* Quiz container border width |
| [1120](#L1120) | \* |
| [1121](#L1121) | \* Quiz container border style |
| [1122](#L1122) | \*/ |
| [1123](#L1123) |  |
| [1124](#L1124) | if(isset($options['enable\_border']) && $options['enable\_border'] == 'on'){ |
| [1125](#L1125) | $enable\_border = true; |
| [1126](#L1126) | }else{ |
| [1127](#L1127) | $enable\_border = false; |
| [1128](#L1128) | } |
| [1129](#L1129) |  |
| [1130](#L1130) | if(isset($options['quiz\_border\_width']) && $options['quiz\_border\_width'] != ''){ |
| [1131](#L1131) | $quiz\_border\_width = $options['quiz\_border\_width']; |
| [1132](#L1132) | }else{ |
| [1133](#L1133) | $quiz\_border\_width = '1'; |
| [1134](#L1134) | } |
| [1135](#L1135) |  |
| [1136](#L1136) | if(isset($options['quiz\_border\_style']) && $options['quiz\_border\_style'] != ''){ |
| [1137](#L1137) | $quiz\_border\_style = $options['quiz\_border\_style']; |
| [1138](#L1138) | }else{ |
| [1139](#L1139) | $quiz\_border\_style = 'solid'; |
| [1140](#L1140) | } |
| [1141](#L1141) |  |
| [1142](#L1142) | // Questions image width, height and sizing |
| [1143](#L1143) |  |
| [1144](#L1144) | // Image Width(px) |
| [1145](#L1145) | $image\_width = (isset($options['image\_width']) && sanitize\_text\_field($options['image\_width']) != '' && absint( sanitize\_text\_field($options['image\_width']) ) > 0) ? absint( sanitize\_text\_field($options['image\_width']) ) : ''; |
| [1146](#L1146) |  |
| [1147](#L1147) | // Quiz image width percentage/px |
| [1148](#L1148) | $quiz\_image\_width\_by\_percentage\_px = (isset($options['quiz\_image\_width\_by\_percentage\_px']) && sanitize\_text\_field( $options['quiz\_image\_width\_by\_percentage\_px'] ) != '') ? sanitize\_text\_field( $options['quiz\_image\_width\_by\_percentage\_px'] ) : 'pixels'; |
| [1149](#L1149) |  |
| [1150](#L1150) | if($image\_width != ''){ |
| [1151](#L1151) | if ($quiz\_image\_width\_by\_percentage\_px == 'percentage') { |
| [1152](#L1152) | if ($image\_width > 100 ) { |
| [1153](#L1153) | $question\_image\_width = '100%'; |
| [1154](#L1154) | }else{ |
| [1155](#L1155) | $question\_image\_width = $image\_width . '%'; |
| [1156](#L1156) | } |
| [1157](#L1157) | }else{ |
| [1158](#L1158) | $question\_image\_width = $image\_width . 'px'; |
| [1159](#L1159) | } |
| [1160](#L1160) | }else{ |
| [1161](#L1161) | $question\_image\_width = "100%"; |
| [1162](#L1162) | } |
| [1163](#L1163) |  |
| [1164](#L1164) | if(isset($options['image\_height']) && $options['image\_height'] != ''){ |
| [1165](#L1165) | $question\_image\_height = $options['image\_height'] . 'px'; |
| [1166](#L1166) | }else{ |
| [1167](#L1167) | $question\_image\_height = "auto"; |
| [1168](#L1168) | } |
| [1169](#L1169) |  |
| [1170](#L1170) | if(isset($options['image\_sizing']) && $options['image\_sizing'] != ''){ |
| [1171](#L1171) | $question\_image\_sizing = $options['image\_sizing']; |
| [1172](#L1172) | }else{ |
| [1173](#L1173) | $question\_image\_sizing = "cover"; |
| [1174](#L1174) | } |
| [1175](#L1175) |  |
| [1176](#L1176) | // Answers font size |
| [1177](#L1177) |  |
| [1178](#L1178) | $answers\_font\_size = '15'; |
| [1179](#L1179) | if(isset($options['answers\_font\_size']) && $options['answers\_font\_size'] != ""){ |
| [1180](#L1180) | $answers\_font\_size = $options['answers\_font\_size']; |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | // Answer font size | On mobile |
| [1184](#L1184) | $answers\_mobile\_font\_size = ( isset($options['answers\_mobile\_font\_size']) && $options['answers\_mobile\_font\_size'] != "" ) ? absint( sanitize\_text\_field( $options['answers\_mobile\_font\_size'] ) ) : 15; |
| [1185](#L1185) |  |
| [1186](#L1186) | // Question Font Size |
| [1187](#L1187) |  |
| [1188](#L1188) | $question\_font\_size = '16'; |
| [1189](#L1189) | if(isset($options['question\_font\_size']) && $options['question\_font\_size'] != ""){ |
| [1190](#L1190) | $question\_font\_size = $options['question\_font\_size']; |
| [1191](#L1191) | } |
| [1192](#L1192) |  |
| [1193](#L1193) | // Question font size | On mobile |
| [1194](#L1194) | $question\_mobile\_font\_size = ( isset($options['question\_mobile\_font\_size']) && $options['question\_mobile\_font\_size'] != "" ) ? absint( sanitize\_text\_field( $options['question\_mobile\_font\_size'] ) ) : 16; |
| [1195](#L1195) |  |
| [1196](#L1196) | // Font size for the wrong answer |
| [1197](#L1197) | $wrong\_answers\_font\_size = (isset($options['wrong\_answers\_font\_size']) && $options['wrong\_answers\_font\_size'] != '') ? absint(sanitize\_text\_field($options['wrong\_answers\_font\_size'])) : '16'; |
| [1198](#L1198) |  |
| [1199](#L1199) | // Font size for the wrong answer | Mobile |
| [1200](#L1200) | $wrong\_answers\_mobile\_font\_size = (isset($options['wrong\_answers\_mobile\_font\_size']) && $options['wrong\_answers\_mobile\_font\_size'] != '') ? absint(sanitize\_text\_field($options['wrong\_answers\_mobile\_font\_size'])) : $wrong\_answers\_font\_size; |
| [1201](#L1201) |  |
| [1202](#L1202) | // Wrong answer transform size |
| [1203](#L1203) | $quiz\_wrong\_answer\_text\_transform = (isset($options[ 'quiz\_wrong\_answer\_text\_transform' ]) && $options[ 'quiz\_wrong\_answer\_text\_transform' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_wrong\_answer\_text\_transform' ] ) ) : 'none'; |
| [1204](#L1204) |  |
| [1205](#L1205) | // Font size for the question explanation |
| [1206](#L1206) | $quest\_explanation\_font\_size = (isset($options['quest\_explanation\_font\_size']) && $options['quest\_explanation\_font\_size'] != '') ? absint(sanitize\_text\_field($options['quest\_explanation\_font\_size'])) : '16'; |
| [1207](#L1207) |  |
| [1208](#L1208) | // Font size for the question explanation | Mobile |
| [1209](#L1209) | $quest\_explanation\_mobile\_font\_size = (isset($options['quest\_explanation\_mobile\_font\_size']) && $options['quest\_explanation\_mobile\_font\_size'] != '') ? absint(esc\_attr($options['quest\_explanation\_mobile\_font\_size'])) : $quest\_explanation\_font\_size; |
| [1210](#L1210) |  |
| [1211](#L1211) | // Question explanation transform size |
| [1212](#L1212) | $quiz\_quest\_explanation\_text\_transform = (isset($options[ 'quiz\_quest\_explanation\_text\_transform' ]) && $options[ 'quiz\_quest\_explanation\_text\_transform' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_quest\_explanation\_text\_transform' ] ) ) : 'none'; |
| [1213](#L1213) |  |
| [1214](#L1214) | // Question Explanation text decoration |
| [1215](#L1215) | $quiz\_quest\_explanation\_text\_decoration = (isset($options[ 'quiz\_quest\_explanation\_text\_decoration' ]) && $options[ 'quiz\_quest\_explanation\_text\_decoration' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_quest\_explanation\_text\_decoration' ] ) ) : 'none'; |
| [1216](#L1216) |  |
| [1217](#L1217) | // Font size for the right answer | PC |
| [1218](#L1218) | $right\_answers\_font\_size = (isset($options['right\_answers\_font\_size']) && $options['right\_answers\_font\_size'] != '') ? absint(sanitize\_text\_field($options['right\_answers\_font\_size'])) : '16'; |
| [1219](#L1219) |  |
| [1220](#L1220) | // Font size for the right answer | Mobile |
| [1221](#L1221) | $right\_answers\_mobile\_font\_size = (isset($options['right\_answers\_mobile\_font\_size']) && $options['right\_answers\_mobile\_font\_size'] != '') ? absint(esc\_attr($options['right\_answers\_mobile\_font\_size'])) : $right\_answers\_font\_size; |
| [1222](#L1222) |  |
| [1223](#L1223) | // Right answer transform size |
| [1224](#L1224) | $quiz\_right\_answer\_text\_transform = (isset($options[ 'quiz\_right\_answer\_text\_transform' ]) && $options[ 'quiz\_right\_answer\_text\_transform' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_right\_answer\_text\_transform' ] ) ) : 'none'; |
| [1225](#L1225) |  |
| [1226](#L1226) | // Font size for the Note text | PC |
| [1227](#L1227) | $note\_text\_font\_size = (isset($options['note\_text\_font\_size']) && $options['note\_text\_font\_size'] != '') ? absint(esc\_attr($options['note\_text\_font\_size'])) : '14'; |
| [1228](#L1228) |  |
| [1229](#L1229) | // Font size for the Note text | Mobile |
| [1230](#L1230) | $note\_text\_mobile\_font\_size = (isset($options['note\_text\_mobile\_font\_size']) && $options['note\_text\_mobile\_font\_size'] != '') ? absint(esc\_attr($options['note\_text\_mobile\_font\_size'])) : $note\_text\_font\_size; |
| [1231](#L1231) |  |
| [1232](#L1232) | // Note text transform size |
| [1233](#L1233) | $quiz\_admin\_note\_text\_transform = (isset($options[ 'quiz\_admin\_note\_text\_transform' ]) && $options[ 'quiz\_admin\_note\_text\_transform' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_admin\_note\_text\_transform' ] ) ) : 'none'; |
| [1234](#L1234) |  |
| [1235](#L1235) | // Note text decoration |
| [1236](#L1236) | $quiz\_admin\_note\_text\_decoration = (isset($options[ 'quiz\_admin\_note\_text\_decoration' ]) && $options[ 'quiz\_admin\_note\_text\_decoration' ] != '') ? stripslashes ( esc\_attr( $options[ 'quiz\_admin\_note\_text\_decoration' ] ) ) : 'none'; |
| [1237](#L1237) |  |
| [1238](#L1238) | // Disable answer hover |
| [1239](#L1239) | $options['disable\_hover\_effect'] = isset($options['disable\_hover\_effect']) ? $options['disable\_hover\_effect'] : 'off'; |
| [1240](#L1240) | $disable\_hover\_effect = (isset($options['disable\_hover\_effect']) && $options['disable\_hover\_effect'] == "on") ? true : false; |
| [1241](#L1241) |  |
| [1242](#L1242) | // Question text alignment |
| [1243](#L1243) | $quiz\_question\_text\_alignment = (isset($options['quiz\_question\_text\_alignment']) && sanitize\_text\_field( $options['quiz\_question\_text\_alignment'] ) != '') ? sanitize\_text\_field( $options['quiz\_question\_text\_alignment'] ) : 'center'; |
| [1244](#L1244) |  |
| [1245](#L1245) |  |
| [1246](#L1246) | // Answers border options |
| [1247](#L1247) | $options['answers\_border'] = (isset($options['answers\_border'])) ? $options['answers\_border'] : 'on'; |
| [1248](#L1248) | $answers\_border = false; |
| [1249](#L1249) | if(isset($options['answers\_border']) && $options['answers\_border'] == 'on'){ |
| [1250](#L1250) | $answers\_border = true; |
| [1251](#L1251) | } |
| [1252](#L1252) | $answers\_border\_width = '1'; |
| [1253](#L1253) | if(isset($options['answers\_border\_width']) && $options['answers\_border\_width'] != ''){ |
| [1254](#L1254) | $answers\_border\_width = $options['answers\_border\_width']; |
| [1255](#L1255) | } |
| [1256](#L1256) | $answers\_border\_style = 'solid'; |
| [1257](#L1257) | if(isset($options['answers\_border\_style']) && $options['answers\_border\_style'] != ''){ |
| [1258](#L1258) | $answers\_border\_style = $options['answers\_border\_style']; |
| [1259](#L1259) | } |
| [1260](#L1260) | $answers\_border\_color = '#444'; |
| [1261](#L1261) | if(isset($options['answers\_border\_color']) && $options['answers\_border\_color'] != ''){ |
| [1262](#L1262) | $answers\_border\_color = $options['answers\_border\_color']; |
| [1263](#L1263) | } |
| [1264](#L1264) |  |
| [1265](#L1265) | // Answers margin option |
| [1266](#L1266) | $answers\_margin = 10; |
| [1267](#L1267) | if(isset($options['answers\_margin']) && $options['answers\_margin'] != ''){ |
| [1268](#L1268) | $answers\_margin = intval( $options['answers\_margin'] ); |
| [1269](#L1269) | } |
| [1270](#L1270) |  |
| [1271](#L1271) | /\* |
| [1272](#L1272) | \* Quiz container background gradient |
| [1273](#L1273) | \* |
| [1274](#L1274) | \*/ |
| [1275](#L1275) |  |
| [1276](#L1276) | // Checking exists background gradient option |
| [1277](#L1277) | $options['enable\_background\_gradient'] = (!isset($options['enable\_background\_gradient'])) ? "off" : $options['enable\_background\_gradient']; |
| [1278](#L1278) |  |
| [1279](#L1279) | if(isset($options['background\_gradient\_color\_1']) && $options['background\_gradient\_color\_1'] != ''){ |
| [1280](#L1280) | $background\_gradient\_color\_1 = $options['background\_gradient\_color\_1']; |
| [1281](#L1281) | }else{ |
| [1282](#L1282) | $background\_gradient\_color\_1 = "#000"; |
| [1283](#L1283) | } |
| [1284](#L1284) |  |
| [1285](#L1285) | if(isset($options['background\_gradient\_color\_2']) && $options['background\_gradient\_color\_2'] != ''){ |
| [1286](#L1286) | $background\_gradient\_color\_2 = $options['background\_gradient\_color\_2']; |
| [1287](#L1287) | }else{ |
| [1288](#L1288) | $background\_gradient\_color\_2 = "#fff"; |
| [1289](#L1289) | } |
| [1290](#L1290) |  |
| [1291](#L1291) | if(isset($options['quiz\_gradient\_direction']) && $options['quiz\_gradient\_direction'] != ''){ |
| [1292](#L1292) | $quiz\_gradient\_direction = $options['quiz\_gradient\_direction']; |
| [1293](#L1293) | }else{ |
| [1294](#L1294) | $quiz\_gradient\_direction = 'vertical'; |
| [1295](#L1295) | } |
| [1296](#L1296) | switch($quiz\_gradient\_direction) { |
| [1297](#L1297) | case "horizontal": |
| [1298](#L1298) | $quiz\_gradient\_direction = "to right"; |
| [1299](#L1299) | break; |
| [1300](#L1300) | case "diagonal\_left\_to\_right": |
| [1301](#L1301) | $quiz\_gradient\_direction = "to bottom right"; |
| [1302](#L1302) | break; |
| [1303](#L1303) | case "diagonal\_right\_to\_left": |
| [1304](#L1304) | $quiz\_gradient\_direction = "to bottom left"; |
| [1305](#L1305) | break; |
| [1306](#L1306) | default: |
| [1307](#L1307) | $quiz\_gradient\_direction = "to bottom"; |
| [1308](#L1308) | } |
| [1309](#L1309) |  |
| [1310](#L1310) | // Quiz container background gradient enabled/disabled |
| [1311](#L1311) |  |
| [1312](#L1312) | if(isset($options['enable\_background\_gradient']) && $options['enable\_background\_gradient'] == "on"){ |
| [1313](#L1313) | $enable\_background\_gradient = true; |
| [1314](#L1314) | }else{ |
| [1315](#L1315) | $enable\_background\_gradient = false; |
| [1316](#L1316) | } |
| [1317](#L1317) |  |
| [1318](#L1318) | // Answers box shadow |
| [1319](#L1319) | $answers\_box\_shadow = false; |
| [1320](#L1320) | $answers\_box\_shadow\_color = '#000'; |
| [1321](#L1321) | if(isset($options['answers\_box\_shadow']) && $options['answers\_box\_shadow'] == 'on'){ |
| [1322](#L1322) | $answers\_box\_shadow = true; |
| [1323](#L1323) | } |
| [1324](#L1324) | if(isset($options['answers\_box\_shadow\_color']) && $options['answers\_box\_shadow\_color'] != ''){ |
| [1325](#L1325) | $answers\_box\_shadow\_color = $options['answers\_box\_shadow\_color']; |
| [1326](#L1326) | } |
| [1327](#L1327) |  |
| [1328](#L1328) | //  Box Shadow X offset |
| [1329](#L1329) | $quiz\_answer\_box\_shadow\_x\_offset = (isset($options['quiz\_answer\_box\_shadow\_x\_offset']) && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_x\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_x\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_x\_offset'] ) ) : 0; |
| [1330](#L1330) |  |
| [1331](#L1331) | //  Box Shadow Y offset |
| [1332](#L1332) | $quiz\_answer\_box\_shadow\_y\_offset = (isset($options['quiz\_answer\_box\_shadow\_y\_offset']) && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_y\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_y\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_y\_offset'] ) ) : 0; |
| [1333](#L1333) |  |
| [1334](#L1334) | //  Box Shadow Z offset |
| [1335](#L1335) | $quiz\_answer\_box\_shadow\_z\_offset = (isset($options['quiz\_answer\_box\_shadow\_z\_offset']) && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_z\_offset'] ) != '' && sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_z\_offset'] ) != 0) ? intval( sanitize\_text\_field( $options['quiz\_answer\_box\_shadow\_z\_offset'] ) ) : 10; |
| [1336](#L1336) |  |
| [1337](#L1337) | $answer\_box\_shadow\_offsets = $quiz\_answer\_box\_shadow\_x\_offset . 'px ' . $quiz\_answer\_box\_shadow\_y\_offset . 'px ' . $quiz\_answer\_box\_shadow\_z\_offset . 'px '; |
| [1338](#L1338) |  |
| [1339](#L1339) |  |
| [1340](#L1340) | // Answers right/wrong icons |
| [1341](#L1341) | $ans\_right\_wrong\_icon = 'default'; |
| [1342](#L1342) | if(isset($options['ans\_right\_wrong\_icon']) && $options['ans\_right\_wrong\_icon'] != ''){ |
| [1343](#L1343) | $ans\_right\_wrong\_icon = $options['ans\_right\_wrong\_icon']; |
| [1344](#L1344) | } |
| [1345](#L1345) |  |
| [1346](#L1346) |  |
| [1347](#L1347) | // Buttons position |
| [1348](#L1348) | $buttons\_position = 'center'; |
| [1349](#L1349) | if(isset($options['buttons\_position']) && $options['buttons\_position'] != ''){ |
| [1350](#L1350) | $buttons\_position = $options['buttons\_position']; |
| [1351](#L1351) | } |
| [1352](#L1352) |  |
| [1353](#L1353) | /\* |
| [1354](#L1354) | ========================================== |
| [1355](#L1355) | Buttons styles |
| [1356](#L1356) | ========================================== |
| [1357](#L1357) | \*/ |
| [1358](#L1358) |  |
| [1359](#L1359) | // Buttons font size |
| [1360](#L1360) | $buttons\_font\_size = '17px'; |
| [1361](#L1361) | if(isset($options['buttons\_font\_size']) && $options['buttons\_font\_size'] != ''){ |
| [1362](#L1362) | $buttons\_font\_size = $options['buttons\_font\_size'] . 'px'; |
| [1363](#L1363) | } |
| [1364](#L1364) |  |
| [1365](#L1365) | // Button font-size (px) | Mobile |
| [1366](#L1366) | $buttons\_mobile\_font\_size = (isset($options['buttons\_mobile\_font\_size']) && $options['buttons\_mobile\_font\_size'] != '') ? absint( esc\_attr( $options['buttons\_mobile\_font\_size'] ) ) : 17; |
| [1367](#L1367) |  |
| [1368](#L1368) | // Buttons font size |
| [1369](#L1369) | $buttons\_width = ''; |
| [1370](#L1370) | if(isset($options['buttons\_width']) && $options['buttons\_width'] != ''){ |
| [1371](#L1371) | $buttons\_width = $options['buttons\_width'] . 'px'; |
| [1372](#L1372) | } |
| [1373](#L1373) |  |
| [1374](#L1374) | $buttons\_width\_html = ''; |
| [1375](#L1375) | if( $buttons\_width != ''){ |
| [1376](#L1376) | $buttons\_width\_html = "width:" . $buttons\_width; |
| [1377](#L1377) | } |
| [1378](#L1378) |  |
| [1379](#L1379) | // Buttons Left / Right padding |
| [1380](#L1380) | $buttons\_left\_right\_padding = '20px'; |
| [1381](#L1381) | if(isset($options['buttons\_left\_right\_padding']) && $options['buttons\_left\_right\_padding'] != ''){ |
| [1382](#L1382) | $buttons\_left\_right\_padding = $options['buttons\_left\_right\_padding'] . 'px'; |
| [1383](#L1383) | } |
| [1384](#L1384) |  |
| [1385](#L1385) | // Buttons Top / Bottom padding |
| [1386](#L1386) | $buttons\_top\_bottom\_padding = '10px'; |
| [1387](#L1387) | if(isset($options['buttons\_top\_bottom\_padding']) && $options['buttons\_top\_bottom\_padding'] != ''){ |
| [1388](#L1388) | $buttons\_top\_bottom\_padding = $options['buttons\_top\_bottom\_padding'] . 'px'; |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | // Buttons border radius |
| [1392](#L1392) | $buttons\_border\_radius = '3px'; |
| [1393](#L1393) | if(isset($options['buttons\_border\_radius']) && $options['buttons\_border\_radius'] != ''){ |
| [1394](#L1394) | $buttons\_border\_radius = $options['buttons\_border\_radius'] . 'px'; |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [1398](#L1398) |  |
| [1399](#L1399) | /\* |
| [1400](#L1400) | \* Quiz start page |
| [1401](#L1401) | \* |
| [1402](#L1402) | \* Quiz title |
| [1403](#L1403) | \* Quiz desctiption |
| [1404](#L1404) | \* Quiz image |
| [1405](#L1405) | \* |
| [1406](#L1406) | \* Quiz Start button |
| [1407](#L1407) | \*/ |
| [1408](#L1408) |  |
| [1409](#L1409) | $title = do\_shortcode(stripslashes($quiz['title'])); |
| [1410](#L1410) |  |
| [1411](#L1411) | $description = $this->replace\_message\_variables($quiz['description'], $message\_variables\_data); |
| [1412](#L1412) | $description = $this->ays\_autoembed( $description ); |
| [1413](#L1413) |  |
| [1414](#L1414) | $quiz\_image = (isset($quiz['quiz\_image']) && $quiz['quiz\_image'] != "") ? esc\_url($quiz['quiz\_image']) : ""; |
| [1415](#L1415) |  |
| [1416](#L1416) | // if( $quiz\_image != "" ){ |
| [1417](#L1417) | //     if ( !(filter\_var($quiz\_image, FILTER\_VALIDATE\_URL) && wp\_http\_validate\_url($quiz\_image)) ) { |
| [1418](#L1418) | //         // Invalid URL, handle accordingly |
| [1419](#L1419) | //         $quiz\_image = ""; |
| [1420](#L1420) | //     } |
| [1421](#L1421) | // } |
| [1422](#L1422) |  |
| [1423](#L1423) | if( $quiz\_image != "" ){ |
| [1424](#L1424) | $check\_if\_current\_image\_exists = Quiz\_Maker\_Admin::ays\_quiz\_check\_if\_current\_image\_exists($quiz\_image); |
| [1425](#L1425) |  |
| [1426](#L1426) | if( !$check\_if\_current\_image\_exists ){ |
| [1427](#L1427) | $quiz\_image = ""; |
| [1428](#L1428) | } |
| [1429](#L1429) | } |
| [1430](#L1430) |  |
| [1431](#L1431) |  |
| [1432](#L1432) | $quiz\_rate\_reports = ''; |
| [1433](#L1433) | $quiz\_result\_reports = ''; |
| [1434](#L1434) |  |
| [1435](#L1435) |  |
| [1436](#L1436) | if($questions\_count == 0){ |
| [1437](#L1437) | $empty\_questions\_notification = '<p id="ays\_no\_questions\_message" style="color:red">' . \_\_('You need to add questions', $this->plugin\_name) . '</p>'; |
| [1438](#L1438) | $empty\_questions\_button = "disabled"; |
| [1439](#L1439) | }else{ |
| [1440](#L1440) | $empty\_questions\_notification = ""; |
| [1441](#L1441) | $empty\_questions\_button = ""; |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) | if( $this->get\_prop( 'is\_training' ) === true && empty( $arr\_questions ) ){ |
| [1445](#L1445) | $empty\_questions\_notification = "<button type='button' class='action-button ays\_restart\_training\_button'> |
| [1446](#L1446) | <i class='ays\_fa ays\_fa\_undo'></i> |
| [1447](#L1447) | <span>". $this->buttons\_texts['restartQuizButton'] ."</span> |
| [1448](#L1448) | </button>";; |
| [1449](#L1449) | } |
| [1450](#L1450) |  |
| [1451](#L1451) | $password\_message = ""; |
| [1452](#L1452) | $start\_button\_disabled = ""; |
| [1453](#L1453) | $quiz\_password\_message\_html = ""; |
| [1454](#L1454) | $password\_message\_with\_toggle = ""; |
| [1455](#L1455) |  |
| [1456](#L1456) | // Password quiz |
| [1457](#L1457) | $quiz\_password = ( isset( $options['password\_quiz']) && $options['password\_quiz'] != '' ) ? stripslashes( $options['password\_quiz'] ) : ''; |
| [1458](#L1458) |  |
| [1459](#L1459) | // Quiz password width |
| [1460](#L1460) | $quiz\_password\_width = (isset($options['quiz\_password\_width']) && ( $options['quiz\_password\_width'] ) != '' && ( $options['quiz\_password\_width'] ) != 0) ? esc\_attr( absint( $options['quiz\_password\_width'] ) ) : ""; |
| [1461](#L1461) |  |
| [1462](#L1462) | $quiz\_password\_width\_css = ""; |
| [1463](#L1463) | if ( $quiz\_password\_width != "" ) { |
| [1464](#L1464) | $quiz\_password\_width\_css = $quiz\_password\_width . "px"; |
| [1465](#L1465) | } else { |
| [1466](#L1466) | $quiz\_password\_width\_css = "100%"; |
| [1467](#L1467) | } |
| [1468](#L1468) |  |
| [1469](#L1469) | if(isset($options['enable\_password']) && $options['enable\_password'] == 'on' && $quiz\_password != ""){ |
| [1470](#L1470) |  |
| [1471](#L1471) | // Password for passing quiz | Message |
| [1472](#L1472) | $quiz\_password\_message = ( isset( $options['quiz\_password\_message']) && $options['quiz\_password\_message'] != '' ) ? stripslashes( $options['quiz\_password\_message'] ) : ''; |
| [1473](#L1473) | $quiz\_password\_message = $this->replace\_message\_variables($quiz\_password\_message, $message\_variables\_data); |
| [1474](#L1474) |  |
| [1475](#L1475) | // Enable toggle password visibility |
| [1476](#L1476) | $options['quiz\_enable\_password\_visibility'] = isset($options['quiz\_enable\_password\_visibility']) ? $options['quiz\_enable\_password\_visibility'] : 'off'; |
| [1477](#L1477) | $quiz\_enable\_password\_visibility = (isset($options['quiz\_enable\_password\_visibility']) && $options['quiz\_enable\_password\_visibility'] == 'on') ? true : false; |
| [1478](#L1478) |  |
| [1479](#L1479) | if ( $quiz\_password\_message != '' ) { |
| [1480](#L1480) | $quiz\_password\_message\_html .= '<div class="ays-quiz-password-message-box">'; |
| [1481](#L1481) | $quiz\_password\_message\_html .= $this->ays\_autoembed($quiz\_password\_message); |
| [1482](#L1482) | $quiz\_password\_message\_html .= '</div>'; |
| [1483](#L1483) | } |
| [1484](#L1484) |  |
| [1485](#L1485) | $password\_message = "<input type='password' autocomplete='no' id='ays\_quiz\_password\_val\_". $id ."' class='ays\_quiz\_password' placeholder='". \_\_( "Please enter password", $this->plugin\_name) ."'>"; |
| [1486](#L1486) |  |
| [1487](#L1487) | if ( $quiz\_enable\_password\_visibility ) { |
| [1488](#L1488) | $password\_message\_with\_toggle .= "<div class='ays-quiz-password-toggle-visibility-box'>"; |
| [1489](#L1489) | $password\_message\_with\_toggle .= $password\_message; |
| [1490](#L1490) | $password\_message\_with\_toggle .= "<img src='". AYS\_QUIZ\_PUBLIC\_URL ."/images/quiz-maker-eye-visibility-off.svg' class='ays-quiz-password-toggle ays-quiz-password-toggle-visibility-off'>"; |
| [1491](#L1491) | $password\_message\_with\_toggle .= "<img src='". AYS\_QUIZ\_PUBLIC\_URL ."/images/quiz-maker-eye-visibility.svg' class='ays-quiz-password-toggle ays-quiz-password-toggle-visibility ays\_display\_none'>"; |
| [1492](#L1492) | $password\_message\_with\_toggle .= "</div>"; |
| [1493](#L1493) |  |
| [1494](#L1494) | $password\_message = $password\_message\_with\_toggle; |
| [1495](#L1495) | } |
| [1496](#L1496) |  |
| [1497](#L1497) | $start\_button\_disabled = " disabled='disabled' "; |
| [1498](#L1498) | } |
| [1499](#L1499) |  |
| [1500](#L1500) | // Checking confirmation box for leaving the page enabled or diabled |
| [1501](#L1501) | if (isset($options['enable\_leave\_page']) && $options['enable\_leave\_page'] == 'on') { |
| [1502](#L1502) | $enable\_leave\_page = 'data-enable-leave-page="false"'; |
| [1503](#L1503) | }elseif (! isset($options['enable\_leave\_page'])) { |
| [1504](#L1504) | $enable\_leave\_page = 'data-enable-leave-page="false"'; |
| [1505](#L1505) | } |
| [1506](#L1506) | else{ |
| [1507](#L1507) | $enable\_leave\_page = ''; |
| [1508](#L1508) | } |
| [1509](#L1509) |  |
| [1510](#L1510) | // Enable lazy loading attribute for images |
| [1511](#L1511) | $settings\_options['quiz\_enable\_lazy\_loading'] = isset($settings\_options['quiz\_enable\_lazy\_loading']) ? esc\_attr( $settings\_options['quiz\_enable\_lazy\_loading'] ) : 'off'; |
| [1512](#L1512) | $quiz\_enable\_lazy\_loading = (isset($settings\_options['quiz\_enable\_lazy\_loading']) && esc\_attr( $settings\_options['quiz\_enable\_lazy\_loading'] ) == "on") ? true : false; |
| [1513](#L1513) |  |
| [1514](#L1514) | // Disable answer hover |
| [1515](#L1515) | $settings\_options['enable\_start\_button\_loader'] = isset($settings\_options['enable\_start\_button\_loader']) ? sanitize\_text\_field($settings\_options['enable\_start\_button\_loader']) : 'off'; |
| [1516](#L1516) | $enable\_start\_button\_loader = (isset($settings\_options['enable\_start\_button\_loader']) && sanitize\_text\_field($settings\_options['enable\_start\_button\_loader']) == "on") ? true : false; |
| [1517](#L1517) |  |
| [1518](#L1518) | $quiz\_start\_button = "<input type='button' $empty\_questions\_button $start\_button\_disabled class='ays\_next start\_button action-button' value='". $this->buttons\_texts['startButton'] ."' ". $enable\_leave\_page ." />" . $empty\_questions\_notification; |
| [1519](#L1519) |  |
| [1520](#L1520) |  |
| [1521](#L1521) | if ( $enable\_start\_button\_loader ) { |
| [1522](#L1522) | $is\_elementor\_exists = $this->ays\_quiz\_is\_elementor(); |
| [1523](#L1523) | if ( $is\_elementor\_exists ) { |
| [1524](#L1524) | $enable\_start\_button\_loader = false; |
| [1525](#L1525) | } |
| [1526](#L1526) |  |
| [1527](#L1527) | $is\_editor\_exists = $this->ays\_quiz\_is\_editor(); |
| [1528](#L1528) | if ( $is\_editor\_exists ) { |
| [1529](#L1529) | $enable\_start\_button\_loader = false; |
| [1530](#L1530) | } |
| [1531](#L1531) | } |
| [1532](#L1532) |  |
| [1533](#L1533) | if ( $enable\_start\_button\_loader ) { |
| [1534](#L1534) | if ($questions\_count != 0) { |
| [1535](#L1535) | $quiz\_start\_butto\_html = "<input type='button' $empty\_questions\_button class='ays\_next start\_button action-button ays\_quiz\_enable\_loader' disabled='disabled' value='". \_\_('Loading ...', $this->plugin\_name) ."' ". $enable\_leave\_page ." />".$empty\_questions\_notification; |
| [1536](#L1536) |  |
| [1537](#L1537) | $quiz\_start\_button = ' |
| [1538](#L1538) | <div class="ays-quiz-start-button-preloader"> |
| [1539](#L1539) | '. $quiz\_start\_butto\_html .' |
| [1540](#L1540) | <img src="'. AYS\_QUIZ\_ADMIN\_URL .'/images/loaders/tail-spin.svg" class="ays\_quiz\_start\_button\_loader"> |
| [1541](#L1541) | </div>'; |
| [1542](#L1542) | } |
| [1543](#L1543) | } |
| [1544](#L1544) |  |
| [1545](#L1545) |  |
| [1546](#L1546) | /\* |
| [1547](#L1547) | \* Show quiz head information |
| [1548](#L1548) | \* Show quiz title and description |
| [1549](#L1549) | \*/ |
| [1550](#L1550) |  |
| [1551](#L1551) | $options['show\_quiz\_title'] = isset($options['show\_quiz\_title']) ? $options['show\_quiz\_title'] : 'on'; |
| [1552](#L1552) | $options['show\_quiz\_desc'] = isset($options['show\_quiz\_desc']) ? $options['show\_quiz\_desc'] : 'on'; |
| [1553](#L1553) | $show\_quiz\_title = (isset($options['show\_quiz\_title']) && $options['show\_quiz\_title'] == "on") ? true : false; |
| [1554](#L1554) | $show\_quiz\_desc = (isset($options['show\_quiz\_desc']) && $options['show\_quiz\_desc'] == "on") ? true : false; |
| [1555](#L1555) |  |
| [1556](#L1556) |  |
| [1557](#L1557) | /\* |
| [1558](#L1558) | \* Quiz passed users count |
| [1559](#L1559) | \* |
| [1560](#L1560) | \* Generate HTML code |
| [1561](#L1561) | \*/ |
| [1562](#L1562) |  |
| [1563](#L1563) | if(isset($options['enable\_pass\_count']) && $options['enable\_pass\_count'] == 'on'){ |
| [1564](#L1564) | $enable\_pass\_count = true; |
| [1565](#L1565) | $quiz\_result\_reports = $this->get\_quiz\_results\_count\_by\_id($id); |
| [1566](#L1566) | $quiz\_result\_reports = "<qm\_users\_count class='ays\_quizn\_ancnoxneri\_qanak'><i class='ays\_fa ays\_fa\_users'></i> ".$quiz\_result\_reports['res\_count']."</qm\_users\_count>"; |
| [1567](#L1567) | $quiz\_modified\_border\_radius = "border-radius:" . $quiz\_border\_radius . "px " . $quiz\_border\_radius . "px 0px " . $quiz\_border\_radius . "px;"; |
| [1568](#L1568) | }else{ |
| [1569](#L1569) | $enable\_pass\_count = false; |
| [1570](#L1570) | } |
| [1571](#L1571) |  |
| [1572](#L1572) |  |
| [1573](#L1573) |  |
| [1574](#L1574) | /\* |
| [1575](#L1575) | \* Quiz average rate |
| [1576](#L1576) | \* |
| [1577](#L1577) | \* Generate HTML code |
| [1578](#L1578) | \*/ |
| [1579](#L1579) |  |
| [1580](#L1580) | $quiz\_rates\_avg = round($this->ays\_get\_average\_of\_rates($id), 1); |
| [1581](#L1581) | $quiz\_rates\_count = $this->ays\_get\_count\_of\_rates($id); |
| [1582](#L1582) | if(isset($options['enable\_rate\_avg']) && $options['enable\_rate\_avg'] == 'on'){ |
| [1583](#L1583) | $enable\_rate\_avg = true; |
| [1584](#L1584) | $quiz\_rate\_reports = "<div class='ays\_quiz\_rete\_avg'> |
| [1585](#L1585) | <div class='for\_quiz\_rate\_avg ui star rating' data-rating='".round($quiz\_rates\_avg)."' data-max-rating='5'></div> |
| [1586](#L1586) | <qm\_votes>$quiz\_rates\_count " . \_\_( "votes", $this->plugin\_name ) . ", $quiz\_rates\_avg " . \_\_( "avg", $this->plugin\_name ) . "</qm\_votes> |
| [1587](#L1587) | </div>"; |
| [1588](#L1588) | $quiz\_modified\_border\_radius = "border-radius:" . $quiz\_border\_radius . "px " . $quiz\_border\_radius . "px " . $quiz\_border\_radius . "px 0px;"; |
| [1589](#L1589) | }else{ |
| [1590](#L1590) | $enable\_rate\_avg = false; |
| [1591](#L1591) | } |
| [1592](#L1592) |  |
| [1593](#L1593) |  |
| [1594](#L1594) |  |
| [1595](#L1595) | /\* |
| [1596](#L1596) | \* Generate HTML code when passed users count and average rate both are enabled |
| [1597](#L1597) | \*/ |
| [1598](#L1598) |  |
| [1599](#L1599) | if($enable\_rate\_avg && $enable\_pass\_count){ |
| [1600](#L1600) | $quiz\_modified\_border\_radius = "border-radius:" . $quiz\_border\_radius . "px " . $quiz\_border\_radius . "px 0px 0px;"; |
| [1601](#L1601) | $ays\_quiz\_reports = "<div class='ays\_quiz\_reports'>$quiz\_rate\_reports $quiz\_result\_reports</div>"; |
| [1602](#L1602) | }else{ |
| [1603](#L1603) | $ays\_quiz\_reports = $quiz\_rate\_reports.$quiz\_result\_reports; |
| [1604](#L1604) | } |
| [1605](#L1605) |  |
| [1606](#L1606) | /\* |
| [1607](#L1607) | \* Generate HTML code when passed users count and average rate both are enabled |
| [1608](#L1608) | \* |
| [1609](#L1609) | \* Show quiz author and create date |
| [1610](#L1610) | \*/ |
| [1611](#L1611) |  |
| [1612](#L1612) | // Show quiz category |
| [1613](#L1613) | if(isset($options['show\_category']) && $options['show\_category'] == "on"){ |
| [1614](#L1614) | $show\_category = true; |
| [1615](#L1615) | }else{ |
| [1616](#L1616) | $show\_category = false; |
| [1617](#L1617) | } |
| [1618](#L1618) |  |
| [1619](#L1619) | // Show quiz category description |
| [1620](#L1620) | $options['quiz\_enable\_quiz\_category\_description'] = isset($options['quiz\_enable\_quiz\_category\_description']) ? $options['quiz\_enable\_quiz\_category\_description'] : 'off'; |
| [1621](#L1621) | $quiz\_enable\_quiz\_category\_description = (isset($options['quiz\_enable\_quiz\_category\_description']) && $options['quiz\_enable\_quiz\_category\_description'] == 'on') ? true : false; |
| [1622](#L1622) |  |
| [1623](#L1623) | // Show question category |
| [1624](#L1624) | if(isset($options['show\_question\_category']) && $options['show\_question\_category'] == "on"){ |
| [1625](#L1625) | $show\_question\_category = true; |
| [1626](#L1626) | }else{ |
| [1627](#L1627) | $show\_question\_category = false; |
| [1628](#L1628) | } |
| [1629](#L1629) |  |
| [1630](#L1630) | // Show question category description |
| [1631](#L1631) | $options['quiz\_enable\_question\_category\_description'] = isset($options['quiz\_enable\_question\_category\_description']) ? $options['quiz\_enable\_question\_category\_description'] : 'off'; |
| [1632](#L1632) | $quiz\_enable\_question\_category\_description = (isset($options['quiz\_enable\_question\_category\_description']) && $options['quiz\_enable\_question\_category\_description'] == 'on') ? true : false; |
| [1633](#L1633) |  |
| [1634](#L1634) | if(isset($options['show\_create\_date']) && $options['show\_create\_date'] == "on"){ |
| [1635](#L1635) | $show\_create\_date = true; |
| [1636](#L1636) | }else{ |
| [1637](#L1637) | $show\_create\_date = false; |
| [1638](#L1638) | } |
| [1639](#L1639) |  |
| [1640](#L1640) | if(isset($options['show\_author']) && $options['show\_author'] == "on"){ |
| [1641](#L1641) | $show\_author = true; |
| [1642](#L1642) | }else{ |
| [1643](#L1643) | $show\_author = false; |
| [1644](#L1644) | } |
| [1645](#L1645) |  |
| [1646](#L1646) | $show\_cd\_and\_author = "<div class='ays\_cb\_and\_a'>"; |
| [1647](#L1647) | if($show\_create\_date){ |
| [1648](#L1648) | $quiz\_create\_date = (isset($options['create\_date']) && $options['create\_date'] != '') ? $options['create\_date'] : "0000-00-00 00:00:00"; |
| [1649](#L1649) | if(Quiz\_Maker\_Admin::validateDate($quiz\_create\_date)){ |
| [1650](#L1650) | $show\_cd\_and\_author .= "<span>".\_\_("Created on",$this->plugin\_name)." </span><strong><time>".date\_i18n("F d, Y", strtotime($quiz\_create\_date))."</time></strong>"; |
| [1651](#L1651) | }else{ |
| [1652](#L1652) | $show\_cd\_and\_author .= ""; |
| [1653](#L1653) | } |
| [1654](#L1654) | } |
| [1655](#L1655) | if($show\_author){ |
| [1656](#L1656) | if(isset($options['author'])){ |
| [1657](#L1657) | if(is\_array($options['author'])){ |
| [1658](#L1658) | $author = $options['author']; |
| [1659](#L1659) | }else{ |
| [1660](#L1660) | $author = json\_decode($options['author'], true); |
| [1661](#L1661) | } |
| [1662](#L1662) | }else{ |
| [1663](#L1663) | $author = array("name"=>"Unknown"); |
| [1664](#L1664) | } |
| [1665](#L1665) | $user\_id = 0; |
| [1666](#L1666) | if(isset($author['id']) && intval($author['id']) != 0){ |
| [1667](#L1667) | $user\_id = intval($author['id']); |
| [1668](#L1668) | } |
| [1669](#L1669) | $image = get\_avatar($user\_id, 32); |
| [1670](#L1670) | if($author['name'] !== "Unknown"){ |
| [1671](#L1671) | if($show\_create\_date){ |
| [1672](#L1672) | $text = \_\_("By", $this->plugin\_name); |
| [1673](#L1673) | }else{ |
| [1674](#L1674) | $text = \_\_("Created by", $this->plugin\_name); |
| [1675](#L1675) | } |
| [1676](#L1676) | $show\_cd\_and\_author .= "<span>   ".$text." </span>".$image."<strong>".$author['name']."</strong>"; |
| [1677](#L1677) | }else{ |
| [1678](#L1678) | $show\_cd\_and\_author .= ""; |
| [1679](#L1679) | } |
| [1680](#L1680) | } |
| [1681](#L1681) | if($show\_category){ |
| [1682](#L1682) | $category\_id = isset($quiz['quiz\_category\_id']) ? intval($quiz['quiz\_category\_id']) : null; |
| [1683](#L1683) | if($category\_id !== null){ |
| [1684](#L1684) | $quiz\_category = $this->get\_quiz\_category\_by\_id($category\_id); |
| [1685](#L1685) |  |
| [1686](#L1686) | $quiz\_category\_description = isset($quiz\_category['description']) && $quiz\_category['description'] != "" ? $this->ays\_autoembed($quiz\_category['description']) : ""; |
| [1687](#L1687) |  |
| [1688](#L1688) | $show\_cd\_and\_author .= "<p style='margin:0!important;'><strong>".$quiz\_category['title']."</strong></p>"; |
| [1689](#L1689) |  |
| [1690](#L1690) | if( $quiz\_enable\_quiz\_category\_description ){ |
| [1691](#L1691) | $show\_cd\_and\_author .= $quiz\_category\_description; |
| [1692](#L1692) | } |
| [1693](#L1693) | }else{ |
| [1694](#L1694) | $show\_cd\_and\_author .= ""; |
| [1695](#L1695) | } |
| [1696](#L1696) | } |
| [1697](#L1697) | $show\_cd\_and\_author .= "</div>"; |
| [1698](#L1698) |  |
| [1699](#L1699) | if($show\_create\_date == false && $show\_author == false && $show\_category == false){ |
| [1700](#L1700) | $show\_cd\_and\_author = ""; |
| [1701](#L1701) | } |
| [1702](#L1702) |  |
| [1703](#L1703) |  |
| [1704](#L1704) |  |
| [1705](#L1705) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [1706](#L1706) |  |
| [1707](#L1707) | /\* |
| [1708](#L1708) | \* Quiz passing options |
| [1709](#L1709) | \* |
| [1710](#L1710) | \* Generate HTML code |
| [1711](#L1711) | \*/ |
| [1712](#L1712) |  |
| [1713](#L1713) | $live\_progress\_bar = ""; |
| [1714](#L1714) | $timer\_row = ""; |
| [1715](#L1715) | $answer\_view\_class = ""; |
| [1716](#L1716) | $correction\_class = ""; |
| [1717](#L1717) | $ie\_container\_css = ""; |
| [1718](#L1718) | $rtl\_style = ""; |
| [1719](#L1719) | $filling\_type\_wrap = ''; |
| [1720](#L1720) | $filling\_type = ''; |
| [1721](#L1721) | $quiz\_message\_before\_timer = ''; |
| [1722](#L1722) |  |
| [1723](#L1723) | // Progress live bar style |
| [1724](#L1724) | $options['enable\_live\_progress\_bar'] = isset($options['enable\_live\_progress\_bar']) ? $options['enable\_live\_progress\_bar'] : 'off'; |
| [1725](#L1725) | $enable\_live\_progress\_bar = (isset($options['enable\_live\_progress\_bar']) && $options['enable\_live\_progress\_bar'] == 'on') ? true : false; |
| [1726](#L1726) |  |
| [1727](#L1727) |  |
| [1728](#L1728) | /\* |
| [1729](#L1729) | \* Generating Quiz timer |
| [1730](#L1730) | \* |
| [1731](#L1731) | \* Checking timer enabled or diabled |
| [1732](#L1732) | \*/ |
| [1733](#L1733) |  |
| [1734](#L1734) | $timer\_enabled = false; |
| [1735](#L1735) | if (isset($options['enable\_timer']) && $options['enable\_timer'] == 'on') { |
| [1736](#L1736) | $timer\_enabled = true; |
| [1737](#L1737) | $timer\_text = (isset($options['timer\_text'])) ? $options['timer\_text'] : ''; |
| [1738](#L1738) | $timer\_text = $this->replace\_message\_variables($timer\_text, $message\_variables\_data); |
| [1739](#L1739) | $timer\_text = $this->ays\_autoembed( $timer\_text ); |
| [1740](#L1740) | $after\_timer\_text = (isset($options['after\_timer\_text'])) ? $options['after\_timer\_text'] : ''; |
| [1741](#L1741) | $after\_timer\_text = $this->replace\_message\_variables($after\_timer\_text, $message\_variables\_data); |
| [1742](#L1742) | $after\_timer\_text = $this->ays\_autoembed( $after\_timer\_text ); |
| [1743](#L1743) |  |
| [1744](#L1744) | // Message before timer |
| [1745](#L1745) | $quiz\_message\_before\_timer = (isset($options['quiz\_message\_before\_timer']) && $options['quiz\_message\_before\_timer'] != '') ? esc\_attr( sanitize\_text\_field( $options['quiz\_message\_before\_timer'] ) ) : ''; |
| [1746](#L1746) |  |
| [1747](#L1747) | $quiz\_message\_before\_timer\_class = ''; |
| [1748](#L1748) | if ( $quiz\_message\_before\_timer != '' ) { |
| [1749](#L1749) | $quiz\_message\_before\_timer\_class = 'ays-quiz-message-before-timer'; |
| [1750](#L1750) | } |
| [1751](#L1751) |  |
| [1752](#L1752) | $hide\_timer\_cont = ""; |
| [1753](#L1753) | $empty\_after\_timer\_text\_class = ""; |
| [1754](#L1754) | if($timer\_text == ""){ |
| [1755](#L1755) | $hide\_timer\_cont = " style='display:none;' "; |
| [1756](#L1756) | } |
| [1757](#L1757) | if($after\_timer\_text == ""){ |
| [1758](#L1758) | $empty\_after\_timer\_text\_class = " empty\_after\_timer\_text "; |
| [1759](#L1759) | } |
| [1760](#L1760) | $timer\_row = "<section {$hide\_timer\_cont} class='ays\_quiz\_timer\_container'> |
| [1761](#L1761) | <div class='ays-quiz-timer ". $quiz\_message\_before\_timer\_class ."' data-timer='" . $options['timer'] . "'>{$timer\_text}</div> |
| [1762](#L1762) | <div class='ays-quiz-after-timer ".$empty\_after\_timer\_text\_class."'>{$after\_timer\_text}</div> |
| [1763](#L1763) | <hr style='height:1px;'> |
| [1764](#L1764) | </section>"; |
| [1765](#L1765) | } |
| [1766](#L1766) |  |
| [1767](#L1767) | /\* |
| [1768](#L1768) | \* Quiz live progress bar |
| [1769](#L1769) | \* |
| [1770](#L1770) | \* Checking enabled or diabled |
| [1771](#L1771) | \* |
| [1772](#L1772) | \* Checking percent view or not |
| [1773](#L1773) | \*/ |
| [1774](#L1774) |  |
| [1775](#L1775) | if($enable\_live\_progress\_bar){ |
| [1776](#L1776) | $live\_preview\_view = isset($options['progress\_live\_bar\_style']) && $options['progress\_live\_bar\_style'] != '' ? $options['progress\_live\_bar\_style'] : 'default'; |
| [1777](#L1777) |  |
| [1778](#L1778) | if(isset($options['enable\_percent\_view']) && $options['enable\_percent\_view'] == 'on'){ |
| [1779](#L1779) | $live\_progress\_bar\_percent = "<span class='ays-live-bar-percent'>0</span>%"; |
| [1780](#L1780) | }else{ |
| [1781](#L1781) | $live\_progress\_bar\_percent = "<span class='ays-live-bar-percent ays-live-bar-count'></span>/$questions\_count"; |
| [1782](#L1782) | } |
| [1783](#L1783) | switch ($live\_preview\_view) { |
| [1784](#L1784) | case 'second': |
| [1785](#L1785) | $filling\_type\_wrap = 'ays-live-second-wrap'; |
| [1786](#L1786) | $filling\_type = 'ays-live-second'; |
| [1787](#L1787) | break; |
| [1788](#L1788) | case 'third': |
| [1789](#L1789) | $filling\_type\_wrap = 'ays-live-third-wrap'; |
| [1790](#L1790) | $filling\_type = 'ays-live-third'; |
| [1791](#L1791) | break; |
| [1792](#L1792) | case 'fourth': |
| [1793](#L1793) | $filling\_type\_wrap = 'ays-live-fourth-wrap'; |
| [1794](#L1794) | $filling\_type = 'ays-live-fourth'; |
| [1795](#L1795) | break; |
| [1796](#L1796) | default: |
| [1797](#L1797) | $filling\_type\_wrap = ''; |
| [1798](#L1798) | $filling\_type = ''; |
| [1799](#L1799) | break; |
| [1800](#L1800) | } |
| [1801](#L1801) |  |
| [1802](#L1802) | $live\_progress\_bar = "<div class='ays-live-bar-wrap ". $filling\_type\_wrap ."'><div class='ays-live-bar-fill ". $filling\_type ."' style='width: 0%;'><span>". $live\_progress\_bar\_percent ."</span></div></div>"; |
| [1803](#L1803) | } |
| [1804](#L1804) |  |
| [1805](#L1805) |  |
| [1806](#L1806) |  |
| [1807](#L1807) | /\* |
| [1808](#L1808) | \* Quiz questions answers view |
| [1809](#L1809) | \* |
| [1810](#L1810) | \* Generate HTML class for answers view |
| [1811](#L1811) | \*/ |
| [1812](#L1812) |  |
| [1813](#L1813) | if(isset($options['answers\_view']) && $options['answers\_view'] != ''){ |
| [1814](#L1814) | $answer\_view\_class = $options['answers\_view']; |
| [1815](#L1815) | } |
| [1816](#L1816) |  |
| [1817](#L1817) |  |
| [1818](#L1818) | /\* |
| [1819](#L1819) | \* Get site url for social sharing buttons |
| [1820](#L1820) | \* |
| [1821](#L1821) | \* Generate HTML class for answers view |
| [1822](#L1822) | \*/ |
| [1823](#L1823) |  |
| [1824](#L1824) | $actual\_link = "://$\_SERVER[HTTP\_HOST]$\_SERVER[REQUEST\_URI]"; |
| [1825](#L1825) | if(isset($\_SERVER['HTTPS']) && $\_SERVER['HTTPS'] === 'on'){ |
| [1826](#L1826) | $actual\_link = "https" . $actual\_link; |
| [1827](#L1827) | }else{ |
| [1828](#L1828) | $actual\_link = "http" . $actual\_link; |
| [1829](#L1829) | } |
| [1830](#L1830) |  |
| [1831](#L1831) | /\* |
| [1832](#L1832) | \* Show correct answers |
| [1833](#L1833) | \* |
| [1834](#L1834) | \* Generate HTML class for answers view |
| [1835](#L1835) | \*/ |
| [1836](#L1836) |  |
| [1837](#L1837) | if($enable\_correction){ |
| [1838](#L1838) | $correction\_class = "enable\_correction"; |
| [1839](#L1839) | } |
| [1840](#L1840) |  |
| [1841](#L1841) | /\* |
| [1842](#L1842) | \* Answeres numbering |
| [1843](#L1843) | \*/ |
| [1844](#L1844) | $show\_answers\_numbering = (isset($options['show\_answers\_numbering']) && sanitize\_text\_field( $options['show\_answers\_numbering'] ) !== '') ?  sanitize\_text\_field( $options['show\_answers\_numbering'] ) : 'none'; |
| [1845](#L1845) |  |
| [1846](#L1846) | // Questions numbering |
| [1847](#L1847) | $show\_questions\_numbering = (isset($options['show\_questions\_numbering']) && $options['show\_questions\_numbering'] !== '') ?  sanitize\_text\_field( $options['show\_questions\_numbering'] ) : 'none'; |
| [1848](#L1848) |  |
| [1849](#L1849) |  |
| [1850](#L1850) | /\* |
| [1851](#L1851) | \* Show correct answers |
| [1852](#L1852) | \* |
| [1853](#L1853) | \* Generate HTML class for answers view |
| [1854](#L1854) | \*/ |
| [1855](#L1855) |  |
| [1856](#L1856) | if(isset($options['enable\_questions\_counter']) && $options['enable\_questions\_counter'] == 'on'){ |
| [1857](#L1857) | $questions\_counter = true; |
| [1858](#L1858) | }else{ |
| [1859](#L1859) | $questions\_counter = false; |
| [1860](#L1860) | } |
| [1861](#L1861) |  |
| [1862](#L1862) |  |
| [1863](#L1863) | /\* |
| [1864](#L1864) | \* Get Browser data for Internet Explorer |
| [1865](#L1865) | \*/ |
| [1866](#L1866) |  |
| [1867](#L1867) | $useragent = htmlentities($\_SERVER['HTTP\_USER\_AGENT'], ENT\_QUOTES, 'UTF-8'); |
| [1868](#L1868) | if(preg\_match('~MSIE|Internet Explorer~i', $useragent) || |
| [1869](#L1869) | (strpos($useragent, 'Trident/7.0; rv:11.0') !== false)){ |
| [1870](#L1870) | $ie\_container\_css = 'display:flex;flex-wrap:wrap;'; |
| [1871](#L1871) | } |
| [1872](#L1872) |  |
| [1873](#L1873) |  |
| [1874](#L1874) | /\* |
| [1875](#L1875) | \* Question hint value |
| [1876](#L1876) | \*/ |
| [1877](#L1877) | $questions\_hint\_type = (isset($options['questions\_hint\_icon\_or\_text']) && $options['questions\_hint\_icon\_or\_text'] != '' ) ? sanitize\_text\_field( $options['questions\_hint\_icon\_or\_text'] ) : 'default'; |
| [1878](#L1878) | $questions\_hint\_value = (isset($options['questions\_hint\_value']) && $options['questions\_hint\_value'] != '') ? stripslashes(esc\_attr($options['questions\_hint\_value'])) : ''; |
| [1879](#L1879) | $questions\_hint\_button\_value = (isset($options['questions\_hint\_button\_value']) && $options['questions\_hint\_button\_value'] != '') ? stripslashes(esc\_attr($options['questions\_hint\_button\_value'])) : ''; |
| [1880](#L1880) |  |
| [1881](#L1881) | $questions\_hint\_arr = array( |
| [1882](#L1882) | 'questionsHintType' => $questions\_hint\_type, |
| [1883](#L1883) | 'questionsHintValue' => $questions\_hint\_value, |
| [1884](#L1884) | 'questionsHintButtonValue' => $questions\_hint\_button\_value, |
| [1885](#L1885) | ); |
| [1886](#L1886) |  |
| [1887](#L1887) | /\* |
| [1888](#L1888) | \* Quiz buttons |
| [1889](#L1889) | \* |
| [1890](#L1890) | \* Next button |
| [1891](#L1891) | \* Previous button |
| [1892](#L1892) | \* Arrows instead buttons |
| [1893](#L1893) | \*/ |
| [1894](#L1894) | if(isset($options['enable\_previous\_button']) && $options['enable\_previous\_button'] == "on"){ |
| [1895](#L1895) | $prev\_button = true; |
| [1896](#L1896) | }else{ |
| [1897](#L1897) | $prev\_button = false; |
| [1898](#L1898) | } |
| [1899](#L1899) |  |
| [1900](#L1900) | if(isset($options['enable\_next\_button']) && $options['enable\_next\_button'] == "on"){ |
| [1901](#L1901) | $next\_button = true; |
| [1902](#L1902) | }else{ |
| [1903](#L1903) | $next\_button = false; |
| [1904](#L1904) | } |
| [1905](#L1905) |  |
| [1906](#L1906) | if(isset($options['enable\_arrows']) && $options['enable\_arrows'] == "on"){ |
| [1907](#L1907) | $enable\_arrows = true; |
| [1908](#L1908) | }else{ |
| [1909](#L1909) | $enable\_arrows = false; |
| [1910](#L1910) | } |
| [1911](#L1911) |  |
| [1912](#L1912) | // Quiz arrows option arrows |
| [1913](#L1913) | if(isset($options['quiz\_arrow\_type']) && $options['quiz\_arrow\_type'] != ""){ |
| [1914](#L1914) | $quiz\_arrow\_type = $options['quiz\_arrow\_type']; |
| [1915](#L1915) | }else{ |
| [1916](#L1916) | $quiz\_arrow\_type = 'default'; |
| [1917](#L1917) | } |
| [1918](#L1918) |  |
| [1919](#L1919) | if(isset($options['enable\_early\_finish']) && $options['enable\_early\_finish'] == 'on'){ |
| [1920](#L1920) | $enable\_early\_finish = true; |
| [1921](#L1921) | }else{ |
| [1922](#L1922) | $enable\_early\_finish = false; |
| [1923](#L1923) | } |
| [1924](#L1924) |  |
| [1925](#L1925) | if($enable\_arrows){ |
| [1926](#L1926) | $arrows\_visibility = ""; |
| [1927](#L1927) | }else{ |
| [1928](#L1928) | $arrows\_visibility = 'ays\_display\_none'; |
| [1929](#L1929) | } |
| [1930](#L1930) |  |
| [1931](#L1931) | if($prev\_button && $enable\_arrows){ |
| [1932](#L1932) | $prev\_arrow\_visibility = ""; |
| [1933](#L1933) | }else{ |
| [1934](#L1934) | $prev\_arrow\_visibility = 'ays\_display\_none'; |
| [1935](#L1935) | } |
| [1936](#L1936) |  |
| [1937](#L1937) | if($prev\_button && !$enable\_arrows){ |
| [1938](#L1938) | $prev\_button\_visibility = ""; |
| [1939](#L1939) | }else{ |
| [1940](#L1940) | $prev\_button\_visibility = 'ays\_display\_none'; |
| [1941](#L1941) | } |
| [1942](#L1942) |  |
| [1943](#L1943) | if($next\_button && $enable\_arrows){ |
| [1944](#L1944) | $next\_arrow\_visibility = ""; |
| [1945](#L1945) | }else{ |
| [1946](#L1946) | $next\_arrow\_visibility = 'ays\_display\_none'; |
| [1947](#L1947) | } |
| [1948](#L1948) |  |
| [1949](#L1949) | if($next\_button == true && $enable\_arrows == false){ |
| [1950](#L1950) | $next\_button\_visibility = ""; |
| [1951](#L1951) | }else{ |
| [1952](#L1952) | $next\_button\_visibility = 'ays\_display\_none'; |
| [1953](#L1953) | } |
| [1954](#L1954) |  |
| [1955](#L1955) |  |
| [1956](#L1956) | /\* |
| [1957](#L1957) | \* Clear answer button |
| [1958](#L1958) | \*/ |
| [1959](#L1959) | $enable\_clear\_answer = false; |
| [1960](#L1960) | if(isset($options['enable\_clear\_answer']) && $options['enable\_clear\_answer'] == 'on'){ |
| [1961](#L1961) | $enable\_clear\_answer = true; |
| [1962](#L1962) | } |
| [1963](#L1963) |  |
| [1964](#L1964) |  |
| [1965](#L1965) | $buttons = array( |
| [1966](#L1966) | "enableArrows" => $enable\_arrows, |
| [1967](#L1967) | "arrows" => $arrows\_visibility, |
| [1968](#L1968) | "nextArrow" => $next\_arrow\_visibility, |
| [1969](#L1969) | "prevArrow" => $prev\_arrow\_visibility, |
| [1970](#L1970) | "nextButton" => $next\_button\_visibility, |
| [1971](#L1971) | "prevButton" => $prev\_button\_visibility, |
| [1972](#L1972) | "earlyButton" => $enable\_early\_finish, |
| [1973](#L1973) | "clearAnswerButton" => $enable\_clear\_answer, |
| [1974](#L1974) | "quizArrowType" => $quiz\_arrow\_type, |
| [1975](#L1975) | ); |
| [1976](#L1976) |  |
| [1977](#L1977) | /\* |
| [1978](#L1978) | \* Quiz restart button |
| [1979](#L1979) | \*/ |
| [1980](#L1980) | $enable\_restart\_button = false; |
| [1981](#L1981) | if(isset($options['enable\_restart\_button']) && $options['enable\_restart\_button'] == 'on'){ |
| [1982](#L1982) | $enable\_restart\_button = true; |
| [1983](#L1983) | } |
| [1984](#L1984) |  |
| [1985](#L1985) | if($enable\_restart\_button){ |
| [1986](#L1986) | $restart\_button = "<button type='button' class='action-button ays\_restart\_button'> |
| [1987](#L1987) | <i class='ays\_fa ays\_fa\_undo'></i> |
| [1988](#L1988) | <span>". $this->buttons\_texts['restartQuizButton'] ."</span> |
| [1989](#L1989) | </button>"; |
| [1990](#L1990) | }else{ |
| [1991](#L1991) | $restart\_button = ""; |
| [1992](#L1992) | } |
| [1993](#L1993) |  |
| [1994](#L1994) |  |
| [1995](#L1995) | /\* |
| [1996](#L1996) | \* EXIT button in finish page |
| [1997](#L1997) | \*/ |
| [1998](#L1998) |  |
| [1999](#L1999) | $enable\_exit\_button = false; |
| [2000](#L2000) | $exit\_redirect\_url = null; |
| [2001](#L2001) | if(isset($options['enable\_exit\_button']) && $options['enable\_exit\_button'] == 'on'){ |
| [2002](#L2002) | $enable\_exit\_button = true; |
| [2003](#L2003) | } |
| [2004](#L2004) | if(isset($options['exit\_redirect\_url']) && $options['exit\_redirect\_url'] != ''){ |
| [2005](#L2005) | $exit\_redirect\_url = $options['exit\_redirect\_url']; |
| [2006](#L2006) | } |
| [2007](#L2007) |  |
| [2008](#L2008) |  |
| [2009](#L2009) | if($enable\_exit\_button && $exit\_redirect\_url !== null){ |
| [2010](#L2010) |  |
| [2011](#L2011) | $exit\_button = "<a style='width:auto;' href='".$exit\_redirect\_url."' class='action-button ays\_restart\_button' target='\_top'> |
| [2012](#L2012) | <span>".$this->buttons\_texts['exitButton']."</span> |
| [2013](#L2013) | <i class='ays\_fa ays\_fa\_sign\_out'></i> |
| [2014](#L2014) | </a>"; |
| [2015](#L2015) | }else{ |
| [2016](#L2016) | $exit\_button = ""; |
| [2017](#L2017) | } |
| [2018](#L2018) |  |
| [2019](#L2019) | /\* |
| [2020](#L2020) | \* Quiz questions per page count |
| [2021](#L2021) | \*/ |
| [2022](#L2022) |  |
| [2023](#L2023) | if(isset($options['enable\_rtl\_direction']) && $options['enable\_rtl\_direction'] == "on"){ |
| [2024](#L2024) | $rtl\_direction = true; |
| [2025](#L2025) | $rtl\_style = " |
| [2026](#L2026) | #ays-quiz-container-" . $id . " p { |
| [2027](#L2027) | direction:rtl; |
| [2028](#L2028) | text-align:right; |
| [2029](#L2029) | } |
| [2030](#L2030) | #ays-quiz-container-" . $id . " p.ays\_score { |
| [2031](#L2031) | text-align: center; |
| [2032](#L2032) | } |
| [2033](#L2033) | #ays-quiz-container-" . $id . " p.ays-question-counter { |
| [2034](#L2034) | right: unset; |
| [2035](#L2035) | left: 8px; |
| [2036](#L2036) | } |
| [2037](#L2037) | #ays-quiz-container-" . $id . " .ays\_question\_hint\_container { |
| [2038](#L2038) | left:unset; |
| [2039](#L2039) | right:10px; |
| [2040](#L2040) | } |
| [2041](#L2041) | #ays-quiz-container-" . $id . " .ays\_question\_hint\_text { |
| [2042](#L2042) | left:unset; |
| [2043](#L2043) | right:20px; |
| [2044](#L2044) | } |
| [2045](#L2045) | #ays-quiz-container-" . $id . " .select2-container--default .select2-results\_\_option { |
| [2046](#L2046) | direction:rtl; |
| [2047](#L2047) | text-align:right; |
| [2048](#L2048) | } |
| [2049](#L2049) | #ays-quiz-container-" . $id . " .select2-container--default .select2-selection--single .select2-selection\_\_placeholder, |
| [2050](#L2050) | #ays-quiz-container-" . $id . " .select2-container--default .select2-selection--single .select2-selection\_\_rendered { |
| [2051](#L2051) | direction:rtl; |
| [2052](#L2052) | text-align:right; |
| [2053](#L2053) | display: inline-block; |
| [2054](#L2054) | width: 100%; |
| [2055](#L2055) | } |
| [2056](#L2056) |  |
| [2057](#L2057) | #ays-quiz-container-" . $id . " .select2-container .select2-selection--single .select2-selection\_\_rendered { |
| [2058](#L2058) | padding-right: 30px; |
| [2059](#L2059) | } |
| [2060](#L2060) | #ays-quiz-container-" . $id . " .ays-field.ays-select-field { |
| [2061](#L2061) | margin: 0; |
| [2062](#L2062) | } |
| [2063](#L2063) |  |
| [2064](#L2064) | #ays-quiz-container-" . $id . " label[for^=\"ays-answer-\"]{ |
| [2065](#L2065) | direction:rtl; |
| [2066](#L2066) | text-align:right; |
| [2067](#L2067) | padding-left: 0px; |
| [2068](#L2068) | padding-right: 10px; |
| [2069](#L2069) | position: relative; |
| [2070](#L2070) | text-overflow: ellipsis; |
| [2071](#L2071) | } |
| [2072](#L2072) | #ays-quiz-container-" . $id . " label[for^=\"ays-answer-\"]:last-child { |
| [2073](#L2073) | padding-right: 0; |
| [2074](#L2074) | } |
| [2075](#L2075) | #ays-quiz-container-" . $id . " label[for^=\"ays-answer-\"]::before { |
| [2076](#L2076) | margin-left: 5px; |
| [2077](#L2077) | margin-right: 5px; |
| [2078](#L2078) | } |
| [2079](#L2079) | #ays-quiz-container-" . $id . " label[for^=\"ays-answer-\"]::after { |
| [2080](#L2080) | margin-left: 0px; |
| [2081](#L2081) | margin-right: 10px; |
| [2082](#L2082) | } |
| [2083](#L2083) | "; |
| [2084](#L2084) | }else{ |
| [2085](#L2085) | $rtl\_direction = false; |
| [2086](#L2086) | } |
| [2087](#L2087) |  |
| [2088](#L2088) |  |
| [2089](#L2089) |  |
| [2090](#L2090) | /\* |
| [2091](#L2091) | \* Quiz background music |
| [2092](#L2092) | \*/ |
| [2093](#L2093) |  |
| [2094](#L2094) | $enable\_bg\_music = false; |
| [2095](#L2095) | $quiz\_bg\_music = ""; |
| [2096](#L2096) | $ays\_quiz\_music\_html = ""; |
| [2097](#L2097) | $ays\_quiz\_music\_sound = ""; |
| [2098](#L2098) |  |
| [2099](#L2099) | if(isset($options['enable\_bg\_music']) && $options['enable\_bg\_music'] == "on"){ |
| [2100](#L2100) | $enable\_bg\_music = true; |
| [2101](#L2101) | } |
| [2102](#L2102) |  |
| [2103](#L2103) | if(isset($options['quiz\_bg\_music']) && $options['quiz\_bg\_music'] != ""){ |
| [2104](#L2104) | $quiz\_bg\_music = $options['quiz\_bg\_music']; |
| [2105](#L2105) | } |
| [2106](#L2106) |  |
| [2107](#L2107) | if($enable\_bg\_music && $quiz\_bg\_music != ""){ |
| [2108](#L2108) | $ays\_quiz\_music\_html = "<audio id='ays\_quiz\_music\_".$id."' loop class='ays\_quiz\_music' src='".$quiz\_bg\_music."'></audio>"; |
| [2109](#L2109) | $with\_timer = ""; |
| [2110](#L2110) | if($timer\_enabled){ |
| [2111](#L2111) | $with\_timer = " ays\_sound\_with\_timer "; |
| [2112](#L2112) | } |
| [2113](#L2113) | $ays\_quiz\_music\_sound = "<span class='ays\_music\_sound ".$with\_timer." ays\_sound\_active ays\_display\_none'><i class='ays\_fa ays\_fa\_volume\_up'></i></span>"; |
| [2114](#L2114) | } |
| [2115](#L2115) |  |
| [2116](#L2116) | /\* |
| [2117](#L2117) | \* Quiz Right / Wrong answers sounds |
| [2118](#L2118) | \*/ |
| [2119](#L2119) |  |
| [2120](#L2120) | $enable\_rw\_asnwers\_sounds = false; |
| [2121](#L2121) | $rw\_answers\_sounds\_status = false; |
| [2122](#L2122) | $right\_answer\_sound\_status = false; |
| [2123](#L2123) | $wrong\_answer\_sound\_status = false; |
| [2124](#L2124) | $right\_answer\_sound = ""; |
| [2125](#L2125) | $wrong\_answer\_sound = ""; |
| [2126](#L2126) | $rw\_asnwers\_sounds\_html = ""; |
| [2127](#L2127) |  |
| [2128](#L2128) |  |
| [2129](#L2129) | if(isset($settings\_options['right\_answer\_sound']) && $settings\_options['right\_answer\_sound'] != ''){ |
| [2130](#L2130) | $right\_answer\_sound\_status = true; |
| [2131](#L2131) | $right\_answer\_sound = $settings\_options['right\_answer\_sound']; |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | if(isset($settings\_options['wrong\_answer\_sound']) && $settings\_options['wrong\_answer\_sound'] != ''){ |
| [2135](#L2135) | $wrong\_answer\_sound\_status = true; |
| [2136](#L2136) | $wrong\_answer\_sound = $settings\_options['wrong\_answer\_sound']; |
| [2137](#L2137) | } |
| [2138](#L2138) |  |
| [2139](#L2139) | if($right\_answer\_sound\_status && $wrong\_answer\_sound\_status){ |
| [2140](#L2140) | $rw\_answers\_sounds\_status = true; |
| [2141](#L2141) | } |
| [2142](#L2142) |  |
| [2143](#L2143) | if(isset($options['enable\_rw\_asnwers\_sounds']) && $options['enable\_rw\_asnwers\_sounds'] == "on"){ |
| [2144](#L2144) | if($rw\_answers\_sounds\_status){ |
| [2145](#L2145) | $enable\_rw\_asnwers\_sounds = true; |
| [2146](#L2146) | } |
| [2147](#L2147) | } |
| [2148](#L2148) |  |
| [2149](#L2149) | if($enable\_rw\_asnwers\_sounds){ |
| [2150](#L2150) | $rw\_asnwers\_sounds\_html = "<audio id='ays\_quiz\_right\_ans\_sound\_".$id."' class='ays\_quiz\_right\_ans\_sound' src='".$right\_answer\_sound."'></audio>"; |
| [2151](#L2151) | $rw\_asnwers\_sounds\_html .= "<audio id='ays\_quiz\_wrong\_ans\_sound\_".$id."' class='ays\_quiz\_wrong\_ans\_sound' src='".$wrong\_answer\_sound."'></audio>"; |
| [2152](#L2152) | } |
| [2153](#L2153) |  |
| [2154](#L2154) |  |
| [2155](#L2155) | /\* |
| [2156](#L2156) | \* Text quetion type |
| [2157](#L2157) | \* Textarea height (public) |
| [2158](#L2158) | \*/ |
| [2159](#L2159) |  |
| [2160](#L2160) | // Textarea height (public) |
| [2161](#L2161) | $quiz\_textarea\_height = (isset($settings\_options['quiz\_textarea\_height']) && $settings\_options['quiz\_textarea\_height'] != '' && $settings\_options['quiz\_textarea\_height'] != 0) ? absint( sanitize\_text\_field($settings\_options['quiz\_textarea\_height']) ) : 100; |
| [2162](#L2162) |  |
| [2163](#L2163) | // Show question explanation |
| [2164](#L2164) | $show\_questions\_explanation = (isset($options['show\_questions\_explanation']) && $options['show\_questions\_explanation'] != '') ? sanitize\_text\_field( $options['show\_questions\_explanation'] ) : 'on\_results\_page'; |
| [2165](#L2165) |  |
| [2166](#L2166) | // Show messages for right/wrong answers |
| [2167](#L2167) | $answers\_rw\_texts = (isset($options['answers\_rw\_texts']) && $options['answers\_rw\_texts'] != '') ? sanitize\_text\_field( $options['answers\_rw\_texts'] ) : 'on\_passing'; |
| [2168](#L2168) |  |
| [2169](#L2169) |  |
| [2170](#L2170) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [2171](#L2171) |  |
| [2172](#L2172) | /\* |
| [2173](#L2173) | \* Quiz finish page |
| [2174](#L2174) | \* |
| [2175](#L2175) | \* Generating some HTML code for finish page |
| [2176](#L2176) | \*/ |
| [2177](#L2177) |  |
| [2178](#L2178) | $progress\_bar = false; |
| [2179](#L2179) | $progress\_bar\_style = "first"; |
| [2180](#L2180) | $progress\_bar\_html = ""; |
| [2181](#L2181) | $show\_average = ""; |
| [2182](#L2182) | $show\_score\_html = ""; |
| [2183](#L2183) | $enable\_questions\_result = ""; |
| [2184](#L2184) | $rate\_form\_title = ""; |
| [2185](#L2185) | $quiz\_rate\_html = ""; |
| [2186](#L2186) | $ays\_social\_buttons = ""; |
| [2187](#L2187) | $pass\_score\_html = ""; |
| [2188](#L2188) |  |
| [2189](#L2189) | /\* |
| [2190](#L2190) | \* Quiz progress bar for finish page |
| [2191](#L2191) | \* |
| [2192](#L2192) | \* Checking enabled or diabled |
| [2193](#L2193) | \*/ |
| [2194](#L2194) |  |
| [2195](#L2195) | if(isset($options['enable\_progress\_bar']) && $options['enable\_progress\_bar'] == 'on'){ |
| [2196](#L2196) | $progress\_bar = true; |
| [2197](#L2197) | } |
| [2198](#L2198) |  |
| [2199](#L2199) | if(isset($options['progress\_bar\_style']) && $options['progress\_bar\_style'] != ""){ |
| [2200](#L2200) | $progress\_bar\_style = $options['progress\_bar\_style']; |
| [2201](#L2201) | } |
| [2202](#L2202) |  |
| [2203](#L2203) | if($progress\_bar){ |
| [2204](#L2204) | $progress\_bar\_html = "<div class='ays-progress " . $progress\_bar\_style . "'> |
| [2205](#L2205) | <span class='ays-progress-value " . $progress\_bar\_style . "'>0%</span> |
| [2206](#L2206) | <div class='ays-progress-bg " . $progress\_bar\_style . "'> |
| [2207](#L2207) | <div class='ays-progress-bar " . $progress\_bar\_style . "' style='width:0%;'></div> |
| [2208](#L2208) | </div> |
| [2209](#L2209) | </div>"; |
| [2210](#L2210) | } |
| [2211](#L2211) |  |
| [2212](#L2212) |  |
| [2213](#L2213) | /\* |
| [2214](#L2214) | \* Average statistical of quiz |
| [2215](#L2215) | \* |
| [2216](#L2216) | \* Checking enabled or diabled |
| [2217](#L2217) | \*/ |
| [2218](#L2218) | if (isset($options['enable\_average\_statistical']) && $options['enable\_average\_statistical'] == "on") { |
| [2219](#L2219) | $sql = "SELECT AVG(`score`) FROM {$wpdb->prefix}aysquiz\_reports WHERE quiz\_id= $id"; |
| [2220](#L2220) |  |
| [2221](#L2221) | $quiz\_avg\_result = $wpdb->get\_var($sql); |
| [2222](#L2222) | if ( is\_null( $quiz\_avg\_result ) || empty( $quiz\_avg\_result ) ) { |
| [2223](#L2223) | $result = 0; |
| [2224](#L2224) | } else { |
| [2225](#L2225) | $result = round($wpdb->get\_var($sql)); |
| [2226](#L2226) | } |
| [2227](#L2227) | $show\_average = "<p class='ays\_average'>" . \_\_('The average score is', $this->plugin\_name) . " " . $result . "%</p>"; |
| [2228](#L2228) | } |
| [2229](#L2229) |  |
| [2230](#L2230) |  |
| [2231](#L2231) | /\* |
| [2232](#L2232) | \* Passed quiz score |
| [2233](#L2233) | \* |
| [2234](#L2234) | \* Checking enabled or diabled |
| [2235](#L2235) | \*/ |
| [2236](#L2236) |  |
| [2237](#L2237) | if(array\_key\_exists('hide\_score',$options) && $options['hide\_score'] != 'on'){ |
| [2238](#L2238) | $show\_score\_html = "<p class='ays\_score ays\_score\_display\_none animated'>" . \_\_( 'Your score is', $this->plugin\_name ) . "</p>"; |
| [2239](#L2239) | } |
| [2240](#L2240) |  |
| [2241](#L2241) |  |
| [2242](#L2242) | /\* |
| [2243](#L2243) | \* Show quiz results after passing quiz |
| [2244](#L2244) | \* |
| [2245](#L2245) | \* Checking enabled or diabled |
| [2246](#L2246) | \*/ |
| [2247](#L2247) |  |
| [2248](#L2248) | if(isset($options['enable\_questions\_result']) && $options['enable\_questions\_result'] == 'on'){ |
| [2249](#L2249) | $enable\_questions\_result = 'enable\_questions\_result'; |
| [2250](#L2250) | } |
| [2251](#L2251) |  |
| [2252](#L2252) | // Add all reviews link |
| [2253](#L2253) | $options['quiz\_make\_all\_review\_link'] = isset($options['quiz\_make\_all\_review\_link']) ? sanitize\_text\_field($options['quiz\_make\_all\_review\_link']) : 'off'; |
| [2254](#L2254) | $quiz\_make\_all\_review\_link = (isset($options['quiz\_make\_all\_review\_link']) && $options['quiz\_make\_all\_review\_link'] == 'on') ? true : false; |
| [2255](#L2255) |  |
| [2256](#L2256) | $all\_review\_link\_html = ''; |
| [2257](#L2257) | if ( $quiz\_make\_all\_review\_link ) { |
| [2258](#L2258) | if ( $this->ays\_get\_count\_of\_reviews(0, 5, $id) > 0 ) { |
| [2259](#L2259) | $all\_review\_link\_html = "<div class='ays-quiz-rate-link-box'><span class='ays-quiz-rate-link'>". \_\_( "See review", $this->plugin\_name ) ."</span></div>"; |
| [2260](#L2260) | } |
| [2261](#L2261) | } |
| [2262](#L2262) |  |
| [2263](#L2263) | // Enable quiz assessment | Placeholder text |
| [2264](#L2264) | $quiz\_review\_placeholder\_text = (isset($options['quiz\_review\_placeholder\_text']) && $options['quiz\_review\_placeholder\_text'] != '') ? stripslashes( esc\_attr( $options['quiz\_review\_placeholder\_text'] ) ) : ""; |
| [2265](#L2265) |  |
| [2266](#L2266) | // Make review required |
| [2267](#L2267) | $options['quiz\_make\_review\_required'] = isset($options['quiz\_make\_review\_required']) ? sanitize\_text\_field($options['quiz\_make\_review\_required']) : 'off'; |
| [2268](#L2268) | $quiz\_make\_review\_required = (isset($options['quiz\_make\_review\_required']) && $options['quiz\_make\_review\_required'] == 'on') ? "true" : "false"; |
| [2269](#L2269) |  |
| [2270](#L2270) | // Enable users' anonymous assessment |
| [2271](#L2271) | $options['quiz\_enable\_user\_cհoosing\_anonymous\_assessment'] = isset($options['quiz\_enable\_user\_cհoosing\_anonymous\_assessment']) ? sanitize\_text\_field($options['quiz\_enable\_user\_cհoosing\_anonymous\_assessment']) : 'off'; |
| [2272](#L2272) | $quiz\_enable\_user\_cհoosing\_anonymous\_assessment = (isset($options['quiz\_enable\_user\_cհoosing\_anonymous\_assessment']) && $options['quiz\_enable\_user\_cհoosing\_anonymous\_assessment'] == 'on') ? true : false; |
| [2273](#L2273) |  |
| [2274](#L2274) | /\* |
| [2275](#L2275) | \* Passed or Failed quiz score html |
| [2276](#L2276) | \*/ |
| [2277](#L2277) | $pass\_score\_html = "<div class='ays\_score\_message'></div>"; |
| [2278](#L2278) |  |
| [2279](#L2279) |  |
| [2280](#L2280) | /\* |
| [2281](#L2281) | \* Quiz rate |
| [2282](#L2282) | \* |
| [2283](#L2283) | \* Generating HTML code |
| [2284](#L2284) | \*/ |
| [2285](#L2285) |  |
| [2286](#L2286) | if(isset($options['rate\_form\_title'])){ |
| [2287](#L2287) | $rate\_form\_title = $this->ays\_autoembed($options['rate\_form\_title']); |
| [2288](#L2288) | $rate\_form\_title = $this->replace\_message\_variables($rate\_form\_title, $message\_variables\_data); |
| [2289](#L2289) | } |
| [2290](#L2290) |  |
| [2291](#L2291) | if(isset($options['enable\_quiz\_rate']) && $options['enable\_quiz\_rate'] == 'on'){ |
| [2292](#L2292) |  |
| [2293](#L2293) | // Thank you message | Review |
| [2294](#L2294) | $quiz\_review\_thank\_you\_message = (isset($options['quiz\_review\_thank\_you\_message']) && $options['quiz\_review\_thank\_you\_message'] != '') ? $this->ays\_autoembed( $options['quiz\_review\_thank\_you\_message'] ) : ""; |
| [2295](#L2295) | $quiz\_review\_thank\_you\_message = $this->replace\_message\_variables($quiz\_review\_thank\_you\_message, $message\_variables\_data); |
| [2296](#L2296) |  |
| [2297](#L2297) | // Enable Comment Field |
| [2298](#L2298) | $options['quiz\_review\_enable\_comment\_field'] = isset($options['quiz\_review\_enable\_comment\_field']) ? sanitize\_text\_field($options['quiz\_review\_enable\_comment\_field']) : 'on'; |
| [2299](#L2299) | $quiz\_review\_enable\_comment\_field = (isset($options['quiz\_review\_enable\_comment\_field']) && $options['quiz\_review\_enable\_comment\_field'] == 'on') ? true : false; |
| [2300](#L2300) |  |
| [2301](#L2301) | $review\_thank\_you\_message = ""; |
| [2302](#L2302) | if ( $quiz\_review\_thank\_you\_message != "" ) { |
| [2303](#L2303) | $review\_thank\_you\_message = "<div class='ays-quiz-review-thank-you-message ays\_display\_none'>". $quiz\_review\_thank\_you\_message ."</div>"; |
| [2304](#L2304) | } |
| [2305](#L2305) |  |
| [2306](#L2306) | $review\_comment\_field\_html = ""; |
| [2307](#L2307) | if ( $quiz\_review\_enable\_comment\_field ) { |
| [2308](#L2308) | $review\_comment\_field\_html = "<textarea id='quiz\_rate\_reason\_".$id."' class='quiz\_rate\_reason' data-required='". $quiz\_make\_review\_required ."' placeholder='". $quiz\_review\_placeholder\_text ."'></textarea>"; |
| [2309](#L2309) | } |
| [2310](#L2310) |  |
| [2311](#L2311) | $enable\_user\_cհoosing\_anonymous\_assessment\_html = ""; |
| [2312](#L2312) | if( $quiz\_enable\_user\_cհoosing\_anonymous\_assessment ){ |
| [2313](#L2313) | $enable\_user\_cհoosing\_anonymous\_assessment\_html = "<div class='ays-quiz-user-cհoosing-anonymous-assessment'> |
| [2314](#L2314) | <label for='ays-quiz-user-cհoosing-anonymous-assessment-{$id}'>". \_\_("Anonymous feedback", $this->plugin\_name) ."</label> |
| [2315](#L2315) | <input type='checkbox' name='ays\_quiz\_user\_cհoosing\_anonymous\_assessment' id='ays-quiz-user-cհoosing-anonymous-assessment-{$id}' class='ays-quiz-user-cհoosing-anonymous-assessment'value='on'/></div>"; |
| [2316](#L2316) | } |
| [2317](#L2317) |  |
| [2318](#L2318) | $quiz\_rate\_html = "<div class='ays\_quiz\_rete'> |
| [2319](#L2319) | <div>$rate\_form\_title</div> |
| [2320](#L2320) | $enable\_user\_cհoosing\_anonymous\_assessment\_html |
| [2321](#L2321) | <div class='for\_quiz\_rate ui huge star rating' data-rating='0' data-max-rating='5'></div> |
| [2322](#L2322) | <div class='ays-quiz-lds-spinner-box'><div class='lds-spinner-none'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div> |
| [2323](#L2323) | ". $all\_review\_link\_html ." |
| [2324](#L2324) | ". $review\_thank\_you\_message ." |
| [2325](#L2325) | <div class='for\_quiz\_rate\_reason'> |
| [2326](#L2326) | ". $review\_comment\_field\_html ." |
| [2327](#L2327) | <div class='ays\_feedback\_button\_div'> |
| [2328](#L2328) | <button type='button' class='action-button'>". $this->buttons\_texts['sendFeedbackButton'] ."</button> |
| [2329](#L2329) | </div> |
| [2330](#L2330) | </div> |
| [2331](#L2331) | <div><div class='lds-spinner2-none'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div> |
| [2332](#L2332) | <div class='quiz\_rate\_reasons\_body'></div> |
| [2333](#L2333) | </div>"; |
| [2334](#L2334) | } |
| [2335](#L2335) |  |
| [2336](#L2336) |  |
| [2337](#L2337) |  |
| [2338](#L2338) | /\* |
| [2339](#L2339) | \* Quiz social sharing buttons |
| [2340](#L2340) | \* |
| [2341](#L2341) | \* Generating HTML code |
| [2342](#L2342) | \*/ |
| [2343](#L2343) |  |
| [2344](#L2344) | // Heading for social buttons |
| [2345](#L2345) | $social\_buttons\_heading = (isset($options['social\_buttons\_heading']) && $options['social\_buttons\_heading'] != '') ? stripslashes( wpautop( $options['social\_buttons\_heading'] ) ) : ""; |
| [2346](#L2346) |  |
| [2347](#L2347) | // Enable Linkedin button |
| [2348](#L2348) | $options['quiz\_enable\_linkedin\_share\_button'] = isset($options['quiz\_enable\_linkedin\_share\_button']) ? sanitize\_text\_field($options['quiz\_enable\_linkedin\_share\_button']) : 'on'; |
| [2349](#L2349) | $quiz\_enable\_linkedin\_share\_button = (isset($options['quiz\_enable\_linkedin\_share\_button']) && $options['quiz\_enable\_linkedin\_share\_button'] == 'on') ? true : false; |
| [2350](#L2350) |  |
| [2351](#L2351) | // Enable Facebook button |
| [2352](#L2352) | $options['quiz\_enable\_facebook\_share\_button'] = isset($options['quiz\_enable\_facebook\_share\_button']) ? sanitize\_text\_field($options['quiz\_enable\_facebook\_share\_button']) : 'on'; |
| [2353](#L2353) | $quiz\_enable\_facebook\_share\_button = (isset($options['quiz\_enable\_facebook\_share\_button']) && $options['quiz\_enable\_facebook\_share\_button'] == 'on') ? true : false; |
| [2354](#L2354) |  |
| [2355](#L2355) | // Enable Twitter button |
| [2356](#L2356) | $options['quiz\_enable\_twitter\_share\_button'] = isset($options['quiz\_enable\_twitter\_share\_button']) ? sanitize\_text\_field($options['quiz\_enable\_twitter\_share\_button']) : 'on'; |
| [2357](#L2357) | $quiz\_enable\_twitter\_share\_button = (isset($options['quiz\_enable\_twitter\_share\_button']) && $options['quiz\_enable\_twitter\_share\_button'] == 'on') ? true : false; |
| [2358](#L2358) |  |
| [2359](#L2359) | // Enable VKontakte button |
| [2360](#L2360) | $options['quiz\_enable\_vkontakte\_share\_button'] = isset($options['quiz\_enable\_vkontakte\_share\_button']) ? sanitize\_text\_field($options['quiz\_enable\_vkontakte\_share\_button']) : 'on'; |
| [2361](#L2361) | $quiz\_enable\_vkontakte\_share\_button = (isset($options['quiz\_enable\_vkontakte\_share\_button']) && $options['quiz\_enable\_vkontakte\_share\_button'] == 'on') ? true : false; |
| [2362](#L2362) |  |
| [2363](#L2363) | if ( ! $quiz\_enable\_linkedin\_share\_button && ! $quiz\_enable\_facebook\_share\_button && ! $quiz\_enable\_twitter\_share\_button && ! $quiz\_enable\_vkontakte\_share\_button) { |
| [2364](#L2364) | $quiz\_enable\_linkedin\_share\_button = true; |
| [2365](#L2365) | $quiz\_enable\_facebook\_share\_button = true; |
| [2366](#L2366) | $quiz\_enable\_twitter\_share\_button = true; |
| [2367](#L2367) | $quiz\_enable\_vkontakte\_share\_button = true; |
| [2368](#L2368) | } |
| [2369](#L2369) |  |
| [2370](#L2370) |  |
| [2371](#L2371) | if(isset($options['enable\_social\_buttons']) && $options['enable\_social\_buttons'] == 'on'){ |
| [2372](#L2372) | $ays\_social\_buttons .= "<div class='ays-quiz-social-shares'>"; |
| [2373](#L2373) | $ays\_social\_buttons .= "<div class='ays-quiz-social-shares-heading'>"; |
| [2374](#L2374) | $ays\_social\_buttons .= $social\_buttons\_heading; |
| [2375](#L2375) | $ays\_social\_buttons .= "</div>"; |
| [2376](#L2376) |  |
| [2377](#L2377) | if ( $quiz\_enable\_linkedin\_share\_button ) { |
| [2378](#L2378) | $ays\_social\_buttons .= " |
| [2379](#L2379) | <!-- Branded LinkedIn button --> |
| [2380](#L2380) | <a class='ays-share-btn ays-to-share ays-share-btn-branded ays-share-btn-linkedin' |
| [2381](#L2381) | href='https://www.linkedin.com/shareArticle?mini=true&url=" . $actual\_link . "' |
| [2382](#L2382) | title='Share on LinkedIn'> |
| [2383](#L2383) | <span class='ays-quiz-share-btn-icon'></span> |
| [2384](#L2384) | <span class='ays-share-btn-text'>LinkedIn</span> |
| [2385](#L2385) | </a>"; |
| [2386](#L2386) | } |
| [2387](#L2387) |  |
| [2388](#L2388) | if ( $quiz\_enable\_facebook\_share\_button ) { |
| [2389](#L2389) | $ays\_social\_buttons .= " |
| [2390](#L2390) | <!-- Branded Facebook button --> |
| [2391](#L2391) | <a class='ays-share-btn ays-to-share ays-share-btn-branded ays-share-btn-facebook' |
| [2392](#L2392) | href='https://www.facebook.com/sharer/sharer.php?u=" . $actual\_link . "' |
| [2393](#L2393) | title='Share on Facebook'> |
| [2394](#L2394) | <span class='ays-quiz-share-btn-icon'></span> |
| [2395](#L2395) | <span class='ays-share-btn-text'>Facebook</span> |
| [2396](#L2396) | </a>"; |
| [2397](#L2397) | } |
| [2398](#L2398) |  |
| [2399](#L2399) | if ( $quiz\_enable\_twitter\_share\_button ) { |
| [2400](#L2400) | $ays\_social\_buttons .= " |
| [2401](#L2401) | <!-- Branded Twitter button --> |
| [2402](#L2402) | <a class='ays-share-btn ays-to-share ays-share-btn-branded ays-share-btn-twitter' |
| [2403](#L2403) | href='https://twitter.com/share?url=" . $actual\_link . "' |
| [2404](#L2404) | title='Share on Twitter'> |
| [2405](#L2405) | <span class='ays-quiz-share-btn-icon'></span> |
| [2406](#L2406) | <span class='ays-share-btn-text'>Twitter</span> |
| [2407](#L2407) | </a>"; |
| [2408](#L2408) | } |
| [2409](#L2409) |  |
| [2410](#L2410) | if ( $quiz\_enable\_vkontakte\_share\_button ) { |
| [2411](#L2411) | $ays\_social\_buttons .= " |
| [2412](#L2412) | <!-- Branded VK button --> |
| [2413](#L2413) | <a class='ays-share-btn ays-to-share ays-share-btn-branded ays-share-btn-vkontakte' |
| [2414](#L2414) | href='https://vk.com/share.php?url=" . $actual\_link . "' |
| [2415](#L2415) | title='Share on VKontakte'> |
| [2416](#L2416) | <span class='ays-quiz-share-btn-icon'></span> |
| [2417](#L2417) | <span class='ays-share-btn-text'>VKontakte</span> |
| [2418](#L2418) | </a>"; |
| [2419](#L2419) | } |
| [2420](#L2420) |  |
| [2421](#L2421) | $ays\_social\_buttons .= "</div>"; |
| [2422](#L2422) | } |
| [2423](#L2423) |  |
| [2424](#L2424) |  |
| [2425](#L2425) |  |
| [2426](#L2426) | /\* |
| [2427](#L2427) | \* Quiz social media links |
| [2428](#L2428) | \* |
| [2429](#L2429) | \* Generating HTML code |
| [2430](#L2430) | \*/ |
| [2431](#L2431) |  |
| [2432](#L2432) | // Heading for social media links |
| [2433](#L2433) | $social\_links\_heading = (isset($options['social\_links\_heading']) && $options['social\_links\_heading'] != '') ? stripslashes( wpautop( $options['social\_links\_heading'] ) ) : ""; |
| [2434](#L2434) |  |
| [2435](#L2435) | // Social Media links |
| [2436](#L2436) |  |
| [2437](#L2437) | $enable\_social\_links = (isset($options['enable\_social\_links']) && $options['enable\_social\_links'] == "on") ? true : false; |
| [2438](#L2438) | $social\_links = (isset($options['social\_links'])) ? $options['social\_links'] : array( |
| [2439](#L2439) | 'linkedin\_link' => '', |
| [2440](#L2440) | 'facebook\_link' => '', |
| [2441](#L2441) | 'twitter\_link' => '', |
| [2442](#L2442) | 'vkontakte\_link' => '', |
| [2443](#L2443) | 'instagram\_link' => '', |
| [2444](#L2444) | 'youtube\_link' => '', |
| [2445](#L2445) | 'behance\_link' => '', |
| [2446](#L2446) | ); |
| [2447](#L2447) | $ays\_social\_links\_array = array(); |
| [2448](#L2448) |  |
| [2449](#L2449) | $linkedin\_link = isset($social\_links['linkedin\_link']) && $social\_links['linkedin\_link'] != '' ? $social\_links['linkedin\_link'] : ''; |
| [2450](#L2450) | $facebook\_link = isset($social\_links['facebook\_link']) && $social\_links['facebook\_link'] != '' ? $social\_links['facebook\_link'] : ''; |
| [2451](#L2451) | $twitter\_link = isset($social\_links['twitter\_link']) && $social\_links['twitter\_link'] != '' ? $social\_links['twitter\_link'] : ''; |
| [2452](#L2452) | $vkontakte\_link = isset($social\_links['vkontakte\_link']) && $social\_links['vkontakte\_link'] != '' ? $social\_links['vkontakte\_link'] : ''; |
| [2453](#L2453) | $instagram\_link = isset($social\_links['instagram\_link']) && $social\_links['instagram\_link'] != '' ? $social\_links['instagram\_link'] : ''; |
| [2454](#L2454) | $youtube\_link = isset($social\_links['youtube\_link']) && $social\_links['youtube\_link'] != '' ? $social\_links['youtube\_link'] : ''; |
| [2455](#L2455) | $behance\_link = isset($social\_links['behance\_link']) && $social\_links['behance\_link'] != '' ? $social\_links['behance\_link'] : ''; |
| [2456](#L2456) |  |
| [2457](#L2457) | if($linkedin\_link != ''){ |
| [2458](#L2458) | $ays\_social\_links\_array['Linkedin'] = $linkedin\_link; |
| [2459](#L2459) | } |
| [2460](#L2460) | if($facebook\_link != ''){ |
| [2461](#L2461) | $ays\_social\_links\_array['Facebook'] = $facebook\_link; |
| [2462](#L2462) | } |
| [2463](#L2463) | if($twitter\_link != ''){ |
| [2464](#L2464) | $ays\_social\_links\_array['Twitter'] = $twitter\_link; |
| [2465](#L2465) | } |
| [2466](#L2466) | if($vkontakte\_link != ''){ |
| [2467](#L2467) | $ays\_social\_links\_array['VKontakte'] = $vkontakte\_link; |
| [2468](#L2468) | } |
| [2469](#L2469) | if($instagram\_link != ''){ |
| [2470](#L2470) | $ays\_social\_links\_array['Instagram'] = $instagram\_link; |
| [2471](#L2471) | } |
| [2472](#L2472) | if($youtube\_link != ''){ |
| [2473](#L2473) | $ays\_social\_links\_array['Youtube'] = $youtube\_link; |
| [2474](#L2474) | } |
| [2475](#L2475) | if($behance\_link != ''){ |
| [2476](#L2476) | $ays\_social\_links\_array['Behance'] = $behance\_link; |
| [2477](#L2477) | } |
| [2478](#L2478) | $ays\_social\_links = ''; |
| [2479](#L2479) |  |
| [2480](#L2480) | if($enable\_social\_links){ |
| [2481](#L2481) | $ays\_social\_links .= "<div class='ays-quiz-social-shares'>"; |
| [2482](#L2482) |  |
| [2483](#L2483) | if( $social\_links\_heading != "" ) { |
| [2484](#L2484) | $ays\_social\_links .= "<div class='ays-quiz-social-links-heading'>"; |
| [2485](#L2485) | $ays\_social\_links .= $social\_links\_heading; |
| [2486](#L2486) | $ays\_social\_links .= "</div>"; |
| [2487](#L2487) | } |
| [2488](#L2488) |  |
| [2489](#L2489) | foreach($ays\_social\_links\_array as $media => $link){ |
| [2490](#L2490) | $ays\_social\_links .= "<!-- Branded " . $media . " button --> |
| [2491](#L2491) | <a class='ays-share-btn ays-share-btn-branded ays-share-btn-rounded ays-share-btn-" . strtolower($media) . "' |
| [2492](#L2492) | href='" . $link . "' |
| [2493](#L2493) | target='\_blank' |
| [2494](#L2494) | title='" . $media . " link'> |
| [2495](#L2495) | <span class='ays-quiz-share-btn-icon'></span> |
| [2496](#L2496) | </a>"; |
| [2497](#L2497) | } |
| [2498](#L2498) |  |
| [2499](#L2499) | // "<!-- Branded Facebook button --> |
| [2500](#L2500) | // <a class='ays-share-btn ays-share-btn-branded ays-share-btn-facebook' |
| [2501](#L2501) | //     href='" . . "' |
| [2502](#L2502) | //     title='Share on Facebook'> |
| [2503](#L2503) | //     <span class='ays-quiz-share-btn-icon'></span> |
| [2504](#L2504) | // </a> |
| [2505](#L2505) | // <!-- Branded Twitter button --> |
| [2506](#L2506) | // <a class='ays-share-btn ays-share-btn-branded ays-share-btn-twitter' |
| [2507](#L2507) | //     href='" . . "' |
| [2508](#L2508) | //     title='Share on Twitter'> |
| [2509](#L2509) | //     <span class='ays-quiz-share-btn-icon'></span> |
| [2510](#L2510) | // </a>"; |
| [2511](#L2511) | $ays\_social\_links .= "</div>"; |
| [2512](#L2512) | } |
| [2513](#L2513) |  |
| [2514](#L2514) |  |
| [2515](#L2515) | /\* |
| [2516](#L2516) | \* Quiz loader |
| [2517](#L2517) | \* |
| [2518](#L2518) | \* Generating HTML code |
| [2519](#L2519) | \*/ |
| [2520](#L2520) |  |
| [2521](#L2521) | $quiz\_loader = 'default'; |
| [2522](#L2522) |  |
| [2523](#L2523) | if(isset($options['quiz\_loader']) && $options['quiz\_loader'] != ''){ |
| [2524](#L2524) | $quiz\_loader = $options['quiz\_loader']; |
| [2525](#L2525) | } |
| [2526](#L2526) | // Custom Text |
| [2527](#L2527) | $quiz\_loader\_text\_value = (isset($options['quiz\_loader\_text\_value']) && $options['quiz\_loader\_text\_value'] != '') ? stripslashes($options['quiz\_loader\_text\_value']) : ''; |
| [2528](#L2528) |  |
| [2529](#L2529) | // Custom Gif |
| [2530](#L2530) | $quiz\_loader\_custom\_gif = (isset($options['quiz\_loader\_custom\_gif']) && $options['quiz\_loader\_custom\_gif'] != '') ? stripslashes($options['quiz\_loader\_custom\_gif']) : ''; |
| [2531](#L2531) |  |
| [2532](#L2532) | //  Quiz loader custom gif width |
| [2533](#L2533) | $quiz\_loader\_custom\_gif\_width = (isset($options['quiz\_loader\_custom\_gif\_width']) && $options['quiz\_loader\_custom\_gif\_width'] != '') ? absint( intval( $options['quiz\_loader\_custom\_gif\_width'] ) ) : 100; |
| [2534](#L2534) |  |
| [2535](#L2535) | $quiz\_loader\_custom\_gif\_width\_css = ''; |
| [2536](#L2536) | if ( $quiz\_loader\_custom\_gif\_width != '' ) { |
| [2537](#L2537) | $quiz\_loader\_custom\_gif\_width\_css = 'width: '. $quiz\_loader\_custom\_gif\_width .'px; height: auto; max-width: 100%;'; |
| [2538](#L2538) | } |
| [2539](#L2539) |  |
| [2540](#L2540) | switch($quiz\_loader){ |
| [2541](#L2541) | case 'default': |
| [2542](#L2542) | $quiz\_loader\_html = "<div data-class='lds-ellipsis' data-role='loader' class='ays-loader'><div></div><div></div><div></div><div></div></div>"; |
| [2543](#L2543) | break; |
| [2544](#L2544) | case 'circle': |
| [2545](#L2545) | $quiz\_loader\_html = "<div data-class='lds-circle' data-role='loader' class='ays-loader'></div>"; |
| [2546](#L2546) | break; |
| [2547](#L2547) | case 'dual\_ring': |
| [2548](#L2548) | $quiz\_loader\_html = "<div data-class='lds-dual-ring' data-role='loader' class='ays-loader'></div>"; |
| [2549](#L2549) | break; |
| [2550](#L2550) | case 'facebook': |
| [2551](#L2551) | $quiz\_loader\_html = "<div data-class='lds-facebook' data-role='loader' class='ays-loader'><div></div><div></div><div></div></div>"; |
| [2552](#L2552) | break; |
| [2553](#L2553) | case 'hourglass': |
| [2554](#L2554) | $quiz\_loader\_html = "<div data-class='lds-hourglass' data-role='loader' class='ays-loader'></div>"; |
| [2555](#L2555) | break; |
| [2556](#L2556) | case 'ripple': |
| [2557](#L2557) | $quiz\_loader\_html = "<div data-class='lds-ripple' data-role='loader' class='ays-loader'><div></div><div></div></div>"; |
| [2558](#L2558) | break; |
| [2559](#L2559) | case 'text': |
| [2560](#L2560) | if ($quiz\_loader\_text\_value != '') { |
| [2561](#L2561) | $quiz\_loader\_html = " |
| [2562](#L2562) | <div class='ays-loader' data-class='text' data-role='loader'> |
| [2563](#L2563) | <p class='ays-loader-content'>". $quiz\_loader\_text\_value ."</p> |
| [2564](#L2564) | </div>"; |
| [2565](#L2565) | }else{ |
| [2566](#L2566) | $quiz\_loader\_html = "<div data-class='lds-ellipsis' data-role='loader' class='ays-loader'><div></div><div></div><div></div><div></div></div>"; |
| [2567](#L2567) | } |
| [2568](#L2568) | break; |
| [2569](#L2569) | case 'custom\_gif': |
| [2570](#L2570) | if ($quiz\_loader\_custom\_gif != '') { |
| [2571](#L2571) | $quiz\_loader\_html = " |
| [2572](#L2572) | <div class='ays-loader' data-class='text' data-role='loader' style='text-align: center;'> |
| [2573](#L2573) | <img src='". $quiz\_loader\_custom\_gif ."' class='ays-loader-content ays-loader-custom-gif-content' style='". $quiz\_loader\_custom\_gif\_width\_css ."'> |
| [2574](#L2574) | </div>"; |
| [2575](#L2575) | }else{ |
| [2576](#L2576) | $quiz\_loader\_html = "<div data-class='lds-ellipsis' data-role='loader' class='ays-loader'><div></div><div></div><div></div><div></div></div>"; |
| [2577](#L2577) | } |
| [2578](#L2578) | break; |
| [2579](#L2579) | default: |
| [2580](#L2580) | $quiz\_loader\_html = "<div data-class='lds-ellipsis' data-role='loader' class='ays-loader'><div></div><div></div><div></div><div></div></div>"; |
| [2581](#L2581) | break; |
| [2582](#L2582) | } |
| [2583](#L2583) |  |
| [2584](#L2584) |  |
| [2585](#L2585) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [2586](#L2586) |  |
| [2587](#L2587) | /\* |
| [2588](#L2588) | \* Quiz limitations |
| [2589](#L2589) | \* |
| [2590](#L2590) | \* Blocking content |
| [2591](#L2591) | \* |
| [2592](#L2592) | \* Generating HTML code |
| [2593](#L2593) | \*/ |
| [2594](#L2594) |  |
| [2595](#L2595) | $limit\_users\_html = ""; |
| [2596](#L2596) | $limit\_users = null; |
| [2597](#L2597) |  |
| [2598](#L2598) | /\* |
| [2599](#L2599) | \* Quiz timer in tab title |
| [2600](#L2600) | \*/ |
| [2601](#L2601) |  |
| [2602](#L2602) | if(isset($options['quiz\_timer\_in\_title']) && $options['quiz\_timer\_in\_title'] == "on"){ |
| [2603](#L2603) | $show\_timer\_in\_title = "true"; |
| [2604](#L2604) | }else{ |
| [2605](#L2605) | $show\_timer\_in\_title = "false"; |
| [2606](#L2606) | } |
| [2607](#L2607) |  |
| [2608](#L2608) | /\* |
| [2609](#L2609) | \* Quiz one time passing |
| [2610](#L2610) | \* |
| [2611](#L2611) | \* Generating HTML code |
| [2612](#L2612) | \*/ |
| [2613](#L2613) |  |
| [2614](#L2614) | // Limit users by option |
| [2615](#L2615) | $limit\_users\_by = 'ip'; |
| [2616](#L2616) | $limit\_users\_attr = array(); |
| [2617](#L2617) | $check\_cookie = null; |
| [2618](#L2618) |  |
| [2619](#L2619) | if(isset($options['limit\_users\_by']) && $options['limit\_users\_by'] != ''){ |
| [2620](#L2620) | $limit\_users\_by = $options['limit\_users\_by']; |
| [2621](#L2621) | } |
| [2622](#L2622) |  |
| [2623](#L2623) | $limit\_users\_attr = array( |
| [2624](#L2624) | 'id' => $id, |
| [2625](#L2625) | 'name' => 'ays\_quiz\_cookie\_', |
| [2626](#L2626) | 'title' => $title, |
| [2627](#L2627) | ); |
| [2628](#L2628) | $check\_cookie = $this->ays\_quiz\_check\_cookie( $limit\_users\_attr ); |
| [2629](#L2629) |  |
| [2630](#L2630) | if (isset($options['limit\_users']) && $options['limit\_users'] == "on") { |
| [2631](#L2631) |  |
| [2632](#L2632) | switch ( $limit\_users\_by ) { |
| [2633](#L2633) | case 'ip': |
| [2634](#L2634) | $result = $this->get\_user\_by\_ip($id); |
| [2635](#L2635) | if ( $check\_cookie ) { |
| [2636](#L2636) | $remove\_cookie = $this->ays\_quiz\_remove\_cookie( $limit\_users\_attr ); |
| [2637](#L2637) | } |
| [2638](#L2638) | break; |
| [2639](#L2639) | case 'user\_id': |
| [2640](#L2640) | if(is\_user\_logged\_in()){ |
| [2641](#L2641) | $user\_id = get\_current\_user\_id(); |
| [2642](#L2642) | $result = $this->get\_limit\_user\_by\_id($id, $user\_id); |
| [2643](#L2643) | }else{ |
| [2644](#L2644) | $result = 0; |
| [2645](#L2645) | } |
| [2646](#L2646) |  |
| [2647](#L2647) | if ( $check\_cookie ) { |
| [2648](#L2648) | $remove\_cookie = $this->ays\_quiz\_remove\_cookie( $limit\_users\_attr ); |
| [2649](#L2649) | } |
| [2650](#L2650) | break; |
| [2651](#L2651) | case 'cookie': |
| [2652](#L2652) | if ( ! $check\_cookie ) { |
| [2653](#L2653) | $result = 0; |
| [2654](#L2654) | }else{ |
| [2655](#L2655) | $result = 1; |
| [2656](#L2656) | } |
| [2657](#L2657) | break; |
| [2658](#L2658) | case 'ip\_cookie': |
| [2659](#L2659) | $check\_user\_by\_ip = $this->get\_user\_by\_ip($id); |
| [2660](#L2660) | if($check\_cookie || $check\_user\_by\_ip > 0){ |
| [2661](#L2661) | $result = 1; |
| [2662](#L2662) | } |
| [2663](#L2663) | elseif(! $check\_cookie || $check\_user\_by\_ip <= 0){ |
| [2664](#L2664) | $result = 0; |
| [2665](#L2665) | } |
| [2666](#L2666) | break; |
| [2667](#L2667) | default: |
| [2668](#L2668) | $result = 0; |
| [2669](#L2669) | if ( $check\_cookie ) { |
| [2670](#L2670) | $remove\_cookie = $this->ays\_quiz\_remove\_cookie( $limit\_users\_attr ); |
| [2671](#L2671) | } |
| [2672](#L2672) | break; |
| [2673](#L2673) | } |
| [2674](#L2674) |  |
| [2675](#L2675) |  |
| [2676](#L2676) | if ($result != 0) { |
| [2677](#L2677) | $limit\_users = true; |
| [2678](#L2678) | $timer\_row = ""; |
| [2679](#L2679) | if(isset($options['redirection\_delay']) && $options['redirection\_delay'] != ''){ |
| [2680](#L2680) | if(isset($options['redirect\_url']) && $options['redirect\_url'] != ''){ |
| [2681](#L2681) | $timer\_row = "<qm\_rurl class='ays\_redirect\_url' style='display:none'>" . |
| [2682](#L2682) | $options['redirect\_url'] . |
| [2683](#L2683) | "</qm\_rurl> |
| [2684](#L2684) | <div class='ays-quiz-timer' data-show-in-title='".$show\_timer\_in\_title."' data-timer='" . $options['redirection\_delay'] . "'>". |
| [2685](#L2685) | \_\_( "Redirecting after", $this->plugin\_name ). " " . |
| [2686](#L2686) | $this->secondsToWords($options['redirection\_delay']) . |
| [2687](#L2687) | "<EXTERNAL\_FRAGMENT></EXTERNAL\_FRAGMENT> |
| [2688](#L2688) | </div>"; |
| [2689](#L2689) | } |
| [2690](#L2690) | } |
| [2691](#L2691) |  |
| [2692](#L2692) | $limitation\_message = (isset($options['limitation\_message']) && $options['limitation\_message'] != '') ? $this->ays\_autoembed($options['limitation\_message']) : \_\_( 'You have already passed this quiz.', $this->plugin\_name ); |
| [2693](#L2693) | $limitation\_message = $this->replace\_message\_variables($limitation\_message, $message\_variables\_data); |
| [2694](#L2694) |  |
| [2695](#L2695) | $limit\_users\_html = $timer\_row . "<div style='color:" . $text\_color . "' class='ays\_block\_content'>" .  $limitation\_message . "</div><style>form{min-height:0 !important;}</style>"; |
| [2696](#L2696) | } |
| [2697](#L2697) | }else{ |
| [2698](#L2698) | $limit\_users = false; |
| [2699](#L2699) | if ( $check\_cookie ) { |
| [2700](#L2700) | $remove\_cookie = $this->ays\_quiz\_remove\_cookie( $limit\_users\_attr ); |
| [2701](#L2701) | } |
| [2702](#L2702) | } |
| [2703](#L2703) |  |
| [2704](#L2704) |  |
| [2705](#L2705) |  |
| [2706](#L2706) | /\* |
| [2707](#L2707) | \* Quiz only for logged in users |
| [2708](#L2708) | \* |
| [2709](#L2709) | \* Generating HTML code |
| [2710](#L2710) | \*/ |
| [2711](#L2711) |  |
| [2712](#L2712) | // Show login form for not logged in users |
| [2713](#L2713) | $options['show\_login\_form'] = isset($options['show\_login\_form']) ? $options['show\_login\_form'] : 'off'; |
| [2714](#L2714) | $show\_login\_form = (isset($options['show\_login\_form']) && $options['show\_login\_form'] == "on") ? true : false; |
| [2715](#L2715) | $quiz\_login\_form = ""; |
| [2716](#L2716) | if($show\_login\_form){ |
| [2717](#L2717) | $ays\_login\_button\_text = $this->buttons\_texts['loginButton']; |
| [2718](#L2718) | $args = array( |
| [2719](#L2719) | 'echo' => false, |
| [2720](#L2720) | 'id\_username' => 'ays\_user\_login', |
| [2721](#L2721) | 'id\_password' => 'ays\_user\_pass', |
| [2722](#L2722) | 'id\_remember' => 'ays\_rememberme', |
| [2723](#L2723) | 'id\_submit' => 'ays-submit', |
| [2724](#L2724) | 'label\_log\_in' => $ays\_login\_button\_text, |
| [2725](#L2725) | ); |
| [2726](#L2726) | $quiz\_login\_form = "<div class='ays\_quiz\_login\_form'>" . wp\_login\_form( $args ) . "</div>"; |
| [2727](#L2727) | } |
| [2728](#L2728) |  |
| [2729](#L2729) | global $wp\_roles; |
| [2730](#L2730) |  |
| [2731](#L2731) | if(isset($options['enable\_logged\_users']) && $options['enable\_logged\_users'] == 'on' && !is\_user\_logged\_in()){ |
| [2732](#L2732) | $enable\_logged\_users = 'only\_logged\_users'; |
| [2733](#L2733) | if(isset($options['enable\_logged\_users\_message']) && $options['enable\_logged\_users\_message'] != ""){ |
| [2734](#L2734) | $logged\_users\_message = $this->ays\_autoembed($options['enable\_logged\_users\_message']); |
| [2735](#L2735) | $logged\_users\_message = $this->replace\_message\_variables($logged\_users\_message, $message\_variables\_data); |
| [2736](#L2736) | }else{ |
| [2737](#L2737) | $logged\_users\_message =  \_\_('You must log in to pass this quiz.', $this->plugin\_name); |
| [2738](#L2738) | } |
| [2739](#L2739) | if($logged\_users\_message !== null){ |
| [2740](#L2740) | $user\_massage = '<div class="logged\_in\_message">' . $logged\_users\_message . '</div>'; |
| [2741](#L2741) | }else{ |
| [2742](#L2742) | $user\_massage = null; |
| [2743](#L2743) | } |
| [2744](#L2744) | }else{ |
| [2745](#L2745) | $user\_massage = null; |
| [2746](#L2746) | $enable\_logged\_users = ''; |
| [2747](#L2747) | $user\_role = (isset($options['user\_role']) && $options['user\_role'] != '') ? $options['user\_role'] : ''; |
| [2748](#L2748) | if (isset($options['enable\_restriction\_pass']) && $options['enable\_restriction\_pass'] == 'on' && !empty( $user\_role )) { |
| [2749](#L2749) | $user = wp\_get\_current\_user(); |
| [2750](#L2750) | $user\_roles   = $wp\_roles->role\_names; |
| [2751](#L2751) | $message = (isset($options['restriction\_pass\_message']) && $options['restriction\_pass\_message'] != '') ? $options['restriction\_pass\_message'] : \_\_('Permission Denied', $this->plugin\_name); |
| [2752](#L2752) | $user\_massage = '<div class="logged\_in\_message">' . $this->ays\_autoembed($message) . '</div>'; |
| [2753](#L2753) | $user\_massage = $this->replace\_message\_variables($user\_massage, $message\_variables\_data); |
| [2754](#L2754) |  |
| [2755](#L2755) | if (is\_array($user\_role)) { |
| [2756](#L2756) | foreach($user\_role as $key => $role){ |
| [2757](#L2757) | if(in\_array($role, $user\_roles)){ |
| [2758](#L2758) | $user\_role[$key] = array\_search($role, $user\_roles); |
| [2759](#L2759) | } |
| [2760](#L2760) | } |
| [2761](#L2761) | }else{ |
| [2762](#L2762) | if(in\_array($user\_role, $user\_roles)){ |
| [2763](#L2763) | $user\_role = array\_search($user\_role, $user\_roles); |
| [2764](#L2764) | } |
| [2765](#L2765) | } |
| [2766](#L2766) |  |
| [2767](#L2767) | if(is\_array($user\_role)){ |
| [2768](#L2768) | foreach($user\_role as $role){ |
| [2769](#L2769) | if (in\_array(strtolower($role), (array)$user->roles)) { |
| [2770](#L2770) | $user\_massage = null; |
| [2771](#L2771) | break; |
| [2772](#L2772) | } |
| [2773](#L2773) | } |
| [2774](#L2774) | }else{ |
| [2775](#L2775) | if (in\_array(strtolower($user\_role), (array)$user->roles)) { |
| [2776](#L2776) | $user\_massage = null; |
| [2777](#L2777) | } |
| [2778](#L2778) | } |
| [2779](#L2779) | } |
| [2780](#L2780) | } |
| [2781](#L2781) |  |
| [2782](#L2782) | if($user\_massage !== null){ |
| [2783](#L2783) | if( !is\_user\_logged\_in() ){ |
| [2784](#L2784) | $user\_massage .= $quiz\_login\_form; |
| [2785](#L2785) | } |
| [2786](#L2786) | } |
| [2787](#L2787) |  |
| [2788](#L2788) | // Limitation tackers of quiz |
| [2789](#L2789) | $enable\_tackers\_count = false; |
| [2790](#L2790) | $tackers\_count = 0; |
| [2791](#L2791) | $tackers\_message = "<div style='padding:50px;'><p>" . \_\_( "This quiz is expired!", $this->plugin\_name ) . "</p></div>"; |
| [2792](#L2792) | $options['enable\_tackers\_count'] = !isset($options['enable\_tackers\_count']) ? 'off' : $options['enable\_tackers\_count']; |
| [2793](#L2793) | if(isset($options['enable\_tackers\_count']) && $options['enable\_tackers\_count'] == 'on'){ |
| [2794](#L2794) | $enable\_tackers\_count = true; |
| [2795](#L2795) | } |
| [2796](#L2796) | if(isset($options['tackers\_count']) && $options['tackers\_count'] != ''){ |
| [2797](#L2797) | $tackers\_count = intval($options['tackers\_count']); |
| [2798](#L2798) | } |
| [2799](#L2799) |  |
| [2800](#L2800) | // Quiz takers message |
| [2801](#L2801) | $quiz\_tackers\_message = ( isset($options['quiz\_tackers\_message']) && $options['quiz\_tackers\_message'] != '' ) ? stripslashes( wpautop( $options['quiz\_tackers\_message'] ) ) : \_\_( "This quiz is expired!", $this->plugin\_name ); |
| [2802](#L2802) | $quiz\_tackers\_message = $this->replace\_message\_variables($quiz\_tackers\_message, $message\_variables\_data); |
| [2803](#L2803) |  |
| [2804](#L2804) | if ( $quiz\_tackers\_message != \_\_( "This quiz is expired!", $this->plugin\_name ) ) { |
| [2805](#L2805) | $tackers\_message = "<div class='ays-quiz-limitation-count-of-takers'>". $quiz\_tackers\_message ."</div>"; |
| [2806](#L2806) | } else { |
| [2807](#L2807) | $tackers\_message = "<div class='ays-quiz-limitation-count-of-takers'><p>" . \_\_( "This quiz is expired!", $this->plugin\_name ) . "</p></div>"; |
| [2808](#L2808) | } |
| [2809](#L2809) |  |
| [2810](#L2810) |  |
| [2811](#L2811) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [2812](#L2812) |  |
| [2813](#L2813) | /\* |
| [2814](#L2814) | \* Schedule quiz |
| [2815](#L2815) | \* Check is quiz expired |
| [2816](#L2816) | \*/ |
| [2817](#L2817) |  |
| [2818](#L2818) | $is\_expired = false; |
| [2819](#L2819) | $active\_date\_check = false; |
| [2820](#L2820) | $UTC\_seconds = null; |
| [2821](#L2821) | $startDate = ''; |
| [2822](#L2822) | $endDate = ''; |
| [2823](#L2823) | $startDate\_atr = ''; |
| [2824](#L2824) | $endDate\_atr = ''; |
| [2825](#L2825) | $current\_time = strtotime(current\_time( "Y:m:d H:i:s" )); |
| [2826](#L2826) | $activeInterval = isset( $options['activeInterval'] ) && $options['activeInterval'] != '' ? $options['activeInterval'] : current\_time( 'mysql' ); |
| [2827](#L2827) | $deactiveInterval = isset( $options['deactiveInterval'] ) && $options['deactiveInterval'] != '' ? $options['deactiveInterval'] : current\_time( 'mysql' ); |
| [2828](#L2828) | $startDate = strtotime( $activeInterval ); |
| [2829](#L2829) | $endDate   = strtotime( $deactiveInterval ); |
| [2830](#L2830) |  |
| [2831](#L2831) | // Timezone | Schedule the quiz |
| [2832](#L2832) | $ays\_quiz\_schedule\_timezone = (isset($options['quiz\_schedule\_timezone']) && $options['quiz\_schedule\_timezone'] != '') ? sanitize\_text\_field( $options['quiz\_schedule\_timezone'] ) : get\_option( 'timezone\_string' ); |
| [2833](#L2833) |  |
| [2834](#L2834) | if ( class\_exists( 'DateTimeZone' )) { |
| [2835](#L2835) |  |
| [2836](#L2836) | // Remove old Etc mappings. Fallback to gmt\_offset. |
| [2837](#L2837) | if ( strpos( $ays\_quiz\_schedule\_timezone, 'Etc/GMT' ) !== false ) { |
| [2838](#L2838) | $ays\_quiz\_schedule\_timezone = ''; |
| [2839](#L2839) | } |
| [2840](#L2840) |  |
| [2841](#L2841) | $current\_offset = get\_option( 'gmt\_offset' ); |
| [2842](#L2842) | if ( empty( $ays\_quiz\_schedule\_timezone ) ) { // Create a UTC+- zone if no timezone string exists. |
| [2843](#L2843) |  |
| [2844](#L2844) | if ( 0 == $current\_offset ) { |
| [2845](#L2845) | $ays\_quiz\_schedule\_timezone = 'UTC+0'; |
| [2846](#L2846) | } elseif ( $current\_offset < 0 ) { |
| [2847](#L2847) | $ays\_quiz\_schedule\_timezone = 'UTC' . $current\_offset; |
| [2848](#L2848) | } else { |
| [2849](#L2849) | $ays\_quiz\_schedule\_timezone = 'UTC+' . $current\_offset; |
| [2850](#L2850) | } |
| [2851](#L2851) | } |
| [2852](#L2852) |  |
| [2853](#L2853) | $if\_timezone\_UTC = false; |
| [2854](#L2854) | if ( strpos($ays\_quiz\_schedule\_timezone, 'UTC+') !== false ) { |
| [2855](#L2855) | $if\_timezone\_UTC = true; |
| [2856](#L2856) |  |
| [2857](#L2857) | $UTC\_val\_arr = explode('+', $ays\_quiz\_schedule\_timezone ); |
| [2858](#L2858) |  |
| [2859](#L2859) | $UTC\_val     = ( isset( $UTC\_val\_arr[1] ) && $UTC\_val\_arr[1] != '' ) ? $UTC\_val\_arr[1] : 0; |
| [2860](#L2860) |  |
| [2861](#L2861) | $UTC\_seconds = (int) ($UTC\_val \* 3600); |
| [2862](#L2862) |  |
| [2863](#L2863) | } elseif ( strpos($ays\_quiz\_schedule\_timezone, 'UTC-') !== false ) { |
| [2864](#L2864) | $if\_timezone\_UTC = true; |
| [2865](#L2865) |  |
| [2866](#L2866) | $UTC\_val\_arr = explode('-', $ays\_quiz\_schedule\_timezone ); |
| [2867](#L2867) |  |
| [2868](#L2868) | $UTC\_val     = ( isset( $UTC\_val\_arr[1] ) && $UTC\_val\_arr[1] != '' ) ? $UTC\_val\_arr[1] : 0; |
| [2869](#L2869) |  |
| [2870](#L2870) | $UTC\_seconds =  (int) ( -1 \* ( $UTC\_val \* 3600 ) ); |
| [2871](#L2871) | } |
| [2872](#L2872) |  |
| [2873](#L2873) | if (in\_array( $ays\_quiz\_schedule\_timezone , DateTimeZone::listIdentifiers()) && ! $if\_timezone\_UTC ) { |
| [2874](#L2874) |  |
| [2875](#L2875) | $Date\_Time\_Zone = new DateTime("now", new DateTimeZone( $ays\_quiz\_schedule\_timezone )); |
| [2876](#L2876) | $current\_time   = strtotime( $Date\_Time\_Zone->format( "Y:m:d H:i:s" ) ); |
| [2877](#L2877) | } else { |
| [2878](#L2878) | if ( ! is\_null( $UTC\_seconds ) && ! empty( $UTC\_seconds ) ) { |
| [2879](#L2879) | $Date\_Time\_Zone = new DateTime("now", new DateTimeZone( 'UTC' )); |
| [2880](#L2880) | $current\_time   = strtotime( $Date\_Time\_Zone->format( "Y:m:d H:i:s" ) ) + ( $UTC\_seconds ); |
| [2881](#L2881) | } else { |
| [2882](#L2882) | $current\_time = strtotime(current\_time( "Y:m:d H:i:s" )); |
| [2883](#L2883) | } |
| [2884](#L2884) | } |
| [2885](#L2885) | } |
| [2886](#L2886) |  |
| [2887](#L2887) | $expired\_quiz\_message = "<p class='ays-fs-subtitle'>" . \_\_('The quiz has expired.', $this->plugin\_name) . "</p>"; |
| [2888](#L2888) |  |
| [2889](#L2889) | if (isset($options['active\_date\_check']) && $options['active\_date\_check'] == "on") { |
| [2890](#L2890) | $active\_date\_check = true; |
| [2891](#L2891) |  |
| [2892](#L2892) | if (isset($options['activeInterval']) && !empty($options['activeInterval'])) { |
| [2893](#L2893) | $startDate\_atr = $startDate - $current\_time; |
| [2894](#L2894) | }elseif (isset($options['deactiveInterval']) && !empty($options['deactiveInterval'])) { |
| [2895](#L2895) | $endDate\_atr = $endDate - $current\_time; |
| [2896](#L2896) | } |
| [2897](#L2897) |  |
| [2898](#L2898) | // show timer |
| [2899](#L2899) | $activeDateCheck =  isset($options['active\_date\_check']) && !empty($options['active\_date\_check']) ? true : false; |
| [2900](#L2900) | $activeDeactiveDateCheck =  isset($options['deactiveInterval']) && !empty($options['deactiveInterval']) ? true : false; |
| [2901](#L2901) | $show\_timer\_type = isset($options['show\_timer\_type']) && !empty($options['show\_timer\_type']) ? $options['show\_timer\_type'] : 'countdown'; |
| [2902](#L2902) | $activeActiveDateCheck =  isset($options['activeInterval']) && !empty($options['activeInterval']) ? true : false; |
| [2903](#L2903) |  |
| [2904](#L2904) | $show\_timer = ''; |
| [2905](#L2905) | if ($activeDateCheck && $activeActiveDateCheck && $active\_date\_check) { |
| [2906](#L2906) | if (isset($options['show\_schedule\_timer']) && $options['show\_schedule\_timer'] == 'on') { |
| [2907](#L2907) | $show\_timer .= "<div class='ays\_quiz\_show\_timer'>"; |
| [2908](#L2908) | if ($show\_timer\_type == 'countdown') { |
| [2909](#L2909) | $show\_timer .= '<p class="show\_timer\_countdown" data-timer\_countdown="'.$startDate\_atr.'"></p>'; |
| [2910](#L2910) | }else if ($show\_timer\_type == 'enddate') { |
| [2911](#L2911) | $show\_timer .= '<p class="show\_timer\_countdown">' . \_\_('This Quiz will start on', $this->plugin\_name); |
| [2912](#L2912) | $show\_timer .= ' ' . date\_i18n('H:i:s F jS, Y', intval($startDate)); |
| [2913](#L2913) | $show\_timer .= '</p>'; |
| [2914](#L2914) | } |
| [2915](#L2915) | $show\_timer .= "</div>"; |
| [2916](#L2916) | } |
| [2917](#L2917) | } |
| [2918](#L2918) |  |
| [2919](#L2919) | if ($startDate > $current\_time) { |
| [2920](#L2920) | $is\_expired = true; |
| [2921](#L2921) | if(isset($options['active\_date\_pre\_start\_message'])){ |
| [2922](#L2922) |  |
| [2923](#L2923) | $active\_date\_pre\_start\_message = isset( $options['active\_date\_pre\_start\_message'] ) && $options['active\_date\_pre\_start\_message'] != "" ? $this->ays\_autoembed($options['active\_date\_pre\_start\_message']) : ""; |
| [2924](#L2924) | $active\_date\_pre\_start\_message = $this->replace\_message\_variables($active\_date\_pre\_start\_message, $message\_variables\_data); |
| [2925](#L2925) |  |
| [2926](#L2926) | $expired\_quiz\_message = "<div class='step active-step'> |
| [2927](#L2927) | <div class='ays-abs-fs'> |
| [2928](#L2928) | ".$show\_timer." |
| [2929](#L2929) | " . $active\_date\_pre\_start\_message . " |
| [2930](#L2930) | </div> |
| [2931](#L2931) | </div>"; |
| [2932](#L2932) | }else{ |
| [2933](#L2933) | $expired\_quiz\_message = "<div class='step active-step'> |
| [2934](#L2934) | <div class='ays-abs-fs'> |
| [2935](#L2935) | ".$show\_timer." |
| [2936](#L2936) | <p class='ays-fs-subtitle'>" . \_\_('The quiz will be available soon.', $this->plugin\_name) . "</p> |
| [2937](#L2937) | </div> |
| [2938](#L2938) | </div>"; |
| [2939](#L2939) | } |
| [2940](#L2940) | }elseif ($endDate < $current\_time) { |
| [2941](#L2941) | $is\_expired = true; |
| [2942](#L2942) | if(isset($options['active\_date\_message']) && $options['active\_date\_message'] != ''){ |
| [2943](#L2943) | $expired\_quiz\_message = "<div class='step active-step' data-message-exist='true'> |
| [2944](#L2944) | <div class='ays-abs-fs'> |
| [2945](#L2945) | " . $this->ays\_autoembed( $options['active\_date\_message'] ) . " |
| [2946](#L2946) | </div> |
| [2947](#L2947) | </div>"; |
| [2948](#L2948) | }else{ |
| [2949](#L2949) | $expired\_quiz\_message = "<div class='step active-step'> |
| [2950](#L2950) | <div class='ays-abs-fs'> |
| [2951](#L2951) | <p class='ays-fs-subtitle'>" . \_\_('The quiz has expired.', $this->plugin\_name) . "</p> |
| [2952](#L2952) | </div> |
| [2953](#L2953) | </div>"; |
| [2954](#L2954) | } |
| [2955](#L2955) | } |
| [2956](#L2956) | } |
| [2957](#L2957) |  |
| [2958](#L2958) |  |
| [2959](#L2959) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [2960](#L2960) |  |
| [2961](#L2961) | /\* |
| [2962](#L2962) | \* Quiz main content |
| [2963](#L2963) | \* |
| [2964](#L2964) | \* Generating HTML code |
| [2965](#L2965) | \*/ |
| [2966](#L2966) |  |
| [2967](#L2967) |  |
| [2968](#L2968) | if($quiz\_image != ""){ |
| [2969](#L2969) | $quiz\_image\_alt\_text = $this->ays\_quiz\_get\_image\_id\_by\_url($quiz\_image); |
| [2970](#L2970) |  |
| [2971](#L2971) | $quiz\_image = "<img src='{$quiz\_image}' alt='". $quiz\_image\_alt\_text ."' class='ays\_quiz\_image'>"; |
| [2972](#L2972) | }else{ |
| [2973](#L2973) | $quiz\_image = ""; |
| [2974](#L2974) | } |
| [2975](#L2975) |  |
| [2976](#L2976) | $ays\_protocol = ((!empty($\_SERVER['HTTPS']) && $\_SERVER['HTTPS'] != 'off') || $\_SERVER['SERVER\_PORT'] == 443) ? "https://" : "http://"; |
| [2977](#L2977) |  |
| [2978](#L2978) | $quiz\_current\_page\_link = esc\_url( $ays\_protocol . $\_SERVER['HTTP\_HOST'] . $\_SERVER['REQUEST\_URI'] ); |
| [2979](#L2979) |  |
| [2980](#L2980) | if($show\_quiz\_title){ |
| [2981](#L2981) | $title = "<p class='ays-fs-title'>" . $title . "</p>"; |
| [2982](#L2982) | }else{ |
| [2983](#L2983) | $title = ""; |
| [2984](#L2984) | } |
| [2985](#L2985) |  |
| [2986](#L2986) | if($show\_quiz\_desc){ |
| [2987](#L2987) | $description = "<div class='ays-fs-subtitle'>" . $description . "</div>"; |
| [2988](#L2988) | }else{ |
| [2989](#L2989) | $description = ""; |
| [2990](#L2990) | } |
| [2991](#L2991) |  |
| [2992](#L2992) |  |
| [2993](#L2993) | $main\_content\_first\_part = "{$timer\_row} |
| [2994](#L2994) | {$rw\_asnwers\_sounds\_html} |
| [2995](#L2995) | {$ays\_quiz\_music\_sound} |
| [2996](#L2996) | <div class='step active-step'> |
| [2997](#L2997) | <div class='ays-abs-fs ays-start-page'> |
| [2998](#L2998) | {$show\_cd\_and\_author} |
| [2999](#L2999) | {$quiz\_image} |
| [3000](#L3000) | {$title} |
| [3001](#L3001) | {$description} |
| [3002](#L3002) | <input type='hidden' name='ays\_quiz\_id' value='{$id}'/> |
| [3003](#L3003) | <input type='hidden' name='ays\_quiz\_curent\_page\_link' class='ays-quiz-curent-page-link' value='{$quiz\_current\_page\_link}'/> |
| [3004](#L3004) | " . (isset($quiz\_questions\_ids) ? "<input type='hidden' name='ays\_quiz\_questions' value='{$quiz\_questions\_ids}'>" : "") . " |
| [3005](#L3005) | {$quiz\_password\_message\_html} |
| [3006](#L3006) | {$password\_message} |
| [3007](#L3007) | {$quiz\_start\_button} |
| [3008](#L3008) | </div> |
| [3009](#L3009) | </div>"; |
| [3010](#L3010) |  |
| [3011](#L3011) | if($limit\_users === false || $limit\_users === null){ |
| [3012](#L3012) | $restart\_button\_html = $restart\_button; |
| [3013](#L3013) | }else{ |
| [3014](#L3014) | $restart\_button\_html = ""; |
| [3015](#L3015) | } |
| [3016](#L3016) |  |
| [3017](#L3017) | $main\_content\_last\_part = "<div class='step ays\_thank\_you\_fs'> |
| [3018](#L3018) | <div class='ays-abs-fs ays-end-page'>". |
| [3019](#L3019) | $quiz\_loader\_html . |
| [3020](#L3020) | "<div class='ays\_quiz\_results\_page'>". |
| [3021](#L3021) | $pass\_score\_html . |
| [3022](#L3022) | "<div class='ays\_message'></div>" . |
| [3023](#L3023) | $show\_score\_html . |
| [3024](#L3024) | $show\_average . |
| [3025](#L3025) | $ays\_social\_buttons . |
| [3026](#L3026) | $ays\_social\_links . |
| [3027](#L3027) | $progress\_bar\_html . |
| [3028](#L3028) | "<p class='ays\_restart\_button\_p'>". |
| [3029](#L3029) | $restart\_button\_html . |
| [3030](#L3030) | $exit\_button . |
| [3031](#L3031) | "</p>". |
| [3032](#L3032) | $quiz\_rate\_html . |
| [3033](#L3033) | "</div> |
| [3034](#L3034) | </div> |
| [3035](#L3035) | </div>"; |
| [3036](#L3036) |  |
| [3037](#L3037) | if (! $show\_information\_form) { |
| [3038](#L3038) | if(is\_user\_logged\_in()){ |
| [3039](#L3039) | $show\_form = null; |
| [3040](#L3040) | } |
| [3041](#L3041) | } |
| [3042](#L3042) |  |
| [3043](#L3043) | switch( $quiz\_arrow\_type ){ |
| [3044](#L3044) | case 'default': |
| [3045](#L3045) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_right"; |
| [3046](#L3046) | break; |
| [3047](#L3047) | case 'long\_arrow': |
| [3048](#L3048) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_long\_arrow\_right"; |
| [3049](#L3049) | break; |
| [3050](#L3050) | case 'arrow\_circle\_o': |
| [3051](#L3051) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_circle\_o\_right"; |
| [3052](#L3052) | break; |
| [3053](#L3053) | case 'arrow\_circle': |
| [3054](#L3054) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_circle\_right"; |
| [3055](#L3055) | break; |
| [3056](#L3056) | default: |
| [3057](#L3057) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_right"; |
| [3058](#L3058) | break; |
| [3059](#L3059) | } |
| [3060](#L3060) |  |
| [3061](#L3061) | if($show\_form != null){ |
| [3062](#L3062) | if ($options['information\_form'] == "after") { |
| [3063](#L3063) | $main\_content\_last\_part = "<div class='step'> |
| [3064](#L3064) | <div class='ays-abs-fs ays-end-page information\_form'> |
| [3065](#L3065) | <div class='ays-form-title'>{$form\_title}</div> |
| [3066](#L3066) | " . $form\_inputs . " |
| [3067](#L3067) | <div class='ays\_buttons\_div'> |
| [3068](#L3068) | <i class='" . ($enable\_arrows ? '' : 'ays\_display\_none') . " ays\_fa ays\_fa\_flag\_checkered ays\_finish action-button ays\_arrow ays\_next\_arrow'></i> |
| [3069](#L3069) | <input type='submit' name='ays\_finish\_quiz' class='" . ($enable\_arrows ? 'ays\_display\_none' : '') . " ays\_next ays\_finish action-button' value='" . $this->buttons\_texts['seeResultButton'] . "'/> |
| [3070](#L3070) | </div> |
| [3071](#L3071) | </div> |
| [3072](#L3072) | </div>" . $main\_content\_last\_part; |
| [3073](#L3073) |  |
| [3074](#L3074) | } elseif ($options['information\_form'] == "before") { |
| [3075](#L3075) | $main\_content\_first\_part = $main\_content\_first\_part . "<div class='step'> |
| [3076](#L3076) | <div class='ays-abs-fs ays-start-page information\_form'> |
| [3077](#L3077) | <div class='ays-form-title'>{$form\_title}</div> |
| [3078](#L3078) | " . $form\_inputs . " |
| [3079](#L3079) | <div class='ays\_buttons\_div'> |
| [3080](#L3080) | <i class='ays\_fa " . $quiz\_arrow\_type\_class\_right . " ays\_next action-button ays\_arrow ays\_next\_arrow " . ($enable\_arrows ? '' : 'ays\_display\_none') . "'></i> |
| [3081](#L3081) | <input type='button' class='ays\_next action-button " . ($enable\_arrows ? 'ays\_display\_none' : '') . "' value='" . $this->buttons\_texts['nextButton'] . "' /> |
| [3082](#L3082) | </div> |
| [3083](#L3083) | </div> |
| [3084](#L3084) | </div>" ; |
| [3085](#L3085) |  |
| [3086](#L3086) | } |
| [3087](#L3087) | }else{ |
| [3088](#L3088) | $options['information\_form'] = "disable"; |
| [3089](#L3089) | } |
| [3090](#L3090) |  |
| [3091](#L3091) |  |
| [3092](#L3092) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [3093](#L3093) |  |
| [3094](#L3094) | /\* |
| [3095](#L3095) | \* Script for getting quiz options |
| [3096](#L3096) | \* |
| [3097](#L3097) | \* Script for question type dropdown |
| [3098](#L3098) | \* |
| [3099](#L3099) | \* Generating HTML code |
| [3100](#L3100) | \*/ |
| [3101](#L3101) |  |
| [3102](#L3102) |  |
| [3103](#L3103) | if(isset($options['submit\_redirect\_delay'])){ |
| [3104](#L3104) | if($options['submit\_redirect\_delay'] == ''){ |
| [3105](#L3105) | $options['submit\_redirect\_delay'] = 0; |
| [3106](#L3106) | } |
| [3107](#L3107) |  |
| [3108](#L3108) | if( $options['submit\_redirect\_delay'] === 0 ){ |
| [3109](#L3109) | $options['submit\_redirect\_after'] = 0; |
| [3110](#L3110) | } else { |
| [3111](#L3111) | $options['submit\_redirect\_after'] = $this->secondsToWords( absint($options['submit\_redirect\_delay']) ); |
| [3112](#L3112) | } |
| [3113](#L3113) | } |
| [3114](#L3114) |  |
| [3115](#L3115) | $options['rw\_answers\_sounds'] = $enable\_rw\_asnwers\_sounds; |
| [3116](#L3116) |  |
| [3117](#L3117) | $quiz\_content\_script = "<script>"; |
| [3118](#L3118) | unset($quiz['options']); |
| [3119](#L3119) | $quiz\_options = $options; |
| [3120](#L3120) | foreach($quiz as $k => $q){ |
| [3121](#L3121) | $quiz\_options[$k] = $q; |
| [3122](#L3122) | } |
| [3123](#L3123) |  |
| [3124](#L3124) | // Animation Top (px) |
| [3125](#L3125) | $quiz\_animation\_top = (isset($settings\_options['quiz\_animation\_top']) && $settings\_options['quiz\_animation\_top'] != 0) ? absint(intval($settings\_options['quiz\_animation\_top'])) : 100; |
| [3126](#L3126) | $settings\_options['quiz\_enable\_animation\_top'] = isset($settings\_options['quiz\_enable\_animation\_top']) ? $settings\_options['quiz\_enable\_animation\_top'] : 'on'; |
| [3127](#L3127) | $quiz\_enable\_animation\_top = (isset($settings\_options['quiz\_enable\_animation\_top']) && $settings\_options['quiz\_enable\_animation\_top'] == "on") ? 'on' : 'off'; |
| [3128](#L3128) |  |
| [3129](#L3129) | $quiz\_options['quiz\_animation\_top'] = $quiz\_animation\_top; |
| [3130](#L3130) | $quiz\_options['quiz\_enable\_animation\_top'] = $quiz\_enable\_animation\_top; |
| [3131](#L3131) |  |
| [3132](#L3132) | if ($limit\_users) { |
| [3133](#L3133) | if($limit\_users\_by == 'ip'){ |
| [3134](#L3134) | $result = $this->get\_user\_by\_ip($id); |
| [3135](#L3135) | }elseif($limit\_users\_by == 'user\_id'){ |
| [3136](#L3136) | if(is\_user\_logged\_in()){ |
| [3137](#L3137) | $user\_id = get\_current\_user\_id(); |
| [3138](#L3138) | $result = $this->get\_limit\_user\_by\_id($id, $user\_id); |
| [3139](#L3139) | }else{ |
| [3140](#L3140) | $result = 0; |
| [3141](#L3141) | } |
| [3142](#L3142) | }else{ |
| [3143](#L3143) | $result = 0; |
| [3144](#L3144) | } |
| [3145](#L3145) | if ($result == 0) { |
| [3146](#L3146) | $quiz\_content\_script .= " |
| [3147](#L3147) | if(typeof aysQuizOptions === 'undefined'){ |
| [3148](#L3148) | var aysQuizOptions = []; |
| [3149](#L3149) | } |
| [3150](#L3150) | aysQuizOptions['".$id."']  = '" . base64\_encode(json\_encode($quiz\_options)) . "';"; |
| [3151](#L3151) | } |
| [3152](#L3152) | }else{ |
| [3153](#L3153) | $quiz\_content\_script .= " |
| [3154](#L3154) | if(typeof aysQuizOptions === 'undefined'){ |
| [3155](#L3155) | var aysQuizOptions = []; |
| [3156](#L3156) | } |
| [3157](#L3157) | aysQuizOptions['".$id."']  = '" . base64\_encode(json\_encode($quiz\_options)) . "';"; |
| [3158](#L3158) | } |
| [3159](#L3159) | $quiz\_content\_script .= " |
| [3160](#L3160) | </script>"; |
| [3161](#L3161) |  |
| [3162](#L3162) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [3163](#L3163) |  |
| [3164](#L3164) | /\* |
| [3165](#L3165) | \* Styles for quiz |
| [3166](#L3166) | \* |
| [3167](#L3167) | \* Generating HTML code |
| [3168](#L3168) | \*/ |
| [3169](#L3169) |  |
| [3170](#L3170) |  |
| [3171](#L3171) | $quest\_animation = 'shake'; |
| [3172](#L3172) |  |
| [3173](#L3173) | if(isset($options['quest\_animation']) && $options['quest\_animation'] != ''){ |
| [3174](#L3174) | $quest\_animation = $options['quest\_animation']; |
| [3175](#L3175) | } |
| [3176](#L3176) |  |
| [3177](#L3177) | $quiz\_styles = "<style> |
| [3178](#L3178) | div#ays-quiz-container-" . $id . " \* { |
| [3179](#L3179) | box-sizing: border-box; |
| [3180](#L3180) | } |
| [3181](#L3181) |  |
| [3182](#L3182) | /\* Styles for Internet Explorer start \*/ |
| [3183](#L3183) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " { |
| [3184](#L3184) | " . $ie\_container\_css . " |
| [3185](#L3185) | }"; |
| [3186](#L3186) |  |
| [3187](#L3187) | if($ie\_container\_css != ''){ |
| [3188](#L3188) | // $quiz\_styles .= "#ays-quiz-container-" . $id . " .ays\_next.action-button, |
| [3189](#L3189) | //                 #ays-quiz-container-" . $id . " .ays\_previous.action-button{ |
| [3190](#L3190) | //                     margin: 10px 5px; |
| [3191](#L3191) | //                 }"; |
| [3192](#L3192) |  |
| [3193](#L3193) | $quiz\_styles .= " |
| [3194](#L3194) | /\* |
| [3195](#L3195) | #ays-quiz-container-" . $id . " .ays\_next.action-button, |
| [3196](#L3196) | #ays-quiz-container-" . $id . " .ays\_previous.action-button{ |
| [3197](#L3197) | margin: 10px 5px; |
| [3198](#L3198) | } |
| [3199](#L3199) | \*/ |
| [3200](#L3200) |  |
| [3201](#L3201) | #ays-quiz-container-" . $id . " .ays\_block\_content{ |
| [3202](#L3202) | margin: 0 auto; |
| [3203](#L3203) | word-break: break-all; |
| [3204](#L3204) | } |
| [3205](#L3205) |  |
| [3206](#L3206) | "; |
| [3207](#L3207) |  |
| [3208](#L3208) | } |
| [3209](#L3209) |  |
| [3210](#L3210) | $quiz\_styles .= " |
| [3211](#L3211) |  |
| [3212](#L3212) | /\* Styles for Quiz container \*/ |
| [3213](#L3213) | #ays-quiz-container-" . $id . "{ |
| [3214](#L3214) | min-height: " . $quiz\_height . "px; |
| [3215](#L3215) | width:" . $quiz\_width . "; |
| [3216](#L3216) | background-color:" . $bg\_color . "; |
| [3217](#L3217) | background-position:" . $quiz\_bg\_image\_position . ";"; |
| [3218](#L3218) |  |
| [3219](#L3219) | if($ays\_quiz\_bg\_image !== null){ |
| [3220](#L3220) | $quiz\_styles .=  "background-image: url('$ays\_quiz\_bg\_image');"; |
| [3221](#L3221) | } elseif($enable\_background\_gradient) { |
| [3222](#L3222) | $quiz\_styles .=  "background-image: linear-gradient($quiz\_gradient\_direction, $background\_gradient\_color\_1, $background\_gradient\_color\_2);"; |
| [3223](#L3223) | } |
| [3224](#L3224) |  |
| [3225](#L3225) | if($quiz\_modified\_border\_radius != ""){ |
| [3226](#L3226) | $quiz\_styles .= $quiz\_modified\_border\_radius; |
| [3227](#L3227) | }else{ |
| [3228](#L3228) | $quiz\_styles .=  "border-radius:" . $quiz\_border\_radius . "px;"; |
| [3229](#L3229) | } |
| [3230](#L3230) |  |
| [3231](#L3231) | if($enable\_box\_shadow){ |
| [3232](#L3232) | $quiz\_styles .=  "box-shadow: ". $box\_shadow\_offsets ." 1px " . $this->hex2rgba($box\_shadow\_color, '0.4') . ";"; |
| [3233](#L3233) | }else{ |
| [3234](#L3234) | $quiz\_styles .=  "box-shadow: none;"; |
| [3235](#L3235) | } |
| [3236](#L3236) | if($enable\_border){ |
| [3237](#L3237) | $quiz\_styles .=  "border-width: " . $quiz\_border\_width.'px;'. |
| [3238](#L3238) | "border-style: " . $quiz\_border\_style.';'. |
| [3239](#L3239) | "border-color: " . $quiz\_border\_color.';'; |
| [3240](#L3240) | }else{ |
| [3241](#L3241) | $quiz\_styles .=  "border: none;"; |
| [3242](#L3242) | } |
| [3243](#L3243) |  |
| [3244](#L3244) | $quiz\_styles .= "} |
| [3245](#L3245) |  |
| [3246](#L3246) | /\* Styles for questions \*/ |
| [3247](#L3247) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " div.step { |
| [3248](#L3248) | min-height: " . $quiz\_height . "px; |
| [3249](#L3249) | } |
| [3250](#L3250) |  |
| [3251](#L3251) | /\* Styles for text inside quiz container \*/ |
| [3252](#L3252) | #ays-quiz-container-" . $id . " .ays-start-page \*:not(input), |
| [3253](#L3253) | #ays-quiz-container-" . $id . " .ays\_question\_hint, |
| [3254](#L3254) | #ays-quiz-container-" . $id . " label[for^=\"ays-answer-\"], |
| [3255](#L3255) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " p, |
| [3256](#L3256) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-fs-title, |
| [3257](#L3257) | #ays-quiz-container-" . $id . " .ays-fs-subtitle, |
| [3258](#L3258) | #ays-quiz-container-" . $id . " .logged\_in\_message, |
| [3259](#L3259) | #ays-quiz-container-" . $id . " .ays\_score\_message, |
| [3260](#L3260) | #ays-quiz-container-" . $id . " .ays\_message{ |
| [3261](#L3261) | color: " . $text\_color . "; |
| [3262](#L3262) | outline: none; |
| [3263](#L3263) | } |
| [3264](#L3264) |  |
| [3265](#L3265) | #ays-quiz-container-" . $id . " .ays-quiz-password-message-box, |
| [3266](#L3266) | #ays-quiz-container-" . $id . " .ays-quiz-question-note-message-box, |
| [3267](#L3267) | #ays-quiz-container-" . $id . " .ays\_quiz\_question, |
| [3268](#L3268) | #ays-quiz-container-" . $id . " .ays\_quiz\_question \*:not([class^='enlighter']) { |
| [3269](#L3269) | color: " . $text\_color . "; |
| [3270](#L3270) | } |
| [3271](#L3271) |  |
| [3272](#L3272) | #ays-quiz-container-" . $id . " textarea, |
| [3273](#L3273) | #ays-quiz-container-" . $id . " input::first-letter, |
| [3274](#L3274) | #ays-quiz-container-" . $id . " select::first-letter, |
| [3275](#L3275) | #ays-quiz-container-" . $id . " option::first-letter { |
| [3276](#L3276) | color: initial !important; |
| [3277](#L3277) | } |
| [3278](#L3278) |  |
| [3279](#L3279) | #ays-quiz-container-" . $id . " p::first-letter:not(.ays\_no\_questions\_message) { |
| [3280](#L3280) | color: " . $text\_color . " !important; |
| [3281](#L3281) | background-color: transparent !important; |
| [3282](#L3282) | font-size: inherit !important; |
| [3283](#L3283) | font-weight: inherit !important; |
| [3284](#L3284) | float: none !important; |
| [3285](#L3285) | line-height: inherit !important; |
| [3286](#L3286) | margin: 0 !important; |
| [3287](#L3287) | padding: 0 !important; |
| [3288](#L3288) | } |
| [3289](#L3289) |  |
| [3290](#L3290) |  |
| [3291](#L3291) | #ays-quiz-container-" . $id . " .select2-container, |
| [3292](#L3292) | #ays-quiz-container-" . $id . " .ays-field \* { |
| [3293](#L3293) | font-size: ".$answers\_font\_size."px !important; |
| [3294](#L3294) | } |
| [3295](#L3295) |  |
| [3296](#L3296) | #ays-quiz-container-" . $id . " .ays\_quiz\_question p { |
| [3297](#L3297) | font-size: ".$question\_font\_size."px; |
| [3298](#L3298) |  |
| [3299](#L3299) | } |
| [3300](#L3300) |  |
| [3301](#L3301) | #ays-quiz-container-" . $id . " .ays-fs-subtitle p { |
| [3302](#L3302) | text-align:  ". $quiz\_question\_text\_alignment ." ; |
| [3303](#L3303) | } |
| [3304](#L3304) |  |
| [3305](#L3305) | #ays-quiz-container-" . $id . " .ays\_quiz\_question { |
| [3306](#L3306) | text-align:  ". $quiz\_question\_text\_alignment ." ; |
| [3307](#L3307) | margin-bottom: 10px; |
| [3308](#L3308) | } |
| [3309](#L3309) |  |
| [3310](#L3310) | #ays-quiz-container-" . $id . " .ays\_quiz\_question pre { |
| [3311](#L3311) | max-width: 100%; |
| [3312](#L3312) | white-space: break-spaces; |
| [3313](#L3313) | } |
| [3314](#L3314) |  |
| [3315](#L3315) | #ays-quiz-container-" . $id . " .ays-quiz-timer p { |
| [3316](#L3316) | font-size: 16px; |
| [3317](#L3317) | } |
| [3318](#L3318) |  |
| [3319](#L3319) | #ays-quiz-container-" . $id . " section.ays\_quiz\_redirection\_timer\_container hr, |
| [3320](#L3320) | #ays-quiz-container-" . $id . " section.ays\_quiz\_timer\_container hr { |
| [3321](#L3321) | margin: 0; |
| [3322](#L3322) | } |
| [3323](#L3323) |  |
| [3324](#L3324) | #ays-quiz-container-" . $id . " section.ays\_quiz\_timer\_container.ays\_quiz\_timer\_red\_warning .ays-quiz-timer { |
| [3325](#L3325) | color: red; |
| [3326](#L3326) | } |
| [3327](#L3327) |  |
| [3328](#L3328) | #ays-quiz-container-" . $id . " .ays\_thank\_you\_fs p { |
| [3329](#L3329) | text-align: center; |
| [3330](#L3330) | } |
| [3331](#L3331) |  |
| [3332](#L3332) | #ays-quiz-container-" . $id . " .ays\_quiz\_results\_page .ays\_score span { |
| [3333](#L3333) | visibility: visible; |
| [3334](#L3334) | } |
| [3335](#L3335) |  |
| [3336](#L3336) | #ays-quiz-container-" . $id . " input[type='button'], |
| [3337](#L3337) | #ays-quiz-container-" . $id . " input[type='submit'] { |
| [3338](#L3338) | color: " . $buttons\_text\_color . " !important; |
| [3339](#L3339) | } |
| [3340](#L3340) |  |
| [3341](#L3341) | #ays-quiz-container-" . $id . " input[type='button']{ |
| [3342](#L3342) | outline: none; |
| [3343](#L3343) | } |
| [3344](#L3344) |  |
| [3345](#L3345) | #ays-quiz-container-" . $id . " .information\_form input[type='text'], |
| [3346](#L3346) | #ays-quiz-container-" . $id . " .information\_form input[type='url'], |
| [3347](#L3347) | #ays-quiz-container-" . $id . " .information\_form input[type='number'], |
| [3348](#L3348) | #ays-quiz-container-" . $id . " .information\_form input[type='email'], |
| [3349](#L3349) | #ays-quiz-container-" . $id . " .information\_form input[type='checkbox'], |
| [3350](#L3350) | #ays-quiz-container-" . $id . " .information\_form input[type='tel'], |
| [3351](#L3351) | #ays-quiz-container-" . $id . " .information\_form textarea, |
| [3352](#L3352) | #ays-quiz-container-" . $id . " .information\_form select, |
| [3353](#L3353) | #ays-quiz-container-" . $id . " .information\_form option { |
| [3354](#L3354) | color: initial !important; |
| [3355](#L3355) | outline: none; |
| [3356](#L3356) | background-image: unset; |
| [3357](#L3357) | } |
| [3358](#L3358) |  |
| [3359](#L3359) | #ays-quiz-container-" . $id . " .wrong\_answer\_text{ |
| [3360](#L3360) | color:#ff4d4d; |
| [3361](#L3361) | } |
| [3362](#L3362) | #ays-quiz-container-" . $id . " .right\_answer\_text{ |
| [3363](#L3363) | color:#33cc33; |
| [3364](#L3364) | } |
| [3365](#L3365) |  |
| [3366](#L3366) | #ays-quiz-container-" . $id . " .wrong\_answer\_text p { |
| [3367](#L3367) | font-size:" . $wrong\_answers\_font\_size . "px; |
| [3368](#L3368) | } |
| [3369](#L3369) |  |
| [3370](#L3370) | #ays-quiz-container-" . $id . " .ays\_questtion\_explanation p { |
| [3371](#L3371) | font-size:" . $quest\_explanation\_font\_size . "px; |
| [3372](#L3372) | } |
| [3373](#L3373) |  |
| [3374](#L3374) | #ays-quiz-container-" . $id . " .wrong\_answer\_text \* { |
| [3375](#L3375) | text-transform:" . $quiz\_wrong\_answer\_text\_transform . "; |
| [3376](#L3376) | } |
| [3377](#L3377) |  |
| [3378](#L3378) | #ays-quiz-container-" . $id . " .ays\_questtion\_explanation \* { |
| [3379](#L3379) | text-transform:" . $quiz\_quest\_explanation\_text\_transform . "; |
| [3380](#L3380) | text-decoration: ". $quiz\_quest\_explanation\_text\_decoration ." |
| [3381](#L3381) | } |
| [3382](#L3382) |  |
| [3383](#L3383) | #ays-quiz-container-" . $id . " .right\_answer\_text \* { |
| [3384](#L3384) | text-transform:" . $quiz\_right\_answer\_text\_transform . "; |
| [3385](#L3385) | } |
| [3386](#L3386) |  |
| [3387](#L3387) | #ays-quiz-container-" . $id . " .right\_answer\_text p { |
| [3388](#L3388) | font-size:" . $right\_answers\_font\_size . "px; |
| [3389](#L3389) | } |
| [3390](#L3390) |  |
| [3391](#L3391) | #ays-quiz-container-" . $id . " .ays-quiz-question-note-message-box p { |
| [3392](#L3392) | font-size:" . $note\_text\_font\_size . "px; |
| [3393](#L3393) | } |
| [3394](#L3394) |  |
| [3395](#L3395) | #ays-quiz-container-" . $id . " .ays-quiz-question-note-message-box \* { |
| [3396](#L3396) | text-transform:" . $quiz\_admin\_note\_text\_transform . "; |
| [3397](#L3397) | text-decoration: ". $quiz\_admin\_note\_text\_decoration ." |
| [3398](#L3398) | } |
| [3399](#L3399) |  |
| [3400](#L3400) | #ays-quiz-container-" . $id . " .ays\_cb\_and\_a, |
| [3401](#L3401) | #ays-quiz-container-" . $id . " .ays\_cb\_and\_a \* { |
| [3402](#L3402) | color: " . $this->hex2rgba($text\_color) . "; |
| [3403](#L3403) | text-align: center; |
| [3404](#L3404) | } |
| [3405](#L3405) |  |
| [3406](#L3406) | /\* Quiz textarea height \*/ |
| [3407](#L3407) | #ays-quiz-container-" . $id . " textarea { |
| [3408](#L3408) | height: ". $quiz\_textarea\_height ."px; |
| [3409](#L3409) | min-height: ". $quiz\_textarea\_height ."px; |
| [3410](#L3410) | } |
| [3411](#L3411) |  |
| [3412](#L3412) | /\* Quiz rate and passed users count \*/ |
| [3413](#L3413) | #ays-quiz-container-" . $id . " .ays\_quizn\_ancnoxneri\_qanak, |
| [3414](#L3414) | #ays-quiz-container-" . $id . " .ays\_quiz\_rete\_avg { |
| [3415](#L3415) | color:" . $bg\_color . " !important; |
| [3416](#L3416) | background-color:" . $text\_color . "; |
| [3417](#L3417) | } |
| [3418](#L3418) |  |
| [3419](#L3419) | #ays-quiz-container-" . $id . " .ays-questions-container > .ays\_quizn\_ancnoxneri\_qanak { |
| [3420](#L3420) | padding: 5px 20px; |
| [3421](#L3421) | } |
| [3422](#L3422) | #ays-quiz-container-" . $id . " div.for\_quiz\_rate.ui.star.rating .icon { |
| [3423](#L3423) | color: " . $this->hex2rgba($text\_color, '0.35') . "; |
| [3424](#L3424) | } |
| [3425](#L3425) | #ays-quiz-container-" . $id . " .ays\_quiz\_rete\_avg div.for\_quiz\_rate\_avg.ui.star.rating .icon { |
| [3426](#L3426) | color: " . $this->hex2rgba($bg\_color, '0.5') . "; |
| [3427](#L3427) | } |
| [3428](#L3428) |  |
| [3429](#L3429) | #ays-quiz-container-" . $id . " .ays\_quiz\_rete .ays-quiz-rate-link-box .ays-quiz-rate-link { |
| [3430](#L3430) | color: " . $text\_color . "; |
| [3431](#L3431) | } |
| [3432](#L3432) |  |
| [3433](#L3433) | /\* Loaders \*/ |
| [3434](#L3434) | #ays-quiz-container-" . $id . " div.lds-spinner, |
| [3435](#L3435) | #ays-quiz-container-" . $id . " div.lds-spinner2 { |
| [3436](#L3436) | color: " . $text\_color . "; |
| [3437](#L3437) | } |
| [3438](#L3438) | #ays-quiz-container-" . $id . " div.lds-spinner div:after, |
| [3439](#L3439) | #ays-quiz-container-" . $id . " div.lds-spinner2 div:after { |
| [3440](#L3440) | background-color: " . $text\_color . "; |
| [3441](#L3441) | } |
| [3442](#L3442) | #ays-quiz-container-" . $id . " .lds-circle, |
| [3443](#L3443) | #ays-quiz-container-" . $id . " .lds-facebook div, |
| [3444](#L3444) | #ays-quiz-container-" . $id . " .lds-ellipsis div{ |
| [3445](#L3445) | background: " . $text\_color . "; |
| [3446](#L3446) | } |
| [3447](#L3447) | #ays-quiz-container-" . $id . " .lds-ripple div{ |
| [3448](#L3448) | border-color: " . $text\_color . "; |
| [3449](#L3449) | } |
| [3450](#L3450) | #ays-quiz-container-" . $id . " .lds-dual-ring::after, |
| [3451](#L3451) | #ays-quiz-container-" . $id . " .lds-hourglass::after{ |
| [3452](#L3452) | border-color: " . $text\_color . " transparent " . $text\_color . " transparent; |
| [3453](#L3453) | } |
| [3454](#L3454) |  |
| [3455](#L3455) | /\* Stars \*/ |
| [3456](#L3456) | #ays-quiz-container-" . $id . " .ui.rating .icon, |
| [3457](#L3457) | #ays-quiz-container-" . $id . " .ui.rating .icon:before { |
| [3458](#L3458) | font-family: Rating !important; |
| [3459](#L3459) | } |
| [3460](#L3460) |  |
| [3461](#L3461) | /\* Progress bars \*/ |
| [3462](#L3462) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-progress { |
| [3463](#L3463) | border-color: " . $this->hex2rgba($text\_color, '0.8') . "; |
| [3464](#L3464) | } |
| [3465](#L3465) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-progress-bg { |
| [3466](#L3466) | background-color: " . $this->hex2rgba($text\_color, '0.3') . "; |
| [3467](#L3467) | }"; |
| [3468](#L3468) |  |
| [3469](#L3469) | if ($enable\_live\_progress\_bar) { |
| [3470](#L3470) | $quiz\_styles .= " |
| [3471](#L3471) | #ays-quiz-container-" . $id . " ." . $filling\_type . " { |
| [3472](#L3472) | background-color: " . $color . "; |
| [3473](#L3473) | } |
| [3474](#L3474) | #ays-quiz-container-" . $id . " ." . $filling\_type\_wrap . " { |
| [3475](#L3475) | background-color: " . $text\_color . "; |
| [3476](#L3476) | }"; |
| [3477](#L3477) | } |
| [3478](#L3478) |  |
| [3479](#L3479) | if ($quiz\_image\_height != '' && $quiz\_image\_height > 0) { |
| [3480](#L3480) | $quiz\_styles .= " |
| [3481](#L3481) | /\* Quiz image \*/ |
| [3482](#L3482) | #ays-quiz-container-" . $id . " .ays\_quiz\_image{ |
| [3483](#L3483) | height: " . $quiz\_image\_height . "px; |
| [3484](#L3484) | }"; |
| [3485](#L3485) | } |
| [3486](#L3486) |  |
| [3487](#L3487) | if ($quiz\_bg\_img\_on\_start\_page) { |
| [3488](#L3488) | if($enable\_background\_gradient) { |
| [3489](#L3489) | $ays\_quiz\_bg\_style\_value = "background-image: linear-gradient(". $quiz\_gradient\_direction .", ". $background\_gradient\_color\_1 .", ". $background\_gradient\_color\_2 .");"; |
| [3490](#L3490) | }else { |
| [3491](#L3491) | $ays\_quiz\_bg\_style\_value = "background-image: unset"; |
| [3492](#L3492) | } |
| [3493](#L3493) |  |
| [3494](#L3494) | $quiz\_styles .= " |
| [3495](#L3495) | div#ays-quiz-container-" . $id . ".ays\_quiz\_hide\_bg\_on\_start\_page { |
| [3496](#L3496) | " . $ays\_quiz\_bg\_style\_value . "; |
| [3497](#L3497) | }"; |
| [3498](#L3498) | } |
| [3499](#L3499) |  |
| [3500](#L3500) | $quiz\_styles .= " |
| [3501](#L3501) | #ays-quiz-container-" . $id . " .ays-progress-value { |
| [3502](#L3502) | color: " . $text\_color . "; |
| [3503](#L3503) | text-align: center; |
| [3504](#L3504) | } |
| [3505](#L3505) | #ays-quiz-container-" . $id . " .ays-progress-bar { |
| [3506](#L3506) | background-color: " . $color . "; |
| [3507](#L3507) | } |
| [3508](#L3508) | #ays-quiz-container-" . $id . " .ays-question-counter .ays-live-bar-wrap { |
| [3509](#L3509) | direction:ltr !important; |
| [3510](#L3510) | } |
| [3511](#L3511) | #ays-quiz-container-" . $id . " .ays-live-bar-fill{ |
| [3512](#L3512) | color: " . $text\_color . "; |
| [3513](#L3513) | border-bottom: 2px solid " . $this->hex2rgba($text\_color, '0.8') . "; |
| [3514](#L3514) | text-shadow: 0px 0px 5px " . $bg\_color . "; |
| [3515](#L3515) | } |
| [3516](#L3516) | #ays-quiz-container-" . $id . " .ays-live-bar-fill.ays-live-fourth, |
| [3517](#L3517) | #ays-quiz-container-" . $id . " .ays-live-bar-fill.ays-live-third, |
| [3518](#L3518) | #ays-quiz-container-" . $id . " .ays-live-bar-fill.ays-live-second { |
| [3519](#L3519) | text-shadow: unset; |
| [3520](#L3520) | } |
| [3521](#L3521) | #ays-quiz-container-" . $id . " .ays-live-bar-percent{ |
| [3522](#L3522) | display:none; |
| [3523](#L3523) | } |
| [3524](#L3524) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays\_average { |
| [3525](#L3525) | text-align: center; |
| [3526](#L3526) | } |
| [3527](#L3527) |  |
| [3528](#L3528) | /\* Music, Sound \*/ |
| [3529](#L3529) | #ays-quiz-container-" . $id . " .ays\_music\_sound { |
| [3530](#L3530) | color:" . $this->hex2rgba($text\_color) . "; |
| [3531](#L3531) | } |
| [3532](#L3532) |  |
| [3533](#L3533) | /\* Dropdown questions scroll bar \*/ |
| [3534](#L3534) | #ays-quiz-container-" . $id . " blockquote { |
| [3535](#L3535) | border-left-color: " . $text\_color . " !important; |
| [3536](#L3536) | } |
| [3537](#L3537) |  |
| [3538](#L3538) | /\* Quiz Password \*/ |
| [3539](#L3539) | #ays-quiz-container-" . $id . " .ays-start-page > input[id^='ays\_quiz\_password\_val\_'], |
| [3540](#L3540) | #ays-quiz-container-" . $id . " .ays-quiz-password-toggle-visibility-box { |
| [3541](#L3541) | width: ". $quiz\_password\_width\_css ."; |
| [3542](#L3542) | } |
| [3543](#L3543) |  |
| [3544](#L3544) |  |
| [3545](#L3545) | /\* Question hint \*/ |
| [3546](#L3546) | #ays-quiz-container-" . $id . " .ays\_question\_hint\_container .ays\_question\_hint\_text { |
| [3547](#L3547) | background-color:" . $bg\_color . "; |
| [3548](#L3548) | box-shadow: 0 0 15px 3px " . $this->hex2rgba($box\_shadow\_color, '0.6') . "; |
| [3549](#L3549) | max-width: 270px; |
| [3550](#L3550) | } |
| [3551](#L3551) |  |
| [3552](#L3552) | #ays-quiz-container-" . $id . " .ays\_question\_hint\_container .ays\_question\_hint\_text p { |
| [3553](#L3553) | max-width: unset; |
| [3554](#L3554) | } |
| [3555](#L3555) |  |
| [3556](#L3556) | #ays-quiz-container-" . $id . " .ays\_questions\_hint\_max\_width\_class { |
| [3557](#L3557) | max-width: 80%; |
| [3558](#L3558) | } |
| [3559](#L3559) |  |
| [3560](#L3560) | /\* Information form \*/ |
| [3561](#L3561) | #ays-quiz-container-" . $id . " .ays-form-title{ |
| [3562](#L3562) | color:" . $this->hex2rgba($text\_color) . "; |
| [3563](#L3563) | } |
| [3564](#L3564) |  |
| [3565](#L3565) | /\* Quiz timer \*/ |
| [3566](#L3566) | #ays-quiz-container-" . $id . " div.ays-quiz-redirection-timer, |
| [3567](#L3567) | #ays-quiz-container-" . $id . " div.ays-quiz-timer{ |
| [3568](#L3568) | color: " . $text\_color . "; |
| [3569](#L3569) | text-align: center; |
| [3570](#L3570) | } |
| [3571](#L3571) |  |
| [3572](#L3572) | #ays-quiz-container-" . $id . " div.ays-quiz-timer.ays-quiz-message-before-timer:before { |
| [3573](#L3573) | font-weight: 500; |
| [3574](#L3574) | } |
| [3575](#L3575) |  |
| [3576](#L3576) | /\* Quiz title / transformation \*/ |
| [3577](#L3577) | #ays-quiz-container-" . $id . " .ays-fs-title{ |
| [3578](#L3578) | text-transform: " . $quiz\_title\_transformation . "; |
| [3579](#L3579) | font-size: " . $quiz\_title\_font\_size . "px; |
| [3580](#L3580) | text-align: center;"; |
| [3581](#L3581) |  |
| [3582](#L3582) | if($quiz\_enable\_title\_text\_shadow){ |
| [3583](#L3583) | $quiz\_styles .= " |
| [3584](#L3584) | text-shadow: " . $title\_text\_shadow\_offsets . " " . $quiz\_title\_text\_shadow\_color . ";"; |
| [3585](#L3585) | }else{ |
| [3586](#L3586) | $quiz\_styles .= " |
| [3587](#L3587) | text-shadow: none;"; |
| [3588](#L3588) | } |
| [3589](#L3589) |  |
| [3590](#L3590) | $quiz\_styles .= " |
| [3591](#L3591) | } |
| [3592](#L3592) |  |
| [3593](#L3593) | /\* Quiz buttons \*/ |
| [3594](#L3594) | #ays-quiz-container-" . $id . " .ays\_arrow { |
| [3595](#L3595) | color:". $buttons\_text\_color ."!important; |
| [3596](#L3596) | } |
| [3597](#L3597) | #ays-quiz-container-" . $id . " input#ays-submit, |
| [3598](#L3598) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button, |
| [3599](#L3599) | div#ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button.ays\_restart\_button, |
| [3600](#L3600) | #ays-quiz-container-" . $id . " + .ays-quiz-category-selective-main-container .ays-quiz-category-selective-restart-bttn, |
| [3601](#L3601) | #ays-quiz-container-" . $id . " .ays-quiz-category-selective-submit-bttn { |
| [3602](#L3602) | background: none; |
| [3603](#L3603) | background-color: " . $color . "; |
| [3604](#L3604) | color:" . $buttons\_text\_color . "; |
| [3605](#L3605) | font-size: " . $buttons\_font\_size . "; |
| [3606](#L3606) | padding: " . $buttons\_top\_bottom\_padding . " " . $buttons\_left\_right\_padding . "; |
| [3607](#L3607) | border-radius: " . $buttons\_border\_radius . "; |
| [3608](#L3608) | height: auto; |
| [3609](#L3609) | letter-spacing: 0; |
| [3610](#L3610) | box-shadow: unset; |
| [3611](#L3611) | } |
| [3612](#L3612) | #ays-quiz-container-" . $id . " input#ays-submit, |
| [3613](#L3613) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " input.action-button, |
| [3614](#L3614) | #ays-quiz-container-" . $id . " + .ays-quiz-category-selective-main-container .ays-quiz-category-selective-restart-bttn, |
| [3615](#L3615) | #ays-quiz-container-" . $id . " .ays-quiz-category-selective-submit-bttn { |
| [3616](#L3616) | " . $buttons\_width\_html . " |
| [3617](#L3617) | } |
| [3618](#L3618) |  |
| [3619](#L3619) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button.ays\_check\_answer { |
| [3620](#L3620) | padding: 5px 10px; |
| [3621](#L3621) | font-size: " . $buttons\_font\_size . " !important; |
| [3622](#L3622) | } |
| [3623](#L3623) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button.ays\_restart\_button { |
| [3624](#L3624) | white-space: nowrap; |
| [3625](#L3625) | padding: 5px 10px; |
| [3626](#L3626) | white-space: normal; |
| [3627](#L3627) | } |
| [3628](#L3628) | #ays-quiz-container-" . $id . " input#ays-submit:hover, |
| [3629](#L3629) | #ays-quiz-container-" . $id . " input#ays-submit:focus, |
| [3630](#L3630) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button:hover, |
| [3631](#L3631) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button:focus, |
| [3632](#L3632) | #ays-quiz-container-" . $id . " + .ays-quiz-category-selective-main-container .ays-quiz-category-selective-restart-bttn:hover, |
| [3633](#L3633) | #ays-quiz-container-" . $id . " .ays-quiz-category-selective-submit-bttn:hover { |
| [3634](#L3634) | background: none; |
| [3635](#L3635) | box-shadow: 0 0 0 2px $buttons\_text\_color; |
| [3636](#L3636) | background-color: " . $color . "; |
| [3637](#L3637) | } |
| [3638](#L3638) | #ays-quiz-container-" . $id . " .ays\_restart\_button { |
| [3639](#L3639) | color: " . $buttons\_text\_color . "; |
| [3640](#L3640) | } |
| [3641](#L3641) |  |
| [3642](#L3642) | #ays-quiz-container-" . $id . " .ays\_restart\_button\_p, |
| [3643](#L3643) | #ays-quiz-container-" . $id . " .ays\_buttons\_div { |
| [3644](#L3644) | justify-content: " . $buttons\_position . "; |
| [3645](#L3645) | }"; |
| [3646](#L3646) |  |
| [3647](#L3647) | if($buttons\_position == "flex-start"){ |
| [3648](#L3648) | $quiz\_styles .= " |
| [3649](#L3649) | #ays-quiz-container-" . $id . " .action-button.start\_button{ |
| [3650](#L3650) | float: left; |
| [3651](#L3651) | clear: both; |
| [3652](#L3652) | }"; |
| [3653](#L3653) | }elseif ($buttons\_position == "flex-end") { |
| [3654](#L3654) | $quiz\_styles .= " |
| [3655](#L3655) | #ays-quiz-container-" . $id . " .action-button.start\_button{ |
| [3656](#L3656) | float: right; |
| [3657](#L3657) | clear: both; |
| [3658](#L3658) | }"; |
| [3659](#L3659) | } |
| [3660](#L3660) |  |
| [3661](#L3661) | $quiz\_styles .= " |
| [3662](#L3662) |  |
| [3663](#L3663) | #ays-quiz-container-" . $id . " .ays\_finish.action-button{ |
| [3664](#L3664) | margin: 10px 5px; |
| [3665](#L3665) | } |
| [3666](#L3666) |  |
| [3667](#L3667) | #ays-quiz-container-" . $id . " .ays-share-btn.ays-share-btn-branded { |
| [3668](#L3668) | color: #fff; |
| [3669](#L3669) | display: inline-block; |
| [3670](#L3670) | } |
| [3671](#L3671) |  |
| [3672](#L3672) | #ays-quiz-container-" . $id . " .ays\_quiz\_results .ays-field.checked\_answer\_div.correct\_div input:checked+label { |
| [3673](#L3673) | background-color: transparent; |
| [3674](#L3674) | } |
| [3675](#L3675) |  |
| [3676](#L3676) | /\* Question answers \*/ |
| [3677](#L3677) | #ays-quiz-container-".$id." .ays-field {"; |
| [3678](#L3678) |  |
| [3679](#L3679) | if($answers\_border){ |
| [3680](#L3680) | $quiz\_styles .= " |
| [3681](#L3681) | border-color: " . $answers\_border\_color . "; |
| [3682](#L3682) | border-style: " . $answers\_border\_style . "; |
| [3683](#L3683) | border-width: " . $answers\_border\_width . "px;"; |
| [3684](#L3684) | }else{ |
| [3685](#L3685) | $quiz\_styles .= " |
| [3686](#L3686) | border-color: transparent; |
| [3687](#L3687) | border-style: none; |
| [3688](#L3688) | border-width: 0;"; |
| [3689](#L3689) | } |
| [3690](#L3690) |  |
| [3691](#L3691) | if($answers\_box\_shadow){ |
| [3692](#L3692) | $quiz\_styles .= " |
| [3693](#L3693) | box-shadow: " . $answer\_box\_shadow\_offsets . " 1px " . $answers\_box\_shadow\_color . ";"; |
| [3694](#L3694) | }else{ |
| [3695](#L3695) | $quiz\_styles .= " |
| [3696](#L3696) | box-shadow: none;"; |
| [3697](#L3697) | } |
| [3698](#L3698) |  |
| [3699](#L3699) | $quiz\_styles .= " |
| [3700](#L3700) | } |
| [3701](#L3701) |  |
| [3702](#L3702) | /\* Answer maximum length of a text field \*/ |
| [3703](#L3703) | #ays-quiz-container-" . $id . " .ays\_quiz\_question\_text\_message{ |
| [3704](#L3704) | color: " . $text\_color . "; |
| [3705](#L3705) | text-align: left; |
| [3706](#L3706) | font-size: 12px; |
| [3707](#L3707) | } |
| [3708](#L3708) |  |
| [3709](#L3709) | div#ays-quiz-container-" . $id . " div.ays\_quiz\_question\_text\_error\_message { |
| [3710](#L3710) | color: #ff0000; |
| [3711](#L3711) | } |
| [3712](#L3712) | "; |
| [3713](#L3713) |  |
| [3714](#L3714) | if (! $disable\_hover\_effect) { |
| [3715](#L3715) | $quiz\_styles .= " |
| [3716](#L3716) | #ays-quiz-container-" . $id . " .ays-quiz-answers .ays-field:hover{ |
| [3717](#L3717) | opacity: 1; |
| [3718](#L3718) | }"; |
| [3719](#L3719) | } else{ |
| [3720](#L3720) | $quiz\_styles .= " |
| [3721](#L3721) | #ays-quiz-container-" . $id . " .ays-quiz-answers .ays-field:hover, |
| [3722](#L3722) | #ays-quiz-container-" . $id . " .ays-quiz-answers .ays-field{ |
| [3723](#L3723) | opacity: 1; |
| [3724](#L3724) | } |
| [3725](#L3725) |  |
| [3726](#L3726) | #ays-quiz-container-" . $id . ".ays\_quiz\_elegant\_light .ays-quiz-answers .ays-field:hover, |
| [3727](#L3727) | #ays-quiz-container-" . $id . ".ays\_quiz\_elegant\_light .ays-quiz-answers .ays-field, |
| [3728](#L3728) | #ays-quiz-container-" . $id . ".ays\_quiz\_elegant\_dark .ays-quiz-answers .ays-field:hover, |
| [3729](#L3729) | #ays-quiz-container-" . $id . ".ays\_quiz\_elegant\_dark .ays-quiz-answers .ays-field{ |
| [3730](#L3730) | opacity: 0.6; |
| [3731](#L3731) | }"; |
| [3732](#L3732) | } |
| [3733](#L3733) |  |
| [3734](#L3734) | $quiz\_styles .= " |
| [3735](#L3735) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-field { |
| [3736](#L3736) | margin-bottom: " . ($answers\_margin) . "px; |
| [3737](#L3737) | } |
| [3738](#L3738) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-field.ays\_grid\_view\_item { |
| [3739](#L3739) | width: calc(50% - " . ($answers\_margin / 2) . "px); |
| [3740](#L3740) | } |
| [3741](#L3741) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-field.ays\_grid\_view\_item:nth-child(odd) { |
| [3742](#L3742) | margin-right: " . ($answers\_margin / 2) . "px; |
| [3743](#L3743) | } |
| [3744](#L3744) |  |
| [3745](#L3745) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-field input:checked+label:before { |
| [3746](#L3746) | border-color: " . $color . "; |
| [3747](#L3747) | background: " . $color . "; |
| [3748](#L3748) | background-clip: content-box; |
| [3749](#L3749) | } |
| [3750](#L3750) | #ays-quiz-container-" . $id . " .ays-quiz-answers div.ays-text-right-answer { |
| [3751](#L3751) | color: " . $text\_color . "; |
| [3752](#L3752) | } |
| [3753](#L3753) |  |
| [3754](#L3754) | /\* Questions answer image \*/ |
| [3755](#L3755) | #ays-quiz-container-" . $id . " .ays-answer-image { |
| [3756](#L3756) | width:" . (isset($options['answers\_view']) && ($options['answers\_view'] == "grid") ? "90%" : "50%") . "; |
| [3757](#L3757) | } |
| [3758](#L3758) |  |
| [3759](#L3759) | /\* Questions answer right/wrong icons \*/ |
| [3760](#L3760) | "; |
| [3761](#L3761) | if($ans\_right\_wrong\_icon == 'default'){ |
| [3762](#L3762) | $quiz\_styles .= "#ays-quiz-container-" . $id . " .ays-field input~label.answered.correct:after{ |
| [3763](#L3763) | content: url('".AYS\_QUIZ\_PUBLIC\_URL."/images/correct.png');          } |
| [3764](#L3764) | #ays-quiz-container-" . $id . " .ays-field input~label.answered.wrong:after{ |
| [3765](#L3765) | content: url('".AYS\_QUIZ\_PUBLIC\_URL."/images/wrong.png'); |
| [3766](#L3766) | }"; |
| [3767](#L3767) | } elseif( $ans\_right\_wrong\_icon == "none" ){ |
| [3768](#L3768) | $quiz\_styles .= "#ays-quiz-container-" . $id . " .ays-field input~label.answered.correct:after{ |
| [3769](#L3769) | content: '';          } |
| [3770](#L3770) | #ays-quiz-container-" . $id . " .ays-field input~label.answered.wrong:after{ |
| [3771](#L3771) | content: ''; |
| [3772](#L3772) | }"; |
| [3773](#L3773) | } else{ |
| [3774](#L3774) | $quiz\_styles .= "#ays-quiz-container-" . $id . " .ays-field input~label.answered.correct:after{ |
| [3775](#L3775) | content: url('".AYS\_QUIZ\_PUBLIC\_URL."/images/correct-".$ans\_right\_wrong\_icon.".png'); |
| [3776](#L3776) | } |
| [3777](#L3777) | #ays-quiz-container-" . $id . " .ays-field input~label.answered.wrong:after{ |
| [3778](#L3778) | content: url('".AYS\_QUIZ\_PUBLIC\_URL."/images/wrong-".$ans\_right\_wrong\_icon.".png'); |
| [3779](#L3779) | }"; |
| [3780](#L3780) |  |
| [3781](#L3781) | if ( $ans\_right\_wrong\_icon == 'style-9' ) { |
| [3782](#L3782) | $quiz\_styles .= "#ays-quiz-container-" . $id . " .ays-field input+label.answered:after{ |
| [3783](#L3783) | width: unset; |
| [3784](#L3784) | height: unset; |
| [3785](#L3785) | }"; |
| [3786](#L3786) | } |
| [3787](#L3787) | } |
| [3788](#L3788) |  |
| [3789](#L3789) | $quiz\_styles .= " |
| [3790](#L3790) | /\* Dropdown questions \*/ |
| [3791](#L3791) | #ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .ays-field .select2-container--default .select2-selection--single { |
| [3792](#L3792) | border-bottom: 2px solid " . $color . "; |
| [3793](#L3793) | background-color: " . $color . "; |
| [3794](#L3794) | } |
| [3795](#L3795) |  |
| [3796](#L3796) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_placeholder, |
| [3797](#L3797) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_rendered, |
| [3798](#L3798) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_arrow { |
| [3799](#L3799) | color: " . $this->ays\_color\_inverse( $text\_color ) . "; |
| [3800](#L3800) | } |
| [3801](#L3801) |  |
| [3802](#L3802) | #ays-quiz-container-" . $id . " .select2-container--default .select2-search--dropdown .select2-search\_\_field:focus, |
| [3803](#L3803) | #ays-quiz-container-" . $id . " .select2-container--default .select2-search--dropdown .select2-search\_\_field { |
| [3804](#L3804) | outline: unset; |
| [3805](#L3805) | padding: 0.75rem; |
| [3806](#L3806) | } |
| [3807](#L3807) |  |
| [3808](#L3808) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_rendered, |
| [3809](#L3809) | #ays-quiz-container-" . $id . " .select2-container--default .select2-results\_\_option--highlighted[aria-selected] { |
| [3810](#L3810) | background-color: " . $color . "; |
| [3811](#L3811) | } |
| [3812](#L3812) |  |
| [3813](#L3813) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default, |
| [3814](#L3814) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .selection, |
| [3815](#L3815) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .dropdown-wrapper, |
| [3816](#L3816) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_rendered, |
| [3817](#L3817) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_rendered .select2-selection\_\_placeholder, |
| [3818](#L3818) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_arrow, |
| [3819](#L3819) | #ays-quiz-container-" . $id . " .ays-field .select2-container--default .select2-selection--single .select2-selection\_\_arrow b[role='presentation'] { |
| [3820](#L3820) | font-size: 16px !important; |
| [3821](#L3821) | } |
| [3822](#L3822) |  |
| [3823](#L3823) | #ays-quiz-container-" . $id . " .select2-container--default .select2-results\_\_option { |
| [3824](#L3824) | padding: 6px; |
| [3825](#L3825) | } |
| [3826](#L3826) |  |
| [3827](#L3827) | /\* Dropdown questions scroll bar \*/ |
| [3828](#L3828) | #ays-quiz-container-" . $id . " .select2-results\_\_options::-webkit-scrollbar { |
| [3829](#L3829) | width: 7px; |
| [3830](#L3830) | } |
| [3831](#L3831) | #ays-quiz-container-" . $id . " .select2-results\_\_options::-webkit-scrollbar-track { |
| [3832](#L3832) | background-color: " . $this->hex2rgba($bg\_color, '0.35') . "; |
| [3833](#L3833) | } |
| [3834](#L3834) | #ays-quiz-container-" . $id . " .select2-results\_\_options::-webkit-scrollbar-thumb { |
| [3835](#L3835) | transition: .3s ease-in-out; |
| [3836](#L3836) | background-color: " . $this->hex2rgba($text\_color, '0.55') . "; |
| [3837](#L3837) | } |
| [3838](#L3838) | #ays-quiz-container-" . $id . " .select2-results\_\_options::-webkit-scrollbar-thumb:hover { |
| [3839](#L3839) | transition: .3s ease-in-out; |
| [3840](#L3840) | background-color: " . $this->hex2rgba($text\_color, '0.85') . "; |
| [3841](#L3841) | } |
| [3842](#L3842) |  |
| [3843](#L3843) | /\* Audio / Video \*/ |
| [3844](#L3844) | #ays-quiz-container-" . $id . " .mejs-container .mejs-time{ |
| [3845](#L3845) | box-sizing: unset; |
| [3846](#L3846) | } |
| [3847](#L3847) | #ays-quiz-container-" . $id . " .mejs-container .mejs-time-rail { |
| [3848](#L3848) | padding-top: 15px; |
| [3849](#L3849) | } |
| [3850](#L3850) |  |
| [3851](#L3851) | #ays-quiz-container-" . $id . " .mejs-container .mejs-mediaelement video { |
| [3852](#L3852) | margin: 0; |
| [3853](#L3853) | } |
| [3854](#L3854) |  |
| [3855](#L3855) | /\* Limitation \*/ |
| [3856](#L3856) | #ays-quiz-container-" . $id . " .ays-quiz-limitation-count-of-takers { |
| [3857](#L3857) | padding: 50px; |
| [3858](#L3858) | } |
| [3859](#L3859) |  |
| [3860](#L3860) | #ays-quiz-container-" . $id . " div.ays-quiz-results-toggle-block span.ays-show-res-toggle.ays-res-toggle-show, |
| [3861](#L3861) | #ays-quiz-container-" . $id . " div.ays-quiz-results-toggle-block span.ays-show-res-toggle.ays-res-toggle-hide{ |
| [3862](#L3862) | color: ". $text\_color ."; |
| [3863](#L3863) | } |
| [3864](#L3864) |  |
| [3865](#L3865) | #ays-quiz-container-" . $id . " div.ays-quiz-results-toggle-block input:checked + label.ays\_switch\_toggle { |
| [3866](#L3866) | border: 1px solid ". $text\_color ."; |
| [3867](#L3867) | } |
| [3868](#L3868) |  |
| [3869](#L3869) | #ays-quiz-container-" . $id . " div.ays-quiz-results-toggle-block input:checked + label.ays\_switch\_toggle { |
| [3870](#L3870) | border: 1px solid ". $text\_color ."; |
| [3871](#L3871) | } |
| [3872](#L3872) |  |
| [3873](#L3873) | #ays-quiz-container-" . $id . " div.ays-quiz-results-toggle-block input:checked + label.ays\_switch\_toggle:after{ |
| [3874](#L3874) | background: ". $text\_color ."; |
| [3875](#L3875) | } |
| [3876](#L3876) |  |
| [3877](#L3877) | #ays-quiz-container-" . $id . ".ays\_quiz\_elegant\_dark div.ays-quiz-results-toggle-block input:checked + label.ays\_switch\_toggle:after, |
| [3878](#L3878) | #ays-quiz-container-" . $id . ".ays\_quiz\_rect\_dark div.ays-quiz-results-toggle-block input:checked + label.ays\_switch\_toggle:after{ |
| [3879](#L3879) | background: #000; |
| [3880](#L3880) | } |
| [3881](#L3881) |  |
| [3882](#L3882) | /\* Hestia theme (Version: 3.0.16) | Start \*/ |
| [3883](#L3883) | #ays-quiz-container-" . $id . " .mejs-container .mejs-inner .mejs-controls .mejs-button > button:hover, |
| [3884](#L3884) | #ays-quiz-container-" . $id . " .mejs-container .mejs-inner .mejs-controls .mejs-button > button { |
| [3885](#L3885) | box-shadow: unset; |
| [3886](#L3886) | background-color: transparent; |
| [3887](#L3887) | } |
| [3888](#L3888) | #ays-quiz-container-" . $id . " .mejs-container .mejs-inner .mejs-controls .mejs-button > button { |
| [3889](#L3889) | margin: 10px 6px; |
| [3890](#L3890) | } |
| [3891](#L3891) | /\* Hestia theme (Version: 3.0.16) | End \*/ |
| [3892](#L3892) |  |
| [3893](#L3893) | /\* Go theme (Version: 1.4.3) | Start \*/ |
| [3894](#L3894) | #ays-quiz-container-" . $id . " label[for^='ays-answer']:before, |
| [3895](#L3895) | #ays-quiz-container-" . $id . " label[for^='ays-answer']:before { |
| [3896](#L3896) | -webkit-mask-image: unset; |
| [3897](#L3897) | mask-image: unset; |
| [3898](#L3898) | } |
| [3899](#L3899) |  |
| [3900](#L3900) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_light .ays-field input:checked+label.answered.correct:before, |
| [3901](#L3901) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_dark .ays-field input:checked+label.answered.correct:before { |
| [3902](#L3902) | background-color: ". $color ." !important; |
| [3903](#L3903) | } |
| [3904](#L3904) | /\* Go theme (Version: 1.4.3) | End \*/ |
| [3905](#L3905) |  |
| [3906](#L3906) | #ays-quiz-container-" . $id . " .ays\_quiz\_results fieldset.ays\_fieldset .ays\_quiz\_question .wp-video { |
| [3907](#L3907) | width: 100% !important; |
| [3908](#L3908) | max-width: 100%; |
| [3909](#L3909) | } |
| [3910](#L3910) |  |
| [3911](#L3911) | /\* Classic Dark / Classic Light \*/ |
| [3912](#L3912) | /\* Dropdown questions right/wrong styles \*/ |
| [3913](#L3913) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_dark .correct\_div, |
| [3914](#L3914) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_light .correct\_div{ |
| [3915](#L3915) | border-color:green !important; |
| [3916](#L3916) | opacity: 1 !important; |
| [3917](#L3917) | background-color: rgba(39,174,96,0.4) !important; |
| [3918](#L3918) | } |
| [3919](#L3919) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_dark .correct\_div .selected-field, |
| [3920](#L3920) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_light .correct\_div .selected-field { |
| [3921](#L3921) | padding: 0px 10px 0px 10px; |
| [3922](#L3922) | color: green !important; |
| [3923](#L3923) | } |
| [3924](#L3924) |  |
| [3925](#L3925) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_dark .wrong\_div, |
| [3926](#L3926) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_light .wrong\_div{ |
| [3927](#L3927) | border-color:red !important; |
| [3928](#L3928) | opacity: 1 !important; |
| [3929](#L3929) | background-color: rgba(243,134,129,0.4) !important; |
| [3930](#L3930) | } |
| [3931](#L3931) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_dark .ays-field, |
| [3932](#L3932) | #ays-quiz-container-" . $id . ".ays\_quiz\_classic\_light .ays-field { |
| [3933](#L3933) | text-align: left; |
| [3934](#L3934) | /\*margin-bottom: 10px;\*/ |
| [3935](#L3935) | padding: 0; |
| [3936](#L3936) | transition: .3s ease-in-out; |
| [3937](#L3937) | } |
| [3938](#L3938) |  |
| [3939](#L3939) | #ays-quiz-container-" . $id . " .ays-quiz-close-full-screen { |
| [3940](#L3940) | fill: $text\_color; |
| [3941](#L3941) | } |
| [3942](#L3942) |  |
| [3943](#L3943) | #ays-quiz-container-" . $id . " .ays-quiz-open-full-screen { |
| [3944](#L3944) | fill: $text\_color; |
| [3945](#L3945) | } |
| [3946](#L3946) |  |
| [3947](#L3947) | #ays-quiz-container-" . $id . " .ays\_quiz\_login\_form p{ |
| [3948](#L3948) | color: $text\_color; |
| [3949](#L3949) | } |
| [3950](#L3950) |  |
| [3951](#L3951) | @media screen and (max-width: 768px){ |
| [3952](#L3952) | #ays-quiz-container-" . $id . "{ |
| [3953](#L3953) | max-width: $mobile\_max\_width; |
| [3954](#L3954) | } |
| [3955](#L3955) |  |
| [3956](#L3956) | #ays-quiz-container-" . $id . " .ays\_quiz\_question p { |
| [3957](#L3957) | font-size: ".$question\_mobile\_font\_size."px; |
| [3958](#L3958) | } |
| [3959](#L3959) |  |
| [3960](#L3960) | #ays-quiz-container-" . $id . " .select2-container, |
| [3961](#L3961) | #ays-quiz-container-" . $id . " .ays-field \* { |
| [3962](#L3962) | font-size: ".$answers\_mobile\_font\_size."px !important; |
| [3963](#L3963) | } |
| [3964](#L3964) |  |
| [3965](#L3965) | div#ays-quiz-container-" . $id . " input#ays-submit, |
| [3966](#L3966) | div#ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button, |
| [3967](#L3967) | div#ays-quiz-container-" . $id . " #ays\_finish\_quiz\_" . $id . " .action-button.ays\_restart\_button, |
| [3968](#L3968) | #ays-quiz-container-" . $id . " + .ays-quiz-category-selective-main-container .ays-quiz-category-selective-restart-bttn, |
| [3969](#L3969) | #ays-quiz-container-" . $id . " .ays-quiz-category-selective-submit-bttn { |
| [3970](#L3970) | font-size: ".$buttons\_mobile\_font\_size."px; |
| [3971](#L3971) | } |
| [3972](#L3972) |  |
| [3973](#L3973) | /\* Quiz title / mobile font size \*/ |
| [3974](#L3974) | div#ays-quiz-container-" . $id . " .ays-fs-title { |
| [3975](#L3975) | font-size: " . $quiz\_title\_mobile\_font\_size . "px; |
| [3976](#L3976) | } |
| [3977](#L3977) |  |
| [3978](#L3978) | /\* Question explanation / mobile font size \*/ |
| [3979](#L3979) | #ays-quiz-container-" . $id . " .ays\_questtion\_explanation p { |
| [3980](#L3980) | font-size:" . $quest\_explanation\_mobile\_font\_size . "px; |
| [3981](#L3981) | } |
| [3982](#L3982) |  |
| [3983](#L3983) | /\* Wrong answers / mobile font size \*/ |
| [3984](#L3984) | #ays-quiz-container-" . $id . " .wrong\_answer\_text p { |
| [3985](#L3985) | font-size:" . $wrong\_answers\_mobile\_font\_size . "px; |
| [3986](#L3986) | } |
| [3987](#L3987) |  |
| [3988](#L3988) | /\* Right answers / mobile font size \*/ |
| [3989](#L3989) | #ays-quiz-container-" . $id . " .right\_answer\_text p { |
| [3990](#L3990) | font-size:" . $right\_answers\_mobile\_font\_size . "px; |
| [3991](#L3991) | } |
| [3992](#L3992) |  |
| [3993](#L3993) | /\* Note text / mobile font size \*/ |
| [3994](#L3994) | #ays-quiz-container-" . $id . " .ays-quiz-question-note-message-box p { |
| [3995](#L3995) | font-size:" . $note\_text\_mobile\_font\_size . "px; |
| [3996](#L3996) | } |
| [3997](#L3997) | } |
| [3998](#L3998) | /\* Custom css styles \*/ |
| [3999](#L3999) | " . stripslashes( htmlspecialchars\_decode( $options['custom\_css'] ) ) . " |
| [4000](#L4000) |  |
| [4001](#L4001) | /\* RTL direction styles \*/ |
| [4002](#L4002) | " . $rtl\_style . " |
| [4003](#L4003) | </style>"; |
| [4004](#L4004) |  |
| [4005](#L4005) |  |
| [4006](#L4006) |  |
| [4007](#L4007) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [4008](#L4008) |  |
| [4009](#L4009) | /\* |
| [4010](#L4010) | \* Quiz container |
| [4011](#L4011) | \* |
| [4012](#L4012) | \* Generating HTML code |
| [4013](#L4013) | \*/ |
| [4014](#L4014) |  |
| [4015](#L4015) | $quiz\_theme = ""; |
| [4016](#L4016) | $options['quiz\_theme'] = (array\_key\_exists('quiz\_theme', $options)) ? $options['quiz\_theme'] : ''; |
| [4017](#L4017) | switch ($options['quiz\_theme']) { |
| [4018](#L4018) | case 'elegant\_dark': |
| [4019](#L4019) | $quiz\_theme = "ays\_quiz\_elegant\_dark"; |
| [4020](#L4020) | break; |
| [4021](#L4021) | case 'elegant\_light': |
| [4022](#L4022) | $quiz\_theme = "ays\_quiz\_elegant\_light"; |
| [4023](#L4023) | break; |
| [4024](#L4024) | case 'rect\_dark': |
| [4025](#L4025) | $quiz\_theme = "ays\_quiz\_rect\_dark"; |
| [4026](#L4026) | break; |
| [4027](#L4027) | case 'rect\_light': |
| [4028](#L4028) | $quiz\_theme = "ays\_quiz\_rect\_light"; |
| [4029](#L4029) | break; |
| [4030](#L4030) | case 'classic\_dark': |
| [4031](#L4031) | $quiz\_theme = "ays\_quiz\_classic\_dark"; |
| [4032](#L4032) | break; |
| [4033](#L4033) | case 'classic\_light': |
| [4034](#L4034) | $quiz\_theme = "ays\_quiz\_classic\_light"; |
| [4035](#L4035) | break; |
| [4036](#L4036) | } |
| [4037](#L4037) |  |
| [4038](#L4038) | $custom\_class = isset($options['custom\_class']) && $options['custom\_class'] != "" ? $options['custom\_class'] : ""; |
| [4039](#L4039) | $quiz\_gradient = ''; |
| [4040](#L4040) | if($enable\_background\_gradient){ |
| [4041](#L4041) | $quiz\_gradient = " data-bg-gradient='linear-gradient($quiz\_gradient\_direction, $background\_gradient\_color\_1, $background\_gradient\_color\_2)' "; |
| [4042](#L4042) | } |
| [4043](#L4043) |  |
| [4044](#L4044) | // Question Image Zoom |
| [4045](#L4045) | $options['quiz\_enable\_question\_image\_zoom'] = isset($options['quiz\_enable\_question\_image\_zoom']) ? $options['quiz\_enable\_question\_image\_zoom'] : 'off'; |
| [4046](#L4046) | $quiz\_enable\_question\_image\_zoom = (isset($options['quiz\_enable\_question\_image\_zoom']) && $options['quiz\_enable\_question\_image\_zoom'] == "on") ? true : false; |
| [4047](#L4047) |  |
| [4048](#L4048) | // Display Messages before the buttons |
| [4049](#L4049) | $options['quiz\_display\_messages\_before\_buttons'] = isset($options['quiz\_display\_messages\_before\_buttons']) ? esc\_attr($options['quiz\_display\_messages\_before\_buttons']) : 'off'; |
| [4050](#L4050) | $quiz\_display\_messages\_before\_buttons = (isset($options['quiz\_display\_messages\_before\_buttons']) && $options['quiz\_display\_messages\_before\_buttons'] == 'on') ? true : false; |
| [4051](#L4051) |  |
| [4052](#L4052) | // Enable questions ordering by category |
| [4053](#L4053) | $options['enable\_questions\_ordering\_by\_cat'] = isset($options['enable\_questions\_ordering\_by\_cat']) ? $options['enable\_questions\_ordering\_by\_cat'] : 'off'; |
| [4054](#L4054) | $enable\_questions\_ordering\_by\_cat = (isset($options['enable\_questions\_ordering\_by\_cat']) && $options['enable\_questions\_ordering\_by\_cat'] == "on") ? true : false; |
| [4055](#L4055) |  |
| [4056](#L4056) | // Enable questions numbering by category |
| [4057](#L4057) | $options['quiz\_questions\_numbering\_by\_category'] = isset($options['quiz\_questions\_numbering\_by\_category']) ? sanitize\_text\_field($options['quiz\_questions\_numbering\_by\_category']) : 'off'; |
| [4058](#L4058) | $quiz\_questions\_numbering\_by\_category = (isset($options['quiz\_questions\_numbering\_by\_category']) && $options['quiz\_questions\_numbering\_by\_category'] == 'on') ? true : false; |
| [4059](#L4059) |  |
| [4060](#L4060) |  |
| [4061](#L4061) | $options['enable\_full\_screen\_mode'] = isset($options['enable\_full\_screen\_mode']) ? $options['enable\_full\_screen\_mode'] : 'off'; |
| [4062](#L4062) | $enable\_full\_screen\_mode = (isset($options['enable\_full\_screen\_mode']) && $options['enable\_full\_screen\_mode'] == "on") ? true : false; |
| [4063](#L4063) |  |
| [4064](#L4064) | $fullcsreen\_mode = ''; |
| [4065](#L4065) |  |
| [4066](#L4066) | if($enable\_full\_screen\_mode){ |
| [4067](#L4067) | $fullcsreen\_mode = '<div class="ays-quiz-full-screen-wrap"> |
| [4068](#L4068) | <a class="ays-quiz-full-screen-container"> |
| [4069](#L4069) | <svg xmlns="http://www.w3.org/2000/svg" height="24" fill="#fff" viewBox="0 0 24 24" width="24" class="ays-quiz-close-full-screen"> |
| [4070](#L4070) | <path d="M0 0h24v24H0z" fill="none"/> |
| [4071](#L4071) | <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/> |
| [4072](#L4072) | </svg> |
| [4073](#L4073) | <svg xmlns="http://www.w3.org/2000/svg" height="24" fill="#fff" viewBox="0 0 24 24" width="24" class="ays-quiz-open-full-screen"> |
| [4074](#L4074) | <path d="M0 0h24v24H0z" fill="none"/> |
| [4075](#L4075) | <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/> |
| [4076](#L4076) | </svg> |
| [4077](#L4077) | </a> |
| [4078](#L4078) | </div>'; |
| [4079](#L4079) | }else { |
| [4080](#L4080) | $fullcsreen\_mode = ''; |
| [4081](#L4081) | } |
| [4082](#L4082) |  |
| [4083](#L4083) | $quiz\_container\_first\_part = " |
| [4084](#L4084) | <div class='ays-quiz-container ".$quiz\_theme." ".$quiz\_bg\_img\_class." ".$custom\_class."' data-quest-effect='".$quest\_animation."' ".$quiz\_gradient." data-hide-bg-image='".$quiz\_bg\_img\_in\_finish\_page."' id='ays-quiz-container-" . $id . "'> |
| [4085](#L4085) | {$live\_progress\_bar} |
| [4086](#L4086) | {$ays\_quiz\_music\_html} |
| [4087](#L4087) | <div class='ays-questions-container'> |
| [4088](#L4088) | {$fullcsreen\_mode} |
| [4089](#L4089) | $ays\_quiz\_reports |
| [4090](#L4090) | <form action='' method='post' id='ays\_finish\_quiz\_" . $id . "' |
| [4091](#L4091) | class='ays-quiz-form " . $correction\_class . " " . $enable\_questions\_result . " " . $enable\_logged\_users . "' |
| [4092](#L4092) | >"; |
| [4093](#L4093) |  |
| [4094](#L4094) | $quiz\_container\_first\_part .= " |
| [4095](#L4095) | <input type='hidden' value='" . $answer\_view\_class . "' class='answer\_view\_class'> |
| [4096](#L4096) | <input type='hidden' value='" . $enable\_arrows . "' class='ays\_qm\_enable\_arrows'>"; |
| [4097](#L4097) |  |
| [4098](#L4098) | $quiz\_container\_middle\_part = ""; |
| [4099](#L4099) | if($is\_expired){ |
| [4100](#L4100) | $quiz\_container\_middle\_part = $expired\_quiz\_message; |
| [4101](#L4101) | $main\_content\_first\_part = ""; |
| [4102](#L4102) | $main\_content\_last\_part = ""; |
| [4103](#L4103) | } |
| [4104](#L4104) | if($enable\_tackers\_count){ |
| [4105](#L4105) | $quiz\_tackers\_count = $this->get\_quiz\_tackers\_count($id); |
| [4106](#L4106) | if($quiz\_tackers\_count >= $tackers\_count){ |
| [4107](#L4107) | $quiz\_container\_middle\_part = $tackers\_message; |
| [4108](#L4108) | $main\_content\_first\_part = ""; |
| [4109](#L4109) | $main\_content\_last\_part = ""; |
| [4110](#L4110) | } |
| [4111](#L4111) | } |
| [4112](#L4112) | if($limit\_users === true){ |
| [4113](#L4113) | $quiz\_container\_middle\_part = $limit\_users\_html; |
| [4114](#L4114) | $main\_content\_first\_part = ""; |
| [4115](#L4115) | $main\_content\_last\_part = ""; |
| [4116](#L4116) | } |
| [4117](#L4117) | if($user\_massage !== null){ |
| [4118](#L4118) | $quiz\_container\_middle\_part = "<!-- This content is empty -->"; |
| [4119](#L4119) | $main\_content\_first\_part = ""; |
| [4120](#L4120) | $main\_content\_last\_part = ""; |
| [4121](#L4121) | } |
| [4122](#L4122) |  |
| [4123](#L4123) |  |
| [4124](#L4124) | $quiz\_container\_last\_part = $quiz\_content\_script; |
| [4125](#L4125) |  |
| [4126](#L4126) | if( $this->get\_prop( 'is\_training' ) === true ){ |
| [4127](#L4127) | $quiz\_container\_last\_part .= "<input type='hidden' name='is\_training' value='true' />"; |
| [4128](#L4128) | } |
| [4129](#L4129) |  |
| [4130](#L4130) | $cat\_selective\_start\_page = ""; |
| [4131](#L4131) | $cat\_selective\_restart\_bttn = ""; |
| [4132](#L4132) | if( $this->get\_prop( 'category\_selective' ) === true ){ |
| [4133](#L4133) | if (isset($\_COOKIE['ays\_quiz\_selected\_categories-'.$id])) { |
| [4134](#L4134) | $selected\_questions = apply\_filters( 'ays\_qm\_front\_end\_category\_selective\_get\_questions', array(), $id ); |
| [4135](#L4135) | $arr\_questions = $selected\_questions; |
| [4136](#L4136) | $cat\_selective\_restart\_bttn = apply\_filters( 'ays\_qm\_front\_end\_category\_selective\_restart\_button', "", $id ); |
| [4137](#L4137) | } else { |
| [4138](#L4138) | $title = $this->get\_prop( 'title' ) != null ? sanitize\_text\_field($this->get\_prop( 'title' )) : ''; |
| [4139](#L4139) | $category\_selective\_quiz\_data = array( |
| [4140](#L4140) | 'title' => $title, |
| [4141](#L4141) | 'quiz\_id' => $id, |
| [4142](#L4142) | ); |
| [4143](#L4143) | $cat\_selective\_start\_page = " |
| [4144](#L4144) | <div class='ays-quiz-wrap'> |
| [4145](#L4145) | <div class='ays-quiz-container ".$quiz\_theme." ".$quiz\_bg\_img\_class." ".$custom\_class."' |
| [4146](#L4146) | data-quest-effect='".$quest\_animation."' ".$quiz\_gradient." |
| [4147](#L4147) | data-hide-bg-image='".$quiz\_bg\_img\_in\_finish\_page."' |
| [4148](#L4148) | id='ays-quiz-container-" . $id . "' |
| [4149](#L4149) | style='padding:30px 0'> |
| [4150](#L4150) | ".apply\_filters( 'ays\_qm\_front\_end\_category\_selective\_start\_page', "", $category\_selective\_quiz\_data )." |
| [4151](#L4151) | </div> |
| [4152](#L4152) | </div>"; |
| [4153](#L4153) | } |
| [4154](#L4154) | } |
| [4155](#L4155) |  |
| [4156](#L4156) | $quiz\_container\_last\_part .= " |
| [4157](#L4157) | <input type='hidden' name='quiz\_id' value='" . $id . "'/> |
| [4158](#L4158) | <input type='hidden' name='start\_date' class='ays-start-date'/> |
| [4159](#L4159) | </form>"; |
| [4160](#L4160) | if($user\_massage !== null){ |
| [4161](#L4161) | $quiz\_container\_last\_part .= $user\_massage; |
| [4162](#L4162) | } |
| [4163](#L4163) |  |
| [4164](#L4164) | $quiz\_container\_last\_part .= "</div> |
| [4165](#L4165) | </div> |
| [4166](#L4166) | {$cat\_selective\_restart\_bttn}"; |
| [4167](#L4167) |  |
| [4168](#L4168) |  |
| [4169](#L4169) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [4170](#L4170) |  |
| [4171](#L4171) | /\* |
| [4172](#L4172) | \* Generating Quiz parts array |
| [4173](#L4173) | \*/ |
| [4174](#L4174) |  |
| [4175](#L4175) | $quiz\_parts = array( |
| [4176](#L4176) | "container\_first\_part" => $quiz\_container\_first\_part, |
| [4177](#L4177) | "main\_content\_first\_part" => $main\_content\_first\_part, |
| [4178](#L4178) | "main\_content\_middle\_part" => $quiz\_container\_middle\_part, |
| [4179](#L4179) | "main\_content\_last\_part" => $main\_content\_last\_part, |
| [4180](#L4180) | "quiz\_styles" => $quiz\_styles, |
| [4181](#L4181) | "quiz\_additional\_styles" => "", |
| [4182](#L4182) | "container\_last\_part" => $quiz\_container\_last\_part, |
| [4183](#L4183) | "cat\_selective\_start\_page" => $cat\_selective\_start\_page, |
| [4184](#L4184) | ); |
| [4185](#L4185) |  |
| [4186](#L4186) | $quizOptions = array( |
| [4187](#L4187) | 'buttons' => $buttons, |
| [4188](#L4188) | 'correction' => $enable\_correction, |
| [4189](#L4189) | 'randomizeAnswers' => $randomize\_answers, |
| [4190](#L4190) | 'questionImageWidth' => $question\_image\_width, |
| [4191](#L4191) | 'questionImageHeight' => $question\_image\_height, |
| [4192](#L4192) | 'questionImageSizing' => $question\_image\_sizing, |
| [4193](#L4193) | 'questionsCounter' => $questions\_counter, |
| [4194](#L4194) | 'informationForm' => $options['information\_form'], |
| [4195](#L4195) | 'answersViewClass' => $answer\_view\_class, |
| [4196](#L4196) | 'quizTheme' => $options['quiz\_theme'], |
| [4197](#L4197) | 'rtlDirection' => $rtl\_direction, |
| [4198](#L4198) | 'showQuestionCategory' => $show\_question\_category, |
| [4199](#L4199) | 'showQuestionCategoryDescription' => $quiz\_enable\_question\_category\_description, |
| [4200](#L4200) | 'questionsHint' => $questions\_hint\_arr, |
| [4201](#L4201) | 'disable\_hover\_effect' => $disable\_hover\_effect, |
| [4202](#L4202) | 'show\_answers\_numbering' => $show\_answers\_numbering, |
| [4203](#L4203) | 'show\_questions\_numbering' => $show\_questions\_numbering, |
| [4204](#L4204) | 'show\_questions\_explanation' => $show\_questions\_explanation, |
| [4205](#L4205) | 'answers\_rw\_texts' => $answers\_rw\_texts, |
| [4206](#L4206) | 'quiz\_waiting\_time' => $quiz\_waiting\_time, |
| [4207](#L4207) | 'quiz\_enable\_lazy\_loading' => $quiz\_enable\_lazy\_loading, |
| [4208](#L4208) | 'quiz\_enable\_question\_image\_zoom' => $quiz\_enable\_question\_image\_zoom, |
| [4209](#L4209) | 'quiz\_display\_messages\_before\_buttons' => $quiz\_display\_messages\_before\_buttons, |
| [4210](#L4210) | 'enable\_questions\_ordering\_by\_cat' => $enable\_questions\_ordering\_by\_cat, |
| [4211](#L4211) | 'quiz\_questions\_numbering\_by\_category' => $quiz\_questions\_numbering\_by\_category, |
| [4212](#L4212) | 'question\_bank\_cats' => $question\_bank\_cats, |
| [4213](#L4213) | ); |
| [4214](#L4214) |  |
| [4215](#L4215) | $ays\_quiz = (object)array( |
| [4216](#L4216) | "quizID" => $id, |
| [4217](#L4217) | "quizOptions" => $quizOptions, |
| [4218](#L4218) | "questions" => $arr\_questions, |
| [4219](#L4219) | "questionsCount" => $questions\_count, |
| [4220](#L4220) | "quizParts" => $quiz\_parts, |
| [4221](#L4221) | "quizColors" => array( |
| [4222](#L4222) | "Color" => $color, |
| [4223](#L4223) | "textColor" => $text\_color, |
| [4224](#L4224) | "bgColor" => $bg\_color, |
| [4225](#L4225) | "boxShadowColor" => $box\_shadow\_color, |
| [4226](#L4226) | "borderColor" => $quiz\_border\_color |
| [4227](#L4227) | ) |
| [4228](#L4228) | ); |
| [4229](#L4229) |  |
| [4230](#L4230) | return $ays\_quiz; |
| [4231](#L4231) | } |
| [4232](#L4232) |  |
| [4233](#L4233) | public function ays\_generate\_quiz($quiz){ |
| [4234](#L4234) |  |
| [4235](#L4235) | $quiz\_id = $quiz->quizID; |
| [4236](#L4236) | $arr\_questions = $quiz->questions; |
| [4237](#L4237) | $questions\_count = $quiz->questionsCount; |
| [4238](#L4238) | $options = $quiz->quizOptions; |
| [4239](#L4239) |  |
| [4240](#L4240) | if (isset($quiz->quizParts['cat\_selective\_start\_page']) && $quiz->quizParts['cat\_selective\_start\_page'] != "") { |
| [4241](#L4241) | return $quiz->quizParts['cat\_selective\_start\_page'].$quiz->quizParts['quiz\_styles']; |
| [4242](#L4242) | } |
| [4243](#L4243) |  |
| [4244](#L4244) | // Disable answer hover |
| [4245](#L4245) | $options['disable\_hover\_effect'] = isset($options['disable\_hover\_effect']) ? $options['disable\_hover\_effect'] : 'off'; |
| [4246](#L4246) | $disable\_hover\_effect = (isset($options['disable\_hover\_effect']) && $options['disable\_hover\_effect'] == "on") ? true : false; |
| [4247](#L4247) |  |
| [4248](#L4248) | $questions = ""; |
| [4249](#L4249) | $questions = $this->get\_quiz\_questions($arr\_questions, $quiz\_id, $options, false); |
| [4250](#L4250) |  |
| [4251](#L4251) | if($quiz->quizParts['main\_content\_middle\_part'] == ""){ |
| [4252](#L4252) | $quiz->quizParts['main\_content\_middle\_part'] = $questions; |
| [4253](#L4253) | } |
| [4254](#L4254) | $additional\_css = " |
| [4255](#L4255) | <style> |
| [4256](#L4256) | #ays-quiz-container-" . $quiz\_id . " p { |
| [4257](#L4257) | margin: 0.625em; |
| [4258](#L4258) | } |
| [4259](#L4259) |  |
| [4260](#L4260) | #ays-quiz-container-" . $quiz\_id . " .ays-field.checked\_answer\_div input:checked+label { |
| [4261](#L4261) | background-color: " . $this->hex2rgba($quiz->quizColors['Color'], '0.6') . "; |
| [4262](#L4262) | } |
| [4263](#L4263) |  |
| [4264](#L4264) | #ays-quiz-container-" . $quiz\_id . ".ays\_quiz\_classic\_light  .enable\_correction .ays-field.checked\_answer\_div input:checked+label, |
| [4265](#L4265) | #ays-quiz-container-" . $quiz\_id . ".ays\_quiz\_classic\_dark  .enable\_correction .ays-field.checked\_answer\_div input:checked+label { |
| [4266](#L4266) | background-color: transparent; |
| [4267](#L4267) | }"; |
| [4268](#L4268) | if (! $disable\_hover\_effect) { |
| [4269](#L4269) | $additional\_css .= " |
| [4270](#L4270) | #ays-quiz-container-" . $quiz\_id . " .ays-field.checked\_answer\_div input:checked+label:hover { |
| [4271](#L4271) | background-color: " . $this->hex2rgba($quiz->quizColors['Color'], '0.8') . "; |
| [4272](#L4272) | } |
| [4273](#L4273) |  |
| [4274](#L4274) | #ays-quiz-container-" . $quiz\_id . " .ays-field:hover label{ |
| [4275](#L4275) | background: " . $this->hex2rgba($quiz->quizColors['Color'], '0.8') . "; |
| [4276](#L4276) | /\* border-radius: 4px; \*/ |
| [4277](#L4277) | color: #fff; |
| [4278](#L4278) | transition: all .3s; |
| [4279](#L4279) | }"; |
| [4280](#L4280) | } |
| [4281](#L4281) |  |
| [4282](#L4282) | $additional\_css .= " |
| [4283](#L4283) | #ays-quiz-container-" . $quiz\_id . " #ays\_finish\_quiz\_" . $quiz\_id . " .action-button:hover, |
| [4284](#L4284) | #ays-quiz-container-" . $quiz\_id . " #ays\_finish\_quiz\_" . $quiz\_id . " .action-button:focus, |
| [4285](#L4285) | #ays-quiz-container-" . $quiz\_id . " + .ays-quiz-category-selective-main-container .ays-quiz-category-selective-restart-bttn:hover, |
| [4286](#L4286) | #ays-quiz-container-" . $quiz\_id . " .ays-quiz-category-selective-submit-bttn:focus { |
| [4287](#L4287) | box-shadow: 0 0 0 2px white, 0 0 0 3px " . $quiz->quizColors['Color'] . "; |
| [4288](#L4288) | background: " . $quiz->quizColors['Color'] . "; |
| [4289](#L4289) | } |
| [4290](#L4290) | </style>"; |
| [4291](#L4291) |  |
| [4292](#L4292) | $quiz->quizParts['quiz\_additional\_styles'] = $additional\_css; |
| [4293](#L4293) |  |
| [4294](#L4294) | $container = implode("", $quiz->quizParts); |
| [4295](#L4295) |  |
| [4296](#L4296) | return $container; |
| [4297](#L4297) | } |
| [4298](#L4298) |  |
| [4299](#L4299) | public function get\_quiz\_by\_id($id){ |
| [4300](#L4300) | global $wpdb; |
| [4301](#L4301) |  |
| [4302](#L4302) | $sql = "SELECT \* |
| [4303](#L4303) | FROM {$wpdb->prefix}aysquiz\_quizes |
| [4304](#L4304) | WHERE id=" . $id; |
| [4305](#L4305) |  |
| [4306](#L4306) | $quiz = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4307](#L4307) |  |
| [4308](#L4308) | return $quiz; |
| [4309](#L4309) | } |
| [4310](#L4310) |  |
| [4311](#L4311) | public static function get\_quiz\_category\_by\_id($id){ |
| [4312](#L4312) | global $wpdb; |
| [4313](#L4313) |  |
| [4314](#L4314) | $sql = "SELECT \* |
| [4315](#L4315) | FROM {$wpdb->prefix}aysquiz\_quizcategories |
| [4316](#L4316) | WHERE id=" . $id; |
| [4317](#L4317) |  |
| [4318](#L4318) | $category = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4319](#L4319) |  |
| [4320](#L4320) | return $category; |
| [4321](#L4321) | } |
| [4322](#L4322) |  |
| [4323](#L4323) | public static function get\_question\_category\_by\_id($id){ |
| [4324](#L4324) | global $wpdb; |
| [4325](#L4325) |  |
| [4326](#L4326) | $sql = "SELECT \* |
| [4327](#L4327) | FROM {$wpdb->prefix}aysquiz\_categories |
| [4328](#L4328) | WHERE id=" . $id; |
| [4329](#L4329) |  |
| [4330](#L4330) | $category = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4331](#L4331) |  |
| [4332](#L4332) | return $category; |
| [4333](#L4333) | } |
| [4334](#L4334) |  |
| [4335](#L4335) | public function get\_quiz\_results\_count\_by\_id($id){ |
| [4336](#L4336) | global $wpdb; |
| [4337](#L4337) |  |
| [4338](#L4338) | $sql = "SELECT COUNT(\*) AS res\_count |
| [4339](#L4339) | FROM {$wpdb->prefix}aysquiz\_reports |
| [4340](#L4340) | WHERE quiz\_id=" . $id; |
| [4341](#L4341) |  |
| [4342](#L4342) | $quiz = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4343](#L4343) |  |
| [4344](#L4344) | return $quiz; |
| [4345](#L4345) | } |
| [4346](#L4346) |  |
| [4347](#L4347) | public function get\_quiz\_attributes\_by\_id($id){ |
| [4348](#L4348) | global $wpdb; |
| [4349](#L4349) | $quiz\_attrs = isset(json\_decode($this->get\_quiz\_by\_id($id)['options'])->quiz\_attributes) ? json\_decode($this->get\_quiz\_by\_id($id)['options'])->quiz\_attributes : array(); |
| [4350](#L4350) | $quiz\_attributes = implode(',', $quiz\_attrs); |
| [4351](#L4351) | if (!empty($quiz\_attributes)) { |
| [4352](#L4352) | $sql = "SELECT \* FROM {$wpdb->prefix}aysquiz\_attributes WHERE `id` in ($quiz\_attributes)"; |
| [4353](#L4353) | $results = $wpdb->get\_results($sql); |
| [4354](#L4354) | return $results; |
| [4355](#L4355) | } |
| [4356](#L4356) | return array(); |
| [4357](#L4357) |  |
| [4358](#L4358) | } |
| [4359](#L4359) |  |
| [4360](#L4360) | public function get\_quiz\_questions($ids, $quiz\_id, $options, $per\_page){ |
| [4361](#L4361) |  |
| [4362](#L4362) | $container = $this->ays\_questions\_parts($ids, $quiz\_id, $options, $per\_page); |
| [4363](#L4363) | $questions\_container = array(); |
| [4364](#L4364) | foreach($container as $key => $question){ |
| [4365](#L4365) | $answer\_container = ''; |
| [4366](#L4366) | $use\_html = $this->in\_question\_use\_html($question['questionID']); |
| [4367](#L4367) | switch ($question["questionType"]) { |
| [4368](#L4368) | case "select": |
| [4369](#L4369) | $ans\_options = array( |
| [4370](#L4370) | 'correction' => $options['correction'], |
| [4371](#L4371) | 'show\_answers\_numbering' => $options['show\_answers\_numbering'], |
| [4372](#L4372) | ); |
| [4373](#L4373) | $answer\_container .= $this->ays\_dropdown\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4374](#L4374) | break; |
| [4375](#L4375) | case "text": |
| [4376](#L4376) | $question\_max\_length\_array = $this->ays\_quiz\_get\_question\_max\_length\_array($question['questionID']); |
| [4377](#L4377) | $ans\_options = array( |
| [4378](#L4378) | 'correction' => $options['correction'], |
| [4379](#L4379) | 'questionMaxLengthArray' => $question\_max\_length\_array, |
| [4380](#L4380) | 'enable\_case\_sensitive\_text' => $question['enable\_case\_sensitive\_text'], |
| [4381](#L4381) | ); |
| [4382](#L4382) | $answer\_container .= $this->ays\_text\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4383](#L4383) | break; |
| [4384](#L4384) | case "short\_text": |
| [4385](#L4385) | $question\_max\_length\_array = $this->ays\_quiz\_get\_question\_max\_length\_array($question['questionID']); |
| [4386](#L4386) | $ans\_options = array( |
| [4387](#L4387) | 'correction' => $options['correction'], |
| [4388](#L4388) | 'questionMaxLengthArray' => $question\_max\_length\_array, |
| [4389](#L4389) | 'enable\_case\_sensitive\_text' => $question['enable\_case\_sensitive\_text'], |
| [4390](#L4390) | ); |
| [4391](#L4391) | $answer\_container .= $this->ays\_short\_text\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4392](#L4392) | break; |
| [4393](#L4393) | case "number": |
| [4394](#L4394) | $question\_max\_length\_array = $this->ays\_quiz\_get\_question\_max\_length\_array($question['questionID']); |
| [4395](#L4395) | $ans\_options = array( |
| [4396](#L4396) | 'correction' => $options['correction'], |
| [4397](#L4397) | 'questionMaxLengthArray' => $question\_max\_length\_array, |
| [4398](#L4398) | ); |
| [4399](#L4399) | $answer\_container .= $this->ays\_number\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4400](#L4400) | break; |
| [4401](#L4401) | case "date": |
| [4402](#L4402) | $ans\_options = array( |
| [4403](#L4403) | 'correction' => $options['correction'] |
| [4404](#L4404) | ); |
| [4405](#L4405) | $answer\_container .= $this->ays\_date\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4406](#L4406) | break; |
| [4407](#L4407) | case "true\_or\_false": |
| [4408](#L4408) | default: |
| [4409](#L4409) | $ans\_options = array( |
| [4410](#L4410) | 'correction' => $options['correction'], |
| [4411](#L4411) | 'rtlDirection' => $options['rtlDirection'], |
| [4412](#L4412) | 'questionType' => $question["questionType"], |
| [4413](#L4413) | 'answersViewClass' => $options['answersViewClass'], |
| [4414](#L4414) | 'show\_answers\_numbering' => $options['show\_answers\_numbering'], |
| [4415](#L4415) | 'useHTML' => $use\_html, |
| [4416](#L4416) | 'enable\_max\_selection\_number' => $question['enable\_max\_selection\_number'], |
| [4417](#L4417) | 'max\_selection\_number' => $question['max\_selection\_number'], |
| [4418](#L4418) | 'enable\_min\_selection\_number' => $question['enable\_min\_selection\_number'], |
| [4419](#L4419) | 'min\_selection\_number' => $question['min\_selection\_number'], |
| [4420](#L4420) | ); |
| [4421](#L4421) | $answer\_container .= $this->ays\_default\_answer\_html($question['questionID'], $quiz\_id, $question['questionAnswers'], $ans\_options); |
| [4422](#L4422) | break; |
| [4423](#L4423) | } |
| [4424](#L4424) | $question['questionParts']['question\_middle\_part'] = $answer\_container; |
| [4425](#L4425) | $questions\_container[] = implode("", $question['questionParts']); |
| [4426](#L4426) | } |
| [4427](#L4427) | $container = implode("", $questions\_container); |
| [4428](#L4428) | return $container; |
| [4429](#L4429) | } |
| [4430](#L4430) |  |
| [4431](#L4431) | public function ays\_questions\_parts($ids, $quiz\_id, $options, $per\_page){ |
| [4432](#L4432) | global $wpdb; |
| [4433](#L4433) | $total = count($ids); |
| [4434](#L4434) | $container = array(); |
| [4435](#L4435) | $buttons = $options['buttons']; |
| [4436](#L4436) | $enable\_arrows = $buttons['enableArrows']; |
| [4437](#L4437) | $quiz\_arrow\_type = $buttons['quizArrowType']; |
| [4438](#L4438) | $settings\_buttons\_texts = $this->buttons\_texts; |
| [4439](#L4439) | $quiz\_waiting\_time = $options['quiz\_waiting\_time']; |
| [4440](#L4440) | $quiz\_enable\_lazy\_loading = $options['quiz\_enable\_lazy\_loading']; |
| [4441](#L4441) | $quiz\_enable\_question\_image\_zoom = $options['quiz\_enable\_question\_image\_zoom']; |
| [4442](#L4442) | $quiz\_display\_messages\_before\_buttons = $options['quiz\_display\_messages\_before\_buttons']; |
| [4443](#L4443) | $enable\_questions\_ordering\_by\_cat = $options['enable\_questions\_ordering\_by\_cat']; |
| [4444](#L4444) | $quiz\_questions\_numbering\_by\_category = $options['quiz\_questions\_numbering\_by\_category']; |
| [4445](#L4445) | $question\_bank\_cats = $options['question\_bank\_cats']; |
| [4446](#L4446) |  |
| [4447](#L4447) | foreach($ids as $key => $id){ |
| [4448](#L4448) | $current = $key + 1; |
| [4449](#L4449) | if($total == $current){ |
| [4450](#L4450) | $last = true; |
| [4451](#L4451) | }else{ |
| [4452](#L4452) | $last = false; |
| [4453](#L4453) | } |
| [4454](#L4454) | $sql = "SELECT \* FROM {$wpdb->prefix}aysquiz\_questions WHERE id = " . $id; |
| [4455](#L4455) | $question = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4456](#L4456) |  |
| [4457](#L4457) | if (!empty($question)) { |
| [4458](#L4458) | $answers = $this->get\_answers\_with\_question\_id($question["id"]); |
| [4459](#L4459) | $question\_options = (isset($question['options']) && sanitize\_text\_field( $question['options'] ) != '') ? json\_decode( $question['options'], true ) : array(); |
| [4460](#L4460) | $question\_image = ''; |
| [4461](#L4461) | $question\_image\_style = ''; |
| [4462](#L4462) | $question\_category = ''; |
| [4463](#L4463) | $question\_category\_description = ''; |
| [4464](#L4464) | $question\_category\_description\_html = ''; |
| [4465](#L4465) | $show\_question\_category = $options['showQuestionCategory']; |
| [4466](#L4466) | $show\_question\_category\_description = $options['showQuestionCategoryDescription']; |
| [4467](#L4467) | $show\_questions\_explanation = $options['show\_questions\_explanation']; |
| [4468](#L4468) | $show\_answers\_rw\_texts = $options['answers\_rw\_texts']; |
| [4469](#L4469) | if($show\_question\_category){ |
| [4470](#L4470) | $question\_category\_data = self::get\_question\_category\_by\_id($question['category\_id']); |
| [4471](#L4471) | $question\_category = ( isset( $question\_category\_data['title'] ) && $question\_category\_data['title'] != "" ) ? $question\_category\_data['title'] : ""; |
| [4472](#L4472) | $question\_category\_description = ( isset( $question\_category\_data['description'] ) && $question\_category\_data['description'] != "" ) ? $question\_category\_data['description'] : ""; |
| [4473](#L4473) |  |
| [4474](#L4474) | $question\_category = "<p style='margin:0!important;text-align:left;'> |
| [4475](#L4475) | <em style='font-style:italic;font-size:0.8em;'>". \_\_("Category", $this->plugin\_name) .":</em> |
| [4476](#L4476) | <strong style='font-size:0.8em;'>{$question\_category}</strong> |
| [4477](#L4477) | </p>"; |
| [4478](#L4478) |  |
| [4479](#L4479) | if ( $show\_question\_category\_description && $question\_category\_description != "" ) { |
| [4480](#L4480) | $question\_category\_description\_html .= '<div class="ays-quiz-category-description-box">'; |
| [4481](#L4481) | $question\_category\_description\_html .= $this->ays\_autoembed($question\_category\_description); |
| [4482](#L4482) | $question\_category\_description\_html .= '</div>'; |
| [4483](#L4483) |  |
| [4484](#L4484) | $question\_category .= $question\_category\_description\_html; |
| [4485](#L4485) | } |
| [4486](#L4486) | } |
| [4487](#L4487) |  |
| [4488](#L4488) | if ( $question["type"] == 'true\_or\_false' ) { |
| [4489](#L4489) | $question["type"] = 'radio'; |
| [4490](#L4490) | } |
| [4491](#L4491) |  |
| [4492](#L4492) | $question['not\_influence\_to\_score'] = ! isset($question['not\_influence\_to\_score']) ? 'off' : $question['not\_influence\_to\_score']; |
| [4493](#L4493) | $not\_influence\_to\_score = (isset($question['not\_influence\_to\_score']) && $question['not\_influence\_to\_score'] == 'on') ? true : false; |
| [4494](#L4494) |  |
| [4495](#L4495) | // Hide question text on the front-end |
| [4496](#L4496) | $question\_options['quiz\_hide\_question\_text'] = isset($question\_options['quiz\_hide\_question\_text']) ? sanitize\_text\_field( $question\_options['quiz\_hide\_question\_text'] ) : 'off'; |
| [4497](#L4497) | $quiz\_hide\_question\_text = (isset($question\_options['quiz\_hide\_question\_text']) && $question\_options['quiz\_hide\_question\_text'] == 'on') ? true : false; |
| [4498](#L4498) |  |
| [4499](#L4499) | $question\_image\_style = "style='width:{$options['questionImageWidth']};height:{$options['questionImageHeight']};object-fit:{$options['questionImageSizing']};object-position:center center;'"; |
| [4500](#L4500) |  |
| [4501](#L4501) | // Enable maximum selection number |
| [4502](#L4502) | $question\_options['enable\_max\_selection\_number'] = isset($question\_options['enable\_max\_selection\_number']) ? sanitize\_text\_field( $question\_options['enable\_max\_selection\_number'] ) : 'off'; |
| [4503](#L4503) | $enable\_max\_selection\_number = (isset($question\_options['enable\_max\_selection\_number']) && sanitize\_text\_field( $question\_options['enable\_max\_selection\_number'] ) == 'on') ? true : false; |
| [4504](#L4504) |  |
| [4505](#L4505) | // Max value |
| [4506](#L4506) | $max\_selection\_number = ( isset($question\_options['max\_selection\_number']) && $question\_options['max\_selection\_number'] != '' ) ? intval( sanitize\_text\_field( $question\_options['max\_selection\_number'] ) ) : ''; |
| [4507](#L4507) |  |
| [4508](#L4508) | // Enable minimum selection number |
| [4509](#L4509) | $question\_options['enable\_min\_selection\_number'] = isset($question\_options['enable\_min\_selection\_number']) ? sanitize\_text\_field( $question\_options['enable\_min\_selection\_number'] ) : 'off'; |
| [4510](#L4510) | $enable\_min\_selection\_number = (isset($question\_options['enable\_min\_selection\_number']) && sanitize\_text\_field( $question\_options['enable\_min\_selection\_number'] ) == 'on') ? true : false; |
| [4511](#L4511) |  |
| [4512](#L4512) | // Min value |
| [4513](#L4513) | $min\_selection\_number = ( isset($question\_options['min\_selection\_number']) && $question\_options['min\_selection\_number'] != '' ) ? intval( sanitize\_text\_field( $question\_options['min\_selection\_number'] ) ) : ''; |
| [4514](#L4514) |  |
| [4515](#L4515) | $max\_selection\_number\_class = ''; |
| [4516](#L4516) | $min\_selection\_number\_class = ''; |
| [4517](#L4517) | if ( $question["type"] == 'checkbox' ) { |
| [4518](#L4518) |  |
| [4519](#L4519) | if ( $enable\_max\_selection\_number && ! empty( $max\_selection\_number ) && $max\_selection\_number != 0 ) { |
| [4520](#L4520) | $max\_selection\_number\_class = 'enable\_max\_selection\_number'; |
| [4521](#L4521) | } |
| [4522](#L4522) | if ( $enable\_min\_selection\_number && ! empty( $min\_selection\_number ) && $min\_selection\_number != 0 ) { |
| [4523](#L4523) | $min\_selection\_number\_class = 'enable\_min\_selection\_number'; |
| [4524](#L4524) | } |
| [4525](#L4525) | } |
| [4526](#L4526) |  |
| [4527](#L4527) | $enable\_case\_sensitive\_text = false; |
| [4528](#L4528) | if ( $question["type"] == 'text' || $question["type"] == 'short\_text' ) { |
| [4529](#L4529) |  |
| [4530](#L4530) | // Enable case sensitive text |
| [4531](#L4531) | $question\_options['enable\_case\_sensitive\_text'] = isset($question\_options['enable\_case\_sensitive\_text']) ? sanitize\_text\_field( $question\_options['enable\_case\_sensitive\_text'] ) : 'off'; |
| [4532](#L4532) | $enable\_case\_sensitive\_text = (isset($question\_options['enable\_case\_sensitive\_text']) && sanitize\_text\_field( $question\_options['enable\_case\_sensitive\_text'] ) == 'on') ? true : false; |
| [4533](#L4533) | } |
| [4534](#L4534) |  |
| [4535](#L4535) | // Enable strip slashes for questions |
| [4536](#L4536) | $question\_options['quiz\_enable\_question\_stripslashes'] = isset($question\_options['quiz\_enable\_question\_stripslashes']) ? sanitize\_text\_field( $question\_options['quiz\_enable\_question\_stripslashes'] ) : 'off'; |
| [4537](#L4537) | $quiz\_enable\_question\_stripslashes = (isset($question\_options['quiz\_enable\_question\_stripslashes']) && $question\_options['quiz\_enable\_question\_stripslashes'] == 'on') ? true : false; |
| [4538](#L4538) |  |
| [4539](#L4539) | // if( isset($question['question\_image']) && $question['question\_image'] != "" && !is\_null($question['question\_image']) ){ |
| [4540](#L4540) | //     if ( !(filter\_var($question['question\_image'], FILTER\_VALIDATE\_URL) && wp\_http\_validate\_url($question['question\_image'])) ) { |
| [4541](#L4541) | //         // Invalid URL, handle accordingly |
| [4542](#L4542) | //         $question['question\_image'] = null; |
| [4543](#L4543) | //     } |
| [4544](#L4544) | // } |
| [4545](#L4545) |  |
| [4546](#L4546) | // if( isset($question['question\_image']) && $question['question\_image'] != "" && !is\_null($question['question\_image']) ){ |
| [4547](#L4547) | //     $check\_if\_current\_image\_exists = Quiz\_Maker\_Admin::ays\_quiz\_check\_if\_current\_image\_exists($question['question\_image']); |
| [4548](#L4548) |  |
| [4549](#L4549) | //     if( !$check\_if\_current\_image\_exists ){ |
| [4550](#L4550) | //         $question['question\_image'] = null; |
| [4551](#L4551) | //     } |
| [4552](#L4552) | // } |
| [4553](#L4553) |  |
| [4554](#L4554) | if ($question['question\_image'] != NULL && $question['question\_image'] != "") { |
| [4555](#L4555) | $question\_image\_alt\_text = $this->ays\_quiz\_get\_image\_id\_by\_url($question['question\_image']); |
| [4556](#L4556) |  |
| [4557](#L4557) | $question\_image\_lazy\_loading\_attr = ""; |
| [4558](#L4558) | if ( $quiz\_enable\_lazy\_loading ) { |
| [4559](#L4559) | if( $key != 0 ){ |
| [4560](#L4560) | $question\_image\_lazy\_loading\_attr = 'loading="lazy"'; |
| [4561](#L4561) | } |
| [4562](#L4562) | } |
| [4563](#L4563) |  |
| [4564](#L4564) | $quiz\_question\_image\_zoom\_class = ""; |
| [4565](#L4565) | $quiz\_question\_full\_size\_url\_attr = ""; |
| [4566](#L4566) | if ( $quiz\_enable\_question\_image\_zoom ) { |
| [4567](#L4567) | $quiz\_question\_image\_zoom\_class = "ays-quiz-question-image-zoom"; |
| [4568](#L4568) | $quiz\_question\_full\_size\_url = $this->ays\_quiz\_get\_image\_full\_size\_url\_by\_url($question['question\_image']); |
| [4569](#L4569) |  |
| [4570](#L4570) | if ( $quiz\_question\_full\_size\_url && $quiz\_question\_full\_size\_url != "" ) { |
| [4571](#L4571) | $quiz\_question\_full\_size\_url\_attr = ' data-ays-src="'. esc\_url( $quiz\_question\_full\_size\_url ) .'" '; |
| [4572](#L4572) | } elseif ( $quiz\_question\_full\_size\_url == "" ) { |
| [4573](#L4573) | $quiz\_question\_full\_size\_url\_attr = ' data-ays-src="'. esc\_url( $question['question\_image'] ) .'" '; |
| [4574](#L4574) | } |
| [4575](#L4575) | } |
| [4576](#L4576) |  |
| [4577](#L4577) | $question\_image .= '<div class="ays-image-question-img">'; |
| [4578](#L4578) | $question\_image .= '<img src="' . esc\_url($question['question\_image']) . '" '. $quiz\_question\_full\_size\_url\_attr .' '. $question\_image\_lazy\_loading\_attr .' alt="'. $question\_image\_alt\_text .'" ' . $question\_image\_style . ' class="'. $quiz\_question\_image\_zoom\_class .'">'; |
| [4579](#L4579) | $question\_image .= '</div>'; |
| [4580](#L4580) | } |
| [4581](#L4581) | $answer\_view\_class = ""; |
| [4582](#L4582) | $question\_hint = ''; |
| [4583](#L4583) | $user\_explanation = ""; |
| [4584](#L4584) | if ($options['randomizeAnswers']) { |
| [4585](#L4585) | shuffle($answers); |
| [4586](#L4586) | } |
| [4587](#L4587) | if (isset($question['question\_hint']) && strlen($question['question\_hint']) !== 0) { |
| [4588](#L4588) | $question\_hint\_arr = $options['questionsHint']; |
| [4589](#L4589) | $questions\_hint\_type = $options['questionsHint']['questionsHintType']; |
| [4590](#L4590) | $question\_text\_value = $options['questionsHint']['questionsHintValue']; |
| [4591](#L4591) | $questions\_hint\_button\_value = $options['questionsHint']['questionsHintButtonValue']; |
| [4592](#L4592) |  |
| [4593](#L4593) | $questions\_hint\_content = "<i class='ays\_fa ays\_fa\_info\_circle ays\_question\_hint' aria-hidden='true'></i>"; |
| [4594](#L4594) | $questions\_hint\_max\_width\_class = ''; |
| [4595](#L4595) | switch ( $questions\_hint\_type ) { |
| [4596](#L4596) | case 'text': |
| [4597](#L4597) | if ($question\_text\_value != '') { |
| [4598](#L4598) | $questions\_hint\_content = '<p class="ays\_question\_hint">'. $question\_text\_value .'</p>'; |
| [4599](#L4599) | } |
| [4600](#L4600) | break; |
| [4601](#L4601) | case 'button': |
| [4602](#L4602) | if ($questions\_hint\_button\_value != '') { |
| [4603](#L4603) | $questions\_hint\_max\_width\_class = 'ays\_questions\_hint\_max\_width\_class'; |
| [4604](#L4604) |  |
| [4605](#L4605) | $questions\_hint\_content = '<button class="ays\_question\_hint action-button ays\_question\_hint\_button\_type">'. $questions\_hint\_button\_value .'</button>'; |
| [4606](#L4606) | } |
| [4607](#L4607) | break; |
| [4608](#L4608) | case 'hide': |
| [4609](#L4609) | $questions\_hint\_content = ''; |
| [4610](#L4610) | break; |
| [4611](#L4611) | case 'default': |
| [4612](#L4612) | default: |
| [4613](#L4613) | $questions\_hint\_content = "<i class='ays\_fa ays\_fa\_info\_circle ays\_question\_hint' aria-hidden='true'></i>"; |
| [4614](#L4614) | break; |
| [4615](#L4615) | } |
| [4616](#L4616) |  |
| [4617](#L4617) | $question\_hint = $this->ays\_autoembed($question['question\_hint']); |
| [4618](#L4618) | $question\_hint = " |
| [4619](#L4619) | <div class='ays\_question\_hint\_container ". $questions\_hint\_max\_width\_class ."'> |
| [4620](#L4620) | ".$questions\_hint\_content." |
| [4621](#L4621) | <span class='ays\_question\_hint\_text'>" . $question\_hint . "</span> |
| [4622](#L4622) | </div>"; |
| [4623](#L4623) |  |
| [4624](#L4624) | if ( $questions\_hint\_type == "hide" ) { |
| [4625](#L4625) | $question\_hint = ""; |
| [4626](#L4626) | } |
| [4627](#L4627) | } |
| [4628](#L4628) | if(isset($question['user\_explanation']) && $question['user\_explanation'] == 'on'){ |
| [4629](#L4629) | $user\_explanation = "<div class='ays\_user\_explanation'> |
| [4630](#L4630) | <textarea placeholder='".\_\_('You can enter your answer explanation',$this->plugin\_name)."' class='ays\_user\_explanation\_text' name='user-answer-explanation[{$id}]'></textarea> |
| [4631](#L4631) | </div>"; |
| [4632](#L4632) | } |
| [4633](#L4633) |  |
| [4634](#L4634) | if($question['wrong\_answer\_text'] == ''){ |
| [4635](#L4635) | $wrong\_answer\_class = 'ays\_do\_not\_show'; |
| [4636](#L4636) | }else{ |
| [4637](#L4637) | $wrong\_answer\_class = ''; |
| [4638](#L4638) | } |
| [4639](#L4639) | if($question['right\_answer\_text'] == ''){ |
| [4640](#L4640) | $right\_answer\_class = 'ays\_do\_not\_show'; |
| [4641](#L4641) | }else{ |
| [4642](#L4642) | $right\_answer\_class = ''; |
| [4643](#L4643) | } |
| [4644](#L4644) |  |
| [4645](#L4645) | // Note text |
| [4646](#L4646) | $quiz\_question\_note\_message = ( isset( $question\_options['quiz\_question\_note\_message']) && $question\_options['quiz\_question\_note\_message'] != '' ) ? stripslashes( $question\_options['quiz\_question\_note\_message'] ) : ''; |
| [4647](#L4647) |  |
| [4648](#L4648) | $quiz\_question\_note\_message\_html = ''; |
| [4649](#L4649) | if ( $quiz\_question\_note\_message != '' ) { |
| [4650](#L4650) | $quiz\_question\_note\_message\_html .= '<div class="ays-quiz-question-note-message-box">'; |
| [4651](#L4651) | $quiz\_question\_note\_message\_html .= $this->ays\_autoembed($quiz\_question\_note\_message); |
| [4652](#L4652) | $quiz\_question\_note\_message\_html .= '</div>'; |
| [4653](#L4653) | } |
| [4654](#L4654) |  |
| [4655](#L4655) | $quiz\_waiting\_time\_html = ''; |
| [4656](#L4656) | // Waiting time |
| [4657](#L4657) | if ( $quiz\_waiting\_time ) { |
| [4658](#L4658) | $quiz\_waiting\_time\_html .= '<div class="ays-quiz-question-waiting-time-box">'; |
| [4659](#L4659) | $quiz\_waiting\_time\_html .= '</div>'; |
| [4660](#L4660) | } |
| [4661](#L4661) |  |
| [4662](#L4662) | if($options['questionsCounter']){ |
| [4663](#L4663) | $questions\_counter = "<p class='ays-question-counter animated'>{$current} / {$total}</p>"; |
| [4664](#L4664) | }else{ |
| [4665](#L4665) | $questions\_counter = ""; |
| [4666](#L4666) | } |
| [4667](#L4667) |  |
| [4668](#L4668) | $early\_finish = ""; |
| [4669](#L4669) | if($buttons['earlyButton']){ |
| [4670](#L4670) | $early\_finish = "<i class='" . ($enable\_arrows ? '' : 'ays\_display\_none'). " ays\_fa ays\_fa\_flag\_checkered ays\_early\_finish action-button ays\_arrow'></i><input type='button' class='" . ($enable\_arrows ? 'ays\_display\_none' : '') . " ays\_early\_finish action-button' value='" . $settings\_buttons\_texts['finishButton'] . "'/>"; |
| [4671](#L4671) | } |
| [4672](#L4672) |  |
| [4673](#L4673) | $clear\_answer = ""; |
| [4674](#L4674) | if($buttons['clearAnswerButton']){ |
| [4675](#L4675) | $clear\_answer = "<i class='" . ($enable\_arrows ? '' : 'ays\_display\_none'). " ays\_fa ays\_fa\_eraser ays\_clear\_answer action-button ays\_arrow'></i><input type='button' class='" . ($enable\_arrows ? 'ays\_display\_none' : '') . " ays\_clear\_answer action-button' value='" . $settings\_buttons\_texts['clearButton'] . "'/>"; |
| [4676](#L4676) | } |
| [4677](#L4677) | if($options['correction']){ |
| [4678](#L4678) | $clear\_answer = ""; |
| [4679](#L4679) | } |
| [4680](#L4680) |  |
| [4681](#L4681) | switch( $quiz\_arrow\_type ){ |
| [4682](#L4682) | case 'default': |
| [4683](#L4683) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_right"; |
| [4684](#L4684) | $quiz\_arrow\_type\_class\_left = "ays\_fa\_arrow\_left"; |
| [4685](#L4685) | break; |
| [4686](#L4686) | case 'long\_arrow': |
| [4687](#L4687) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_long\_arrow\_right"; |
| [4688](#L4688) | $quiz\_arrow\_type\_class\_left = "ays\_fa\_long\_arrow\_left"; |
| [4689](#L4689) | break; |
| [4690](#L4690) | case 'arrow\_circle\_o': |
| [4691](#L4691) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_circle\_o\_right"; |
| [4692](#L4692) | $quiz\_arrow\_type\_class\_left = "ays\_fa\_arrow\_circle\_o\_left"; |
| [4693](#L4693) | break; |
| [4694](#L4694) | case 'arrow\_circle': |
| [4695](#L4695) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_circle\_right"; |
| [4696](#L4696) | $quiz\_arrow\_type\_class\_left = "ays\_fa\_arrow\_circle\_left"; |
| [4697](#L4697) | break; |
| [4698](#L4698) | default: |
| [4699](#L4699) | $quiz\_arrow\_type\_class\_right = "ays\_fa\_arrow\_right"; |
| [4700](#L4700) | $quiz\_arrow\_type\_class\_left = "ays\_fa\_arrow\_left"; |
| [4701](#L4701) | break; |
| [4702](#L4702) | } |
| [4703](#L4703) |  |
| [4704](#L4704) | if ($last) { |
| [4705](#L4705) | switch($options['informationForm']){ |
| [4706](#L4706) | case "disable": |
| [4707](#L4707) | $input = "<i class='" . $buttons['nextArrow'] . " ays\_fa ays\_fa\_flag\_checkered ays\_finish action-button ays\_arrow ays\_next\_arrow'></i><input type='submit' name='ays\_finish\_quiz' class=' " . $buttons['nextButton'] . " ays\_next ays\_finish action-button' value='" . $settings\_buttons\_texts['seeResultButton'] . "'/>"; |
| [4708](#L4708) | break; |
| [4709](#L4709) | case "before": |
| [4710](#L4710) | $input = "<i class='" . $buttons['nextArrow'] . " ays\_fa ays\_fa\_flag\_checkered ays\_finish action-button ays\_arrow ays\_next\_arrow'></i><input type='submit' name='ays\_finish\_quiz' class=' " . $buttons['nextButton'] . " ays\_next ays\_finish action-button' value='" . $settings\_buttons\_texts['seeResultButton'] . "'/>"; |
| [4711](#L4711) | break; |
| [4712](#L4712) | case "after": |
| [4713](#L4713) | $input = "<i class='" . $buttons['nextArrow'] . " ays\_fa ". $quiz\_arrow\_type\_class\_right ." ays\_finish action-button ays\_arrow ays\_next\_arrow'></i><input type='button' class=' " . $buttons['nextButton'] . " ays\_next action-button' value='" . $settings\_buttons\_texts['finishButton'] . "' />"; |
| [4714](#L4714) | break; |
| [4715](#L4715) | default: |
| [4716](#L4716) | $input = "<i class='" . $buttons['nextArrow'] . " ays\_fa ays\_fa\_flag\_checkered ays\_finish action-button ays\_arrow ays\_next\_arrow'></i><input type='submit' name='ays\_finish\_quiz' class=' " . $buttons['nextButton'] . " ays\_next ays\_finish action-button' value='" . $settings\_buttons\_texts['seeResultButton'] . "'/>"; |
| [4717](#L4717) | break; |
| [4718](#L4718) | } |
| [4719](#L4719) | $buttons\_div = "<div class='ays\_buttons\_div'> |
| [4720](#L4720) | {$clear\_answer} |
| [4721](#L4721) | <i class=\"ays\_fa ". $quiz\_arrow\_type\_class\_left ." ays\_previous action-button ays\_arrow " . $buttons['prevArrow'] . "\"></i> |
| [4722](#L4722) | <input type='button' class='ays\_previous action-button " . $buttons['prevButton'] . "'  value='".$settings\_buttons\_texts['previousButton']."' /> |
| [4723](#L4723) | {$input} |
| [4724](#L4724) | </div>"; |
| [4725](#L4725) | }else{ |
| [4726](#L4726) | $buttons\_div = "<div class='ays\_buttons\_div'> |
| [4727](#L4727) | {$clear\_answer} |
| [4728](#L4728) | <i class=\"ays\_fa ". $quiz\_arrow\_type\_class\_left ." ays\_previous action-button ays\_arrow " . $buttons['prevArrow'] . "\"></i> |
| [4729](#L4729) | <input type='button' class='ays\_previous action-button " . $buttons['prevButton'] . "' value='".$settings\_buttons\_texts['previousButton']."' /> |
| [4730](#L4730) | " . $early\_finish . " |
| [4731](#L4731) | <i class=\"ays\_fa ". $quiz\_arrow\_type\_class\_right ." ays\_next action-button ays\_arrow ays\_next\_arrow " . $buttons['nextArrow'] . "\"></i> |
| [4732](#L4732) | <input type='button' class='ays\_next action-button " . $buttons['nextButton'] . "' value='" . $settings\_buttons\_texts['nextButton'] . "' /> |
| [4733](#L4733) | </div>"; |
| [4734](#L4734) | } |
| [4735](#L4735) |  |
| [4736](#L4736) | $additional\_css = ""; |
| [4737](#L4737) | $answer\_view\_class = $options['answersViewClass']; |
| [4738](#L4738) |  |
| [4739](#L4739) | $show\_questions\_numbering = $options['show\_questions\_numbering']; |
| [4740](#L4740) | $question\_numering\_type = $this->ays\_question\_numbering( $show\_questions\_numbering, $total ); |
| [4741](#L4741) |  |
| [4742](#L4742) | $question\_title = $question['question']; |
| [4743](#L4743) |  |
| [4744](#L4744) | if ( $quiz\_enable\_question\_stripslashes ) { |
| [4745](#L4745) | $question\_title = stripslashes( $question\_title ); |
| [4746](#L4746) | } |
| [4747](#L4747) |  |
| [4748](#L4748) | $question\_numering\_value = ""; |
| [4749](#L4749) | if( isset( $question\_numering\_type[$key] ) && $question\_numering\_type[$key] != '' ){ |
| [4750](#L4750) |  |
| [4751](#L4751) | if( $enable\_questions\_ordering\_by\_cat && $quiz\_questions\_numbering\_by\_category ){ |
| [4752](#L4752) | if( !empty( $question\_bank\_cats ) ){ |
| [4753](#L4753) | $question\_bank\_cat\_key = null; |
| [4754](#L4754) | foreach ($question\_bank\_cats as $question\_bank\_cat\_id => $question\_bank\_cat\_arr) { |
| [4755](#L4755) | $question\_bank\_cat\_key\_index = array\_search($id, $question\_bank\_cat\_arr); |
| [4756](#L4756) | if( is\_numeric( $question\_bank\_cat\_key\_index ) && !is\_bool( $question\_bank\_cat\_key\_index ) ){ |
| [4757](#L4757) | $question\_bank\_cat\_key = $question\_bank\_cat\_key\_index; |
| [4758](#L4758) | break; |
| [4759](#L4759) | } |
| [4760](#L4760) | } |
| [4761](#L4761) | if( !is\_null( $question\_bank\_cat\_key ) ){ |
| [4762](#L4762) | $question\_numering\_value = $question\_numering\_type[$question\_bank\_cat\_key] . " "; |
| [4763](#L4763) | $question\_title = $question\_numering\_value . $question['question']; |
| [4764](#L4764) | } |
| [4765](#L4765) | } |
| [4766](#L4766) | } else { |
| [4767](#L4767) | $question\_numering\_value = $question\_numering\_type[$key] . " "; |
| [4768](#L4768) | $question\_title = $question\_numering\_value . $question['question']; |
| [4769](#L4769) | } |
| [4770](#L4770) | } |
| [4771](#L4771) |  |
| [4772](#L4772) | $question\_content = $this->ays\_autoembed( $question\_title ); |
| [4773](#L4773) |  |
| [4774](#L4774) | if ( $quiz\_hide\_question\_text ) { |
| [4775](#L4775) | $question\_content = ''; |
| [4776](#L4776) | } |
| [4777](#L4777) |  |
| [4778](#L4778) | switch ($options['quizTheme']) { |
| [4779](#L4779) | case 'elegant\_dark': |
| [4780](#L4780) | case 'elegant\_light': |
| [4781](#L4781) | case 'rect\_dark': |
| [4782](#L4782) | case 'rect\_light': |
| [4783](#L4783) | $question\_html = "<div class='ays\_quiz\_question'> |
| [4784](#L4784) | " . $question\_content . " |
| [4785](#L4785) | </div> |
| [4786](#L4786) | {$question\_image}"; |
| [4787](#L4787) | $answer\_view\_class = "ays\_".$answer\_view\_class."\_view\_container"; |
| [4788](#L4788) | break; |
| [4789](#L4789) | default: |
| [4790](#L4790) | $question\_html = "<div class='ays\_quiz\_question'> |
| [4791](#L4791) | " . $question\_content . " |
| [4792](#L4792) | </div> |
| [4793](#L4793) | {$question\_image}"; |
| [4794](#L4794) | $answer\_view\_class = "ays\_".$answer\_view\_class."\_view\_container"; |
| [4795](#L4795) | break; |
| [4796](#L4796) | } |
| [4797](#L4797) | $not\_influence\_to\_score\_class = $not\_influence\_to\_score ? 'not\_influence\_to\_score' : ''; |
| [4798](#L4798) | $container\_first\_part = "<div class='step ".$not\_influence\_to\_score\_class."' data-question-id='" . $question["id"] . "' data-type='" . $question["type"] . "'> |
| [4799](#L4799) | {$question\_hint} |
| [4800](#L4800) | {$quiz\_waiting\_time\_html} |
| [4801](#L4801) | {$questions\_counter} |
| [4802](#L4802) | <div class='ays-abs-fs'> |
| [4803](#L4803) | {$question\_category} |
| [4804](#L4804) | {$question\_html} |
| [4805](#L4805) | <div class='ays-quiz-answers $answer\_view\_class $max\_selection\_number\_class $min\_selection\_number\_class'>"; |
| [4806](#L4806) |  |
| [4807](#L4807) | $required\_question\_message = ''; |
| [4808](#L4808) | if( $enable\_min\_selection\_number ){ |
| [4809](#L4809) | $required\_question\_message = '<div class="ays-quiz-question-validation-error" role="alert"></div>'; |
| [4810](#L4810) | } |
| [4811](#L4811) |  |
| [4812](#L4812) | $ays\_questtion\_explanation\_html = ""; |
| [4813](#L4813) | if ( $show\_questions\_explanation != "" && $show\_questions\_explanation != "disable") { |
| [4814](#L4814) | $ays\_questtion\_explanation\_html = $this->ays\_autoembed($question["explanation"]); |
| [4815](#L4815) | } |
| [4816](#L4816) |  |
| [4817](#L4817) | $wrong\_answer\_text\_html = ""; |
| [4818](#L4818) | $right\_answer\_text\_html = ""; |
| [4819](#L4819) | if ( $show\_answers\_rw\_texts != "" && $show\_answers\_rw\_texts != "disable") { |
| [4820](#L4820) | $wrong\_answer\_text\_html = $this->ays\_autoembed($question["wrong\_answer\_text"]); |
| [4821](#L4821) | $right\_answer\_text\_html = $this->ays\_autoembed($question["right\_answer\_text"]); |
| [4822](#L4822) | } |
| [4823](#L4823) |  |
| [4824](#L4824) | $new\_buttons\_div\_html = ""; |
| [4825](#L4825) | if( $quiz\_display\_messages\_before\_buttons ) { |
| [4826](#L4826) | $new\_buttons\_div\_html = $buttons\_div; |
| [4827](#L4827) | $buttons\_div = ""; |
| [4828](#L4828) | } |
| [4829](#L4829) |  |
| [4830](#L4830) | $container\_last\_part = "</div> |
| [4831](#L4831) | {$quiz\_question\_note\_message\_html} |
| [4832](#L4832) | {$user\_explanation} |
| [4833](#L4833) | {$buttons\_div} |
| [4834](#L4834) | {$required\_question\_message} |
| [4835](#L4835) | <div class='wrong\_answer\_text $wrong\_answer\_class' style='display:none'> |
| [4836](#L4836) | " . $wrong\_answer\_text\_html . " |
| [4837](#L4837) | </div> |
| [4838](#L4838) | <div class='right\_answer\_text $right\_answer\_class' style='display:none'> |
| [4839](#L4839) | " . $right\_answer\_text\_html . " |
| [4840](#L4840) | </div> |
| [4841](#L4841) | <div class='ays\_questtion\_explanation' style='display:none'> |
| [4842](#L4842) | " . $ays\_questtion\_explanation\_html . " |
| [4843](#L4843) | </div> |
| [4844](#L4844) | {$new\_buttons\_div\_html} |
| [4845](#L4845) | {$additional\_css} |
| [4846](#L4846) | </div> |
| [4847](#L4847) | </div>"; |
| [4848](#L4848) |  |
| [4849](#L4849) | $container[] = array( |
| [4850](#L4850) | 'quizID' => $quiz\_id, |
| [4851](#L4851) | 'questionID' => $question['id'], |
| [4852](#L4852) | 'questionAnswers' => $answers, |
| [4853](#L4853) | 'questionType' => $question["type"], |
| [4854](#L4854) | 'enable\_max\_selection\_number' => $enable\_max\_selection\_number, |
| [4855](#L4855) | 'max\_selection\_number' => $max\_selection\_number, |
| [4856](#L4856) | 'enable\_min\_selection\_number' => $enable\_min\_selection\_number, |
| [4857](#L4857) | 'min\_selection\_number' => $min\_selection\_number, |
| [4858](#L4858) | 'enable\_case\_sensitive\_text' => $enable\_case\_sensitive\_text, |
| [4859](#L4859) | 'questionParts' => array( |
| [4860](#L4860) | 'question\_first\_part' => $container\_first\_part, |
| [4861](#L4861) | 'question\_middle\_part' => "", |
| [4862](#L4862) | 'question\_last\_part' => $container\_last\_part |
| [4863](#L4863) | ) |
| [4864](#L4864) | ); |
| [4865](#L4865) | } |
| [4866](#L4866) | } |
| [4867](#L4867) | return $container; |
| [4868](#L4868) | } |
| [4869](#L4869) |  |
| [4870](#L4870) | protected function get\_answers\_with\_question\_id($id){ |
| [4871](#L4871) | global $wpdb; |
| [4872](#L4872) |  |
| [4873](#L4873) | $sql = "SELECT \* |
| [4874](#L4874) | FROM {$wpdb->prefix}aysquiz\_answers |
| [4875](#L4875) | WHERE question\_id=" . $id; |
| [4876](#L4876) |  |
| [4877](#L4877) | $answer = $wpdb->get\_results($sql, 'ARRAY\_A'); |
| [4878](#L4878) |  |
| [4879](#L4879) | return $answer; |
| [4880](#L4880) | } |
| [4881](#L4881) |  |
| [4882](#L4882) | public function get\_quiz\_questions\_count($id){ |
| [4883](#L4883) | global $wpdb; |
| [4884](#L4884) |  |
| [4885](#L4885) | $sql = "SELECT `question\_ids` |
| [4886](#L4886) | FROM {$wpdb->prefix}aysquiz\_quizes |
| [4887](#L4887) | WHERE id=" . $id; |
| [4888](#L4888) |  |
| [4889](#L4889) | $questions\_str = $wpdb->get\_row($sql, 'ARRAY\_A'); |
| [4890](#L4890) | $questions = explode(',', $questions\_str['question\_ids']); |
| [4891](#L4891) | return $questions; |
| [4892](#L4892) | } |
| [4893](#L4893) |  |
| [4894](#L4894) | public function get\_question\_bank\_categories($q\_ids){ |
| [4895](#L4895) | global $wpdb; |
| [4896](#L4896) |  |
| [4897](#L4897) | if($q\_ids == ''){ |
| [4898](#L4898) | return array(); |
| [4899](#L4899) | } |
| [4900](#L4900) | $sql = "SELECT DISTINCT c.id, c.title |
| [4901](#L4901) | FROM {$wpdb->prefix}aysquiz\_categories c |
| [4902](#L4902) | JOIN {$wpdb->prefix}aysquiz\_questions q |
| [4903](#L4903) | ON c.id = q.category\_id |
| [4904](#L4904) | WHERE q.id IN ({$q\_ids})"; |
| [4905](#L4905) |  |
| [4906](#L4906) | $result = $wpdb->get\_results($sql, 'ARRAY\_A'); |
| [4907](#L4907) | $cats = array(); |
| [4908](#L4908) |  |
| [4909](#L4909) | foreach($result as $res){ |
| [4910](#L4910) | $cats[$res['id']] = $res['title']; |
| [4911](#L4911) | } |
| [4912](#L4912) |  |
| [4913](#L4913) | return $cats; |
| [4914](#L4914) | } |
| [4915](#L4915) |  |
| [4916](#L4916) | public static function get\_quiz\_tackers\_count($id){ |
| [4917](#L4917) | global $wpdb; |
| [4918](#L4918) |  |
| [4919](#L4919) | $sql = "SELECT COUNT(\*) |
| [4920](#L4920) | FROM {$wpdb->prefix}aysquiz\_reports |
| [4921](#L4921) | WHERE quiz\_id=" . $id; |
| [4922](#L4922) |  |
| [4923](#L4923) | $count = intval($wpdb->get\_var($sql)); |
| [4924](#L4924) |  |
| [4925](#L4925) | return $count; |
| [4926](#L4926) | } |
| [4927](#L4927) |  |
| [4928](#L4928) | public function sort\_array\_keys\_by\_array($array, $orderArray) { |
| [4929](#L4929) | $ordered = array(); |
| [4930](#L4930) | foreach ($orderArray as $key) { |
| [4931](#L4931) | if (array\_key\_exists('ays-question-'.$key, $array)) { |
| [4932](#L4932) | $ordered['ays-question-'.$key] = $array['ays-question-'.$key]; |
| [4933](#L4933) | unset($array['ays-question-'.$key]); |
| [4934](#L4934) | } |
| [4935](#L4935) | } |
| [4936](#L4936) | return $ordered + $array; |
| [4937](#L4937) | } |
| [4938](#L4938) |  |
| [4939](#L4939) | public function ays\_finish\_quiz(){ |
| [4940](#L4940) | ob\_start(); |
| [4941](#L4941) | $quiz\_id = isset($\_REQUEST['ays\_quiz\_id']) ? absint( sanitize\_text\_field( $\_REQUEST['ays\_quiz\_id'] ) ) : 0; |
| [4942](#L4942) |  |
| [4943](#L4943) | if($quiz\_id === 0){ |
| [4944](#L4944) | ob\_end\_clean(); |
| [4945](#L4945) | $ob\_get\_clean = ob\_get\_clean(); |
| [4946](#L4946) | echo json\_encode(array("status" => false, "message" => "No no no" )); |
| [4947](#L4947) | wp\_die(); |
| [4948](#L4948) | } else { |
| [4949](#L4949) | global $wpdb; |
| [4950](#L4950) |  |
| [4951](#L4951) | // $quiz\_id = absint(intval($\_REQUEST['ays\_quiz\_id'])); |
| [4952](#L4952) | $questions\_answers = (isset($\_REQUEST["ays\_questions"])) ? Quiz\_Maker\_Admin::recursive\_sanitize\_text\_field( $\_REQUEST['ays\_questions'] ) : array(); |
| [4953](#L4953) | $is\_training = isset( $\_REQUEST["is\_training"] ) && sanitize\_text\_field( $\_REQUEST['is\_training'] ) === 'true' ? true : false; |
| [4954](#L4954) |  |
| [4955](#L4955) | $questions\_ids = preg\_split('/,/', sanitize\_text\_field( $\_REQUEST['ays\_quiz\_questions'] ) ); |
| [4956](#L4956) | $questions\_answers = $this->sort\_array\_keys\_by\_array($questions\_answers, $questions\_ids); |
| [4957](#L4957) |  |
| [4958](#L4958) | $quiz = $this->get\_quiz\_by\_id($quiz\_id); |
| [4959](#L4959) | $quiz\_intervals\_data = (isset( $quiz['intervals'] ) && $quiz['intervals'] != "") ? $quiz['intervals'] : ""; |
| [4960](#L4960) | $quiz\_intervals = array(); |
| [4961](#L4961) | if ( $quiz\_intervals\_data != "" ) { |
| [4962](#L4962) | $quiz\_intervals = json\_decode($quiz\_intervals\_data); |
| [4963](#L4963) | } |
| [4964](#L4964) | $options = json\_decode($quiz['options']); |
| [4965](#L4965) | $quiz\_questions\_count = $this->get\_quiz\_questions\_count($quiz\_id); |
| [4966](#L4966) |  |
| [4967](#L4967) | if (isset($options->enable\_question\_bank) && $options->enable\_question\_bank == 'on' && isset($options->questions\_count) && intval($options->questions\_count) > 0 && count($quiz\_questions\_count) > intval($options->questions\_count) || $is\_training) { |
| [4968](#L4968) | $question\_ids = preg\_split('/,/', sanitize\_text\_field( $\_REQUEST['ays\_quiz\_questions'] ) ); |
| [4969](#L4969) | } else { |
| [4970](#L4970) | $question\_ids = $this->get\_quiz\_questions\_count($quiz\_id); |
| [4971](#L4971) | } |
| [4972](#L4972) | // Strong calculation of checkbox answers |
| [4973](#L4973) | $options->checkbox\_score\_by = ! isset($options->checkbox\_score\_by) ? 'on' : $options->checkbox\_score\_by; |
| [4974](#L4974) | $strong\_count\_checkbox = (isset($options->checkbox\_score\_by) && $options->checkbox\_score\_by == "on") ? true : false; |
| [4975](#L4975) |  |
| [4976](#L4976) | // Calculate the score |
| [4977](#L4977) | $options->calculate\_score = ! isset($options->calculate\_score) ? 'by\_correctness' : $options->calculate\_score; |
| [4978](#L4978) | $calculate\_score = (isset($options->calculate\_score) && $options->calculate\_score != "") ? $options->calculate\_score : 'by\_correctness'; |
| [4979](#L4979) |  |
| [4980](#L4980) | // Disable store data |
| [4981](#L4981) | $options->disable\_store\_data = ! isset( $options->disable\_store\_data ) ? 'off' : $options->disable\_store\_data; |
| [4982](#L4982) | $disable\_store\_data = (isset($options->disable\_store\_data) && $options->disable\_store\_data == 'off') ? true : false; |
| [4983](#L4983) |  |
| [4984](#L4984) | // Display score option |
| [4985](#L4985) | $display\_score = (isset($options->display\_score) && $options->display\_score != "") ? $options->display\_score : 'by\_percantage'; |
| [4986](#L4986) |  |
| [4987](#L4987) | //Pass score count |
| [4988](#L4988) | $pass\_score\_count = (isset($options->pass\_score) && $options->pass\_score != '') ? absint(intval($options->pass\_score)) : 0; |
| [4989](#L4989) |  |
| [4990](#L4990) | // Information form |
| [4991](#L4991) | $information\_form = (isset($options->information\_form) && $options->information\_form != '') ? $options->information\_form : 'disable'; |
| [4992](#L4992) |  |
| [4993](#L4993) | // Show information form to logged in users |
| [4994](#L4994) | $options->show\_information\_form = isset($options->show\_information\_form) ? $options->show\_information\_form : 'on'; |
| [4995](#L4995) | $show\_information\_form = (isset($options->show\_information\_form) && $options->show\_information\_form == 'on') ? true : false; |
| [4996](#L4996) |  |
| [4997](#L4997) | // Pass Score Text |
| [4998](#L4998) | $pass\_score\_message = ''; |
| [4999](#L4999) | if(isset($options->pass\_score\_message) && $options->pass\_score\_message != ''){ |
| [5000](#L5000) | $pass\_score\_message = $this->ays\_autoembed($options->pass\_score\_message); |
| [5001](#L5001) | }else{ |
| [5002](#L5002) | // $pass\_score\_message = '<h4 style="text-align: center;">'. \_\_("Congratulations!", $this->plugin\_name) .'</h4><p style="text-align: center;">'. \_\_("You passed the quiz!", $this->plugin\_name) .'</p>'; |
| [5003](#L5003) | } |
| [5004](#L5004) |  |
| [5005](#L5005) | // Fail Score Text |
| [5006](#L5006) | $fail\_score\_message = ''; |
| [5007](#L5007) | if(isset($options->fail\_score\_message) && $options->fail\_score\_message != ''){ |
| [5008](#L5008) | $fail\_score\_message = $this->ays\_autoembed($options->fail\_score\_message); |
| [5009](#L5009) | }else{ |
| [5010](#L5010) | // $fail\_score\_message = '<h4 style="text-align: center;">'. \_\_("Oops!", $this->plugin\_name) .'</h4><p style="text-align: center;">'. \_\_("You have not passed the quiz! <br> Try again!", $this->plugin\_name) .'</p>'; |
| [5011](#L5011) | } |
| [5012](#L5012) |  |
| [5013](#L5013) | if(! $show\_information\_form){ |
| [5014](#L5014) | if($information\_form !== 'disable'){ |
| [5015](#L5015) | $user = wp\_get\_current\_user(); |
| [5016](#L5016) | if($user->ID != 0){ |
| [5017](#L5017) | $\_REQUEST['ays\_user\_email'] = $user->data->user\_email; |
| [5018](#L5018) | $\_REQUEST['ays\_user\_name'] = $user->data->display\_name; |
| [5019](#L5019) | } |
| [5020](#L5020) | } |
| [5021](#L5021) | } |
| [5022](#L5022) |  |
| [5023](#L5023) | // Quiz create date |
| [5024](#L5024) | $quiz\_creation\_date = (isset($options->create\_date) && $options->create\_date != '') ? sanitize\_text\_field( $options->create\_date ) : ""; |
| [5025](#L5025) |  |
| [5026](#L5026) | // Quiz Author ID |
| [5027](#L5027) | if ( isset( $options->author ) && is\_string($options->author) ) { |
| [5028](#L5028) | $quiz\_current\_author\_data = (isset( $options->author ) && $options->author != '') ? json\_decode($options->author, true) : array(); |
| [5029](#L5029) | } else { |
| [5030](#L5030) | $options\_author = isset( $options->author ) ? (array)$options->author : array(); |
| [5031](#L5031) | $quiz\_current\_author\_data = (is\_array( $options\_author ) && empty( $options\_author )) ? $options\_author : array(); |
| [5032](#L5032) | } |
| [5033](#L5033) |  |
| [5034](#L5034) | // General Setting's Options |
| [5035](#L5035) | $quiz\_settings = $this->settings; |
| [5036](#L5036) | $general\_settings\_options = ($quiz\_settings->ays\_get\_setting('options') === false) ? json\_encode(array()) : $quiz\_settings->ays\_get\_setting('options'); |
| [5037](#L5037) | $settings\_options = json\_decode(stripcslashes($general\_settings\_options), true); |
| [5038](#L5038) |  |
| [5039](#L5039) | // Do not store IP adressess |
| [5040](#L5040) | $disable\_user\_ip = (isset($settings\_options['disable\_user\_ip']) && $settings\_options['disable\_user\_ip'] == 'on') ? true : false; |
| [5041](#L5041) |  |
| [5042](#L5042) | // Limit user |
| [5043](#L5043) | $options->limit\_users = isset($options->limit\_users) ? $options->limit\_users : 'off'; |
| [5044](#L5044) | $limit\_users = (isset($options->limit\_users) && $options->limit\_users == 'on') ? true : false; |
| [5045](#L5045) |  |
| [5046](#L5046) | // Limit user by |
| [5047](#L5047) | $limit\_users\_by = (isset($options->limit\_users\_by) && $options->limit\_users\_by != '') ? $options->limit\_users\_by : 'ip'; |
| [5048](#L5048) |  |
| [5049](#L5049) | // Quiz Title |
| [5050](#L5050) | $quiz\_title = (isset($quiz['title']) && $quiz['title'] != '') ? stripslashes( $quiz['title'] ) : ''; |
| [5051](#L5051) |  |
| [5052](#L5052) | $limit\_users\_attr = array( |
| [5053](#L5053) | 'id' => $quiz\_id, |
| [5054](#L5054) | 'name' => 'ays\_quiz\_cookie\_', |
| [5055](#L5055) | 'title' => $quiz\_title, |
| [5056](#L5056) | ); |
| [5057](#L5057) | $check\_cookie = $this->ays\_quiz\_check\_cookie( $limit\_users\_attr ); |
| [5058](#L5058) | $return\_false\_status\_arr = array( |
| [5059](#L5059) | "status" => false, |
| [5060](#L5060) | "flag" => false, |
| [5061](#L5061) | "text" => \_\_( 'You have already passed this quiz.', $this->plugin\_name ), |
| [5062](#L5062) | ); |
| [5063](#L5063) |  |
| [5064](#L5064) | if ( $check\_cookie ) { |
| [5065](#L5065) | echo json\_encode( $return\_false\_status\_arr ); |
| [5066](#L5066) | wp\_die(); |
| [5067](#L5067) | } |
| [5068](#L5068) | if ( $limit\_users ) { |
| [5069](#L5069) | switch ( $limit\_users\_by ) { |
| [5070](#L5070) | case 'ip': |
| [5071](#L5071) | break; |
| [5072](#L5072) | case 'user\_id': |
| [5073](#L5073) | break; |
| [5074](#L5074) | case 'cookie': |
| [5075](#L5075) | if ( ! $check\_cookie ) { |
| [5076](#L5076) | $set\_cookie = $this->ays\_quiz\_set\_cookie( $limit\_users\_attr ); |
| [5077](#L5077) | } |
| [5078](#L5078) | break; |
| [5079](#L5079) | case 'ip\_cookie': |
| [5080](#L5080) | $check\_user\_by\_ip = $this->get\_user\_by\_ip($quiz\_id); |
| [5081](#L5081) | if ( ! $check\_cookie || $check\_user\_by\_ip <= 0 ) { |
| [5082](#L5082) | if ( ! $check\_cookie ) { |
| [5083](#L5083) | $set\_cookie = $this->ays\_quiz\_set\_cookie( $limit\_users\_attr ); |
| [5084](#L5084) | } |
| [5085](#L5085) | } else { |
| [5086](#L5086) | echo json\_encode( $return\_false\_status\_arr ); |
| [5087](#L5087) | wp\_die(); |
| [5088](#L5088) | } |
| [5089](#L5089) | break; |
| [5090](#L5090) | default: |
| [5091](#L5091) | break; |
| [5092](#L5092) | } |
| [5093](#L5093) | } |
| [5094](#L5094) |  |
| [5095](#L5095) | $questions\_count = count($question\_ids); |
| [5096](#L5096) | $correctness = array(); |
| [5097](#L5097) | $user\_answered = array(); |
| [5098](#L5098) | $correctness\_results = array(); |
| [5099](#L5099) | $answer\_max\_weights = array(); |
| [5100](#L5100) | if (is\_array($questions\_answers)) { |
| [5101](#L5101) | $quests = array(); |
| [5102](#L5102) | $questions\_cats = array(); |
| [5103](#L5103) | $quiz\_questions\_ids = array(); |
| [5104](#L5104) | $question\_bank\_by\_categories1 = array(); |
| [5105](#L5105) |  |
| [5106](#L5106) | foreach($questions\_answers as $key => $val){ |
| [5107](#L5107) | $question\_id = explode('-', $key)[2]; |
| [5108](#L5108) | $quiz\_questions\_ids[] = strval($question\_id); |
| [5109](#L5109) | } |
| [5110](#L5110) |  |
| [5111](#L5111) | $questions\_categories = $this->get\_questions\_categories( implode( ',', $quiz\_questions\_ids ) ); |
| [5112](#L5112) | $quest\_s = $this->get\_quiz\_questions\_by\_ids($quiz\_questions\_ids); |
| [5113](#L5113) | foreach($quest\_s as $quest){ |
| [5114](#L5114) | $quests[$quest['id']] = $quest; |
| [5115](#L5115) | } |
| [5116](#L5116) |  |
| [5117](#L5117) | foreach($quiz\_questions\_ids as $key => $question\_id){ |
| [5118](#L5118) | $questions\_cats[$quests[$question\_id]['category\_id']][$question\_id] = null; |
| [5119](#L5119) | } |
| [5120](#L5120) | foreach ($questions\_answers as $key => $questions\_answer) { |
| [5121](#L5121) | $continue = false; |
| [5122](#L5122) | $question\_id = explode('-', $key)[2]; |
| [5123](#L5123) | if($this->is\_question\_not\_influence($question\_id)){ |
| [5124](#L5124) | $questions\_count--; |
| [5125](#L5125) | $continue = true; |
| [5126](#L5126) | } |
| [5127](#L5127) | $multiple\_correctness = array(); |
| [5128](#L5128) | $has\_multiple = $this->has\_multiple\_correct\_answers($question\_id); |
| [5129](#L5129) | $answer\_max\_weights[] = $this->get\_answers\_max\_weight($question\_id, $has\_multiple); |
| [5130](#L5130) |  |
| [5131](#L5131) | $user\_answered["question\_id\_" . $question\_id] = $questions\_answer; |
| [5132](#L5132) | if ($has\_multiple) { |
| [5133](#L5133) | if (is\_array($questions\_answer)) { |
| [5134](#L5134) | foreach ($questions\_answer as $answer\_id) { |
| [5135](#L5135) | $multiple\_correctness[] = $this->check\_answer\_correctness($question\_id, $answer\_id, $calculate\_score); |
| [5136](#L5136) | } |
| [5137](#L5137) |  |
| [5138](#L5138) | if($calculate\_score == 'by\_points'){ |
| [5139](#L5139) | if(!$continue){ |
| [5140](#L5140) | $correctness[$question\_id] = array\_sum($multiple\_correctness); |
| [5141](#L5141) | } |
| [5142](#L5142) | $correctness\_results["question\_id\_" . $question\_id] = array\_sum($multiple\_correctness); |
| [5143](#L5143) | continue; |
| [5144](#L5144) | } |
| [5145](#L5145) |  |
| [5146](#L5146) | if($strong\_count\_checkbox === false){ |
| [5147](#L5147) | if(!$continue){ |
| [5148](#L5148) | $correctness[$question\_id] = $this->isHomogenousStrong($multiple\_correctness, $question\_id); |
| [5149](#L5149) | } |
| [5150](#L5150) | $correctness\_results["question\_id\_" . $question\_id] = $this->isHomogenousStrong($multiple\_correctness, $question\_id); |
| [5151](#L5151) | }else{ |
| [5152](#L5152) | if ($this->isHomogenous($multiple\_correctness, $question\_id)) { |
| [5153](#L5153) | if(!$continue){ |
| [5154](#L5154) | $correctness[$question\_id] = true; |
| [5155](#L5155) | } |
| [5156](#L5156) | $correctness\_results["question\_id\_" . $question\_id] = true; |
| [5157](#L5157) | } else { |
| [5158](#L5158) | if(!$continue){ |
| [5159](#L5159) | $correctness[$question\_id] = false; |
| [5160](#L5160) | } |
| [5161](#L5161) | $correctness\_results["question\_id\_" . $question\_id] = false; |
| [5162](#L5162) | } |
| [5163](#L5163) | } |
| [5164](#L5164) | } else { |
| [5165](#L5165) | if($calculate\_score == 'by\_points'){ |
| [5166](#L5166) | if(!$continue){ |
| [5167](#L5167) | $correctness[$question\_id] = $this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score); |
| [5168](#L5168) | } |
| [5169](#L5169) | $correctness\_results["question\_id\_" . $question\_id] = $this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score); |
| [5170](#L5170) | continue; |
| [5171](#L5171) | } |
| [5172](#L5172) | if($strong\_count\_checkbox === false){ |
| [5173](#L5173) | if($this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score)){ |
| [5174](#L5174) | if(!$continue){ |
| [5175](#L5175) | $correctness[$question\_id] = 1 / intval($this->count\_multiple\_correct\_answers($question\_id)); |
| [5176](#L5176) | } |
| [5177](#L5177) | }else{ |
| [5178](#L5178) | if(!$continue){ |
| [5179](#L5179) | $correctness[$question\_id] = false; |
| [5180](#L5180) | } |
| [5181](#L5181) | } |
| [5182](#L5182) | $correctness\_results["question\_id\_" . $question\_id] = $this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score); |
| [5183](#L5183) | }else{ |
| [5184](#L5184) | if(!$continue){ |
| [5185](#L5185) | $correctness[$question\_id] = false; |
| [5186](#L5186) | } |
| [5187](#L5187) | $correctness\_results["question\_id\_" . $question\_id] = false; |
| [5188](#L5188) | } |
| [5189](#L5189) | } |
| [5190](#L5190) | } elseif($this->has\_text\_answer($question\_id)) { |
| [5191](#L5191) | $quests\_data = ( isset( $quests[$question\_id] ) && ! empty( $quests[$question\_id] ) ) ? $quests[$question\_id] : array(); |
| [5192](#L5192) | $quests\_data\_options = isset( $quests\_data['options'] ) ? json\_decode( $quests\_data['options'], true ) : array(); |
| [5193](#L5193) | if(!$continue){ |
| [5194](#L5194) | $correctness[$question\_id] = $this->check\_text\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score, $quests\_data\_options); |
| [5195](#L5195) | } |
| [5196](#L5196) | $correctness\_results["question\_id\_" . $question\_id] = $this->check\_text\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score, $quests\_data\_options); |
| [5197](#L5197) | } else { |
| [5198](#L5198) | if(!$continue){ |
| [5199](#L5199) | $correctness[$question\_id] = $this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score); |
| [5200](#L5200) | } |
| [5201](#L5201) | $correctness\_results["question\_id\_" . $question\_id] = $this->check\_answer\_correctness($question\_id, $questions\_answer, $calculate\_score); |
| [5202](#L5202) | } |
| [5203](#L5203) | } |
| [5204](#L5204) |  |
| [5205](#L5205) | $new\_correctness = array(); |
| [5206](#L5206) | $quiz\_weight = array(); |
| [5207](#L5207) | $corrects\_count = 0; |
| [5208](#L5208) | $quiz\_weight\_correctness = array(); |
| [5209](#L5209) | $corrects\_count\_by\_cats = array(); |
| [5210](#L5210) | foreach($questions\_cats as $cat\_id => &$q\_ids){ |
| [5211](#L5211) | $corrects\_count\_by\_cats[$cat\_id] = 0; |
| [5212](#L5212) | foreach($correctness as $question\_id => $item){ |
| [5213](#L5213) | if( array\_key\_exists( strval($question\_id), $q\_ids ) ){ |
| [5214](#L5214) | switch($calculate\_score){ |
| [5215](#L5215) | case "by\_correctness": |
| [5216](#L5216) | if($item){ |
| [5217](#L5217) | $corrects\_count\_by\_cats[$cat\_id]++; |
| [5218](#L5218) | } |
| [5219](#L5219) | break; |
| [5220](#L5220) | default: |
| [5221](#L5221) | if($item){ |
| [5222](#L5222) | $corrects\_count\_by\_cats[$cat\_id]++; |
| [5223](#L5223) | } |
| [5224](#L5224) | break; |
| [5225](#L5225) | } |
| [5226](#L5226) | } |
| [5227](#L5227) | } |
| [5228](#L5228) | } |
| [5229](#L5229) |  |
| [5230](#L5230) |  |
| [5231](#L5231) | foreach($correctness as $question\_id => $item){ |
| [5232](#L5232) | $question\_weight = $this->get\_question\_weight($question\_id); |
| [5233](#L5233) | $new\_correctness[strval($question\_id)] = $question\_weight \* floatval($item); |
| [5234](#L5234) | $quiz\_weight[] = $question\_weight; |
| [5235](#L5235) | $quiz\_weight\_correctness[strval($question\_id)] = $question\_weight; |
| [5236](#L5236) | switch($calculate\_score){ |
| [5237](#L5237) | case "by\_correctness": |
| [5238](#L5238) | if($item){ |
| [5239](#L5239) | $corrects\_count++; |
| [5240](#L5240) | } |
| [5241](#L5241) | break; |
| [5242](#L5242) | default: |
| [5243](#L5243) | if($item){ |
| [5244](#L5244) | $corrects\_count++; |
| [5245](#L5245) | } |
| [5246](#L5246) | break; |
| [5247](#L5247) | } |
| [5248](#L5248) | } |
| [5249](#L5249) |  |
| [5250](#L5250) |  |
| [5251](#L5251) | $quiz\_weight\_new\_correctness\_by\_cats = array(); |
| [5252](#L5252) | $quiz\_weight\_correctness\_by\_cats = array(); |
| [5253](#L5253) |  |
| [5254](#L5254) | $questions\_count\_by\_cats = array(); |
| [5255](#L5255) | foreach($questions\_cats as $cat\_id => &$q\_ids){ |
| [5256](#L5256) | foreach($q\_ids as $q\_id => &$val){ |
| [5257](#L5257) | $val = array\_key\_exists($q\_id, $new\_correctness) ? $new\_correctness[$q\_id] : false; |
| [5258](#L5258) | $quiz\_weight\_new\_correctness\_by\_cats[$cat\_id][$q\_id] = $val; |
| [5259](#L5259) | if( $this->is\_question\_not\_influence($q\_id) ){ |
| [5260](#L5260) | continue; |
| [5261](#L5261) | } |
| [5262](#L5262) |  |
| [5263](#L5263) | if ( isset( $quiz\_weight\_correctness[$q\_id] ) && sanitize\_text\_field( $quiz\_weight\_correctness[$q\_id] ) != '' ) { |
| [5264](#L5264) | $quiz\_weight\_correctness\_by\_cats[$cat\_id][$q\_id] = $quiz\_weight\_correctness[$q\_id]; |
| [5265](#L5265) | } |
| [5266](#L5266) | } |
| [5267](#L5267) | $questions\_count\_by\_cats[$cat\_id] = count($q\_ids); |
| [5268](#L5268) | } |
| [5269](#L5269) |  |
| [5270](#L5270) | $final\_score\_by\_cats = array(); |
| [5271](#L5271) | $quiz\_weight\_cats = array(); |
| [5272](#L5272) | $correct\_answered\_count\_cats = array(); |
| [5273](#L5273) | foreach($quiz\_weight\_new\_correctness\_by\_cats as $cat\_id => $q\_ids){ |
| [5274](#L5274) |  |
| [5275](#L5275) | if ( ! isset( $quiz\_weight\_correctness\_by\_cats[$cat\_id] ) ) { |
| [5276](#L5276) | continue; |
| [5277](#L5277) | } |
| [5278](#L5278) | $quiz\_weight\_correctness\_by\_cats[$cat\_id] = array\_filter($quiz\_weight\_correctness\_by\_cats[$cat\_id], "strlen"); |
| [5279](#L5279) |  |
| [5280](#L5280) | switch($calculate\_score){ |
| [5281](#L5281) | case "by\_correctness": |
| [5282](#L5282) | $quiz\_weight\_cat = array\_sum($quiz\_weight\_correctness\_by\_cats[$cat\_id]); |
| [5283](#L5283) | $quiz\_weight\_cats[$cat\_id] = array\_sum($quiz\_weight\_correctness\_by\_cats[$cat\_id]); |
| [5284](#L5284) | break; |
| [5285](#L5285) | default: |
| [5286](#L5286) | $quiz\_weight\_cat = array\_sum($quiz\_weight\_correctness\_by\_cats[$cat\_id]); |
| [5287](#L5287) | $quiz\_weight\_cats[$cat\_id] = array\_sum($quiz\_weight\_correctness\_by\_cats[$cat\_id]); |
| [5288](#L5288) | break; |
| [5289](#L5289) | } |
| [5290](#L5290) |  |
| [5291](#L5291) | $correct\_answered\_count\_cat = array\_sum($q\_ids); |
| [5292](#L5292) |  |
| [5293](#L5293) | if($quiz\_weight\_cat == 0){ |
| [5294](#L5294) | $final\_score\_by\_cats[$cat\_id] = floatval(0); |
| [5295](#L5295) | }else{ |
| [5296](#L5296) | $final\_score\_by\_cats[$cat\_id] = floatval(floor(($correct\_answered\_count\_cat / $quiz\_weight\_cat) \* 100)); |
| [5297](#L5297) | } |
| [5298](#L5298) | } |
| [5299](#L5299) | //                $average\_percent = 100 / $questions\_count; |
| [5300](#L5300) |  |
| [5301](#L5301) | switch($calculate\_score){ |
| [5302](#L5302) | case "by\_correctness": |
| [5303](#L5303) | $quiz\_weight = array\_sum($quiz\_weight); |
| [5304](#L5304) | break; |
| [5305](#L5305) | case "by\_points": |
| [5306](#L5306) | $quiz\_weight = array\_sum($answer\_max\_weights); |
| [5307](#L5307) | break; |
| [5308](#L5308) | default: |
| [5309](#L5309) | $quiz\_weight = array\_sum($quiz\_weight); |
| [5310](#L5310) | break; |
| [5311](#L5311) | } |
| [5312](#L5312) | $correct\_answered\_count = array\_sum($new\_correctness); |
| [5313](#L5313) |  |
| [5314](#L5314) | if( $quiz\_weight > 0 ){ |
| [5315](#L5315) | $final\_score = intval(floor(($correct\_answered\_count / $quiz\_weight) \* 100)); |
| [5316](#L5316) | }else{ |
| [5317](#L5317) | $final\_score = 0; |
| [5318](#L5318) | } |
| [5319](#L5319) |  |
| [5320](#L5320) | $current\_quiz\_question\_categories\_count = 0; |
| [5321](#L5321) | if( !empty( $final\_score\_by\_cats ) && is\_array( $final\_score\_by\_cats ) ){ |
| [5322](#L5322) | $current\_quiz\_question\_categories\_count = count($final\_score\_by\_cats); |
| [5323](#L5323) | } |
| [5324](#L5324) |  |
| [5325](#L5325) | $score\_by\_cats = array(); |
| [5326](#L5326) | foreach($final\_score\_by\_cats as $cat\_id => $cat\_score){ |
| [5327](#L5327) |  |
| [5328](#L5328) | $questions\_categorie\_title = isset( $questions\_categories[$cat\_id] ) && $questions\_categories[$cat\_id] != "" ? esc\_attr( $questions\_categories[$cat\_id] ) : ""; |
| [5329](#L5329) |  |
| [5330](#L5330) | switch($display\_score){ |
| [5331](#L5331) | case "by\_correctness": |
| [5332](#L5332) | $score\_by\_cats[$cat\_id] = array( |
| [5333](#L5333) | 'score' => $corrects\_count\_by\_cats[$cat\_id] . " / " . $questions\_count\_by\_cats[$cat\_id], |
| [5334](#L5334) | 'categoryName' => $questions\_categorie\_title, |
| [5335](#L5335) | ); |
| [5336](#L5336) | break; |
| [5337](#L5337) | case "by\_percentage": |
| [5338](#L5338) | $score\_by\_cats[$cat\_id] = array( |
| [5339](#L5339) | 'score' => $cat\_score . "%", |
| [5340](#L5340) | 'categoryName' => $questions\_categorie\_title, |
| [5341](#L5341) | ); |
| [5342](#L5342) | break; |
| [5343](#L5343) | default: |
| [5344](#L5344) | $score\_by\_cats[$cat\_id] = array( |
| [5345](#L5345) | 'score' => $cat\_score . "%", |
| [5346](#L5346) | 'categoryName' => $questions\_categorie\_title, |
| [5347](#L5347) | ); |
| [5348](#L5348) | break; |
| [5349](#L5349) | } |
| [5350](#L5350) | } |
| [5351](#L5351) |  |
| [5352](#L5352) | if(empty($score\_by\_cats)){ |
| [5353](#L5353) | $result\_score\_by\_categories = ''; |
| [5354](#L5354) | }else{ |
| [5355](#L5355) | $result\_score\_by\_categories = '<div class="ays\_result\_by\_cats">'; |
| [5356](#L5356) | foreach($score\_by\_cats as $cat\_id => $cat){ |
| [5357](#L5357) | $result\_score\_by\_categories .= '<p class="ays\_result\_by\_cat"> |
| [5358](#L5358) | <strong class="ays\_result\_by\_cat\_name">'. $cat['categoryName'] .':</strong> |
| [5359](#L5359) | <span class="ays\_result\_by\_cat\_score">'. $cat['score'] .'</span> |
| [5360](#L5360) | </p>'; |
| [5361](#L5361) | } |
| [5362](#L5362) | $result\_score\_by\_categories .= '</div>'; |
| [5363](#L5363) | $result\_score\_by\_categories = str\_replace(array("\r\n", "\n", "\r"), "", $result\_score\_by\_categories); |
| [5364](#L5364) | } |
| [5365](#L5365) |  |
| [5366](#L5366) | switch($display\_score){ |
| [5367](#L5367) | case "by\_correctness": |
| [5368](#L5368) | $score = $corrects\_count . " / " . $questions\_count; |
| [5369](#L5369) | break; |
| [5370](#L5370) | case "by\_percentage": |
| [5371](#L5371) | $score = $final\_score . "%"; |
| [5372](#L5372) | break; |
| [5373](#L5373) | default: |
| [5374](#L5374) | $score = $final\_score . "%"; |
| [5375](#L5375) | break; |
| [5376](#L5376) | } |
| [5377](#L5377) |  |
| [5378](#L5378) | $wrong\_answered\_count = $questions\_count - $corrects\_count; |
| [5379](#L5379) |  |
| [5380](#L5380) | $skipped\_questions\_count = 0; |
| [5381](#L5381) | foreach ($user\_answered as $q\_id => $user\_answered\_val) { |
| [5382](#L5382) | $question\_id\_val = explode('\_', $q\_id)[2]; |
| [5383](#L5383) | if($this->is\_question\_not\_influence($question\_id\_val)){ |
| [5384](#L5384) | continue; |
| [5385](#L5385) | } |
| [5386](#L5386) |  |
| [5387](#L5387) | if ( $user\_answered\_val == '') { |
| [5388](#L5388) | $skipped\_questions\_count++; |
| [5389](#L5389) | } |
| [5390](#L5390) | } |
| [5391](#L5391) |  |
| [5392](#L5392) | $only\_wrong\_answers\_count = $questions\_count - ( $corrects\_count + $skipped\_questions\_count ); |
| [5393](#L5393) |  |
| [5394](#L5394) | $answered\_questions\_count = $questions\_count - $skipped\_questions\_count; |
| [5395](#L5395) | $user\_failed\_questions\_count = $corrects\_count + ( $questions\_count - ($corrects\_count + $skipped\_questions\_count) ); |
| [5396](#L5396) |  |
| [5397](#L5397) | if ( ! empty( $user\_failed\_questions\_count ) || $user\_failed\_questions\_count != 0) { |
| [5398](#L5398) | $score\_by\_answered\_questions = round( ( $corrects\_count \* 100 ) / $user\_failed\_questions\_count , 1 ); |
| [5399](#L5399) | } else { |
| [5400](#L5400) | $score\_by\_answered\_questions = 0; |
| [5401](#L5401) | } |
| [5402](#L5402) |  |
| [5403](#L5403) | $user\_first\_name        = ''; |
| [5404](#L5404) | $user\_last\_name         = ''; |
| [5405](#L5405) | $user\_nickname          = ''; |
| [5406](#L5406) | $user\_display\_name      = ''; |
| [5407](#L5407) | $user\_wordpress\_email   = ''; |
| [5408](#L5408) | $user\_wordpress\_roles   = ''; |
| [5409](#L5409) | $user\_wordpress\_website = ''; |
| [5410](#L5410) | $user\_id = get\_current\_user\_id(); |
| [5411](#L5411) | if($user\_id != 0){ |
| [5412](#L5412) | $usermeta = get\_user\_meta( $user\_id ); |
| [5413](#L5413) | if($usermeta !== null){ |
| [5414](#L5414) | $user\_first\_name = (isset($usermeta['first\_name'][0]) && sanitize\_text\_field( $usermeta['first\_name'][0] != '') ) ? sanitize\_text\_field( $usermeta['first\_name'][0] ) : ''; |
| [5415](#L5415) | $user\_last\_name  = (isset($usermeta['last\_name'][0]) && sanitize\_text\_field( $usermeta['last\_name'][0] != '') ) ? sanitize\_text\_field( $usermeta['last\_name'][0] ) : ''; |
| [5416](#L5416) | $user\_nickname   = (isset($usermeta['nickname'][0]) && sanitize\_text\_field( $usermeta['nickname'][0] != '') ) ? sanitize\_text\_field( $usermeta['nickname'][0] ) : ''; |
| [5417](#L5417) | } |
| [5418](#L5418) |  |
| [5419](#L5419) | $current\_user\_data = get\_userdata( $user\_id ); |
| [5420](#L5420) | if ( ! is\_null( $current\_user\_data ) && $current\_user\_data ) { |
| [5421](#L5421) | $user\_display\_name    = ( isset( $current\_user\_data->data->display\_name ) && $current\_user\_data->data->display\_name != '' ) ? sanitize\_text\_field( $current\_user\_data->data->display\_name ) : ""; |
| [5422](#L5422) | $user\_wordpress\_email = ( isset( $current\_user\_data->data->user\_email ) && $current\_user\_data->data->user\_email != '' ) ? sanitize\_text\_field( $current\_user\_data->data->user\_email ) : ""; |
| [5423](#L5423) |  |
| [5424](#L5424) | $user\_wordpress\_roles = ( isset( $current\_user\_data->roles ) && ! empty( $current\_user\_data->roles ) ) ? $current\_user\_data->roles : ""; |
| [5425](#L5425) |  |
| [5426](#L5426) | if ( !empty( $user\_wordpress\_roles ) && $user\_wordpress\_roles != "" ) { |
| [5427](#L5427) | if ( is\_array( $user\_wordpress\_roles ) ) { |
| [5428](#L5428) | $user\_wordpress\_roles = implode(",", $user\_wordpress\_roles); |
| [5429](#L5429) | } |
| [5430](#L5430) | } |
| [5431](#L5431) |  |
| [5432](#L5432) | $user\_wordpress\_website\_url = ( isset( $current\_user\_data->user\_url ) && ! empty( $current\_user\_data->user\_url ) ) ? sanitize\_url($current\_user\_data->user\_url) : ""; |
| [5433](#L5433) |  |
| [5434](#L5434) | if( !empty( $user\_wordpress\_website\_url ) ){ |
| [5435](#L5435) | $user\_wordpress\_website = "<a href='". esc\_url( $user\_wordpress\_website\_url ) ."' target='\_blank' class='ays-quiz-user-website-link-a-tag'>". \_\_( "Website", $this->plugin\_name ) ."</a>"; |
| [5436](#L5436) | } |
| [5437](#L5437) |  |
| [5438](#L5438) | } |
| [5439](#L5439) | } |
| [5440](#L5440) |  |
| [5441](#L5441) | $current\_quiz\_author = \_\_( "Unknown", $this->plugin\_name ); |
| [5442](#L5442) | $current\_quiz\_author\_nickname = ""; |
| [5443](#L5443) | $current\_quiz\_author\_email = ""; |
| [5444](#L5444) |  |
| [5445](#L5445) | $super\_admin\_email = get\_option('admin\_email'); |
| [5446](#L5446) |  |
| [5447](#L5447) | if( !empty($quiz\_current\_author\_data) ){ |
| [5448](#L5448) | if( !is\_array($quiz\_current\_author\_data) ){ |
| [5449](#L5449) | $quiz\_current\_author\_data = json\_decode($quiz\_current\_author\_data, true); |
| [5450](#L5450) | } |
| [5451](#L5451) |  |
| [5452](#L5452) | $quiz\_current\_author = (isset($quiz\_current\_author\_data['id']) && $quiz\_current\_author\_data['id'] != "") ? absint(sanitize\_text\_field( $quiz\_current\_author\_data['id'] )) : ""; |
| [5453](#L5453) |  |
| [5454](#L5454) | $current\_quiz\_user\_data = get\_userdata( $quiz\_current\_author ); |
| [5455](#L5455) | if ( ! is\_null( $current\_quiz\_user\_data ) && $current\_quiz\_user\_data ) { |
| [5456](#L5456) | $current\_quiz\_author            = ( isset( $current\_quiz\_user\_data->data->display\_name ) && $current\_quiz\_user\_data->data->display\_name != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->display\_name ) : ""; |
| [5457](#L5457) | $current\_quiz\_author\_email      = ( isset( $current\_quiz\_user\_data->data->user\_email ) && $current\_quiz\_user\_data->data->user\_email != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->user\_email ) : ""; |
| [5458](#L5458) | $current\_quiz\_author\_nickname   = ( isset( $current\_quiz\_user\_data->data->user\_nicename ) && $current\_quiz\_user\_data->data->user\_nicename != '' ) ? sanitize\_text\_field( $current\_quiz\_user\_data->data->user\_nicename ) : ""; |
| [5459](#L5459) | } |
| [5460](#L5460) | } |
| [5461](#L5461) |  |
| [5462](#L5462) | // $correct\_answered\_count = array\_sum($correctness); |
| [5463](#L5463) |  |
| [5464](#L5464) | // $final\_score = floor(($average\_percent \* $correct\_answered\_count)); |
| [5465](#L5465) |  |
| [5466](#L5466) | if($disable\_user\_ip){ |
| [5467](#L5467) | $user\_ip = ''; |
| [5468](#L5468) | }else{ |
| [5469](#L5469) | $user\_ip = $this->get\_user\_ip(); |
| [5470](#L5470) | } |
| [5471](#L5471) |  |
| [5472](#L5472) | $current\_user\_ip = $user\_ip; |
| [5473](#L5473) |  |
| [5474](#L5474) | $correctness\_and\_answers = array( |
| [5475](#L5475) | 'correctness' => $correctness\_results, |
| [5476](#L5476) | 'user\_answered' => $user\_answered |
| [5477](#L5477) | ); |
| [5478](#L5478) | $ays\_user\_name = isset( $\_REQUEST['ays\_user\_name'] ) && $\_REQUEST['ays\_user\_name'] != '' ? esc\_sql( sanitize\_text\_field( $\_REQUEST['ays\_user\_name'] ) ) : ''; |
| [5479](#L5479) | $ays\_user\_email = isset( $\_REQUEST['ays\_user\_email'] ) && $\_REQUEST['ays\_user\_email'] != '' ? esc\_sql( sanitize\_email( $\_REQUEST['ays\_user\_email'] ) ) : ''; |
| [5480](#L5480) | $ays\_user\_phone = isset( $\_REQUEST['ays\_user\_phone'] ) && $\_REQUEST['ays\_user\_phone'] != '' ? esc\_sql( sanitize\_text\_field( $\_REQUEST['ays\_user\_phone'] ) ) : ''; |
| [5481](#L5481) | $start\_date = isset( $\_REQUEST['start\_date'] ) && $\_REQUEST['start\_date'] != '' ? sanitize\_text\_field( $\_REQUEST['start\_date'] ) : current\_time( 'mysql' ); |
| [5482](#L5482) | $end\_date = isset( $\_REQUEST['end\_date'] ) && $\_REQUEST['end\_date'] != '' ? sanitize\_text\_field( $\_REQUEST['end\_date'] ) : current\_time( 'mysql' ); |
| [5483](#L5483) |  |
| [5484](#L5484) | $quiz\_curent\_page\_link = isset( $\_REQUEST['ays\_quiz\_curent\_page\_link'] ) && $\_REQUEST['ays\_quiz\_curent\_page\_link'] != '' ? sanitize\_url( $\_REQUEST['ays\_quiz\_curent\_page\_link'] ) : ""; |
| [5485](#L5485) |  |
| [5486](#L5486) | $quiz\_current\_page\_link\_html = "<a href='". esc\_sql( $quiz\_curent\_page\_link ) ."' target='\_blank' class='ays-quiz-curent-page-link-a-tag'>". \_\_( "Quiz link", $this->plugin\_name ) ."</a>"; |
| [5487](#L5487) |  |
| [5488](#L5488) | // WP home page url |
| [5489](#L5489) | $home\_main\_url = home\_url(); |
| [5490](#L5490) | $wp\_home\_page\_url = '<a href="'.$home\_main\_url.'" target="\_blank">'.$home\_main\_url.'</a>'; |
| [5491](#L5491) |  |
| [5492](#L5492) | $message\_data = array( |
| [5493](#L5493) | 'quiz\_name'                                 => stripslashes($quiz['title']), |
| [5494](#L5494) | 'user\_name'                                 => $ays\_user\_name, |
| [5495](#L5495) | 'user\_email'                                => $ays\_user\_email, |
| [5496](#L5496) | 'user\_phone'                                => $ays\_user\_phone, |
| [5497](#L5497) | 'score'                                     => $final\_score . "%", |
| [5498](#L5498) | 'current\_date'                              => date\_i18n( get\_option( 'date\_format' ), strtotime( $end\_date ) ), |
| [5499](#L5499) | 'results\_by\_cats'                           => $result\_score\_by\_categories, |
| [5500](#L5500) | 'avg\_score'                                 => $this->ays\_get\_average\_of\_scores($quiz\_id) . "%", |
| [5501](#L5501) | 'avg\_rate'                                  => round($this->ays\_get\_average\_of\_rates($quiz\_id), 1), |
| [5502](#L5502) | 'user\_pass\_time'                            => $this->get\_time\_difference( $start\_date, $end\_date ), |
| [5503](#L5503) | 'quiz\_time'                                 => $this->secondsToWords($options->timer), |
| [5504](#L5504) | 'user\_corrects\_count'                       => $corrects\_count, |
| [5505](#L5505) | 'wrong\_answers\_count'                       => $wrong\_answered\_count, |
| [5506](#L5506) | 'skipped\_questions\_count'                   => $skipped\_questions\_count, |
| [5507](#L5507) | 'answered\_questions\_count'                  => $answered\_questions\_count, |
| [5508](#L5508) | 'score\_by\_answered\_questions'               => $score\_by\_answered\_questions, |
| [5509](#L5509) | 'user\_first\_name'                           => $user\_first\_name, |
| [5510](#L5510) | 'user\_last\_name'                            => $user\_last\_name, |
| [5511](#L5511) | 'questions\_count'                           => $questions\_count, |
| [5512](#L5512) | 'only\_wrong\_answers\_count'                  => $only\_wrong\_answers\_count, |
| [5513](#L5513) | 'user\_nickname'                             => $user\_nickname, |
| [5514](#L5514) | 'user\_display\_name'                         => $user\_display\_name, |
| [5515](#L5515) | 'user\_wordpress\_email'                      => $user\_wordpress\_email, |
| [5516](#L5516) | 'user\_wordpress\_roles'                      => $user\_wordpress\_roles, |
| [5517](#L5517) | 'user\_wordpress\_website'                    => $user\_wordpress\_website, |
| [5518](#L5518) | 'quiz\_creation\_date'                        => date\_i18n( get\_option( 'date\_format' ), strtotime( $quiz\_creation\_date ) ), |
| [5519](#L5519) | 'current\_quiz\_author'                       => $current\_quiz\_author, |
| [5520](#L5520) | 'current\_quiz\_page\_link'                    => $quiz\_current\_page\_link\_html, |
| [5521](#L5521) | 'current\_user\_ip'                           => $current\_user\_ip, |
| [5522](#L5522) | 'current\_quiz\_author\_email'                 => $current\_quiz\_author\_email, |
| [5523](#L5523) | 'current\_quiz\_author\_nickname'              => $current\_quiz\_author\_nickname, |
| [5524](#L5524) | 'admin\_email'                               => $super\_admin\_email, |
| [5525](#L5525) | 'home\_page\_url'                             => $wp\_home\_page\_url, |
| [5526](#L5526) | 'quiz\_id'                                   => $quiz\_id, |
| [5527](#L5527) | 'user\_id'                                   => $user\_id, |
| [5528](#L5528) | 'current\_quiz\_question\_categories\_count'    => $current\_quiz\_question\_categories\_count, |
| [5529](#L5529) | ); |
| [5530](#L5530) |  |
| [5531](#L5531) | $data = array( |
| [5532](#L5532) | 'user\_ip'      => $user\_ip, |
| [5533](#L5533) | 'user\_name'    => $ays\_user\_name, |
| [5534](#L5534) | 'user\_email'   => $ays\_user\_email, |
| [5535](#L5535) | 'user\_phone'   => $ays\_user\_phone, |
| [5536](#L5536) | 'start\_date'   => esc\_sql( $start\_date ), |
| [5537](#L5537) | 'end\_date'     => esc\_sql( $end\_date ), |
| [5538](#L5538) | 'answered'     => $correctness\_and\_answers, |
| [5539](#L5539) | 'score'        => $final\_score, |
| [5540](#L5540) | 'calc\_method'  => $calculate\_score, |
| [5541](#L5541) | 'quiz\_id'      => $quiz\_id |
| [5542](#L5542) | ); |
| [5543](#L5543) |  |
| [5544](#L5544) | if( $is\_training === true ){ |
| [5545](#L5545) | $disable\_store\_data = false; |
| [5546](#L5546) | } |
| [5547](#L5547) |  |
| [5548](#L5548) | // Disabling store data in DB |
| [5549](#L5549) | if($disable\_store\_data){ |
| [5550](#L5550) | $result = $this->add\_results\_to\_db($data); |
| [5551](#L5551) | }else{ |
| [5552](#L5552) | $result = true; |
| [5553](#L5553) | } |
| [5554](#L5554) |  |
| [5555](#L5555) | $last\_result\_id = $wpdb->insert\_id; |
| [5556](#L5556) |  |
| [5557](#L5557) | $message\_data['avg\_score\_by\_category'] = $this->ays\_get\_average\_score\_by\_category($quiz\_id); |
| [5558](#L5558) | $message\_data['result\_id'] = $last\_result\_id; |
| [5559](#L5559) |  |
| [5560](#L5560) | if ($final\_score >= $pass\_score\_count) { |
| [5561](#L5561) | $score\_message = $pass\_score\_message; |
| [5562](#L5562) | }else{ |
| [5563](#L5563) | $score\_message = $fail\_score\_message; |
| [5564](#L5564) | } |
| [5565](#L5565) |  |
| [5566](#L5566) | $final\_score\_message = ""; |
| [5567](#L5567) | if($pass\_score\_count > 0){ |
| [5568](#L5568) | $final\_score\_message = $this->replace\_message\_variables($score\_message, $message\_data); |
| [5569](#L5569) | } |
| [5570](#L5570) |  |
| [5571](#L5571) | $result\_text = ''; |
| [5572](#L5572) | if(isset($options->result\_text) && $options->result\_text != ''){ |
| [5573](#L5573) | $result\_text = $this->ays\_autoembed($options->result\_text); |
| [5574](#L5574) | } |
| [5575](#L5575) |  |
| [5576](#L5576) | $result\_text = $this->replace\_message\_variables($result\_text, $message\_data); |
| [5577](#L5577) |  |
| [5578](#L5578) | $heading\_for\_share\_buttons = ''; |
| [5579](#L5579) | if( isset($options->enable\_social\_buttons) && $options->enable\_social\_buttons ){ |
| [5580](#L5580) | $heading\_for\_share\_buttons = isset( $options->social\_buttons\_heading ) ? $options->social\_buttons\_heading : ""; |
| [5581](#L5581) | $heading\_for\_share\_buttons = $this->replace\_message\_variables($heading\_for\_share\_buttons, $message\_data); |
| [5582](#L5582) | $heading\_for\_share\_buttons = $this->ays\_autoembed($heading\_for\_share\_buttons); |
| [5583](#L5583) | } |
| [5584](#L5584) |  |
| [5585](#L5585) | $heading\_for\_social\_links = ''; |
| [5586](#L5586) | if( isset($options->enable\_social\_links) && $options->enable\_social\_links ){ |
| [5587](#L5587) | if( isset( $options->social\_links\_heading ) && $options->social\_links\_heading != "" ){ |
| [5588](#L5588) | $heading\_for\_social\_links = isset( $options->social\_links\_heading ) ? $options->social\_links\_heading : ""; |
| [5589](#L5589) | $heading\_for\_social\_links = $this->replace\_message\_variables($heading\_for\_social\_links, $message\_data); |
| [5590](#L5590) | $heading\_for\_social\_links = $this->ays\_autoembed($heading\_for\_social\_links); |
| [5591](#L5591) | } |
| [5592](#L5592) |  |
| [5593](#L5593) | } |
| [5594](#L5594) |  |
| [5595](#L5595) | if( $is\_training === true ) { |
| [5596](#L5596) | if ( has\_action( 'ays\_qm\_front\_end\_trainings\_save' ) ) { |
| [5597](#L5597) | $correct\_questions = array(); |
| [5598](#L5598) | $wrong\_questions = array(); |
| [5599](#L5599) | foreach ( $correctness\_results as $q\_key => $is\_correct ){ |
| [5600](#L5600) | $qid = explode( '\_', $q\_key )[2]; |
| [5601](#L5601) | if( $is\_correct === true ){ |
| [5602](#L5602) | $correct\_questions[] = absint( $qid ); |
| [5603](#L5603) | }else{ |
| [5604](#L5604) | $wrong\_questions[] = absint( $qid ); |
| [5605](#L5605) | } |
| [5606](#L5606) | } |
| [5607](#L5607) | do\_action( "ays\_qm\_front\_end\_trainings\_save", $quiz\_id, $correct\_questions, $wrong\_questions ); |
| [5608](#L5608) | } |
| [5609](#L5609) | }else{ |
| [5610](#L5610) | if ( has\_action( 'ays\_qm\_front\_end\_integrations' ) ) { |
| [5611](#L5611) | $integration\_args          = array(); |
| [5612](#L5612) | $integration\_options       = (array) $options; |
| [5613](#L5613) | $integration\_options['id'] = $quiz\_id; |
| [5614](#L5614) | $integration\_options['ays\_quiz\_final\_score'] = $final\_score; |
| [5615](#L5615) | // $integration\_options['ays\_quiz\_score\_by'] = $score\_by; |
| [5616](#L5616) | // $integration\_options['quiz\_attributes\_information'] = $quiz\_attributes\_information\_slag; |
| [5617](#L5617) | $integrations\_data         = apply\_filters( 'ays\_qm\_front\_end\_integrations\_options', $integration\_args, $integration\_options ); |
| [5618](#L5618) | do\_action( "ays\_qm\_front\_end\_integrations", $integrations\_data, $integration\_options, $data ); |
| [5619](#L5619) | } |
| [5620](#L5620) | } |
| [5621](#L5621) |  |
| [5622](#L5622) | ob\_end\_clean(); |
| [5623](#L5623) | $ob\_get\_clean = ob\_get\_clean(); |
| [5624](#L5624) | if ($result) { |
| [5625](#L5625) | echo json\_encode(array( |
| [5626](#L5626) | "status"                => true, |
| [5627](#L5627) | "score"                 => $score, |
| [5628](#L5628) | "scoreMessage"          => $final\_score\_message, |
| [5629](#L5629) | "displayScore"          => $display\_score, |
| [5630](#L5630) | "text"                  => $result\_text, |
| [5631](#L5631) | "result\_id"             => $last\_result\_id, |
| [5632](#L5632) | "result\_id"             => $last\_result\_id, |
| [5633](#L5633) | "socialHeading"         => $heading\_for\_share\_buttons, |
| [5634](#L5634) | "socialLinksHeading"    => $heading\_for\_social\_links |
| [5635](#L5635) | )); |
| [5636](#L5636) | wp\_die(); |
| [5637](#L5637) | }else{ |
| [5638](#L5638) | echo json\_encode(array( |
| [5639](#L5639) | "status" => false, |
| [5640](#L5640) | "text"   => "No no no" |
| [5641](#L5641) | )); |
| [5642](#L5642) | wp\_die(); |
| [5643](#L5643) | } |
| [5644](#L5644) |  |
| [5645](#L5645) | } else { |
| [5646](#L5646) | $admin\_mails = get\_option('admin\_email'); |
| [5647](#L5647) |  |
| [5648](#L5648) | ob\_end\_clean(); |
| [5649](#L5649) | $ob\_get\_clean = ob\_get\_clean(); |
| [5650](#L5650) |  |
| [5651](#L5651) | echo json\_encode(array( |
| [5652](#L5652) | "status"     => false, |
| [5653](#L5653) | "text"       => "No no no", |
| [5654](#L5654) | "admin\_mail" => $admin\_mails |
| [5655](#L5655) | )); |
| [5656](#L5656) | wp\_die(); |
| [5657](#L5657) | } |
| [5658](#L5658) | } |
| [5659](#L5659) | } |
| [5660](#L5660) |  |
| [5661](#L5661) | public function replace\_message\_variables($content, $data){ |
| [5662](#L5662) | foreach($data as $variable => $value){ |
| [5663](#L5663) | $content = str\_replace("%%".$variable."%%", $value, $content); |
| [5664](#L5664) | } |
| [5665](#L5665) | return $content; |
| [5666](#L5666) | } |
| [5667](#L5667) |  |
| [5668](#L5668) | public function get\_answers\_max\_weight($question\_id, $has\_multiple){ |
| [5669](#L5669) | global $wpdb; |
| [5670](#L5670) | //$answers\_table = $wpdb->prefix . "aysquiz\_answers"; |
| [5671](#L5671) | //$question\_id = absint(intval($question\_id)); |
| [5672](#L5672) | //$query\_part = "MAX(weight)"; |
| [5673](#L5673) | //if($has\_multiple){ |
| [5674](#L5674) | //    $query\_part = "SUM(weight)"; |
| [5675](#L5675) | //} |
| [5676](#L5676) | //$sql = "SELECT {$query\_part} FROM {$answers\_table} WHERE question\_id={$question\_id}"; |
| [5677](#L5677) | //$checks = $wpdb->get\_var($sql); |
| [5678](#L5678) | //$answer\_weight = floatval($checks); |
| [5679](#L5679) |  |
| [5680](#L5680) | return 0; |
| [5681](#L5681) | } |
| [5682](#L5682) |  |
| [5683](#L5683) | public function check\_answer\_correctness($question\_id, $answer\_id, $calc\_method){ |
| [5684](#L5684) | global $wpdb; |
| [5685](#L5685) | $answers\_table = $wpdb->prefix . "aysquiz\_answers"; |
| [5686](#L5686) | $question\_id = absint(intval($question\_id)); |
| [5687](#L5687) | $answer\_id = absint(intval($answer\_id)); |
| [5688](#L5688) | $checks = $wpdb->get\_row("SELECT \* FROM {$answers\_table} WHERE question\_id={$question\_id} AND id={$answer\_id}", "ARRAY\_A"); |
| [5689](#L5689) | if( empty( $checks ) ){ |
| [5690](#L5690) | return false; |
| [5691](#L5691) | } |
| [5692](#L5692) | $answer = false; |
| [5693](#L5693) | switch($calc\_method){ |
| [5694](#L5694) | case "by\_correctness": |
| [5695](#L5695) | if (absint(intval($checks["correct"])) == 1) |
| [5696](#L5696) | $answer = true; |
| [5697](#L5697) | else |
| [5698](#L5698) | $answer = false; |
| [5699](#L5699) | break; |
| [5700](#L5700) | case "by\_points": |
| [5701](#L5701) | $answer\_weight = isset($checks['weight']) ? floatval($checks['weight']) : 0; |
| [5702](#L5702) | $answer = $answer\_weight; |
| [5703](#L5703) | break; |
| [5704](#L5704) | default: |
| [5705](#L5705) | if (absint(intval($checks["correct"])) == 1) |
| [5706](#L5706) | $answer = true; |
| [5707](#L5707) | else |
| [5708](#L5708) | $answer = false; |
| [5709](#L5709) | break; |
| [5710](#L5710) | } |
| [5711](#L5711) | return $answer; |
| [5712](#L5712) | } |
| [5713](#L5713) |  |
| [5714](#L5714) | public function check\_text\_answer\_correctness($question\_id, $answer, $calc\_method, $options = array()){ |
| [5715](#L5715) | global $wpdb; |
| [5716](#L5716) | $answers\_table = $wpdb->prefix . "aysquiz\_answers"; |
| [5717](#L5717) | $question\_id = absint(intval($question\_id)); |
| [5718](#L5718) | $checks = $wpdb->get\_row("SELECT COUNT(\*) AS qanak, answer, weight FROM {$answers\_table} WHERE question\_id={$question\_id}", ARRAY\_A); |
| [5719](#L5719) |  |
| [5720](#L5720) | $checks['answer'] = (isset( $checks['answer'] ) && $checks['answer'] != "") ? $checks['answer'] : ""; |
| [5721](#L5721) |  |
| [5722](#L5722) | $correct\_answers = mb\_strtolower($checks['answer']); |
| [5723](#L5723) |  |
| [5724](#L5724) | // Disable strip slashes for answers |
| [5725](#L5725) | $options['quiz\_disable\_answer\_stripslashes'] = isset($options['quiz\_disable\_answer\_stripslashes']) ? sanitize\_text\_field( $options['quiz\_disable\_answer\_stripslashes'] ) : 'off'; |
| [5726](#L5726) | $quiz\_disable\_answer\_stripslashes = (isset($options['quiz\_disable\_answer\_stripslashes']) && $options['quiz\_disable\_answer\_stripslashes'] == 'on') ? true : false; |
| [5727](#L5727) |  |
| [5728](#L5728) | if ( !$quiz\_disable\_answer\_stripslashes ) { |
| [5729](#L5729) | $answer = stripslashes($answer); |
| [5730](#L5730) | } |
| [5731](#L5731) |  |
| [5732](#L5732) | $correct = false; |
| [5733](#L5733) | $text\_type = $this->text\_answer\_is($question\_id); |
| [5734](#L5734) |  |
| [5735](#L5735) | // Enable case sensitive text |
| [5736](#L5736) | $options['enable\_case\_sensitive\_text'] = isset($options['enable\_case\_sensitive\_text']) ? sanitize\_text\_field( $options['enable\_case\_sensitive\_text'] ) : 'off'; |
| [5737](#L5737) | $enable\_case\_sensitive\_text = (isset($options['enable\_case\_sensitive\_text']) && sanitize\_text\_field( $options['enable\_case\_sensitive\_text'] ) == 'on') ? true : false; |
| [5738](#L5738) |  |
| [5739](#L5739) | if( $text\_type == 'text' || $text\_type == 'short\_text' ){ |
| [5740](#L5740) | if ( $enable\_case\_sensitive\_text ) { |
| [5741](#L5741) | $correct\_answers = $checks['answer']; |
| [5742](#L5742) | } |
| [5743](#L5743) | } |
| [5744](#L5744) |  |
| [5745](#L5745) | if($text\_type == 'date'){ |
| [5746](#L5746) | // if(Quiz\_Maker\_Admin::validateDate($answer, 'Y-m-d')){ |
| [5747](#L5747) | if(date('Y-m-d', strtotime($correct\_answers)) == date('Y-m-d', strtotime($answer))){ |
| [5748](#L5748) | $correct = true; |
| [5749](#L5749) | } |
| [5750](#L5750) | // } |
| [5751](#L5751) | }elseif($text\_type != 'number'){ |
| [5752](#L5752) | $correct\_answers = explode('%%%', $correct\_answers); |
| [5753](#L5753) | foreach($correct\_answers as $c){ |
| [5754](#L5754) | if ($enable\_case\_sensitive\_text) { |
| [5755](#L5755) | if(trim($c) === trim($answer)){ |
| [5756](#L5756) | $correct = true; |
| [5757](#L5757) | break; |
| [5758](#L5758) | } |
| [5759](#L5759) | } else { |
| [5760](#L5760) | if(trim($c) === mb\_strtolower(trim($answer))){ |
| [5761](#L5761) | $correct = true; |
| [5762](#L5762) | break; |
| [5763](#L5763) | } |
| [5764](#L5764) | } |
| [5765](#L5765) | } |
| [5766](#L5766) | }else{ |
| [5767](#L5767) | if($correct\_answers == mb\_strtolower(trim($answer))){ |
| [5768](#L5768) | $correct = true; |
| [5769](#L5769) | } |
| [5770](#L5770) | } |
| [5771](#L5771) | $answer\_res = false; |
| [5772](#L5772) | switch($calc\_method){ |
| [5773](#L5773) | case "by\_correctness": |
| [5774](#L5774) | if($correct) |
| [5775](#L5775) | $answer\_res = true; |
| [5776](#L5776) | else |
| [5777](#L5777) | $answer\_res = false; |
| [5778](#L5778) | break; |
| [5779](#L5779) | case "by\_points": |
| [5780](#L5780) | $answer\_weight = floatval($checks['weight']); |
| [5781](#L5781) | if($correct) |
| [5782](#L5782) | $answer\_res = $answer\_weight; |
| [5783](#L5783) | else |
| [5784](#L5784) | $answer\_res = 0; |
| [5785](#L5785) | break; |
| [5786](#L5786) | default: |
| [5787](#L5787) | if($correct) |
| [5788](#L5788) | $answer\_res = true; |
| [5789](#L5789) | else |
| [5790](#L5790) | $answer\_res = false; |
| [5791](#L5791) | break; |
| [5792](#L5792) | } |
| [5793](#L5793) | return $answer\_res; |
| [5794](#L5794) | } |
| [5795](#L5795) |  |
| [5796](#L5796) | public function count\_multiple\_correct\_answers($question\_id){ |
| [5797](#L5797) | global $wpdb; |
| [5798](#L5798) | $answers\_table = $wpdb->prefix . "aysquiz\_answers"; |
| [5799](#L5799) | $question\_id = absint(intval($question\_id)); |
| [5800](#L5800) |  |
| [5801](#L5801) | $get\_answers = $wpdb->get\_var("SELECT COUNT(\*) FROM {$answers\_table} WHERE question\_id={$question\_id} AND correct=1"); |
| [5802](#L5802) | return $get\_answers; |
| [5803](#L5803) | } |
| [5804](#L5804) |  |
| [5805](#L5805) | public function has\_multiple\_correct\_answers($question\_id){ |
| [5806](#L5806) | global $wpdb; |
| [5807](#L5807) | $answers\_table = $wpdb->prefix . "aysquiz\_answers"; |
| [5808](#L5808) | $question\_id = absint(intval($question\_id)); |
| [5809](#L5809) |  |
| [5810](#L5810) | $get\_answers = $wpdb->get\_var("SELECT COUNT(\*) FROM {$answers\_table} WHERE question\_id={$question\_id} AND correct=1"); |
| [5811](#L5811) |  |
| [5812](#L5812) | if (intval($get\_answers) > 1) { |
| [5813](#L5813) | return true; |
| [5814](#L5814) | } |
| [5815](#L5815) | return false; |
| [5816](#L5816) | } |
| [5817](#L5817) |  |
| [5818](#L5818) | public function is\_question\_not\_influence($question\_id){ |
| [5819](#L5819) | global $wpdb; |
| [5820](#L5820) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [5821](#L5821) | $question\_id = absint(intval($question\_id)); |
| [5822](#L5822) |  |
| [5823](#L5823) | $question = $wpdb->get\_row("SELECT \* FROM {$questions\_table} WHERE id={$question\_id};", "ARRAY\_A"); |
| [5824](#L5824) | $question['not\_influence\_to\_score'] = ! isset($question['not\_influence\_to\_score']) ? 'off' : $question['not\_influence\_to\_score']; |
| [5825](#L5825) | if(isset($question['not\_influence\_to\_score']) && $question['not\_influence\_to\_score'] == 'on'){ |
| [5826](#L5826) | return true; |
| [5827](#L5827) | } |
| [5828](#L5828) | return false; |
| [5829](#L5829) | } |
| [5830](#L5830) |  |
| [5831](#L5831) | public function in\_question\_use\_html($question\_id){ |
| [5832](#L5832) | global $wpdb; |
| [5833](#L5833) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [5834](#L5834) | $question\_id = absint(intval($question\_id)); |
| [5835](#L5835) |  |
| [5836](#L5836) | $question = $wpdb->get\_row("SELECT \* FROM {$questions\_table} WHERE id={$question\_id};", "ARRAY\_A"); |
| [5837](#L5837) | $options = ! isset($question['options']) ? array() : json\_decode($question['options'], true); |
| [5838](#L5838) | if(isset($options['use\_html']) && $options['use\_html'] == 'on'){ |
| [5839](#L5839) | return true; |
| [5840](#L5840) | } |
| [5841](#L5841) | return false; |
| [5842](#L5842) | } |
| [5843](#L5843) |  |
| [5844](#L5844) | public function has\_text\_answer($question\_id){ |
| [5845](#L5845) | global $wpdb; |
| [5846](#L5846) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [5847](#L5847) | $question\_id = absint(intval($question\_id)); |
| [5848](#L5848) |  |
| [5849](#L5849) | $text\_types = array('text', 'short\_text', 'number', 'date'); |
| [5850](#L5850) | $get\_answers = $wpdb->get\_var("SELECT type FROM {$questions\_table} WHERE id={$question\_id}"); |
| [5851](#L5851) |  |
| [5852](#L5852) | if (in\_array($get\_answers, $text\_types)) { |
| [5853](#L5853) | return true; |
| [5854](#L5854) | } |
| [5855](#L5855) | return false; |
| [5856](#L5856) | } |
| [5857](#L5857) |  |
| [5858](#L5858) | public function text\_answer\_is($question\_id){ |
| [5859](#L5859) | global $wpdb; |
| [5860](#L5860) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [5861](#L5861) | $question\_id = absint(intval($question\_id)); |
| [5862](#L5862) |  |
| [5863](#L5863) | $text\_types = array('text', 'short\_text', 'number', 'date'); |
| [5864](#L5864) | $get\_answers = $wpdb->get\_var("SELECT type FROM {$questions\_table} WHERE id={$question\_id}"); |
| [5865](#L5865) |  |
| [5866](#L5866) | if (in\_array($get\_answers, $text\_types)) { |
| [5867](#L5867) | return $get\_answers; |
| [5868](#L5868) | } |
| [5869](#L5869) | return false; |
| [5870](#L5870) | } |
| [5871](#L5871) |  |
| [5872](#L5872) | public function ays\_default\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [5873](#L5873) | $answer\_container = ""; |
| [5874](#L5874) | $show\_answers\_numbering = (isset($options['show\_answers\_numbering']) && $options['show\_answers\_numbering'] != '') ? $options['show\_answers\_numbering'] : 'none'; |
| [5875](#L5875) | $numbering\_type\_arr = $this->ays\_answer\_numbering($show\_answers\_numbering); |
| [5876](#L5876) | $numbering\_type = ''; |
| [5877](#L5877) |  |
| [5878](#L5878) | $answer\_container\_script    = ''; |
| [5879](#L5879) | $answer\_container\_script\_html = ''; |
| [5880](#L5880) | $script\_data\_arr = array(); |
| [5881](#L5881) | $question\_answer = array(); |
| [5882](#L5882) | foreach ($answers as $key => $answer) { |
| [5883](#L5883) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? "<img src='{$answer["image"]}' alt='answer\_image' class='ays-answer-image'>" : ""; |
| [5884](#L5884) |  |
| [5885](#L5885) | if($answer\_image == ""){ |
| [5886](#L5886) | $ays\_field\_style = ""; |
| [5887](#L5887) | $answer\_label\_style = ""; |
| [5888](#L5888) | }else{ |
| [5889](#L5889) | if($options['rtlDirection']){ |
| [5890](#L5890) | $ays\_flex\_dir = 'unset'; |
| [5891](#L5891) | $ays\_border\_dir = "right"; |
| [5892](#L5892) | }else{ |
| [5893](#L5893) | $ays\_flex\_dir = 'row-reverse'; |
| [5894](#L5894) | $ays\_border\_dir = "left"; |
| [5895](#L5895) | } |
| [5896](#L5896) | if($options['answersViewClass'] == 'grid'){ |
| [5897](#L5897) | $ays\_field\_style = "style='display: block; height: fit-content; margin-bottom: 10px; width:200px;'"; |
| [5898](#L5898) | $answer\_label\_style = "style='margin-bottom: 0; box-shadow: 0px 0px 10px; line-height: 1.5'"; |
| [5899](#L5899) | }else{ |
| [5900](#L5900) | $ays\_field\_style = "style='margin-bottom: 10px; border-radius: 4px 4px 0 0; overflow: hidden; display: flex; box-shadow: 0px 0px 10px; flex-direction: {$ays\_flex\_dir};'"; |
| [5901](#L5901) | $answer\_label\_style = "style='border-radius:0; border-{$ays\_border\_dir}:1px solid #ccc; line-height: 100px'"; |
| [5902](#L5902) | } |
| [5903](#L5903) | } |
| [5904](#L5904) |  |
| [5905](#L5905) | if ( $options["questionType"] == 'checkbox' ) { |
| [5906](#L5906) |  |
| [5907](#L5907) | $enable\_max\_selection\_number = ( isset( $options['enable\_max\_selection\_number'] ) && $options["enable\_max\_selection\_number"] == 'on' ) ? true : false; |
| [5908](#L5908) | $max\_selection\_number        = ( isset( $options["max\_selection\_number"] ) && $options["max\_selection\_number"] != '' ) ? absint($options["max\_selection\_number"]) : ''; |
| [5909](#L5909) |  |
| [5910](#L5910) | $enable\_min\_selection\_number = ( isset( $options['enable\_min\_selection\_number'] ) && $options["enable\_min\_selection\_number"] == 'on' ) ? true : false; |
| [5911](#L5911) | $min\_selection\_number        = ( isset( $options["min\_selection\_number"] ) && $options["min\_selection\_number"] != '' ) ? absint($options["min\_selection\_number"]) : ''; |
| [5912](#L5912) |  |
| [5913](#L5913) | if ( ( $enable\_max\_selection\_number && ! empty( $max\_selection\_number ) && $max\_selection\_number != 0 ) || ( $enable\_min\_selection\_number && ! empty( $min\_selection\_number ) && $min\_selection\_number != 0 ) ) { |
| [5914](#L5914) |  |
| [5915](#L5915) | $script\_data\_arr['enable\_max\_selection\_number'] = $enable\_max\_selection\_number; |
| [5916](#L5916) | $script\_data\_arr['max\_selection\_number'] = $max\_selection\_number; |
| [5917](#L5917) | $script\_data\_arr['enable\_min\_selection\_number'] = $enable\_min\_selection\_number; |
| [5918](#L5918) | $script\_data\_arr['min\_selection\_number'] = $min\_selection\_number; |
| [5919](#L5919) | } |
| [5920](#L5920) | } |
| [5921](#L5921) |  |
| [5922](#L5922) | $correct\_answer\_flag = 'ays\_answer\_image\_class'; |
| [5923](#L5923) | if( isset($\_GET['ays\_quiz\_answers']) && sanitize\_key( $\_GET['ays\_quiz\_answers'] ) == 'error404' && $answer["correct"] == 1 ){ |
| [5924](#L5924) | $correct\_answer\_flag = 'ays\_anser\_image\_class'; |
| [5925](#L5925) | } |
| [5926](#L5926) |  |
| [5927](#L5927) | $label = ""; |
| [5928](#L5928) | if( $answer["answer"] != "" ){ |
| [5929](#L5929) | if($options['useHTML']){ |
| [5930](#L5930) | $answer\_content = do\_shortcode((stripslashes($answer["answer"]))); |
| [5931](#L5931) | }else{ |
| [5932](#L5932) | $answer\_content = do\_shortcode(htmlspecialchars(stripslashes($answer["answer"]))); |
| [5933](#L5933) | } |
| [5934](#L5934) |  |
| [5935](#L5935) | $question\_answer[ $answer["id"] ] = htmlspecialchars\_decode(stripslashes($answer["correct"]), ENT\_QUOTES); |
| [5936](#L5936) |  |
| [5937](#L5937) | if ( ! empty($numbering\_type\_arr) ) { |
| [5938](#L5938) | $numbering\_type = (isset($numbering\_type\_arr[$key]) && $numbering\_type\_arr[$key] != '') ? $numbering\_type\_arr[$key] :''; |
| [5939](#L5939) | $numbering\_type = $numbering\_type . ' '; |
| [5940](#L5940) | } |
| [5941](#L5941) |  |
| [5942](#L5942) | $label .= "<label for='ays-answer-{$answer["id"]}-{$quiz\_id}' class='ays\_answer\_image {$correct\_answer\_flag}' $answer\_label\_style>" . $numbering\_type  . $answer\_content . "</label>"; |
| [5943](#L5943) | } |
| [5944](#L5944) | if( $answer\_image != "" ){ |
| [5945](#L5945) | $label .= "<label for='ays-answer-{$answer["id"]}-{$quiz\_id}' style='border-radius:0;margin:0;padding:0;height:100px;'>{$answer\_image}</label>"; |
| [5946](#L5946) | } |
| [5947](#L5947) | $answer\_container .= " |
| [5948](#L5948) | <div class='ays-field ays\_" . $options['answersViewClass'] . "\_view\_item' $ays\_field\_style> |
| [5949](#L5949) | <input type='hidden' name='ays\_answer\_correct[]' value='0'/> |
| [5950](#L5950) |  |
| [5951](#L5951) | <input type='{$options["questionType"]}' name='ays\_questions[ays-question-{$question\_id}]' id='ays-answer-{$answer["id"]}-{$quiz\_id}' value='{$answer["id"]}'/> |
| [5952](#L5952) |  |
| [5953](#L5953) | {$label} |
| [5954](#L5954) |  |
| [5955](#L5955) | </div>"; |
| [5956](#L5956) | } |
| [5957](#L5957) |  |
| [5958](#L5958) | $script\_data\_arr['question\_answer'] = $question\_answer; |
| [5959](#L5959) |  |
| [5960](#L5960) | $answer\_container\_script\_html .= '<script>'; |
| [5961](#L5961) | $answer\_container\_script\_html .= " |
| [5962](#L5962) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [5963](#L5963) | window.quizOptions\_$quiz\_id = []; |
| [5964](#L5964) | } |
| [5965](#L5965) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode($script\_data\_arr)) . "';"; |
| [5966](#L5966) | $answer\_container\_script\_html .= '</script>'; |
| [5967](#L5967) |  |
| [5968](#L5968) | $answer\_container .= $answer\_container\_script\_html; |
| [5969](#L5969) |  |
| [5970](#L5970) | return $answer\_container; |
| [5971](#L5971) | } |
| [5972](#L5972) |  |
| [5973](#L5973) | protected function ays\_text\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [5974](#L5974) | $enable\_correction = $options['correction'] ? "display:inline-block;white-space: nowrap;" : "display:none"; |
| [5975](#L5975) | $enable\_correction\_textarea = $options['correction'] ? "width:100%;" : "width:100%;"; |
| [5976](#L5976) | $is\_enable\_question\_max\_length = $this->ays\_quiz\_is\_enable\_question\_max\_length( $question\_id , 'text' ); |
| [5977](#L5977) |  |
| [5978](#L5978) | $question\_not\_influence\_class  = ""; |
| [5979](#L5979) | if ( $this->is\_question\_not\_influence( $question\_id ) ) { |
| [5980](#L5980) | $question\_not\_influence\_class  = "ays\_display\_none"; |
| [5981](#L5981) | $enable\_correction\_textarea    = "width:100%;"; |
| [5982](#L5982) | } |
| [5983](#L5983) |  |
| [5984](#L5984) | $question\_text\_max\_length\_array = (isset($options['questionMaxLengthArray']) && ! empty($options['questionMaxLengthArray'])) ? $options['questionMaxLengthArray'] : array(); |
| [5985](#L5985) |  |
| [5986](#L5986) | $ays\_question\_limit\_length\_class = ''; |
| [5987](#L5987) | $ays\_quiz\_question\_text\_message\_html = ''; |
| [5988](#L5988) | $enable\_question\_text\_max\_length = false; |
| [5989](#L5989) | $question\_text\_max\_length = ''; |
| [5990](#L5990) | $question\_limit\_text\_type = 'characters'; |
| [5991](#L5991) | $question\_enable\_text\_message = false; |
| [5992](#L5992) | if (! empty($question\_text\_max\_length\_array) ) { |
| [5993](#L5993) |  |
| [5994](#L5994) | $enable\_question\_text\_max\_length = $question\_text\_max\_length\_array['enable\_question\_text\_max\_length']; |
| [5995](#L5995) |  |
| [5996](#L5996) | $question\_text\_max\_length = $question\_text\_max\_length\_array['question\_text\_max\_length']; |
| [5997](#L5997) |  |
| [5998](#L5998) | $question\_limit\_text\_type = $question\_text\_max\_length\_array['question\_limit\_text\_type']; |
| [5999](#L5999) |  |
| [6000](#L6000) | $question\_enable\_text\_message = $question\_text\_max\_length\_array['question\_enable\_text\_message']; |
| [6001](#L6001) | } |
| [6002](#L6002) |  |
| [6003](#L6003) | if( $is\_enable\_question\_max\_length ){ |
| [6004](#L6004) | $ays\_question\_limit\_length\_class = 'ays\_question\_limit\_length'; |
| [6005](#L6005) |  |
| [6006](#L6006) | if ($question\_enable\_text\_message && $question\_text\_max\_length != 0 && $question\_text\_max\_length != '') { |
| [6007](#L6007) | $ays\_quiz\_question\_text\_message\_html .= '<div class="ays\_quiz\_question\_text\_conteiner">'; |
| [6008](#L6008) | $ays\_quiz\_question\_text\_message\_html .= '<div class="ays\_quiz\_question\_text\_message">'; |
| [6009](#L6009) | $ays\_quiz\_question\_text\_message\_html .= '<span class="ays\_quiz\_question\_text\_message\_span">'. $question\_text\_max\_length . '</span> ' . $question\_limit\_text\_type . ' ' . \_\_( 'left' , $this->plugin\_name ); |
| [6010](#L6010) | $ays\_quiz\_question\_text\_message\_html .= '</div>'; |
| [6011](#L6011) | $ays\_quiz\_question\_text\_message\_html .= '</div>'; |
| [6012](#L6012) | } |
| [6013](#L6013) | } |
| [6014](#L6014) |  |
| [6015](#L6015) | // Enable case sensitive text |
| [6016](#L6016) | $enable\_case\_sensitive\_text = ( isset($options['enable\_case\_sensitive\_text']) && $options['enable\_case\_sensitive\_text'] != '' ) ? $options['enable\_case\_sensitive\_text'] : false; |
| [6017](#L6017) |  |
| [6018](#L6018) | $answer\_container = "<div class='ays-field ays-text-field'>"; |
| [6019](#L6019) | foreach ($answers as $answer) { |
| [6020](#L6020) | $placeholder = isset($answer["placeholder"]) && $answer["placeholder"] != '' ? stripslashes(htmlentities($answer["placeholder"], ENT\_QUOTES)) : ''; |
| [6021](#L6021) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? $answer["image"] : ""; |
| [6022](#L6022) | $answer\_container .= "<textarea style='$enable\_correction\_textarea' type='text' placeholder='$placeholder' class='ays-text-input ". $ays\_question\_limit\_length\_class ."' autocomplete='off' name='ays\_questions[ays-question-{$question\_id}]' data-question-id='". $question\_id ."' ></textarea> |
| [6023](#L6023) | <input type='hidden' name='ays\_answer\_correct[]' value='0'/> |
| [6024](#L6024) | <button type='button' style='$enable\_correction' class='ays\_check\_answer action-button ". $question\_not\_influence\_class ."'>".$this->buttons\_texts['checkButton']."</button>"; |
| [6025](#L6025) | $answer\_container .= "<script> |
| [6026](#L6026) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [6027](#L6027) | window.quizOptions\_$quiz\_id = []; |
| [6028](#L6028) | } |
| [6029](#L6029) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode(array( |
| [6030](#L6030) | 'question\_type' => 'text', |
| [6031](#L6031) | 'question\_answer' => htmlspecialchars\_decode(stripslashes($answer["answer"]), ENT\_QUOTES), |
| [6032](#L6032) | 'enable\_question\_text\_max\_length' => $enable\_question\_text\_max\_length, |
| [6033](#L6033) | 'question\_text\_max\_length' => $question\_text\_max\_length, |
| [6034](#L6034) | 'question\_limit\_text\_type' => $question\_limit\_text\_type, |
| [6035](#L6035) | 'question\_enable\_text\_message' => $question\_enable\_text\_message, |
| [6036](#L6036) | 'enable\_case\_sensitive\_text' => $enable\_case\_sensitive\_text, |
| [6037](#L6037) | ))) . "'; |
| [6038](#L6038) | </script>"; |
| [6039](#L6039) | } |
| [6040](#L6040) |  |
| [6041](#L6041) | $answer\_container .= "</div>"; |
| [6042](#L6042) | $answer\_container .= $ays\_quiz\_question\_text\_message\_html; |
| [6043](#L6043) | return $answer\_container; |
| [6044](#L6044) | } |
| [6045](#L6045) |  |
| [6046](#L6046) | protected function ays\_short\_text\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [6047](#L6047) | $enable\_correction = $options['correction'] ? "display:inline-block;white-space: nowrap;" : "display:none"; |
| [6048](#L6048) | $enable\_correction\_textarea = $options['correction'] ? "width:100%;" : "width:100%;"; |
| [6049](#L6049) | $is\_enable\_question\_max\_length = $this->ays\_quiz\_is\_enable\_question\_max\_length( $question\_id , 'short\_text' ); |
| [6050](#L6050) |  |
| [6051](#L6051) | $question\_not\_influence\_class  = ""; |
| [6052](#L6052) | if ( $this->is\_question\_not\_influence( $question\_id ) ) { |
| [6053](#L6053) | $question\_not\_influence\_class  = "ays\_display\_none"; |
| [6054](#L6054) | $enable\_correction\_textarea    = "width:100%;"; |
| [6055](#L6055) | } |
| [6056](#L6056) |  |
| [6057](#L6057) | $question\_text\_max\_length\_array = (isset($options['questionMaxLengthArray']) && ! empty($options['questionMaxLengthArray'])) ? $options['questionMaxLengthArray'] : array(); |
| [6058](#L6058) |  |
| [6059](#L6059) | $ays\_question\_limit\_length\_class = ''; |
| [6060](#L6060) | $ays\_quiz\_question\_text\_message\_html = ''; |
| [6061](#L6061) | $enable\_question\_text\_max\_length = false; |
| [6062](#L6062) | $question\_text\_max\_length = ''; |
| [6063](#L6063) | $question\_limit\_text\_type = 'characters'; |
| [6064](#L6064) | $question\_enable\_text\_message = false; |
| [6065](#L6065) | if (! empty($question\_text\_max\_length\_array) ) { |
| [6066](#L6066) |  |
| [6067](#L6067) | $enable\_question\_text\_max\_length = $question\_text\_max\_length\_array['enable\_question\_text\_max\_length']; |
| [6068](#L6068) |  |
| [6069](#L6069) | $question\_text\_max\_length = $question\_text\_max\_length\_array['question\_text\_max\_length']; |
| [6070](#L6070) |  |
| [6071](#L6071) | $question\_limit\_text\_type = $question\_text\_max\_length\_array['question\_limit\_text\_type']; |
| [6072](#L6072) |  |
| [6073](#L6073) | $question\_enable\_text\_message = $question\_text\_max\_length\_array['question\_enable\_text\_message']; |
| [6074](#L6074) | } |
| [6075](#L6075) |  |
| [6076](#L6076) | if( $is\_enable\_question\_max\_length ){ |
| [6077](#L6077) | $ays\_question\_limit\_length\_class = 'ays\_question\_limit\_length'; |
| [6078](#L6078) |  |
| [6079](#L6079) | if ($question\_enable\_text\_message && $question\_text\_max\_length != 0 && $question\_text\_max\_length != '') { |
| [6080](#L6080) | $ays\_quiz\_question\_text\_message\_html .= '<div class="ays\_quiz\_question\_text\_conteiner">'; |
| [6081](#L6081) | $ays\_quiz\_question\_text\_message\_html .= '<div class="ays\_quiz\_question\_text\_message">'; |
| [6082](#L6082) | $ays\_quiz\_question\_text\_message\_html .= '<span class="ays\_quiz\_question\_text\_message\_span">'. $question\_text\_max\_length . '</span> ' . $question\_limit\_text\_type . ' ' . \_\_( 'left' , $this->plugin\_name ); |
| [6083](#L6083) | $ays\_quiz\_question\_text\_message\_html .= '</div>'; |
| [6084](#L6084) | $ays\_quiz\_question\_text\_message\_html .= '</div>'; |
| [6085](#L6085) | } |
| [6086](#L6086) | } |
| [6087](#L6087) |  |
| [6088](#L6088) | // Enable case sensitive text |
| [6089](#L6089) | $enable\_case\_sensitive\_text = ( isset($options['enable\_case\_sensitive\_text']) && $options['enable\_case\_sensitive\_text'] != '' ) ? $options['enable\_case\_sensitive\_text'] : false; |
| [6090](#L6090) |  |
| [6091](#L6091) | $answer\_container = "<div class='ays-field ays-text-field'>"; |
| [6092](#L6092) | foreach ($answers as $answer) { |
| [6093](#L6093) | $placeholder = isset($answer["placeholder"]) && $answer["placeholder"] != '' ? stripslashes(htmlentities($answer["placeholder"], ENT\_QUOTES)) : ''; |
| [6094](#L6094) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? $answer["image"] : ""; |
| [6095](#L6095) | $answer\_container .= "<input style='$enable\_correction\_textarea' type='text' placeholder='$placeholder' class='ays-text-input ". $ays\_question\_limit\_length\_class ."' autocomplete='off' name='ays\_questions[ays-question-{$question\_id}]' data-question-id='". $question\_id ."'> |
| [6096](#L6096) | <input type='hidden' name='ays\_answer\_correct[]' value='0'/> |
| [6097](#L6097) | <button type='button' style='$enable\_correction' class='ays\_check\_answer action-button ". $question\_not\_influence\_class ."'>".$this->buttons\_texts['checkButton']."</button>"; |
| [6098](#L6098) | $answer\_container .= "<script> |
| [6099](#L6099) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [6100](#L6100) | window.quizOptions\_$quiz\_id = []; |
| [6101](#L6101) | } |
| [6102](#L6102) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode(array( |
| [6103](#L6103) | 'question\_type' => 'short\_text', |
| [6104](#L6104) | 'question\_answer' => htmlspecialchars\_decode(stripslashes($answer["answer"]), ENT\_QUOTES), |
| [6105](#L6105) | 'enable\_question\_text\_max\_length' => $enable\_question\_text\_max\_length, |
| [6106](#L6106) | 'question\_text\_max\_length' => $question\_text\_max\_length, |
| [6107](#L6107) | 'question\_limit\_text\_type' => $question\_limit\_text\_type, |
| [6108](#L6108) | 'question\_enable\_text\_message' => $question\_enable\_text\_message, |
| [6109](#L6109) | 'enable\_case\_sensitive\_text' => $enable\_case\_sensitive\_text |
| [6110](#L6110) | ))) . "'; |
| [6111](#L6111) | </script>"; |
| [6112](#L6112) | } |
| [6113](#L6113) |  |
| [6114](#L6114) | $answer\_container .= "</div>"; |
| [6115](#L6115) | $answer\_container .= $ays\_quiz\_question\_text\_message\_html; |
| [6116](#L6116) | return $answer\_container; |
| [6117](#L6117) | } |
| [6118](#L6118) |  |
| [6119](#L6119) | protected function ays\_number\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [6120](#L6120) | $enable\_correction = $options['correction'] ? "display:inline-block;white-space: nowrap;" : "display:none"; |
| [6121](#L6121) | $enable\_correction\_textarea = $options['correction'] ? "width:100%;" : "width:100%;"; |
| [6122](#L6122) | $is\_enable\_question\_max\_length = $this->ays\_quiz\_is\_enable\_question\_max\_length( $question\_id , 'number' ); |
| [6123](#L6123) |  |
| [6124](#L6124) | $question\_not\_influence\_class  = ""; |
| [6125](#L6125) | if ( $this->is\_question\_not\_influence( $question\_id ) ) { |
| [6126](#L6126) | $question\_not\_influence\_class  = "ays\_display\_none"; |
| [6127](#L6127) | $enable\_correction\_textarea    = "width:100%;"; |
| [6128](#L6128) | } |
| [6129](#L6129) |  |
| [6130](#L6130) | $question\_text\_max\_length\_array = (isset($options['questionMaxLengthArray']) && ! empty($options['questionMaxLengthArray'])) ? $options['questionMaxLengthArray'] : array(); |
| [6131](#L6131) |  |
| [6132](#L6132) | $ays\_question\_limit\_length\_class        = ''; |
| [6133](#L6133) | $ays\_quiz\_question\_number\_message\_html  = ''; |
| [6134](#L6134) | $question\_number\_min\_message\_html       = ''; |
| [6135](#L6135) | $question\_number\_error\_message          = ''; |
| [6136](#L6136) | $question\_number\_error\_message\_html     = ''; |
| [6137](#L6137) |  |
| [6138](#L6138) | $enable\_question\_number\_max\_length      = false; |
| [6139](#L6139) | $enable\_question\_number\_min\_length      = false; |
| [6140](#L6140) | $enable\_question\_number\_error\_message   = false; |
| [6141](#L6141) |  |
| [6142](#L6142) | $question\_number\_max\_length = ''; |
| [6143](#L6143) | $question\_number\_min\_length = ''; |
| [6144](#L6144) |  |
| [6145](#L6145) | if (! empty($question\_text\_max\_length\_array) ) { |
| [6146](#L6146) |  |
| [6147](#L6147) | $enable\_question\_number\_max\_length      = $question\_text\_max\_length\_array['enable\_question\_number\_max\_length']; |
| [6148](#L6148) | $question\_number\_max\_length             = $question\_text\_max\_length\_array['question\_number\_max\_length']; |
| [6149](#L6149) |  |
| [6150](#L6150) | $enable\_question\_number\_min\_length      = $question\_text\_max\_length\_array['enable\_question\_number\_min\_length']; |
| [6151](#L6151) | $question\_number\_min\_length             = $question\_text\_max\_length\_array['question\_number\_min\_length']; |
| [6152](#L6152) |  |
| [6153](#L6153) | $enable\_question\_number\_error\_message   = $question\_text\_max\_length\_array['enable\_question\_number\_error\_message']; |
| [6154](#L6154) | $question\_number\_error\_message          = $question\_text\_max\_length\_array['question\_number\_error\_message']; |
| [6155](#L6155) | } |
| [6156](#L6156) |  |
| [6157](#L6157) | if( $is\_enable\_question\_max\_length ){ |
| [6158](#L6158) | $ays\_question\_limit\_length\_class = 'ays\_question\_number\_limit\_length'; |
| [6159](#L6159) |  |
| [6160](#L6160) | if ($question\_number\_max\_length != 0 && $question\_number\_max\_length != '') { |
| [6161](#L6161) | $ays\_quiz\_question\_number\_message\_html .= 'max="'. $question\_number\_max\_length .'"'; |
| [6162](#L6162) | } |
| [6163](#L6163) | } |
| [6164](#L6164) |  |
| [6165](#L6165) | if ( $enable\_question\_number\_min\_length ) { |
| [6166](#L6166) | $ays\_question\_limit\_length\_class = 'ays\_question\_number\_limit\_length'; |
| [6167](#L6167) |  |
| [6168](#L6168) | if ($question\_number\_min\_length != 0 && $question\_number\_min\_length != '') { |
| [6169](#L6169) | $question\_number\_min\_message\_html .= 'min="'. $question\_number\_min\_length .'"'; |
| [6170](#L6170) | } |
| [6171](#L6171) | } |
| [6172](#L6172) |  |
| [6173](#L6173) | if ( $enable\_question\_number\_error\_message ) { |
| [6174](#L6174) | $ays\_question\_limit\_length\_class = 'ays\_question\_number\_limit\_length'; |
| [6175](#L6175) |  |
| [6176](#L6176) | if ( $question\_number\_error\_message != "" ) { |
| [6177](#L6177) | $question\_number\_error\_message\_html .= "<div class='ays-quiz-number-error-message ays\_display\_none'>"; |
| [6178](#L6178) | $question\_number\_error\_message\_html .= $question\_number\_error\_message; |
| [6179](#L6179) | $question\_number\_error\_message\_html .= "</div>"; |
| [6180](#L6180) | } |
| [6181](#L6181) | } |
| [6182](#L6182) |  |
| [6183](#L6183) | $answer\_container = "<div class='ays-field ays-text-field'>"; |
| [6184](#L6184) | foreach ($answers as $answer) { |
| [6185](#L6185) | $placeholder = isset($answer["placeholder"]) && $answer["placeholder"] != '' ? stripslashes(htmlentities($answer["placeholder"], ENT\_QUOTES)) : ''; |
| [6186](#L6186) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? $answer["image"] : ""; |
| [6187](#L6187) | $answer\_container .= "<input style='$enable\_correction\_textarea' type='number' placeholder='$placeholder' class='ays-text-input ". $ays\_question\_limit\_length\_class ."' ". $ays\_quiz\_question\_number\_message\_html ." ". $question\_number\_min\_message\_html ." name='ays\_questions[ays-question-{$question\_id}]' data-question-id='". $question\_id ."'> |
| [6188](#L6188) | <input type='hidden' name='ays\_answer\_correct[]' value='0'/> |
| [6189](#L6189) | <button type='button' style='$enable\_correction' class='ays\_check\_answer action-button ". $question\_not\_influence\_class ."'>".$this->buttons\_texts['checkButton']."</button>"; |
| [6190](#L6190) | $answer\_container .= "<script> |
| [6191](#L6191) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [6192](#L6192) | window.quizOptions\_$quiz\_id = []; |
| [6193](#L6193) | } |
| [6194](#L6194) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode(array( |
| [6195](#L6195) | 'question\_type' => 'text', |
| [6196](#L6196) | 'question\_answer' => htmlspecialchars(stripslashes($answer["answer"])), |
| [6197](#L6197) | 'enable\_question\_number\_max\_length' => $enable\_question\_number\_max\_length, |
| [6198](#L6198) | 'question\_number\_max\_length' => $question\_number\_max\_length, |
| [6199](#L6199) | 'enable\_question\_number\_min\_length' => $enable\_question\_number\_min\_length, |
| [6200](#L6200) | 'question\_number\_min\_length' => $question\_number\_min\_length, |
| [6201](#L6201) | 'enable\_question\_number\_error\_message' => $enable\_question\_number\_error\_message, |
| [6202](#L6202) | 'question\_number\_error\_message' => $question\_number\_error\_message, |
| [6203](#L6203) | ))) . "'; |
| [6204](#L6204) | </script>"; |
| [6205](#L6205) | } |
| [6206](#L6206) |  |
| [6207](#L6207) | $answer\_container .= "</div>"; |
| [6208](#L6208) |  |
| [6209](#L6209) | $answer\_container .= $question\_number\_error\_message\_html; |
| [6210](#L6210) |  |
| [6211](#L6211) | return $answer\_container; |
| [6212](#L6212) | } |
| [6213](#L6213) |  |
| [6214](#L6214) | protected function ays\_date\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [6215](#L6215) | $enable\_correction = $options['correction'] ? "display:inline-block;white-space: nowrap;" : "display:none"; |
| [6216](#L6216) | $enable\_correction\_textarea = $options['correction'] ? "width:100%;" : "width:100%;"; |
| [6217](#L6217) |  |
| [6218](#L6218) | $question\_not\_influence\_class  = ""; |
| [6219](#L6219) | if ( $this->is\_question\_not\_influence( $question\_id ) ) { |
| [6220](#L6220) | $question\_not\_influence\_class  = "ays\_display\_none"; |
| [6221](#L6221) | $enable\_correction\_textarea    = "width:100%;"; |
| [6222](#L6222) | } |
| [6223](#L6223) | $answer\_container = "<div class='ays-field ays-text-field'>"; |
| [6224](#L6224) | foreach ($answers as $answer) { |
| [6225](#L6225) | $placeholder = isset($answer["placeholder"]) && $answer["placeholder"] != '' ? stripslashes(htmlentities($answer["placeholder"], ENT\_QUOTES)) : ''; |
| [6226](#L6226) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? $answer["image"] : ""; |
| [6227](#L6227) | $answer\_container .= "<input style='$enable\_correction\_textarea' type='date' autocomplete='off' placeholder='$placeholder' class='ays-text-input' name='ays\_questions[ays-question-{$question\_id}]'> |
| [6228](#L6228) | <input type='hidden' name='ays\_answer\_correct[]' value='0'/> |
| [6229](#L6229) | <button type='button' style='$enable\_correction' class='ays\_check\_answer action-button ". $question\_not\_influence\_class ."'>".$this->buttons\_texts['checkButton']."</button>"; |
| [6230](#L6230) | $answer\_container .= "<script> |
| [6231](#L6231) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [6232](#L6232) | window.quizOptions\_$quiz\_id = []; |
| [6233](#L6233) | } |
| [6234](#L6234) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode(array( |
| [6235](#L6235) | 'question\_type' => 'date', |
| [6236](#L6236) | 'question\_answer' => htmlspecialchars(stripslashes($answer["answer"])) |
| [6237](#L6237) | ))) . "'; |
| [6238](#L6238) | </script>"; |
| [6239](#L6239) | } |
| [6240](#L6240) |  |
| [6241](#L6241) | $answer\_container .= "</div>"; |
| [6242](#L6242) | return $answer\_container; |
| [6243](#L6243) | } |
| [6244](#L6244) |  |
| [6245](#L6245) | protected function ays\_dropdown\_answer\_html($question\_id, $quiz\_id, $answers, $options){ |
| [6246](#L6246) | $show\_answers\_numbering = (isset($options['show\_answers\_numbering']) && $options['show\_answers\_numbering'] != '') ? $options['show\_answers\_numbering'] : 'none'; |
| [6247](#L6247) | $numbering\_type\_arr = $this->ays\_answer\_numbering($show\_answers\_numbering); |
| [6248](#L6248) | $numbering\_type = ''; |
| [6249](#L6249) | $script\_data\_arr = array(); |
| [6250](#L6250) | $question\_answer = array(); |
| [6251](#L6251) | $answer\_container\_script\_html = ""; |
| [6252](#L6252) | $answer\_container = "<div class='ays-field ays-select-field'> |
| [6253](#L6253) | <select class='ays-select'> |
| [6254](#L6254) | <option value=''>".\_\_('Select an answer', $this->plugin\_name)."</option>"; |
| [6255](#L6255) | foreach ($answers as $key => $answer) { |
| [6256](#L6256) | if ( ! empty($numbering\_type\_arr) ) { |
| [6257](#L6257) | $numbering\_type = (isset($numbering\_type\_arr[$key]) && $numbering\_type\_arr[$key] != '') ? $numbering\_type\_arr[$key] :''; |
| [6258](#L6258) | $numbering\_type = $numbering\_type . ' '; |
| [6259](#L6259) | } |
| [6260](#L6260) |  |
| [6261](#L6261) | $correct\_answer\_flag = 'ays\_answer\_image\_class'; |
| [6262](#L6262) | if( isset($\_GET['ays\_quiz\_answers']) && sanitize\_key( $\_GET['ays\_quiz\_answers'] ) == 'error404' && $answer["correct"] == 1 ){ |
| [6263](#L6263) | $correct\_answer\_flag = 'ays\_anser\_image\_class'; |
| [6264](#L6264) | } |
| [6265](#L6265) |  |
| [6266](#L6266) | $question\_answer[ $answer["id"] ] = htmlspecialchars\_decode(stripslashes($answer["correct"]), ENT\_QUOTES); |
| [6267](#L6267) |  |
| [6268](#L6268) | $answer\_image = (isset($answer['image']) && $answer['image'] != '') ? $answer["image"] : ""; |
| [6269](#L6269) | $answer\_container .= "<option data-nkar='{$answer\_image}' data-chisht='0' class='ays\_answer\_image {$correct\_answer\_flag}' value='{$answer["id"]}'>" . $numbering\_type . do\_shortcode(htmlspecialchars(stripslashes($answer["answer"]))) . "</option>"; |
| [6270](#L6270) | } |
| [6271](#L6271) | $answer\_container .= "</select>"; |
| [6272](#L6272) | $answer\_container .= "<input class='ays-select-field-value' type='hidden' name='ays\_questions[ays-question-{$question\_id}]' value=''/>"; |
| [6273](#L6273) |  |
| [6274](#L6274) | foreach ($answers as $answer) { |
| [6275](#L6275) | $answer\_container .= "<input type='hidden' name='ays\_answer\_correct[]' data-id='{$answer["id"]}' value='0'/>"; |
| [6276](#L6276) | } |
| [6277](#L6277) | $answer\_container .= "</div>"; |
| [6278](#L6278) |  |
| [6279](#L6279) | $script\_data\_arr['question\_answer'] = $question\_answer; |
| [6280](#L6280) |  |
| [6281](#L6281) | $answer\_container\_script\_html .= '<script>'; |
| [6282](#L6282) | $answer\_container\_script\_html .= " |
| [6283](#L6283) | if(typeof window.quizOptions\_$quiz\_id === 'undefined'){ |
| [6284](#L6284) | window.quizOptions\_$quiz\_id = []; |
| [6285](#L6285) | } |
| [6286](#L6286) | window.quizOptions\_".$quiz\_id."['".$question\_id."'] = '" . base64\_encode(json\_encode($script\_data\_arr)) . "';"; |
| [6287](#L6287) | $answer\_container\_script\_html .= '</script>'; |
| [6288](#L6288) |  |
| [6289](#L6289) | $answer\_container .= $answer\_container\_script\_html; |
| [6290](#L6290) |  |
| [6291](#L6291) | return $answer\_container; |
| [6292](#L6292) | } |
| [6293](#L6293) |  |
| [6294](#L6294) | protected function isHomogenousStrong($arr, $question\_id){ |
| [6295](#L6295) | $arr\_count = count( $arr ); |
| [6296](#L6296) | $arr\_sum = array\_sum( $arr ); |
| [6297](#L6297) | $count\_correct = intval( $this->count\_multiple\_correct\_answers($question\_id) ); |
| [6298](#L6298) | $a = $arr\_count - $arr\_sum; |
| [6299](#L6299) | $b = $arr\_sum - $a; |
| [6300](#L6300) |  |
| [6301](#L6301) | return $b / $count\_correct; |
| [6302](#L6302) | } |
| [6303](#L6303) |  |
| [6304](#L6304) | protected function isHomogenous($arr, $question\_id){ |
| [6305](#L6305) | $mustBe = true; |
| [6306](#L6306) | $count = 0; |
| [6307](#L6307) | foreach ($arr as $val) { |
| [6308](#L6308) | if ($mustBe !== $val) { |
| [6309](#L6309) | return false; |
| [6310](#L6310) | } |
| [6311](#L6311) | $count++; |
| [6312](#L6312) | } |
| [6313](#L6313) | $count\_correct = intval( $this->count\_multiple\_correct\_answers($question\_id) ); |
| [6314](#L6314) | if($count !== $count\_correct){ |
| [6315](#L6315) | return false; |
| [6316](#L6316) | } |
| [6317](#L6317) | return true; |
| [6318](#L6318) | } |
| [6319](#L6319) |  |
| [6320](#L6320) | protected function get\_question\_weight($id){ |
| [6321](#L6321) | //global $wpdb; |
| [6322](#L6322) | //$sql = "SELECT weight FROM {$wpdb->prefix}aysquiz\_questions WHERE id = $id"; |
| [6323](#L6323) | //$result = $wpdb->get\_var($sql); |
| [6324](#L6324) | //return intval($result); |
| [6325](#L6325) | return 1; |
| [6326](#L6326) | } |
| [6327](#L6327) |  |
| [6328](#L6328) | protected function hex2rgba($color, $opacity = false){ |
| [6329](#L6329) |  |
| [6330](#L6330) | $default = 'rgb(0,0,0)'; |
| [6331](#L6331) |  |
| [6332](#L6332) | //Return default if no color provided |
| [6333](#L6333) | if (empty($color)) |
| [6334](#L6334) | return $default; |
| [6335](#L6335) |  |
| [6336](#L6336) | //Sanitize $color if "#" is provided |
| [6337](#L6337) | if ($color[0] == '#') { |
| [6338](#L6338) | $color = substr($color, 1); |
| [6339](#L6339) | }else{ |
| [6340](#L6340) | return $color; |
| [6341](#L6341) | } |
| [6342](#L6342) |  |
| [6343](#L6343) | //Check if color has 6 or 3 characters and get values |
| [6344](#L6344) | if (strlen($color) == 6) { |
| [6345](#L6345) | $hex = array($color[0] . $color[1], $color[2] . $color[3], $color[4] . $color[5]); |
| [6346](#L6346) | } elseif (strlen($color) == 3) { |
| [6347](#L6347) | $hex = array($color[0] . $color[0], $color[1] . $color[1], $color[2] . $color[2]); |
| [6348](#L6348) | } else { |
| [6349](#L6349) | return $default; |
| [6350](#L6350) | } |
| [6351](#L6351) |  |
| [6352](#L6352) | //Convert hexadec to rgb |
| [6353](#L6353) | $rgb = array\_map('hexdec', $hex); |
| [6354](#L6354) |  |
| [6355](#L6355) | //Check if opacity is set(rgba or rgb) |
| [6356](#L6356) | if ($opacity) { |
| [6357](#L6357) | if (abs($opacity) > 1) |
| [6358](#L6358) | $opacity = 1.0; |
| [6359](#L6359) | $output = 'rgba(' . implode(",", $rgb) . ',' . $opacity . ')'; |
| [6360](#L6360) | } else { |
| [6361](#L6361) | $output = 'rgb(' . implode(",", $rgb) . ')'; |
| [6362](#L6362) | } |
| [6363](#L6363) |  |
| [6364](#L6364) | //Return rgb(a) color string |
| [6365](#L6365) | return $output; |
| [6366](#L6366) | } |
| [6367](#L6367) |  |
| [6368](#L6368) | public static function secondsToWords($seconds){ |
| [6369](#L6369) | $ret = ""; |
| [6370](#L6370) | $seconds = absint($seconds); |
| [6371](#L6371) |  |
| [6372](#L6372) | /\*\*\* get the days \*\*\*/ |
| [6373](#L6373) | $days = (int)($seconds / 86400); |
| [6374](#L6374) | if ($days > 0) { |
| [6375](#L6375) | $ret .= sprintf( \_\_('%s days', AYS\_QUIZ\_NAME ), $days ) . " "; |
| [6376](#L6376) | } |
| [6377](#L6377) |  |
| [6378](#L6378) | /\*\*\* get the hours \*\*\*/ |
| [6379](#L6379) | $hours = (int)(($seconds - ($days \* 86400)) / 3600); |
| [6380](#L6380) | if ($hours > 0) { |
| [6381](#L6381) | $ret .= sprintf( \_\_('%s hours', AYS\_QUIZ\_NAME ), $hours ) . " "; |
| [6382](#L6382) | } |
| [6383](#L6383) |  |
| [6384](#L6384) | /\*\*\* get the minutes \*\*\*/ |
| [6385](#L6385) | $minutes = (int)(($seconds - $days \* 86400 - $hours \* 3600) / 60); |
| [6386](#L6386) | if ($minutes > 0) { |
| [6387](#L6387) | $ret .= sprintf( \_\_('%s minutes', AYS\_QUIZ\_NAME ), $minutes ) . " "; |
| [6388](#L6388) | } |
| [6389](#L6389) |  |
| [6390](#L6390) | /\*\*\* get the seconds \*\*\*/ |
| [6391](#L6391) | $seconds = (int)($seconds - ($days \* 86400) - ($hours \* 3600) - ($minutes \* 60)); |
| [6392](#L6392) | if ($seconds > 0) { |
| [6393](#L6393) | $ret .= sprintf( \_\_('%s seconds', AYS\_QUIZ\_NAME ), $seconds ); |
| [6394](#L6394) | } |
| [6395](#L6395) |  |
| [6396](#L6396) | return $ret; |
| [6397](#L6397) | } |
| [6398](#L6398) |  |
| [6399](#L6399) | protected function add\_results\_to\_db($data){ |
| [6400](#L6400) | global $wpdb; |
| [6401](#L6401) | $results\_table = $wpdb->prefix . 'aysquiz\_reports'; |
| [6402](#L6402) |  |
| [6403](#L6403) | $user\_ip = $data['user\_ip']; |
| [6404](#L6404) | $user\_name = $data['user\_name']; |
| [6405](#L6405) | $user\_email = $data['user\_email']; |
| [6406](#L6406) | $user\_phone = $data['user\_phone']; |
| [6407](#L6407) | $quiz\_id = $data['quiz\_id']; |
| [6408](#L6408) | $start\_date = $data['start\_date']; |
| [6409](#L6409) | $end\_date = $data['end\_date']; |
| [6410](#L6410) | $duration = strtotime($end\_date) - strtotime($start\_date); |
| [6411](#L6411) | $score = $data['score']; |
| [6412](#L6412) | $options = array(); |
| [6413](#L6413) | $options = $data['answered']; |
| [6414](#L6414) | $calc\_method = $data['calc\_method']; |
| [6415](#L6415) | $options['passed\_time'] = $this->get\_time\_difference($start\_date, $end\_date); |
| [6416](#L6416) | $options['calc\_method'] = $calc\_method; |
| [6417](#L6417) |  |
| [6418](#L6418) | $quiz\_attributes\_information = array(); |
| [6419](#L6419) | $quiz\_attributes = $this->get\_quiz\_attributes\_by\_id($quiz\_id); |
| [6420](#L6420) |  |
| [6421](#L6421) | $options['attributes\_information'] = $quiz\_attributes\_information; |
| [6422](#L6422) | $results = $wpdb->insert( |
| [6423](#L6423) | $results\_table, |
| [6424](#L6424) | array( |
| [6425](#L6425) | 'quiz\_id' => absint(intval($quiz\_id)), |
| [6426](#L6426) | 'user\_id' => get\_current\_user\_id(), |
| [6427](#L6427) | 'user\_name' => $user\_name, |
| [6428](#L6428) | 'user\_email' => $user\_email, |
| [6429](#L6429) | 'user\_phone' => $user\_phone, |
| [6430](#L6430) | 'user\_ip' => $user\_ip, |
| [6431](#L6431) | 'start\_date' => $start\_date, |
| [6432](#L6432) | 'end\_date' => $end\_date, |
| [6433](#L6433) | 'duration' => $duration, |
| [6434](#L6434) | 'score' => $score, |
| [6435](#L6435) | 'options' => json\_encode($options) |
| [6436](#L6436) | ), |
| [6437](#L6437) | array( |
| [6438](#L6438) | '%d', // quiz\_id |
| [6439](#L6439) | '%d', // user\_id |
| [6440](#L6440) | '%s', // user\_name |
| [6441](#L6441) | '%s', // user\_email |
| [6442](#L6442) | '%s', // user\_phone |
| [6443](#L6443) | '%s', // user\_ip |
| [6444](#L6444) | '%s', // start\_date |
| [6445](#L6445) | '%s', // end\_date |
| [6446](#L6446) | '%s', // duration |
| [6447](#L6447) | '%d', // score |
| [6448](#L6448) | '%s', // options |
| [6449](#L6449) | ) |
| [6450](#L6450) | ); |
| [6451](#L6451) |  |
| [6452](#L6452) | if ($results >= 0) { |
| [6453](#L6453) | return true; |
| [6454](#L6454) | } |
| [6455](#L6455) |  |
| [6456](#L6456) | return false; |
| [6457](#L6457) | } |
| [6458](#L6458) |  |
| [6459](#L6459) | protected function ays\_get\_count\_of\_rates($id){ |
| [6460](#L6460) | global $wpdb; |
| [6461](#L6461) | $sql = "SELECT COUNT(`id`) AS count FROM {$wpdb->prefix}aysquiz\_rates WHERE quiz\_id= $id"; |
| [6462](#L6462) | $result = $wpdb->get\_var($sql); |
| [6463](#L6463) | return $result; |
| [6464](#L6464) | } |
| [6465](#L6465) |  |
| [6466](#L6466) | protected function ays\_get\_count\_of\_reviews($start, $limit, $quiz\_id){ |
| [6467](#L6467) | global $wpdb; |
| [6468](#L6468) | $sql = "SELECT COUNT(`id`) AS count FROM {$wpdb->prefix}aysquiz\_rates WHERE (review<>'' OR options<>'') AND quiz\_id = $quiz\_id ORDER BY id DESC LIMIT $start, $limit"; |
| [6469](#L6469) | $result = $wpdb->get\_var($sql); |
| [6470](#L6470) | return $result; |
| [6471](#L6471) | } |
| [6472](#L6472) |  |
| [6473](#L6473) | protected function ays\_set\_rate\_id\_of\_result($id , $last\_result\_id){ |
| [6474](#L6474) | global $wpdb; |
| [6475](#L6475) | $results\_table = $wpdb->prefix . 'aysquiz\_reports'; |
| [6476](#L6476) | $sql = "SELECT \* FROM $results\_table WHERE id = ".intval($last\_result\_id); |
| [6477](#L6477) | $res = $wpdb->get\_row($sql, ARRAY\_A); |
| [6478](#L6478) | $options = json\_decode($res['options'], true); |
| [6479](#L6479) | $options['rate\_id'] = $id; |
| [6480](#L6480) | $results = $wpdb->update( |
| [6481](#L6481) | $results\_table, |
| [6482](#L6482) | array( 'options' => json\_encode($options) ), |
| [6483](#L6483) | array( 'id' => intval($last\_result\_id) ), |
| [6484](#L6484) | array( '%s' ), |
| [6485](#L6485) | array( '%d' ) |
| [6486](#L6486) | ); |
| [6487](#L6487) | if($results !== false){ |
| [6488](#L6488) | return true; |
| [6489](#L6489) | } |
| [6490](#L6490) | return false; |
| [6491](#L6491) | } |
| [6492](#L6492) |  |
| [6493](#L6493) | protected function ays\_get\_average\_of\_rates($id){ |
| [6494](#L6494) | global $wpdb; |
| [6495](#L6495) | $sql = "SELECT AVG(`score`) AS avg\_score FROM {$wpdb->prefix}aysquiz\_rates WHERE quiz\_id= $id"; |
| [6496](#L6496) | $result = $wpdb->get\_var($sql); |
| [6497](#L6497) |  |
| [6498](#L6498) | if ( is\_null( $result ) || empty( $result ) ) { |
| [6499](#L6499) | $result = 0; |
| [6500](#L6500) | } |
| [6501](#L6501) |  |
| [6502](#L6502) | return $result; |
| [6503](#L6503) | } |
| [6504](#L6504) |  |
| [6505](#L6505) | protected function ays\_get\_average\_of\_scores($id){ |
| [6506](#L6506) | global $wpdb; |
| [6507](#L6507) | $sql = "SELECT AVG(`score`) FROM {$wpdb->prefix}aysquiz\_reports WHERE quiz\_id= $id"; |
| [6508](#L6508) |  |
| [6509](#L6509) | $avg\_result = $wpdb->get\_var($sql); |
| [6510](#L6510) | if ( is\_null( $avg\_result ) || empty( $avg\_result ) ) { |
| [6511](#L6511) | $avg\_result = 0; |
| [6512](#L6512) | } |
| [6513](#L6513) |  |
| [6514](#L6514) | $result = round($avg\_result); |
| [6515](#L6515) | return $result; |
| [6516](#L6516) | } |
| [6517](#L6517) |  |
| [6518](#L6518) | protected function ays\_get\_reasons\_of\_rates($start, $limit, $quiz\_id){ |
| [6519](#L6519) | global $wpdb; |
| [6520](#L6520) | $sql = "SELECT \* FROM {$wpdb->prefix}aysquiz\_rates WHERE quiz\_id=$quiz\_id AND (review<>'' OR options<>'') ORDER BY id DESC LIMIT $start, $limit"; |
| [6521](#L6521) | $result = $wpdb->get\_results($sql, "ARRAY\_A"); |
| [6522](#L6522) | return $result; |
| [6523](#L6523) | } |
| [6524](#L6524) |  |
| [6525](#L6525) | protected function ays\_get\_full\_reasons\_of\_rates($start, $limit, $quiz\_id, $zuyga){ |
| [6526](#L6526) | $quiz\_rate\_reasons = $this->ays\_get\_reasons\_of\_rates($start, $limit, $quiz\_id); |
| [6527](#L6527) | $quiz\_rate\_html = ""; |
| [6528](#L6528) | foreach($quiz\_rate\_reasons as $key => $reasons){ |
| [6529](#L6529) | $user\_name = !empty($reasons['user\_name']) ? "<span>".$reasons['user\_name']."</span>" : ''; |
| [6530](#L6530) | if($this->isJSON($reasons['options'])){ |
| [6531](#L6531) | $reason = json\_decode($reasons['options'], true)['reason']; |
| [6532](#L6532) | }elseif($reasons['options'] != ''){ |
| [6533](#L6533) | $reason = $reasons['options']; |
| [6534](#L6534) | }else{ |
| [6535](#L6535) | $reason = $reasons['review']; |
| [6536](#L6536) | } |
| [6537](#L6537) | if(intval($reasons['user\_id']) != 0){ |
| [6538](#L6538) | $user\_img = esc\_url( get\_avatar\_url( intval($reasons['user\_id']) ) ); |
| [6539](#L6539) | }else{ |
| [6540](#L6540) | $user\_img = AYS\_QUIZ\_PUBLIC\_URL . "/images/avatar\_2x.png"; |
| [6541](#L6541) | } |
| [6542](#L6542) | $score = $reasons['score']; |
| [6543](#L6543) | $commented = date('M j, Y', strtotime($reasons['rate\_date'])); |
| [6544](#L6544) | if($zuyga == 1){ |
| [6545](#L6545) | $row\_reverse = ($key % 2 == 0) ? 'row\_reverse' : ''; |
| [6546](#L6546) | }else{ |
| [6547](#L6547) | $row\_reverse = ($key % 2 == 0) ? '' : 'row\_reverse'; |
| [6548](#L6548) | } |
| [6549](#L6549) | $quiz\_rate\_html .= "<div class='quiz\_rate\_reasons'> |
| [6550](#L6550) | <div class='rate\_comment\_row $row\_reverse'> |
| [6551](#L6551) | <div class='rate\_comment\_user'> |
| [6552](#L6552) | <div class='thumbnail'> |
| [6553](#L6553) | <img class='img-responsive user-photo' src='".$user\_img."'> |
| [6554](#L6554) | </div> |
| [6555](#L6555) | </div> |
| [6556](#L6556) | <div class='rate\_comment'> |
| [6557](#L6557) | <div class='panel panel-default'> |
| [6558](#L6558) | <div class='panel-heading'> |
| [6559](#L6559) | <i class='ays\_fa ays\_fa\_user'></i> <strong>$user\_name</strong><br/> |
| [6560](#L6560) | <i class='ays\_fa ays\_fa\_clock\_o'></i> $commented<br/> |
| [6561](#L6561) | ".\_\_("Rated", $this->plugin\_name)." <i class='ays\_fa ays\_fa\_star'></i> $score |
| [6562](#L6562) | </div> |
| [6563](#L6563) | <div class='panel-body'><div>". stripslashes(nl2br($reason)) ."</div></div> |
| [6564](#L6564) | </div> |
| [6565](#L6565) | </div> |
| [6566](#L6566) | </div> |
| [6567](#L6567) | </div>"; |
| [6568](#L6568) | } |
| [6569](#L6569) | return $quiz\_rate\_html; |
| [6570](#L6570) | } |
| [6571](#L6571) |  |
| [6572](#L6572) | public function ays\_get\_rate\_last\_reviews(){ |
| [6573](#L6573) |  |
| [6574](#L6574) | $quiz\_id = absint( sanitize\_text\_field( $\_REQUEST["quiz\_id"] ) ); |
| [6575](#L6575) | $this->buttons\_texts = $this->ays\_set\_quiz\_texts($quiz\_id); |
| [6576](#L6576) | $ays\_load\_more\_button\_text = $this->buttons\_texts['loadMoreButton']; |
| [6577](#L6577) |  |
| [6578](#L6578) | $quiz\_rate\_html = "<div class='quiz\_rate\_reasons\_container'>"; |
| [6579](#L6579) | $quiz\_rate\_html .= $this->ays\_get\_full\_reasons\_of\_rates(0, 5, $quiz\_id, 0); |
| [6580](#L6580) | $quiz\_rate\_html .= "</div>"; |
| [6581](#L6581) | if($this->ays\_get\_count\_of\_reviews(0, 5, $quiz\_id) / 5 > 1){ |
| [6582](#L6582) | $quiz\_rate\_html .= "<div class='quiz\_rate\_load\_more'> |
| [6583](#L6583) | <div> |
| [6584](#L6584) | <div data-class='lds-spinner' data-role='loader' class='ays-loader'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div> |
| [6585](#L6585) | </div> |
| [6586](#L6586) | <button type='button' zuyga='1' startfrom='5' class='action-button ays\_load\_more\_review'><i class='ays\_fa ays\_fa\_chevron\_circle\_down'></i> ".$ays\_load\_more\_button\_text."</button> |
| [6587](#L6587) | </div>"; |
| [6588](#L6588) | } |
| [6589](#L6589) | ob\_end\_clean(); |
| [6590](#L6590) | $ob\_get\_clean = ob\_get\_clean(); |
| [6591](#L6591) | echo json\_encode(array( |
| [6592](#L6592) | 'status'         => true, |
| [6593](#L6593) | 'quiz\_rate\_html' => $quiz\_rate\_html |
| [6594](#L6594) | )); |
| [6595](#L6595) | wp\_die(); |
| [6596](#L6596) | } |
| [6597](#L6597) |  |
| [6598](#L6598) | public function ays\_load\_more\_reviews(){ |
| [6599](#L6599) | $quiz\_id = absint( sanitize\_text\_field( $\_REQUEST["quiz\_id"] ) ); |
| [6600](#L6600) | $start = absint( sanitize\_text\_field( $\_REQUEST["start\_from"] ) ); |
| [6601](#L6601) | $zuyga = absint( sanitize\_text\_field( $\_REQUEST["zuyga"] ) ); |
| [6602](#L6602) | $limit = 5; |
| [6603](#L6603) | $quiz\_rate\_html = ""; |
| [6604](#L6604) | $quiz\_rate\_html .= $this->ays\_get\_full\_reasons\_of\_rates($start, $limit, $quiz\_id, $zuyga); |
| [6605](#L6605) | if($quiz\_rate\_html == ""){ |
| [6606](#L6606) | ob\_end\_clean(); |
| [6607](#L6607) | $ob\_get\_clean = ob\_get\_clean(); |
| [6608](#L6608) | echo "<p class='ays\_no\_more'>" . \_\_( "No more reviews", $this->plugin\_name ) . "</p>"; |
| [6609](#L6609) | wp\_die(); |
| [6610](#L6610) | }else{ |
| [6611](#L6611) | ob\_end\_clean(); |
| [6612](#L6612) | $ob\_get\_clean = ob\_get\_clean(); |
| [6613](#L6613) | $quiz\_rate\_html = "<div class='quiz\_rate\_more\_review'>".$quiz\_rate\_html."</div>"; |
| [6614](#L6614) | echo $quiz\_rate\_html; |
| [6615](#L6615) | wp\_die(); |
| [6616](#L6616) | } |
| [6617](#L6617) | } |
| [6618](#L6618) |  |
| [6619](#L6619) | public function ays\_shuffle\_assoc($list) { |
| [6620](#L6620) | if (!is\_array($list)) return $list; |
| [6621](#L6621) |  |
| [6622](#L6622) | $keys = array\_keys($list); |
| [6623](#L6623) | shuffle($keys); |
| [6624](#L6624) | $random = array(); |
| [6625](#L6625) | foreach ($keys as $key) { |
| [6626](#L6626) | $random[$key] = $list[$key]; |
| [6627](#L6627) | } |
| [6628](#L6628) | return $random; |
| [6629](#L6629) | } |
| [6630](#L6630) |  |
| [6631](#L6631) | public function ays\_rate\_the\_quiz(){ |
| [6632](#L6632) | global $wpdb; |
| [6633](#L6633) | $rates\_table = $wpdb->prefix . 'aysquiz\_rates'; |
| [6634](#L6634) |  |
| [6635](#L6635) | $user\_id = get\_current\_user\_id(); |
| [6636](#L6636) |  |
| [6637](#L6637) | $report\_id = (isset($\_REQUEST['last\_result\_id']) && sanitize\_text\_field($\_REQUEST['last\_result\_id']) != '' && ! is\_null( sanitize\_text\_field($\_REQUEST['last\_result\_id']) ) ) ? intval( sanitize\_text\_field( $\_REQUEST['last\_result\_id'] ) ) : 0; |
| [6638](#L6638) |  |
| [6639](#L6639) | // Make responses anonymous |
| [6640](#L6640) | $quiz\_make\_responses\_anonymous = (isset($\_REQUEST['quiz\_make\_responses\_anonymous']) && sanitize\_text\_field($\_REQUEST['quiz\_make\_responses\_anonymous']) == 'true' ) ? true : false; |
| [6641](#L6641) |  |
| [6642](#L6642) | // Make responses anonymous |
| [6643](#L6643) | $quiz\_enable\_user\_cհoosing\_anonymous\_assessment = (isset($\_REQUEST['quiz\_enable\_user\_cհoosing\_anonymous\_assessment']) && sanitize\_text\_field($\_REQUEST['quiz\_enable\_user\_cհoosing\_anonymous\_assessment']) == 'true' ) ? true : false; |
| [6644](#L6644) | $quiz\_enable\_user\_cհoosing\_anonymous\_assessment\_checkbox\_flag = (isset($\_REQUEST['quiz\_enable\_user\_cհoosing\_anonymous\_assessment\_checkbox\_flag']) && sanitize\_text\_field($\_REQUEST['quiz\_enable\_user\_cհoosing\_anonymous\_assessment\_checkbox\_flag']) == 'true' ) ? true : false; |
| [6645](#L6645) |  |
| [6646](#L6646) | $user\_ip = $this->get\_user\_ip(); |
| [6647](#L6647) | if(isset($\_REQUEST['ays\_user\_name']) && sanitize\_text\_field( $\_REQUEST['ays\_user\_name'] ) != ''){ |
| [6648](#L6648) | $user\_name = esc\_sql( sanitize\_text\_field( $\_REQUEST['ays\_user\_name'] ) ); |
| [6649](#L6649) | }elseif(is\_user\_logged\_in()){ |
| [6650](#L6650) | $user = wp\_get\_current\_user(); |
| [6651](#L6651) | $user\_name = $user->data->display\_name; |
| [6652](#L6652) | }else{ |
| [6653](#L6653) | $user\_name = \_\_( 'Anonymous' , AYS\_QUIZ\_NAME ); |
| [6654](#L6654) | } |
| [6655](#L6655) | $user\_email = isset($\_REQUEST['ays\_user\_email']) ? esc\_sql( sanitize\_email( $\_REQUEST['ays\_user\_email'] ) ) : ''; |
| [6656](#L6656) | $user\_phone = isset($\_REQUEST['ays\_user\_phone']) ? esc\_sql( sanitize\_text\_field( $\_REQUEST['ays\_user\_phone'] ) ) : ''; |
| [6657](#L6657) | $quiz\_id = absint( sanitize\_text\_field($\_REQUEST["quiz\_id"]) ); |
| [6658](#L6658) | $score = (isset($\_REQUEST['rate\_score']) && $\_REQUEST['rate\_score'] != "") ? esc\_sql( absint( sanitize\_text\_field( $\_REQUEST['rate\_score'] ) ) ) : 5; |
| [6659](#L6659) | $rate\_date = esc\_sql( sanitize\_text\_field( $\_REQUEST['rate\_date'] ) ); |
| [6660](#L6660) | $rate\_reason = (isset($\_REQUEST['rate\_reason']) && $\_REQUEST['rate\_reason'] != "") ? stripslashes( sanitize\_textarea\_field( $\_REQUEST['rate\_reason'] ) ) : ''; |
| [6661](#L6661) |  |
| [6662](#L6662) | switch ($score) { |
| [6663](#L6663) | case "1": |
| [6664](#L6664) | case "2": |
| [6665](#L6665) | case "3": |
| [6666](#L6666) | case "4": |
| [6667](#L6667) | case "5": |
| [6668](#L6668) | $score = $score; |
| [6669](#L6669) | break; |
| [6670](#L6670) | default: |
| [6671](#L6671) | $score = 5; |
| [6672](#L6672) | break; |
| [6673](#L6673) | } |
| [6674](#L6674) |  |
| [6675](#L6675) | if ( $quiz\_make\_responses\_anonymous ) { |
| [6676](#L6676) | $user\_id     = 0; |
| [6677](#L6677) | $user\_ip     = ''; |
| [6678](#L6678) | $user\_name   = \_\_( 'Anonymous' , AYS\_QUIZ\_NAME ); |
| [6679](#L6679) | $user\_email  = ''; |
| [6680](#L6680) | $user\_phone  = ''; |
| [6681](#L6681) | } |
| [6682](#L6682) |  |
| [6683](#L6683) | if ( $quiz\_enable\_user\_cհoosing\_anonymous\_assessment && $quiz\_enable\_user\_cհoosing\_anonymous\_assessment\_checkbox\_flag ) { |
| [6684](#L6684) | $user\_id     = 0; |
| [6685](#L6685) | $user\_ip     = ''; |
| [6686](#L6686) | $user\_name   = \_\_( 'Anonymous' , AYS\_QUIZ\_NAME ); |
| [6687](#L6687) | $user\_email  = ''; |
| [6688](#L6688) | $user\_phone  = ''; |
| [6689](#L6689) | } |
| [6690](#L6690) |  |
| [6691](#L6691) | $results = $wpdb->insert( |
| [6692](#L6692) | $rates\_table, |
| [6693](#L6693) | array( |
| [6694](#L6694) | 'quiz\_id'     => $quiz\_id, |
| [6695](#L6695) | 'user\_id'     => $user\_id, |
| [6696](#L6696) | 'user\_ip'     => $user\_ip, |
| [6697](#L6697) | 'user\_name'   => $user\_name, |
| [6698](#L6698) | 'user\_email'  => $user\_email, |
| [6699](#L6699) | 'user\_phone'  => $user\_phone, |
| [6700](#L6700) | 'score'       => $score, |
| [6701](#L6701) | 'review'      => $rate\_reason, |
| [6702](#L6702) | 'options'     => '', |
| [6703](#L6703) | 'rate\_date'   => $rate\_date, |
| [6704](#L6704) | ), |
| [6705](#L6705) | array( |
| [6706](#L6706) | '%d', //quiz\_id |
| [6707](#L6707) | '%d', //user\_id |
| [6708](#L6708) | '%s', //user\_ip |
| [6709](#L6709) | '%s', //user\_name |
| [6710](#L6710) | '%s', //user\_email |
| [6711](#L6711) | '%s', //user\_phone |
| [6712](#L6712) | '%s', //score |
| [6713](#L6713) | '%s', //review |
| [6714](#L6714) | '%s', //options |
| [6715](#L6715) | '%s', //rate\_date |
| [6716](#L6716) | ) |
| [6717](#L6717) | ); |
| [6718](#L6718) | $rate\_id = $wpdb->insert\_id; |
| [6719](#L6719) | $avg\_score = $this->ays\_get\_average\_of\_rates($quiz\_id); |
| [6720](#L6720) | if ($results >= 0 && $this->ays\_set\_rate\_id\_of\_result( $rate\_id , $report\_id )) { |
| [6721](#L6721) | ob\_end\_clean(); |
| [6722](#L6722) | $ob\_get\_clean = ob\_get\_clean(); |
| [6723](#L6723) | echo json\_encode(array( |
| [6724](#L6724) | //'rate\_id'     => $rate\_id, |
| [6725](#L6725) | //'result'      => $this->ays\_set\_rate\_id\_of\_result($rate\_id), |
| [6726](#L6726) | 'quiz\_id'       => $quiz\_id, |
| [6727](#L6727) | 'status'        => true, |
| [6728](#L6728) | 'avg\_score'     => round($avg\_score, 1), |
| [6729](#L6729) | 'score'         => intval(round($score)), |
| [6730](#L6730) | 'rates\_count'   => $this->ays\_get\_count\_of\_rates($quiz\_id), |
| [6731](#L6731) | )); |
| [6732](#L6732) | wp\_die(); |
| [6733](#L6733) | } |
| [6734](#L6734) | ob\_end\_clean(); |
| [6735](#L6735) | $ob\_get\_clean = ob\_get\_clean(); |
| [6736](#L6736) | echo json\_encode(array( |
| [6737](#L6737) | 'status'    => false, |
| [6738](#L6738) | )); |
| [6739](#L6739) | wp\_die(); |
| [6740](#L6740) | } |
| [6741](#L6741) |  |
| [6742](#L6742) | protected function get\_user\_by\_ip($id){ |
| [6743](#L6743) | global $wpdb; |
| [6744](#L6744) | $user\_ip = $this->get\_user\_ip(); |
| [6745](#L6745) | $sql = "SELECT COUNT(\*) FROM `{$wpdb->prefix}aysquiz\_reports` WHERE `user\_ip` = '$user\_ip' AND `quiz\_id` = $id"; |
| [6746](#L6746) | $result = $wpdb->get\_var($sql); |
| [6747](#L6747) | return $result; |
| [6748](#L6748) | } |
| [6749](#L6749) |  |
| [6750](#L6750) | protected function get\_limit\_user\_by\_id($quiz\_id, $user\_id){ |
| [6751](#L6751) | global $wpdb; |
| [6752](#L6752) | $sql = "SELECT COUNT(\*) FROM `{$wpdb->prefix}aysquiz\_reports` WHERE `user\_id` = '$user\_id' AND `quiz\_id` = $quiz\_id"; |
| [6753](#L6753) | $result = intval($wpdb->get\_var($sql)); |
| [6754](#L6754) | return $result; |
| [6755](#L6755) | } |
| [6756](#L6756) |  |
| [6757](#L6757) | protected function get\_user\_ip(){ |
| [6758](#L6758) | $ipaddress = ''; |
| [6759](#L6759) | if (getenv('REMOTE\_ADDR')) |
| [6760](#L6760) | $ipaddress = getenv('REMOTE\_ADDR'); |
| [6761](#L6761) | elseif (getenv('HTTP\_CLIENT\_IP')) |
| [6762](#L6762) | $ipaddress = getenv('HTTP\_CLIENT\_IP'); |
| [6763](#L6763) | else if (getenv('HTTP\_X\_FORWARDED\_FOR')) |
| [6764](#L6764) | $ipaddress = getenv('HTTP\_X\_FORWARDED\_FOR'); |
| [6765](#L6765) | else if (getenv('HTTP\_X\_FORWARDED')) |
| [6766](#L6766) | $ipaddress = getenv('HTTP\_X\_FORWARDED'); |
| [6767](#L6767) | else if (getenv('HTTP\_FORWARDED\_FOR')) |
| [6768](#L6768) | $ipaddress = getenv('HTTP\_FORWARDED\_FOR'); |
| [6769](#L6769) | else if (getenv('HTTP\_FORWARDED')) |
| [6770](#L6770) | $ipaddress = getenv('HTTP\_FORWARDED'); |
| [6771](#L6771) | else |
| [6772](#L6772) | $ipaddress = 'UNKNOWN'; |
| [6773](#L6773) | return $ipaddress; |
| [6774](#L6774) | } |
| [6775](#L6775) |  |
| [6776](#L6776) | protected function get\_time\_difference($strStart, $strEnd){ |
| [6777](#L6777) | $dteStart = new DateTime($strStart); |
| [6778](#L6778) | $dteEnd = new DateTime($strEnd); |
| [6779](#L6779) | $texts = array( |
| [6780](#L6780) | 'year' => \_\_( "year", 'quiz-maker' ), |
| [6781](#L6781) | 'years' => \_\_( "years", 'quiz-maker' ), |
| [6782](#L6782) | 'month' => \_\_( "month", 'quiz-maker' ), |
| [6783](#L6783) | 'months' => \_\_( "months", 'quiz-maker' ), |
| [6784](#L6784) | 'day' => \_\_( "day", 'quiz-maker' ), |
| [6785](#L6785) | 'days' => \_\_( "days", 'quiz-maker' ), |
| [6786](#L6786) | 'hour' => \_\_( "hour", 'quiz-maker' ), |
| [6787](#L6787) | 'hours' => \_\_( "hours", 'quiz-maker' ), |
| [6788](#L6788) | 'minute' => \_\_( "minute", 'quiz-maker' ), |
| [6789](#L6789) | 'minutes' => \_\_( "minutes", 'quiz-maker' ), |
| [6790](#L6790) | 'second' => \_\_( "second", 'quiz-maker' ), |
| [6791](#L6791) | 'seconds' => \_\_( "seconds", 'quiz-maker' ), |
| [6792](#L6792) | ); |
| [6793](#L6793) | $interval = $dteStart->diff($dteEnd); |
| [6794](#L6794) | $return = ''; |
| [6795](#L6795) |  |
| [6796](#L6796) | if ($v = $interval->y >= 1) $return .= $interval->y ." ". $texts[$this->pluralize\_new($interval->y, 'year')] . ' '; |
| [6797](#L6797) | if ($v = $interval->m >= 1) $return .= $interval->m ." ". $texts[$this->pluralize\_new($interval->m, 'month')] . ' '; |
| [6798](#L6798) | if ($v = $interval->d >= 1) $return .= $interval->d ." ". $texts[$this->pluralize\_new($interval->d, 'day')] . ' '; |
| [6799](#L6799) | if ($v = $interval->h >= 1) $return .= $interval->h ." ". $texts[$this->pluralize\_new($interval->h, 'hour')] . ' '; |
| [6800](#L6800) | if ($v = $interval->i >= 1) $return .= $interval->i ." ". $texts[$this->pluralize\_new($interval->i, 'minute')] . ' '; |
| [6801](#L6801) |  |
| [6802](#L6802) | $return .= $interval->s ." ". $texts[$this->pluralize\_new($interval->s, 'second')]; |
| [6803](#L6803) |  |
| [6804](#L6804) | return $return; |
| [6805](#L6805) | } |
| [6806](#L6806) |  |
| [6807](#L6807) | protected function pluralize($count, $text){ |
| [6808](#L6808) | return $count . (($count == 1) ? (" $text") : (" {$text}s")); |
| [6809](#L6809) | } |
| [6810](#L6810) |  |
| [6811](#L6811) | protected function pluralize\_new($count, $text){ |
| [6812](#L6812) | return ($count == 1) ? $text."" : $text."s"; |
| [6813](#L6813) | } |
| [6814](#L6814) |  |
| [6815](#L6815) | protected function isJSON($string){ |
| [6816](#L6816) | return is\_string($string) && is\_array(json\_decode($string, true)) && (json\_last\_error() == JSON\_ERROR\_NONE) ? true : false; |
| [6817](#L6817) | } |
| [6818](#L6818) |  |
| [6819](#L6819) | public function ays\_get\_user\_information() { |
| [6820](#L6820) |  |
| [6821](#L6821) | if(is\_user\_logged\_in()) { |
| [6822](#L6822) | $output = json\_encode(wp\_get\_current\_user()); |
| [6823](#L6823) | } else { |
| [6824](#L6824) | $output = null; |
| [6825](#L6825) | } |
| [6826](#L6826) | ob\_end\_clean(); |
| [6827](#L6827) | $ob\_get\_clean = ob\_get\_clean(); |
| [6828](#L6828) | echo $output; |
| [6829](#L6829) | wp\_die(); |
| [6830](#L6830) | } |
| [6831](#L6831) |  |
| [6832](#L6832) | public static function ays\_quiz\_set\_cookie($attr){ |
| [6833](#L6833) | $cookie\_name = $attr['name'].$attr['id']; |
| [6834](#L6834) | $cookie\_value = $attr['title']; |
| [6835](#L6835) | $cookie\_expiration =  current\_time('timestamp') + (1 \* 365 \* 24 \* 60 \* 60); |
| [6836](#L6836) | setcookie($cookie\_name, $cookie\_value, $cookie\_expiration, '/'); |
| [6837](#L6837) | } |
| [6838](#L6838) |  |
| [6839](#L6839) | public static function ays\_quiz\_remove\_cookie($attr){ |
| [6840](#L6840) | $cookie\_name = $attr['name'].$attr['id']; |
| [6841](#L6841) | if(isset($\_COOKIE[$cookie\_name])){ |
| [6842](#L6842) | unset($\_COOKIE[$cookie\_name]); |
| [6843](#L6843) | $cookie\_expiration =  current\_time('timestamp') - 1; |
| [6844](#L6844) | setcookie($cookie\_name, null, $cookie\_expiration, '/'); |
| [6845](#L6845) | } |
| [6846](#L6846) | } |
| [6847](#L6847) |  |
| [6848](#L6848) | public static function ays\_quiz\_check\_cookie($attr){ |
| [6849](#L6849) | $cookie\_name = $attr['name'].$attr['id']; |
| [6850](#L6850) | if(isset($\_COOKIE[$cookie\_name])){ |
| [6851](#L6851) | return true; |
| [6852](#L6852) | } |
| [6853](#L6853) | return false; |
| [6854](#L6854) | } |
| [6855](#L6855) |  |
| [6856](#L6856) | public static function ays\_autoembed( $content ) { |
| [6857](#L6857) | global $wp\_embed; |
| [6858](#L6858) |  |
| [6859](#L6859) | if ( is\_null( $content ) ) { |
| [6860](#L6860) | return $content; |
| [6861](#L6861) | } |
| [6862](#L6862) |  |
| [6863](#L6863) | $content = stripslashes( wpautop( $content ) ); |
| [6864](#L6864) | $content = $wp\_embed->autoembed( $content ); |
| [6865](#L6865) | if ( strpos( $content, '[embed]' ) !== false ) { |
| [6866](#L6866) | $content = $wp\_embed->run\_shortcode( $content ); |
| [6867](#L6867) | } |
| [6868](#L6868) | $content = do\_shortcode( $content ); |
| [6869](#L6869) | return $content; |
| [6870](#L6870) | } |
| [6871](#L6871) |  |
| [6872](#L6872) | public static function get\_questions\_categories($q\_ids){ |
| [6873](#L6873) | global $wpdb; |
| [6874](#L6874) |  |
| [6875](#L6875) | if($q\_ids == ''){ |
| [6876](#L6876) | return array(); |
| [6877](#L6877) | } |
| [6878](#L6878) | $sql = "SELECT DISTINCT c.id, c.title |
| [6879](#L6879) | FROM {$wpdb->prefix}aysquiz\_categories c |
| [6880](#L6880) | JOIN {$wpdb->prefix}aysquiz\_questions q |
| [6881](#L6881) | ON c.id = q.category\_id |
| [6882](#L6882) | WHERE q.id IN ({$q\_ids})"; |
| [6883](#L6883) |  |
| [6884](#L6884) | $result = $wpdb->get\_results($sql, 'ARRAY\_A'); |
| [6885](#L6885) | $cats = array(); |
| [6886](#L6886) |  |
| [6887](#L6887) | foreach($result as $res){ |
| [6888](#L6888) | $cats[$res['id']] = $res['title']; |
| [6889](#L6889) | } |
| [6890](#L6890) |  |
| [6891](#L6891) | return $cats; |
| [6892](#L6892) | } |
| [6893](#L6893) |  |
| [6894](#L6894) | public static function get\_quiz\_questions\_by\_ids($ids){ |
| [6895](#L6895) |  |
| [6896](#L6896) | global $wpdb; |
| [6897](#L6897) |  |
| [6898](#L6898) | $results = array(); |
| [6899](#L6899) | if(!empty($ids)){ |
| [6900](#L6900) | $ids = implode(",", $ids); |
| [6901](#L6901) | $sql = "SELECT \* FROM {$wpdb->prefix}aysquiz\_questions WHERE id IN (" . $ids . ")"; |
| [6902](#L6902) |  |
| [6903](#L6903) | $results = $wpdb->get\_results($sql, "ARRAY\_A"); |
| [6904](#L6904) |  |
| [6905](#L6905) | } |
| [6906](#L6906) |  |
| [6907](#L6907) | return $results; |
| [6908](#L6908) |  |
| [6909](#L6909) | } |
| [6910](#L6910) |  |
| [6911](#L6911) | public static function ays\_get\_average\_score\_by\_category($id){ |
| [6912](#L6912) | global $wpdb; |
| [6913](#L6913) | $quizes\_table = $wpdb->prefix . 'aysquiz\_quizes'; |
| [6914](#L6914) | $quizes\_questions\_table = $wpdb->prefix . 'aysquiz\_questions'; |
| [6915](#L6915) | $quizes\_questions\_cat\_table = $wpdb->prefix . 'aysquiz\_categories'; |
| [6916](#L6916) | $sql = "SELECT question\_ids FROM {$quizes\_table} WHERE id = ".$id; |
| [6917](#L6917) | $results = $wpdb->get\_var( $sql); |
| [6918](#L6918) | $questions\_ids = array(); |
| [6919](#L6919) | $questions\_counts = array(); |
| [6920](#L6920) | $questions\_cat\_list = array(); |
| [6921](#L6921) | if($results != ''){ |
| [6922](#L6922) | $results = explode("," , $results); |
| [6923](#L6923) | foreach ($results as $key){ |
| [6924](#L6924) | $questions\_ids[$key] = 0; |
| [6925](#L6925) | $questions\_counts[$key] = 0; |
| [6926](#L6926) |  |
| [6927](#L6927) | $sql = "SELECT q.category\_id, c.title |
| [6928](#L6928) | FROM {$quizes\_questions\_table} AS q |
| [6929](#L6929) | JOIN {$quizes\_questions\_cat\_table} AS c |
| [6930](#L6930) | ON q.category\_id = c.id |
| [6931](#L6931) | WHERE q.id = {$key}; "; |
| [6932](#L6932) | $questions\_cat\_list[$key] = $wpdb->get\_row( $sql); |
| [6933](#L6933) | } |
| [6934](#L6934) | } |
| [6935](#L6935) |  |
| [6936](#L6936) | $quizes\_reports\_table = $wpdb->prefix . 'aysquiz\_reports'; |
| [6937](#L6937) | $sql = "SELECT options |
| [6938](#L6938) | FROM {$quizes\_reports\_table} |
| [6939](#L6939) | WHERE quiz\_id =".$id; |
| [6940](#L6940) | $report = $wpdb->get\_results( $sql, ARRAY\_A ); |
| [6941](#L6941) | if(! empty($report)){ |
| [6942](#L6942) | foreach ($report as $key){ |
| [6943](#L6943) | $report = json\_decode($key["options"]); |
| [6944](#L6944) | $questions = isset( $report->correctness ) ? $report->correctness : array(); |
| [6945](#L6945) | foreach ($questions as $i => $v){ |
| [6946](#L6946) | $q = (int) substr($i ,12); |
| [6947](#L6947) | if(isset($questions\_ids[$q])) { |
| [6948](#L6948) | if ($v) { |
| [6949](#L6949) | $questions\_ids[$q]++; |
| [6950](#L6950) | } |
| [6951](#L6951) |  |
| [6952](#L6952) | $questions\_counts[$q]++; |
| [6953](#L6953) | } |
| [6954](#L6954) | } |
| [6955](#L6955) | } |
| [6956](#L6956) | } |
| [6957](#L6957) |  |
| [6958](#L6958) | $q\_cat\_list = array(); |
| [6959](#L6959) | $q\_cat\_title = array(); |
| [6960](#L6960) | foreach ($questions\_cat\_list as $key\_id => $val ) { |
| [6961](#L6961) | $val\_arr = (array) $val; |
| [6962](#L6962) | if(isset($val\_arr['category\_id'])){ |
| [6963](#L6963) | if (!array\_key\_exists($val\_arr['category\_id'], $q\_cat\_list)) { |
| [6964](#L6964) | $q\_cat\_list[$val\_arr['category\_id']][] = $key\_id; |
| [6965](#L6965) | $q\_cat\_title[$val\_arr['category\_id']] = $val\_arr['title']; |
| [6966](#L6966) | }else{ |
| [6967](#L6967) | $q\_cat\_list[$val\_arr['category\_id']][] = $key\_id; |
| [6968](#L6968) | $q\_cat\_title[$val\_arr['category\_id']] = $val\_arr['title']; |
| [6969](#L6969) | } |
| [6970](#L6970) | } |
| [6971](#L6971) | } |
| [6972](#L6972) |  |
| [6973](#L6973) | $q\_cat\_lists = array('percent'=>'', 'cat\_name'=>''); |
| [6974](#L6974) | $q\_cats\_lists = array(); |
| [6975](#L6975) | foreach ($q\_cat\_list as $key1 => $value1) { |
| [6976](#L6976) | $sum\_min = 0; |
| [6977](#L6977) | $sum\_max = 0; |
| [6978](#L6978) | foreach ($value1 as $key2 => $value2) { |
| [6979](#L6979) | $sum\_min += $questions\_ids[$value2]; |
| [6980](#L6980) | $sum\_max += $questions\_counts[$value2]; |
| [6981](#L6981) | } |
| [6982](#L6982) | if($sum\_max == 0){ |
| [6983](#L6983) | $persentage = 0; |
| [6984](#L6984) | }else{ |
| [6985](#L6985) | $persentage = round(($sum\_min\*100)/$sum\_max, 1); |
| [6986](#L6986) | } |
| [6987](#L6987) |  |
| [6988](#L6988) | $passed\_users\_count = "SELECT COUNT(\*) FROM {$wpdb->prefix}aysquiz\_reports WHERE quiz\_id=".$id; |
| [6989](#L6989) | $passed\_users\_count\_res = $wpdb->get\_var($passed\_users\_count); |
| [6990](#L6990) | $avg\_score\_by\_cat = "0%"; |
| [6991](#L6991) | if ($passed\_users\_count\_res > 0) { |
| [6992](#L6992) | $avg\_score\_by\_cat = round( $persentage , 1 ) . '%'; |
| [6993](#L6993) | } |
| [6994](#L6994) | $q\_cat\_lists['percent'] = $avg\_score\_by\_cat; |
| [6995](#L6995) | $q\_cat\_lists['cat\_name'] = $q\_cat\_title[$key1]; |
| [6996](#L6996) | $q\_cats\_lists[] = $q\_cat\_lists; |
| [6997](#L6997) |  |
| [6998](#L6998) | } |
| [6999](#L6999) |  |
| [7000](#L7000) | $avg\_category = ''; |
| [7001](#L7001) | foreach ($q\_cats\_lists as $key => $q\_cats\_list) { |
| [7002](#L7002) | $avg\_category .= '<p class=""> |
| [7003](#L7003) | <strong class="">'.$q\_cats\_list['cat\_name']  .':</strong> |
| [7004](#L7004) | <span class="">'.$q\_cats\_list['percent'].'</span> |
| [7005](#L7005) | </p>'; |
| [7006](#L7006) | } |
| [7007](#L7007) | return $avg\_category; |
| [7008](#L7008) | } |
| [7009](#L7009) |  |
| [7010](#L7010) | public function ays\_quiz\_is\_elementor(){ |
| [7011](#L7011) | // if ( defined( 'ELEMENTOR\_PATH' ) && class\_exists( 'Elementor\Widget\_Base' ) ) { |
| [7012](#L7012) | //     if ( class\_exists( 'Elementor\Plugin' ) ) { |
| [7013](#L7013) | //         if ( is\_callable( 'Elementor\Plugin', 'instance' ) ) { |
| [7014](#L7014) | //             $elementor = Elementor\Plugin::instance(); |
| [7015](#L7015) | //             if ( isset( $elementor->preview ) ) { |
| [7016](#L7016) | //                 return \Elementor\Plugin::$instance->preview->is\_preview\_mode(); |
| [7017](#L7017) | //             } |
| [7018](#L7018) | //         } |
| [7019](#L7019) | //     } |
| [7020](#L7020) | // } |
| [7021](#L7021) | $is\_elementor = isset( $\_GET['action'] ) && $\_GET['action'] == 'elementor' ? true : false; |
| [7022](#L7022) | if ( ! $is\_elementor ) { |
| [7023](#L7023) | $is\_elementor = isset( $\_REQUEST['action'] ) && $\_REQUEST['action'] == 'elementor\_ajax' ? true : false; |
| [7024](#L7024) | } |
| [7025](#L7025) | return $is\_elementor; |
| [7026](#L7026) | } |
| [7027](#L7027) |  |
| [7028](#L7028) | public function ays\_quiz\_is\_editor(){ |
| [7029](#L7029) | $is\_editor = false; |
| [7030](#L7030) | if( isset( $\_GET['action'] ) && ( $\_GET['action'] == 'add' || $\_GET['action'] == 'edit' ) ){ |
| [7031](#L7031) | if ( isset( $\_GET['post'] ) && absint( $\_GET['post'] ) > 0 ) { |
| [7032](#L7032) | $is\_editor = true; |
| [7033](#L7033) | } |
| [7034](#L7034) | } elseif ( isset( $\_GET['context'] ) && ( $\_GET['context'] == 'add' || $\_GET['context'] == 'edit' ) ) { |
| [7035](#L7035) | if( isset( $\_GET['post\_id'] ) & absint( $\_GET['post\_id'] ) > 0 ){ |
| [7036](#L7036) | $is\_editor = true; |
| [7037](#L7037) | } |
| [7038](#L7038) | } |
| [7039](#L7039) |  |
| [7040](#L7040) | return $is\_editor; |
| [7041](#L7041) | } |
| [7042](#L7042) |  |
| [7043](#L7043) | public static function ays\_quiz\_is\_enable\_question\_max\_length( $question\_id , $question\_type = 'text' ){ |
| [7044](#L7044) | global $wpdb; |
| [7045](#L7045) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [7046](#L7046) | $question\_id = absint(intval($question\_id)); |
| [7047](#L7047) |  |
| [7048](#L7048) | $question = $wpdb->get\_row("SELECT \* FROM {$questions\_table} WHERE id={$question\_id};", "ARRAY\_A"); |
| [7049](#L7049) | $options = ! isset($question['options']) ? array() : json\_decode($question['options'], true); |
| [7050](#L7050) |  |
| [7051](#L7051) | $res = false; |
| [7052](#L7052) | switch ( $question\_type ) { |
| [7053](#L7053) | case 'number': |
| [7054](#L7054) | if(isset($options['enable\_question\_number\_max\_length']) && sanitize\_text\_field( $options['enable\_question\_number\_max\_length'] ) == 'on'){ |
| [7055](#L7055) | $res = true; |
| [7056](#L7056) | } |
| [7057](#L7057) | break; |
| [7058](#L7058) | default: |
| [7059](#L7059) | if(isset($options['enable\_question\_text\_max\_length']) && sanitize\_text\_field( $options['enable\_question\_text\_max\_length'] ) == 'on'){ |
| [7060](#L7060) | $res = true; |
| [7061](#L7061) | } |
| [7062](#L7062) | break; |
| [7063](#L7063) | } |
| [7064](#L7064) | return $res; |
| [7065](#L7065) | } |
| [7066](#L7066) |  |
| [7067](#L7067) | public static function ays\_quiz\_get\_question\_max\_length\_array( $question\_id ){ |
| [7068](#L7068) | global $wpdb; |
| [7069](#L7069) | $questions\_table = $wpdb->prefix . "aysquiz\_questions"; |
| [7070](#L7070) | $question\_id = absint(intval($question\_id)); |
| [7071](#L7071) |  |
| [7072](#L7072) | $question = $wpdb->get\_row("SELECT \* FROM {$questions\_table} WHERE id={$question\_id};", "ARRAY\_A"); |
| [7073](#L7073) | $options = ! isset($question['options']) ? array() : json\_decode($question['options'], true); |
| [7074](#L7074) |  |
| [7075](#L7075) | $res = array(); |
| [7076](#L7076) |  |
| [7077](#L7077) | // Maximum length of a text field |
| [7078](#L7078) | $options['enable\_question\_text\_max\_length'] = isset($options['enable\_question\_text\_max\_length']) ? sanitize\_text\_field( $options['enable\_question\_text\_max\_length'] ) : 'off'; |
| [7079](#L7079) | $res['enable\_question\_text\_max\_length'] = (isset($options['enable\_question\_text\_max\_length']) && sanitize\_text\_field( $options['enable\_question\_text\_max\_length'] ) == 'on') ? true : false; |
| [7080](#L7080) |  |
| [7081](#L7081) | // Length |
| [7082](#L7082) | $res['question\_text\_max\_length'] = ( isset($options['question\_text\_max\_length']) && sanitize\_text\_field( $options['question\_text\_max\_length'] ) != '' ) ? absint( intval( sanitize\_text\_field( $options['question\_text\_max\_length'] ) ) ) : ''; |
| [7083](#L7083) |  |
| [7084](#L7084) | // Limit by |
| [7085](#L7085) | $res['question\_limit\_text\_type'] = ( isset($options['question\_limit\_text\_type']) && sanitize\_text\_field( $options['question\_limit\_text\_type'] ) != '' ) ? sanitize\_text\_field( $options['question\_limit\_text\_type'] ) : 'characters'; |
| [7086](#L7086) |  |
| [7087](#L7087) | // Show the counter-message |
| [7088](#L7088) | $options['question\_enable\_text\_message'] = isset($options['question\_enable\_text\_message']) ? sanitize\_text\_field( $options['question\_enable\_text\_message'] ) : 'off'; |
| [7089](#L7089) | $res['question\_enable\_text\_message'] = (isset($options['question\_enable\_text\_message']) && $options['question\_enable\_text\_message'] == 'on') ? true : false; |
| [7090](#L7090) |  |
| [7091](#L7091) | // Maximum length of a number field |
| [7092](#L7092) | $options['enable\_question\_number\_max\_length'] = isset($options['enable\_question\_number\_max\_length']) ? sanitize\_text\_field( $options['enable\_question\_number\_max\_length'] ) : 'off'; |
| [7093](#L7093) | $res['enable\_question\_number\_max\_length'] = (isset($options['enable\_question\_number\_max\_length']) && sanitize\_text\_field( $options['enable\_question\_number\_max\_length'] ) == 'on') ? true : false; |
| [7094](#L7094) |  |
| [7095](#L7095) | // Length |
| [7096](#L7096) | $res['question\_number\_max\_length'] = ( isset($options['question\_number\_max\_length']) && sanitize\_text\_field( $options['question\_number\_max\_length'] ) != '' ) ? intval( sanitize\_text\_field( $options['question\_number\_max\_length'] ) ) : ''; |
| [7097](#L7097) |  |
| [7098](#L7098) | // Minimum length of a number field |
| [7099](#L7099) | $options['enable\_question\_number\_min\_length'] = isset($options['enable\_question\_number\_min\_length']) ? sanitize\_text\_field( $options['enable\_question\_number\_min\_length'] ) : 'off'; |
| [7100](#L7100) | $res['enable\_question\_number\_min\_length'] = (isset($options['enable\_question\_number\_min\_length']) && sanitize\_text\_field( $options['enable\_question\_number\_min\_length'] ) == 'on') ? true : false; |
| [7101](#L7101) |  |
| [7102](#L7102) | // Length |
| [7103](#L7103) | $res['question\_number\_min\_length'] = ( isset($options['question\_number\_min\_length']) && sanitize\_text\_field( $options['question\_number\_min\_length'] ) != '' ) ? intval( sanitize\_text\_field( $options['question\_number\_min\_length'] ) ) : ''; |
| [7104](#L7104) |  |
| [7105](#L7105) | // Show error message |
| [7106](#L7106) | $options['enable\_question\_number\_error\_message'] = isset($options['enable\_question\_number\_error\_message']) ? sanitize\_text\_field( $options['enable\_question\_number\_error\_message'] ) : 'off'; |
| [7107](#L7107) | $res['enable\_question\_number\_error\_message'] = (isset($options['enable\_question\_number\_error\_message']) && sanitize\_text\_field( $options['enable\_question\_number\_error\_message'] ) == 'on') ? true : false; |
| [7108](#L7108) |  |
| [7109](#L7109) | // Message |
| [7110](#L7110) | $res['question\_number\_error\_message'] = ( isset($options['question\_number\_error\_message']) && sanitize\_text\_field( $options['question\_number\_error\_message'] ) != '' ) ? stripslashes( sanitize\_text\_field( $options['question\_number\_error\_message'] ) ) : ''; |
| [7111](#L7111) |  |
| [7112](#L7112) | return $res; |
| [7113](#L7113) | } |
| [7114](#L7114) |  |
| [7115](#L7115) | public function ays\_answer\_numbering($numbering){ |
| [7116](#L7116) | $keyword\_arr = array(); |
| [7117](#L7117) | switch ($numbering) { |
| [7118](#L7118) | case '1.': |
| [7119](#L7119) | $char\_min\_val = '1'; |
| [7120](#L7120) | $char\_max\_val = '100'; |
| [7121](#L7121) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7122](#L7122) | $keyword\_arr[] = $x ."."; |
| [7123](#L7123) | } |
| [7124](#L7124) | break; |
| [7125](#L7125) | case '1)': |
| [7126](#L7126) | $char\_min\_val = '1'; |
| [7127](#L7127) | $char\_max\_val = '100'; |
| [7128](#L7128) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7129](#L7129) | $keyword\_arr[] = $x .")"; |
| [7130](#L7130) | } |
| [7131](#L7131) | break; |
| [7132](#L7132) | case 'A.': |
| [7133](#L7133) | $char\_min\_val = 'A'; |
| [7134](#L7134) | $char\_max\_val = 'Z'; |
| [7135](#L7135) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7136](#L7136) | $keyword\_arr[] = $x ."."; |
| [7137](#L7137) | } |
| [7138](#L7138) | break; |
| [7139](#L7139) | case 'A)': |
| [7140](#L7140) | $char\_min\_val = 'A'; |
| [7141](#L7141) | $char\_max\_val = 'Z'; |
| [7142](#L7142) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7143](#L7143) | $keyword\_arr[] = $x .")"; |
| [7144](#L7144) | } |
| [7145](#L7145) | break; |
| [7146](#L7146) | case 'a.': |
| [7147](#L7147) | $char\_min\_val = 'a'; |
| [7148](#L7148) | $char\_max\_val = 'z'; |
| [7149](#L7149) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7150](#L7150) | $keyword\_arr[] = $x ."."; |
| [7151](#L7151) | } |
| [7152](#L7152) | break; |
| [7153](#L7153) | case 'a)': |
| [7154](#L7154) | $char\_min\_val = 'a'; |
| [7155](#L7155) | $char\_max\_val = 'z'; |
| [7156](#L7156) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7157](#L7157) | $keyword\_arr[] = $x .")"; |
| [7158](#L7158) | } |
| [7159](#L7159) | break; |
| [7160](#L7160) | default: |
| [7161](#L7161) | break; |
| [7162](#L7162) | } |
| [7163](#L7163) | return $keyword\_arr; |
| [7164](#L7164) | } |
| [7165](#L7165) |  |
| [7166](#L7166) | public static function ays\_question\_numbering( $numbering , $total ){ |
| [7167](#L7167) | $keyword\_arr = array(); |
| [7168](#L7168) | switch ($numbering) { |
| [7169](#L7169) | case '1.': |
| [7170](#L7170) | $char\_min\_val = '1'; |
| [7171](#L7171) | $char\_max\_val = $total; |
| [7172](#L7172) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7173](#L7173) | $keyword\_arr[] = $x ."."; |
| [7174](#L7174) | } |
| [7175](#L7175) |  |
| [7176](#L7176) | break; |
| [7177](#L7177) | case '1)': |
| [7178](#L7178) | $char\_min\_val = '1'; |
| [7179](#L7179) | $char\_max\_val = $total; |
| [7180](#L7180) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7181](#L7181) | $keyword\_arr[] = $x .")"; |
| [7182](#L7182) | } |
| [7183](#L7183) | break; |
| [7184](#L7184) | case 'A.': |
| [7185](#L7185) |  |
| [7186](#L7186) | $char\_min\_val = 'A'; |
| [7187](#L7187) | $char\_max\_val = 'Z'; |
| [7188](#L7188) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7189](#L7189) | $keyword\_arr[] = $x ."."; |
| [7190](#L7190) | } |
| [7191](#L7191) |  |
| [7192](#L7192) | break; |
| [7193](#L7193) | case 'A)': |
| [7194](#L7194) |  |
| [7195](#L7195) | $char\_min\_val = 'A'; |
| [7196](#L7196) | $char\_max\_val = 'Z'; |
| [7197](#L7197) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7198](#L7198) | $keyword\_arr[] = $x .")"; |
| [7199](#L7199) | } |
| [7200](#L7200) |  |
| [7201](#L7201) | break; |
| [7202](#L7202) | case 'a.': |
| [7203](#L7203) | $char\_min\_val = 'a'; |
| [7204](#L7204) | $char\_max\_val = 'z'; |
| [7205](#L7205) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7206](#L7206) | $keyword\_arr[] = $x ."."; |
| [7207](#L7207) | } |
| [7208](#L7208) |  |
| [7209](#L7209) | break; |
| [7210](#L7210) | case 'a)': |
| [7211](#L7211) |  |
| [7212](#L7212) | $char\_min\_val = 'a'; |
| [7213](#L7213) | $char\_max\_val = 'z'; |
| [7214](#L7214) | for($x = $char\_min\_val; $x <= $char\_max\_val; $x++){ |
| [7215](#L7215) | $keyword\_arr[] = $x .")"; |
| [7216](#L7216) | } |
| [7217](#L7217) |  |
| [7218](#L7218) | break; |
| [7219](#L7219) |  |
| [7220](#L7220) | default: |
| [7221](#L7221) |  |
| [7222](#L7222) | break; |
| [7223](#L7223) | } |
| [7224](#L7224) |  |
| [7225](#L7225) | return $keyword\_arr; |
| [7226](#L7226) | } |
| [7227](#L7227) |  |
| [7228](#L7228) | public function ays\_color\_inverse( $color ){ |
| [7229](#L7229) | $color = str\_replace( '#', '', $color ); |
| [7230](#L7230) | if ( strlen( $color ) == 3 ){ |
| [7231](#L7231) | $color\_short = str\_split( $color ); |
| [7232](#L7232) | foreach( $color\_short as $k => $c\_short ){ |
| [7233](#L7233) | $color\_short[$k] = $c\_short . $c\_short; |
| [7234](#L7234) | } |
| [7235](#L7235) | $color = implode( $color\_short ); |
| [7236](#L7236) | } |
| [7237](#L7237) |  |
| [7238](#L7238) | if ( strlen( $color ) != 6 ){ |
| [7239](#L7239) | return '#000000'; |
| [7240](#L7240) | } |
| [7241](#L7241) |  |
| [7242](#L7242) | $rgb = ''; |
| [7243](#L7243) | for ( $x = 0; $x < 3; $x++ ){ |
| [7244](#L7244) | $c = 255 - hexdec( substr( $color, ( 2 \* $x ), 2 ) ); |
| [7245](#L7245) | $c = ( $c < 0 ) ? 0 : dechex( $c ); |
| [7246](#L7246) | $rgb .= ( strlen( $c ) < 2 ) ? '0' . $c : $c; |
| [7247](#L7247) | } |
| [7248](#L7248) |  |
| [7249](#L7249) | return '#'.$rgb; |
| [7250](#L7250) | } |
| [7251](#L7251) |  |
| [7252](#L7252) | // Retrieves the attachment ID from the file URL |
| [7253](#L7253) | public function ays\_quiz\_get\_image\_id\_by\_url( $image\_url ) { |
| [7254](#L7254) | global $wpdb; |
| [7255](#L7255) |  |
| [7256](#L7256) | $image\_alt\_text = ""; |
| [7257](#L7257) | if ( !empty( $image\_url ) ) { |
| [7258](#L7258) |  |
| [7259](#L7259) | $re = '/-\d+[Xx]\d+\./'; |
| [7260](#L7260) | $subst = '.'; |
| [7261](#L7261) |  |
| [7262](#L7262) | $image\_url = preg\_replace($re, $subst, $image\_url, 1); |
| [7263](#L7263) |  |
| [7264](#L7264) | $attachment = $wpdb->get\_col($wpdb->prepare("SELECT ID FROM $wpdb->posts WHERE guid='%s';", $image\_url )); |
| [7265](#L7265) | if ( !is\_null( $attachment ) && !empty( $attachment ) ) { |
| [7266](#L7266) |  |
| [7267](#L7267) | $image\_id = (isset( $attachment[0] ) && $attachment[0] != "") ? absint(  $attachment[0] ) : ""; |
| [7268](#L7268) | if ( $image\_id != "" ) { |
| [7269](#L7269) | $image\_alt\_text = $this->ays\_quiz\_get\_image\_alt\_text\_by\_id( $image\_id ); |
| [7270](#L7270) | } |
| [7271](#L7271) | } |
| [7272](#L7272) | } |
| [7273](#L7273) |  |
| [7274](#L7274) | return $image\_alt\_text; |
| [7275](#L7275) | } |
| [7276](#L7276) |  |
| [7277](#L7277) | public function ays\_quiz\_get\_image\_alt\_text\_by\_id( $image\_id ) { |
| [7278](#L7278) |  |
| [7279](#L7279) | $image\_data = ""; |
| [7280](#L7280) | if ( $image\_id != "" ) { |
| [7281](#L7281) |  |
| [7282](#L7282) | $result = get\_post\_meta($image\_id, '\_wp\_attachment\_image\_alt', TRUE); |
| [7283](#L7283) | if ( $result && $result != "" ) { |
| [7284](#L7284) | $image\_data = esc\_attr( $result ); |
| [7285](#L7285) | } |
| [7286](#L7286) | } |
| [7287](#L7287) |  |
| [7288](#L7288) | return $image\_data; |
| [7289](#L7289) | } |
| [7290](#L7290) |  |
| [7291](#L7291) | public function ays\_quiz\_get\_image\_full\_size\_url\_by\_url( $image\_url ) { |
| [7292](#L7292) | global $wpdb; |
| [7293](#L7293) |  |
| [7294](#L7294) | $image\_full\_size = ""; |
| [7295](#L7295) | if ( !empty( $image\_url ) ) { |
| [7296](#L7296) |  |
| [7297](#L7297) | $re = '/-\d+[Xx]\d+\./'; |
| [7298](#L7298) | $subst = '.'; |
| [7299](#L7299) |  |
| [7300](#L7300) | $image\_url = preg\_replace($re, $subst, $image\_url, 1); |
| [7301](#L7301) |  |
| [7302](#L7302) | $attachment = $wpdb->get\_col($wpdb->prepare("SELECT ID FROM $wpdb->posts WHERE guid='%s';", $image\_url )); |
| [7303](#L7303) | if ( !is\_null( $attachment ) && !empty( $attachment ) ) { |
| [7304](#L7304) |  |
| [7305](#L7305) | $image\_id = (isset( $attachment[0] ) && $attachment[0] != "") ? absint(  $attachment[0] ) : ""; |
| [7306](#L7306) | if ( $image\_id != "" ) { |
| [7307](#L7307) | $image\_full\_size = $this->ays\_quiz\_get\_image\_full\_size\_by\_id( $image\_id ); |
| [7308](#L7308) | } |
| [7309](#L7309) | } |
| [7310](#L7310) | elseif( !is\_null( $attachment ) && empty( $attachment ) ){ |
| [7311](#L7311) | $image\_full\_size = $image\_url; |
| [7312](#L7312) | } |
| [7313](#L7313) | } |
| [7314](#L7314) |  |
| [7315](#L7315) | return $image\_full\_size; |
| [7316](#L7316) | } |
| [7317](#L7317) |  |
| [7318](#L7318) | public function ays\_quiz\_get\_image\_full\_size\_by\_id( $image\_id ) { |
| [7319](#L7319) |  |
| [7320](#L7320) | $image\_data = ""; |
| [7321](#L7321) | if ( $image\_id != "" ) { |
| [7322](#L7322) |  |
| [7323](#L7323) | $result = wp\_get\_attachment\_image\_src( $image\_id, 'full' ); |
| [7324](#L7324) | if ( !is\_null( $result ) && $result && !empty($result) ) { |
| [7325](#L7325) | $image\_data = (isset( $result[0] ) && $result[0] != "") ? esc\_url($result[0]) : ""; |
| [7326](#L7326) | } |
| [7327](#L7327) | } |
| [7328](#L7328) |  |
| [7329](#L7329) | return $image\_data; |
| [7330](#L7330) | } |
| [7331](#L7331) |  |
| [7332](#L7332) | public static function get\_published\_questions\_id\_arr($ids) { |
| [7333](#L7333) | global $wpdb; |
| [7334](#L7334) |  |
| [7335](#L7335) | $ids = sanitize\_text\_field($ids); |
| [7336](#L7336) |  |
| [7337](#L7337) | $sql = "SELECT id FROM {$wpdb->prefix}aysquiz\_questions WHERE id IN({$ids}) AND published = 1 ORDER BY find\_in\_set(id,'".$ids."');"; |
| [7338](#L7338) |  |
| [7339](#L7339) | $results = $wpdb->get\_results( $sql, 'ARRAY\_A' ); |
| [7340](#L7340) |  |
| [7341](#L7341) | if ( !is\_null( $results ) && !empty($results) ) { |
| [7342](#L7342) | $new\_question\_ids = array(); |
| [7343](#L7343) | foreach ($results as $key => $value) { |
| [7344](#L7344) | $published\_question\_id = (isset( $value['id'] ) && intval( $value['id'] ) > 0 && $value['id'] != "") ? sanitize\_text\_field($value['id']) : null; |
| [7345](#L7345) |  |
| [7346](#L7346) | if ( !is\_null( $published\_question\_id ) ) { |
| [7347](#L7347) | $new\_question\_ids[] = $published\_question\_id; |
| [7348](#L7348) | } |
| [7349](#L7349) | } |
| [7350](#L7350) |  |
| [7351](#L7351) | if ( !empty( $new\_question\_ids ) ) { |
| [7352](#L7352) | $results = $new\_question\_ids; |
| [7353](#L7353) | } else { |
| [7354](#L7354) | $results = explode(",", $ids); |
| [7355](#L7355) | } |
| [7356](#L7356) | } else { |
| [7357](#L7357) | if( !empty($ids) && ( is\_null( $results ) || empty($results) ) ){ |
| [7358](#L7358) | $results = array(); |
| [7359](#L7359) | } else { |
| [7360](#L7360) | $results = explode(",", $ids); |
| [7361](#L7361) | } |
| [7362](#L7362) | } |
| [7363](#L7363) |  |
| [7364](#L7364) | return $results; |
| [7365](#L7365) | } |
| [7366](#L7366) |  |
| [7367](#L7367) | public function set\_prop( $prop, $value ){ |
| [7368](#L7368) | if( property\_exists( $this, $prop ) && ! empty( $value ) ){ |
| [7369](#L7369) | $this->$prop = $value; |
| [7370](#L7370) | } |
| [7371](#L7371) | } |
| [7372](#L7372) |  |
| [7373](#L7373) | public function get\_prop( $prop ){ |
| [7374](#L7374) | if( isset( $this->$prop ) ){ |
| [7375](#L7375) | return $this->$prop; |
| [7376](#L7376) | } |
| [7377](#L7377) |  |
| [7378](#L7378) | return null; |
| [7379](#L7379) | } |
| [7380](#L7380) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php?format=txt)
* [Original Format](/export/3220651/quiz-maker/tags/6.5.7.5/public/class-quiz-maker-public.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

