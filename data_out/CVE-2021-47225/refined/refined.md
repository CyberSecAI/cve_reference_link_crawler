The content provided is related to CVE-2021-47225.

**Root cause of the vulnerability:**
A deadlock occurs in the mac80211 driver when closing an AP interface that has associated AP_VLAN interfaces that are up. The deadlock happens because `dev_close()` is called on the AP_VLAN interfaces while holding the wiphy mutex. This then leads to a recursive attempt to acquire the same mutex in the netdev notifier in cfg80211.

**Weaknesses/vulnerabilities present:**
- Improper locking during the closing of network interfaces.
- Reentrant mutex usage

**Impact of exploitation:**
- System deadlock leading to denial of service.

**Attack vectors:**
- Triggering the closing of an AP interface that has active AP_VLAN interfaces.

**Required attacker capabilities/position:**
- The attacker needs to be able to bring up and down network interfaces, specifically AP and AP_VLAN interfaces.
-  Ability to trigger a network interface close operation.

**Additional details:**
The fix involves two key changes:
1. Preventing changes to the interface type while AP_VLAN interfaces are up. The driver now returns -EBUSY when attempting to change the interface type of an AP interface that has VLANs.
2. Moving the dev_close() loop for VLAN interfaces outside the wiphy mutex held section in the normal stop case. This is done by performing the dev_close operation of dependent VLAN interfaces *before* acquiring the wiphy lock.
These changes fix the deadlock by preventing the nested mutex acquisition.