

[Skip to content](#main)

[Ars Technica home](https://arstechnica.com/)

Sections

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

* [Feature](/features/)
* [Reviews](/reviews/)
* [Store](/store/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Pin to story

Theme

* HyperLight
* Day & Night
* Dark
* System

Search dialog...

Sign In

Sign in dialog...

Sign in

WORST FIT EVER

# Nasty bug with very simple exploit hits PHP just in time for the weekend

With PoC code available and active Internet scans, speed is of the essence.

[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
–
Jun 7, 2024 5:57 pm

| [81](https://arstechnica.com/security/2024/06/php-vulnerability-allows-attackers-to-run-malicious-code-on-windows-servers/#comments "81 comments")

[![](https://cdn.arstechnica.net/wp-content/uploads/2023/07/exploit-vulnerability-security.jpg)](https://cdn.arstechnica.net/wp-content/uploads/2023/07/exploit-vulnerability-security.jpg)

Credit:
Getty Images

Credit:
Getty Images

Text
settings

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Minimize to nav

A critical vulnerability in the PHP programming language can be trivially exploited to execute malicious code on Windows devices, security researchers warned as they urged those affected to take action before the weekend starts.

Within 24 hours of the vulnerability and accompanying patch being published, researchers from the nonprofit security organization Shadowserver [reported](https://infosec.exchange/%40shadowserver/112575314920464732) Internet scans designed to identify servers that are susceptible to attacks. That—combined with (1) the ease of exploitation, (2) the availability of proof-of-concept attack code, (3) the severity of remotely executing code on vulnerable machines, and (4) the widely used [XAMPP](https://en.wikipedia.org/wiki/XAMPP) platform being vulnerable by default—has prompted security practitioners to urge admins check to see if their PHP servers are affected before starting the weekend.

## When “Best Fit” isn't

“A nasty bug with a very simple exploit—perfect for a Friday afternoon,” researchers with security firm WatchTowr [wrote](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/).

CVE-2024-4577, as the vulnerability is tracked, stems from errors in the way PHP converts unicode characters into ASCII. A [feature](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ucoderef/d1980631-6401-428e-a49d-d71394be7da8) built into Windows known as Best Fit allows attackers to use a technique known as [argument injection](https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html#argument-injection) to pass user-supplied input into commands executed by an application, in this case, PHP. Exploits allow attackers to bypass [CVE-2012-1823](https://arstechnica.com/information-technology/2014/03/php-bug-allowing-site-hijacking-still-menaces-internet-22-months-on/), a critical code execution vulnerability patched in PHP in 2012.

“While implementing PHP, the team did not notice the Best-Fit feature of encoding conversion within the Windows operating system,” researchers with Devcore, the security firm that discovered CVE-2024-4577, [wrote](https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en/). “This oversight allows unauthenticated attackers to bypass the previous protection of CVE-2012-1823 by specific character sequences. Arbitrary code can be executed on remote PHP servers through the argument injection attack.”

CVE-2024-4577 affects PHP only when it runs in a mode known as CGI, in which a web server parses HTTP requests and passes them to a PHP script for processing. Even when PHP isn’t set to CGI mode, however, the vulnerability may still be exploitable when PHP executables such as php.exe and php-cgi.exe are in directories that are accessible by the web server. This configuration is set by default in XAMPP for Windows, making the platform vulnerable unless it has been modified.

One example, WatchTowr noted, occurs when queries are parsed and sent through a command line. The result: a harmless request such as `http://host/cgi.php?foo=bar` could be converted into `php.exe cgi.php foo=bar`, a command that would be executed by the main PHP engine.

## No escape

Like many other languages, PHP converts certain types of user input to prevent it from being interpreted as a command for execution. This is a process known as escaping. For example, in HTML, the < and > characters are often escaped by converting them into their unicode hex value equivalents < and > to prevent them from being interpreted as HTML tags by a browser.

The WatchTowr researchers demonstrate how Best Fit fails to escape characters such as a soft hyphen (with unicode value 0xAD) and instead converts it to an unescaped regular hyphen (0x2D), a character that’s instrumental in many code syntaxes.

The researchers went on to explain:

> It turns out that, as part of unicode processing, PHP will apply what’s known as a ‘best fit’ mapping, and helpfully assume that, when the user entered a soft hyphen, they actually intended to type a *real* hyphen, and interpret it as such. Herein lies our vulnerability—if we supply a CGI handler with a soft hyphen (0xAD), the CGI handler won’t feel the need to escape it, and will pass it to PHP. PHP, however, will interpret it as if it were a *real* hyphen, which allows an attacker to sneak extra command line arguments, which begin with hyphens, into the PHP process.
>
> This is remarkably similar to an older PHP bug (when in CGI mode), CVE-2012-1823, and so we can borrow some exploitation techniques developed for this older bug and adapt them to work with our new bug. A helpful [writeup](https://pentesterlab.com/exercises/cve-2012-1823/course) advises that, to translate our injection into RCE, we should aim to inject the following arguments:
>
> ```
> -d allow_url_include=1 -d auto_prepend_file=php://input
>
> ```
>
> This will accept input from our HTTP request body, and process it using PHP. Straightforward enough - let’s try a version of this equipped with our 0xAD ‘soft hyphen’ instead of the usual hyphen. Maybe it’s enough to slip through the escaping?
>
> ```
> POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
> Host: {{host}}
> User-Agent: curl/8.3.0
> Accept: */*
> Content-Length: 23
> Content-Type: application/x-www-form-urlencoded
> Connection: keep-alive
>
>
>
> ```
>
> Oh joy—we’re rewarded with a `phpinfo` page, showing us we have indeed achieved RCE.
>
> [![](https://cdn.arstechnica.net/wp-content/uploads/2024/06/php-info.png)](https://cdn.arstechnica.net/wp-content/uploads/2024/06/php-info.png)

The vulnerability was discovered by Devcore researcher Orange Tsai, who [said](https://blog.orange.tw/2024/06/cve-2024-4577-yet-another-php-rce.html): “The bug is incredibly simple, but that’s also what makes it interesting.”

The Devcore writeup said that the researchers have confirmed that XAMPP is vulnerable when Windows is configured to use the locales for Traditional Chinese, Simplified Chinese, or Japanese. In Windows, a locale is a set of user preference information related to the user's language, environment, and/or cultural conventions. The researchers haven’t tested other locales and have urged people using them to perform a comprehensive asset assessment to test their usage scenarios.

CVE-2024-4577 affects all versions of PHP running on a Windows device. That includes version branches 8.3 prior to 8.3.8, 8.2 prior to 8.2.20, and 8.1 prior to 8.1.29.

The 8.0, 7, and 5 version branches are also vulnerable, but since they’re no longer supported, admins will have to follow mitigation advice since patches aren’t available. One option is to apply what are known as rewrite rules such as:

```
RewriteEngine On
RewriteCond %{QUERY_STRING} ^%ad [NC]
RewriteRule .? - [F,L]
```

The researchers caution these rules have been tested only for the three locales they have confirmed as vulnerable.

XAMPP for Windows had yet to release a fix at the time this post went live. For admins without the need for PHP CGI, they can turn it off using the following Apache HTTP Server configuration:

> C:/xampp/apache/conf/extra/httpd-xampp.conf

Locating the corresponding lines:

```
ScriptAlias /php-cgi/ "C:/xampp/php/"

```

And comment it out:

```
# ScriptAlias /php-cgi/ "C:/xampp/php/"

```

Additional analysis of the vulnerability is available [here](https://buaq.net/go-244036.html).

Related Stories

[![](https://cdn.arstechnica.net/wp-content/uploads/2014/03/dennis-the-manace-150x150.jpg)](https://arstechnica.com/information-technology/2014/03/php-bug-allowing-site-hijacking-still-menaces-internet-22-months-on/)

[PHP bug allowing site hijacking still menaces Internet 22 months on](https://arstechnica.com/information-technology/2014/03/php-bug-allowing-site-hijacking-still-menaces-internet-22-months-on/)

Hackers continue to dish exploits executing malicious code on unsecured sites.

Listing image:
Getty Images

[![Photo of Dan Goodin](/wp-content/uploads/2018/10/Dang.jpg)](https://arstechnica.com/author/dan-goodin/)
[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
Senior Security Editor

[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
Senior Security Editor

Dan Goodin is Senior Security Editor at Ars Technica, where he oversees coverage of malware, computer espionage, botnets, hardware hacking, encryption, and passwords. In his spare time, he enjoys gardening, cooking, and following the independent music scene. Dan is based in San Francisco. Follow him at [here](https://infosec.exchange/%40dangoodin) on Mastodon and [here](https://bsky.app/profile/dangoodin.bsky.social) on Bluesky. Contact him on Signal at DanArs.82.

[81 Comments](https://arstechnica.com/security/2024/06/php-vulnerability-allows-attackers-to-run-malicious-code-on-windows-servers/#comments "81 comments")

Comments

[Forum view](https://arstechnica.com/civis/threads/php-vulnerability-allows-attackers-to-run-malicious-code-on-windows-servers.1501169/)

![Loading](https://arstechnica.com/wp-content/themes/ars-v9/public/images/firework-loader.75ab30.gif)

[Prev story](https://arstechnica.com/tech-policy/2024/06/google-avoids-jury-trial-by-sending-2-3-million-check-to-us-government/ "Go to: Google avoids jury trial by sending $2.3 million check to US government")

[Next story](https://arstechnica.com/science/2024/06/people-are-seizing-being-intubated-after-eating-microdose-chocolates/ "Go to: People are seizing, being intubated after eating microdose chocolates")

Most Read

1. [![Listing image for first story in Most Read: Judge ends man’s 11-year quest to dig up landfill and recover $765M in bitcoin](https://cdn.arstechnica.net/wp-content/uploads/2025/01/newport-landfill-768x432-1736530527.jpg)](https://arstechnica.com/tech-policy/2025/01/judge-ends-mans-11-year-quest-to-dig-up-landfill-and-recover-765m-in-bitcoin/)

   1.
   [Judge ends man’s 11-year quest to dig up landfill and recover $765M in bitcoin](https://arstechnica.com/tech-policy/2025/01/judge-ends-mans-11-year-quest-to-dig-up-landfill-and-recover-765m-in-bitcoin/)
2. 2.
   [A glowing ring of metal fell to Earth, and no one has any idea what it is](https://arstechnica.com/space/2025/01/a-glowing-ring-of-metal-fell-to-earth-and-no-one-has-any-idea-what-it-is/)
3. 3.
   [A taller, heavier, smarter version of SpaceX’s Starship is almost ready to fly](https://arstechnica.com/space/2025/01/a-taller-heavier-smarter-version-of-spacexs-starship-is-almost-ready-to-fly/)
4. 4.
   [Man turns irreversibly gray from an unidentified silver exposure](https://arstechnica.com/health/2025/01/man-turns-irreversibly-gray-from-an-unidentified-silver-exposure/)
5. 5.
   [German router maker is latest company to inadvertently clarify the LGPL license](https://arstechnica.com/gadgets/2025/01/suing-wi-fi-router-makers-remains-a-necessary-part-of-open-source-license-law/)

Customize

Ars Technica has been separating the signal from
the noise for over 25 years. With our unique combination of
technical savvy and wide-ranging interest in the technological arts
and sciences, Ars is the trusted source in a sea of information. After
all, you don’t need to know everything, only what’s important.

More
from Ars

* [About Us](https://arstechnica.com/about-us/)
* [Staff Directory](https://arstechnica.com/staff-directory/)
* [Newsletters](https://arstechnica.com/newsletters/)
* [Ars Videos](https://arstechnica.com/video/)
* [General FAQ](https://arstechnica.com/general-faq/)
* [RSS Feeds](https://arstechnica.com/rss-feeds/)

Contact

* [Contact us](https://arstechnica.com/contact-us/)
* [Advertise with us](https://www.condenast.com/brands/ars-technica)
* [Reprints](https://arstechnica.com/reprints/)

Do Not Sell My Personal
Information

© 2025 Condé Nast. All rights reserved. Use of and/or
registration on any portion of this site constitutes acceptance of our [User Agreement](https://www.condenast.com/user-agreement/) and
[Privacy Policy and
Cookie Statement](https://www.condenast.com/privacy-policy/) and [Ars
Technica Addendum](/amendment-to-conde-nast-user-agreement-privacy-policy/) and [Your
California Privacy Rights](https://www.condenast.com/privacy-policy/#california). Ars Technica may earn compensation on
sales from links on this site. [Read our
affiliate link policy](/affiliate-link-policy/). The material on this site may not be
reproduced, distributed, transmitted, cached or otherwise used, except
with the prior written permission of Condé Nast. [Ad
Choices](https://www.aboutads.info/)

