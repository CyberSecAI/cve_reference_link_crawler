

| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [mupdf.git](/cgi-bin/cgit.cgi/mupdf.git/ "mupdf.git") | 1.18.x 1.19.x 1.20.x 1.21.x 1.22.x 1.23.x 1.24.x 1.25.x android-muso android-muso-signing android-openjpeg-2.3.1 css fontconfig java-empty-store lcms lcms2 line\_art\_filter master muso muso-3.9-release muso-temporary-hack objc-openjpeg-2.3.1 release-1.10a release\_1.8 so so-tess2 stext-flags win-openjpeg-2.3.1 winRT winphone |
| --- | --- | --- |
| MuPDF library | Chris Liddell |

| [summary](/cgi-bin/cgit.cgi/mupdf.git/)[refs](/cgi-bin/cgit.cgi/mupdf.git/refs/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)[log](/cgi-bin/cgit.cgi/mupdf.git/log/)[tree](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)[commit](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)[diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sebastian Rasmussen <sebras@gmail.com> | 2018-08-12 04:14:03 +0800 |
| --- | --- | --- |
| committer | Sebastian Rasmussen <sebras@gmail.com> | 2018-08-14 20:56:39 +0800 |
| commit | [8aa2bd34065d2844aae778bd4cc20c74bbcd9406](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406) ([patch](/cgi-bin/cgit.cgi/mupdf.git/patch/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)) | |
| tree | [330fd9aefd7a5bfaa1cb8f3f3f38044e17c1d677](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406) | |
| parent | [199668e936ba87e2f9d88562d83b89dc3cc40a5a](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=199668e936ba87e2f9d88562d83b89dc3cc40a5a) ([diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406&id2=199668e936ba87e2f9d88562d83b89dc3cc40a5a)) | |

Bug 698887: Fix leak of device/pixmap when rendering fails.[Diffstat](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)

| -rw-r--r-- | [source/fitz/util.c](/cgi-bin/cgit.cgi/mupdf.git/diff/source/fitz/util.c?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 4 deletions

| diff --git a/source/fitz/util.c b/source/fitz/util.cindex aea89144b..8f0d9f620 100644--- a/[source/fitz/util.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/fitz/util.c?id=199668e936ba87e2f9d88562d83b89dc3cc40a5a)+++ b/[source/fitz/util.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/fitz/util.c?id=8aa2bd34065d2844aae778bd4cc20c74bbcd9406)@@ -217,18 +217,21 @@ fz\_new\_pixmap\_from\_page(fz\_context \*ctx, fz\_page \*page, fz\_matrix ctm, fz\_colors fz\_pixmap \*pix; fz\_device \*dev = NULL; + fz\_var(dev);+ rect = fz\_bound\_page(ctx, page); rect = fz\_transform\_rect(rect, ctm); bbox = fz\_round\_rect(rect);  pix = fz\_new\_pixmap\_with\_bbox(ctx, cs, bbox, 0, alpha);- if (alpha)- fz\_clear\_pixmap(ctx, pix);- else- fz\_clear\_pixmap\_with\_value(ctx, pix, 0xFF);  fz\_try(ctx) {+ if (alpha)+ fz\_clear\_pixmap(ctx, pix);+ else+ fz\_clear\_pixmap\_with\_value(ctx, pix, 0xFF);+ dev = fz\_new\_draw\_device(ctx, ctm, pix); fz\_run\_page(ctx, page, dev, fz\_identity, NULL); fz\_close\_device(ctx, dev); |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 06:56:51 +0000

