=== Content from github.com_2fe3d519_20250111_074959.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhanxuer%2Fcrashes%2Fblob%2Fmain%2Fflvmeta%2F01%2Freadme.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhanxuer%2Fcrashes%2Fblob%2Fmain%2Fflvmeta%2F01%2Freadme.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=hanxuer%2Fcrashes)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hanxuer](/hanxuer)
/
**[crashes](/hanxuer/crashes)**
Public

* [Notifications](/login?return_to=%2Fhanxuer%2Fcrashes) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2Fhanxuer%2Fcrashes)
* [Star
   0](/login?return_to=%2Fhanxuer%2Fcrashes)

* [Code](/hanxuer/crashes)
* [Issues
  0](/hanxuer/crashes/issues)
* [Pull requests
  0](/hanxuer/crashes/pulls)
* [Actions](/hanxuer/crashes/actions)
* [Projects
  0](/hanxuer/crashes/projects)
* [Security](/hanxuer/crashes/security)
* [Insights](/hanxuer/crashes/pulse)

Additional navigation options

* [Code](/hanxuer/crashes)
* [Issues](/hanxuer/crashes/issues)
* [Pull requests](/hanxuer/crashes/pulls)
* [Actions](/hanxuer/crashes/actions)
* [Projects](/hanxuer/crashes/projects)
* [Security](/hanxuer/crashes/security)
* [Insights](/hanxuer/crashes/pulse)

## Files

¬†main
## Breadcrumbs

1. [crashes](/hanxuer/crashes/tree/main)
2. /[flvmeta](/hanxuer/crashes/tree/main/flvmeta)
3. /[01](/hanxuer/crashes/tree/main/flvmeta/01)
/
# readme.md

Copy path Blame  Blame
## Latest commit

## History

[History](/hanxuer/crashes/commits/main/flvmeta/01/readme.md)127 lines (114 loc) ¬∑ 5.43 KB¬†main
## Breadcrumbs

1. [crashes](/hanxuer/crashes/tree/main)
2. /[flvmeta](/hanxuer/crashes/tree/main/flvmeta)
3. /[01](/hanxuer/crashes/tree/main/flvmeta/01)
/
# readme.md

Top
## File metadata and controls

* Preview
* Code
* Blame

127 lines (114 loc) ¬∑ 5.43 KB[Raw](https://github.com/hanxuer/crashes/raw/refs/heads/main/flvmeta/01/readme.md)
### 1.The name and version of the affected product:

```
flvmeta 1.2.2

Copyright (C) 2007-2019 Marc Noirot <marc.noirot AT gmail.com>
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

```

### 2.Description

flvmeta v1.2.2 was detected to contain a heap-use-after-free via the function flvmeta/src/flv.c:375:21 in flv\_close

### 3.environment

```
$ uname -a
Linux ubuntu 5.4.0-152-generic #169~18.04.1-Ubuntu SMP Wed Jun 7 22:22:24 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux

```

### 4.compiler with asan

```
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_FLAGS="-fsanitize=address"
make

```

### 5.how to reproduce

./flvmeta/build/src/flvmeta ./poc

### 6.Asan report

```
==129869==ERROR: AddressSanitizer: heap-use-after-free on address 0x604000000010 at pc 0x000000539f2c bp 0x7ffc37b92ee0 sp 0x7ffc37b92ed8
READ of size 8 at 0x604000000010 thread T0
    #0 0x539f2b in flv_close /flvmeta/flvmeta/src/flv.c:375:21
    #1 0x53bce3 in flv_parse /flvmeta/flvmeta/src/flv.c:525:17
    #2 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14
    #3 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50
    #4 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310
    #5 0x41c7f9 in _start (/flvmeta/flvmeta/build/src/flvmeta+0x41c7f9)

0x604000000010 is located 0 bytes inside of 40-byte region [0x604000000010,0x604000000038)
freed by thread T0 here:
    #0 0x4dc4e0 in __interceptor_free.localalias.0 (/flvmeta/flvmeta-cov/build/src/flvmeta+0x4dc4e0)
    #1 0x539f79 in flv_close /flvmeta/flvmeta/src/flv.c:378:9
    #2 0x539e83 in flv_read_video_tag /flvmeta/flvmeta/src/flv.c:250:13
    #3 0x53bc93 in flv_parse /flvmeta/flvmeta/src/flv.c:523:22
    #4 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14
    #5 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50
    #6 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310

previously allocated by thread T0 here:
    #0 0x4dc6b0 in malloc (/flvmeta/flvmeta/build/src/flvmeta+0x4dc6b0)
    #1 0x53771a in flv_open /flvmeta/flvmeta/src/flv.c:52:42
    #2 0x53b5d9 in flv_parse /flvmeta/flvmeta/src/flv.c:480:22
    #3 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14
    #4 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50
    #5 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310

SUMMARY: AddressSanitizer: heap-use-after-free /flvmeta/flvmeta-cov/src/flv.c:375:21 in flv_close
Shadow bytes around the buggy address:
  0x0c087fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c087fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c087fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c087fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c087fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0c087fff8000: fa fa[fd]fd fd fd fd fa fa fa fa fa fa fa fa fa
  0x0c087fff8010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c087fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c087fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c087fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c087fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==129869==ABORTING

```

gdb backtrace

```
gef‚û§  bt
#0  __GI_raise (sig=sig@entry=0x6) at ../sysdeps/unix/sysv/linux/raise.c:51
#1  0x00007ffff76847f1 in __GI_abort () at abort.c:79
#2  0x00007ffff76cd837 in __libc_message (action=action@entry=do_abort, fmt=fmt@entry=0x7ffff77faa7b "%s\n") at ../sysdeps/posix/libc_fatal.c:181
#3  0x00007ffff76d48ba in malloc_printerr (str=str@entry=0x7ffff77fc6e8 "free(): double free detected in tcache 2") at malloc.c:5342
#4  0x00007ffff76dc0ed in _int_free (have_lock=0x0, p=0x693250, av=0x7ffff7a2fc40 <main_arena>) at malloc.c:4195
#5  __GI___libc_free (mem=0x693260) at malloc.c:3134
#6  0x00000000004223d3 in flv_close (stream=0x693260) at /home/hanxuerr/myfuzz/target_program/flvmeta/flvmeta/src/flv.c:378
#7  0x000000000042394c in flv_parse (file=<optimized out>, parser=<optimized out>) at /flvmeta/flvmeta/src/flv.c:525
#8  0x000000000041a41d in dump_metadata (options=0x652530 <main.options>) at /flvmeta/flvmeta/src/dump.c:180
#9  0x0000000000424937 in main (argc=<optimized out>, argv=<optimized out>) at /flvmeta/flvmeta/src/flvmeta.c:385

```

### source code

```
void flv_close(flv_stream * stream) {
    if (stream != NULL) {
        if (stream->flvin != NULL) {
            fclose(stream->flvin);
        }
        free(stream); // flv.c:378
    }
}

else if (tag.type == FLV_TAG_TYPE_VIDEO) {
            retval = flv_read_video_tag(parser->stream, &vt);
            if (retval == FLV_ERROR_EOF) {
                flv_close(parser->stream);  //flv.c:525
                return retval;
            }
```

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_5243c20a_20250111_075000.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnoirotm%2Fflvmeta%2Fissues%2F23)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnoirotm%2Fflvmeta%2Fissues%2F23)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=noirotm%2Fflvmeta)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[noirotm](/noirotm)
/
**[flvmeta](/noirotm/flvmeta)**
Public

* [Notifications](/login?return_to=%2Fnoirotm%2Fflvmeta) You must be signed in to change notification settings
* [Fork
  35](/login?return_to=%2Fnoirotm%2Fflvmeta)
* [Star
   122](/login?return_to=%2Fnoirotm%2Fflvmeta)

* [Code](/noirotm/flvmeta)
* [Issues
  4](/noirotm/flvmeta/issues)
* [Pull requests
  1](/noirotm/flvmeta/pulls)
* [Actions](/noirotm/flvmeta/actions)
* [Projects
  0](/noirotm/flvmeta/projects)
* [Wiki](/noirotm/flvmeta/wiki)
* [Security](/noirotm/flvmeta/security)
* [Insights](/noirotm/flvmeta/pulse)

Additional navigation options

* [Code](/noirotm/flvmeta)
* [Issues](/noirotm/flvmeta/issues)
* [Pull requests](/noirotm/flvmeta/pulls)
* [Actions](/noirotm/flvmeta/actions)
* [Projects](/noirotm/flvmeta/projects)
* [Wiki](/noirotm/flvmeta/wiki)
* [Security](/noirotm/flvmeta/security)
* [Insights](/noirotm/flvmeta/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnoirotm%2Fflvmeta%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnoirotm%2Fflvmeta%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# heap-use-after-free via the function flvmeta/src/flv.c:375:21 in flv\_close was detected #23

Closed

[hanxuer](/hanxuer) opened this issue
Jan 29, 2024
¬∑ 7 comments

Closed

# [heap-use-after-free via the function flvmeta/src/flv.c:375:21 in flv\_close was detected](#top) #23

[hanxuer](/hanxuer) opened this issue
Jan 29, 2024
¬∑ 7 comments

Assignees
[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm)

## Comments

[![@hanxuer](https://avatars.githubusercontent.com/u/61982907?s=80&u=b8d4fac77da6f89fe4d04ff3be6424f938fc4d2e&v=4)](/hanxuer)

Copy link

### **[hanxuer](/hanxuer)** commented [Jan 29, 2024](#issue-2105619312)

| Hello, I would like to bring to your attention that I have encountered a potential issue in the new version about the flvmeta 1.2.2 [0d3eb28](https://github.com/noirotm/flvmeta/commit/0d3eb281dd4bc17344fa53b05a78294f599c9327).I'm not sure if this is. This observation was made during testing on Ubuntu 18.04. Thank you for your understanding. compiler with asan ``` mkdir build cd build cmake .. -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_FLAGS="-fsanitize=address" make  ```  pocÔºö<https://github.com/hanxuer/crashes/raw/main/flvmeta/01/poc> reproduceÔºö ./flvmeta/build/src/flvmeta ./poc Asan report ``` ==129869==ERROR: AddressSanitizer: heap-use-after-free on address 0x604000000010 at pc 0x000000539f2c bp 0x7ffc37b92ee0 sp 0x7ffc37b92ed8 READ of size 8 at 0x604000000010 thread T0     #0 0x539f2b in flv_close /flvmeta/flvmeta/src/flv.c:375:21     #1 0x53bce3 in flv_parse /flvmeta/flvmeta/src/flv.c:525:17     #2 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14     #3 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50     #4 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310     #5 0x41c7f9 in _start (/flvmeta/flvmeta/build/src/flvmeta+0x41c7f9)  0x604000000010 is located 0 bytes inside of 40-byte region [0x604000000010,0x604000000038) freed by thread T0 here:     #0 0x4dc4e0 in __interceptor_free.localalias.0 (/flvmeta/flvmeta-cov/build/src/flvmeta+0x4dc4e0)     #1 0x539f79 in flv_close /flvmeta/flvmeta/src/flv.c:378:9     #2 0x539e83 in flv_read_video_tag /flvmeta/flvmeta/src/flv.c:250:13     #3 0x53bc93 in flv_parse /flvmeta/flvmeta/src/flv.c:523:22     #4 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14     #5 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50     #6 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310  previously allocated by thread T0 here:     #0 0x4dc6b0 in malloc (/flvmeta/flvmeta/build/src/flvmeta+0x4dc6b0)     #1 0x53771a in flv_open /flvmeta/flvmeta/src/flv.c:52:42     #2 0x53b5d9 in flv_parse /flvmeta/flvmeta/src/flv.c:480:22     #3 0x52c487 in dump_metadata /flvmeta/flvmeta/src/dump.c:180:14     #4 0x53c9cb in main /flvmeta/flvmeta/src/flvmeta.c:385:50     #5 0x7faea13ddc86 in __libc_start_main /build/glibc-CVJwZb/glibc-2.27/csu/../csu/libc-start.c:310  SUMMARY: AddressSanitizer: heap-use-after-free /flvmeta/flvmeta-cov/src/flv.c:375:21 in flv_close Shadow bytes around the buggy address:   0x0c087fff7fb0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c087fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c087fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c087fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c087fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c087fff8000: fa fa[fd]fd fd fd fd fa fa fa fa fa fa fa fa fa   0x0c087fff8010: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c087fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c087fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c087fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c087fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==129869==ABORTING  ```  gdb backtrace  ``` gef‚û§  bt #0  __GI_raise (sig=sig@entry=0x6) at ../sysdeps/unix/sysv/linux/raise.c:51 #1  0x00007ffff76847f1 in __GI_abort () at abort.c:79 #2  0x00007ffff76cd837 in __libc_message (action=action@entry=do_abort, fmt=fmt@entry=0x7ffff77faa7b "%s\n") at ../sysdeps/posix/libc_fatal.c:181 #3  0x00007ffff76d48ba in malloc_printerr (str=str@entry=0x7ffff77fc6e8 "free(): double free detected in tcache 2") at malloc.c:5342 #4  0x00007ffff76dc0ed in _int_free (have_lock=0x0, p=0x693250, av=0x7ffff7a2fc40 <main_arena>) at malloc.c:4195 #5  __GI___libc_free (mem=0x693260) at malloc.c:3134 #6  0x00000000004223d3 in flv_close (stream=0x693260) at /home/hanxuerr/myfuzz/target_program/flvmeta/flvmeta/src/flv.c:378 #7  0x000000000042394c in flv_parse (file=<optimized out>, parser=<optimized out>) at /flvmeta/flvmeta/src/flv.c:525 #8  0x000000000041a41d in dump_metadata (options=0x652530 <main.options>) at /flvmeta/flvmeta/src/dump.c:180 #9  0x0000000000424937 in main (argc=<optimized out>, argv=<optimized out>) at /flvmeta/flvmeta/src/flvmeta.c:385  ``` source code ``` void flv_close(flv_stream * stream) {     if (stream != NULL) {         if (stream->flvin != NULL) {             fclose(stream->flvin);         }         free(stream); // flv.c:378     } }   else if (tag.type == FLV_TAG_TYPE_VIDEO) {             retval = flv_read_video_tag(parser->stream, &vt);             if (retval == FLV_ERROR_EOF) {                 flv_close(parser->stream);  //flv.c:525                 return retval;             } ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=80&v=4)](/noirotm)

Copy link

Owner

### **[noirotm](/noirotm)** commented [Jan 31, 2024](#issuecomment-1918809815)

| Hi! Thanks for the bug report. I will try to reproduce, and have an in-depth look at this. At first glance, I don't believe this has been introduced recently as the code you're pointing to hasn't been changed much. |
| --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=80&v=4)](/noirotm)

Copy link

Owner

### **[noirotm](/noirotm)** commented [Jan 31, 2024](#issuecomment-1918822927)

| I can reproduce a crash when trying to display metadata.  Also the check command gives this output, which demonstrates that we can see that there's something wrong in the file.  ``` $ flvmeta.exe -C poc.flv 0x00000003: error E11003: header version should be 1, 121 found instead 0x00000004: error E11007: header reserved flags are not zero 0x00000005: error E11008: header offset should be 9, 3825205257 found instead 0x00000009: error E12010: first previous tag size should be 0, 3909091698 found instead 0x0000000e: fatal F20016: tag body length (14617727 bytes) exceeds file size 5 error(s), 0 warning(s)  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=80&v=4)](/noirotm)

Copy link

Owner

### **[noirotm](/noirotm)** commented [Jan 31, 2024](#issuecomment-1918903723)

| At first glance, I don't believe this has been introduced recently as the code you're pointing to hasn't been changed much.  Nevermind, I found the bug.  It has been introduced in [5ad3d50](https://github.com/noirotm/flvmeta/commit/5ad3d503213e5d816a0c2e908f26c34767dd7d79). Problem is at   [flvmeta/src/flv.c](https://github.com/noirotm/flvmeta/blob/0d3eb281dd4bc17344fa53b05a78294f599c9327/src/flv.c#L250)  Line 250 in [0d3eb28](/noirotm/flvmeta/commit/0d3eb281dd4bc17344fa53b05a78294f599c9327)   |  | flv\_close(stream); | | --- | --- |      The `flv_read_video_tag` function should not call `flv_close` as it violates the ownership contract that only the owner of the `flv_stream` should be able to close it, and not the `flv_stream` itself.  I unfortunately overlooked this in my code review.  The more I review code in this project, the more I want to rewrite it in Rust üòÑ |
| --- | --- | --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm)
[noirotm](/noirotm)
self-assigned this
[Jan 31, 2024](#event-11655979851)

[![@hanxuer](https://avatars.githubusercontent.com/u/61982907?s=80&u=b8d4fac77da6f89fe4d04ff3be6424f938fc4d2e&v=4)](/hanxuer)

Copy link

Author

### **[hanxuer](/hanxuer)** commented [Jan 31, 2024](#issuecomment-1919460329)

| At first glance, I don't believe this has been introduced recently as the code you're pointing to hasn't been changed much.  Nevermind, I found the bug.  It has been introduced in [5ad3d50](https://github.com/noirotm/flvmeta/commit/5ad3d503213e5d816a0c2e908f26c34767dd7d79). Problem is at     [flvmeta/src/flv.c](https://github.com/noirotm/flvmeta/blob/0d3eb281dd4bc17344fa53b05a78294f599c9327/src/flv.c#L250)  Line 250 in [0d3eb28](/noirotm/flvmeta/commit/0d3eb281dd4bc17344fa53b05a78294f599c9327)   |  | flv\_close(stream); | | --- | --- |      The `flv_read_video_tag` function should not call `flv_close` as it violates the ownership contract that only the owner of the `flv_stream` should be able to close it, and not the `flv_stream` itself.  I unfortunately overlooked this in my code review.  The more I review code in this project, the more I want to rewrite it in Rust üòÑ  Thank you for attention to this issue.I am confident that you work will significantly bolster the project's stability üòä |
| --- | --- | --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm)
[noirotm](/noirotm)
closed this as [completed](/noirotm/flvmeta/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[b54861c](/noirotm/flvmeta/commit/b54861c940f2ebc67bf88c4f6841256dba8fb0ac)`
[Jan 31, 2024](#event-11659316589)

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=80&v=4)](/noirotm)

Copy link

Owner

### **[noirotm](/noirotm)** commented [Jan 31, 2024](#issuecomment-1919610512)

| Reopening issue to make sure the fix actually does the job. |
| --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm)
[noirotm](/noirotm)
reopened this
[Jan 31, 2024](#event-11659330232)

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=80&v=4)](/noirotm)

Copy link

Owner

### **[noirotm](/noirotm)** commented [Feb 8, 2024](#issuecomment-1934492012)

| [@hanxuer](https://github.com/hanxuer) Could you please confirm if [b54861c](https://github.com/noirotm/flvmeta/commit/b54861c940f2ebc67bf88c4f6841256dba8fb0ac) fixed the issue? |
| --- |

All reactions

Sorry, something went wrong.

[![@hanxuer](https://avatars.githubusercontent.com/u/61982907?s=80&u=b8d4fac77da6f89fe4d04ff3be6424f938fc4d2e&v=4)](/hanxuer)

Copy link

Author

### **[hanxuer](/hanxuer)** commented [Feb 8, 2024](#issuecomment-1934536894)

| [@hanxuer](https://github.com/hanxuer) Could you please confirm if [b54861c](https://github.com/noirotm/flvmeta/commit/b54861c940f2ebc67bf88c4f6841256dba8fb0ac) fixed the issue? There is no longer a use-after-free vulnerability. Thank you for your attention.üòä |
| --- |

All reactions

Sorry, something went wrong.

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm)
[noirotm](/noirotm)
closed this as [completed](/noirotm/flvmeta/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Feb 8, 2024](#event-11752002206)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnoirotm%2Fflvmeta%2Fissues%2F23)

Assignees

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=40&v=4)](/noirotm) [noirotm](/noirotm)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@noirotm](https://avatars.githubusercontent.com/u/280166?s=52&v=4)](/noirotm) [![@hanxuer](https://avatars.githubusercontent.com/u/61982907?s=52&v=4)](/hanxuer)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


