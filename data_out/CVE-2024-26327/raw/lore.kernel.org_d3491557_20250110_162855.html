<html><head><title>[PATCH v4 5/9] pcie_sriov: Validate NumVFs - Akihiko Odaki</title><link
rel=alternate
title="Atom feed"
href="../new.atom"
type="application/atom+xml"/><style>pre{white-space:pre-wrap}*{font-size:100%;font-family:monospace}</style><link
type=text/css
rel=stylesheet
href=../216light.css?66c655cb
media=screen,print /><link
type=text/css
rel=stylesheet
media="screen and (prefers-color-scheme:dark)"
href=../216dark.css?66c655cb /></head><body><form
action="../"><pre><a
href="../?t=20240214051608"><b>All of lore.kernel.org</b></a>
<input
name=q
type=text /><input
type=submit
value=search /> <a
href="../_/text/help/">help</a> / <a
href="../_/text/color/">color</a> / <a
id=mirror
href="../_/text/mirror/">mirror</a> / <a
href="../new.atom">Atom feed</a></pre></form><pre
id=b>From: Akihiko Odaki &lt;akihiko.odaki@daynix.com&gt;
To: &#34;Philippe Mathieu-Daud&#233;&#34; &lt;philmd@linaro.org&gt;,
	&#34;Michael S. Tsirkin&#34; &lt;mst@redhat.com&gt;,
	&#34;Marcel Apfelbaum&#34; &lt;marcel.apfelbaum@gmail.com&gt;,
	&#34;Alex Williamson&#34; &lt;alex.williamson@redhat.com&gt;,
	&#34;C&#233;dric Le Goater&#34; &lt;clg@redhat.com&gt;,
	&#34;Paolo Bonzini&#34; &lt;pbonzini@redhat.com&gt;,
	&#34;Daniel P. Berrang&#233;&#34; &lt;berrange@redhat.com&gt;,
	&#34;Eduardo Habkost&#34; &lt;eduardo@habkost.net&gt;,
	&#34;Sriram Yagnaraman&#34; &lt;sriram.yagnaraman@est.tech&gt;,
	&#34;Jason Wang&#34; &lt;jasowang@redhat.com&gt;,
	&#34;Keith Busch&#34; &lt;kbusch@kernel.org&gt;,
	&#34;Klaus Jensen&#34; &lt;its@irrelevant.dk&gt;
Cc: <a
href="../../qemu-devel/?t=20240214051608">qemu-devel@nongnu.org</a>, qemu-block@nongnu.org,
	 Akihiko Odaki &lt;akihiko.odaki@daynix.com&gt;
Subject: <a
href="#r"
id=t>[PATCH v4 5/9] pcie_sriov: Validate NumVFs</a>
Date: Wed, 14 Feb 2024 14:13:43 +0900	<a
href="#r">[thread overview]</a>
Message-ID: &lt;20240214-reuse-v4-5-89ad093a07f4@daynix.com&gt; (<a href="raw">raw</a>)
In-Reply-To: &lt;<a
href="../20240214-reuse-v4-0-89ad093a07f4@daynix.com/">20240214-reuse-v4-0-89ad093a07f4@daynix.com</a>&gt;

The guest may write NumVFs greater than TotalVFs and that can lead
to buffer overflow in VF implementations.

Fixes: 7c0fa8dff811 (&#34;pcie: Add support for Single Root I/O Virtualization (SR/IOV)&#34;)
Signed-off-by: Akihiko Odaki &lt;akihiko.odaki@daynix.com&gt;
---
 <a
id=iZ31hw:pci:pcie_sriov.c
href=#Z31hw:pci:pcie_sriov.c>hw/pci/pcie_sriov.c</a> | 3 +++
 1 file <a href="#related">changed</a>, 3 insertions(+)

<span
class="head"><a
href=#iZ31hw:pci:pcie_sriov.c
id=Z31hw:pci:pcie_sriov.c>diff</a> --git a/hw/pci/pcie_sriov.c b/hw/pci/pcie_sriov.c
index a1fe65f5d801..da209b7f47fd 100644
--- a/hw/pci/pcie_sriov.c
+++ b/hw/pci/pcie_sriov.c
</span><span
class="hunk">@@ -176,6 +176,9 @@ static void register_vfs(PCIDevice *dev)
</span> 
     assert(sriov_cap &gt; 0);
     num_vfs = pci_get_word(dev-&gt;config + sriov_cap + PCI_SRIOV_NUM_VF);
<span
class="add">+    if (num_vfs &gt; pci_get_word(dev-&gt;config + sriov_cap + PCI_SRIOV_TOTAL_VF)) {
+        return;
+    }
</span> 
     dev-&gt;exp.sriov_pf.vf = g_new(PCIDevice *, num_vfs);
 

-- 
2.43.0


</pre><hr><pre><a
href="../20240214015107-mutt-send-email-mst@kernel.org/"
rel=next>next</a> <a
href="../20240214-reuse-v4-4-89ad093a07f4@daynix.com/"
rel=prev>prev</a> <a
href="../20240214-reuse-v4-0-89ad093a07f4@daynix.com/">parent</a> <a
href="#R">reply</a>	other threads:[<a
href="../?t=20240214051608">~2024-02-14  5:16 UTC</a>|<a
href="../">newest</a>]

<b>Thread overview: </b>34+ messages / expand[<a
href="T/#u">flat</a>|<a
href="t/#u">nested</a>]  <a
href="t.mbox.gz">mbox.gz</a>  <a
href="t.atom">Atom feed</a>  <a
href="#b">top</a>
2024-02-14  5:13 <a
href="../20240214-reuse-v4-0-89ad093a07f4@daynix.com/">[PATCH v4 0/9] hw/pci: SR-IOV related fixes and improvements</a> Akihiko Odaki
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-1-89ad093a07f4@daynix.com/">[PATCH v4 1/9] hw/pci: Use -1 as a default value for rombar</a> Akihiko Odaki
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-2-89ad093a07f4@daynix.com/">[PATCH v4 2/9] hw/pci: Determine if rombar is explicitly enabled</a> Akihiko Odaki
2024-02-14  6:49   ` <a
href="../20240214014345-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-3-89ad093a07f4@daynix.com/">[PATCH v4 3/9] vfio: Avoid inspecting option QDict for rombar</a> Akihiko Odaki
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-4-89ad093a07f4@daynix.com/">[PATCH v4 4/9] hw/qdev: Remove opts member</a> Akihiko Odaki
<b>2024-02-14  5:13 ` <a
id=r
href="#t">Akihiko Odaki [this message]</a></b>
2024-02-14  6:52   ` <a
href="../20240214015107-mutt-send-email-mst@kernel.org/">[PATCH v4 5/9] pcie_sriov: Validate NumVFs</a> Michael S. Tsirkin
2024-02-14 14:49     ` <a
href="../dbb8562b-6532-45af-a6fe-63bbf9b74a1d@daynix.com/">Akihiko Odaki</a>
2024-02-14 15:54       ` <a
href="../20240214105244-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 16:22         ` <a
href="../ee785cca-76c0-4e27-babe-907e849ef0bb@daynix.com/">Akihiko Odaki</a>
2024-02-14  8:58   ` <a
href="../bd6328d1-6568-4ac1-9be4-293bccc722e3@tls.msk.ru/">Michael Tokarev</a>
2024-02-14 14:54     ` <a
href="../56e83476-f607-482e-a9f2-e473148de839@daynix.com/">Akihiko Odaki</a>
2024-02-14 15:53       ` <a
href="../0282c0e6-1e1b-4960-ad74-3e186062b4d7@tls.msk.ru/">Michael Tokarev</a>
2024-02-14 15:55         ` <a
href="../20240214105534-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-17 11:32           ` <a
href="../795247c3-f79b-4385-8bea-0de9c9a8d554@daynix.com/">Akihiko Odaki</a>
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-6-89ad093a07f4@daynix.com/">[PATCH v4 6/9] pcie_sriov: Reuse SR-IOV VF device instances</a> Akihiko Odaki
2024-02-14  7:54   ` <a
href="../20240214024239-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 14:44     ` <a
href="../3e889cd9-0d3e-4d35-ba74-4dc95ca26504@daynix.com/">Akihiko Odaki</a>
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-7-89ad093a07f4@daynix.com/">[PATCH v4 7/9] pcie_sriov: Release VFs failed to realize</a> Akihiko Odaki
2024-02-14  7:54   ` <a
href="../20240214025430-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14  7:58     ` <a
href="../05044456-50f5-4d18-8de6-42215145cb55@daynix.com/">Akihiko Odaki</a>
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-8-89ad093a07f4@daynix.com/">[PATCH v4 8/9] pcie_sriov: Do not reset NumVFs after unregistering VFs</a> Akihiko Odaki
2024-02-14  6:53   ` <a
href="../20240214015322-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 14:32     ` <a
href="../a20793a9-87b0-4a3d-9032-590502454dd0@daynix.com/">Akihiko Odaki</a>
2024-02-14 15:51       ` <a
href="../20240214104637-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 16:10         ` <a
href="../baa47c5d-050d-4687-bacd-f16ba1740ecc@daynix.com/">Akihiko Odaki</a>
2024-02-14  5:13 ` <a
href="../20240214-reuse-v4-9-89ad093a07f4@daynix.com/">[PATCH v4 9/9] hw/nvme: Refer to dev-&gt;exp.sriov_pf.num_vfs</a> Akihiko Odaki
2024-02-14  7:07   ` <a
href="../20240214015457-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 14:09     ` <a
href="../c7369ada-96b1-41ad-b141-ff7f1e1dc291@daynix.com/">Akihiko Odaki</a>
2024-02-14 15:46       ` <a
href="../20240214103705-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 16:07         ` <a
href="../0f7ae8e0-6c59-400a-8fc0-7ab21b7471d2@daynix.com/">Akihiko Odaki</a>
2024-02-14 16:34           ` <a
href="../20240214113312-mutt-send-email-mst@kernel.org/">Michael S. Tsirkin</a>
2024-02-14 16:51             ` <a
href="../7ad59c7d-2de4-4de6-aa6a-0c27f63ca8c3@daynix.com/">Akihiko Odaki</a>
</pre><form id=related
action=../
><pre>find likely ancestor, descendant, or conflicting patches for <a
href=#t>this message</a>:
<textarea name=q cols=72 rows=3>( dfblob:a1fe65f5d80 dfblob:da209b7f47f )
 OR (
bs:&#34;[PATCH v4 5/9] pcie_sriov: Validate NumVFs&#34; )</textarea>
<input type=submit value=search
/>	(<a href=../_/text/help/#search>help</a>)</pre></form>
<hr><pre
id=R><b>Reply instructions:</b>

You may reply publicly to <a
href=#t>this message</a> via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: <a
href=raw>mbox</a>

  Avoid top-posting and favor interleaved quoting:
  <a
href="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</a>

* Reply using the <b>--to</b>, <b>--cc</b>, and <b>--in-reply-to</b>
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20240214-reuse-v4-5-89ad093a07f4@daynix.com \
    --to=akihiko.odaki@daynix.com \
    --cc=alex.williamson@redhat.com \
    --cc=berrange@redhat.com \
    --cc=clg@redhat.com \
    --cc=eduardo@habkost.net \
    --cc=its@irrelevant.dk \
    --cc=jasowang@redhat.com \
    --cc=kbusch@kernel.org \
    --cc=marcel.apfelbaum@gmail.com \
    --cc=mst@redhat.com \
    --cc=pbonzini@redhat.com \
    --cc=philmd@linaro.org \
    --cc=qemu-block@nongnu.org \
    --cc=qemu-devel@nongnu.org \
    --cc=sriram.yagnaraman@est.tech \
    /path/to/YOUR_REPLY

  <a
href="https://kernel.org/pub/software/scm/git/docs/git-send-email.html">https://kernel.org/pub/software/scm/git/docs/git-send-email.html</a>

* If your mail client supports setting the <b>In-Reply-To</b> header
  via mailto: links, try the <a
href="mailto:akihiko.odaki@daynix.com?In-Reply-To=%3C20240214-reuse-v4-5-89ad093a07f4@daynix.com%3E&#38;Cc=alex.williamson%40redhat.com%2Cberrange%40redhat.com%2Cclg%40redhat.com%2Ceduardo%40habkost.net%2Cits%40irrelevant.dk%2Cjasowang%40redhat.com%2Ckbusch%40kernel.org%2Cmarcel.apfelbaum%40gmail.com%2Cmst%40redhat.com%2Cpbonzini%40redhat.com%2Cphilmd%40linaro.org%2Cqemu-block%40nongnu.org%2Cqemu-devel%40nongnu.org%2Csriram.yagnaraman%40est.tech&#38;Subject=Re%3A%20%5BPATCH%20v4%205%2F9%5D%20pcie_sriov%3A%20Validate%20NumVFs">mailto: link</a>
</pre>

  Be sure your reply has a <b>Subject:</b> header at the top and a blank line
  before the message body.
<hr><pre>This is an external index of several public inboxes,
see <a href="../_/text/mirror/">mirroring instructions</a> on how to clone and mirror
all data and code used by this external index.</pre></body></html>