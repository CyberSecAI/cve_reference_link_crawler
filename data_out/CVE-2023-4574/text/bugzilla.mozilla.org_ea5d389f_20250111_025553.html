

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1846688)
* [XML](/show_bug.cgi?ctype=xml&id=1846688)

Closed
[Bug 1846688](/show_bug.cgi?id=1846688)
(CVE-2023-4574)

Opened 1 years ago
Closed 1 year ago

# use-after-free in ColorPickerShownCallback

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

use-after-free in ColorPickerShownCallback

## Categories

### (Core :: DOM: Content Processes, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Content%20Processes#DOM%3A%20Content%20Processes)

DOM: Content Processes
▾

Core :: DOM: Content Processes
Issues related to implementation of content processes in Firefox, especially the code in dom/ipc ([more info](https://wiki.mozilla.org/Project\_Fission))
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Content%20Processes&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Content%20Processes&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Content%20Processes)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

118 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | [117+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=117%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed) |
| firefox-esr115 | [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox116 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix) |
| firefox117 | [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) |
| firefox118 | [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 | 117+ | fixed |
| firefox-esr115 | 117+ | fixed |
| firefox-esr128 | --- | --- |
| firefox116 |  | wontfix |
| firefox117 | + | fixed |
| firefox118 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sonakkbi, Assigned: vhilla)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a8fd53ad2b0e29c7dcd466d08a6c4b4a?d=mm&size=40)  [vhilla](/user_profile?user_id=725173)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/fbcb684d5cd0458d775e9361e0bd6cb6?d=mm&size=40)  [sonakkbi](/user_profile?user_id=698655)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/2b84b1a415615d22d7afc6554020d164?d=mm&size=40)  [jjalkanen](/user_profile?user_id=689836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

### (Regression)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[910384](/show_bug.cgi?id=910384 "VERIFIED FIXED - [e10s] File picker doesn't work")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2023-4575](/show_bug.cgi?id=1846689 "RESOLVED FIXED - use-after-free in FilePickerShownCallback")

## Details

### (6 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-4574

[Keywords:](/describekeywords.cgi)

[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1163740_1689 "1 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 1 obsolete file)

| [ASAN.txt](/attachment.cgi?id=9346872)  [1 years ago](#c0)  [sonakkbi](/user_profile?user_id=698655)   13.40 KB, text/plain |  | [Details](/attachment.cgi?id=9346872&action=edit) |
| --- | --- | --- |
| [index.html](/attachment.cgi?id=9346873)  [1 years ago](#c1)  [sonakkbi](/user_profile?user_id=698655)   215 bytes, text/html |  | [Details](/attachment.cgi?id=9346873&action=edit) |
| [patch.diff](/attachment.cgi?id=9346874)  [1 years ago](#c2)  [sonakkbi](/user_profile?user_id=698655)   986 bytes, patch |  | [Details](/attachment.cgi?id=9346874&action=edit) | [Diff](/attachment.cgi?id=9346874&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846688&attachment=9346874) |
| [patch.diff](/attachment.cgi?id=9346875)  [1 years ago](#c3)  [sonakkbi](/user_profile?user_id=698655)   986 bytes, patch |  | [Details](/attachment.cgi?id=9346875&action=edit) | [Diff](/attachment.cgi?id=9346875&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846688&attachment=9346875) |
| [Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8](/attachment.cgi?id=9348238)  [1 year ago](#c6)  [Vincent Hilla [:vhilla]](/user_profile?user_id=725173)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c13 "1 year ago")  RyanVM : [approval-mozilla-esr102+](#c13 "1 year ago")  RyanVM : [approval-mozilla-esr115+](#c13 "1 year ago")  tjr : [sec-approval+](#c8 "1 year ago") | [Details](/attachment.cgi?id=9348238&action=edit) | [Review](/attachment.cgi?id=9348238) |
| [Bug 1846688 - Backport ManualDealloc removal from ColorPicker and FilePicker.](/attachment.cgi?id=9349601)  [1 year ago](#c17)  [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr102+](#a1420467_75935 "1 year ago") | [Details](/attachment.cgi?id=9349601&action=edit) | [Review](/attachment.cgi?id=9349601) |
| [advisory.txt](/attachment.cgi?id=9350232)  [1 year ago](#c20)  [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341)   354 bytes, text/plain |  | [Details](/attachment.cgi?id=9350232&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1846688#c0)• 1 years ago |
|  | |

Attached file
[ASAN.txt](attachment.cgi?id=9346872)
— [Details](attachment.cgi?id=9346872&action=edit)

|ColorPickerShownCallback| is requested when a Color Picker window open[1](https://searchfox.org/mozilla-central/source/dom/ipc/ColorPickerParent.cpp#66). It isn’t considered several |ColorPickerShownCallbacks| are requested at a time. And |Done()| will destroy |mColorPickerParent|[2](https://searchfox.org/mozilla-central/source/dom/ipc/ColorPickerParent.cpp#30). This leads to use-after-free when another |Done()| is called after a |Done()|

REPRODUCE

1. apply \*patch.diff
2. visit index.html

\*: Patch to emulate a compromised content process.

Crash State: see asan file

Flags: sec-bounty?

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1846688#c1)• 1 years ago |
|  | |

Attached file
[index.html](attachment.cgi?id=9346873)
— [Details](attachment.cgi?id=9346873&action=edit)

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1846688#c2)• 1 years ago |
|  | |

Attached patch

[patch.diff](attachment.cgi?id=9346874&action=diff)
— [Details](attachment.cgi?id=9346874&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846688&attachment=9346874)

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1846688#c3)• 1 years ago |
|  | |

Attached patch

[patch.diff](attachment.cgi?id=9346875&action=diff) (obsolete)
— [Details](attachment.cgi?id=9346875&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846688&attachment=9346875)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a19641_159069)• 1 years ago |

Group: firefox-core-security → dom-core-securityComponent: Security → DOM: Content ProcessesProduct: Firefox → CoreSee Also: → [CVE-2023-4575](/show_bug.cgi?id=1846689 "RESOLVED FIXED - use-after-free in FilePickerShownCallback")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1846688#c4)• 1 years ago |
|  | |

Comment on [attachment 9346875](/attachment.cgi?id=9346875 "patch.diff") [[details]](/attachment.cgi?id=9346875&action=edit "patch.diff") [[diff]](/attachment.cgi?id=9346875&action=diff "patch.diff") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1846688&attachment=9346875)

patch.diff

hiding to avoid confusion... duplicate attachment

[Attachment #9346875](/attachment.cgi?id=9346875&action=edit "patch.diff") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a52438_1689)• 1 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a53590_1689)• 1 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a486280_406194)• 1 year ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a624130_646284)• 1 year ago |

Severity: -- → S2Priority: -- → P2

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1846688#c5)• 1 year ago |
|  | |

As this code is basically identical to the code in [bug 1846689](/show_bug.cgi?id=1846689 "RESOLVED FIXED - use-after-free in FilePickerShownCallback"), we want to make sure these are fixed in the same release.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a632449_406194)• 1 year ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Vincent Hilla [:vhilla]](/user_profile?user_id=725173)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a638283_725173)• 1 year ago |

Assignee: nobody → vhilla

|  | [Vincent Hilla [:vhilla]](/user_profile?user_id=725173)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1846688#c6)• 1 year ago |
|  | |

Attached file
[Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8](attachment.cgi?id=9348238)
— [Details](attachment.cgi?id=9348238&action=edit)

Depends on D185820

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a640497_600971)• 1 year ago |

[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Attachment description: Bug 1846688 - Prevent multiple color picker from breaking. r=mccr8 → Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

|  | [Vincent Hilla [:vhilla]](/user_profile?user_id=725173)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1846688#c7)• 1 year ago |
|  | |

Comment on [attachment 9348238](/attachment.cgi?id=9348238 "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") [[details]](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8")

[Bug 1846688](/show_bug.cgi?id=1846688 "RESOLVED FIXED - use-after-free in ColorPickerShownCallback") - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: To exploit this bug, there first has to be a content-RCE security bug compromising the child process.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Yes
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: [Bug 910384](/show_bug.cgi?id=910384 "VERIFIED FIXED - [e10s] File picker doesn't work")
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: The same patch should apply to older versions too.
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely. The main concern are leaks, though the newly introduced strong reference is always cleared in FilePickerParent::ActorDestroy.
* **Is Android affected?**: Unknown
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1846688#c8)• 1 year ago |
|  | |

Comment on [attachment 9348238](/attachment.cgi?id=9348238 "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") [[details]](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8")

[Bug 1846688](/show_bug.cgi?id=1846688 "RESOLVED FIXED - use-after-free in ColorPickerShownCallback") - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

Approved to land and uplift

[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: sec-approval? → sec-approval+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1077579_75935)• 1 year ago |

[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox118](/buglist.cgi?f1=cf_tracking_firefox118&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=117%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Regressed by: [910384](/show_bug.cgi?id=910384 "VERIFIED FIXED - [e10s] File picker doesn't work")

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1846688#c9)• 1 year ago |
|  | |

Pushed by rvandermeulen@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/e69719641442>
Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1846688#c10)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e69719641442>

Status: NEW → RESOLVEDClosed: 1 year ago
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 118 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1846688#c11)• 1 year ago |
|  | |

The patch landed in nightly and beta is affected.

:vhilla, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox117` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(vhilla)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1163740_1689)• 1 year ago |

Flags: sec-bounty? → sec-bounty+

|  | [Vincent Hilla [:vhilla]](/user_profile?user_id=725173)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1846688#c12)• 1 year ago |
|  | |

Comment on [attachment 9348238](/attachment.cgi?id=9348238 "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") [[details]](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8")

[Bug 1846688](/show_bug.cgi?id=1846688 "RESOLVED FIXED - use-after-free in ColorPickerShownCallback") - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

### Beta/Release Uplift Approval Request

* **User impact if declined**: Security risk. If someone can compromise a child process, this UAF could enable a sandbox escape.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: [Bug 1846689](/show_bug.cgi?id=1846689 "RESOLVED FIXED - use-after-free in FilePickerShownCallback")
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The change is small with the only risk being a leak. Though the newly introduced strong reference is always cleared in ColorPickerParent::ActorDestroy, which should prevent such.
* **String changes made/needed**:
* **Is Android affected?**: Unknown

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: Security risk. If someone can compromise a child process, this UAF could enable a sandbox escape.
* **Fix Landed on Version**: 118
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The change is small with the only risk being a leak. Though the newly introduced strong reference is always cleared in ColorPickerParent::ActorDestroy, which should prevent such.
Flags: needinfo?(vhilla)
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr115?
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr102?
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1846688#c13)• 1 year ago |
|  | |

Comment on [attachment 9348238](/attachment.cgi?id=9348238 "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") [[details]](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8")

[Bug 1846688](/show_bug.cgi?id=1846688 "RESOLVED FIXED - use-after-free in ColorPickerShownCallback") - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8

Approved for 117.0b9, 115.2esr, and 102.15esr.

[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr115?
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr115+
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr102?
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-esr102+
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-beta?
[Attachment #9348238](/attachment.cgi?id=9348238&action=edit "Bug 1846688 - Make ColorPickerShownCallback::mCallback into a RefPtr. r=mccr8") -
Flags: approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1846688#c14)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/93fe46d88a5e>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1251828_75935)• 1 year ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1846688#c15)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/5c1290876623>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1252986_75935)• 1 year ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1846688#c16)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/21a369743b3a>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1406086_75935)• 1 year ago |

Group: dom-core-security → core-security-release
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1846688#c17)• 1 year ago |
|  | |

Attached file
[Bug 1846688 - Backport ManualDealloc removal from ColorPicker and FilePicker.](attachment.cgi?id=9349601)
— [Details](attachment.cgi?id=9349601&action=edit)

This is a rebased version of [bug 1816740](/show_bug.cgi?id=1816740 "RESOLVED FIXED - PFilePicker cleanup and modernization") #6:

<https://hg.mozilla.org/mozilla-central/rev/dab075577d74>

There should be no functional changes from this change, but it resolves

the build failures caused by the patches in [bug 1846688](/show_bug.cgi?id=1846688 "RESOLVED FIXED - use-after-free in ColorPickerShownCallback") and [bug 1846689](/show_bug.cgi?id=1846689 "RESOLVED FIXED - use-after-free in FilePickerShownCallback").

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1420467_75935)• 1 year ago |

[Attachment #9349601](/attachment.cgi?id=9349601&action=edit "Bug 1846688 - Backport ManualDealloc removal from ColorPicker and FilePicker.") -
Flags: approval-mozilla-esr102+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1846688#c18)• 1 year ago |
|  | |

# Uplift Approval Request

* **Is Android affected?**: no
* **Fix verified in Nightly**: no
* **Code covered by automated testing**: yes
* **Risk associated with taking this patch**: low
* **String changes made/needed**: --
* **Needs manual QE test**: yes
* **Explanation of risk level**: no functional changes; straightforward backport of (verified-in-Nightly) no-functional-changes patch on mainline
* **Steps to reproduce for manual QE testing**: confirm no crash when using `data:text/html,<input type=file multiple>`
* **User impact if declined**: can't easily uplift other dependent patches
Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1420567_75935)• 1 year ago |

Flags: qe-verify+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1846688#c19)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/6f58eb1a03ef>

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1634501_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1846688#c20)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9350232)
— [Details](attachment.cgi?id=9350232&action=edit)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a1985125_626341)• 1 year ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a13393362_1689)• 1 year ago |

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a13399258_1689)• 1 year ago |

Alias: CVE-2023-4574

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846688#a26132407_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1846688&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [sonakkbi](/user_profile?user_id=698655)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

