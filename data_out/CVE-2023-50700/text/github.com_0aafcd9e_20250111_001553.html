
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flinuxdeepin%2Fdeveloper-center%2Fissues%2F10007)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flinuxdeepin%2Fdeveloper-center%2Fissues%2F10007)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=linuxdeepin%2Fdeveloper-center)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[linuxdeepin](/linuxdeepin)
/
**[developer-center](/linuxdeepin/developer-center)**
Public

* [Notifications](/login?return_to=%2Flinuxdeepin%2Fdeveloper-center) You must be signed in to change notification settings
* [Fork
  74](/login?return_to=%2Flinuxdeepin%2Fdeveloper-center)
* [Star
   449](/login?return_to=%2Flinuxdeepin%2Fdeveloper-center)

* [Code](/linuxdeepin/developer-center)
* [Issues
  1.4k](/linuxdeepin/developer-center/issues)
* [Pull requests
  0](/linuxdeepin/developer-center/pulls)
* [Discussions](/linuxdeepin/developer-center/discussions)
* [Actions](/linuxdeepin/developer-center/actions)
* [Projects
  7](/linuxdeepin/developer-center/projects)
* [Wiki](/linuxdeepin/developer-center/wiki)
* [Security](/linuxdeepin/developer-center/security)
* [Insights](/linuxdeepin/developer-center/pulse)

Additional navigation options

* [Code](/linuxdeepin/developer-center)
* [Issues](/linuxdeepin/developer-center/issues)
* [Pull requests](/linuxdeepin/developer-center/pulls)
* [Discussions](/linuxdeepin/developer-center/discussions)
* [Actions](/linuxdeepin/developer-center/actions)
* [Projects](/linuxdeepin/developer-center/projects)
* [Wiki](/linuxdeepin/developer-center/wiki)
* [Security](/linuxdeepin/developer-center/security)
* [Insights](/linuxdeepin/developer-center/pulse)

# D-Bus and Policy security issues on dde-file-manager¬†#10007

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkOpenOpen[D-Bus and Policy security issues on dde-file-manager](#top)#10007Copy link![@hillwoodroc](https://avatars.githubusercontent.com/u/1880237?v=4&size=80)
## Description

![@hillwoodroc](https://avatars.githubusercontent.com/u/1880237?v=4&size=48)[hillwoodroc](https://github.com/hillwoodroc)opened [on Jul 26, 2024](https://github.com/linuxdeepin/developer-center/issues/10007#issue-2432139876)
### SUMMARY | ÈóÆÈ¢òÊ¶ÇË¶Å

This dde-file-manager-daemon is a security nightmare! None of the D-Bus methods it exports are protected by polkit so just any user can call them. While this is not generally a problem it *is* a problem here, because the exported methods allow a bunch of privileged operations to everybody.

### SOFTWARE/OS VERSIONS | ËΩØ‰ª∂/Á≥ªÁªüÁâàÊú¨‰ø°ÊÅØ

```
6.0.54 and before

```
### PRE-REQUIREMENT | È¢ÑÁΩÆÊù°‰ª∂

*No response*

### STEPS TO REPRODUCE | Â§çÁé∞Ê≠•È™§

From <https://bugzilla.opensuse.org/show_bug.cgi?id=1134132>

in the D-Bus configuration file com.deepin.filemanager.daemon.conf we find the following:

```
<!-- Only root can own the service -->
<policy user="root">
  <allow own="com.deepin.filemanager.daemon"/>
</policy>

<!-- Allow anyone to invoke methods on the interfaces -->
<policy context="default">
  <allow own="com.deepin.filemanager.daemon"/>

```

There are two "own=" lines one for root and one for everybody else. This allows any user to register this daemon (or actually: any program) on the D-Bus system bus. It allows to hijack other users' D-Bus connections. This is especially bad since for example in the method `setUserSharePassword` cleartext passwords are passed.

setUserSharePassword: allows to set arbitrary users' smd password. Changes the database in /var/lib/samba/private. If at all then this must only be allowed for the caller's username. This is now Polkit authenticated. The name is still passed unfiltered to`smbpasswd`, though. It could be a command line parameter "--evil". This should be filtered.

Newly added D-Bus methods:

* com.deepin.filemanager.daemon.MountControl.Mount: allows to mount file

  systems, not Polkit authenticated. There is support for "common" file

  systems, which is not implemented though. Then there's "cifs" which allows

  pretty much freedom about passing strings to "mkdir()" and to "mount()",

  creates directories with user controlled data in /media//samba. In

  principle allows "../" elements in paths, only the `mkdir()` luckily fails

  to follow them. Then there's a "dlnfs" file system plugin which looks for a

  "dlnfs" program before continuing. I couldn't find out what program this is

  supposed to be. It's not packaged on openSUSE anyway. A user controlled path

  is passed as command line argument to this program, which might allow

  privilege escalation, but I cannot say for sure, since I don't know the program.
* com.deepin.filemanager.daemon.MountControl.Unmount: allows to unmount some

  file systems. The plugins that deal with this use libmount mtab for finding

  out about already existing mounts. This could be tricked by users that are

  allowed to mount FUSE based file systems. They can choose arbitrary strings

  as "source device" that might confuse the logic in the plugins.
* com.deepin.filemanager.daemon.UserShareManager.CloseSmbShareByShareName:

  this tries to unmount a share via "smbcontrol smbd close-share %1", where %1

  is a user controlled string. There is no Polkit authentication. There are

  some checks that the resulting path is not a symlink or an escape out of

  /var/lib/samba/usershares. If somebody managed to mount a samba share under

  a weird name like "myshare --extra-parameter=this", then the

  resulting QProcess execution of smbcontrol might result in side effects.
* com.deepin.filemanager.daemon.UserShareManager.EnableSmbServices:

  allow to enable smbd and nmbd without authentication. This must be

  authenticated.
* com.deepin.filemanager.daemon.AccessControlManager:

  + SetAccessPolicy(): uses an unsafe utils::isValidInvoker() helper function

    that checks the callers /proc/%1/exe. This is a racy check that can we

    circumvented by unprivileged callers by replacing their process with one

    of the whitelisted ones.
  + SetVaultAccessPolicy(): use the same unsafe check
  + Chmod(): Allows to change the mode of arbitrary paths. Luckily Polkit

    authenticated. But there is a file existence check issue in there. If the

    file doesn't exist, then the call exists early without authenticating.

    Thus a caller can determine whether certain files exist or not, by

    observing whether Polkit authentication requests are sent out or not.

Overall this service still isn't fit for inclusion for a lot of reasons.

Most if not all of the D-Bus methods need to Polkit authenticated (they can

have a 'yes' setting for active users, if the methods don't allow highly

privileged things. But nobody & friends should not be allowed to call all

these methods.

Other shaky authentication tests should be dropped like this

utils::isValidInvoker().

The D-Bus configuration "own" line still needs to be fixed.

### OBSERVED RESULT | ËßÇÂØüÂà∞ÁöÑÁªìÊûú

*No response*

### EXPECTED RESULT | ÊúüÊúõÁöÑÁªìÊûú

*No response*

### ADDITIONAL INFORMATION | È¢ùÂ§ñË°•ÂÖÖ

*No response*

üëç1
## Activity

[Sign up for free](/signup?return_to=) **to join this conversation on GitHub.** Already have an account? [Sign in to comment](/login?return_to=)
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

