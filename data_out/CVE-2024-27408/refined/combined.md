=== Content from git.kernel.org_77ae6271_20250110_153629.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kory Maincent <kory.maincent@bootlin.com> | 2024-01-29 17:26:02 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:53:59 +0000 |
| commit | [f396b4df27cfe01a99f4b41f584c49e56477be3a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)) | |
| tree | [ccf05cad62a445fda392a6b72744e3b3557b45fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a) | |
| parent | [17be6f5cb223f22e4733ed8fe8b2247cbb677716](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=17be6f5cb223f22e4733ed8fe8b2247cbb677716) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a&id2=17be6f5cb223f22e4733ed8fe8b2247cbb677716)) | |
| download | [linux-f396b4df27cfe01a99f4b41f584c49e56477be3a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f396b4df27cfe01a99f4b41f584c49e56477be3a.tar.gz) | |

dmaengine: dw-edma: eDMA: Add sync read before starting the DMA transfer in remote setup[ Upstream commit bbcc1c83f343e580c3aa1f2a8593343bf7b55bba ]
The Linked list element and pointer are not stored in the same memory as
the eDMA controller register. If the doorbell register is toggled before
the full write of the linked list a race condition error will occur.
In remote setup we can only use a readl to the memory to assure the full
write has occurred.
Fixes: 7e4b8a4fbe2c ("dmaengine: Add Synopsys eDMA IP version 0 support")
Reviewed-by: Serge Semin <fancer.lancer@gmail.com>
Reviewed-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
Signed-off-by: Kory Maincent <kory.maincent@bootlin.com>
Link: [https://lore.kernel.org/r/20240129-b4-feature\_hdma\_mainline-v7-6-8e8c1acb7a46@bootlin.com](https://lore.kernel.org/r/20240129-b4-feature_hdma_mainline-v7-6-8e8c1acb7a46%40bootlin.com)
Signed-off-by: Vinod Koul <vkoul@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)

| -rw-r--r-- | [drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/dma/dw-edma/dw-edma-v0-core.c?id=f396b4df27cfe01a99f4b41f584c49e56477be3a) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 17 insertions, 0 deletions

| diff --git a/drivers/dma/dw-edma/dw-edma-v0-core.c b/drivers/dma/dw-edma/dw-edma-v0-core.cindex b38786f0ad7995..b75fdaffad9a4e 100644--- a/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=17be6f5cb223f22e4733ed8fe8b2247cbb677716)+++ b/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=f396b4df27cfe01a99f4b41f584c49e56477be3a)@@ -346,6 +346,20 @@ static void dw\_edma\_v0\_core\_write\_chunk(struct dw\_edma\_chunk \*chunk) dw\_edma\_v0\_write\_ll\_link(chunk, i, control, chunk->ll\_region.paddr); } +static void dw\_edma\_v0\_sync\_ll\_data(struct dw\_edma\_chunk \*chunk)+{+ /\*+ \* In case of remote eDMA engine setup, the DW PCIe RP/EP internal+ \* configuration registers and application memory are normally accessed+ \* over different buses. Ensure LL-data reaches the memory before the+ \* doorbell register is toggled by issuing the dummy-read from the remote+ \* LL memory in a hope that the MRd TLP will return only after the+ \* last MWr TLP is completed+ \*/+ if (!(chunk->chan->dw->chip->flags & DW\_EDMA\_CHIP\_LOCAL))+ readl(chunk->ll\_region.vaddr.io);+}+ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) { struct dw\_edma\_chan \*chan = chunk->chan;@@ -412,6 +426,9 @@ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) SET\_CH\_32(dw, chan->dir, chan->id, llp.msb, upper\_32\_bits(chunk->ll\_region.paddr)); }++ dw\_edma\_v0\_sync\_ll\_data(chunk);+ /\* Doorbell \*/ SET\_RW\_32(dw, chan->dir, doorbell, FIELD\_PREP(EDMA\_V0\_DOORBELL\_CH\_MASK, chan->id)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:35:06 +0000



=== Content from git.kernel.org_824239a4_20250110_153627.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kory Maincent <kory.maincent@bootlin.com> | 2024-01-29 17:26:02 +0100 |
| --- | --- | --- |
| committer | Vinod Koul <vkoul@kernel.org> | 2024-02-07 09:30:52 +0100 |
| commit | [bbcc1c83f343e580c3aa1f2a8593343bf7b55bba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)) | |
| tree | [88a03391fd3755c1401ab72bf5fd2ab683ff97aa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba) | |
| parent | [712a92a48158e02155b4b6b21e03a817f78c9b7e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=712a92a48158e02155b4b6b21e03a817f78c9b7e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba&id2=712a92a48158e02155b4b6b21e03a817f78c9b7e)) | |
| download | [linux-bbcc1c83f343e580c3aa1f2a8593343bf7b55bba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bbcc1c83f343e580c3aa1f2a8593343bf7b55bba.tar.gz) | |

dmaengine: dw-edma: eDMA: Add sync read before starting the DMA transfer in remote setupThe Linked list element and pointer are not stored in the same memory as
the eDMA controller register. If the doorbell register is toggled before
the full write of the linked list a race condition error will occur.
In remote setup we can only use a readl to the memory to assure the full
write has occurred.
Fixes: 7e4b8a4fbe2c ("dmaengine: Add Synopsys eDMA IP version 0 support")
Reviewed-by: Serge Semin <fancer.lancer@gmail.com>
Reviewed-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
Signed-off-by: Kory Maincent <kory.maincent@bootlin.com>
Link: [https://lore.kernel.org/r/20240129-b4-feature\_hdma\_mainline-v7-6-8e8c1acb7a46@bootlin.com](https://lore.kernel.org/r/20240129-b4-feature_hdma_mainline-v7-6-8e8c1acb7a46%40bootlin.com)
Signed-off-by: Vinod Koul <vkoul@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)

| -rw-r--r-- | [drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/dma/dw-edma/dw-edma-v0-core.c?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 17 insertions, 0 deletions

| diff --git a/drivers/dma/dw-edma/dw-edma-v0-core.c b/drivers/dma/dw-edma/dw-edma-v0-core.cindex b38786f0ad7995..b75fdaffad9a4e 100644--- a/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=712a92a48158e02155b4b6b21e03a817f78c9b7e)+++ b/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=bbcc1c83f343e580c3aa1f2a8593343bf7b55bba)@@ -346,6 +346,20 @@ static void dw\_edma\_v0\_core\_write\_chunk(struct dw\_edma\_chunk \*chunk) dw\_edma\_v0\_write\_ll\_link(chunk, i, control, chunk->ll\_region.paddr); } +static void dw\_edma\_v0\_sync\_ll\_data(struct dw\_edma\_chunk \*chunk)+{+ /\*+ \* In case of remote eDMA engine setup, the DW PCIe RP/EP internal+ \* configuration registers and application memory are normally accessed+ \* over different buses. Ensure LL-data reaches the memory before the+ \* doorbell register is toggled by issuing the dummy-read from the remote+ \* LL memory in a hope that the MRd TLP will return only after the+ \* last MWr TLP is completed+ \*/+ if (!(chunk->chan->dw->chip->flags & DW\_EDMA\_CHIP\_LOCAL))+ readl(chunk->ll\_region.vaddr.io);+}+ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) { struct dw\_edma\_chan \*chan = chunk->chan;@@ -412,6 +426,9 @@ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) SET\_CH\_32(dw, chan->dir, chan->id, llp.msb, upper\_32\_bits(chunk->ll\_region.paddr)); }++ dw\_edma\_v0\_sync\_ll\_data(chunk);+ /\* Doorbell \*/ SET\_RW\_32(dw, chan->dir, doorbell, FIELD\_PREP(EDMA\_V0\_DOORBELL\_CH\_MASK, chan->id)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:35:05 +0000



=== Content from git.kernel.org_c6e80ed3_20250110_153628.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kory Maincent <kory.maincent@bootlin.com> | 2024-01-29 17:26:02 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:48:43 +0000 |
| commit | [d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)) | |
| tree | [31f38ff8db2d2032ef0d45aac19d9a355e3ae9d1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3) | |
| parent | [227ef58a9b0c372efba422e8886a8015a1509eba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=227ef58a9b0c372efba422e8886a8015a1509eba) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3&id2=227ef58a9b0c372efba422e8886a8015a1509eba)) | |
| download | [linux-d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3.tar.gz) | |

dmaengine: dw-edma: eDMA: Add sync read before starting the DMA transfer in remote setup[ Upstream commit bbcc1c83f343e580c3aa1f2a8593343bf7b55bba ]
The Linked list element and pointer are not stored in the same memory as
the eDMA controller register. If the doorbell register is toggled before
the full write of the linked list a race condition error will occur.
In remote setup we can only use a readl to the memory to assure the full
write has occurred.
Fixes: 7e4b8a4fbe2c ("dmaengine: Add Synopsys eDMA IP version 0 support")
Reviewed-by: Serge Semin <fancer.lancer@gmail.com>
Reviewed-by: Manivannan Sadhasivam <manivannan.sadhasivam@linaro.org>
Signed-off-by: Kory Maincent <kory.maincent@bootlin.com>
Link: [https://lore.kernel.org/r/20240129-b4-feature\_hdma\_mainline-v7-6-8e8c1acb7a46@bootlin.com](https://lore.kernel.org/r/20240129-b4-feature_hdma_mainline-v7-6-8e8c1acb7a46%40bootlin.com)
Signed-off-by: Vinod Koul <vkoul@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)

| -rw-r--r-- | [drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/dma/dw-edma/dw-edma-v0-core.c?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 17 insertions, 0 deletions

| diff --git a/drivers/dma/dw-edma/dw-edma-v0-core.c b/drivers/dma/dw-edma/dw-edma-v0-core.cindex b38786f0ad7995..b75fdaffad9a4e 100644--- a/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=227ef58a9b0c372efba422e8886a8015a1509eba)+++ b/[drivers/dma/dw-edma/dw-edma-v0-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/dma/dw-edma/dw-edma-v0-core.c?id=d24fe6d5a1cfdddb7a9ef56736ec501c4d0a5fd3)@@ -346,6 +346,20 @@ static void dw\_edma\_v0\_core\_write\_chunk(struct dw\_edma\_chunk \*chunk) dw\_edma\_v0\_write\_ll\_link(chunk, i, control, chunk->ll\_region.paddr); } +static void dw\_edma\_v0\_sync\_ll\_data(struct dw\_edma\_chunk \*chunk)+{+ /\*+ \* In case of remote eDMA engine setup, the DW PCIe RP/EP internal+ \* configuration registers and application memory are normally accessed+ \* over different buses. Ensure LL-data reaches the memory before the+ \* doorbell register is toggled by issuing the dummy-read from the remote+ \* LL memory in a hope that the MRd TLP will return only after the+ \* last MWr TLP is completed+ \*/+ if (!(chunk->chan->dw->chip->flags & DW\_EDMA\_CHIP\_LOCAL))+ readl(chunk->ll\_region.vaddr.io);+}+ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) { struct dw\_edma\_chan \*chan = chunk->chan;@@ -412,6 +426,9 @@ static void dw\_edma\_v0\_core\_start(struct dw\_edma\_chunk \*chunk, bool first) SET\_CH\_32(dw, chan->dir, chan->id, llp.msb, upper\_32\_bits(chunk->ll\_region.paddr)); }++ dw\_edma\_v0\_sync\_ll\_data(chunk);+ /\* Doorbell \*/ SET\_RW\_32(dw, chan->dir, doorbell, FIELD\_PREP(EDMA\_V0\_DOORBELL\_CH\_MASK, chan->id)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:35:05 +0000


