

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiasheng Jiang <jiasheng@iscas.ac.cn> | 2023-06-19 16:12:02 +0800 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2023-10-07 10:55:45 +0200 |
| commit | [1fd6eb12642e0c32692924ff359c07de4b781d78](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1fd6eb12642e0c32692924ff359c07de4b781d78) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)) | |
| tree | [0e87b26dc209c8a789ada6fcf3215ba201d5bdb3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1fd6eb12642e0c32692924ff359c07de4b781d78) | |
| parent | [76a2c5df6ca8bd8ada45e953b8c72b746f42918d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76a2c5df6ca8bd8ada45e953b8c72b746f42918d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fd6eb12642e0c32692924ff359c07de4b781d78&id2=76a2c5df6ca8bd8ada45e953b8c72b746f42918d)) | |
| download | [linux-1fd6eb12642e0c32692924ff359c07de4b781d78.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1fd6eb12642e0c32692924ff359c07de4b781d78.tar.gz) | |

media: vidtv: mux: Add check and kfree for kstrdupAdd check for the return value of kstrdup() and return the error
if it fails in order to avoid NULL pointer dereference.
Moreover, use kfree() in the later error handling in order to avoid
memory leak.
Fixes: c2f78f0cb294 ("media: vidtv: psi: add a Network Information Table (NIT)")
Signed-off-by: Jiasheng Jiang <jiasheng@iscas.ac.cn>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fd6eb12642e0c32692924ff359c07de4b781d78)

| -rw-r--r-- | [drivers/media/test-drivers/vidtv/vidtv\_mux.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/test-drivers/vidtv/vidtv_mux.c?id=1fd6eb12642e0c32692924ff359c07de4b781d78) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/drivers/media/test-drivers/vidtv/vidtv\_mux.c b/drivers/media/test-drivers/vidtv/vidtv\_mux.cindex b51e6a3b8cbeb5..f99878eff7acea 100644--- a/[drivers/media/test-drivers/vidtv/vidtv\_mux.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/test-drivers/vidtv/vidtv_mux.c?id=76a2c5df6ca8bd8ada45e953b8c72b746f42918d)+++ b/[drivers/media/test-drivers/vidtv/vidtv\_mux.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/test-drivers/vidtv/vidtv_mux.c?id=1fd6eb12642e0c32692924ff359c07de4b781d78)@@ -504,13 +504,16 @@ struct vidtv\_mux \*vidtv\_mux\_init(struct dvb\_frontend \*fe, m->priv = args->priv; m->network\_id = args->network\_id; m->network\_name = kstrdup(args->network\_name, GFP\_KERNEL);+ if (!m->network\_name)+ goto free\_mux\_buf;+ m->timing.current\_jiffies = get\_jiffies\_64();  if (args->channels) m->channels = args->channels; else if (vidtv\_channels\_init(m) < 0)- goto free\_mux\_buf;+ goto free\_mux\_network\_name;  /\* will alloc data for pmt\_sections after initializing pat \*/ if (vidtv\_channel\_si\_init(m) < 0)@@ -527,6 +530,8 @@ free\_channel\_si: vidtv\_channel\_si\_destroy(m); free\_channels: vidtv\_channels\_destroy(m);+free\_mux\_network\_name:+ kfree(m->network\_name); free\_mux\_buf: vfree(m->mux\_buf); free\_mux: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:14:33 +0000

