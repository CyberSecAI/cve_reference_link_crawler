<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oss-security - Re: STARTTLS vulnerabilities</title>

<link href="/style.css" type="text/css" rel="stylesheet">
<style type="text/css">
.calendar { text-align: center; }
.ccell { background: #ccc; width: 5ex; padding: 2px; }

.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>
</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">


<table bgcolor="#ffffff" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>

<td>
<a href="/"><img class="logo" src="/logo.png" border="0" width="182" height="80" alt="Openwall"></a>
<td width="100%">
<div class="nav">
<ul>
<li><a href="/">Products</a>
<ul>
<li><a href="/Owl/">Openwall GNU/*/Linux &nbsp; <i>server OS</i></a>
<li><a href="/lkrg/">Linux Kernel Runtime Guard</a>
<li><a href="/john/">John the Ripper &nbsp; <i>password cracker</i></a>
<ul>
<li><a href="/john/">Free &amp; Open Source for any platform</a>
<li><a href="/john/cloud/">in the cloud</a>
<li><a href="/john/pro/linux/">Pro for Linux</a>
<li><a href="/john/pro/macosx/">Pro for macOS</a>
</ul>
<li><a href="/wordlists/">Wordlists &nbsp; <i>for password cracking</i></a>
<li><a href="/passwdqc/">passwdqc &nbsp; <i>policy enforcement</i></a>
<ul>
<li><a href="/passwdqc/">Free &amp; Open Source for Unix</a>
<li><a href="/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</ul>
<li><a href="/yescrypt/">yescrypt &nbsp; <i>KDF &amp; password hashing</i></a>
<li><a href="/yespower/">yespower &nbsp; <i>Proof-of-Work (PoW)</i></a>
<li><a href="/crypt/">crypt_blowfish &nbsp; <i>password hashing</i></a>
<li><a href="/phpass/">phpass &nbsp; <i>ditto in PHP</i></a>
<li><a href="/tcb/">tcb &nbsp; <i>better password shadowing</i></a>
<li><a href="/pam/">Pluggable Authentication Modules</a>
<li><a href="/scanlogd/">scanlogd &nbsp; <i>port scan detector</i></a>
<li><a href="/popa3d/">popa3d &nbsp; <i>tiny POP3 daemon</i></a>
<li><a href="/blists/">blists &nbsp; <i>web interface to mailing lists</i></a>
<li><a href="/msulogin/">msulogin &nbsp; <i>single user mode login</i></a>
<li><a href="/php_mt_seed/">php_mt_seed &nbsp; <i>mt_rand() cracker</i></a>
</ul>
<li><a href="/services/">Services</a>
<li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="/articles/">Articles</a>
<li><a href="/presentations/">Presentations</a>
</ul>
<li><a>Resources</a>
<ul>
<li><a href="/lists/">Mailing lists</a>
<li><a href="https://openwall.info/wiki/">Community wiki</a>
<li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
<li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
<li><a href="/mirrors/">File archive &amp; mirrors</a>
<li><a href="/signatures/">How to verify digital signatures</a>
<li><a href="/ove/">OVE IDs</a>
</ul>
<li id="last-li"><a href="/news">What's new</a>
</ul>
</div>


</table>


<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">
<a href="https://twitter.com/openwall">
Follow @Openwall on Twitter for new release announcements and other news</a>

</TABLE>
</TABLE>

<a href="1">[&lt;prev]</a> <a href="3">[next&gt;]</a> <a href="../../../2021/08/16/2">[&lt;thread-prev]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;20210818152612.5v3noomg4xt4a6pi&#64;redhat.com&gt;
Date: Wed, 18 Aug 2021 10:26:12 -0500
From: Eric Blake &lt;eblake&#64;...hat.com&gt;
To: oss-security&#64;...ts.openwall.com
Subject: Re: STARTTLS vulnerabilities

On Mon, Aug 16, 2021 at 02:04:06PM -0500, Eric Blake wrote:
&gt; On Wed, Aug 11, 2021 at 06:02:35PM +0200, Hanno BÃ¶ck wrote:
&gt; &gt; On Wed, 11 Aug 2021 10:31:58 -0500
&gt; &gt; Eric Blake &lt;eblake&#64;...hat.com&gt; wrote:
&gt; &gt; 
&gt; &gt; &gt; Not mentioned in that list was ndb, but as far as I can tell, that
&gt; &gt; &gt; project has already documented the ramifications of opportunistic
&gt; &gt; &gt; encryption as being a security risk, and all known implementations
&gt; &gt; &gt; (both servers and clients) with TLS support have a mode of execution
&gt; &gt; &gt; that ensures the connection is dropped if a downgrade attack is
&gt; &gt; &gt; attempted:
&gt; &gt; 
&gt; &gt; I should point out that our research is not on simple downgrade attacks.
&gt; &gt; These are kinda obvious by the design of STARTTLS if you implement it
&gt; &gt; in an opportunistic way.
&gt; &gt; 
&gt; &gt; The buffering vulnerabilities we found are in STARTTLS implementations
&gt; &gt; that have the expectation to enforce a secure connection, but suffer
&gt; &gt; from various vulnerabilities in the implementation.
&gt; 
&gt; Thank you for persisting.  As a result, I have found a security bug in
&gt; nbdkit, which improperly cached the result of NBD_OPT_STRUCTURED_REPLY
&gt; from a plaintext MitM attacker prior to acting on NBD_OPT_STARTTLS, to
&gt; the potential confusion of a client that does not expect structured
&gt; replies.  I will follow up again when I have a CVE number.
&gt; 
&gt; <a href="https://listman.redhat.com/archives/libguestfs/2021-August/msg00077.html" rel="nofollow">https://listman.redhat.com/archives/libguestfs/2021-August/msg00077.html</a>

Now designated as CVE-2021-3716, affecting nbdkit versions 1.12
through 1.26.4; fixed nbdkit 1.26.5 will be released later today.

Mitigating factors: the bug is only possible when nbdkit is used in
opportunistic mode (--tls=on); you can avoid it by requesting that
nbdkit use forced tls mode (--tls=require on the command line).
Furthermore, all impacted nbdkit versions give successful replies to
repeated NBD_OPT_STRUCTURED_REPLY requests even though the NBD
protocol did not mandate that, so any client that requests structured
replies after STARTTLS will not see any change in behavior in spite of
the MitM injection.  In short, the bug will only impact really old
clients that understand TLS but not structured replies (at this point,
I'm aware of qemu 2.6 through 2.10, where most distros have moved to
newer versions of qemu; and all versions of nbd-client 3.15 to the
present).

-- 
Eric Blake, Principal Software Engineer
Red Hat, Inc.           +1-919-301-3266
Virtualization:  qemu.org | libvirt.org

</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
<p>
Confused about <a href="/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
<p>

</body>
</html>
