=== Content from bugzilla.redhat.com_1c38c591_20250108_134011.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1994695)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1994695)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1994695)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1994695

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1994695**](show_bug.cgi?id=1994695)
(CVE-2021-3716)
- [CVE-2021-3716](https://access.redhat.com/security/cve/CVE-2021-3716) nbdkit: NBD\_OPT\_STRUCTURED\_REPLY injection on STARTTLS

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-3716 nbdkit: NBD\_OPT\_STRUCTURED\_REPLY injection on STARTTLS

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-3716 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | low | | [Severity:](page.cgi?id=fields.html#bug_severity) | low | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1994913](show_bug.cgi?id=1994913) [1994914](show_bug.cgi?id=1994914) [1994915](show_bug.cgi?id=1994915) [1994928](show_bug.cgi?id=1994928 "CLOSED ERRATA - CVE-2021-3716 nbdkit: NBD_OPT_STRUCTURED_REPLY injection on STARTTLS [fedora-all]") [1995692](show_bug.cgi?id=1995692) [2040780](show_bug.cgi?id=2040780) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1994697](show_bug.cgi?id=1994697) [2002253](show_bug.cgi?id=2002253) | | TreeView+ | [depends on](buglist.cgi?bug_id=1994695&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1994695&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-08-17 17:36 UTC by Mauro Matteo Cascella | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-05-10 13:16 UTC ([History](show_activity.cgi?id=1994695)) | | [CC List:](page.cgi?id=fields.html#cclist) | 6 users (show)  eblake michal.skrivanek mperina rjones sbonazzo virt-maint | | Fixed In Version: | nbdkit 1.24.6, nbdkit 1.26.5, nbdkit 1.27.6 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in nbdkit due to to improperly caching plaintext state across the STARTTLS encryption boundary. A MitM attacker could use this flaw to inject a plaintext NBD\_OPT\_STRUCTURED\_REPLY before proxying everything else a client sends to the server, potentially leading the client to terminate the NBD session. The highest threat from this vulnerability is to system availability. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-02-02 10:02:22 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2022:0397](https://access.redhat.com/errata/RHSA-2022%3A0397) | 0 | None | None | None | 2022-02-02 08:47:58 UTC | | Red Hat Product Errata | [RHSA-2022:1759](https://access.redhat.com/errata/RHSA-2022%3A1759) | 0 | None | None | None | 2022-05-10 13:16:46 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1994695#c0)  Mauro Matteo Cascella    2021-08-17 17:36:03 UTC  ``` <https://nostarttls.secvuln.info/> pointed out a common implementation flaw in various SMTP and IMAP servers with regards to improperly caching plaintext state across the STARTTLS encryption boundary.  It turns out that nbdkit has the same vulnerability in regards to the NBD protocol: an attacker is able to inject a plaintext NBD_OPT_STRUCTURED_REPLY before proxying everything else a client sends to the server; if the server then acts on that plaintext request (as nbdkit did before this patch), then the server ends up sending structured replies to at least NBD_CMD_READ, even though the client was not expecting them. The NBD spec has been recently tightened to declare the nbdkit behavior to be a security hole.  Depending on how the client handles unexpected structured replies, the attacker can use this to form a denial of service attack on the client, distinct from a trivial protocol downgrade attack. Please refer to the upstream announcement ([comment#10](show_bug.cgi?id=1994695#c10)) for additional details.   ```  [Comment 3](show_bug.cgi?id=1994695#c3)  Mauro Matteo Cascella    2021-08-18 08:05:41 UTC  ``` Created nbdkit tracking bugs for this issue:  Affects: fedora-all [[bug 1994928](show_bug.cgi?id=1994928 "CLOSED ERRATA - CVE-2021-3716 nbdkit: NBD_OPT_STRUCTURED_REPLY injection on STARTTLS [fedora-all]")]   ```  [Comment 5](show_bug.cgi?id=1994695#c5)  Mauro Matteo Cascella    2021-08-18 08:19:37 UTC  ``` This bug was introduced in nbdkit v1.11.8 (March 2019) with the first implementation of NBD Structured Replies: <https://github.com/libguestfs/nbdkit/commit/eaa4c6e9a>   ```  [Comment 6](show_bug.cgi?id=1994695#c6)  Richard W.M. Jones    2021-08-18 09:21:46 UTC  ``` Upstream fix is: <https://listman.redhat.com/archives/libguestfs/2021-August/msg00077.html>  There's no upstream commit yet, I'll add a comment here when the final patch has been pushed upstream.   ```  [Comment 7](show_bug.cgi?id=1994695#c7)  Richard W.M. Jones    2021-08-19 07:28:15 UTC  ``` The fixes are:  <https://gitlab.com/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd> <https://gitlab.com/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8>   ```  [Comment 10](show_bug.cgi?id=1994695#c10)  Eric Blake    2021-08-19 20:52:16 UTC  ``` Upstream announcement: <https://listman.redhat.com/archives/libguestfs/2021-August/msg00083.html>   ```  [Comment 11](show_bug.cgi?id=1994695#c11)  errata-xmlrpc    2022-02-02 08:47:55 UTC  ``` This issue has been addressed in the following products:    Advanced Virtualization for RHEL 8.5.0.Z  Via RHSA-2022:0397 [https://access.redhat.com/errata/RHSA-2022:0397](https://access.redhat.com/errata/RHSA-2022%3A0397)   ```  [Comment 12](show_bug.cgi?id=1994695#c12)  Product Security DevOps Team    2022-02-02 10:02:19 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2021-3716>   ```  [Comment 13](show_bug.cgi?id=1994695#c13)  errata-xmlrpc    2022-05-10 13:16:43 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2022:1759 [https://access.redhat.com/errata/RHSA-2022:1759](https://access.redhat.com/errata/RHSA-2022%3A1759)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1994695&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_c8cdac2b_20250108_160701.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=bCzJJ_cQk8Y&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjoxNzU5JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMTc1OSkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=bCzJJ_cQk8Y&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjoxNzU5JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMTc1OSkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=bCzJJ_cQk8Y&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjoxNzU5JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMTc1OSkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from gitlab.com_b2196758_20250108_160703.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
6c5faac6**

authored
Aug 16, 2021
by
**[![Eric Blake's avatar](https://secure.gravatar.com/avatar/a48050179faca1b9281aa8cf42be5d8fe022c39005ce3a77d709290bf87dc818?s=96&d=identicon "Eric Blake")](/ebblake)
[Eric Blake](/ebblake)**

[Browse files](/nbdkit/nbdkit/-/tree/6c5faac6a37077cf2366388a80862bb00616d0d8)

### server: reset meta context replies on starttls

```

Related to CVE-2021-3716, but not as severe.  No compliant client will
send NBD_CMD_BLOCK_STATUS unless it first negotiates
NBD_OPT_SET_META_CONTEXT.  If an attacker injects a premature
SET_META_CONTEXT, either the client will never notice (because it
never uses BLOCK_STATUS), or the client will overwrite the attacker's
attempt with the client's own SET_META_CONTEXT request after
encryption is enabled.  So I don't class this as having the potential
to trigger denial-of-service due to any protocol mismatch between
compliant client and server (I don't care what happens with
non-compliant clients).

Fixes: [26455d45](/nbdkit/nbdkit/-/commit/26455d452574f60119a79aea5a9f437c1d222ae5 "server: protocol: Implement Block Status \"base:allocation\".") (server: protocol: Implement Block Status "base:allocation".)
```

parent
[ff617f38](/nbdkit/nbdkit/-/commit/ff617f386b55090fb1ff7e5232fd39132ffe2311)

Loading

Loading

Loading

* [Changes
  1](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8)

[Hide whitespace changes](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?action=show&controller=projects%2Fcommit&id=6c5faac6a37077cf2366388a80862bb00616d0d8&namespace_id=nbdkit&project_id=nbdkit&w=1)
[Inline](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=inline)
[Side-by-side](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=parallel)

Loading

* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_654751330)

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  mentioned in commit 89ef17c90996c0e212e3a17c8d26ff930ab464ea

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655417842)

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  mentioned in commit 814d8103fb4b581dc01dfd25d2cd81596576f211

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655422648)

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  mentioned in commit e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655432074)

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  mentioned in commit 386a6e832602ea88b9318dc02a5bade5196dba69

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655441899)

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  mentioned in commit 66834346d60bdd41ded9f8ef9773317d601f850e

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655446380)

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  mentioned in commit 1105c52548967bad821de5dcb08e06576bc69017

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655451363)

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  mentioned in commit 4c07516eca730291e2c5746e2139bf063f70e451

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655454351)

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  mentioned in commit ab1c1a69020f7a409eeb62a6795e4324ae80276d

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  ·

  [Jan 26, 2022](#note_822140903)

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  mentioned in commit add9b794b9dc697a1b52115c997fcfb6e06bf64c

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from nostarttls.secvuln.info_91862ea4_20250108_160703.html ===

![logo](images/nostarttls.svg)
# NO STARTTLS

## Why TLS is better without STARTTLS A Security Analysis of STARTTLS in the Email Context

by Damian Poddebniak¹, Fabian Ising¹, Hanno Böck², and Sebastian Schinzel¹

¹ Münster University of Applied Sciences ² Independent Researcher

*Full paper [published
at USENIX Security 21](https://www.usenix.org/conference/usenixsecurity21/presentation/poddebniak)*

## Introduction

Connections between email clients and servers provide two ways to be protected with TLS: While implicit TLS
encrypts the connection from the start and runs on a separate port, STARTTLS
provides a mechanism to upgrade existing unencrypted connections to TLS.

Sometimes STARTTLS is seen as an opportunistic encryption mode that provides TLS protection
only when available. This is trivially vulnerable to downgrade attacks. However, modern email clients
usually have the expectation that STARTTLS is enforced, and when enabled, no unencrypted communication
is possible.

Upgrading connections via STARTTLS is fragile and vulnerable to a number of security
vulnerabilities and attacks. We found more than 40 vulnerabilities in STARTTLS implementations. We
conclude that these vulnerabilities are so common that we recommend
avoiding using STARTTLS when possible.

![Steps of an email submission and access. From left to right: Author (Email Client), Provider, Provider, Recipient (Email Client).](images/email.svg)

## Attacks

We assume a Meddler-in-the-Middle (MitM) attacker who can modify connections established between an
email client and the email server of a provider.

### Stealing Login Credentials with SMTP and IMAP via Command Injection

In 2011 Postfix developer Wietse Venema [described a bug
in STARTTLS implementations](http://www.postfix.org/CVE-2011-0411.html) that allowed
injecting plaintext commands that a server interprets as if they were part of the
encrypted connection. This works by sending additional commands with the STARTTLS command to the
server in the same TCP segment.

We found that despite being known since 2011, this vulnerability is still very common. We found
15 vulnerable implementations, and in scans, 2% of all mail servers showed this vulnerability.

This command injection can be used to steal credentials with the SMTP and IMAP protocols.

Our attack requires a Meddler in the Middle (MitM) attacker that can modify network traffic and has
login credentials for their own account on the same server. The attacker can inject commands
that authenticate them and then start sending (SMTP) or storing (IMAP) an email.
The login credentials sent by the victim will be stored in the email that the attacker
can access.

The command injection can also be used for a cross-protocol attack to serve HTTPS content with
the mail server's certificate. Detailed descriptions of these attacks can be found in our paper.

### Mailbox content forgery via Response Injection

We discovered an attack similar to the command injection in email client applications.
We call this a response injection.
This bug affected many popular mail clients, including Apple Mail, Mozilla Thunderbird, Claws Mail, and
Mutt.

By injecting additional content to the server message in response to the STARTTLS command before the TLS
handshake,
we can inject server commands that the client will process as if they were part of the encrypted connection.
This
can be used to forge mailbox content.

### IMAP connection downgrade via PREAUTH and credential-stealing with REFERRAL

In the IMAP protocol, a server can signal the client in the first message that it is already authenticated
via
the PREAUTH command. The protocol forbids using the STARTTLS command in an authenticated state. Therefore, if
a client application accepts PREAUTH, it cannot enforce STARTTLS.

A Meddler in the Middle attacker can use this to prevent STARTTLS from upgrading the connection and force
a client to an unencrypted connection.

This vulnerability was originally [found in
Trojitá in 2014](http://jkt.flaska.net/blog/Trojita_0_4_1__a_security_update_for_CVE_2014_2567.html). We discovered that multiple other
email client applications were vulnerable to the same bug.

This bug is especially severe in combination with the IMAP features [Login Referrals](https://datatracker.ietf.org/doc/html/rfc2221) and [Mailbox Referrals](https://datatracker.ietf.org/doc/html/rfc2193).
These commands allow a server to instruct a client to log into another IMAP server. By using PREAUTH to
prevent an encrypted connection, an attacker can use referrals to force a client to send credentials to an
attacker-controlled server.
Fortunately, the referral features are not supported by many clients.
We found only one client - Alpine - vulnerable to this combination of PREAUTH and referrals.

### Additional Attacks

We found additional attacks, whose security impact may vary for implementations.
Please see our paper to learn more about these attacks.

## Conclusion

All vulnerabilities described here rely on the transition of an insecure connection to a
secure connection.
Implicit TLS does not have such a transition and is therefore not vulnerable to any of these attacks.
We therefore consider implicit TLS a more secure option than STARTTLS.

We also point out that STARTTLS always introduces at least one extra connection
round trip. So implicit TLS generally provides better performance.

## Impact

The demonstrated attacks require an active attacker and may be recognized when
used against an email client that tries to enforce the transition to TLS.
We have informed all popular email client and server vendors and most issues are already
fixed.
We think that the demonstrated attacks would be difficult to execute on a large scale, and we
primarily expect them to be used in targeted attacks.
As a general recommendation, you should always update your software and (to also profit from faster
connections)
reconfigure your email client to use implicit TLS only (see below).

## Recommendations

### For Email Client Users

If possible, we recommend that users check and configure their email clients to use SMTP, POP3 and IMAP with
implicit TLS on dedicated ports, i.e., SMTP/Submission on port 465, POP3 on port 995, and IMAP on port 993.
This is in line with already existing recommendations in
[RFC 8314](https://datatracker.ietf.org/doc/html/rfc8314#section-3) and was already recommended
by [security professionals](https://www.agwa.name/blog/post/starttls_considered_harmful) before.

Some mail service providers, notably Microsoft and Apple, do not support implicit TLS for SMTP/Submission.
We recommend that users ask their mail service providers to offer the more secure implicit TLS option.

### For Application Developers

Both email server and client applications should offer implicit TLS by default.
In the long term, software developers may decide to not support STARTTLS at all and thus simplify both
their code and configuration dialogs and files.

We recommend auditing all applications supporting STARTTLS - both on the server and the client side -
for the bugs discovered.
Most importantly, applications need to ensure that no unencrypted content gets processed as part of an
encrypted connection.
IMAP applications must make sure that they do not allow PREAUTH in combination with STARTTLS.
We provide the [EAST toolkit](https://github.com/fhms-its/EAST), which allows testing
applications.

### For Mail Server Administrators

Make sure your server supports implicit TLS for all supported protocols.
If possible, consider disabling STARTTLS for IMAP, POP3 and SMTP submission.

If you really need to support STARTTLS, we recommend testing your server with our tool for the command
injection vulnerability for all supported protocols.
If your server software is vulnerable, you should ask your vendor for a security update.

## FAQ

### Isn't STARTTLS insecure anyway?

STARTTLS is used in two "modes", "opportunistic", and "enforced".
Email clients must authenticate themselves with a username and password before submitting a new email or
accessing existing emails.
For these connections, the transition to TLS via STARTTLS **must** be strictly enforced because a
downgrade would reveal the username and password and give an attacker full access to the email account.

### How can I test if my software is vulnerable?

We provide the [EAST toolkit](https://github.com/fhms-its/EAST) that allows testing email clients
and servers.

**Testing an email server** for the command injection is relatively easy with our [Command Injection Tester](https://github.com/Email-Analysis-Toolkit/command-injection-tester).
[testssl.sh](https://github.com/drwetter/testssl.sh) (dev version) and
[TLS-Attacker](https://github.com/tls-attacker/TLS-Attacker/tree/starttls)/[TLS-Scanner](https://github.com/tls-attacker/TLS-Scanner/tree/starttls) (starttls branch) also check for the command injection.

**Testing an email client** is more complex, and we refer to EAST's [Fake Mail Server](https://github.com/Email-Analysis-Toolkit/fake-mail-server) component.

### Are other protocols with support for STARTTLS or similar mechanisms affected?

We expect to see similar vulnerabilities in other protocols using STARTTLS, e.g., XMPP, FTP, IRC, or LDAP.
Thus, our recommendation to avoid STARTTLS and use implicit TLS when possible applies to those protocols as
well.
We encourage security researchers to look for such vulnerabilities in other protocols.

Some protocols only support STARTTLS and provide no implicit TLS mechanism.
We recommend that standards bodies define implicit TLS modes for these protocols and that future protocols
do this by default and avoid STARTTLS completely.

### What about communication between email servers (MTA to MTA)?

Traditionally, STARTTLS between email servers only protects against passive attacks and is vulnerable to
active attacks such as STARTTLS stripping.
Thus STARTTLS vulnerabilities do not give an advantage to the attacker.

However, efforts like [MTA-STS](https://datatracker.ietf.org/doc/html/rfc8461) and [DANE](https://datatracker.ietf.org/doc/html/rfc7671) provide authentication mechanisms for MTA
to MTA connections.
Therefore, server software should be investigated for STARTTLS vulnerabilities as well.
Particularly relevant are the buffering bugs, which can happen both for the sending (response injection) and
receiving (command injection) side of a mail server.
We have found and reported some vulnerabilities in server software during our research.

Currently, there is no standardized way to use implicit TLS for MTA to MTA connections.
Therefore, it is not possible to avoid STARTTLS without changes to the protocol specification.

### How important is this?

[It's not the most important thing you should worry about today.](https://www.ipcc.ch/assessment-report/ar6/)

### How can I contact you?

You can reach us via mail or twitter:

* Damian Poddebniak, [@duesee@norden.social](https://norden.social/%40duesee), poddebniak@fh-muenster.de
* Fabian Ising, [@Murgi](https://twitter.com/Murgi), F.Ising@fh-muenster.de
* [Hanno Böck](https://hboeck.de/), [@hanno@mastodon.social](https://mastodon.social/%40hanno), hanno@hboeck.de
* Sebastian Schinzel, [@seecurity](https://twitter.com/seecurity), schinzel@fh-muenster.de

## Reported Vulnerabilities

The following is a list of all STARTTLS-related vulnerabilities we found during our research.
None of the issues would be present if implicit TLS had been used exclusively.
Due to different kinds of reports, not all issues are publicly documented.
All issues were reported more than 90 days ago.

### Email Clients

As an end user, make sure to use the newest version of your email software.
The following list serves as a quick check if your client is still affected.

#### Response Injection (Buffering)

| Product | Protocol | Status | Links |
| --- | --- | --- | --- |
| Apple Mail (macOS) | SMTP/POP3/IMAP | Fixed in macOS High Sierra 10.13.6/Big Sur 11.4 | [CVE-2020-9941](https://nvd.nist.gov/vuln/detail/CVE-2020-9941), [CVE-2021-30696](https://nvd.nist.gov/vuln/detail/CVE-2021-30696) |
| Apple Mail (iOS/iPadOS) | SMTP/POP3/IMAP | Fixed in iOS/iPadOS 14.0 | [CVE-2020-9941](https://nvd.nist.gov/vuln/detail/CVE-2020-9941) |
| Mozilla Thunderbird | IMAP | Fixed in 78.7.0 | [CVE-2020-15685](https://nvd.nist.gov/vuln/detail/CVE-2020-15685), [Vendor advisory](https://www.mozilla.org/en-US/security/advisories/mfsa2021-05/), [Bug report](https://bugzilla.mozilla.org/show_bug.cgi?id=1622640) |
| Claws Mail | SMTP/POP3/IMAP | Fixed in 3.17.6 for SMTP/POP3, See libEtPan for IMAP | [CVE-2020-15917](https://nvd.nist.gov/vuln/detail/CVE-2020-15917) |
| Mutt | IMAP/SMTP/POP3 | Fixed in 1.14.4 | [CVE-2020-14954](https://nvd.nist.gov/vuln/detail/CVE-2020-14954) |
| NeoMutt | IMAP/SMPT/POP3 | Fixed in 2020-06-19 | [Commit/Patch](https://github.com/neomutt/neomutt/commit/fb013ec666759cb8a9e294347c7b4c1f597639cc), see also [CVE-2020-14954](https://nvd.nist.gov/vuln/detail/CVE-2020-14954) |
| Evolution | SMTP/POP3 | Fixed in 3.36.4 (evolution-data-server) | [CVE-2020-14928](https://nvd.nist.gov/vuln/detail/CVE-2020-14928) |
| LibEtPan (Mail Framework for C Language) | IMAP/SMTP/POP3 | Fixed in repository, unreleased | [CVE-2020-15953](https://nvd.nist.gov/vuln/detail/CVE-2020-15953) |
| Exim (MTA sending) | SMTP | Unfixed (reported privately) | [CVE-2021-38371](https://nvd.nist.gov/vuln/detail/CVE-2021-38371) |
| Gmail (iOS/iPadOS) | SMTP/IMAP | Unfixed (reported privately) | - |
| Mail.ru, MyMail | SMTP | Unfixed (reported privately, report closed as not applicable) | - |
| Yandex | SMTP/IMAP | Unfixed (reported privately) | - |
| PHP (stream\_socket\_enable\_crypto) | SMTP/POP3/IMAP | Unfixed | [Bug report (private)](https://bugs.php.net/bug.php?id=80008) |

#### Negotiation and Tampering bugs

| Product | Description | Protocol | Status | Links |
| --- | --- | --- | --- | --- |
| Gmail (Android) | Leak of emails | IMAP | Fixed (retested in 2021.07.11.387440246) | - |
| Gmail (Go) | Leak of emails | IMAP | Fixed (retested in 2020.10.15.341102866) | - |
| Samsung Email | Leak of emails | IMAP | Fixed (untested) | - |
| Alpine | Untagged responses accepted before STARTTLS | IMAP | fixed in 2.25 | [CVE-2021-38370](https://nvd.nist.gov/vuln/detail/CVE-2021-38370), [Release notes](https://alpineapp.email/alpine/release/alpine-2.25.html) |
| Trojitá Trojita | Untagged responses accepted before STARTTLS | IMAP | Unknown | [Bug report](https://bugs.kde.org/show_bug.cgi?id=432353) |
| Mozilla Thunderbird | Server responses prior to STARTTLS processed | IMAP | Fixed in 78.12 | [CVE-2021-29969](https://nvd.nist.gov/vuln/detail/CVE-2021-29969), [Vendor advisory](https://www.mozilla.org/en-US/security/advisories/mfsa2021-30/) |
| KMail | STARTTLS ignored when "Server requires authentication" not checked | SMTP | Unfixed | [Bug report](https://bugs.kde.org/show_bug.cgi?id=423423) |
| Sylpheed | STARTTLS stripping | IMAP | Unknown | [Bug report](https://sylpheed.sraoss.jp/redmine/issues/322) |
| OfflineIMAP | STARTTLS stripping | IMAP | Unknown | [Bug report](https://github.com/OfflineIMAP/offlineimap/issues/669) |
| GMX / Web.de Mail Collector | STARTTLS stripping | POP3/IMAP | Fixed | - |
| Mail.ru, MyMail, Email app for Gmail | STARTTLS Stripping | SMTP | Unfixed (report closed as not applicable) | - |

#### Avoiding Encryption via IMAP PREAUTH

| Product | Status | Links |
| --- | --- | --- |
| Apple Mail (iOS/iPadOS) | Fixed in iOS 15.1 | - |
| Mozilla Thunderbird | Fixed in 68.9.0 | [CVE-2020-12398](https://nvd.nist.gov/vuln/detail/CVE-2020-12398) |
| Alpine | Fixed in 2.23 | [CVE-2020-14929](https://nvd.nist.gov/vuln/detail/CVE-2020-14929), [Commit](https://repo.or.cz/alpine.git/commit/000edd9036b6aea5e6a06900ecd6c58faec665ab) |
| Mutt | Fixed in 1.14.3 | [CVE-2020-14093](https://nvd.nist.gov/vuln/detail/CVE-2020-14093) |
| NeoMutt | Fixed in Release 2020-06-19 | [Commit/Patch](https://github.com/neomutt/neomutt/commit/9909cde1f332d2f641c6aec0eb92adf0a150c7e5), see also [CVE-2020-14093](https://nvd.nist.gov/vuln/detail/CVE-2020-14093) |
| GMX / Web.de Mail Collector | Fixed | - |

#### Certificate Validation

| Product | Protocol | Description | Status | Links |
| --- | --- | --- | --- | --- |
| OfflineIMAP | IMAP | Accepts untrusted certificates | Unknown | [Bug report](https://github.com/OfflineIMAP/offlineimap/issues/669) |
| GMX / Web.de Mail Collector | POP3/IMAP | Accepts untrusted certificates | Still allows self-signed | - |
| Yandex | SMTP/IMAP | Accepts untrusted certificates | Unknown (report closed as not eligible) | - |
| Mail.ru, MyMail | SMTP | Accepts untrusted certificates (SMTP, IMAP) | Unknown (report closed as duplicate) | - |
| Outlook (Android & iOS) | SMTP/IMAP | Certificate hostname not checked (SMTP, IMAP) | Unknown (report closed as low/medium severity) | - |
| Geary | SMTP/IMAP | Accepting an untrusted certificate creates a permanent trust exception for all certificates | Fixed in 3.36.3 | [CVE-2020-24661](https://nvd.nist.gov/vuln/detail/CVE-2020-24661) |
| Trojitá Trojita | SMTP | Accepts untrusted certificates | Fixed in repository (77ddd5d4) (no official releases) | [CVE-2020-15047](https://nvd.nist.gov/vuln/detail/CVE-2020-15047) |
| Ruby Net::SMTP | SMTP | Only checks hostname, ignores certificate signature | Fixed in 2.7.2 | [Bug report](https://hackerone.com/reports/980249) |

#### Crashes

| Product | Protocol | Description | Status | Links |
| --- | --- | --- | --- | --- |
| Alpine | IMAP | Crash when LIST or LSUB send before STARTTLS | Fixed in 2.25 | [CVE-2021-46853](https://nvd.nist.gov/vuln/detail/CVE-2021-46853), [Release notes](https://alpineapp.email/alpine/release/alpine-2.25.html) |
| Balsa | IMAP | Nullptr dereference when TLS required and PREAUTH send | Fixed in 2.5.10 | [CVE-2020-16118](https://nvd.nist.gov/vuln/detail/CVE-2020-16118) |
| Balsa | IMAP | Stack overflow due to repeated BAD answer to CAPABILITY command | Fixed in 2.6.3 | [Bug Report](https://gitlab.gnome.org/GNOME/balsa/-/issues/48) |
| Balsa | IMAP | Crash on untagged EXPUNGE response | Fixed in 2.6.3 | [Bug Report](https://gitlab.gnome.org/GNOME/balsa/-/issues/54) |
| Evolution | IMAP | Invalid free when no auth mechanisms in greeting | Fixed in >3.35.91 | [CVE-2020-16117](https://nvd.nist.gov/vuln/detail/CVE-2020-16117) |

#### Miscellaneous

| Product | Protocol | Description | Status | Links |
| --- | --- | --- | --- | --- |
| KMail | POP3 | Setup wizard in POP3 defaults to unencrypted connections | Unfixed | [Bug Report](https://bugs.kde.org/show_bug.cgi?id=423426) |
| KMail | POP3 | Config shows "encrypted", but it isn't | Unfixed | [CVE-2020-15954](https://nvd.nist.gov/vuln/detail/CVE-2020-15954) |
| KMail | SMTP/IMAP | Dialog loop "forces" the user to accept invalid certificates | Unfixed | [Bug Report](https://bugs.kde.org/show_bug.cgi?id=423424) |
| Mozilla Thunderbird | POP3 | Infinite loop when POP3 server replies with -ERR to STLS command | Unknown | [Bug Report](https://bugzilla.mozilla.org/show_bug.cgi?id=1641882) |
| Trojitá Trojita | SMTP/IMAP | Hard to choose implicit TLS due to typo (German) | Fixed | [Bug Report](https://bugs.kde.org/show_bug.cgi?id=416942) |
| Trojitá Trojita | SMTP | SMTP defaults to plaintext on port 587 | Unknown | [Bug Report](https://bugs.kde.org/show_bug.cgi?id=432354) |

### Email Servers

We found 320.000 vulnerable email servers in an Internet-wide scan and conducted a coordinated disclosure
involving different CERTs.
It is impracticable to inform and keep track of the update process of all mail service providers on the
Internet, and thus we identified and prioritized popular mail service
providers.
We only list these in the following table.

Server issues are generally more severe than client issues.
Unfortunately, no client configuration prevents server issues from being exploited, not even the usage of
implicit TLS.
Thus, you must ensure that your server (or your mail service provider) is not affected by STARTTLS issues.

You can use our [command\_injection\_tester tool](https://github.com/Email-Analysis-Toolkit/command-injection-tester) to verify that your server is not affected by the
most severe issue.

#### Command Injection (Buffering)

| Product | Protocol | Status | Links |
| --- | --- | --- | --- |
| Nemesis (used by GMX / Web.de, provider) | POP3/IMAP | Fixed (reported privately) | - |
| Interia.pl (provider) | SMTP/POP3/IMAP | Fixed (reported privately) | - |
| Yahoo (only MTA-to-MTA, provider) | SMTP | Unfixed (reported privately) | - |
| Yandex (provider) | SMTP/POP3/IMAP | Unfixed (reported privately) | - |
| s/qmail | SMTP | Fixed in 4.0.09 | [CVE-2020-15955](https://nvd.nist.gov/vuln/detail/CVE-2020-15955) |
| Coremail | SMTP/POP3/IMAP | Unfixed (reported via CERT) | - |
| Citadel | SMTP/POP3/IMAP | Unfixed | [CVE-2020-29547](https://nvd.nist.gov/vuln/detail/CVE-2020-29547), [Bug report](https://uncensored.citadel.org/dotgoto?room=Citadel%20Security) |
| Gordano GMS | POP3/IMAP | Unfixed | [CVE-2021-37844](https://nvd.nist.gov/vuln/detail/CVE-2021-37844) |
| recvmail | SMTP | Fixed in 3.1.2 (reported privately) | - |
| SmarterMail | POP3 | Fixed in Build 7537 | [CVE-2020-29548](https://nvd.nist.gov/vuln/detail/CVE-2020-29548) |
| Burp Collaborator | SMTP | Fixed in 2020.9.2 | [Bug report](https://hackerone.com/reports/953219), [Vendor release notes](https://portswigger.net/burp/releases/professional-community-2020-9-2) |
| Dovecot | SMTP | Fixed in 2.3.14.1 and 2.3.15 | [CVE-2021-33515](https://nvd.nist.gov/vuln/detail/CVE-2021-33515) |
| Mercury/32 | SMTP/POP3/IMAP | Fixed in 4.90 | [CVE-2021-33487](https://nvd.nist.gov/vuln/detail/CVE-2021-33487) |
| QMail Toaster (1.4.1) | SMTP | Project discontinued | - |
| Courier | POP3 | Fixed in 1.1.5 (reported privately), known since 2013 | [Discussion from 2013](https://sourceforge.net/p/courier/mailman/courier-imap/thread/525D3389.4080507%40csi.uned.es/), [CVE-2021-38084](https://nvd.nist.gov/vuln/detail/CVE-2021-38084), [Fix](https://sourceforge.net/p/courier/mailman/message/37329216/) |
| PHP (stream\_socket\_enable\_crypto) | SMTP/POP3/IMAP | Unfixed | [Bug report (private)](https://bugs.php.net/bug.php?id=80008) |

#### Session Fixation

| Product | Protocol | Status | Links |
| --- | --- | --- | --- |
| Citadel | POP3/IMAP | Reported via forum, unfixed | [Forum with report](https://uncensored.citadel.org/dotgoto?room=Citadel%20Security), [CVE-2021-37845](https://nvd.nist.gov/vuln/detail/CVE-2021-37845) |
| IPswitch iMail | POP3/IMAP | Fixed in iMail 12.5.8 | [CVE-2021-37846](https://nvd.nist.gov/vuln/detail/CVE-2021-37846), [Changelog](https://docs.ipswitch.com/_Messaging/IMailServer/v12.5.8/ReleaseNotes/index.htm#link2) |

#### Miscellaneous Issues

| Product | Protocol | Description | Status | Links |
| --- | --- | --- | --- | --- |
| Nemesis (used by GMX / Web.de, provider) | SMTP | Advertises authentication before STARTTLS even though it is disabled | Fixed (reported via Bugbounty) | - |

### Media reports

[Golem.de: Sicherheitsrisiko STARTTLS](https://www.golem.de/news/verschluesselung-sicherheitsrisiko-starttls-2108-158714.html)

[The Hacker News: Dozens of STARTTLS Related Flaws Found Affecting Popular Email Clients](https://thehackernews.com/2021/08/dozens-of-starttls-related-flaws-found.html)

[The Record: STARTTLS implementations in email clients & servers plagued by 40+ vulnerabilities](https://therecord.media/starttls-implementations-in-email-clients-servers-plagued-by-40-vulnerabilities/)

[SecurityLab.ru: Десятки уязвимостей в протоколе STARTTLS затрагивают популярные почтовые клиенты](https://www.securitylab.ru/news/523448.php)

[LWN: STARTTLS considered harmful](https://lwn.net/Articles/866481/)

[Bulletproof TLS Newsletter: Vulnerabilities show fragility of STARTTLS](https://www.feistyduck.com/bulletproof-tls-newsletter/issue_80_vulnerabilities_show_fragility_of_starttls)

[APNIC blog: Vulnerabilities show why STARTTLS should be avoided if possible](https://blog.apnic.net/2021/11/18/vulnerabilities-show-why-starttls-should-be-avoided-if-possible/)

### Presentations

[USENIX Security '21 - Why TLS is better without STARTTLS](https://www.youtube.com/watch?v=cJhJdMC_PGI)

[Driving IT Conference 2021: STARTTLS endangers your E-Mail passwords](https://videos.ida.dk/media/STARTTLS%2Bendangers%2Byour%2BE-Mail%2Bpasswords%2Bv%2BHanno%2BB%C3%B6ck/1_8t4x51z0/235923713)

### Followup research

After we published our research some people found similar bugs in other software and other
protocols using STARTTLS.

[StartTLS in LDAP](https://fy.blackhats.net.au/blog/html/2021/08/12/starttls_in_ldap.html)

[nbdkit: Reset structured replies on STARTTLS (CVE-2021-3716)](https://listman.redhat.com/archives/libguestfs/2021-August/msg00077.html)

[fetchmail: STARTTLS session encryption bypassing (CVE-2021-39272)](https://www.fetchmail.info/fetchmail-SA-2021-02.txt)

[curl 7.79.0 fixes two STARTTLS vulnerabilities](https://daniel.haxx.se/blog/2021/09/15/curl-7-79-0-secure-local-cookies/)

[CVE-2021-38542: Apache James vulnerable to STARTTLS command injection (IMAP and POP3)](https://lists.apache.org/thread/j8p5n4g431hwy78qro6mwchbogq1zpck)

[CVE-2021-32066: A StartTLS stripping vulnerability in Net::IMAP](https://www.ruby-lang.org/en/news/2021/07/07/starttls-stripping-in-net-imap/)

The website design was "stolen" from the DROWN website and slightly adapted;
it was created by [Sarah Madden](http://sarahmadden.com/).
The logo was created by [foxitalic](https://twitter.com/foxitalic).
Logo, design, and content of this website are under a
[CC0](https://creativecommons.org/publicdomain/zero/1.0/) license.
| [Imprint](/imprint)

First published: 2021-08-09, last changes: 2024-01-24



=== Content from access.redhat.com_b31c40c8_20250108_160701.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from gitlab.com_e33126ef_20250108_160700.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
09a13daf**

authored
Aug 16, 2021
by
**[![Eric Blake's avatar](https://secure.gravatar.com/avatar/a48050179faca1b9281aa8cf42be5d8fe022c39005ce3a77d709290bf87dc818?s=96&d=identicon "Eric Blake")](/ebblake)
[Eric Blake](/ebblake)**

[Browse files](/nbdkit/nbdkit/-/tree/09a13dafb7bb3a38ab52eb5501cba786365ba7fd)

### server: CVE-2021-3716 reset structured replies on starttls

```

<https://nostarttls.secvuln.info/> pointed out a series of CVEs in
common implementation flaw in various SMTP and IMAP clients and
servers, all with a common thread of improperly caching plaintext
state across the STARTTLS encryption boundary; and recommended that
other protocols with a STARTTLS operation perform a similar audit.

It turns out that nbdkit has the same vulnerability in regards to the
NBD protocol: when nbdkit is run in opportunistic TLS mode, an
attacker is able to inject a plaintext NBD_OPT_STRUCTURED_REPLY before
proxying everything else a client sends to the server; if the server
then acts on that plaintext request (as nbdkit did before this patch),
then the server ends up sending structured replies to at least
NBD_CMD_READ, even though the client was assuming that the transition
to TLS has ruled out a MitM attack.

On the bright side, nbdkit's behavior on a second
NBD_OPT_STRUCTURED_REPLY was to still reply with success, so a client
that always requests structured replies after starting TLS sees no
difference in behavior (that is, qemu 2.12 and later are immune) (had
nbdkit given an error to the second request, that may have caused
confusion to more clients).  And there is always the mitigation of
using --tls=require, which lets nbdkit reject the MitM message
pre-encryption.  However, nbd-client 3.15 to the present do not
understand structured replies, and I have confirmed that a MitM
attacker can thus cause a denial-of-service attack that does not
trigger until the client does its first encrypted NBD_CMD_READ.

The NBD spec has been recently tightened to declare the nbdkit
behavior to be a security hole:
<https://github.com/NetworkBlockDevice/nbd/commit/77e55378096aa>
```

parent
[7182c47d](/nbdkit/nbdkit/-/commit/7182c47d04d2b68005fceadefc0c14bfaa61a533)

Loading

Loading

Loading

* [Changes
  2](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd)

[Hide whitespace changes](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?action=show&controller=projects%2Fcommit&id=09a13dafb7bb3a38ab52eb5501cba786365ba7fd&namespace_id=nbdkit&project_id=nbdkit&w=1)
[Inline](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?view=inline)
[Side-by-side](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?view=parallel)

Loading

* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [b358ead0](/nbdkit/nbdkit/-/commit/b358ead018fa3ba36918969f801dde73251afd6f "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_654557387)

  mentioned in commit [b358ead0](/nbdkit/nbdkit/-/commit/b358ead018fa3ba36918969f801dde73251afd6f "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit b358ead018fa3ba36918969f801dde73251afd6f

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6185b15a](/nbdkit/nbdkit/-/commit/6185b15a81e6915734d678f0781e31d45a7941a1 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_654568235)

  mentioned in commit [6185b15a](/nbdkit/nbdkit/-/commit/6185b15a81e6915734d678f0781e31d45a7941a1 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 6185b15a81e6915734d678f0781e31d45a7941a1

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [ffb9dc38](/nbdkit/nbdkit/-/commit/ffb9dc381a57d2de17dae7a39853c041a36a041f "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655422649)

  mentioned in commit [ffb9dc38](/nbdkit/nbdkit/-/commit/ffb9dc381a57d2de17dae7a39853c041a36a041f "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit ffb9dc381a57d2de17dae7a39853c041a36a041f

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [2845315e](/nbdkit/nbdkit/-/commit/2845315e7691c500f5788c047f4aa82f4abd209d "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655432075)

  mentioned in commit [2845315e](/nbdkit/nbdkit/-/commit/2845315e7691c500f5788c047f4aa82f4abd209d "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 2845315e7691c500f5788c047f4aa82f4abd209d

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c8159e4c](/nbdkit/nbdkit/-/commit/c8159e4c63b7909dacc0c6c6da67f4a26c654e83 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655441901)

  mentioned in commit [c8159e4c](/nbdkit/nbdkit/-/commit/c8159e4c63b7909dacc0c6c6da67f4a26c654e83 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit c8159e4c63b7909dacc0c6c6da67f4a26c654e83

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c6a76da8](/nbdkit/nbdkit/-/commit/c6a76da86bd5fad5b22bf228616a40a263ca8802 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655446379)

  mentioned in commit [c6a76da8](/nbdkit/nbdkit/-/commit/c6a76da86bd5fad5b22bf228616a40a263ca8802 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit c6a76da86bd5fad5b22bf228616a40a263ca8802

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [022a63bf](/nbdkit/nbdkit/-/commit/022a63bfe956b58a11713744c9b98b3781570a84 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655451358)

  mentioned in commit [022a63bf](/nbdkit/nbdkit/-/commit/022a63bfe956b58a11713744c9b98b3781570a84 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 022a63bfe956b58a11713744c9b98b3781570a84

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [650fc431](/nbdkit/nbdkit/-/commit/650fc4316172d75ddd755d7cda36de0c4799f532 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655454352)

  mentioned in commit [650fc431](/nbdkit/nbdkit/-/commit/650fc4316172d75ddd755d7cda36de0c4799f532 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 650fc4316172d75ddd755d7cda36de0c4799f532

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6b9d4380](/nbdkit/nbdkit/-/commit/6b9d4380df9bd0be91f49aad8c4f47b4e672adde "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Jan 26, 2022](#note_822140906)

  mentioned in commit [6b9d4380](/nbdkit/nbdkit/-/commit/6b9d4380df9bd0be91f49aad8c4f47b4e672adde "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 6b9d4380df9bd0be91f49aad8c4f47b4e672adde

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [282c3b03](/nbdkit/nbdkit/-/commit/282c3b036809bc634930bda7ad6e51640925526a "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 05, 2022](#note_1125833839)

  mentioned in commit [282c3b03](/nbdkit/nbdkit/-/commit/282c3b036809bc634930bda7ad6e51640925526a "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit 282c3b036809bc634930bda7ad6e51640925526a

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c2509f99](/nbdkit/nbdkit/-/commit/c2509f9996def87c3ec478000062b06b34be42d5 "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 14, 2022](#note_1136417337)

  mentioned in commit [c2509f99](/nbdkit/nbdkit/-/commit/c2509f9996def87c3ec478000062b06b34be42d5 "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit c2509f9996def87c3ec478000062b06b34be42d5

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6e7b6faf](/nbdkit/nbdkit/-/commit/6e7b6fafaa5c08770d9818575ce423b60d5d006f "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 14, 2022](#note_1136423084)

  mentioned in commit [6e7b6faf](/nbdkit/nbdkit/-/commit/6e7b6fafaa5c08770d9818575ce423b60d5d006f "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit 6e7b6fafaa5c08770d9818575ce423b60d5d006f

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_b2196758_20250108_134013.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
6c5faac6**

authored
Aug 16, 2021
by
**[![Eric Blake's avatar](https://secure.gravatar.com/avatar/a48050179faca1b9281aa8cf42be5d8fe022c39005ce3a77d709290bf87dc818?s=96&d=identicon "Eric Blake")](/ebblake)
[Eric Blake](/ebblake)**

[Browse files](/nbdkit/nbdkit/-/tree/6c5faac6a37077cf2366388a80862bb00616d0d8)

### server: reset meta context replies on starttls

```

Related to CVE-2021-3716, but not as severe.  No compliant client will
send NBD_CMD_BLOCK_STATUS unless it first negotiates
NBD_OPT_SET_META_CONTEXT.  If an attacker injects a premature
SET_META_CONTEXT, either the client will never notice (because it
never uses BLOCK_STATUS), or the client will overwrite the attacker's
attempt with the client's own SET_META_CONTEXT request after
encryption is enabled.  So I don't class this as having the potential
to trigger denial-of-service due to any protocol mismatch between
compliant client and server (I don't care what happens with
non-compliant clients).

Fixes: [26455d45](/nbdkit/nbdkit/-/commit/26455d452574f60119a79aea5a9f437c1d222ae5 "server: protocol: Implement Block Status \"base:allocation\".") (server: protocol: Implement Block Status "base:allocation".)
```

parent
[ff617f38](/nbdkit/nbdkit/-/commit/ff617f386b55090fb1ff7e5232fd39132ffe2311)

Loading

Loading

Loading

* [Changes
  1](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8)

[Hide whitespace changes](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?action=show&controller=projects%2Fcommit&id=6c5faac6a37077cf2366388a80862bb00616d0d8&namespace_id=nbdkit&project_id=nbdkit&w=1)
[Inline](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=inline)
[Side-by-side](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=parallel)

Loading

* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_654751330)

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  mentioned in commit 89ef17c90996c0e212e3a17c8d26ff930ab464ea

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655417842)

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  mentioned in commit 814d8103fb4b581dc01dfd25d2cd81596576f211

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655422648)

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  mentioned in commit e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655432074)

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  mentioned in commit 386a6e832602ea88b9318dc02a5bade5196dba69

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655441899)

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  mentioned in commit 66834346d60bdd41ded9f8ef9773317d601f850e

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655446380)

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  mentioned in commit 1105c52548967bad821de5dcb08e06576bc69017

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655451363)

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  mentioned in commit 4c07516eca730291e2c5746e2139bf063f70e451

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655454351)

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  mentioned in commit ab1c1a69020f7a409eeb62a6795e4324ae80276d

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  ·

  [Jan 26, 2022](#note_822140903)

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  mentioned in commit add9b794b9dc697a1b52115c997fcfb6e06bf64c

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from gitlab.com_e33126ef_20250108_134012.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
09a13daf**

authored
Aug 16, 2021
by
**[![Eric Blake's avatar](https://secure.gravatar.com/avatar/a48050179faca1b9281aa8cf42be5d8fe022c39005ce3a77d709290bf87dc818?s=96&d=identicon "Eric Blake")](/ebblake)
[Eric Blake](/ebblake)**

[Browse files](/nbdkit/nbdkit/-/tree/09a13dafb7bb3a38ab52eb5501cba786365ba7fd)

### server: CVE-2021-3716 reset structured replies on starttls

```

<https://nostarttls.secvuln.info/> pointed out a series of CVEs in
common implementation flaw in various SMTP and IMAP clients and
servers, all with a common thread of improperly caching plaintext
state across the STARTTLS encryption boundary; and recommended that
other protocols with a STARTTLS operation perform a similar audit.

It turns out that nbdkit has the same vulnerability in regards to the
NBD protocol: when nbdkit is run in opportunistic TLS mode, an
attacker is able to inject a plaintext NBD_OPT_STRUCTURED_REPLY before
proxying everything else a client sends to the server; if the server
then acts on that plaintext request (as nbdkit did before this patch),
then the server ends up sending structured replies to at least
NBD_CMD_READ, even though the client was assuming that the transition
to TLS has ruled out a MitM attack.

On the bright side, nbdkit's behavior on a second
NBD_OPT_STRUCTURED_REPLY was to still reply with success, so a client
that always requests structured replies after starting TLS sees no
difference in behavior (that is, qemu 2.12 and later are immune) (had
nbdkit given an error to the second request, that may have caused
confusion to more clients).  And there is always the mitigation of
using --tls=require, which lets nbdkit reject the MitM message
pre-encryption.  However, nbd-client 3.15 to the present do not
understand structured replies, and I have confirmed that a MitM
attacker can thus cause a denial-of-service attack that does not
trigger until the client does its first encrypted NBD_CMD_READ.

The NBD spec has been recently tightened to declare the nbdkit
behavior to be a security hole:
<https://github.com/NetworkBlockDevice/nbd/commit/77e55378096aa>
```

parent
[7182c47d](/nbdkit/nbdkit/-/commit/7182c47d04d2b68005fceadefc0c14bfaa61a533)

Loading

Loading

Loading

* [Changes
  2](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd)

[Hide whitespace changes](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?action=show&controller=projects%2Fcommit&id=09a13dafb7bb3a38ab52eb5501cba786365ba7fd&namespace_id=nbdkit&project_id=nbdkit&w=1)
[Inline](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?view=inline)
[Side-by-side](/nbdkit/nbdkit/-/commit/09a13dafb7bb3a38ab52eb5501cba786365ba7fd?view=parallel)

Loading

* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [b358ead0](/nbdkit/nbdkit/-/commit/b358ead018fa3ba36918969f801dde73251afd6f "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_654557387)

  mentioned in commit [b358ead0](/nbdkit/nbdkit/-/commit/b358ead018fa3ba36918969f801dde73251afd6f "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit b358ead018fa3ba36918969f801dde73251afd6f

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6185b15a](/nbdkit/nbdkit/-/commit/6185b15a81e6915734d678f0781e31d45a7941a1 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_654568235)

  mentioned in commit [6185b15a](/nbdkit/nbdkit/-/commit/6185b15a81e6915734d678f0781e31d45a7941a1 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 6185b15a81e6915734d678f0781e31d45a7941a1

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [ffb9dc38](/nbdkit/nbdkit/-/commit/ffb9dc381a57d2de17dae7a39853c041a36a041f "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655422649)

  mentioned in commit [ffb9dc38](/nbdkit/nbdkit/-/commit/ffb9dc381a57d2de17dae7a39853c041a36a041f "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit ffb9dc381a57d2de17dae7a39853c041a36a041f

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [2845315e](/nbdkit/nbdkit/-/commit/2845315e7691c500f5788c047f4aa82f4abd209d "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655432075)

  mentioned in commit [2845315e](/nbdkit/nbdkit/-/commit/2845315e7691c500f5788c047f4aa82f4abd209d "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 2845315e7691c500f5788c047f4aa82f4abd209d

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c8159e4c](/nbdkit/nbdkit/-/commit/c8159e4c63b7909dacc0c6c6da67f4a26c654e83 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655441901)

  mentioned in commit [c8159e4c](/nbdkit/nbdkit/-/commit/c8159e4c63b7909dacc0c6c6da67f4a26c654e83 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit c8159e4c63b7909dacc0c6c6da67f4a26c654e83

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c6a76da8](/nbdkit/nbdkit/-/commit/c6a76da86bd5fad5b22bf228616a40a263ca8802 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655446379)

  mentioned in commit [c6a76da8](/nbdkit/nbdkit/-/commit/c6a76da86bd5fad5b22bf228616a40a263ca8802 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit c6a76da86bd5fad5b22bf228616a40a263ca8802

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [022a63bf](/nbdkit/nbdkit/-/commit/022a63bfe956b58a11713744c9b98b3781570a84 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655451358)

  mentioned in commit [022a63bf](/nbdkit/nbdkit/-/commit/022a63bfe956b58a11713744c9b98b3781570a84 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 022a63bfe956b58a11713744c9b98b3781570a84

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [650fc431](/nbdkit/nbdkit/-/commit/650fc4316172d75ddd755d7cda36de0c4799f532 "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Aug 19, 2021](#note_655454352)

  mentioned in commit [650fc431](/nbdkit/nbdkit/-/commit/650fc4316172d75ddd755d7cda36de0c4799f532 "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 650fc4316172d75ddd755d7cda36de0c4799f532

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6b9d4380](/nbdkit/nbdkit/-/commit/6b9d4380df9bd0be91f49aad8c4f47b4e672adde "server: CVE-2021-3716 reset structured replies on starttls")

  ·

  [Jan 26, 2022](#note_822140906)

  mentioned in commit [6b9d4380](/nbdkit/nbdkit/-/commit/6b9d4380df9bd0be91f49aad8c4f47b4e672adde "server: CVE-2021-3716 reset structured replies on starttls")

  mentioned in commit 6b9d4380df9bd0be91f49aad8c4f47b4e672adde

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [282c3b03](/nbdkit/nbdkit/-/commit/282c3b036809bc634930bda7ad6e51640925526a "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 05, 2022](#note_1125833839)

  mentioned in commit [282c3b03](/nbdkit/nbdkit/-/commit/282c3b036809bc634930bda7ad6e51640925526a "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit 282c3b036809bc634930bda7ad6e51640925526a

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [c2509f99](/nbdkit/nbdkit/-/commit/c2509f9996def87c3ec478000062b06b34be42d5 "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 14, 2022](#note_1136417337)

  mentioned in commit [c2509f99](/nbdkit/nbdkit/-/commit/c2509f9996def87c3ec478000062b06b34be42d5 "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit c2509f9996def87c3ec478000062b06b34be42d5

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [6e7b6faf](/nbdkit/nbdkit/-/commit/6e7b6fafaa5c08770d9818575ce423b60d5d006f "tls: Gracefully handle early NBD_OPT_ payload")

  ·

  [Oct 14, 2022](#note_1136423084)

  mentioned in commit [6e7b6faf](/nbdkit/nbdkit/-/commit/6e7b6fafaa5c08770d9818575ce423b60d5d006f "tls: Gracefully handle early NBD_OPT_ payload")

  mentioned in commit 6e7b6fafaa5c08770d9818575ce423b60d5d006f

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from access.redhat.com_ff7358de_20250108_160700.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_eff49020_20250108_160702.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibguestfs%2Fnbdkit%2Fcommit%2Feaa4c6e9a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibguestfs%2Fnbdkit%2Fcommit%2Feaa4c6e9a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=libguestfs%2Fnbdkit)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libguestfs](/libguestfs)
/
**[nbdkit](/libguestfs/nbdkit)**
Public

* [Notifications](/login?return_to=%2Flibguestfs%2Fnbdkit) You must be signed in to change notification settings
* [Fork
  33](/login?return_to=%2Flibguestfs%2Fnbdkit)
* [Star
   229](/login?return_to=%2Flibguestfs%2Fnbdkit)

* [Code](/libguestfs/nbdkit)
* [Issues
  0](/libguestfs/nbdkit/issues)
* [Pull requests
  1](/libguestfs/nbdkit/pulls)
* [Actions](/libguestfs/nbdkit/actions)
* [Projects
  0](/libguestfs/nbdkit/projects)
* [Wiki](/libguestfs/nbdkit/wiki)
* [Security](/libguestfs/nbdkit/security)
* [Insights](/libguestfs/nbdkit/pulse)

Additional navigation options

* [Code](/libguestfs/nbdkit)
* [Issues](/libguestfs/nbdkit/issues)
* [Pull requests](/libguestfs/nbdkit/pulls)
* [Actions](/libguestfs/nbdkit/actions)
* [Projects](/libguestfs/nbdkit/projects)
* [Wiki](/libguestfs/nbdkit/wiki)
* [Security](/libguestfs/nbdkit/security)
* [Insights](/libguestfs/nbdkit/pulse)

## Commit

[Permalink](/libguestfs/nbdkit/commit/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

server: Minimal implementation of NBD Structured Replies.

[Browse files](/libguestfs/nbdkit/tree/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8)
Browse the repository at this point in the history

```
This is about the simplest implementation of NBD Structured Replies
(SR) that we can do right now.

It accepts NBD_OPT_STRUCTURED_REPLIES when negotiated by the client,
but only sends back the simplest possible SR when required to by
NBD_CMD_READ.  The rest of the time it will send back simple replies
as before.  We do not modify the plugin API so plugins are unable to
send complex SRs.

Also we do not handle human-readable error messages yet because that
would require changes in how we handle nbdkit_error().

Also we do not understand NBD_CMD_FLAG_DF, but that seems to be OK
because (a) we don't advertize the feature and (b) we only send back a
single chunk anyway.
```

* Loading branch information

[![@rwmjones](https://avatars.githubusercontent.com/u/259688?s=40&v=4)](/rwmjones)

[rwmjones](/libguestfs/nbdkit/commits?author=rwmjones "View all commits by rwmjones")
committed
Mar 8, 2019

1 parent
[b165ff3](/libguestfs/nbdkit/commit/b165ff3ef6c20f62108bafa2834cd849fba2a695)

commit eaa4c6e

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**212 additions**
and
**48 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/nbdkit-protocol.pod
    [nbdkit-protocol.pod](#diff-54f01e6e09e09ea26f84fc1d7c8b085b52d72f02488d8122081aff2237a9bcf7)
* plugins/nbd

  + plugins/nbd/nbd.c
    [nbd.c](#diff-967ab3fe0694929a6358d750a23ce048fe860d2019e1a570bfdd2b33d49a4c6f)
* server

  + server/connections.c
    [connections.c](#diff-72adc1d494090d8b2fa8138e8c949a7aabcfb573a19f578acfbc53e44de6a303)
  + server/protocol.h
    [protocol.h](#diff-eb7b78724e4573a9623844ba231db3b197c15152c41d691091ac05ee0e144702)
* tests

  + tests/test-layers.c
    [test-layers.c](#diff-26c29ce8f250c5a9dbc7a13ad63cf9874a6dcda006d060467220a83f5b100d83)

## There are no files selected for viewing

6 changes: 5 additions & 1 deletion

6
[docs/nbdkit-protocol.pod](#diff-54f01e6e09e09ea26f84fc1d7c8b085b52d72f02488d8122081aff2237a9bcf7 "docs/nbdkit-protocol.pod")

Show comments

[View file](/libguestfs/nbdkit/blob/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8/docs/nbdkit-protocol.pod)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -122,7 +122,11 @@ Supported in nbdkit E<ge> 1.9.9. |
|  |  |  |
|  |  | =item Structured Replies |
|  |  |  |
|  |  | I<Not supported>. |
|  |  | Supported in nbdkit E<ge> 1.11.8. |
|  |  |  |
|  |  | However we don’t expose the capability to send structured replies to |
|  |  | plugins yet, nor do we send human-readable error messages using this |
|  |  | facility. |
|  |  |  |
|  |  | =item Block Status |
|  |  |  |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[plugins/nbd/nbd.c](#diff-967ab3fe0694929a6358d750a23ce048fe860d2019e1a570bfdd2b33d49a4c6f "plugins/nbd/nbd.c")

Show comments

[View file](/libguestfs/nbdkit/blob/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8/plugins/nbd/nbd.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -345,15 +345,15 @@ nbd\_request (struct handle \*h, uint16\_t flags, uint16\_t type, uint64\_t offset, |
|  |  | static int |
|  |  | nbd\_reply\_raw (struct handle \*h, int \*fd) |
|  |  | { |
|  |  | struct reply rep; |
|  |  | struct simple\_reply rep; |
|  |  | struct transaction \*trans; |
|  |  | void \*buf; |
|  |  | uint32\_t count; |
|  |  |  |
|  |  | \*fd = -1; |
|  |  | if (read\_full (h->fd, &rep, sizeof rep) < 0) |
|  |  | return nbd\_mark\_dead (h); |
|  |  | if (be32toh (rep.magic) != NBD\_REPLY\_MAGIC) |
|  |  | if (be32toh (rep.magic) != NBD\_SIMPLE\_REPLY\_MAGIC) |
|  |  | return nbd\_mark\_dead (h); |
|  |  | nbdkit\_debug ("received reply for cookie %#" PRIx64 ", status %s", |
|  |  | rep.handle, name\_of\_nbd\_error(be32toh (rep.error))); |
| Expand Down | |  |

189 changes: 157 additions & 32 deletions

189
[server/connections.c](#diff-72adc1d494090d8b2fa8138e8c949a7aabcfb573a19f578acfbc53e44de6a303 "server/connections.c")

Show comments

[View file](/libguestfs/nbdkit/blob/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8/server/connections.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -86,6 +86,7 @@ struct connection { |
|  |  | bool can\_fua; |
|  |  | bool can\_multi\_conn; |
|  |  | bool using\_tls; |
|  |  | bool structured\_replies; |
|  |  |  |
|  |  | int sockin, sockout; |
|  |  | connection\_recv\_function recv; |
| Expand Down  Expand Up | | @@ -905,6 +906,26 @@ \_negotiate\_handshake\_newstyle\_options (struct connection \*conn) |
|  |  |  |
|  |  | break; |
|  |  |  |
|  |  | case NBD\_OPT\_STRUCTURED\_REPLY: |
|  |  | if (optlen != 0) { |
|  |  | if (send\_newstyle\_option\_reply (conn, option, NBD\_REP\_ERR\_INVALID) |
|  |  | == -1) |
|  |  | return -1; |
|  |  | if (conn\_recv\_full (conn, data, optlen, |
|  |  | "read: %s: %m", name\_of\_nbd\_opt (option)) == -1) |
|  |  | return -1; |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | debug ("newstyle negotiation: %s: client requested structured replies", |
|  |  | name\_of\_nbd\_opt (option)); |
|  |  |  |
|  |  | if (send\_newstyle\_option\_reply (conn, option, NBD\_REP\_ACK) == -1) |
|  |  | return -1; |
|  |  |  |
|  |  | conn->structured\_replies = true; |
|  |  | break; |
|  |  |  |
|  |  | default: |
|  |  | /\* Unknown option. \*/ |
|  |  | if (send\_newstyle\_option\_reply (conn, option, NBD\_REP\_ERR\_UNSUP) == -1) |
| Expand Down  Expand Up | | @@ -1224,12 +1245,123 @@ nbd\_errno (int error) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | send\_simple\_reply (struct connection \*conn, |
|  |  | uint64\_t handle, uint16\_t cmd, |
|  |  | const char \*buf, uint32\_t count, |
|  |  | uint32\_t error) |
|  |  | { |
|  |  | ACQUIRE\_LOCK\_FOR\_CURRENT\_SCOPE (&conn->write\_lock); |
|  |  | struct simple\_reply reply; |
|  |  | int r; |
|  |  |  |
|  |  | reply.magic = htobe32 (NBD\_SIMPLE\_REPLY\_MAGIC); |
|  |  | reply.handle = handle; |
|  |  | reply.error = htobe32 (nbd\_errno (error)); |
|  |  |  |
|  |  | r = conn->send (conn, &reply, sizeof reply); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write reply: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  |  |
|  |  | /\* Send the read data buffer. \*/ |
|  |  | if (cmd == NBD\_CMD\_READ && !error) { |
|  |  | r = conn->send (conn, buf, count); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write data: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return 1; /\* command processed ok \*/ |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | send\_structured\_reply\_read (struct connection \*conn, |
|  |  | uint64\_t handle, uint16\_t cmd, |
|  |  | const char \*buf, uint32\_t count, uint64\_t offset) |
|  |  | { |
|  |  | /\* Once we are really using structured replies and sending data back |
|  |  | \* in chunks, we'll be able to grab the write lock for each chunk, |
|  |  | \* allowing other threads to interleave replies. As we're not doing |
|  |  | \* that yet we acquire the lock for the whole function. |
|  |  | \*/ |
|  |  | ACQUIRE\_LOCK\_FOR\_CURRENT\_SCOPE (&conn->write\_lock); |
|  |  | struct structured\_reply reply; |
|  |  | struct structured\_reply\_offset\_data offset\_data; |
|  |  | int r; |
|  |  |  |
|  |  | assert (cmd == NBD\_CMD\_READ); |
|  |  |  |
|  |  | reply.magic = htobe32 (NBD\_STRUCTURED\_REPLY\_MAGIC); |
|  |  | reply.handle = handle; |
|  |  | reply.flags = htobe16 (NBD\_REPLY\_FLAG\_DONE); |
|  |  | reply.type = htobe16 (NBD\_REPLY\_TYPE\_OFFSET\_DATA); |
|  |  | reply.length = htobe32 (count + sizeof offset\_data); |
|  |  |  |
|  |  | r = conn->send (conn, &reply, sizeof reply); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write reply: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  |  |
|  |  | /\* Send the offset + read data buffer. \*/ |
|  |  | offset\_data.offset = htobe64 (offset); |
|  |  | r = conn->send (conn, &offset\_data, sizeof offset\_data); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write data: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  |  |
|  |  | r = conn->send (conn, buf, count); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write data: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  |  |
|  |  | return 1; /\* command processed ok \*/ |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | send\_structured\_reply\_error (struct connection \*conn, |
|  |  | uint64\_t handle, uint16\_t cmd, uint32\_t error) |
|  |  | { |
|  |  | ACQUIRE\_LOCK\_FOR\_CURRENT\_SCOPE (&conn->write\_lock); |
|  |  | struct structured\_reply reply; |
|  |  | struct structured\_reply\_error error\_data; |
|  |  | int r; |
|  |  |  |
|  |  | reply.magic = htobe32 (NBD\_STRUCTURED\_REPLY\_MAGIC); |
|  |  | reply.handle = handle; |
|  |  | reply.flags = htobe16 (NBD\_REPLY\_FLAG\_DONE); |
|  |  | reply.type = htobe16 (NBD\_REPLY\_TYPE\_ERROR); |
|  |  | reply.length = htobe32 (0 /\* no human readable error \*/ + sizeof error\_data); |
|  |  |  |
|  |  | r = conn->send (conn, &reply, sizeof reply); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write error reply: %m"); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  |  |
|  |  | /\* Send the error. \*/ |
|  |  | error\_data.error = htobe32 (error); |
|  |  | error\_data.len = htobe16 (0); |
|  |  | r = conn->send (conn, &error\_data, sizeof error\_data); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write data: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  | /\* No human readable error message at the moment. \*/ |
|  |  |  |
|  |  | return 1; /\* command processed ok \*/ |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | recv\_request\_send\_reply (struct connection \*conn) |
|  |  | { |
|  |  | int r; |
|  |  | struct request request; |
|  |  | struct reply reply; |
|  |  | uint16\_t cmd, flags; |
|  |  | uint32\_t magic, count, error = 0; |
|  |  | uint64\_t offset; |
| Expand Down  Expand Up | | @@ -1317,40 +1449,33 @@ recv\_request\_send\_reply (struct connection \*conn) |
|  |  |  |
|  |  | /\* Send the reply packet. \*/ |
|  |  | send\_reply: |
|  |  | { |
|  |  | ACQUIRE\_LOCK\_FOR\_CURRENT\_SCOPE (&conn->write\_lock); |
|  |  | if (get\_status (conn) < 0) |
|  |  | return -1; |
|  |  | reply.magic = htobe32 (NBD\_REPLY\_MAGIC); |
|  |  | reply.handle = request.handle; |
|  |  | reply.error = htobe32 (nbd\_errno (error)); |
|  |  |  |
|  |  | if (error != 0) { |
|  |  | /\* Since we're about to send only the limited NBD\_E\* errno to the |
|  |  | \* client, don't lose the information about what really happened |
|  |  | \* on the server side. Make sure there is a way for the operator |
|  |  | \* to retrieve the real error. |
|  |  | \*/ |
|  |  | debug ("sending error reply: %s", strerror (error)); |
|  |  | } |
|  |  |  |
|  |  | r = conn->send (conn, &reply, sizeof reply); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write reply: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  | if (get\_status (conn) < 0) |
|  |  | return -1; |
|  |  |  |
|  |  | /\* Send the read data buffer. \*/ |
|  |  | if (cmd == NBD\_CMD\_READ && !error) { |
|  |  | r = conn->send (conn, buf, count); |
|  |  | if (r == -1) { |
|  |  | nbdkit\_error ("write data: %s: %m", name\_of\_nbd\_cmd (cmd)); |
|  |  | return set\_status (conn, -1); |
|  |  | } |
|  |  | } |
|  |  | if (error != 0) { |
|  |  | /\* Since we're about to send only the limited NBD\_E\* errno to the |
|  |  | \* client, don't lose the information about what really happened |
|  |  | \* on the server side. Make sure there is a way for the operator |
|  |  | \* to retrieve the real error. |
|  |  | \*/ |
|  |  | debug ("sending error reply: %s", strerror (error)); |
|  |  | } |
|  |  |  |
|  |  | return 1; /\* command processed ok \*/ |
|  |  | /\* Currently we prefer to send simple replies for everything except |
|  |  | \* where we have to (ie. NBD\_CMD\_READ when structured\_replies have |
|  |  | \* been negotiated). However this prevents us from sending |
|  |  | \* human-readable error messages to the client, so we should |
|  |  | \* reconsider this in future. |
|  |  | \*/ |
|  |  | if (conn->structured\_replies && cmd == NBD\_CMD\_READ) { |
|  |  | if (!error) |
|  |  | return send\_structured\_reply\_read (conn, request.handle, cmd, |
|  |  | buf, count, offset); |
|  |  | else |
|  |  | return send\_structured\_reply\_error (conn, request.handle, cmd, error); |
|  |  | } |
|  |  | else |
|  |  | return send\_simple\_reply (conn, request.handle, cmd, buf, count, error); |
|  |  | } |
|  |  |  |
|  |  | /\* Write buffer to conn->sockout and either succeed completely |
| Expand Down | |  |

59 changes: 47 additions & 12 deletions

59
[server/protocol.h](#diff-eb7b78724e4573a9623844ba231db3b197c15152c41d691091ac05ee0e144702 "server/protocol.h")

Show comments

[View file](/libguestfs/nbdkit/blob/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8/server/protocol.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | /\* nbdkit |
|  |  | \* Copyright (C) 2013-2018 Red Hat Inc. |
|  |  | \* Copyright (C) 2013-2019 Red Hat Inc. |
|  |  | \* All rights reserved. |
|  |  | \* |
|  |  | \* Redistribution and use in source and binary forms, with or without |
| Expand Down  Expand Up | | @@ -98,12 +98,13 @@ extern const char \*name\_of\_nbd\_flag (int); |
|  |  |  |
|  |  | /\* NBD options (new style handshake only). \*/ |
|  |  | extern const char \*name\_of\_nbd\_opt (int); |
|  |  | #define NBD\_OPT\_EXPORT\_NAME 1 |
|  |  | #define NBD\_OPT\_ABORT 2 |
|  |  | #define NBD\_OPT\_LIST 3 |
|  |  | #define NBD\_OPT\_STARTTLS 5 |
|  |  | #define NBD\_OPT\_INFO 6 |
|  |  | #define NBD\_OPT\_GO 7 |
|  |  | #define NBD\_OPT\_EXPORT\_NAME 1 |
|  |  | #define NBD\_OPT\_ABORT 2 |
|  |  | #define NBD\_OPT\_LIST 3 |
|  |  | #define NBD\_OPT\_STARTTLS 5 |
|  |  | #define NBD\_OPT\_INFO 6 |
|  |  | #define NBD\_OPT\_GO 7 |
|  |  | #define NBD\_OPT\_STRUCTURED\_REPLY 8 |
|  |  |  |
|  |  | extern const char \*name\_of\_nbd\_rep (int); |
|  |  | #define NBD\_REP\_ACK 1 |
| Expand Down  Expand Up | | @@ -144,15 +145,49 @@ struct request { |
|  |  | uint32\_t count; /\* Request length. \*/ |
|  |  | } \_\_attribute\_\_((packed)); |
|  |  |  |
|  |  | /\* Reply (server -> client). \*/ |
|  |  | struct reply { |
|  |  | uint32\_t magic; /\* NBD\_REPLY\_MAGIC. \*/ |
|  |  | /\* Simple reply (server -> client). \*/ |
|  |  | struct simple\_reply { |
|  |  | uint32\_t magic; /\* NBD\_SIMPLE\_REPLY\_MAGIC. \*/ |
|  |  | uint32\_t error; /\* NBD\_SUCCESS or one of NBD\_E\*. \*/ |
|  |  | uint64\_t handle; /\* Opaque handle. \*/ |
|  |  | } \_\_attribute\_\_((packed)); |
|  |  |  |
|  |  | #define NBD\_REQUEST\_MAGIC 0x25609513 |
|  |  | #define NBD\_REPLY\_MAGIC 0x67446698 |
|  |  | /\* Structured reply (server -> client). \*/ |
|  |  | struct structured\_reply { |
|  |  | uint32\_t magic; /\* NBD\_STRUCTURED\_REPLY\_MAGIC. \*/ |
|  |  | uint16\_t flags; /\* NBD\_REPLY\_FLAG\_\* \*/ |
|  |  | uint16\_t type; /\* NBD\_REPLY\_TYPE\_\* \*/ |
|  |  | uint64\_t handle; /\* Opaque handle. \*/ |
|  |  | uint32\_t length; /\* Length of payload which follows. \*/ |
|  |  | } \_\_attribute\_\_((packed)); |
|  |  |  |
|  |  | struct structured\_reply\_offset\_data { |
|  |  | uint64\_t offset; /\* offset \*/ |
|  |  | /\* Followed by data. \*/ |
|  |  | } \_\_attribute\_\_((packed)); |
|  |  |  |
|  |  | struct structured\_reply\_error { |
|  |  | uint32\_t error; /\* NBD\_E\* error number \*/ |
|  |  | uint16\_t len; /\* Length of human readable error. \*/ |
|  |  | /\* Followed by human readable error string. \*/ |
|  |  | } \_\_attribute\_\_((packed)); |
|  |  |  |
|  |  | #define NBD\_REQUEST\_MAGIC 0x25609513 |
|  |  | #define NBD\_SIMPLE\_REPLY\_MAGIC 0x67446698 |
|  |  | #define NBD\_STRUCTURED\_REPLY\_MAGIC 0x668e33ef |
|  |  |  |
|  |  | /\* Structured reply flags. \*/ |
|  |  | extern const char \*name\_of\_nbd\_reply\_flag (int); |
|  |  | #define NBD\_REPLY\_FLAG\_DONE (1<<0) |
|  |  |  |
|  |  | /\* Structured reply types. \*/ |
|  |  | extern const char \*name\_of\_nbd\_reply\_type (int); |
|  |  | #define NBD\_REPLY\_TYPE\_NONE 0 |
|  |  | #define NBD\_REPLY\_TYPE\_OFFSET\_DATA 1 |
|  |  | #define NBD\_REPLY\_TYPE\_OFFSET\_HOLE 2 |
|  |  | #define NBD\_REPLY\_TYPE\_BLOCK\_STATUS 3 |
|  |  | #define NBD\_REPLY\_TYPE\_ERROR ((1<<15) + 1) |
|  |  | #define NBD\_REPLY\_TYPE\_ERROR\_OFFSET ((1<<15) + 2) |
|  |  |  |
|  |  | /\* NBD commands. \*/ |
|  |  | extern const char \*name\_of\_nbd\_cmd (int); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[tests/test-layers.c](#diff-26c29ce8f250c5a9dbc7a13ad63cf9874a6dcda006d060467220a83f5b100d83 "tests/test-layers.c")

Show comments

[View file](/libguestfs/nbdkit/blob/eaa4c6e9a2c4bdb71aefdd4b1d865e7a9af606a8/tests/test-layers.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -92,7 +92,7 @@ main (int argc, char \*argv[]) |
|  |  | struct new\_handshake\_finish handshake\_finish; |
|  |  | uint16\_t eflags; |
|  |  | struct request request; |
|  |  | struct reply reply; |
|  |  | struct simple\_reply reply; |
|  |  | char data[512]; |
|  |  |  |
|  |  | #ifndef HAVE\_EXIT\_WITH\_PARENT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `eaa4c6e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibguestfs%2Fnbdkit%2Fcommit%2Feaa4c6e9a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_b4a3b001_20250108_134013.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2021/08/16/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20210818152612.5v3noomg4xt4a6pi@redhat.com>
Date: Wed, 18 Aug 2021 10:26:12 -0500
From: Eric Blake <eblake@...hat.com>
To: oss-security@...ts.openwall.com
Subject: Re: STARTTLS vulnerabilities

On Mon, Aug 16, 2021 at 02:04:06PM -0500, Eric Blake wrote:
> On Wed, Aug 11, 2021 at 06:02:35PM +0200, Hanno Böck wrote:
> > On Wed, 11 Aug 2021 10:31:58 -0500
> > Eric Blake <eblake@...hat.com> wrote:
> >
> > > Not mentioned in that list was ndb, but as far as I can tell, that
> > > project has already documented the ramifications of opportunistic
> > > encryption as being a security risk, and all known implementations
> > > (both servers and clients) with TLS support have a mode of execution
> > > that ensures the connection is dropped if a downgrade attack is
> > > attempted:
> >
> > I should point out that our research is not on simple downgrade attacks.
> > These are kinda obvious by the design of STARTTLS if you implement it
> > in an opportunistic way.
> >
> > The buffering vulnerabilities we found are in STARTTLS implementations
> > that have the expectation to enforce a secure connection, but suffer
> > from various vulnerabilities in the implementation.
>
> Thank you for persisting.  As a result, I have found a security bug in
> nbdkit, which improperly cached the result of NBD_OPT_STRUCTURED_REPLY
> from a plaintext MitM attacker prior to acting on NBD_OPT_STARTTLS, to
> the potential confusion of a client that does not expect structured
> replies.  I will follow up again when I have a CVE number.
>
> <https://listman.redhat.com/archives/libguestfs/2021-August/msg00077.html>

Now designated as CVE-2021-3716, affecting nbdkit versions 1.12
through 1.26.4; fixed nbdkit 1.26.5 will be released later today.

Mitigating factors: the bug is only possible when nbdkit is used in
opportunistic mode (--tls=on); you can avoid it by requesting that
nbdkit use forced tls mode (--tls=require on the command line).
Furthermore, all impacted nbdkit versions give successful replies to
repeated NBD_OPT_STRUCTURED_REPLY requests even though the NBD
protocol did not mandate that, so any client that requests structured
replies after STARTTLS will not see any change in behavior in spite of
the MitM injection.  In short, the bug will only impact really old
clients that understand TLS but not structured replies (at this point,
I'm aware of qemu 2.6 through 2.10, where most distros have moved to
newer versions of qemu; and all versions of nbd-client 3.15 to the
present).

--
Eric Blake, Principal Software Engineer
Red Hat, Inc.           +1-919-301-3266
Virtualization:  qemu.org | libvirt.org

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from access.redhat.com_3729f601_20250108_160704.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=dp0YsXOfZEQ&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjowMzk3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMDM5NykifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=dp0YsXOfZEQ&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjowMzk3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMDM5NykifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=dp0YsXOfZEQ&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMjowMzk3JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDIyJTNBMDM5NykifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


