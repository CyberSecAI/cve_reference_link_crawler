

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

**Commit
6c5faac6**

authored
Aug 16, 2021
by
**[![Eric Blake's avatar](https://secure.gravatar.com/avatar/a48050179faca1b9281aa8cf42be5d8fe022c39005ce3a77d709290bf87dc818?s=96&d=identicon "Eric Blake")](/ebblake)
[Eric Blake](/ebblake)**

[Browse files](/nbdkit/nbdkit/-/tree/6c5faac6a37077cf2366388a80862bb00616d0d8)

### server: reset meta context replies on starttls

```

Related to CVE-2021-3716, but not as severe.  No compliant client will
send NBD_CMD_BLOCK_STATUS unless it first negotiates
NBD_OPT_SET_META_CONTEXT.  If an attacker injects a premature
SET_META_CONTEXT, either the client will never notice (because it
never uses BLOCK_STATUS), or the client will overwrite the attacker's
attempt with the client's own SET_META_CONTEXT request after
encryption is enabled.  So I don't class this as having the potential
to trigger denial-of-service due to any protocol mismatch between
compliant client and server (I don't care what happens with
non-compliant clients).

Fixes: [26455d45](/nbdkit/nbdkit/-/commit/26455d452574f60119a79aea5a9f437c1d222ae5 "server: protocol: Implement Block Status \"base:allocation\".") (server: protocol: Implement Block Status "base:allocation".)
```

parent
[ff617f38](/nbdkit/nbdkit/-/commit/ff617f386b55090fb1ff7e5232fd39132ffe2311)

Loading

Loading

Loading

* [Changes
  1](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8)

[Hide whitespace changes](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?action=show&controller=projects%2Fcommit&id=6c5faac6a37077cf2366388a80862bb00616d0d8&namespace_id=nbdkit&project_id=nbdkit&w=1)
[Inline](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=inline)
[Side-by-side](/nbdkit/nbdkit/-/commit/6c5faac6a37077cf2366388a80862bb00616d0d8?view=parallel)

Loading

* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_654751330)

  mentioned in commit [89ef17c9](/nbdkit/nbdkit/-/commit/89ef17c90996c0e212e3a17c8d26ff930ab464ea "server: reset meta context replies on starttls")

  mentioned in commit 89ef17c90996c0e212e3a17c8d26ff930ab464ea

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655417842)

  mentioned in commit [814d8103](/nbdkit/nbdkit/-/commit/814d8103fb4b581dc01dfd25d2cd81596576f211 "server: reset meta context replies on starttls")

  mentioned in commit 814d8103fb4b581dc01dfd25d2cd81596576f211

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655422648)

  mentioned in commit [e4b6a76f](/nbdkit/nbdkit/-/commit/e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5 "server: reset meta context replies on starttls")

  mentioned in commit e4b6a76fabdaf594acb084daf9ff6ef8ff8916c5

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655432074)

  mentioned in commit [386a6e83](/nbdkit/nbdkit/-/commit/386a6e832602ea88b9318dc02a5bade5196dba69 "server: reset meta context replies on starttls")

  mentioned in commit 386a6e832602ea88b9318dc02a5bade5196dba69

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655441899)

  mentioned in commit [66834346](/nbdkit/nbdkit/-/commit/66834346d60bdd41ded9f8ef9773317d601f850e "server: reset meta context replies on starttls")

  mentioned in commit 66834346d60bdd41ded9f8ef9773317d601f850e

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655446380)

  mentioned in commit [1105c525](/nbdkit/nbdkit/-/commit/1105c52548967bad821de5dcb08e06576bc69017 "server: reset meta context replies on starttls")

  mentioned in commit 1105c52548967bad821de5dcb08e06576bc69017

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655451363)

  mentioned in commit [4c07516e](/nbdkit/nbdkit/-/commit/4c07516eca730291e2c5746e2139bf063f70e451 "server: reset meta context replies on starttls")

  mentioned in commit 4c07516eca730291e2c5746e2139bf063f70e451

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  ·

  [Aug 19, 2021](#note_655454351)

  mentioned in commit [ab1c1a69](/nbdkit/nbdkit/-/commit/ab1c1a69020f7a409eeb62a6795e4324ae80276d "server: reset meta context replies on starttls")

  mentioned in commit ab1c1a69020f7a409eeb62a6795e4324ae80276d

  Toggle commit list
* [Eric Blake](/ebblake)
  @ebblake

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  ·

  [Jan 26, 2022](#note_822140903)

  mentioned in commit [add9b794](/nbdkit/nbdkit/-/commit/add9b794b9dc697a1b52115c997fcfb6e06bf64c "server: reset meta context replies on starttls")

  mentioned in commit add9b794b9dc697a1b52115c997fcfb6e06bf64c

  Toggle commit list

Preview

0%
Loading

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment

