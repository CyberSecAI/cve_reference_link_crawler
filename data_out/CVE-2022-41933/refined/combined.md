=== Content from github.com_689c20de_20250108_124035.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F443e8398b75a1295067d74afb5898370782d863a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F443e8398b75a1295067d74afb5898370782d863a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  553](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  135](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

## Commit

[Permalink](/xwiki/xwiki-platform/commit/443e8398b75a1295067d74afb5898370782d863a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

XWIKI-19869: Improve user property storage

[Browse files](/xwiki/xwiki-platform/tree/443e8398b75a1295067d74afb5898370782d863a)
Browse the repository at this point in the history

```
  - Provide a new API for sending text based email
  - Provide a migration and a listener for informing users about it
```

* Loading branch information

[![@surli](https://avatars.githubusercontent.com/u/1478232?s=40&v=4)](/surli)

[surli](/xwiki/xwiki-platform/commits?author=surli "View all commits by surli")
committed
Jul 8, 2022

1 parent
[9c577ba](/xwiki/xwiki-platform/commit/9c577ba7b03491bb24fb945ce8b2ae7d76b4f985)

commit 443e839

 Show file tree

 Hide file tree

Showing
**14 changed files**
with
**1,044 additions**
and
**12 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* xwiki-platform-core

  + xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src

    - main

      * java/org/xwiki/mail/internal/factory/text

        + xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactory.java
          [TextMimeMessageFactory.java](#diff-e2a8706c49af2249615e4f90a6f05d7fc6c7d0ddf392ae9c178c95be983ec181)
      * resources/META-INF

        + xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/resources/META-INF/components.txt
          [components.txt](#diff-ed259521eed7266d86d866bbd32c81e6b5cc7b32f7d66cfa3ee7924f513ca19e)
    - test/java/org/xwiki/mail/internal/factory/text

      * xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/test/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactoryTest.java
        [TextMimeMessageFactoryTest.java](#diff-011de45ab3c2451fc8b12eba8e1f9d53ed05dd5321bf02d57c559c9b6aad3f4d)
  + xwiki-platform-oldcore/src/main

    - java/com/xpn/xwiki/store/migration/hibernate

      * xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/migration/hibernate/R140600000XWIKI19869DataMigration.java
        [R140600000XWIKI19869DataMigration.java](#diff-9beadfc923fa9516012a12df14f66d64fd95995acf420f66471b566a752c08a3)
    - resources/META-INF

      * xwiki-platform-core/xwiki-platform-oldcore/src/main/resources/META-INF/components.txt
        [components.txt](#diff-a0fd4d8fcae0656ae53c493a687c13a4b00170d962e5146cc4cb8ae6eec08fae)
  + xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src

    - main

      * java/org/xwiki/security/authentication/internal

        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java
          [DefaultResetPasswordManager.java](#diff-f8a8f8ba80dfc55f044e2e60b521ce379176430ca6921b0f87b79cf682531f79)
        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/R140600000XWIKI19869DataMigrationListener.java
          [R140600000XWIKI19869DataMigrationListener.java](#diff-abea939980988dd671edfc034c3005b27dd80cfbcc6aa9eafca204a856b04294)
        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/ResetPasswordMailSender.java
          [ResetPasswordMailSender.java](#diff-ea6f37f113600d1c33d439f55ddfe528ca0af02964747d8851093da2934f25e6)
      * resources

        + xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/resources/ApplicationResources.properties
          [ApplicationResources.properties](#diff-787588d681cd9223a0cfcc9a08ac2547b9f8546858111a355fe51f020f33494d)
        + META-INF

          - xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/resources/META-INF/components.txt
            [components.txt](#diff-ca52f6aba12b736ebd8e89ff8f3d116451e393ae2b38b44d2d7ceba49ce5a359)
    - test/java/org/xwiki/security/authentication/internal

      * xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManagerTest.java
        [DefaultResetPasswordManagerTest.java](#diff-47b2d87b9f0cc1a184c271c777c57256ff51a6ed0474abf9f7d44e84b4e5c659)
      * xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/R140600000XWIKI19869DataMigrationListenerTest.java
        [R140600000XWIKI19869DataMigrationListenerTest.java](#diff-564395fc0ef0fd5946bd95b1614e5e195d003b766a66c5196901b6cc55f9f0d4)
      * xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/ResetPasswordMailSenderTest.java
        [ResetPasswordMailSenderTest.java](#diff-d904f11810850e0884bef950a51a22a677283149a9048ddaea9cdc4a87eb8dae)
* xwiki-platform-tools/xwiki-platform-tool-configuration-resources/src/main/resources

  + xwiki-platform-tools/xwiki-platform-tool-configuration-resources/src/main/resources/xwiki.properties.vm
    [xwiki.properties.vm](#diff-dcbdc74dfba4049080f6ecbf5b078d266e04d4c7c48cd9cc1d266ad4590bb969)

## There are no files selected for viewing

109 changes: 109 additions & 0 deletions

109
[...nd-default/src/main/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactory.java](#diff-e2a8706c49af2249615e4f90a6f05d7fc6c7d0ddf392ae9c178c95be983ec181 "xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactory.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/443e8398b75a1295067d74afb5898370782d863a/xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,109 @@ |
|  |  | /\* |
|  |  | \* See the NOTICE file distributed with this work for additional |
|  |  | \* information regarding copyright ownership. |
|  |  | \* |
|  |  | \* This is free software; you can redistribute it and/or modify it |
|  |  | \* under the terms of the GNU Lesser General Public License as |
|  |  | \* published by the Free Software Foundation; either version 2.1 of |
|  |  | \* the License, or (at your option) any later version. |
|  |  | \* |
|  |  | \* This software is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU |
|  |  | \* Lesser General Public License for more details. |
|  |  | \* |
|  |  | \* You should have received a copy of the GNU Lesser General Public |
|  |  | \* License along with this software; if not, write to the Free |
|  |  | \* Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA |
|  |  | \* 02110-1301 USA, or see the FSF site: http://www.fsf.org. |
|  |  | \*/ |
|  |  | package org.xwiki.mail.internal.factory.text; |
|  |  |  |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import javax.inject.Inject; |
|  |  | import javax.inject.Named; |
|  |  | import javax.inject.Singleton; |
|  |  | import javax.mail.Address; |
|  |  | import javax.mail.Message; |
|  |  | import javax.mail.MessagingException; |
|  |  | import javax.mail.Multipart; |
|  |  | import javax.mail.internet.MimeMessage; |
|  |  | import javax.mail.internet.MimeMultipart; |
|  |  |  |
|  |  | import org.xwiki.component.annotation.Component; |
|  |  | import org.xwiki.mail.ExtendedMimeMessage; |
|  |  | import org.xwiki.mail.MimeBodyPartFactory; |
|  |  | import org.xwiki.mail.MimeMessageFactory; |
|  |  | import org.xwiki.mail.internal.factory.AbstractMimeMessageFactory; |
|  |  | import org.xwiki.properties.ConverterManager; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* A basic {@link MimeMessageFactory} which is taken a {@link String} as source which represents the content of the |
|  |  | \* message. |
|  |  | \* |
|  |  | \* @version $Id$ |
|  |  | \* @since 14.6RC1 |
|  |  | \* @since 14.4.3 |
|  |  | \* @since 13.10.8 |
|  |  | \*/ |
|  |  | @Component |
|  |  | @Singleton |
|  |  | @Named("text") |
|  |  | public class TextMimeMessageFactory extends AbstractMimeMessageFactory<MimeMessage> |
|  |  | { |
|  |  | @Inject |
|  |  | private ConverterManager converterManager; |
|  |  |  |
|  |  | @Inject |
|  |  | private MimeBodyPartFactory<String> mimeBodyPartFactory; |
|  |  |  |
|  |  | @Override |
|  |  | public MimeMessage createMessage(Object source, Map<String, Object> parameters) throws MessagingException |
|  |  | { |
|  |  | // This whole code has been inspired by the implementation of |
|  |  | // org.xwiki.mail.internal.factory.template.AbstractTemplateMimeMessageFactory |
|  |  |  |
|  |  | // Note: We don't create a Session here ATM since it's not required. The returned MimeMessage will be |
|  |  | // given a valid Session when it's deserialized from the mail content store for sending. |
|  |  | ExtendedMimeMessage message = new ExtendedMimeMessage(); |
|  |  |  |
|  |  | // Handle optional "from" address. |
|  |  | Address from = this.converterManager.convert(Address.class, parameters.get("from")); |
|  |  | if (from != null) { |
|  |  | message.setFrom(from); |
|  |  | } |
|  |  |  |
|  |  | // Handle optional "to", "cc" and "bcc" addresses. |
|  |  | setRecipient(message, Message.RecipientType.TO, parameters.get("to")); |
|  |  | setRecipient(message, Message.RecipientType.CC, parameters.get("cc")); |
|  |  | setRecipient(message, Message.RecipientType.BCC, parameters.get("bcc")); |
|  |  |  |
|  |  | // Handle optional "type" parameter to set the mail type |
|  |  | // Set the Message type if passed in parameters |
|  |  | String type = (String) parameters.get("type"); |
|  |  | if (type != null) { |
|  |  | message.setType(type); |
|  |  | } |
|  |  |  |
|  |  | // Handle the subject. Get it from the parameters. |
|  |  | String subject = (String) parameters.get("subject"); |
|  |  | message.setSubject(subject); |
|  |  |  |
|  |  | // Add a default body part taken from the template. |
|  |  | Multipart multipart = new MimeMultipart("mixed"); |
|  |  | multipart.addBodyPart(this.mimeBodyPartFactory.create((String) source, parameters)); |
|  |  | message.setContent(multipart); |
|  |  |  |
|  |  | return message; |
|  |  | } |
|  |  |  |
|  |  | private void setRecipient(MimeMessage message, Message.RecipientType type, Object value) |
|  |  | throws MessagingException |
|  |  | { |
|  |  | Address[] addresses = this.converterManager.convert(Address[].class, value); |
|  |  | if (addresses != null) { |
|  |  | message.setRecipients(type, addresses); |
|  |  | } |
|  |  | } |
|  |  | } |

1 change: 1 addition & 0 deletions

1
[...orm-mail-send/xwiki-platform-mail-send-default/src/main/resources/META-INF/components.txt](#diff-ed259521eed7266d86d866bbd32c81e6b5cc7b32f7d66cfa3ee7924f513ca19e "xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/resources/META-INF/components.txt")

Show comments

[View file](/xwiki/xwiki-platform/blob/443e8398b75a1295067d74afb5898370782d863a/xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/main/resources/META-INF/components.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -33,3 +33,4 @@ org.xwiki.mail.internal.factory.template.DefaultAttachmentConverter |
|  |  | org.xwiki.mail.internal.factory.files.SerializedFilesMimeMessageFactory |
|  |  | org.xwiki.mail.internal.factory.group.GroupMimeMessageFactory |
|  |  | org.xwiki.mail.internal.factory.usersandgroups.UsersAndGroupsMimeMessageFactory |
|  |  | org.xwiki.mail.internal.factory.text.TextMimeMessageFactory |

98 changes: 98 additions & 0 deletions

98
[...efault/src/test/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactoryTest.java](#diff-011de45ab3c2451fc8b12eba8e1f9d53ed05dd5321bf02d57c559c9b6aad3f4d "xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/test/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactoryTest.java")

Show comments

[View file](/xwiki/xwiki-platform/blob/443e8398b75a1295067d74afb5898370782d863a/xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-send/xwiki-platform-mail-send-default/src/test/java/org/xwiki/mail/internal/factory/text/TextMimeMessageFactoryTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,98 @@ |
|  |  | /\* |
|  |  | \* See the NOTICE file distributed with this work for additional |
|  |  | \* information regarding copyright ownership. |
|  |  | \* |
|  |  | \* This is free software; you can redistribute it and/or modify it |
|  |  | \* under the terms of the GNU Lesser General Public License as |
|  |  | \* published by the Free Software Foundation; either version 2.1 of |
|  |  | \* the License, or (at your option) any later version. |
|  |  | \* |
|  |  | \* This software is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU |
|  |  | \* Lesser General Public License for more details. |
|  |  | \* |
|  |  | \* You should have received a copy of the GNU Lesser General Public |
|  |  | \* License along with this software; if not, write to the Free |
|  |  | \* Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA |
|  |  | \* 02110-1301 USA, or see the FSF site: http://www.fsf.org. |
|  |  | \*/ |
|  |  | package org.xwiki.mail.internal.factory.text; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import javax.mail.Address; |
|  |  | import javax.mail.Message; |
|  |  | import javax.mail.MessagingException; |
|  |  | import javax.mail.Multipart; |
|  |  | import javax.mail.internet.InternetAddress; |
|  |  | import javax.mail.internet.MimeBodyPart; |
|  |  | import javax.mail.internet.MimeMessage; |
|  |  | import javax.mail.internet.MimeMultipart; |
|  |  |  |
|  |  | import org.junit.jupiter.api.Test; |
|  |  | import org.xwiki.mail.ExtendedMimeMessage; |
|  |  | import org.xwiki.mail.MimeBodyPartFactory; |
|  |  | import org.xwiki.properties.ConverterManager; |
|  |  | import org.xwiki.test.junit5.mockito.ComponentTest; |
|  |  | import org.xwiki.test.junit5.mockito.InjectMockComponents; |
|  |  | import org.xwiki.test.junit5.mockito.MockComponent; |
|  |  |  |
|  |  | import static org.junit.jupiter.api.Assertions.\*; |
|  |  | import static org.mockito.Mockito.mock; |
|  |  | import static org.mockito.Mockito.when; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Tests for {@link TextMimeMessageFactory}. |
|  |  | \* |
|  |  | \* @version $Id$ |
|  |  | \*/ |
|  |  | @ComponentTest |
|  |  | class TextMimeMessageFactoryTest |
|  |  | { |
|  |  | @InjectMockComponents |
|  |  | private TextMimeMessageFactory textMimeMessageFactory; |
|  |  |  |
|  |  | @MockComponent |
|  |  | private ConverterManager converterManager; |
|  |  |  |
|  |  | @MockComponent |
|  |  | private MimeBodyPartFactory<String> mimeBodyPartFactory; |
|  |  |  |
|  |  | @Test |
|  |  | void createMessage() throws MessagingException, IOException |
|  |  | { |
|  |  | String source = "Some mail content"; |
|  |  | Map<String, Object> parameters = new HashMap<>(); |
|  |  | parameters.put("to", "toto@xwiki.com"); |
|  |  | parameters.put("from", "admin@xwiki.com"); |
|  |  | parameters.put("type", "text"); |
|  |  | parameters.put("subject", "important email"); |
|  |  |  |
|  |  | Address from = new InternetAddress("admin@xwiki.com"); |
|  |  | Address to = new InternetAddress("toto@xwiki.com"); |
|  |  |  |
|  |  | when(this.converterManager.convert(Address[].class, "toto@xwiki.com")).thenReturn(new Address[] {to}); |
|  |  | when(this.converterManager.convert(Address.class, "admin@xwiki.com")).thenReturn(from); |
|  |  |  |
|  |  | MimeBodyPart bodyPart = mock(MimeBodyPart.class); |
|  |  | when(this.mimeBodyPartFactory.create(source, parameters)).thenReturn(bodyPart); |
|  |  |  |
|  |  | ExtendedMimeMessage expectedMessage = new ExtendedMimeMessage(); |
|  |  | expectedMessage.setFrom(from); |
|  |  | expectedMessage.setRecipient(Message.RecipientType.TO, to); |
|  |  | expectedMessage.setSubject("important email"); |
|  |  | expectedMessage.setType("text"); |
|  |  | Multipart multipart = new MimeMultipart("mixed"); |
|  |  | multipart.addBodyPart(bodyPart); |
|  |  | expectedMessage.setContent(multipart); |
|  |  |  |
|  |  | MimeMessage message = this.textMimeMessageFactory.createMessage(source, parameters); |
|  |  | assertEquals(to, message.getRecipients(Message.RecipientType.TO)[0]); |
|  |  | assertEquals(from, message.getFrom()[0]); |
|  |  | assertEquals("important email", message.getSubject()); |
|  |  | assertEquals(bodyPart, ((Multipart) message.getContent()).getBodyPart(0)); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `443e839`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fcommit%2F443e8398b75a1295067d74afb5898370782d863a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_3518ea21_20250108_124036.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19869)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19869)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-19869](/browse/XWIKI-19869)

# Password reset stores passwords in plaintext

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19869 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.6-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.6-rc-1 "14.6-rc-1 "), [13.10.8](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+13.10.8 "13.10.8 "), [14.4.3](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.4.3 "14.4.3 ")
* **Affects Version/s:**
  13.1-rc-1
* **Component/s:**
  [Authentication](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Authentication "Authentication ")
* **Labels:**
  + [attack\_dataleak](/issues/?jql=labels+%3D+attack_dataleak "attack_dataleak")
  + [attacker\_admin](/issues/?jql=labels+%3D+attacker_admin "attacker_admin")
  + [bugfixingday](/issues/?jql=labels+%3D+bugfixingday "bugfixingday")
  + [regression](/issues/?jql=labels+%3D+regression "regression")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Development Priority:**
  High
* **Difficulty:**
  Easy
* **Documentation:**
  <https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-q2hm-2h45-v5g3>
* **Documentation in Release Notes:**
  <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/14.6RC1/#HMigrationsendingemails>
* **Similar issues:**

#### Description

Tested on 14.4.1 but according to github the current state is still affected.

When the the reset password form is used the new password is stored in plaintext.

xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/main/java/org/xwiki/security/authentication/internal/DefaultResetPasswordManager.java - Line 317:

```

userXObject.setStringValue("password", newPassword);

```

After fixing this a migration will be needed to convert passwords that are currently stored in plaintext into hashes.

Furthermore, this indicates that the authentication check works against a stored plaintext password. This should not be possible.

#### Attachments

#### Issue Links

causes

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20067](/browse/XWIKI-20067)
Misleading logs suggesting that the security mails about clear passwords were not sent

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

is related to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-19945](/browse/XWIKI-19945)
Reset password and forgot username features are not working for subwiki users

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-11205](/browse/XWIKI-11205)
If view rights are not allowed for guest users then ResetPassword doesn't work

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

#### Activity

#### People

Assignee:

![surli](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Simon Urli

Reporter:

![yoksner](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Yana Oksner

Votes:
0
Vote for this issue

Watchers:
3
Start watching this issue

#### Dates

Created:

23/Jun/22 13:37

Updated:

21/Nov/22 10:31

Resolved:

08/Jul/22 14:03

Date of First Response:

24/Jun/22 9:00 AM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)



=== Content from github.com_0727a5af_20250108_124036.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-q2hm-2h45-v5g3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-q2hm-2h45-v5g3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  553](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  135](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

# Plaintext storage of password after a reset in org.xwiki.platform:xwiki-platform-security-authentication-default

Moderate

[surli](/surli)
published
GHSA-q2hm-2h45-v5g3
Nov 21, 2022

## Package

maven

org.xwiki.platform:xwiki-platform-security-authentication-default
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

> 13.1RC1

## Patched versions

14.6RC1, 13.10.8, 14.4.3

## Description

### Impact

We discovered that when the reset a forgotten password feature of XWiki was used, the password was then stored in plain text in database. This only concerns XWiki 13.1RC1 and next versions.

Note that it only concerns the reset password feature available from the "Forgot your password" link in the login view: the features allowing a user to change their password, or for an admin to change a user password are not impacted.

This vulnerability is particularly dangerous in combination with other vulnerabilities allowing to perform data leak of personal data from users, such as [GHSA-599v-w48h-rjrm](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-599v-w48h-rjrm "GHSA-599v-w48h-rjrm").

Note that this vulnerability only concerns the users of the main wiki: in case of farms, the users registered on subwiki are not impacted thanks to a bug we discovered when investigating this.

### Patches

The problem has been patched in version 14.6RC1, 14.4.3 and 13.10.8.

The patch involves a migration of the impacted users as well as the history of the page, to ensure no password remains in plain text in the database. This migration also involves to inform the users about the possible disclosure of their passwords: by default, two emails are automatically sent to the impacted users. A first email to inform about the possibility that their password have been leaked, and a second email using the reset password feature to ask them to set a new password. See below for the configuration options to disable the mail sending.

The first email contains by default the following text (could be translated depending on the wiki language settings):

```
Subject: Important security issue
Dear user,

due to a bug your password was stored in plain text in our wiki. We cannot exclude that your plain text password was exposed in a data leak. Therefore, you might receive a second email to choose a new password.
Please contact the administrator in case of problem or for further questions.

```

It's possible to specify another text by creating a file at the root of the permanent directory named `140600000XWIKI19869-mail.txt`, this file should have same structure as used above:

```
Subject: [your custom subject]
[your custom mail content]

```

This mail is sent plain text and cannot contain any variable.

Note that the second mail for the reset password is using the standard feature, so you can find information about the email templates [there](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Authentication/#HMailTemplates).

Also note that if the users doesn't have any registered email address obviously no mail will be sent, so it's the administrators responsibility to find a way to contact the user (through comment on the user profile, or any other channel used for that wiki). The administrator should be particularly careful on the presence of logs such as:

```
WARN  WIKI19869DataMigrationListener - Reset email cannot be sent for user [reference = [xwiki:XWiki.Foo]] as no email address is provided

```

It's also possible for administrators to set some properties for the migration: it's possible to decide if the user password should be reset (default) or if the passwords should be kept but only hashed. Note that in the first option, the users won't be able to login anymore until they set a new password if they were impacted. Note that in both options, mails will be sent to users to inform them and encourage them to change their passwords.

Two other properties are available to chose the behaviour regarding the mails to be sent: it's possible to chose to only send the first security email, or to only send the reset password email. It's important to note that those emails are sent after the migration during the initialization of the wiki, by reading a file creating by the migration in the permanent directory (the file is named `140600000XWIKI19869DataMigration-users.txt`): then it's possible for an administrator to chose to not sent any email when the migration is performed (by setting the properties to false), and to send them later in a future restart by then setting back the properties to true before the restart of the wiki. Also note that the file is deleted after the mails are sent.

The mentioned properties can be found in `xwiki.properties` in the `[Security]` section:

```
#-# [Since 14.6RC1]
#-# [Since 14.4.3]
#-# [Since 13.10.8]
#-# This option is only used when performing a migration from a wiki before the versions mentioning above.
#-# This parameter defines if as part of the migration R140600000XWIKI19869 the passwords of impacted user should be
#-# reset or not. It's advised to keep this value as true, now for some usecases advertised administrators might want
#-# their users to keep their passwords nevertheless, then enable the configuration and set it to false before the
#-# migration is executed.
# security.migration.R140600000XWIKI19869.resetPassword = true

#-# [Since 14.6RC1]
#-# [Since 14.4.3]
#-# [Since 13.10.8]
#-# This option is only used when performing a migration from a wiki before the versions mentioned above.
#-#
#-# This parameter defines if reset password emails should be sent as part of the migration R140600000XWIKI19869.
#-# By default this value is set to true, so emails will be automatically produced. Now it's possible for admin to set
#-# this option to false: note that in such case a file containing the list of users for whom a reset password email
#-# should be sent will still be created in the permanent directory (named 140600000XWIKI19869DataMigration-users.txt).
#-# If this file exists and this property is set back to true after the migration, the file will still be consumed to
#-# send the emails, so it's possible to perform the migration and send the emails only later if needed.
# security.migration.R140600000XWIKI19869.sendResetPasswordEmail = true

#-# [Since 14.6RC1]
#-# [Since 14.4.3]
#-# [Since 13.10.8]
#-# This option is only used when performing a migration from a wiki before the versions mentioned above.
#-#
#-# This parameter defines if a security email information should be sent as part of the migration R140600000XWIKI19869.
#-# By default this value is set to true, so emails will be automatically produced. Now it's possible for admin to set
#-# this option to false: note that in such case a file containing the list of users for whom a reset password email
#-# should be sent will still be created in the permanent directory (named 140600000XWIKI19869DataMigration-users.txt).
#-# If this file exists and this property is set back to true after the migration, the file will still be consumed to
#-# send the emails, so it's possible to perform the migration and send the emails only later if needed.
# security.migration.R140600000XWIKI19869.sendSecurityEmail = true

```
### Workarounds

There is actually 2 parts of the vulnerability:

1. users who might have use the reset feature should get their password protected. We provide some instructions how to identify and fix those.
2. the next usage of the reset password feature shouldn't lead to plain text password: sadly there is no easy workaround for that, except by recompiling `xwiki-platform-security-authentication-default` with that change: [443e839#diff-f8a8f8ba80dfc55f044e2e60b521ce379176430ca6921b0f87b79cf682531f79L322](https://github.com/xwiki/xwiki-platform/commit/443e8398b75a1295067d74afb5898370782d863a#diff-f8a8f8ba80dfc55f044e2e60b521ce379176430ca6921b0f87b79cf682531f79L322)

It's possible to identify all impacted users and to manually reset their passwords with an Admin account. For identifying the impacted users, a query such as the following is possible:

```
{{velocity}}
## The statement is put on multiple lines for readability of the snippet
#set ($statement = "select distinct doc.fullName from Document doc, doc.object(XWiki.XWikiUsers) objUser
where objUser.password not like 'hash:%' and objUser.password <> ''
order by doc.fullName")
$services.query.xwql($statement).execute()
{{/velocity}}

```

Once impacted users are identified at least 2 options are possible:

1. Set a new password (manually by going to the user profile, or automatically with a groovy script for example)
2. rollback to a previous version of the user document: in such case the password will be automatically processed properly

Be aware that those workarounds won't remove the clear password entry that might remain in database due to history.

### References

* Jira ticket: <https://jira.xwiki.org/browse/XWIKI-19869>
* Advisory of a data leak vulnerability that increases the criticality of this vulnerability: [GHSA-599v-w48h-rjrm](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-599v-w48h-rjrm "GHSA-599v-w48h-rjrm")
* Bug discovered "protecting" subwiki from this vulnerability: <https://jira.xwiki.org/browse/XWIKI-19945>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [Jira](https://jira.xwiki.org)
* Email us at security ML

### Severity

Moderate

6.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
Required

Scope
Changed

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:N/A:N

### CVE ID

CVE-2022-41933

### Weaknesses

[CWE-256](/advisories?query=cwe%3A256)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9f720603_20250108_124036.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-599v-w48h-rjrm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxwiki%2Fxwiki-platform%2Fsecurity%2Fadvisories%2FGHSA-599v-w48h-rjrm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xwiki%2Fxwiki-platform)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xwiki](/xwiki)
/
**[xwiki-platform](/xwiki/xwiki-platform)**
Public

* [Notifications](/login?return_to=%2Fxwiki%2Fxwiki-platform) You must be signed in to change notification settings
* [Fork
  553](/login?return_to=%2Fxwiki%2Fxwiki-platform)
* [Star
   1k](/login?return_to=%2Fxwiki%2Fxwiki-platform)

* [Code](/xwiki/xwiki-platform)
* [Pull requests
  135](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects
  0](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

Additional navigation options

* [Code](/xwiki/xwiki-platform)
* [Pull requests](/xwiki/xwiki-platform/pulls)
* [Actions](/xwiki/xwiki-platform/actions)
* [Projects](/xwiki/xwiki-platform/projects)
* [Security](/xwiki/xwiki-platform/security)
* [Insights](/xwiki/xwiki-platform/pulse)

# Missing Authorization and Exposure of Private Personal Information to an Unauthorized Actor in org.xwiki.platform:xwiki-platform-web-templates

High

[surli](/surli)
published
GHSA-599v-w48h-rjrm
Sep 8, 2022

## Package

maven

org.xwiki.platform:xwiki-platform-web
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

>= 1.3

## Patched versions

13.10.4, 14.2

maven

org.xwiki.platform:xwiki-platform-web-templates
([Maven](/advisories?query=ecosystem%3Amaven))

< 13.10.4, < 14.2

13.10.4, 14.2

## Description

### Impact

Through the suggestion feature, string and list properties of objects the user shouldn't have access to can be accessed. This includes private personal information like email addresses and salted password hashes of registered users but also other information stored in properties of objects. Sensitive configuration fields like passwords for LDAP or SMTP servers could be accessed. By exploiting an additional vulnerability, this issue can even be exploited on [private wikis](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Access%20Rights/#HPrivateWiki) at least for string properties.

### Patches

The issue is patched in version 13.10.4 and 14.2. Password properties are no longer displayed and rights are checked for other properties.

### Workarounds

The template file `suggest.vm` can be replaced by a patched version without upgrading or restarting XWiki unless it has been [overridden](https://extensions.xwiki.org/xwiki/bin/view/Extension/Skin%20Application#HHowtooverrideatemplate), in which case the overridden template should be patched, too. This might need adjustments for older versions, though.

### References

* <https://jira.xwiki.org/browse/XWIKI-18849>

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [Jira XWiki.org](https://jira.xwiki.org)
* Email us at security mailing-list

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2022-36091

### Weaknesses

[CWE-359](/advisories?query=cwe%3A359) [CWE-862](/advisories?query=cwe%3A862)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jira.xwiki.org_397a9bf3_20250108_124037.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19945)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoading…[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19945)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-19945](/browse/XWIKI-19945)

# Reset password and forgot username features are not working for subwiki users

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-19945 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Duplicate
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  None
* **Affects Version/s:**
  13.1-rc-1
* **Component/s:**
  [Authentication](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+Authentication "Authentication ")
* **Labels:**
  + [regression](/issues/?jql=labels+%3D+regression "regression")

* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

Reproduction steps:

* Create a subwiki with "local and global users" (or local users only)
* Create a user on that subwiki with an email address
* Go to the login page of the wiki and click on "forgot password"
* Insert the username of the user and submit the form

Expected result:

* a mail is sent to perform the reset password operation

Obtained result:

* no mail is sent at all

Note that the process works if the entered user is a main wiki user even accessed from subwiki. The root cause of the bug is that the form is accessed using this kind of URL:

<http://localhost:8080/xwiki/authenticate/reset> which doesn't provide any information about the subwiki.

#### Attachments

#### Issue Links

duplicates

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-19591](/browse/XWIKI-19591)
Local users of subwikis can't recover password or username

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

is caused by

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-11205](/browse/XWIKI-11205)
If view rights are not allowed for guest users then ResetPassword doesn't work

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

relates to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-19869](/browse/XWIKI-19869)
Password reset stores passwords in plaintext

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

#### Activity

#### People

Assignee:

![surli](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Simon Urli

Reporter:

![surli](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Simon Urli

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

07/Jul/22 14:49

Updated:

07/Jul/22 15:34

Resolved:

07/Jul/22 15:34

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)


