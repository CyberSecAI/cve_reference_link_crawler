The provided content relates to CVE-2024-26865.

**Root cause of vulnerability:**
The root cause is a use-after-free vulnerability in the Linux kernel's networking subsystem related to the Reliable Datagram Sockets (RDS) over TCP implementation, specifically in the `reqsk_timer_handler()` function. The issue arises due to incorrect handling of network namespace (netns) teardown when using kernel sockets.

**Weaknesses/vulnerabilities present:**
- **Use-After-Free (UAF):** The primary vulnerability is a use-after-free. A request socket (`reqsk`) timer handler attempts to access the network namespace structure (`net`) after it has been freed. This occurs because the request socket timer doesn't properly account for the lifecycle of the associated network namespace.
- **Incorrect Refcounting:** The `reqsk` assumes the listener guarantees netns safety until all `reqsk` timers expire by holding the listener's refcount, but this wasn't the case for kernel sockets.

**Impact of exploitation:**
- **Kernel crash:** The use-after-free leads to a kernel panic due to memory corruption when the kernel attempts to access freed memory. The provided logs clearly show KASAN (Kernel Address Sanitizer) detecting the issue and triggering a BUG report, which includes a stack trace.
- **Denial of Service (DoS):** A successful exploit would lead to a kernel crash, causing a denial of service.

**Attack vectors:**
1. **Create a new network namespace:** The attacker starts by using `unshare(CLONE_NEWNET)` to create a new network namespace, which will create a per-netns TCP listener in `rds_tcp_listen_init()`.
2. **Connect to the listener:** An attacker would create a socket that connects to the RDS listener in the newly created namespace using a `connect()` call. This creates a `reqsk`.
3. **Exit the network namespace:** The attacker exits the network namespace using `exit()`.
4. **Trigger the timer:** This triggers the `reqsk` timer, causing the `reqsk_timer_handler` function to run, attempting to use the freed `net` structure, thus causing a use-after-free.

**Required attacker capabilities/position:**
- **System call access:** The attacker must be able to make system calls such as `socket()`, `connect()`, `unshare()`, and `exit()`. This indicates the attacker needs to be able to execute code on the system.
- **Knowledge of RDS protocol:** While not explicit, the attack involves using the RDS-TCP socket, which implies some knowledge of the RDS protocol.
- **Ability to create network namespaces**: This requires `CAP_SYS_ADMIN` capabilities.

**Additional details:**
- The provided content includes detailed kernel logs showing the crash and the memory corruption.
- The fix involves applying the same cleanup mechanism as was previously done for the per-netns ehash to the global ehash, ensuring that the kernel request sockets associated with the listener are properly cleaned up when the network namespace is destroyed. The fix also addresses a reference counting issue.
- The bug is triggered in the timer handler for request sockets, which are created during connection establishment.
- The vulnerability was found by the syzkaller fuzzer.