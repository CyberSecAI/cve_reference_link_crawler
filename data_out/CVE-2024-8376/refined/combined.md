=== Content from gitlab.eclipse.org_c86877a2_20250111_030202.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Mosquitto: Use after free on mosquitto\_acl\_check

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

## What are the affected versions?

2.0.18

We have not checked previous versions.

## Details of the issue

We have found a heap-use-after-free vulnerability on Mosquitto 2.0.18 which occurs on src/security.c:688:15 (at function 'mosquitto\_acl\_check').

This vulnerability can be triggered by sending a specific sequence of the following packets:

CONNECT

SUBSCRIBE

UNSUBSCRIBE

DISCONNECT

CONNECT

PUBLISH

We attach the ASan stack trace of the vulnerability as well as the hex-encoded bytes of the packets ("%x" is used as a hex prefix).

## Steps to reproduce

Run the attached `replay_mqtt_finding.py` script against a Mosquitto 2.0.18 broker which has been instrumented with ASan (AddressSanitizer).

## Do you know any mitigations of the issue?

No.

## Credit request

If you assign a CVE, is it possible to register the requested CVE with our names and organization name? We are Roman Kraus, Steffen Lüdtke, Martin Schneider and Ramon Barakat of Fraunhofer FOKUS.

Best regards,

Roman Kraus

[acl\_check\_uaf.zip](/-/project/3804/uploads/740dab1c631f7eed28eebb760a160e95/acl_check_uaf.zip)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)



=== Content from mosquitto.org_039bdd35_20250111_030203.html ===

[![Mosquitto: An Open Source MQTT Server](images/mosquitto-text-side-28.png)](https://mosquitto.org/)
[![The Eclipse Foundation](images/eclipse_logo_colour.png)](https://eclipse.org/)
[![Cedalo Gmbh](images/cedalo.png)](https://cedalo.com/mqtt-broker-pro-mosquitto)

[Home](.)
[Blog](blog/)
[Download](download/)
Documentation
[All](documentation/)
[Roadmap](roadmap/)
[API](api/)
[libmosquitto](man/libmosquitto-3.html)
[mosquitto](man/mosquitto-8.html)
[mosquitto.conf](man/mosquitto-conf-5.html)
[mosquitto\_ctrl](man/mosquitto_ctrl-1.html)
[mosquitto\_ctrl\_dynsec](man/mosquitto_ctrl_dynsec-1.html)
[mosquitto\_passwd](man/mosquitto_passwd-1.html)
[mosquitto\_pub](man/mosquitto_pub-1.html)
[mosquitto\_rr](man/mosquitto_rr-1.html)
[mosquitto\_sub](man/mosquitto_sub-1.html)
[mosquitto-tls](man/mosquitto-tls-7.html)
[mqtt](man/mqtt-7.html)

---

# Eclipse Mosquittoâ¢

## An open source MQTT broker

---

Eclipse Mosquitto is an open source (EPL/EDL licensed) message broker that
implements the MQTT protocol versions 5.0, 3.1.1 and 3.1. Mosquitto
is lightweight and is suitable for use on all devices from low
power single board computers to full servers.

The MQTT protocol provides a lightweight method of carrying
out messaging using a publish/subscribe model. This makes it
suitable for Internet of Things messaging such as with low
power sensors or mobile devices such as phones, embedded
computers or microcontrollers.

The Mosquitto project also provides a C library for
implementing MQTT clients, and the very popular mosquitto\_pub
and mosquitto\_sub command line MQTT clients.

Mosquitto is part of the [Eclipse
Foundation](https://eclipse.org/), and is an [iot.eclipse.org](https://iot.eclipse.org/)
project. The development is driven by [Cedalo](https://cedalo.com/mqtt-broker-pro-mosquitto/).

---

## Download and Security

Mosquitto is highly portable and available for a wide range of
platforms. Go to the dedicated [download
page](download) to find the source or binaries for your platform.

Read the [Change Log](ChangeLog.txt) to find out
about recent releases.

Use the <security> page to find out
how to report vulnerabilities or responses to past security
issues.

## Test

You can have your own instance of Mosquitto running in
minutes, but to make testing even easier, the Mosquitto Project
runs a test server at
[test.mosquitto.org](https://test.mosquitto.org/) where
you can test your clients in a variety of ways: plain MQTT,
MQTT over TLS, MQTT over TLS (with
[client certificate](https://test.mosquitto.org/ssl/)),
MQTT over WebSockets and MQTT over WebSockets with TLS.

Alternatively, Cedalo offers a free 14-day cloud trial or a
30-day on-premises trial with basic HA configuration. [Sign
up for a trial instance here.](https://cedalo.com/mqtt-broker-pro-mosquitto/trial-signup/)

## Community

* Report bugs or submit changes on the [Github repository](https://github.com/eclipse/mosquitto)
* Talk to other users on the [Mosquitto mailing list](https://dev.eclipse.org/mailman/listinfo/mosquitto-dev)
  or on [Slack](https://eclipse-iot-wg.slack.com/join/shared_invite/zt-d8zil9s0-NF5UHh92Odf3AbonspswHA#/).
* Get help from the [forums](https://forum.cedalo.com/).
* [Cite Mosquitto](2017/06/citing-eclipse-mosquitto/) in your academic work.

## Support

Support is always available from the community channels on a
best effort basis. If you require commercial support,
[Cedalo](https://cedalo.com/mqtt-broker-pro-mosquitto/) can offer support for hosted
or on-premise instances, consulting on the use of Mosquitto,
and custom development to your needs.

Cedalo provides Mosquitto users with tailored professional
support. It includes early access to the latest patches & bug
fixes. Learn more about the [support
service here.](https://cedalo.com/open-source-mosquitto-support/%22%22)

## Training

Learn more about MQTT with Cedaloâs [MQTT Academy](https://cedalo.com/mqtt-academy/). It is
completely free, and it is designed for beginners and
experienced professionals.

The courses cover everything from the basics of MQTT to more
advanced topics like Quality of Service (QoS) levels. [Sign up
here!](https://mqtt-academy.cedalo.com/) Remember to give some feedback.

## Related Projects

[Paho](https://eclipse.org/paho/) provides MQTT
client library implementations in a wide variety of
languages.

[Streamsheets](https://eclipse.org/streamsheets/) is an
easy to use web based real time spreadsheet interface that can
be used to process incoming data from a variety of sources,
such as MQTT, OPC-UA, and REST. Developers and non-developers
can use Streamsheets to control processes and build dashboards,
for example. Mosquitto is a core component of Streamsheets.

[Eclipse Home](http://www.eclipse.org)
[Market Place](http://marketplace.eclipse.org/)
[Eclipse Planet](http://www.planeteclipse.org/)
[Eclipse Security](https://eclipse.org/security/)
[Privacy Policy](http://www.eclipse.org/legal/privacy.php)
[Terms of Use](http://www.eclipse.org/legal/termsofuse.php)
[Copyright Agent](http://www.eclipse.org/legal/copyright.php)
[Legal](http://www.eclipse.org/legal/)



=== Content from gitlab.eclipse.org_3f701d02_20250111_030201.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Memory leaking in Eclipse Mosquitto

The Eclipse Foundation is a [Common Vulnerabilities and Exposures](https://cve.mitre.org/) (CVE) Numbering Authority. This issue it used to request and track the progress of the assignment of a CVE for a vulnerability in the project code for an Eclipse open source project.

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

**Request type:** publication

**Versions affected:** [TBD, 2.0.18a]

**Common Weakness Enumeration:**

* {[CWE-401: Missing Release of Memory after Effective Lifetime](https://cwe.mitre.org/data/definitions/401.html)}
* {[CWE-416: Use After Free](https://cwe.mitre.org/data/definitions/416.html)}
* {[CWE-248: Uncaught Exception](https://cwe.mitre.org/data/definitions/248.html)}

**Common Vulnerability Scoring System:** {[CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:L/VA:H/SC:H/SI:L/SA:H/E:P](https://nvd.nist.gov/vuln-metrics/cvss/v4-calculator?vector=AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:L/VA:H/SC:H/SI:L/SA:H/E:P)}

**Summary:**

In Eclipse Mosquitto up to version 2.0.18a, an attacker can achieve memory leaking, segmentation fault or heap-use-after-free by sending specific sequences of "CONNECT", "DISCONNECT", "SUBSCRIBE", "UNSUBSCRIBE" and "PUBLISH" packets.

**Credits:**

* Roman Kraus (Fraunhofer FOKUS)
* Steffen Lüdtke (Fraunhofer FOKUS)
* Martin Schneider (Fraunhofer FOKUS)
* Ramon Barakat (Fraunhofer FOKUS)

**Links:**

* {primary resolution link}

Edited Oct 02, 2024 by [Tiago Lucas](/tiagolucas)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)



=== Content from github.com_80913ab5_20250111_030201.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-mosquitto%2Fmosquitto%2Freleases%2Ftag%2Fv2.0.19)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-mosquitto%2Fmosquitto%2Freleases%2Ftag%2Fv2.0.19)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=eclipse-mosquitto%2Fmosquitto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[eclipse-mosquitto](/eclipse-mosquitto)
/
**[mosquitto](/eclipse-mosquitto/mosquitto)**
Public

* [Notifications](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto)
* [Star
   9.3k](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto)

* [Code](/eclipse-mosquitto/mosquitto/tree/v2.0.19)
* [Issues
  747](/eclipse-mosquitto/mosquitto/issues)
* [Pull requests
  87](/eclipse-mosquitto/mosquitto/pulls)
* [Actions](/eclipse-mosquitto/mosquitto/actions)
* [Projects
  0](/eclipse-mosquitto/mosquitto/projects)
* [Security](/eclipse-mosquitto/mosquitto/security)
* [Insights](/eclipse-mosquitto/mosquitto/pulse)

Additional navigation options

* [Code](/eclipse-mosquitto/mosquitto/tree/v2.0.19)
* [Issues](/eclipse-mosquitto/mosquitto/issues)
* [Pull requests](/eclipse-mosquitto/mosquitto/pulls)
* [Actions](/eclipse-mosquitto/mosquitto/actions)
* [Projects](/eclipse-mosquitto/mosquitto/projects)
* [Security](/eclipse-mosquitto/mosquitto/security)
* [Insights](/eclipse-mosquitto/mosquitto/pulse)

[Releases](/eclipse-mosquitto/mosquitto/releases)
[Tags](/eclipse-mosquitto/mosquitto/tags)

# v2.0.19

* [v2.0.19](/eclipse-mosquitto/mosquitto/tree/v2.0.19)
* [`5eb40ee`](/eclipse-mosquitto/mosquitto/commit/5eb40ee3d691fb3c2dc222685e7ffcf6e6a69a79)
* Verified

  # Verified

  This tag was signed with the committer’s **verified signature**.
  The key has expired.

  [![](https://avatars.githubusercontent.com/u/79578?s=64&v=4)](/ralight)
  [ralight](/ralight)
  Roger Light

  GPG key ID: 779B22DFB3E717B7
  Expired

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/eclipse-mosquitto/mosquitto/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.0.19)

   Loading

  [View all tags](/eclipse-mosquitto/mosquitto/tags)

[v2.0.19](/eclipse-mosquitto/mosquitto/releases/tag/v2.0.19)

* [v2.0.19](/eclipse-mosquitto/mosquitto/tree/v2.0.19)
* [`5eb40ee`](/eclipse-mosquitto/mosquitto/commit/5eb40ee3d691fb3c2dc222685e7ffcf6e6a69a79)
* Compare

  Choose a tag to compare

  Could not load tags

  Nothing to show

  [{{ refName }}
  default](/eclipse-mosquitto/mosquitto/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v2.0.19)

   Loading

  [View all tags](/eclipse-mosquitto/mosquitto/tags)
* Verified

  # Verified

  This tag was signed with the committer’s **verified signature**.
  The key has expired.

  [![](https://avatars.githubusercontent.com/u/79578?s=64&v=4)](/ralight)
  [ralight](/ralight)
  Roger Light

  GPG key ID: 779B22DFB3E717B7
  Expired

  [Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

![@ralight](https://avatars.githubusercontent.com/u/79578?s=40&v=4)

```
Version 2.0.19
```

 Assets
2

 Loading

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from gitlab.eclipse.org_976af722_20250111_030203.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Mosquitto: Memory leaks

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

## What are the affected versions?

2.0.18

We have not checked previous versions.

## Details of the issue

We have found memory leaks on Mosquitto 2.0.18.

This vulnerability can be triggered by sending a specific sequence of the following packets:

CONNECT

SUBSCRIBE

UNSUBSCRIBE

We attach the ASan stack trace of the vulnerability as well as the hex-encoded bytes of the packets ("%x" is used as a hex prefix).

## Steps to reproduce

Run the attached `replay_mqtt_finding.py` script against a Mosquitto 2.0.18 broker which has been instrumented with ASan (AddressSanitizer).

## Do you know any mitigations of the issue?

No.

## Credit request

If you assign a CVE, is it possible to register the requested CVE with our names and organization name? We are Roman Kraus, Steffen Lüdtke, Martin Schneider and Ramon Barakat of Fraunhofer FOKUS.

Best regards,

Roman Kraus

[mosquitto\_memory\_leaks.zip](/-/project/3804/uploads/0c814be13cdcb0c882aff34ed9548da2/mosquitto_memory_leaks.zip)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)



=== Content from gitlab.eclipse.org_e11189ba_20250111_030203.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Mosquitto: Segmentation fault on db\_\_message\_insert

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

## What are the affected versions?

2.0.18

We have not checked previous versions.

However, the current `develop` branch of Mosquitto is also vulnerable to this attack.

## Details of the issue

We have found a segmentation fault on Mosquitto 2.0.18 which occurs on src/database.c:581 (at function 'db\_\_message\_insert').

This vulnerability can be triggered by sending a specific sequence of the following packets:

CONNECT

PUBLISH

CONNECT

SUBSCRIBE

SUBSCRIBE

DISCONNECT

CONNECT

CONNECT

SUBSCRIBE

UNSUBSCRIBE

DISCONNECT

CONNECT

SUBSCRIBE

The order in which connections are closed seems to play a role. Particularly, it seems that the first connection has to be closed last.

We attach the Mosquitto output, the gbd backtrace and the hex-encoded bytes of the packets ("%x" is used as a hex prefix).

## Steps to reproduce

Run the attached `replay_mqtt_finding.py` script against a Mosquitto 2.0.18 broker. It seems to be important that the broker is **not** instrumented with ASan (AddressSanitizer). Otherwise, we could not observe this error. We also want to mention that the reproduction can be flaky. Thus, you might need some attempts. However, the reproduction script we attach here was quite reliable for us.

## Do you know any mitigations of the issue?

No.

## Credit request

If you assign a CVE, is it possible to register the requested CVE with our names and organization name? We are Roman Kraus, Steffen Lüdtke, Martin Schneider and Ramon Barakat of Fraunhofer FOKUS.

Best regards,

Roman Kraus

[mosquitto\_segfault.zip](/-/project/3804/uploads/c8a43a25b4bc9d431dfe9df5e3f9c40b/mosquitto_segfault.zip)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)



=== Content from gitlab.eclipse.org_5f792ec1_20250111_030202.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Mosquitto: Use after free on sub\_\_add\_leaf

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

## What are the affected versions?

2.0.18

We have not checked previous versions.

## Details of the issue

We have found a heap-use-after-free vulnerability on Mosquitto 2.0.18 which occurs on src/subs.c:165:38 (at function 'sub\_\_add\_leaf').

This vulnerability can be triggered by sending a specific sequence of the following packets:

CONNECT

SUBSCRIBE

UNSUBSCRIBE

DISCONNECT

CONNECT

SUBSCRIBE

We attach the ASan stack trace of the vulnerability as well as the hex-encoded bytes of the packets ("%x" is used as a hex prefix).

## Steps to reproduce

Run the attached `replay_mqtt_finding.py` script against a Mosquitto 2.0.18 broker which has been instrumented with ASan (AddressSanitizer).

## Do you know any mitigations of the issue?

No.

## Credit request

If you assign a CVE, is it possible to register the requested CVE with our names and organization name? We are Roman Kraus, Steffen Lüdtke, Martin Schneider and Ramon Barakat of Fraunhofer FOKUS.

Best regards,

Roman Kraus

[shared\_sub\_uaf.zip](/-/project/3804/uploads/06b30821ce273a727b8ef92a5c9808b1/shared_sub_uaf.zip)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)



=== Content from github.com_0627821f_20250111_030200.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-mosquitto%2Fmosquitto%2Fcommit%2F1914b3ee2a18102d0a94cbdbbfeae1afa03edd17)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-mosquitto%2Fmosquitto%2Fcommit%2F1914b3ee2a18102d0a94cbdbbfeae1afa03edd17)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=eclipse-mosquitto%2Fmosquitto)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[eclipse-mosquitto](/eclipse-mosquitto)
/
**[mosquitto](/eclipse-mosquitto/mosquitto)**
Public

* [Notifications](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto)
* [Star
   9.3k](/login?return_to=%2Feclipse-mosquitto%2Fmosquitto)

* [Code](/eclipse-mosquitto/mosquitto)
* [Issues
  747](/eclipse-mosquitto/mosquitto/issues)
* [Pull requests
  87](/eclipse-mosquitto/mosquitto/pulls)
* [Actions](/eclipse-mosquitto/mosquitto/actions)
* [Projects
  0](/eclipse-mosquitto/mosquitto/projects)
* [Security](/eclipse-mosquitto/mosquitto/security)
* [Insights](/eclipse-mosquitto/mosquitto/pulse)

Additional navigation options

* [Code](/eclipse-mosquitto/mosquitto)
* [Issues](/eclipse-mosquitto/mosquitto/issues)
* [Pull requests](/eclipse-mosquitto/mosquitto/pulls)
* [Actions](/eclipse-mosquitto/mosquitto/actions)
* [Projects](/eclipse-mosquitto/mosquitto/projects)
* [Security](/eclipse-mosquitto/mosquitto/security)
* [Insights](/eclipse-mosquitto/mosquitto/pulse)

## Commit

[Permalink](/eclipse-mosquitto/mosquitto/commit/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Use separate trees for shared/normal subs

[Browse files](/eclipse-mosquitto/mosquitto/tree/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17)
Browse the repository at this point in the history

```
Fixes Eclipse [#217](https://github.com/eclipse-mosquitto/mosquitto/pull/217), [#218](https://github.com/eclipse-mosquitto/mosquitto/pull/218).
```

* Loading branch information

[![@ralight](https://avatars.githubusercontent.com/u/79578?s=40&v=4)](/ralight)

[ralight](/eclipse-mosquitto/mosquitto/commits?author=ralight "View all commits by ralight")
committed
Oct 2, 2024

1 parent
[3bb6c9a](/eclipse-mosquitto/mosquitto/commit/3bb6c9ad51f712864dea63529e0b55661c2a9e84)

commit 1914b3e

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**95 additions**
and
**20 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ChangeLog.txt
  [ChangeLog.txt](#diff-0f921eda741b33546cece2f7869409c946c019c3b0dc5b065f1cff7fab614a00)
* src

  + src/database.c
    [database.c](#diff-47e508fb16508f30ccdaf0a02b29a83833f5071ab7548c2a0e89fc34f693c49d)
  + src/loop.c
    [loop.c](#diff-a153e24e283f88e72b130ffed4221a887310cd1e483871c5aab4c577d9f8da26)
  + src/mosquitto\_broker\_internal.h
    [mosquitto\_broker\_internal.h](#diff-b7f6a13b903b70b7039fd0021a4feb52d8f5afbe3879487b3d6312d2e4efea92)
  + src/persist\_write.c
    [persist\_write.c](#diff-14d80f95aeca35e110932910677b559238aa23dd69d7459d8447dac541e60ae7)
  + src/subs.c
    [subs.c](#diff-f6993b97aedd5fd63ccda05b57aee9d218c6a9a0a89431d064a67acda9a264b3)
* test

  + broker

    - data

      * test/broker/data/REGRESSION.json
        [REGRESSION.json](#diff-2fa653babcec70efd6cd9d6bda93736112cd885a08fc1a4ea3af2f6a9bfe996e)
    - test/broker/msg\_sequence\_test.py
      [msg\_sequence\_test.py](#diff-79d2503c7dac870818a3437c811c86847d70c48e393cf5957cbb3736c498c059)
  + unit

    - test/unit/subs\_test.c
      [subs\_test.c](#diff-3466e24a0b6bfa498b2273fc2ef0079355b73720c9e2ddf3088c6d6d82c5efe6)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[ChangeLog.txt](#diff-0f921eda741b33546cece2f7869409c946c019c3b0dc5b065f1cff7fab614a00 "ChangeLog.txt")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/ChangeLog.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,12 +1,16 @@ |
|  |  | 2.0.19 - 2024-09-xx |
|  |  | =================== |
|  |  |  |
|  |  | Security: |
|  |  | - Fix mismatched subscribe/unsubscribe with normal/shared topics. |
|  |  |  |
|  |  | Broker: |
|  |  | - Fix assert failure when loading a persistence file that contains |
|  |  | subscriptions with no client id. |
|  |  | - Fix local bridges being incorrectly expired when |
|  |  | persistent\_client\_expiration is in use. |
|  |  | - Fix use of CLOCK\_BOOTTIME for getting time. Closes #3089. |
|  |  | - Fix mismatched subscribe/unsubscribe with normal/shared topics. |
|  |  |  |
|  |  | Library: |
|  |  | - Fix some error codes being converted to string as "unknown". Closes #2579. |
| Expand Down | |  |

13 changes: 9 additions & 4 deletions

13
[src/database.c](#diff-47e508fb16508f30ccdaf0a02b29a83833f5071ab7548c2a0e89fc34f693c49d "src/database.c")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/src/database.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -199,12 +199,16 @@ int db\_\_open(struct mosquitto\_\_config \*config) |
|  |  | /\* Initialize the hashtable \*/ |
|  |  | db.clientid\_index\_hash = NULL; |
|  |  |  |
|  |  | db.subs = NULL; |
|  |  | db.normal\_subs = NULL; |
|  |  | db.shared\_subs = NULL; |
|  |  |  |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.subs, "", 0); |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.shared\_subs, "", 0); |
|  |  | if(!subhier) return MOSQ\_ERR\_NOMEM; |
|  |  |  |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.subs, "$SYS", (uint16\_t)strlen("$SYS")); |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.normal\_subs, "", 0); |
|  |  | if(!subhier) return MOSQ\_ERR\_NOMEM; |
|  |  |  |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.normal\_subs, "$SYS", (uint16\_t)strlen("$SYS")); |
|  |  | if(!subhier) return MOSQ\_ERR\_NOMEM; |
|  |  |  |
|  |  | retain\_\_init(); |
| Expand Down  Expand Up | | @@ -240,7 +244,8 @@ static void subhier\_clean(struct mosquitto\_\_subhier \*\*subhier) |
|  |  |  |
|  |  | int db\_\_close(void) |
|  |  | { |
|  |  | subhier\_clean(&db.subs); |
|  |  | subhier\_clean(&db.normal\_subs); |
|  |  | subhier\_clean(&db.shared\_subs); |
|  |  | retain\_\_clean(&db.retains); |
|  |  | db\_\_msg\_store\_clean(); |
|  |  |  |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[src/loop.c](#diff-a153e24e283f88e72b130ffed4221a887310cd1e483871c5aab4c577d9f8da26 "src/loop.c")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/src/loop.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -240,7 +240,8 @@ int mosquitto\_main\_loop(struct mosquitto\_\_listener\_sock \*listensock, int listens |
|  |  | flag\_reload = false; |
|  |  | } |
|  |  | if(flag\_tree\_print){ |
|  |  | sub\_\_tree\_print(db.subs, 0); |
|  |  | sub\_\_tree\_print(db.normal\_subs, 0); |
|  |  | sub\_\_tree\_print(db.shared\_subs, 0); |
|  |  | flag\_tree\_print = false; |
|  |  | #ifdef WITH\_XTREPORT |
|  |  | xtreport(); |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[src/mosquitto\_broker\_internal.h](#diff-b7f6a13b903b70b7039fd0021a4feb52d8f5afbe3879487b3d6312d2e4efea92 "src/mosquitto_broker_internal.h")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/src/mosquitto_broker_internal.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -442,7 +442,8 @@ struct mosquitto\_message\_v5{ |
|  |  |  |
|  |  | struct mosquitto\_db{ |
|  |  | dbid\_t last\_db\_id; |
|  |  | struct mosquitto\_\_subhier \*subs; |
|  |  | struct mosquitto\_\_subhier \*normal\_subs; |
|  |  | struct mosquitto\_\_subhier \*shared\_subs; |
|  |  | struct mosquitto\_\_retainhier \*retains; |
|  |  | struct mosquitto \*contexts\_by\_id; |
|  |  | struct mosquitto \*contexts\_by\_sock; |
| Expand Down | |  |

8 changes: 7 additions & 1 deletion

8
[src/persist\_write.c](#diff-14d80f95aeca35e110932910677b559238aa23dd69d7459d8447dac541e60ae7 "src/persist_write.c")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/src/persist_write.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -266,7 +266,13 @@ static int persist\_\_subs\_save\_all(FILE \*db\_fptr) |
|  |  | { |
|  |  | struct mosquitto\_\_subhier \*subhier, \*subhier\_tmp; |
|  |  |  |
|  |  | HASH\_ITER(hh, db.subs, subhier, subhier\_tmp){ |
|  |  | HASH\_ITER(hh, db.normal\_subs, subhier, subhier\_tmp){ |
|  |  | if(subhier->children){ |
|  |  | persist\_\_subs\_save(db\_fptr, subhier->children, "", 0); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | HASH\_ITER(hh, db.shared\_subs, subhier, subhier\_tmp){ |
|  |  | if(subhier->children){ |
|  |  | persist\_\_subs\_save(db\_fptr, subhier->children, "", 0); |
|  |  | } |
| Expand Down | |  |

42 changes: 32 additions & 10 deletions

42
[src/subs.c](#diff-f6993b97aedd5fd63ccda05b57aee9d218c6a9a0a89431d064a67acda9a264b3 "src/subs.c")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/src/subs.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -595,16 +595,29 @@ int sub\_\_add(struct mosquitto \*context, const char \*sub, uint8\_t qos, uint32\_t i |
|  |  | mosquitto\_\_free(topics); |
|  |  | return MOSQ\_ERR\_INVAL; |
|  |  | } |
|  |  | HASH\_FIND(hh, db.subs, topics[0], topiclen, subhier); |
|  |  | if(!subhier){ |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.subs, topics[0], (uint16\_t)topiclen); |
|  |  |  |
|  |  | if(sharename){ |
|  |  | HASH\_FIND(hh, db.shared\_subs, topics[0], topiclen, subhier); |
|  |  | if(!subhier){ |
|  |  | mosquitto\_\_free(local\_sub); |
|  |  | mosquitto\_\_free(topics); |
|  |  | log\_\_printf(NULL, MOSQ\_LOG\_ERR, "Error: Out of memory."); |
|  |  | return MOSQ\_ERR\_NOMEM; |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.shared\_subs, topics[0], (uint16\_t)topiclen); |
|  |  | if(!subhier){ |
|  |  | mosquitto\_\_free(local\_sub); |
|  |  | mosquitto\_\_free(topics); |
|  |  | log\_\_printf(NULL, MOSQ\_LOG\_ERR, "Error: Out of memory."); |
|  |  | return MOSQ\_ERR\_NOMEM; |
|  |  | } |
|  |  | } |
|  |  | }else{ |
|  |  | HASH\_FIND(hh, db.normal\_subs, topics[0], topiclen, subhier); |
|  |  | if(!subhier){ |
|  |  | subhier = sub\_\_add\_hier\_entry(NULL, &db.normal\_subs, topics[0], (uint16\_t)topiclen); |
|  |  | if(!subhier){ |
|  |  | mosquitto\_\_free(local\_sub); |
|  |  | mosquitto\_\_free(topics); |
|  |  | log\_\_printf(NULL, MOSQ\_LOG\_ERR, "Error: Out of memory."); |
|  |  | return MOSQ\_ERR\_NOMEM; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | } |
|  |  | rc = sub\_\_add\_context(context, sub, qos, identifier, options, subhier, topics, sharename); |
|  |  |  |
| Expand All | | @@ -627,7 +640,11 @@ int sub\_\_remove(struct mosquitto \*context, const char \*sub, uint8\_t \*reason) |
|  |  | rc = sub\_\_topic\_tokenise(sub, &local\_sub, &topics, &sharename); |
|  |  | if(rc) return rc; |
|  |  |  |
|  |  | HASH\_FIND(hh, db.subs, topics[0], strlen(topics[0]), subhier); |
|  |  | if(sharename){ |
|  |  | HASH\_FIND(hh, db.shared\_subs, topics[0], strlen(topics[0]), subhier); |
|  |  | }else{ |
|  |  | HASH\_FIND(hh, db.normal\_subs, topics[0], strlen(topics[0]), subhier); |
|  |  | } |
|  |  | if(subhier){ |
|  |  | \*reason = MQTT\_RC\_NO\_SUBSCRIPTION\_EXISTED; |
|  |  | rc = sub\_\_remove\_recurse(context, subhier, topics, reason, sharename); |
| Expand Down  Expand Up | | @@ -656,7 +673,12 @@ int sub\_\_messages\_queue(const char \*source\_id, const char \*topic, uint8\_t qos, i |
|  |  | \*/ |
|  |  | db\_\_msg\_store\_ref\_inc(\*stored); |
|  |  |  |
|  |  | HASH\_FIND(hh, db.subs, split\_topics[0], strlen(split\_topics[0]), subhier); |
|  |  | HASH\_FIND(hh, db.normal\_subs, split\_topics[0], strlen(split\_topics[0]), subhier); |
|  |  | if(subhier){ |
|  |  | rc = sub\_\_search(subhier, split\_topics, source\_id, topic, qos, retain, \*stored); |
|  |  | } |
|  |  |  |
|  |  | HASH\_FIND(hh, db.shared\_subs, split\_topics[0], strlen(split\_topics[0]), subhier); |
|  |  | if(subhier){ |
|  |  | rc = sub\_\_search(subhier, split\_topics, source\_id, topic, qos, retain, \*stored); |
|  |  | } |
| Expand Down | |  |

31 changes: 31 additions & 0 deletions

31
[test/broker/data/REGRESSION.json](#diff-2fa653babcec70efd6cd9d6bda93736112cd885a08fc1a4ea3af2f6a9bfe996e "test/broker/data/REGRESSION.json")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/test/broker/data/REGRESSION.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,5 +14,36 @@ |
|  |  | {"type":"recv", "payload":"90 03 1234 00"} |
|  |  | ], "comment": "https://github.com/eclipse/mosquitto/issues/2885"} |
|  |  | ] |
|  |  | }, |
|  |  | { |
|  |  | "group": "REGRESSIONS", |
|  |  | "tests": [ |
|  |  | { |
|  |  | "name": "mismatched-shared-normal-subscribe-unsubscribe-leak", "ver":4, "expect\_disconnect":false, "msgs": [ |
|  |  | {"type":"send", "payload":"82 1a 0001 0015 24 73 68 61 72 65 2f 73 68 61 72 65 6e 61 6d 65 2f 74 65 73 74 01"}, |
|  |  | {"type":"recv", "payload":"90 03 0001 01"}, |
|  |  | {"type":"send", "payload":"82 09 0002 0004 74 65 73 74 00"}, |
|  |  | {"type":"recv", "payload":"90 03 0002 00"}, |
|  |  | {"type":"send", "payload":"A2 08 0007 0004 74 65 73 74"}, |
|  |  | {"type":"recv", "payload":"B0 02 0007"} |
|  |  | ], |
|  |  | "comment": "Also part one of the next two tests" |
|  |  | }, |
|  |  | { |
|  |  | "name": "acl-check-uaf", "ver":4, "expect\_disconnect":false, "msgs": [ |
|  |  | {"type":"send", "payload":"30 0D 0004 74657374 7061796C6F6164"} |
|  |  | ] |
|  |  | }, |
|  |  | { |
|  |  | "name": "shared-sub-uaf", "ver":4, "expect\_disconnect":false, "msgs": [ |
|  |  | {"type":"send", "payload":"82 1a 0001 0015 24 73 68 61 72 65 2f 73 68 61 72 65 6e 61 6d 65 2f 74 65 73 74 01"}, |
|  |  | {"type":"recv", "payload":"90 03 0001 01"}, |
|  |  | {"type":"send", "payload":"82 09 0002 0004 74 65 73 74 00"}, |
|  |  | {"type":"recv", "payload":"90 03 0002 00"}, |
|  |  | {"type":"send", "payload":"A2 08 0007 0004 74 65 73 74"}, |
|  |  | {"type":"recv", "payload":"B0 02 0007"} |
|  |  | ] |
|  |  | } |
|  |  | ] |
|  |  | } |
|  |  | ] |

4 changes: 4 additions & 0 deletions

4
[test/broker/msg\_sequence\_test.py](#diff-79d2503c7dac870818a3437c811c86847d70c48e393cf5957cbb3736c498c059 "test/broker/msg_sequence_test.py")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/test/broker/msg_sequence_test.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -218,6 +218,10 @@ def do\_test(hostname, port): |
|  |  | broker.terminate() |
|  |  | broker.wait() |
|  |  | (stdo, stde) = broker.communicate() |
|  |  | if broker.returncode != 0: |
|  |  | rc = broker.returncode |
|  |  | print(f"Broker exited with code {rc}. If there are no obvious errors this may be due to an ASAN build having leaks, which must be fixed.") |
|  |  | print("The easiest way to reproduce this is to run the broker with `mosquitto -p 1888`, rerun the test, then quit the broker.") |
|  |  | if rc: |
|  |  | #print(stde.decode('utf-8')) |
|  |  | exit(rc) |

7 changes: 4 additions & 3 deletions

7
[test/unit/subs\_test.c](#diff-3466e24a0b6bfa498b2273fc2ef0079355b73720c9e2ddf3088c6d6d82c5efe6 "test/unit/subs_test.c")

Show comments

[View file](/eclipse-mosquitto/mosquitto/blob/1914b3ee2a18102d0a94cbdbbfeae1afa03edd17/test/unit/subs_test.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -60,9 +60,10 @@ static void TEST\_sub\_add\_single(void) |
|  |  |  |
|  |  | rc = sub\_\_add(&context, "a/b/c/d/e", 0, 0, 0); |
|  |  | CU\_ASSERT\_EQUAL(rc, MOSQ\_ERR\_SUCCESS); |
|  |  | CU\_ASSERT\_PTR\_NOT\_NULL(db.subs); |
|  |  | if(db.subs){ |
|  |  | sub = db.subs; |
|  |  | CU\_ASSERT\_PTR\_NOT\_NULL(db.shared\_subs); |
|  |  | CU\_ASSERT\_PTR\_NOT\_NULL(db.normal\_subs); |
|  |  | if(db.normal\_subs){ |
|  |  | sub = db.normal\_subs; |
|  |  |  |
|  |  | hier\_quick\_check(&sub, NULL, ""); |
|  |  | hier\_quick\_check(&sub, NULL, ""); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1914b3e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Feclipse-mosquitto%2Fmosquitto%2Fcommit%2F1914b3ee2a18102d0a94cbdbbfeae1afa03edd17) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


