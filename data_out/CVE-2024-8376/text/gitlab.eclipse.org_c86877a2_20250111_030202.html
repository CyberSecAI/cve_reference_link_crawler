

[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Mosquitto: Use after free on mosquitto\_acl\_check

## Basic information

**Project name:** Eclipse Mosquitto

**Project id:** iot.mosquitto

## What are the affected versions?

2.0.18

We have not checked previous versions.

## Details of the issue

We have found a heap-use-after-free vulnerability on Mosquitto 2.0.18 which occurs on src/security.c:688:15 (at function 'mosquitto\_acl\_check').

This vulnerability can be triggered by sending a specific sequence of the following packets:

CONNECT

SUBSCRIBE

UNSUBSCRIBE

DISCONNECT

CONNECT

PUBLISH

We attach the ASan stack trace of the vulnerability as well as the hex-encoded bytes of the packets ("%x" is used as a hex prefix).

## Steps to reproduce

Run the attached `replay_mqtt_finding.py` script against a Mosquitto 2.0.18 broker which has been instrumented with ASan (AddressSanitizer).

## Do you know any mitigations of the issue?

No.

## Credit request

If you assign a CVE, is it possible to register the requested CVE with our names and organization name? We are Roman Kraus, Steffen Lüdtke, Martin Schneider and Ramon Barakat of Fraunhofer FOKUS.

Best regards,

Roman Kraus

[acl\_check\_uaf.zip](/-/project/3804/uploads/740dab1c631f7eed28eebb760a160e95/acl_check_uaf.zip)

To upload designs, you'll need to enable LFS and have an admin enable hashed storage. [More information](/help/user/project/issues/design_management.md#prerequisites)

Assignee
Loading

Time tracking
Loading

Copyright © Eclipse Foundation, Inc. All Rights Reserved.     [Privacy Policy](https://www.eclipse.org/legal/privacy.php) | [Terms of Use](https://www.eclipse.org/legal/termsofuse.php) | [Copyright Agent](https://www.eclipse.org/legal/copyright.php)

