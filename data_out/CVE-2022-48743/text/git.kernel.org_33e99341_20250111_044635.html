

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-08 18:23:12 +0100 |
| commit | [34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)) | |
| tree | [445bd2dc83e4bb51955084d46fc524f1d97fa022](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) | |
| parent | [6b90b8ff90d212da14d1fd0e58d96f677ecae0fe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26&id2=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe)) | |
| download | [linux-34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 5949d30ee9a53f..35659f0dbe74e6 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)@@ -2768,6 +2768,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2797,8 +2805,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:13 +0000

