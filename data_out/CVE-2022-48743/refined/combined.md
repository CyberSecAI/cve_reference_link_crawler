=== Content from git.kernel.org_cb63efd3_20250111_044644.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8f73f620fee5f52653ed2da360121e4446575c5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8f73f620fee5f52653ed2da360121e4446575c5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8f73f620fee5f52653ed2da360121e4446575c5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8f73f620fee5f52653ed2da360121e4446575c5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-05 12:39:57 +0100 |
| commit | [e8f73f620fee5f52653ed2da360121e4446575c5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8f73f620fee5f52653ed2da360121e4446575c5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8f73f620fee5f52653ed2da360121e4446575c5)) | |
| tree | [2207914f2e34a65c526422953e17ce6617b6e0f5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8f73f620fee5f52653ed2da360121e4446575c5) | |
| parent | [dc2c6fdbfc1af540eb0e8a81bf330a747846931f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dc2c6fdbfc1af540eb0e8a81bf330a747846931f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8f73f620fee5f52653ed2da360121e4446575c5&id2=dc2c6fdbfc1af540eb0e8a81bf330a747846931f)) | |
| download | [linux-e8f73f620fee5f52653ed2da360121e4446575c5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8f73f620fee5f52653ed2da360121e4446575c5.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8f73f620fee5f52653ed2da360121e4446575c5)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=e8f73f620fee5f52653ed2da360121e4446575c5) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 6fe779d185f4ba..7086d0e1e45588 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=dc2c6fdbfc1af540eb0e8a81bf330a747846931f)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=e8f73f620fee5f52653ed2da360121e4446575c5)@@ -2555,6 +2555,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2584,8 +2592,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:21 +0000



=== Content from git.kernel.org_8cde9493_20250111_044637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2022-01-27 18:24:54 -0800 |
| commit | [5aac9108a180fc06e28d4e7fb00247ce603b72ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)) | |
| tree | [6f650fc5a3bcf53ce275b7465b130ddba1653968](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee) | |
| parent | [23a46422c56144939c091c76cf389aa863ce9c18](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=23a46422c56144939c091c76cf389aa863ce9c18) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee&id2=23a46422c56144939c091c76cf389aa863ce9c18)) | |
| download | [linux-5aac9108a180fc06e28d4e7fb00247ce603b72ee.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5aac9108a180fc06e28d4e7fb00247ce603b72ee.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowThere will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 492ac383f16df0..ec3b287e3a7187 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=23a46422c56144939c091c76cf389aa863ce9c18)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=5aac9108a180fc06e28d4e7fb00247ce603b72ee)@@ -2550,6 +2550,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2579,8 +2587,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:15 +0000



=== Content from git.kernel.org_017096a1_20250111_044643.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=db6fd92316a254be2097556f01bccecf560e53ce)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=db6fd92316a254be2097556f01bccecf560e53ce)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db6fd92316a254be2097556f01bccecf560e53ce)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db6fd92316a254be2097556f01bccecf560e53ce)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-05 12:38:59 +0100 |
| commit | [db6fd92316a254be2097556f01bccecf560e53ce](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db6fd92316a254be2097556f01bccecf560e53ce) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=db6fd92316a254be2097556f01bccecf560e53ce)) | |
| tree | [41815adccaa0117b765d095b0f4be776b0f8e3c3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=db6fd92316a254be2097556f01bccecf560e53ce) | |
| parent | [8cb5afa71033a065164f7988500fa7130ce4f152](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8cb5afa71033a065164f7988500fa7130ce4f152) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db6fd92316a254be2097556f01bccecf560e53ce&id2=8cb5afa71033a065164f7988500fa7130ce4f152)) | |
| download | [linux-db6fd92316a254be2097556f01bccecf560e53ce.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-db6fd92316a254be2097556f01bccecf560e53ce.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=db6fd92316a254be2097556f01bccecf560e53ce)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=db6fd92316a254be2097556f01bccecf560e53ce) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 4c515a497a2ba8..e6883d52d230c8 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=8cb5afa71033a065164f7988500fa7130ce4f152)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=db6fd92316a254be2097556f01bccecf560e53ce)@@ -2557,6 +2557,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2586,8 +2594,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:20 +0000



=== Content from git.kernel.org_648f2f05_20250111_044637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-05 12:37:56 +0100 |
| commit | [4d3fcfe8464838b3920bc2b939d888e0b792934e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)) | |
| tree | [a90971bc20e5ca275f61eb4282cbdeec8cf83794](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e) | |
| parent | [cadfa7dce526334d7ae1425cdc66c626f8adfbf5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cadfa7dce526334d7ae1425cdc66c626f8adfbf5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e&id2=cadfa7dce526334d7ae1425cdc66c626f8adfbf5)) | |
| download | [linux-4d3fcfe8464838b3920bc2b939d888e0b792934e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4d3fcfe8464838b3920bc2b939d888e0b792934e.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=4d3fcfe8464838b3920bc2b939d888e0b792934e) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 66e71fa5068797..a816b30bca04c7 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=cadfa7dce526334d7ae1425cdc66c626f8adfbf5)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=4d3fcfe8464838b3920bc2b939d888e0b792934e)@@ -2559,6 +2559,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2588,8 +2596,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:14 +0000



=== Content from git.kernel.org_d4b5350b_20250111_044639.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=617f9934bb37993b9813832516f318ba874bcb7d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=617f9934bb37993b9813832516f318ba874bcb7d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=617f9934bb37993b9813832516f318ba874bcb7d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=617f9934bb37993b9813832516f318ba874bcb7d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-08 18:16:27 +0100 |
| commit | [617f9934bb37993b9813832516f318ba874bcb7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=617f9934bb37993b9813832516f318ba874bcb7d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=617f9934bb37993b9813832516f318ba874bcb7d)) | |
| tree | [55722fd1b2a95066f2e73355237d3773684606b2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=617f9934bb37993b9813832516f318ba874bcb7d) | |
| parent | [c517b169c2185b84deee8fba0b49962affaaa04e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c517b169c2185b84deee8fba0b49962affaaa04e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=617f9934bb37993b9813832516f318ba874bcb7d&id2=c517b169c2185b84deee8fba0b49962affaaa04e)) | |
| download | [linux-617f9934bb37993b9813832516f318ba874bcb7d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-617f9934bb37993b9813832516f318ba874bcb7d.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=617f9934bb37993b9813832516f318ba874bcb7d)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=617f9934bb37993b9813832516f318ba874bcb7d) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 933ccae14f976b..78412d6024aad6 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=c517b169c2185b84deee8fba0b49962affaaa04e)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=617f9934bb37993b9813832516f318ba874bcb7d)@@ -2722,6 +2722,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2751,8 +2759,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:16 +0000



=== Content from git.kernel.org_33e99341_20250111_044635.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-08 18:23:12 +0100 |
| commit | [34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)) | |
| tree | [445bd2dc83e4bb51955084d46fc524f1d97fa022](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) | |
| parent | [6b90b8ff90d212da14d1fd0e58d96f677ecae0fe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26&id2=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe)) | |
| download | [linux-34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 5949d30ee9a53f..35659f0dbe74e6 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=6b90b8ff90d212da14d1fd0e58d96f677ecae0fe)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=34aeb4da20f93ac80a6291a2dbe7b9c6460e9b26)@@ -2768,6 +2768,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2797,8 +2805,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:13 +0000



=== Content from git.kernel.org_d4b407b5_20250111_044641.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9924c80bd484340191e586110ca22bff23a49f2e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9924c80bd484340191e586110ca22bff23a49f2e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9924c80bd484340191e586110ca22bff23a49f2e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9924c80bd484340191e586110ca22bff23a49f2e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-08 18:15:28 +0100 |
| commit | [9924c80bd484340191e586110ca22bff23a49f2e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9924c80bd484340191e586110ca22bff23a49f2e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9924c80bd484340191e586110ca22bff23a49f2e)) | |
| tree | [0d762f17a4e40a776d815686e43ff126639767be](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9924c80bd484340191e586110ca22bff23a49f2e) | |
| parent | [cadd542ebec04549e112720a803df22f03b2b05c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cadd542ebec04549e112720a803df22f03b2b05c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9924c80bd484340191e586110ca22bff23a49f2e&id2=cadd542ebec04549e112720a803df22f03b2b05c)) | |
| download | [linux-9924c80bd484340191e586110ca22bff23a49f2e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9924c80bd484340191e586110ca22bff23a49f2e.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9924c80bd484340191e586110ca22bff23a49f2e)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=9924c80bd484340191e586110ca22bff23a49f2e) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 11882a18c45fdd..d412d942cbdaf5 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=cadd542ebec04549e112720a803df22f03b2b05c)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=9924c80bd484340191e586110ca22bff23a49f2e)@@ -1968,6 +1968,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -1997,8 +2005,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:18 +0000



=== Content from git.kernel.org_7c4ed4fa_20250111_044640.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9892742f035f7aa7dcd2bb0750effa486db89576)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9892742f035f7aa7dcd2bb0750effa486db89576)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9892742f035f7aa7dcd2bb0750effa486db89576)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9892742f035f7aa7dcd2bb0750effa486db89576)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shyam Sundar S K <Shyam-sundar.S-k@amd.com> | 2022-01-27 14:50:03 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-05 12:35:36 +0100 |
| commit | [9892742f035f7aa7dcd2bb0750effa486db89576](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9892742f035f7aa7dcd2bb0750effa486db89576) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9892742f035f7aa7dcd2bb0750effa486db89576)) | |
| tree | [9c1d7a4d796b07a94f950fae727f3d46ab314f18](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9892742f035f7aa7dcd2bb0750effa486db89576) | |
| parent | [28bdf65a561283b51b3083e7ff88f5d942a52ce4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28bdf65a561283b51b3083e7ff88f5d942a52ce4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9892742f035f7aa7dcd2bb0750effa486db89576&id2=28bdf65a561283b51b3083e7ff88f5d942a52ce4)) | |
| download | [linux-9892742f035f7aa7dcd2bb0750effa486db89576.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9892742f035f7aa7dcd2bb0750effa486db89576.tar.gz) | |

net: amd-xgbe: Fix skb data length underflowcommit 5aac9108a180fc06e28d4e7fb00247ce603b72ee upstream.
There will be BUG\_ON() triggered in include/linux/skbuff.h leading to
intermittent kernel panic, when the skb length underflow is detected.
Fix this by dropping the packet if such length underflows are seen
because of inconsistencies in the hardware descriptors.
Fixes: 622c36f143fc ("amd-xgbe: Fix jumbo MTU processing on newer hardware")
Suggested-by: Tom Lendacky <thomas.lendacky@amd.com>
Signed-off-by: Shyam Sundar S K <Shyam-sundar.S-k@amd.com>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k@amd.com](https://lore.kernel.org/r/20220127092003.2812745-1-Shyam-sundar.S-k%40amd.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9892742f035f7aa7dcd2bb0750effa486db89576)

| -rw-r--r-- | [drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=9892742f035f7aa7dcd2bb0750effa486db89576) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/amd/xgbe/xgbe-drv.c b/drivers/net/ethernet/amd/xgbe/xgbe-drv.cindex 30f50d5787bddc..0442d7e1cd20bd 100644--- a/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=28bdf65a561283b51b3083e7ff88f5d942a52ce4)+++ b/[drivers/net/ethernet/amd/xgbe/xgbe-drv.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/amd/xgbe/xgbe-drv.c?id=9892742f035f7aa7dcd2bb0750effa486db89576)@@ -2767,6 +2767,14 @@ read\_again: buf2\_len = xgbe\_rx\_buf2\_len(rdata, packet, len); len += buf2\_len; + if (buf2\_len > rdata->rx.buf.dma\_len) {+ /\* Hardware inconsistency within the descriptors+ \* that has resulted in a length underflow.+ \*/+ error = 1;+ goto skip\_data;+ }+ if (!skb) { skb = xgbe\_create\_skb(pdata, napi, rdata, buf1\_len);@@ -2796,8 +2804,10 @@ skip\_data: if (!last || context\_next) goto read\_again; - if (!skb)+ if (!skb || error) {+ dev\_kfree\_skb(skb); goto next\_packet;+ }  /\* Be sure we don't exceed the configured MTU \*/ max\_len = netdev->mtu + ETH\_HLEN; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:45:17 +0000


