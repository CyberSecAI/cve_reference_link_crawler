=== Content from huntr.com_9ecb5ec7_20250111_111102.html ===


* [![logo](/horizontal-logo-wh.svg)](/)
* [Bounties](/bounties)
* [Partners](/partners)
* Community
* Info
[SUBMIT REPORT](/bounties/disclose)

Supported by [Protect AI](https://protectai.com/) and leading the way to [MLSecOps](https://mlsecops.com) and greater AI security.

© 2024

[Privacy Policy](/privacy)[Terms of Service](/terms)[Code of Conduct](/code-of-conduct)Cookie Preferences[Contact Us](/contact-us)

=== Content from github.com_a61f44e7_20250111_111101.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fcommit%2F727d5023ce88e18e3074ef620a98137d26ff92a3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fcommit%2F727d5023ce88e18e3074ef620a98137d26ff92a3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=langchain-ai%2Flangchain)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[langchain-ai](/langchain-ai)
/
**[langchain](/langchain-ai/langchain)**
Public

* [Notifications](/login?return_to=%2Flangchain-ai%2Flangchain) You must be signed in to change notification settings
* [Fork
  15.9k](/login?return_to=%2Flangchain-ai%2Flangchain)
* [Star
   98k](/login?return_to=%2Flangchain-ai%2Flangchain)

* [Code](/langchain-ai/langchain)
* [Issues
  382](/langchain-ai/langchain/issues)
* [Pull requests
  45](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects
  2](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

Additional navigation options

* [Code](/langchain-ai/langchain)
* [Issues](/langchain-ai/langchain/issues)
* [Pull requests](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

## Commit

[Permalink](/langchain-ai/langchain/commit/727d5023ce88e18e3074ef620a98137d26ff92a3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

core[patch]: Use defusedxml in XMLOutputParser ([#19526](https://github.com/langchain-ai/langchain/pull/19526))

[Browse files](/langchain-ai/langchain/tree/727d5023ce88e18e3074ef620a98137d26ff92a3)
Browse the repository at this point in the history

```
This mitigates a security concern for users still using older versions of libexpat that causes an attacker to compromise the availability of the system if an attacker manages to surface malicious payload to this XMLParser.
```

* Loading branch information

[![@eyurtsev](https://avatars.githubusercontent.com/u/3205522?s=40&v=4)](/eyurtsev)

[eyurtsev](/langchain-ai/langchain/commits?author=eyurtsev "View all commits by eyurtsev")
authored
Mar 25, 2024

1 parent
[e1a6341](/langchain-ai/langchain/commit/e1a6341940e7b62a5a1ecff17f99d56f362d449b)

commit 727d502

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**122 additions**
and
**36 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* libs/core

  + langchain\_core/output\_parsers

    - libs/core/langchain\_core/output\_parsers/xml.py
      [xml.py](#diff-832572971e52b9ca7c3ab4902c3e94beab966bb513998fe508300e5474532932)
  + libs/core/poetry.lock
    [poetry.lock](#diff-55267c883e58892916d5316bc029725fdeeba5a77e2557cf7667793823d9d9c6)
  + libs/core/pyproject.toml
    [pyproject.toml](#diff-06baaee12b22a370fef9f170c9ed13e2727e377d3b32f5018430f4f0a39d3537)
  + tests/unit\_tests/output\_parsers

    - libs/core/tests/unit\_tests/output\_parsers/test\_xml\_parser.py
      [test\_xml\_parser.py](#diff-d88d0ed5eccba8ccdad6f927202286e9964047e479570c9652cb6893a5a6287b)

## There are no files selected for viewing

50 changes: 42 additions & 8 deletions

50
[libs/core/langchain\_core/output\_parsers/xml.py](#diff-832572971e52b9ca7c3ab4902c3e94beab966bb513998fe508300e5474532932 "libs/core/langchain_core/output_parsers/xml.py")

Show comments

[View file](/langchain-ai/langchain/blob/727d5023ce88e18e3074ef620a98137d26ff92a3/libs/core/langchain_core/output_parsers/xml.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,7 @@ |
|  |  | import re |
|  |  | import xml.etree.ElementTree as ET |
|  |  | from typing import Any, AsyncIterator, Dict, Iterator, List, Optional, Union |
|  |  | from xml.etree import ElementTree as ET |
|  |  | from xml.etree.ElementTree import TreeBuilder |
|  |  |  |
|  |  | from langchain\_core.exceptions import OutputParserException |
|  |  | from langchain\_core.messages import BaseMessage |
| Expand Down  Expand Up | | @@ -35,6 +36,10 @@ def get\_format\_instructions(self) -> str: |
|  |  | return XML\_FORMAT\_INSTRUCTIONS.format(tags=self.tags) |
|  |  |  |
|  |  | def parse(self, text: str) -> Dict[str, List[Any]]: |
|  |  | # Imports are temporarily placed here to avoid issue with caching on CI |
|  |  | # likely if you're reading this you can move them to the top of the file |
|  |  | from defusedxml import ElementTree as DET # type: ignore[import] |
|  |  |  |
|  |  | # Try to find XML string within triple backticks |
|  |  | match = re.search(r"```(xml)?(.\*)```", text, re.DOTALL) |
|  |  | if match is not None: |
| Expand All | | @@ -46,18 +51,24 @@ def parse(self, text: str) -> Dict[str, List[Any]]: |
|  |  |  |
|  |  | text = text.strip() |
|  |  | try: |
|  |  | root = ET.fromstring(text) |
|  |  | root = DET.fromstring(text) |
|  |  | return self.\_root\_to\_dict(root) |
|  |  |  |
|  |  | except ET.ParseError as e: |
|  |  | except (DET.ParseError, DET.EntitiesForbidden) as e: |
|  |  | msg = f"Failed to parse XML format from completion {text}. Got: {e}" |
|  |  | raise OutputParserException(msg, llm\_output=text) from e |
|  |  |  |
|  |  | def \_transform( |
|  |  | self, input: Iterator[Union[str, BaseMessage]] |
|  |  | ) -> Iterator[AddableDict]: |
|  |  | # Imports are temporarily placed here to avoid issue with caching on CI |
|  |  | # likely if you're reading this you can move them to the top of the file |
|  |  | from defusedxml.ElementTree import DefusedXMLParser # type: ignore[import] |
|  |  |  |
|  |  | parser = ET.XMLPullParser( |
|  |  | ["start", "end"], \_parser=DefusedXMLParser(target=TreeBuilder()) |
|  |  | ) |
|  |  | xml\_start\_re = re.compile(r"<[a-zA-Z:\_]") |
|  |  | parser = ET.XMLPullParser(["start", "end"]) |
|  |  | xml\_started = False |
|  |  | current\_path: List[str] = [] |
|  |  | current\_path\_has\_children = False |
| Expand All | | @@ -83,6 +94,7 @@ def \_transform( |
|  |  | parser.feed(buffer) |
|  |  | buffer = "" |
|  |  | # yield all events |
|  |  |  |
|  |  | for event, elem in parser.read\_events(): |
|  |  | if event == "start": |
|  |  | # update current path |
| Expand All | | @@ -105,18 +117,37 @@ def \_transform( |
|  |  | async def \_atransform( |
|  |  | self, input: AsyncIterator[Union[str, BaseMessage]] |
|  |  | ) -> AsyncIterator[AddableDict]: |
|  |  | parser = ET.XMLPullParser(["start", "end"]) |
|  |  | # Imports are temporarily placed here to avoid issue with caching on CI |
|  |  | # likely if you're reading this you can move them to the top of the file |
|  |  | from defusedxml.ElementTree import DefusedXMLParser # type: ignore[import] |
|  |  |  |
|  |  | \_parser = DefusedXMLParser(target=TreeBuilder()) |
|  |  | parser = ET.XMLPullParser(["start", "end"], \_parser=\_parser) |
|  |  | xml\_start\_re = re.compile(r"<[a-zA-Z:\_]") |
|  |  | xml\_started = False |
|  |  | current\_path: List[str] = [] |
|  |  | current\_path\_has\_children = False |
|  |  | buffer = "" |
|  |  | async for chunk in input: |
|  |  | if isinstance(chunk, BaseMessage): |
|  |  | # extract text |
|  |  | chunk\_content = chunk.content |
|  |  | if not isinstance(chunk\_content, str): |
|  |  | continue |
|  |  | chunk = chunk\_content |
|  |  | # pass chunk to parser |
|  |  | parser.feed(chunk) |
|  |  | # add chunk to buffer of unprocessed text |
|  |  | buffer += chunk |
|  |  | # if xml string hasn't started yet, continue to next chunk |
|  |  | if not xml\_started: |
|  |  | if match := xml\_start\_re.search(buffer): |
|  |  | # if xml string has started, remove all text before it |
|  |  | buffer = buffer[match.start() :] |
|  |  | xml\_started = True |
|  |  | else: |
|  |  | continue |
|  |  | # feed buffer to parser |
|  |  | parser.feed(buffer) |
|  |  | buffer = "" |
|  |  | # yield all events |
|  |  | for event, elem in parser.read\_events(): |
|  |  | if event == "start": |
| Expand All | | @@ -130,7 +161,10 @@ async def \_atransform( |
|  |  | if not current\_path\_has\_children: |
|  |  | yield nested\_element(current\_path, elem) |
|  |  | # prevent yielding of parent element |
|  |  | current\_path\_has\_children = True |
|  |  | if current\_path: |
|  |  | current\_path\_has\_children = True |
|  |  | else: |
|  |  | xml\_started = False |
|  |  | # close parser |
|  |  | parser.close() |
|  |  |  |
| Expand Down | |  |

48 changes: 24 additions & 24 deletions

48
[libs/core/poetry.lock](#diff-55267c883e58892916d5316bc029725fdeeba5a77e2557cf7667793823d9d9c6 "libs/core/poetry.lock")

Show comments

[View file](/langchain-ai/langchain/blob/727d5023ce88e18e3074ef620a98137d26ff92a3/libs/core/poetry.lock)
Edit file

Delete file

Load diff

Some generated files are not rendered by default. Learn more about [how customized files appear on GitHub](https://docs.github.com/github/administering-a-repository/customizing-how-changed-files-appear-on-github).

Oops, something went wrong.

Retry

1 change: 1 addition & 0 deletions

1
[libs/core/pyproject.toml](#diff-06baaee12b22a370fef9f170c9ed13e2727e377d3b32f5018430f4f0a39d3537 "libs/core/pyproject.toml")

Show comments

[View file](/langchain-ai/langchain/blob/727d5023ce88e18e3074ef620a98137d26ff92a3/libs/core/pyproject.toml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,6 +19,7 @@ PyYAML = ">=5.3" |
|  |  | requests = "^2" |
|  |  | packaging = "^23.2" |
|  |  | jinja2 = { version = "^3", optional = true } |
|  |  | defusedxml = "^0.7" |
|  |  |  |
|  |  | [tool.poetry.group.lint] |
|  |  | optional = true |
| Expand Down | |  |

59 changes: 55 additions & 4 deletions

59
[libs/core/tests/unit\_tests/output\_parsers/test\_xml\_parser.py](#diff-d88d0ed5eccba8ccdad6f927202286e9964047e479570c9652cb6893a5a6287b "libs/core/tests/unit_tests/output_parsers/test_xml_parser.py")

Show comments

[View file](/langchain-ai/langchain/blob/727d5023ce88e18e3074ef620a98137d26ff92a3/libs/core/tests/unit_tests/output_parsers/test_xml_parser.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,7 @@ |
|  |  | """Test XMLOutputParser""" |
|  |  | from typing import AsyncIterator |
|  |  | from xml.etree.ElementTree import ParseError |
|  |  |  |
|  |  | import pytest |
|  |  |  |
|  |  | from langchain\_core.exceptions import OutputParserException |
| Expand Down  Expand Up | | @@ -40,19 +43,29 @@ |
|  |  | """, |
|  |  | ], |
|  |  | ) |
|  |  | def test\_xml\_output\_parser(result: str) -> None: |
|  |  | async def test\_xml\_output\_parser(result: str) -> None: |
|  |  | """Test XMLOutputParser.""" |
|  |  |  |
|  |  | xml\_parser = XMLOutputParser() |
|  |  |  |
|  |  | xml\_result = xml\_parser.parse(result) |
|  |  | assert DEF\_RESULT\_EXPECTED == xml\_result |
|  |  | assert DEF\_RESULT\_EXPECTED == xml\_parser.parse(result) |
|  |  | assert DEF\_RESULT\_EXPECTED == (await xml\_parser.aparse(result)) |
|  |  | assert list(xml\_parser.transform(iter(result))) == [ |
|  |  | {"foo": [{"bar": [{"baz": None}]}]}, |
|  |  | {"foo": [{"bar": [{"baz": "slim.shady"}]}]}, |
|  |  | {"foo": [{"baz": "tag"}]}, |
|  |  | ] |
|  |  |  |
|  |  | async def \_as\_iter(string: str) -> AsyncIterator[str]: |
|  |  | for c in string: |
|  |  | yield c |
|  |  |  |
|  |  | chunks = [chunk async for chunk in xml\_parser.atransform(\_as\_iter(result))] |
|  |  | assert chunks == [ |
|  |  | {"foo": [{"bar": [{"baz": None}]}]}, |
|  |  | {"foo": [{"bar": [{"baz": "slim.shady"}]}]}, |
|  |  | {"foo": [{"baz": "tag"}]}, |
|  |  | ] |
|  |  |  |
|  |  |  |
|  |  | @pytest.mark.parametrize("result", ["foo></foo>", "<foo></foo", "foo></foo", "foofoo"]) |
|  |  | def test\_xml\_output\_parser\_fail(result: str) -> None: |
| Expand All | | @@ -63,3 +76,41 @@ def test\_xml\_output\_parser\_fail(result: str) -> None: |
|  |  | with pytest.raises(OutputParserException) as e: |
|  |  | xml\_parser.parse(result) |
|  |  | assert "Failed to parse" in str(e) |
|  |  |  |
|  |  |  |
|  |  | MALICIOUS\_XML = """<?xml version="1.0"?> |
|  |  | <!DOCTYPE lolz [<!ENTITY lol "lol"><!ELEMENT lolz (#PCDATA)> |
|  |  | <!ENTITY lol1 "&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;&lol;"> |
|  |  | <!ENTITY lol2 "&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;&lol1;"> |
|  |  | <!ENTITY lol3 "&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;&lol2;"> |
|  |  | <!ENTITY lol4 "&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;&lol3;"> |
|  |  | <!ENTITY lol5 "&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;&lol4;"> |
|  |  | <!ENTITY lol6 "&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;&lol5;"> |
|  |  | <!ENTITY lol7 "&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;&lol6;"> |
|  |  | <!ENTITY lol8 "&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;&lol7;"> |
|  |  | <!ENTITY lol9 "&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;&lol8;"> |
|  |  | ]> |
|  |  | <lolz>&lol9;</lolz>""" |
|  |  |  |
|  |  |  |
|  |  | async def tests\_billion\_laughs\_attack() -> None: |
|  |  | parser = XMLOutputParser() |
|  |  | with pytest.raises(OutputParserException): |
|  |  | parser.parse(MALICIOUS\_XML) |
|  |  |  |
|  |  | with pytest.raises(OutputParserException): |
|  |  | await parser.aparse(MALICIOUS\_XML) |
|  |  |  |
|  |  | with pytest.raises(ParseError): |
|  |  | # Right now raises undefined entity error |
|  |  | assert list(parser.transform(iter(MALICIOUS\_XML))) == [ |
|  |  | {"foo": [{"bar": [{"baz": None}]}]} |
|  |  | ] |
|  |  |  |
|  |  | async def \_as\_iter(string: str) -> AsyncIterator[str]: |
|  |  | for c in string: |
|  |  | yield c |
|  |  |  |
|  |  | with pytest.raises(ParseError): |
|  |  | chunks = [chunk async for chunk in parser.atransform(\_as\_iter(MALICIOUS\_XML))] |
|  |  | assert chunks == [{"foo": [{"bar": [{"baz": None}]}]}] |

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `727d502`

[![@fubuki8087](https://avatars.githubusercontent.com/u/17444844?s=80&v=4)](/fubuki8087)

Copy link

Contributor

### @fubuki8087 **[fubuki8087](/fubuki8087)** commented on `[727d502](/langchain-ai/langchain/commit/727d5023ce88e18e3074ef620a98137d26ff92a3)` [Apr 19, 2024](#commitcomment-141147983)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I still get problem when I run the [PoC](https://security.snyk.io/vuln/SNYK-PYTHON-LANGCHAINCORE-6501732):

[![poc](https://private-user-images.githubusercontent.com/17444844/323893636-c4c27a95-9362-479e-9791-bcd81df9cdf4.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1OTQxNjEsIm5iZiI6MTczNjU5Mzg2MSwicGF0aCI6Ii8xNzQ0NDg0NC8zMjM4OTM2MzYtYzRjMjdhOTUtOTM2Mi00NzllLTk3OTEtYmNkODFkZjljZGY0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDExMTEwMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTczMWY2ZjZmODBjNDg4NWIxOTdmMzcxMjIyNmE5YzZmMGQ3ZTBhMzJmNWVjNmE4M2E4NjU3ODEzNTQ2MDc4NjQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.RKN5ydfKCZlnFnRLZZisw6BtDthxQnWC74kV6evkTcM)](https://private-user-images.githubusercontent.com/17444844/323893636-c4c27a95-9362-479e-9791-bcd81df9cdf4.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1OTQxNjEsIm5iZiI6MTczNjU5Mzg2MSwicGF0aCI6Ii8xNzQ0NDg0NC8zMjM4OTM2MzYtYzRjMjdhOTUtOTM2Mi00NzllLTk3OTEtYmNkODFkZjljZGY0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDExMTEwMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTczMWY2ZjZmODBjNDg4NWIxOTdmMzcxMjIyNmE5YzZmMGQ3ZTBhMzJmNWVjNmE4M2E4NjU3ODEzNTQ2MDc4NjQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.RKN5ydfKCZlnFnRLZZisw6BtDthxQnWC74kV6evkTcM)

Besides, the unit test `tests_billion_laughs_attack` fails too:

[![unit_test](https://private-user-images.githubusercontent.com/17444844/323893883-5b8be34e-4a22-4d4e-acff-d9ed3a8dfbe2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1OTQxNjEsIm5iZiI6MTczNjU5Mzg2MSwicGF0aCI6Ii8xNzQ0NDg0NC8zMjM4OTM4ODMtNWI4YmUzNGUtNGEyMi00ZDRlLWFjZmYtZDllZDNhOGRmYmUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDExMTEwMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI4ZWViMDJmZWEyZDVmMzU3YzI2MjRlMWVkYWJlMGQxMWZmNDI3MmY4MDc1ZDNjZDYzMjkwNWIyNjJmZjViYjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.7iV6xAiG043U5oTY05dp7V1mCtBlqxJmiurH4d2unEY)](https://private-user-images.githubusercontent.com/17444844/323893883-5b8be34e-4a22-4d4e-acff-d9ed3a8dfbe2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1OTQxNjEsIm5iZiI6MTczNjU5Mzg2MSwicGF0aCI6Ii8xNzQ0NDg0NC8zMjM4OTM4ODMtNWI4YmUzNGUtNGEyMi00ZDRlLWFjZmYtZDllZDNhOGRmYmUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDExMTEwMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI4ZWViMDJmZWEyZDVmMzU3YzI2MjRlMWVkYWJlMGQxMWZmNDI3MmY4MDc1ZDNjZDYzMjkwNWIyNjJmZjViYjMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.7iV6xAiG043U5oTY05dp7V1mCtBlqxJmiurH4d2unEY)

It seems this patch has something wrong and does not work normally.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fcommit%2F727d5023ce88e18e3074ef620a98137d26ff92a3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


