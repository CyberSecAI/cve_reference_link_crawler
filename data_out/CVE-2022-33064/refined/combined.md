=== Content from github.com_39876748_20250110_142113.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F832)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F832)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libsndfile%2Flibsndfile)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libsndfile](/libsndfile)
/
**[libsndfile](/libsndfile/libsndfile)**
Public

* [Notifications](/login?return_to=%2Flibsndfile%2Flibsndfile) You must be signed in to change notification settings
* [Fork
  398](/login?return_to=%2Flibsndfile%2Flibsndfile)
* [Star
   1.5k](/login?return_to=%2Flibsndfile%2Flibsndfile)

* [Code](/libsndfile/libsndfile)
* [Issues
  144](/libsndfile/libsndfile/issues)
* [Pull requests
  27](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects
  0](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

Additional navigation options

* [Code](/libsndfile/libsndfile)
* [Issues](/libsndfile/libsndfile/issues)
* [Pull requests](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# UndefinedBehaviorSanitizer: index 100 out of bounds for type 'SF\_CUE\_POINT [100]' #832

Open

[pietroborrello](/pietroborrello) opened this issue
Apr 29, 2022
¬∑ 10 comments

Open

# [UndefinedBehaviorSanitizer: index 100 out of bounds for type 'SF\_CUE\_POINT [100]'](#top) #832

[pietroborrello](/pietroborrello) opened this issue
Apr 29, 2022
¬∑ 10 comments

## Comments

[![@pietroborrello](https://avatars.githubusercontent.com/u/18199462?s=80&v=4)](/pietroborrello)

Copy link

### **[pietroborrello](/pietroborrello)** commented [Apr 29, 2022](#issue-1221093333)

| **Describe the bug** UndefinedBehaviorSanitizer: index 100 out of bounds for type 'SF\_CUE\_POINT [100]' in wav.c:524 **To Reproduce** Built libsndfile using clang-10 according to [the oss-fuzz script](https://github.com/google/oss-fuzz/blob/master/projects/libsndfile/build.sh) with `CXXFLAGS='-O1 -fsanitize=address -fsanitize=array-bounds,bool,builtin,enum,float-divide-by-zero,function,integer-divide-by-zero,null,object-size,return,returns-nonnull-attribute,shift,signed-integer-overflow,unreachable,vla-bound,vptr'`  commit: [4b01368](https://github.com/libsndfile/libsndfile/commit/4b01368fd8a1e4541d7a5d125f70e99d30851718) **UBSAN Output** ``` $ ./sndfile_alt_fuzzer id:000051,sig:06,src:002454+003908,time:5669051,op:splice,rep:8,trial:2 INFO: Seed: 3446105526 INFO: Loaded 1 modules   (33759 inline 8-bit counters): 33759 [0x8977c3, 0x89fba2),  INFO: Loaded 1 PC tables (33759 PCs): 33759 [0x6f6b48,0x77a938),  sndfile_alt_fuzzer: Running 1 inputs 1 time(s) each. Running: id:000051,sig:06,src:002454+003908,time:5669051,op:splice,rep:8,trial:2 src/wav.c:524:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:524:8 in  src/wav.c:525:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:525:8 in  src/wav.c:526:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:526:8 in  src/wav.c:527:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:527:8 in  src/wav.c:528:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:528:8 in  src/wav.c:529:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:529:8 in  src/wav.c:530:8: runtime error: index 100 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/wav.c:530:8 in  Executed id:000051,sig:06,src:002454+003908,time:5669051,op:splice,rep:8,trial:2 in 2 ms  ```  testcase: [idx out of bound.zip](https://github.com/libsndfile/libsndfile/files/8591945/idx.out.of.bound.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
1
 krisfed reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[![@rfrohl](https://avatars.githubusercontent.com/u/1474150?s=80&u=76b9f7025ea6e851f5857d243560a53c1a610ee5&v=4)](/rfrohl)

Copy link

### **[rfrohl](/rfrohl)** commented [Jul 19, 2023](#issuecomment-1641675015)

| FTR: someone also assigned a CVE to this bug report: [CVE-2022-33064](https://nvd.nist.gov/vuln/detail/CVE-2022-33064) |
| --- |

All reactions

Sorry, something went wrong.

[![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=80&u=893609d2bfd9a34721b779f9be03457fb6722731&v=4)](/ellenjohnson)

Copy link

### **[ellenjohnson](/ellenjohnson)** commented [Aug 1, 2023](#issuecomment-1659408802)

| Hello! Can someone please provide an update on a timeframe for fixing this issue? We current use libsndfile v1.1.0 and [CVE-2022-33064](https://nvd.nist.gov/vuln/detail/CVE-2022-33064) was reported to our team as a high severity security bug. Thanks! |
| --- |

 üëç
3
 krisfed, abscondment, and stiepan reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=80&u=893609d2bfd9a34721b779f9be03457fb6722731&v=4)](/ellenjohnson)

Copy link

### **[ellenjohnson](/ellenjohnson)** commented [Aug 11, 2023](#issuecomment-1675413504) ‚Ä¢ edited Loading

| Any updates on this? It's a high severity security bug on our plate. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=80&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)

Copy link

Member

### **[evpobr](/evpobr)** commented [Aug 12, 2023](#issuecomment-1675714534)

| Hi [@ellenjohnson](https://github.com/ellenjohnson) ! Unfortunately not plans to fix it yet. Maybe you can help us? |
| --- |

All reactions

Sorry, something went wrong.

[![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=80&u=893609d2bfd9a34721b779f9be03457fb6722731&v=4)](/ellenjohnson)

Copy link

### **[ellenjohnson](/ellenjohnson)** commented [Aug 14, 2023](#issuecomment-1677790605) ‚Ä¢ edited Loading

| Hi [@evpobr](https://github.com/evpobr) - thank you for letting us know there are no plans to fix this yet. |
| --- |

All reactions

Sorry, something went wrong.

[![@kulikjak](https://avatars.githubusercontent.com/u/18516837?s=80&u=836026a03a2aa11444ed9f78364412596c33dbdf&v=4)](/kulikjak)

Copy link

### **[kulikjak](/kulikjak)** commented [Sep 1, 2023](#issuecomment-1702253852) ‚Ä¢ edited Loading

| Hi, I don't have ASAN available and I have almost no prior knowledge of libsndfile code base; however, I looked a little into this (in version 1.1.0 - nothing relevant seems to have changed since), and I think this might be a false positive.  I added some debug prints and verified that the supplied input doesn't do anything unexpected.  The input file reports that it has 1024 cues, [`psf_cues_alloc`](https://github.com/libsndfile/libsndfile/blob/48535fc2ab7a08596474ad9104bb14e26518385e/src/common.c#L1325) allocates a structure that is 286724 bytes in size (4 bytes for cue\_count and 1024\*280 for all points), and then only 120 cues are actually present in the file, so it writes nowhere close to the end of the allocated memory.  My guess is that the [following definition](https://github.com/libsndfile/libsndfile/blob/48535fc2ab7a08596474ad9104bb14e26518385e/include/sndfile.h#L440) in `sndfile.h` makes it think that `SF_CUES` has 100 `cue_points`:  ``` typedef struct {	int32_t 	indx ; 	uint32_t 	position ; 	int32_t 	fcc_chunk ; 	int32_t 	chunk_start ; 	int32_t		block_start ; 	uint32_t 	sample_offset ; 	char name [256] ; } SF_CUE_POINT ;  #define	SF_CUES_VAR(count) \ 	struct \ 	{	uint32_t cue_count ; \ 		SF_CUE_POINT cue_points [count] ; \ 	}  typedef SF_CUES_VAR (100) SF_CUES ; ```  which is a good guess, but that is not the case when allocated with `psf_cues_alloc` as it allocates a buffer of `(sizeof (SF_CUES_0) + count * sizeof (SF_CUE_POINT))` bytes.  All that said, I might have overlooked something important, so take it with a grain of salt. |
| --- |

All reactions

Sorry, something went wrong.

[![@mhlavink](https://avatars.githubusercontent.com/u/12829958?s=80&v=4)](/mhlavink)

Copy link

### **[mhlavink](/mhlavink)** commented [Oct 4, 2023](#issuecomment-1746553697)

| I have checked this, then did some evaluations for boundary conditions and ended up with same conclusion as kulikjak. I think that it is confused about how much memory is really allocated and this is false positive. |
| --- |

All reactions

Sorry, something went wrong.

[![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=80&u=893609d2bfd9a34721b779f9be03457fb6722731&v=4)](/ellenjohnson)

Copy link

### **[ellenjohnson](/ellenjohnson)** commented [Oct 19, 2023](#issuecomment-1771593630) ‚Ä¢ edited Loading

| Thank you [@kulikjak](https://github.com/kulikjak) and [@mhlavink](https://github.com/mhlavink) for looking into this and for investigating whether this might be a false positive. [@evpobr](https://github.com/evpobr): Can you or someone else from libsndfile confirm whether this CVE is a real issue or a false positive? Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=80&u=893609d2bfd9a34721b779f9be03457fb6722731&v=4)](/ellenjohnson)

Copy link

### **[ellenjohnson](/ellenjohnson)** commented [Jan 12, 2024](#issuecomment-1889755075)

| Hi [@evpobr](https://github.com/evpobr) -- we're still tracking this security issue since it's still listed as a high-score CVE at <https://nvd.nist.gov/vuln/detail/CVE-2022-33064>. I see also Linux distros Debian and Ubuntu are also tracking this as unresolved. Would you or another developer at libsndfile please confirm what [@kulikjak](https://github.com/kulikjak) and [@mhlavink](https://github.com/mhlavink) suspect -- that this might be a false positive? Thank you! |
| --- |

 üëç
4
 arc9693, git-withit, sandy-lcq, and kulikjak reacted with thumbs up emoji

All reactions

* üëç
  4 reactions

Sorry, something went wrong.

[![@pgh24](https://avatars.githubusercontent.com/u/179844984?s=80&v=4)](/pgh24)

Copy link

### **[pgh24](/pgh24)** commented [Aug 29, 2024](#issuecomment-2318852579) ‚Ä¢ edited Loading

| The issue here is the odd implementation of flexible array members, earlier known as a struct hack. When the last element of a structure is intended to be a variable sized array, C99 uses the format:  ``` struct foo {   int size;   int stuff[]; }  ```  Earlier C variants used:  `int stuff[0];` or even  `int stuff[1];` as the trailing element.  In the case here, the developer chose the arbitrary value of 100 even though the structure never appears to be used with this default size. clang and presumably other static analysis tools see that the structure could be accessed beyond 100 values and raise an error, however the structure is correctly allocated with calloc(). Note that if the trailing element is size null, 0 or 1, clang will not attempt to validate array out of bounds, but will if 2 or greater.  Recommendation. Declare the structure with a trailing SF\_CUE\_POINT cue\_points []; i.e. change `typedef SF_CUES_VAR (100) SF_CUES;` to `typedef SF_CUES_VAR () SF_CUES;`  Here's some test code to illustrate the issue:  ``` #include <stdio.h> #include <stdlib.h>   typedef struct { int   indx;   char name [256]; } SF_CUE_POINT;  #define SF_CUES_VAR(count) \   struct \   { int cue_count; \     SF_CUE_POINT cue_points [count]; \   }  typedef SF_CUES_VAR (100) SF_CUES;  typedef struct sf_private_tag {   int morespace;   SF_CUES *cues; } SF_PRIVATE;  typedef SF_CUES_VAR () SF_CUES_0;  #define SF_CUES_VAR_SIZE(count) (sizeof (SF_CUES_0) + count * sizeof (SF_CUE_POINT))  SF_CUES* psf_cues_alloc(int n) {   SF_CUES* pcues = calloc(1, SF_CUES_VAR_SIZE(n));   printf("allocated size %ld\n", SF_CUES_VAR_SIZE(n));   return pcues; }  int main(int ac, char *av[]) {   SF_PRIVATE sf, *psf = &sf;   SF_CUES cues1;   int cue_count = atoi(av[1]);      printf("sizeof SF_CUES %ld\n", sizeof(cues1));   psf->cues = psf_cues_alloc (cue_count);   printf("sizeof cues %ld\n", sizeof *psf->cues);   psf->cues->cue_points[cue_count-1].indx = 1;   if (ac > 2) {     printf("trying out of bounds\n");     psf->cues->cue_points[cue_count].indx = 1;   }    free(psf->cues); }    ```  Compiling with clang and running:  ``` $ clang -fsanitize=array-bounds,address snd.c -o snd $ ./snd 50 sizeof SF_CUES 26004 allocated size 13004 sizeof cues 26004 $ ./snd 200 sizeof SF_CUES 26004 allocated size 52004 sizeof cues 26004 snd.c:44:3: runtime error: index 199 out of bounds for type 'SF_CUE_POINT [100]' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior snd.c:44:3 in   ```  If I change the `typedef SF_CUES_VAR line` to `()` instead of `100`  ``` $ ./snd 50 sizeof SF_CUES 4 allocated size 13004 sizeof cues 4 $ ./snd 200 sizeof SF_CUES 4 allocated size 52004 sizeof cues 4  ```  The out of bounds is still picked up on both occasions:  ``` $ ./snd 50 1 sizeof SF_CUES 4 allocated size 13004 sizeof cues 4 trying out of bounds ================================================================= ==1310252==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6270000033cc at pc 0x0000004c349d bp 0x7ffcad5af450 sp 0x7ffcad5af448  $ ./snd 200 1 sizeof SF_CUES 4 allocated size 52004 sizeof cues 4 trying out of bounds ================================================================= ==1461440==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62f00000cf24 at pc 0x0000004c349d bp 0x7fff53ad3970 sp 0x7fff53ad3968  ``` |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F832)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

7 participants

[![@rfrohl](https://avatars.githubusercontent.com/u/1474150?s=52&v=4)](/rfrohl) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=52&v=4)](/evpobr) [![@mhlavink](https://avatars.githubusercontent.com/u/12829958?s=52&v=4)](/mhlavink) [![@pietroborrello](https://avatars.githubusercontent.com/u/18199462?s=52&v=4)](/pietroborrello) [![@kulikjak](https://avatars.githubusercontent.com/u/18516837?s=52&v=4)](/kulikjak) [![@ellenjohnson](https://avatars.githubusercontent.com/u/50502729?s=52&v=4)](/ellenjohnson) [![@pgh24](https://avatars.githubusercontent.com/u/179844984?s=52&v=4)](/pgh24)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


