The provided content relates to CVE-2024-26992.

**Root cause of vulnerability:**
The KVM implementation for adaptive PEBS (Precise Event Based Sampling) is flawed. It has multiple bugs related to handling of performance monitoring counters, and it can leak host LBR (Last Branch Record) information to the guest.

**Weaknesses/vulnerabilities present:**
1.  **Incorrect handling of IA32\_FIXED\_CTR\_CTRL:** KVM doesn't account for the upper 32 bits of the IA32\_FIXED\_CTR\_CTRL when reprogramming fixed counters.
2.  **Forced adaptive PEBS records:** KVM always sets precise\_ip to a non-zero value for PEBS events, causing perf to always generate adaptive records even when basic records are requested by the guest.
3.  **Incorrect perf behavior:** perf's intel\_pmu\_disable\_fixed() and intel\_pmu\_enable\_fixed() do not correctly clear the ICL\_FIXED\_0\_ADAPTIVE flag, leading to adaptive counters being always enabled.
4.  **Potential bypass of event filters:** Adaptive PEBS might bypass event filters set by the host via KVM\_SET\_PMU\_EVENT\_FILTER because it can record information disallowed by user space.
5.  **LBR leak:** KVM does not ensure that LBR MSRs hold guest values or zeros when entering a vCPU with adaptive PEBS, allowing the guest to read host LBRs (host RIPs/addresses) through "LBR Entries" records.

**Impact of exploitation:**
-   A malicious guest can potentially read host kernel addresses via the LBR leak.
-   A guest can bypass performance monitoring event filters configured by the host.

**Attack vectors:**
- A malicious guest OS can leverage the vulnerabilities in KVM's adaptive PEBS implementation.

**Required attacker capabilities/position:**
- The attacker needs to have control of a guest OS running on a vulnerable hypervisor with KVM enabled.