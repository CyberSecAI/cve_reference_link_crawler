

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=64a47cf634ae44e92be24ebc982410841093bd7b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=64a47cf634ae44e92be24ebc982410841093bd7b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64a47cf634ae44e92be24ebc982410841093bd7b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64a47cf634ae44e92be24ebc982410841093bd7b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Horatiu Vultur <horatiu.vultur@microchip.com> | 2024-05-13 21:21:57 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:44:40 +0200 |
| commit | [64a47cf634ae44e92be24ebc982410841093bd7b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=64a47cf634ae44e92be24ebc982410841093bd7b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=64a47cf634ae44e92be24ebc982410841093bd7b)) | |
| tree | [a9ed554a7e48b95c39c56f2b38b4be3ddba7c7a8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=64a47cf634ae44e92be24ebc982410841093bd7b) | |
| parent | [6f476aff2d8da1a189621c4c16a76a6c534e4312](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6f476aff2d8da1a189621c4c16a76a6c534e4312) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64a47cf634ae44e92be24ebc982410841093bd7b&id2=6f476aff2d8da1a189621c4c16a76a6c534e4312)) | |
| download | [linux-64a47cf634ae44e92be24ebc982410841093bd7b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-64a47cf634ae44e92be24ebc982410841093bd7b.tar.gz) | |

net: micrel: Fix receiving the timestamp in the frame for lan8841[ Upstream commit aea27a92a41dae14843f92c79e9e42d8f570105c ]
The blamed commit started to use the ptp workqueue to get the second
part of the timestamp. And when the port was set down, then this
workqueue is stopped. But if the config option NETWORK\_PHY\_TIMESTAMPING
is not enabled, then the ptp\_clock is not initialized so then it would
crash when it would try to access the delayed work.
So then basically by setting up and then down the port, it would crash.
The fix consists in checking if the ptp\_clock is initialized and only
then cancel the delayed work.
Fixes: cc7554954848 ("net: micrel: Change to receive timestamp in the frame for lan8841")
Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=64a47cf634ae44e92be24ebc982410841093bd7b)

| -rw-r--r-- | [drivers/net/phy/micrel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/phy/micrel.c?id=64a47cf634ae44e92be24ebc982410841093bd7b) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/phy/micrel.c b/drivers/net/phy/micrel.cindex ddb50a0e2bc822..87780465cd0d59 100644--- a/[drivers/net/phy/micrel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/phy/micrel.c?id=6f476aff2d8da1a189621c4c16a76a6c534e4312)+++ b/[drivers/net/phy/micrel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/phy/micrel.c?id=64a47cf634ae44e92be24ebc982410841093bd7b)@@ -4676,7 +4676,8 @@ static int lan8841\_suspend(struct phy\_device \*phydev) struct kszphy\_priv \*priv = phydev->priv; struct kszphy\_ptp\_priv \*ptp\_priv = &priv->ptp\_priv; - ptp\_cancel\_worker\_sync(ptp\_priv->ptp\_clock);+ if (ptp\_priv->ptp\_clock)+ ptp\_cancel\_worker\_sync(ptp\_priv->ptp\_clock);  return genphy\_suspend(phydev); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:22:00 +0000

