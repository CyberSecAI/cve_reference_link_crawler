

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1690979)
* [XML](/show_bug.cgi?ctype=xml&id=1690979)

Closed
[Bug 1690979](/show_bug.cgi?id=1690979)
(CVE-2023-5732)

Opened 4 years ago
Closed 1 year ago

# URL bar spoofing with bidirectional Unicode characters (also link hover text)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

URL bar spoofing with bidirectional Unicode characters (also link hover text)

## Categories

### (Firefox :: Address Bar, defect, P3)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Address%20Bar#Address%20Bar)

Address Bar
▾

Firefox :: Address Bar
For bugs in the Firefox "Smart Location Bar" (aka Awesome Bar) UI element, including the bookmark and history autocomplete matching behavior.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Address%20Bar&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Address%20Bar&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Address%20Bar)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

117 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [119+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=119%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox117 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr115 | 119+ | fixed |
| firefox-esr128 | --- | --- |
| firefox117 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: arminius, Assigned: mseibert)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/82c213f9f648a145742e189093dbcd7d?d=mm&size=40)  [mseibert](/user_profile?user_id=725240)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/3cca6b6cc3855653ab1b17e9df3aa8e1?d=mm&size=40)  [arminius](/user_profile?user_id=526160)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/a65a0876b78fe449d63939aa44c86afc?d=mm&size=40)  [daisuke](/user_profile?user_id=439222)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2023-37205](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)")

[1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1690979&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1690979)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1832243](/show_bug.cgi?id=1832243 "RESOLVED DUPLICATE - RTL Domain Name Allows IP Spoofing"), [1844915](/show_bug.cgi?id=1844915 "RESOLVED DUPLICATE - Arabic IDNs allow address bar spoofing")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2021-4221](/show_bug.cgi?id=1704422 "RESOLVED FIXED - Address Bar Spoofing due to Arabic RTL characters"), [1844915](/show_bug.cgi?id=1844915 "RESOLVED DUPLICATE - Arabic IDNs allow address bar spoofing")

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=1175415 "https://bugs.chromium.org/p/chromium/issues/detail?id=1175415")

[mozilla-hub.atlassian.net/browse/SNT-700](https://mozilla-hub.atlassian.net/browse/SNT-700 "https://mozilla-hub.atlassian.net/browse/SNT-700")

## Details

### (Keywords: csectype-spoof, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form] [verif?][snt-scrubbed][adv-ESR115.4+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-5732

[Keywords:](/describekeywords.cgi)

[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][snt-scrubbed][adv-ESR115.4+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a48766797_1689 "4 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [All examples from the report as clickable links](/attachment.cgi?id=9201587)  [4 years ago](#c4)  [Armin Ebert [:arminius]](/user_profile?user_id=526160)   988 bytes, text/html |  | [Details](/attachment.cgi?id=9201587&action=edit) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9359587)  [1 year ago](#c17)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   191 bytes, text/plain |  | [Details](/attachment.cgi?id=9359587&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1690979#c0)• 4 years ago |
|  | |

The URL bar content can be spoofed by mixing bidirectional Unicode characters in specific ways, allowing an attacker to forge the displayed protocol and host.

I'm reporting two variants. (1) is Firefox-specific and seems to be facilitated by URL trimming. (2) affects both Firefox and Google Chrome and seems to point to a general issue with how the parts of bidirectional URLs are reordered.

**(1)**

In a text, the first occurring *strong* (i.e. directional) character determines the base direction. In the URL bar, this is usually the `h` of `http`. However, Firefox strips `http://` from plain HTTP URLs (if `browser.urlbar.trimURLs == true`, as is the default). In that case, the first character of the hostname determines the text direction. So, if a hostname from an RTL script is chosen (which passes the IDN display algorithm without being altered, e.g. an Arabic or Hebrew word), the entire URL string is displayed with RTL as the base direction. This arranges parts of the URL in unexpected ways.

**Proof of concept**

* [`http://xn--tib.ml/index%F0%90%A9%96https://www.mozilla.org/articles`](http://xn--tib.ml/index%F0%90%A9%96https%3A//www.mozilla.org/articles) appears in the URL bar as `https://www.mozilla.org/articles𐩖ml/index.ٴ`, spoofing both the HTTPS protocol and full host. (I've chosen an Arabic letter as the second-level domain name and an RTL slash-lookalike (`U+10A56`) as a convincing path separator, although the latter isn't a requirement for the attack.)
* Similarly, a hostname with European numbers (because they aren't *strongly* directional) and an RTL top-level domain could be used, e.g.: [`http://123.456.קום/https://www.mozilla.org/articles`](http://123.456.%D7%A7%D7%95%D7%9D/https%3A//www.mozilla.org/articles) which displays as `https://www.mozilla.org/articles/קום.123.456`

**(2)**

Both Firefox and Google Chrome seem to implement the same display algorithm for URLs with bidirectional text, which gives unexpected results if both the hostname and path contain RTL sequences. In particular, if the hostname ends with an RTL part, and the path starts with an RTL character, both are interpreted as a continuous RTL context and get visually re-ordered. This way part of the path ends up in the hostname and vice versa. This also means that an attacker can (visually) inject characters into the hostname which are on the IDN blocklist but don't get blocked here because they are actually part of the path segment, not the domain name.

**Proof of concept**

* [`https://www.mozilla.org.xn--tib.xn--9dbq2a/#%F0%90%A9%96/app/main`](https://www.mozilla.org.xn--tib.xn--9dbq2a/#%F0%90%A9%96/app/main) displays as `https://www.mozilla.org.𐩖#...`
* Also, an RTL-only hostname can trivially be shadowed by another RTL hostname: [`https://ק.קום/م.كوم/foo`](https://%D7%A7.%D7%A7%D7%95%D7%9D/%D9%85.%D9%83%D9%88%D9%85/foo) requests `ק.קום` although visually `م.كوم` follows after the protocol part.
* Since numbers aren't strongly directional, one can also trivially spoof IP hosts. E.g., [`https://127.xn--9dbq2a/0.0.1/`](https://127.xn--9dbq2a/0.0.1/) and [`https://127.ק.קום/0.0.1/index.php`](https://127.%D7%A7.%D7%A7%D7%95%D7%9D/0.0.1/index.php) both visually start with `https://127.0.0.1/` but request a different hostname.

All examples were tested on Linux + Nightly with default settings.

Flags: sec-bounty?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1690979#c1)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1690979&comment_id=15250643 "1 revision") |
|  | |

:jfkthame, can you help take a look at what's happening here?

Reporter: thanks for the report. I'm assuming you've reported to Chrome as well. Can you link us to your report there so we can avoid zero-daying them if we fix first and/or ensure that fixes are complete etc. ? (Fine if the Chrome report is hidden from the public, we can ask them for CCs if we know which it is.)

Type: task → defectComponent: Security → Address BarFlags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1690979#c2)• 4 years ago |
|  | |

This seems quite related to the issues in [bug 1623888](/show_bug.cgi?id=1623888 "VERIFIED FIXED - URL spoof: RTL character in URL flips domain and path if domain contains no directional characters (e.g. ip address)"), although here the examples aren't relying on overflowing the available space, they're just about reordering the pieces so that it's unclear what the actual domain is. (I believe we correctly show the domain darker than the rest of the URL in each case, but it may be easy to overlook that when what looks like a normal domain name is visually at the beginning.)

Flags: needinfo?(jfkthame) → needinfo?(mak)

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1690979#c3)• 4 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1690979&comment_id=15250955 "3 revisions") |
|  | |

Similarly to [bug 1623888](/show_bug.cgi?id=1623888 "VERIFIED FIXED - URL spoof: RTL character in URL flips domain and path if domain contains no directional characters (e.g. ip address)"), we could insert nonbreaking/forcing chars where necessary (for case 1 when we strip http, for case 2 between the host and the path), but again it would add a lot of complication to have a visible value different from the real input value when we calculate selection and highlight. With [Bug 1577539](/show_bug.cgi?id=1577539 "REOPENED - Stop formatting the url when there's user typed text in the urlbar") fixed things could maybe be easier, since we'd only format fixed and confirmed URLs, rather than any string.

I must think a bit more about this and experiment a little.

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1690979#c4)• 4 years ago |
|  | |

Attached file
[All examples from the report as clickable links](attachment.cgi?id=9201587)
— [Details](attachment.cgi?id=9201587&action=edit)

|  | [Armin Ebert [:arminius]](/user_profile?user_id=526160)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1690979#c5)• 4 years ago |
|  | |

:Gijs Sure, just filed it. Chromium ticket: <https://bugs.chromium.org/p/chromium/issues/detail?id=1175415>

> I believe we correctly show the domain darker than the rest of the URL in each case, but it may be easy to overlook that when what looks like a normal domain name is visually at the beginning.

Yep, the fake hostname will be more grey. That said, in some scenarios (e.g. a rogue WiFi AP), a non-ICANN hostname can be used to make Firefox stop greying out anything - e.g. [`http://xn--tib.index/test𐩖https://accounts.google.com`](http://xn--tib.index/test%F0%90%A9%96https%3A//accounts.google.com) shows as `https://accounts.google.com/...` in all black. Or, as in my examples, a very short IDN domain name can be used to make the URL appear more consistently grey (I used [U+0674](https://util.unicode.org/UnicodeJsps/character.jsp?a=%D9%B4&B1=Show) which is barely visible).

:mak Note that the port will have to be separated from the host too, otherwise it's shuffled with the domain parts. E.g.:

[`https://xn--seb.xn--9dbq2a:8080/%D7%A7%D7%95%D7%9D`](https://xn--seb.xn--9dbq2a:8080/%D7%A7%D7%95%D7%9D)

[`https://1234.xn--9dbq2a:5678/some/path`](https://1234.xn--9dbq2a:5678/some/path)

Maybe it could also be an option to fall back to punycode and/or URL-encoding the path for misbehaving URLs. Given the (possibly?) rare number of cases where this issue occurs naturally, the impact on UX may be tolerable.

Also, just adding that the examples of (2) generally apply to link hover texts, too.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a276590_159069)• 4 years ago |

See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=1175415>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a2912441_1689)• 4 years ago |

Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Summary: URL bar spoofing with bidirectional Unicode characters → URL bar spoofing with bidirectional Unicode characters (also link hover text)

|  | [Drew Willcoxon :adw](/user_profile?user_id=334927) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a25970994_334927)• 3 years ago |

Severity: -- → S3Priority: -- → P3

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a33046095_1689)• 3 years ago |

See Also: → [CVE-2021-4221](/show_bug.cgi?id=1704422 "RESOLVED FIXED - Address Bar Spoofing due to Arabic RTL characters")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a33046662_1689)• 3 years ago |

Blocks: [CVE-2023-37205](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)")

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a35450885_240353)• 3 years ago |

Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(mak)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a48766797_1689)• 2 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a71213960_159069)• 2 years ago |

Duplicate of this bug: [1832243](/show_bug.cgi?id=1832243 "RESOLVED DUPLICATE - RTL Domain Name Allows IP Spoofing")

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1690979#c8)• 2 years ago |
|  | |

(In reply to Armin Ebert [:arminius] from [comment #5](/show_bug.cgi?id=1690979#c5 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)"))

> Yep, the fake hostname will be more grey. That said, in some scenarios (e.g. a rogue WiFi AP), a non-ICANN hostname can be used to make Firefox stop greying out anything - e.g. [`http://xn--tib.index/test𐩖https://accounts.google.com`](http://xn--tib.index/test%F0%90%A9%96https%3A//accounts.google.com) shows as `https://accounts.google.com/...` in all black. Or, as in my examples, a very short IDN domain name can be used to make the URL appear more consistently grey (I used [U+0674](https://util.unicode.org/UnicodeJsps/character.jsp?a=%D9%B4&B1=Show) which is barely visible).

The highlighting has been fixed in [bug 1704420](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)").

To further improve the situation we plan to introduce a direction character when we remove the protocol ([bug 1833091](/show_bug.cgi?id=1833091 "RESOLVED FIXED - Replace direct UrlbarInput.inputField access with UrlbarInput proxies")). There may still need to be further work after that.

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][snt-scrubbed]

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a72257338_240353)• 2 years ago |

See Also: → <https://mozilla-hub.atlassian.net/browse/SNT-700>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a77741398_1689)• 1 years ago |

See Also: → [1844915](/show_bug.cgi?id=1844915 "RESOLVED DUPLICATE - Arabic IDNs allow address bar spoofing")

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a77786286_240353)• 1 years ago |

Duplicate of this bug: [1844915](/show_bug.cgi?id=1844915 "RESOLVED DUPLICATE - Arabic IDNs allow address bar spoofing")

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1690979#c10)• 1 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1690979&comment_id=16511022 "1 revision") |
|  | |

(In reply to Mark Banner (:standard8) from [comment #8](/show_bug.cgi?id=1690979#c8 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)"))

> There may still need to be further work after that.

There is further work we are doing in [bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL"), though we may have to change approach because introducing invisible characters is proving to be complicate, we must manipulate the selection and that breaks a ton of tests and may introduce regressions.

It may be possible to "simulate" the same behavior in the input field itself (we briefly discussed this with @jfkthame), but in the meanwhile we could decide to just not trim when directionality changes after trimming.

Just wanted to point out that work is ongoing.

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1690979#c11)• 1 years ago |
|  | |

See <https://bugzilla.mozilla.org/show_bug.cgi?id=1624703#c8>.

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1690979#c12)• 1 year ago |
|  | |

To sum up a bit the situation here:

1. highlighting was improved, so we don't end up not hilighting anything that may be confusing. Afaict the highlight is correct now.
2. we don't trim the protocol anymore if by doing that we end up changing the initial directionality of the URL. This is a temporary solution until we can get support in the input field itself to "force" the first character directionality (I filed [bug 1856384](/show_bug.cgi?id=1856384 "NEW - Long term solution for trimming the protocol without changing initial text directionality") for this).

The remaining things are:

1. have a clear indicator of the address bar status, whether it contains the current URI, or an edited string or a persisted search term. This is pretty much covered by [Bug 1850690](/show_bug.cgi?id=1850690 "NEW")
2. Evaluate alternative approaches for the default address bar visualization, that advanced users could disable if they wish to have normal access to full URLs. That's being discussed in [bug 1624703](/show_bug.cgi?id=1624703 "NEW").

I think we can consider this resolved, as the workarounds bring this issue on par with previous solutions (formatting and proper bidi). The remaining enhancements remain open for a continuation of the work.

Status: NEW → RESOLVEDClosed: 1 year agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1690979#c13)• 1 year ago |
|  | |

IIUC, [bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL") and [bug 1833091](/show_bug.cgi?id=1833091 "RESOLVED FIXED - Replace direct UrlbarInput.inputField access with UrlbarInput proxies") implemented the changes referenced in [comment 12](/show_bug.cgi?id=1690979#c12 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)")? Can we set the dependencies? Also, those landed in 116/117 - do we need to do any follow-up work for ESR115 still?

Group: firefox-core-security → core-security-releaseFlags: needinfo?(mak)

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1690979#c14)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1690979&comment_id=16604712 "1 revision") |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #13](/show_bug.cgi?id=1690979#c13 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)"))

> IIUC, [bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL") and [bug 1833091](/show_bug.cgi?id=1833091 "RESOLVED FIXED - Replace direct UrlbarInput.inputField access with UrlbarInput proxies") implemented the changes referenced in [comment 12](/show_bug.cgi?id=1690979#c12 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)")? Can we set the dependencies?

We usually don't link non secure bugs to secure bugs.

> Also, those landed in 116/117 - do we need to do any follow-up work for ESR115 still?

[bug 1704420](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)") is the right one for highlighting and it's fixed in 115.

[bug 1833091](/show_bug.cgi?id=1833091 "RESOLVED FIXED - Replace direct UrlbarInput.inputField access with UrlbarInput proxies") is no longer related to this issue. That was the initial plan but it ended up being really hard, so we ended up with [bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL"). So it's not necessary to uplift that work.

[Bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL") may be interesting to uplift, yes. I'll ping Marc about that.

Flags: needinfo?(mak)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1690979#c15)• 1 year ago |
|  | |

(In reply to Marco Bonardo [:mak] from [comment #14](/show_bug.cgi?id=1690979#c14 "RESOLVED FIXED - URL bar spoofing with bidirectional Unicode characters (also link hover text)"))

> We usually don't link non secure bugs to secure bugs.

That was fixed awhile ago. You can safely do so now - secure bug dependencies aren't shown to users who can't access the bugs in question.

> [bug 1704420](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)") is the right one for highlighting and it's fixed in 115.
>
> [bug 1833091](/show_bug.cgi?id=1833091 "RESOLVED FIXED - Replace direct UrlbarInput.inputField access with UrlbarInput proxies") is no longer related to this issue. That was the initial plan but it ended up being really hard, so we ended up with [bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL"). So it's not necessary to uplift that work.
>
> [Bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL") may be interesting to uplift, yes. I'll ping Marc about that.

Thanks

Assignee: nobody → mseibertNo longer blocks: [CVE-2023-37205](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)")
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)Depends on: [CVE-2023-37205](/show_bug.cgi?id=1704420 "VERIFIED FIXED - Address Bar Spoofing due to Arabic RTL characters (fix domain highlighting)"), [1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL")Target Milestone: --- → 117 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a83826602_75935)• 1 year ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [119+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=119%2B)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1690979#c16)• 1 year ago |
|  | |

[Bug 1836962](/show_bug.cgi?id=1836962 "VERIFIED FIXED - Only trim URL if directionality doesn't change to RTL") was uplifted to ESR115

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a85228365_486634)• 1 year ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][snt-scrubbed] → [reporter-external] [client-bounty-form] [verif?][snt-scrubbed][adv-ESR115.4+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1690979#c17)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9359587)
— [Details](attachment.cgi?id=9359587&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a85663221_578488)• 1 year ago |

Alias: CVE-2023-5732

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a91841454_1689)• 1 year ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1690979#a104577725_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1690979&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Armin Ebert [:arminius]](/user_profile?user_id=526160)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

