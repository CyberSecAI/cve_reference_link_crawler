- **Root cause of vulnerability**: The `ctr_get_width` function was not defined in the legacy case (`CONFIG_RISCV_PMU_LEGACY=y` and `CONFIG_RISCV_PMU_SBI=n`), leading to a NULL pointer dereference when `arch_perf_update_userpage` attempts to use it.
- **Weaknesses/vulnerabilities present**: NULL pointer dereference. The `riscv_pmu_ctr_get_width_mask` function checks `rvpmu->ctr_get_width`, however it does not handle the case when it is NULL.
- **Impact of exploitation**: Kernel crash. The system becomes unusable, requiring a reboot.
- **Attack vectors**: The vulnerability can be triggered by using `perf record` utility, which calls `arch_perf_update_userpage`, which attempts to use `ctr_get_width` on the legacy PMU which does not define this function.
- **Required attacker capabilities/position**: The attacker needs the ability to execute `perf` commands, indicating a local user with sufficient privileges.