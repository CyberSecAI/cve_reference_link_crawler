=== Content from lists.debian.org_68041af4_20250108_105220.html ===


---

[[Date Prev](msg00030.html)][[Date Next](msg00032.html)]
[[Thread Prev](msg00030.html)][[Thread Next](msg00032.html)]
[[Date Index](maillist.html#00031)]
[[Thread Index](threads.html#00031)]

# [SECURITY] [DLA 3244-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3244-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Thu, 22 Dec 2022 14:40:03 +0100
* *Message-id*: <[[游댍]](/msgid-search/4bd394b5a6656ecd24f8981d40c39b25c3cfd17d.camel%40debian.org)[4bd394b5a6656ecd24f8981d40c39b25c3cfd17d.camel@debian.org](msg00031.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3244-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
December 20, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.158-2~deb10u1
CVE ID         : CVE-2021-3759 CVE-2022-3169 CVE-2022-3435 CVE-2022-3521
                 CVE-2022-3524 CVE-2022-3564 CVE-2022-3565 CVE-2022-3594
                 CVE-2022-3628 CVE-2022-3640 CVE-2022-3643 CVE-2022-4139
                 CVE-2022-4378 CVE-2022-41849 CVE-2022-41850 CVE-2022-42328
                 CVE-2022-42329 CVE-2022-42895 CVE-2022-42896 CVE-2022-47518
                 CVE-2022-47519 CVE-2022-47520 CVE-2022-47521
Debian Bug     : 1022806 1024697

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2021-3759

    It was discovered that the memory cgroup controller did not
    account for kernel memory allocated for IPC objects.  A local user
    could use this for denial of service (memory exhaustion).

CVE-2022-3169

    It was discovered that the NVMe host driver did not prevent a
    concurrent reset and subsystem reset.  A local user with access to
    an NVMe device could use this to cause a denial of service (device
    disconnect or crash).

CVE-2022-3435

    Gwangun Jung reported a flaw in the IPv4 forwarding subsystem
    which would lead to an out-of-bounds read.  A local user with
    CAP_NET_ADMIN capability in any user namespace could possibly
    exploit this to cause a denial of service (crash).

CVE-2022-3521

    The syzbot tool found a race condition in the KCM subsystem
    which could lead to a crash.

    This subsystem is not enabled in Debian's official kernel
    configurations.

CVE-2022-3524

    The syzbot tool found a race condition in the IPv6 stack which
    could lead to a memory leak.  A local user could exploit this to
    cause a denial of service (memory exhaustion).

CVE-2022-3564

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3565

    A flaw was discovered in the mISDN driver which would lead to a
    use-after-free.  This might be exploitable to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3594

    Andrew Gaul reported that the r8152 Ethernet driver would log
    excessive numbers of messages in response to network errors.  A
    remote attacker could possibly exploit this to cause a denial of
    service (resource exhaustion).

CVE-2022-3628

    Dokyung Song, Jisoo Jang, and Minsuk Kang reported a potential
    heap-based buffer overflow in the brcmfmac Wi-Fi driver.  A user
    able to connect a malicious USB device could exploit this to cause
    a denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-3640

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3643 (XSA-423)

    A flaw was discovered in the Xen network backend driver that would
    result in it generating malformed packet buffers.  If these
    packets were forwarded to certain other network devices, a Xen
    guest could exploit this to cause a denial of service (crash or
    device reset).

CVE-2022-4139

    A flaw was discovered in the i915 graphics driver.  On gen12 "Xe"
    GPUs it failed to flush TLBs when necessary, resulting in GPU
    programs retaining access to freed memory.  A local user with
    access to the GPU could exploit this to leak sensitive
    information, cause a denial of service (crash or memory
    corruption) or likely for privilege escalation.

CVE-2022-4378

    Kyle Zeng found a flaw in procfs that would cause a stack-based
    buffer overflow.  A local user permitted to write to a sysctl
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2022-41849

    A race condition was discovered in the smscufx graphics driver,
    which could lead to a use-after-free.  A user able to remove the
    physical device while also accessing its device node could exploit
    this to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-41850

    A race condition was discovered in the hid-roccat input driver,
    which could lead to a use-after-free.  A local user able to access
    such a device could exploit this to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-42328, CVE-2022-42329 (XSA-424)

    Yang Yingliang reported that the Xen network backend driver did
    not use the proper function to free packet buffers in one case,
    which could lead to a deadlock.  A Xen guest could exploit this to
    cause a denial of service (hang).

CVE-2022-42895

    Tam치s Koczka reported a flaw in the Bluetooh L2CAP subsystem
    that would result in reading uninitialised memory.  A nearby
    attacker able to make a Bluetooth connection could exploit
    this to leak sensitive information.

CVE-2022-42896

    Tam치s Koczka reported flaws in the Bluetooh L2CAP subsystem that
    can lead to a use-after-free.  A nearby attacker able to make a
    Bluetooth SMP connection could exploit this to cause a denial of
    service (crash or memory corruption) or possibly for remote code
    execution.

CVE-2022-47518, CVE-2022-47519, CVE-2022-47521

    Several flaws were discovered in the wilc1000 Wi-Fi driver which
    could lead to a heap-based buffer overflow.  A nearby attacker
    could exploit these for denial of service (crash or memory
    corruption) or possibly for remote code execution.

CVE-2022-47520

    A flaw was discovered in the wilc1000 Wi-Fi driver which could
    lead to a heap-based buffer overflow.  A local user with
    CAP_NET_ADMIN capability over such a Wi-Fi device could exploit
    this for denial of service (crash or memory corruption) or
    possibly for privilege escalation.

For Debian 10 buster, these problems have been fixed in version
5.10.158-2~deb10u1.

We recommend that you upgrade your linux-5.10 packages.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS
teams

```

**Attachment:
[signature.asc](pgpUHfc88I3cD.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from lists.debian.org_fd6e070d_20250108_105220.html ===


---

[[Date Prev](msg00033.html)][[Date Next](msg00035.html)]
[[Thread Prev](msg00033.html)][[Thread Next](msg00035.html)]
[[Date Index](maillist.html#00034)]
[[Thread Index](threads.html#00034)]

# [SECURITY] [DLA 3245-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3245-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Fri, 23 Dec 2022 23:16:58 +0100
* *Message-id*: <[[游댍]](/msgid-search/1bbd98236848af2b95e3e5504023b5363cf93d77.camel%40debian.org)[1bbd98236848af2b95e3e5504023b5363cf93d77.camel@debian.org](msg00034.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3245-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
December 21, 2022                             <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux
Version        : 4.19.269-1
CVE ID         : CVE-2022-2978 CVE-2022-3521 CVE-2022-3524 CVE-2022-3564
                 CVE-2022-3565 CVE-2022-3594 CVE-2022-3621 CVE-2022-3628
                 CVE-2022-3640 CVE-2022-3643 CVE-2022-3646 CVE-2022-3649
                 CVE-2022-4378 CVE-2022-20369 CVE-2022-29901 CVE-2022-40768
                 CVE-2022-41849 CVE-2022-41850 CVE-2022-42328 CVE-2022-42329
                 CVE-2022-42895 CVE-2022-42896 CVE-2022-43750

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2022-2978

    "butt3rflyh4ck", Hao Sun, and Jiacheng Xu reported a flaw in the
    nilfs2 filesystem driver which can lead to a use-after-free.  A
    local use might be able to exploit this to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3521

    The syzbot tool found a race condition in the KCM subsystem
    which could lead to a crash.

    This subsystem is not enabled in Debian's official kernel
    configurations.

CVE-2022-3524

    The syzbot tool found a race condition in the IPv6 stack which
    could lead to a memory leak.  A local user could exploit this to
    cause a denial of service (memory exhaustion).

CVE-2022-3564

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3565

    A flaw was discovered in the mISDN driver which would lead to a
    use-after-free.  This might be exploitable to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2022-3594

    Andrew Gaul reported that the r8152 Ethernet driver would log
    excessive numbers of messages in response to network errors.  A
    remote attacker could possibly exploit this to cause a denial of
    service (resource exhaustion).

CVE-2022-3621, CVE-2022-3646

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a null pointer dereference or memory leak.  A user
    permitted to mount arbitrary filesystem images could use these to
    cause a denial of service (crash or resource exhaustion).

CVE-2022-3628

    Dokyung Song, Jisoo Jang, and Minsuk Kang reported a potential
    heap-based buffer overflow in the brcmfmac Wi-Fi driver.  A user
    able to connect a malicious USB device could exploit this to cause
    a denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-3640

    A flaw was discovered in the Bluetooh L2CAP subsystem which
    would lead to a use-after-free.  This might be exploitable
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-3643 (XSA-423)

    A flaw was discovered in the Xen network backend driver that would
    result in it generating malformed packet buffers.  If these
    packets were forwarded to certain other network devices, a Xen
    guest could exploit this to cause a denial of service (crash or
    device reset).

CVE-2022-3649

    The syzbot tool found flaws in the nilfs2 filesystem driver which
    can lead to a use-after-free.  A user permitted to mount arbitrary
    filesystem images could use these to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-4378

    Kyle Zeng found a flaw in procfs that would cause a stack-based
    buffer overflow.  A local user permitted to write to a sysctl
    could use this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2022-20369

    A flaw was found in the v4l2-mem2mem media driver that would lead
    to an out-of-bounds write.  A local user with access to such a
    device could exploit this for privilege escalation.

CVE-2022-29901

    Johannes Wikner and Kaveh Razavi reported that for Intel
    processors (Intel Core generation 6, 7 and 8), protections against
    speculative branch target injection attacks were insufficient in
    some circumstances, which may allow arbitrary speculative code
    execution under certain microarchitecture-dependent conditions.

    More information can be found at
    <https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/advisory-guidance/return-stack-buffer-underflow.html>

CVE-2022-40768

    "hdthky" reported that the stex SCSI adapter driver did not fully
    initialise a structure that is copied to user-space.  A local user
    with access to such a device could exploit this to leak sensitive
    information.

CVE-2022-41849

    A race condition was discovered in the smscufx graphics driver,
    which could lead to a use-after-free.  A user able to remove the
    physical device while also accessing its device node could exploit
    this to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2022-41850

    A race condition was discovered in the hid-roccat input driver,
    which could lead to a use-after-free.  A local user able to access
    such a device could exploit this to cause a denial of service
    (crash or memory corruption) or possibly for privilege escalation.

CVE-2022-42328, CVE-2022-42329 (XSA-424)

    Yang Yingliang reported that the Xen network backend driver did
    not use the proper function to free packet buffers in one case,
    which could lead to a deadlock.  A Xen guest could exploit this to
    cause a denial of service (hang).

CVE-2022-42895

    Tam치s Koczka reported a flaw in the Bluetooh L2CAP subsystem
    that would result in reading uninitialised memory.  A nearby
    attacker able to make a Bluetooth connection could exploit
    this to leak sensitive information.

CVE-2022-42896

    Tam치s Koczka reported flaws in the Bluetooh L2CAP subsystem that
    can lead to a use-after-free.  A nearby attacker able to make a
    Bluetooth SMP connection could exploit this to cause a denial of
    service (crash or memory corruption) or possibly for remote code
    execution.

CVE-2022-43750

    The syzbot tool found that the USB monitor (usbmon) driver allowed
    user-space programs to overwrite the driver's data structures.  A
    local user permitted to access a USB monitor device could exploit
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.  However, by default only the
    root user can access such devices.

For Debian 10 buster, these problems have been fixed in version
4.19.269-1.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS
teams

```

**Attachment:
[signature.asc](pgpJBRnFmtPRG.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from www.openwall.com_e2f8329a_20250108_105220.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2022/12/09/1) [[<thread-prev]](2) [[thread-next>]](../../../2022/12/09/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <e22fcdce-f029-de46-81a6-60f5ffc9c9a2@suse.com>
Date: Thu, 8 Dec 2022 17:12:32 +0100
From: Juergen Gross <jgross@...e.com>
To: Pratyush Yadav <ptyadav@...zon.de>,
 "Xen.org security team" <security@....org>
Cc: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com,
 "Xen.org security team" <security-team-members@....org>
Subject: Re: Xen Security Advisory 424 v1 (CVE-2022-42328,CVE-2022-42329) -
 Guests can trigger deadlock in Linux netback driver

On 08.12.22 16:59, Pratyush Yadav wrote:
>
> Hi,
>
> I noticed one interesting thing about this patch but I'm not familiar
> enough with the driver to say for sure what the right thing is.
>
> On Tue, Dec 06 2022, Xen.org security team wrote:
>
> [...]
>>
>>  From cfdf8fd81845734b6152b4617746c1127ec52228 Mon Sep 17 00:00:00 2001
>> From: Juergen Gross <jgross@...e.com>
>> Date: Tue, 6 Dec 2022 08:54:24 +0100
>> Subject: [PATCH] xen/netback: don't call kfree_skb() with interrupts disabled
>>
>> It is not allowed to call kfree_skb() from hardware interrupt
>> context or with interrupts being disabled. So remove kfree_skb()
>> from the spin_lock_irqsave() section and use the already existing
>> "drop" label in xenvif_start_xmit() for dropping the SKB. At the
>> same time replace the dev_kfree_skb() call there with a call of
>> dev_kfree_skb_any(), as xenvif_start_xmit() can be called with
>> disabled interrupts.
>>
>> This is XSA-424 / CVE-2022-42328 / CVE-2022-42329.
>>
>> Fixes: be81992f9086 ("xen/netback: don't queue unlimited number of packages")
>> Reported-by: Yang Yingliang <yangyingliang@...wei.com>
>> Signed-off-by: Juergen Gross <jgross@...e.com>
>> Reviewed-by: Jan Beulich <jbeulich@...e.com>
>> ---
>>   drivers/net/xen-netback/common.h    | 2 +-
>>   drivers/net/xen-netback/interface.c | 6 ++++--
>>   drivers/net/xen-netback/rx.c        | 8 +++++---
>>   3 files changed, 10 insertions(+), 6 deletions(-)
>>
>> diff --git a/drivers/net/xen-netback/common.h b/drivers/net/xen-netback/common.h
>> index 1545cbee77a4..3dbfc8a6924e 100644
>> --- a/drivers/net/xen-netback/common.h
>> +++ b/drivers/net/xen-netback/common.h
>> @@ -386,7 +386,7 @@ int xenvif_dealloc_kthread(void *data);
>>   irqreturn_t xenvif_ctrl_irq_fn(int irq, void *data);
>>
>>   bool xenvif_have_rx_work(struct xenvif_queue *queue, bool test_kthread);
>> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
>> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
>>
>>   void xenvif_carrier_on(struct xenvif *vif);
>>
>> diff --git a/drivers/net/xen-netback/interface.c b/drivers/net/xen-netback/interface.c
>> index 650fa180220f..f3f2c07423a6 100644
>> --- a/drivers/net/xen-netback/interface.c
>> +++ b/drivers/net/xen-netback/interface.c
>> @@ -254,14 +254,16 @@ xenvif_start_xmit(struct sk_buff *skb, struct net_device *dev)
>>   	if (vif->hash.alg == XEN_NETIF_CTRL_HASH_ALGORITHM_NONE)
>>   		skb_clear_hash(skb);
>>
>> -	xenvif_rx_queue_tail(queue, skb);
>> +	if (!xenvif_rx_queue_tail(queue, skb))
>> +		goto drop;
>> +
>>   	xenvif_kick_thread(queue);
>>
>>   	return NETDEV_TX_OK;
>>
>>    drop:
>>   	vif->dev->stats.tx_dropped++;
>
> Now tx_dropped is incremented on packet drop...
>
>> -	dev_kfree_skb(skb);
>> +	dev_kfree_skb_any(skb);
>>   	return NETDEV_TX_OK;
>>   }
>>
>> diff --git a/drivers/net/xen-netback/rx.c b/drivers/net/xen-netback/rx.c
>> index 932762177110..0ba754ebc5ba 100644
>> --- a/drivers/net/xen-netback/rx.c
>> +++ b/drivers/net/xen-netback/rx.c
>> @@ -82,9 +82,10 @@ static bool xenvif_rx_ring_slots_available(struct xenvif_queue *queue)
>>   	return false;
>>   }
>>
>> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>>   {
>>   	unsigned long flags;
>> +	bool ret = true;
>>
>>   	spin_lock_irqsave(&queue->rx_queue.lock, flags);
>>
>> @@ -92,8 +93,7 @@ void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>>   		struct net_device *dev = queue->vif->dev;
>>
>>   		netif_tx_stop_queue(netdev_get_tx_queue(dev, queue->id));
>> -		kfree_skb(skb);
>> -		queue->vif->dev->stats.rx_dropped++;
>
> ... but earlier rx_dropped was incremented.
>
> Which one is actually correct? This line was added by be81992f9086b
> ("xen/netback: don't queue unlimited number of packages"), which was the
> fix for XSA-392. I think incrementing tx_dropped is the right thing to
> do, as was done before XSA-392 but it would be nice if someone else
> takes a look at this as well.

Yes, I think the XSA-392 patch was wrong in this regard.

Juergen

Download attachment "[OpenPGP_0xB0DE9DD628BF132F.asc](3/1)" of type "application/pgp-keys" (3099 bytes)

Download attachment "[OpenPGP_signature](3/2)" of type "application/pgp-signature" (496 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_156b6702_20250108_105220.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2022/12/13/1) [[<thread-prev]](../../../2022/12/08/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAG7k0EpOz=X8AFw-wE-0OEA98_w77PNmVg_AE-R8mc7sBcsr9w@mail.gmail.com>
Date: Fri, 9 Dec 2022 16:54:41 +0000
From: Ross Lagerwall <ross.lagerwall@...ud.com>
To: Juergen Gross <jgross@...e.com>
Cc: Pratyush Yadav <ptyadav@...zon.de>, "Xen.org security team" <security@....org>, xen-announce@...ts.xen.org,
	xen-devel@...ts.xen.org, xen-users@...ts.xen.org,
	oss-security@...ts.openwall.com,
	"Xen.org security team" <security-team-members@....org>
Subject: Re: Xen Security Advisory 424 v1 (CVE-2022-42328,CVE-2022-42329) -
 Guests can trigger deadlock in Linux netback driver

On Thu, Dec 8, 2022 at 4:13 PM Juergen Gross <jgross@...e.com> wrote:
>
> On 08.12.22 16:59, Pratyush Yadav wrote:
> >
> > Hi,
> >
> > I noticed one interesting thing about this patch but I'm not familiar
> > enough with the driver to say for sure what the right thing is.
> >
> > On Tue, Dec 06 2022, Xen.org security team wrote:
> >
> > [...]
> >>
> >>  From cfdf8fd81845734b6152b4617746c1127ec52228 Mon Sep 17 00:00:00 2001
> >> From: Juergen Gross <jgross@...e.com>
> >> Date: Tue, 6 Dec 2022 08:54:24 +0100
> >> Subject: [PATCH] xen/netback: don't call kfree_skb() with interrupts disabled
> >>
> >> It is not allowed to call kfree_skb() from hardware interrupt
> >> context or with interrupts being disabled. So remove kfree_skb()
> >> from the spin_lock_irqsave() section and use the already existing
> >> "drop" label in xenvif_start_xmit() for dropping the SKB. At the
> >> same time replace the dev_kfree_skb() call there with a call of
> >> dev_kfree_skb_any(), as xenvif_start_xmit() can be called with
> >> disabled interrupts.
> >>
> >> This is XSA-424 / CVE-2022-42328 / CVE-2022-42329.
> >>
> >> Fixes: be81992f9086 ("xen/netback: don't queue unlimited number of packages")
> >> Reported-by: Yang Yingliang <yangyingliang@...wei.com>
> >> Signed-off-by: Juergen Gross <jgross@...e.com>
> >> Reviewed-by: Jan Beulich <jbeulich@...e.com>
> >> ---
> >>   drivers/net/xen-netback/common.h    | 2 +-
> >>   drivers/net/xen-netback/interface.c | 6 ++++--
> >>   drivers/net/xen-netback/rx.c        | 8 +++++---
> >>   3 files changed, 10 insertions(+), 6 deletions(-)
> >>
> >> diff --git a/drivers/net/xen-netback/common.h b/drivers/net/xen-netback/common.h
> >> index 1545cbee77a4..3dbfc8a6924e 100644
> >> --- a/drivers/net/xen-netback/common.h
> >> +++ b/drivers/net/xen-netback/common.h
> >> @@ -386,7 +386,7 @@ int xenvif_dealloc_kthread(void *data);
> >>   irqreturn_t xenvif_ctrl_irq_fn(int irq, void *data);
> >>
> >>   bool xenvif_have_rx_work(struct xenvif_queue *queue, bool test_kthread);
> >> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
> >> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
> >>
> >>   void xenvif_carrier_on(struct xenvif *vif);
> >>
> >> diff --git a/drivers/net/xen-netback/interface.c b/drivers/net/xen-netback/interface.c
> >> index 650fa180220f..f3f2c07423a6 100644
> >> --- a/drivers/net/xen-netback/interface.c
> >> +++ b/drivers/net/xen-netback/interface.c
> >> @@ -254,14 +254,16 @@ xenvif_start_xmit(struct sk_buff *skb, struct net_device *dev)
> >>      if (vif->hash.alg == XEN_NETIF_CTRL_HASH_ALGORITHM_NONE)
> >>              skb_clear_hash(skb);
> >>
> >> -    xenvif_rx_queue_tail(queue, skb);
> >> +    if (!xenvif_rx_queue_tail(queue, skb))
> >> +            goto drop;
> >> +
> >>      xenvif_kick_thread(queue);
> >>
> >>      return NETDEV_TX_OK;
> >>
> >>    drop:
> >>      vif->dev->stats.tx_dropped++;
> >
> > Now tx_dropped is incremented on packet drop...
> >
> >> -    dev_kfree_skb(skb);
> >> +    dev_kfree_skb_any(skb);
> >>      return NETDEV_TX_OK;
> >>   }
> >>
> >> diff --git a/drivers/net/xen-netback/rx.c b/drivers/net/xen-netback/rx.c
> >> index 932762177110..0ba754ebc5ba 100644
> >> --- a/drivers/net/xen-netback/rx.c
> >> +++ b/drivers/net/xen-netback/rx.c
> >> @@ -82,9 +82,10 @@ static bool xenvif_rx_ring_slots_available(struct xenvif_queue *queue)
> >>      return false;
> >>   }
> >>
> >> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
> >> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
> >>   {
> >>      unsigned long flags;
> >> +    bool ret = true;
> >>
> >>      spin_lock_irqsave(&queue->rx_queue.lock, flags);
> >>
> >> @@ -92,8 +93,7 @@ void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
> >>              struct net_device *dev = queue->vif->dev;
> >>
> >>              netif_tx_stop_queue(netdev_get_tx_queue(dev, queue->id));
> >> -            kfree_skb(skb);
> >> -            queue->vif->dev->stats.rx_dropped++;
> >
> > ... but earlier rx_dropped was incremented.
> >
> > Which one is actually correct? This line was added by be81992f9086b
> > ("xen/netback: don't queue unlimited number of packages"), which was the
> > fix for XSA-392. I think incrementing tx_dropped is the right thing to
> > do, as was done before XSA-392 but it would be nice if someone else
> > takes a look at this as well.
>
> Yes, I think the XSA-392 patch was wrong in this regard.
>

Netback calls this rx (to-guest) traffic so rx_dropped seems better. On the
other hand, the networking stack thinks of this as tx since the packet is going
from the networking stack to the NIC driver...

Regardless, it is currently inconsistent since to-guest traffic increments
tx_dropped if it is dropped because the rx queue len is too long but it
increments rx_dropped if those same packets are dropped when they expire in the
rx queue.

I also see that the tx path (from-guest) doesn't increment any dropped counters
when it drops a packet.

Ross

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from xenbits.xenproject.org_cd6eefa1_20250108_105221.html ===
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256
Xen Security Advisory CVE-2022-42328,CVE-2022-42329 / XSA-424
Guests can trigger deadlock in Linux netback driver
ISSUE DESCRIPTION
=================
The patch for XSA-392 introduced another issue which might result in
a deadlock when trying to free the SKB of a packet dropped due to
the XSA-392 handling (CVE-2022-42328).
Additionally when dropping packages for other reasons the same
deadlock could occur in case of netpoll being active for the interface
the xen-netback driver is connected to (CVE-2022-42329).
IMPACT
======
A malicious guest could cause Denial of Service (DoS) of the host via
the paravirtualized network interface.
VULNERABLE SYSTEMS
==================
All systems using the Linux kernel based network backend xen-netback
are vulnerable.
MITIGATION
==========
Using another PV network backend (e.g. the qemu based "qnic" backend)
will mitigate the problem.
Using a dedicated network driver domain per guest will mitigate the
problem.
NOTE REGARDING LACK OF EMBARGO
==============================
This issue was discussed in public already.
RESOLUTION
==========
Applying the attached patch resolves this issue.
xsa424-linux.patch Linux 6.0, 6.1-rc
$ sha256sum xsa424\*
89db7cad9694f498c4ac450356932fb69fb514162e07aea0343776effa821fc8 xsa424-linux.patch
$
-----BEGIN PGP SIGNATURE-----
iQFABAEBCAAqFiEEI+MiLBRfRHX6gGCng/4UyVfoK9kFAmOPXKYMHHBncEB4ZW4u
b3JnAAoJEIP+FMlX6CvZ30IH/1GZwPXXAqMjN3d1n7BotiDLfmDiNp8e92wvQvmh
cXgsBtvTZ+oDzI7J+Xr/42c4IN41s34fWl0hmNbdrw4lwrOSoj0rnCP73Bn22oUT
jbv3bmFOHytCs5crvVrA4S7dCNcdpoEmfOoSaz1cBPhMecotlgTQo7M2Cagv3O9a
a9fR+KGMk9EBDGdo2wBJyEcD9ApASPEV+LJgLoTOuYFIStCO/+TTBfJx5H7T/vgK
Dqxsq1nULCSBc5Z5wrmtF49G3asBrAbPTkRhpyp9giXU+UV0QNJclnc+IJPdLIOe
jISAvpHQ3Fkb7Q25jaBg+c0bf9KzT3ekBOaf1RofgA84Jg0=
=4J/5
-----END PGP SIGNATURE-----


=== Content from www.openwall.com_374e35dc_20250108_105220.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2022/12/06/2) [[thread-next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <mafs0lenhlwcv.fsf@dev-dsk-ptyadav-1c-37607b33.eu-west-1.amazon.com>
Date: Thu, 8 Dec 2022 16:59:44 +0100
From: Pratyush Yadav <ptyadav@...zon.de>
To: Xen.org security team <security@....org>
CC: <xen-announce@...ts.xen.org>, <xen-devel@...ts.xen.org>,
	<xen-users@...ts.xen.org>, <oss-security@...ts.openwall.com>, "Xen.org
 security team" <security-team-members@....org>
Subject: Re: Xen Security Advisory 424 v1 (CVE-2022-42328,CVE-2022-42329) -
 Guests can trigger deadlock in Linux netback driver

Hi,

I noticed one interesting thing about this patch but I'm not familiar
enough with the driver to say for sure what the right thing is.

On Tue, Dec 06 2022, Xen.org security team wrote:

[...]
>
> From cfdf8fd81845734b6152b4617746c1127ec52228 Mon Sep 17 00:00:00 2001
> From: Juergen Gross <jgross@...e.com>
> Date: Tue, 6 Dec 2022 08:54:24 +0100
> Subject: [PATCH] xen/netback: don't call kfree_skb() with interrupts disabled
>
> It is not allowed to call kfree_skb() from hardware interrupt
> context or with interrupts being disabled. So remove kfree_skb()
> from the spin_lock_irqsave() section and use the already existing
> "drop" label in xenvif_start_xmit() for dropping the SKB. At the
> same time replace the dev_kfree_skb() call there with a call of
> dev_kfree_skb_any(), as xenvif_start_xmit() can be called with
> disabled interrupts.
>
> This is XSA-424 / CVE-2022-42328 / CVE-2022-42329.
>
> Fixes: be81992f9086 ("xen/netback: don't queue unlimited number of packages")
> Reported-by: Yang Yingliang <yangyingliang@...wei.com>
> Signed-off-by: Juergen Gross <jgross@...e.com>
> Reviewed-by: Jan Beulich <jbeulich@...e.com>
> ---
>  drivers/net/xen-netback/common.h    | 2 +-
>  drivers/net/xen-netback/interface.c | 6 ++++--
>  drivers/net/xen-netback/rx.c        | 8 +++++---
>  3 files changed, 10 insertions(+), 6 deletions(-)
>
> diff --git a/drivers/net/xen-netback/common.h b/drivers/net/xen-netback/common.h
> index 1545cbee77a4..3dbfc8a6924e 100644
> --- a/drivers/net/xen-netback/common.h
> +++ b/drivers/net/xen-netback/common.h
> @@ -386,7 +386,7 @@ int xenvif_dealloc_kthread(void *data);
>  irqreturn_t xenvif_ctrl_irq_fn(int irq, void *data);
>
>  bool xenvif_have_rx_work(struct xenvif_queue *queue, bool test_kthread);
> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb);
>
>  void xenvif_carrier_on(struct xenvif *vif);
>
> diff --git a/drivers/net/xen-netback/interface.c b/drivers/net/xen-netback/interface.c
> index 650fa180220f..f3f2c07423a6 100644
> --- a/drivers/net/xen-netback/interface.c
> +++ b/drivers/net/xen-netback/interface.c
> @@ -254,14 +254,16 @@ xenvif_start_xmit(struct sk_buff *skb, struct net_device *dev)
>  	if (vif->hash.alg == XEN_NETIF_CTRL_HASH_ALGORITHM_NONE)
>  		skb_clear_hash(skb);
>
> -	xenvif_rx_queue_tail(queue, skb);
> +	if (!xenvif_rx_queue_tail(queue, skb))
> +		goto drop;
> +
>  	xenvif_kick_thread(queue);
>
>  	return NETDEV_TX_OK;
>
>   drop:
>  	vif->dev->stats.tx_dropped++;

Now tx_dropped is incremented on packet drop...

> -	dev_kfree_skb(skb);
> +	dev_kfree_skb_any(skb);
>  	return NETDEV_TX_OK;
>  }
>
> diff --git a/drivers/net/xen-netback/rx.c b/drivers/net/xen-netback/rx.c
> index 932762177110..0ba754ebc5ba 100644
> --- a/drivers/net/xen-netback/rx.c
> +++ b/drivers/net/xen-netback/rx.c
> @@ -82,9 +82,10 @@ static bool xenvif_rx_ring_slots_available(struct xenvif_queue *queue)
>  	return false;
>  }
>
> -void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
> +bool xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>  {
>  	unsigned long flags;
> +	bool ret = true;
>
>  	spin_lock_irqsave(&queue->rx_queue.lock, flags);
>
> @@ -92,8 +93,7 @@ void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>  		struct net_device *dev = queue->vif->dev;
>
>  		netif_tx_stop_queue(netdev_get_tx_queue(dev, queue->id));
> -		kfree_skb(skb);
> -		queue->vif->dev->stats.rx_dropped++;

... but earlier rx_dropped was incremented.

Which one is actually correct? This line was added by be81992f9086b
("xen/netback: don't queue unlimited number of packages"), which was the
fix for XSA-392. I think incrementing tx_dropped is the right thing to
do, as was done before XSA-392 but it would be nice if someone else
takes a look at this as well.

> +		ret = false;
>  	} else {
>  		if (skb_queue_empty(&queue->rx_queue))
>  			xenvif_update_needed_slots(queue, skb);
> @@ -104,6 +104,8 @@ void xenvif_rx_queue_tail(struct xenvif_queue *queue, struct sk_buff *skb)
>  	}
>
>  	spin_unlock_irqrestore(&queue->rx_queue.lock, flags);
> +
> +	return ret;
>  }
>
>  static struct sk_buff *xenvif_rx_dequeue(struct xenvif_queue *queue)

--
Regards,
Pratyush Yadav

Amazon Development Center Germany GmbH
Krausenstr. 38
10117 Berlin
Geschaeftsfuehrung: Christian Schlaeger, Jonathan Weiss
Eingetragen am Amtsgericht Charlottenburg unter HRB 149173 B
Sitz: Berlin
Ust-ID: DE 289 237 879

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


