

| [cgit logo](/) | [index](/) : [wireless/iwd.git](/pub/scm/network/wireless/iwd.git/) | master |
| --- | --- | --- |
| Wireless daemon for Linux | Marcel Holtmann |

| [about](/pub/scm/network/wireless/iwd.git/about/)[summary](/pub/scm/network/wireless/iwd.git/)[refs](/pub/scm/network/wireless/iwd.git/refs/?id=52a47c9fd428904de611a90cbf8b223af879684d)[log](/pub/scm/network/wireless/iwd.git/log/)[tree](/pub/scm/network/wireless/iwd.git/tree/?id=52a47c9fd428904de611a90cbf8b223af879684d)[commit](/pub/scm/network/wireless/iwd.git/commit/?id=52a47c9fd428904de611a90cbf8b223af879684d)[diff](/pub/scm/network/wireless/iwd.git/diff/?id=52a47c9fd428904de611a90cbf8b223af879684d)[stats](/pub/scm/network/wireless/iwd.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | James Prestwood <prestwoj@gmail.com> | 2024-02-29 09:07:32 -0800 |
| --- | --- | --- |
| committer | Denis Kenzior <denkenz@gmail.com> | 2024-02-29 14:32:53 -0600 |
| commit | [52a47c9fd428904de611a90cbf8b223af879684d](/pub/scm/network/wireless/iwd.git/commit/?id=52a47c9fd428904de611a90cbf8b223af879684d) ([patch](/pub/scm/network/wireless/iwd.git/patch/?id=52a47c9fd428904de611a90cbf8b223af879684d)) | |
| tree | [91836cf1416d9cc7211d1e65e8dcb2aa0343c118](/pub/scm/network/wireless/iwd.git/tree/?id=52a47c9fd428904de611a90cbf8b223af879684d) | |
| parent | [816d258cab66a99a3930d2812a67030ecf883d9e](/pub/scm/network/wireless/iwd.git/commit/?id=816d258cab66a99a3930d2812a67030ecf883d9e) ([diff](/pub/scm/network/wireless/iwd.git/diff/?id=52a47c9fd428904de611a90cbf8b223af879684d&id2=816d258cab66a99a3930d2812a67030ecf883d9e)) | |

p2putil: fix crash/remove side effect parsing adv service infoThe input queue pointer was being initialized unconditionally so if
parsing fails the out pointer is still set after the queue is
destroyed. This causes a crash during cleanup.
Instead use a temporary pointer while parsing and only after parsing
has finished do we set the out pointer.
Reported-By: Alex Radocea <alex@supernetworks.org>
[Diffstat](/pub/scm/network/wireless/iwd.git/diff/?id=52a47c9fd428904de611a90cbf8b223af879684d)

| -rw-r--r-- | [src/p2putil.c](/pub/scm/network/wireless/iwd.git/diff/src/p2putil.c?id=52a47c9fd428904de611a90cbf8b223af879684d) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 5 deletions

| diff --git a/src/p2putil.c b/src/p2putil.cindex 5313b34cc..faf151a5f 100644--- a/[src/p2putil.c](/pub/scm/network/wireless/iwd.git/tree/src/p2putil.c?id=816d258cab66a99a3930d2812a67030ecf883d9e)+++ b/[src/p2putil.c](/pub/scm/network/wireless/iwd.git/tree/src/p2putil.c?id=52a47c9fd428904de611a90cbf8b223af879684d)@@ -541,7 +541,8 @@ static void p2p\_clear\_advertised\_service\_descriptor(void \*data) static bool extract\_p2p\_advertised\_service\_info(const uint8\_t \*attr, size\_t len, void \*data) {- struct l\_queue \*\*out = data;+ struct l\_queue \*\*q = data;+ struct l\_queue \*out = NULL;  while (len) { struct p2p\_advertised\_service\_descriptor \*desc;@@ -557,11 +558,11 @@ static bool extract\_p2p\_advertised\_service\_info(const uint8\_t \*attr, size\_t len, if (!l\_utf8\_validate((const char \*) attr + 7, name\_len, NULL)) goto error; - if (!\*out)- \*out = l\_queue\_new();+ if (!out)+ out = l\_queue\_new();  desc = l\_new(struct p2p\_advertised\_service\_descriptor, 1);- l\_queue\_push\_tail(\*out, desc);+ l\_queue\_push\_tail(out, desc);  desc->advertisement\_id = l\_get\_le32(attr + 0); desc->wsc\_config\_methods = l\_get\_be16(attr + 4);@@ -572,10 +573,12 @@ static bool extract\_p2p\_advertised\_service\_info(const uint8\_t \*attr, size\_t len, len -= 7 + name\_len; } + \*q = out;+ return true;  error:- l\_queue\_destroy(\*out, p2p\_clear\_advertised\_service\_descriptor);+ l\_queue\_destroy(out, p2p\_clear\_advertised\_service\_descriptor); return false; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:54:57 +0000

