=== Content from git.kernel.org_d33a9aa8_20250110_170859.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:10:39 +0200 |
| commit | [1afed66cb271b3e65fe9df1c9fba2bf4b1f55669](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)) | |
| tree | [ac7fefe6435eee22d3eed9e4d96751df4fc4d9fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669) | |
| parent | [a15df5f37fa3a8b7a8ec7a339d1e897bc524e28f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a15df5f37fa3a8b7a8ec7a339d1e897bc524e28f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669&id2=a15df5f37fa3a8b7a8ec7a339d1e897bc524e28f)) | |
| download | [linux-1afed66cb271b3e65fe9df1c9fba2bf4b1f55669.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1afed66cb271b3e65fe9df1c9fba2bf4b1f55669.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex fa7de3e47b8cce..0e2841fc84dcdf 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=a15df5f37fa3a8b7a8ec7a339d1e897bc524e28f)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=1afed66cb271b3e65fe9df1c9fba2bf4b1f55669)@@ -4776,6 +4776,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -4857,8 +4861,11 @@ static void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:37 +0000



=== Content from git.kernel.org_a9d4d3db_20250110_170903.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:07:35 +0200 |
| commit | [de46b1d24f5f752b3bd8b46673c2ea4239661244](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)) | |
| tree | [8fe01f1b40ae378a1dbbb245680bbc3222a8c5b4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244) | |
| parent | [db81677f4b6cbf4baa4b5ce357370e88de7f5002](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=db81677f4b6cbf4baa4b5ce357370e88de7f5002) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244&id2=db81677f4b6cbf4baa4b5ce357370e88de7f5002)) | |
| download | [linux-de46b1d24f5f752b3bd8b46673c2ea4239661244.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-de46b1d24f5f752b3bd8b46673c2ea4239661244.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=de46b1d24f5f752b3bd8b46673c2ea4239661244) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 08008b0c0637cd..fa784d83529012 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=db81677f4b6cbf4baa4b5ce357370e88de7f5002)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=de46b1d24f5f752b3bd8b46673c2ea4239661244)@@ -4747,6 +4747,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -4828,8 +4832,11 @@ static void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:40 +0000



=== Content from git.kernel.org_3d6d1899_20250110_170901.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-30 16:25:10 +0200 |
| commit | [4d0a900ec470d392476c428875dbf053f8a0ae5e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)) | |
| tree | [2d53472b14a9b70904b4fecf7b9e5bf5b1e6c668](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e) | |
| parent | [2c61b561baf92a2860c76c2302a62169e22c21cc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2c61b561baf92a2860c76c2302a62169e22c21cc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e&id2=2c61b561baf92a2860c76c2302a62169e22c21cc)) | |
| download | [linux-4d0a900ec470d392476c428875dbf053f8a0ae5e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4d0a900ec470d392476c428875dbf053f8a0ae5e.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=4d0a900ec470d392476c428875dbf053f8a0ae5e) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex f973efbbc3795e..d2daea3b1f38ad 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=2c61b561baf92a2860c76c2302a62169e22c21cc)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=4d0a900ec470d392476c428875dbf053f8a0ae5e)@@ -5589,6 +5589,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -5673,8 +5677,11 @@ void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw, struct ieee80211\_vif \*vif,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:38 +0000



=== Content from git.kernel.org_e7899dbc_20250110_170902.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7188b7a72320367554b76d8f298417b070b05dd3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7188b7a72320367554b76d8f298417b070b05dd3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7188b7a72320367554b76d8f298417b070b05dd3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7188b7a72320367554b76d8f298417b070b05dd3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-30 16:29:29 +0200 |
| commit | [7188b7a72320367554b76d8f298417b070b05dd3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7188b7a72320367554b76d8f298417b070b05dd3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7188b7a72320367554b76d8f298417b070b05dd3)) | |
| tree | [0cd733ca5dd5ddd431521d5af0347b73cef1c6a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7188b7a72320367554b76d8f298417b070b05dd3) | |
| parent | [55086c97a55d781b04a2667401c75ffde190135c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55086c97a55d781b04a2667401c75ffde190135c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7188b7a72320367554b76d8f298417b070b05dd3&id2=55086c97a55d781b04a2667401c75ffde190135c)) | |
| download | [linux-7188b7a72320367554b76d8f298417b070b05dd3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7188b7a72320367554b76d8f298417b070b05dd3.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7188b7a72320367554b76d8f298417b070b05dd3)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=7188b7a72320367554b76d8f298417b070b05dd3) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 259afecd1a98da..83551d962a46c4 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=55086c97a55d781b04a2667401c75ffde190135c)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=7188b7a72320367554b76d8f298417b070b05dd3)@@ -5819,6 +5819,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -5914,8 +5918,11 @@ void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw, struct ieee80211\_vif \*vif,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:39 +0000



=== Content from git.kernel.org_3e2d145b_20250110_170902.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:19:03 +0100 |
| commit | [ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)) | |
| tree | [653b7bd8a72e5a3e2930d16488bf7f455eb0838e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3) | |
| parent | [f4eb52b18a74812151105b6e0afe640a74eeebfa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f4eb52b18a74812151105b6e0afe640a74eeebfa) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3&id2=f4eb52b18a74812151105b6e0afe640a74eeebfa)) | |
| download | [linux-ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 3f37fb64e71c24..3c00a737c4b346 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=f4eb52b18a74812151105b6e0afe640a74eeebfa)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=ad2fcc2daa203a6ad491f00e9ae3b7867e8fe0f3)@@ -4326,6 +4326,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -4407,8 +4411,11 @@ static void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:40 +0000



=== Content from git.kernel.org_6c21f8eb_20250110_170859.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-08 16:20:25 +0100 |
| commit | [16c1e5d5228f26f120e12e6ca55c59c3a5e6dece](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)) | |
| tree | [3b8f62d3a231accc4a8c866d2093c8817dba40b5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece) | |
| parent | [5fa62c3fffa7731ee92a2167b7360d8274777d4d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5fa62c3fffa7731ee92a2167b7360d8274777d4d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece&id2=5fa62c3fffa7731ee92a2167b7360d8274777d4d)) | |
| download | [linux-16c1e5d5228f26f120e12e6ca55c59c3a5e6dece.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-16c1e5d5228f26f120e12e6ca55c59c3a5e6dece.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 3c523774ef0e6a..c8c884bb5090e1 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=5fa62c3fffa7731ee92a2167b7360d8274777d4d)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=16c1e5d5228f26f120e12e6ca55c59c3a5e6dece)@@ -4666,6 +4666,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -4747,8 +4751,11 @@ static void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:36 +0000



=== Content from git.kernel.org_1d9fe4fd_20250110_170900.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-30 16:23:48 +0200 |
| commit | [1b0cd832c9607f41f84053b818e0b7908510a3b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)) | |
| tree | [2cca136a0ecfa4147a2481915c11840c6676e78c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9) | |
| parent | [5948a191906b54e10f02f6b7a7670243a39f99f4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5948a191906b54e10f02f6b7a7670243a39f99f4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9&id2=5948a191906b54e10f02f6b7a7670243a39f99f4)) | |
| download | [linux-1b0cd832c9607f41f84053b818e0b7908510a3b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1b0cd832c9607f41f84053b818e0b7908510a3b9.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is dead[ Upstream commit 3a84454f5204718ca5b4ad2c1f0bf2031e2403d1 ]
There is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=1b0cd832c9607f41f84053b818e0b7908510a3b9) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 4e8bdd3d701bf2..bd4301857ba87f 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=5948a191906b54e10f02f6b7a7670243a39f99f4)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=1b0cd832c9607f41f84053b818e0b7908510a3b9)@@ -4800,6 +4800,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { mutex\_lock(&mvm->mutex); iwl\_mvm\_flush\_tx\_path(mvm,@@ -4881,8 +4885,11 @@ static void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:37 +0000



=== Content from git.kernel.org_a3b80666_20250110_170900.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emmanuel Grumbach <emmanuel.grumbach@intel.com> | 2024-08-25 19:17:04 +0300 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-08-26 17:42:38 +0200 |
| commit | [3a84454f5204718ca5b4ad2c1f0bf2031e2403d1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)) | |
| tree | [581b2dada400839f6fd835cb5c0f916ddf157667](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1) | |
| parent | [454f6306a31248cf972f5f16d4c145ad5b33bfdc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=454f6306a31248cf972f5f16d4c145ad5b33bfdc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1&id2=454f6306a31248cf972f5f16d4c145ad5b33bfdc)) | |
| download | [linux-3a84454f5204718ca5b4ad2c1f0bf2031e2403d1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3a84454f5204718ca5b4ad2c1f0bf2031e2403d1.tar.gz) | |

wifi: iwlwifi: mvm: don't wait for tx queues if firmware is deadThere is a WARNING in iwl\_trans\_wait\_tx\_queues\_empty() (that was
recently converted from just a message), that can be hit if we
wait for TX queues to become empty after firmware died. Clearly,
we can't expect anything from the firmware after it's declared dead.
Don't call iwl\_trans\_wait\_tx\_queues\_empty() in this case. While it could
be a good idea to stop the flow earlier, the flush functions do some
maintenance work that is not related to the firmware, so keep that part
of the code running even when the firmware is not running.
Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6@changeid](https://patch.msgid.link/20240825191257.a7cbd794cee9.I44a739fbd4ffcc46b83844dd1c7b2eb0c7b270f6%40changeid)
[edit commit message]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c b/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.cindex 835a05b9183331..625ccf566e1c2a 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=454f6306a31248cf972f5f16d4c145ad5b33bfdc)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c?id=3a84454f5204718ca5b4ad2c1f0bf2031e2403d1)@@ -5818,6 +5818,10 @@ static void iwl\_mvm\_flush\_no\_vif(struct iwl\_mvm \*mvm, u32 queues, bool drop) int i;  if (!iwl\_mvm\_has\_new\_tx\_api(mvm)) {+ /\* we can't ask the firmware anything if it is dead \*/+ if (test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status))+ return; if (drop) { guard(mvm)(mvm); iwl\_mvm\_flush\_tx\_path(mvm,@@ -5911,8 +5915,11 @@ void iwl\_mvm\_mac\_flush(struct ieee80211\_hw \*hw, struct ieee80211\_vif \*vif,  /\* this can take a while, and we may need/want other operations \* to succeed while doing this, so do it without the mutex held+ \* If the firmware is dead, this can't work... \*/- if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm))+ if (!drop && !iwl\_mvm\_has\_new\_tx\_api(mvm) &&+ !test\_bit(IWL\_MVM\_STATUS\_HW\_RESTART\_REQUESTED,+ &mvm->status)) iwl\_trans\_wait\_tx\_queues\_empty(mvm->trans, msk); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:07:38 +0000


