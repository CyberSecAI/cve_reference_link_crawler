

[![logo]()](https://www.eclipse.org/)

* [Download](https://www.eclipse.org/downloads/)
* [Getting Started](https://www.eclipse.org/users/)
* [Members](https://www.eclipse.org/membership/)
* [Projects](https://www.eclipse.org/projects/)
* Community
  + [Marketplace](http://marketplace.eclipse.org)
  + [Events](http://events.eclipse.org)
  + [Planet Eclipse](http://www.planeteclipse.org/)
  + [Newsletter](https://www.eclipse.org/community/eclipse_newsletter/)
  + [Videos](https://www.youtube.com/user/EclipseFdn)
* Participate
  + [Report a Bug](https://bugs.eclipse.org/bugs/)
  + [Forums](https://www.eclipse.org/forums/)
  + [Mailing Lists](https://www.eclipse.org/mail/)
  + [Wiki](https://wiki.eclipse.org/)
  + [IRC](https://wiki.eclipse.org/IRC)
  + [How to Contribute](https://www.eclipse.org/contribute/)
* Working Groups
  + [Automotive](http://wiki.eclipse.org/Auto_IWG)
  + [Internet of Things](http://iot.eclipse.org)
  + [LocationTech](http://locationtech.org)
  + [Long-Term Support](http://lts.eclipse.org)
  + [PolarSys](http://polarsys.org)
  + [Science](http://science.eclipse.org)
  + [OpenMDM](http://www.openmdm.org)
* More
  + - **Community**
    - [Marketplace](http://marketplace.eclipse.org)
    - [Events](http://events.eclipse.org)
    - [Planet Eclipse](http://www.planeteclipse.org/)
    - [Newsletter](https://www.eclipse.org/community/eclipse_newsletter/)
    - [Videos](https://www.youtube.com/user/EclipseFdn)
    - **Participate**
    - [Report a Bug](https://bugs.eclipse.org/bugs/)
    - [Forums](https://www.eclipse.org/forums/)
    - [Mailing Lists](https://www.eclipse.org/mail/)
    - [Wiki](https://wiki.eclipse.org/)
    - [IRC](https://wiki.eclipse.org/IRC)
    - [How to Contribute](https://www.eclipse.org/contribute/)
    - **Working Groups**
    - [Automotive](http://wiki.eclipse.org/Auto_IWG)
    - [Internet of Things](http://iot.eclipse.org)
    - [LocationTech](http://locationtech.org)
    - [Long-Term Support](http://lts.eclipse.org)
    - [PolarSys](http://polarsys.org)
    - [Science](http://science.eclipse.org)
    - [OpenMDM](http://www.openmdm.org)

Toggle navigation

[![logo](/eclipse.org-common/themes/solstice/public/images/logo/eclipse-800x188.png)](https://www.eclipse.org/)

Bugzilla – Bug 577029
p2 metadata (even without artifacts) can be an attack vector
Last modified: 2023-04-27 09:30:14 EDT

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=577029&GoAheadAndLogIn=1)

  [x]
| * [Terms of Use](http://www.eclipse.org/legal/termsofuse.php)
| * [Copyright Agent](http://www.eclipse.org/legal/copyright.php)

This Bugzilla instance is deprecated, and most Eclipse projects now use
[GitHub](https://github.com/eclipse) or [Eclipse GitLab](https://gitlab.eclipse.org/eclipse/). Please see the [deprecation plan](https://gitlab.eclipse.org/eclipsefdn/helpdesk/-/wikis/Gerrit/Gerrit-and-Bugzilla-deprecation-and-migration-plan) for details.

[**Bug 577029**](show_bug.cgi?id=577029)
(CVE-2021-41037)
- p2 metadata (even without artifacts) can be an attack vector

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
p2 metadata (even without artifacts) can be an attack vector

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-41037 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Equinox | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Eclipse Project | | [Component:](describecomponents.cgi?product=Equinox "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | p2 ([show other bugs](buglist.cgi?component=p2&product=Equinox&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified   [Edit](https://dev.eclipse.org/committers/bugs/bugz_manager.php) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | P3 critical ([vote](page.cgi?id=voting/user.html&bug_id=577029#vote_577029)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | ---   [Edit](https://dev.eclipse.org/committers/bugs/bugz_manager.php) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | P2 Inbox [CLA](https://wiki.eclipse.org/ECA) | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2021-11-03 05:56 EDT by Mickael Istria [CLA](https://wiki.eclipse.org/ECA) | | --- | --- | | Modified: | 2023-04-27 09:30 EDT ([History](show_activity.cgi?id=577029)) | | CC List: | 9 users (show)  akurtakov eclipse.tjw Ed.Merks gunnar jonah laeubi loskutov tjwatson wayne.beaton | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * [576705](show_bug.cgi?id=576705 "RESOLVED FIXED - Offer a way for products and other IUs to declare some PGP keys as trusted for further installations") | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=577029&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=577029&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=577029#c0)  Mickael Istria [CLA](https://wiki.eclipse.org/ECA)    2021-11-03 05:56:45 EDT  ``` p2 metadata, even without artifacts, can affect the application in unsafe way: touchpoints can run some local commands, change the command line that will be used to start the IDE (ie changing the JVM, adding some agents...). It seems relatively easy to inject malicious changes in p2 metadata. Unlike artifacts, installing a unit that consists only of metadata doesn't show any warning to users. So they may install malicious code without any warning. There is no concept of "trusting" metadata like it exists for artifacts.  On the long run, the solution would be to sign metadata as well, like other package managers -eg rpm- do. ```  [Comment 1](show_bug.cgi?id=577029#c1)  Mickael Istria [CLA](https://wiki.eclipse.org/ECA)    2021-11-03 05:59:32 EDT  ``` I think this qualifies as a CVE. @Thomas: is it OK? ```  [Comment 2](show_bug.cgi?id=577029#c2)  Thomas Watson [CLA](https://wiki.eclipse.org/ECA)    2021-11-03 08:57:00 EDT  ``` (In reply to Mickael Istria from [comment #1](show_bug.cgi?id=577029#c1)) > I think this qualifies as a CVE. > @Thomas: is it OK?  Yes I think so.  I've marked this committer-only now. ```  [Comment 3](show_bug.cgi?id=577029#c3)  Mickael Istria [CLA](https://wiki.eclipse.org/ECA)    2021-11-03 09:58:26 EDT  ``` I've opened <https://gitlab.eclipse.org/eclipsefdn/emo-team/emo/-/issues/124> ```  [Comment 4](show_bug.cgi?id=577029#c4)  Wayne Beaton [CLA](https://wiki.eclipse.org/ECA)    2021-11-03 11:33:22 EDT  ``` I've assigned CVE-2021-41037. Don't use that number externally until after we disclose. ```  [Comment 5](show_bug.cgi?id=577029#c5)  Wayne Beaton [CLA](https://wiki.eclipse.org/ECA)    2021-12-10 13:03:23 EST  ``` What's the status on this?  Because of a quirk of the CVE assignment process, we're getting very close to needing to either push the CVE to the central CNA or reassign this CVE to another issue (and then assign another CVE to this issue when you're ready).    Unless we have a rush of vulnerability reports, we're probably good until the end of the year.  FWIW... we're currently using the old CVE reporting system, but are going to switch over to their new CVE reservation system which will make this sort of timing problem go away. ```  [Comment 6](show_bug.cgi?id=577029#c6)  Mickael Istria [CLA](https://wiki.eclipse.org/ECA)    2021-12-10 14:54:10 EST  ``` (In reply to Wayne Beaton from [comment #5](show_bug.cgi?id=577029#c5)) > What's the status on this?  no progress on a solution, and as far as I'm aware of, no plans from anyone to fix it so far. ```  [Comment 7](show_bug.cgi?id=577029#c7)  Wayne Beaton [CLA](https://wiki.eclipse.org/ECA)    2021-12-10 15:24:50 EST  ``` If there's no prospect of this being fixed, then I recommend that we push the CVE sooner rather than later. ```  [Comment 8](show_bug.cgi?id=577029#c8)  Mickael Istria [CLA](https://wiki.eclipse.org/ECA)    2021-12-10 16:59:48 EST  ``` (In reply to Wayne Beaton from [comment #7](show_bug.cgi?id=577029#c7)) > If there's no prospect of this being fixed, then I recommend that we push > the CVE sooner rather than later.  I personally have no objection here. However I'm not much familiar with best way to handle security issue, so others' opinions are probably much more valuable. ```  [Comment 9](show_bug.cgi?id=577029#c9)  Wayne Beaton [CLA](https://wiki.eclipse.org/ECA)    2022-07-07 23:48:51 EDT  ``` (In reply to Mickael Istria from [comment #3](show_bug.cgi?id=577029#c3)) > I've opened <https://gitlab.eclipse.org/eclipsefdn/emo-team/emo/-/issues/124>  I've pushed the issue to the central authority. I'm removing the committer-only flag since the issue has been publicly disclosed via the CVE. ```  [Comment 10](show_bug.cgi?id=577029#c10)  Christoph Laeubrich [CLA](https://wiki.eclipse.org/ECA)    2023-01-31 13:52:17 EST  ``` While there is possibility to "fake" the metadata, I must confess I don't understand how to use that in practice.  Just assume I can make a user use my update site and choose something to install I can already do lot more things (e.g. execute arbitrary code by implementing a common extension point that activates my Activator, adding/overriding Menu items, add new buttons or editor/key bindings), this even includes executing any native command or contacting remote sites and as most eclipse ship with SSH support even open reverse SSH sessions... so injecting malicious code into p2 meta-data seems not advantageous. ```  [Comment 11](show_bug.cgi?id=577029#c11)  Jonah Graham [CLA](https://wiki.eclipse.org/ECA)    2023-01-31 14:51:38 EST  ``` I think the key line is "There is no concept of "trusting" metadata like it exists for artifacts."  The trust for metadata comes simply from the transport layer that downloads the metadata (e.g. normally https).  A good example in practice is related to why EF just removed loads of listings from the marketplace. They were on http:// or the p2 sites pointed at domains that were no longer registered. Placing artifacts on those (more easily compromiseable) p2 sites would display trust dialog to user, but the metadata/p2/etc would "just happen" ```  [Comment 12](show_bug.cgi?id=577029#c12)  Thomas Watson [CLA](https://wiki.eclipse.org/ECA)    2023-01-31 16:30:10 EST  ``` I thought p2 disabled usage of http altogether at some point also. ```  [Comment 13](show_bug.cgi?id=577029#c13)  Gunnar Wagenknecht [CLA](https://wiki.eclipse.org/ECA)    2023-02-01 00:50:36 EST  ``` (In reply to Thomas Watson from [comment #12](show_bug.cgi?id=577029#c12)) > I thought p2 disabled usage of http altogether at some point also.  It's only warning:  Using unsafe http transport to retrieve <http://download.eclipse.org/technology/m2e/releases/>, see CVE-2021-41033. Consider using https instead. ```  [Comment 14](show_bug.cgi?id=577029#c14)  Christoph Laeubrich [CLA](https://wiki.eclipse.org/ECA)    2023-02-01 01:22:25 EST  ``` I think  the problem is that if I can make the user to install something, then I'm not need to craft the meta-data in a special way, I can simply make a valid site with a jar signed with an official certificate everyone can buy for a few bucks, or simply depend on users that dismiss warning dialogs anyways.  So just *loading* the meta-data should not cause any issues... and if an attacker is in control of the (content-) metadata I'm lost anyways, p2 currently assumes that one only adds trusted sites, so we can trust the meta-data.  What I can think of (and what would be rather easy to archive) would be that we do it like maven-central does and for each content.xml/jar/xz (same for artifacts.xml/jar/xz) we look for a corresponding content.xml.sha256 and content.xml.asc (one should then also consider p2.index!) and then we can verify the integrity and the origin of the meta-data.  I see the following problems: - one can always create a valid site, with a PGP Key that looks similar to something "official", even from a site with https-certificate and there is no authority to "proof" validity and if I can make the user to install something it is likely to dismiss warning dialogs - Still it is common for user to use very old (or even ancient) Eclipse versions (and thus P2 as well) and also Eclipse claims "long-term-compatibility" and we support such users even with providing some software for very old Eclipse, so as long as we do not encourage users to upgrade (e.g. show a big-fat banner after a new release is there that this Eclipse version is outdated and vulnerable to security risks) its likely such enhancements will never get widely adopted.  > It's only warning:  There is even an option to disable the warning because users are annoyed when using local intranet sites :-\ ```  [Comment 15](show_bug.cgi?id=577029#c15)  Ed Merks [CLA](https://wiki.eclipse.org/ECA)    2023-03-22 13:00:06 EDT  ``` The exact nature of the problem as described in the CVE seems somewhat open to interpretation.  E.g., this statement seems kind of "open":  As a result, it's possible to install a unit that will run malicious code during installation without user receiving any warning about this installation step being risky when coming from untrusted source.  I though the issue was more about "bad things" happening when running the resulting installation not about "bad things" happening while installing, but that aside, given that <https://github.com/eclipse-equinox/p2/issues/230> ensures that metadatada is accessed not by http but rather by https, I'm not entirely sure if the fact that it securely comes from a secured source is the same as it coming from a "trusted" source.  I think it is the same, but maybe someone else will think it isn't.  How to resolve that? ```  [Comment 16](show_bug.cgi?id=577029#c16)  Jonah Graham [CLA](https://wiki.eclipse.org/ECA)    2023-03-22 13:48:27 EDT  ``` I think in the same way we said that artifacts simply coming from https:// isn't sufficient (needs GPG or jarsigning) the same applies to touchpoints. We could solve that by GPG, jarsigning or otherwise signing the p2 metadata.  That said, what Christoph said in [Comment 14](show_bug.cgi?id=577029#c14) Paragraph 1 is still very relevant. If you can social engineer the user to add a "bad" p2 site it is very easy to bypass other issues. There is a way to validate jars, but there isn't a way to do that for p2 metadata.   What I really struggle to answer is, now with p2#230 done, what priority this remaining issue has. The implementation is one side of things, but rolling this out to all the existing p2 sites will take quite a long time. ```  [Comment 17](show_bug.cgi?id=577029#c17)  Christoph Laeubrich [CLA](https://wiki.eclipse.org/ECA)    2023-03-23 03:28:15 EDT  ``` https only ensures that the communication channel is secure, not that the data is secure! I can buy a valid certificate for only a few bucks so that's not really an issue ...  Just out of curiosity eclipse.de is a domain owned by itemis (at least it redirects to their site), eclipse.com is currently not serving any content so probably it is for sale?   So would a user not so familiar with the eclipse infrastructure really spot the difference to be a "danger" from  <https://download.eclipse.org/eclipse/updates/4.24/>  versus  <https://download.eclipse.de/eclipse/updates/4.24/> <https://download.eclipse.com/eclipse/updates/4.24/>  ...  :-) ```  [Comment 18](show_bug.cgi?id=577029#c18)  Ed Merks [CLA](https://wiki.eclipse.org/ECA)    2023-03-25 06:16:24 EDT  ``` I've opened up this issue as a follow up:  <https://github.com/eclipse-equinox/p2/issues/235> ```  [Comment 19](show_bug.cgi?id=577029#c19)  Ed Merks [CLA](https://wiki.eclipse.org/ECA)    2023-04-27 09:30:14 EDT  ``` Resolved via   <https://github.com/eclipse-equinox/p2/issues/235> ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=577029)
* - [XML](show_bug.cgi?ctype=xml&id=577029)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=577029)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=577029&GoAheadAndLogIn=1)

    [x]
  | + [Terms of Use](http://www.eclipse.org/legal/termsofuse.php)
  | + [Copyright Agent](http://www.eclipse.org/legal/copyright.php)

