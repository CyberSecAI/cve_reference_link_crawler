<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.78.2" />

    
    
    

<title> CVE-2023-36631: Circumventing Windows Firewall controls with... Malwarebytes&#39; Windows Firewall Control â¢ Jeffrey Bencteux</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=" CVE-2023-36631: Circumventing Windows Firewall controls with... Malwarebytes&#39; Windows Firewall Control"/>
<meta name="twitter:description" content="Malwarebytes&#39; software for firewall management let unprivileged users perform administrative firewall actions without access controls allowing for local network rules bypass."/>

<meta property="og:title" content=" CVE-2023-36631: Circumventing Windows Firewall controls with... Malwarebytes&#39; Windows Firewall Control" />
<meta property="og:description" content="Malwarebytes&#39; software for firewall management let unprivileged users perform administrative firewall actions without access controls allowing for local network rules bypass." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bencteux.fr/posts/malwarebytes_wfc/" />
<meta property="article:published_time" content="2023-06-21T09:28:09+00:00" />
<meta property="article:modified_time" content="2023-06-21T09:28:09+00:00" /><meta property="og:site_name" content="Jeffrey Bencteux" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">









<link rel="stylesheet" href="/scss/hyde-hyde.71157e768c4e111a23c3531b95e0cbb59bbef3c9e6901d36247cb53d6b6be258.css" integrity="sha256-cRV&#43;doxOERojw1MbleDLtZu&#43;88nmkB02JHy1PWtr4lg=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


<link rel="stylesheet" href="/css/custom.0feaa34a7be8819ce960219f3ff920fb192e09394719a63fa91f5ec21727d8d7.css" integrity="sha256-D&#43;qjSnvogZzpYCGfP/kg&#43;xkuCTlHGaY/qR9ewhcn2Nc=">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    <script type="text/javascript">
  var _paq = window._paq = window._paq || [];
   
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.bencteux.fr/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.bencteux.fr/">
        
          Jeffrey Bencteux
        
        </a>
      </span>
      
        
        
        
      <div class="author-image">
	<img src="https://www.bencteux.fr/img/book.jpg" alt="Author Image" class="img--circle img--headshot element--center">
      </div>
        
      
      
      <p class="site__description">
         Rubrique-Ã -brac 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Jeffrey Bencteux</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Home</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/me/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/hacking/">
						<span>Hacking</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/books">
						<span>Library</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jeffbencteux" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://github.com/jeffbencteux" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jeffrey-bencteux-6ba59a89" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://stackoverflow.com/users/3452702/jeff-bencteux" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
</section>

	<p align="center"><iframe width='160' height='450' src='https://leanpub.com/emailsecattackanddefence/embed' frameborder='0' allowtransparency='true'></iframe></p>
      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 - 2024 Jeffrey Bencteux
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> â¤ï¸ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1> CVE-2023-36631: Circumventing Windows Firewall controls with... Malwarebytes&#39; Windows Firewall Control</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jun 21, 2023
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/hacking">HACKING</a>
              â¢
          
              <a class="badge badge-category" href="/categories/vulnerabilities">VULNERABILITIES</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/malwarebytes">malwarebytes</a>
           
      
          <a class="badge badge-tag" href="/tags/wfc">wfc</a>
           
      
          <a class="badge badge-tag" href="/tags/access-control">access control</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  <div class="post">
    <p><strong>TL;DR;</strong> Malwarebytes' software for firewall management let unprivileged users perform administrative firewall actions without access controls allowing for local network rules bypass.</p>
<h2 id="timeline">Timeline</h2>
<ul>
<li>24-05-2023: Vulnerability reported on Malwarebytes' HackerOne program</li>
<li>06-06-2023: Malwarebytes' close the report as informative with &ldquo;no security impact&rdquo;</li>
<li>06-06-2023: Report was reopened after more information was given</li>
<li>06-06-2023: Report was closed again as informative with &ldquo;it appears this is intended behavior as the application can be locked using a password.&rdquo;</li>
<li>21-06-2023: Report was locked by Malwarebytes / Current article published</li>
<li>25-06-2023: CVE-2023-36631 assigned</li>
</ul>
<h2 id="windows-firewall">Windows Firewall</h2>
<p>The Windows Defender Firewall with Advanced Security is defined as such by Microsoft:</p>
<blockquote>
<p>Windows Defender Firewall with Advanced Security is a host firewall that helps secure the device in two ways. First, it can filter the network traffic permitted to enter the device from the network, and also control what network traffic the device is allowed to send to the network.</p>
</blockquote>
<p>Seeing and defining firewall rules are possible by using that default Microsoft tool:</p>
<p><img src="/img/wfc/windows_defender.png" alt=""></p>
<p>This is the MMC snap-in:</p>
<blockquote>
<p>The Windows Defender Firewall with Advanced Security MMC snap-in is more flexible and provides much more functionality than the consumer-friendly Windows Defender Firewall interface found in the Control Panel. Both interfaces interact with the same underlying services, but provide different levels of control over those services.</p>
</blockquote>
<p>However the actions possible with that tool are restricted to either the local administrator or the network administrator group. Trying such actions with an unprivileged user will result in a permission denied error:</p>
<p><img src="/img/wfc/export_fw_5.png" alt=""></p>
<p>Same from the GUI:</p>
<p><img src="/img/wfc/unprivileged_1.png" alt=""></p>
<h2 id="malwarebytes-windows-firewall-control">Malwarebytes' Windows Firewall Control</h2>
<p><a href="https://binisoft.org/wfc">Windows Firewall Control</a> is a product from Binisoft (one of Malwarebytes companies). Description of the product from the vendor website is as such:</p>
<blockquote>
<p>Windows Firewall Control is a powerful tool which extends the functionality of Windows Firewall and provides new extra features which makes Windows Firewall better. It runs in the system tray and allows the user to control the native firewall easily without having to waste time by navigating to the specific part of the firewall.</p>
</blockquote>
<p>It can be installed pretty quickly by an administrator:</p>
<p><img src="/img/wfc/install_1.png" alt=""></p>
<p><img src="/img/wfc/install_2.png" alt=""></p>
<p>(Note for later that no lock password was asked)</p>
<p>Once installed, it appears in the system tray of any user that launch the <code>wfc.exe</code> binary from the installation folder (that is, any local user):</p>
<p><img src="/img/wfc_1.png" alt=""></p>
<p>And the graphical interface can be started to execute different actions related to firewall administration:</p>
<p><img src="/img/wfc/wfc_2.png" alt=""></p>
<p>Two executables are running under the hood, a privileged service <code>wfcs.exe</code> and the GUI tool <code>wfc.exe</code>:</p>
<p><img src="/img/wfc/process.png" alt=""></p>
<p>Basically, the GUI is giving order to the service for privileged actions.</p>
<h2 id="the-issue">The issue</h2>
<p>The <code>wfc.exe</code> binary allow unprivileged users to execute Windows Defender Firewall with Advanced Security actions by using the <code>Main Panel</code> &gt; <code>Rules</code> tab without applying additional access controls.</p>
<p>Amongst the possible actions there are:</p>
<ul>
<li>Exporting firewall rules; which leaks current rules to an attacker.</li>
<li>Importing firewall rules; which can allow an attacker to completely bypass the firewall rules by overwriting existing rules.</li>
<li>Resetting firewall rules to default; which could also allow an attacker to bypass custom rules that were added after the defaults ones.</li>
</ul>
<p>This issue basically give full firewall control to unprivileged users.</p>
<h2 id="poc">PoC</h2>
<h3 id="export-feature"><code>Export</code> feature:</h3>
<ol>
<li>Open the Malwarebytes Windows Firewall Control via the system tray and clicking <code>Main Panel</code> or by double-clicking <code>wfc.exe</code> in the installation folder</li>
<li>Go to <code>Rules</code> tab</li>
<li>Click the <code>Export Firewall rules to a file</code> link:</li>
</ol>
<p><img src="/img/wfc/export_fw_4.png" alt=""></p>
<ol start="4">
<li>Save the file to a location with write permissions for the user:</li>
</ol>
<p><img src="/img/wfc/export_fw_6.png" alt=""></p>
<p>The exported file is successfully saved and readable:</p>
<p><img src="/img/wfc/export_fw_7.png" alt=""></p>
<h3 id="restore-feature"><code>Restore</code> feature:</h3>
<p>Note that it is also possible to use the <code>Restore Windows Firewall default set of rules</code> feature in the same fashion:</p>
<p><img src="/img/wfc/set_default_fw_1.png" alt=""></p>
<h3 id="import-feature"><code>Import</code> feature:</h3>
<p>The &ldquo;Import Windows Firewall rules from a file&rdquo; is also working, which can allow an attacker to erase current rules, whitelist any network flow, and totally bypass the firewall:</p>
<p><img src="/img/wfc/import_fw_1.png" alt=""></p>
<h2 id="conclusion">Conclusion</h2>
<p>Malwarebytes was reached through its HackerOne&rsquo;s bug bounty program, the report was closed as informative and their answer was the following:</p>
<blockquote>
<p>After discussing this internally, it appears this is intended behavior as the application can be locked using a password.</p>
</blockquote>
<p>No lock password is asked on default installation which means users are vulnerable by default unless an administrator did set up a password after installation.</p>
<p>The same lack of access control was reported in 2022 on another tab of the software, this time allowing local privilege escalation: <a href="https://www.cvedetails.com/cve/CVE-2022-25150/">CVE-2022-25150 : In Malwarebytes Binisoft Windows Firewall Control before 6.8.1.0, programs executed from the Tools tab can be used to es (cvedetails.com)</a></p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/windows-firewall-with-advanced-security">Windows Defender Firewall with Advanced Security - Windows Security | Microsoft Learn</a></li>
<li><a href="https://hackerone.com/reports/2000375">https://hackerone.com/reports/2000375</a> (I doubt this will ever be disclosed but who knows)</li>
</ul>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/osint_images/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">OSINT from images&#39; metadata hosted on websites</span>
    </a>
    
    
    <a href="/posts/netkit_rcp/" class="navigation-next">
      <span class="navigation-tittle">CVE-2023-38336: Command injection in netkit-rcp</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  




  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
