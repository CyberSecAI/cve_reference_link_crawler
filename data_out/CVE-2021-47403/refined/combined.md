=== Content from git.kernel.org_306fcb58_20250110_210954.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:42:36 +0200 |
| commit | [3253c87e1e5bc0107aab773af2f135ebccf38666](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3253c87e1e5bc0107aab773af2f135ebccf38666) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)) | |
| tree | [9b5cbd8caee5b558f974f6a7390a7aa86ab1d308](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3253c87e1e5bc0107aab773af2f135ebccf38666) | |
| parent | [9c802a05749aef342fa1d593f3ef549b785cf6fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c802a05749aef342fa1d593f3ef549b785cf6fd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3253c87e1e5bc0107aab773af2f135ebccf38666&id2=9c802a05749aef342fa1d593f3ef549b785cf6fd)) | |
| download | [linux-3253c87e1e5bc0107aab773af2f135ebccf38666.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3253c87e1e5bc0107aab773af2f135ebccf38666.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3253c87e1e5bc0107aab773af2f135ebccf38666)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=3253c87e1e5bc0107aab773af2f135ebccf38666) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex e22696ebd40679..0f1dca623b5a10 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=9c802a05749aef342fa1d593f3ef549b785cf6fd)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=3253c87e1e5bc0107aab773af2f135ebccf38666)@@ -84,22 +84,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -665,6 +677,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:31 +0000



=== Content from git.kernel.org_2f5a9d74_20250110_211000.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:23:42 +0200 |
| commit | [c0adb5a947dec6cff7050ec56d78ecd3916f9ce6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)) | |
| tree | [5377499cf2faa65019de3cf53274b234f3df9219](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6) | |
| parent | [f99060fd36a18ee64e47dced167f7173c06eb780](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f99060fd36a18ee64e47dced167f7173c06eb780) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6&id2=f99060fd36a18ee64e47dced167f7173c06eb780)) | |
| download | [linux-c0adb5a947dec6cff7050ec56d78ecd3916f9ce6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c0adb5a947dec6cff7050ec56d78ecd3916f9ce6.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 2765ab54b58296..f558aeb8f88843 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=f99060fd36a18ee64e47dced167f7173c06eb780)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=c0adb5a947dec6cff7050ec56d78ecd3916f9ce6)@@ -87,22 +87,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -668,6 +680,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:37 +0000



=== Content from git.kernel.org_86d39fb1_20250110_210955.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7cea848678470daadbfdaa6a112b823c290f900c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7cea848678470daadbfdaa6a112b823c290f900c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7cea848678470daadbfdaa6a112b823c290f900c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7cea848678470daadbfdaa6a112b823c290f900c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:56:01 +0200 |
| commit | [7cea848678470daadbfdaa6a112b823c290f900c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7cea848678470daadbfdaa6a112b823c290f900c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7cea848678470daadbfdaa6a112b823c290f900c)) | |
| tree | [acf782437ed1da1704d2d56f891726b5fa9d52a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7cea848678470daadbfdaa6a112b823c290f900c) | |
| parent | [843efca98e6a24a917585247883d7cc34e9fe077](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=843efca98e6a24a917585247883d7cc34e9fe077) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7cea848678470daadbfdaa6a112b823c290f900c&id2=843efca98e6a24a917585247883d7cc34e9fe077)) | |
| download | [linux-7cea848678470daadbfdaa6a112b823c290f900c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7cea848678470daadbfdaa6a112b823c290f900c.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7cea848678470daadbfdaa6a112b823c290f900c)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=7cea848678470daadbfdaa6a112b823c290f900c) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 9e6e105e35aa77..1f7512c991a322 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=843efca98e6a24a917585247883d7cc34e9fe077)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=7cea848678470daadbfdaa6a112b823c290f900c)@@ -84,22 +84,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -665,6 +677,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:32 +0000



=== Content from git.kernel.org_5b9fc158_20250110_210952.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31398849b84ebae0d43a1cf379cb9895597f221a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31398849b84ebae0d43a1cf379cb9895597f221a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31398849b84ebae0d43a1cf379cb9895597f221a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31398849b84ebae0d43a1cf379cb9895597f221a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 10:22:25 +0200 |
| commit | [31398849b84ebae0d43a1cf379cb9895597f221a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31398849b84ebae0d43a1cf379cb9895597f221a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31398849b84ebae0d43a1cf379cb9895597f221a)) | |
| tree | [847109b4551830241afce70f532c1a6aaefbaa88](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31398849b84ebae0d43a1cf379cb9895597f221a) | |
| parent | [27c0c13e88c39e84c5e1a01b134a8103ea2c27a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=27c0c13e88c39e84c5e1a01b134a8103ea2c27a8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31398849b84ebae0d43a1cf379cb9895597f221a&id2=27c0c13e88c39e84c5e1a01b134a8103ea2c27a8)) | |
| download | [linux-31398849b84ebae0d43a1cf379cb9895597f221a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31398849b84ebae0d43a1cf379cb9895597f221a.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31398849b84ebae0d43a1cf379cb9895597f221a)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=31398849b84ebae0d43a1cf379cb9895597f221a) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 30ca29f99c0f67..c1175464064bec 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=27c0c13e88c39e84c5e1a01b134a8103ea2c27a8)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=31398849b84ebae0d43a1cf379cb9895597f221a)@@ -87,22 +87,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -669,6 +681,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:29 +0000



=== Content from git.kernel.org_58ec8589_20250110_210959.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-09-27 17:38:49 +0200 |
| commit | [bb8a4fcb2136508224c596a7e665bdba1d7c3c27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)) | |
| tree | [6349a8c8cd733b11ef5281c2fb17220751f9c256](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27) | |
| parent | [445c8132727728dc297492a7d9fc074af3e94ba3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=445c8132727728dc297492a7d9fc074af3e94ba3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27&id2=445c8132727728dc297492a7d9fc074af3e94ba3)) | |
| download | [linux-bb8a4fcb2136508224c596a7e665bdba1d7c3c27.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bb8a4fcb2136508224c596a7e665bdba1d7c3c27.tar.gz) | |

ipack: ipoctal: fix module reference leakA reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 61c41f53551072..c709861198e593 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=445c8132727728dc297492a7d9fc074af3e94ba3)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=bb8a4fcb2136508224c596a7e665bdba1d7c3c27)@@ -82,22 +82,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -661,6 +673,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:36 +0000



=== Content from git.kernel.org_f8852413_20250110_210956.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=811178f296b16af30264def74c8d2179a72d5562)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=811178f296b16af30264def74c8d2179a72d5562)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=811178f296b16af30264def74c8d2179a72d5562)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=811178f296b16af30264def74c8d2179a72d5562)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-07 07:53:17 +0200 |
| commit | [811178f296b16af30264def74c8d2179a72d5562](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=811178f296b16af30264def74c8d2179a72d5562) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=811178f296b16af30264def74c8d2179a72d5562)) | |
| tree | [d32a97fe8d45cf007eeb95f4adf1f2a2fb2de9c1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=811178f296b16af30264def74c8d2179a72d5562) | |
| parent | [382ef7ff1854d527f5ff394d337f5f4f4952ec18](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=382ef7ff1854d527f5ff394d337f5f4f4952ec18) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=811178f296b16af30264def74c8d2179a72d5562&id2=382ef7ff1854d527f5ff394d337f5f4f4952ec18)) | |
| download | [linux-811178f296b16af30264def74c8d2179a72d5562.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-811178f296b16af30264def74c8d2179a72d5562.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=811178f296b16af30264def74c8d2179a72d5562)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=811178f296b16af30264def74c8d2179a72d5562) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 64b67f0d5c047a..9117874cbfdbd1 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=382ef7ff1854d527f5ff394d337f5f4f4952ec18)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=811178f296b16af30264def74c8d2179a72d5562)@@ -82,22 +82,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -662,6 +674,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:34 +0000



=== Content from git.kernel.org_3764e689_20250110_210958.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:31:25 +0200 |
| commit | [9c5b77a7ffc983b2429ce158b50497c5d3c86a69](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)) | |
| tree | [4c94daee5a08bd2fd4a1e4ec35e505e81e78027f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69) | |
| parent | [eee92da3b0a1371e52505169003ba8bfabfe44d2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eee92da3b0a1371e52505169003ba8bfabfe44d2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69&id2=eee92da3b0a1371e52505169003ba8bfabfe44d2)) | |
| download | [linux-9c5b77a7ffc983b2429ce158b50497c5d3c86a69.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9c5b77a7ffc983b2429ce158b50497c5d3c86a69.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 2765ab54b58296..f558aeb8f88843 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=eee92da3b0a1371e52505169003ba8bfabfe44d2)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=9c5b77a7ffc983b2429ce158b50497c5d3c86a69)@@ -87,22 +87,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -668,6 +680,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:35 +0000



=== Content from git.kernel.org_2a81bdce_20250110_211001.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johan Hovold <johan@kernel.org> | 2021-09-17 13:46:21 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-06 15:05:09 +0200 |
| commit | [dde4c1429b97383689f755ce92b4ed1e84a9c92b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)) | |
| tree | [f7c4344efbb8ec47c4fcd72f345698f99c5f8273](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b) | |
| parent | [58e818cd994fdd3921dfbbdc67d0b581a2f7aa2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=58e818cd994fdd3921dfbbdc67d0b581a2f7aa2f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b&id2=58e818cd994fdd3921dfbbdc67d0b581a2f7aa2f)) | |
| download | [linux-dde4c1429b97383689f755ce92b4ed1e84a9c92b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-dde4c1429b97383689f755ce92b4ed1e84a9c92b.tar.gz) | |

ipack: ipoctal: fix module reference leakcommit bb8a4fcb2136508224c596a7e665bdba1d7c3c27 upstream.
A reference to the carrier module was taken on every open but was only
released once when the final reference to the tty struct was dropped.
Fix this by taking the module reference and initialising the tty driver
data when installing the tty.
Fixes: 82a82340bab6 ("ipoctal: get carrier driver to avoid rmmod")
Cc: stable@vger.kernel.org # 3.18
Cc: Federico Vaga <federico.vaga@cern.ch>
Acked-by: Samuel Iglesias Gonsalvez <siglesias@igalia.com>
Signed-off-by: Johan Hovold <johan@kernel.org>
Link: [https://lore.kernel.org/r/20210917114622.5412-6-johan@kernel.org](https://lore.kernel.org/r/20210917114622.5412-6-johan%40kernel.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)

| -rw-r--r-- | [drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/ipack/devices/ipoctal.c?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b) | 29 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 21 insertions, 8 deletions

| diff --git a/drivers/ipack/devices/ipoctal.c b/drivers/ipack/devices/ipoctal.cindex 2765ab54b58296..f558aeb8f88843 100644--- a/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=58e818cd994fdd3921dfbbdc67d0b581a2f7aa2f)+++ b/[drivers/ipack/devices/ipoctal.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/ipack/devices/ipoctal.c?id=dde4c1429b97383689f755ce92b4ed1e84a9c92b)@@ -87,22 +87,34 @@ static int ipoctal\_port\_activate(struct tty\_port \*port, struct tty\_struct \*tty) return 0; } -static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+static int ipoctal\_install(struct tty\_driver \*driver, struct tty\_struct \*tty) { struct ipoctal\_channel \*channel = dev\_get\_drvdata(tty->dev); struct ipoctal \*ipoctal = chan\_to\_ipoctal(channel, tty->index);- int err;-- tty->driver\_data = channel;+ int res;  if (!ipack\_get\_carrier(ipoctal->dev)) return -EBUSY; - err = tty\_port\_open(&channel->tty\_port, tty, file);- if (err)- ipack\_put\_carrier(ipoctal->dev);+ res = tty\_standard\_install(driver, tty);+ if (res)+ goto err\_put\_carrier;++ tty->driver\_data = channel;++ return 0;++err\_put\_carrier:+ ipack\_put\_carrier(ipoctal->dev);++ return res;+}++static int ipoctal\_open(struct tty\_struct \*tty, struct file \*file)+{+ struct ipoctal\_channel \*channel = tty->driver\_data; - return err;+ return tty\_port\_open(&channel->tty\_port, tty, file); }  static void ipoctal\_reset\_stats(struct ipoctal\_stats \*stats)@@ -668,6 +680,7 @@ static void ipoctal\_cleanup(struct tty\_struct \*tty)  static const struct tty\_operations ipoctal\_fops = { .ioctl = NULL,+ .install = ipoctal\_install, .open = ipoctal\_open, .close = ipoctal\_close, .write = ipoctal\_write\_tty, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:08:39 +0000


