

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shin'ichiro Kawasaki <shinichiro.kawasaki@wdc.com> | 2024-03-23 17:41:55 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 12:02:11 +0200 |
| commit | [f09318244c6cafd10aca741b9c01e0a2c362d43a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)) | |
| tree | [8617526b9249f713e12e3517033e7e34c54f6e3e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a) | |
| parent | [845d179992fccb8c732aa081b0ce0d45c1d8cdb4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=845d179992fccb8c732aa081b0ce0d45c1d8cdb4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a&id2=845d179992fccb8c732aa081b0ce0d45c1d8cdb4)) | |
| download | [linux-f09318244c6cafd10aca741b9c01e0a2c362d43a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f09318244c6cafd10aca741b9c01e0a2c362d43a.tar.gz) | |

scsi: mpi3mr: Avoid memcpy field-spanning write WARNING[ Upstream commit 429846b4b6ce9853e0d803a2357bb2e55083adf0 ]
When the "storcli2 show" command is executed for eHBA-9600, mpi3mr driver
prints this WARNING message:
memcpy: detected field-spanning write (size 128) of single field "bsg\_reply\_buf->reply\_buf" at drivers/scsi/mpi3mr/mpi3mr\_app.c:1658 (size 1)
WARNING: CPU: 0 PID: 12760 at drivers/scsi/mpi3mr/mpi3mr\_app.c:1658 mpi3mr\_bsg\_request+0x6b12/0x7f10 [mpi3mr]
The cause of the WARN is 128 bytes memcpy to the 1 byte size array "\_\_u8
replay\_buf[1]" in the struct mpi3mr\_bsg\_in\_reply\_buf. The array is intended
to be a flexible length array, so the WARN is a false positive.
To suppress the WARN, remove the constant number '1' from the array
declaration and clarify that it has flexible length. Also, adjust the
memory allocation size to match the change.
Suggested-by: Sathya Prakash Veerichetty <sathya.prakash@broadcom.com>
Signed-off-by: Shin'ichiro Kawasaki <shinichiro.kawasaki@wdc.com>
Link: [https://lore.kernel.org/r/20240323084155.166835-1-shinichiro.kawasaki@wdc.com](https://lore.kernel.org/r/20240323084155.166835-1-shinichiro.kawasaki%40wdc.com)
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)

| -rw-r--r-- | [drivers/scsi/mpi3mr/mpi3mr\_app.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/mpi3mr/mpi3mr_app.c?id=f09318244c6cafd10aca741b9c01e0a2c362d43a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/uapi/scsi/scsi\_bsg\_mpi3mr.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/uapi/scsi/scsi_bsg_mpi3mr.h?id=f09318244c6cafd10aca741b9c01e0a2c362d43a) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/scsi/mpi3mr/mpi3mr\_app.c b/drivers/scsi/mpi3mr/mpi3mr\_app.cindex 9dacbb8570c93a..aa5b535e6662b4 100644--- a/[drivers/scsi/mpi3mr/mpi3mr\_app.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/mpi3mr/mpi3mr_app.c?id=845d179992fccb8c732aa081b0ce0d45c1d8cdb4)+++ b/[drivers/scsi/mpi3mr/mpi3mr\_app.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/mpi3mr/mpi3mr_app.c?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)@@ -1345,7 +1345,7 @@ static long mpi3mr\_bsg\_process\_mpt\_cmds(struct bsg\_job \*job, unsigned int \*reply if ((mpirep\_offset != 0xFF) && drv\_bufs[mpirep\_offset].bsg\_buf\_len) { drv\_buf\_iter = &drv\_bufs[mpirep\_offset];- drv\_buf\_iter->kern\_buf\_len = (sizeof(\*bsg\_reply\_buf) - 1 ++ drv\_buf\_iter->kern\_buf\_len = (sizeof(\*bsg\_reply\_buf) + mrioc->reply\_sz); bsg\_reply\_buf = kzalloc(drv\_buf\_iter->kern\_buf\_len, GFP\_KERNEL); diff --git a/include/uapi/scsi/scsi\_bsg\_mpi3mr.h b/include/uapi/scsi/scsi\_bsg\_mpi3mr.hindex 907d345f04f93b..353183e863e47a 100644--- a/[include/uapi/scsi/scsi\_bsg\_mpi3mr.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/uapi/scsi/scsi_bsg_mpi3mr.h?id=845d179992fccb8c732aa081b0ce0d45c1d8cdb4)+++ b/[include/uapi/scsi/scsi\_bsg\_mpi3mr.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/uapi/scsi/scsi_bsg_mpi3mr.h?id=f09318244c6cafd10aca741b9c01e0a2c362d43a)@@ -382,7 +382,7 @@ struct mpi3mr\_bsg\_in\_reply\_buf { \_\_u8 mpi\_reply\_type; \_\_u8 rsvd1; \_\_u16 rsvd2;- \_\_u8 reply\_buf[1];+ \_\_u8 reply\_buf[]; };  /\*\* |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 06:27:40 +0000

