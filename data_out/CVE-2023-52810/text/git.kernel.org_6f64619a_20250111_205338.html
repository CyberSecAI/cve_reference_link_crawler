

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5f148b16972e5f4592629b244d5109b15135f53f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f148b16972e5f4592629b244d5109b15135f53f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f148b16972e5f4592629b244d5109b15135f53f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f148b16972e5f4592629b244d5109b15135f53f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Juntong Deng <juntong.deng@outlook.com> | 2023-10-02 17:56:58 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 16:56:18 +0000 |
| commit | [5f148b16972e5f4592629b244d5109b15135f53f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5f148b16972e5f4592629b244d5109b15135f53f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5f148b16972e5f4592629b244d5109b15135f53f)) | |
| tree | [f3ca76fc4cae5f801a0471c0506339d21d813ab5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5f148b16972e5f4592629b244d5109b15135f53f) | |
| parent | [e1d1f79b1929dce470a5dc9281c574cd58e8c6c0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1d1f79b1929dce470a5dc9281c574cd58e8c6c0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f148b16972e5f4592629b244d5109b15135f53f&id2=e1d1f79b1929dce470a5dc9281c574cd58e8c6c0)) | |
| download | [linux-5f148b16972e5f4592629b244d5109b15135f53f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5f148b16972e5f4592629b244d5109b15135f53f.tar.gz) | |

fs/jfs: Add check for negative db\_l2nbperpage[ Upstream commit 525b861a008143048535011f3816d407940f4bfa ]
l2nbperpage is log2(number of blks per page), and the minimum legal
value should be 0, not negative.
In the case of l2nbperpage being negative, an error will occur
when subsequently used as shift exponent.
Syzbot reported this bug:
UBSAN: shift-out-of-bounds in fs/jfs/jfs\_dmap.c:799:12
shift exponent -16777216 is negative
Reported-by: syzbot+debee9ab7ae2b34b0307@syzkaller.appspotmail.com
Closes: https://syzkaller.appspot.com/bug?extid=debee9ab7ae2b34b0307
Signed-off-by: Juntong Deng <juntong.deng@outlook.com>
Signed-off-by: Dave Kleikamp <dave.kleikamp@oracle.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5f148b16972e5f4592629b244d5109b15135f53f)

| -rw-r--r-- | [fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/jfs/jfs_dmap.c?id=5f148b16972e5f4592629b244d5109b15135f53f) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/fs/jfs/jfs\_dmap.c b/fs/jfs/jfs\_dmap.cindex da4f9c3b714fea..a700950429c5fb 100644--- a/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=e1d1f79b1929dce470a5dc9281c574cd58e8c6c0)+++ b/[fs/jfs/jfs\_dmap.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/jfs/jfs_dmap.c?id=5f148b16972e5f4592629b244d5109b15135f53f)@@ -180,7 +180,8 @@ int dbMount(struct inode \*ipbmap) bmp->db\_nfree = le64\_to\_cpu(dbmp\_le->dn\_nfree);  bmp->db\_l2nbperpage = le32\_to\_cpu(dbmp\_le->dn\_l2nbperpage);- if (bmp->db\_l2nbperpage > L2PSIZE - L2MINBLOCKSIZE) {+ if (bmp->db\_l2nbperpage > L2PSIZE - L2MINBLOCKSIZE ||+ bmp->db\_l2nbperpage < 0) { err = -EINVAL; goto err\_release\_metapage; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:52:16 +0000

