Based on the provided information, this content is related to **CVE-2024-35994**.

**Root cause of vulnerability:**
The vulnerability arises from the incorrect handling of memory regions when communicating with the Qualcomm UEFI Secure Application (uefisecapp). The `QSEECOM APP_SEND` command expects separate buffers for request and response, while uefisecapp expects these to reside within a single contiguous memory region.

**Weaknesses/vulnerabilities present:**
- **Incorrect Memory Handling:** The driver was allocating separate memory regions for request and response buffers, which contradicts uefisecapp's requirement for a single contiguous region.
- **Alignment Issues:**  The separate allocation did not ensure proper alignment between the request and response structs within the shared memory region as expected by the firmware

**Impact of exploitation:**
- **No Response:** Failure to adhere to the memory layout can result in the response buffer not being written to, leading to an I/O error (EIO).
- **SCM Call Failure:** The Secure Channel Manager (SCM) call might fail with `EINVAL`, which is an invalid argument error directly from the TrustZone (TZ) firmware.
- **Device Hard Reset:** The most severe consequence is a device hard reset.

**Attack vectors:**
The vulnerability is triggered during the communication between the kernel driver and the uefisecapp through the QSEECOM service when performing operations such as querying UEFI variables.

**Required attacker capabilities/position:**
An attacker would need to be able to trigger the vulnerable code path, which involves sending requests to the QSEECOM application. This would typically require some level of access to the system, as it involves driver interactions. The attacker would need to interact with UEFI variables to trigger the vulnerable code, such as performing operations that use `qsee_uefi_get_variable`, `qsee_uefi_set_variable`, `qsee_uefi_get_next_variable`, or `qsee_uefi_query_variable_info`.

**Additional Details:**
The provided patches address the issue by:
- Allocating a single contiguous memory block for both request and response buffers.
- Introducing macros `qcuefi_buf_align_fields`, `__reqdata_offs`  to handle proper alignment of the request and response structs within this block.
- Modifying the `qcom_qseecom_app_send` function to accept DMA addresses instead of pointers to buffers, moving DMA mapping responsibility to the caller.
- Introducing helper functions `qseecom_dma_alloc` and `qseecom_dma_free` to allocate and free DMA memory for QSEECOM client.