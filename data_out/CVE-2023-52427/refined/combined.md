=== Content from github.com_0b0b2e69_20250111_011958.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenDDS%2FOpenDDS%2Fissues%2F4388)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenDDS%2FOpenDDS%2Fissues%2F4388)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenDDS%2FOpenDDS)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenDDS](/OpenDDS)
/
**[OpenDDS](/OpenDDS/OpenDDS)**
Public

* [Notifications](/login?return_to=%2FOpenDDS%2FOpenDDS) You must be signed in to change notification settings
* [Fork
  483](/login?return_to=%2FOpenDDS%2FOpenDDS)
* [Star
   1.4k](/login?return_to=%2FOpenDDS%2FOpenDDS)

* [Code](/OpenDDS/OpenDDS)
* [Issues
  143](/OpenDDS/OpenDDS/issues)
* [Pull requests
  16](/OpenDDS/OpenDDS/pulls)
* [Discussions](/OpenDDS/OpenDDS/discussions)
* [Actions](/OpenDDS/OpenDDS/actions)
* [Projects
  6](/OpenDDS/OpenDDS/projects)
* [Wiki](/OpenDDS/OpenDDS/wiki)
* [Security](/OpenDDS/OpenDDS/security)
* [Insights](/OpenDDS/OpenDDS/pulse)

Additional navigation options

* [Code](/OpenDDS/OpenDDS)
* [Issues](/OpenDDS/OpenDDS/issues)
* [Pull requests](/OpenDDS/OpenDDS/pulls)
* [Discussions](/OpenDDS/OpenDDS/discussions)
* [Actions](/OpenDDS/OpenDDS/actions)
* [Projects](/OpenDDS/OpenDDS/projects)
* [Wiki](/OpenDDS/OpenDDS/wiki)
* [Security](/OpenDDS/OpenDDS/security)
* [Insights](/OpenDDS/OpenDDS/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenDDS%2FOpenDDS%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenDDS%2FOpenDDS%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Segmentation fault while create\_datawriter #4388

Closed

[llddang](/llddang) opened this issue
Dec 12, 2023
· 3 comments

Closed

# [Segmentation fault while create\_datawriter](#top) #4388

[llddang](/llddang) opened this issue
Dec 12, 2023
· 3 comments

## Comments

[![@llddang](https://avatars.githubusercontent.com/u/77055208?s=80&u=5e7732ed876f9a80f67e5bef0fd2f76e19a1f676&v=4)](/llddang)

Copy link

### **[llddang](/llddang)** commented [Dec 12, 2023](#issue-2036823315)

| Expected behavior Process will exit with 0. Current behavior Process exited with signal SIGSEGV, Segmentation fault. Steps to Reproduce  1. Create Participant, Topic, Publisher with default qos like [this example](https://opendds.readthedocs.io/en/latest-release/devguide/getting_started.html#getting-started). 2. Create DataWriter with max\_samples of resource\_limits of 900000000. 3. Running with RTPS (ex: `./publisher -DCPSConfigFile rtps.ini`)   publisher.cpp:  ``` int main(int argc, char* argv[]){     DomainParticipantFactory_var factory = TheParticipantFactoryWithArgs(argc, argv);      DomainParticipant_var participant= factory->create_participant(4, PARTICIPANT_QOS_DEFAULT, 0, DEFAULT_STATUS_MASK);     if( !participant ) std::cout << "ERROR: create_participant failed \n";      Messenger::MessageTypeSupport_var ts = new Messenger::MessageTypeSupportImpl;     if( ts->register_type(participant, "") != RETCODE_OK ) std::cout << "ERROR: register_type failed \n";      CORBA::String_var type_name = ts->get_type_name();     Topic_var topic = participant->create_topic("TopicName", type_name, TOPIC_QOS_DEFAULT, 0, DEFAULT_STATUS_MASK);     if( !topic ) std::cout << "ERROR: create_topic failed \n";      Publisher_var pub = participant->create_publisher(PUBLISHER_QOS_DEFAULT, 0, DEFAULT_STATUS_MASK);     if( !pub ) std::cout << "ERROR: create_publisher failed \n";      DataWriterQos writer_qos;     pub->get_default_datawriter_qos(writer_qos);     writer_qos.resource_limits.max_samples = 900000000;      DataWriter_var writer = pub->create_datawriter(topic, writer_qos, 0, DEFAULT_STATUS_MASK);     if( !writer ) std::cout << "ERROR: create_datawriter failed \n";      participant->delete_contained_entities();     factory->delete_participant(participant);      return 0; }  ```  rtps.ini:  ``` [common] DCPSGlobalTransportConfig=$file DCPSDefaultDiscovery=DEFAULT_RTPS  [transport/the_rtps_transport] transport_type=rtps_udp  ``` Open dds version 3.26 Platform / Architecture ubuntu 22.04 amd64 Additional context This bug is triggered when the value of the `max_samples` is very large. The cause may be that `WriteDataContainer` allocates memory twice the value of the `max_samples` given.  segmentation fault backtrace:  ``` Thread 1 "main" received signal SIGSEGV, Segmentation fault. 0x00007ffff73f227a in ACE_Cached_Mem_Pool_Node<OpenDDS::DCPS::DataSampleElement>::set_next (this=0x0, ptr=0x0) at /home/dpl5626/OpenDDS-3.26/ACE_wrappers/ace/Malloc_T.inl:24 24        this->next_ = ptr; (gdb) bt #0  0x00007ffff73f227a in ACE_Cached_Mem_Pool_Node<OpenDDS::DCPS::DataSampleElement>::set_next (this=0x0, ptr=0x0) at /home/dpl5626/OpenDDS-3.26/ACE_wrappers/ace/Malloc_T.inl:24 #1  0x00007ffff73f1617 in ACE_Locked_Free_List<ACE_Cached_Mem_Pool_Node<OpenDDS::DCPS::DataSampleElement>, ACE_Null_Mutex>::add (this=0x555555722150, element=0x0) at /home/dpl5626/OpenDDS-3.26/ACE_wrappers/ace/Free_List.cpp:69 #2  0x00007ffff73f093a in OpenDDS::DCPS::Cached_Allocator_With_Overflow<OpenDDS::DCPS::DataSampleElement, ACE_Null_Mutex>::Cached_Allocator_With_Overflow (this=0x555555722138, n_chunks=1800000000)     at ../dds/DCPS/Cached_Allocator_With_Overflow_T.h:76 #3  0x00007ffff748798b in OpenDDS::DCPS::WriteDataContainer::WriteDataContainer (this=0x555555721ed0, writer=0x555555720e30, max_samples_per_instance=2147483647, history_depth=1, max_durable_per_instance=0,      max_blocking_time=..., n_chunks=900000000, domain_id=4, topic_name=0x5555556ef600 "TopicName", type_name=0x55555571acc0 "Messenger::Message", durability_cache=0x0, durability_service=..., max_instances=0,      max_total_samples=900000000, deadline_status_lock=..., deadline_status=..., deadline_last_total_count=@0x555555721348: 0, __in_chrg=<optimized out>, __vtt_parm=<optimized out>)     at /home/dpl5626/OpenDDS-3.26/dds/DCPS/WriteDataContainer.cpp:102 #4  0x00007ffff72ee8fb in OpenDDS::DCPS::DataWriterImpl::enable (this=0x555555720e30) at /home/dpl5626/OpenDDS-3.26/dds/DCPS/DataWriterImpl.cpp:1413 #5  0x00007ffff73b7093 in OpenDDS::DCPS::PublisherImpl::create_datawriter (this=0x555555720830, a_topic=0x555555720180, qos=..., a_listener=0x0, mask=4294967295) at /home/dpl5626/OpenDDS-3.26/dds/DCPS/PublisherImpl.cpp:161 #6  0x0000555555591dc8 in main ()  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@jrw972](https://avatars.githubusercontent.com/u/9758895?s=80&u=550ea33bf459fe5668ce95e121dc72c8bc3a1115&v=4)](/jrw972)

Copy link

Contributor

### **[jrw972](/jrw972)** commented [Dec 12, 2023](#issuecomment-1852943594)

| When resource limits are known, OpenDDS allocates memory for that limit. In the example you present, OpenDDS will attempt to allocate 900,000,000 DataSampleElements. Conservatively, a DataSampleElement is 128 bytes so it is attempting to allocate approximately 107 GB of memory. Presumably, this will fail on most systems.  An alternative implementation would not preallocate and only allocate when necessary off of the heap. In this case, the application would eventually allocate the same amount of memory and, presumably, fail. Thus, the existing implementation has the advantage that misconfiguration is detected earlier. It is the responsibility of the user to configure OpenDDS in a way that makes sense for their system. |
| --- |

All reactions

Sorry, something went wrong.

[![@jrw972](https://avatars.githubusercontent.com/u/9758895?s=40&u=550ea33bf459fe5668ce95e121dc72c8bc3a1115&v=4)](/jrw972)
[jrw972](/jrw972)
closed this as [not planned](/OpenDDS/OpenDDS/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3A%22not+planned%22)
Won't fix, can't repro, duplicate, stale
[Dec 15, 2023](#event-11262776343)

[![@llddang](https://avatars.githubusercontent.com/u/77055208?s=80&u=5e7732ed876f9a80f67e5bef0fd2f76e19a1f676&v=4)](/llddang)

Copy link

Author

### **[llddang](/llddang)** commented [Dec 21, 2023](#issuecomment-1866899908)

| Hi [@jrw972](https://github.com/jrw972). Thank you for your response. As you mentioned, I agree that allocating memory by this value will fail. However, it worked without any problems on the same machine when allocating by this value for other open source vendors such as Fast-DDS and Cyclone DDS. Considering that DDS should be interoperable, operating differently for the same value (abnormal termination in this case) is problematic. Therefore, I think handling is necessary for this. |
| --- |

All reactions

Sorry, something went wrong.

[![@jrw972](https://avatars.githubusercontent.com/u/9758895?s=80&u=550ea33bf459fe5668ce95e121dc72c8bc3a1115&v=4)](/jrw972)

Copy link

Contributor

### **[jrw972](/jrw972)** commented [Jan 2, 2024](#issuecomment-1874544618)

| Interoperability is the ability of different DDS implementations to exchange data. The RTPS specification is concerned with interoperability. Portability is the ability to write a DDS program that works the same with different DDS vendors. The DDS specification does not require portability. Thus, it is not our goal that every program written for Fast-DDS and Cyclone DDS works with OpenDDS and we do not expect or require that every program written for OpenDDS work with Fast-DDS and Cyclone DDS.  However, if you have a set of programs that must be portable across various DDS implementations and OpenDDS does not meet your needs, then you are free to extend OpenDDS for your needs. In this case, you would probably need to add configuration for the `Cached_Allocator_With_Overflow`. By default, it should statically allocate up to the resource limit as it does now. The configuration would allow the user to set a lower maximum so the allocator would statically allocate fewer items. |
| --- |

All reactions

Sorry, something went wrong.

[![@mirusu400](https://avatars.githubusercontent.com/u/25397908?s=40&v=4)](/mirusu400)
[mirusu400](/mirusu400)
mentioned this issue
[Mar 20, 2024](#ref-issue-2196614921)

[Process killed with high RAM usage when setting malicious DataReaderQoS setting
#4527](/OpenDDS/OpenDDS/issues/4527)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenDDS%2FOpenDDS%2Fissues%2F4388)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@jrw972](https://avatars.githubusercontent.com/u/9758895?s=52&v=4)](/jrw972) [![@llddang](https://avatars.githubusercontent.com/u/77055208?s=52&v=4)](/llddang)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


