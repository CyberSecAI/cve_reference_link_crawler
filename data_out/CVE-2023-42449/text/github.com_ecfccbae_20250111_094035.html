
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcardano-scaling%2Fhydra%2Fsecurity%2Fadvisories%2FGHSA-9m8q-7wxv-v65p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcardano-scaling%2Fhydra%2Fsecurity%2Fadvisories%2FGHSA-9m8q-7wxv-v65p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=cardano-scaling%2Fhydra)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cardano-scaling](/cardano-scaling)
/
**[hydra](/cardano-scaling/hydra)**
Public

* [Notifications](/login?return_to=%2Fcardano-scaling%2Fhydra) You must be signed in to change notification settings
* [Fork
  88](/login?return_to=%2Fcardano-scaling%2Fhydra)
* [Star
   291](/login?return_to=%2Fcardano-scaling%2Fhydra)

* [Code](/cardano-scaling/hydra)
* [Issues
  73](/cardano-scaling/hydra/issues)
* [Pull requests
  5](/cardano-scaling/hydra/pulls)
* [Discussions](/cardano-scaling/hydra/discussions)
* [Actions](/cardano-scaling/hydra/actions)
* [Projects
  1](/cardano-scaling/hydra/projects)
* [Wiki](/cardano-scaling/hydra/wiki)
* [Security](/cardano-scaling/hydra/security)
* [Insights](/cardano-scaling/hydra/pulse)

Additional navigation options

* [Code](/cardano-scaling/hydra)
* [Issues](/cardano-scaling/hydra/issues)
* [Pull requests](/cardano-scaling/hydra/pulls)
* [Discussions](/cardano-scaling/hydra/discussions)
* [Actions](/cardano-scaling/hydra/actions)
* [Projects](/cardano-scaling/hydra/projects)
* [Wiki](/cardano-scaling/hydra/wiki)
* [Security](/cardano-scaling/hydra/security)
* [Insights](/cardano-scaling/hydra/pulse)

# Malicious head initialiser can extract PTs from control of Hydra scripts, leading to locked participant commits or spoofed commits

High

Unknown
published
GHSA-9m8q-7wxv-v65p
Oct 4, 2023

## Package

hydra-node

## Affected versions

< 0.13.0

## Patched versions

0.13.0

## Description

### Summary

In normal use the participation tokens of a Hydra head remain under the control of the Hydra validators from the point they are minted until they are burned. Because of this, the validators can trust that a UTxO containing a PT has been progressed through the Hydra validators which come before it and been subject to the constraints and checks performed by the validators which the PT has passed through.

For example, the `commit` validator assumes that a UTxO residing at the `commit` validator containing a PT can only have progressed from the `initial` validator to the UTxO at the `commit` validator if the transaction creating the UTxO passed the checks enforced by the `initial` validator. In this particular case, the `commit` validator knows that for a UTxO containing a PT at the `commit` validator that specifies a reference to a committed UTxO `commit_ref` in its datum, the `initial` validator will have checked that the participant really did commit that UTxO.

A UTxO containing a PT and its data is seen as trusted, because it has been progressed through the Hydra validators and subject to their checks. Therefore if a malicious user can extract a PT from the control of the Hydra validators this trust assumption is broken, because it is no longer true that a UTxO containing a PT was subject to the checks of the Hydra validators, and the malicious user can place the PT in any UTxO with any datum they like attached at any address they wish. For example, the attacker can put the PT in a UTxO at the `commit` validator stating in the datum that they committed a particular UTxO, when in reality they did not really `commit` this UTxO which was possible because this was not checked by the `initial` validator, as the PT was moved from the control of the attacker to the `commit` validator instead of from the `initial` contract.

It is possible for a malicious head initialiser to extract one or more PTs for the head they are initialising due to incorrect data validation logic in the head token minting policy which then results in an flawed check for burning the head ST in the `initial` validator.

### Details

It is possible for a malicious head initialiser to extract one or more PTs for the head they are initialising. First, in the head-initialisation transaction the attacker specifies a policy they control (`attacker_cid`) instead of the real head ID policy in the datum of one of the outputs at the `initial` validator.

[![image](https://user-images.githubusercontent.com/25673452/261073622-7239b08e-81d5-4ae6-9372-3751d67284ea.png)](https://user-images.githubusercontent.com/25673452/261073622-7239b08e-81d5-4ae6-9372-3751d67284ea.png)

This is possible because it is not checked in [HeadTokens.hs](https://github.com/input-output-hk/hydra/blob/master/hydra-plutus/src/Hydra/Contract/HeadTokens.hs#L76-L136) that the datums of the outputs at the `initial` validator are equal to the real head ID, and it is also not checked in the [off-chain code](https://github.com/input-output-hk/hydra/blob/1e13b60a7b21c5ccd6c36e3cf220547f5d443cef/hydra-node/src/Hydra/Chain/Direct/Tx.hs#L645-L761).

The UTxO resides at the `initial` validator and contains a PT for the real head ID. It is possible to spend UTxOs at the `initial` contract using one of two redeemers, `viaAbort` and `viaCommit`. If the UTxO is being redeemed using `viaAbort` then the only check performed is that the state token for the head is burned in the transaction, as this will mean the `head` validator enforces a number of rules (such as the PTs being burned).

<https://github.com/input-output-hk/hydra/blob/1e13b60a7b21c5ccd6c36e3cf220547f5d443cef/hydra-plutus/src/Hydra/Contract/Initial.hs#L84-L91>

This check that the state token is burned takes the head ID from the UTxO datum, and checks that the txmint field contains `datum.head_id -> "HydraHeadV1" -> (-1)`, but *the attacker set the head ID in the datum to a policy they control instead of the real head ID*; that is, `datum.head_id = attacker_cid`. This means that the only check done by `viaAbort` is that the txmint field contains `attacker_cid -> "HydraHeadV1" -> (-1)`, which the attacker can satisfy because they control `attacker_cid` and can have previously minted a token named `"HydraHeadV1"` that they can burn in the transaction.

[![image](https://user-images.githubusercontent.com/25673452/261079145-f857c18c-6ecc-4a8c-a4eb-5e346f422dde.png)](https://user-images.githubusercontent.com/25673452/261079145-f857c18c-6ecc-4a8c-a4eb-5e346f422dde.png)

This means the attacker can spend the UTxO at the `initial` validator containing a PT for the head by burning the "fake" head ST they minted previously, and bypass the usual checks that would be performed by the `head` validator when burning the real head ST - in particular they can move the PT out of control of the Hydra validators and into their own control/wallet.

### PoC

* Attacker creates a minting policy (`attacker_cid`) and mints the token named "HydraHeadV1" under that policy.
* Attacker creates an `InitTx` to initialise a Hydra head with `head_cid`, but in one of the outputs (`malicious_output`) at the `initial` contract they specify `attacker_cid` in the datum instead of `head_cid`.
* Attacker creates a transaction which:
  + spends `malicious_output` with the `ViaAbort` redeemer
  + burns `1` of the token they minted earlier (txmint field contains `attacker_cid -> "HydraHeadV1" -> (-1)`)
  + sends the PT for `head_cid` contained in `malicious_output` to their own wallet (or anywhere they wish)

The attacker then has control of a PT for `head_cid`.

### Impact

During the `Initial` state of the protocol, if the malicious initialiser removes a PT from the Hydra scripts it becomes impossible for any other participant to reclaim any funds they have attempted to commit into the head, as to do so the Abort transaction must burn all the PTs for the head, but they cannot burn the PT which the attacker controls and so cannot satisfy this requirement. That means the initialiser can lock the other participants committed funds forever or until they choose to return the PT (ransom).

The malicious initialiser can also use the PT to spoof that they have committed a particular TxO when progressing the head into the `Open` state. For example, they could say they committed a TxO residing at their address containing 100 ADA, but in fact this 100 ADA was not moved into the head, and thus in order for an other participant to perform the fanout they will be forced to pay the attacker the 100 ADA out of their own funds, as the fanout transaction must pay all the committed TxOs (even though the attacker did not really commit that TxO). They can do this by placing the PT in a UTxO with a well-formed `Commit` datum with whatever contents they like, then use this UTxO in the `collectCom` transaction.

There may be other possible ways to abuse having control of a PT.

### Severity

High

8.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:H

### CVE ID

CVE-2023-42449

### Weaknesses

No CWEs

### Credits

* [![@jmhrpr](https://avatars.githubusercontent.com/u/25673452?s=40&v=4)](/jmhrpr)
  [jmhrpr](/jmhrpr)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

