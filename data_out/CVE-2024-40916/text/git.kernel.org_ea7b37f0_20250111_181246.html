

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Marek Szyprowski <m.szyprowski@samsung.com> | 2024-04-25 11:48:51 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-21 14:38:38 +0200 |
| commit | [35bcf16b4a28c10923ff391d14f6ed0ae471ee5f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)) | |
| tree | [fa672ee6740005b07d6fd9b3423fa2bfc9ed5ed7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f) | |
| parent | [a269c5701244db2722ae0fce5d1854f5d8f31224](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a269c5701244db2722ae0fce5d1854f5d8f31224) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f&id2=a269c5701244db2722ae0fce5d1854f5d8f31224)) | |
| download | [linux-35bcf16b4a28c10923ff391d14f6ed0ae471ee5f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-35bcf16b4a28c10923ff391d14f6ed0ae471ee5f.tar.gz) | |

drm/exynos: hdmi: report safe 640x480 mode as a fallback when no EDID foundcommit 799d4b392417ed6889030a5b2335ccb6dcf030ab upstream.
When reading EDID fails and driver reports no modes available, the DRM
core adds an artificial 1024x786 mode to the connector. Unfortunately
some variants of the Exynos HDMI (like the one in Exynos4 SoCs) are not
able to drive such mode, so report a safe 640x480 mode instead of nothing
in case of the EDID reading failure.
This fixes the following issue observed on Trats2 board since commit
13d5b040363c ("drm/exynos: do not return negative values from .get\_modes()"):
[drm] Exynos DRM: using 11c00000.fimd device for DMA mapping operations
exynos-drm exynos-drm: bound 11c00000.fimd (ops fimd\_component\_ops)
exynos-drm exynos-drm: bound 12c10000.mixer (ops mixer\_component\_ops)
exynos-dsi 11c80000.dsi: [drm:samsung\_dsim\_host\_attach] Attached s6e8aa0 device (lanes:4 bpp:24 mode-flags:0x10b)
exynos-drm exynos-drm: bound 11c80000.dsi (ops exynos\_dsi\_component\_ops)
exynos-drm exynos-drm: bound 12d00000.hdmi (ops hdmi\_component\_ops)
[drm] Initialized exynos 1.1.0 20180330 for exynos-drm on minor 1
exynos-hdmi 12d00000.hdmi: [drm:hdmiphy\_enable.part.0] \*ERROR\* PLL could not reach steady state
panel-samsung-s6e8aa0 11c80000.dsi.0: ID: 0xa2, 0x20, 0x8c
exynos-mixer 12c10000.mixer: timeout waiting for VSYNC
------------[ cut here ]------------
WARNING: CPU: 1 PID: 11 at drivers/gpu/drm/drm\_atomic\_helper.c:1682 drm\_atomic\_helper\_wait\_for\_vblanks.part.0+0x2b0/0x2b8
[CRTC:70:crtc-1] vblank wait timed out
Modules linked in:
CPU: 1 PID: 11 Comm: kworker/u16:0 Not tainted 6.9.0-rc5-next-20240424 #14913
Hardware name: Samsung Exynos (Flattened Device Tree)
Workqueue: events\_unbound deferred\_probe\_work\_func
Call trace:
unwind\_backtrace from show\_stack+0x10/0x14
show\_stack from dump\_stack\_lvl+0x68/0x88
dump\_stack\_lvl from \_\_warn+0x7c/0x1c4
\_\_warn from warn\_slowpath\_fmt+0x11c/0x1a8
warn\_slowpath\_fmt from drm\_atomic\_helper\_wait\_for\_vblanks.part.0+0x2b0/0x2b8
drm\_atomic\_helper\_wait\_for\_vblanks.part.0 from drm\_atomic\_helper\_commit\_tail\_rpm+0x7c/0x8c
drm\_atomic\_helper\_commit\_tail\_rpm from commit\_tail+0x9c/0x184
commit\_tail from drm\_atomic\_helper\_commit+0x168/0x190
drm\_atomic\_helper\_commit from drm\_atomic\_commit+0xb4/0xe0
drm\_atomic\_commit from drm\_client\_modeset\_commit\_atomic+0x23c/0x27c
drm\_client\_modeset\_commit\_atomic from drm\_client\_modeset\_commit\_locked+0x60/0x1cc
drm\_client\_modeset\_commit\_locked from drm\_client\_modeset\_commit+0x24/0x40
drm\_client\_modeset\_commit from \_\_drm\_fb\_helper\_restore\_fbdev\_mode\_unlocked+0x9c/0xc4
\_\_drm\_fb\_helper\_restore\_fbdev\_mode\_unlocked from drm\_fb\_helper\_set\_par+0x2c/0x3c
drm\_fb\_helper\_set\_par from fbcon\_init+0x3d8/0x550
fbcon\_init from visual\_init+0xc0/0x108
visual\_init from do\_bind\_con\_driver+0x1b8/0x3a4
do\_bind\_con\_driver from do\_take\_over\_console+0x140/0x1ec
do\_take\_over\_console from do\_fbcon\_takeover+0x70/0xd0
do\_fbcon\_takeover from fbcon\_fb\_registered+0x19c/0x1ac
fbcon\_fb\_registered from register\_framebuffer+0x190/0x21c
register\_framebuffer from \_\_drm\_fb\_helper\_initial\_config\_and\_unlock+0x350/0x574
\_\_drm\_fb\_helper\_initial\_config\_and\_unlock from exynos\_drm\_fbdev\_client\_hotplug+0x6c/0xb0
exynos\_drm\_fbdev\_client\_hotplug from drm\_client\_register+0x58/0x94
drm\_client\_register from exynos\_drm\_bind+0x160/0x190
exynos\_drm\_bind from try\_to\_bring\_up\_aggregate\_device+0x200/0x2d8
try\_to\_bring\_up\_aggregate\_device from \_\_component\_add+0xb0/0x170
\_\_component\_add from mixer\_probe+0x74/0xcc
mixer\_probe from platform\_probe+0x5c/0xb8
platform\_probe from really\_probe+0xe0/0x3d8
really\_probe from \_\_driver\_probe\_device+0x9c/0x1e4
\_\_driver\_probe\_device from driver\_probe\_device+0x30/0xc0
driver\_probe\_device from \_\_device\_attach\_driver+0xa8/0x120
\_\_device\_attach\_driver from bus\_for\_each\_drv+0x80/0xcc
bus\_for\_each\_drv from \_\_device\_attach+0xac/0x1fc
\_\_device\_attach from bus\_probe\_device+0x8c/0x90
bus\_probe\_device from deferred\_probe\_work\_func+0x98/0xe0
deferred\_probe\_work\_func from process\_one\_work+0x240/0x6d0
process\_one\_work from worker\_thread+0x1a0/0x3f4
worker\_thread from kthread+0x104/0x138
kthread from ret\_from\_fork+0x14/0x28
Exception stack(0xf0895fb0 to 0xf0895ff8)
...
irq event stamp: 82357
hardirqs last enabled at (82363): [<c01a96e8>] vprintk\_emit+0x308/0x33c
hardirqs last disabled at (82368): [<c01a969c>] vprintk\_emit+0x2bc/0x33c
softirqs last enabled at (81614): [<c0101644>] \_\_do\_softirq+0x320/0x500
softirqs last disabled at (81609): [<c012dfe0>] \_\_irq\_exit\_rcu+0x130/0x184
---[ end trace 0000000000000000 ]---
exynos-drm exynos-drm: [drm] \*ERROR\* flip\_done timed out
exynos-drm exynos-drm: [drm] \*ERROR\* [CRTC:70:crtc-1] commit wait timed out
exynos-drm exynos-drm: [drm] \*ERROR\* flip\_done timed out
exynos-drm exynos-drm: [drm] \*ERROR\* [CONNECTOR:74:HDMI-A-1] commit wait timed out
exynos-drm exynos-drm: [drm] \*ERROR\* flip\_done timed out
exynos-drm exynos-drm: [drm] \*ERROR\* [PLANE:56:plane-5] commit wait timed out
exynos-mixer 12c10000.mixer: timeout waiting for VSYNC
Cc: stable@vger.kernel.org
Fixes: 13d5b040363c ("drm/exynos: do not return negative values from .get\_modes()")
Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com>
Signed-off-by: Inki Dae <inki.dae@samsung.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)

| -rw-r--r-- | [drivers/gpu/drm/exynos/exynos\_hdmi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/exynos/exynos_hdmi.c?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/gpu/drm/exynos/exynos\_hdmi.c b/drivers/gpu/drm/exynos/exynos\_hdmi.cindex eff51bfc464407..906133331a4424 100644--- a/[drivers/gpu/drm/exynos/exynos\_hdmi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/exynos/exynos_hdmi.c?id=a269c5701244db2722ae0fce5d1854f5d8f31224)+++ b/[drivers/gpu/drm/exynos/exynos\_hdmi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/exynos/exynos_hdmi.c?id=35bcf16b4a28c10923ff391d14f6ed0ae471ee5f)@@ -887,11 +887,11 @@ static int hdmi\_get\_modes(struct drm\_connector \*connector) int ret;  if (!hdata->ddc\_adpt)- return 0;+ goto no\_edid;  edid = drm\_get\_edid(connector, hdata->ddc\_adpt); if (!edid)- return 0;+ goto no\_edid;  hdata->dvi\_mode = !connector->display\_info.is\_hdmi; DRM\_DEV\_DEBUG\_KMS(hdata->dev, "%s : width[%d] x height[%d]\n",@@ -906,6 +906,9 @@ static int hdmi\_get\_modes(struct drm\_connector \*connector) kfree(edid);  return ret;++no\_edid:+ return drm\_add\_modes\_noedid(connector, 640, 480); }  static int hdmi\_find\_phy\_conf(struct hdmi\_context \*hdata, u32 pixel\_clock) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:11:23 +0000

