

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3037664%2540maintenance-page%252Ftrunk%26old%3D1218033%2540maintenance-page%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/1218033/maintenance-page/trunk?old=3037664&old_path=%2Fmaintenance-page%2Ftrunk)

---

# Changes in [maintenance-page/trunk](/browser/maintenance-page/trunk?rev=3037664 "Show entry in browser") [[1218033:3037664]](/log/maintenance-page/trunk?rev=3037664&stop_rev=1218033 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[maintenance-page/trunk](/browser/maintenance-page/trunk?rev=3037664)
Files:

8 edited

* [includes/admin/class-settings-api.php](/browser/maintenance-page/trunk/includes/admin/class-settings-api.php?rev=3037664 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [includes/admin/settings-api.php](/browser/maintenance-page/trunk/includes/admin/settings-api.php?rev=3037664 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [includes/lib/class-maintenance-page-activator.php](/browser/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?rev=3037664 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [includes/lib/subscriber\_handler.php](/browser/maintenance-page/trunk/includes/lib/subscriber_handler.php?rev=3037664 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [maintenance-page.php](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664 "Show entry in browser")
  (modified)
  ([10 diffs](#file4 "Show differences"))
* [public/template/maintenance-page-display.php](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664 "Show entry in browser")
  (modified)
  ([6 diffs](#file5 "Show differences"))
* [readme.txt](/browser/maintenance-page/trunk/readme.txt?rev=3037664 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [uninstall.php](/browser/maintenance-page/trunk/uninstall.php?rev=3037664 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [maintenance-page/trunk/includes/admin/class-settings-api.php](/changeset/3037664/maintenance-page/trunk/includes/admin/class-settings-api.php?old=1218029&old_path=maintenance-page%2Ftrunk%2Fincludes%2Fadmin%2Fclass-settings-api.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/includes/admin/class-settings-api.php")

  | [r1218033](/browser/maintenance-page/trunk/includes/admin/class-settings-api.php?rev=1218029#L15 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/includes/admin/class-settings-api.php?rev=3037664#L15 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | \* |
  | 16 | 16 | \*/ |
  | 17 |  | if ( !class\_exists( 'MP\_Settings\_API' ) ): |
  | 18 |  | class MP\_Settings\_API { |
  | 19 |  |  |
  | 20 |  | /\*\* |
  | 21 |  | \* settings sections array |
  | 22 |  | \* |
  | 23 |  | \* @var array |
  | 24 |  | \*/ |
  | 25 |  | private $settings\_sections = array(); |
  | 26 |  |  |
  | 27 |  | /\*\* |
  | 28 |  | \* Settings fields array |
  | 29 |  | \* |
  | 30 |  | \* @var array |
  | 31 |  | \*/ |
  | 32 |  | private $settings\_fields = array(); |
  | 33 |  |  |
  | 34 |  | /\*\* |
  | 35 |  | \* Singleton instance |
  | 36 |  | \* |
  | 37 |  | \* @var object |
  | 38 |  | \*/ |
  | 39 |  | private static $\_instance; |
  | 40 |  |  |
  | 41 |  | public function \_\_construct() { |
  | 42 |  | add\_action( 'admin\_enqueue\_scripts', array( $this, 'admin\_enqueue\_scripts' ) ); |
  | 43 |  | $this->mp\_sanitize\_callbacks(); |
  | 44 |  | } |
  | 45 |  |  |
  | 46 |  | /\*\* |
  | 47 |  | \* Enqueue scripts and styles |
  | 48 |  | \*/ |
  | 49 |  | function admin\_enqueue\_scripts() { |
  | 50 |  | wp\_enqueue\_style( 'wp-color-picker' ); |
  | 51 |  |  |
  | 52 |  | wp\_enqueue\_media(); |
  | 53 |  | wp\_enqueue\_script( 'wp-color-picker' ); |
  | 54 |  | wp\_enqueue\_script( 'jquery' ); |
  | 55 |  | } |
  | 56 |  |  |
  | 57 |  | /\*\* |
  | 58 |  | \* Set settings sections |
  | 59 |  | \* |
  | 60 |  | \* @param array   $sections setting sections array |
  | 61 |  | \*/ |
  | 62 |  | function set\_sections( $sections ) { |
  | 63 |  | $this->settings\_sections = $sections; |
  | 64 |  |  |
  | 65 |  | return $this; |
  | 66 |  | } |
  | 67 |  |  |
  | 68 |  | /\*\* |
  | 69 |  | \* Add a single section |
  | 70 |  | \* |
  | 71 |  | \* @param array   $section |
  | 72 |  | \*/ |
  | 73 |  | function add\_section( $section ) { |
  | 74 |  | $this->settings\_sections[] = $section; |
  | 75 |  |  |
  | 76 |  | return $this; |
  | 77 |  | } |
  | 78 |  |  |
  | 79 |  | /\*\* |
  | 80 |  | \* Set settings fields |
  | 81 |  | \* |
  | 82 |  | \* @param array   $fields settings fields array |
  | 83 |  | \*/ |
  | 84 |  | function set\_fields( $fields ) { |
  | 85 |  | $this->settings\_fields = $fields; |
  | 86 |  |  |
  | 87 |  | return $this; |
  | 88 |  | } |
  | 89 |  |  |
  | 90 |  | function add\_field( $section, $field ) { |
  | 91 |  | $defaults = array( |
  | 92 |  | 'name' => '', |
  | 93 |  | 'label' => '', |
  | 94 |  | 'desc' => '', |
  | 95 |  | 'type' => 'text' |
  | 96 |  | ); |
  | 97 |  |  |
  | 98 |  | $arg = wp\_parse\_args( $field, $defaults ); |
  | 99 |  | $this->settings\_fields[$section][] = $arg; |
  | 100 |  |  |
  | 101 |  | return $this; |
  | 102 |  | } |
  | 103 |  |  |
  | 104 |  | /\*\* |
  | 105 |  | \* Initialize and registers the settings sections and fileds to WordPress |
  | 106 |  | \* |
  | 107 |  | \* Usually this should be called at `admin\_init` hook. |
  | 108 |  | \* |
  | 109 |  | \* This function gets the initiated settings sections and fields. Then |
  | 110 |  | \* registers them to WordPress and ready for use. |
  | 111 |  | \*/ |
  | 112 |  | function admin\_init() { |
  | 113 |  | //register settings sections |
  | 114 |  | foreach ( $this->settings\_sections as $section ) { |
  | 115 |  | if ( false == get\_option( $section['id'] ) ) { |
  | 116 |  | add\_option( $section['id'] ); |
  | 117 |  | } |
  | 118 |  |  |
  | 119 |  | if ( isset($section['desc']) && !empty($section['desc']) ) { |
  | 120 |  | $section['desc'] = '<div class="inside">'.$section['desc'].'</div>'; |
  | 121 |  | $callback = create\_function('', 'echo "'.str\_replace('"', '\"', $section['desc']).'";'); |
  | 122 |  | } else { |
  | 123 |  | $callback = '\_\_return\_false'; |
  | 124 |  | } |
  | 125 |  |  |
  | 126 |  | add\_settings\_section( $section['id'], $section['title'], $callback, $section['id'] ); |
  | 127 |  | } |
  | 128 |  |  |
  | 129 |  | //register settings fields |
  | 130 |  | foreach ( $this->settings\_fields as $section => $field ) { |
  | 131 |  | foreach ( $field as $option ) { |
  | 132 |  |  |
  | 133 |  | $type = isset( $option['type'] ) ? $option['type'] : 'text'; |
  | 134 |  |  |
  | 135 |  | $args = array( |
  | 136 |  | 'id' => $option['name'], |
  | 137 |  | 'desc' => isset( $option['desc'] ) ? $option['desc'] : '', |
  | 138 |  | 'name' => $option['label'], |
  | 139 |  | 'section' => $section, |
  | 140 |  | 'size' => isset( $option['size'] ) ? $option['size'] : null, |
  | 141 |  | 'options' => isset( $option['options'] ) ? $option['options'] : '', |
  | 142 |  | 'std' => isset( $option['default'] ) ? $option['default'] : '', |
  | 143 |  | 'sanitize\_callback' => isset( $option['sanitize\_callback'] ) ? $option['sanitize\_callback'] : '', |
  | 144 |  | ); |
  | 145 |  | add\_settings\_field( $section . '[' . $option['name'] . ']', $option['label'], array( $this, 'callback\_' . $type ), $section, $section, $args ); |
  | 146 |  | } |
  | 147 |  | } |
  | 148 |  |  |
  | 149 |  | // creates our settings in the options table |
  | 150 |  | foreach ( $this->settings\_sections as $section ) { |
  | 151 |  | register\_setting( $section['id'], $section['id'], array( $this, 'sanitize\_options' ) ); |
  | 152 |  | } |
  | 153 |  | } |
  | 154 |  |  |
  | 155 |  | /\*\* |
  | 156 |  | \* collection of our own sanitization functions |
  | 157 |  | \*/ |
  | 158 |  | function mp\_sanitize\_callbacks() { |
  | 159 |  |  |
  | 160 |  | function mp\_filter\_kses( $data ) { |
  | 161 |  | if ( current\_user\_can('unfiltered\_html') ) { |
  | 162 |  | return $data; |
  | 163 |  | } else { |
  | 164 |  | return wp\_kses\_post( $data ); |
  | 165 |  | } |
  | 166 |  |  |
  | 167 |  | } |
  | 168 |  |  |
  | 169 |  | } |
  | 170 |  |  |
  | 171 |  | /\*\* |
  | 172 |  | \* Displays a text field for a settings field |
  | 173 |  | \* |
  | 174 |  | \* @param array   $args settings field args |
  | 175 |  | \*/ |
  | 176 |  | function callback\_text( $args ) { |
  | 177 |  |  |
  | 178 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 179 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 180 |  |  |
  | 181 |  | $html = sprintf( '<input type="text" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  | 182 |  | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  | 183 |  |  |
  | 184 |  | echo $html; |
  | 185 |  | } |
  | 186 |  |  |
  | 187 |  | /\*\* |
  | 188 |  | \* Displays a checkbox for a settings field |
  | 189 |  | \* |
  | 190 |  | \* @param array   $args settings field args |
  | 191 |  | \*/ |
  | 192 |  | function callback\_checkbox( $args ) { |
  | 193 |  |  |
  | 194 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 195 |  |  |
  | 196 |  | $html = sprintf( '<input type="hidden" name="%1$s[%2$s]" value="off" />', $args['section'], $args['id'] ); |
  | 197 |  | $html .= sprintf( '<input type="checkbox" class="checkbox" id="wpuf-%1$s[%2$s]" name="%1$s[%2$s]" value="on"%4$s />', $args['section'], $args['id'], $value, checked( $value, 'on', false ) ); |
  | 198 |  | $html .= sprintf( '<label for="wpuf-%1$s[%2$s]"> %3$s</label>', $args['section'], $args['id'], $args['desc'] ); |
  | 199 |  |  |
  | 200 |  | echo $html; |
  | 201 |  | } |
  | 202 |  |  |
  | 203 |  | /\*\* |
  | 204 |  | \* Displays a multicheckbox a settings field |
  | 205 |  | \* |
  | 206 |  | \* @param array   $args settings field args |
  | 207 |  | \*/ |
  | 208 |  | function callback\_multicheck( $args ) { |
  | 209 |  |  |
  | 210 |  | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  | 211 |  |  |
  | 212 |  | $html = ''; |
  | 213 |  | foreach ( $args['options'] as $key => $label ) { |
  | 214 |  | $checked = isset( $value[$key] ) ? $value[$key] : '0'; |
  | 215 |  | $html .= sprintf( '<input type="checkbox" class="checkbox" id="wpuf-%1$s[%2$s][%3$s]" name="%1$s[%2$s][%3$s]" value="%3$s"%4$s />', $args['section'], $args['id'], $key, checked( $checked, $key, false ) ); |
  | 216 |  | $html .= sprintf( '<label for="wpuf-%1$s[%2$s][%4$s]"> %3$s</label><br>', $args['section'], $args['id'], $label, $key ); |
  | 217 |  | } |
  | 218 |  | $html .= sprintf( '<span class="description"> %s</label>', $args['desc'] ); |
  | 219 |  |  |
  | 220 |  | echo $html; |
  | 221 |  | } |
  | 222 |  |  |
  | 223 |  | /\*\* |
  | 224 |  | \* Displays a multicheckbox a settings field |
  | 225 |  | \* |
  | 226 |  | \* @param array   $args settings field args |
  | 227 |  | \*/ |
  | 228 |  | function callback\_radio( $args ) { |
  | 229 |  |  |
  | 230 |  | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  | 231 |  |  |
  | 232 |  | $html = ''; |
  | 233 |  | foreach ( $args['options'] as $key => $label ) { |
  | 234 |  | $html .= sprintf( '<input type="radio" class="radio" id="wpuf-%1$s[%2$s][%3$s]" name="%1$s[%2$s]" value="%3$s"%4$s />', $args['section'], $args['id'], $key, checked( $value, $key, false ) ); |
  | 235 |  | $html .= sprintf( '<label for="wpuf-%1$s[%2$s][%4$s]"> %3$s</label><br>', $args['section'], $args['id'], $label, $key ); |
  | 236 |  | } |
  | 237 |  | $html .= sprintf( '<span class="description"> %s</label>', $args['desc'] ); |
  | 238 |  |  |
  | 239 |  | echo $html; |
  | 240 |  | } |
  | 241 |  |  |
  | 242 |  | /\*\* |
  | 243 |  | \* Displays a selectbox for a settings field |
  | 244 |  | \* |
  | 245 |  | \* @param array   $args settings field args |
  | 246 |  | \*/ |
  | 247 |  | function callback\_select( $args ) { |
  | 248 |  |  |
  | 249 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 250 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 251 |  |  |
  | 252 |  | $html = sprintf( '<select class="%1$s" name="%2$s[%3$s]" id="%2$s[%3$s]">', $size, $args['section'], $args['id'] ); |
  | 253 |  | foreach ( $args['options'] as $key => $label ) { |
  | 254 |  | $html .= sprintf( '<option value="%s"%s>%s</option>', $key, selected( $value, $key, false ), $label ); |
  | 255 |  | } |
  | 256 |  | $html .= sprintf( '</select>' ); |
  | 257 |  | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  | 258 |  |  |
  | 259 |  | echo $html; |
  | 260 |  | } |
  | 261 |  |  |
  | 262 |  | /\*\* |
  | 263 |  | \* Displays a textarea for a settings field |
  | 264 |  | \* |
  | 265 |  | \* @param array   $args settings field args |
  | 266 |  | \*/ |
  | 267 |  | function callback\_textarea( $args ) { |
  | 268 |  |  |
  | 269 |  | $value = esc\_textarea( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 270 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 271 |  |  |
  | 272 |  | $html = sprintf( '<textarea rows="5" cols="55" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]">%4$s</textarea>', $size, $args['section'], $args['id'], $value ); |
  | 273 |  | $html .= sprintf( '<br><span class="description"> %s</span>', $args['desc'] ); |
  | 274 |  |  |
  | 275 |  | echo $html; |
  | 276 |  | } |
  | 277 |  |  |
  | 278 |  | /\*\* |
  | 279 |  | \* Displays a textarea for a settings field |
  | 280 |  | \* |
  | 281 |  | \* @param array   $args settings field args |
  | 282 |  | \*/ |
  | 283 |  | function callback\_html( $args ) { |
  | 284 |  | echo $args['desc']; |
  | 285 |  | } |
  | 286 |  |  |
  | 287 |  | /\*\* |
  | 288 |  | \* Displays a rich text textarea for a settings field |
  | 289 |  | \* |
  | 290 |  | \* @param array   $args settings field args |
  | 291 |  | \*/ |
  | 292 |  | function callback\_wysiwyg( $args ) { |
  | 293 |  |  |
  | 294 |  | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  | 295 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : '500px'; |
  | 296 |  |  |
  | 297 |  | echo '<div style="width: ' . $size . ';">'; |
  | 298 |  |  |
  | 299 |  | wp\_editor( $value, $args['section'] . '-' . $args['id'] . '', array( 'teeny' => true, 'textarea\_name' => $args['section'] . '[' . $args['id'] . ']', 'textarea\_rows' => 10 ) ); |
  | 300 |  |  |
  | 301 |  | echo '</div>'; |
  | 302 |  |  |
  | 303 |  | echo sprintf( '<br><span class="description"> %s</span>', $args['desc'] ); |
  | 304 |  | } |
  | 305 |  |  |
  | 306 |  | /\*\* |
  | 307 |  | \* Displays a file upload field for a settings field |
  | 308 |  | \* |
  | 309 |  | \* @param array   $args settings field args |
  | 310 |  | \*/ |
  | 311 |  | function callback\_file( $args ) { |
  | 312 |  |  |
  | 313 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 314 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 315 |  | $id = $args['section']  . '[' . $args['id'] . ']'; |
  | 316 |  |  |
  | 317 |  | $html  = sprintf( '<input type="text" class="%1$s-text wpsa-url" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  | 318 |  | $html .= '<input type="button" class="button wpsa-browse" value="'.\_\_( 'Browse' ).'" />'; |
  | 319 |  |  |
  | 320 |  | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  | 321 |  |  |
  | 322 |  | echo $html; |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | /\*\* |
  | 326 |  | \* Displays a password field for a settings field |
  | 327 |  | \* |
  | 328 |  | \* @param array   $args settings field args |
  | 329 |  | \*/ |
  | 330 |  | function callback\_password( $args ) { |
  | 331 |  |  |
  | 332 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 333 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 334 |  |  |
  | 335 |  | $html = sprintf( '<input type="password" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  | 336 |  | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  | 337 |  |  |
  | 338 |  | echo $html; |
  | 339 |  | } |
  | 340 |  |  |
  | 341 |  | /\*\* |
  | 342 |  | \* Displays a color picker field for a settings field |
  | 343 |  | \* |
  | 344 |  | \* @param array   $args settings field args |
  | 345 |  | \*/ |
  | 346 |  | function callback\_color( $args ) { |
  | 347 |  |  |
  | 348 |  | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  | 349 |  | $size = isset( $args['size'] ) && !is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  | 350 |  |  |
  | 351 |  | $html = sprintf( '<input type="text" class="%1$s-text wp-color-picker-field" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s" data-default-color="%5$s" />', $size, $args['section'], $args['id'], $value, $args['std'] ); |
  | 352 |  | $html .= sprintf( '<span class="description" style="display:block;"> %s</span>', $args['desc'] ); |
  | 353 |  |  |
  | 354 |  | echo $html; |
  | 355 |  | } |
  | 356 |  |  |
  | 357 |  | /\*\* |
  | 358 |  | \* Hook Callback |
  | 359 |  | \* |
  | 360 |  | \* Adds a do\_action() hook in place of the field |
  | 361 |  | \* |
  | 362 |  | \* @since 1.0.8.2 |
  | 363 |  | \* @param array $args Arguments passed by the setting |
  | 364 |  | \* @return void |
  | 365 |  | \*/ |
  | 366 |  | function callback\_hook( $args ) { |
  | 367 |  | do\_action( $args['id'] ); |
  | 368 |  | } |
  | 369 |  |  |
  | 370 |  | /\*\* |
  | 371 |  | \* Sanitize callback for Settings API |
  | 372 |  | \*/ |
  | 373 |  | function sanitize\_options( $options ) { |
  | 374 |  | foreach( $options as $option\_slug => $option\_value ) { |
  | 375 |  | $sanitize\_callback = $this->get\_sanitize\_callback( $option\_slug ); |
  | 376 |  |  |
  | 377 |  | // If callback is set, call it |
  | 378 |  | if ( $sanitize\_callback ) { |
  | 379 |  | $options[ $option\_slug ] = call\_user\_func( $sanitize\_callback, $option\_value ); |
  | 380 |  | continue; |
  | 381 |  | } |
  | 382 |  | } |
  | 383 |  |  |
  | 384 |  | return $options; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | /\*\* |
  | 388 |  | \* Get sanitization callback for given option slug |
  | 389 |  | \* |
  | 390 |  | \* @param string $slug option slug |
  | 391 |  | \* |
  | 392 |  | \* @return mixed string or bool false |
  | 393 |  | \*/ |
  | 394 |  | function get\_sanitize\_callback( $slug = '' ) { |
  | 395 |  | if ( empty( $slug ) ) { |
  | 396 |  | return false; |
  | 397 |  | } |
  | 398 |  |  |
  | 399 |  | // Iterate over registered fields and see if we can find proper callback |
  | 400 |  | foreach( $this->settings\_fields as $section => $options ) { |
  | 401 |  | foreach ( $options as $option ) { |
  | 402 |  | if ( $option['name'] != $slug ) { |
  | 403 |  | continue; |
  | 404 |  | } |
  | 405 |  |  |
  | 406 |  | // Return the callback name |
  | 407 |  | return isset( $option['sanitize\_callback'] ) && is\_callable( $option['sanitize\_callback'] ) ? $option['sanitize\_callback'] : false; |
  | 408 |  | } |
  | 409 |  | } |
  | 410 |  |  |
  | 411 |  | return false; |
  | 412 |  | } |
  | 413 |  |  |
  | 414 |  | /\*\* |
  | 415 |  | \* Get the value of a settings field |
  | 416 |  | \* |
  | 417 |  | \* @param string  $option  settings field name |
  | 418 |  | \* @param string  $section the section name this field belongs to |
  | 419 |  | \* @param string  $default default text if it's not found |
  | 420 |  | \* @return string |
  | 421 |  | \*/ |
  | 422 |  | function get\_option( $option, $section, $default = '' ) { |
  | 423 |  |  |
  | 424 |  | $options = get\_option( $section ); |
  | 425 |  |  |
  | 426 |  | if ( isset( $options[$option] ) ) { |
  | 427 |  | return $options[$option]; |
  | 428 |  | } |
  | 429 |  |  |
  | 430 |  | return $default; |
  | 431 |  | } |
  | 432 |  |  |
  | 433 |  | /\*\* |
  | 434 |  | \* Show navigations as tab |
  | 435 |  | \* |
  | 436 |  | \* Shows all the settings section labels as tab |
  | 437 |  | \*/ |
  | 438 |  | function show\_navigation() { |
  | 439 |  | $html = '<h2 class="nav-tab-wrapper">'; |
  | 440 |  |  |
  | 441 |  | foreach ( $this->settings\_sections as $tab ) { |
  | 442 |  | $html .= sprintf( '<a href="#%1$s" class="nav-tab" id="%1$s-tab">%2$s</a>', $tab['id'], $tab['title'] ); |
  | 443 |  | } |
  | 444 |  |  |
  | 445 |  | $html .= '</h2>'; |
  | 446 |  |  |
  | 447 |  | echo $html; |
  | 448 |  | } |
  | 449 |  |  |
  | 450 |  | /\*\* |
  | 451 |  | \* Show the section settings forms |
  | 452 |  | \* |
  | 453 |  | \* This function displays every sections in a different form |
  | 454 |  | \*/ |
  | 455 |  | function show\_forms() { |
  | 456 |  | ?> |
  | 457 |  | <div class="metabox-holder"> |
  | 458 |  | <div class="postbox"> |
  | 459 |  | <?php foreach ( $this->settings\_sections as $form ) { ?> |
  | 460 |  | <div id="<?php echo $form['id']; ?>" class="group"> |
  | 461 |  | <form method="post" action="options.php"> |
  | 462 |  |  |
  | 463 |  | <?php do\_action( 'wsa\_form\_top\_' . $form['id'], $form ); ?> |
  | 464 |  | <?php settings\_fields( $form['id'] ); ?> |
  | 465 |  | <?php do\_settings\_sections( $form['id'] ); ?> |
  | 466 |  | <?php do\_action( 'wsa\_form\_bottom\_' . $form['id'], $form ); ?> |
  | 467 |  |  |
  | 468 |  | <div style="padding-left: 10px"> |
  | 469 |  | <?php submit\_button(); ?> |
  | 470 |  | </div> |
  | 471 |  | </form> |
  | 472 |  | </div> |
  | 473 |  | <?php } ?> |
  | 474 |  | </div> |
  | 475 |  | </div> |
  | 476 |  |  |
  | 477 |  | <?php |
  | 478 |  | do\_action( 'mp\_before\_form\_closing' ); |
  | 479 |  | $this->script(); |
  | 480 |  | } |
  | 481 |  |  |
  | 482 |  | /\*\* |
  | 483 |  | \* Tabbable JavaScript codes & Initiate Color Picker |
  | 484 |  | \* |
  | 485 |  | \* This code uses localstorage for displaying active tabs |
  | 486 |  | \*/ |
  | 487 |  | function script() { |
  | 488 |  | ?> |
  | 489 |  | <script> |
  | 490 |  | jQuery(document).ready(function($) { |
  | 491 |  | //Initiate Color Picker |
  | 492 |  | $('.wp-color-picker-field').wpColorPicker(); |
  | 493 |  |  |
  | 494 |  | // Switches option sections |
  | 495 |  | $('.group').hide(); |
  | 496 |  | var activetab = ''; |
  | 497 |  | if (typeof(localStorage) != 'undefined' ) { |
  | 498 |  | activetab = localStorage.getItem("activetab"); |
  | 499 |  | } |
  | 500 |  | if (activetab != '' && $(activetab).length ) { |
  | 501 |  | $(activetab).fadeIn(); |
  | 502 |  | } else { |
  | 503 |  | $('.group:first').fadeIn(); |
  | 504 |  | } |
  | 505 |  | $('.group .collapsed').each(function(){ |
  | 506 |  | $(this).find('input:checked').parent().parent().parent().nextAll().each( |
  | 507 |  | function(){ |
  | 508 |  | if ($(this).hasClass('last')) { |
  | 509 |  | $(this).removeClass('hidden'); |
  | 510 |  | return false; |
  | 511 |  | } |
  | 512 |  | $(this).filter('.hidden').removeClass('hidden'); |
  | 513 |  | }); |
  | 514 |  | }); |
  | 515 |  |  |
  | 516 |  | if (activetab != '' && $(activetab + '-tab').length ) { |
  | 517 |  | $(activetab + '-tab').addClass('nav-tab-active'); |
  | 518 |  | } |
  | 519 |  | else { |
  | 520 |  | $('.nav-tab-wrapper a:first').addClass('nav-tab-active'); |
  | 521 |  | } |
  | 522 |  | $('.nav-tab-wrapper a').click(function(evt) { |
  | 523 |  | $('.nav-tab-wrapper a').removeClass('nav-tab-active'); |
  | 524 |  | $(this).addClass('nav-tab-active').blur(); |
  | 525 |  | var clicked\_group = $(this).attr('href'); |
  | 526 |  | if (typeof(localStorage) != 'undefined' ) { |
  | 527 |  | localStorage.setItem("activetab", $(this).attr('href')); |
  | 528 |  | } |
  | 529 |  | $('.group').hide(); |
  | 530 |  | $(clicked\_group).fadeIn(); |
  | 531 |  | evt.preventDefault(); |
  | 532 |  | }); |
  | 533 |  |  |
  | 534 |  | var file\_frame = null; |
  | 535 |  | $('.wpsa-browse').on('click', function (event) { |
  | 536 |  | event.preventDefault(); |
  | 537 |  |  |
  | 538 |  | var self = $(this); |
  | 539 |  |  |
  | 540 |  | // Create the media frame. |
  | 541 |  | file\_frame = wp.media.frames.file\_frame = wp.media({ |
  | 542 |  | title: self.data('uploader\_title'), |
  | 543 |  | button: { |
  | 544 |  | text: self.data('uploader\_button\_text'), |
  | 545 |  | }, |
  | 546 |  | multiple: false |
  | 547 |  | }); |
  | 548 |  |  |
  | 549 |  | file\_frame.on('select', function () { |
  | 550 |  | attachment = file\_frame.state().get('selection').first().toJSON(); |
  | 551 |  |  |
  | 552 |  | self.prev('.wpsa-url').val(attachment.url); |
  | 553 |  | }); |
  | 554 |  |  |
  | 555 |  | // Finally, open the modal |
  | 556 |  | file\_frame.open(); |
  | 557 |  | }); |
  | 558 |  | }); |
  | 559 |  | </script> |
  | 560 |  |  |
  | 561 |  | <style type="text/css"> |
  | 562 |  | /\*\* WordPress 3.8 Fix \*\*/ |
  | 563 |  | .form-table th { |
  | 564 |  | padding: 20px 10px; |
  | 565 |  | } |
  | 566 |  | #wpbody-content .metabox-holder { |
  | 567 |  | padding-top: 5px; |
  | 568 |  | width: 70%; |
  | 569 |  | float: left; |
  | 570 |  | } |
  | 571 |  | </style> |
  | 572 |  | <?php |
  | 573 |  | } |
  | 574 |  |  |
  | 575 |  | } |
  |  | 17 | if ( ! class\_exists( 'MP\_Settings\_API' ) ) : |
  |  | 18 | class MP\_Settings\_API { |
  |  | 19 |  |
  |  | 20 | /\*\* |
  |  | 21 | \* settings sections array |
  |  | 22 | \* |
  |  | 23 | \* @var array |
  |  | 24 | \*/ |
  |  | 25 | private $settings\_sections = array(); |
  |  | 26 |  |
  |  | 27 | /\*\* |
  |  | 28 | \* Settings fields array |
  |  | 29 | \* |
  |  | 30 | \* @var array |
  |  | 31 | \*/ |
  |  | 32 | private $settings\_fields = array(); |
  |  | 33 |  |
  |  | 34 | /\*\* |
  |  | 35 | \* Singleton instance |
  |  | 36 | \* |
  |  | 37 | \* @var object |
  |  | 38 | \*/ |
  |  | 39 | private static $\_instance; |
  |  | 40 |  |
  |  | 41 | public function \_\_construct() { |
  |  | 42 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'admin\_enqueue\_scripts' ) ); |
  |  | 43 | $this->mp\_sanitize\_callbacks(); |
  |  | 44 | } |
  |  | 45 |  |
  |  | 46 | /\*\* |
  |  | 47 | \* Enqueue scripts and styles |
  |  | 48 | \*/ |
  |  | 49 | function admin\_enqueue\_scripts() { |
  |  | 50 | wp\_enqueue\_style( 'wp-color-picker' ); |
  |  | 51 |  |
  |  | 52 | wp\_enqueue\_media(); |
  |  | 53 | wp\_enqueue\_script( 'wp-color-picker' ); |
  |  | 54 | wp\_enqueue\_script( 'jquery' ); |
  |  | 55 | } |
  |  | 56 |  |
  |  | 57 | /\*\* |
  |  | 58 | \* Set settings sections |
  |  | 59 | \* |
  |  | 60 | \* @param array   $sections setting sections array |
  |  | 61 | \*/ |
  |  | 62 | function set\_sections( $sections ) { |
  |  | 63 | $this->settings\_sections = $sections; |
  |  | 64 |  |
  |  | 65 | return $this; |
  |  | 66 | } |
  |  | 67 |  |
  |  | 68 | /\*\* |
  |  | 69 | \* Add a single section |
  |  | 70 | \* |
  |  | 71 | \* @param array   $section |
  |  | 72 | \*/ |
  |  | 73 | function add\_section( $section ) { |
  |  | 74 | $this->settings\_sections[] = $section; |
  |  | 75 |  |
  |  | 76 | return $this; |
  |  | 77 | } |
  |  | 78 |  |
  |  | 79 | /\*\* |
  |  | 80 | \* Set settings fields |
  |  | 81 | \* |
  |  | 82 | \* @param array   $fields settings fields array |
  |  | 83 | \*/ |
  |  | 84 | function set\_fields( $fields ) { |
  |  | 85 | $this->settings\_fields = $fields; |
  |  | 86 |  |
  |  | 87 | return $this; |
  |  | 88 | } |
  |  | 89 |  |
  |  | 90 | function add\_field( $section, $field ) { |
  |  | 91 | $defaults = array( |
  |  | 92 | 'name'  => '', |
  |  | 93 | 'label' => '', |
  |  | 94 | 'desc'  => '', |
  |  | 95 | 'type'  => 'text', |
  |  | 96 | ); |
  |  | 97 |  |
  |  | 98 | $arg                                 = wp\_parse\_args( $field, $defaults ); |
  |  | 99 | $this->settings\_fields[ $section ][] = $arg; |
  |  | 100 |  |
  |  | 101 | return $this; |
  |  | 102 | } |
  |  | 103 |  |
  |  | 104 | /\*\* |
  |  | 105 | \* Initialize and registers the settings sections and fileds to WordPress |
  |  | 106 | \* |
  |  | 107 | \* Usually this should be called at `admin\_init` hook. |
  |  | 108 | \* |
  |  | 109 | \* This function gets the initiated settings sections and fields. Then |
  |  | 110 | \* registers them to WordPress and ready for use. |
  |  | 111 | \*/ |
  |  | 112 | function admin\_init() { |
  |  | 113 | //register settings sections |
  |  | 114 | foreach ( $this->settings\_sections as $section ) { |
  |  | 115 | if ( false == get\_option( $section['id'] ) ) { |
  |  | 116 | add\_option( $section['id'] ); |
  |  | 117 | } |
  |  | 118 |  |
  |  | 119 | if ( isset( $section['desc'] ) && ! empty( $section['desc'] ) ) { |
  |  | 120 | $section['desc'] = '<div class="inside">' . $section['desc'] . '</div>'; |
  |  | 121 | $callback        = create\_function( '', 'echo "' . str\_replace( '"', '\"', $section['desc'] ) . '";' ); |
  |  | 122 | } else { |
  |  | 123 | $callback = '\_\_return\_false'; |
  |  | 124 | } |
  |  | 125 |  |
  |  | 126 | add\_settings\_section( $section['id'], $section['title'], $callback, $section['id'] ); |
  |  | 127 | } |
  |  | 128 |  |
  |  | 129 | //register settings fields |
  |  | 130 | foreach ( $this->settings\_fields as $section => $field ) { |
  |  | 131 | foreach ( $field as $option ) { |
  |  | 132 |  |
  |  | 133 | $type = isset( $option['type'] ) ? $option['type'] : 'text'; |
  |  | 134 |  |
  |  | 135 | $args = array( |
  |  | 136 | 'id'                => $option['name'], |
  |  | 137 | 'desc'              => isset( $option['desc'] ) ? $option['desc'] : '', |
  |  | 138 | 'name'              => $option['label'], |
  |  | 139 | 'section'           => $section, |
  |  | 140 | 'size'              => isset( $option['size'] ) ? $option['size'] : null, |
  |  | 141 | 'options'           => isset( $option['options'] ) ? $option['options'] : '', |
  |  | 142 | 'std'               => isset( $option['default'] ) ? $option['default'] : '', |
  |  | 143 | 'sanitize\_callback' => isset( $option['sanitize\_callback'] ) ? $option['sanitize\_callback'] : '', |
  |  | 144 | ); |
  |  | 145 | add\_settings\_field( $section . '[' . $option['name'] . ']', $option['label'], array( $this, 'callback\_' . $type ), $section, $section, $args ); |
  |  | 146 | } |
  |  | 147 | } |
  |  | 148 |  |
  |  | 149 | // creates our settings in the options table |
  |  | 150 | foreach ( $this->settings\_sections as $section ) { |
  |  | 151 | register\_setting( $section['id'], $section['id'], array( $this, 'sanitize\_options' ) ); |
  |  | 152 | } |
  |  | 153 | } |
  |  | 154 |  |
  |  | 155 | /\*\* |
  |  | 156 | \* collection of our own sanitization functions |
  |  | 157 | \*/ |
  |  | 158 | function mp\_sanitize\_callbacks() { |
  |  | 159 |  |
  |  | 160 | function mp\_filter\_kses( $data ) { |
  |  | 161 | if ( current\_user\_can( 'unfiltered\_html' ) ) { |
  |  | 162 | return $data; |
  |  | 163 | } else { |
  |  | 164 | return wp\_kses\_post( $data ); |
  |  | 165 | } |
  |  | 166 | } |
  |  | 167 | } |
  |  | 168 |  |
  |  | 169 | /\*\* |
  |  | 170 | \* Displays a text field for a settings field |
  |  | 171 | \* |
  |  | 172 | \* @param array   $args settings field args |
  |  | 173 | \*/ |
  |  | 174 | function callback\_text( $args ) { |
  |  | 175 |  |
  |  | 176 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 177 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 178 |  |
  |  | 179 | $html  = sprintf( '<input type="text" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  |  | 180 | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  |  | 181 |  |
  |  | 182 | echo $html; |
  |  | 183 | } |
  |  | 184 |  |
  |  | 185 | /\*\* |
  |  | 186 | \* Displays a checkbox for a settings field |
  |  | 187 | \* |
  |  | 188 | \* @param array   $args settings field args |
  |  | 189 | \*/ |
  |  | 190 | function callback\_checkbox( $args ) { |
  |  | 191 |  |
  |  | 192 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 193 |  |
  |  | 194 | $html  = sprintf( '<input type="hidden" name="%1$s[%2$s]" value="off" />', $args['section'], $args['id'] ); |
  |  | 195 | $html .= sprintf( '<input type="checkbox" class="checkbox" id="wpuf-%1$s[%2$s]" name="%1$s[%2$s]" value="on"%4$s />', $args['section'], $args['id'], $value, checked( $value, 'on', false ) ); |
  |  | 196 | $html .= sprintf( '<label for="wpuf-%1$s[%2$s]"> %3$s</label>', $args['section'], $args['id'], $args['desc'] ); |
  |  | 197 |  |
  |  | 198 | echo $html; |
  |  | 199 | } |
  |  | 200 |  |
  |  | 201 | /\*\* |
  |  | 202 | \* Displays a multicheckbox a settings field |
  |  | 203 | \* |
  |  | 204 | \* @param array   $args settings field args |
  |  | 205 | \*/ |
  |  | 206 | function callback\_multicheck( $args ) { |
  |  | 207 |  |
  |  | 208 | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  |  | 209 |  |
  |  | 210 | $html = ''; |
  |  | 211 | foreach ( $args['options'] as $key => $label ) { |
  |  | 212 | $checked = isset( $value[ $key ] ) ? $value[ $key ] : '0'; |
  |  | 213 | $html   .= sprintf( '<input type="checkbox" class="checkbox" id="wpuf-%1$s[%2$s][%3$s]" name="%1$s[%2$s][%3$s]" value="%3$s"%4$s />', $args['section'], $args['id'], $key, checked( $checked, $key, false ) ); |
  |  | 214 | $html   .= sprintf( '<label for="wpuf-%1$s[%2$s][%4$s]"> %3$s</label><br>', $args['section'], $args['id'], $label, $key ); |
  |  | 215 | } |
  |  | 216 | $html .= sprintf( '<span class="description"> %s</label>', $args['desc'] ); |
  |  | 217 |  |
  |  | 218 | echo $html; |
  |  | 219 | } |
  |  | 220 |  |
  |  | 221 | /\*\* |
  |  | 222 | \* Displays a multicheckbox a settings field |
  |  | 223 | \* |
  |  | 224 | \* @param array   $args settings field args |
  |  | 225 | \*/ |
  |  | 226 | function callback\_radio( $args ) { |
  |  | 227 |  |
  |  | 228 | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  |  | 229 |  |
  |  | 230 | $html = ''; |
  |  | 231 | foreach ( $args['options'] as $key => $label ) { |
  |  | 232 | $html .= sprintf( '<input type="radio" class="radio" id="wpuf-%1$s[%2$s][%3$s]" name="%1$s[%2$s]" value="%3$s"%4$s />', $args['section'], $args['id'], $key, checked( $value, $key, false ) ); |
  |  | 233 | $html .= sprintf( '<label for="wpuf-%1$s[%2$s][%4$s]"> %3$s</label><br>', $args['section'], $args['id'], $label, $key ); |
  |  | 234 | } |
  |  | 235 | $html .= sprintf( '<span class="description"> %s</label>', $args['desc'] ); |
  |  | 236 |  |
  |  | 237 | echo $html; |
  |  | 238 | } |
  |  | 239 |  |
  |  | 240 | /\*\* |
  |  | 241 | \* Displays a selectbox for a settings field |
  |  | 242 | \* |
  |  | 243 | \* @param array   $args settings field args |
  |  | 244 | \*/ |
  |  | 245 | function callback\_select( $args ) { |
  |  | 246 |  |
  |  | 247 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 248 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 249 |  |
  |  | 250 | $html = sprintf( '<select class="%1$s" name="%2$s[%3$s]" id="%2$s[%3$s]">', $size, $args['section'], $args['id'] ); |
  |  | 251 | foreach ( $args['options'] as $key => $label ) { |
  |  | 252 | $html .= sprintf( '<option value="%s"%s>%s</option>', $key, selected( $value, $key, false ), $label ); |
  |  | 253 | } |
  |  | 254 | $html .= sprintf( '</select>' ); |
  |  | 255 | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  |  | 256 |  |
  |  | 257 | echo $html; |
  |  | 258 | } |
  |  | 259 |  |
  |  | 260 | /\*\* |
  |  | 261 | \* Displays a textarea for a settings field |
  |  | 262 | \* |
  |  | 263 | \* @param array   $args settings field args |
  |  | 264 | \*/ |
  |  | 265 | function callback\_textarea( $args ) { |
  |  | 266 |  |
  |  | 267 | $value = esc\_textarea( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 268 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 269 |  |
  |  | 270 | $html  = sprintf( '<textarea rows="5" cols="55" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]">%4$s</textarea>', $size, $args['section'], $args['id'], $value ); |
  |  | 271 | $html .= sprintf( '<br><span class="description"> %s</span>', $args['desc'] ); |
  |  | 272 |  |
  |  | 273 | echo $html; |
  |  | 274 | } |
  |  | 275 |  |
  |  | 276 | /\*\* |
  |  | 277 | \* Displays a textarea for a settings field |
  |  | 278 | \* |
  |  | 279 | \* @param array   $args settings field args |
  |  | 280 | \*/ |
  |  | 281 | function callback\_html( $args ) { |
  |  | 282 | echo $args['desc']; |
  |  | 283 | } |
  |  | 284 |  |
  |  | 285 | /\*\* |
  |  | 286 | \* Displays a rich text textarea for a settings field |
  |  | 287 | \* |
  |  | 288 | \* @param array   $args settings field args |
  |  | 289 | \*/ |
  |  | 290 | function callback\_wysiwyg( $args ) { |
  |  | 291 |  |
  |  | 292 | $value = $this->get\_option( $args['id'], $args['section'], $args['std'] ); |
  |  | 293 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : '500px'; |
  |  | 294 |  |
  |  | 295 | echo '<div style="width: ' . $size . ';">'; |
  |  | 296 |  |
  |  | 297 | wp\_editor( |
  |  | 298 | $value, |
  |  | 299 | $args['section'] . '-' . $args['id'] . '', |
  |  | 300 | array( |
  |  | 301 | 'teeny'         => true, |
  |  | 302 | 'textarea\_name' => $args['section'] . '[' . $args['id'] . ']', |
  |  | 303 | 'textarea\_rows' => 10, |
  |  | 304 | ) |
  |  | 305 | ); |
  |  | 306 |  |
  |  | 307 | echo '</div>'; |
  |  | 308 |  |
  |  | 309 | printf( '<br><span class="description"> %s</span>', $args['desc'] ); |
  |  | 310 | } |
  |  | 311 |  |
  |  | 312 | /\*\* |
  |  | 313 | \* Displays a file upload field for a settings field |
  |  | 314 | \* |
  |  | 315 | \* @param array   $args settings field args |
  |  | 316 | \*/ |
  |  | 317 | function callback\_file( $args ) { |
  |  | 318 |  |
  |  | 319 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 320 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 321 | $id    = $args['section'] . '[' . $args['id'] . ']'; |
  |  | 322 |  |
  |  | 323 | $html  = sprintf( '<input type="text" class="%1$s-text wpsa-url" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  |  | 324 | $html .= '<input type="button" class="button wpsa-browse" value="' . \_\_( 'Browse' ) . '" />'; |
  |  | 325 |  |
  |  | 326 | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  |  | 327 |  |
  |  | 328 | echo $html; |
  |  | 329 | } |
  |  | 330 |  |
  |  | 331 | /\*\* |
  |  | 332 | \* Displays a password field for a settings field |
  |  | 333 | \* |
  |  | 334 | \* @param array   $args settings field args |
  |  | 335 | \*/ |
  |  | 336 | function callback\_password( $args ) { |
  |  | 337 |  |
  |  | 338 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 339 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 340 |  |
  |  | 341 | $html  = sprintf( '<input type="password" class="%1$s-text" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s"/>', $size, $args['section'], $args['id'], $value ); |
  |  | 342 | $html .= sprintf( '<span class="description"> %s</span>', $args['desc'] ); |
  |  | 343 |  |
  |  | 344 | echo $html; |
  |  | 345 | } |
  |  | 346 |  |
  |  | 347 | /\*\* |
  |  | 348 | \* Displays a color picker field for a settings field |
  |  | 349 | \* |
  |  | 350 | \* @param array   $args settings field args |
  |  | 351 | \*/ |
  |  | 352 | function callback\_color( $args ) { |
  |  | 353 |  |
  |  | 354 | $value = esc\_attr( $this->get\_option( $args['id'], $args['section'], $args['std'] ) ); |
  |  | 355 | $size  = isset( $args['size'] ) && ! is\_null( $args['size'] ) ? $args['size'] : 'regular'; |
  |  | 356 |  |
  |  | 357 | $html  = sprintf( '<input type="text" class="%1$s-text wp-color-picker-field" id="%2$s[%3$s]" name="%2$s[%3$s]" value="%4$s" data-default-color="%5$s" />', $size, $args['section'], $args['id'], $value, $args['std'] ); |
  |  | 358 | $html .= sprintf( '<span class="description" style="display:block;"> %s</span>', $args['desc'] ); |
  |  | 359 |  |
  |  | 360 | echo $html; |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | /\*\* |
  |  | 364 | \* Hook Callback |
  |  | 365 | \* |
  |  | 366 | \* Adds a do\_action() hook in place of the field |
  |  | 367 | \* |
  |  | 368 | \* @since 1.0.8.2 |
  |  | 369 | \* @param array $args Arguments passed by the setting |
  |  | 370 | \* @return void |
  |  | 371 | \*/ |
  |  | 372 | function callback\_hook( $args ) { |
  |  | 373 | do\_action( $args['id'] ); |
  |  | 374 | } |
  |  | 375 |  |
  |  | 376 | /\*\* |
  |  | 377 | \* Sanitize callback for Settings API |
  |  | 378 | \*/ |
  |  | 379 | function sanitize\_options( $options ) { |
  |  | 380 | foreach ( $options as $option\_slug => $option\_value ) { |
  |  | 381 | $sanitize\_callback = $this->get\_sanitize\_callback( $option\_slug ); |
  |  | 382 |  |
  |  | 383 | // If callback is set, call it |
  |  | 384 | if ( $sanitize\_callback ) { |
  |  | 385 | $options[ $option\_slug ] = call\_user\_func( $sanitize\_callback, $option\_value ); |
  |  | 386 | continue; |
  |  | 387 | } |
  |  | 388 | } |
  |  | 389 |  |
  |  | 390 | return $options; |
  |  | 391 | } |
  |  | 392 |  |
  |  | 393 | /\*\* |
  |  | 394 | \* Get sanitization callback for given option slug |
  |  | 395 | \* |
  |  | 396 | \* @param string $slug option slug |
  |  | 397 | \* |
  |  | 398 | \* @return mixed string or bool false |
  |  | 399 | \*/ |
  |  | 400 | function get\_sanitize\_callback( $slug = '' ) { |
  |  | 401 | if ( empty( $slug ) ) { |
  |  | 402 | return false; |
  |  | 403 | } |
  |  | 404 |  |
  |  | 405 | // Iterate over registered fields and see if we can find proper callback |
  |  | 406 | foreach ( $this->settings\_fields as $section => $options ) { |
  |  | 407 | foreach ( $options as $option ) { |
  |  | 408 | if ( $option['name'] != $slug ) { |
  |  | 409 | continue; |
  |  | 410 | } |
  |  | 411 |  |
  |  | 412 | // Return the callback name |
  |  | 413 | return isset( $option['sanitize\_callback'] ) && is\_callable( $option['sanitize\_callback'] ) ? $option['sanitize\_callback'] : false; |
  |  | 414 | } |
  |  | 415 | } |
  |  | 416 |  |
  |  | 417 | return false; |
  |  | 418 | } |
  |  | 419 |  |
  |  | 420 | /\*\* |
  |  | 421 | \* Get the value of a settings field |
  |  | 422 | \* |
  |  | 423 | \* @param string  $option  settings field name |
  |  | 424 | \* @param string  $section the section name this field belongs to |
  |  | 425 | \* @param string  $default default text if it's not found |
  |  | 426 | \* @return string |
  |  | 427 | \*/ |
  |  | 428 | function get\_option( $option, $section, $default = '' ) { |
  |  | 429 |  |
  |  | 430 | $options = get\_option( $section ); |
  |  | 431 |  |
  |  | 432 | if ( isset( $options[ $option ] ) ) { |
  |  | 433 | return $options[ $option ]; |
  |  | 434 | } |
  |  | 435 |  |
  |  | 436 | return $default; |
  |  | 437 | } |
  |  | 438 |  |
  |  | 439 | /\*\* |
  |  | 440 | \* Show navigations as tab |
  |  | 441 | \* |
  |  | 442 | \* Shows all the settings section labels as tab |
  |  | 443 | \*/ |
  |  | 444 | function show\_navigation() { |
  |  | 445 | $html = '<h2 class="nav-tab-wrapper">'; |
  |  | 446 |  |
  |  | 447 | foreach ( $this->settings\_sections as $tab ) { |
  |  | 448 | $html .= sprintf( '<a href="#%1$s" class="nav-tab" id="%1$s-tab">%2$s</a>', $tab['id'], $tab['title'] ); |
  |  | 449 | } |
  |  | 450 |  |
  |  | 451 | $html .= '</h2>'; |
  |  | 452 |  |
  |  | 453 | echo $html; |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | /\*\* |
  |  | 457 | \* Show the section settings forms |
  |  | 458 | \* |
  |  | 459 | \* This function displays every sections in a different form |
  |  | 460 | \*/ |
  |  | 461 | function show\_forms() { |
  |  | 462 | ?> |
  |  | 463 | <div class="metabox-holder"> |
  |  | 464 | <div class="postbox"> |
  |  | 465 | <?php foreach ( $this->settings\_sections as $form ) { ?> |
  |  | 466 | <div id="<?php echo $form['id']; ?>" class="group"> |
  |  | 467 | <form method="post" action="options.php"> |
  |  | 468 |  |
  |  | 469 | <?php do\_action( 'wsa\_form\_top\_' . $form['id'], $form ); ?> |
  |  | 470 | <?php settings\_fields( $form['id'] ); ?> |
  |  | 471 | <?php do\_settings\_sections( $form['id'] ); ?> |
  |  | 472 | <?php do\_action( 'wsa\_form\_bottom\_' . $form['id'], $form ); ?> |
  |  | 473 |  |
  |  | 474 | <div style="padding-left: 10px"> |
  |  | 475 | <?php submit\_button(); ?> |
  |  | 476 | </div> |
  |  | 477 | </form> |
  |  | 478 | </div> |
  |  | 479 | <?php } ?> |
  |  | 480 | </div> |
  |  | 481 | </div> |
  |  | 482 |  |
  |  | 483 | <?php |
  |  | 484 | do\_action( 'mp\_before\_form\_closing' ); |
  |  | 485 | $this->script(); |
  |  | 486 | } |
  |  | 487 |  |
  |  | 488 | /\*\* |
  |  | 489 | \* Tabbable JavaScript codes & Initiate Color Picker |
  |  | 490 | \* |
  |  | 491 | \* This code uses localstorage for displaying active tabs |
  |  | 492 | \*/ |
  |  | 493 | function script() { |
  |  | 494 | ?> |
  |  | 495 | <script> |
  |  | 496 | jQuery(document).ready(function($) { |
  |  | 497 | //Initiate Color Picker |
  |  | 498 | $('.wp-color-picker-field').wpColorPicker(); |
  |  | 499 |  |
  |  | 500 | // Switches option sections |
  |  | 501 | $('.group').hide(); |
  |  | 502 | var activetab = ''; |
  |  | 503 | if (typeof(localStorage) != 'undefined' ) { |
  |  | 504 | activetab = localStorage.getItem("activetab"); |
  |  | 505 | } |
  |  | 506 | if (activetab != '' && $(activetab).length ) { |
  |  | 507 | $(activetab).fadeIn(); |
  |  | 508 | } else { |
  |  | 509 | $('.group:first').fadeIn(); |
  |  | 510 | } |
  |  | 511 | $('.group .collapsed').each(function(){ |
  |  | 512 | $(this).find('input:checked').parent().parent().parent().nextAll().each( |
  |  | 513 | function(){ |
  |  | 514 | if ($(this).hasClass('last')) { |
  |  | 515 | $(this).removeClass('hidden'); |
  |  | 516 | return false; |
  |  | 517 | } |
  |  | 518 | $(this).filter('.hidden').removeClass('hidden'); |
  |  | 519 | }); |
  |  | 520 | }); |
  |  | 521 |  |
  |  | 522 | if (activetab != '' && $(activetab + '-tab').length ) { |
  |  | 523 | $(activetab + '-tab').addClass('nav-tab-active'); |
  |  | 524 | } |
  |  | 525 | else { |
  |  | 526 | $('.nav-tab-wrapper a:first').addClass('nav-tab-active'); |
  |  | 527 | } |
  |  | 528 | $('.nav-tab-wrapper a').click(function(evt) { |
  |  | 529 | $('.nav-tab-wrapper a').removeClass('nav-tab-active'); |
  |  | 530 | $(this).addClass('nav-tab-active').blur(); |
  |  | 531 | var clicked\_group = $(this).attr('href'); |
  |  | 532 | if (typeof(localStorage) != 'undefined' ) { |
  |  | 533 | localStorage.setItem("activetab", $(this).attr('href')); |
  |  | 534 | } |
  |  | 535 | $('.group').hide(); |
  |  | 536 | $(clicked\_group).fadeIn(); |
  |  | 537 | evt.preventDefault(); |
  |  | 538 | }); |
  |  | 539 |  |
  |  | 540 | var file\_frame = null; |
  |  | 541 | $('.wpsa-browse').on('click', function (event) { |
  |  | 542 | event.preventDefault(); |
  |  | 543 |  |
  |  | 544 | var self = $(this); |
  |  | 545 |  |
  |  | 546 | // Create the media frame. |
  |  | 547 | file\_frame = wp.media.frames.file\_frame = wp.media({ |
  |  | 548 | title: self.data('uploader\_title'), |
  |  | 549 | button: { |
  |  | 550 | text: self.data('uploader\_button\_text'), |
  |  | 551 | }, |
  |  | 552 | multiple: false |
  |  | 553 | }); |
  |  | 554 |  |
  |  | 555 | file\_frame.on('select', function () { |
  |  | 556 | attachment = file\_frame.state().get('selection').first().toJSON(); |
  |  | 557 |  |
  |  | 558 | self.prev('.wpsa-url').val(attachment.url); |
  |  | 559 | }); |
  |  | 560 |  |
  |  | 561 | // Finally, open the modal |
  |  | 562 | file\_frame.open(); |
  |  | 563 | }); |
  |  | 564 | }); |
  |  | 565 | </script> |
  |  | 566 |  |
  |  | 567 | <style type="text/css"> |
  |  | 568 | /\*\* WordPress 3.8 Fix \*\*/ |
  |  | 569 | .form-table th { |
  |  | 570 | padding: 20px 10px; |
  |  | 571 | } |
  |  | 572 | #wpbody-content .metabox-holder { |
  |  | 573 | padding-top: 5px; |
  |  | 574 | width: 70%; |
  |  | 575 | float: left; |
  |  | 576 | } |
  |  | 577 | </style> |
  |  | 578 | <?php |
  |  | 579 | } |
  |  | 580 | } |
  | 576 | 581 | endif; |
* ## [maintenance-page/trunk/includes/admin/settings-api.php](/changeset/3037664/maintenance-page/trunk/includes/admin/settings-api.php?old=1218029&old_path=maintenance-page%2Ftrunk%2Fincludes%2Fadmin%2Fsettings-api.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/includes/admin/settings-api.php")

  | [r1218033](/browser/maintenance-page/trunk/includes/admin/settings-api.php?rev=1218029#L9 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/includes/admin/settings-api.php?rev=3037664#L9 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | \* @since       1.0 |
  | 10 | 10 | \*/ |
  | 11 |  | if ( !class\_exists('MP\_Settings' ) ): |
  | 12 |  | class MP\_Settings { |
  | 13 |  |  |
  | 14 |  | private $settings\_api; |
  | 15 |  |  |
  | 16 |  | function \_\_construct() { |
  | 17 |  | $this->settings\_api = new MP\_Settings\_API; |
  | 18 |  |  |
  | 19 |  | add\_action( 'admin\_init', array($this, 'admin\_init') ); |
  | 20 |  | add\_action( 'admin\_menu', array($this, 'admin\_menu') ); |
  | 21 |  | add\_action( 'mp\_before\_form\_closing', array($this, 'admin\_options\_sidebar') ); |
  | 22 |  | add\_action( 'mp\_subscribe\_settings', array($this, 'download\_csv\_button') ); |
  | 23 |  | add\_filter('plugin\_action\_links\_' . mp()->basename, array($this, 'add\_settings\_link')); |
  | 24 |  | } |
  | 25 |  |  |
  | 26 |  | function admin\_init() { |
  | 27 |  |  |
  | 28 |  | //set the settings |
  | 29 |  | $this->settings\_api->set\_sections( $this->get\_settings\_sections() ); |
  | 30 |  | $this->settings\_api->set\_fields( $this->get\_settings\_fields() ); |
  | 31 |  |  |
  | 32 |  | //initialize settings |
  | 33 |  | $this->settings\_api->admin\_init(); |
  | 34 |  | } |
  | 35 |  |  |
  | 36 |  | function admin\_menu() { |
  | 37 |  | $hook = add\_options\_page( 'Maintenance Page', 'Maintenance Page', 'manage\_options', 'mp\_settings\_api', array($this, 'plugin\_page') ); |
  | 38 |  | add\_action( "admin\_print\_styles-$hook", array( $this, "enqueue\_admin\_styles" ) ); |
  | 39 |  | } |
  | 40 |  |  |
  | 41 |  | function get\_settings\_sections() { |
  | 42 |  | $sections = array( |
  | 43 |  | array( |
  | 44 |  | 'id' => 'mp\_basics', |
  | 45 |  | 'title' => \_\_( 'General', 'maintenance-page' ) |
  | 46 |  | ), |
  | 47 |  | array( |
  | 48 |  | 'id' => 'mp\_social', |
  | 49 |  | 'title' => \_\_( 'Social Icons', 'maintenance-page' ) |
  | 50 |  | ), |
  | 51 |  | array( |
  | 52 |  | 'id' => 'mp\_subscribe', |
  | 53 |  | 'title' => \_\_( 'Subscribe', 'maintenance-page' ) |
  | 54 |  | ) |
  | 55 |  | ); |
  | 56 |  | return $sections; |
  | 57 |  | } |
  | 58 |  |  |
  | 59 |  | /\*\* |
  | 60 |  | \* Returns all the settings fields |
  | 61 |  | \* |
  | 62 |  | \* @return array settings fields |
  | 63 |  | \*/ |
  | 64 |  | function get\_settings\_fields() { |
  | 65 |  | $settings\_fields = array( |
  | 66 |  | 'mp\_basics' => array( |
  | 67 |  | array( |
  | 68 |  | 'name' => 'mp\_activate', |
  | 69 |  | 'label' => \_\_( 'Activate', 'maintenance-page' ), |
  | 70 |  | 'desc' => \_\_( 'Activate the Maintenance Page', 'maintenance-page' ), |
  | 71 |  | 'type' => 'checkbox' |
  | 72 |  | ), |
  | 73 |  | array( |
  | 74 |  | 'name' => 'mp\_header\_status', |
  | 75 |  | 'label' => \_\_( '503', 'maintenance-page' ), |
  | 76 |  | 'desc' => \_\_( 'Search engines will be notified site is unavailable', 'maintenance-page' ), |
  | 77 |  | 'type' => 'checkbox' |
  | 78 |  | ), |
  | 79 |  | array( |
  | 80 |  | 'name'  => 'mp\_logo', |
  | 81 |  | 'label' => \_\_( 'Logo', 'maintenance-page' ), |
  | 82 |  | 'desc'  => \_\_( 'Upload Logo', 'maintenance-page' ), |
  | 83 |  | 'type'  => 'file', |
  | 84 |  | 'default' => '', |
  | 85 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 86 |  | ), |
  | 87 |  | array( |
  | 88 |  | 'name' => 'mp\_heading', |
  | 89 |  | 'label' => \_\_( 'Heading Title', 'maintenance-page' ), |
  | 90 |  | 'desc' => \_\_( 'Main Heading for the Maintenance Page', 'maintenance-page' ), |
  | 91 |  | 'type' => 'text', |
  | 92 |  | 'default' => 'MAINTENANCE PAGE', |
  | 93 |  | 'sanitize\_callback' => 'sanitize\_text\_field' |
  | 94 |  | ), |
  | 95 |  | array( |
  | 96 |  | 'name' => 'mp\_message', |
  | 97 |  | 'label' => \_\_( 'Text Message', 'maintenance-page' ), |
  | 98 |  | 'desc' => \_\_( 'Message For your Viewer', 'maintenance-page' ), |
  | 99 |  | 'type' => 'wysiwyg', |
  | 100 |  | 'sanitize\_callback' => 'mp\_filter\_kses' |
  | 101 |  | ), |
  | 102 |  | array( |
  | 103 |  | 'name'  => 'mp\_background\_image', |
  | 104 |  | 'label' => \_\_( 'Background Image', 'maintenance-page' ), |
  | 105 |  | 'desc'  => \_\_( 'Upload background Image', 'maintenance-page' ), |
  | 106 |  | 'type'  => 'file', |
  | 107 |  | 'default' => '', |
  | 108 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 109 |  | ), |
  | 110 |  | array( |
  | 111 |  | 'name' => 'mp\_background\_image\_deactivate', |
  | 112 |  | 'label' => \_\_( 'Deactivate', 'maintenance-page' ), |
  | 113 |  | 'desc' => \_\_( 'Deactivate the Background Image', 'maintenance-page' ), |
  | 114 |  | 'type' => 'checkbox' |
  | 115 |  | ), |
  | 116 |  | array( |
  | 117 |  | 'name' => 'mp\_background\_color', |
  | 118 |  | 'label' => \_\_( 'Background Color', 'maintenance-page' ), |
  | 119 |  | 'desc' => \_\_( 'Choose Background Color', 'maintenance-page' ), |
  | 120 |  | 'type' => 'color', |
  | 121 |  | 'default' => '#ffffff', |
  | 122 |  | 'sanitize\_callback' => 'sanitize\_hex\_color' |
  | 123 |  | ), |
  | 124 |  | array( |
  | 125 |  | 'name' => 'mp\_font\_color', |
  | 126 |  | 'label' => \_\_( 'Font Color', 'maintenance-page' ), |
  | 127 |  | 'desc' => \_\_( 'Choose font color', 'maintenance-page' ), |
  | 128 |  | 'type' => 'color', |
  | 129 |  | 'default' => '#ffffff', |
  | 130 |  | 'sanitize\_callback' => 'sanitize\_hex\_color' |
  | 131 |  | ), |
  | 132 |  | array( |
  | 133 |  | 'name' => 'mp\_link\_color', |
  | 134 |  | 'label' => \_\_( 'Link Color', 'maintenance-page' ), |
  | 135 |  | 'desc' => \_\_( 'Choose Link color', 'maintenance-page' ), |
  | 136 |  | 'type' => 'color', |
  | 137 |  | 'default' => '#1BBC9B', |
  | 138 |  | 'sanitize\_callback' => 'sanitize\_hex\_color' |
  | 139 |  | ), |
  | 140 |  | array( |
  | 141 |  | 'name' => 'mp\_css', |
  | 142 |  | 'label' => \_\_( 'Custom CSS', 'maintenance-page' ), |
  | 143 |  | 'desc' => \_\_( 'Enter Your Custom CSS here', 'maintenance-page' ), |
  | 144 |  | 'type' => 'textarea', |
  | 145 |  | 'sanitize\_callback' => 'wp\_filter\_kses' |
  | 146 |  | ), |
  | 147 |  | array( |
  | 148 |  | 'name' => 'mp\_exclude', |
  | 149 |  | 'label' => \_\_( 'Exclude', 'maintenance-page' ), |
  | 150 |  | 'desc' => \_\_( 'Enter the page/post slug. One slug per line', 'maintenance-page' ), |
  | 151 |  | 'type' => 'textarea', |
  | 152 |  | 'sanitize\_callback' => 'wp\_filter\_kses' |
  | 153 |  | ), |
  | 154 |  | array( |
  | 155 |  | 'name' => 'mp\_footer\_radio', |
  | 156 |  | 'label' => \_\_( 'Powered by ThemeGrill', 'maintenance-page' ), |
  | 157 |  | 'desc' => \_\_( 'How about a footer credit for our hardwork', 'maintenance-page' ), |
  | 158 |  | 'type' => 'radio', |
  | 159 |  | 'options' => array( |
  | 160 |  | 'yes' => \_\_( 'Yes - we love you', 'maintenance-page' ), |
  | 161 |  | 'no' => \_\_( 'Nope', 'maintenance-page' ) |
  | 162 |  | ), |
  | 163 |  | 'default' =>'no' |
  | 164 |  | ) |
  | 165 |  | ), |
  | 166 |  | 'mp\_social' => array( |
  | 167 |  | array( |
  | 168 |  | 'name' => 'mp\_facebook', |
  | 169 |  | 'label' => \_\_( 'Facebook', 'maintenance-page' ), |
  | 170 |  | 'desc' => \_\_( 'Enter Facebook url', 'maintenance-page' ), |
  | 171 |  | 'type' => 'text', |
  | 172 |  | 'default' => '', |
  | 173 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 174 |  | ), |
  | 175 |  | array( |
  | 176 |  | 'name' => 'mp\_twitter', |
  | 177 |  | 'label' => \_\_( 'Twitter', 'maintenance-page' ), |
  | 178 |  | 'desc' => \_\_( 'Enter Twitter url', 'maintenance-page' ), |
  | 179 |  | 'type' => 'text', |
  | 180 |  | 'default' => '', |
  | 181 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 182 |  | ), |
  | 183 |  | array( |
  | 184 |  | 'name' => 'mp\_pinterest', |
  | 185 |  | 'label' => \_\_( 'Pinterest', 'maintenance-page' ), |
  | 186 |  | 'desc' => \_\_( 'Enter Pinterest url', 'maintenance-page' ), |
  | 187 |  | 'type' => 'text', |
  | 188 |  | 'default' => '', |
  | 189 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 190 |  | ), |
  | 191 |  | array( |
  | 192 |  | 'name' => 'mp\_google', |
  | 193 |  | 'label' => \_\_( 'GooglePlus', 'maintenance-page' ), |
  | 194 |  | 'desc' => \_\_( 'Enter GooglePlus url', 'maintenance-page' ), |
  | 195 |  | 'type' => 'text', |
  | 196 |  | 'default' => '', |
  | 197 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 198 |  | ), |
  | 199 |  | array( |
  | 200 |  | 'name' => 'mp\_youtube', |
  | 201 |  | 'label' => \_\_( 'Youtube', 'maintenance-page' ), |
  | 202 |  | 'desc' => \_\_( 'Enter Youtube url', 'maintenance-page' ), |
  | 203 |  | 'type' => 'text', |
  | 204 |  | 'default' => '', |
  | 205 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 206 |  | ), |
  | 207 |  | array( |
  | 208 |  | 'name' => 'mp\_linkedin', |
  | 209 |  | 'label' => \_\_( 'LinkedIn', 'maintenance-page' ), |
  | 210 |  | 'desc' => \_\_( 'Enter LinkedIn url', 'maintenance-page' ), |
  | 211 |  | 'type' => 'text', |
  | 212 |  | 'default' => '', |
  | 213 |  | 'sanitize\_callback' => 'esc\_url\_raw' |
  | 214 |  | ) |
  | 215 |  | ), |
  | 216 |  | 'mp\_subscribe' => array( |
  | 217 |  | array( |
  | 218 |  | 'name' => 'mp\_subscribe\_activate', |
  | 219 |  | 'label' => \_\_( 'Activate', 'maintenance-page' ), |
  | 220 |  | 'desc' => \_\_( 'Activate subscribe feature', 'maintenance-page' ), |
  | 221 |  | 'type' => 'checkbox' |
  | 222 |  | ), |
  | 223 |  | array( |
  | 224 |  | 'name' => 'mp\_subscribe\_title', |
  | 225 |  | 'label' => \_\_( 'Subscribe Info Title', 'maintenance-page' ), |
  | 226 |  | 'desc' => \_\_( 'Title For the Subscribe information', 'maintenance-page' ), |
  | 227 |  | 'type' => 'text', |
  | 228 |  | 'default' => '', |
  | 229 |  | 'sanitize\_callback' => 'sanitize\_text\_field' |
  | 230 |  | ), |
  | 231 |  | array( |
  | 232 |  | 'name' => 'mp\_subscribe\_message', |
  | 233 |  | 'label' => \_\_( 'Subscribe Message', 'maintenance-page' ), |
  | 234 |  | 'desc' => \_\_( 'Message for subscribe text', 'maintenance-page' ), |
  | 235 |  | 'type' => 'wysiwyg', |
  | 236 |  | 'sanitize\_callback' => 'wp\_kses\_post' |
  | 237 |  | ), |
  | 238 |  | array( |
  | 239 |  | 'name' => 'mp\_subscribe\_settings', |
  | 240 |  | 'label' => \_\_( 'Download', 'maintenance-page' ), |
  | 241 |  | 'desc' => '', |
  | 242 |  | 'type' => 'hook' |
  | 243 |  | ), |
  | 244 |  | ) |
  | 245 |  | ); |
  | 246 |  |  |
  | 247 |  | return $settings\_fields; |
  | 248 |  | } |
  | 249 |  |  |
  | 250 |  | function plugin\_page() { |
  | 251 |  | echo '<div class="wrap">'; |
  | 252 |  |  |
  | 253 |  | $this->settings\_api->show\_navigation(); |
  | 254 |  | $this->settings\_api->show\_forms(); |
  | 255 |  |  |
  | 256 |  | echo '</div>'; |
  | 257 |  | } |
  | 258 |  |  |
  | 259 |  | /\*\* |
  | 260 |  | \* Get all the pages |
  | 261 |  | \* |
  | 262 |  | \* @return array page names with key value pairs |
  | 263 |  | \*/ |
  | 264 |  | function get\_pages() { |
  | 265 |  | $pages = get\_pages(); |
  | 266 |  | $pages\_options = array(); |
  | 267 |  | if ( $pages ) { |
  | 268 |  | foreach ($pages as $page) { |
  | 269 |  | $pages\_options[$page->ID] = $page->post\_title; |
  | 270 |  | } |
  | 271 |  | } |
  | 272 |  |  |
  | 273 |  | return $pages\_options; |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | /\*\* |
  | 277 |  | \* Get the value of a settings field |
  | 278 |  | \* |
  | 279 |  | \* @param string $option settings field name |
  | 280 |  | \* @param string $section the section name this field belongs to |
  | 281 |  | \* @param string $default default text if it's not found |
  | 282 |  | \* @return mixed |
  | 283 |  | \*/ |
  | 284 |  | function get\_option( $option, $section, $default = '' ) { |
  | 285 |  |  |
  | 286 |  | $options = get\_option( $section ); |
  | 287 |  |  |
  | 288 |  | if ( isset( $options[$option] ) ) { |
  | 289 |  | return $options[$option]; |
  | 290 |  | } |
  | 291 |  |  |
  | 292 |  | return $default; |
  | 293 |  | } |
  | 294 |  |  |
  | 295 |  | /\*\* |
  | 296 |  | \* Add the settings link to the plugins page |
  | 297 |  | \* |
  | 298 |  | \* @param string $links |
  | 299 |  | \* @return array |
  | 300 |  | \*/ |
  | 301 |  | function add\_settings\_link($links) { |
  | 302 |  | $settings\_link = '<a href="options-general.php?page=mp\_settings\_api">'.\_\_( 'Settings','maintenance-page' ).'</a>'; |
  | 303 |  | array\_unshift($links, $settings\_link); |
  | 304 |  | return $links; |
  | 305 |  | } |
  | 306 |  |  |
  | 307 |  | /\*\* |
  | 308 |  | \* Sends ajax request to download subscriber list. |
  | 309 |  | \*/ |
  | 310 |  | function download\_csv\_button() { |
  | 311 |  | global $wpdb; |
  | 312 |  | $count = $wpdb->get\_var( "SELECT COUNT(\*) FROM {$wpdb->prefix}maintenance\_page" ); |
  | 313 |  | if( $count == 0 ) { |
  | 314 |  | \_e( 'No subscribers yet', 'maintenance-page'); |
  | 315 |  | } else { |
  | 316 |  | echo '<a class="csv-download button" href="'.admin\_url().'admin-ajax.php?action=subscribe\_ajax">'.\_\_( 'Download Subscriber CSV list','maintenance-page' ).'</a>'; |
  | 317 |  | } |
  | 318 |  | } |
  | 319 |  |  |
  | 320 |  | /\*\* |
  | 321 |  | \* Load CSS files |
  | 322 |  | \*/ |
  | 323 |  | public function enqueue\_admin\_styles() { |
  | 324 |  | wp\_enqueue\_style('mp-admin-styles', mp()->plugin\_url . 'includes/admin/css/admin.css'); |
  | 325 |  | } |
  | 326 |  |  |
  | 327 |  |  |
  | 328 |  | /\*\* |
  | 329 |  | \* Adds the sidebar section on the admin page |
  | 330 |  | \* @return void |
  | 331 |  | \*/ |
  | 332 |  | function admin\_options\_sidebar() { ?> |
  | 333 |  | <div id="options-sidebar"> |
  | 334 |  | <div class="metabox-holder"> |
  | 335 |  | <div class="postbox"> |
  | 336 |  | <h3><?php esc\_attr\_e( 'Plugin Info', 'spacious' ); ?></h3> |
  | 337 |  | <div class="inside"> |
  | 338 |  | <div class="option-btn"> |
  | 339 |  | <a href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page-pro/' ); ?>" target="\_blank" rel="nofollow"> |
  | 340 |  | <img src="<?php echo mp()->plugin\_url . 'includes/admin/images/maintenance-page-pro.jpg';?>" alt="<?php \_e('maintenance-page-pro', 'maintenance-page'); ?>"> |
  | 341 |  | </a> |
  | 342 |  | </div> |
  | 343 |  | <div class="option-btn"><a class="btn upgrade" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page-pro/' ); ?>"><?php esc\_attr\_e( 'Upgrade' , 'maintenance-page' ); ?></a></div> |
  | 344 |  | <div class="option-btn"><a class="btn support" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/support-forum/' ); ?>"><?php esc\_attr\_e( 'Free Support' , 'maintenance-page' ); ?></a></div> |
  | 345 |  | <div class="option-btn"><a class="btn demo" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page/' ); ?>"><?php esc\_attr\_e( 'View Demo' , 'maintenance-page' ); ?></a></div> |
  | 346 |  | <div align="center" style="padding:5px; background-color:#fafafa;border: 1px solid #CCC;margin-bottom: 10px;"> |
  | 347 |  | <strong><?php esc\_attr\_e( 'If you like our work. Buy us a beer.', 'esteem' ); ?></strong> |
  | 348 |  | <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="\_top"> |
  | 349 |  | <input type="hidden" name="cmd" value="\_s-xclick"> |
  | 350 |  | <input type="hidden" name="hosted\_button\_id" value="8AHDCA8CDGAJG"> |
  | 351 |  | <input type="image" src="https://www.paypalobjects.com/en\_US/GB/i/btn/btn\_donateCC\_LG.gif" border="0" name="submit" alt="PayPal"> |
  | 352 |  | <img alt="" border="0" src="https://www.paypalobjects.com/en\_GB/i/scr/pixel.gif" width="1" height="1"> |
  | 353 |  | </form> |
  | 354 |  | </div> |
  | 355 |  | </div><!-- inside --> |
  | 356 |  | </div><!-- .postbox --> |
  | 357 |  | </div><!-- .metabox-holder --> |
  | 358 |  | </div><!-- #options-sidebar --> |
  | 359 |  | <?php |
  | 360 |  | } |
  | 361 |  | } |
  |  | 11 | if ( ! class\_exists( 'MP\_Settings' ) ) : |
  |  | 12 | class MP\_Settings { |
  |  | 13 |  |
  |  | 14 | private $settings\_api; |
  |  | 15 |  |
  |  | 16 | function \_\_construct() { |
  |  | 17 | $this->settings\_api = new MP\_Settings\_API(); |
  |  | 18 |  |
  |  | 19 | add\_action( 'admin\_init', array( $this, 'admin\_init' ) ); |
  |  | 20 | add\_action( 'admin\_menu', array( $this, 'admin\_menu' ) ); |
  |  | 21 | add\_action( 'mp\_before\_form\_closing', array( $this, 'admin\_options\_sidebar' ) ); |
  |  | 22 | add\_action( 'mp\_subscribe\_settings', array( $this, 'download\_csv\_button' ) ); |
  |  | 23 | add\_filter( 'plugin\_action\_links\_' . mp()->basename, array( $this, 'add\_settings\_link' ) ); |
  |  | 24 | } |
  |  | 25 |  |
  |  | 26 | function admin\_init() { |
  |  | 27 |  |
  |  | 28 | //set the settings |
  |  | 29 | $this->settings\_api->set\_sections( $this->get\_settings\_sections() ); |
  |  | 30 | $this->settings\_api->set\_fields( $this->get\_settings\_fields() ); |
  |  | 31 |  |
  |  | 32 | //initialize settings |
  |  | 33 | $this->settings\_api->admin\_init(); |
  |  | 34 | } |
  |  | 35 |  |
  |  | 36 | function admin\_menu() { |
  |  | 37 | $hook = add\_options\_page( 'Maintenance Page', 'Maintenance Page', 'manage\_options', 'mp\_settings\_api', array( $this, 'plugin\_page' ) ); |
  |  | 38 | add\_action( "admin\_print\_styles-$hook", array( $this, 'enqueue\_admin\_styles' ) ); |
  |  | 39 | } |
  |  | 40 |  |
  |  | 41 | function get\_settings\_sections() { |
  |  | 42 | $sections = array( |
  |  | 43 | array( |
  |  | 44 | 'id'    => 'mp\_basics', |
  |  | 45 | 'title' => \_\_( 'General', 'maintenance-page' ), |
  |  | 46 | ), |
  |  | 47 | array( |
  |  | 48 | 'id'    => 'mp\_social', |
  |  | 49 | 'title' => \_\_( 'Social Icons', 'maintenance-page' ), |
  |  | 50 | ), |
  |  | 51 | array( |
  |  | 52 | 'id'    => 'mp\_subscribe', |
  |  | 53 | 'title' => \_\_( 'Subscribe', 'maintenance-page' ), |
  |  | 54 | ), |
  |  | 55 | ); |
  |  | 56 | return $sections; |
  |  | 57 | } |
  |  | 58 |  |
  |  | 59 | /\*\* |
  |  | 60 | \* Returns all the settings fields |
  |  | 61 | \* |
  |  | 62 | \* @return array settings fields |
  |  | 63 | \*/ |
  |  | 64 | function get\_settings\_fields() { |
  |  | 65 | $settings\_fields = array( |
  |  | 66 | 'mp\_basics'    => array( |
  |  | 67 | array( |
  |  | 68 | 'name'  => 'mp\_activate', |
  |  | 69 | 'label' => \_\_( 'Activate', 'maintenance-page' ), |
  |  | 70 | 'desc'  => \_\_( 'Activate the Maintenance Page', 'maintenance-page' ), |
  |  | 71 | 'type'  => 'checkbox', |
  |  | 72 | ), |
  |  | 73 | array( |
  |  | 74 | 'name'  => 'mp\_header\_status', |
  |  | 75 | 'label' => \_\_( '503', 'maintenance-page' ), |
  |  | 76 | 'desc'  => \_\_( 'Search engines will be notified site is unavailable', 'maintenance-page' ), |
  |  | 77 | 'type'  => 'checkbox', |
  |  | 78 | ), |
  |  | 79 | array( |
  |  | 80 | 'name'              => 'mp\_logo', |
  |  | 81 | 'label'             => \_\_( 'Logo', 'maintenance-page' ), |
  |  | 82 | 'desc'              => \_\_( 'Upload Logo', 'maintenance-page' ), |
  |  | 83 | 'type'              => 'file', |
  |  | 84 | 'default'           => '', |
  |  | 85 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 86 | ), |
  |  | 87 | array( |
  |  | 88 | 'name'              => 'mp\_heading', |
  |  | 89 | 'label'             => \_\_( 'Heading Title', 'maintenance-page' ), |
  |  | 90 | 'desc'              => \_\_( 'Main Heading for the Maintenance Page', 'maintenance-page' ), |
  |  | 91 | 'type'              => 'text', |
  |  | 92 | 'default'           => 'MAINTENANCE PAGE', |
  |  | 93 | 'sanitize\_callback' => 'sanitize\_text\_field', |
  |  | 94 | ), |
  |  | 95 | array( |
  |  | 96 | 'name'              => 'mp\_message', |
  |  | 97 | 'label'             => \_\_( 'Text Message', 'maintenance-page' ), |
  |  | 98 | 'desc'              => \_\_( 'Message For your Viewer', 'maintenance-page' ), |
  |  | 99 | 'type'              => 'wysiwyg', |
  |  | 100 | 'sanitize\_callback' => 'mp\_filter\_kses', |
  |  | 101 | ), |
  |  | 102 | array( |
  |  | 103 | 'name'              => 'mp\_background\_image', |
  |  | 104 | 'label'             => \_\_( 'Background Image', 'maintenance-page' ), |
  |  | 105 | 'desc'              => \_\_( 'Upload background Image', 'maintenance-page' ), |
  |  | 106 | 'type'              => 'file', |
  |  | 107 | 'default'           => '', |
  |  | 108 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 109 | ), |
  |  | 110 | array( |
  |  | 111 | 'name'  => 'mp\_background\_image\_deactivate', |
  |  | 112 | 'label' => \_\_( 'Deactivate', 'maintenance-page' ), |
  |  | 113 | 'desc'  => \_\_( 'Deactivate the Background Image', 'maintenance-page' ), |
  |  | 114 | 'type'  => 'checkbox', |
  |  | 115 | ), |
  |  | 116 | array( |
  |  | 117 | 'name'              => 'mp\_background\_color', |
  |  | 118 | 'label'             => \_\_( 'Background Color', 'maintenance-page' ), |
  |  | 119 | 'desc'              => \_\_( 'Choose Background Color', 'maintenance-page' ), |
  |  | 120 | 'type'              => 'color', |
  |  | 121 | 'default'           => '#ffffff', |
  |  | 122 | 'sanitize\_callback' => 'sanitize\_hex\_color', |
  |  | 123 | ), |
  |  | 124 | array( |
  |  | 125 | 'name'              => 'mp\_font\_color', |
  |  | 126 | 'label'             => \_\_( 'Font Color', 'maintenance-page' ), |
  |  | 127 | 'desc'              => \_\_( 'Choose font color', 'maintenance-page' ), |
  |  | 128 | 'type'              => 'color', |
  |  | 129 | 'default'           => '#ffffff', |
  |  | 130 | 'sanitize\_callback' => 'sanitize\_hex\_color', |
  |  | 131 | ), |
  |  | 132 | array( |
  |  | 133 | 'name'              => 'mp\_link\_color', |
  |  | 134 | 'label'             => \_\_( 'Link Color', 'maintenance-page' ), |
  |  | 135 | 'desc'              => \_\_( 'Choose Link color', 'maintenance-page' ), |
  |  | 136 | 'type'              => 'color', |
  |  | 137 | 'default'           => '#1BBC9B', |
  |  | 138 | 'sanitize\_callback' => 'sanitize\_hex\_color', |
  |  | 139 | ), |
  |  | 140 | array( |
  |  | 141 | 'name'              => 'mp\_css', |
  |  | 142 | 'label'             => \_\_( 'Custom CSS', 'maintenance-page' ), |
  |  | 143 | 'desc'              => \_\_( 'Enter Your Custom CSS here', 'maintenance-page' ), |
  |  | 144 | 'type'              => 'textarea', |
  |  | 145 | 'sanitize\_callback' => 'wp\_filter\_kses', |
  |  | 146 | ), |
  |  | 147 | array( |
  |  | 148 | 'name'              => 'mp\_exclude', |
  |  | 149 | 'label'             => \_\_( 'Exclude', 'maintenance-page' ), |
  |  | 150 | 'desc'              => \_\_( 'Enter the page/post slug. One slug per line', 'maintenance-page' ), |
  |  | 151 | 'type'              => 'textarea', |
  |  | 152 | 'sanitize\_callback' => 'wp\_filter\_kses', |
  |  | 153 | ), |
  |  | 154 | array( |
  |  | 155 | 'name'    => 'mp\_footer\_radio', |
  |  | 156 | 'label'   => \_\_( 'Powered by ThemeGrill', 'maintenance-page' ), |
  |  | 157 | 'desc'    => \_\_( 'How about a footer credit for our hardwork', 'maintenance-page' ), |
  |  | 158 | 'type'    => 'radio', |
  |  | 159 | 'options' => array( |
  |  | 160 | 'yes' => \_\_( 'Yes - we love you', 'maintenance-page' ), |
  |  | 161 | 'no'  => \_\_( 'Nope', 'maintenance-page' ), |
  |  | 162 | ), |
  |  | 163 | 'default' => 'no', |
  |  | 164 | ), |
  |  | 165 | ), |
  |  | 166 | 'mp\_social'    => array( |
  |  | 167 | array( |
  |  | 168 | 'name'              => 'mp\_facebook', |
  |  | 169 | 'label'             => \_\_( 'Facebook', 'maintenance-page' ), |
  |  | 170 | 'desc'              => \_\_( 'Enter Facebook url', 'maintenance-page' ), |
  |  | 171 | 'type'              => 'text', |
  |  | 172 | 'default'           => '', |
  |  | 173 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 174 | ), |
  |  | 175 | array( |
  |  | 176 | 'name'              => 'mp\_twitter', |
  |  | 177 | 'label'             => \_\_( 'Twitter', 'maintenance-page' ), |
  |  | 178 | 'desc'              => \_\_( 'Enter Twitter url', 'maintenance-page' ), |
  |  | 179 | 'type'              => 'text', |
  |  | 180 | 'default'           => '', |
  |  | 181 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 182 | ), |
  |  | 183 | array( |
  |  | 184 | 'name'              => 'mp\_pinterest', |
  |  | 185 | 'label'             => \_\_( 'Pinterest', 'maintenance-page' ), |
  |  | 186 | 'desc'              => \_\_( 'Enter Pinterest url', 'maintenance-page' ), |
  |  | 187 | 'type'              => 'text', |
  |  | 188 | 'default'           => '', |
  |  | 189 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 190 | ), |
  |  | 191 | array( |
  |  | 192 | 'name'              => 'mp\_google', |
  |  | 193 | 'label'             => \_\_( 'GooglePlus', 'maintenance-page' ), |
  |  | 194 | 'desc'              => \_\_( 'Enter GooglePlus url', 'maintenance-page' ), |
  |  | 195 | 'type'              => 'text', |
  |  | 196 | 'default'           => '', |
  |  | 197 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 198 | ), |
  |  | 199 | array( |
  |  | 200 | 'name'              => 'mp\_youtube', |
  |  | 201 | 'label'             => \_\_( 'Youtube', 'maintenance-page' ), |
  |  | 202 | 'desc'              => \_\_( 'Enter Youtube url', 'maintenance-page' ), |
  |  | 203 | 'type'              => 'text', |
  |  | 204 | 'default'           => '', |
  |  | 205 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 206 | ), |
  |  | 207 | array( |
  |  | 208 | 'name'              => 'mp\_linkedin', |
  |  | 209 | 'label'             => \_\_( 'LinkedIn', 'maintenance-page' ), |
  |  | 210 | 'desc'              => \_\_( 'Enter LinkedIn url', 'maintenance-page' ), |
  |  | 211 | 'type'              => 'text', |
  |  | 212 | 'default'           => '', |
  |  | 213 | 'sanitize\_callback' => 'esc\_url\_raw', |
  |  | 214 | ), |
  |  | 215 | ), |
  |  | 216 | 'mp\_subscribe' => array( |
  |  | 217 | array( |
  |  | 218 | 'name'  => 'mp\_subscribe\_activate', |
  |  | 219 | 'label' => \_\_( 'Activate', 'maintenance-page' ), |
  |  | 220 | 'desc'  => \_\_( 'Activate subscribe feature', 'maintenance-page' ), |
  |  | 221 | 'type'  => 'checkbox', |
  |  | 222 | ), |
  |  | 223 | array( |
  |  | 224 | 'name'              => 'mp\_subscribe\_title', |
  |  | 225 | 'label'             => \_\_( 'Subscribe Info Title', 'maintenance-page' ), |
  |  | 226 | 'desc'              => \_\_( 'Title For the Subscribe information', 'maintenance-page' ), |
  |  | 227 | 'type'              => 'text', |
  |  | 228 | 'default'           => '', |
  |  | 229 | 'sanitize\_callback' => 'sanitize\_text\_field', |
  |  | 230 | ), |
  |  | 231 | array( |
  |  | 232 | 'name'              => 'mp\_subscribe\_message', |
  |  | 233 | 'label'             => \_\_( 'Subscribe Message', 'maintenance-page' ), |
  |  | 234 | 'desc'              => \_\_( 'Message for subscribe text', 'maintenance-page' ), |
  |  | 235 | 'type'              => 'wysiwyg', |
  |  | 236 | 'sanitize\_callback' => 'wp\_kses\_post', |
  |  | 237 | ), |
  |  | 238 | array( |
  |  | 239 | 'name'  => 'mp\_subscribe\_settings', |
  |  | 240 | 'label' => \_\_( 'Download', 'maintenance-page' ), |
  |  | 241 | 'desc'  => '', |
  |  | 242 | 'type'  => 'hook', |
  |  | 243 | ), |
  |  | 244 | ), |
  |  | 245 | ); |
  |  | 246 |  |
  |  | 247 | return $settings\_fields; |
  |  | 248 | } |
  |  | 249 |  |
  |  | 250 | function plugin\_page() { |
  |  | 251 | echo '<div class="wrap">'; |
  |  | 252 |  |
  |  | 253 | $this->settings\_api->show\_navigation(); |
  |  | 254 | $this->settings\_api->show\_forms(); |
  |  | 255 |  |
  |  | 256 | echo '</div>'; |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | /\*\* |
  |  | 260 | \* Get all the pages |
  |  | 261 | \* |
  |  | 262 | \* @return array page names with key value pairs |
  |  | 263 | \*/ |
  |  | 264 | function get\_pages() { |
  |  | 265 | $pages         = get\_pages(); |
  |  | 266 | $pages\_options = array(); |
  |  | 267 | if ( $pages ) { |
  |  | 268 | foreach ( $pages as $page ) { |
  |  | 269 | $pages\_options[ $page->ID ] = $page->post\_title; |
  |  | 270 | } |
  |  | 271 | } |
  |  | 272 |  |
  |  | 273 | return $pages\_options; |
  |  | 274 | } |
  |  | 275 |  |
  |  | 276 | /\*\* |
  |  | 277 | \* Get the value of a settings field |
  |  | 278 | \* |
  |  | 279 | \* @param string $option settings field name |
  |  | 280 | \* @param string $section the section name this field belongs to |
  |  | 281 | \* @param string $default default text if it's not found |
  |  | 282 | \* @return mixed |
  |  | 283 | \*/ |
  |  | 284 | function get\_option( $option, $section, $default = '' ) { |
  |  | 285 |  |
  |  | 286 | $options = get\_option( $section ); |
  |  | 287 |  |
  |  | 288 | if ( isset( $options[ $option ] ) ) { |
  |  | 289 | return $options[ $option ]; |
  |  | 290 | } |
  |  | 291 |  |
  |  | 292 | return $default; |
  |  | 293 | } |
  |  | 294 |  |
  |  | 295 | /\*\* |
  |  | 296 | \* Add the settings link to the plugins page |
  |  | 297 | \* |
  |  | 298 | \* @param string $links |
  |  | 299 | \* @return array |
  |  | 300 | \*/ |
  |  | 301 | function add\_settings\_link( $links ) { |
  |  | 302 | $settings\_link = '<a href="options-general.php?page=mp\_settings\_api">' . \_\_( 'Settings', 'maintenance-page' ) . '</a>'; |
  |  | 303 | array\_unshift( $links, $settings\_link ); |
  |  | 304 | return $links; |
  |  | 305 | } |
  |  | 306 |  |
  |  | 307 | /\*\* |
  |  | 308 | \* Sends ajax request to download subscriber list. |
  |  | 309 | \*/ |
  |  | 310 | function download\_csv\_button() { |
  |  | 311 | global $wpdb; |
  |  | 312 | $count = $wpdb->get\_var( "SELECT COUNT(\*) FROM {$wpdb->prefix}maintenance\_page" ); |
  |  | 313 | if ( $count == 0 ) { |
  |  | 314 | \_e( 'No subscribers yet', 'maintenance-page' ); |
  |  | 315 | } else { |
  |  | 316 | $url = admin\_url() . 'admin-ajax.php?action=subscribe\_ajax'; |
  |  | 317 | echo '<a class="csv-download button" href="' . wp\_nonce\_url( $url, 'subscribe\_download' ) . '">' . \_\_( 'Download Subscriber CSV list', 'maintenance-page' ) . '</a>'; |
  |  | 318 | } |
  |  | 319 | } |
  |  | 320 |  |
  |  | 321 | /\*\* |
  |  | 322 | \* Load CSS files |
  |  | 323 | \*/ |
  |  | 324 | public function enqueue\_admin\_styles() { |
  |  | 325 | wp\_enqueue\_style( 'mp-admin-styles', mp()->plugin\_url . 'includes/admin/css/admin.css' ); |
  |  | 326 | } |
  |  | 327 |  |
  |  | 328 |  |
  |  | 329 | /\*\* |
  |  | 330 | \* Adds the sidebar section on the admin page |
  |  | 331 | \* @return void |
  |  | 332 | \*/ |
  |  | 333 | function admin\_options\_sidebar() { |
  |  | 334 | ?> |
  |  | 335 | <div id="options-sidebar"> |
  |  | 336 | <div class="metabox-holder"> |
  |  | 337 | <div class="postbox"> |
  |  | 338 | <h3><?php esc\_attr\_e( 'Plugin Info', 'spacious' ); ?></h3> |
  |  | 339 | <div class="inside"> |
  |  | 340 | <div class="option-btn"> |
  |  | 341 | <a href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page-pro/' ); ?>" target="\_blank" rel="nofollow"> |
  |  | 342 | <img src="<?php echo mp()->plugin\_url . 'includes/admin/images/maintenance-page-pro.jpg'; ?>" alt="<?php \_e( 'maintenance-page-pro', 'maintenance-page' ); ?>"> |
  |  | 343 | </a> |
  |  | 344 | </div> |
  |  | 345 | <div class="option-btn"><a class="btn upgrade" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page-pro/' ); ?>"><?php esc\_attr\_e( 'Upgrade', 'maintenance-page' ); ?></a></div> |
  |  | 346 | <div class="option-btn"><a class="btn support" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/support-forum/' ); ?>"><?php esc\_attr\_e( 'Free Support', 'maintenance-page' ); ?></a></div> |
  |  | 347 | <div class="option-btn"><a class="btn demo" target="\_blank" href="<?php echo esc\_url( 'http://themegrill.com/plugins/maintenance-page/' ); ?>"><?php esc\_attr\_e( 'View Demo', 'maintenance-page' ); ?></a></div> |
  |  | 348 | <div align="center" style="padding:5px; background-color:#fafafa;border: 1px solid #CCC;margin-bottom: 10px;"> |
  |  | 349 | <strong><?php esc\_attr\_e( 'If you like our work. Buy us a beer.', 'esteem' ); ?></strong> |
  |  | 350 | <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="\_top"> |
  |  | 351 | <input type="hidden" name="cmd" value="\_s-xclick"> |
  |  | 352 | <input type="hidden" name="hosted\_button\_id" value="8AHDCA8CDGAJG"> |
  |  | 353 | <input type="image" src="https://www.paypalobjects.com/en\_US/GB/i/btn/btn\_donateCC\_LG.gif" border="0" name="submit" alt="PayPal"> |
  |  | 354 | <img alt="" border="0" src="https://www.paypalobjects.com/en\_GB/i/scr/pixel.gif" width="1" height="1"> |
  |  | 355 | </form> |
  |  | 356 | </div> |
  |  | 357 | </div><!-- inside --> |
  |  | 358 | </div><!-- .postbox --> |
  |  | 359 | </div><!-- .metabox-holder --> |
  |  | 360 | </div><!-- #options-sidebar --> |
  |  | 361 | <?php |
  |  | 362 | } |
  |  | 363 | } |
  | 362 | 364 | endif; |
* ## [maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php](/changeset/3037664/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?old=1202134&old_path=maintenance-page%2Ftrunk%2Fincludes%2Flib%2Fclass-maintenance-page-activator.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php")

  | [r1218033](/browser/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?rev=1202134#L21 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?rev=3037664#L21 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | class Maintenance\_Page\_Activator { |
  | 22 | 22 |  |
  | 23 |  | /\*\* |
  | 24 |  | \* creates database table on activation |
  | 25 |  | \* |
  | 26 |  | \* @global WPDB $wpdb |
  | 27 |  | \* |
  | 28 |  | \* @since    1.0.0 |
  | 29 |  | \*/ |
  | 30 |  | public static function activate( $networkwide ) { |
  | 31 |  | global $wpdb; |
  |  | 23 | /\*\* |
  |  | 24 | \* creates database table on activation |
  |  | 25 | \* |
  |  | 26 | \* @global WPDB $wpdb |
  |  | 27 | \* |
  |  | 28 | \* @since    1.0.0 |
  |  | 29 | \*/ |
  |  | 30 | public static function activate( $networkwide ) { |
  |  | 31 | global $wpdb; |
  | 32 | 32 |  |
  | 33 |  | ~~if (~~function\_exists( 'is\_multisite' ) && is\_multisite() ) { |
  | 34 |  | //check if it is network activation if so run the activation function for each id |
  | 35 |  | ~~if~~( $networkwide ) { |
  | 36 |  | ~~$old\_blog =~~  $wpdb->blogid; |
  | 37 |  | //Get all blog ids |
  | 38 |  | ~~$blogids =~~  $wpdb->get\_col( "SELECT blog\_id FROM $wpdb->blogs" ); |
  |  | 33 | if ( function\_exists( 'is\_multisite' ) && is\_multisite() ) { |
  |  | 34 | //check if it is network activation if so run the activation function for each id |
  |  | 35 | if ( $networkwide ) { |
  |  | 36 | $old\_blog = $wpdb->blogid; |
  |  | 37 | //Get all blog ids |
  |  | 38 | $blogids = $wpdb->get\_col( "SELECT blog\_id FROM $wpdb->blogs" ); |
  | 39 | 39 |  |
  | 40 |  | foreach ( $blogids as $blog\_id ) { |
  | 41 |  | ~~switch\_to\_blog($blog\_id~~); |
  | 42 |  | //Create database table if not exists |
  | 43 |  | self::create\_subscribe\_table(); |
  | 44 |  | } |
  | 45 |  | switch\_to\_blog( $old\_blog ); |
  | 46 |  | return; |
  | 47 |  | } |
  | 48 |  | } |
  | 49 |  | //Create database table if not exists |
  | 50 |  | self::create\_subscribe\_table(); |
  | 51 |  | } |
  |  | 40 | foreach ( $blogids as $blog\_id ) { |
  |  | 41 | switch\_to\_blog( $blog\_id ); |
  |  | 42 | //Create database table if not exists |
  |  | 43 | self::create\_subscribe\_table(); |
  |  | 44 | } |
  |  | 45 | switch\_to\_blog( $old\_blog ); |
  |  | 46 | return; |
  |  | 47 | } |
  |  | 48 | } |
  |  | 49 | //Create database table if not exists |
  |  | 50 | self::create\_subscribe\_table(); |
  |  | 51 | } |
  | 52 | 52 |  |
  | 53 |  | /\*\* |
  | 54 |  | \* sql query for creating database table |
  | 55 |  | \* |
  | 56 |  | \* @global WPDB $wpdb |
  | 57 |  | \* |
  | 58 |  | \* @since    1.0.0 |
  | 59 |  | \*/ |
  | 60 |  | public static function create\_subscribe\_table() { |
  | 61 |  | global $wpdb; |
  | 62 |  | $query = "CREATE TABLE IF NOT EXISTS {$wpdb->prefix}maintenance\_page ( |
  |  | 53 | /\*\* |
  |  | 54 | \* sql query for creating database table |
  |  | 55 | \* |
  |  | 56 | \* @global WPDB $wpdb |
  |  | 57 | \* |
  |  | 58 | \* @since    1.0.0 |
  |  | 59 | \*/ |
  |  | 60 | public static function create\_subscribe\_table() { |
  |  | 61 | global $wpdb; |
  |  | 62 | $query = "CREATE TABLE IF NOT EXISTS {$wpdb->prefix}maintenance\_page ( |
  | 63 | 63 | `id` bigint(20) NOT NULL AUTO\_INCREMENT, |
  | 64 | 64 | `email` varchar(50) NOT NULL UNIQUE, |
  | […](/browser/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?rev=1202134#L66) | […](/browser/maintenance-page/trunk/includes/lib/class-maintenance-page-activator.php?rev=3037664#L66) |  |
  | 66 | 66 | PRIMARY KEY (`id`) |
  | 67 | 67 | ) DEFAULT CHARSET=utf8 AUTO\_INCREMENT=1"; |
  | 68 |  | ~~require\_once(ABSPATH . 'wp-admin/includes/upgrade.php')~~; |
  | 69 |  | ~~dbDelta($query~~); |
  | 70 |  | } |
  |  | 68 | require\_once ABSPATH . 'wp-admin/includes/upgrade.php'; |
  |  | 69 | dbDelta( $query ); |
  |  | 70 | } |
  | 71 | 71 | } |
* ## [maintenance-page/trunk/includes/lib/subscriber\_handler.php](/changeset/3037664/maintenance-page/trunk/includes/lib/subscriber_handler.php?old=1021658&old_path=maintenance-page%2Ftrunk%2Fincludes%2Flib%2Fsubscriber_handler.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/includes/lib/subscriber_handler.php")

  | [r1218033](/browser/maintenance-page/trunk/includes/lib/subscriber_handler.php?rev=1021658#L1 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/includes/lib/subscriber_handler.php?rev=3037664#L1 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | $insert = FALSE;; |
  | 3 |  | if( is\_email( $\_POST['subscriber\_email'] ) ) { |
  | 4 |  | global $wpdb; |
  | 5 |  | $wpdb->hide\_errors(); |
  |  | 2 | $insert = false; |
  | 6 | 3 |  |
  | 7 |  | if ( isset($\_POST['subscriber\_email']) ) { |
  |  | 4 | if ( is\_email( $\_POST['subscriber\_email'] ) ) { |
  |  | 5 | global $wpdb; |
  |  | 6 | $wpdb->hide\_errors(); |
  | 8 | 7 |  |
  | 9 |  | //add subscriber email to database |
  | 10 |  | $insert = $wpdb->insert( |
  | 11 |  | "{$wpdb->prefix}maintenance\_page", |
  | 12 |  | array( |
  | 13 |  | 'email' => $\_POST["subscriber\_email"], |
  | 14 |  | 'insert\_date' => current\_time('mysql', true) |
  | 15 |  | ), |
  | 16 |  | array( |
  | 17 |  | '%s', |
  | 18 |  | '%s' |
  | 19 |  | ) |
  | 20 |  | ); |
  | 21 |  | } |
  |  | 8 | if ( isset( $\_POST['subscriber\_email'] ) ) { |
  |  | 9 |  |
  |  | 10 | //add subscriber email to database |
  |  | 11 | $insert = $wpdb->insert( |
  |  | 12 | "{$wpdb->prefix}maintenance\_page", |
  |  | 13 | array( |
  |  | 14 | 'email'       => $\_POST['subscriber\_email'], |
  |  | 15 | 'insert\_date' => current\_time( 'mysql', true ), |
  |  | 16 | ), |
  |  | 17 | array( |
  |  | 18 | '%s', |
  |  | 19 | '%s', |
  |  | 20 | ) |
  |  | 21 | ); |
  |  | 22 | } |
  | 22 | 23 | } else { |
  | 23 |  | ~~$email = isset( $\_POST['subscriber\_email'] ) ? $\_POST["subscriber\_email"] : FALSE~~; |
  | 24 |  | ~~$erroResponse = \_\_('Enter a Valid Email Id','maintenance-page'~~); ?> |
  | 25 |  | <script> |
  | 26 |  | var erroResponse = '<?php echo $erroResponse; ?>'; |
  | 27 |  | jQuery(document).ready(function($) { |
  | 28 |  | $(".inputsubs").attr("placeholder", erroResponse ); |
  | 29 |  | $(".email-field").addClass('alert'); |
  | 30 |  | $(".inputsubs").css('color','RED'); |
  | 31 |  | }); |
  | 32 |  | </script> |
  | 33 |  | <?php |
  |  | 24 | $email        = isset( $\_POST['subscriber\_email'] ) ? $\_POST['subscriber\_email'] : false; |
  |  | 25 | $erroResponse = \_\_( 'Enter a Valid Email Id', 'maintenance-page' ); ?> |
  |  | 26 | <script> |
  |  | 27 | var erroResponse = '<?php echo $erroResponse; ?>'; |
  |  | 28 | jQuery(document).ready(function($) { |
  |  | 29 | $(".inputsubs").attr("placeholder", erroResponse ); |
  |  | 30 | $(".email-field").addClass('alert'); |
  |  | 31 | $(".inputsubs").css('color','RED'); |
  |  | 32 | }); |
  |  | 33 | </script> |
  |  | 34 | <?php |
  | 34 | 35 | } |
  | 35 |  | if (!$insert === FALSE) { |
  | 36 |  | $response = \_\_('You successfully subscribed. Thanks!','maintenance-page');?> |
  | 37 |  | <script> |
  | 38 |  | jQuery(document).ready(function($) { |
  | 39 |  | var response = '<?php echo $response; ?>'; |
  | 40 |  | $(".sign-up").html(response); |
  | 41 |  | $('.sign-up').addClass('response').removeClass('sign-up'); |
  | 42 |  | }); |
  | 43 |  | </script> |
  | 44 |  | <?php } |
  |  | 36 | if ( ! $insert === false ) { |
  |  | 37 | $response = \_\_( 'You successfully subscribed. Thanks!', 'maintenance-page' ); |
  |  | 38 | ?> |
  |  | 39 | <script> |
  |  | 40 | jQuery(document).ready(function($) { |
  |  | 41 | var response = '<?php echo $response; ?>'; |
  |  | 42 | $(".sign-up").html(response); |
  |  | 43 | $('.sign-up').addClass('response').removeClass('sign-up'); |
  |  | 44 | }); |
  |  | 45 | </script> |
  |  | 46 | <?php } |
  | 45 | 47 | ?> |
* ## [maintenance-page/trunk/maintenance-page.php](/changeset/3037664/maintenance-page/trunk/maintenance-page.php?old=1218029&old_path=maintenance-page%2Ftrunk%2Fmaintenance-page.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/maintenance-page.php")

  | [r1218033](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L6 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L6 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* Author: ThemeGrill |
  | 7 | 7 | \* Author URI: http://themegrill.com |
  | 8 |  | \* Version: 1.0.~~8~~ |
  |  | 8 | \* Version: 1.0.9 |
  | 9 | 9 | \* |
  | 10 | 10 | \* Maintenance Page is free software: you can redistribute it and/or modify |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L32) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L32) |  |
  | 32 | 32 | \* that request data directly. |
  | 33 | 33 | \*/ |
  | 34 |  | if ( ! defined( 'ABSPATH' ) ) exit; |
  | 35 |  |  |
  | 36 |  | if( !class\_exists( 'Maintenance\_Page' ) ) { |
  |  | 34 | if ( ! defined( 'ABSPATH' ) ) { |
  |  | 35 | exit; |
  |  | 36 | } |
  |  | 37 |  |
  |  | 38 | if ( ! class\_exists( 'Maintenance\_Page' ) ) { |
  | 37 | 39 | /\*\* |
  | 38 | 40 | \* Main Class |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L57) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L59) |  |
  | 57 | 59 | /\*\* |
  | 58 | 60 | \* Private constructor prevents construction outside this class. |
  | 59 |  | \*/ |
  | 60 |  | ~~P~~rivate function \_\_construct() { |
  | 61 |  | } |
  | 62 |  |  |
  | 63 |  | /\*\* |
  |  | 61 | \*/ |
  |  | 62 | private function \_\_construct() { |
  |  | 63 | } |
  |  | 64 |  |
  |  | 65 | /\*\* |
  | 64 | 66 | \* Main Maintenance Page Instance |
  | 65 | 67 | \* |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L71) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L73) |  |
  | 71 | 73 | \* @staticvar array $instance |
  | 72 | 74 | \* @uses Maintenance\_Page::setup\_constants() Setup the contants needed |
  | 73 |  | \* @uses Maintenance\_Page::includes() Include the required files |
  | 74 |  | \* @uses Maintenance\_Page::setup\_actions() Setup the hooks and actions |
  | 75 |  | \* @uses Maintenance\_Page::load\_textdomain() loads the textdomain for tranlation |
  |  | 75 | \* @uses Maintenance\_Page::includes() Include the required files |
  |  | 76 | \* @uses Maintenance\_Page::setup\_actions() Setup the hooks and actions |
  |  | 77 | \* @uses Maintenance\_Page::load\_textdomain() loads the textdomain for tranlation |
  | 76 | 78 | \* @see mp() |
  | 77 | 79 | \* @return The one true Maintenance\_Page |
  | 78 | 80 | \*/ |
  | 79 |  | public static function getInstance() { |
  | 80 |  | ~~if ( !~~isset( self::$instance ) ) { |
  | 81 |  | self::$instance = new self(); |
  | 82 |  | self::$instance->setup\_constants(); |
  | 83 |  | self::$instance->includes(); |
  | 84 |  | self::$instance->load\_textdomain(); |
  | 85 |  | self::$instance->setting\_options = new MP\_Settings(); |
  | 86 |  | self::$instance->setup\_actions(); |
  | 87 |  | } |
  |  | 81 | public static function getInstance() { |
  |  | 82 | if ( ! isset( self::$instance ) ) { |
  |  | 83 | self::$instance = new self(); |
  |  | 84 | self::$instance->setup\_constants(); |
  |  | 85 | self::$instance->includes(); |
  |  | 86 | self::$instance->load\_textdomain(); |
  |  | 87 | self::$instance->setting\_options = new MP\_Settings(); |
  |  | 88 | self::$instance->setup\_actions(); |
  |  | 89 | } |
  | 88 | 90 |  |
  | 89 | 91 | return self::$instance; |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L105) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L107) |  |
  | 105 | 107 | } |
  | 106 | 108 |  |
  | 107 |  | /\*\* |
  |  | 109 | /\*\* |
  | 108 | 110 | \* Setup plugin constants |
  | 109 | 111 | \* |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L114) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L116) |  |
  | 114 | 116 | private function setup\_constants() { |
  | 115 | 117 | // Plugin version |
  | 116 |  | $this->version = '1.0'; |
  |  | 118 | $this->version = '1.0'; |
  | 117 | 119 |  |
  | 118 | 120 | // Setup some base path and URL information |
  | 119 | 121 | $this->file       = \_\_FILE\_\_; // Plugin Root File |
  | 120 |  | $this->plugin\_dir = apply\_filters( 'mp\_plugin\_dir\_path', plugin\_dir\_path( $this->file ) ); // Plugin Folder Path |
  | 121 |  | $this->plugin\_url = apply\_filters( 'mp\_plugin\_dir\_url', ~~plugin\_dir\_url~~ ( $this->file ) ); // Plugin Folder URL |
  |  | 122 | $this->plugin\_dir = apply\_filters( 'mp\_plugin\_dir\_path', plugin\_dir\_path( $this->file ) ); // Plugin Folder Path |
  |  | 123 | $this->plugin\_url = apply\_filters( 'mp\_plugin\_dir\_url', plugin\_dir\_url( $this->file ) ); // Plugin Folder URL |
  | 122 | 124 | $this->basename   = apply\_filters( 'mp\_plugin\_basenname', plugin\_basename( $this->file ) ); //path relative to plugin folder |
  | 123 | 125 | } |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L134) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L136) |  |
  | 134 | 136 | require\_once $this->plugin\_dir . 'includes/admin/settings-api.php'; |
  | 135 | 137 | require\_once $this->plugin\_dir . 'includes/lib/class-maintenance-page-activator.php'; |
  | 136 |  |  |
  | 137 | 138 | } |
  | 138 | 139 |  |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L145) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L146) |  |
  | 145 | 146 | \*/ |
  | 146 | 147 | private function setup\_actions() { |
  | 147 |  | add\_action( 'template\_redirect', array( $this, 'load\_template\_file' ), 8); |
  | 148 |  | add\_action( 'wp\_ajax\_subscribe\_ajax', array( $this, 'subscribe\_download' ) ); |
  | 149 |  | /\*\* This action is documented in includes/class-maintenance-page-activator.php \*/ |
  | 150 |  | register\_activation\_hook( $this->file , array( 'Maintenance\_Page\_Activator', 'activate' ) ); |
  | 151 |  | add\_action('admin\_bar\_menu', array( $this, 'admin\_bar\_notice' ), 999); |
  | 152 |  | //fires when new blog is created in multisite. |
  | 153 |  | add\_action( 'wpmu\_new\_blog', array( $this, 'create\_subscribe\_table\_mu' ), 10, 6 ); |
  | 154 |  | add\_filter( 'wpmu\_drop\_tables', array( $this, 'delete\_subscribe\_table\_mu' ) ); |
  |  | 148 | add\_action( 'template\_redirect', array( $this, 'load\_template\_file' ), 8 ); |
  |  | 149 | add\_action( 'wp\_ajax\_subscribe\_ajax', array( $this, 'subscribe\_download' ) ); |
  |  | 150 | /\*\* This action is documented in includes/class-maintenance-page-activator.php \*/ |
  |  | 151 | register\_activation\_hook( $this->file, array( 'Maintenance\_Page\_Activator', 'activate' ) ); |
  |  | 152 | add\_action( 'admin\_bar\_menu', array( $this, 'admin\_bar\_notice' ), 999 ); |
  |  | 153 | //fires when new blog is created in multisite. |
  |  | 154 | add\_action( 'wpmu\_new\_blog', array( $this, 'create\_subscribe\_table\_mu' ), 10, 6 ); |
  |  | 155 | add\_filter( 'wpmu\_drop\_tables', array( $this, 'delete\_subscribe\_table\_mu' ) ); |
  |  | 156 | add\_filter( 'rest\_authentication\_errors', array( $this, 'restrict\_rest\_api' ) ); |
  |  | 157 | } |
  |  | 158 |  |
  |  | 159 | /\*\* |
  |  | 160 | \* Only allow REST API to be accessed by logged in users when maintenance page is activated |
  |  | 161 | \* |
  |  | 162 | \* @since 1.0.9 |
  |  | 163 | \* @return void |
  |  | 164 | \*/ |
  |  | 165 |  |
  |  | 166 | public function restrict\_rest\_api( $result ) { |
  |  | 167 | if ( $this->setting\_options->get\_option( 'mp\_activate', 'mp\_basics' ) == 'on' ) { |
  |  | 168 |  |
  |  | 169 | if ( true === $result || is\_wp\_error( $result ) ) { |
  |  | 170 | return $result; |
  |  | 171 | } |
  |  | 172 |  |
  |  | 173 | // Check if the user is logged in and is an administrator |
  |  | 174 | if ( ! is\_user\_logged\_in() || ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 175 | return new WP\_Error( |
  |  | 176 | \_\_( 'REST API is disabled. Currently under maintenance mode!!' ), |
  |  | 177 | array( 'status' => 403 ) |
  |  | 178 | ); |
  |  | 179 | } |
  |  | 180 | return $result; |
  |  | 181 | } |
  | 155 | 182 | } |
  | 156 | 183 |  |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L163) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L190) |  |
  | 163 | 190 | \*/ |
  | 164 | 191 | public function load\_textdomain() { |
  | 165 |  | load\_plugin\_textdomain( 'maintenance-page', false, dirname( $this->basename ) . '/languages' ); |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | /\*\* |
  | 169 |  | \* Loads the template file |
  | 170 |  | \* |
  | 171 |  | \* @since 1.0 |
  | 172 |  | \* @return void |
  | 173 |  | \*/ |
  |  | 192 | load\_plugin\_textdomain( 'maintenance-page', false, dirname( $this->basename ) . '/languages' ); |
  |  | 193 | } |
  |  | 194 |  |
  |  | 195 | /\*\* |
  |  | 196 | \* Loads the template file |
  |  | 197 | \* |
  |  | 198 | \* @since 1.0 |
  |  | 199 | \* @return void |
  |  | 200 | \*/ |
  | 174 | 201 | public function load\_template\_file() { |
  | 175 |  | if~~( $this->setting\_options->get\_option( 'mp\_activate','mp\_basics' ) ==~~'on' ) { |
  |  | 202 | if ( $this->setting\_options->get\_option( 'mp\_activate', 'mp\_basics' ) == 'on' ) { |
  | 176 | 203 | //Allow logged in user to view site. |
  | 177 |  | if~~( !~~is\_user\_logged\_in() ) { |
  | 178 |  | if~~( !~~$this->check\_excluded\_page() ) { |
  |  | 204 | if ( ! is\_user\_logged\_in() ) { |
  |  | 205 | if ( ! $this->check\_excluded\_page() ) { |
  | 179 | 206 | $this->check\_header\_status(); |
  | 180 | 207 | $file = $this->plugin\_dir . 'public/template/maintenance-page-display.php'; |
  | 181 |  | ~~include($file)~~; |
  | 182 |  | exit(); |
  | 183 |  | } |
  | 184 |  | } |
  | 185 |  | } |
  | 186 |  |  |
  | 187 |  | } |
  | 188 |  |  |
  | 189 |  | /\*\* |
  | 190 |  | \* Checks for page to exclude for redirect. |
  | 191 |  | \* |
  | 192 |  | \* @since 1.0 |
  | 193 |  | \* @return boolean |
  | 194 |  | \*/ |
  | 195 |  | public function check\_excluded\_page() { |
  | 196 |  | $is\_exclude = false; |
  | 197 |  | if( $this->setting\_options->get\_option( 'mp\_exclude','mp\_basics' ) ) { |
  | 198 |  | ~~$excluded = explode( "\n", $this->setting\_options->get\_option( 'mp\_exclude','mp\_basics' ) );~~ |
  | 199 |  | ~~foreach ($excluded as $key => $excluded\_slug~~) { |
  | 200 |  | ~~if( rtrim($excluded\_slug) == trim($\_SERVER['REQUEST\_URI'], '/') ){~~ |
  | 201 |  | ~~$is\_exclude = true~~; |
  | 202 |  | ~~break;~~ |
  | 203 |  | } |
  | 204 |  | } |
  | 205 |  | ~~}~~ |
  | 206 |  | return $is\_exclude; |
  | 207 |  | } |
  | 208 |  |  |
  | 209 |  | /\*\* |
  | 210 |  | \* Send 503 unavailable header status if activated |
  | 211 |  | \* |
  | 212 |  | \* @since 1.0 |
  | 213 |  | \*/ |
  | 214 |  | function check\_header\_status() { |
  | 215 |  | // set headers |
  | 216 |  | nocache\_headers(); |
  | 217 |  | if( $this->setting\_options->get\_option( 'mp\_header\_status','mp\_basics' ) == 'on' ) { |
  | 218 |  | $protocol = "HTTP/1.0"; |
  | 219 |  | ~~if ( "HTTP/1.1" == $\_SERVER["SERVER\_PROTOCOL"] )~~ |
  | 220 |  | ~~$protocol = "HTTP/1.1";~~ |
  |  | 208 | include $file; |
  |  | 209 | exit(); |
  |  | 210 | } |
  |  | 211 | } |
  |  | 212 | } |
  |  | 213 | } |
  |  | 214 |  |
  |  | 215 | /\*\* |
  |  | 216 | \* Checks for page to exclude for redirect. |
  |  | 217 | \* |
  |  | 218 | \* @since 1.0 |
  |  | 219 | \* @return boolean |
  |  | 220 | \*/ |
  |  | 221 | public function check\_excluded\_page() { |
  |  | 222 | $is\_exclude = false; |
  |  | 223 | if ( $this->setting\_options->get\_option( 'mp\_exclude', 'mp\_basics' ) ) { |
  |  | 224 | $excluded = explode( "\n", $this->setting\_options->get\_option( 'mp\_exclude', 'mp\_basics' ) ); |
  |  | 225 | foreach ( $excluded as $key => $excluded\_slug ) { |
  |  | 226 | if ( rtrim( $excluded\_slug ) == trim( $\_SERVER['REQUEST\_URI'], '/' ) ) { |
  |  | 227 | $is\_exclude = true; |
  |  | 228 | break; |
  |  | 229 | } |
  |  | 230 | } |
  |  | 231 | } |
  |  | 232 | return $is\_exclude; |
  |  | 233 | } |
  |  | 234 |  |
  |  | 235 | /\*\* |
  |  | 236 | \* Send 503 unavailable header status if activated |
  |  | 237 | \* |
  |  | 238 | \* @since 1.0 |
  |  | 239 | \*/ |
  |  | 240 | function check\_header\_status() { |
  |  | 241 | // set headers |
  |  | 242 | nocache\_headers(); |
  |  | 243 | if ( $this->setting\_options->get\_option( 'mp\_header\_status', 'mp\_basics' ) == 'on' ) { |
  |  | 244 | $protocol = 'HTTP/1.0'; |
  |  | 245 | if ( 'HTTP/1.1' == $\_SERVER['SERVER\_PROTOCOL'] ) { |
  |  | 246 | $protocol = 'HTTP/1.1'; |
  |  | 247 | } |
  | 221 | 248 | header( "$protocol 503 Service Unavailable", true, 503 ); |
  | 222 |  | header( "Retry-After: 86400" ); //retry in a day |
  | 223 |  | $mp\_construction\_file = WP\_CONTENT\_DIR."/maintenance-page.php"; |
  | 224 |  | if(!empty($mp\_construction\_file) and file\_exists($mp\_construction\_file)){ |
  | 225 |  | include\_once( $mp\_construction\_file ); |
  | 226 |  | exit(); |
  | 227 |  | } |
  | 228 |  | } |
  | 229 |  | } |
  | 230 |  |  |
  | 231 |  | /\*\* |
  | 232 |  | \* Download subscibers list |
  | 233 |  | \* |
  | 234 |  | \* @since 1.0 |
  | 235 |  | \* @global $wpdb |
  | 236 |  | \* @return void |
  | 237 |  | \*/ |
  | 238 |  | public function subscribe\_download() { |
  |  | 249 | header( 'Retry-After: 86400' ); //retry in a day |
  |  | 250 | $mp\_construction\_file = WP\_CONTENT\_DIR . '/maintenance-page.php'; |
  |  | 251 | if ( ! empty( $mp\_construction\_file ) and file\_exists( $mp\_construction\_file ) ) { |
  |  | 252 | include\_once $mp\_construction\_file; |
  |  | 253 | exit(); |
  |  | 254 | } |
  |  | 255 | } |
  |  | 256 | } |
  |  | 257 |  |
  |  | 258 | /\*\* |
  |  | 259 | \* Download subscibers list |
  |  | 260 | \* |
  |  | 261 | \* @since 1.0 |
  |  | 262 | \* @global $wpdb |
  |  | 263 | \* @return void |
  |  | 264 | \*/ |
  |  | 265 | public function subscribe\_download() { |
  |  | 266 |  |
  |  | 267 | if ( ! check\_admin\_referer( 'subscribe\_download' ) || ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 268 | wp\_die( \_\_( 'Security check failed!', 'maintenance-page' ) ); |
  |  | 269 | } |
  |  | 270 |  |
  | 239 | 271 | global $wpdb; |
  | 240 | 272 |  |
  | 241 |  | ~~$results = $wpdb->get\_results("SELECT email, insert\_date FROM {$wpdb->prefix}maintenance\_page ORDER BY id DESC", ARRAY\_A~~); |
  | 242 |  | ~~if (!empty($results)~~) { |
  | 243 |  | ~~$filename = 'subscribers-' . date('Y-m-d-h-i-s'~~) . '.csv'; |
  | 244 |  |  |
  | 245 |  | ~~header('Content-Type: text/csv'~~); |
  | 246 |  | ~~header('Content-Disposition: attachment;filename=' . $filename~~); |
  | 247 |  |  |
  | 248 |  | ~~$fp = fopen('php://output', 'w'~~); |
  | 249 |  |  |
  | 250 |  | ~~fputcsv($fp, array('email', 'insert\_date')~~); |
  | 251 |  | ~~foreach ($results as $item~~) { |
  | 252 |  | ~~fputcsv($fp, $item~~); |
  | 253 |  | } |
  | 254 |  |  |
  | 255 |  | ~~fclose($fp~~); |
  | 256 |  | } |
  | 257 |  | } |
  | 258 |  |  |
  | 259 |  | /\*\* |
  | 260 |  | \* Shows admin notice on/off |
  | 261 |  | \* |
  | 262 |  | \* @since 1.0 |
  | 263 |  | \* @global $wp\_admin\_bar |
  | 264 |  | \* @return void |
  | 265 |  | \*/ |
  |  | 273 | $results = $wpdb->get\_results( "SELECT email, insert\_date FROM {$wpdb->prefix}maintenance\_page ORDER BY id DESC", ARRAY\_A ); |
  |  | 274 | if ( ! empty( $results ) ) { |
  |  | 275 | $filename = 'subscribers-' . date( 'Y-m-d-h-i-s' ) . '.csv'; |
  |  | 276 |  |
  |  | 277 | header( 'Content-Type: text/csv' ); |
  |  | 278 | header( 'Content-Disposition: attachment;filename=' . $filename ); |
  |  | 279 |  |
  |  | 280 | $fp = fopen( 'php://output', 'w' ); |
  |  | 281 |  |
  |  | 282 | fputcsv( $fp, array( 'email', 'insert\_date' ) ); |
  |  | 283 | foreach ( $results as $item ) { |
  |  | 284 | fputcsv( $fp, $item ); |
  |  | 285 | } |
  |  | 286 |  |
  |  | 287 | fclose( $fp ); |
  |  | 288 | } |
  |  | 289 | } |
  |  | 290 |  |
  |  | 291 | /\*\* |
  |  | 292 | \* Shows admin notice on/off |
  |  | 293 | \* |
  |  | 294 | \* @since 1.0 |
  |  | 295 | \* @global $wp\_admin\_bar |
  |  | 296 | \* @return void |
  |  | 297 | \*/ |
  | 266 | 298 | function admin\_bar\_notice() { |
  | 267 |  | global $wp\_admin\_bar; |
  | 268 |  | $value = $this->setting\_options->get\_option( 'mp\_activate','mp\_basics' ); |
  | 269 |  | if( $value == 'on') { |
  | 270 |  | $argsParent=array( |
  | 271 |  | 'id' => 'admin\_bar\_notice', |
  | 272 |  | 'title' => \_\_( 'Maintenance Page On','maintenance-page' ), |
  | 273 |  | 'href' => admin\_url('options-general.php?page=mp\_settings\_api'), |
  | 274 |  | 'meta'   => array( 'class' => 'mode-enable' ), |
  | 275 |  | ); |
  | 276 |  | } else { |
  | 277 |  | // Add Parent Menu |
  | 278 |  | $argsParent=array( |
  | 279 |  | 'id' => 'admin\_bar\_notice', |
  | 280 |  | 'title' => \_\_( 'Maintenance Page Off','maintenance-page' ), |
  | 281 |  | 'href' => admin\_url('options-general.php?page=mp\_settings\_api'), |
  | 282 |  | 'meta'   => array( 'class' => 'mode-disable' ), |
  | 283 |  | ); |
  | 284 |  |  |
  | 285 |  | } |
  | 286 |  | $wp\_admin\_bar->add\_menu( $argsParent ); |
  | 287 |  |  |
  | 288 |  |  |
  | 289 |  | } |
  | 290 |  |  |
  | 291 |  | /\*\* |
  | 292 |  | \* Create subscribe table for new multisite created |
  | 293 |  | \* |
  | 294 |  | \* @since 1.0.7 |
  | 295 |  | \* @return void |
  | 296 |  | \*/ |
  | 297 |  | public function create\_subscribe\_table\_mu( $blog\_id, $user\_id, $domain, $path, $site\_id, $meta ) { |
  | 298 |  | if ( is\_plugin\_active\_for\_network( 'maintenance-page/maintenance-page.php' ) ) { |
  | 299 |  | switch\_to\_blog( $blog\_id ); |
  | 300 |  | Maintenance\_Page\_Activator::create\_subscribe\_table(); |
  | 301 |  | restore\_current\_blog(); |
  | 302 |  | } |
  | 303 |  | } |
  | 304 |  |  |
  | 305 |  | /\*\* |
  | 306 |  | \* Delete subscribe table when multisite blog is deleted |
  | 307 |  | \* |
  | 308 |  | \* @since 1.0.7 |
  | 309 |  | \* @global $wpdb |
  | 310 |  | \* @return void |
  | 311 |  | \*/ |
  | 312 |  | public function delete\_subscribe\_table\_mu( $tables ) { |
  | 313 |  | global $wpdb; |
  | 314 |  | $tables[] = $wpdb->prefix . 'maintenance\_page'; |
  | 315 |  | return $tables; |
  | 316 |  | } |
  | 317 |  |  |
  | 318 |  | } |
  |  | 299 | global $wp\_admin\_bar; |
  |  | 300 | $value = $this->setting\_options->get\_option( 'mp\_activate', 'mp\_basics' ); |
  |  | 301 | if ( $value == 'on' ) { |
  |  | 302 | $argsParent = array( |
  |  | 303 | 'id'    => 'admin\_bar\_notice', |
  |  | 304 | 'title' => \_\_( 'Maintenance Page On', 'maintenance-page' ), |
  |  | 305 | 'href'  => admin\_url( 'options-general.php?page=mp\_settings\_api' ), |
  |  | 306 | 'meta'  => array( 'class' => 'mode-enable' ), |
  |  | 307 | ); |
  |  | 308 | } else { |
  |  | 309 | // Add Parent Menu |
  |  | 310 | $argsParent = array( |
  |  | 311 | 'id'    => 'admin\_bar\_notice', |
  |  | 312 | 'title' => \_\_( 'Maintenance Page Off', 'maintenance-page' ), |
  |  | 313 | 'href'  => admin\_url( 'options-general.php?page=mp\_settings\_api' ), |
  |  | 314 | 'meta'  => array( 'class' => 'mode-disable' ), |
  |  | 315 | ); |
  |  | 316 |  |
  |  | 317 | } |
  |  | 318 | $wp\_admin\_bar->add\_menu( $argsParent ); |
  |  | 319 | } |
  |  | 320 |  |
  |  | 321 | /\*\* |
  |  | 322 | \* Create subscribe table for new multisite created |
  |  | 323 | \* |
  |  | 324 | \* @since 1.0.7 |
  |  | 325 | \* @return void |
  |  | 326 | \*/ |
  |  | 327 | public function create\_subscribe\_table\_mu( $blog\_id, $user\_id, $domain, $path, $site\_id, $meta ) { |
  |  | 328 | if ( is\_plugin\_active\_for\_network( 'maintenance-page/maintenance-page.php' ) ) { |
  |  | 329 | switch\_to\_blog( $blog\_id ); |
  |  | 330 | Maintenance\_Page\_Activator::create\_subscribe\_table(); |
  |  | 331 | restore\_current\_blog(); |
  |  | 332 | } |
  |  | 333 | } |
  |  | 334 |  |
  |  | 335 | /\*\* |
  |  | 336 | \* Delete subscribe table when multisite blog is deleted |
  |  | 337 | \* |
  |  | 338 | \* @since 1.0.7 |
  |  | 339 | \* @global $wpdb |
  |  | 340 | \* @return void |
  |  | 341 | \*/ |
  |  | 342 | public function delete\_subscribe\_table\_mu( $tables ) { |
  |  | 343 | global $wpdb; |
  |  | 344 | $tables[] = $wpdb->prefix . 'maintenance\_page'; |
  |  | 345 | return $tables; |
  |  | 346 | } |
  |  | 347 | } |
  | 319 | 348 | } |
  | 320 | 349 |  |
  | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=1218029#L335) | […](/browser/maintenance-page/trunk/maintenance-page.php?rev=3037664#L364) |  |
  | 335 | 364 | // Get mp Running |
  | 336 | 365 | MP(); |
  | 337 |  | ~~?>~~ |
* ## [maintenance-page/trunk/public/template/maintenance-page-display.php](/changeset/3037664/maintenance-page/trunk/public/template/maintenance-page-display.php?old=1041702&old_path=maintenance-page%2Ftrunk%2Fpublic%2Ftemplate%2Fmaintenance-page-display.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/public/template/maintenance-page-display.php")

  | [r1218033](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L9 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L9 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 9 | 9 | <title> |
  | 10 | 10 | <?php |
  | 11 |  | $title ~~= get\_bloginfo( 'name'~~); |
  |  | 11 | $title            = get\_bloginfo( 'name' ); |
  | 12 | 12 | $site\_description = get\_bloginfo( 'description' ); |
  | 13 |  | if~~( !empty( $site\_description) )~~  { |
  | 14 |  | $title .= ' &#124; '. $site\_description; |
  |  | 13 | if ( ! empty( $site\_description ) ) { |
  |  | 14 | $title .= ' &#124; ' . $site\_description; |
  | 15 | 15 | } |
  | 16 | 16 | echo $title; |
  | 17 | 17 | ?> |
  | 18 | 18 | </title> |
  | 19 |  | <link rel="stylesheet" type="text/css" media="all" href="<?php echo $this->plugin\_url .~~'public/css/style.css'~~ ?>"> |
  | 20 |  | <link rel="stylesheet" href="<?php echo $this->plugin\_url .~~'public/font-awesome/css/font-awesome.min.css'~~ ?>"> |
  |  | 19 | <link rel="stylesheet" type="text/css" media="all" href="<?php echo $this->plugin\_url . 'public/css/style.css'; ?>"> |
  |  | 20 | <link rel="stylesheet" href="<?php echo $this->plugin\_url . 'public/font-awesome/css/font-awesome.min.css'; ?>"> |
  | 21 | 21 | <link href='//fonts.googleapis.com/css?family=Signika+Negative:300,400' rel='stylesheet' type='text/css'> |
  | 22 | 22 |  |
  | 23 | 23 | <?php |
  | 24 |  | wp\_print\_scripts('jquery-core'); |
  | 25 |  | do\_action('mp\_script'); |
  | 26 |  | if( preg\_match('/(?i)msie [1-9]/',$\_SERVER['HTTP\_USER\_AGENT'] ) ) { ?> |
  | 27 |  | <script src="<?php echo $this->plugin\_url .'public/js/html5shiv.js' ?>"></script> |
  | 28 |  | <script src="<?php echo $this->plugin\_url .'public/js/jquery.placeholder.js' ?>"></script> |
  |  | 24 | wp\_print\_scripts( 'jquery-core' ); |
  |  | 25 | do\_action( 'mp\_script' ); |
  |  | 26 | if ( preg\_match( '/(?i)msie [1-9]/', $\_SERVER['HTTP\_USER\_AGENT'] ) ) { |
  |  | 27 | ?> |
  |  | 28 | <script src="<?php echo $this->plugin\_url . 'public/js/html5shiv.js'; ?>"></script> |
  |  | 29 | <script src="<?php echo $this->plugin\_url . 'public/js/jquery.placeholder.js'; ?>"></script> |
  | 29 | 30 | <script> |
  | 30 |  | jQuery(document).ready(function($) { |
  | 31 |  | $('input, textarea').placeholder(); |
  | 32 |  | }); |
  | 33 |  | </script> |
  | 34 |  | <?php } |
  | 35 |  | if( !empty( $\_POST['subscriber\_email']) ) { |
  |  | 31 | jQuery(document).ready(function($) { |
  |  | 32 | $('input, textarea').placeholder(); |
  |  | 33 | }); |
  |  | 34 | </script> |
  |  | 35 | <?php |
  |  | 36 | } |
  |  | 37 | if ( ! empty( $\_POST['subscriber\_email'] ) ) { |
  | 36 | 38 | $file = $this->plugin\_dir . 'includes/lib/subscriber\_handler.php'; |
  | 37 |  | include~~($file)~~; |
  |  | 39 | include $file; |
  | 38 | 40 | } |
  | 39 |  | $background\_image = $option->get\_option( 'mp\_background\_image','mp\_basics',''); |
  | 40 |  | $background\_image\_deactivate = $option->get\_option( 'mp\_background\_image\_deactivate','mp\_basics','off'); ?> |
  |  | 41 | $background\_image            = $option->get\_option( 'mp\_background\_image', 'mp\_basics', '' ); |
  |  | 42 | $background\_image\_deactivate = $option->get\_option( 'mp\_background\_image\_deactivate', 'mp\_basics', 'off' ); |
  |  | 43 | ?> |
  | 41 | 44 | <style type="text/css"> |
  | 42 | 45 | <?php |
  | 43 |  | if( $background\_image\_deactivate == "off" ) { |
  | 44 |  | if( $background\_image ) { ?> |
  |  | 46 | if ( $background\_image\_deactivate == 'off' ) { |
  |  | 47 | if ( $background\_image ) { |
  |  | 48 | ?> |
  | 45 | 49 | body { |
  | 46 | 50 | background: url("<?php echo $background\_image; ?>") no-repeat fixed center; |
  | 47 | 51 | background-size: cover; |
  | 48 | 52 | } |
  | 49 |  | <?php |
  | 50 |  | } else { ?> |
  |  | 53 | <?php |
  |  | 54 | } else { |
  |  | 55 | ?> |
  | 51 | 56 | body { |
  | 52 |  | background: url("<?php echo $this->plugin\_url~~.~~'public/images/background.jpg'; ?>") no-repeat fixed center; |
  |  | 57 | background: url("<?php echo $this->plugin\_url . 'public/images/background.jpg'; ?>") no-repeat fixed center; |
  | 53 | 58 | background-size: cover; |
  | 54 | 59 | } |
  | 55 |  | <?php |
  |  | 60 | <?php |
  | 56 | 61 | } |
  | 57 | 62 | } |
  | 58 |  | if( $option->get\_option( 'mp\_background\_color','mp\_basics') != '#ffffff' ) { ?> |
  |  | 63 | if ( $option->get\_option( 'mp\_background\_color', 'mp\_basics' ) != '#ffffff' ) { |
  |  | 64 | ?> |
  | 59 | 65 | body { |
  | 60 |  | background-color: <?php echo $option->get\_option( 'mp\_background\_color',~~'mp\_basics',''~~); ?>; |
  |  | 66 | background-color: <?php echo $option->get\_option( 'mp\_background\_color', 'mp\_basics', '' ); ?>; |
  | 61 | 67 | } |
  | 62 | 68 | <?php } ?> |
  | 63 |  | <?php if~~( $option->get\_option( 'mp\_font\_color','mp\_basics'~~) != '#ffffff' ) { ?> |
  |  | 69 | <?php if ( $option->get\_option( 'mp\_font\_color', 'mp\_basics' ) != '#ffffff' ) { ?> |
  | 64 | 70 | body { |
  | 65 |  | color: <?php echo $option->get\_option( 'mp\_font\_color',~~'mp\_basics',''~~); ?>; |
  |  | 71 | color: <?php echo $option->get\_option( 'mp\_font\_color', 'mp\_basics', '' ); ?>; |
  | 66 | 72 | } |
  | 67 | 73 | <?php } ?> |
  | 68 |  | <?php if~~( $option->get\_option( 'mp\_link\_color','mp\_basics'~~) != '#1bbc9b' ) { ?> |
  |  | 74 | <?php if ( $option->get\_option( 'mp\_link\_color', 'mp\_basics' ) != '#1bbc9b' ) { ?> |
  | 69 | 75 | a, a:hover, .copyright a:hover,a:visited  { |
  | 70 |  | color: <?php echo $option->get\_option( 'mp\_link\_color',~~'mp\_basics',''~~); ?>; |
  |  | 76 | color: <?php echo $option->get\_option( 'mp\_link\_color', 'mp\_basics', '' ); ?>; |
  | 71 | 77 | } |
  | 72 | 78 | .subscribe-button button{ |
  | 73 |  | background-color: <?php echo $option->get\_option( 'mp\_link\_color',~~'mp\_basics',''~~); ?> |
  |  | 79 | background-color: <?php echo $option->get\_option( 'mp\_link\_color', 'mp\_basics', '' ); ?> |
  | 74 | 80 | } |
  | 75 | 81 | <?php } ?> |
  | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L77) | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L83) |  |
  | 77 | 83 | </style> |
  | 78 | 84 | <?php |
  | 79 |  | if ( $option->get\_option( 'mp\_css','mp\_basics') ) { ?> |
  | 80 |  | <style type="text/css"><?php echo stripslashes( $option->get\_option( 'mp\_css','mp\_basics') );   ?></style> |
  | 81 |  | <?php |
  |  | 85 | if ( $option->get\_option( 'mp\_css', 'mp\_basics' ) ) { |
  |  | 86 | ?> |
  |  | 87 | <style type="text/css"><?php echo stripslashes( $option->get\_option( 'mp\_css', 'mp\_basics' ) ); ?></style> |
  |  | 88 | <?php |
  | 82 | 89 | } |
  | 83 |  | do\_action( 'mp\_head' ); ?> |
  |  | 90 | do\_action( 'mp\_head' ); |
  |  | 91 | ?> |
  | 84 | 92 | </head> |
  | 85 | 93 |  |
  | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L88) | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L96) |  |
  | 88 | 96 | <section id="content"> |
  | 89 | 97 | <?php |
  | 90 |  | $logo = $option->get\_option( 'mp\_logo','mp\_basics',''); |
  | 91 |  | if( !empty( $logo ) ) { ?> |
  |  | 98 | $logo = $option->get\_option( 'mp\_logo', 'mp\_basics', '' ); |
  |  | 99 | if ( ! empty( $logo ) ) { |
  |  | 100 | ?> |
  | 92 | 101 | <div class="logo"> |
  | 93 |  | <img alt="<?php bloginfo( 'name' )?>" src="<?php echo esc\_url( $logo ); ?>"> |
  |  | 102 | <img alt="<?php bloginfo( 'name' ); ?>" src="<?php echo esc\_url( $logo ); ?>"> |
  | 94 | 103 | </div><!-- .logo --> |
  | 95 | 104 | <?php } ?> |
  | 96 | 105 |  |
  | 97 | 106 | <?php |
  | 98 |  | $title = $option->get\_option( 'mp\_heading','mp\_basics','Title'); |
  | 99 |  | if( !empty( $title ) ) { ?> |
  | 100 |  | <h1 class="site-title"><?php echo $title ?></a></h1> |
  |  | 107 | $title = $option->get\_option( 'mp\_heading', 'mp\_basics', 'Title' ); |
  |  | 108 | if ( ! empty( $title ) ) { |
  |  | 109 | ?> |
  |  | 110 | <h1 class="site-title"><?php echo $title; ?></a></h1> |
  | 101 | 111 | <?php } ?> |
  | 102 |  | <?php if~~( $option->get\_option( 'mp\_message',~~'mp\_basics' ) ) { ?> |
  |  | 112 | <?php if ( $option->get\_option( 'mp\_message', 'mp\_basics' ) ) { ?> |
  | 103 | 113 | <div class="construction-msg"> |
  | 104 |  | <p><?php echo do\_shortcode( $option->get\_option( 'mp\_message','mp\_basics' ) ); ?></p> |
  |  | 114 | <p><?php echo do\_shortcode( $option->get\_option( 'mp\_message', 'mp\_basics' ) ); ?></p> |
  | 105 | 115 | </div> |
  | 106 | 116 | <?php } ?> |
  | 107 | 117 | <div class="social-icons clearfix"> |
  | 108 | 118 | <ul> |
  | 109 |  | <?php if~~( $option->get\_option( 'mp\_facebook',~~'mp\_social' ) ) { ?> |
  | 110 |  | <li class="facebook"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_facebook',~~'mp\_social' ) );~~?>"><i class="fa fa-facebook"></i></a></li> |
  |  | 119 | <?php if ( $option->get\_option( 'mp\_facebook', 'mp\_social' ) ) { ?> |
  |  | 120 | <li class="facebook"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_facebook', 'mp\_social' ) ); ?>"><i class="fa fa-facebook"></i></a></li> |
  | 111 | 121 | <?php } ?> |
  | 112 |  | <?php if~~( $option->get\_option( 'mp\_twitter',~~'mp\_social' ) ) { ?> |
  | 113 |  | <li class="twitter"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_twitter','mp\_social' ) ); ?>"><i class="fa fa-twitter"></i></a></li> |
  |  | 122 | <?php if ( $option->get\_option( 'mp\_twitter', 'mp\_social' ) ) { ?> |
  |  | 123 | <li class="twitter"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_twitter', 'mp\_social' ) ); ?>"><i class="fa fa-twitter"></i></a></li> |
  | 114 | 124 | <?php } ?> |
  | 115 |  | <?php if~~( $option->get\_option( 'mp\_pinterest',~~'mp\_social' ) ) { ?> |
  | 116 |  | <li class="google-plus"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_pinterest',~~'mp\_social' ) );~~?>"><i class="fa fa-pinterest"></i></a></li> |
  |  | 125 | <?php if ( $option->get\_option( 'mp\_pinterest', 'mp\_social' ) ) { ?> |
  |  | 126 | <li class="google-plus"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_pinterest', 'mp\_social' ) ); ?>"><i class="fa fa-pinterest"></i></a></li> |
  | 117 | 127 | <?php } ?> |
  | 118 |  | <?php if~~( $option->get\_option( 'mp\_google',~~'mp\_social' ) ) { ?> |
  | 119 |  | <li class="youtube"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_google',~~'mp\_social' ) );~~?>"><i class="fa fa-google-plus"></i></a></li> |
  |  | 128 | <?php if ( $option->get\_option( 'mp\_google', 'mp\_social' ) ) { ?> |
  |  | 129 | <li class="youtube"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_google', 'mp\_social' ) ); ?>"><i class="fa fa-google-plus"></i></a></li> |
  | 120 | 130 | <?php } ?> |
  | 121 |  | <?php if~~( $option->get\_option( 'mp\_youtube',~~'mp\_social' ) ) { ?> |
  | 122 |  | <li class="pinterest"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_youtube',~~'mp\_social' ) );~~?>"><i class="fa fa-youtube"></i></a></li> |
  |  | 131 | <?php if ( $option->get\_option( 'mp\_youtube', 'mp\_social' ) ) { ?> |
  |  | 132 | <li class="pinterest"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_youtube', 'mp\_social' ) ); ?>"><i class="fa fa-youtube"></i></a></li> |
  | 123 | 133 | <?php } ?> |
  | 124 |  | <?php if~~( $option->get\_option( 'mp\_linkedin',~~'mp\_social' ) ) { ?> |
  | 125 |  | <li class="linkedin"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_linkedin',~~'mp\_social' ) );~~?>"><i class="fa fa-linkedin"></i></a></li> |
  |  | 134 | <?php if ( $option->get\_option( 'mp\_linkedin', 'mp\_social' ) ) { ?> |
  |  | 135 | <li class="linkedin"><a href="<?php echo esc\_url( $option->get\_option( 'mp\_linkedin', 'mp\_social' ) ); ?>"><i class="fa fa-linkedin"></i></a></li> |
  | 126 | 136 | <?php } ?> |
  | 127 | 137 | </ul> |
  | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L129) | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L139) |  |
  | 129 | 139 | </section> |
  | 130 | 140 |  |
  | 131 |  | <?php if~~( $option->get\_option( 'mp\_subscribe\_activate',~~'mp\_subscribe' ) == 'on' ) { ?> |
  |  | 141 | <?php if ( $option->get\_option( 'mp\_subscribe\_activate', 'mp\_subscribe' ) == 'on' ) { ?> |
  | 132 | 142 | <section id="newsletter"> |
  | 133 | 143 | <div class="wrapper clearfix"> |
  | 134 | 144 | <div class="mp-one-half"> |
  | 135 | 145 | <div class="newsletter-content"> |
  | 136 |  | <?php if~~( $option->get\_option( 'mp\_subscribe\_title',~~'mp\_subscribe' ) ) { ?> |
  | 137 |  | <h2 class="entry-title"><?php echo $option->get\_option( 'mp\_subscribe\_title','mp\_subscribe' ); ?></h2> |
  |  | 146 | <?php if ( $option->get\_option( 'mp\_subscribe\_title', 'mp\_subscribe' ) ) { ?> |
  |  | 147 | <h2 class="entry-title"><?php echo $option->get\_option( 'mp\_subscribe\_title', 'mp\_subscribe' ); ?></h2> |
  | 138 | 148 | <?php } ?> |
  | 139 |  | <?php if~~( $option->get\_option( 'mp\_subscribe\_message',~~'mp\_subscribe' ) ) { ?> |
  | 140 |  | <p><?php echo do\_shortcode( $option->get\_option( 'mp\_subscribe\_message','mp\_subscribe' ) ); ?></p> |
  |  | 149 | <?php if ( $option->get\_option( 'mp\_subscribe\_message', 'mp\_subscribe' ) ) { ?> |
  |  | 150 | <p><?php echo do\_shortcode( $option->get\_option( 'mp\_subscribe\_message', 'mp\_subscribe' ) ); ?></p> |
  | 141 | 151 | <?php } ?> |
  | 142 | 152 | </div> |
  | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L146) | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L156) |  |
  | 146 | 156 | <div class="sign-up"> |
  | 147 | 157 | <div class="email-field"> |
  | 148 |  | <input type="text" placeholder="<?php \_e(~~'Enter email to subscribe', 'maintenance-page');~~?>" class="inputsubs" name="subscriber\_email" > |
  |  | 158 | <input type="text" placeholder="<?php \_e( 'Enter email to subscribe', 'maintenance-page' ); ?>" class="inputsubs" name="subscriber\_email" > |
  | 149 | 159 | </div> |
  | 150 | 160 | <div class="subscribe-button"> |
  | 151 |  | <button type="submit" value="submit"><?php \_e(~~'Subscribe', 'maintenance-page')~~?></button> |
  |  | 161 | <button type="submit" value="submit"><?php \_e( 'Subscribe', 'maintenance-page' ); ?></button> |
  | 152 | 162 | </div> |
  | 153 | 163 | </div> |
  | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=1041702#L159) | […](/browser/maintenance-page/trunk/public/template/maintenance-page-display.php?rev=3037664#L169) |  |
  | 159 | 169 |  |
  | 160 | 170 | <footer id="colophon" class="site-footer"> |
  | 161 |  | <?php $footer\_text = sprintf( \_\_( 'Copyright &copy; <a href="%1$s">%2$s </a>', 'maintenance-page' ), esc\_url( home\_url() ), get\_bloginfo( 'name' ) ); |
  | 162 |  | if( $option->get\_option( 'mp\_footer\_radio','mp\_basics') == 'yes' ) { |
  |  | 171 | <?php |
  |  | 172 | $footer\_text = sprintf( \_\_( 'Copyright &copy; <a href="%1$s">%2$s </a>', 'maintenance-page' ), esc\_url( home\_url() ), get\_bloginfo( 'name' ) ); |
  |  | 173 | if ( $option->get\_option( 'mp\_footer\_radio', 'mp\_basics' ) == 'yes' ) { |
  | 163 | 174 | $footer\_text .= sprintf( \_\_( 'Powered by <a href="%s">ThemeGrill</a>', 'maintenance-page' ), esc\_url( 'http://themegrill.com' ) ); |
  | 164 |  | } ?> |
  |  | 175 | } |
  |  | 176 | ?> |
  | 165 | 177 | <div class="copyright"><?php echo $footer\_text; ?></div> |
  | 166 | 178 | </footer> |
* ## [maintenance-page/trunk/readme.txt](/changeset/3037664/maintenance-page/trunk/readme.txt?old=1218033&old_path=maintenance-page%2Ftrunk%2Freadme.txt "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/readme.txt")

  | [r1218033](/browser/maintenance-page/trunk/readme.txt?rev=1218033#L6 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/readme.txt?rev=3037664#L6 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | Tags: maintenance page, under construction, coming soon, coming soon page, maintenance, maintenace mode, landing page, launch, launch page, splash page, offline, site offline, unavailable, administrator, subscribe, construction |
  | 7 | 7 | Requires at least: 3.4 |
  | 8 |  | Tested up to: ~~4.3~~ |
  | 9 |  | Stable tag: 1.0.~~8~~ |
  |  | 8 | Tested up to: 6.4 |
  |  | 9 | Stable tag: 1.0.9 |
  | 10 | 10 | License: GPLv2 or later |
  | 11 | 11 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/maintenance-page/trunk/readme.txt?rev=1218033#L74) | […](/browser/maintenance-page/trunk/readme.txt?rev=3037664#L74) |  |
  | 74 | 74 |  |
  | 75 | 75 | == Changelog == |
  |  | 76 | = 1.0.9 = |
  |  | 77 | \* General security measures and enhancements. |
  |  | 78 | \* Updated WordPress tested upto version to 6.4. |
  |  | 79 |  |
  | 76 | 80 | = 1.0.8 = |
  | 77 | 81 | \* Administrator added with unfiltered html capabilty for wp\_editor in plugin options. |
* ## [maintenance-page/trunk/uninstall.php](/changeset/3037664/maintenance-page/trunk/uninstall.php?old=1202134&old_path=maintenance-page%2Ftrunk%2Funinstall.php "Show the [1218033:3037664] differences restricted to maintenance-page/trunk/uninstall.php")

  | [r1218033](/browser/maintenance-page/trunk/uninstall.php?rev=1202134#L12 "Show revision 1218033 of this file in browser") | [r3037664](/browser/maintenance-page/trunk/uninstall.php?rev=3037664#L12 "Show revision 3037664 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | // If uninstall not called from WordPress, then exit. |
  | 13 | 13 | if ( ! defined( 'WP\_UNINSTALL\_PLUGIN' ) ) { |
  | 14 |  | exit; |
  |  | 14 | exit; |
  | 15 | 15 | } |
  | 16 | 16 |  |
  | 17 |  | if (function\_exists( 'is\_multisite' ) && is\_multisite() ) { |
  | 18 |  | global $wpdb; |
  |  | 17 | if ( function\_exists( 'is\_multisite' ) && is\_multisite() ) { |
  |  | 18 | global $wpdb; |
  | 19 | 19 |  |
  | 20 |  | ~~$old\_blog =~~  $wpdb->blogid; |
  | 21 |  | //Get all blog ids |
  | 22 |  | ~~$blogids =~~  $wpdb->get\_col( "SELECT blog\_id FROM $wpdb->blogs" ); |
  |  | 20 | $old\_blog = $wpdb->blogid; |
  |  | 21 | //Get all blog ids |
  |  | 22 | $blogids = $wpdb->get\_col( "SELECT blog\_id FROM $wpdb->blogs" ); |
  | 23 | 23 |  |
  | 24 |  | foreach ( $blogids as $blog\_id ) { |
  | 25 |  | ~~switch\_to\_blog($blog\_id~~); |
  | 26 |  | maintenance\_page\_delete\_table(); |
  | 27 |  | } |
  | 28 |  | switch\_to\_blog( $old\_blog ); |
  |  | 24 | foreach ( $blogids as $blog\_id ) { |
  |  | 25 | switch\_to\_blog( $blog\_id ); |
  |  | 26 | maintenance\_page\_delete\_table(); |
  |  | 27 | } |
  |  | 28 | switch\_to\_blog( $old\_blog ); |
  | 29 | 29 | } else { |
  | 30 |  | maintenance\_page\_delete\_table(); |
  |  | 30 | maintenance\_page\_delete\_table(); |
  | 31 | 31 | } |
  | 32 | 32 |  |
  | […](/browser/maintenance-page/trunk/uninstall.php?rev=1202134#L38) | […](/browser/maintenance-page/trunk/uninstall.php?rev=3037664#L38) |  |
  | 38 | 38 | \* @return void |
  | 39 | 39 | \*/ |
  | 40 |  | function maintenance\_page\_delete\_table(){ |
  | 41 |  | global $wpdb; |
  |  | 40 | function maintenance\_page\_delete\_table() { |
  |  | 41 | global $wpdb; |
  | 42 | 42 |  |
  | 43 |  | $wpdb->query( "DROP TABLE IF EXISTS {$wpdb->prefix}maintenance\_page" ); |
  |  | 43 | $wpdb->query( "DROP TABLE IF EXISTS {$wpdb->prefix}maintenance\_page" ); |
  | 44 | 44 |  |
  | 45 |  | /\*\* Delete all the Plugin Options \*/ |
  | 46 |  | delete\_option( 'mp\_basics' ); |
  | 47 |  | delete\_option( 'mp\_social' ); |
  | 48 |  | delete\_option( 'mp\_subscribe' ); |
  |  | 45 | /\*\* Delete all the Plugin Options \*/ |
  |  | 46 | delete\_option( 'mp\_basics' ); |
  |  | 47 | delete\_option( 'mp\_social' ); |
  |  | 48 | delete\_option( 'mp\_subscribe' ); |
  | 49 | 49 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3037664&old=1218033&new_path=%2Fmaintenance-page%2Ftrunk&old_path=%2Fmaintenance-page%2Ftrunk)
* [Zip Archive](?format=zip&new=3037664&old=1218033&new_path=%2Fmaintenance-page%2Ftrunk&old_path=%2Fmaintenance-page%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

