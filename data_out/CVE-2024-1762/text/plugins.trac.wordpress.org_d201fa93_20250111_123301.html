

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fsocial-networks-auto-poster-facebook-twitter-g%2Ftrunk%2Finc%2Fnxs_functions_engine.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php?rev=3084635 "Revision 3084635")
* Next Revision →
* [Blame](/browser/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php)

---

# [source:](/browser?order=name "Go to repository root") [social-networks-auto-poster-facebook-twitter-g](/browser/social-networks-auto-poster-facebook-twitter-g?order=name "View social-networks-auto-poster-facebook-twitter-g")/[trunk](/browser/social-networks-auto-poster-facebook-twitter-g/trunk?order=name "View trunk")/[inc](/browser/social-networks-auto-poster-facebook-twitter-g/trunk/inc?order=name "View inc")/[nxs\_functions\_engine.php](/browser/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php?order=name "View nxs_functions_engine.php")

View diff against:

View revision:

| [Last change](/changeset/3095795/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php "View differences") on this file was [3095795](/changeset/3095795/ "View changeset 3095795"), checked in by NextScripts, [7 months ago](/timeline?from=2024-05-31T17%3A39%3A29Z&precision=second "See timeline at 05/31/2024 05:39:29 PM") |
| --- |
| Version 4.4.5 |
| **File size:** 29.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | //## Main Function to Post |
| [3](#L3) | if (!function\_exists("nxs\_snapPublishTo")) { function nxs\_snapPublishTo($postIDorObj, $aj=false) {  global $nxs\_SNAP, $nxs\_snapAvNts, $blog\_id, $nxs\_tpWMPU; $uid=0; |
| [4](#L4) | if (!isset($nxs\_SNAP)) return; |
| [5](#L5) | if (!empty($\_POST['nxs\_snapPostOptions'])) { $NXS\_POSTX = $\_POST['nxs\_snapPostOptions'];  $NXS\_POST = array(); $NXS\_POST = NXS\_parseQueryStr($NXS\_POSTX); } else $NXS\_POST = $\_POST; |
| [6](#L6) | if(is\_object($postIDorObj)) { $postObj = $postIDorObj; $postID = $postObj->ID; } else { $postID = $postIDorObj; $postObj = get\_post($postID); } unset($postIDorObj); $isPost = isset($NXS\_POST["snapEdIT"]); |
| [7](#L7) |  |
| [8](#L8) |  |
| [9](#L9) | global $wp; |
| [10](#L10) | if (stripos($wp->request,'wp-json/wp/v2/posts/')!==false) {  $tp = get\_option('\_nxs\_tp'); if (empty($tp)) $tp = array(); $tp[] = $postID; update\_option( '\_nxs\_tp', $tp, false ); |
| [11](#L11) | nxs\_LogIt('I', 'Guttenberg', '','', 'Pending Autopost from Guttenberg.', 'Waiting for Metadata ('.print\_r($tp, true).') - Post ID:('.$postID.') - Current Post status - '.$postObj->post\_status, 'snap', $uid ); return; |
| [12](#L12) | } |
| [13](#L13) |  |
| [14](#L14) | $postUser = $postObj->post\_author; $isItUserWhoCan = (!user\_can($postUser, 'manage\_options' ) && user\_can($postUser, 'haveown\_snap\_accss')); //if ($isItUserWhoCan) $uid = $postUser; |
| [15](#L15) | if ($isItUserWhoCan) { $nxs\_SNAP = new nxs\_SNAP($postUser); $networks = $nxs\_SNAP->nxs\_acctsU; $uid = $postUser; global $nxs\_uid; $nxs\_uid = $uid; } else { $networks = $nxs\_SNAP->nxs\_accts; } |
| [16](#L16) |  |
| [17](#L17) | $options = $nxs\_SNAP->nxs\_options; if (empty($options)) return; |
| [18](#L18) | if ($postObj->post\_status != 'publish') { sleep(5);  $postObj = get\_post($postID); |
| [19](#L19) | if ($postObj->post\_status != 'publish') {  nxs\_LogIt('I', 'Cancelled', '','', 'Autopost Cancelled', 'Post is not "Published" Right now - Post ID:('.$postID.') - Current Post status -'.$postObj->post\_status, 'snap', $uid ); return; } |
| [20](#L20) | } |
| [21](#L21) | //## User Security (&& MU) |
| [22](#L22) | if ($isPost && empty($options['skipSecurity']) && !current\_user\_can("make\_snap\_posts") && !current\_user\_can("haveown\_snap\_accss") && !current\_user\_can("manage\_options")) { nxs\_LogIt('I', 'Skipped', '','', 'Current user can\'t autopost - Post ID:('.$postID.')','','snap',$uid ); return; } |
| [23](#L23) | if (empty($options['skipSecurity']) && !user\_can( $postUser, "make\_snap\_posts" ) && !user\_can( $postUser, "haveown\_snap\_accss" ) && !user\_can( $postUser, "manage\_options")){ nxs\_LogIt('I', 'Skipped', '', '', 'User ID '.$postUser.' can\'t autopost (please see <a target="\_blank" href="https://www.nextscripts.com/support-faq/#a17">FAQ #1.7</a> for more info/solution)  - Post ID:('.$postID.')','','snap',$uid ); return; } |
| [24](#L24) | //## Post |
| [25](#L25) | if ($isPost) $nxs\_SNAP->NS\_SNAP\_SavePostMetaTags($postID); |
| [26](#L26) |  |
| [27](#L27) | if (!isset($options['nxsHTDP']) || $options['nxsHTDP']=='S') { if(isset($NXS\_POST["snapEdIT"]) && $NXS\_POST["snapEdIT"]=='1') { $publtype='S'; $delay = rand(2,10); } else $publtype='A'; |
| [28](#L28) | if (!$aj && !empty($options['quLimit']) && $options['quLimit']=='1') { global $wpdb; //## Add to posting query |
| [29](#L29) | $table\_name = $wpdb->prefix . "nxs\_query"; |
| [30](#L30) | $sql = $wpdb->prepare( |
| [31](#L31) | "SELECT timetorun FROM $table\_name WHERE type = %s ORDER BY timetorun DESC LIMIT 1", |
| [32](#L32) | 'Q' |
| [33](#L33) | ); |
| [34](#L34) | $quNxTime = $wpdb->get\_var($sql); |
| [35](#L35) | if (empty($quNxTime)) $quNxTime = time()+5; $quNxTime=strtotime($quNxTime); |
| [36](#L36) | $rndSec=$options['quLimitRndMins']\*60; $pstEvrySec=$options['quDays']\*86400+$options['quHrs']\*3600+$options['quMins']\*60; $rndTime=rand(0-$rndSec, $rndSec); $quNxTime=$quNxTime + $pstEvrySec + $rndTime; |
| [37](#L37) | $dbItem = array('datecreated'=>date\_i18n('Y-m-d H:i:s'), 'type'=>'Q', 'postid'=>$postID, 'timetorun'=> date\_i18n('Y-m-d H:i:s', $quNxTime), 'descr'=> 'Post ID:('.$postID.')', 'uid'=>$postUser); |
| [38](#L38) | $nxDB = $wpdb->insert( $wpdb->prefix . "nxs\_query", $dbItem );  $lid = $wpdb->insert\_id; nxs\_recountQueryTimes(); nxs\_LogIt('I', 'Queried', '','', $lid.'| Post ID:('.$postID.')','','snap',$uid ); |
| [39](#L39) | return; |
| [40](#L40) | } |
| [41](#L41) | } else $publtype = 'I'; |
| [42](#L42) |  |
| [43](#L43) | //## Apply Global Filters (At the time of publishing) |
| [44](#L44) | $rMsg = nxs\_snapCheckFilters($options, $postObj); if ($rMsg!==false) { nxs\_LogIt('I', 'Skipped', '','', 'Filter(Global) - Excluded - Post ID:('.$postID.')',$rMsg,'snap',$uid ); return; } |
| [45](#L45) |  |
| [46](#L46) | nxs\_LogIt('BG', 'Start =- ', '','', '------=========#### NEW AUTO-POST REQUEST ####=========------', ($blog\_id>1?'BlogID:'.$blog\_id:'').' PostID:('.$postID.') '.($publtype=='S'?'Scheduled +'.$delay:($publtype=='A'?'Automated':'Immediate')),'snap',$uid); |
| [47](#L47) |  |
| [48](#L48) | $snap\_isAutoPosted = get\_post\_meta($postID, 'snap\_isAutoPosted', true); if (!empty($snap\_isAutoPosted)) { $snap\_isAutoPosted = ($snap\_isAutoPosted>1)?'(on '.date\_i18n('Y-m-d H:i:s',$snap\_isAutoPosted).')':''; |
| [49](#L49) | nxs\_LogIt('W', 'Skipped', '','', 'Already Autoposted ', $snap\_isAutoPosted.' - Post ID:('.$postID.')' ,'snap',$uid); return; |
| [50](#L50) | } $snap\_isEdIT = get\_post\_meta($postID, 'snapEdIT', true);     //     var\_dump($snap\_isEdIT); |
| [51](#L51) |  |
| [52](#L52) | if (function\_exists('nxs\_v4doSMAS2')) { nxs\_v4doSMAS2($postObj, $NXS\_POST, $publtype,$aj); return; } else { #################################### !!!!!!!!!!!!!!!!!!!!!!!!!!! |
| [53](#L53) |  |
| [54](#L54) | foreach ($nxs\_snapAvNts as $avNt) { |
| [55](#L55) | if (!empty($networks[$avNt['lcode']]) && count($networks[$avNt['lcode']])>0) { $clName = 'nxs\_snapClass'.$avNt['code']; $ntClInst = new $clName(); $publTempType = ''; |
| [56](#L56) | if ($isPost && isset($NXS\_POST[$avNt['lcode']])) $po = $NXS\_POST[$avNt['lcode']]; else { $po =  get\_post\_meta($postID, 'snap'.$avNt['code'], true); $po =  maybe\_unserialize($po);} |
| [57](#L57) | if (isset($po) && is\_array($po)) $isPostMeta = true; else { $isPostMeta = false; $po = $networks[$avNt['lcode']]; update\_post\_meta($postID, 'snap'.$avNt['code'], $po); } // prr($po); |
| [58](#L58) | delete\_post\_meta($postID, 'snap\_isAutoPosted'); add\_post\_meta($postID, 'snap\_isAutoPosted', time()); |
| [59](#L59) | $optMt = $networks[$avNt['lcode']][0]; if ($isPostMeta) $optMt = $ntClInst->adjMetaOpt($optMt, $po[0]); if (!$ntClInst->checkIfSetupFinished($optMt)) continue;  //prr($optMt); |
| [60](#L60) | if ($optMt['do']=='2') { $rMsg = nxs\_snapCheckFilters($optMt, $postObj); if ($rMsg!==false) { nxs\_LogIt('I', 'Skipped', $avNt['name'].' ('.$optMt['nName'].')','', 'Filter(Network) - Excluded - Post ID:('.$postID.')',$rMsg, 'snap', $uid ); continue; } else $optMt['do'] = 1;} |
| [61](#L61) | if ($optMt['do']=='1') { $optMt['ii'] = 0; |
| [62](#L62) | if ($publtype=='A' && ($optMt['nMin']>0 || $optMt['nHrs']>0 || !empty($optMt['nTime']))) $publTempType='S'; |
| [63](#L63) | if ($publtype=='S' || $publTempType=='S') { $publTempType = ''; if (isset($optMt['nHrs']) && isset($optMt['nMin']) && ($optMt['nHrs']>0 || $optMt['nMin']>0) ) { $delay = $optMt['nMin']\*60+$optMt['nHrs']\*3600; |
| [64](#L64) | nxs\_LogIt('I', 'Delayed', $avNt['name'].' ('.$optMt['nName'].')', '','Post has been delayed',' for '.$delay.' Seconds ('.($optMt['nHrs']>0?$optMt['nHrs'].' Hours':'')." ".($optMt['nMin']>0?$optMt['nMin'].' Minutes':'').')','snap',$uid ); |
| [65](#L65) | } else $delay = rand(2,10); |
| [66](#L66) | $optMt['timeToRun'] = time() + ( get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS )+$delay;  global $wpdb; |
| [67](#L67) | $dbItem = array('datecreated'=>date\_i18n('Y-m-d H:i:s'), 'type'=>'S', 'postid'=>$postID, 'nttype'=>$avNt['code'], 'refid'=>$optMt['ii'], 'timetorun'=> date\_i18n('Y-m-d H:i:s', $optMt['timeToRun']), 'extInfo'=>serialize($optMt), 'descr'=> (!empty($optMt['nName'])?'('.$avNt['code'].' - '.$optMt['nName'].') ':'').'Post ID:('.$postID.')', 'uid'=>$postUser); |
| [68](#L68) | $nxDB = $wpdb->insert( $wpdb->prefix . "nxs\_query", $dbItem );  $lid = $wpdb->insert\_id; |
| [69](#L69) | nxs\_LogIt('BI', 'Scheduled', $avNt['name'].' ('.$optMt['nName'].')','','Scheduled for '.date\_i18n('Y-m-d H:i:s', $optMt['timeToRun']).")", ' PostID:('.$postID.')','snap',$uid ); |
| [70](#L70) | } else { $ntClInst->nt[0] = $optMt; $ntClInst->publishWP(0, $postID); } |
| [71](#L71) | } else { nxs\_LogIt('GR', 'Skipped', $avNt['name'].' ('.$optMt['nName'].')','', '-=[Unchecked Account]=-', 'PostID: '.$postID,'snap',$uid ); } |
| [72](#L72) | } |
| [73](#L73) | } |
| [74](#L74) | } |
| [75](#L75) | if (isset($isS) && $isS) restore\_current\_blog(); |
| [76](#L76) | }} |
| [77](#L77) | if (!function\_exists("nxs\_noSing")) { function nxs\_noSing( &$obj ) { $obj->is\_singular = false; $obj->is\_single = false; return $obj; }} |
| [78](#L78) |  |
| [79](#L79) | //## Functions |
| [80](#L80) | if (!function\_exists('nxs\_getFromGlobalOpt')){ function nxs\_getFromGlobalOpt($optName) { global $nxs\_SNAP; |
| [81](#L81) | if (!isset($nxs\_SNAP)) { if (class\_exists('nxs\_SNAP')) $nxs\_SNAP = new nxs\_SNAP(); else return ''; } $gOptions = $nxs\_SNAP->nxs\_options;  if (!empty($gOptions[$optName])) return $gOptions[$optName]; else return ''; |
| [82](#L82) | }} |
| [83](#L83) |  |
| [84](#L84) | //## ===================== Cron/Query/Reposter Engine |
| [85](#L85) |  |
| [86](#L86) | //## Recount Query/Timeline |
| [87](#L87) | if (!function\_exists("nxs\_recountQueryTimes")) { function nxs\_recountQueryTimes($force=false){ global $wpdb, $nxs\_SNAP; if (!isset($nxs\_SNAP)) return; $options = $nxs\_SNAP->nxs\_options; $currTime = nxs\_getCurrTime(); |
| [88](#L88) | $sql = $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}nxs\_query WHERE type = %s ORDER BY timetorun ASC",'Q' ); |
| [89](#L89) | $quPosts = $wpdb->get\_results($sql, ARRAY\_A);  // var\_dump($quPosts);   prr($quPosts); |
| [90](#L90) | if (count($quPosts)>0) { $pstEvrySec = $options['quDays']\*86400+$options['quHrs']\*3600+$options['quMins']\*60; $rndSec = $options['quLimitRndMins']\*60; $ttr = time(); //$ttr = strtotime('2050-10-15 10:10:10'); |
| [91](#L91) | //$ttr = $quPosts[0]['timetorun']; $quNxTime = ($ttr>'2050-10-15 10:10:00')?(time()+(get\_option('gmt\_offset')\*HOUR\_IN\_SECONDS)):strtotime($ttr); //## ????? why did I do that row? |
| [92](#L92) | $quNxTime = $ttr+(get\_option('gmt\_offset')\*HOUR\_IN\_SECONDS)+$pstEvrySec; |
| [93](#L93) | foreach ($quPosts as $row){ $id = $row['id']; |
| [94](#L94) | if (!empty($row['postid'])) { $post = get\_post($row['postid']); if (empty($post)) { $wpdb->delete($wpdb->prefix."nxs\_query", array('id' => $id)); continue; } } |
| [95](#L95) | $quNxTimeTxt = date\_i18n('Y-m-d H:i:s', $quNxTime); $wpdb->update($wpdb->prefix."nxs\_query", array('timetorun' => $quNxTimeTxt), array('id' => $id));  //prr($quNxTimeTxt); |
| [96](#L96) | $rndTime = rand(0-$rndSec, $rndSec); $quNxTime = $quNxTime + $pstEvrySec + $rndTime; |
| [97](#L97) | } |
| [98](#L98) | } $sql = $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}nxs\_query WHERE type = %s ORDER BY timetorun ASC", 'R' ); |
| [99](#L99) | $quPosts = $wpdb->get\_results($sql, ARRAY\_A); // prr($quPosts, 'KKKKKKKKKKKKKKKKKKKK');  // var\_dump($quPosts); |
| [100](#L100) | if (count($quPosts)>0) foreach ($quPosts as $row){ $id = $row['id'];  if ($force || $row['timetorun'] > date\_i18n('Y-m-d H:i:s', $currTime-600)) { |
| [101](#L101) | $rpstrOpts = maybe\_unserialize(get\_post\_meta( $id, 'nxs\_rpstr', true )); |
| [102](#L102) | if (!empty($rpstrOpts) && is\_array($rpstrOpts)) { $rpstrOpts['rpstNxTime'] = nxs\_getNextPostTime( $rpstrOpts['rpstDays'], $rpstrOpts['rpstHrs'], $rpstrOpts['rpstMins'],$rpstrOpts['rpstRndMins']); |
| [103](#L103) | $dbItem = array('timetorun'=> date\_i18n('Y-m-d H:i:s',$rpstrOpts['rpstNxTime']));  $whItem = array('id'=>$id); $wpdb->update( $wpdb->prefix . "nxs\_query", $dbItem, $whItem); |
| [104](#L104) | nxs\_Filters::save\_meta($id, 'nxs\_rpstr', $rpstrOpts ); |
| [105](#L105) | } |
| [106](#L106) | }} |
| [107](#L107) | }} |
| [108](#L108) |  |
| [109](#L109) | if (!function\_exists("nxs\_pushPostToNT")){function nxs\_pushPostToNT($ntCode, $ii, $postID, $type='a'){ $postObj = get\_post($postID); $nt = strtolower($ntCode); $ntU = strtoupper($ntCode); |
| [110](#L110) | $postUser = $postObj->post\_author; $isItUserWhoCan = (!user\_can($postUser, 'manage\_options' ) && user\_can($postUser, 'haveown\_snap\_accss')); //if ($isItUserWhoCan) $uid = $postUser; |
| [111](#L111) | if ($isItUserWhoCan) { $nxs\_SNAP = new nxs\_SNAP($postUser); $networks = $nxs\_SNAP->nxs\_acctsU; $uid = $postUser; global $nxs\_uid; $nxs\_uid = $uid; } else { global $nxs\_SNAP; if (!isset($nxs\_SNAP)) return; $networks = $nxs\_SNAP->nxs\_accts; } |
| [112](#L112) | $optNt = maybe\_unserialize(get\_post\_meta($postID, 'snap'.$ntU, true)); |
| [113](#L113) | $clName = 'nxs\_snapClass'.$ntU; if (class\_exists($clName)) { $cl = new $clName(); |
| [114](#L114) | if (empty($optNt) || !is\_array($optNt)) $optNt = $networks[$nt][$ii]; else $optNt = $cl->adjMetaOpt($networks[$nt][$ii],$optNt[$ii]); |
| [115](#L115) | $optNt['pType'] = 'aj';$cl->nt[$ii] = $optNt; if ($type=='r') $cl->isRepost=true; return $cl->publishWP($ii, $postID); |
| [116](#L116) | } |
| [117](#L117) | }} |
| [118](#L118) |  |
| [119](#L119) | if (!function\_exists("nxs\_getCurrTime")){ function nxs\_getCurrTime(){ $tm = microtime(); $tma = explode(' ',$tm); $tmCorr = (function\_exists('get\_option'))?get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS :0; $tm = number\_format((float)$tma[0]+(float)$tma[1], 8, '.', ''); return $tm+$tmCorr; }} |
| [120](#L120) | if (!function\_exists("nxs\_getNextPostTime")){ function nxs\_getNextPostTime($d,$h,$m,$r=0){ $currTime = nxs\_getCurrTime(); $sec = $d\*86400+$h\*3600+$m\*60; $rndSecs = isset($r)?$r\*60:0; $rndTime = rand(0-$rndSecs, $rndSecs); return $currTime + $sec + $rndTime; }} |
| [121](#L121) |  |
| [122](#L122) | //## New Scheduled Engine Functions |
| [123](#L123) | //## Main Cron Engine Function. |
| [124](#L124) | if (!function\_exists("nxs\_checkQuery")){ function nxs\_checkQuery(){ set\_time\_limit(0); $arrOut = array(); nxs\_cron\_check(); |
| [125](#L125) | if (empty($\_SERVER["HTTP\_USER\_AGENT"])) $\_SERVER["HTTP\_USER\_AGENT"] = '?'; $tmCorr = get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS ;  $isDebug = current\_user\_can('administrator') && !empty($\_GET['dbg']);  //$isDebug = true; |
| [126](#L126) | $tm = microtime(); $tma = explode(' ',$tm); $tm = number\_format((float)$tma[0]+(float)$tma[1], 8, '.', ''); $currTime = $tm+$tmCorr;  $tmL = get\_option('nxs\_last\_nxs\_cron'); update\_option('nxs\_last\_nxs\_cron', $tm, false); $tmL2=$tmL+19; $tmL3=$tmL+600; |
| [127](#L127) | //## Log Cron Request |
| [128](#L128) | if (isset($\_GET['nxs-cronrun'])) { $\_GET['nxs-cronrun'] = sanitize\_text\_field($\_GET['nxs-cronrun']); $contCron = get\_option('nxs\_contCron'); if ($isDebug) echo wp\_kses($\_GET['nxs-cronrun'],'('.$contCron.')', wp\_kses\_allowed\_html( 'post' )); //## Manual/Forced cron request. |
| [129](#L129) | nxs\_addToLogN('L','NXS Cron Request (Forced)','',number\_format(($tm-$tmL), 2,'.','').'s after the previous one. ', 'CNT: '.$\_GET['nxs-cronrun'].'('.$contCron.')'); |
| [130](#L130) | } else { //## Cron request from WP itself |
| [131](#L131) | if ($tm<$tmL2) { nxs\_addToLogN('W', '\*\*WARNING. Unhealthy Cron Request\*\*', ' [<a target="\_blank" href="https://nxs.fyi/uhcr">More info</a>] ', 'Too close ('.number\_format(($tm-$tmL), 2,'.','').'s) to the previous one. ', 'Now - '.date\_i18n('H:i:s',$currTime).' | Previous - '.date\_i18n('H:i:s',$tmL+$tmCorr).  '| Cron called from '.(!empty($\_SERVER["REMOTE\_ADDR"])?$\_SERVER["REMOTE\_ADDR"]:'Unknown IP').' ('.nsTrnc((!empty($\_SERVER["HTTP\_USER\_AGENT"])?esc\_html(strip\_tags($\_SERVER["HTTP\_USER\_AGENT"])):'Unknown UA'), 70).')', 'cron');  /\* return; \*/ } |
| [132](#L132) | elseif ($tm>$tmL3) { nxs\_addToLogN('W', '\*\*WARNING. Unhealthy Cron Request\*\*', ' [<a target="\_blank" href="https://nxs.fyi/uhcr">More info</a>] ', 'Too far ('.number\_format(($tm-$tmL), 2,'.','').'s) from the previous one. ', 'Now - '.date\_i18n('H:i:s',$currTime).' | Previous - '.date\_i18n('H:i:s',$tmL+$tmCorr).  '| Cron called from '.(!empty($\_SERVER["REMOTE\_ADDR"])?$\_SERVER["REMOTE\_ADDR"]:'Unknown IP').' ('.nsTrnc((!empty($\_SERVER["HTTP\_USER\_AGENT"])?esc\_html(strip\_tags($\_SERVER["HTTP\_USER\_AGENT"])):'Unknown UA'), 70).')', 'cron');  /\* return; \*/ } |
| [133](#L133) | else nxs\_addToLogN('L','Cron Request','',number\_format(($tm-$tmL), 2,'.','').'s after the previous one. ', '| Cron called from '.(!empty($\_SERVER["REMOTE\_ADDR"])?$\_SERVER["REMOTE\_ADDR"]:'Unknown IP').' ('.nsTrnc((!empty($\_SERVER["HTTP\_USER\_AGENT"])?esc\_html(strip\_tags($\_SERVER["HTTP\_USER\_AGENT"])):'Unknown UA'), 70).')', 'cron'); |
| [134](#L134) | } |
| [135](#L135) |  |
| [136](#L136) | global $nxs\_SNAP; if (!isset($nxs\_SNAP)) return; $options = $nxs\_SNAP->nxs\_options; if (empty($options['numOfTasks']) || !is\_int($options['numOfTasks']) || $options['numOfTasks']<10) $options['numOfTasks'] = 30; |
| [137](#L137) | if (!empty($options['riActive']) && $options['riActive']=='1') { $howOften = !empty($options['riHowOften'])?$options['riHowOften']:15; $lastCommentsCheck = get\_option('nxs\_cronLastCommentsCheck'); //$howOften = 3; |
| [138](#L138) | if (!empty($lastCommentsCheck)) { if ($lastCommentsCheck+($howOften\*60)<$currTime) {  update\_option('nxs\_cronLastCommentsCheck', $currTime, false); nxs\_importComments();  update\_option('nxs\_cronLastCommentsCheck', $currTime, false); } } |
| [139](#L139) | else update\_option('nxs\_cronLastCommentsCheck', $currTime, false); |
| [140](#L140) | } |
| [141](#L141) | //nxs\_addToLogN('L', 'Cron Run', '', 'Cron IN - '.$tm.' | Last - '.$tmL); |
| [142](#L142) | global $wpdb, $doing\_wp\_cron; |
| [143](#L143) | if ($isDebug) echo "==-- CRON --=="; |
| [144](#L144) |  |
| [145](#L145) | //## Debug only - delete later - shows all reords in the Query |
| [146](#L146) | $sqql = $wpdb->prepare("SELECT \* FROM {$wpdb->prefix}nxs\_query ORDER BY timetorun DESC LIMIT %d", $options['numOfTasks']); |
| [147](#L147) | $quPosts = $wpdb->get\_results($sqql, ARRAY\_A); |
| [148](#L148) | if ($isDebug) { prr($sqql); prr($quPosts); prr(date\_i18n('Y-m-d H:i:s')); } |
| [149](#L149) | //## / Debug only - delete later - shows all reords in the Query |
| [150](#L150) |  |
| [151](#L151) | //## Get count of tasks |
| [152](#L152) | $ttr = "FROM ". $wpdb->prefix . "nxs\_query WHERE timetorun<'".date\_i18n('Y-m-d H:i:s')."'"; |
| [153](#L153) | $quPostsCnt = $wpdb->get\_var($wpdb->prepare("SELECT COUNT(id) %s", $ttr)); |
| [154](#L154) | if ($isDebug) prr($ttr, 'TTR:'); |
| [155](#L155) | if ($isDebug) prr($quPostsCnt, 'COUNT:'); |
| [156](#L156) | if ((int)$quPostsCnt<1) return; //## Nothing in Query - return; |
| [157](#L157) | //## Get 20 tasks |
| [158](#L158) | $sql = $wpdb->prepare( "SELECT \* %s ORDER BY timetorun DESC LIMIT %d", $ttr, $options['numOfTasks'] ); |
| [159](#L159) | $quPosts = $wpdb->get\_results($sql, ARRAY\_A); |
| [160](#L160) |  |
| [161](#L161) | // Assuming you have access to the $wpdb object and $options array |
| [162](#L162) |  |
| [163](#L163) | $current\_datetime = date\_i18n('Y-m-d H:i:s'); |
| [164](#L164) | $ttr = "FROM {$wpdb->prefix}nxs\_query WHERE timetorun < %s"; |
| [165](#L165) | $prepared\_count\_query = $wpdb->prepare("SELECT COUNT(id) {$ttr}", $current\_datetime); |
| [166](#L166) | $quPostsCnt = $wpdb->get\_var($prepared\_count\_query); |
| [167](#L167) | if ($isDebug) { |
| [168](#L168) | prr($ttr, 'TTR:'); |
| [169](#L169) | prr($quPostsCnt, 'COUNT:'); |
| [170](#L170) | } |
| [171](#L171) | if ((int)$quPostsCnt < 1) { |
| [172](#L172) | return; // Nothing in Query - return |
| [173](#L173) | } |
| [174](#L174) | // Define the query to get 20 tasks |
| [175](#L175) | $sql = $wpdb->prepare( "SELECT \* %s ORDER BY timetorun DESC LIMIT %d", $ttr, $options['numOfTasks'] ); |
| [176](#L176) | $quPosts = $wpdb->get\_results($sql, ARRAY\_A); |
| [177](#L177) |  |
| [178](#L178) | $current\_time = date\_i18n('Y-m-d H:i:s'); |
| [179](#L179) | $sql\_count = $wpdb->prepare("SELECT COUNT(id) FROM {$wpdb->prefix}nxs\_query WHERE timetorun < %s", $current\_time); |
| [180](#L180) | $quPostsCnt = $wpdb->get\_var($sql\_count); |
| [181](#L181) |  |
| [182](#L182) | if ($isDebug) { |
| [183](#L183) | prr($sql\_count, 'TTR:'); |
| [184](#L184) | prr($quPostsCnt, 'COUNT:'); |
| [185](#L185) | } |
| [186](#L186) |  |
| [187](#L187) | if ((int) $quPostsCnt < 1) { |
| [188](#L188) | return; // Nothing in query - return |
| [189](#L189) | } |
| [190](#L190) |  |
| [191](#L191) | // Get 20 tasks with prepared query |
| [192](#L192) | $sql\_select = $wpdb->prepare( |
| [193](#L193) | "SELECT \* FROM {$wpdb->prefix}nxs\_query WHERE timetorun < %s ORDER BY timetorun DESC LIMIT %d", |
| [194](#L194) | $current\_time, |
| [195](#L195) | $options['numOfTasks'] |
| [196](#L196) | ); |
| [197](#L197) | $quPosts = $wpdb->get\_results($sql\_select, ARRAY\_A); |
| [198](#L198) |  |
| [199](#L199) |  |
| [200](#L200) |  |
| [201](#L201) |  |
| [202](#L202) |  |
| [203](#L203) |  |
| [204](#L204) |  |
| [205](#L205) |  |
| [206](#L206) |  |
| [207](#L207) | if ($isDebug) { var\_dump($quPosts); prr($quPosts); } $quPosts = array\_reverse($quPosts); |
| [208](#L208) | if (count($quPosts)>0) { |
| [209](#L209) | foreach ($quPosts as $row){ $id = $row['id']; if (!empty($row['postid'])) $postID = $row['postid']; else $postID = ''; //prr($row); prr($row['type']); |
| [210](#L210) | switch ( $row['type'] ) { |
| [211](#L211) | case 'Q':  //## Post from Query (to All Networks) |
| [212](#L212) | nxs\_LogIt('BG', 'Query', '','', '--===#### POST REQUEST FROM QUERY - Post ID:('.$postID.') ####===',print\_r($row, true),'snap',$row['uid']); nxs\_snapPublishTo($postID, true); $wpdb->delete($wpdb->prefix . "nxs\_query", array('id'=>$id)); |
| [213](#L213) | if ($options['nxsOverLimit']=='D') { $dateC = date("d", strtotime($row['datecreated'])); $dayN = date("d", strtotime($row['timetorun'])); |
| [214](#L214) | if ($dayN!=$dateC) { $wpdb->delete($wpdb->prefix . "nxs\_query", array('type'=>'Q')); |
| [215](#L215) | nxs\_LogIt('BG', 'Query', '','', '--===#### QUERY CLEARED ####===-- OVERLIMIT: '.$options['nxsOverLimit'], date("d", strtotime($row['datecreated'])).' != '.date("d", strtotime($row['datecreated']),'snap',$row['uid']),'snap',$row['uid']); |
| [216](#L216) | } |
| [217](#L217) | } |
| [218](#L218) | break; |
| [219](#L219) | case 'S': //## Post shedulled post. (to Individual Network) |
| [220](#L220) | $res = nxs\_pushPostToNT($row['nttype'], $row['refid'], $postID); if ($res=='200') $arrOut[] = 'All OK - ID: '.$id.' ('.$row['nttype'].'|'.$row['refid'].'|'.$postID.')'; |
| [221](#L221) | $wpdb->delete($wpdb->prefix . "nxs\_query", array('id'=>$id)); //nxsLogIt(array('msg'=>'S-Del:'.$id, 'extInfo'=>$doing\_wp\_cron)); |
| [222](#L222) | break; |
| [223](#L223) | case 'R': //## Reposter is active - check if it's time to re-post. |
| [224](#L224) | $tsd = get\_post\_meta( $row['postid'], 'nxs\_rpstr' ); $tsd = get\_post\_meta( $row['postid'], 'nxs\_rpstr\_data' ); |
| [225](#L225) | $fltrOpts = maybe\_unserialize(get\_post\_meta( $row['postid'], 'nxs\_rpstr\_data' , true)); $rpstrOpts = maybe\_unserialize(get\_post\_meta( $row['postid'], 'nxs\_rpstr' , true)); //prr($rpstrOpts, 'rpstrOpts'); prr($fltrOpts, 'FTT OPTS'); |
| [226](#L226) | //## Delete Ghosted Posters |
| [227](#L227) | if (empty($rpstrOpts['rpstOn'])) { $wpdb->delete( $wpdb->prefix . "nxs\_query", array( 'postid' => $row['postid'] ) );  nxs\_LogIt('DBG', 'Ghosted Reposter [Deleted]', 'RP','','Reposter ID:'.$row['postid'].' ', '-=[ '.print\_r($rpstrOpts, true).' ]=-'); break; } |
| [228](#L228) | //## |
| [229](#L229) | if ($rpstrOpts['rpstNxTime']>$currTime) { |
| [230](#L230) | if ($isDebug) echo wp\_kses("Post ID: ".$row['postid']." - No TIme Yet:".$rpstrOpts['rpstNxTime']." > ".$currTime." | ". date\_i18n('Y-m-d H:i:s',$rpstrOpts['rpstNxTime']). ' > '. date\_i18n('Y-m-d H:i:s',$currTime)."<br/>", wp\_kses\_allowed\_html( 'post' ), wp\_kses\_allowed\_html( 'post' )); |
| [231](#L231) | nxs\_recountQueryTimes();  break; |
| [232](#L232) | } |
| [233](#L233) | //## Time to Post |
| [234](#L234) | nxs\_LogIt('I', 'Reposter [Time to Post]', 'RPSTR','', 'Reposter ID:'.$row['postid'].' ', '-=[ '.print\_r($rpstrOpts, true).' ]=--=[ '.print\_r($fltrOpts, true).' ]=-'); if ($isDebug) echo wp\_kses('Reposter [Time to Post] '. 'Reposter ID:'.$row['postid'].' '); |
| [235](#L235) |  |
| [236](#L236) | if (!empty($fltrOpts)) { $fltrOpts['posts\_per\_page'] = '1'; |
| [237](#L237) |  |
| [238](#L238) | if (isset($rpstrOpts['rpstBtwHrsType']) && $rpstrOpts['rpstBtwHrsType']=='D'){ |
| [239](#L239) | //## Check Days |
| [240](#L240) | if (isset($rpstrOpts['rpstBtwDays']) && count($rpstrOpts['rpstBtwDays'])>0 ) $rpstBtwDays = $rpstrOpts['rpstBtwDays']; else $rpstBtwDays = array(); |
| [241](#L241) | if (is\_array($rpstBtwDays) && count($rpstBtwDays)>0) { $currDay = (int)date('w'); if ($currDay==0) $currDay = 7; if (!(in\_array($currDay, $rpstBtwDays))) { |
| [242](#L242) | nxs\_LogIt('I', 'Reposter: Skipped - Excluded Day - '.date\_i18n('D'), 'Reposter ID:'.$row['postid'], '', '-=[ - ]=-', print\_r($rpstrOpts, true)); break; |
| [243](#L243) | }} |
| [244](#L244) | //## Check Hours |
| [245](#L245) | if (isset($rpstrOpts['rpstBtwHrsF']) && (int)$rpstrOpts['rpstBtwHrsF']>0) $rpstBtwHrsF = (int)$rpstrOpts['rpstBtwHrsF']; else $rpstBtwHrsF = 0; |
| [246](#L246) | if (isset($rpstrOpts['rpstBtwHrsT']) && (int)$rpstrOpts['rpstBtwHrsT']>0) $rpstBtwHrsT = (int)$rpstrOpts['rpstBtwHrsT']; |
| [247](#L247) | if ($rpstBtwHrsT>0) { $currHour = (int)date\_i18n('H', $currTime); |
| [248](#L248) | if ( !( ($rpstBtwHrsF<$rpstBtwHrsT && $currHour<$rpstBtwHrsT && $currHour>=$rpstBtwHrsF) || ($rpstBtwHrsF>$rpstBtwHrsT && $currHour<$rpstBtwHrsF && $currHour>=$rpstBtwHrsT) )) { |
| [249](#L249) | nxs\_LogIt('I', 'Reposter: Skipped - Excluded Hour - '.$currHour, 'Reposter ID:'.$row['postid'], '', '-=[ - ]=-', print\_r($rpstrOpts, true)); break; |
| [250](#L250) | }} |
| [251](#L251) | } |
| [252](#L252) |  |
| [253](#L253) | //## Type of Post New-to-Old, Old-to-New, Random |
| [254](#L254) | if (empty($rpstrOpts['rpstType']) || $rpstrOpts['rpstType']=='2') { $fltrOpts['orderby']='post\_date'; $fltrOpts['order'] = 'ASC'; } |
| [255](#L255) | elseif ($rpstrOpts['rpstType']=='3') { $fltrOpts['orderby']='post\_date'; $fltrOpts['order'] = 'DESC'; } elseif ($rpstrOpts['rpstType']=='1') { $fltrOpts['orderby']='rand'; $rpstrOpts['rpstStop']='W'; } //else |
| [256](#L256) | //## Apply filters |
| [257](#L257) | nxs\_removeAllWPQueryFilters(); $ids = get\_posts\_ids\_by\_filter($fltrOpts); $pCnt = count($ids); |
| [258](#L258) | //## Do post to all specified networks |
| [259](#L259) | if (!empty($ids[0])) { nxs\_LogIt('I', 'Reposter [Got Post ID]', 'Reposter ID:'.$row['postid'].' (Post ID: '.$ids[0].')', '', '', ''); |
| [260](#L260) | foreach ($fltrOpts['nxs\_NPNts'] as $ntCode=>$ntts) { foreach ($ntts as $iis=>$accs) { $res = nxs\_pushPostToNT($ntCode, $iis,  $ids[0], 'r'); } } |
| [261](#L261) | update\_post\_meta($ids[0], 'snap\_isAutoPosted', '1'); update\_post\_meta($ids[0], 'snap\_isRpstd'.$row['postid'], time()); |
| [262](#L262) | nxs\_LogIt('I', 'Reposter [After the Post]', 'Reposter ID:'.$row['postid'].' (Post ID: '.$ids[0].')', '', '-=[ ]=-', print\_r($rpstrOpts, true)); |
| [263](#L263) | $rpstrOpts['lastID'] = $ids[0]; |
| [264](#L264) | //## Add to Stats |
| [265](#L265) | $stats = maybe\_unserialize(get\_post\_meta( $postID, 'nxs\_rpstr\_stats', true )); if (empty($stats['posted'])) $stats['posted'] = 0; $stats['posted']++; $stats['pstdLst'][] = $ids[0]; nxs\_Filters::save\_meta($row['postid'], 'nxs\_rpstr\_stats', $stats ); |
| [266](#L266) | //## When finished: Repeat N times  - Stop it |
| [267](#L267) | if ($rpstrOpts['rpstStop']=='N') {  $n = $rpstrOpts['rpstStopRpt'];  if ($stats['posted']>=$n) {$rpstrOpts['rpstOn'] = 0; $wpdb->delete( $wpdb->prefix . "nxs\_query", array( 'postid' => $row['postid'] ) );  $rpstrOpts['rpstOn'] = 'F'; |
| [268](#L268) | nxs\_LogIt('INF', 'Reposter Finished: Set to repeat '.$n.' times', 'RP','','Reposter ID:'.$row['postid'].' ', '-=[ '.print\_r($rpstrOpts, true).' ]=-'); nxs\_Filters::save\_meta($row['postid'], 'nxs\_rpstr', $rpstrOpts );  break; |
| [269](#L269) | }} |
| [270](#L270) | } else { |
| [271](#L271) | if ($isDebug) echo "END of the LINE!"; |
| [272](#L272) | //## Turn Reposting off |
| [273](#L273) | if ($rpstrOpts['rpstStop']=='O') { $rpstrOpts['rpstOn'] = 'F'; $wpdb->delete( $wpdb->prefix . "nxs\_query", array( 'postid' => $row['postid'] ) ); nxs\_LogIt('INF', 'Reposter Finished: End of the line', 'RP','','Reposter ID:'.$row['postid'].' ', '-=[ '.print\_r($rpstrOpts, true).' ]=-'); nxs\_Filters::save\_meta($row['postid'], 'nxs\_rpstr', $rpstrOpts );  break; } |
| [274](#L274) | //## Loop it - restart from the beginning |
| [275](#L275) | if ($rpstrOpts['rpstStop']=='R') { |
| [276](#L276) | $sql = $wpdb->prepare( |
| [277](#L277) | "DELETE FROM {$wpdb->postmeta} WHERE meta\_key = %s", |
| [278](#L278) | 'snap\_isRpstd' . $row['postid'] |
| [279](#L279) | ); |
| [280](#L280) | $wpdb->query($sql); |
| [281](#L281) | nxs\_LogIt('INF', 'Reposter Finished: Restarting...', 'RP','','Reposter ID:'.$row['postid'].' ', '-=[ '.print\_r($rpstrOpts, true).' ]=-'); |
| [282](#L282) | } |
| [283](#L283) | //## Wait for new posts (Do nothing) |
| [284](#L284) | if ($rpstrOpts['rpstStop']=='W') {  } |
| [285](#L285) | } |
| [286](#L286) | //## Figure our NextPost Date/Time |
| [287](#L287) | if ( $rpstrOpts['rpstOn'] =='1' && (empty($rpstrOpts['rpstTimes']) || $rpstrOpts['rpstTimes']=='A')) $rpstrOpts['rpstNxTime'] = nxs\_getNextPostTime( $rpstrOpts['rpstDays'], $rpstrOpts['rpstHrs'], $rpstrOpts['rpstMins'],$rpstrOpts['rpstRndMins']); else { |
| [288](#L288) | global $nxs\_cTime; $nxs\_cTime = time() + ( get\_option( 'gmt\_offset' ) \* HOUR\_IN\_SECONDS );     nxs\_LogIt('I', 'Reposter Check', 'Reposter ID:'.$row['postid'].' (CNT: '.$pCnt.')', '', '-=[ '.date('Y-m-d H:i:s', $nxs\_cTime).' ]=-'); |
| [289](#L289) | if (isset($rpstrOpts['rpstCustTD']) && is\_array($rpstrOpts['rpstCustTD'])) { |
| [290](#L290) | $rpstrOpts['rpstCustTD'] = array\_filter($rpstrOpts['rpstCustTD'], create\_function('$value', 'global $nxs\_cTime; return !empty($value) && strtotime($value)>$nxs\_cTime;'));  sort($rpstrOpts['rpstCustTD']); |
| [291](#L291) | } else $rpstrOpts['rpstCustTD'] = array(); if (!empty($rpstrOpts['rpstCustTD'][0])) $rpstrOpts['rpstNxTime'] = strtotime($rpstrOpts['rpstCustTD'][0]); else {  $rpstrOpts['rpstNxTime'] = ''; $rpstrOpts['rpstOn'] = 0; } |
| [292](#L292) | } |
| [293](#L293) | nxs\_Filters::save\_meta($row['postid'], 'nxs\_rpstr', $rpstrOpts ); |
| [294](#L294) |  |
| [295](#L295) | $whItem = array('id'=>$id); if (!empty( $rpstrOpts['rpstNxTime'])) { $dbItem = array('timetorun'=> date\_i18n('Y-m-d H:i:s',$rpstrOpts['rpstNxTime'])); $wpdb->update( $wpdb->prefix . "nxs\_query", $dbItem, $whItem); } else $wpdb->delete( $wpdb->prefix . "nxs\_query", $whItem); |
| [296](#L296) | } |
| [297](#L297) | break; |
| [298](#L298) | case 'F': //## Post from Quick Post From |
| [299](#L299) | $postUser = $row['uid']; $isItUserWhoCan = (!user\_can($postUser, 'manage\_options' ) && user\_can($postUser, 'haveown\_snap\_accss')); //if ($isItUserWhoCan) $uid = $postUser; |
| [300](#L300) | if ($isItUserWhoCan) { $nxs\_SNAP = new nxs\_SNAP($postUser); $networks = $nxs\_SNAP->nxs\_acctsU; global $nxs\_uid; $nxs\_uid = $postUser; } else { $networks = $nxs\_SNAP->nxs\_accts; } |
| [301](#L301) | $post  = unserialize($row['extInfo']);  $arrOut = nxs\_postFromForm($post, $networks, true); $wpdb->delete($wpdb->prefix . "nxs\_query", array('id'=>$id)); |
| [302](#L302) | break; |
| [303](#L303) | } |
| [304](#L304) | } if (!empty($arrOut)) nxs\_addToLogN('L', 'Cron Run ('.$doing\_wp\_cron.')', '', 'Cron:'. is\_array($arrOut)?print\_r($arrOut, true):$arrOut); |
| [305](#L305) | } |
| [306](#L306) | //## If more then 20 tasks - lets continue. |
| [307](#L307) | if ((int)$quPostsCnt>$options['numOfTasks']) { |
| [308](#L308) | // update\_option('nxs\_contCron',$quPostsCnt); //## Finish that. Disabled, 2017-12-05. Bad Idea? Genertes duplicates if a lot of shedulled posts. |
| [309](#L309) | } else update\_option('nxs\_contCron',false); |
| [310](#L310) | }} |
| [311](#L311) |  |
| [312](#L312) | //## Hook for Manual NXS Cron - ?nxs-cronrun=1 |
| [313](#L313) | if (!function\_exists("nxs\_cron\_manual")) {  function nxs\_cron\_manual(){ |
| [314](#L314) | if (isset($\_GET['nxs-cronrun'])) { nxs\_checkQuery(); /\* nxs\_recountQueryTimes(); \*/ die(); } |
| [315](#L315) | }} add\_action('wp\_loaded','nxs\_cron\_manual'); |
| [316](#L316) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php?format=txt)
* [Original Format](/export/3220685/social-networks-auto-poster-facebook-twitter-g/trunk/inc/nxs_functions_engine.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

