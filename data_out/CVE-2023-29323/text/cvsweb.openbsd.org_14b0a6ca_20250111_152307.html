

| [[BACK]](/cgi-bin/cvsweb/src/usr.sbin/smtpd/envelope.c?f=h#rev1.50.4.1)**Return to [envelope.c](/cgi-bin/cvsweb/src/usr.sbin/smtpd/envelope.c?f=h#rev1.50.4.1) CVS log** [TXT] | [DIR] **Up to [[local]](/cgi-bin/cvsweb/?f=h#dirlist) / [src](/cgi-bin/cvsweb/src/?f=h#dirlist) / [usr.sbin](/cgi-bin/cvsweb/src/usr.sbin/?f=h#dirlist) / [smtpd](/cgi-bin/cvsweb/src/usr.sbin/smtpd/?f=h#dirlist)** |
| --- | --- |

### Diff for /src/usr.sbin/smtpd/envelope.c between version 1.50 and 1.50.4.1

| version 1.50, 2022/09/24 17:08:32 | version 1.50.4.1, 2023/02/07 15:50:30 || | **Line 270** | | --- | | | **Line 270** | | --- | || static int | static int |
| ascii\_load\_sockaddr(struct sockaddr\_storage \*ss, char \*buf) | ascii\_load\_sockaddr(struct sockaddr\_storage \*ss, char \*buf) |
| { | { |
| struct sockaddr\_in6 ssin6; |  |
| struct sockaddr\_in  ssin; |  |
|  |  |
| memset(&ssin, 0, sizeof ssin); |  |
| memset(&ssin6, 0, sizeof ssin6); |  |
|  |  |
| if (!strcmp("local", buf)) { | if (!strcmp("local", buf)) { |
| ss->ss\_family = AF\_LOCAL; | ss->ss\_family = AF\_LOCAL; |
| } | } |
| else if (buf[0] == '[' && buf[strlen(buf)-1] == ']') { | else if (buf[0] == '[' && buf[strlen(buf)-1] == ']') { |
|  | struct addrinfo hints, \*res0; |
|  |  |
| buf[strlen(buf)-1] = '\0'; | buf[strlen(buf)-1] = '\0'; |
| if (inet\_pton(AF\_INET6, buf+1, &ssin6.sin6\_addr) != 1) |  |
|  | /\* getaddrinfo() is used to support scoped addresses. \*/ |
|  | memset(&hints, 0, sizeof(hints)); |
|  | hints.ai\_family = AF\_INET6; |
|  | hints.ai\_flags = AI\_NUMERICHOST; |
|  | if (getaddrinfo(buf+1, NULL, &hints, &res0) != 0) |
| return 0; | return 0; |
| ssin6.sin6\_family = AF\_INET6; | memcpy(ss, res0->ai\_addr, res0->ai\_addrlen); |
| memcpy(ss, &ssin6, sizeof(ssin6)); | ss->ss\_len = res0->ai\_addrlen; |
| ss->ss\_len = sizeof(struct sockaddr\_in6); | freeaddrinfo(res0); |
| } | } |
| else { | else { |
|  | struct sockaddr\_in ssin; |
|  |  |
|  | memset(&ssin, 0, sizeof ssin); |
| if (inet\_pton(AF\_INET, buf, &ssin.sin\_addr) != 1) | if (inet\_pton(AF\_INET, buf, &ssin.sin\_addr) != 1) |
| return 0; | return 0; |
| ssin.sin\_family = AF\_INET; | ssin.sin\_family = AF\_INET; |

| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

---

| | Legend:  | Removed from v.1.50 |  | | --- | --- | | changed lines | | |  | Added in v.1.50.4.1 | | | --- | --- | --- | --- | --- | --- | --- | | Colored Long colored Unified Context |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

