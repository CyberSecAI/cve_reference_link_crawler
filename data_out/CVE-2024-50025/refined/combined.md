=== Content from git.kernel.org_45c146ba_20250110_225719.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Martin Wilck <martin.wilck@suse.com> | 2024-09-30 15:30:14 +0200 |
| --- | --- | --- |
| committer | Martin K. Petersen <martin.petersen@oracle.com> | 2024-10-03 21:45:11 -0400 |
| commit | [f30e5f77d2f205ac14d09dec40fd4bb76712f13d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)) | |
| tree | [edeed6add617dc944065d7b5b92b77d60c018538](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d) | |
| parent | [d5130c5a093257aa4542aaded8034ef116a7624a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d5130c5a093257aa4542aaded8034ef116a7624a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d&id2=d5130c5a093257aa4542aaded8034ef116a7624a)) | |
| download | [linux-f30e5f77d2f205ac14d09dec40fd4bb76712f13d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f30e5f77d2f205ac14d09dec40fd4bb76712f13d.tar.gz) | |

scsi: fnic: Move flush\_work initialization out of if blockAfter commit 379a58caa199 ("scsi: fnic: Move fnic\_fnic\_flush\_tx() to a
work queue"), it can happen that a work item is sent to an uninitialized
work queue. This may has the effect that the item being queued is never
actually queued, and any further actions depending on it will not
proceed.
The following warning is observed while the fnic driver is loaded:
kernel: WARNING: CPU: 11 PID: 0 at ../kernel/workqueue.c:1524 \_\_queue\_work+0x373/0x410
kernel: <IRQ>
kernel: queue\_work\_on+0x3a/0x50
kernel: fnic\_wq\_copy\_cmpl\_handler+0x54a/0x730 [fnic 62fbff0c42e7fb825c60a55cde2fb91facb2ed24]
kernel: fnic\_isr\_msix\_wq\_copy+0x2d/0x60 [fnic 62fbff0c42e7fb825c60a55cde2fb91facb2ed24]
kernel: \_\_handle\_irq\_event\_percpu+0x36/0x1a0
kernel: handle\_irq\_event\_percpu+0x30/0x70
kernel: handle\_irq\_event+0x34/0x60
kernel: handle\_edge\_irq+0x7e/0x1a0
kernel: \_\_common\_interrupt+0x3b/0xb0
kernel: common\_interrupt+0x58/0xa0
kernel: </IRQ>
It has been observed that this may break the rediscovery of Fibre
Channel devices after a temporary fabric failure.
This patch fixes it by moving the work queue initialization out of
an if block in fnic\_probe().
Signed-off-by: Martin Wilck <mwilck@suse.com>
Fixes: 379a58caa199 ("scsi: fnic: Move fnic\_fnic\_flush\_tx() to a work queue")
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240930133014.71615-1-mwilck@suse.com](https://lore.kernel.org/r/20240930133014.71615-1-mwilck%40suse.com)
Reviewed-by: Lee Duncan <lduncan@suse.com>
Reviewed-by: Karan Tilak Kumar <kartilak@cisco.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)

| -rw-r--r-- | [drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/fnic/fnic_main.c?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/scsi/fnic/fnic\_main.c b/drivers/scsi/fnic/fnic\_main.cindex 0044717d4486c6..adec0df24bc475 100644--- a/[drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/fnic/fnic_main.c?id=d5130c5a093257aa4542aaded8034ef116a7624a)+++ b/[drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/fnic/fnic_main.c?id=f30e5f77d2f205ac14d09dec40fd4bb76712f13d)@@ -830,7 +830,6 @@ static int fnic\_probe(struct pci\_dev \*pdev, const struct pci\_device\_id \*ent) spin\_lock\_init(&fnic->vlans\_lock); INIT\_WORK(&fnic->fip\_frame\_work, fnic\_handle\_fip\_frame); INIT\_WORK(&fnic->event\_work, fnic\_handle\_event);- INIT\_WORK(&fnic->flush\_work, fnic\_flush\_tx); skb\_queue\_head\_init(&fnic->fip\_frame\_queue); INIT\_LIST\_HEAD(&fnic->evlist); INIT\_LIST\_HEAD(&fnic->vlans);@@ -948,6 +947,7 @@ static int fnic\_probe(struct pci\_dev \*pdev, const struct pci\_device\_id \*ent)  INIT\_WORK(&fnic->link\_work, fnic\_handle\_link); INIT\_WORK(&fnic->frame\_work, fnic\_handle\_frame);+ INIT\_WORK(&fnic->flush\_work, fnic\_flush\_tx); skb\_queue\_head\_init(&fnic->frame\_queue); skb\_queue\_head\_init(&fnic->tx\_queue); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:55:57 +0000



=== Content from git.kernel.org_54f96bd9_20250110_225719.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6b7836b80061bf1accc5d78b12bc086aed252388)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b7836b80061bf1accc5d78b12bc086aed252388)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b7836b80061bf1accc5d78b12bc086aed252388)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b7836b80061bf1accc5d78b12bc086aed252388)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Martin Wilck <martin.wilck@suse.com> | 2024-09-30 15:30:14 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:26:58 +0200 |
| commit | [6b7836b80061bf1accc5d78b12bc086aed252388](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b7836b80061bf1accc5d78b12bc086aed252388) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6b7836b80061bf1accc5d78b12bc086aed252388)) | |
| tree | [1de4e53e4797a5e31767b7eacfba9d62d72f9515](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b7836b80061bf1accc5d78b12bc086aed252388) | |
| parent | [b60ff1a95c7c386cdd6153de3d7d85edaeabd800](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b60ff1a95c7c386cdd6153de3d7d85edaeabd800) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b7836b80061bf1accc5d78b12bc086aed252388&id2=b60ff1a95c7c386cdd6153de3d7d85edaeabd800)) | |
| download | [linux-6b7836b80061bf1accc5d78b12bc086aed252388.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6b7836b80061bf1accc5d78b12bc086aed252388.tar.gz) | |

scsi: fnic: Move flush\_work initialization out of if blockcommit f30e5f77d2f205ac14d09dec40fd4bb76712f13d upstream.
After commit 379a58caa199 ("scsi: fnic: Move fnic\_fnic\_flush\_tx() to a
work queue"), it can happen that a work item is sent to an uninitialized
work queue. This may has the effect that the item being queued is never
actually queued, and any further actions depending on it will not
proceed.
The following warning is observed while the fnic driver is loaded:
kernel: WARNING: CPU: 11 PID: 0 at ../kernel/workqueue.c:1524 \_\_queue\_work+0x373/0x410
kernel: <IRQ>
kernel: queue\_work\_on+0x3a/0x50
kernel: fnic\_wq\_copy\_cmpl\_handler+0x54a/0x730 [fnic 62fbff0c42e7fb825c60a55cde2fb91facb2ed24]
kernel: fnic\_isr\_msix\_wq\_copy+0x2d/0x60 [fnic 62fbff0c42e7fb825c60a55cde2fb91facb2ed24]
kernel: \_\_handle\_irq\_event\_percpu+0x36/0x1a0
kernel: handle\_irq\_event\_percpu+0x30/0x70
kernel: handle\_irq\_event+0x34/0x60
kernel: handle\_edge\_irq+0x7e/0x1a0
kernel: \_\_common\_interrupt+0x3b/0xb0
kernel: common\_interrupt+0x58/0xa0
kernel: </IRQ>
It has been observed that this may break the rediscovery of Fibre
Channel devices after a temporary fabric failure.
This patch fixes it by moving the work queue initialization out of
an if block in fnic\_probe().
Signed-off-by: Martin Wilck <mwilck@suse.com>
Fixes: 379a58caa199 ("scsi: fnic: Move fnic\_fnic\_flush\_tx() to a work queue")
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240930133014.71615-1-mwilck@suse.com](https://lore.kernel.org/r/20240930133014.71615-1-mwilck%40suse.com)
Reviewed-by: Lee Duncan <lduncan@suse.com>
Reviewed-by: Karan Tilak Kumar <kartilak@cisco.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b7836b80061bf1accc5d78b12bc086aed252388)

| -rw-r--r-- | [drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/fnic/fnic_main.c?id=6b7836b80061bf1accc5d78b12bc086aed252388) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/scsi/fnic/fnic\_main.c b/drivers/scsi/fnic/fnic\_main.cindex 29eead383eb9a4..5d833577f23fe1 100644--- a/[drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/fnic/fnic_main.c?id=b60ff1a95c7c386cdd6153de3d7d85edaeabd800)+++ b/[drivers/scsi/fnic/fnic\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/fnic/fnic_main.c?id=6b7836b80061bf1accc5d78b12bc086aed252388)@@ -830,7 +830,6 @@ static int fnic\_probe(struct pci\_dev \*pdev, const struct pci\_device\_id \*ent) spin\_lock\_init(&fnic->vlans\_lock); INIT\_WORK(&fnic->fip\_frame\_work, fnic\_handle\_fip\_frame); INIT\_WORK(&fnic->event\_work, fnic\_handle\_event);- INIT\_WORK(&fnic->flush\_work, fnic\_flush\_tx); skb\_queue\_head\_init(&fnic->fip\_frame\_queue); INIT\_LIST\_HEAD(&fnic->evlist); INIT\_LIST\_HEAD(&fnic->vlans);@@ -948,6 +947,7 @@ static int fnic\_probe(struct pci\_dev \*pdev, const struct pci\_device\_id \*ent)  INIT\_WORK(&fnic->link\_work, fnic\_handle\_link); INIT\_WORK(&fnic->frame\_work, fnic\_handle\_frame);+ INIT\_WORK(&fnic->flush\_work, fnic\_flush\_tx); skb\_queue\_head\_init(&fnic->frame\_queue); skb\_queue\_head\_init(&fnic->tx\_queue); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:55:56 +0000


