

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Arbitrary GFM references rendered in Incident Timeline Events leak private/confidential resources

**[HackerOne report #1652853](https://hackerone.com/reports/1652853)** by `yvvdwf` on 2022-07-28, assigned to [@ngeorge1](/ngeorge1 "Nikhil George"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hi,

Gitlab recently introduced Incident [Timeline events](https://docs.gitlab.com/ee/operations/incident_management/incidents.html#timeline-events) feature. The events' description is generated using [TimelineEventPipeline](https://gitlab.com/gitlab-org/gitlab/-/blob/7aaa1146f7da57f9003dc2154132b80e008b4043/lib/banzai/pipeline/incident_management/timeline_event_pipeline.rb) pipeline which allows the following filters:

```
def self.filters
  [@]filters ||= FilterArray[
    *super,
    Filter::SanitizationFilter,
    *Banzai::Pipeline::GfmPipeline.reference_filters,
    Filter::EmojiFilter,
    Filter::ExternalLinkFilter,
    Filter::ImageLinkFilter
  ]
end
```

The `reference_filters` filters expand any references. Consequently when the description of a timeline event references to *private or confidential resources*, it will render their titles.

Normally these private/confidential resources are redacted when rendering to non-permission users. Somehow this redaction is not used in the incident timeline event.

### Steps to reproduce:

As a normal user (victim):

* create a private project, let's call `victim/project-a`, then create a confidential issue inside. It's GFM reference is now `victim/project-a#1`

As an attacker:

* In an existing project or create a new one
* Go to `Monitor/Incidents` and create an incident
* Open `Timeline` tab of the incident you've created. Then create a new timeline event and reference the issue above: fill `victim/project-a#1` in the `Timeline text`
* You should see now the issue's title is rendered in the description of the event

### Example

I tested on gitlab.com. I used `gitlab-org/gitlab#367408` as payload which is used to track one my previous H1 report.

The example is available in this private project: <https://gitlab.com/yvvdwf/xss/-/issues/12>

[![Screenshot_2022-07-28_at_15.20.03.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/1e181d387c6a86d6a168e276c514255b90bc4cd7/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f62323865663163352d353439352d343433612d383363302d6539633139383261363730392f53637265656e73686f745f323032322d30372d32385f61745f31352e32302e30332e706e67)

### Impact

This vulnerability allows to renders *all* GFM references, such as, merged requests, issues, etc, even if they are private or confidential.

For example, attackers can simply scan through all *issue* numbers (starting from 1) of the `gitlab-org/gitlab` project, and thus leaking their titles.

Best regards,

yvvdwf

#### Impact

This vulnerability allows attacker to access to *all private or confidential* GFM references, such as, merged requests, issues, etc.

For example, attackers can simply scan through all *issue* numbers (starting from 1) of the `gitlab-org/gitlab` project, and thus leaking their titles.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Screenshot\_2022-07-28\_at\_15.20.03.png](https://h1.sec.gitlab.net/a/b28ef1c5-5495-443a-83c0-e9c1982a6709/Screenshot_2022-07-28_at_15.20.03.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

