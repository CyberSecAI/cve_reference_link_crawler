

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Do not allow too many syntax operators in search terms

Related to [gitlab-com/gl-infra/production#16237 (comment 1532286716)](https://gitlab.com/gitlab-com/gl-infra/production/-/issues/16237#note_1532286716 "2023-08-25: SidekiqQueueTooLarge - ElasticSearch")

Note: marking as confidential because this is a DOS for search

## Summary

Too many OR terms in the search query (specifically for group search, but possible global search and project search) caused high CPU on the search nodes and eventually the system stopped serving search requests.

Need to look into why this is happening from the Elasticsearch side, it might be relevant. The blobs search is doing simple query string with default operator of `AND`. The search syntax supported: <https://docs.gitlab.com/ee/user/search/advanced_search.html#syntax>

relevant links:

* <https://discuss.elastic.co/t/increase-query-performance-for-many-or-clauses/63425>

## Possible fixes

Add something to search params to prevent and alert the user if too many operators are added to the query. We should support some amount but not unlimited and 11 is too many, so less than that.

We should also update documentation to [note the limitation](https://docs.gitlab.com/ee/user/search/advanced_search.html#syntax)

Edited Aug 28, 2023 by [Terri Chu](/terrichu)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

