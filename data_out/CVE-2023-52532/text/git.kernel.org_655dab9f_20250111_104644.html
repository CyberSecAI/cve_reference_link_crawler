

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Haiyang Zhang <haiyangz@microsoft.com> | 2023-09-29 13:42:25 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-19 23:08:49 +0200 |
| commit | [b67d7b1bfc46d05c1a58b172516454698e8d5004](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)) | |
| tree | [4bc8641bf5f2bc05e073f8d75fecc36cc194a2ca](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004) | |
| parent | [adc4d740ad9ec780657327c69ab966fa4fdf0e8e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=adc4d740ad9ec780657327c69ab966fa4fdf0e8e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004&id2=adc4d740ad9ec780657327c69ab966fa4fdf0e8e)) | |
| download | [linux-b67d7b1bfc46d05c1a58b172516454698e8d5004.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b67d7b1bfc46d05c1a58b172516454698e8d5004.tar.gz) | |

net: mana: Fix TX CQE error handling[ Upstream commit b2b000069a4c307b09548dc2243f31f3ca0eac9c ]
For an unknown TX CQE error type (probably from a newer hardware),
still free the SKB, update the queue tail, etc., otherwise the
accounting will be wrong.
Also, TX errors can be triggered by injecting corrupted packets, so
replace the WARN\_ONCE to ratelimited error logging.
Cc: stable@vger.kernel.org
Fixes: ca9c54d2d6a5 ("net: mana: Add a driver for Microsoft Azure Network Adapter (MANA)")
Signed-off-by: Haiyang Zhang <haiyangz@microsoft.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Reviewed-by: Shradha Gupta <shradhagupta@linux.microsoft.com>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)

| -rw-r--r-- | [drivers/net/ethernet/microsoft/mana/mana\_en.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/microsoft/mana/mana_en.c?id=b67d7b1bfc46d05c1a58b172516454698e8d5004) | 18 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 11 insertions, 7 deletions

| diff --git a/drivers/net/ethernet/microsoft/mana/mana\_en.c b/drivers/net/ethernet/microsoft/mana/mana\_en.cindex 4f4204432aaa3f..b751b03eddfb1e 100644--- a/[drivers/net/ethernet/microsoft/mana/mana\_en.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microsoft/mana/mana_en.c?id=adc4d740ad9ec780657327c69ab966fa4fdf0e8e)+++ b/[drivers/net/ethernet/microsoft/mana/mana\_en.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/microsoft/mana/mana_en.c?id=b67d7b1bfc46d05c1a58b172516454698e8d5004)@@ -1003,17 +1003,21 @@ static void mana\_poll\_tx\_cq(struct mana\_cq \*cq) case CQE\_TX\_VPORT\_IDX\_OUT\_OF\_RANGE: case CQE\_TX\_VPORT\_DISABLED: case CQE\_TX\_VLAN\_TAGGING\_VIOLATION:- WARN\_ONCE(1, "TX: CQE error %d: ignored.\n",- cqe\_oob->cqe\_hdr.cqe\_type);+ if (net\_ratelimit())+ netdev\_err(ndev, "TX: CQE error %d\n",+ cqe\_oob->cqe\_hdr.cqe\_type);+ break;  default:- /\* If the CQE type is unexpected, log an error, assert,- \* and go through the error path.+ /\* If the CQE type is unknown, log an error,+ \* and still free the SKB, update tail, etc. \*/- WARN\_ONCE(1, "TX: Unexpected CQE type %d: HW BUG?\n",- cqe\_oob->cqe\_hdr.cqe\_type);- return;+ if (net\_ratelimit())+ netdev\_err(ndev, "TX: unknown CQE type %d\n",+ cqe\_oob->cqe\_hdr.cqe\_type);++ break; }  if (WARN\_ON\_ONCE(txq->gdma\_txq\_id != completions[i].wq\_num)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:45:21 +0000

