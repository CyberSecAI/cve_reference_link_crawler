
# [gynvael.coldwin//vx.log](/?blog=1)

![](/images/something_suspicious.png)
[Available for Consulting and Projects](https://hexarcana.ch/?utm=gyn-blog)
[Upcoming Talks](https://hexarcana.ch/workshops/?utm=gyn-blog-w)

![](/img/gynvael-close.jpg)

* [Return to dashboard ⇪](/)

### *Sections*

* **lang**: [![PL](/images/lang_pl.png)](?blog=1&lang=pl) | [![EN](/images/lang_en.png)](?blog=1&lang=en)
* **RSS**: [![RSS PL](/images/lang_pl.png)](/rss_pl.php) | [![RSS EN](/images/lang_en.png)](/rss_en.php)
* [About me](?id=50)
* [Tools](?id=182)
* [→ YT YouTube (EN)](https://youtube.com/c/GynvaelEN)
* [→ D Discord](/discord)* [→ M Mastodon](https://infosec.exchange/%40gynvael)* [→ T Twitter](https://twitter.com/gynvael)* [→ GH GitHub](https://github.com/gynvael)

        [![](/img/hexarcana160_2.png)](https://hexarcana.ch)

        [My company's website](https://hexarcana.ch)

        [![](/img/po_issue_5_rbanner.png)](https://pagedout.institute/)

        [Paged Out! zine](https://pagedout.institute/)

        [![](/img/ds_logo_160.jpg)](https://dragonsector.pl/)

        [Dragon Sector CTF Team](https://dragonsector.pl/)

### *Links / Blogs*

* [→ dragonsector.pl](http://dragonsector.pl)
* [→ vexillium.org](http://vexillium.org)
* **Security/Hacking:**
  + [j00ru's blog](http://j00ru.vexillium.org/?lang=en)
  + [lcamtuf's blog](http://lcamtuf.blogspot.com/)
  + [invisible things (new)](http://blog.invisiblethings.org/)
  + [invisible things (old)](http://theinvisiblethings.blogspot.com/)
  + [liveoverflow's site](http://liveoverflow.com/)
  + [/dev/null's site](https://d3vnull.com/)
  + [pi3's blog](http://blog.pi3.com.pl/)
  + [icewall's blog](http://icewall.pl/)
  + [taviso's blog](http://blog.cmpxchg8b.com/)
  + [pawel's blog](http://wampir.mroczna-zaloga.org/)
  + [sandeep's blog](http://www.sandeepkamble.com/)
  + [koto's blog](http://blog.kotowicz.net/)
  + [carstein's blog](http://128nops.blogspot.ch/)
  + [zaufana trzecia strona](http://zaufanatrzeciastrona.pl/)
  + [niebezpiecznik](https://niebezpiecznik.pl/)
  + [sekurak](https://sekurak.pl/)
* **Reverse Eng./Low-Level:**
  + [rewolf's blog](http://blog.rewolf.pl/blog/)
  + [gdtr](http://gdtr.wordpress.com/)
  + [spinning mirrors](http://omeg.pl/)
  + [security news](https://www.secnews.pl/)
  + [rev3rsed](http://rev3rsed.blogspot.com/)
* **Programming/Code:**
  + [/dev/krzaq](https://dev.krzaq.cc/)
  + [sil2100/vx's web log](http://sil2100.vexillium.org/)
  + [adam sawicki](http://asawicki.info/)
  + [devkk.net](http://devkk.net/)
  + [xion.log](http://xion.org.pl/)

### *Posts*

* [Paged Out! #5 is out,](?id=797)
* [CVEs of SSH talk this Thursday,](?id=796)
* [Debug Log: Internet doesn't work (it was the PSU),](?id=793)
* [FAQ: The tragedy of low-level exploitation,](?id=791)
* [Solving Hx8 Teaser 2 highlight videos!,](?id=789)
* [Gynvael on SECURITYbreak podcast,](?id=788)
* [Paged Out! #4 is out,](?id=786)
* [I won't be able to attend CONFidence'24 after all :(,](?id=785)
* [xz/liblzma: Bash-stage Obfuscation Explained,](?id=782)
* [Two of my bookmarklets: image extraction and simple TTS,](?id=781)
* [→ see all posts on main page](/)

// copyright © Gynvael Coldwind

// design & art by Xa

// logo font (birdman regular) by utopiafonts / Dale Harris

/\* the author and owner of this blog hereby allows anyone to test the security of this blog (on HTTP level only, the server is not mine, so let's leave it alone ;>), and try to break in (including successful breaks) without any consequences of any kind (DoS attacks are an exception here) ... I'll add that I planted in some places funny photos of some kittens, there are 7 of them right now, so have fun looking for them ;> let me know if You find them all, I'll add some congratz message or sth ;> \*/

**Vulns found in blog:**

\* XSS *(pers, user-inter)* by ged\_

\* XSS *(non-pers)* by Anno & Tracerout

\* XSS *(pers)* by Anno & Tracerout

\* Blind SQLI by Sławomir Błażek

\* XSS *(pers) by* Sławomir Błażek

2021-09-06:
## [Draconian Fear vulnerability (some NETGEAR smart switches)](?id=741)

netgear:vulnerability
[![Name of the vulnerability - Draconian Fear - in a red horror-style font on stained black background](/img/draconian-fear-small.jpg)](/?id=740)

TL;DR: NETGEAR just patched 3 reported vulnerabilities ([Demon's Cries](/?id=740), [Draconian Fear](/?id=741) and [Seventh Inferno](/?id=742)) in some managed (smart) switches. If you or your company owns any of these devices, **please patch now**.

Note: Details on Seventh Inferno will be publish on or after 13th September.

Affected devices:

* GC108P
* GC108PP
* GS108Tv3
* GS110TPP
* GS110TPv3
* GS110TUP
* GS308T
* GS310TP
* GS710TUP
* GS716TP
* GS716TPP
* GS724TPP
* GS724TPv2
* GS728TPPv2
* GS728TPv2
* GS750E
* GS752TPP
* GS752TPv2
* MS510TXM
* MS510TXUP

NETGEAR's advisory can be found here: [Security Advisory for Multiple Vulnerabilities on Some Smart Switches, PSV-2021-0140, PSV-2021-0144, PSV-2021-0145](https://kb.netgear.com/000063978/Security-Advisory-for-Multiple-Vulnerabilities-on-Some-Smart-Switches-PSV-2021-0140-PSV-2021-0144-PSV-2021-0145).

### CVSS, CVE, etc

Some human readable details are in the next section.

* **Vulnerability Codename:** Draconian Fear
* **Vendor-specific ID:** PSV-2021-0144
* **CVE:** CVE-2021-40867
* **CVSS:** 7.8 (High)1, CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
* **Patch Diff Risk:** Medium

1 NETGEAR on the advisory page says it's 7.4 (High), since we rated Attack Complexity and User Interaction differently (in my case I think the attack complexity is low, but it does require user interaction - admin needs to be in the process of logging in; NETGEAR rated the opposite).

#### Detailed Report

Published on September 6th, 2021.

`Draconian Fear
*** Summary:
Affected Model: NETGEAR GS110TPV3 Smart Managed Pro Switch (and some other)
Firmware Version: V7.0.6.3 (from 2021-05-07)
NETGEAR GS110TPV3 Smart Managed Pro Switch is vulnerable to authentication
hijacking (for lack of a better term) that allows an attacker with the same IP
as a logging in admin to hijack the session bootstrapping information, giving
the attacker full admin access to the device web UI and resulting in a full
compromise of the device.
The obvious limiting factor here is the requirement for the attacker to either
have the same IP as the admin (foothold on the same machine with limited
privileges, same source NAT IP, etc) or being able to spoof the IP with various
low-level network shenanigans, as well winning a race condition with a 1-second
window (pretty easy actually).
Attached PoC will attempt to win the race and hijack session bootstrap
information.
IMPORTANT: This vulnerability is reported under the 90-day policy, i.e. this
report will be shared publicly with the defensive community on 6th September
2021. See https://www.google.com/about/appsecurity/ for details.
NOTE: At this point in time I haven't checked what other models are affected,
but I strongly suspect other NETGEAR devices reuse the same code.
*** More details:
Web UI authentication logic on this device goes like this:
1. Admin opens the website and enters the password.
2. The password is obfuscated and sent to /cgi/set.cgi?cmd=home_loginAuth.
3. The set.cgi handler (cgi_home_loginAuth_set) creates an authing session file
(libcgiutil.so's cgi_util_authingSession_create) named:
/tmp/sess/guiAuth_info_{handlerPid}
This file contains:
* username
* password
* name of the result file /tmp/sess/guiAuth_{http}_{clientIP}_{userAgent}
* {clientIP}
* {http}
* {userAgent}
(where {http} is either "http" or "https" string, and {userAgent} is
an integer between 1 and 5 denoting a type of browser)
4. The same handler creates another file named /tmp/_polld_act_web_login and
fills it with a command to be executed:
/home/web/cgi/login.cgi {handlerPid} &
5. Then sends a SIGUSR1 signal to polld daemon and returns a generic HTTP
response.
6. The polld daemon upon receiving the SIGUSR1 opens the created
/tmp/_polld_act_web_login file and executes the command within it.
7. The login.cgi program uses the data inside the
/tmp/sess/guiAuth_info_{handlerPid} file to authenticate the user, and
writes the result in the /tmp/sess/guiAuth_{http}_{clientIP}_{userAgent}
file.
8. At the same time the browser is instructed to poll the
/cgi/get.cgi?cmd=home_loginStatus endpoint every second to receive
information whether the authentication is still in progress, or whether it
failed or succeeded.
9. The get.cgi handler (cgi_home_loginStatus_get) takes the client IP, http or
https schema, and user agent type, and opens the status file
/tmp/sess/guiAuth_{http}_{clientIP}_{userAgent} to check the status.
In case the status is 1 (followed by session id), the handler returns the
session bootstrapping material (session id and RSA public key).
To put it another way, the browser first sends the login information using
set.cgi, and then polls get.cgi to get the session id.
The problem is that get.cgi relies only on the IP and a guessable 1-5 browser
type number for verification whether the polling party is actually the same as
the party that sent in the login information. I.e. there is no e.g. session
cookie that ties the subsequent set.cgi and get.cgi together.
Given this, an attacker on the same IP as the admin can just flood the get.cgi
with requests and snatch the session information as soon as it appears. Since
the window between get.cgi requests on the browser is 1 second, that allows an
attacker to send multiple requests effectively greatly increasing the odds of
getting the session information before admin's browser gets it (in my tests the
attached PoC wins the race 9 out of 10 times).
*** Proposed fix:
The name of the result file should be a cryptographically secure random value
(e.g. 32 lower-case hexadecimal characters), e.g. following this pattern:
/tmp/sess/guiAuth_result_{random32lowerCaseHexChars}
The {random} value should then be passed when returning from the set.cgi request
to the browser and used in subsequent get.cgi requests.
Since the value has the charset limited to hexadecimal characters, and has a set
length, it's quite easy to verify that the get.cgi parameter meets these
criteria (and therefore eliminate any possibility of a path traversal / pointing
to an arbitrary file by the attacker).
Please let me know if you have any questions.
*** PoC Exploit:
#!/usr/bin/python3
import requests
import json
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
import sys
import time
SWITCH_ADDR = '192.168.2.14' # Address of the target switch.
headers = {
'User-Agent': 'Chrome', # Change the user agent if needed.
}
while True:
r = requests.get(
f"http://{SWITCH_ADDR}/cgi/get.cgi?cmd=home_loginStatus&token=bla",
verify=False,
headers=headers,
)
#print(r.status_code)
d = r.json()
print(d["data"]["status"])
if d["data"]["status"] != "authing":
print(d)
break`

## Add a comment:

| Nick: |  |
| --- | --- |
| URL (optional): |  |
| Math captcha: 10 ∗ 9 ＋ 9 = |  |
|  | |

