
[![git](static/git-logo.png)](https://git-scm.com/ "git homepage")[git://sourceware.org](/git) / [glibc.git](/git?p=glibc.git;a=summary) / commit

commit
grep
author
committer
pickaxe
 [?](/git?p=glibc.git;a=search_help "search help") search:

re

[summary](/git?p=glibc.git;a=summary) | [shortlog](/git?p=glibc.git;a=shortlog;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [log](/git?p=glibc.git;a=log;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | commit | [commitdiff](/git?p=glibc.git;a=commitdiff;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [tree](/git?p=glibc.git;a=tree;h=4ce71226b6ce414b7c5a08d6406e5506f2b32442;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e)

(parent: [6c2f050](/git?p=glibc.git;a=commit;h=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b)) | [patch](/git?p=glibc.git;a=patch;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e)

[getcwd: Set errno to ERANGE for size == 1 (CVE-2021-3999)](/git?p=glibc.git;a=commitdiff;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e)

| author | [Siddhesh Poyarekar](/git?p=glibc.git;a=search;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;s=Siddhesh+Poyarekar;st=author "Search for commits authored by Siddhesh Poyarekar") [<siddhesh@sourceware.org>](/git?p=glibc.git;a=search;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;s=siddhesh@sourceware.org;st=author "Search for commits authored by siddhesh@sourceware.org") |  |
| --- | --- | --- |
|  | Fri, 21 Jan 2022 18:02:56 +0000 (23:32 +0530) |
| committer | [Siddhesh Poyarekar](/git?p=glibc.git;a=search;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;s=Siddhesh+Poyarekar;st=committer "Search for commits committed by Siddhesh Poyarekar") [<siddhesh@sourceware.org>](/git?p=glibc.git;a=search;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;s=siddhesh@sourceware.org;st=committer "Search for commits committed by siddhesh@sourceware.org") |  |
|  | Mon, 24 Jan 2022 05:30:17 +0000 (11:00 +0530) |
| commit | 23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e |
| tree | [4ce71226b6ce414b7c5a08d6406e5506f2b32442](/git?p=glibc.git;a=tree;h=4ce71226b6ce414b7c5a08d6406e5506f2b32442;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [tree](/git?p=glibc.git;a=tree;h=4ce71226b6ce414b7c5a08d6406e5506f2b32442;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |
| parent | [6c2f050dbe11fb4ed0a401a5f25731f2aa53046b](/git?p=glibc.git;a=commit;h=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) | [commit](/git?p=glibc.git;a=commit;h=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) | [diff](/git?p=glibc.git;a=commitdiff;h=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;hp=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) |

getcwd: Set errno to ERANGE for size == 1 (CVE-2021-3999)

No valid path returned by getcwd would fit into 1 byte, so reject the

size early and return NULL with errno set to ERANGE.  This change is

prompted by CVE-2021-3999, which describes a single byte buffer

underflow and overflow when all of the following conditions are met:

- The buffer size (i.e. the second argument of getcwd) is 1 byte

- The current working directory is too long

- '/' is also mounted on the current working directory

Sequence of events:

- In sysdeps/unix/sysv/linux/getcwd.c, the syscall returns ENAMETOOLONG

  because the linux kernel checks for name length before it checks

  buffer size

- The code falls back to the generic getcwd in sysdeps/posix

- In the generic func, the buf[0] is set to '\0' on line 250

- this while loop on line 262 is bypassed:

    while (!(thisdev == rootdev && thisino == rootino))

  since the rootfs (/) is bind mounted onto the directory and the flow

  goes on to line 449, where it puts a '/' in the byte before the

  buffer.

- Finally on line 458, it moves 2 bytes (the underflowed byte and the

  '\0') to the buf[0] and buf[1], resulting in a 1 byte buffer overflow.

- buf is returned on line 469 and errno is not set.

This resolves BZ #28769.

Reviewed-by: Andreas Schwab <schwab@linux-m68k.org>

Reviewed-by: Adhemerval Zanella <adhemerval.zanella@linaro.org>

Signed-off-by: Qualys Security Advisory <qsa@qualys.com>

Signed-off-by: Siddhesh Poyarekar <siddhesh@sourceware.org>

| [NEWS](/git?p=glibc.git;a=blob;f=NEWS;h=07e9eac52d531afec15297ad546157d98c1c2c20;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |  | [diff](/git?p=glibc.git;a=blobdiff;f=NEWS;h=07e9eac52d531afec15297ad546157d98c1c2c20;hp=4c392a445e327e2d317ce62f2043b95a947a7ec8;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;hpb=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) | [blob](/git?p=glibc.git;a=blob;f=NEWS;h=07e9eac52d531afec15297ad546157d98c1c2c20;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [blame](/git?p=glibc.git;a=blame;f=NEWS;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [history](/git?p=glibc.git;a=history;f=NEWS;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |
| --- | --- | --- |
| [sysdeps/posix/getcwd.c](/git?p=glibc.git;a=blob;f=sysdeps/posix/getcwd.c;h=9d5787b6f42f272d64d9b7455153e6e28b51d1ad;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |  | [diff](/git?p=glibc.git;a=blobdiff;f=sysdeps/posix/getcwd.c;h=9d5787b6f42f272d64d9b7455153e6e28b51d1ad;hp=e147a31a816c4e12ec0540c386e3dd7e5ebaaf62;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;hpb=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) | [blob](/git?p=glibc.git;a=blob;f=sysdeps/posix/getcwd.c;h=9d5787b6f42f272d64d9b7455153e6e28b51d1ad;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [blame](/git?p=glibc.git;a=blame;f=sysdeps/posix/getcwd.c;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [history](/git?p=glibc.git;a=history;f=sysdeps/posix/getcwd.c;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |
| [sysdeps/unix/sysv/linux/Makefile](/git?p=glibc.git;a=blob;f=sysdeps/unix/sysv/linux/Makefile;h=7ca9350c99bd8b3ed95227e18e8188e8a34ee290;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |  | [diff](/git?p=glibc.git;a=blobdiff;f=sysdeps/unix/sysv/linux/Makefile;h=7ca9350c99bd8b3ed95227e18e8188e8a34ee290;hp=85fc8cbf7566314874d316f93e5f1421f36f46b8;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e;hpb=6c2f050dbe11fb4ed0a401a5f25731f2aa53046b) | [blob](/git?p=glibc.git;a=blob;f=sysdeps/unix/sysv/linux/Makefile;h=7ca9350c99bd8b3ed95227e18e8188e8a34ee290;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [blame](/git?p=glibc.git;a=blame;f=sysdeps/unix/sysv/linux/Makefile;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [history](/git?p=glibc.git;a=history;f=sysdeps/unix/sysv/linux/Makefile;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |
| [sysdeps/unix/sysv/linux/tst-getcwd-smallbuff.c](/git?p=glibc.git;a=blob;f=sysdeps/unix/sysv/linux/tst-getcwd-smallbuff.c;h=d460d6e7662dc5e451cb8e76e96855a7527ba06d;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) | [new file with mode: 0644] | [blob](/git?p=glibc.git;a=blob;f=sysdeps/unix/sysv/linux/tst-getcwd-smallbuff.c;h=d460d6e7662dc5e451cb8e76e96855a7527ba06d;hb=23e0e8f5f1fb5ed150253d986ecccdc90c2dcd5e) |

GNU C Library master sources
[RSS](/git?p=glibc.git;a=rss "log RSS feed")
[Atom](/git?p=glibc.git;a=atom "log Atom feed")

This page took 0.043338 seconds  and 6 git commands to generate.

