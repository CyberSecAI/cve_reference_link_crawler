

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Christian Marangi <ansuelsmth@gmail.com> | 2024-10-04 20:27:58 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:24:35 +0200 |
| commit | [143ffa7878e2d9d9c3836ee8304ce4930f7852a3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)) | |
| tree | [663babadd8a4793129abbb4a2da85f021d282146](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3) | |
| parent | [28a2c3e51d097975521ca9ffbd8b82ea7b8cdc14](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28a2c3e51d097975521ca9ffbd8b82ea7b8cdc14) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3&id2=28a2c3e51d097975521ca9ffbd8b82ea7b8cdc14)) | |
| download | [linux-143ffa7878e2d9d9c3836ee8304ce4930f7852a3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-143ffa7878e2d9d9c3836ee8304ce4930f7852a3.tar.gz) | |

net: phy: Remove LED entry from LEDs list on unregistercommit f50b5d74c68e551667e265123659b187a30fe3a5 upstream.
Commit c938ab4da0eb ("net: phy: Manual remove LEDs to ensure correct
ordering") correctly fixed a problem with using devm\_ but missed
removing the LED entry from the LEDs list.
This cause kernel panic on specific scenario where the port for the PHY
is torn down and up and the kmod for the PHY is removed.
On setting the port down the first time, the assosiacted LEDs are
correctly unregistered. The associated kmod for the PHY is now removed.
The kmod is now added again and the port is now put up, the associated LED
are registered again.
On putting the port down again for the second time after these step, the
LED list now have 4 elements. With the first 2 already unregistered
previously and the 2 new one registered again.
This cause a kernel panic as the first 2 element should have been
removed.
Fix this by correctly removing the element when LED is unregistered.
Reported-by: Daniel Golle <daniel@makrotopia.org>
Tested-by: Daniel Golle <daniel@makrotopia.org>
Cc: stable@vger.kernel.org
Fixes: c938ab4da0eb ("net: phy: Manual remove LEDs to ensure correct ordering")
Signed-off-by: Christian Marangi <ansuelsmth@gmail.com>
Reviewed-by: Andrew Lunn <andrew@lunn.ch>
Link: [https://patch.msgid.link/20241004182759.14032-1-ansuelsmth@gmail.com](https://patch.msgid.link/20241004182759.14032-1-ansuelsmth%40gmail.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)

| -rw-r--r-- | [drivers/net/phy/phy\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/phy/phy_device.c?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 2 deletions

| diff --git a/drivers/net/phy/phy\_device.c b/drivers/net/phy/phy\_device.cindex 2e4bff6055e223..ec2a3d16b1a2da 100644--- a/[drivers/net/phy/phy\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/phy/phy_device.c?id=28a2c3e51d097975521ca9ffbd8b82ea7b8cdc14)+++ b/[drivers/net/phy/phy\_device.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/phy/phy_device.c?id=143ffa7878e2d9d9c3836ee8304ce4930f7852a3)@@ -3082,10 +3082,11 @@ static \_\_maybe\_unused int phy\_led\_hw\_is\_supported(struct led\_classdev \*led\_cdev,  static void phy\_leds\_unregister(struct phy\_device \*phydev) {- struct phy\_led \*phyled;+ struct phy\_led \*phyled, \*tmp; - list\_for\_each\_entry(phyled, &phydev->leds, list) {+ list\_for\_each\_entry\_safe(phyled, tmp, &phydev->leds, list) { led\_classdev\_unregister(&phyled->led\_cdev);+ list\_del(&phyled->list); } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:58:33 +0000

