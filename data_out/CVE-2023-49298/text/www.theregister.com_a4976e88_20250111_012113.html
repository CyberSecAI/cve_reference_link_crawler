

[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_extents_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_filled_extents_16x16.png)
Sign in / up](https://account.theregister.com/register/)

[![The Register® — Biting the hand that feeds IT](/design_picker/fa16d26efb42e6ba1052f1d387470f643c5aa18d/graphics/std/reg_logo_no_strapline.png)](https://www.theregister.com/)

[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/magnifying_glass_white_extents_16x16.png)](https://search.theregister.com/)

![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_close_16x16.png)

## Topics

[Security](#subnav-box-nav-security)
## [Security](#subnav-box-nav-security)

[All Security](https://www.theregister.com/security/)[Cyber-crime](https://www.theregister.com/security/cyber_crime/)[Patches](https://www.theregister.com/security/patches/)[Research](https://www.theregister.com/security/research/)[CSO](https://www.theregister.com/security/cso/)
[(X)](#masthead)

[Off-Prem](#subnav-box-nav-off_prem)
## [Off-Prem](#subnav-box-nav-off_prem)

[All Off-Prem](https://www.theregister.com/off_prem/)[Edge + IoT](https://www.theregister.com/off_prem/edge_iot/)[Channel](https://www.theregister.com/off_prem/channel/)[PaaS + IaaS](https://www.theregister.com/off_prem/paas_iaas/)[SaaS](https://www.theregister.com/off_prem/saas/)
[(X)](#masthead)

[On-Prem](#subnav-box-nav-on_prem)
## [On-Prem](#subnav-box-nav-on_prem)

[All On-Prem](https://www.theregister.com/on_prem/)[Systems](https://www.theregister.com/on_prem/systems/)[Storage](https://www.theregister.com/on_prem/storage/)[Networks](https://www.theregister.com/on_prem/networks/)[HPC](https://www.theregister.com/on_prem/hpc/)[Personal Tech](https://www.theregister.com/on_prem/personal_tech/)[CxO](https://www.theregister.com/on_prem/cxo/)[Public Sector](https://www.theregister.com/on_prem/public_sector/)
[(X)](#masthead)

[Software](#subnav-box-nav-software)
## [Software](#subnav-box-nav-software)

[All Software](https://www.theregister.com/software/)[AI + ML](https://www.theregister.com/software/ai_ml/)[Applications](https://www.theregister.com/software/applications/)[Databases](https://www.theregister.com/software/databases/)[DevOps](https://www.theregister.com/software/devops/)[OSes](https://www.theregister.com/software/oses/)[Virtualization](https://www.theregister.com/software/virtualization/)
[(X)](#masthead)

[Offbeat](#subnav-box-nav-offbeat)
## [Offbeat](#subnav-box-nav-offbeat)

[All Offbeat](https://www.theregister.com/offbeat/)[Debates](https://www.theregister.com/Debates/)[Columnists](https://www.theregister.com/offbeat/columnists/)[Science](https://www.theregister.com/offbeat/science/)[Geek's Guide](https://www.theregister.com/offbeat/geeks_guide/)[BOFH](https://www.theregister.com/offbeat/bofh/)[Legal](https://www.theregister.com/offbeat/legal/)[Bootnotes](https://www.theregister.com/offbeat/bootnotes/)[Site News](https://www.theregister.com/offbeat/site_news/)[About Us](https://www.theregister.com/offbeat/about_us/)
[(X)](#masthead)

[Special Features](#subnav-box-nav-special_features)
## Special Features

[All Special Features](https://www.theregister.com/special_features)
[The Future of the Datacenter](https://www.theregister.com/special_features/future_of_the_datacenter)
[Cybersecurity Month](https://www.theregister.com/special_features/cybersecurity_month)
[VMware Explore](https://www.theregister.com/special_features/vmware_explore)
[Cloud Infrastructure Month](https://www.theregister.com/special_features/cloud_infrastructure_month)

## Vendor Voice

[Vendor Voice](#subnav-box-nav-tag-vendor-voice)
## [Vendor Voice](#subnav-box-nav-tag-vendor-voice)

[All Vendor Voice](https://www.theregister.com/VendorVoice/)
[Pure Storage](https://www.theregister.com/VendorVoice/pure_storage_portworx/)
[Kilka Tech](https://www.theregister.com/VendorVoice/aws_klika_tech/)
[HERE and AWS](https://www.theregister.com/VendorVoice/aws_here/)
[Vonage](https://www.theregister.com/VendorVoice/aws_vonage/)
[GE Vernova with AWS](https://www.theregister.com/VendorVoice/aws_ge_vernova_manufacturing/)
[Amazon Web Services (AWS) New Horizon in Cloud Computing](https://www.theregister.com/VendorVoice/aws_new_horizon_solutions/)
[DDN](https://www.theregister.com/VendorVoice/ddn/)
[Google Cloud Data Transformation](https://www.theregister.com/VendorVoice/google_cloud_data_transformation/)
[Google Gemini](https://www.theregister.com/VendorVoice/google_gemini/)
[Hewlett Packard Enterprise: Edge-to-Cloud Platform](https://www.theregister.com/VendorVoice/hpe_greenlake/)
[Intel vPro](https://www.theregister.com/VendorVoice/intelvpro/)
[VMware](https://www.theregister.com/VendorVoice/vmware/)
[(X)](#masthead)

[Resources](#subnav-box-nav-resources)
## Resources

[Whitepapers](https://whitepapers.theregister.com/)
[Webinars & Events](https://whitepapers.theregister.com/events/list/)
[Newsletters](https://account.theregister.com/edit/newsletter/)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

#### [Security](/security/)

[**4**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2023/12/04/two_new_versions_of_openzfs/ "View comments on this article")

This article is more than **1 year old**

# Two new versions of OpenZFS fix long-hidden corruption bug

[**4**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2023/12/04/two_new_versions_of_openzfs/ "View comments on this article")

## Version 2.2.2 and also 2.1.14, showing that this wasn't a new issue in the latest release

![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_red.svg)
[Liam Proven](/Author/Liam-Proven "Read more by this author")

Mon 4 Dec 2023  //
16:15 UTC

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)

The bug that was very occasionally corrupting data on file copies in OpenZFS 2.2.0 has been identified and fixed, and there's a fix for the previous OpenZFS release too.

The OpenZFS development team have put out not one but two new releases of the open-source cross-platform filesystem for Linux and FreeBSD. [Version 2.2.2](https://github.com/openzfs/zfs/releases/tag/zfs-2.2.2) fixes the problem that showed up in the latest version, which is included in FreeBSD 14 as well as several Linux distros, including Ubuntu 23.10. There's also a new release in the previous version of OpenZFS: [version 2.1.14](https://github.com/openzfs/zfs/releases/tag/zfs-2.1.14) which applies to FreeBSD back to version 12.

This was necessary because while, as we [reported a week ago](https://www.theregister.com/2023/11/27/openzfs_2_2_0_data_corruption/), it was OpenZFS 2.2.0 that brought the issue to light and made it visible, it didn't actually *cause* the problem. It merely exposed an underlying bug which had been around for years: OpenZFS 2.2.0's new, faster copy function simply made the existing issue much more likely to happen. The FreeBSD project has [published an errata notice](https://www.freebsd.org/security/advisories/FreeBSD-EN-23%3A16.openzfs.asc), and made fixes available for FreeBSD 12, 13 and 14.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

The investigation that's been going on since then has revealed more. For instance, the bug was also [confirmed](https://www.illumos.org/issues/16087) in Illumos, the open-source fork of OpenSolaris which has continued development since [Oracle killed off the open source project](https://www.theregister.com/2010/08/13/opensolaris_is_dead/) in 2010. Illumos is itself the basis of [several OpenSolaris-based distributions](https://www.theregister.com/2022/12/07/new_version_of_openindiana/).

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D426raptor%3Dfalcon%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D4%26raptor%3Dfalcon%26pos%3Dmid%26test%3D0)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)

As amendments in the release notes for both these versions clarify, it's also slightly worse than it looked last week, when we wrote that:

> For Linux users, an additional condition seems to be that the OS has a recent version of the `coreutils` package – above version 9.x.

This looked to be the case because the `cp` command in Coretils 9 was updated to look for ways to speed up file copies, such as checking for "holes" in files – long stretches of zeroes – called the [SEEK\_HOLE optimization](https://lwn.net/Articles/440255/). Unfortunately, it looks like Red Hat backported this functionality from Coreutils 9.x to 8.x, and it's [been identified](https://github.com/openzfs/zfs/issues/15526#issuecomment-1835465225) in CentOS Stream 9 as well as in the [OpenELA source code](https://gitlab.com/redhat/centos-stream/rpms/coreutils/-/blob/c9s/coreutils-8.32-cp-file-range.patch?ref_type=heads). As the code comment dryly says:

> I'd link to the corresponding RHEL code, but sadly they no longer publish it.

RHEL doesn't include OpenZFS, so this data-loss issue will not affect it. Indeed, RHEL [doesn't even include Btrfs](https://www.theregister.com/2017/08/16/red_hat_banishes_btrfs_from_rhel/)… but [Oracle Linux does](https://www.theregister.com/2022/07/12/oracle_linux_9/), although that's no cause for concern here: Btrfs itself is immune from the bug.

* [Researcher bags two-for-one deal on Linux bugs while probing GNOME component](https://www.theregister.com/2023/10/10/linux_gnome_libcue_exploit/)
* [Red Hat bins Bugzilla for RHEL issue tracking, jumps on Jira](https://www.theregister.com/2023/09/29/red_hat_bugzilla_jira_migration/)
* [Nearly every AMD CPU since 2017 vulnerable to Inception data-leak attacks](https://www.theregister.com/2023/08/09/amd_inception/)
* [Alarm raised over Mozilla VPN: Wonky authorization check lets users cause havoc](https://www.theregister.com/2023/08/04/mozilla_vpn_linux_flaw/)

What this illustrates, though, is the problem with trying to pin down affected versions. As we [described back in June](https://www.theregister.com/2023/06/30/enterprise_distro_feature_devconf/), Red Hat puts a lot of engineering time and effort into backporting features from newer kernels into its very-long-term supported enterprise kernels. Sometimes, these backports may not be limited to the kernel: they may extend to non-kernel system utilities. These optimizations are perfectly safe on the Big Purple Hat's own distro, and indeed its RHELatives such as Oracle and Alma and so on. However, such changes can get picked up by other distros, or even by people hand-building complex bespoke installations. The result is that it's not safe to simply say *"this only affects systems with coreutils 9 or above"*.

At any rate, for now, the issue is fixed. There's a newer [overview of the issue](https://gist.github.com/rincebrain/e23b4a39aba3fadc04db18574d30dc73) on Github, but the investigation as to when the bug first appeared is still underway, as the comments there show (along with a link to our earlier story).

The bug might go back as far as 2006. Although [bug fix #15571](https://github.com/openzfs/zfs/pull/15571) in these two new OpenZFS releases does resolve the issue, another, newer attempt to fix the issue in a cleaner way is *also* under investigation as [bug fix #15615](https://github.com/openzfs/zfs/pull/15615). ZFS is a complex filesystem, and this is a complex bug that may have remained hidden for 17 years. If there is a simpler, cleaner way to fix the issue, that would be a good thing.

**Get our** [Tech Resources](https://whitepapers.theregister.com/)

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

#### More about

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

[**4**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)
COMMENTS](https://forums.theregister.com/forum/all/2023/12/04/two_new_versions_of_openzfs/ "View comments on this article")

#### TIP US OFF

[Send us news](https://www.theregister.com/Profile/contact/)

---

### Other stories you might like

[#### Google and Linux Foundation form Chromium love club

Right as Uncle Sam pushes for Chrome sell-off, eh?
Applications10 Jan 2025 | 1](/2025/01/10/google_linux_foundation_chromium/?td=keepreading)

[#### Chinese cyber-spies peek over shoulder of officials probing real-estate deals near American military bases

Gee, wonder why Beijing is so keen on the – checks notes – Committee on Foreign Investment in the US
Cyber-crime10 Jan 2025 | 2](/2025/01/10/china_treasury_foreign_investment/?td=keepreading)

[#### Tongue-zapping spoons, tea-cooling catbots, lazy vacuums and more from CES

CES All the consumer electronics weirdness you didn't want to see in person anyway
Personal Tech10 Jan 2025 | 3](/2025/01/10/ces_weird_gadgets/?td=keepreading)

[#### Fortify your data

How cyber resilient storage hardware can defeat ransomware
Sponsored Feature](/2024/11/26/fortify_your_data/?td=keepreading)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_security/front&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z4HHidFJjItPH3TcefDeyAAAAMY&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)

[#### Azure networking snafu enters day 2, some services still limping

Struggling to connect to the cloud? You’re not alone
Off-Prem10 Jan 2025 | 7](/2025/01/10/microsoft_azure_networking_snafu/?td=keepreading)

[#### Blue Origin postpones New Glenn's maiden flight to January 12

Now set for the day before SpaceX's next Starship test
Science10 Jan 2025 | 22](/2025/01/10/blue_origin_new_glenn/?td=keepreading)

[#### Drug addiction treatment service admits attackers stole sensitive patient data

Details of afflictions and care plastered online
Cyber-crime10 Jan 2025 | 4](/2025/01/10/baymark_data_breach/?td=keepreading)

[#### New Outlook marches onto Windows 10 for what little time it has left

Users of doomed operating system to receive unloved app via an update
OSes10 Jan 2025 | 24](/2025/01/10/new_outlook_windows_10/?td=keepreading)

[#### Free-software warriors celebrate landmark case that enforced GNU LGPL

On the Fritz: German router maker AVM lets device rights case end after coughing up source code
Software10 Jan 2025 | 19](/2025/01/10/german_router_maker_avm_lgpl/?td=keepreading)

[#### BOFH: Forecasting and the fine art of desktop upgrades

Episode 1 New year, new PC
BOFH10 Jan 2025 | 32](/2025/01/10/bofh_2025_episode_1/?td=keepreading)

[#### Scammers exploit UK's digital landline switch to swipe cash

Old deadline of January 2025 being used to push victims into paying up
Networks10 Jan 2025 | 29](/2025/01/10/digital_landline_switch_scam/?td=keepreading)

[#### Mail-out madness as insurer offers refunds to customers in error

Hastings has a mystery to solve – how did all those customers get offered refunds?
Databases10 Jan 2025 | 40](/2025/01/10/hastings_direct_mailout_error/?td=keepreading)

The Register ![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_white.png) Biting the hand that feeds IT

#### About Us

* [Contact us](https://www.theregister.com/Profile/contact/)
* [Advertise with us](https://www.theregister.com/AdvertiseWithUs/)
* [Who we are](https://www.theregister.com/Profile/about_the_register/)

#### Our Websites

* [The Next Platform](https://www.nextplatform.com/)
* [DevClass](https://devclass.com/)
* [Blocks and Files](https://blocksandfiles.com/)

#### Your Privacy

* [Cookies Policy](https://www.theregister.com/Profile/cookies/)
* [Privacy Policy](https://www.theregister.com/Profile/privacy/)
* [Ts & Cs](https://www.theregister.com/Profile/terms_and_conditions_of_use/)

[![Situation Publishing](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/std/sitpublogo_2022.png)](https://situationpublishing.com/)

Copyright. All rights reserved © 1998–2025

![no-js](/Design/graphics/std/transparent_pixel.png)

