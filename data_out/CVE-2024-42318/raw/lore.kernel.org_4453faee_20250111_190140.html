<html><head><title>Landlock Houdini fix: CVE-2024-42318 - Micka&#235;l Sala&#252;n</title><link
rel=alternate
title="Atom feed"
href="../new.atom"
type="application/atom+xml"/><style>pre{white-space:pre-wrap}*{font-size:100%;font-family:monospace}</style><link
type=text/css
rel=stylesheet
href=../216light.css?66c655cb
media=screen,print /><link
type=text/css
rel=stylesheet
media="screen and (prefers-color-scheme:dark)"
href=../216dark.css?66c655cb /></head><body><form
action="../"><pre><a
href="../?t=20240817161518"><b>All of lore.kernel.org</b></a>
<input
name=q
type=text /><input
type=submit
value=search /> <a
href="../_/text/help/">help</a> / <a
href="../_/text/color/">color</a> / <a
id=mirror
href="../_/text/mirror/">mirror</a> / <a
href="../new.atom">Atom feed</a></pre></form><pre
id=b>From: &#34;Micka&#235;l Sala&#252;n&#34; &lt;mic@digikod.net&gt;
To: <a
href="../../landlock/?t=20240817161518">landlock@lists.linux.dev</a>, oss-security@lists.openwall.com
Cc: &#34;Jann Horn&#34; &lt;jannh@google.com&gt;,
	&#34;G&#252;nther Noack&#34; &lt;gnoack@google.com&gt;,
	&#34;Paul Moore&#34; &lt;paul@paul-moore.com&gt;,
	&#34;Greg Kroah-Hartman&#34; &lt;gregkh@linuxfoundation.org&gt;,
	<a
href="../../linux-security-module/?t=20240817161518">linux-security-module@vger.kernel.org</a>
Subject: <a
href="#r"
id=t>Landlock Houdini fix: CVE-2024-42318</a>
Date: Sat, 17 Aug 2024 17:56:11 +0200	<a
href="#r">[thread overview]</a>
Message-ID: &lt;20240817.shahka3Ee1iy@digikod.net&gt; (<a href="raw">raw</a>)
In-Reply-To: &lt;<a
href="../2024081754-CVE-2024-42318-f0c9@gregkh/">2024081754-CVE-2024-42318-f0c9@gregkh</a>&gt;

Hi,

On July 24, Jann Horn reported [1] a security issue in Landlock [2].  He
provided a fix and a proof of concept.  Many thanks for all this work!
He discovered a logical bug that makes it possible for a process to
escape its sandbox and bypass any Landlock restrictions.  This is due to
a missing LSM hook implementation for the special case of keyctl(2)&#39;s
KEYCTL_SESSION_TO_PARENT.  This issue is now identified as
CVE-2024-42318 [2].

[1] <a
href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2566">https://bugs.chromium.org/p/project-zero/issues/detail?id=2566</a>
[2] <a
href="https://landlock.io/">https://landlock.io/</a>
[3] <a
href="https://cve.org/CVERecord/?id=CVE-2024-42318">https://cve.org/CVERecord/?id=CVE-2024-42318</a>

The issue was fixed a few hours later [4] and we developed a dedicated
test [5] to make sure the fix works as expected and that the issue never
happens again. This was merged in Linux 6.11-rc1 [6] published July 28.

[4] <a
href="https://git.kernel.org/torvalds/c/39705a6c29f8a2b93cf5b99528a55366c50014d1">https://git.kernel.org/torvalds/c/39705a6c29f8a2b93cf5b99528a55366c50014d1</a>
[5] <a
href="https://git.kernel.org/torvalds/c/cc374782b6ca0fd634482391da977542443d3368">https://git.kernel.org/torvalds/c/cc374782b6ca0fd634482391da977542443d3368</a>
[6] <a
href="https://git.kernel.org/torvalds/c/86b405ad8d0d2994a7ffbacb8fcf83be8afb952c">https://git.kernel.org/torvalds/c/86b405ad8d0d2994a7ffbacb8fcf83be8afb952c</a>

The fix has also been backported to:
- Linux 6.10.3 (released on August 3)
- Linux 6.6.44 (released on August 3)
- Linux 6.1.103 (released on August 3)
- Linux 5.15.165 (will be released in a few days, but in the meantime
  you can cherry-pick
  <a
href="https://git.kernel.org/stable/c/0d74fd54db0bd0c0c224bef0da8fc95ea9c9f36c">https://git.kernel.org/stable/c/0d74fd54db0bd0c0c224bef0da8fc95ea9c9f36c</a>)

This vulnerability only impacts sandboxing put in place by Landlock, but
the kernel is not at risk, nor system services.  The impact is limited
thanks to the stackable LSM infrastructure.

To fix this vulnerability, only the kernel needs to be updated, not the
sandboxed programs which will automatically be well-sandboxed with an
up-to-date kernel.  Sandboxing with Landlock is really an investment to
leverage current and future Landlock features.

To exploit this vulnerability, an attacker needs to have full code
execution including the ability to perform arbitrary syscalls,
especially keyctl(2).  Complementary security mechanisms can be put in
place to avoid arbitrary code execution or arbitrary syscalls (e.g.
with seccomp filters).

To test the fix, here are simple steps to run on an up-to-date kernel
source tree (Linux 6.6.44 to run these tests with an unprivileged user):
  make alldefconfig
  make TARGETS=landlock kselftest-install
  ./tools/testing/selftests/kselftest_install/landlock/base_test
  # The global.cred_transfer test should pass.

Landlock is a defense-in-depth security mechanism.  Even if it is
already useful to protect users and applications, it should not be the
only security layer for the system, mainly because it is not a full
feature access control system yet.  As explained in the documentation
[7], some actions may not be restricted yet, which may also be the case
for other security modules.  We are working to extend the access control
types [8], but it takes time and resources to build a new unprivileged
access control system properly handling Linux specificities.

[7] <a
href="https://docs.kernel.org/userspace-api/landlock.html#filesystem-flags">https://docs.kernel.org/userspace-api/landlock.html#filesystem-flags</a>
[8] <a
href="https://github.com/orgs/landlock-lsm/projects/1">https://github.com/orgs/landlock-lsm/projects/1</a>

Looking at the other side, it is interesting to note that Landlock can
also limit the impact of similar potential vulnerabilities affecting
other access control systems.

This issue also started a discussion to improve (or remove) the
KEYCTL_SESSION_TO_PARENT special case [9].

[9] <a
href="https://lore.kernel.org/r/20240805-remove-cred-transfer-v2-0-a2aa1d45e6b8@google.com">https://lore.kernel.org/r/20240805-remove-cred-transfer-v2-0-a2aa1d45e6b8@google.com</a>

We are two official reviewers for Landlock, but contributors and other
reviewers such as Jann (who previously reviewed the initial Landlock
code) also work on making changes as safe and secure as possible.  The
Linux kernel needs more eyes, time, and experts to proactively find
these kind of issues.  If you are interested, reward programs [10] may
help.

[10] <a
href="https://alpha-omega.dev/">https://alpha-omega.dev/</a>

Regards,
 Micka&#235;l
</pre><hr><pre>     <a
href="../2024081754-CVE-2024-42318-f0c9@gregkh/"
rel=prev>prev parent</a> <a
href="#R">reply</a><a id=related>	</a>other threads:[<a
href="../?t=20240817161518">~2024-08-17 16:15 UTC</a>|<a
href="../">newest</a>]

<b>Thread overview: </b>2+ messages / expand[<a
href="T/#u">flat</a>|<a
href="t/#u">nested</a>]  <a
href="t.mbox.gz">mbox.gz</a>  <a
href="t.atom">Atom feed</a>  <a
href="#b">top</a>
2024-08-17  9:10 <a
href="../2024081754-CVE-2024-42318-f0c9@gregkh/">CVE-2024-42318: landlock: Don&#39;t lose track of restrictions on cred_transfer</a> Greg Kroah-Hartman
<b>2024-08-17 15:56 ` <a
id=r
href="#t">Micka&#235;l Sala&#252;n [this message]</a></b>
</pre><hr><pre
id=R><b>Reply instructions:</b>

You may reply publicly to <a
href=#t>this message</a> via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: <a
href=raw>mbox</a>

  Avoid top-posting and favor interleaved quoting:
  <a
href="https://en.wikipedia.org/wiki/Posting_style#Interleaved_style">https://en.wikipedia.org/wiki/Posting_style#Interleaved_style</a>

* Reply using the <b>--to</b>, <b>--cc</b>, and <b>--in-reply-to</b>
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20240817.shahka3Ee1iy@digikod.net \
    --to=mic@digikod.net \
    --cc=gnoack@google.com \
    --cc=gregkh@linuxfoundation.org \
    --cc=jannh@google.com \
    --cc=landlock@lists.linux.dev \
    --cc=linux-security-module@vger.kernel.org \
    --cc=oss-security@lists.openwall.com \
    --cc=paul@paul-moore.com \
    /path/to/YOUR_REPLY

  <a
href="https://kernel.org/pub/software/scm/git/docs/git-send-email.html">https://kernel.org/pub/software/scm/git/docs/git-send-email.html</a>

* If your mail client supports setting the <b>In-Reply-To</b> header
  via mailto: links, try the <a
href="mailto:mic@digikod.net?In-Reply-To=%3C20240817.shahka3Ee1iy@digikod.net%3E&#38;Cc=gnoack%40google.com%2Cgregkh%40linuxfoundation.org%2Cjannh%40google.com%2Clandlock%40lists.linux.dev%2Clinux-security-module%40vger.kernel.org%2Coss-security%40lists.openwall.com%2Cpaul%40paul-moore.com&#38;Subject=Re%3A%20Landlock%20Houdini%20fix%3A%20CVE-2024-42318">mailto: link</a>
</pre>

  Be sure your reply has a <b>Subject:</b> header at the top and a blank line
  before the message body.
<hr><pre>This is an external index of several public inboxes,
see <a href="../_/text/mirror/">mirroring instructions</a> on how to clone and mirror
all data and code used by this external index.</pre></body></html>