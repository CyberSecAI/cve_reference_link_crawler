- **Root cause of vulnerability:** The `host_deny` script in Wazuh does not properly validate the input IP address (`srcip`) before writing it to the `/etc/hosts.deny` file. This allows an attacker to inject arbitrary commands into the file.
- **Weaknesses/vulnerabilities present:** Command injection vulnerability due to lack of input validation. The `host_deny` script takes the `srcip` from a JSON message without any sanitization before adding it to the `/etc/hosts.deny` file. This allows an attacker to insert commands using the `spawn` directive in `hosts.deny`.
- **Impact of exploitation:** Arbitrary command execution as root on the Wazuh agent or server. An attacker can gain complete control over the affected system.
- **Attack vectors:** The vulnerability can be triggered by writing events to either the local `execd` queue on the server, or the `ar` queue, which forwards the events to the agents. This means it can lead to both local privilege escalation (LPE) on the server and remote code execution (RCE) on the agents, both as root.
- **Required attacker capabilities/position:** An attacker needs to be able to send a crafted JSON message containing malicious content as the `srcip` value to trigger an active response, either through the server or directly to an agent. The attacker requires low privileges to execute this attack.