

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kent Overstreet <kent.overstreet@gmail.com> | 2021-02-12 20:11:25 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-28 17:06:54 +0000 |
| commit | [784d01f9bbc282abb0c5ade5beb98a87f50343ac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)) | |
| tree | [89e0bab660f9bd5e84ec478e064e73696359ff09](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac) | |
| parent | [c56df79d68677cf062da1b6e3b33e74299a92dfc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c56df79d68677cf062da1b6e3b33e74299a92dfc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac&id2=c56df79d68677cf062da1b6e3b33e74299a92dfc)) | |
| download | [linux-784d01f9bbc282abb0c5ade5beb98a87f50343ac.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-784d01f9bbc282abb0c5ade5beb98a87f50343ac.tar.gz) | |

lib/generic-radix-tree.c: Don't overflow in peek()[ Upstream commit 9492261ff2460252cf2d8de89cdf854c7e2b28a0 ]
When we started spreading new inode numbers throughout most of the 64
bit inode space, that triggered some corner case bugs, in particular
some integer overflows related to the radix tree code. Oops.
Signed-off-by: Kent Overstreet <kent.overstreet@gmail.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)

| -rw-r--r-- | [include/linux/generic-radix-tree.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/generic-radix-tree.h?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [lib/generic-radix-tree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/generic-radix-tree.c?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac) | 17 | |  |  |  | | --- | --- | --- | |

2 files changed, 21 insertions, 3 deletions

| diff --git a/include/linux/generic-radix-tree.h b/include/linux/generic-radix-tree.hindex 107613f7d79202..f6cd0f909d9fb9 100644--- a/[include/linux/generic-radix-tree.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/generic-radix-tree.h?id=c56df79d68677cf062da1b6e3b33e74299a92dfc)+++ b/[include/linux/generic-radix-tree.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/generic-radix-tree.h?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)@@ -38,6 +38,7 @@  #include <asm/page.h> #include <linux/bug.h>+#include <linux/limits.h> #include <linux/log2.h> #include <linux/math.h> #include <linux/types.h>@@ -184,6 +185,12 @@ void \*\_\_genradix\_iter\_peek(struct genradix\_iter \*, struct \_\_genradix \*, size\_t); static inline void \_\_genradix\_iter\_advance(struct genradix\_iter \*iter, size\_t obj\_size) {+ if (iter->offset + obj\_size < iter->offset) {+ iter->offset = SIZE\_MAX;+ iter->pos = SIZE\_MAX;+ return;+ }+ iter->offset += obj\_size;  if (!is\_power\_of\_2(obj\_size) &&diff --git a/lib/generic-radix-tree.c b/lib/generic-radix-tree.cindex f25eb111c0516f..7dfa88282b006a 100644--- a/[lib/generic-radix-tree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/generic-radix-tree.c?id=c56df79d68677cf062da1b6e3b33e74299a92dfc)+++ b/[lib/generic-radix-tree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/generic-radix-tree.c?id=784d01f9bbc282abb0c5ade5beb98a87f50343ac)@@ -166,6 +166,10 @@ void \*\_\_genradix\_iter\_peek(struct genradix\_iter \*iter, struct genradix\_root \*r; struct genradix\_node \*n; unsigned level, i;++ if (iter->offset == SIZE\_MAX)+ return NULL;+ restart: r = READ\_ONCE(radix->root); if (!r)@@ -184,10 +188,17 @@ restart: (GENRADIX\_ARY - 1);  while (!n->children[i]) {+ size\_t objs\_per\_ptr = genradix\_depth\_size(level);++ if (iter->offset + objs\_per\_ptr < iter->offset) {+ iter->offset = SIZE\_MAX;+ iter->pos = SIZE\_MAX;+ return NULL;+ }+ i++;- iter->offset = round\_down(iter->offset +- genradix\_depth\_size(level),- genradix\_depth\_size(level));+ iter->offset = round\_down(iter->offset + objs\_per\_ptr,+ objs\_per\_ptr); iter->pos = (iter->offset >> PAGE\_SHIFT) \* objs\_per\_page; if (i == GENRADIX\_ARY) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:14:03 +0000

