

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dragos Tatulea <dtatulea@nvidia.com> | 2022-11-25 17:51:19 +0200 |
| --- | --- | --- |
| committer | Saeed Mahameed <saeedm@nvidia.com> | 2023-01-09 22:08:34 -0800 |
| commit | [31c70bfe58ef09fe36327ddcced9143a16e9e83d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)) | |
| tree | [de94ff037e80224648db0868082c1f28c87d0230](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d) | |
| parent | [806a8df7126a8c05d60411eeb81057c2a8bbe7a7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=806a8df7126a8c05d60411eeb81057c2a8bbe7a7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d&id2=806a8df7126a8c05d60411eeb81057c2a8bbe7a7)) | |
| download | [linux-31c70bfe58ef09fe36327ddcced9143a16e9e83d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31c70bfe58ef09fe36327ddcced9143a16e9e83d.tar.gz) | |

net/mlx5e: IPoIB, Block PKEY interfaces with less rx queues than parentA user is able to configure an arbitrary number of rx queues when
creating an interface via netlink. This doesn't work for child PKEY
interfaces because the child interface uses the parent receive channels.
Although the child shares the parent's receive channels, the number of
rx queues is important for the channel\_stats array: the parent's rx
channel index is used to access the child's channel\_stats. So the array
has to be at least as large as the parent's rx queue size for the
counting to work correctly and to prevent out of bound accesses.
This patch checks for the mentioned scenario and returns an error when
trying to create the interface. The error is propagated to the user.
Fixes: be98737a4faa ("net/mlx5e: Use dynamic per-channel allocations in stats")
Signed-off-by: Dragos Tatulea <dtatulea@nvidia.com>
Reviewed-by: Tariq Toukan <tariqt@nvidia.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.cindex 28795fb6bccc3f..03e681297937f8 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=806a8df7126a8c05d60411eeb81057c2a8bbe7a7)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=31c70bfe58ef09fe36327ddcced9143a16e9e83d)@@ -168,6 +168,15 @@ static int mlx5i\_pkey\_dev\_init(struct net\_device \*dev) return -EINVAL; } + if (dev->num\_rx\_queues < parent\_dev->real\_num\_rx\_queues) {+ mlx5\_core\_warn(priv->mdev,+ "failed to create child device with rx queues [%d] less than parent's [%d]\n",+ dev->num\_rx\_queues,+ parent\_dev->real\_num\_rx\_queues);+ mlx5i\_parent\_put(dev);+ return -EINVAL;+ }+ /\* Get QPN to netdevice hash table from parent \*/ parent\_ipriv = netdev\_priv(parent\_dev); ipriv->qpn\_htbl = parent\_ipriv->qpn\_htbl; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:46:23 +0000

