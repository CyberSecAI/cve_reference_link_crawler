

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dragos Tatulea <dtatulea@nvidia.com> | 2022-11-25 17:51:19 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:58:30 +0100 |
| commit | [5844a46f09f768da866d6b0ffbf1a9073266bf24](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)) | |
| tree | [23c2cc4cd05522e9212cb4f60067f1ea5c5b93de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24) | |
| parent | [b5f108e202b74b3641dfcfcbacea096e159760dc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5f108e202b74b3641dfcfcbacea096e159760dc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24&id2=b5f108e202b74b3641dfcfcbacea096e159760dc)) | |
| download | [linux-5844a46f09f768da866d6b0ffbf1a9073266bf24.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5844a46f09f768da866d6b0ffbf1a9073266bf24.tar.gz) | |

net/mlx5e: IPoIB, Block PKEY interfaces with less rx queues than parent[ Upstream commit 31c70bfe58ef09fe36327ddcced9143a16e9e83d ]
A user is able to configure an arbitrary number of rx queues when
creating an interface via netlink. This doesn't work for child PKEY
interfaces because the child interface uses the parent receive channels.
Although the child shares the parent's receive channels, the number of
rx queues is important for the channel\_stats array: the parent's rx
channel index is used to access the child's channel\_stats. So the array
has to be at least as large as the parent's rx queue size for the
counting to work correctly and to prevent out of bound accesses.
This patch checks for the mentioned scenario and returns an error when
trying to create the interface. The error is propagated to the user.
Fixes: be98737a4faa ("net/mlx5e: Use dynamic per-channel allocations in stats")
Signed-off-by: Dragos Tatulea <dtatulea@nvidia.com>
Reviewed-by: Tariq Toukan <tariqt@nvidia.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=5844a46f09f768da866d6b0ffbf1a9073266bf24) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c b/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.cindex 3d31c59e69d450..0cf4eaf852d2ae 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=b5f108e202b74b3641dfcfcbacea096e159760dc)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib\_vlan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/ipoib/ipoib_vlan.c?id=5844a46f09f768da866d6b0ffbf1a9073266bf24)@@ -168,6 +168,15 @@ static int mlx5i\_pkey\_dev\_init(struct net\_device \*dev) return -EINVAL; } + if (dev->num\_rx\_queues < parent\_dev->real\_num\_rx\_queues) {+ mlx5\_core\_warn(priv->mdev,+ "failed to create child device with rx queues [%d] less than parent's [%d]\n",+ dev->num\_rx\_queues,+ parent\_dev->real\_num\_rx\_queues);+ mlx5i\_parent\_put(dev);+ return -EINVAL;+ }+ /\* Get QPN to netdevice hash table from parent \*/ parent\_ipriv = netdev\_priv(parent\_dev); ipriv->qpn\_htbl = parent\_ipriv->qpn\_htbl; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:46:24 +0000

