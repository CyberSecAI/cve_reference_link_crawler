=== Content from skypoc.wordpress.com_c9ee75b1_20250111_082408.html ===

[コンテンツへスキップ](#content)
[![ギカク](https://skypoc.wordpress.com/wp-content/uploads/2023/09/cropped-czj5l300402x.png)](https://skypoc.wordpress.com/)

[ギカク](https://skypoc.wordpress.com/)

ペンテストと脆弱性診断Blog

メニュー

* [Home](https://skypoc.wordpress.com)
* [About me](https://skypoc.wordpress.com/about-me/)
* [ペネトレーションテスト](https://skypoc.wordpress.com/category/%E3%83%9A%E3%83%8D%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88/)
* [経験メモ](https://skypoc.wordpress.com/category/%E7%B5%8C%E9%A8%93%E3%83%A1%E3%83%A2/)
* [Bug Hunt](https://skypoc.wordpress.com/category/bug-hunt/)
* [CTF](https://skypoc.wordpress.com/category/ctf/)
* [CVE](https://skypoc.wordpress.com/category/cve/)
* [PoC](https://skypoc.wordpress.com/category/poc/)

# Sourcecodester Contact Manager App Has Multiple Vulnerabilities

[Gi](https://skypoc.wordpress.com/author/skypoc/ "Gi の投稿")
[CVE](https://skypoc.wordpress.com/category/cve/)
2023年9月5日2023年9月30日
3 Minutes
## Update

**Update 2023/09/10**

**The vulnerability has been included and approved for public disclosure by MITRE.**

**CVE Record**

* [CVE-2023-4868](https://www.cve.org/CVERecord?id=CVE-2023-4868)
* [CVE-2023-4869](https://www.cve.org/CVERecord?id=CVE-2023-4869)
* [CVE-2023-4870](https://www.cve.org/CVERecord?id=CVE-2023-4870)
* [CVE-2023-4871](https://www.cve.org/CVERecord?id=CVE-2023-4871)
* [CVE-2023-4872](https://www.cve.org/CVERecord?id=CVE-2023-4872)

**NVD**

* [CVE-2023-4868](https://nvd.nist.gov/vuln/detail/CVE-2023-4868)
* [CVE-2023-4869](https://nvd.nist.gov/vuln/detail/CVE-2023-4869)
* [CVE-2023-4870](https://nvd.nist.gov/vuln/detail/CVE-2023-4870)
* [CVE-2023-4871](https://nvd.nist.gov/vuln/detail/CVE-2023-4871)
* [CVE-2023-4872](https://nvd.nist.gov/vuln/detail/CVE-2023-4872)

Vuln\_Author: WEI（ギカク）

The program is built using the xmapp-php8.2.4 version

**Vulnerabilities**：

* **Stored XSS【CVE-2023-4870】**
* **SQL Injection**【CVE-2023-4871】【CVE-2023-4872】
* **CSRF**【CVE-2023-4868】【CVE-2023-4869】

## About the Contact Manager App

> **[Contact Manager](https://www.sourcecodester.com/java/15561/simple-user-contact-management-app-java-free-source-code.html)** web application that enables users to manage their contacts, including contact details and images. The application will cover the basic functionalities of adding, viewing, updating, and deleting contacts.
>
> Developer

**Key Features:**

1. **Create:** Users can add new contacts by providing their details, including a profile image.
2. **Read:** Contacts stored in the database can be viewed in a tabular format, displaying their essential information and images.
3. **Update:** Users can edit contact information and images to keep the data up-to-date.
4. **Delete:** Contacts can be removed from the database when no longer needed.

![](https://www.sourcecodester.com/sites/default/files/images/rems/pics_0.png)
![](https://www.sourcecodester.com/sites/default/files/images/rems/add_0.png)
## Stored XSS

**This XSS vulnerability exists in index.php**

### Code Audit

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/vhke2iz6402x.png?w=1024)
```
<td id="contactID-<?= $contactID ?>"><?php echo $contactID ?></td>
```

In the code, we can see that there is an operation to directly output data from the database to HTML. If the data in the database contains malicious JavaScript code, this may lead to XSS attacks.

### PoC

First create a contact information

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/rwyuzgpp402x.png?w=1024)

Then modify the contact information to insert the XSS payload into the name field and address field

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/fir67fnj402x.png?w=1024)
```
"><sCrIpT>alert(1)</ScRiPt>
```

After clicking “Save Changes”, the XSS payload is successfully executed.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/2cnafcoh402x.png?w=1024)

Return to the homepage, XSS is triggered again.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/3z2wggbn402x.png?w=1024)

Confirmed Stored XSS vulnerability

## **SQL Injection**

### Code Audit

In the delete. php and add. php files, user input (such as $contact and $contactName) is directly inserted into the SQL query. This can lead to SQL injection attacks, allowing attackers to manipulate queries, read, modify, or delete data from the database.

```

<?php
session_start();
include('../conn/conn.php');

if (isset($_GET['contact'])) {
    $contact = $_GET['contact'];

    try {

        $query = "DELETE FROM `tbl_contact` WHERE tbl_contact_id ='$contact'";

        $statement = $conn->prepare($query);
        $query_execute = $statement->execute();

        if ($query_execute) {
            $_SESSION['message'] = "Deleted Successfully";
            header('Location:http://localhost/contact-manager/');
            exit(0);
        } else {
            $_SESSION['message'] = "Not Deleted";
            header('Location:http://localhost/contact-manager/');
            exit(0);
        }
    } catch (PDOException $e) {
        echo $e->getMessage();
    }
}

```
### PoC

Create two contacts for testing.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/gznbcbkl402x.png?w=1024)

Use the delete function to delete the contact with ID 13

Use burpsuite for packet capture

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/3-1.png?w=1024)

According to the result of code auditing, there is an injection point in the contact parameter.

Perform SQL injection testing on the parameters.

```
/endpoint/delete.php?contact=1%27%20OR%20%271%27%3D%271
```

This payload causes all contact information to be deleted.

From the figure below, it can be seen that SQL injection malicious code has been successfully executed, and all contacts have been deleted.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/blgsi1ek402x.png?w=1024)

SQL injection vulnerability has been confirmed to exist.

## CSRF

### Code Audit

A CSRF vulnerability exists in add.php and update.php

```

$contactName = $_POST['contact_name'];
$contactNumber = $_POST['contact_number'];
$contactEmail = $_POST['contact_email'];
$contactAddress = $_POST['contact_address'];

//...more code...

$stmt = $conn->prepare("INSERT INTO `tbl_contact` (`tbl_contact_id`,`contact_image`, `contact_name`, `contact_number`, `contact_email`, `contact_address`) VALUES (NULL, :contactImage, :contactName, :contactNumber, :contactEmail, :contactAddress)");
$stmt->bindParam(':contactImage', $contactImage);
$stmt->bindParam(':contactName', $contactName);
$stmt->bindParam(':contactNumber', $contactNumber);
$stmt->bindParam(':contactEmail', $contactEmail);
$stmt->bindParam(':contactAddress', $contactAddress);
$stmt->execute();

header("location: http://localhost/contact-manager/");

```

```

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $contactID = $_POST['tbl_contact_id'];
    $updateContactName = $_POST['contact_name'];
    $updateContactNumber = $_POST['contact_number'];
    $updateContactEmail = $_POST['contact_email'];
    $updateContactAddress = $_POST['contact_address'];

    //...more code...

    $stmt = $conn->prepare("UPDATE tbl_contact SET contact_name = ?, contact_number = ?, contact_email = ?, contact_address = ? WHERE tbl_contact_id = ?");
    $stmt->execute([$updateContactName, $updateContactNumber, $updateContactEmail, $updateContactAddress, $contactID]);

    header("location: http://localhost/contact-manager/");
    exit();
}

```

In these two code snippets, there are cases where data is directly received and processed from the user’s POST request, but CSRF protection is not implemented, so they may be exploited by attackers. Attackers can forge a legitimate user’s POST request to add or update data in the database, therefore both of these code snippets have CSRF vulnerabilities.

### PoC

Create a contact, with the contact ID being 15.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/fpoxuvo0402x.png?w=1024)

Create a test.html file with the following content.

```

<a href="http://localhost/endpoint/delete.php?contact=15"> test for csrf</a>

```

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/krcwgoon402x.png?w=1024)

When the user clicks “test for csrf”, it will directly trigger the delete function and delete the specified contact.

![](https://skypoc.wordpress.com/wp-content/uploads/2023/09/o7dy1sjd402x.png?w=1024)

Contact deleted successfully

Confirm the existence of CSRF vulnerability.

### 共享此文章：

* [Twitter](https://skypoc.wordpress.com/2023/09/05/vuln1/?share=twitter "クリックして Twitter で共有")
* [Facebook](https://skypoc.wordpress.com/2023/09/05/vuln1/?share=facebook "Facebook で共有するにはクリックしてください")
いいね 読み込み中…

**公開済み**
2023年9月5日2023年9月30日

## 投稿ナビゲーション

[Previous Post 【CVE-2023-4864】【CVE-2023-4865】SourceCodester Take-Note App v1.0 has Multiple Vulnerabilities](https://skypoc.wordpress.com/2023/09/05/sourcecodester-take-note-app-v1-0-has-multiple-vulnerabilities/)[Next Post Passing the eJPTv2 Certification on First attempt](https://skypoc.wordpress.com/2023/12/08/ejpt/)

[WordPress.com ホスティングサイト](https://wordpress.com/ja/?ref=footer_custom_powered).

* リブログ
* 登録
  開始日

  + [![](https://skypoc.wordpress.com/wp-content/uploads/2024/11/cropped-jmq4ccvq402x.png?w=50) ギカク](https://skypoc.wordpress.com)

  登録する

  + WordPress.com のアカウントをすでにお持ちですか ? [今すぐログイン](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fskypoc.wordpress.com%2F2023%2F09%2F05%2Fvuln1%2F&signup_flow=account)
* プライバシー
* + [![](https://skypoc.wordpress.com/wp-content/uploads/2024/11/cropped-jmq4ccvq402x.png?w=50) ギカク](https://skypoc.wordpress.com)
  + [カスタマイズ](https://skypoc.wordpress.com/wp-admin/customize.php?url=https%3A%2F%2Fskypoc.wordpress.com%2F2023%2F09%2F05%2Fvuln1%2F)
  + 登録
    開始日
  + [登録](https://wordpress.com/start/)
  + [ログイン](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fskypoc.wordpress.com%2F2023%2F09%2F05%2Fvuln1%2F&signup_flow=account)
  + [短縮リンクをコピー](https://wp.me/scbw4P-vuln1)
  + [このコンテンツを報告](https://wordpress.com/abuse/?report_url=https://skypoc.wordpress.com/2023/09/05/vuln1/)
  + [Reader で投稿を表示](https://wordpress.com/read/blogs/180060947/posts/1764)
  + [購読管理](https://subscribe.wordpress.com/)
  + このバーを折りたたむ

##

##

コメントを読み込み中…

コメントを投稿するにはログインしてください。

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
WordPress.com で次のようなサイトをデザイン[始めてみよう](https://wordpress.com/start/ja?ref=marketing_bar)


