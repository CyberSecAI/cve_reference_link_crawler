

# USB vulnerability

[[Date Prev](msg144176.html)][[Date Next](msg144178.html)][[Thread Prev](msg144170.html)][[Thread Next](msg144179.html)][[Date Index](mail49.html#144177)][[Thread Index](thrd47.html#144177)]

---

* *Subject*: USB vulnerability
* *From*: roswest <roswest@xxxxxxxxx>
* *Date*: Thu, 28 Jul 2016 12:23:01 -0400
* *Cc*: linux-usb@xxxxxxxxxxxxxxx, Christopher Kopek <ckopek@xxxxxxxxx>
* *User-agent*: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:45.0) Gecko/20100101 Thunderbird/45.0

---

```

Alan,

Hi, I am an engineer at Cisco Systems, and this summer we tasked some
interns with performing USB fuzzing. One of the interns, Jake Lamberson,
was able to cause a kernel panic when emulating an HID keyboard because
the OHCI driver fails to reserve bandwidth for the device.  Please see
the attachment for details.

Thank you,
Rosie Hall

```
```

Headline:         Linux Kernel Panic Over USB with HID Keyboard wMaxPacketSize
Platforms:        Ubuntu
Versions:         Linux Kernel 4.4.0-22-generic
CVSS Score:       4.7
CVSS Vector:      AV:L/AC:M/Au:N/C:N/I:N/A:C
Filed Defects:
Related Defects:
CWE Tags:
Cycle:
Found by:         Jake Lamberson

Linux Kernel panics when using an OHCI controller if a USB device reports being
a generic HID keyboard and reports a wMaxPacketSize of over 4095. The OHCI
controller driver fails to reserve bandwidth for the device, causing the
keyboard handler to fail when attaching to the HID. Later, when the device is
removed, the system crashes due to a null pointer dereference in a linked list
of endpoint descriptors. The crash can be re-created using a Facedancer and UMAP
software. Given an appropriately configured Facedancer and UMAP setup, the crash
can be re-created with:
sudo board=facedancer21 python3 umap.py -P /dev/serial_device_here -f 03:00:00:E:0046 -l LOG

Note: OHCI is a USB 1.1 controller standard that can be included with devices
that support either USB 1.1 or 2.0 as their highest USB spec. USB 3.0 devices
all use xHCI, which implements USB 1.1, 2.0, and 3.0, making them immune to
this particular bug.

```

**Attachment:
[signature.asc](attachments/pgpBm0C7is62T.pgp)**

*Description:* OpenPGP digital signature

---

* **Follow-Ups**:
  + **[Re: USB vulnerability](msg144205.html)**
    - *From:* Felipe Balbi
  + **[Re: USB vulnerability](msg144179.html)**
    - *From:* Greg KH

* Prev by Date:
  **[Re: [PATCH v3 4/6] usb: core: add power sequence handling for USB devices](msg144176.html)**
* Next by Date:
  **[Re: [PATCH v3 0/6] power: add power sequence library](msg144178.html)**
* Previous by thread:
  **[xhci\_hcd crash on linux 4.7.0](msg144170.html)**
* Next by thread:
  **[Re: USB vulnerability](msg144179.html)**
* Index(es):
  + [**Date**](mail49.html#144177)
  + [**Thread**](thrd47.html#144177)

[[Index of Archives]](/lists/)

[[Linux Media]](/lists/linux-media/)

[[Linux Input]](/lists/linux-input/)

[[Linux Audio Users]](/lists/linux-audio-users/)

[[Yosemite News]](https://yosemitenews.info/)

[[Linux Kernel]](/lists/kernel/)

[[Linux SCSI]](/lists/linux-scsi/)

[[Old Linux USB Devel Archive]](/lists/linux-usb-devel/)

---

|  | [Powered by Linux](/lists/) |
| --- | --- |

