The provided content relates to CVE-2021-47473.

**Root cause of vulnerability:**
A previous fix for a memory leak in the `qla2x00_process_els()` function in the qla2xxx SCSI driver introduced a logical error. The fix was intended to check `bsg_job->request->msgcode != FC_BSG_RPT_ELS` but mistakenly used `==` instead of `!=`. This caused the fcport structure to be leaked or unallocated memory to be freed when the msgcode was not `FC_BSG_RPT_ELS`.

**Weaknesses/vulnerabilities present:**
- Memory leak: The incorrect condition `bsg_job->request->msgcode == FC_BSG_RPT_ELS` caused the fcport structure to be leaked in some error paths.
- Use-after-free or double free: if the condition was met in the error path, unallocated memory could be freed due to the incorrect comparison logic.

**Impact of exploitation:**
- Memory exhaustion leading to a denial-of-service.
- System instability or crashes due to memory corruption.

**Attack vectors:**
The vulnerability is triggered through the SCSI block layer when processing specific bsg (Block SCSI Generic) requests related to ELS (Extended Link Services) frames. 

**Required attacker capabilities/position:**
An attacker needs to be able to send crafted bsg requests with specific `msgcode` values that would trigger the faulty condition. This implies local access or the ability to send SCSI commands to the vulnerable system.