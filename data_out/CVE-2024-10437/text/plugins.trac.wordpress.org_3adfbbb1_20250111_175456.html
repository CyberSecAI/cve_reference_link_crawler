

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpc-smart-messages%2Ftags%2F4.2.1%2Fincludes%2Fclass-backend.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/wpc-smart-messages/tags/4.2.1/includes/class-backend.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpc-smart-messages/tags/4.2.1/includes/class-backend.php)

---

# [source:](/browser?order=name "Go to repository root") [wpc-smart-messages](/browser/wpc-smart-messages?order=name "View wpc-smart-messages")/[tags](/browser/wpc-smart-messages/tags?order=name "View tags")/[4.2.1](/browser/wpc-smart-messages/tags/4.2.1?order=name "View 4.2.1")/[includes](/browser/wpc-smart-messages/tags/4.2.1/includes?order=name "View includes")/[class-backend.php](/browser/wpc-smart-messages/tags/4.2.1/includes/class-backend.php?order=name "View class-backend.php")

View diff against:

View revision:

| [Last change](/changeset/3127671/wpc-smart-messages/tags/4.2.1/includes/class-backend.php "View differences") on this file was [3127671](/changeset/3127671/ "View changeset 3127671"), checked in by wpclever, [6 months ago](/timeline?from=2024-07-29T19%3A03%3A10Z&precision=second "See timeline at 07/29/2024 07:03:10 PM") |
| --- |
| Update 4.2.1 |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 40.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | defined( 'ABSPATH' ) || exit; |
| [3](#L3) |  |
| [4](#L4) | use Automattic\WooCommerce\Utilities\FeaturesUtil; |
| [5](#L5) |  |
| [6](#L6) | if ( ! class\_exists( 'Wpcsm\_Backend' ) ) { |
| [7](#L7) | class Wpcsm\_Backend { |
| [8](#L8) | protected static $instance = null; |
| [9](#L9) |  |
| [10](#L10) | public static function instance() { |
| [11](#L11) | if ( is\_null( self::$instance ) ) { |
| [12](#L12) | self::$instance = new self(); |
| [13](#L13) | } |
| [14](#L14) |  |
| [15](#L15) | return self::$instance; |
| [16](#L16) | } |
| [17](#L17) |  |
| [18](#L18) | function \_\_construct() { |
| [19](#L19) | add\_action( 'init', [ $this, 'init' ] ); |
| [20](#L20) | add\_action( 'admin\_enqueue\_scripts', [ $this, 'enqueue\_scripts' ] ); |
| [21](#L21) |  |
| [22](#L22) | // meta boxes |
| [23](#L23) | add\_action( 'add\_meta\_boxes', [ $this, 'add\_meta\_box' ] ); |
| [24](#L24) | add\_action( 'save\_post\_wpc\_smart\_message', [ $this, 'save\_post' ] ); |
| [25](#L25) |  |
| [26](#L26) | // ajax |
| [27](#L27) | add\_action( 'wp\_ajax\_wpcsm\_get\_condition\_value', [ $this, 'ajax\_get\_condition\_value' ] ); |
| [28](#L28) | add\_action( 'wp\_ajax\_wpcsm\_add\_condition', [ $this, 'ajax\_add\_condition' ] ); |
| [29](#L29) | add\_action( 'wp\_ajax\_wpcsm\_activate', [ $this, 'ajax\_enable' ] ); |
| [30](#L30) | add\_action( 'wp\_ajax\_wpcsm\_search\_term', [ $this, 'ajax\_search\_term' ] ); |
| [31](#L31) |  |
| [32](#L32) | // columns |
| [33](#L33) | add\_filter( 'manage\_edit-wpc\_smart\_message\_columns', [ $this, 'message\_columns' ] ); |
| [34](#L34) | add\_action( 'manage\_wpc\_smart\_message\_posts\_custom\_column', [ $this, 'message\_columns\_content' ], 10, 2 ); |
| [35](#L35) |  |
| [36](#L36) | // HPOS compatibility |
| [37](#L37) | add\_action( 'before\_woocommerce\_init', function () { |
| [38](#L38) | if ( class\_exists( '\Automattic\WooCommerce\Utilities\FeaturesUtil' ) ) { |
| [39](#L39) | FeaturesUtil::declare\_compatibility( 'custom\_order\_tables', WPCSM\_FILE ); |
| [40](#L40) | } |
| [41](#L41) | } ); |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | function add\_meta\_box() { |
| [45](#L45) | add\_meta\_box( 'wpcsm\_metabox\_location', esc\_html\_\_( 'Location', 'wpc-smart-messages' ), [ |
| [46](#L46) | $this, |
| [47](#L47) | 'metabox\_location' |
| [48](#L48) | ], 'wpc\_smart\_message', 'advanced', 'low' ); |
| [49](#L49) |  |
| [50](#L50) | add\_meta\_box( 'wpcsm\_metabox\_conditions', esc\_html\_\_( 'Conditions', 'wpc-smart-messages' ), [ |
| [51](#L51) | $this, |
| [52](#L52) | 'metabox\_conditions' |
| [53](#L53) | ], 'wpc\_smart\_message', 'advanced', 'low' ); |
| [54](#L54) |  |
| [55](#L55) | add\_meta\_box( 'wpcsm\_metabox\_design', esc\_html\_\_( 'Design', 'wpc-smart-messages' ), [ |
| [56](#L56) | $this, |
| [57](#L57) | 'metabox\_design' |
| [58](#L58) | ], 'wpc\_smart\_message', 'advanced', 'low' ); |
| [59](#L59) |  |
| [60](#L60) | add\_meta\_box( 'wpcsm\_metabox\_message', esc\_html\_\_( 'Message', 'wpc-smart-messages' ), [ |
| [61](#L61) | $this, |
| [62](#L62) | 'metabox\_message' |
| [63](#L63) | ], 'wpc\_smart\_message', 'advanced', 'low' ); |
| [64](#L64) | } |
| [65](#L65) |  |
| [66](#L66) | function metabox\_location( $post ) { |
| [67](#L67) | $locations        = self::get\_locations(); |
| [68](#L68) | $location         = get\_post\_meta( $post->ID, 'wpcsm\_location', true ) ?: 'store\_notice\_info'; |
| [69](#L69) | $custom\_location  = get\_post\_meta( $post->ID, 'wpcsm\_custom\_location', true ) ?: ''; |
| [70](#L70) | $matched\_location = false; |
| [71](#L71) | ?> |
| [72](#L72) | <div class="wpcsm-settings-option"> |
| [73](#L73) | <select name="wpcsm\_location" id="wpcsm\_location"> |
| [74](#L74) | <?php |
| [75](#L75) | foreach ( $locations as $group => $hooks ) { |
| [76](#L76) | echo '<optgroup label="' . esc\_attr( $group ) . '">'; |
| [77](#L77) |  |
| [78](#L78) | foreach ( $hooks as $hook => $label ) { |
| [79](#L79) | echo '<option value="' . esc\_attr( $hook ) . '" ' . selected( $hook, $location, false ) . '>' . esc\_html( is\_array( $label ) && isset( $label['name'] ) ? $label['name'] : $label ) . '</option>'; |
| [80](#L80) |  |
| [81](#L81) | if ( $hook == $location ) { |
| [82](#L82) | $matched\_location = true; |
| [83](#L83) | } |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | echo '</optgroup>'; |
| [87](#L87) | } |
| [88](#L88) |  |
| [89](#L89) | if ( ! $matched\_location ) { |
| [90](#L90) | echo '<optgroup label="' . esc\_html\_\_( 'Undefined', 'wpc-smart-messages' ) . '"></optgroup>'; |
| [91](#L91) | echo '<option value="' . esc\_attr( $location ) . '" selected>' . esc\_html( $location ) . '</option>'; |
| [92](#L92) | } |
| [93](#L93) | ?> |
| [94](#L94) | </select> |
| [95](#L95) | <span class="wpcsm-custom-location <?php echo esc\_attr( $location !== 'custom' ? 'hidden' : '' ) ?>"> |
| [96](#L96) | <span class="hint--top" aria-label="You can set any action hook where you want to display the message. (Optional) Set a custom priority by adding a colon followed by a integer, e.g. &#039;:10&#039;"><input type="text" class="regular-text" name="wpcsm\_custom\_location" value="<?php echo esc\_attr( $custom\_location ); ?>"/></span> <span><a href="https://wpclever.net/faqs/using-the-custom-location/" target="\_blank">How to use the ‘Custom’ location?</a></span> |
| [97](#L97) | </span> |
| [98](#L98) | </div> |
| [99](#L99) | <?php |
| [100](#L100) | echo '<div class="wpcsm-shortcode">'; |
| [101](#L101) | echo '<div class="wpcsm-shortcode-des">' . esc\_html\_\_( 'You also can place below shortcode where you want to show this message. It still needs to meet the conditions to be displayed.', 'wpc-smart-messages' ) . '</div>'; |
| [102](#L102) | echo '<div class="wpcsm-shortcode-txt"><input type="text" class="wpcsm-shortcode-input" data-id="' . $post->ID . '" readonly value="[wpc\_smart\_message id=&quot;' . $post->ID . '&quot; name=&quot;' . esc\_attr( $post->post\_title ) . '&quot;]"/></div>'; |
| [103](#L103) | echo '</div>'; |
| [104](#L104) | } |
| [105](#L105) |  |
| [106](#L106) | function metabox\_conditions( $post ) { |
| [107](#L107) | $conditions = get\_post\_meta( $post->ID, 'wpcsm\_conditions', true ); |
| [108](#L108) | ?> |
| [109](#L109) | <div class="wpcsm-conditions-note"> |
| [110](#L110) | <?php esc\_html\_e( 'Current time', 'wpc-smart-messages' ); ?> |
| [111](#L111) | <code><?php echo esc\_html( current\_time( 'l' ) ); ?></code> |
| [112](#L112) | <code><?php echo esc\_html( current\_time( 'm/d/Y' ) ); ?></code> |
| [113](#L113) | <code><?php echo esc\_html( current\_time( 'h:i a' ) ); ?></code> |
| [114](#L114) | <code><?php echo esc\_html\_\_( 'Week No.', 'wpc-smart-messages' ) . ' ' . current\_time( 'W' ); ?></code> |
| [115](#L115) | <a href="<?php echo esc\_url( admin\_url( 'options-general.php' ) ); ?>" target="\_blank"><?php esc\_html\_e( 'Date/time settings', 'wpc-smart-messages' ); ?></a> |
| [116](#L116) | </div> |
| [117](#L117) | <div class="wpcsm-conditions-note" style="padding: 12px; margin: 12px 0; background-color: rgba(0,0,0,.03)"> |
| [118](#L118) | <?php esc\_html\_e( 'The logic when configuring conditions should be precise, meaningful & relevant for the message to be displayed on the chosen locations. Some conditions are satisfied in certain locations only. Irrelevant conditions will be skipped. For example, if you choose the condition “Product categories” & “Single product page” for the location, the message will be visible for all products under the chosen categories.', 'wpc-smart-messages' ); ?> |
| [119](#L119) | </div> |
| [120](#L120) | <div class="wpcsm-conditions"> |
| [121](#L121) | <?php if ( is\_array( $conditions ) && count( $conditions ) > 0 ) { |
| [122](#L122) | $index = 0; |
| [123](#L123) |  |
| [124](#L124) | foreach ( $conditions as $condition ) { ?> |
| [125](#L125) | <div class="input-panel" data-key="<?php echo esc\_attr( $index ) ?>"> |
| [126](#L126) | <div class="input-type"> |
| [127](#L127) | <?php self::get\_condition\_type( $index, $condition ); ?> |
| [128](#L128) | </div> |
| [129](#L129) | <div class="input-value"> |
| [130](#L130) | <?php self::get\_condition\_value( $index, $condition ); ?> |
| [131](#L131) | </div> |
| [132](#L132) | <span class="wpcsm-remove-condition hint--left" aria-label="<?php esc\_attr\_e( 'Remove', 'wpc-smart-messages' ); ?>">×</span> |
| [133](#L133) | </div> |
| [134](#L134) | <?php |
| [135](#L135) | $index ++; |
| [136](#L136) | } |
| [137](#L137) | } else { ?> |
| [138](#L138) | <div class="input-panel" data-key="0"> |
| [139](#L139) | <div class="input-type"> |
| [140](#L140) | <?php self::get\_condition\_type(); ?> |
| [141](#L141) | </div> |
| [142](#L142) | <div class="input-value"> |
| [143](#L143) | <?php self::get\_condition\_value(); ?> |
| [144](#L144) | </div> |
| [145](#L145) | <span class="wpcsm-remove-condition hint--left" aria-label="<?php esc\_attr\_e( 'Remove', 'wpc-smart-messages' ); ?>">×</span> |
| [146](#L146) | </div> |
| [147](#L147) | <?php } ?> |
| [148](#L148) | </div> |
| [149](#L149) | <button class="button wpcsm-add-condition" type="button"> |
| [150](#L150) | <?php esc\_html\_e( '+ Add Condition', 'wpc-smart-messages' ); ?> |
| [151](#L151) | </button> |
| [152](#L152) | <?php |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | function metabox\_message( $post ) { |
| [156](#L156) | ?> |
| [157](#L157) | <div class="wpcsm-settings-note"> |
| [158](#L158) | <?php esc\_html\_e( 'You can use the shortcode within the HTML text. Build-in shortcodes:', 'wpc-smart-messages' ); ?> |
| [159](#L159) | <ul> |
| [160](#L160) | <?php |
| [161](#L161) | foreach ( Wpcsm\_Shortcode::instance()->get\_shortcodes() as $k => $d ) { |
| [162](#L162) | echo '<li><code>[' . esc\_attr( $k ) . ']</code> - <i>' . esc\_html( $d ) . '</i></li>'; |
| [163](#L163) | } |
| [164](#L164) | ?> |
| [165](#L165) | </ul> |
| [166](#L166) | </div> |
| [167](#L167) | <?php |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | function metabox\_design( $post ) { |
| [171](#L171) | $container     = get\_post\_meta( $post->ID, 'wpcsm\_container', true ) ?: 'div'; |
| [172](#L172) | $extra\_classes = get\_post\_meta( $post->ID, 'wpcsm\_extra\_classes', true ) ?: ''; |
| [173](#L173) | $design        = get\_post\_meta( $post->ID, 'wpcsm\_design', true ) ?: 'no'; |
| [174](#L174) | $custom\_css    = get\_post\_meta( $post->ID, 'wpcsm\_custom\_css', true ) ?: ''; |
| [175](#L175) | $css           = (array) get\_post\_meta( $post->ID, 'wpcsm\_css', true ) ?: []; |
| [176](#L176) | $css           = array\_merge( [ |
| [177](#L177) | 'background' => [ 'color' => '' ], |
| [178](#L178) | 'border'     => [ 'style' => '', 'width' => '', 'color' => '', 'radius' => '' ], |
| [179](#L179) | 'padding'    => [ 'top' => '', 'right' => '', 'bottom' => '', 'left' => '' ], |
| [180](#L180) | 'margin'     => [ 'top' => '', 'right' => '', 'bottom' => '', 'left' => '' ], |
| [181](#L181) | ], $css ); |
| [182](#L182) | ?> |
| [183](#L183) | <div class="wpcsm-settings-note wpcsm-design-box"> |
| [184](#L184) | <div class="wpcsm-design-box-row wpcsm-design-box-row-design"> |
| [185](#L185) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Container', 'wpc-smart-messages' ); ?></div> |
| [186](#L186) | <div class="wpcsm-design-box-value"> |
| [187](#L187) | <select name="wpcsm\_container" class="wpcsm\_container"> |
| [188](#L188) | <option value="div" <?php selected( $container, 'div' ); ?>>div</option> |
| [189](#L189) | <option value="span" <?php selected( $container, 'span' ); ?>>span</option> |
| [190](#L190) | </select> |
| [191](#L191) | <span class="description"><?php esc\_html\_e( 'Wrap the message by a div or span tag.', 'wpc-smart-messages' ); ?></span> |
| [192](#L192) | </div> |
| [193](#L193) | </div> |
| [194](#L194) | <div class="wpcsm-design-box-row wpcsm-design-box-row-design"> |
| [195](#L195) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Extra CSS classes', 'wpc-smart-messages' ); ?></div> |
| [196](#L196) | <div class="wpcsm-design-box-value"> |
| [197](#L197) | <input type="text" name="wpcsm\_extra\_classes" class="text regular-text" value="<?php echo esc\_attr( $extra\_classes ); ?>"/> |
| [198](#L198) | <span class="description"><?php esc\_html\_e( 'Add extra CSS classes for the message container, split by one space.', 'wpc-smart-messages' ); ?></span> |
| [199](#L199) | </div> |
| [200](#L200) | </div> |
| [201](#L201) | <div class="wpcsm-design-box-row wpcsm-design-box-row-design"> |
| [202](#L202) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Design', 'wpc-smart-messages' ); ?></div> |
| [203](#L203) | <div class="wpcsm-design-box-value"> |
| [204](#L204) | <select name="wpcsm\_design" class="wpcsm\_design"> |
| [205](#L205) | <option value="no" <?php selected( $design, 'no' ); ?>><?php esc\_html\_e( 'No', 'wpc-smart-messages' ); ?></option> |
| [206](#L206) | <option value="css" <?php selected( $design, 'css' ); ?>><?php esc\_html\_e( 'Visual', 'wpc-smart-messages' ); ?></option> |
| [207](#L207) | <option value="custom\_css" <?php selected( $design, 'custom\_css' ); ?>><?php esc\_html\_e( 'Custom CSS', 'wpc-smart-messages' ); ?></option> |
| [208](#L208) | </select> |
| [209](#L209) | <span class="description"><?php esc\_html\_e( 'Configure the appearance of the container for this message.', 'wpc-smart-messages' ); ?></span> |
| [210](#L210) | </div> |
| [211](#L211) | </div> |
| [212](#L212) | <div class="wpcsm-design-box-row wpcsm-design-box-row-custom-css"> |
| [213](#L213) | <div class="wpcsm-design-box-label">CSS</div> |
| [214](#L214) | <div class="wpcsm-design-box-value"> |
| [215](#L215) | <div> |
| [216](#L216) | <div style="margin-bottom: 5px"><?php printf( esc\_html\_\_( 'Just fill CSS code without brackets, it will be used in %s', 'wpc-smart-messages' ), '<code>.wpcsm-message-' . $post->ID . ' { ... }</code>' ); ?></div> |
| [217](#L217) | <div> |
| [218](#L218) | <textarea rows="10" cols="50" class="large-text" name="wpcsm\_custom\_css" style="width: 100%"><?php echo $custom\_css; ?></textarea> |
| [219](#L219) | </div> |
| [220](#L220) | </div> |
| [221](#L221) | </div> |
| [222](#L222) | </div> |
| [223](#L223) | <div class="wpcsm-design-box-row"> |
| [224](#L224) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Background', 'wpc-smart-messages' ); ?></div> |
| [225](#L225) | <div class="wpcsm-design-box-value"> |
| [226](#L226) | <div> |
| [227](#L227) | <div><?php esc\_html\_e( 'Color', 'wpc-smart-messages' ); ?></div> |
| [228](#L228) | <div> |
| [229](#L229) | <input type="text" name="wpcsm\_css[background][color]" class="wpcsm\_color\_input" data-alpha-enabled="true" data-alpha-color-type="rgba" value="<?php echo esc\_attr( $css['background']['color'] ); ?>"/> |
| [230](#L230) | </div> |
| [231](#L231) | </div> |
| [232](#L232) | </div> |
| [233](#L233) | </div> |
| [234](#L234) | <div class="wpcsm-design-box-row"> |
| [235](#L235) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Border', 'wpc-smart-messages' ); ?></div> |
| [236](#L236) | <div class="wpcsm-design-box-value"> |
| [237](#L237) | <div> |
| [238](#L238) | <div><?php esc\_html\_e( 'Style', 'wpc-smart-messages' ); ?></div> |
| [239](#L239) | <div> |
| [240](#L240) | <select name="wpcsm\_css[border][style]"> |
| [241](#L241) | <option value="none" <?php selected( $css['border']['style'], 'none' ); ?>><?php esc\_html\_e( 'None', 'wpc-smart-messages' ); ?></option> |
| [242](#L242) | <option value="solid" <?php selected( $css['border']['style'], 'solid' ); ?>><?php esc\_html\_e( 'Solid', 'wpc-smart-messages' ); ?></option> |
| [243](#L243) | <option value="dotted" <?php selected( $css['border']['style'], 'dotted' ); ?>><?php esc\_html\_e( 'Dotted', 'wpc-smart-messages' ); ?></option> |
| [244](#L244) | <option value="dashed" <?php selected( $css['border']['style'], 'dashed' ); ?>><?php esc\_html\_e( 'Dashed', 'wpc-smart-messages' ); ?></option> |
| [245](#L245) | <option value="double" <?php selected( $css['border']['style'], 'double' ); ?>><?php esc\_html\_e( 'Double', 'wpc-smart-messages' ); ?></option> |
| [246](#L246) | </select> |
| [247](#L247) | </div> |
| [248](#L248) | </div> |
| [249](#L249) | <div> |
| [250](#L250) | <div><?php esc\_html\_e( 'With (px)', 'wpc-smart-messages' ); ?></div> |
| [251](#L251) | <div> |
| [252](#L252) | <input type="number" name="wpcsm\_css[border][width]" placeholder="0" value="<?php echo esc\_attr( $css['border']['width'] ); ?>"/> |
| [253](#L253) | </div> |
| [254](#L254) | </div> |
| [255](#L255) | <div> |
| [256](#L256) | <div><?php esc\_html\_e( 'Color', 'wpc-smart-messages' ); ?></div> |
| [257](#L257) | <div> |
| [258](#L258) | <input type="text" name="wpcsm\_css[border][color]" class="wpcsm\_color\_input" data-alpha-enabled="true" data-alpha-color-type="rgba" value="<?php echo esc\_attr( $css['border']['color'] ); ?>"/> |
| [259](#L259) | </div> |
| [260](#L260) | </div> |
| [261](#L261) | <div> |
| [262](#L262) | <div><?php esc\_html\_e( 'Radius (px)', 'wpc-smart-messages' ); ?></div> |
| [263](#L263) | <div> |
| [264](#L264) | <input type="number" name="wpcsm\_css[border][radius]" placeholder="0" value="<?php echo esc\_attr( $css['border']['radius'] ); ?>"/> |
| [265](#L265) | </div> |
| [266](#L266) | </div> |
| [267](#L267) | </div> |
| [268](#L268) | </div> |
| [269](#L269) | <div class="wpcsm-design-box-row"> |
| [270](#L270) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Padding', 'wpc-smart-messages' ); ?></div> |
| [271](#L271) | <div class="wpcsm-design-box-value"> |
| [272](#L272) | <div class="wpcsm-design-box-value"> |
| [273](#L273) | <div> |
| [274](#L274) | <div><?php esc\_html\_e( 'Top (px)', 'wpc-smart-messages' ); ?></div> |
| [275](#L275) | <div> |
| [276](#L276) | <input type="number" name="wpcsm\_css[padding][top]" placeholder="0" value="<?php echo esc\_attr( $css['padding']['top'] ); ?>"/> |
| [277](#L277) | </div> |
| [278](#L278) | </div> |
| [279](#L279) | <div> |
| [280](#L280) | <div><?php esc\_html\_e( 'Right (px)', 'wpc-smart-messages' ); ?></div> |
| [281](#L281) | <div> |
| [282](#L282) | <input type="number" name="wpcsm\_css[padding][right]" placeholder="0" value="<?php echo esc\_attr( $css['padding']['right'] ); ?>"/> |
| [283](#L283) | </div> |
| [284](#L284) | </div> |
| [285](#L285) | <div> |
| [286](#L286) | <div><?php esc\_html\_e( 'Bottom (px)', 'wpc-smart-messages' ); ?></div> |
| [287](#L287) | <div> |
| [288](#L288) | <input type="number" name="wpcsm\_css[padding][bottom]" placeholder="0" value="<?php echo esc\_attr( $css['padding']['bottom'] ); ?>"/> |
| [289](#L289) | </div> |
| [290](#L290) | </div> |
| [291](#L291) | <div> |
| [292](#L292) | <div><?php esc\_html\_e( 'Left (px)', 'wpc-smart-messages' ); ?></div> |
| [293](#L293) | <div> |
| [294](#L294) | <input type="number" name="wpcsm\_css[padding][left]" placeholder="0" value="<?php echo esc\_attr( $css['padding']['left'] ); ?>"/> |
| [295](#L295) | </div> |
| [296](#L296) | </div> |
| [297](#L297) | </div> |
| [298](#L298) | </div> |
| [299](#L299) | </div> |
| [300](#L300) | <div class="wpcsm-design-box-row"> |
| [301](#L301) | <div class="wpcsm-design-box-label"><?php esc\_html\_e( 'Margin', 'wpc-smart-messages' ); ?></div> |
| [302](#L302) | <div class="wpcsm-design-box-value"> |
| [303](#L303) | <div class="wpcsm-design-box-value"> |
| [304](#L304) | <div> |
| [305](#L305) | <div><?php esc\_html\_e( 'Top (px)', 'wpc-smart-messages' ); ?></div> |
| [306](#L306) | <div> |
| [307](#L307) | <input type="number" name="wpcsm\_css[margin][top]" placeholder="0" value="<?php echo esc\_attr( $css['margin']['top'] ); ?>"/> |
| [308](#L308) | </div> |
| [309](#L309) | </div> |
| [310](#L310) | <div> |
| [311](#L311) | <div><?php esc\_html\_e( 'Right (px)', 'wpc-smart-messages' ); ?></div> |
| [312](#L312) | <div> |
| [313](#L313) | <input type="number" name="wpcsm\_css[margin][right]" placeholder="0" value="<?php echo esc\_attr( $css['margin']['right'] ); ?>"/> |
| [314](#L314) | </div> |
| [315](#L315) | </div> |
| [316](#L316) | <div> |
| [317](#L317) | <div><?php esc\_html\_e( 'Bottom (px)', 'wpc-smart-messages' ); ?></div> |
| [318](#L318) | <div> |
| [319](#L319) | <input type="number" name="wpcsm\_css[margin][bottom]" placeholder="0" value="<?php echo esc\_attr( $css['margin']['bottom'] ); ?>"/> |
| [320](#L320) | </div> |
| [321](#L321) | </div> |
| [322](#L322) | <div> |
| [323](#L323) | <div><?php esc\_html\_e( 'Left (px)', 'wpc-smart-messages' ); ?></div> |
| [324](#L324) | <div> |
| [325](#L325) | <input type="number" name="wpcsm\_css[margin][left]" placeholder="0" value="<?php echo esc\_attr( $css['margin']['left'] ); ?>"/> |
| [326](#L326) | </div> |
| [327](#L327) | </div> |
| [328](#L328) | </div> |
| [329](#L329) | </div> |
| [330](#L330) | </div> |
| [331](#L331) | </div> |
| [332](#L332) | <?php |
| [333](#L333) | } |
| [334](#L334) |  |
| [335](#L335) | function ajax\_add\_condition() { |
| [336](#L336) | $index = sanitize\_text\_field( $\_POST['index'] ); |
| [337](#L337) | ?> |
| [338](#L338) | <div class="input-panel" data-key="<?php echo esc\_attr( $index ) ?>"> |
| [339](#L339) | <div class="input-type"> |
| [340](#L340) | <?php self::get\_condition\_type( $index ); ?> |
| [341](#L341) | </div> |
| [342](#L342) | <div class="input-value"> |
| [343](#L343) | <?php self::get\_condition\_value( $index ); ?> |
| [344](#L344) | </div> |
| [345](#L345) | <span class="wpcsm-remove-condition hint--left" aria-label="<?php esc\_attr\_e( 'Remove', 'wpc-smart-messages' ); ?>">×</span> |
| [346](#L346) | </div> |
| [347](#L347) | <?php |
| [348](#L348) | wp\_die(); |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) | function ajax\_get\_condition\_value() { |
| [352](#L352) | $group = sanitize\_text\_field( $\_POST['group'] ); |
| [353](#L353) | $type  = sanitize\_text\_field( $\_POST['type'] ); |
| [354](#L354) | $index = sanitize\_text\_field( $\_POST['index'] ); |
| [355](#L355) | self::get\_condition\_value( $index, [ 'group' => $group, 'type' => $type ] ); |
| [356](#L356) | wp\_die(); |
| [357](#L357) | } |
| [358](#L358) |  |
| [359](#L359) | function get\_condition\_type( $index = 0, $condition = [] ) { |
| [360](#L360) | $condition = array\_merge( [ 'type' => 'every\_day' ], $condition ); |
| [361](#L361) | ?> |
| [362](#L362) | <select class="wpcsm-condition-type-select" name="wpcsm\_conditions[<?php echo esc\_attr( $index ) ?>][type]"> |
| [363](#L363) | <optgroup label="<?php esc\_html\_e( 'Date & Time', 'wpc-smart-messages' ); ?>"> |
| [364](#L364) | <option value="every\_day" data-group="none" <?php selected( $condition['type'], 'every\_day' ); ?>><?php esc\_html\_e( 'Everyday', 'wpc-smart-messages' ); ?></option> |
| [365](#L365) | <option value="date\_on" data-group="date" <?php selected( $condition['type'], 'date\_on' ); ?>><?php esc\_html\_e( 'On the date', 'wpc-smart-messages' ); ?></option> |
| [366](#L366) | <option value="date\_time\_before" data-group="date\_time" <?php selected( $condition['type'], 'date\_time\_before' ); ?>><?php esc\_html\_e( 'Before date & time', 'wpc-smart-messages' ); ?></option> |
| [367](#L367) | <option value="date\_time\_after" data-group="date\_time" <?php selected( $condition['type'], 'date\_time\_after' ); ?>><?php esc\_html\_e( 'After date & time', 'wpc-smart-messages' ); ?></option> |
| [368](#L368) | <option value="date\_before" data-group="date" <?php selected( $condition['type'], 'date\_before' ); ?>><?php esc\_html\_e( 'Before date', 'wpc-smart-messages' ); ?></option> |
| [369](#L369) | <option value="date\_after" data-group="date" <?php selected( $condition['type'], 'date\_after' ); ?>><?php esc\_html\_e( 'After date', 'wpc-smart-messages' ); ?></option> |
| [370](#L370) | <option value="date\_multi" data-group="date\_multi" <?php selected( $condition['type'], 'date\_multi' ); ?>><?php esc\_html\_e( 'Multiple dates', 'wpc-smart-messages' ); ?></option> |
| [371](#L371) | <option value="date\_range" data-group="date\_range" <?php selected( $condition['type'], 'date\_range' ); ?>><?php esc\_html\_e( 'Date range', 'wpc-smart-messages' ); ?></option> |
| [372](#L372) | <option value="date\_even" data-group="none" <?php selected( $condition['type'], 'date\_even' ); ?>><?php esc\_html\_e( 'All even dates', 'wpc-smart-messages' ); ?></option> |
| [373](#L373) | <option value="date\_odd" data-group="none" <?php selected( $condition['type'], 'date\_odd' ); ?>><?php esc\_html\_e( 'All odd dates', 'wpc-smart-messages' ); ?></option> |
| [374](#L374) | <option value="time\_range" data-group="time\_range" <?php selected( $condition['type'], 'time\_range' ); ?>><?php esc\_html\_e( 'Daily time range', 'wpc-smart-messages' ); ?></option> |
| [375](#L375) | <option value="time\_before" data-group="time" <?php selected( $condition['type'], 'time\_before' ); ?>><?php esc\_html\_e( 'Daily before time', 'wpc-smart-messages' ); ?></option> |
| [376](#L376) | <option value="time\_after" data-group="time" <?php selected( $condition['type'], 'time\_after' ); ?>><?php esc\_html\_e( 'Daily after time', 'wpc-smart-messages' ); ?></option> |
| [377](#L377) | <option value="weekly\_every" data-group="weekday" <?php selected( $condition['type'], 'weekly\_every' ); ?>><?php esc\_html\_e( 'Weekly on every', 'wpc-smart-messages' ); ?></option> |
| [378](#L378) | <option value="week\_even" data-group="none" <?php selected( $condition['type'], 'week\_even' ); ?>><?php esc\_html\_e( 'All even weeks', 'wpc-smart-messages' ); ?></option> |
| [379](#L379) | <option value="week\_odd" data-group="none" <?php selected( $condition['type'], 'week\_odd' ); ?>><?php esc\_html\_e( 'All odd weeks', 'wpc-smart-messages' ); ?></option> |
| [380](#L380) | <option value="week\_no" data-group="weekno" <?php selected( $condition['type'], 'week\_no' ); ?>><?php esc\_html\_e( 'On week No.', 'wpc-smart-messages' ); ?></option> |
| [381](#L381) | <option value="monthly\_every" data-group="monthday" <?php selected( $condition['type'], 'monthly\_every' ); ?>><?php esc\_html\_e( 'Monthly on the', 'wpc-smart-messages' ); ?></option> |
| [382](#L382) | <option value="month\_no" data-group="monthno" <?php selected( $condition['type'], 'month\_no' ); ?>><?php esc\_html\_e( 'On month No.', 'wpc-smart-messages' ); ?></option> |
| [383](#L383) | </optgroup> |
| [384](#L384) | <optgroup label="<?php esc\_html\_e( 'User', 'wpc-smart-messages' ); ?>"> |
| [385](#L385) | <option value="user\_role" data-group="user\_role" <?php selected( $condition['type'], 'user\_role' ); ?>><?php esc\_html\_e( 'User role', 'wpc-smart-messages' ); ?></option> |
| [386](#L386) | </optgroup> |
| [387](#L387) | <optgroup label="<?php esc\_html\_e( 'Cart', 'wpc-smart-messages' ); ?>"> |
| [388](#L388) | <option value="cart\_total" data-group="compare\_number" <?php selected( $condition['type'], 'cart\_total' ); ?>><?php esc\_html\_e( 'Cart total', 'wpc-smart-messages' ); ?></option> |
| [389](#L389) | <option value="cart\_count" data-group="compare\_number" <?php selected( $condition['type'], 'cart\_count' ); ?>><?php esc\_html\_e( 'Cart count', 'wpc-smart-messages' ); ?></option> |
| [390](#L390) | </optgroup> |
| [391](#L391) | <optgroup label="<?php esc\_html\_e( 'Product', 'wpc-smart-messages' ); ?>"> |
| [392](#L392) | <option value="product\_status" data-group="product\_status" <?php selected( $condition['type'], 'product\_status' ); ?>><?php esc\_html\_e( 'Product status', 'wpc-smart-messages' ); ?></option> |
| [393](#L393) | <option value="product\_stock" data-group="compare\_number" <?php selected( $condition['type'], 'product\_stock' ); ?>><?php esc\_html\_e( 'Product stock', 'wpc-smart-messages' ); ?></option> |
| [394](#L394) | <option value="product\_weight" data-group="compare\_number" <?php selected( $condition['type'], 'product\_weight' ); ?>><?php esc\_html\_e( 'Product weight', 'wpc-smart-messages' ); ?></option> |
| [395](#L395) | <option value="product\_width" data-group="compare\_number" <?php selected( $condition['type'], 'product\_width' ); ?>><?php esc\_html\_e( 'Product width', 'wpc-smart-messages' ); ?></option> |
| [396](#L396) | <option value="product\_height" data-group="compare\_number" <?php selected( $condition['type'], 'product\_height' ); ?>><?php esc\_html\_e( 'Product height', 'wpc-smart-messages' ); ?></option> |
| [397](#L397) | <?php |
| [398](#L398) | $taxonomies = get\_object\_taxonomies( 'product', 'objects' ); //$taxonomies = get\_taxonomies( [ 'object\_type' => [ 'product' ] ], 'objects' ); |
| [399](#L399) |  |
| [400](#L400) | foreach ( $taxonomies as $taxonomy ) { |
| [401](#L401) | echo '<option value="' . $taxonomy->name . '" data-group="term" ' . selected( $condition['type'], $taxonomy->name, false ) . '>' . $taxonomy->label . '</option>'; |
| [402](#L402) | } |
| [403](#L403) | ?> |
| [404](#L404) | </optgroup> |
| [405](#L405) | </select> |
| [406](#L406) | <?php |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | function get\_condition\_value( $index = 0, $condition = [] ) { |
| [410](#L410) | $condition = array\_merge( [ |
| [411](#L411) | 'group'   => 'none', |
| [412](#L412) | 'type'    => 'every\_day', |
| [413](#L413) | 'compare' => '', |
| [414](#L414) | 'value'   => '' |
| [415](#L415) | ], $condition ); |
| [416](#L416) |  |
| [417](#L417) | if ( ! empty( $condition['group'] ) ) { |
| [418](#L418) | include 'templates/conditions/' . $condition['group'] . '.php'; |
| [419](#L419) | } |
| [420](#L420) | } |
| [421](#L421) |  |
| [422](#L422) | function get\_locations() { |
| [423](#L423) | return apply\_filters( 'wpcsm\_locations', [ |
| [424](#L424) | 'Custom'          => [ |
| [425](#L425) | 'custom' => [ |
| [426](#L426) | 'hook'     => 'custom', |
| [427](#L427) | 'priority' => 10, |
| [428](#L428) | 'name'     => 'Custom', |
| [429](#L429) | ], |
| [430](#L430) | 'none'   => [ |
| [431](#L431) | 'hook'     => 'none', |
| [432](#L432) | 'priority' => 10, |
| [433](#L433) | 'name'     => 'None', |
| [434](#L434) | ], |
| [435](#L435) | ], |
| [436](#L436) | 'General'         => [ |
| [437](#L437) | 'store\_notice\_info'    => [ |
| [438](#L438) | 'hook'     => 'wp', |
| [439](#L439) | 'priority' => 20, |
| [440](#L440) | 'name'     => 'Info notice', |
| [441](#L441) | ], |
| [442](#L442) | 'store\_notice\_error'   => [ |
| [443](#L443) | 'hook'     => 'wp', |
| [444](#L444) | 'priority' => 20, |
| [445](#L445) | 'name'     => 'Error notice', |
| [446](#L446) | ], |
| [447](#L447) | 'store\_notice\_success' => [ |
| [448](#L448) | 'hook'     => 'wp', |
| [449](#L449) | 'priority' => 20, |
| [450](#L450) | 'name'     => 'Success notice', |
| [451](#L451) | ], |
| [452](#L452) | 'main\_content\_before'  => [ |
| [453](#L453) | 'hook'     => 'woocommerce\_before\_main\_content', |
| [454](#L454) | 'priority' => 10, |
| [455](#L455) | 'name'     => 'Before main content', |
| [456](#L456) | ], |
| [457](#L457) | 'main\_content\_after'   => [ |
| [458](#L458) | 'hook'     => 'woocommerce\_after\_main\_content', |
| [459](#L459) | 'priority' => 10, |
| [460](#L460) | 'name'     => 'After main content', |
| [461](#L461) | ], |
| [462](#L462) | ], |
| [463](#L463) | 'Product Archive' => [ |
| [464](#L464) | 'shop\_loop\_item\_before'       => [ |
| [465](#L465) | 'hook'     => 'woocommerce\_before\_shop\_loop\_item', |
| [466](#L466) | 'priority' => 10, |
| [467](#L467) | 'name'     => 'Before product', |
| [468](#L468) | ], |
| [469](#L469) | 'shop\_loop\_item\_after'        => [ |
| [470](#L470) | 'hook'     => 'woocommerce\_after\_shop\_loop\_item', |
| [471](#L471) | 'priority' => 25, |
| [472](#L472) | 'name'     => 'After product', |
| [473](#L473) | ], |
| [474](#L474) | 'shop\_loop\_item\_title\_before' => [ |
| [475](#L475) | 'hook'     => 'woocommerce\_shop\_loop\_item\_title', |
| [476](#L476) | 'priority' => 9, |
| [477](#L477) | 'name'     => 'Before product title', |
| [478](#L478) | ], |
| [479](#L479) | 'shop\_loop\_item\_title\_after'  => [ |
| [480](#L480) | 'hook'     => 'woocommerce\_shop\_loop\_item\_title', |
| [481](#L481) | 'priority' => 11, |
| [482](#L482) | 'name'     => 'After product title', |
| [483](#L483) | ], |
| [484](#L484) | 'shop\_loop\_item\_price\_before' => [ |
| [485](#L485) | 'hook'     => 'woocommerce\_after\_shop\_loop\_item\_title', |
| [486](#L486) | 'priority' => 9, |
| [487](#L487) | 'name'     => 'Before product price', |
| [488](#L488) | ], |
| [489](#L489) | 'shop\_loop\_item\_price\_after'  => [ |
| [490](#L490) | 'hook'     => 'woocommerce\_after\_shop\_loop\_item\_title', |
| [491](#L491) | 'priority' => 11, |
| [492](#L492) | 'name'     => 'After product price', |
| [493](#L493) | ], |
| [494](#L494) | ], |
| [495](#L495) | 'Product Single'  => [ |
| [496](#L496) | 'single\_product\_before'             => [ |
| [497](#L497) | 'hook'     => 'woocommerce\_before\_single\_product', |
| [498](#L498) | 'priority' => 11, |
| [499](#L499) | 'name'     => 'Before product', |
| [500](#L500) | ], |
| [501](#L501) | 'single\_product\_after'              => [ |
| [502](#L502) | 'hook'     => 'woocommerce\_after\_single\_product', |
| [503](#L503) | 'priority' => 11, |
| [504](#L504) | 'name'     => 'After product', |
| [505](#L505) | ], |
| [506](#L506) | 'single\_product\_summary\_before'     => [ |
| [507](#L507) | 'hook'     => 'woocommerce\_before\_single\_product\_summary', |
| [508](#L508) | 'priority' => 9, |
| [509](#L509) | 'name'     => 'Before product summary', |
| [510](#L510) | ], |
| [511](#L511) | 'single\_product\_summary\_after'      => [ |
| [512](#L512) | 'hook'     => 'woocommerce\_after\_single\_product\_summary', |
| [513](#L513) | 'priority' => 21, |
| [514](#L514) | 'name'     => 'After product summary', |
| [515](#L515) | ], |
| [516](#L516) | 'single\_product\_title\_before'       => [ |
| [517](#L517) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [518](#L518) | 'priority' => 4, |
| [519](#L519) | 'name'     => 'Before product title', |
| [520](#L520) | ], |
| [521](#L521) | 'single\_product\_title\_after'        => [ |
| [522](#L522) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [523](#L523) | 'priority' => 6, |
| [524](#L524) | 'name'     => 'After product title', |
| [525](#L525) | ], |
| [526](#L526) | 'single\_product\_price\_before'       => [ |
| [527](#L527) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [528](#L528) | 'priority' => 9, |
| [529](#L529) | 'name'     => 'Before product price', |
| [530](#L530) | ], |
| [531](#L531) | 'single\_product\_price\_after'        => [ |
| [532](#L532) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [533](#L533) | 'priority' => 11, |
| [534](#L534) | 'name'     => 'After product price', |
| [535](#L535) | ], |
| [536](#L536) | 'single\_product\_excerpt\_before'     => [ |
| [537](#L537) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [538](#L538) | 'priority' => 19, |
| [539](#L539) | 'name'     => 'Before product excerpt', |
| [540](#L540) | ], |
| [541](#L541) | 'single\_product\_excerpt\_after'      => [ |
| [542](#L542) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [543](#L543) | 'priority' => 21, |
| [544](#L544) | 'name'     => 'After product excerpt', |
| [545](#L545) | ], |
| [546](#L546) | 'single\_product\_add\_to\_cart\_before' => [ |
| [547](#L547) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [548](#L548) | 'priority' => 29, |
| [549](#L549) | 'name'     => 'Before product add to cart', |
| [550](#L550) | ], |
| [551](#L551) | 'single\_product\_add\_to\_cart\_after'  => [ |
| [552](#L552) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [553](#L553) | 'priority' => 31, |
| [554](#L554) | 'name'     => 'After product add to cart', |
| [555](#L555) | ], |
| [556](#L556) | 'single\_product\_meta\_before'        => [ |
| [557](#L557) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [558](#L558) | 'priority' => 39, |
| [559](#L559) | 'name'     => 'Before product meta', |
| [560](#L560) | ], |
| [561](#L561) | 'single\_product\_meta\_after'         => [ |
| [562](#L562) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [563](#L563) | 'priority' => 41, |
| [564](#L564) | 'name'     => 'After product meta', |
| [565](#L565) | ], |
| [566](#L566) | 'single\_product\_sharing\_before'     => [ |
| [567](#L567) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [568](#L568) | 'priority' => 49, |
| [569](#L569) | 'name'     => 'Before product sharing', |
| [570](#L570) | ], |
| [571](#L571) | 'single\_product\_sharing\_after'      => [ |
| [572](#L572) | 'hook'     => 'woocommerce\_single\_product\_summary', |
| [573](#L573) | 'priority' => 51, |
| [574](#L574) | 'name'     => 'After product sharing', |
| [575](#L575) | ], |
| [576](#L576) | 'single\_product\_tabs\_before'        => [ |
| [577](#L577) | 'hook'     => 'woocommerce\_after\_single\_product\_summary', |
| [578](#L578) | 'priority' => 9, |
| [579](#L579) | 'name'     => 'Before product tabs', |
| [580](#L580) | ], |
| [581](#L581) | 'single\_product\_tabs\_after'         => [ |
| [582](#L582) | 'hook'     => 'woocommerce\_after\_single\_product\_summary', |
| [583](#L583) | 'priority' => 11, |
| [584](#L584) | 'name'     => 'After product tabs', |
| [585](#L585) | ], |
| [586](#L586) | 'single\_product\_related\_before'     => [ |
| [587](#L587) | 'hook'     => 'woocommerce\_after\_single\_product\_summary', |
| [588](#L588) | 'priority' => 19, |
| [589](#L589) | 'name'     => 'Before related products', |
| [590](#L590) | ], |
| [591](#L591) | 'single\_product\_related\_after'      => [ |
| [592](#L592) | 'hook'     => 'woocommerce\_after\_single\_product\_summary', |
| [593](#L593) | 'priority' => 21, |
| [594](#L594) | 'name'     => 'After related products', |
| [595](#L595) | ], |
| [596](#L596) | ], |
| [597](#L597) | 'Cart'            => [ |
| [598](#L598) | 'cart\_before'             => [ |
| [599](#L599) | 'hook'     => 'woocommerce\_before\_cart', |
| [600](#L600) | 'priority' => 10, |
| [601](#L601) | 'name'     => 'Before cart', |
| [602](#L602) | ], |
| [603](#L603) | 'cart\_after'              => [ |
| [604](#L604) | 'hook'     => 'woocommerce\_after\_cart', |
| [605](#L605) | 'priority' => 10, |
| [606](#L606) | 'name'     => 'After cart', |
| [607](#L607) | ], |
| [608](#L608) | 'cart\_table\_before'       => [ |
| [609](#L609) | 'hook'     => 'woocommerce\_before\_cart\_table', |
| [610](#L610) | 'priority' => 10, |
| [611](#L611) | 'name'     => 'Before cart table', |
| [612](#L612) | ], |
| [613](#L613) | 'cart\_table\_after'        => [ |
| [614](#L614) | 'hook'     => 'woocommerce\_after\_cart\_table', |
| [615](#L615) | 'priority' => 10, |
| [616](#L616) | 'name'     => 'After cart table', |
| [617](#L617) | ], |
| [618](#L618) | 'cart\_totals\_before'      => [ |
| [619](#L619) | 'hook'     => 'woocommerce\_before\_cart\_totals', |
| [620](#L620) | 'priority' => 10, |
| [621](#L621) | 'name'     => 'Before cart totals', |
| [622](#L622) | ], |
| [623](#L623) | 'cart\_totals\_after'       => [ |
| [624](#L624) | 'hook'     => 'woocommerce\_after\_cart\_totals', |
| [625](#L625) | 'priority' => 10, |
| [626](#L626) | 'name'     => 'After cart totals', |
| [627](#L627) | ], |
| [628](#L628) | 'cart\_before\_collaterals' => [ |
| [629](#L629) | 'hook'     => 'woocommerce\_before\_cart\_collaterals', |
| [630](#L630) | 'priority' => 10, |
| [631](#L631) | 'name'     => 'Before cart collaterals', |
| [632](#L632) | ], |
| [633](#L633) | 'cart\_after\_item\_name'    => [ |
| [634](#L634) | 'hook'     => 'woocommerce\_after\_cart\_item\_name', |
| [635](#L635) | 'priority' => 10, |
| [636](#L636) | 'name'     => 'After cart item name', |
| [637](#L637) | ], |
| [638](#L638) | ], |
| [639](#L639) | 'Checkout'        => [ |
| [640](#L640) | 'checkout\_form\_before'             => [ |
| [641](#L641) | 'hook'     => 'woocommerce\_before\_checkout\_form', |
| [642](#L642) | 'priority' => 10, |
| [643](#L643) | 'name'     => 'Before checkout', |
| [644](#L644) | ], |
| [645](#L645) | 'checkout\_form\_after'              => [ |
| [646](#L646) | 'hook'     => 'woocommerce\_after\_checkout\_form', |
| [647](#L647) | 'priority' => 10, |
| [648](#L648) | 'name'     => 'After checkout', |
| [649](#L649) | ], |
| [650](#L650) | 'checkout\_customer\_details\_before' => [ |
| [651](#L651) | 'hook'     => 'woocommerce\_checkout\_before\_customer\_details', |
| [652](#L652) | 'priority' => 10, |
| [653](#L653) | 'name'     => 'Before customer details', |
| [654](#L654) | ], |
| [655](#L655) | 'checkout\_customer\_details\_after'  => [ |
| [656](#L656) | 'hook'     => 'woocommerce\_checkout\_after\_customer\_details', |
| [657](#L657) | 'priority' => 10, |
| [658](#L658) | 'name'     => 'After customer details', |
| [659](#L659) | ], |
| [660](#L660) | 'checkout\_billing\_before'          => [ |
| [661](#L661) | 'hook'     => 'woocommerce\_checkout\_billing', |
| [662](#L662) | 'priority' => 10, |
| [663](#L663) | 'name'     => 'Before billing address', |
| [664](#L664) | ], |
| [665](#L665) | 'checkout\_shipping\_before'         => [ |
| [666](#L666) | 'hook'     => 'woocommerce\_checkout\_shipping', |
| [667](#L667) | 'priority' => 10, |
| [668](#L668) | 'name'     => 'Before shipping address', |
| [669](#L669) | ], |
| [670](#L670) | ], |
| [671](#L671) | ] ); |
| [672](#L672) | } |
| [673](#L673) |  |
| [674](#L674) | function sanitize\_array( $arr ) { |
| [675](#L675) | foreach ( (array) $arr as $k => $v ) { |
| [676](#L676) | if ( is\_array( $v ) ) { |
| [677](#L677) | $arr[ $k ] = self::sanitize\_array( $v ); |
| [678](#L678) | } else { |
| [679](#L679) | $arr[ $k ] = sanitize\_text\_field( $v ); |
| [680](#L680) | } |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) | return $arr; |
| [684](#L684) | } |
| [685](#L685) |  |
| [686](#L686) | function save\_post( $post\_id ) { |
| [687](#L687) | if ( isset( $\_POST['wpcsm\_location'] ) ) { |
| [688](#L688) | update\_post\_meta( $post\_id, 'wpcsm\_location', sanitize\_text\_field( $\_POST['wpcsm\_location'] ) ); |
| [689](#L689) | } |
| [690](#L690) |  |
| [691](#L691) | if ( isset( $\_POST['wpcsm\_custom\_location'] ) ) { |
| [692](#L692) | update\_post\_meta( $post\_id, 'wpcsm\_custom\_location', sanitize\_text\_field( $\_POST['wpcsm\_custom\_location'] ) ); |
| [693](#L693) | } |
| [694](#L694) |  |
| [695](#L695) | if ( isset( $\_POST['wpcsm\_conditions'] ) ) { |
| [696](#L696) | update\_post\_meta( $post\_id, 'wpcsm\_conditions', self::sanitize\_array( $\_POST['wpcsm\_conditions'] ) ); |
| [697](#L697) | } |
| [698](#L698) |  |
| [699](#L699) | if ( isset( $\_POST['wpcsm\_container'] ) ) { |
| [700](#L700) | update\_post\_meta( $post\_id, 'wpcsm\_container', sanitize\_text\_field( $\_POST['wpcsm\_container'] ) ); |
| [701](#L701) | } |
| [702](#L702) |  |
| [703](#L703) | if ( isset( $\_POST['wpcsm\_extra\_classes'] ) ) { |
| [704](#L704) | update\_post\_meta( $post\_id, 'wpcsm\_extra\_classes', sanitize\_text\_field( $\_POST['wpcsm\_extra\_classes'] ) ); |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) | if ( isset( $\_POST['wpcsm\_design'] ) ) { |
| [708](#L708) | update\_post\_meta( $post\_id, 'wpcsm\_design', sanitize\_text\_field( $\_POST['wpcsm\_design'] ) ); |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | if ( isset( $\_POST['wpcsm\_css'] ) ) { |
| [712](#L712) | update\_post\_meta( $post\_id, 'wpcsm\_css', self::sanitize\_array( $\_POST['wpcsm\_css'] ) ); |
| [713](#L713) | } |
| [714](#L714) |  |
| [715](#L715) | if ( isset( $\_POST['wpcsm\_custom\_css'] ) ) { |
| [716](#L716) | update\_post\_meta( $post\_id, 'wpcsm\_custom\_css', sanitize\_textarea\_field( $\_POST['wpcsm\_custom\_css'] ) ); |
| [717](#L717) | } |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | function init() { |
| [721](#L721) | $labels = [ |
| [722](#L722) | 'name'          => \_x( 'Smart Messages', 'Post Type General Name', 'wpc-smart-messages' ), |
| [723](#L723) | 'singular\_name' => \_x( 'Smart Message', 'Post Type Singular Name', 'wpc-smart-messages' ), |
| [724](#L724) | 'add\_new\_item'  => esc\_html\_\_( 'Add New Smart Message', 'wpc-smart-messages' ), |
| [725](#L725) | 'add\_new'       => esc\_html\_\_( 'Add New', 'wpc-smart-messages' ), |
| [726](#L726) | 'edit\_item'     => esc\_html\_\_( 'Edit Smart Message', 'wpc-smart-messages' ), |
| [727](#L727) | 'update\_item'   => esc\_html\_\_( 'Update Smart Message', 'wpc-smart-messages' ), |
| [728](#L728) | 'search\_items'  => esc\_html\_\_( 'Search Smart Message', 'wpc-smart-messages' ), |
| [729](#L729) | ]; |
| [730](#L730) |  |
| [731](#L731) | $args = [ |
| [732](#L732) | 'label'               => esc\_html\_\_( 'Smart Messages', 'wpc-smart-messages' ), |
| [733](#L733) | 'labels'              => $labels, |
| [734](#L734) | 'supports'            => [ 'title', 'editor' ], |
| [735](#L735) | 'hierarchical'        => false, |
| [736](#L736) | 'public'              => false, |
| [737](#L737) | 'show\_ui'             => true, |
| [738](#L738) | 'show\_in\_menu'        => true, |
| [739](#L739) | 'show\_in\_nav\_menus'   => true, |
| [740](#L740) | 'show\_in\_admin\_bar'   => true, |
| [741](#L741) | 'menu\_position'       => 28, |
| [742](#L742) | 'menu\_icon'           => 'dashicons-megaphone', |
| [743](#L743) | 'can\_export'          => true, |
| [744](#L744) | 'has\_archive'         => false, |
| [745](#L745) | 'exclude\_from\_search' => true, |
| [746](#L746) | 'publicly\_queryable'  => false, |
| [747](#L747) | 'capability\_type'     => 'post', |
| [748](#L748) | 'show\_in\_rest'        => false, |
| [749](#L749) | ]; |
| [750](#L750) |  |
| [751](#L751) | register\_post\_type( 'wpc\_smart\_message', $args ); |
| [752](#L752) | } |
| [753](#L753) |  |
| [754](#L754) | function enqueue\_scripts() { |
| [755](#L755) | wp\_enqueue\_style( 'hint', WPCSM\_URI . 'assets/css/hint.css' ); |
| [756](#L756) |  |
| [757](#L757) | // color picker |
| [758](#L758) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [759](#L759) | wp\_register\_script( 'wp-color-picker-alpha', WPCSM\_URI . 'assets/js/wp-color-picker-alpha.min.js', [ 'wp-color-picker' ], WPCSM\_VERSION ); |
| [760](#L760) |  |
| [761](#L761) | // wpcdpk |
| [762](#L762) | wp\_enqueue\_style( 'wpcdpk', WPCSM\_URI . 'assets/libs/wpcdpk/css/datepicker.css' ); |
| [763](#L763) | wp\_enqueue\_script( 'wpcdpk', WPCSM\_URI . 'assets/libs/wpcdpk/js/datepicker.js', [ 'jquery' ], WPCSM\_VERSION, true ); |
| [764](#L764) |  |
| [765](#L765) | wp\_enqueue\_style( 'wpcsm-backend', WPCSM\_URI . 'assets/css/backend.css', [ 'woocommerce\_admin\_styles' ], WPCSM\_VERSION ); |
| [766](#L766) | wp\_enqueue\_script( 'wpcsm-backend', WPCSM\_URI . 'assets/js/backend.js', [ |
| [767](#L767) | 'jquery', |
| [768](#L768) | 'wp-color-picker', |
| [769](#L769) | 'wp-color-picker-alpha', |
| [770](#L770) | 'wc-enhanced-select', |
| [771](#L771) | 'selectWoo' |
| [772](#L772) | ], WPCSM\_VERSION, true ); |
| [773](#L773) | } |
| [774](#L774) |  |
| [775](#L775) | function ajax\_enable() { |
| [776](#L776) | if ( isset( $\_POST['id'], $\_POST['act'] ) ) { |
| [777](#L777) | $id  = sanitize\_text\_field( $\_POST['id'] ); |
| [778](#L778) | $act = sanitize\_text\_field( $\_POST['act'] ); |
| [779](#L779) |  |
| [780](#L780) | update\_post\_meta( $id, 'wpcsm\_activate', ( $act === 'activate' ? 'on' : 'off' ) ); |
| [781](#L781) | echo $act; |
| [782](#L782) | } |
| [783](#L783) |  |
| [784](#L784) | wp\_die(); |
| [785](#L785) | } |
| [786](#L786) |  |
| [787](#L787) | function ajax\_search\_term() { |
| [788](#L788) | $return = []; |
| [789](#L789) |  |
| [790](#L790) | $args = [ |
| [791](#L791) | 'taxonomy'   => sanitize\_text\_field( $\_REQUEST['taxonomy'] ), |
| [792](#L792) | 'orderby'    => 'id', |
| [793](#L793) | 'order'      => 'ASC', |
| [794](#L794) | 'hide\_empty' => false, |
| [795](#L795) | 'fields'     => 'all', |
| [796](#L796) | 'name\_\_like' => sanitize\_text\_field( $\_REQUEST['q'] ), |
| [797](#L797) | ]; |
| [798](#L798) |  |
| [799](#L799) | $terms = get\_terms( $args ); |
| [800](#L800) |  |
| [801](#L801) | if ( count( $terms ) ) { |
| [802](#L802) | foreach ( $terms as $term ) { |
| [803](#L803) | $return[] = [ $term->slug, $term->name ]; |
| [804](#L804) | } |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | wp\_send\_json( $return ); |
| [808](#L808) | } |
| [809](#L809) |  |
| [810](#L810) | function message\_columns( $columns ) { |
| [811](#L811) | return [ |
| [812](#L812) | 'cb'       => $columns['cb'], |
| [813](#L813) | 'activate' => esc\_html\_\_( 'Activate', 'wpc-smart-messages' ), |
| [814](#L814) | 'title'    => esc\_html\_\_( 'Title', 'wpc-smart-messages' ), |
| [815](#L815) | 'location' => esc\_html\_\_( 'Location', 'wpc-smart-messages' ), |
| [816](#L816) | 'message'  => esc\_html\_\_( 'Message', 'wpc-smart-messages' ), |
| [817](#L817) | 'date'     => esc\_html\_\_( 'Date', 'wpc-smart-messages' ), |
| [818](#L818) | ]; |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | function message\_columns\_content( $column, $post\_id ) { |
| [822](#L822) | if ( $column === 'activate' ) { |
| [823](#L823) | if ( get\_post\_meta( $post\_id, 'wpcsm\_activate', true ) === 'off' ) { |
| [824](#L824) | echo '<a href="#" class="wpcsm-activate-btn activate button" data-id="' . esc\_attr( $post\_id ) . '"></a>'; |
| [825](#L825) | } else { |
| [826](#L826) | echo '<a href="#" class="wpcsm-activate-btn deactivate button button-primary" data-id="' . esc\_attr( $post\_id ) . '"></a>'; |
| [827](#L827) | } |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | if ( $column === 'location' ) { |
| [831](#L831) | $location = get\_post\_meta( $post\_id, 'wpcsm\_location', true ) ?: 'store\_notice\_info'; |
| [832](#L832) |  |
| [833](#L833) | if ( $location === 'custom' ) { |
| [834](#L834) | echo get\_post\_meta( $post\_id, 'wpcsm\_custom\_location', true ); |
| [835](#L835) | } else { |
| [836](#L836) | $locations    = self::get\_locations(); |
| [837](#L837) | $has\_location = false; |
| [838](#L838) |  |
| [839](#L839) | foreach ( $locations as $group => $location\_keys ) { |
| [840](#L840) | if ( array\_key\_exists( $location, $location\_keys ) ) { |
| [841](#L841) | $has\_location = true; |
| [842](#L842) | echo esc\_html( is\_array( $location\_keys[ $location ] ) && isset( $location\_keys[ $location ]['name'] ) ? $group . ' > ' . $location\_keys[ $location ]['name'] : $group . ' > ' . $location\_keys[ $location ] ); |
| [843](#L843) |  |
| [844](#L844) | break; |
| [845](#L845) | } |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | if ( ! $has\_location ) { |
| [849](#L849) | echo esc\_html( $location ); |
| [850](#L850) | } |
| [851](#L851) | } |
| [852](#L852) | } |
| [853](#L853) |  |
| [854](#L854) | if ( $column === 'message' ) { |
| [855](#L855) | echo wp\_strip\_all\_tags( get\_the\_content( null, false, $post\_id ) ); |
| [856](#L856) | } |
| [857](#L857) | } |
| [858](#L858) | } |
| [859](#L859) |  |
| [860](#L860) | Wpcsm\_Backend::instance(); |
| [861](#L861) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpc-smart-messages/tags/4.2.1/includes/class-backend.php?format=txt)
* [Original Format](/export/3220797/wpc-smart-messages/tags/4.2.1/includes/class-backend.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

