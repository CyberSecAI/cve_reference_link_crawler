=== Content from git.kernel.org_c44fdf0a_20250111_194222.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mian Yousaf Kaukab <ykaukab@suse.de> | 2021-12-08 10:32:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-29 12:23:36 +0100 |
| commit | [8efd6a3391f7b0b19fb0c38e50add06ca30c94af](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)) | |
| tree | [df972246ec0217a072877cb7ab44eeeac9ad0c9b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af) | |
| parent | [cd24bafefc17947532008c3667637aee7471d7a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd24bafefc17947532008c3667637aee7471d7a8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af&id2=cd24bafefc17947532008c3667637aee7471d7a8)) | |
| download | [linux-8efd6a3391f7b0b19fb0c38e50add06ca30c94af.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8efd6a3391f7b0b19fb0c38e50add06ca30c94af.tar.gz) | |

ipmi: ssif: initialize ssif\_info->client earlycommit 34f35f8f14bc406efc06ee4ff73202c6fd245d15 upstream.
During probe ssif\_info->client is dereferenced in error path. However,
it is set when some of the error checking has already been done. This
causes following kernel crash if an error path is taken:
[ 30.645593][ T674] ipmi\_ssif 0-000e: ipmi\_ssif: Not probing, Interface already present
[ 30.657616][ T674] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000088
...
[ 30.657723][ T674] pc : \_\_dev\_printk+0x28/0xa0
[ 30.657732][ T674] lr : \_dev\_err+0x7c/0xa0
...
[ 30.657772][ T674] Call trace:
[ 30.657775][ T674] \_\_dev\_printk+0x28/0xa0
[ 30.657778][ T674] \_dev\_err+0x7c/0xa0
[ 30.657781][ T674] ssif\_probe+0x548/0x900 [ipmi\_ssif 62ce4b08badc1458fd896206d9ef69a3c31f3d3e]
[ 30.657791][ T674] i2c\_device\_probe+0x37c/0x3c0
...
Initialize ssif\_info->client before any error path can be taken. Clear
i2c\_client data in the error path to prevent the dangling pointer from
leaking.
Fixes: c4436c9149c5 ("ipmi\_ssif: avoid registering duplicate ssif interface")
Cc: stable@vger.kernel.org # 5.4.x
Suggested-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Mian Yousaf Kaukab <ykaukab@suse.de>
Message-Id: <20211208093239.4432-1-ykaukab@suse.de>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)

| -rw-r--r-- | [drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/char/ipmi/ipmi_ssif.c?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/char/ipmi/ipmi\_ssif.c b/drivers/char/ipmi/ipmi\_ssif.cindex 8ac390c2b51475..bb42a1c92cae53 100644--- a/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=cd24bafefc17947532008c3667637aee7471d7a8)+++ b/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=8efd6a3391f7b0b19fb0c38e50add06ca30c94af)@@ -1704,6 +1704,9 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) } } + ssif\_info->client = client;+ i2c\_set\_clientdata(client, ssif\_info);+ rv = ssif\_check\_and\_remove(client, ssif\_info); /\* If rv is 0 and addr source is not SI\_ACPI, continue probing \*/ if (!rv && ssif\_info->addr\_source == SI\_ACPI) {@@ -1724,9 +1727,6 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) ipmi\_addr\_src\_to\_str(ssif\_info->addr\_source), client->addr, client->adapter->name, slave\_addr); - ssif\_info->client = client;- i2c\_set\_clientdata(client, ssif\_info);- /\* Now check for system interface capabilities \*/ msg[0] = IPMI\_NETFN\_APP\_REQUEST << 2; msg[1] = IPMI\_GET\_SYSTEM\_INTERFACE\_CAPABILITIES\_CMD;@@ -1926,6 +1926,7 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id)  dev\_err(&ssif\_info->client->dev, "Unable to start IPMI SSIF: %d\n", rv);+ i2c\_set\_clientdata(client, NULL); kfree(ssif\_info); } kfree(resp); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:41:00 +0000



=== Content from git.kernel.org_93afb548_20250111_194220.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mian Yousaf Kaukab <ykaukab@suse.de> | 2021-12-08 10:32:39 +0100 |
| --- | --- | --- |
| committer | Corey Minyard <cminyard@mvista.com> | 2021-12-08 07:13:37 -0600 |
| commit | [34f35f8f14bc406efc06ee4ff73202c6fd245d15](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)) | |
| tree | [5cc8f610916b226686442747472422dda7a354fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15) | |
| parent | [12119cfa1052d512a92524e90ebee85029a918f8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=12119cfa1052d512a92524e90ebee85029a918f8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15&id2=12119cfa1052d512a92524e90ebee85029a918f8)) | |
| download | [linux-34f35f8f14bc406efc06ee4ff73202c6fd245d15.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-34f35f8f14bc406efc06ee4ff73202c6fd245d15.tar.gz) | |

ipmi: ssif: initialize ssif\_info->client earlyDuring probe ssif\_info->client is dereferenced in error path. However,
it is set when some of the error checking has already been done. This
causes following kernel crash if an error path is taken:
[ 30.645593][ T674] ipmi\_ssif 0-000e: ipmi\_ssif: Not probing, Interface already present
[ 30.657616][ T674] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000088
...
[ 30.657723][ T674] pc : \_\_dev\_printk+0x28/0xa0
[ 30.657732][ T674] lr : \_dev\_err+0x7c/0xa0
...
[ 30.657772][ T674] Call trace:
[ 30.657775][ T674] \_\_dev\_printk+0x28/0xa0
[ 30.657778][ T674] \_dev\_err+0x7c/0xa0
[ 30.657781][ T674] ssif\_probe+0x548/0x900 [ipmi\_ssif 62ce4b08badc1458fd896206d9ef69a3c31f3d3e]
[ 30.657791][ T674] i2c\_device\_probe+0x37c/0x3c0
...
Initialize ssif\_info->client before any error path can be taken. Clear
i2c\_client data in the error path to prevent the dangling pointer from
leaking.
Fixes: c4436c9149c5 ("ipmi\_ssif: avoid registering duplicate ssif interface")
Cc: stable@vger.kernel.org # 5.4.x
Suggested-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Mian Yousaf Kaukab <ykaukab@suse.de>
Message-Id: <20211208093239.4432-1-ykaukab@suse.de>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)

| -rw-r--r-- | [drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/char/ipmi/ipmi_ssif.c?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/char/ipmi/ipmi\_ssif.c b/drivers/char/ipmi/ipmi\_ssif.cindex 0c62e578749ef9..48aab77abebf1f 100644--- a/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=12119cfa1052d512a92524e90ebee85029a918f8)+++ b/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=34f35f8f14bc406efc06ee4ff73202c6fd245d15)@@ -1659,6 +1659,9 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) } } + ssif\_info->client = client;+ i2c\_set\_clientdata(client, ssif\_info);+ rv = ssif\_check\_and\_remove(client, ssif\_info); /\* If rv is 0 and addr source is not SI\_ACPI, continue probing \*/ if (!rv && ssif\_info->addr\_source == SI\_ACPI) {@@ -1679,9 +1682,6 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) ipmi\_addr\_src\_to\_str(ssif\_info->addr\_source), client->addr, client->adapter->name, slave\_addr); - ssif\_info->client = client;- i2c\_set\_clientdata(client, ssif\_info);- /\* Now check for system interface capabilities \*/ msg[0] = IPMI\_NETFN\_APP\_REQUEST << 2; msg[1] = IPMI\_GET\_SYSTEM\_INTERFACE\_CAPABILITIES\_CMD;@@ -1881,6 +1881,7 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id)  dev\_err(&ssif\_info->client->dev, "Unable to start IPMI SSIF: %d\n", rv);+ i2c\_set\_clientdata(client, NULL); kfree(ssif\_info); } kfree(resp); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:40:57 +0000



=== Content from git.kernel.org_04564ea8_20250111_194220.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mian Yousaf Kaukab <ykaukab@suse.de> | 2021-12-08 10:32:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-29 12:26:01 +0100 |
| commit | [1f6ab847461ce7dd89ae9db2dd4658c993355d7c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)) | |
| tree | [b0d0e56131eb50b40ff8c30053087f50be70c340](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c) | |
| parent | [a5192f31160c1739ef6525ed77d6aafa8e6565dd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a5192f31160c1739ef6525ed77d6aafa8e6565dd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c&id2=a5192f31160c1739ef6525ed77d6aafa8e6565dd)) | |
| download | [linux-1f6ab847461ce7dd89ae9db2dd4658c993355d7c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1f6ab847461ce7dd89ae9db2dd4658c993355d7c.tar.gz) | |

ipmi: ssif: initialize ssif\_info->client earlycommit 34f35f8f14bc406efc06ee4ff73202c6fd245d15 upstream.
During probe ssif\_info->client is dereferenced in error path. However,
it is set when some of the error checking has already been done. This
causes following kernel crash if an error path is taken:
[ 30.645593][ T674] ipmi\_ssif 0-000e: ipmi\_ssif: Not probing, Interface already present
[ 30.657616][ T674] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000088
...
[ 30.657723][ T674] pc : \_\_dev\_printk+0x28/0xa0
[ 30.657732][ T674] lr : \_dev\_err+0x7c/0xa0
...
[ 30.657772][ T674] Call trace:
[ 30.657775][ T674] \_\_dev\_printk+0x28/0xa0
[ 30.657778][ T674] \_dev\_err+0x7c/0xa0
[ 30.657781][ T674] ssif\_probe+0x548/0x900 [ipmi\_ssif 62ce4b08badc1458fd896206d9ef69a3c31f3d3e]
[ 30.657791][ T674] i2c\_device\_probe+0x37c/0x3c0
...
Initialize ssif\_info->client before any error path can be taken. Clear
i2c\_client data in the error path to prevent the dangling pointer from
leaking.
Fixes: c4436c9149c5 ("ipmi\_ssif: avoid registering duplicate ssif interface")
Cc: stable@vger.kernel.org # 5.4.x
Suggested-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Mian Yousaf Kaukab <ykaukab@suse.de>
Message-Id: <20211208093239.4432-1-ykaukab@suse.de>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)

| -rw-r--r-- | [drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/char/ipmi/ipmi_ssif.c?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/char/ipmi/ipmi\_ssif.c b/drivers/char/ipmi/ipmi\_ssif.cindex 0416b9c9d41054..3de679723648b1 100644--- a/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=a5192f31160c1739ef6525ed77d6aafa8e6565dd)+++ b/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=1f6ab847461ce7dd89ae9db2dd4658c993355d7c)@@ -1700,6 +1700,9 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) } } + ssif\_info->client = client;+ i2c\_set\_clientdata(client, ssif\_info);+ rv = ssif\_check\_and\_remove(client, ssif\_info); /\* If rv is 0 and addr source is not SI\_ACPI, continue probing \*/ if (!rv && ssif\_info->addr\_source == SI\_ACPI) {@@ -1720,9 +1723,6 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) ipmi\_addr\_src\_to\_str(ssif\_info->addr\_source), client->addr, client->adapter->name, slave\_addr); - ssif\_info->client = client;- i2c\_set\_clientdata(client, ssif\_info);- /\* Now check for system interface capabilities \*/ msg[0] = IPMI\_NETFN\_APP\_REQUEST << 2; msg[1] = IPMI\_GET\_SYSTEM\_INTERFACE\_CAPABILITIES\_CMD;@@ -1922,6 +1922,7 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id)  dev\_err(&ssif\_info->client->dev, "Unable to start IPMI SSIF: %d\n", rv);+ i2c\_set\_clientdata(client, NULL); kfree(ssif\_info); } kfree(resp); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:40:57 +0000



=== Content from git.kernel.org_8cc831c2_20250111_194221.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mian Yousaf Kaukab <ykaukab@suse.de> | 2021-12-08 10:32:39 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-29 12:28:53 +0100 |
| commit | [77a7311ca167aa5b7055c549a940a56e73ee5f29](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)) | |
| tree | [6f3cbfebd447c147a8bab3aa9746f35fadfcc392](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29) | |
| parent | [7232a5941d3fb41df5f10a99051710ef3bcce7d9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7232a5941d3fb41df5f10a99051710ef3bcce7d9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29&id2=7232a5941d3fb41df5f10a99051710ef3bcce7d9)) | |
| download | [linux-77a7311ca167aa5b7055c549a940a56e73ee5f29.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-77a7311ca167aa5b7055c549a940a56e73ee5f29.tar.gz) | |

ipmi: ssif: initialize ssif\_info->client earlycommit 34f35f8f14bc406efc06ee4ff73202c6fd245d15 upstream.
During probe ssif\_info->client is dereferenced in error path. However,
it is set when some of the error checking has already been done. This
causes following kernel crash if an error path is taken:
[ 30.645593][ T674] ipmi\_ssif 0-000e: ipmi\_ssif: Not probing, Interface already present
[ 30.657616][ T674] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000088
...
[ 30.657723][ T674] pc : \_\_dev\_printk+0x28/0xa0
[ 30.657732][ T674] lr : \_dev\_err+0x7c/0xa0
...
[ 30.657772][ T674] Call trace:
[ 30.657775][ T674] \_\_dev\_printk+0x28/0xa0
[ 30.657778][ T674] \_dev\_err+0x7c/0xa0
[ 30.657781][ T674] ssif\_probe+0x548/0x900 [ipmi\_ssif 62ce4b08badc1458fd896206d9ef69a3c31f3d3e]
[ 30.657791][ T674] i2c\_device\_probe+0x37c/0x3c0
...
Initialize ssif\_info->client before any error path can be taken. Clear
i2c\_client data in the error path to prevent the dangling pointer from
leaking.
Fixes: c4436c9149c5 ("ipmi\_ssif: avoid registering duplicate ssif interface")
Cc: stable@vger.kernel.org # 5.4.x
Suggested-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Mian Yousaf Kaukab <ykaukab@suse.de>
Message-Id: <20211208093239.4432-1-ykaukab@suse.de>
Signed-off-by: Corey Minyard <cminyard@mvista.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)

| -rw-r--r-- | [drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/char/ipmi/ipmi_ssif.c?id=77a7311ca167aa5b7055c549a940a56e73ee5f29) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/char/ipmi/ipmi\_ssif.c b/drivers/char/ipmi/ipmi\_ssif.cindex 20d5af92966d43..8d7a8898e80b03 100644--- a/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=7232a5941d3fb41df5f10a99051710ef3bcce7d9)+++ b/[drivers/char/ipmi/ipmi\_ssif.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/char/ipmi/ipmi_ssif.c?id=77a7311ca167aa5b7055c549a940a56e73ee5f29)@@ -1659,6 +1659,9 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) } } + ssif\_info->client = client;+ i2c\_set\_clientdata(client, ssif\_info);+ rv = ssif\_check\_and\_remove(client, ssif\_info); /\* If rv is 0 and addr source is not SI\_ACPI, continue probing \*/ if (!rv && ssif\_info->addr\_source == SI\_ACPI) {@@ -1679,9 +1682,6 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id) ipmi\_addr\_src\_to\_str(ssif\_info->addr\_source), client->addr, client->adapter->name, slave\_addr); - ssif\_info->client = client;- i2c\_set\_clientdata(client, ssif\_info);- /\* Now check for system interface capabilities \*/ msg[0] = IPMI\_NETFN\_APP\_REQUEST << 2; msg[1] = IPMI\_GET\_SYSTEM\_INTERFACE\_CAPABILITIES\_CMD;@@ -1881,6 +1881,7 @@ static int ssif\_probe(struct i2c\_client \*client, const struct i2c\_device\_id \*id)  dev\_err(&ssif\_info->client->dev, "Unable to start IPMI SSIF: %d\n", rv);+ i2c\_set\_clientdata(client, NULL); kfree(ssif\_info); } kfree(resp); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 19:40:59 +0000


