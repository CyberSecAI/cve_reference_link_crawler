

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jason Wang <jasowang@redhat.com> | 2021-09-17 16:34:06 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-09-30 10:12:57 +0200 |
| commit | [f020bb63b5d2e5576acadd10e158fe3b04af67ba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)) | |
| tree | [479b7490e5aa29ec8c62ec252d370a3a8d23c5fd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba) | |
| parent | [9a5ba85e8dce59bd7d4dcd62b4ae096c650ceac6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9a5ba85e8dce59bd7d4dcd62b4ae096c650ceac6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba&id2=9a5ba85e8dce59bd7d4dcd62b4ae096c650ceac6)) | |
| download | [linux-f020bb63b5d2e5576acadd10e158fe3b04af67ba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f020bb63b5d2e5576acadd10e158fe3b04af67ba.tar.gz) | |

virtio-net: fix pages leaking when building skb in big mode[ Upstream commit afd92d82c9d715fb97565408755acad81573591a ]
We try to use build\_skb() if we had sufficient tailroom. But we forget
to release the unused pages chained via private in big mode which will
leak pages. Fixing this by release the pages after building the skb in
big mode.
Cc: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
Fixes: fb32856b16ad ("virtio-net: page\_to\_skb() use build\_skb when there's sufficient tailroom")
Signed-off-by: Jason Wang <jasowang@redhat.com>
Reviewed-by: Xuan Zhuo <xuanzhuo@linux.alibaba.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)

| -rw-r--r-- | [drivers/net/virtio\_net.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/virtio_net.c?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/net/virtio\_net.c b/drivers/net/virtio\_net.cindex eee493685aad5d..fb96658bb91ff0 100644--- a/[drivers/net/virtio\_net.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/virtio_net.c?id=9a5ba85e8dce59bd7d4dcd62b4ae096c650ceac6)+++ b/[drivers/net/virtio\_net.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/virtio_net.c?id=f020bb63b5d2e5576acadd10e158fe3b04af67ba)@@ -435,6 +435,10 @@ static struct sk\_buff \*page\_to\_skb(struct virtnet\_info \*vi,  skb\_reserve(skb, p - buf); skb\_put(skb, len);++ page = (struct page \*)page->private;+ if (page)+ give\_pages(rq, page); goto ok; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:32:00 +0000

