=== Content from plugins.trac.wordpress.org_cc587cee_20250110_195945.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3167148)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3167147 "Changeset 3167147")
* [Next Changeset](/changeset/3167149 "Changeset 3167149") →

---

# Changeset 3167148

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/11/2024 11:53:17 AM
([3 months](/timeline?from=2024-10-11T11%3A53%3A17Z&precision=second "See timeline at 10/11/2024 11:53:17 AM") ago)

Author:
babbardel
Message:

tagging version 1.0.1

File:

1 edited

* [category-icon/trunk/readme.txt](/browser/category-icon/trunk/readme.txt?rev=3167148 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [category-icon/trunk/readme.txt](/changeset/3167148/category-icon/trunk/readme.txt "Show the changeset 3167148 restricted to category-icon/trunk/readme.txt")

  | [r3167145](/browser/category-icon/trunk/readme.txt?rev=3167145#L28 "Show revision 3167145 of this file in browser") | [r3167148](/browser/category-icon/trunk/readme.txt?rev=3167148#L28 "Show revision 3167148 of this file in browser") |  |
  | --- | --- | --- |
  | 28 | 28 |  |
  | 29 | 29 | = 1.0.1 = |
  |  | 30 | \* Added sanitization for SVG uploads to prevent Cross-Site Scripting (XSS) vulnerabilities. |
  |  | 31 | \* Implemented secure file naming for uploaded SVG files by appending a random suffix to filenames. |
  |  | 32 | \* Enhanced upload handling to ensure SVG files are sanitized in place without altering the original upload path. |
  |  | 33 | \* Improved compatibility with WordPress file upload checks. |
  | 30 | 34 |  |
  | 31 | 35 | = 1.0.0 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3167148)
* [Zip Archive](?format=zip&new=3167148)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_388f6c0a_20250110_195946.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Category Icon

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fcategory-icon&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fcategory-icon&locale=en_US)

Search plugins

![](https://ps.w.org/category-icon/assets/banner-772x250.png?rev=1263844)
![](https://ps.w.org/category-icon/assets/icon.svg?rev=1263877)
# Category Icon

By [Pixelgrade](http://pixelgrade.com)

[Download](https://downloads.wordpress.org/plugin/category-icon.1.0.1.zip)

* [Details](https://wordpress.org/plugins/category-icon/#description)
* [Reviews](https://wordpress.org/plugins/category-icon/#reviews)
* [Installation](https://wordpress.org/plugins/category-icon/#installation)
* [Development](https://wordpress.org/plugins/category-icon/#developers)

[Support](https://wordpress.org/support/plugin/category-icon/)

## Description

A WordPress plugin to easily attach an icon to a category, tag or any other taxonomy term.

\*\* Now supports a category, tag or any other taxonomy image field, also.

Please note that this plugin will not automatically output the icon or the image on the frontend of our site.

It is up to you to query and output in your theme using the provided getter functions: `get_term_icon_id()`, `get_term_icon_url()`, `get_term_image_id()`, `get_term_image_url()`.

## Installation

1. Install Category Icon either via the WordPress.org plugin directory, or by uploading the files to your `/wp-content/plugins/` directory
2. After activating Category Icon go and edit any category or term to see the upload field.
3. Now you can add or edit category, tags or any other taxonomy terms icons.

## Reviews

![](https://secure.gravatar.com/avatar/c72b1c71cd0802e6bbedf05b201ccfa2526709ed43cec735d9bd6da662c5b1da?s=60&d=retro&r=g)
### [No documentation](https://wordpress.org/support/topic/no-documentation-52/)

[mogeh](https://profiles.wordpress.org/mogeh/ "Posts by mogeh")
December 8, 2022

How would someone implement your plugin if
there is no documentation?
The idea is good but the delivery is poor taste.

![](https://secure.gravatar.com/avatar/72c999339f3a4d12eb4356d97decbf047563fa603480fbdf80a9d5536f696e33?s=60&d=retro&r=g)
### [not working anymore on wp 5.4.2 anymore](https://wordpress.org/support/topic/not-working-anymore-on-wp-5-2-4-anymore/)

[farzinsb](https://profiles.wordpress.org/farzinsb/ "Posts by farzinsb")
June 27, 2020

It is causing errors for my other plugins without showing any errors on screen or in error\_log file or chrome console in latest wp update 5.4.2. so I removed it.

![](https://secure.gravatar.com/avatar/26291a3e27bd18f19210e959736696d8527c5888fa120aaeea76025b6df94891?s=60&d=retro&r=g)
### [Absolutely useless](https://wordpress.org/support/topic/absolutely-useless-8/)

[Joe Bloggs](https://profiles.wordpress.org/joe-bloggs/ "Posts by Joe Bloggs")
November 24, 2019
1 reply

This plugin is absolutely useless without any instructions on how to actually fetch the icon after it has been assigned to a taxonomy term.
No support what’s so ever, support questions unanswered, figure out for your self kind of thing.
Well done guys!

[Read all 3 reviews](https://wordpress.org/support/plugin/category-icon/reviews/)
## Contributors & Developers

“Category Icon” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/92b145017152b912cd86d66b2f0d57cee115e896c97899bc469f85da774598dd?s=32&d=mm&r=g) [pixelgrade](https://profiles.wordpress.org/pixelgrade/)
* ![](https://secure.gravatar.com/avatar/ccc27d0e9ef97559eb3994006fc07e09ca24a72ff4819d485617d4337a8198ca?s=32&d=mm&r=g) [vlad.olaru](https://profiles.wordpress.org/vladolaru/)
* ![](https://secure.gravatar.com/avatar/d009163b3cb8ccf934981570634cdeb71e937529bef967d7f130e203680b745d?s=32&d=mm&r=g) [George Olaru](https://profiles.wordpress.org/babbardel/)

“Category Icon” has been translated into 5 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/category-icon/contributors) for their contributions.

[Translate “Category Icon” into your language.](https://translate.wordpress.org/projects/wp-plugins/category-icon)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/category-icon/), check out the [SVN repository](https://plugins.svn.wordpress.org/category-icon/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/category-icon/) by [RSS](https://plugins.trac.wordpress.org/log/category-icon/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

#### 1.0.1

* Added sanitization for SVG uploads to prevent Cross-Site Scripting (XSS) vulnerabilities.
* Implemented secure file naming for uploaded SVG files by appending a random suffix to filenames.
* Enhanced upload handling to ensure SVG files are sanitized in place without altering the original upload path.
* Improved compatibility with WordPress file upload checks.

#### 1.0.0

* Ensure compatibility with WordPress 5.9
* Add getter functions for term icon and image.
* Update build process.
* Clarify description and instructions about what this plugin does and doesn’t do.

#### 0.7.1

* Improve compatibility with WordPress 5.7

#### 0.7.0

* We did several compatibility checks with Gutenberg so everything will work just fine
* Solved an issue where Category-Icon was having a conflict with other plugins in the Dashboard

#### 0.6.0

* Add a category image field to be used as featured category image

#### 0.5.0

* Deploy on wordpress.org

#### 0.0.1

* Init Plugin

## Meta

* Version **1.0.0**
* Last updated **3 months ago**
* Active installations **3,000+**
* WordPress version **4.9.19 or higher**
* Tested up to **6.6.2**
* PHP version **5.6.40 or higher**
* Languages
  See all 6

  Close

  [English (US)](https://wordpress.org/plugins/category-icon/), [Spanish (Colombia)](https://es-co.wordpress.org/plugins/category-icon/), [Spanish (Mexico)](https://es-mx.wordpress.org/plugins/category-icon/), [Spanish (Spain)](https://es.wordpress.org/plugins/category-icon/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/category-icon/), and [Swedish](https://sv.wordpress.org/plugins/category-icon/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/category-icon)
* Tags [category](https://wordpress.org/plugins/tags/category/)[icon](https://wordpress.org/plugins/tags/icon/)[image](https://wordpress.org/plugins/tags/image/)[taxonomy](https://wordpress.org/plugins/tags/taxonomy/)[term](https://wordpress.org/plugins/tags/term/)
* [Advanced View](https://wordpress.org/plugins/category-icon/advanced/)

## Ratings

1 out of 5 stars.

* [0 5-star reviews
  5 stars

  0](https://wordpress.org/support/plugin/category-icon/reviews/?filter=5)
* [0 4-star reviews
  4 stars

  0](https://wordpress.org/support/plugin/category-icon/reviews/?filter=4)
* [0 3-star reviews
  3 stars

  0](https://wordpress.org/support/plugin/category-icon/reviews/?filter=3)
* [0 2-star reviews
  2 stars

  0](https://wordpress.org/support/plugin/category-icon/reviews/?filter=2)
* [3 1-star reviews
  1 star

  3](https://wordpress.org/support/plugin/category-icon/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/category-icon/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/category-icon/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/92b145017152b912cd86d66b2f0d57cee115e896c97899bc469f85da774598dd?s=32&d=mm&r=g) [pixelgrade](https://profiles.wordpress.org/pixelgrade/)
* ![](https://secure.gravatar.com/avatar/ccc27d0e9ef97559eb3994006fc07e09ca24a72ff4819d485617d4337a8198ca?s=32&d=mm&r=g) [vlad.olaru](https://profiles.wordpress.org/vladolaru/)
* ![](https://secure.gravatar.com/avatar/d009163b3cb8ccf934981570634cdeb71e937529bef967d7f130e203680b745d?s=32&d=mm&r=g) [George Olaru](https://profiles.wordpress.org/babbardel/)
## Support

Issues resolved in last two months:

0 out of 1

[View support forum](https://wordpress.org/support/plugin/category-icon/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_b0a0b9e8_20250110_195945.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fcategory-icon%2Ftrunk%2Fcategory-icon.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/category-icon/trunk/category-icon.php?rev=3167142 "Revision 3167142")
* Next Revision →
* [Blame](/browser/category-icon/trunk/category-icon.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/category-icon/trunk/category-icon.php)

---

# [source:](/browser?order=name "Go to repository root") [category-icon](/browser/category-icon?order=name "View category-icon")/[trunk](/browser/category-icon/trunk?order=name "View trunk")/[category-icon.php](/browser/category-icon/trunk/category-icon.php?order=name "View category-icon.php")

View diff against:

View revision:

| [Last change](/changeset/3167145/category-icon/trunk/category-icon.php "View differences") on this file was [3167145](/changeset/3167145/ "View changeset 3167145"), checked in by babbardel, [3 months ago](/timeline?from=2024-10-11T11%3A51%3A12Z&precision=second "See timeline at 10/11/2024 11:51:12 AM") |
| --- |
| tagging version 1.0.1 |
| **File size:** 17.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name: Category Icon |
| [4](#L4) | \* Plugin URI:  http://pixelgrade.com |
| [5](#L5) | \* Description: Easily attach an icon and/or an image to a category, tag or any other taxonomy term. |
| [6](#L6) | \* Version: 1.0.1 |
| [7](#L7) | \* Author: Pixelgrade |
| [8](#L8) | \* Author URI: http://pixelgrade.com |
| [9](#L9) | \* Author Email: contact@pixelgrade.com |
| [10](#L10) | \* Text Domain: category-icon |
| [11](#L11) | \* License:     GPL-2.0+ |
| [12](#L12) | \* License URI: http://www.gnu.org/licenses/gpl-2.0.txt |
| [13](#L13) | \* Domain Path: /lang |
| [14](#L14) | \* Requires at least: 4.9.19 |
| [15](#L15) | \* Tested up to:      6.6.2 |
| [16](#L16) | \* Requires PHP:      5.6.40 |
| [17](#L17) | \*/ |
| [18](#L18) |  |
| [19](#L19) | // If this file is called directly, abort. |
| [20](#L20) | if ( ! defined( 'ABSPATH' ) ) { |
| [21](#L21) | die; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | global $pixtaxonomyicons\_plugin; |
| [25](#L25) | $pixtaxonomyicons\_plugin = PixTaxonomyIconsPlugin::get\_instance(); |
| [26](#L26) |  |
| [27](#L27) | class PixTaxonomyIconsPlugin { |
| [28](#L28) | protected static $instance; |
| [29](#L29) |  |
| [30](#L30) | protected $plugin\_basepath = null; |
| [31](#L31) | protected $plugin\_baseurl = null; |
| [32](#L32) | protected $plugin\_screen\_hook\_suffix = null; |
| [33](#L33) | protected $version = '1.0.0'; |
| [34](#L34) | protected $plugin\_slug = 'category-icon'; |
| [35](#L35) | protected $plugin\_key = 'category-icon'; |
| [36](#L36) |  |
| [37](#L37) | protected $default\_settings = array( |
| [38](#L38) | 'taxonomies' => array( |
| [39](#L39) | 'category' => 'on', |
| [40](#L40) | 'post\_tag' => 'on' |
| [41](#L41) | ) |
| [42](#L42) | ); |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* Initialize the plugin by setting localization, filters, and administration functions. |
| [46](#L46) | \* @since     1.0.0 |
| [47](#L47) | \*/ |
| [48](#L48) | protected function \_\_construct() { |
| [49](#L49) |  |
| [50](#L50) | $this->plugin\_basepath = plugin\_dir\_path( \_\_FILE\_\_ ); |
| [51](#L51) | $this->plugin\_baseurl = plugin\_dir\_url( \_\_FILE\_\_ ); |
| [52](#L52) |  |
| [53](#L53) | require\_once( 'inc/extras.php'); |
| [54](#L54) |  |
| [55](#L55) | $options = get\_option('category-icon'); |
| [56](#L56) | // ensure some defaults |
| [57](#L57) | if ( empty( $options ) ) { |
| [58](#L58) | $options = $this->get\_defaults(); |
| [59](#L59) | update\_option( 'category-icon', $options); |
| [60](#L60) | } |
| [61](#L61) |  |
| [62](#L62) | /\*\* |
| [63](#L63) | \* As we code this, WordPress has a problem with uploading and viewing svg files. |
| [64](#L64) | \* Until they get it done in core, we use these filters |
| [65](#L65) | \*/ |
| [66](#L66) | add\_filter('upload\_mimes', array( $this, 'allow\_svg\_in\_mime\_types' ) ); |
| [67](#L67) | add\_filter('wp\_handle\_upload\_prefilter', array($this, 'sanitize\_svg\_upload')); |
| [68](#L68) | add\_action('admin\_head', array( $this, 'force\_svg\_with\_visible\_sizes' ) ); |
| [69](#L69) |  |
| [70](#L70) | add\_action( 'admin\_menu', array( $this, 'add\_plugin\_admin\_menu' ) ); |
| [71](#L71) |  |
| [72](#L72) | add\_action( 'admin\_init', array( $this, 'plugin\_admin\_init' ) ); |
| [73](#L73) |  |
| [74](#L74) | // Load plugin text domain |
| [75](#L75) | add\_action( 'init', array( $this, 'plugin\_init' ), 9999999999 ); |
| [76](#L76) | add\_action( 'init', array( $this, 'register\_the\_termmeta\_table' ), 1 ); |
| [77](#L77) | add\_action('wpmu\_new\_blog', array($this, 'new\_blog'), 10, 6); |
| [78](#L78) |  |
| [79](#L79) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_admin\_scripts' ) ); |
| [80](#L80) |  |
| [81](#L81) | register\_activation\_hook( \_\_FILE\_\_, array($this, 'activate') ); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | /\*\* |
| [85](#L85) | \* Handles the SVG upload process by sanitizing the file content, |
| [86](#L86) | \* generating a random filename, and preserving the original upload path. |
| [87](#L87) | \* |
| [88](#L88) | \* @param array $file The uploaded file information. |
| [89](#L89) | \* @return array The modified file information with sanitized content and updated filename. |
| [90](#L90) | \*/ |
| [91](#L91) | public function sanitize\_svg\_upload($file) { |
| [92](#L92) | // Check if the uploaded file is an SVG |
| [93](#L93) | if ($file['type'] === 'image/svg+xml') { |
| [94](#L94) | // Step 1: Read the original SVG content from the temporary file location |
| [95](#L95) | $svg\_content = file\_get\_contents($file['tmp\_name']); |
| [96](#L96) |  |
| [97](#L97) | // Step 2: Sanitize the SVG content to remove any potentially unsafe elements |
| [98](#L98) | $clean\_svg = $this->sanitize\_svg\_content($svg\_content); |
| [99](#L99) |  |
| [100](#L100) | // Step 3: Extract the original file name (without extension) for use in the new name |
| [101](#L101) | $original\_name = pathinfo($file['name'], PATHINFO\_FILENAME); |
| [102](#L102) |  |
| [103](#L103) | // Step 4: Sanitize the original name to ensure no special characters remain |
| [104](#L104) | $sanitized\_name = sanitize\_file\_name($original\_name); |
| [105](#L105) |  |
| [106](#L106) | // Step 5: Generate a unique filename by appending a random suffix to the sanitized name |
| [107](#L107) | $random\_suffix = wp\_generate\_password(6, false); |
| [108](#L108) | $new\_filename = "{$sanitized\_name}-{$random\_suffix}.svg"; |
| [109](#L109) |  |
| [110](#L110) | // Step 6: Overwrite the temporary file with the sanitized SVG content |
| [111](#L111) | file\_put\_contents($file['tmp\_name'], $clean\_svg); |
| [112](#L112) |  |
| [113](#L113) | // Step 7: Update the file's displayed name, leaving tmp\_name intact for WordPress to handle |
| [114](#L114) | $file['name'] = $new\_filename; |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | // Return the updated file information back to WordPress |
| [118](#L118) | return $file; |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* Sanitizes SVG content by removing <script> elements and any unsafe attributes. |
| [123](#L123) | \* This helps mitigate potential XSS vulnerabilities from SVG uploads. |
| [124](#L124) | \* |
| [125](#L125) | \* @param string $svg\_content The raw SVG content to be sanitized. |
| [126](#L126) | \* @return string The sanitized SVG content. |
| [127](#L127) | \*/ |
| [128](#L128) | private function sanitize\_svg\_content($svg\_content) { |
| [129](#L129) | // Create a new DOMDocument instance to parse the SVG XML content |
| [130](#L130) | $dom = new DOMDocument(); |
| [131](#L131) |  |
| [132](#L132) | // Suppress XML parsing errors for invalid SVG formats |
| [133](#L133) | libxml\_use\_internal\_errors(true); |
| [134](#L134) |  |
| [135](#L135) | // Load the SVG content into the DOMDocument for manipulation |
| [136](#L136) | $dom->loadXML($svg\_content, LIBXML\_NOENT | LIBXML\_DTDLOAD); |
| [137](#L137) |  |
| [138](#L138) | // Clear any XML parsing errors |
| [139](#L139) | libxml\_clear\_errors(); |
| [140](#L140) |  |
| [141](#L141) | // Step 1: Remove any <script> elements, which can execute JavaScript |
| [142](#L142) | $scripts = $dom->getElementsByTagName('script'); |
| [143](#L143) | while ($scripts->length > 0) { |
| [144](#L144) | $scripts->item(0)->parentNode->removeChild($scripts->item(0)); |
| [145](#L145) | } |
| [146](#L146) |  |
| [147](#L147) | // Step 2: Remove unsafe attributes that could contain JavaScript (like onclick, onload) |
| [148](#L148) | $xpath = new DOMXPath($dom); |
| [149](#L149) | foreach ($xpath->query('//@\*') as $attr) { |
| [150](#L150) | if (stripos($attr->name, 'on') === 0 || stripos($attr->value, 'javascript:') === 0) { |
| [151](#L151) | $attr->parentNode->removeAttribute($attr->name); |
| [152](#L152) | } |
| [153](#L153) | } |
| [154](#L154) |  |
| [155](#L155) | // Return the sanitized SVG content as XML |
| [156](#L156) | return $dom->saveXML(); |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) |  |
| [160](#L160) |  |
| [161](#L161) | /\*\* |
| [162](#L162) | \* This will run when the plugin will turn On |
| [163](#L163) | \* |
| [164](#L164) | \* @param bool|false $network\_wide |
| [165](#L165) | \*/ |
| [166](#L166) | function activate( $network\_wide = false ) { |
| [167](#L167) | global $wpdb; |
| [168](#L168) |  |
| [169](#L169) | // if activated on a particular blog, just set it up there. |
| [170](#L170) | if ( !$network\_wide ) { |
| [171](#L171) | $this->create\_the\_termmeta\_table(); |
| [172](#L172) | return; |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | $blogs = $wpdb->get\_col( "SELECT blog\_id FROM {$wpdb->blogs} WHERE site\_id = '{$wpdb->siteid}'" ); |
| [176](#L176) | foreach ( $blogs as $blog\_id ) { |
| [177](#L177) | $this->create\_the\_termmeta\_table( $blog\_id ); |
| [178](#L178) | } |
| [179](#L179) | // I feel dirty... this line smells like perl. |
| [180](#L180) | do {} while ( restore\_current\_blog() ); |
| [181](#L181) | } |
| [182](#L182) |  |
| [183](#L183) | function new\_blog( $blog\_id, $user\_id, $domain, $path, $site\_id, $meta ) { |
| [184](#L184) | if ( is\_plugin\_active\_for\_network(plugin\_basename(\_\_FILE\_\_)) ) |
| [185](#L185) | $this->create\_the\_termmeta\_table($blog\_id); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) | /\*\* |
| [189](#L189) | \* Return an instance of this class. |
| [190](#L190) | \* @since     1.0.0 |
| [191](#L191) | \* @return    object    A single instance of this class. |
| [192](#L192) | \*/ |
| [193](#L193) | public static function get\_instance() { |
| [194](#L194) |  |
| [195](#L195) | // If the single instance hasn't been set, set it now. |
| [196](#L196) | if ( null == self::$instance ) { |
| [197](#L197) | self::$instance = new self; |
| [198](#L198) | } |
| [199](#L199) |  |
| [200](#L200) | return self::$instance; |
| [201](#L201) | } |
| [202](#L202) |  |
| [203](#L203) | function plugin\_init() { |
| [204](#L204) |  |
| [205](#L205) | $selected\_taxonomies = $this->get\_plugin\_option('taxonomies'); |
| [206](#L206) |  |
| [207](#L207) | if ( ! is\_wp\_error( $selected\_taxonomies ) && ! empty( $selected\_taxonomies ) ) { |
| [208](#L208) | foreach ( $selected\_taxonomies as $tax\_name => $somerandomvalue ) { |
| [209](#L209) | add\_action( $tax\_name . '\_add\_form\_fields', array( $this, 'taxonomy\_add\_new\_meta\_field'), 10, 2 ); |
| [210](#L210) | add\_action( $tax\_name . '\_edit\_form\_fields', array( $this, 'taxonomy\_edit\_new\_meta\_field'), 10, 2 ); |
| [211](#L211) | add\_action( 'edited\_' . $tax\_name,  array( $this, 'save\_taxonomy\_custom\_meta' ), 10, 2 ); |
| [212](#L212) | add\_action( 'create\_' . $tax\_name,  array( $this, 'save\_taxonomy\_custom\_meta' ), 10, 2 ); |
| [213](#L213) | add\_filter( "manage\_edit-" . $tax\_name . "\_columns", array( $this, 'add\_custom\_tax\_column' ) ); |
| [214](#L214) | add\_filter( "manage\_" . $tax\_name . "\_custom\_column", array( $this, 'output\_custom\_tax\_column' ), 10, 3 ); |
| [215](#L215) | } |
| [216](#L216) | } |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | function enqueue\_admin\_scripts () { |
| [220](#L220) | wp\_enqueue\_style( $this->plugin\_slug . '-admin-style', plugins\_url( 'assets/admin/css/category-icon.css', \_\_FILE\_\_ ), array(  ), $this->version ); |
| [221](#L221) | wp\_enqueue\_media(); |
| [222](#L222) | wp\_enqueue\_script( $this->plugin\_slug . '-admin-script', plugins\_url( 'assets/admin/js/category-icon.js', \_\_FILE\_\_ ), array( 'jquery' ), $this->version ); |
| [223](#L223) | wp\_localize\_script( $this->plugin\_slug . '-admin-script', 'locals', array( |
| [224](#L224) | 'ajax\_url' => admin\_url( 'admin-ajax.php' ) |
| [225](#L225) | ) ); |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | function taxonomy\_add\_new\_meta\_field ( $tax ) { ?> |
| [229](#L229) | <div class="open\_term\_icon\_preview form-field"> |
| [230](#L230) | <input type="hidden" name="term\_icon\_value" id="term\_icon\_value" value=""> |
| [231](#L231) | <span class="open\_term\_icon\_upload button button-secondary"> |
| [232](#L232) | <?php \_e( 'Select Icon', 'category-icon' ); ?> |
| [233](#L233) | </span> |
| [234](#L234) | </div> |
| [235](#L235) |  |
| [236](#L236) | <div class="open\_term\_image\_preview form-field"> |
| [237](#L237) | <input type="hidden" name="term\_image\_value" id="term\_image\_value" value=""> |
| [238](#L238) | <span class="open\_term\_image\_upload button button-secondary"> |
| [239](#L239) | <?php \_e( 'Select Image', 'category-icon' ); ?> |
| [240](#L240) | </span> |
| [241](#L241) | </div> |
| [242](#L242) | <?php |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | function taxonomy\_edit\_new\_meta\_field ( $term ) { |
| [246](#L246) | $current\_value = ''; |
| [247](#L247) | if ( isset( $term->term\_id ) ) { |
| [248](#L248) | $current\_value = get\_term\_meta( $term->term\_id, 'pix\_term\_icon', true ); |
| [249](#L249) | } ?> |
| [250](#L250) | <tr class="form-field"> |
| [251](#L251) | <th scope="row" valign="top"><label for="term\_icon\_value"><?php esc\_html\_e( 'Icon', $this->plugin\_slug ); ?></label></th> |
| [252](#L252) | <td> |
| [253](#L253) | <div class="open\_term\_icon\_preview"> |
| [254](#L254) | <input type="hidden" name="term\_icon\_value" id="term\_icon\_value" value="<?php echo $current\_value; ?>"> |
| [255](#L255) | <?php if ( empty( $current\_value ) ) { ?> |
| [256](#L256) | <span class="open\_term\_icon\_upload button button-secondary"> |
| [257](#L257) | <?php \_e( 'Select Icon', $this->plugin\_slug );?> |
| [258](#L258) | </span> |
| [259](#L259) | <?php } else { |
| [260](#L260) | $thumb\_src = wp\_get\_attachment\_image\_src( $current\_value );?> |
| [261](#L261) | <img src="<?php echo $thumb\_src[0]; ?>" style="width: 90%; height:90%; padding: 5%" /> |
| [262](#L262) | <span class="open\_term\_icon\_upload button button-secondary"> |
| [263](#L263) | <?php \_e( 'Select', $this->plugin\_slug );?> |
| [264](#L264) | </span> |
| [265](#L265) | <span class="open\_term\_icon\_delete button button-secondary"> |
| [266](#L266) | <?php \_e( 'Remove', $this->plugin\_slug );?> |
| [267](#L267) | </span> |
| [268](#L268) | <?php } ?> |
| [269](#L269) | </div> |
| [270](#L270) | </td> |
| [271](#L271) | </tr> |
| [272](#L272) | <?php |
| [273](#L273) | $current\_image\_value = ''; |
| [274](#L274) | if ( isset( $term->term\_id ) ) { |
| [275](#L275) | $current\_image\_value = get\_term\_meta( $term->term\_id, 'pix\_term\_image', true ); |
| [276](#L276) | } ?> |
| [277](#L277) |  |
| [278](#L278) | <tr class="form-field"> |
| [279](#L279) | <th scope="row" valign="top"><label for="term\_image\_value"><?php esc\_html\_e( 'Image', 'category-icon' ); ?></label></th> |
| [280](#L280) | <td> |
| [281](#L281) | <div class="open\_term\_image\_preview"> |
| [282](#L282) | <input type="hidden" name="term\_image\_value" id="term\_image\_value" value="<?php echo $current\_image\_value; ?>"> |
| [283](#L283) | <?php if ( empty( $current\_image\_value ) ) { ?> |
| [284](#L284) | <span class="open\_term\_image\_upload button button-secondary"> |
| [285](#L285) | <?php \_e( 'Select Image', 'category-icon' );?> |
| [286](#L286) | </span> |
| [287](#L287) | <?php } else { |
| [288](#L288) | $thumb\_src = wp\_get\_attachment\_image\_src( $current\_image\_value );?> |
| [289](#L289) | <img src="<?php echo $thumb\_src[0]; ?>" style="width: 90%; height:90%; padding: 5%" /> |
| [290](#L290) | <span class="open\_term\_image\_upload button button-secondary"> |
| [291](#L291) | <?php esc\_html\_e( 'Select', 'category-icon' );?> |
| [292](#L292) | </span> |
| [293](#L293) | <span class="open\_term\_image\_delete button button-secondary"> |
| [294](#L294) | <?php esc\_html\_e( 'Remove', 'category-icon' );?> |
| [295](#L295) | </span> |
| [296](#L296) | <?php } ?> |
| [297](#L297) | </div> |
| [298](#L298) | </td> |
| [299](#L299) | </tr> |
| [300](#L300) | <?php |
| [301](#L301) | } |
| [302](#L302) |  |
| [303](#L303) | function save\_taxonomy\_custom\_meta ( $term\_id ) { |
| [304](#L304) | if ( isset( $\_POST['term\_icon\_value'] ) ) { |
| [305](#L305) | $value = $\_POST['term\_icon\_value']; |
| [306](#L306) | $current\_value = get\_term\_meta( $term\_id, 'pix\_term\_icon', true ); |
| [307](#L307) |  |
| [308](#L308) | if ( empty( $current\_value ) ) { |
| [309](#L309) | $updated = update\_term\_meta( $term\_id, 'pix\_term\_icon', $value ); |
| [310](#L310) | } else { |
| [311](#L311) | $updated = update\_term\_meta( $term\_id, 'pix\_term\_icon', $value, $current\_value ); |
| [312](#L312) | } |
| [313](#L313) | update\_termmeta\_cache( array( $term\_id ) ); |
| [314](#L314) | } |
| [315](#L315) |  |
| [316](#L316) | if ( isset( $\_POST['term\_image\_value'] ) ) { |
| [317](#L317) | $value\_image = $\_POST['term\_image\_value']; |
| [318](#L318) | $current\_value\_image = get\_term\_meta( $term\_id, 'pix\_term\_image', true ); |
| [319](#L319) |  |
| [320](#L320) | if ( empty( $current\_value\_image ) ) { |
| [321](#L321) | $updated = update\_term\_meta( $term\_id, 'pix\_term\_image', $value\_image ); |
| [322](#L322) | } else { |
| [323](#L323) | $updated = update\_term\_meta( $term\_id, 'pix\_term\_image', $value\_image, $current\_value\_image ); |
| [324](#L324) | } |
| [325](#L325) | update\_termmeta\_cache( array( $term\_id ) ); |
| [326](#L326) | } |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | /\*\* |
| [330](#L330) | \* Taxonomy columns |
| [331](#L331) | \*/ |
| [332](#L332) | function add\_custom\_tax\_column( $current\_columns ) { |
| [333](#L333) |  |
| [334](#L334) | $input = array\_shift( $current\_columns ); |
| [335](#L335) | $new\_columns = array( |
| [336](#L336) | 'cb' => $input, |
| [337](#L337) | 'pix-taxonomy-icon' => \_\_( 'Icon', $this->plugin\_slug ), |
| [338](#L338) | ); |
| [339](#L339) |  |
| [340](#L340) | $new\_columns = $new\_columns + $current\_columns; |
| [341](#L341) | return $new\_columns; |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | function output\_custom\_tax\_column( $value, $column\_name, $id ) { |
| [345](#L345) |  |
| [346](#L346) | if( $column\_name !== 'pix-taxonomy-icon'){ |
| [347](#L347) | return $value; |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | $icon\_id = get\_term\_meta( $id, 'pix\_term\_icon', true ); |
| [351](#L351) | if ( is\_numeric( $icon\_id ) ) { |
| [352](#L352) | $src = wp\_get\_attachment\_image\_src( $icon\_id, 'thumbnail' ); |
| [353](#L353) | if ( isset( $src[0] ) && ! empty( $src[0] ) ) { |
| [354](#L354) | $value = '<div class="pix-taxonomy-icon-column\_wrap media-icon"><img src="' . $src[0] . '" width="60px" height="60px" /></div>'; |
| [355](#L355) | } |
| [356](#L356) | } |
| [357](#L357) |  |
| [358](#L358) | return $value; |
| [359](#L359) |  |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) |  |
| [363](#L363) | /\*\* |
| [364](#L364) | \* create an admin page |
| [365](#L365) | \*/ |
| [366](#L366) | function add\_plugin\_admin\_menu( ) { |
| [367](#L367) | $this->plugin\_screen\_hook\_suffix = add\_options\_page( |
| [368](#L368) | \_\_( 'Category Icon', $this->plugin\_slug ), |
| [369](#L369) | \_\_( 'Category Icon', $this->plugin\_slug ), |
| [370](#L370) | 'manage\_options', |
| [371](#L371) | $this->plugin\_slug, array( $this, 'display\_plugin\_admin\_page' ) |
| [372](#L372) | ); |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | function plugin\_admin\_init() { |
| [376](#L376) |  |
| [377](#L377) |  |
| [378](#L378) | register\_setting( 'category-icon', 'category-icon', array( $this, 'save\_setting\_values' ) ); |
| [379](#L379) | add\_settings\_section( |
| [380](#L380) | 'category-icon', |
| [381](#L381) | null, |
| [382](#L382) | array( $this, 'render\_settings\_section\_title' ), |
| [383](#L383) | 'category-icon' |
| [384](#L384) | ); |
| [385](#L385) | add\_settings\_field('taxonomies', \_\_( 'Select Taxonomies', 'category-icon' ), array( $this, 'render\_taxonomies\_select' ), 'category-icon', 'category-icon'); |
| [386](#L386) |  |
| [387](#L387) | /\*\* |
| [388](#L388) | \* Little trick to embed svg in media modal |
| [389](#L389) | \* https://gist.github.com/Lewiscowles1986/44f059876ec205dd4d27 |
| [390](#L390) | \*/ |
| [391](#L391) | ob\_start(); |
| [392](#L392) | add\_action('shutdown', array ($this,'on\_shutdown'), 0); |
| [393](#L393) | add\_filter('final\_output', array( $this,'fix\_svg\_template')); |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | function render\_taxonomies\_select ( ) { |
| [397](#L397) | $taxonomies = get\_taxonomies(); |
| [398](#L398) |  |
| [399](#L399) | // get the current selected taxonomies |
| [400](#L400) | $options = get\_option('category-icon'); |
| [401](#L401) |  |
| [402](#L402) | $selected\_taxonomies = array(); |
| [403](#L403) |  |
| [404](#L404) | if ( isset( $options['taxonomies'] ) ) { |
| [405](#L405) | $selected\_taxonomies = $options['taxonomies']; |
| [406](#L406) | } ?> |
| [407](#L407) | <field class="select\_taxonomies"> |
| [408](#L408) | <?php |
| [409](#L409) | if ( ! empty( $taxonomies ) || ! is\_wp\_error( $taxonomies ) ) { |
| [410](#L410) | foreach ( $taxonomies as $key => $tax ) { |
| [411](#L411) | $selected = ''; |
| [412](#L412) | if ( ! empty( $selected\_taxonomies ) && isset( $selected\_taxonomies[$key] ) &&  $selected\_taxonomies[$key] = 'on' ) { |
| [413](#L413) | $selected = ' checked="selected"'; |
| [414](#L414) | } |
| [415](#L415) | $full\_key = 'category-icon[taxonomies][' . $key  . ']'; ?> |
| [416](#L416) | <label for="<?php echo $full\_key; ?>"> |
| [417](#L417) | <input id='<?php echo $full\_key; ?>' name='<?php echo $full\_key; ?>' size='40' type='checkbox' <?php echo $selected ?>/> |
| [418](#L418) | <?php echo $key ?> |
| [419](#L419) | </br> |
| [420](#L420) | </label> |
| [421](#L421) | <?php } |
| [422](#L422) | }?> |
| [423](#L423) |  |
| [424](#L424) | </field> |
| [425](#L425) | <?php } |
| [426](#L426) |  |
| [427](#L427) | // this should sanitize things around |
| [428](#L428) | function save\_setting\_values( $input ) { |
| [429](#L429) | return $input; |
| [430](#L430) | } |
| [431](#L431) |  |
| [432](#L432) | function render\_settings\_section\_title() { ?> |
| [433](#L433) | <h2><?php \_e('Category Icon Options', $this->plugin\_slug); ?></h2> |
| [434](#L434) | <?php } |
| [435](#L435) |  |
| [436](#L436) | /\*\* |
| [437](#L437) | \* Render the settings page for this plugin. |
| [438](#L438) | \*/ |
| [439](#L439) | function display\_plugin\_admin\_page() { ?> |
| [440](#L440) | <div class="wrap" id="taxonomy\_icons\_form"> |
| [441](#L441) | <div id="icon-options-general" class="icon32"></div> |
| [442](#L442) | <form action="options.php" method="post"> |
| [443](#L443) | <?php |
| [444](#L444) | settings\_fields('category-icon'); |
| [445](#L445) | do\_settings\_sections('category-icon'); ?> |
| [446](#L446) | <input name="Submit" type="submit" value="<?php \_e('Save Changes', $this->plugin\_slug); ?>" /> |
| [447](#L447) | </form> |
| [448](#L448) | </div> |
| [449](#L449) | <?php } |
| [450](#L450) |  |
| [451](#L451) | function get\_plugin\_option( $key ) { |
| [452](#L452) |  |
| [453](#L453) | $options = get\_option('category-icon'); |
| [454](#L454) |  |
| [455](#L455) | if ( isset( $options [$key] ) ) { |
| [456](#L456) | return $options [$key]; |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | return null; |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) | function get\_defaults() { |
| [463](#L463) | return $this->default\_settings; |
| [464](#L464) | } |
| [465](#L465) |  |
| [466](#L466) | /\*\* Ensure compat with wp 4.4 \*/ |
| [467](#L467) | function create\_the\_termmeta\_table( $id = false ) { |
| [468](#L468) | global $wpdb; |
| [469](#L469) |  |
| [470](#L470) | if ( $id !== false) |
| [471](#L471) | switch\_to\_blog( $id ); |
| [472](#L472) |  |
| [473](#L473) | $max\_index\_length = 191; |
| [474](#L474) | $charset\_collate = ''; |
| [475](#L475) |  |
| [476](#L476) | if ( ! empty($wpdb->charset) ) |
| [477](#L477) | $charset\_collate = "DEFAULT CHARACTER SET $wpdb->charset"; |
| [478](#L478) | if ( ! empty($wpdb->collate) ) |
| [479](#L479) | $charset\_collate .= " COLLATE $wpdb->collate"; |
| [480](#L480) |  |
| [481](#L481) | $blog\_tables = "CREATE TABLE IF NOT EXISTS {$wpdb->prefix}termmeta ( |
| [482](#L482) | meta\_id bigint(20) unsigned NOT NULL auto\_increment, |
| [483](#L483) | term\_id bigint(20) unsigned NOT NULL default '0', |
| [484](#L484) | meta\_key varchar(255) default NULL, |
| [485](#L485) | meta\_value longtext, |
| [486](#L486) | PRIMARY KEY (meta\_id), |
| [487](#L487) | KEY term\_id (term\_id), |
| [488](#L488) | KEY meta\_key (meta\_key($max\_index\_length)) |
| [489](#L489) | ) $charset\_collate; "; |
| [490](#L490) |  |
| [491](#L491) | require\_once( ABSPATH . 'wp-admin/includes/upgrade.php' ); |
| [492](#L492) |  |
| [493](#L493) | dbDelta( $blog\_tables ); |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | function register\_the\_termmeta\_table() { |
| [497](#L497) | global $wpdb; |
| [498](#L498) |  |
| [499](#L499) | //register the termmeta table with the wpdb object if this is older than 4.4 |
| [500](#L500) | if ( ! isset($wpdb->termmeta)) { |
| [501](#L501) | $wpdb->termmeta = $wpdb->prefix . "termmeta"; |
| [502](#L502) | //add the shortcut so you can use $wpdb->stats |
| [503](#L503) | $wpdb->tables[] = str\_replace($wpdb->prefix, '', $wpdb->prefix . "termmeta"); |
| [504](#L504) | } |
| [505](#L505) | } |
| [506](#L506) | /\*\* |
| [507](#L507) | \* Allow svg files to be uploaded |
| [508](#L508) | \* @param $mimes |
| [509](#L509) | \* |
| [510](#L510) | \* @return mixed |
| [511](#L511) | \*/ |
| [512](#L512) | function allow\_svg\_in\_mime\_types($mimes) { |
| [513](#L513) | if ( ! isset( $mimes['svg'] ) ) { |
| [514](#L514) | $mimes['svg'] = 'image/svg+xml'; |
| [515](#L515) | } |
| [516](#L516) | return $mimes; |
| [517](#L517) | } |
| [518](#L518) |  |
| [519](#L519) | public function on\_shutdown() { |
| [520](#L520) | $final = ''; |
| [521](#L521) | $ob\_levels = ob\_get\_level(); |
| [522](#L522) | for ($i = 0; $i < $ob\_levels; $i++) { |
| [523](#L523) | $final .= ob\_get\_clean(); |
| [524](#L524) | } |
| [525](#L525) | echo apply\_filters('final\_output', $final); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | function force\_svg\_with\_visible\_sizes() { |
| [529](#L529) | echo '<style> |
| [530](#L530) | svg, img[src\*=".svg"] { |
| [531](#L531) | max-width: 150px !important; |
| [532](#L532) | max-height: 150px !important; |
| [533](#L533) | } |
| [534](#L534) | </style>'; |
| [535](#L535) | } |
| [536](#L536) |  |
| [537](#L537) | public function fix\_svg\_template($content='') { |
| [538](#L538) | $content = str\_replace( |
| [539](#L539) | '<# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [540](#L540) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [541](#L541) | <img class="details-image" src="{{ data.url }}" draggable="false" /> |
| [542](#L542) | <# } else if ( \'image\' === data.type && data.sizes && data.sizes.full ) { #>', |
| [543](#L543) | $content |
| [544](#L544) | ); |
| [545](#L545) | $content = str\_replace( |
| [546](#L546) | '<# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [547](#L547) | '<# } else if ( \'svg+xml\' === data.subtype ) { #> |
| [548](#L548) | <div class="centered"> |
| [549](#L549) | <img src="{{ data.url }}" class="thumbnail" draggable="false" /> |
| [550](#L550) | </div> |
| [551](#L551) | <# } else if ( \'image\' === data.type && data.sizes ) { #>', |
| [552](#L552) | $content |
| [553](#L553) | ); |
| [554](#L554) | return $content; |
| [555](#L555) | } |
| [556](#L556) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/category-icon/trunk/category-icon.php?format=txt)
* [Original Format](/export/3220430/category-icon/trunk/category-icon.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_ff89f5c8_20250110_195947.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Category Icon <= 1.0.0 - Authenticated (Author+) Stored Cross-Site Scripting via SVG File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Category Icon <= 1.0.0 - Authenticated (Author+) Stored Cross-Site Scripting via SVG File Upload

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-8915](https://www.cve.org/CVERecord?id=CVE-2024-8915) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | October 11, 2024 |
| Last Updated | October 12, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The Category Icon plugin for WordPress is vulnerable to Stored Cross-Site Scripting via SVG File uploads in all versions up to, and including, 1.0.0 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with Author-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses the SVG file.

#### References

* [wordpress.org](https://wordpress.org/plugins/category-icon/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/category-icon/trunk/category-icon.php#L437)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3167148/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcategory-icon%2Fcategory-icon-100-authenticated-author-stored-cross-site-scripting-via-svg-file-upload&t=Category%20Icon%20%3C%3D%201.0.0%20-%20Authenticated%20%28Author%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcategory-icon%2Fcategory-icon-100-authenticated-author-stored-cross-site-scripting-via-svg-file-upload&text=Category%20Icon%20%3C%3D%201.0.0%20-%20Authenticated%20%28Author%2B%29%20Stored%20Cross-Site%20Scripting%20via%20SVG%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fcategory-icon%2Fcategory-icon-100-authenticated-author-stored-cross-site-scripting-via-svg-file-upload "LinkedIn")
Email

## Vulnerability Details for Category Icon

#### [Category Icon](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/category-icon)

| Software Type | Plugin |
| --- | --- |
| Software Slug | category-icon [(view on wordpress.org)](https://wordpress.org/plugins/category-icon) |
| Patched? | Yes |
| Remediation | Update to version 1.0.1, or a newer patched version |
| Affected Version | * <= 1.0.0 |
| Patched Version | * 1.0.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


