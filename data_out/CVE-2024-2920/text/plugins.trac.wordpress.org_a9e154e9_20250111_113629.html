

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3074215%2540wp-members%26old%3D3074215%2540wp-members)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3074214/wp-members "Changeset 3074214 for wp-members")
* [Next Change](/changeset/3077018/wp-members "Changeset 3077018 for wp-members") →

---

# Changeset [3074215](/changeset/3074215 "Show full changeset") for [wp-members](/browser/wp-members?rev=3074215 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/20/2024 12:54:38 PM
([9 months](/timeline?from=2024-04-20T12%3A54%3A38Z&precision=second "See timeline at 04/20/2024 12:54:38 PM") ago)

Author:
cbutlerjr
Message:

tagging 3.4.9.4 release

Location:
[wp-members/tags/3.4.9.4/includes](/browser/wp-members/tags/3.4.9.4/includes?rev=3074215)
Files:

4 edited

* [admin/class-wp-members-admin-api.php](/browser/wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php?rev=3074215 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [api/api-utilities.php](/browser/wp-members/tags/3.4.9.4/includes/api/api-utilities.php?rev=3074215 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [class-wp-members-user.php](/browser/wp-members/tags/3.4.9.4/includes/class-wp-members-user.php?rev=3074215 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [install.php](/browser/wp-members/tags/3.4.9.4/includes/install.php?rev=3074215 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php](/changeset/3074215/wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php "Show the changeset 3074215 restricted to wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php")

  | [r2920897](/browser/wp-members/trunk/includes/admin/class-wp-members-admin-api.php?rev=2920897#L207 "Show revision 2920897 of this file in browser") | [r3074215](/browser/wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php?rev=3074215#L207 "Show revision 3074215 of this file in browser") |  |
  | --- | --- | --- |
  | 207 | 207 | add\_action( 'admin\_notices', array( $this, 'do\_admin\_notices' ) ); |
  | 208 | 208 | } |
  |  | 209 |  |
  |  | 210 | add\_action( 'current\_screen', array( $this, 'check\_user\_folders\_for\_index' ) ); |
  | 209 | 211 | } // End of load\_hooks() |
  | 210 | 212 |  |
  | […](/browser/wp-members/trunk/includes/admin/class-wp-members-admin-api.php?rev=2920897#L678) | […](/browser/wp-members/tags/3.4.9.4/includes/admin/class-wp-members-admin-api.php?rev=3074215#L680) |  |
  | 678 | 680 | } |
  | 679 | 681 |  |
  |  | 682 | function check\_user\_folders\_for\_index() { |
  |  | 683 | global $current\_screen, $wpmem; |
  |  | 684 | if ( 'user-edit' == $current\_screen->id |
  |  | 685 | || 'profile' == $current\_screen->id |
  |  | 686 | || 'dashboard' == $current\_screen->id |
  |  | 687 | || 'plugins' == $current\_screen->id |
  |  | 688 | || 'update-core' == $current\_screen->id |
  |  | 689 | || 'settings\_page\_wpmem-settings' == $current\_screen->id ) { |
  |  | 690 |  |
  |  | 691 | $upload\_vars  = wp\_upload\_dir( null, false ); |
  |  | 692 | $wpmem\_base\_dir = trailingslashit( trailingslashit( $upload\_vars['basedir'] ) . $wpmem->upload\_base ); |
  |  | 693 | $wpmem\_user\_files\_dir = $wpmem\_base\_dir . 'user\_files/'; |
  |  | 694 |  |
  |  | 695 | if ( file\_exists( $wpmem\_user\_files\_dir ) ) { |
  |  | 696 | // If there is a user file dir, check/self-heal htaccess/index files. |
  |  | 697 | wpmem\_create\_htaccess\_file( $wpmem\_user\_files\_dir ); |
  |  | 698 | wpmem\_create\_index\_file( $wpmem\_base\_dir ); |
  |  | 699 | wpmem\_create\_index\_file( $wpmem\_user\_files\_dir ); |
  |  | 700 | } |
  |  | 701 | } |
  |  | 702 | } |
  |  | 703 |  |
  | 680 | 704 | } // End of WP\_Members\_Admin\_API class. |
  | 681 | 705 |  |
* ## [wp-members/tags/3.4.9.4/includes/api/api-utilities.php](/changeset/3074215/wp-members/tags/3.4.9.4/includes/api/api-utilities.php "Show the changeset 3074215 restricted to wp-members/tags/3.4.9.4/includes/api/api-utilities.php")

  | [r2920897](/browser/wp-members/trunk/includes/api/api-utilities.php?rev=2920897#L305 "Show revision 2920897 of this file in browser") | [r3074215](/browser/wp-members/tags/3.4.9.4/includes/api/api-utilities.php?rev=3074215#L305 "Show revision 3074215 of this file in browser") |  |
  | --- | --- | --- |
  | 305 | 305 | return $redirect\_to; |
  | 306 | 306 | } |
  |  | 307 |  |
  |  | 308 | /\*\* |
  |  | 309 | \* Creates an index file in a directory. |
  |  | 310 | \* |
  |  | 311 | \* @since 3.5.0 |
  |  | 312 | \* |
  |  | 313 | \* @param string $path Path to the directory to set an index.php. |
  |  | 314 | \*/ |
  |  | 315 | function wpmem\_create\_index\_file( $path ) { |
  |  | 316 | $check\_index = trailingslashit( $path ) . 'index.php'; |
  |  | 317 | if ( ! file\_exists( $check\_index ) ) { |
  |  | 318 | $index = fopen( $check\_index, "w" ) or die( "Unable to create index file!" ); |
  |  | 319 | $txt = "<?php // Silence is golden."; |
  |  | 320 | fwrite( $index, $txt ); |
  |  | 321 | fclose( $index ); |
  |  | 322 | } |
  |  | 323 | } |
  |  | 324 |  |
  |  | 325 | /\*\* |
  |  | 326 | \* Creates an index file in a directory. |
  |  | 327 | \* |
  |  | 328 | \* @since 3.5.0 |
  |  | 329 | \* |
  |  | 330 | \* @param string $path Path to the directory to set an index.php. |
  |  | 331 | \*/ |
  |  | 332 | function wpmem\_create\_htaccess\_file( $path ) { |
  |  | 333 | $check\_index = trailingslashit( $path ) . '.htaccess'; |
  |  | 334 | if ( ! file\_exists( $check\_index ) ) { |
  |  | 335 | $index = fopen( $check\_index, "w" ) or die( "Unable to create .htaccess file!" ); |
  |  | 336 | $txt = "Options -Indexes"; |
  |  | 337 | fwrite( $index, $txt ); |
  |  | 338 | fclose( $index ); |
  |  | 339 | } |
  |  | 340 | } |
* ## [wp-members/tags/3.4.9.4/includes/class-wp-members-user.php](/changeset/3074215/wp-members/tags/3.4.9.4/includes/class-wp-members-user.php "Show the changeset 3074215 restricted to wp-members/tags/3.4.9.4/includes/class-wp-members-user.php")

  | [r2893181](/browser/wp-members/trunk/includes/class-wp-members-user.php?rev=2893181#L62 "Show revision 2893181 of this file in browser") | [r3074215](/browser/wp-members/tags/3.4.9.4/includes/class-wp-members-user.php?rev=3074215#L62 "Show revision 3074215 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | add\_action( 'user\_register', array( $this, 'set\_default\_product' ), 6 ); |
  | 63 | 63 | } |
  |  | 64 |  |
  |  | 65 | add\_action( 'wpmem\_file\_uploaded', array( $this, 'check\_folder\_for\_index' ), 10 , 3 ); |
  | 64 | 66 | } |
  | 65 | 67 |  |
  | […](/browser/wp-members/trunk/includes/class-wp-members-user.php?rev=2893181#L1343) | […](/browser/wp-members/tags/3.4.9.4/includes/class-wp-members-user.php?rev=3074215#L1345) |  |
  | 1343 | 1345 | } |
  | 1344 | 1346 | } |
  |  | 1347 |  |
  |  | 1348 | /\*\* |
  |  | 1349 | \* Checks user file upload folder for an index.php file. |
  |  | 1350 | \* |
  |  | 1351 | \* @since 3.4.9.4 |
  |  | 1352 | \* |
  |  | 1353 | \* @param int    $user\_id |
  |  | 1354 | \* @param string $meta\_key |
  |  | 1355 | \* @param string $file\_post\_id |
  |  | 1356 | \*/ |
  |  | 1357 | public function check\_folder\_for\_index( $user\_id, $meta\_key, $file\_post\_id ) { |
  |  | 1358 | $upload\_vars  = wp\_upload\_dir( null, false ); |
  |  | 1359 | wpmem\_create\_index\_file( $upload\_vars['path'] ); |
  |  | 1360 | } |
  | 1345 | 1361 | } |
* ## [wp-members/tags/3.4.9.4/includes/install.php](/changeset/3074215/wp-members/tags/3.4.9.4/includes/install.php "Show the changeset 3074215 restricted to wp-members/tags/3.4.9.4/includes/install.php")

  | [r3074062](/browser/wp-members/trunk/includes/install.php?rev=3074062#L886 "Show revision 3074062 of this file in browser") | [r3074215](/browser/wp-members/tags/3.4.9.4/includes/install.php?rev=3074215#L886 "Show revision 3074215 of this file in browser") |  |
  | --- | --- | --- |
  | 886 | 886 | $wpmem\_user\_files\_dir = $wpmem\_base\_dir . 'user\_files/'; |
  | 887 | 887 |  |
  | 888 |  | wpmem\_create\_htaccess\_file( $wpmem\_user\_files\_dir ); |
  | 889 |  |  |
  | 890 |  | // Fix wpmem base dir first. |
  | 891 |  | wpmem\_create\_index\_file( $wpmem\_base\_dir ); |
  | 892 |  |  |
  | 893 |  | // Fix wpmem user\_files dir. |
  | 894 |  | wpmem\_create\_index\_file( $wpmem\_user\_files\_dir ); |
  | 895 |  |  |
  | 896 |  | // Loop through users to update user dirs. |
  | 897 |  | foreach ( $users\_to\_check as $user ) { |
  | 898 |  | $wpmem\_user\_dir = $wpmem\_user\_files\_dir . $user; |
  | 899 |  | if ( is\_dir( $wpmem\_user\_dir ) ) { |
  | 900 |  | wpmem\_create\_index\_file( $wpmem\_user\_dir ); |
  | 901 |  | } |
  | 902 |  | } |
  | 903 |  | } |
  | 904 |  |  |
  | 905 |  | /\*\* |
  | 906 |  | \* Creates an index file in a directory. |
  | 907 |  | \* |
  | 908 |  | \* @since 3.5.0 |
  | 909 |  | \* |
  | 910 |  | \* @param string $path Path to the directory to set an index.php. |
  | 911 |  | \*/ |
  | 912 |  | function wpmem\_create\_index\_file( $path ) { |
  | 913 |  | $check\_index = trailingslashit( $path ) . 'index.php'; |
  | 914 |  | if ( ! file\_exists( $check\_index ) ) { |
  | 915 |  | $index = fopen( $check\_index, "w" ) or die( "Unable to create index file!" ); |
  | 916 |  | $txt = "<?php // Silence is golden."; |
  | 917 |  | fwrite( $index, $txt ); |
  | 918 |  | fclose( $index ); |
  | 919 |  | } |
  | 920 |  | } |
  | 921 |  |  |
  | 922 |  | /\*\* |
  | 923 |  | \* Creates an index file in a directory. |
  | 924 |  | \* |
  | 925 |  | \* @since 3.5.0 |
  | 926 |  | \* |
  | 927 |  | \* @param string $path Path to the directory to set an index.php. |
  | 928 |  | \*/ |
  | 929 |  | function wpmem\_create\_htaccess\_file( $path ) { |
  | 930 |  | $check\_index = trailingslashit( $path ) . '.htaccess'; |
  | 931 |  | if ( ! file\_exists( $check\_index ) ) { |
  | 932 |  | $index = fopen( $check\_index, "w" ) or die( "Unable to create index file!" ); |
  | 933 |  | $txt = "Options -Indexes"; |
  | 934 |  | fwrite( $index, $txt ); |
  | 935 |  | fclose( $index ); |
  |  | 888 | if ( file\_exists( $wpmem\_user\_files\_dir ) ) { |
  |  | 889 |  |
  |  | 890 | // We need this for the utility functions. |
  |  | 891 | include\_once 'api/api-utilities.php'; |
  |  | 892 |  |
  |  | 893 | // Add indexes and htaccess |
  |  | 894 | wpmem\_create\_index\_file( $wpmem\_base\_dir ); |
  |  | 895 | wpmem\_create\_index\_file( $wpmem\_user\_files\_dir ); |
  |  | 896 | wpmem\_create\_htaccess\_file( $wpmem\_user\_files\_dir ); |
  |  | 897 |  |
  |  | 898 | // Loop through users to update user dirs. |
  |  | 899 | foreach ( $users\_to\_check as $user ) { |
  |  | 900 | $wpmem\_user\_dir = $wpmem\_user\_files\_dir . $user; |
  |  | 901 | if ( is\_dir( $wpmem\_user\_dir ) ) { |
  |  | 902 | wpmem\_create\_index\_file( $wpmem\_user\_dir ); |
  |  | 903 | } |
  |  | 904 | } |
  | 936 | 905 | } |
  | 937 | 906 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3074215)
* [Zip Archive](?format=zip&new=3074215)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

