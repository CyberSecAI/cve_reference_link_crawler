=== Content from www.wordfence.com_4630a7ce_20250111_173206.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# OSM <= 6.1.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via osm\_map and osm\_map\_v3 Shortcodes

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   OSM <= 6.1.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via osm\_map and osm\_map\_v3 Shortcodes

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-8991](https://www.cve.org/CVERecord?id=CVE-2024-8991) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | September 26, 2024 |
| Last Updated | September 27, 2024 |
| Researcher | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) |

### Description

The OSM – OpenStreetMap plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the plugin's osm\_map and osm\_map\_v3 shortcodes in all versions up to, and including, 6.1.0 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers, with contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [wordpress.org](https://wordpress.org/plugins/osm/#developers)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/osm/trunk/osm-metabox.php#L155)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/osm/trunk/osm.php#L1120)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/osm/trunk/osm-metabox_v4.php#L139)
* [wp-osm-plugin.hyumika.com](https://wp-osm-plugin.hyumika.com/changelog/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3157069/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fosm%2Fosm-610-authenticated-contributor-stored-cross-site-scripting-via-osm-map-and-osm-map-v3-shortcodes&t=OSM%20%3C%3D%206.1.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20osm_map%20and%20osm_map_v3%20Shortcodes "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fosm%2Fosm-610-authenticated-contributor-stored-cross-site-scripting-via-osm-map-and-osm-map-v3-shortcodes&text=OSM%20%3C%3D%206.1.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20osm_map%20and%20osm_map_v3%20Shortcodes "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fosm%2Fosm-610-authenticated-contributor-stored-cross-site-scripting-via-osm-map-and-osm-map-v3-shortcodes "LinkedIn")
Email

## Vulnerability Details for OSM – OpenStreetMap

#### [OSM – OpenStreetMap](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/osm)

| Software Type | Plugin |
| --- | --- |
| Software Slug | osm [(view on wordpress.org)](https://wordpress.org/plugins/osm) |
| Patched? | Yes |
| Remediation | Update to version 6.1.1, or a newer patched version |
| Affected Version | * <= 6.1.0 |
| Patched Version | * 6.1.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_064b6ef6_20250111_173202.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fosm%2Ftrunk%2Fosm.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/osm/trunk/osm.php?rev=3167884 "Revision 3167884")
* Next Revision →
* [Blame](/browser/osm/trunk/osm.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/osm/trunk/osm.php)

---

# [source:](/browser?order=name "Go to repository root") [osm](/browser/osm?order=name "View osm")/[trunk](/browser/osm/trunk?order=name "View trunk")/[osm.php](/browser/osm/trunk/osm.php?order=name "View osm.php")

View diff against:

View revision:

| [Last change](/changeset/3171779/osm/trunk/osm.php "View differences") on this file was [3171779](/changeset/3171779/ "View changeset 3171779"), checked in by photoweblog, [3 months ago](/timeline?from=2024-10-19T04%3A19%3A14Z&precision=second "See timeline at 10/19/2024 04:19:14 AM") |
| --- |
| avoid error\_logs in debug mode. |
| **File size:** 45.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: OSM |
| [4](#L4) | Plugin URI: https://wp-osm-plugin.hyumika.com |
| [5](#L5) | Description: Embeds maps in your blog and adds geo data to your posts.  Find samples and a forum on the <a href="https://wp-osm-plugin.hyumika.com">OSM plugin page</a>. |
| [6](#L6) | Version: 6.1.6 |
| [7](#L7) | Author: MiKa |
| [8](#L8) | Author URI: http://www.hyumika.com |
| [9](#L9) | Minimum WordPress Version Required: 3.0 |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | /\*  (c) Copyright 2024  MiKa (www.hyumika.com) |
| [13](#L13) |  |
| [14](#L14) | This program is free software; you can redistribute it and/or modify |
| [15](#L15) | it under the terms of the GNU General Public License as published by |
| [16](#L16) | the Free Software Foundation; either version 2 of the License, or |
| [17](#L17) | (at your option) any later version. |
| [18](#L18) |  |
| [19](#L19) | This program is distributed in the hope that it will be useful, |
| [20](#L20) | but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [21](#L21) | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [22](#L22) | GNU General Public License for more details. |
| [23](#L23) |  |
| [24](#L24) | You should have received a copy of the GNU General Public License |
| [25](#L25) | along with this program; if not, write to the Free Software |
| [26](#L26) | Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA |
| [27](#L27) | \*/ |
| [28](#L28) | load\_plugin\_textdomain('OSM', false, dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/'); |
| [29](#L29) |  |
| [30](#L30) | define ("PLUGIN\_VER", "V6.1.6"); |
| [31](#L31) |  |
| [32](#L32) | // modify anything about the marker for tagged posts here |
| [33](#L33) | // instead of the coding. |
| [34](#L34) | define ("POST\_MARKER\_PNG", "marker\_posts.png"); |
| [35](#L35) | define ('POST\_MARKER\_PNG\_HEIGHT', 2); |
| [36](#L36) | define ('POST\_MARKER\_PNG\_WIDTH', 2); |
| [37](#L37) |  |
| [38](#L38) | define ("GCSTATS\_MARKER\_PNG", "geocache.png"); |
| [39](#L39) | define ('GCSTATS\_MARKER\_PNG\_HEIGHT', 25); |
| [40](#L40) | define ('GCSTATS\_MARKER\_PNG\_WIDTH', 25); |
| [41](#L41) |  |
| [42](#L42) | define ("INDIV\_MARKER", "marker\_blue.png"); |
| [43](#L43) | define ('INDIV\_MARKER\_PNG\_HEIGHT', 25); |
| [44](#L44) | define ('INDIV\_MARKER\_PNG\_WIDTH', 25); |
| [45](#L45) |  |
| [46](#L46) | // these defines are given by OpenStreetMap.org |
| [47](#L47) | define ("URL\_INDEX", "http://www.openstreetmap.org/index.html?"); |
| [48](#L48) | define ("URL\_LAT","&mlat="); |
| [49](#L49) | define ("URL\_LON","&mlon="); |
| [50](#L50) | define ("URL\_ZOOM\_01","&zoom=["); |
| [51](#L51) | define ("URL\_ZOOM\_02","]"); |
| [52](#L52) | define ('ZOOM\_LEVEL\_GOOGLE\_MAX',22); |
| [53](#L53) | define ('ZOOM\_LEVEL\_MAX',18);       // standard is 17, only mapnik is 18 |
| [54](#L54) | define ('ZOOM\_LEVEL\_MIN',1); |
| [55](#L55) |  |
| [56](#L56) | // other geo plugin defines |
| [57](#L57) | // google-maps-geocoder |
| [58](#L58) | define ("WPGMG\_LAT", "lat"); |
| [59](#L59) | define ("WPGMG\_LON", "lng"); |
| [60](#L60) |  |
| [61](#L61) | // some general defines |
| [62](#L62) | define ('LAT\_MIN',-90); |
| [63](#L63) | define ('LAT\_MAX',90); |
| [64](#L64) | define ('LON\_MIN',-180); |
| [65](#L65) | define ('LON\_MAX',180); |
| [66](#L66) |  |
| [67](#L67) | // tracelevels |
| [68](#L68) | define ('DEBUG\_OFF', 0); |
| [69](#L69) | define ('DEBUG\_ERROR', 1); |
| [70](#L70) | define ('DEBUG\_WARNING', 2); |
| [71](#L71) | define ('DEBUG\_INFO', 3); |
| [72](#L72) | define ('HTML\_COMMENT', 10); |
| [73](#L73) |  |
| [74](#L74) | // Load OSM library mode |
| [75](#L75) | define ('SERVER\_EMBEDDED', 1); |
| [76](#L76) | define ('SERVER\_WP\_ENQUEUE', 2); |
| [77](#L77) |  |
| [78](#L78) | define('OSM\_PRIV\_WP\_CONTENT\_URL', site\_url() . '/wp-content' ); |
| [79](#L79) | define('OSM\_PRIV\_WP\_CONTENT\_DIR', content\_url() . 'wp-content' ); |
| [80](#L80) | define('OSM\_PRIV\_WP\_PLUGIN\_URL', plugins\_url() ); |
| [81](#L81) | define('OSM\_PRIV\_WP\_PLUGIN\_DIR', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
| [82](#L82) |  |
| [83](#L83) | define('OSM\_PLUGIN\_URL', OSM\_PRIV\_WP\_PLUGIN\_URL."/osm/"); |
| [84](#L84) | define('OSM\_PLUGIN\_ICONS\_URL', OSM\_PLUGIN\_URL."icons/"); |
| [85](#L85) | define('URL\_POST\_MARKER', OSM\_PLUGIN\_URL.POST\_MARKER\_PNG); |
| [86](#L86) | define('OSM\_PLUGIN\_THEMES\_URL', OSM\_PLUGIN\_URL."themes/"); |
| [87](#L87) | define('OSM\_OPENLAYERS\_THEMES\_URL', content\_url(). '/uploads/osm/theme/' ); |
| [88](#L88) | define('OSM\_PLUGIN\_JS\_URL', OSM\_PLUGIN\_URL."js/"); |
| [89](#L89) |  |
| [90](#L90) | global $wp\_version; |
| [91](#L91) | if (version\_compare($wp\_version,"3.0","<")){ |
| [92](#L92) | exit('[OSM plugin - ERROR]: At least Wordpress Version 3.0 is required for this plugin!'); |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | // get the configuratin by |
| [96](#L96) | // default or costumer settings |
| [97](#L97) |  |
| [98](#L98) | $OL3\_LIBS\_LOADED = 0; |
| [99](#L99) |  |
| [100](#L100) | include ('osm-config.php'); |
| [101](#L101) |  |
| [102](#L102) |  |
| [103](#L103) | // do not edit this |
| [104](#L104) | //define ("Osm\_TraceLevel", DEBUG\_ERROR); |
| [105](#L105) | //define ("Osm\_TraceLevel", DEBUG\_OFF); |
| [106](#L106) |  |
| [107](#L107) | define ("Osm\_TraceLevel", DEBUG\_ERROR); |
| [108](#L108) |  |
| [109](#L109) |  |
| [110](#L110) | // If the function exists this file is called as upload\_mimes. |
| [111](#L111) | // We don't do anything then. |
| [112](#L112) | if ( ! function\_exists( 'osm\_restrict\_mime\_types' ) ) { |
| [113](#L113) | // |
| [114](#L114) | // Return allowed mime types |
| [115](#L115) | // |
| [116](#L116) | // @see function get\_allowed\_mime\_types in wp-includes/functions.php |
| [117](#L117) | // @param array $mime\_types Array of mime types |
| [118](#L118) | // @return array Array of mime types keyed by the file extension regex corresponding to those types. |
| [119](#L119) | // |
| [120](#L120) | function osm\_restrict\_mime\_types( $mime\_types ) { |
| [121](#L121) | // Logging der aktuellen MIME-Typen, die erlaubt sind |
| [122](#L122) | // error\_log('Called osm\_restrict\_mime\_types filter.'); |
| [123](#L123) |  |
| [124](#L124) | // Füge gpx und kml zu den erlaubten MIME-Typen hinzu |
| [125](#L125) | $mime\_types['gpx'] = 'application/gpx+xml'; |
| [126](#L126) | $mime\_types['kml'] = 'application/vnd.google-earth.kml+xml'; |
| [127](#L127) |  |
| [128](#L128) | // Logge die Liste der erlaubten MIME-Typen nach dem Hinzufügen |
| [129](#L129) | // error\_log('Allowed MIME types after modification: ' . print\_r($mime\_types, true)); |
| [130](#L130) |  |
| [131](#L131) | return $mime\_types; |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | function allow\_osm\_upload( $data, $file, $filename, $mimes ) { |
| [135](#L135) | // Logging des Dateinamens und der empfangenen Mimetypen |
| [136](#L136) | // error\_log('Called allow\_osm\_upload for file: ' . $filename); |
| [137](#L137) | // error\_log('File MIME types received: ' . print\_r($mimes, true)); |
| [138](#L138) |  |
| [139](#L139) | // Hole die Dateiendung (unabhängig von Groß-/Kleinschreibung) |
| [140](#L140) | $ext = strtolower( pathinfo( $filename, PATHINFO\_EXTENSION ) ); |
| [141](#L141) |  |
| [142](#L142) | // Logge die erkannte Dateiendung |
| [143](#L143) | // error\_log('Detected file extension: ' . $ext); |
| [144](#L144) |  |
| [145](#L145) | // Prüfe auf kml oder gpx und setze den entsprechenden MIME-Typ |
| [146](#L146) | if ( $ext === 'kml' ) { |
| [147](#L147) | // error\_log('Processing KML file.'); |
| [148](#L148) | $data['ext']  = 'kml'; |
| [149](#L149) | $data['type'] = 'application/vnd.google-earth.kml+xml'; |
| [150](#L150) | $data['proper\_filename'] = $filename; |
| [151](#L151) | } elseif ( $ext === 'gpx' ) { |
| [152](#L152) | // error\_log('Processing GPX file.'); |
| [153](#L153) | $data['ext']  = 'gpx'; |
| [154](#L154) | $data['type'] = 'application/gpx+xml'; |
| [155](#L155) | $data['proper\_filename'] = $filename; |
| [156](#L156) | } else { |
| [157](#L157) | // Logge, wenn die Dateiendung nicht unterstützt wird |
| [158](#L158) | error\_log('Unsupported file extension: ' . $ext); |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | // Logge die finalen Dateiinformationen, bevor sie zurückgegeben werden |
| [162](#L162) | // error\_log('File data to be returned: ' . print\_r($data, true)); |
| [163](#L163) | return $data; |
| [164](#L164) | } |
| [165](#L165) |  |
| [166](#L166) | // Filter einbinden, um zusätzliche MIME-Typen (gpx und kml) zu erlauben |
| [167](#L167) | add\_filter( 'upload\_mimes', 'osm\_restrict\_mime\_types' ); |
| [168](#L168) | add\_filter( 'wp\_check\_filetype\_and\_ext', 'allow\_osm\_upload', 10, 4 ); |
| [169](#L169) | } |
| [170](#L170) |  |
| [171](#L171) | function saveGeotagAndPic() { |
| [172](#L172) | if ( isset( $\_POST['lat'], $\_POST['lon'], $\_POST['icon'], $\_POST['post\_id'], $\_POST['geotag\_nonce'] ) ) { |
| [173](#L173) | $latlon  = sanitize\_text\_field( wp\_unslash( $\_POST['lat'] ) ) . ',' . sanitize\_text\_field( wp\_unslash( $\_POST['lon'] ) ); |
| [174](#L174) | $icon    = sanitize\_text\_field( wp\_unslash( $\_POST['icon'] ) ); |
| [175](#L175) | $post\_id = sanitize\_text\_field( wp\_unslash( $\_POST['post\_id'] ) ); |
| [176](#L176) | $nonce   = sanitize\_text\_field( wp\_unslash( $\_POST['geotag\_nonce'] ) ); |
| [177](#L177) |  |
| [178](#L178) | if ( ! wp\_verify\_nonce( $nonce, 'osm\_geotag\_nonce' ) ) { |
| [179](#L179) | echo "Error: Bad ajax request"; |
| [180](#L180) | } else { |
| [181](#L181) | echo "<br>"; |
| [182](#L182) | \_e( 'Location (geotag) saved successfully, you can use it at [Map & Locations]!', 'OSM' ); |
| [183](#L183) | echo "<br><b>"; |
| [184](#L184) | \_e( 'TIPP: ', 'OSM' ); |
| [185](#L185) | echo "</b>"; |
| [186](#L186) | \_e( 'There is an OSM widget that shows a map with your location automatically on your post/page!', 'OSM' ); |
| [187](#L187) |  |
| [188](#L188) | // Custom Field update |
| [189](#L189) | $CustomField = get\_option( 'osm\_custom\_field', 'OSM\_geo\_data' ); |
| [190](#L190) | delete\_post\_meta( $post\_id, $CustomField ); |
| [191](#L191) | delete\_post\_meta( $post\_id, "OSM\_geo\_icon" ); |
| [192](#L192) | add\_post\_meta( $post\_id, $CustomField, $latlon, true ); |
| [193](#L193) | if ( $icon != "" ) { |
| [194](#L194) | add\_post\_meta( $post\_id, "OSM\_geo\_icon", $icon, true ); |
| [195](#L195) | } |
| [196](#L196) | } |
| [197](#L197) | } else { |
| [198](#L198) | // Fehler, wenn die erwarteten POST-Variablen fehlen |
| [199](#L199) | echo "Error: Required data is missing."; |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | wp\_die(); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) |  |
| [206](#L206) |  |
| [207](#L207) | function osm\_add\_action\_links ( $actions ) { |
| [208](#L208) | $mylinks = array( |
| [209](#L209) | '<a href="' . admin\_url( 'options-general.php?page=osm' ) . '">Settings</a>', |
| [210](#L210) | ); |
| [211](#L211) | $actions = array\_merge( $actions, $mylinks ); |
| [212](#L212) | return $actions; |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) | function savePostMarker() { |
| [217](#L217) | if ( isset( $\_POST['MarkerId'], $\_POST['MarkerLat'], $\_POST['MarkerLon'], $\_POST['MarkerIcon'], $\_POST['MarkerName'], $\_POST['post\_id'], $\_POST['marker\_nonce'], $\_POST['MarkerText'] ) ) { |
| [218](#L218) |  |
| [219](#L219) | $MarkerId      = sanitize\_text\_field( wp\_unslash( $\_POST['MarkerId'] ) ); |
| [220](#L220) | $MarkerLatLon  = sanitize\_text\_field( wp\_unslash( $\_POST['MarkerLat'] ) ) . ',' . sanitize\_text\_field( wp\_unslash( $\_POST['MarkerLon'] ) ); |
| [221](#L221) | $MarkerIcon    = sanitize\_text\_field( wp\_unslash( $\_POST['MarkerIcon'] ) ); |
| [222](#L222) | $MarkerName    = sanitize\_text\_field( wp\_unslash( $\_POST['MarkerName'] ) ); |
| [223](#L223) | $post\_id       = sanitize\_text\_field( wp\_unslash( $\_POST['post\_id'] ) ); |
| [224](#L224) | $nonce         = sanitize\_text\_field( wp\_unslash( $\_POST['marker\_nonce'] ) ); |
| [225](#L225) |  |
| [226](#L226) | $allowed\_html  = array( |
| [227](#L227) | 'a'  => array( 'href' => array() ), |
| [228](#L228) | 'br' => array(), |
| [229](#L229) | 'b'  => array(), |
| [230](#L230) | 'i'  => array(), |
| [231](#L231) | ); |
| [232](#L232) | $MarkerText    = wp\_kses( wp\_unslash( $\_POST['MarkerText'] ), $allowed\_html ); |
| [233](#L233) |  |
| [234](#L234) | // Überprüfung des Nonce-Wertes |
| [235](#L235) | if ( ! wp\_verify\_nonce( $nonce, 'osm\_marker\_nonce' ) ) { |
| [236](#L236) | echo "Error: Bad ajax request"; |
| [237](#L237) | } else { |
| [238](#L238) | // Löschen und Hinzufügen von Meta-Daten |
| [239](#L239) | delete\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Name' ); |
| [240](#L240) | delete\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_LatLon' ); |
| [241](#L241) | delete\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Icon' ); |
| [242](#L242) | delete\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Text' ); |
| [243](#L243) | add\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Name', $MarkerName, true ); |
| [244](#L244) | add\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_LatLon', $MarkerLatLon, true ); |
| [245](#L245) | add\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Icon', $MarkerIcon, true ); |
| [246](#L246) | add\_post\_meta( $post\_id, 'OSM\_Marker\_0' . $MarkerId . '\_Text', $MarkerText, true ); |
| [247](#L247) | } |
| [248](#L248) | } else { |
| [249](#L249) | // Fehlende Felder debuggen |
| [250](#L250) | $missing\_fields = array(); |
| [251](#L251) | if ( ! isset( $\_POST['MarkerId'] ) ) $missing\_fields[] = 'MarkerId'; |
| [252](#L252) | if ( ! isset( $\_POST['MarkerLat'] ) ) $missing\_fields[] = 'MarkerLat'; |
| [253](#L253) | if ( ! isset( $\_POST['MarkerLon'] ) ) $missing\_fields[] = 'MarkerLon'; |
| [254](#L254) | if ( ! isset( $\_POST['MarkerIcon'] ) ) $missing\_fields[] = 'MarkerIcon'; |
| [255](#L255) | if ( ! isset( $\_POST['MarkerName'] ) ) $missing\_fields[] = 'MarkerName'; |
| [256](#L256) | if ( ! isset( $\_POST['post\_id'] ) ) $missing\_fields[] = 'post\_id'; |
| [257](#L257) | if ( ! isset( $\_POST['marker\_nonce'] ) ) $missing\_fields[] = 'marker\_nonce'; |
| [258](#L258) | if ( ! isset( $\_POST['MarkerText'] ) ) $missing\_fields[] = 'MarkerText'; |
| [259](#L259) |  |
| [260](#L260) | echo "Error: Required data is missing: " . implode( ', ', $missing\_fields ); |
| [261](#L261) | echo "Error: Required data is missing."; |
| [262](#L262) | } |
| [263](#L263) | wp\_die(); |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) |  |
| [267](#L267) |  |
| [268](#L268) | // If the function exists this file is called as post-upload-ui. |
| [269](#L269) | // We don't do anything then. |
| [270](#L270) | if ( ! function\_exists( 'osm\_restrict\_mime\_types\_hint' ) ) { |
| [271](#L271) | // add to wp |
| [272](#L272) | add\_action( 'post-upload-ui', 'osm\_restrict\_mime\_types\_hint' ); |
| [273](#L273) | /\*\* |
| [274](#L274) | \* Get an Hint about the allowed mime types |
| [275](#L275) | \* |
| [276](#L276) | \* @return  void |
| [277](#L277) | \*/ |
| [278](#L278) | function osm\_restrict\_mime\_types\_hint() { |
| [279](#L279) | echo '<br />'; |
| [280](#L280) | \_e('OSM plugin added: GPX / KML','OSM'); |
| [281](#L281) | } |
| [282](#L282) | } |
| [283](#L283) |  |
| [284](#L284) |  |
| [285](#L285) | // hook to create the meta box |
| [286](#L286) | // enable in osm-config-sample.php |
| [287](#L287) | if (OSM\_enable\_Ajax){ |
| [288](#L288) | add\_action( 'add\_meta\_boxes', 'osm\_map\_create' ); |
| [289](#L289) | } |
| [290](#L290) | include('osm-args-class.php'); |
| [291](#L291) | include('osm-metabox.php'); |
| [292](#L292) | include('osm\_map/osm-oljs2.php'); |
| [293](#L293) | include('osm\_map\_v3/osm-oljs3.php'); |
| [294](#L294) | include('osm\_map/osm-icon.php'); |
| [295](#L295) | include('osm-icon-class.php'); |
| [296](#L296) |  |
| [297](#L297) |  |
| [298](#L298) |  |
| [299](#L299) | function load\_osm\_map\_v3\_scripts($hook) { |
| [300](#L300) | //for osm\_map\_v3 |
| [301](#L301) | wp\_enqueue\_style('osm-ol3-css', Osm\_OL\_3\_CSS); |
| [302](#L302) | wp\_enqueue\_style('osm-ol3-ext-css', Osm\_OL\_3\_Ext\_CSS); |
| [303](#L303) | wp\_enqueue\_style('osm-map-css', Osm\_map\_CSS); |
| [304](#L304) | wp\_enqueue\_script('osm-polyfill', OSM\_PLUGIN\_URL . 'js/polyfill/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL'); |
| [305](#L305) | wp\_enqueue\_script('osm-ol3-library', Osm\_OL\_3\_LibraryLocation); |
| [306](#L306) | wp\_enqueue\_script('osm-ol3-ext-library', Osm\_OL\_3\_Ext\_LibraryLocation); |
| [307](#L307) | wp\_enqueue\_script('osm-ol3-metabox-events', Osm\_OL\_3\_MetaboxEvents\_LibraryLocation); |
| [308](#L308) | wp\_enqueue\_script('osm-map-startup', Osm\_map\_startup\_LibraryLocation); |
| [309](#L309) |  |
| [310](#L310) | } |
| [311](#L311) |  |
| [312](#L312) | function load\_osm\_map\_scripts($hook) { |
| [313](#L313) | wp\_enqueue\_script(array ('jquery')); |
| [314](#L314) |  |
| [315](#L315) | //for osm\_map |
| [316](#L316) | wp\_enqueue\_style('osm-map-css', Osm\_map\_CSS); |
| [317](#L317) | wp\_enqueue\_script('osm-ol-library', Osm\_OL\_LibraryLocation); |
| [318](#L318) | wp\_enqueue\_script('osm-osm-library', Osm\_OSM\_LibraryLocation); |
| [319](#L319) | wp\_enqueue\_script('osm-harbours-library', Osm\_harbours\_LibraryLocation); |
| [320](#L320) | wp\_enqueue\_script('osm-map-utils-library', Osm\_map\_utils\_LibraryLocation); |
| [321](#L321) | wp\_enqueue\_script('osm-utilities-library', Osm\_utilities\_LibraryLocation); |
| [322](#L322) | wp\_enqueue\_script('OsmScript',OSM\_PLUGIN\_JS\_URL.'osm-plugin-lib.js'); |
| [323](#L323) | //wp\_enqueue\_script('OsnScript',Osm\_GOOGLE\_LibraryLocation); |
| [324](#L324) | define ('OSM\_LIBS\_LOADED', 1); |
| [325](#L325) | define ('OL\_LIBS\_LOADED', 1); |
| [326](#L326) | define ('GOOGLE\_LIBS\_LOADED', 1); |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | // let's be unique ... |
| [330](#L330) | // with this namespace |
| [331](#L331) | class Osm |
| [332](#L332) | { |
| [333](#L333) | static $OSM\_ErrorMsg; |
| [334](#L334) | private $localizionName; |
| [335](#L335) |  |
| [336](#L336) | function \_\_construct(){ |
| [337](#L337) | $this->localizionName = 'OSM'; |
| [338](#L338) |  |
| [339](#L339) | // create error object and add our errors |
| [340](#L340) | self::$OSM\_ErrorMsg = new WP\_Error(); |
| [341](#L341) | include('osm-error-msg.php'); |
| [342](#L342) |  |
| [343](#L343) |  |
| [344](#L344) | // add the WP action |
| [345](#L345) | add\_action('wp\_head', array(&$this, 'wp\_head')); |
| [346](#L346) | add\_action('admin\_head', array(&$this, 'admin\_head')); |
| [347](#L347) | add\_action('admin\_menu', array(&$this, 'admin\_menu')); |
| [348](#L348) | add\_action('wp\_enqueue\_scripts', 'load\_osm\_map\_scripts'); |
| [349](#L349) | add\_action('wp\_enqueue\_scripts', 'load\_osm\_map\_v3\_scripts'); |
| [350](#L350) | add\_action('widgets\_init', 'register\_osm\_widget' ); |
| [351](#L351) | add\_action('wp\_ajax\_act\_saveGeotag', 'saveGeotagAndPic'); |
| [352](#L352) | add\_action('wp\_ajax\_act\_saveMarker', 'savePostMarker'); |
| [353](#L353) |  |
| [354](#L354) | // add the WP shortcode |
| [355](#L355) | add\_shortcode('osm\_map',array(&$this, 'sc\_showMap')); |
| [356](#L356) | add\_shortcode('osm\_map\_v3',array(&$this, 'sc\_OL3JS')); |
| [357](#L357) | add\_shortcode('osm\_info',array(&$this, 'sc\_info')); |
| [358](#L358) |  |
| [359](#L359) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename(\_\_FILE\_\_), 'osm\_add\_action\_links' ); |
| [360](#L360) |  |
| [361](#L361) |  |
| [362](#L362) |  |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | public static function traceErrorMsg($e = '') |
| [366](#L366) | { |
| [367](#L367) | $EMsg = self::$OSM\_ErrorMsg->get\_error\_message($e); |
| [368](#L368) | if ($EMsg == null){ |
| [369](#L369) | return $e; |
| [370](#L370) | //return\_\_("Unknown errormessage",$this->localizionName); |
| [371](#L371) | } |
| [372](#L372) | return $EMsg; |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | public static function traceText($a\_Level, $a\_String) |
| [376](#L376) | { |
| [377](#L377) | $TracePrefix = array( |
| [378](#L378) | DEBUG\_ERROR =>'[OSM-Plugin-Error]:', |
| [379](#L379) | DEBUG\_WARNING=>'[OSM-Plugin-Warning]:', |
| [380](#L380) | DEBUG\_INFO=>'[OSM-Plugin-Info]:'); |
| [381](#L381) |  |
| [382](#L382) | if ($a\_Level == DEBUG\_ERROR){ |
| [383](#L383) | echo '<div class="osm\_error\_msg"><p><strong style="color:red">'.$TracePrefix[$a\_Level].Osm::traceErrorMsg($a\_String).'</strong></p></div>'; |
| [384](#L384) | } |
| [385](#L385) | else if ($a\_Level <= Osm\_TraceLevel){ |
| [386](#L386) | echo $TracePrefix[$a\_Level].$a\_String.'<br>'; |
| [387](#L387) | } |
| [388](#L388) | else if ($a\_Level == HTML\_COMMENT){ |
| [389](#L389) | echo "<!-- ".$a\_String." --> \n"; |
| [390](#L390) | } |
| [391](#L391) | } |
| [392](#L392) |  |
| [393](#L393) | // add it to the Settings page |
| [394](#L394) | static function options\_page\_osm() { |
| [395](#L395) | // 0 = no error; |
| [396](#L396) | // 1 = error occurred |
| [397](#L397) | $Option\_Error = 0; |
| [398](#L398) |  |
| [399](#L399) | // Name des benutzerdefinierten Felds für Längen- und Breitengrad |
| [400](#L400) | $osm\_custom\_field  = get\_option('osm\_custom\_field', 'OSM\_geo\_data'); |
| [401](#L401) |  |
| [402](#L402) | // Standardwerte für die Karte |
| [403](#L403) | $osm\_default\_lat  = get\_option('osm\_default\_lat', OSM\_default\_lat); |
| [404](#L404) | $osm\_default\_lon  = get\_option('osm\_default\_lon', OSM\_default\_lon); |
| [405](#L405) | $osm\_default\_zoom = get\_option('osm\_default\_zoom', OSM\_default\_zoom); |
| [406](#L406) |  |
| [407](#L407) | // Überprüfung, ob das Formular gesendet wurde und der Nonce korrekt ist |
| [408](#L408) | if (isset($\_POST['osm\_options']) && wp\_verify\_nonce(sanitize\_text\_field(wp\_unslash($\_POST['osm\_options'])), 'update\_options')) { |
| [409](#L409) |  |
| [410](#L410) | // Prüfen und verarbeiten der Default Latitude |
| [411](#L411) | if (isset($\_POST['osm\_default\_lat'])) { |
| [412](#L412) | $temp\_lat = (float) sanitize\_text\_field(wp\_unslash($\_POST['osm\_default\_lat'])); |
| [413](#L413) | if ($temp\_lat > LAT\_MAX || $temp\_lat < LAT\_MIN) { |
| [414](#L414) | $Option\_Error = 1; |
| [415](#L415) | Osm::traceText(DEBUG\_ERROR, "e\_default\_lat\_range"); |
| [416](#L416) | } else { |
| [417](#L417) | update\_option('osm\_default\_lat', $temp\_lat); |
| [418](#L418) | } |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | // Prüfen und verarbeiten der Default Longitude |
| [422](#L422) | if (isset($\_POST['osm\_default\_lon'])) { |
| [423](#L423) | $temp\_lon = (float) sanitize\_text\_field(wp\_unslash($\_POST['osm\_default\_lon'])); |
| [424](#L424) | if ($temp\_lon > LON\_MAX || $temp\_lon < LON\_MIN) { |
| [425](#L425) | $Option\_Error = 1; |
| [426](#L426) | Osm::traceText(DEBUG\_ERROR, "e\_default\_lon\_range"); |
| [427](#L427) | } else { |
| [428](#L428) | update\_option('osm\_default\_lon', $temp\_lon); |
| [429](#L429) | } |
| [430](#L430) | } |
| [431](#L431) |  |
| [432](#L432) | // Prüfen und verarbeiten der Default Zoom |
| [433](#L433) | if (isset($\_POST['osm\_default\_zoom'])) { |
| [434](#L434) | $temp\_zoom = (int) sanitize\_text\_field(wp\_unslash($\_POST['osm\_default\_zoom'])); |
| [435](#L435) | if ($temp\_zoom > 19 || $temp\_zoom < 1) { |
| [436](#L436) | $Option\_Error = 1; |
| [437](#L437) | Osm::traceText(DEBUG\_ERROR, "e\_default\_zoom\_range"); |
| [438](#L438) | } else { |
| [439](#L439) | update\_option('osm\_default\_zoom', $temp\_zoom); |
| [440](#L440) | } |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | // Erfolgs- oder Fehlermeldung |
| [444](#L444) | if ($Option\_Error == 0) { |
| [445](#L445) | Osm::traceText(DEBUG\_INFO, "i\_options\_updated"); |
| [446](#L446) | } else { |
| [447](#L447) | Osm::traceText(DEBUG\_ERROR, "e\_options\_not\_updated"); |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) | } else { |
| [451](#L451) | // Fehler bei der Nonce-Überprüfung |
| [452](#L452) | if (isset($\_POST['osm\_options'])) { |
| [453](#L453) | Osm::traceText(DEBUG\_ERROR, "e\_nonce\_verification\_failed"); |
| [454](#L454) | } |
| [455](#L455) | } |
| [456](#L456) |  |
| [457](#L457) | // Einbinden der Optionen-Seite |
| [458](#L458) | include('osm-options.php'); |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) |  |
| [462](#L462) | // put meta tags into the head section |
| [463](#L463) | function wp\_head($not\_used) |
| [464](#L464) | { |
| [465](#L465) | global $wp\_query; |
| [466](#L466) | global $post; |
| [467](#L467) |  |
| [468](#L468) | $lat = ''; |
| [469](#L469) | $lon = ''; |
| [470](#L470) | $CustomField =  get\_option('osm\_custom\_field','OSM\_geo\_data'); |
| [471](#L471) |  |
| [472](#L472) | if (($CustomField != false) && (get\_the\_ID() !== false) && (get\_post\_meta($post->ID, $CustomField, true))){ |
| [473](#L473) | $PostLatLon = get\_post\_meta($post->ID, $CustomField, true); |
| [474](#L474) | if (!empty($PostLatLon)) { |
| [475](#L475) | list($lat, $lon) = explode(',', $PostLatLon); |
| [476](#L476) | } |
| [477](#L477) | } |
| [478](#L478) |  |
| [479](#L479) |  |
| [480](#L480) | // global Javascript variables |
| [481](#L481) | echo '<script type="text/javascript"> |
| [482](#L482) |  |
| [483](#L483) | /\*\*  all layers have to be in this global array - in further process each map will have something like vectorM[map\_ol3js\_n][layer\_n] \*/ |
| [484](#L484) | var vectorM = [[]]; |
| [485](#L485) |  |
| [486](#L486) |  |
| [487](#L487) | /\*\* put translations from PHP/mo to JavaScript \*/ |
| [488](#L488) | var translations = []; |
| [489](#L489) |  |
| [490](#L490) | /\*\* global GET-Parameters \*/ |
| [491](#L491) | var HTTP\_GET\_VARS = []; |
| [492](#L492) |  |
| [493](#L493) | </script>'; |
| [494](#L494) |  |
| [495](#L495) | if(is\_single() && ($lat != '') && ($lon != '')){ |
| [496](#L496) | $title = convert\_chars(wp\_strip\_all\_tags(get\_bloginfo("name")))." - ".$wp\_query->post->post\_title; |
| [497](#L497) | Osm::traceText(HTML\_COMMENT, 'OSM plugin '.PLUGIN\_VER.': adding geo meta tags:'); |
| [498](#L498) | } |
| [499](#L499) | else{ |
| [500](#L500) | Osm::traceText(HTML\_COMMENT, 'OSM plugin '.PLUGIN\_VER.': did not add geo meta tags.'); |
| [501](#L501) | return; |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) |  |
| [505](#L505) |  |
| [506](#L506) |  |
| [507](#L507) |  |
| [508](#L508) | // let's store geo data with W3 standard |
| [509](#L509) | echo "<meta name=\"ICBM\" content=\"{$lat}, {$lon}\" />\n"; |
| [510](#L510) | echo "<meta name=\"DC.title\" content=\"{$wp\_query->post->post\_title}\" />\n"; |
| [511](#L511) | echo "<meta name=\"geo.placename\" content=\"{$wp\_query->post->post\_title}\"/>\n"; |
| [512](#L512) | echo "<meta name=\"geo.position\"  content=\"{$lat};{$lon}\" />\n"; |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | // global JS variable in admin area |
| [516](#L516) | function admin\_head($not\_used) |
| [517](#L517) | { |
| [518](#L518) | // global Javascript variables |
| [519](#L519) | echo '<script type="text/javascript"> |
| [520](#L520) |  |
| [521](#L521) | /\*\*  all layers have to be in this global array - in further process each map will have something like vectorM[map\_ol3js\_n][layer\_n] \*/ |
| [522](#L522) | var vectorM = [[]]; |
| [523](#L523) |  |
| [524](#L524) |  |
| [525](#L525) | /\*\* put translations from PHP/mo to JavaScript \*/ |
| [526](#L526) | var translations = []; |
| [527](#L527) |  |
| [528](#L528) | /\*\* global GET-Parameters \*/ |
| [529](#L529) | var HTTP\_GET\_VARS = []; |
| [530](#L530) |  |
| [531](#L531) | </script>'; |
| [532](#L532) |  |
| [533](#L533) | } |
| [534](#L534) |  |
| [535](#L535) | function gps2Num($coordPart) { |
| [536](#L536) | $parts = explode('/', $coordPart); |
| [537](#L537) | if (count($parts) <= 0){ |
| [538](#L538) | return 0; |
| [539](#L539) | } |
| [540](#L540) | if (count($parts) == 1){ |
| [541](#L541) | return $parts[0]; |
| [542](#L542) | } |
| [543](#L543) | return floatval($parts[0]) / floatval($parts[1]); |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | function getGps($exifCoord, $hemi) { |
| [547](#L547) | $degrees = count($exifCoord) > 0 ? OSM::gps2Num($exifCoord[0]) : 0; |
| [548](#L548) | $minutes = count($exifCoord) > 1 ? OSM::gps2Num($exifCoord[1]) : 0; |
| [549](#L549) | $seconds = count($exifCoord) > 2 ? OSM::gps2Num($exifCoord[2]) : 0; |
| [550](#L550) |  |
| [551](#L551) | $flip = ($hemi == 'W' or $hemi == 'S') ? -1 : 1; |
| [552](#L552) | return $flip \* ($degrees + $minutes / 60 + $seconds / 3600); |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | static function getPostMarkerCFN($a\_Number, $a\_FieldName) { |
| [556](#L556) | $CustomFieldName = "OSM\_Marker\_0".$a\_Number."\_".$a\_FieldName; |
| [557](#L557) | return $CustomFieldName; |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | @param $a\_import geotag(osm,osm\_l) or postmarkers (1..9,all) |
| [562](#L562) | @param $a\_import\_osm\_cat\_incl\_name only for geotag (only used for geotagged) |
| [563](#L563) | @param $a\_import\_osm\_cat\_excl\_name only for getoag (only used for geotagged) |
| [564](#L564) | @param $a\_post\_type  (only used for geotagged) |
| [565](#L565) | @param $a\_import\_osm\_custom\_tax\_incl\_name only for geotag |
| [566](#L566) | @param $a\_custom\_taxonomy only for geotag |
| [567](#L567) | @return list of markers |
| [568](#L568) | \*/ |
| [569](#L569) | static function OL3\_createMarkerList($a\_import, $a\_import\_osm\_cat\_incl\_name, $a\_import\_osm\_cat\_excl\_name, $a\_post\_type, $a\_import\_osm\_custom\_tax\_incl\_name, $a\_taxonomy) { |
| [570](#L570) | Osm::traceText(DEBUG\_INFO, "OL3\_createMarkerList(".$a\_import.",".$a\_import\_osm\_cat\_incl\_name.",".$a\_import\_osm\_cat\_excl\_name.",".$a\_post\_type.",".$a\_import\_osm\_custom\_tax\_incl\_name.",".$a\_taxonomy.")"); |
| [571](#L571) |  |
| [572](#L572) | global $post; |
| [573](#L573) | $post\_org = $post; |
| [574](#L574) |  |
| [575](#L575) | // Initialize $pageposts |
| [576](#L576) | $pageposts = []; |
| [577](#L577) |  |
| [578](#L578) | // Posts or pages with geotags |
| [579](#L579) | if ($a\_import == 'osm' || $a\_import == 'osm\_l') { |
| [580](#L580) | $CustomFieldName = get\_option('osm\_custom\_field', 'OSM\_geo\_data'); |
| [581](#L581) | global $wpdb; |
| [582](#L582) |  |
| [583](#L583) | // Sanitize input |
| [584](#L584) | $post\_type = sanitize\_key($a\_post\_type); |
| [585](#L585) | $CustomFieldName = sanitize\_text\_field($CustomFieldName); |
| [586](#L586) |  |
| [587](#L587) | // Query depending on category inclusion or exclusion |
| [588](#L588) | if ($a\_import\_osm\_cat\_incl\_name == "osm\_all") { |
| [589](#L589) | // Execute the query with placeholders inside get\_results |
| [590](#L590) | $pageposts = $wpdb->get\_results( |
| [591](#L591) | $wpdb->prepare(" |
| [592](#L592) | SELECT DISTINCT wposts.\* |
| [593](#L593) | FROM {$wpdb->posts} wposts |
| [594](#L594) | LEFT JOIN {$wpdb->postmeta} wpostmeta ON wposts.ID = wpostmeta.post\_id |
| [595](#L595) | LEFT JOIN {$wpdb->term\_relationships} tr ON (wposts.ID = tr.object\_id) |
| [596](#L596) | LEFT JOIN {$wpdb->term\_taxonomy} tt ON (tr.term\_taxonomy\_id = tt.term\_taxonomy\_id) |
| [597](#L597) | WHERE wpostmeta.meta\_key = %s |
| [598](#L598) | AND wposts.post\_status = 'publish' |
| [599](#L599) | AND wposts.post\_type = %s |
| [600](#L600) | ", $CustomFieldName, $post\_type), |
| [601](#L601) | OBJECT |
| [602](#L602) | ); |
| [603](#L603) | } else { |
| [604](#L604) | // Execute the query with placeholders inside get\_results |
| [605](#L605) | $pageposts = $wpdb->get\_results( |
| [606](#L606) | $wpdb->prepare(" |
| [607](#L607) | SELECT wposts.\* |
| [608](#L608) | FROM {$wpdb->posts} wposts |
| [609](#L609) | JOIN {$wpdb->postmeta} wpostmeta ON (wpostmeta.post\_id = wposts.ID) |
| [610](#L610) | JOIN {$wpdb->term\_relationships} tr ON (tr.object\_id = wposts.ID) |
| [611](#L611) | JOIN {$wpdb->term\_taxonomy} tt ON (tt.term\_taxonomy\_id = tr.term\_taxonomy\_id) |
| [612](#L612) | JOIN {$wpdb->terms} t ON tt.term\_id = t.term\_id |
| [613](#L613) | WHERE wpostmeta.meta\_key = %s |
| [614](#L614) | AND wposts.post\_status = 'publish' |
| [615](#L615) | AND wposts.post\_type = %s |
| [616](#L616) | AND tt.taxonomy = %s |
| [617](#L617) | AND t.name = %s |
| [618](#L618) | ", $CustomFieldName, $post\_type, $a\_taxonomy, $a\_import\_osm\_cat\_incl\_name), |
| [619](#L619) | OBJECT |
| [620](#L620) | ); |
| [621](#L621) | } |
| [622](#L622) |  |
| [623](#L623) | if ($pageposts) { |
| [624](#L624) | $MarkerArray = []; |
| [625](#L625) | foreach ($pageposts as $post) { |
| [626](#L626) | setup\_postdata($post); |
| [627](#L627) | $Data = get\_post\_meta($post->ID, $CustomFieldName, true); |
| [628](#L628) | // Remove spaces before and after commas |
| [629](#L629) | $Data = preg\_replace('/\s\*,\s\*/', ',', $Data); |
| [630](#L630) | $GeoData\_Array = explode(' ', $Data); |
| [631](#L631) | list($temp\_lat, $temp\_lon) = explode(',', $GeoData\_Array[0]); |
| [632](#L632) | $PostMarker = get\_post\_meta($post->ID, 'OSM\_geo\_icon', true); |
| [633](#L633) | $PostMarker = Osm\_icon::replaceOldIcon($PostMarker); |
| [634](#L634) |  |
| [635](#L635) | // Create the marker text |
| [636](#L636) | $Marker\_Txt = '<a href="'.get\_permalink($post->ID).'">'.get\_the\_title($post->ID).'</a><br>'; |
| [637](#L637) | $MarkerArray[] = array( |
| [638](#L638) | 'lat' => $temp\_lat, |
| [639](#L639) | 'lon' => $temp\_lon, |
| [640](#L640) | 'popup\_height' => '100', |
| [641](#L641) | 'popup\_width' => '150', |
| [642](#L642) | 'marker' => $PostMarker, |
| [643](#L643) | 'text' => $Marker\_Txt, |
| [644](#L644) | 'Marker' => $PostMarker |
| [645](#L645) | ); |
| [646](#L646) | } |
| [647](#L647) | wp\_reset\_postdata(); // Reset global post data |
| [648](#L648) | $post = $post\_org;  // Restore original post |
| [649](#L649) | Osm::traceText(DEBUG\_INFO, "[OL3\_createMarkerList]: Found Marker " . count($MarkerArray)); |
| [650](#L650) | return $MarkerArray; |
| [651](#L651) | } else { |
| [652](#L652) | Osm::traceText(DEBUG\_ERROR, "[OL3\_createMarkerList]: No posts/pages with geotag found!"); |
| [653](#L653) | Osm::traceText(DEBUG\_ERROR, "CustomFieldName: " . $CustomFieldName); |
| [654](#L654) | Osm::traceText(DEBUG\_ERROR, "tagged\_type: " . $post\_type); |
| [655](#L655) | Osm::traceText(DEBUG\_ERROR, "tagged\_filter\_type: " . $a\_taxonomy); |
| [656](#L656) | Osm::traceText(DEBUG\_ERROR, "tagged\_filter: " . $a\_import\_osm\_cat\_incl\_name); |
| [657](#L657) | } |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | // Handle single post marker (marker\_id between 1 and 9) |
| [661](#L661) | elseif (($a\_import > 0) && ($a\_import < 10)) { |
| [662](#L662) | $PostMarkerCFN\_LatLon = OSM::getPostMarkerCFN($a\_import,"LatLon"); |
| [663](#L663) | $PostMarkerCFN\_Icon\_Name = OSM::getPostMarkerCFN($a\_import,"Icon"); |
| [664](#L664) | $PostMarkerCFN\_Name = OSM::getPostMarkerCFN($a\_import,"Name"); |
| [665](#L665) | $PostMarkerCFN\_Text = OSM::getPostMarkerCFN($a\_import,"Text"); |
| [666](#L666) |  |
| [667](#L667) | $metapostLatLon = get\_post\_meta($post->ID, $PostMarkerCFN\_LatLon, true); |
| [668](#L668) | $metapostIcon\_name = get\_post\_meta($post->ID, $PostMarkerCFN\_Icon\_Name, true); |
| [669](#L669) | $metapostmarker\_name = get\_post\_meta($post->ID, $PostMarkerCFN\_Name, true); |
| [670](#L670) | $metapostmarker\_text = get\_post\_meta($post->ID, $PostMarkerCFN\_Text, true); |
| [671](#L671) |  |
| [672](#L672) | // Check lat lon |
| [673](#L673) | $metapostLatLon = preg\_replace('/\s\*,\s\*/', ',', $metapostLatLon); |
| [674](#L674) | $GeoData\_Array = explode(' ', $metapostLatLon); |
| [675](#L675) | list($temp\_lat, $temp\_lon) = explode(',', $GeoData\_Array[0]); |
| [676](#L676) |  |
| [677](#L677) | list($temp\_lat, $temp\_lon) = Osm::checkLatLongRange('Marker', $temp\_lat, $temp\_lon, 'no'); |
| [678](#L678) | if (($temp\_lat != 0) || ($temp\_lon != 0)) { |
| [679](#L679) | $PostMarker = Osm\_icon::replaceOldIcon($metapostIcon\_name); |
| [680](#L680) | $Marker\_Txt = '<p>' . $metapostmarker\_text . '</p>'; |
| [681](#L681) | $MarkerArray[] = array( |
| [682](#L682) | 'lat' => $temp\_lat, |
| [683](#L683) | 'lon' => $temp\_lon, |
| [684](#L684) | 'popup\_height' => '100', |
| [685](#L685) | 'popup\_width' => '150', |
| [686](#L686) | 'marker' => $PostMarker, |
| [687](#L687) | 'text' => $Marker\_Txt, |
| [688](#L688) | 'Marker' => $PostMarker |
| [689](#L689) | ); |
| [690](#L690) | } |
| [691](#L691) | $post = $post\_org; |
| [692](#L692) | return $MarkerArray; |
| [693](#L693) | } |
| [694](#L694) |  |
| [695](#L695) | // Handle all post markers |
| [696](#L696) | elseif ($a\_import == "all") { |
| [697](#L697) | $MarkerArray = []; |
| [698](#L698) | for ($Counter = 1; $Counter < 10; $Counter++) { |
| [699](#L699) | $PostMarkerCFN\_LatLon = OSM::getPostMarkerCFN($Counter, "LatLon"); |
| [700](#L700) | $PostMarkerCFN\_Icon\_Name = OSM::getPostMarkerCFN($Counter, "Icon"); |
| [701](#L701) | $PostMarkerCFN\_Name = OSM::getPostMarkerCFN($Counter, "Name"); |
| [702](#L702) | $PostMarkerCFN\_Text = OSM::getPostMarkerCFN($Counter, "Text"); |
| [703](#L703) |  |
| [704](#L704) | $metapostLatLon = get\_post\_meta($post->ID, $PostMarkerCFN\_LatLon, true); |
| [705](#L705) | $metapostIcon\_name = get\_post\_meta($post->ID, $PostMarkerCFN\_Icon\_Name, true); |
| [706](#L706) | $metapostmarker\_name = get\_post\_meta($post->ID, $PostMarkerCFN\_Name, true); |
| [707](#L707) | $metapostmarker\_text = get\_post\_meta($post->ID, $PostMarkerCFN\_Text, true); |
| [708](#L708) |  |
| [709](#L709) | // Check lat lon |
| [710](#L710) | $metapostLatLon = preg\_replace('/\s\*,\s\*/', ',', $metapostLatLon); |
| [711](#L711) | $GeoData\_Array = explode(' ', $metapostLatLon); |
| [712](#L712) | list($temp\_lat, $temp\_lon) = explode(',', $GeoData\_Array[0]); |
| [713](#L713) |  |
| [714](#L714) | list($temp\_lat, $temp\_lon) = Osm::checkLatLongRange('Marker', $temp\_lat, $temp\_lon, 'no'); |
| [715](#L715) | if (($temp\_lat != 0) || ($temp\_lon != 0)) { |
| [716](#L716) | $PostMarker = Osm\_icon::replaceOldIcon($metapostIcon\_name); |
| [717](#L717) | $Marker\_Txt = $metapostmarker\_text . '  </a><br>'; |
| [718](#L718) | $MarkerArray[] = array( |
| [719](#L719) | 'lat' => $temp\_lat, |
| [720](#L720) | 'lon' => $temp\_lon, |
| [721](#L721) | 'popup\_height' => '100', |
| [722](#L722) | 'popup\_width' => '150', |
| [723](#L723) | 'marker' => $PostMarker, |
| [724](#L724) | 'text' => $Marker\_Txt, |
| [725](#L725) | 'Marker' => $PostMarker |
| [726](#L726) | ); |
| [727](#L727) | } |
| [728](#L728) | } |
| [729](#L729) | $post = $post\_org; |
| [730](#L730) | return $MarkerArray; |
| [731](#L731) | } |
| [732](#L732) | } |
| [733](#L733) |  |
| [734](#L734) |  |
| [735](#L735) |  |
| [736](#L736) |  |
| [737](#L737) | function createMarkerList($a\_import, $a\_import\_UserName, $a\_Customfield, $a\_import\_osm\_cat\_incl\_name,  $a\_import\_osm\_cat\_excl\_name, $a\_post\_type, $a\_import\_osm\_custom\_tax\_incl\_name, $a\_custom\_taxonomy) |
| [738](#L738) | { |
| [739](#L739) | Osm::traceText(DEBUG\_INFO, "createMarkerList(".$a\_import.",".$a\_import\_UserName.",".$a\_Customfield.")"); |
| [740](#L740) | global $post; |
| [741](#L741) | $post\_org = $post; |
| [742](#L742) |  |
| [743](#L743) | // make a dummymarker to you use icon.clone later |
| [744](#L744) | if ($a\_import == 'gcstats'){ |
| [745](#L745) | Osm::traceText(DEBUG\_INFO, "Requesting data from gcStats-plugin"); |
| [746](#L746) | include('osm-import.php'); |
| [747](#L747) | } |
| [748](#L748) | else if ($a\_import == 'ecf'){ |
| [749](#L749) | Osm::traceText(DEBUG\_INFO, "Requesting data from comments"); |
| [750](#L750) | include('osm-import.php'); |
| [751](#L751) | } |
| [752](#L752) | else if ($a\_import == 'osm' || $a\_import == 'osm\_l'){ |
| [753](#L753) | // let's see which posts are using our geo data ... |
| [754](#L754) | Osm::traceText(DEBUG\_INFO, "check all posts for osm geo custom fields"); |
| [755](#L755) | $CustomFieldName = get\_option('osm\_custom\_field','OSM\_geo\_data'); |
| [756](#L756) | $recentPosts = new WP\_Query(); |
| [757](#L757) | $recentPosts->query('meta\_key='.$CustomFieldName.'&post\_status=publish'.'&showposts=-1'.'&post\_type='.$a\_post\_type.''); |
| [758](#L758) | while ($recentPosts->have\_posts()) : $recentPosts->the\_post(); |
| [759](#L759) | $Data = get\_post\_meta($post->ID, $CustomFieldName, true); |
| [760](#L760) | // remove space before and after comma |
| [761](#L761) | $Data = preg\_replace('/\s\*,\s\*/', ',',$Data); |
| [762](#L762) | // get pairs of coordination |
| [763](#L763) | $GeoData\_Array = explode( ' ', $Data ); |
| [764](#L764) | list($temp\_lat, $temp\_lon) = explode(',', $GeoData\_Array[0]); |
| [765](#L765) | //echo $post->ID.'Lat: '.$temp\_lat.'Long '.$temp\_lon.'<br>'; |
| [766](#L766) | // check if a filter is set and geodata are set |
| [767](#L767) | // if filter is set and set then pretend there are no geodata |
| [768](#L768) | if (($a\_import\_osm\_cat\_incl\_name  != 'Osm\_All' || $a\_import\_osm\_cat\_excl\_name  != 'Osm\_None' || $a\_import\_osm\_custom\_tax\_incl\_name != 'Osm\_All')&&($temp\_lat != '' && $temp\_lon != '')){ |
| [769](#L769) | $categories = wp\_get\_post\_categories($post->ID); |
| [770](#L770) | foreach( $categories as $catid ) { |
| [771](#L771) | $cat = get\_category($catid); |
| [772](#L772) | if (($a\_import\_osm\_cat\_incl\_name  != 'Osm\_All') && (strtolower($cat->name) != (strtolower($a\_import\_osm\_cat\_incl\_name)))){ |
| [773](#L773) | $temp\_lat = ''; |
| [774](#L774) | $temp\_lon = ''; |
| [775](#L775) | } |
| [776](#L776) | if (strtolower($cat->name) == (strtolower($a\_import\_osm\_cat\_excl\_name))){ |
| [777](#L777) | $temp\_lat = ''; |
| [778](#L778) | $temp\_lon = ''; |
| [779](#L779) | } |
| [780](#L780) | } |
| [781](#L781) | if ($a\_import\_osm\_custom\_tax\_incl\_name != 'Osm\_All'){ // get rid of  Invalid argument supplied for foreach() |
| [782](#L782) | $mycustomcategories = get\_the\_terms( $post->ID, $a\_import\_osm\_custom\_tax\_incl\_name); |
| [783](#L783) | foreach( $mycustomcategories as $term ) { |
| [784](#L784) | $taxonomies[0] = $term->term\_taxonomy\_id; |
| [785](#L785) | // Get rid of the other data stored in the object |
| [786](#L786) | unset($term); |
| [787](#L787) | } |
| [788](#L788) | foreach( $taxonomies as $taxid ) { |
| [789](#L789) | $termsObjects = wp\_get\_object\_terms($post->ID, $a\_custom\_taxonomy); |
| [790](#L790) | foreach ($termsObjects as $termsObject) { |
| [791](#L791) | $currentCustomCat[] = $termsObject->name; |
| [792](#L792) | } |
| [793](#L793) | if (($a\_import\_osm\_custom\_tax\_incl\_name  != 'Osm\_All') &&  ! in\_array($a\_import\_osm\_custom\_tax\_incl\_name, $currentCustomCat)) { |
| [794](#L794) | $temp\_lat = ''; |
| [795](#L795) | $temp\_lon = ''; |
| [796](#L796) | } |
| [797](#L797) | if (strtolower($currentCustomCat) == (strtolower($a\_import\_osm\_cat\_excl\_name))){ |
| [798](#L798) | $temp\_lat = ''; |
| [799](#L799) | $temp\_lon = ''; |
| [800](#L800) | } |
| [801](#L801) | } |
| [802](#L802) | } |
| [803](#L803) | } |
| [804](#L804) | if ($temp\_lat != '' && $temp\_lon != '') { |
| [805](#L805) | // how many tags do we have in this post? |
| [806](#L806) | $NumOfGeoTagsInPost = count($GeoData\_Array); |
| [807](#L807) | $PostMarker = get\_post\_meta($post->ID, 'OSM\_geo\_icon', true); |
| [808](#L808) | $PostMarker = Osm\_icon::replaceOldIcon($PostMarker); |
| [809](#L809) | for ($TagNum = 0; $TagNum < $NumOfGeoTagsInPost; $TagNum++){ |
| [810](#L810) | list($tag\_lat, $tag\_lon) = explode(',', $GeoData\_Array[$TagNum]); |
| [811](#L811) | list($tag\_lat, $tag\_lon) = Osm::checkLatLongRange('$marker\_all\_posts',$tag\_lat, $tag\_lon); |
| [812](#L812) | //if ($a\_import == 'osm\_l' ){ |
| [813](#L813) | $categories = wp\_get\_post\_categories($post->ID); |
| [814](#L814) | // take the last one but ignore those without a specific category |
| [815](#L815) | foreach( $categories as $catid ) { |
| [816](#L816) | $cat = get\_category($catid); |
| [817](#L817) | if ((strtolower($cat->name) == 'uncategorized') || (strtolower($cat->name) == 'allgemein')){ |
| [818](#L818) | $Category\_Txt = ''; |
| [819](#L819) | } |
| [820](#L820) | else{ |
| [821](#L821) | $Category\_Txt = $cat->name.': '; |
| [822](#L822) | } |
| [823](#L823) | } |
| [824](#L824) | $Marker\_Txt = '<a href="'.get\_permalink($post->ID).'">'.$Category\_Txt.get\_the\_title($post->ID).'  </a><br>'; |
| [825](#L825) | if ($a\_import == 'osm\_l' ){ |
| [826](#L826) | $Marker\_Txt .= get\_the\_excerpt($post->ID); |
| [827](#L827) | } |
| [828](#L828) | $MarkerArray[] = array('lat'=> $tag\_lat,'lon'=>$tag\_lon,'popup\_height'=>'100', 'popup\_width'=>'150', 'marker'=>$PostMarker, 'text'=>$Marker\_Txt, 'Marker'=>$PostMarker); |
| [829](#L829) | //} |
| [830](#L830) | //else{ // plain osm without link to the post |
| [831](#L831) | //  $Marker\_Txt = ' '; |
| [832](#L832) | //  $MarkerArray[] = array('lat'=> $tag\_lat,'lon'=>$tag\_lon,'popup\_height'=>'100', 'popup\_width'=>'150', 'marker'=>$Icon["name"], 'text'=>$Marker\_Txt, 'Marker'=>$PostMarker); |
| [833](#L833) | //} |
| [834](#L834) | } |
| [835](#L835) | } |
| [836](#L836) | Osm::traceText(DEBUG\_INFO, "Found Marker ".count($MarkerArray)); |
| [837](#L837) | endwhile; |
| [838](#L838) | } |
| [839](#L839) | else if ($a\_import == 'wpgmg'){ |
| [840](#L840) | // let's see which posts are using our geo data ... |
| [841](#L841) | Osm::traceText(DEBUG\_INFO, "check all posts for wpgmg geo custom fields"); |
| [842](#L842) | $recentPosts = new WP\_Query(); |
| [843](#L843) | $recentPosts->query('meta\_key='.WPGMG\_LAT.'&meta\_key='.WPGMG\_LON.'&showposts=-1'); |
| [844](#L844) | while ($recentPosts->have\_posts()) : $recentPosts->the\_post(); |
| [845](#L845) | include('osm-import.php'); |
| [846](#L846) | if ($temp\_lat != '' && $temp\_lon != '') { |
| [847](#L847) | list($temp\_lat, $temp\_lon) = $this->checkLatLongRange('$marker\_all\_posts',$temp\_lat, $temp\_lon); |
| [848](#L848) | $MarkerArray[] = array('lat'=> $temp\_lat,'lon'=>$temp\_lon,'marker'=>$Icon["name"],'popup\_height'=>'100', 'popup\_width'=>'200'); |
| [849](#L849) | } |
| [850](#L850) | endwhile; |
| [851](#L851) | } |
| [852](#L852) | else if ($a\_import == 'exif\_m'){ |
| [853](#L853) | $attachments = get\_children( array( |
| [854](#L854) | 'post\_parent'    => get\_the\_ID(), |
| [855](#L855) | 'post\_type'      => 'attachment', |
| [856](#L856) | 'numberposts'    => -1, // show all -1 |
| [857](#L857) | 'post\_status'    => 'inherit', |
| [858](#L858) | 'post\_mime\_type' => 'image', |
| [859](#L859) | 'order'          => 'ASC', |
| [860](#L860) | 'orderby'        => 'menu\_order ASC')); |
| [861](#L861) |  |
| [862](#L862) | foreach ( $attachments as $attachment\_id => $attachment ) { |
| [863](#L863) | $imagemeta = wp\_get\_attachment\_metadata($attachment\_id ); |
| [864](#L864) |  |
| [865](#L865) | $img\_src   = wp\_get\_attachment\_image\_src($attachment\_id,'full'); |
| [866](#L866) | $img\_thmb   = wp\_get\_attachment\_image\_src($attachment\_id,'thumbnail'); |
| [867](#L867) | $Popup\_width  = $img\_thmb[1]+20; |
| [868](#L868) | $Popup\_height = $img\_thmb[2]+10; |
| [869](#L869) |  |
| [870](#L870) | $file      = $img\_src[0]; |
| [871](#L871) | if (is\_callable('exif\_read\_data')) { |
| [872](#L872) | $exif = @exif\_read\_data($file); |
| [873](#L873) | if (!empty($exif['GPSLatitude'])) { |
| [874](#L874) | $lat = OSM::getGps($exif["GPSLatitude"], $exif['GPSLatitudeRef']); |
| [875](#L875) | } |
| [876](#L876) | if (!empty($exif['GPSLongitude'])) { |
| [877](#L877) | $lon = OSM::getGps($exif["GPSLongitude"], $exif['GPSLongitudeRef']); |
| [878](#L878) | } |
| [879](#L879) | } |
| [880](#L880) | $Marker\_Txt = wp\_get\_attachment\_image( $attachment\_id ); |
| [881](#L881) | $MarkerArray[] = array('lat'=> $lat,'lon'=>$lon,'popup\_height'=>$Popup\_height, 'popup\_width'=>$Popup\_width, 'marker'=>$Icon["name"], 'text'=>$Marker\_Txt, 'Marker'=>$PostMarker); |
| [882](#L882) | } |
| [883](#L883) | } |
| [884](#L884) | $post = $post\_org; |
| [885](#L885) | return $MarkerArray; |
| [886](#L886) | } |
| [887](#L887) |  |
| [888](#L888) | // if you miss a colour, just add it |
| [889](#L889) | public static  function checkStyleColour($a\_colour){ |
| [890](#L890) | if ($a\_colour != 'red' && $a\_colour != 'blue' && $a\_colour != 'black' && $a\_colour != 'green' && $a\_colour != 'orange'){ |
| [891](#L891) | return "blue"; |
| [892](#L892) | } |
| [893](#L893) | return $a\_colour; |
| [894](#L894) | } |
| [895](#L895) |  |
| [896](#L896) | // get the layer for the markers |
| [897](#L897) | static function getImportLayer($a\_type, $a\_UserName, $Icon, $a\_osm\_cat\_incl\_name, $a\_osm\_cat\_excl\_name, $a\_line\_color, $a\_line\_width, $a\_line\_opacity, $a\_post\_type, $a\_import\_osm\_custom\_tax\_incl\_name, $a\_custom\_taxonomy, $a\_MapName){ |
| [898](#L898) |  |
| [899](#L899) | if ($a\_type  == 'osm\_l'){ |
| [900](#L900) | $LayerName = 'TaggedPosts'; |
| [901](#L901) | if ($Icon["name"] != 'NoName'){ // <= ToDo |
| [902](#L902) | $PopUp = 'true'; |
| [903](#L903) | } |
| [904](#L904) | else { |
| [905](#L905) | $PopUp = 'false'; |
| [906](#L906) | } |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | // import data from tagged posts |
| [910](#L910) | else if ($a\_type  == 'osm'){ |
| [911](#L911) | $LayerName = 'TaggedPosts'; |
| [912](#L912) | $PopUp = 'true'; |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | // import data from wpgmg |
| [916](#L916) | else if ($a\_type  == 'wpgmg'){ |
| [917](#L917) | $LayerName = 'TaggedPosts'; |
| [918](#L918) | $PopUp = 'false'; |
| [919](#L919) | } |
| [920](#L920) | // import data from gcstats |
| [921](#L921) | else if ($a\_type == 'gcstats'){ |
| [922](#L922) | $LayerName     = 'GeoCaches'; |
| [923](#L923) | $PopUp = 'true'; |
| [924](#L924) | $Icon = Osm\_icon::getIconsize(GCSTATS\_MARKER\_PNG); |
| [925](#L925) | $Icon["name"] = GCSTATS\_MARKER\_PNG; |
| [926](#L926) | } |
| [927](#L927) | // import data from ecf |
| [928](#L928) | else if ($a\_type == 'ecf'){ |
| [929](#L929) | $LayerName = 'Comments'; |
| [930](#L930) | $PopUp = 'true'; |
| [931](#L931) | $Icon = Osm\_icon::getIconsize(INDIV\_MARKER); |
| [932](#L932) | $Icon["name"] = INDIV\_MARKER; |
| [933](#L933) | } |
| [934](#L934) | // import data from ecf |
| [935](#L935) | else if ($a\_type == 'exif\_m'){ |
| [936](#L936) | $LayerName = 'Photos'; |
| [937](#L937) | $PopUp = 'true'; |
| [938](#L938) | } |
| [939](#L939) | else{ |
| [940](#L940) | Osm::traceText(DEBUG\_ERROR, "e\_import\_unknwon"); |
| [941](#L941) | } |
| [942](#L942) | $MarkerArray = Osm::createMarkerList($a\_type, $a\_UserName,'Empty', $a\_osm\_cat\_incl\_name,  $a\_osm\_cat\_excl\_name, $a\_post\_type, $a\_import\_osm\_custom\_tax\_incl\_name, $a\_custom\_taxonomy); |
| [943](#L943) | if ($a\_line\_color != 'none'){ |
| [944](#L944) | $line\_color = Osm::checkStyleColour($a\_line\_color); |
| [945](#L945) | $txt = Osm\_OpenLayers::addLines($MarkerArray, $line\_color, $a\_line\_width, $a\_MapName); |
| [946](#L946) | } |
| [947](#L947) | $txt .= Osm\_OpenLayers::addMarkerListLayer($a\_MapName, $Icon, $MarkerArray, $PopUp); |
| [948](#L948) | return $txt; |
| [949](#L949) | } |
| [950](#L950) |  |
| [951](#L951) | // check Lat and Long |
| [952](#L952) | public static function getMapCenter($a\_Lat, $a\_Long, $a\_import, $a\_import\_UserName){ |
| [953](#L953) | if ($a\_import == 'wpgmg'){ |
| [954](#L954) | $Lat  = OSM\_getCoordinateLat($a\_import); |
| [955](#L955) | $Lon = OSM\_getCoordinateLong($a\_import); |
| [956](#L956) | } |
| [957](#L957) | else if ($a\_import == 'gcstats'){ |
| [958](#L958) | if (function\_exists('gcStats\_\_getInterfaceVersion')) { |
| [959](#L959) | $Val = gcStats\_\_getMinMaxLat($a\_import\_UserName); |
| [960](#L960) | $Lat = ($Val["min"] + $Val["max"]) / 2; |
| [961](#L961) | $Val = gcStats\_\_getMinMaxLon($a\_import\_UserName); |
| [962](#L962) | $Lon = ($Val["min"] + $Val["max"]) / 2; |
| [963](#L963) | } |
| [964](#L964) | else{ |
| [965](#L965) | Osm::traceText(DEBUG\_WARNING, "getMapCenter() could not connect to gcStats plugin"); |
| [966](#L966) | $Lat  = 0;$Long = 0; |
| [967](#L967) | } |
| [968](#L968) | } |
| [969](#L969) | else if ($a\_Lat == '' || $a\_Long == ''){ |
| [970](#L970) | $Lat = OSM\_getCoordinateLat('osm'); |
| [971](#L971) | $Lon = OSM\_getCoordinateLong('osm'); |
| [972](#L972) | } |
| [973](#L973) | else { |
| [974](#L974) | $Lat = $a\_Lat; |
| [975](#L975) | $Lon = $a\_Long; |
| [976](#L976) | } |
| [977](#L977) | return array($Lat,$Lon); |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) |  |
| [981](#L981) | // check Lat and Long |
| [982](#L982) | public static function getCustomFieldData() |
| [983](#L983) | { |
| [984](#L984) | Osm::traceText(DEBUG\_INFO, "getCustomFieldData"); |
| [985](#L985) | //todo |
| [986](#L986) | return array($MarkerName, $FirstLat,$FirstLong); |
| [987](#L987) | } |
| [988](#L988) |  |
| [989](#L989) |  |
| [990](#L990) | // check Lat and Long |
| [991](#L991) | public static function checkLatLongRange($a\_CallingId, $a\_Lat, $a\_Long, $a\_traceError = "yes") |
| [992](#L992) | { |
| [993](#L993) | Osm::traceText(DEBUG\_INFO, "checkLatLongRange(".$a\_CallingId.",".$a\_Lat.",".$a\_Long.",".$a\_traceError.")"); |
| [994](#L994) | if ($a\_Lat >= LAT\_MIN && $a\_Lat <= LAT\_MAX && $a\_Long >= LON\_MIN && $a\_Long <= LON\_MAX && |
| [995](#L995) | preg\_match('!^[^0-9]+$!', $a\_Lat) != 1 && preg\_match('!^[^0-9]+$!', $a\_Long) != 1){ |
| [996](#L996) | // all is fine |
| [997](#L997) | } |
| [998](#L998) | else{ |
| [999](#L999) | if ($a\_traceError == "yes"){ |
| [1000](#L1000) | Osm::traceText(DEBUG\_ERROR, "e\_lat\_lon\_range"); |
| [1001](#L1001) | Osm::traceText(DEBUG\_INFO, "Error: ".$a\_CallingId." Lat".$a\_Lat." or Long".$a\_Long); |
| [1002](#L1002) | } |
| [1003](#L1003) | $a\_Lat  = 0; |
| [1004](#L1004) | $a\_Long = 0; |
| [1005](#L1005) | } |
| [1006](#L1006) | return array($a\_Lat,$a\_Long); |
| [1007](#L1007) | } |
| [1008](#L1008) |  |
| [1009](#L1009) | public static function getGPXName($filepath){ |
| [1010](#L1010) | $file = basename($filepath, ".gpx"); // $file is set to "index" |
| [1011](#L1011) | return $file; |
| [1012](#L1012) | } |
| [1013](#L1013) | // shortcode for map with OpenLayers 3 |
| [1014](#L1014) | public static function sc\_OL3JS($atts) { |
| [1015](#L1015) | static  $MapCounter = 0; |
| [1016](#L1016) | include('osm\_map\_v3/osm-sc-osm\_map\_v3.php'); |
| [1017](#L1017) | return $output; |
| [1018](#L1018) | } |
| [1019](#L1019) | // shortcode for map with OpenLayers 2 |
| [1020](#L1020) | public static function sc\_showMap($atts) { |
| [1021](#L1021) | static  $MapCounter = 0; |
| [1022](#L1022) | include('osm\_map/osm-sc-osm\_map.php'); |
| [1023](#L1023) | return $output; |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) | // shortcode for image OpenLayers 2 |
| [1027](#L1027) | function sc\_info($atts) { |
| [1028](#L1028) | include('osm-sc-info.php'); |
| [1029](#L1029) | return $output; |
| [1030](#L1030) | } |
| [1031](#L1031) |  |
| [1032](#L1032) |  |
| [1033](#L1033) | // add OSM-config page to Settings |
| [1034](#L1034) | function admin\_menu($not\_used){ |
| [1035](#L1035) | // place the info in the plugin settings page |
| [1036](#L1036) | add\_options\_page(\_\_('OpenStreetMap Manager', 'Osm'), \_\_('OSM', 'Osm'), 'manage\_options', basename(\_\_FILE\_\_), array('Osm', 'options\_page\_osm')); |
| [1037](#L1037) | } |
| [1038](#L1038) |  |
| [1039](#L1039) | }       // End class Osm |
| [1040](#L1040) |  |
| [1041](#L1041) | include('osm-widget.php'); |
| [1042](#L1042) |  |
| [1043](#L1043) |  |
| [1044](#L1044) | // register OSM\_Widget widget |
| [1045](#L1045) | function register\_osm\_widget() { |
| [1046](#L1046) | register\_widget( 'OSM\_Tagged\_Widget' ); |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) |  |
| [1050](#L1050) |  |
| [1051](#L1051) | $pOsm = new Osm(); |
| [1052](#L1052) |  |
| [1053](#L1053) | function OSM\_isGeotagged(){ |
| [1054](#L1054) | global $post; |
| [1055](#L1055) | $temp\_lat = 0; |
| [1056](#L1056) | $temp\_lon= 0; |
| [1057](#L1057) | //$Data = get\_post\_meta($post->ID, 'OSM\_geo\_data', true); |
| [1058](#L1058) | $CustomFieldName = get\_option('osm\_custom\_field','OSM\_geo\_data'); |
| [1059](#L1059) | $Data = get\_post\_meta($post->ID, $CustomFieldName, true); |
| [1060](#L1060) | if (!empty($Data)) { |
| [1061](#L1061) | $Data = preg\_replace('/\s\*,\s\*/', ',',$Data); |
| [1062](#L1062) | // get pairs of coordination |
| [1063](#L1063) | $GeoData\_Array = explode( ' ', $Data ); |
| [1064](#L1064) | list($temp\_lat, $temp\_lon) = explode(',', $GeoData\_Array[0]); |
| [1065](#L1065) | list($temp\_lat, $temp\_lon) = Osm::checkLatLongRange('Marker',$temp\_lat, $temp\_lon,'no'); |
| [1066](#L1066) | } |
| [1067](#L1067) | if (($temp\_lat != 0) || ($temp\_lon != 0)){ |
| [1068](#L1068) | return 1; |
| [1069](#L1069) | } |
| [1070](#L1070) | else { |
| [1071](#L1071) | return 0; |
| [1072](#L1072) | } |
| [1073](#L1073) | } |
| [1074](#L1074) |  |
| [1075](#L1075) |  |
| [1076](#L1076) | // This is meant to be the interface used |
| [1077](#L1077) | // in your WP-template |
| [1078](#L1078) |  |
| [1079](#L1079) | // returns Lat data of the first (!) coordination |
| [1080](#L1080) | function OSM\_getCoordinateLat($a\_import) |
| [1081](#L1081) | { |
| [1082](#L1082) | global $post; |
| [1083](#L1083) | $a\_import = strtolower($a\_import); |
| [1084](#L1084) | if ($a\_import == 'osm' || $a\_import == 'osm\_l'){ |
| [1085](#L1085) | $Data = get\_post\_meta($post->ID, get\_option('osm\_custom\_field','OSM\_geo\_data'), true); |
| [1086](#L1086) | // remove space before and after comma |
| [1087](#L1087) | $Data = preg\_replace('/\s\*,\s\*/', ',',$Data); |
| [1088](#L1088) | // get pairs of coordination |
| [1089](#L1089) | $GeoData\_Array = explode( ' ', $Data ); |
| [1090](#L1090) | list($lat, $lon) = explode(',', $GeoData\_Array[0]); |
| [1091](#L1091) | //list($lat, $lon) = explode(',', get\_post\_meta($post->ID, get\_option('osm\_custom\_field','OSM\_geo\_data'), true)); |
| [1092](#L1092) | } |
| [1093](#L1093) | else if ($a\_import == 'wpgmg'){ |
| [1094](#L1094) | $lat = get\_post\_meta($post->ID, WPGMG\_LAT, true); |
| [1095](#L1095) | } |
| [1096](#L1096) | else { |
| [1097](#L1097) | Osm::traceText(DEBUG\_ERROR, "e\_php\_getlat\_missing\_arg"); |
| [1098](#L1098) | $lat = 0; |
| [1099](#L1099) | } |
| [1100](#L1100) | if ($lat != '') { |
| [1101](#L1101) | return trim($lat); |
| [1102](#L1102) | } |
| [1103](#L1103) | return ''; |
| [1104](#L1104) | } |
| [1105](#L1105) |  |
| [1106](#L1106) | // returns Lon data |
| [1107](#L1107) | function OSM\_getCoordinateLong($a\_import) |
| [1108](#L1108) | { |
| [1109](#L1109) | global $post; |
| [1110](#L1110) |  |
| [1111](#L1111) | $a\_import = strtolower($a\_import); |
| [1112](#L1112) | if ($a\_import == 'osm' || $a\_import == 'osm\_l'){ |
| [1113](#L1113) | $Data = get\_post\_meta($post->ID, get\_option('osm\_custom\_field','OSM\_geo\_data'), true); |
| [1114](#L1114) | // remove space before and after comma |
| [1115](#L1115) | $Data = preg\_replace('/\s\*,\s\*/', ',',$Data); |
| [1116](#L1116) | // get pairs of coordination |
| [1117](#L1117) | $GeoData\_Array = explode( ' ', $Data ); |
| [1118](#L1118) | list($lat, $lon) = explode(',', $GeoData\_Array[0]); |
| [1119](#L1119) | //list($lat, $lon) = explode(',', get\_post\_meta($post->ID, get\_option('osm\_custom\_field','OSM\_geo\_data'), true)); |
| [1120](#L1120) | } |
| [1121](#L1121) | else if ($a\_import == 'wpgmg'){ |
| [1122](#L1122) | list($lon) = get\_post\_meta($post->ID,WPGMG\_LON, true); |
| [1123](#L1123) | } |
| [1124](#L1124) | else { |
| [1125](#L1125) | Osm::traceText(DEBUG\_ERROR, "e\_php\_getlon\_missing\_arg"); |
| [1126](#L1126) | $lon = 0; |
| [1127](#L1127) | } |
| [1128](#L1128) | if ($lon != '') { |
| [1129](#L1129) | return trim($lon); |
| [1130](#L1130) | } |
| [1131](#L1131) | return ''; |
| [1132](#L1132) | } |
| [1133](#L1133) |  |
| [1134](#L1134) | function OSM\_getOpenStreetMapUrl() { |
| [1135](#L1135) | $zoom\_level = get\_option('osm\_zoom\_level','7'); |
| [1136](#L1136) | $lat = $lat == ''? OSM\_getCoordinateLat('osm') : $lat; |
| [1137](#L1137) | $lon = $lon == ''? OSM\_getCoordinateLong('osm'): $lon; |
| [1138](#L1138) | return URL\_INDEX.URL\_LAT.$lat.URL\_LON.$lon.URL\_ZOOM\_01.$zoom\_level.URL\_ZOOM\_02; |
| [1139](#L1139) | } |
| [1140](#L1140) |  |
| [1141](#L1141) | function OSM\_echoOpenStreetMapUrl(){ |
| [1142](#L1142) | echo OSM\_getOpenStreetMapUrl() ; |
| [1143](#L1143) | } |
| [1144](#L1144) | // functions to display a map in your theme |
| [1145](#L1145) | // by using the custom fields |
| [1146](#L1146) | // default values should be set only at sc\_showMap() |
| [1147](#L1147) | function OSM\_displayOpenStreetMap($a\_widht, $a\_hight, $a\_zoom, $a\_type){ |
| [1148](#L1148) |  |
| [1149](#L1149) | $atts = array ('width'        => $a\_widht, |
| [1150](#L1150) | 'height'       => $a\_hight, |
| [1151](#L1151) | 'type'         => $a\_type, |
| [1152](#L1152) | 'zoom'         => $a\_zoom, |
| [1153](#L1153) | 'control'                  => 'off'); |
| [1154](#L1154) |  |
| [1155](#L1155) | if ((OSM\_getCoordinateLong("osm"))&&(OSM\_getCoordinateLat("osm"))) { |
| [1156](#L1156) | echo OSM::sc\_showMap($atts); |
| [1157](#L1157) | } |
| [1158](#L1158) | } |
| [1159](#L1159) |  |
| [1160](#L1160) | function OSM\_displayOpenStreetMapExt($a\_widht, $a\_hight, $a\_zoom, $a\_type, $a\_control, $a\_marker\_name, $a\_marker\_height, $a\_marker\_width, $a\_marker\_text, $a\_ov\_map, $a\_marker\_focus = 0, $a\_routing = 'No', $a\_theme = 'dark'){ |
| [1161](#L1161) |  |
| [1162](#L1162) | $atts = array ('width'          => $a\_widht, |
| [1163](#L1163) | 'height'         => $a\_hight, |
| [1164](#L1164) | 'type'           => $a\_type, |
| [1165](#L1165) | 'zoom'           => $a\_zoom, |
| [1166](#L1166) | 'ov\_map'         => $a\_ov\_map, |
| [1167](#L1167) | 'marker\_name'    => $a\_marker\_name, |
| [1168](#L1168) | 'marker\_height'  => $a\_marker\_height, |
| [1169](#L1169) | 'marker\_width'   => $a\_marker\_width, |
| [1170](#L1170) | 'marker'         => OSM\_getCoordinateLat("osm") . ',' . OSM\_getCoordinateLong("osm") . ',' . $a\_marker\_text, |
| [1171](#L1171) | 'control'        => $a\_control, |
| [1172](#L1172) | 'marker\_focus'   => $a\_marker\_focus, |
| [1173](#L1173) | 'theme'          => $a\_theme, |
| [1174](#L1174) | 'marker\_routing' => $a\_routing); |
| [1175](#L1175) |  |
| [1176](#L1176) | if ((OSM\_getCoordinateLong("osm"))&&(OSM\_getCoordinateLat("osm"))) { |
| [1177](#L1177) | echo OSM::sc\_showMap($atts); |
| [1178](#L1178) | } |
| [1179](#L1179) | } |
| [1180](#L1180) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/osm/trunk/osm.php?format=txt)
* [Original Format](/export/3220792/osm/trunk/osm.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wordpress.org_ecbed1db_20250111_173204.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

OSM – OpenStreetMap

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fosm&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fosm&locale=en_US)

Search plugins

![](https://ps.w.org/osm/assets/banner-772x250.png?rev=1305867)
![](https://ps.w.org/osm/assets/icon-256x256.png?rev=2087144)
# OSM – OpenStreetMap

By [MiKa](http://www.hyumika.com)

[Download](https://downloads.wordpress.org/plugin/osm.zip)

* [Details](https://wordpress.org/plugins/osm/#description)
* [Reviews](https://wordpress.org/plugins/osm/#reviews)
* [Installation](https://wordpress.org/plugins/osm/#installation)
* [Development](https://wordpress.org/plugins/osm/#developers)

[Support](https://wordpress.org/support/plugin/osm/)

## Description

Add a map with marker in less than 100 sec:

If you want to get detailed information about the OSM-plugin visit these pages:

* Homepage: [WP-OSM-Plugin](https://wp-osm-plugin.hyumika.com/ "OSM-plugin")
* Forum: [EN|DE](https://wp-osm-plugin.hyumika.com/survey/ "OSM-plugin feedback / feature request EN|DE")
* Twitter: [@WP\_OSM\_Plugin](https://twitter.com/wp_osm_plugin "@WP_OSM_Plugin")

Features of the OSM-plugin:

* OpenStreetMap, HOT, OpenSeaMap, OpenTopoMap, BaseMap (AT), Stamen in posts/pages
* Integration in post / page / widget
* HTML Popup Marker
* GPX and KML (incl. upload in Mediathek)
* Map with geo-tagged posts/pages as linked marker
* Map with autogenerated track by geo-tagged posts / pages
* html-meta tags for geo-tagged posts/pages
* uses OpenLayers Library
* SSL connection (https)

Languages – thanks to:

* English
* Deutsch
* Japanese [by Sykane]
* French [by Tounoki and Marc]
* Russian [by Вячеслав Стренадко/Vyacheslav Strenadko]
* Italian [by Andrea Giacomelli]
* Spanish [by Colegota]
* Romanian [by Sorin Pop]
* Swedish [by Olle Zettergren]
* [OpenLayers](http://openlayers.org): Open Source JavaScript, released under the 2-clause BSD

!! IMPORTANT !!

The WordPress Plugin Review Team required us to provide opt-in feature to display attribution since it is part of [WordPress Plugin Guidelines](https://developer.wordpress.org/plugins/wordpress-org/detailed-plugin-guidelines/#10-plugins-may-not-embed-external-links-or-credits-on-the-public-site-without-explicitly-asking-the-user%e2%80%99s-permission). So you have to enable the checkbox “Display attribution (credit) in the map.” at the WP OSM Plugin Shortcode generater or add the attribution manually to your map. Otherwise it may violate the map or data license, eg [OpenStreetMap](https://www.openstreetmap.org/copyright).

This plugin enables GPX and KML upload!

Licenses of the maps:

\* OpenStreetMap: [OpenStreetMap License](https://www.openstreetmap.org/copyright)

\* OpenTopoMap: [OpenTopoMap License](https://opentopomap.org/about)

\* Stamen Maps: [Stamen License](http://maps.stamen.com)

\* BaseMap: [BaseMap License](http://basemap.at)

\* Thunderforest (API key): [Thunderforest License](http://www.thunderforest.com/terms/)

\* Others: Depends on the map you are including – check it before including it!

## Installation

1. Upload OSM folder to the `/wp-content/plugins/` directory
2. Activate the plugin through the ‘Plugins’ menu in WordPress
3. Generate the OSM shortcode when you write your post / page

IMPORTANT:

Personal data (eg. gpx files) must not be stored in the plugins/osm folder but in the upload folder!

## FAQ

### Do I need any key or any registration to show maps in my blog

No!

### I do not see my gpx file / marker file in the map ?

The file has to be located at the same adress as your blog.

There must be not format tag (like href …) in the shortcode.

## Reviews

![](https://secure.gravatar.com/avatar/d1c12d8562434dc100c0918a0492417c94f75bb2dad1408a43c3528037e5f381?s=60&d=retro&r=g)
### [Great useful Plugin – active support and development](https://wordpress.org/support/topic/great-useful-plugin-active-support-and-development/)

[Sakudo](https://profiles.wordpress.org/sakudo/ "Posts by Sakudo")
October 13, 2024

Plugin is very useful and friendly support.

![](https://secure.gravatar.com/avatar/62a88abcfa5be9029b0941cd384ef3886fb230ebc87d1fa72a46028e0f517586?s=60&d=retro&r=g)
### [Das OSM-Plugin ⭐](https://wordpress.org/support/topic/das-osm-plugin-%E2%AD%90/)

[stephanknorr](https://profiles.wordpress.org/stephanknorr/ "Posts by stephanknorr")
October 4, 2024

Nicht nur schöne Karten mit Tracks und Waypoints, sondern auch geolokalisierte Posts sind im Handumdrehen erstellt.Für alle die viel unterwegs sind und davon auch berichten, ganz einfach ein supercooles Muss!

![](https://secure.gravatar.com/avatar/5a54283f0fce0a9c4e672a568b9e6cb4683dc525d81e7994742e8675dfceb039?s=60&d=retro&r=g)
### [Versatile & quick support](https://wordpress.org/support/topic/versatile-quick-support/)

[jean38](https://profiles.wordpress.org/jean38/ "Posts by jean38")
October 2, 2024

What the title says, we have been using the plugin for over a year, and had issues with recent updates. After raising the issue, it was acknowledged and addressed in a few hours.
Our maps all show fine again, it looks great.

![](https://secure.gravatar.com/avatar/d4b3bc8f6030ba5e7ef243e7e7bc4d6dd0196261b121281a7057b777c9b50793?s=60&d=retro&r=g)
### [simple to use, clean look, responsive support!](https://wordpress.org/support/topic/simple-to-use-clean-look-responsive-support/)

[alexishuxley](https://profiles.wordpress.org/alexishuxley/ "Posts by alexishuxley")
September 27, 2024

excellent plugin for showing waypoints, routes and tracks on OSM maps and fast support from the developers. Top marks!

![](https://secure.gravatar.com/avatar/eda93ee21874eddbf6d0be2a308b91ba39339135faf483a2f0014e98f1477385?s=60&d=retro&r=g)
### [Nice Plugin that also allows openseamap easily](https://wordpress.org/support/topic/nice-plugin-that-also-alles-openseamap-easily/)

[tired68](https://profiles.wordpress.org/tired68/ "Posts by tired68")
September 23, 2024

Mostly well working plugin. Some issues in Sep. 2024 after update were quickly solved after request

![](https://secure.gravatar.com/avatar/8a035987b26ba43485ccd61114b3db218c694317224225054cf00be8900c15d1?s=60&d=retro&r=g)
### [Nice Plugin! Nettes Plugin!](https://wordpress.org/support/topic/nice-plugin-nettes-plugin/)

[argonaut4416](https://profiles.wordpress.org/argonaut4416/ "Posts by argonaut4416")
December 30, 2023

Wir benutzen OSM, um koordinatenmarkierte Beiträge auf Übersichtskarten zu zeigen, und um automatisch generierte Koordinatenlisten sowohl als Einzelpunkte als auch als Routen darzustellen. Funktioniert perfekt!
We’re using OSM to show geotagged articles on overview maps and to show automatically generated koordinate lists as points or as routes on maps. Works perfectly!

[Read all 133 reviews](https://wordpress.org/support/plugin/osm/reviews/)
## Contributors & Developers

“OSM – OpenStreetMap” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/e96c4c7fde7ebaf2cfdfaecfb98aa522146f8c1bca6972d55e5bec419d69ed25?s=32&d=mm&r=g) [Mika](https://profiles.wordpress.org/mika/)

[Translate “OSM – OpenStreetMap” into your language.](https://translate.wordpress.org/projects/wp-plugins/osm)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/osm/), check out the [SVN repository](https://plugins.svn.wordpress.org/osm/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/osm/) by [RSS](https://plugins.trac.wordpress.org/log/osm/?limit=100&mode=stop_on_copy&format=rss).

## Changelog

[ChangeLog](https://wp-osm-plugin.hyumika.com/changelog/)

## Meta

* Version **6.1.6**
* Last updated **3 months ago**
* Active installations **10,000+**
* WordPress version **3.0 or higher**
* Tested up to **6.6.2**
* PHP version **5.3 or higher**
* Tags [GPX](https://wordpress.org/plugins/tags/gpx/)[kml](https://wordpress.org/plugins/tags/kml/)[map](https://wordpress.org/plugins/tags/map/)[openstreetmap](https://wordpress.org/plugins/tags/openstreetmap/)
* [Advanced View](https://wordpress.org/plugins/osm/advanced/)

## Ratings

4.6 out of 5 stars.

* [113 5-star reviews
  5 stars

  113](https://wordpress.org/support/plugin/osm/reviews/?filter=5)
* [7 4-star reviews
  4 stars

  7](https://wordpress.org/support/plugin/osm/reviews/?filter=4)
* [3 3-star reviews
  3 stars

  3](https://wordpress.org/support/plugin/osm/reviews/?filter=3)
* [3 2-star reviews
  2 stars

  3](https://wordpress.org/support/plugin/osm/reviews/?filter=2)
* [7 1-star reviews
  1 star

  7](https://wordpress.org/support/plugin/osm/reviews/?filter=1)

[Add my review](https://wordpress.org/support/plugin/osm/reviews/#new-post)

[See all reviews](https://wordpress.org/support/plugin/osm/reviews/)

## Contributors

* ![](https://secure.gravatar.com/avatar/e96c4c7fde7ebaf2cfdfaecfb98aa522146f8c1bca6972d55e5bec419d69ed25?s=32&d=mm&r=g) [Mika](https://profiles.wordpress.org/mika/)
## Support

Issues resolved in last two months:

0 out of 1

[View support forum](https://wordpress.org/support/plugin/osm/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from wp-osm-plugin.hyumika.com_dd06ef5e_20250111_173205.html ===

[↓ Skip to Main Content](#primary)

Secondary Navigation

Main Navigation

Menu

* [Home](https://wp-osm-plugin.hyumika.com)* [Blog](https://wp-osm-plugin.hyumika.com/Blog/)* [Documentation](http://-)

      + [Map with marker](https://wp-osm-plugin.hyumika.com/map-with-one-html-popup-marker-in-wordpress/)+ [Geotags](https://wp-osm-plugin.hyumika.com/geotag-posts-and-display-map-with-geotags-in-wordpress/)+ [GPX | KML](https://wp-osm-plugin.hyumika.com/map-with-gpx-or-kml-in-wordpress/)+ [Custom marker and mousewheelzoom](https://wp-osm-plugin.hyumika.com/custom-icon-for-marker-and-mousewheelzoom-with-wordpress-openstreetmap-plugin/)+ [Youtube Channel](https://www.youtube.com/channel/UClbaig8Q4cqHgdO9DEKVDRg)* Maptypes

        + [OpenStreetMap](https://wp-osm-plugin.hyumika.com/openstreetmap-in-wordpress/)+ [OpenTopo](https://wp-osm-plugin.hyumika.com/opentopo-map-in-wordpress/)+ [HOTmap](https://wp-osm-plugin.hyumika.com/hotmap-in-wordpress/)+ [OpenSeaMap](https://wp-osm-plugin.hyumika.com/openseamap-in-wordpress/)+ [Stamen](https://wp-osm-plugin.hyumika.com/stamen-maps-in-wordpress/)+ [basemap.at](https://wp-osm-plugin.hyumika.com/basemap-at/)+ [Thunderforest](https://wp-osm-plugin.hyumika.com/thunderforest-in-wordpress/)* Articles

          + [Multiple markers](https://wp-osm-plugin.hyumika.com/multiple-markers-with-openstreetmap-in-wordpress/)+ [XSLT + GPSBabel](https://wp-osm-plugin.hyumika.com/datareduction-of-gpx-files-with-xslt-and-gpsbabel/)+ [kml file with Viking](https://wp-osm-plugin.hyumika.com/create-a-kml-file-with-viking/)* [Contact](http://-)

            + [Mail](https://wp-osm-plugin.hyumika.com/contact/)+ [Survey](https://wp-osm-plugin.hyumika.com/survey/)* [Others](http://-)

              + [Changelog](https://wp-osm-plugin.hyumika.com/changelog/)+ [Known Limitations](https://wp-osm-plugin.hyumika.com/known-limitations/)+ [Collaboration](https://wp-osm-plugin.hyumika.com/collaboration/)+ [map icons](https://wp-osm-plugin.hyumika.com/collection-of-map-icons-under-free-cc0-license/)+ [WP OSM Plugin Forum Test page](https://wp-osm-plugin.hyumika.com/wp-osm-plugin-forum-test-page/)+ [Deprecated](https://-)

                          - [Simple Map](https://wp-osm-plugin.hyumika.com/deprecated-ol-2-part-2/)- [Map with marker](https://wp-osm-plugin.hyumika.com/deprecated-openlayers-2-part-3/)- [KML file](https://wp-osm-plugin.hyumika.com/deprecated-ol-2-part-2-2/)- [Map with circles](https://wp-osm-plugin.hyumika.com/deprecated-openlayers-2-part-4/)- [Markerfile](https://wp-osm-plugin.hyumika.com/deprecated-openlayers-2-part-5/)- [Geotag](https://wp-osm-plugin.hyumika.com/deprecated-openlayers-2-part-6/)

# changelog

# changelog

**= WP OSM Plugin V 6.1.3 (Oct 4th 2024) = RELEASED**

* **FIX**: XSS issue.

**= WP OSM Plugin V 6.0.14 (Sept 22th 2024) = RELEASED**

* ****FIX****: Display post/page with geotag filter

**= WP OSM Plugin V 6.0.13 (Sept 21th 2024) = RELEASED**

* ****FIX****: [CVE-2024-3604](https://www.cve.org/CVERecord?id=CVE-2024-3604)
* ****FIX****: [CVE-2024-3603](https://www.cve.org/CVERecord?id=CVE-2024-3603)

**= WP OSM Plugin V 6.0.6 (Sept 20th 2024) = RELEASED**

* ****FIX****: [Security patch (CVE-2022-4676](https://www.cve.org/CVERecord?id=CVE-2022-4676)[)](https://www.cve.org/CVERecord?id=CVE-2022-4676)

**= WP OSM Plugin V 6.0.2 (Nov 1st 2023) = RELEASED**

* ****FIX****: Replaced stamen tiles with OSM tiles
* ****NEW****: OpenLayers 8.1.0

**= WP OSM Plugin V 6.0.1 (Oct 15th 2022) = RELEASED**

* ****FIX****: Security Fix
* ****NEW****: OpenLayers 7.0.1

**= WP OSM Plugin V 6.0 (Jun 11th 2022) = RELEASED**

* ****FIX****: jQuery.fn.load() is deprecated

**= WP OSM Plugin V 5.9.3 (Nov 27th 2021) = RELEASED**

* ****FIX****: Javascript but if site used optimizer

**= WP OSM Plugin V 5.9.2 (Nov 26th 2021) = RELEASED**

* ****FIX****: Background Image not loaded per default

**= WP OSM Plugin V 5.9.1 (Nov 26th 2021) = RELEASED**

* ****FIX****: Load JS with version
* ****FIX****: add Settings Link at plugin page
* ****FIX****: some internal changes

**= WP OSM Plugin V 5.9 (Nov 19th 2021) = RELEASED**

* ****NEW****: OpenLayers 6.9
* ****NEW****: Cluster for one single KML file and standard marker
* ****NEW****: Overviewmap
* ****NEW****: some internal changes

**= WP OSM Plugin V 5.8.1 (Sept 14th 2021) = RELEASED**

* ****NEW****: OpenLayers 6.7
* ****NEW****: Tested with WP 5.8.1

**= WP OSM Plugin V 5.8 (March 28th 2021) = RELEASED**

* ****NEW****: custom post type for geotags
* ****FIX**:** some fixes at css for map div
* ****NEW****: OpenLayers 6.5
* ****NEW****: MarkerSample.kml added

**= WP OSM Plugin V 5.7 (December 28th 2020) = RELEASED**

* ****NEW****: generator shortcode for geotag marker of local post/page
* ****FIX**:** shortcode generator brakes when edit post/page at Gutenberg
* ****FIX****: map did not show at first tab in shortcode generator at Gutenberg
* ****FIX****: \*.map files are not delivered (8 MB => 3,5MB)

**= WP OSM Plugin V 5.6 (December 9th 2020) = RELEASED**

* ****FIX**:** multiple maps with KML / GPX on one post/page
* ****NEW****: UX optimization at the backend
* ****NEW****: suppport WordPress V5.6
* ******NEW******: performance optimization

**= WP OSM Plugin V 5.5.1 (November 20th 2020) = RELEASED**

* ****FIX**:** Display multiple GPX files
* ******NEW******: Opt In for attribution
* ****FIX****: security issue (sanitization)

**= WP OSM Plugin V 5.5 (August 30th 2020) = RELEASED**

* **NEW**: OpenLayers V6.4.3
* **NEW**: swedish tranlsation
* **FIX**: Update russian translation
* **FIX**: HOT map

**= WP OSM Plugin V 5.4.4 (June 22nd 2020) = RLEASED**

* **NEW**: autozoom can be replaced with max zoom for KML and GPX files
* **FIX**: php 7.1 compatible \* $this” can no longer be used in a plain function or method since PHP 7.1.

**= WP OSM Plugin V 5.4.3 (May 11th 2020) = RELEASED**

* **NEW**: autocenter and autozoom for KML and GPX files
* **NEW**: option to add GDPR image.

**= WP OSM Plugin V 5.4.2 (May 5th 2020) = RELEASED**

* **NEW**: If a map with marker is created, the zoom is taken when [save] button is pressed, not when the marker is set.
* **NEW**: OpenTopoMap
* **NEW**: Soccer icon
* **NEW**: Show image if map is not loaded [GDPR]
* **NEW**: Support Custom PostTypes for maps with geotagged markers (shortcode has to be modified manually).

**= WP OSM Plugin V 5.4.1 (April 25th 2020) = RELEASED**

* **FIX**: conflict with Robbo Gallery
* **FIX**: conflict with Sucuri
* **FIX**: Delete old OL folders

**= WP OSM Plugin V 5.4 (April 14th 2020) = RELEASED**

* **NEW**: OpenLayers 6.3.1
* **NEW**: Tested with 5.4
* **FIX**: Take cdn.polyfill.io (MIT license) as local script
* **FIX**: basemap.at without highres

**= WP OSM Plugin V 5.3.6 (Jan 11th 2020) = RELEASED**

* **FIX**: z-index for gpx

**= WP OSM Plugin V 5.3.5 (Dec 19th 2019) = RELEASED**

* **FIX**: z-index for gpx and kml and marker

**= WP OSM Plugin V 5.3.4 (Dec 1st 2019) = RELEASED**

* **FIX**: blank map
* **FIX**: OpenSeaMap

**= WP OSM Plugin V 5.3.2 (Dec 1st 2019) = RELEASED**

* **NEW**: OpenLayers 6.1.1
* **FIX**: corrected address for ol.css

**= WP OSM Plugin V 5.3.1 (Nov 18th 2019) = RELEASED**

* **NEW**: OpenLayers 6.1
* **FIX**: WP 5.3 support Clickeventhandler to generate shortcode

**= WP OSM Plugin V 5.2.2 (July 27th 2019) = RELEASED**

* **Fix:** Fatal error line 249 osm.php
* **Fix:** SSL for osm\_map shortcode

**= WP OSM Plugin V 5.2.1 (May 12th 2019) = RELEASED**

* **NEW**: All icons are available at SetGeotag
* **NEW**: CreateMarker and Map&Marker is combined (simplicity)
* **FIX**: Load osm\_map.css error

**= WP OSM Plugin V 5.1.4 (April 14th 2019) = RELEASED**

* **Fix:** KML selector box

**= WP OSM Plugin V 5.1.1 (March 13th 2019) = RELEASED**

* **Fix**: Undefined variable: OL3\_LIBS\_LOADED
* **Fix**: Custom Post Type

**= WP OSM Plugin V 5.0.2 (Feb 22nd 2019) = RELEASED**

* PHP Warning because of non static function … traceErrorMsg

**= WP OSM Plugin V 5.0.1 (Feb 17th 2019) = RELEASED**

* **NEW:** New Icons
* **NEW:** Gutenberg compatible
* **NEW:** OpenLayers 5.3.0
* **NEW**: Stamen terrain
* **Fix:** “hot” in map selector
* **NEW**: Rumania language
* **Fix:** Nachkommastellen
* **Fix**: Warning at OL2

**= WP OSM Plugin V 4.1.2 (Sep 29th 2018) = RELEASED**

* **NEW:** Humanitarian OSM map (type=”hot”)
* **FIX**: Thunderforest maps were not shown
* **FIX**: check for post ID in osm.php

**= WP OSM Plugin V 4.1 (Feb 17th 2018) =**

* **NEW:** Add default values for maps in settings (thanks to alm06130 )
* **FIX**: Unable to select different tabs at shortcode generator
* **FIX**: Forumlink at settings

**= WP OSM Plugin V 4.0.2 (Dec 17th 2017) =**

* **FIX:** Add “globe” button [E] at shortcode generatetor
* **FIX**: Use of deprecated PHP4 style class constructor is not supported since PHP 7.
* **FIX**: add\_options\_page has to be static
* **NEW**: show icon at [Create Marker]

**= WP OSM Plugin V 4.0.1 (Nov 28th 2017) =**

* **FIX:** “Notice: Undefined offset: 1” if gpx file list color is not set
* **FIX**: “Strict Standards: Non-static method Osm::sc\_OL3JS() should not be called statically”

**= WP OSM Plugin V 4.0 (Nov 26th 2017) =**

* **NEW:** Selectionbox under map
* **NEW:** OpenLayers 4.5
* **NEW:** Backend with OpenLayers 4.5

**= WP OSM Plugin V 3.9.4 (May 12th 2017) =**

* **FIX:** empty map if geotag of posts were shown
* **FIX:** caravan icon was wrong

**= WP OSM Plugin V 3.9.3 (April 28th 2017) =**

* **FIX:** Parse error: syntax error, unexpected ‘[‘ in

**= WP OSM Plugin V 3.9.2 (April 23th 2017) =**

* **FIX:** shortcode generator for KML and GPX did not work
* **FIX:** Strict Standards: Non-static method Osm::getPostMarkerCFN() fixed

**= WP OSM Plugin V 3.9.1 (April 9th 2017) =**

* **FIX:** Warning at kml and gpx in debug mode
* **Note**: The text “*if you want to setup a control via text link, set setup\_map\_name in shortcode of map to control*” is only visible when you are logged in.

**= WP OSM Plugin V 3.9 (April 9th 2017) =**

* **NEW:** API key support for thunderforest maps
* **NEW:** most tiles are loaded via https instead of http
* **NEW:** OpenLayers 4.0.1 and polyfill to cover also old browsers
* **NEW:** enlarged map at shortcode generator
* **NEW:** plugin size less 1MB
* **FIX:** change text-domain to “osm”

**= WP OSM Plugin V 3.8 (Jan. 8th 2017) =**

* **NEW:** add nine markers to a post/page
* **NEW:** change cursor on hover over marker
* **FIX:** basemap.at did not show

**= WP OSM Plugin V 3.7 (Feb. 19th 2017) =**

* **NEW:** Combine / cluster feature for maps with geotag.
* **NEW:** OpenLayers V3.13.1
* **FIX:** map\_border at KML tag generator
* **FIX:** changed order in mouseposition
* **FIX:** improve error messages with more details
* **FIX:** marker\_size at osm\_map\_v3 did not work since 3.6.2

**= WP OSM Plugin V 3.6.2 (Jan. 20th 2017) =**

* **NEW:** Spanish translation
* **NEW:** controls at kml / gps shortcode generator
* **FIX:** widget has got 99% instead of 100% width
* **FIX:** osm\_map => osm\_map\_v3 converter for geotags

**= WP OSM Plugin V 3.6.1 (Jan. 9th 20th 2017) =**

* **NEW:** OpenLayers 3.12.1
* **NEW:** WP OSM Studio: shortcode generator & geotagger in one metabox
* **NEW:** iconview in WP OSM Studio
* **NEW:** marker in osm\_map\_v3 with html-text
* **NEW:** mouseposition and scaleline in osm\_map\_v3
* **FIX:** Support of PHP 7.0

**= 3.5.5 =**

**\* NEW:** osm\_map\_v3: map types “pioneer” and “brezhoneg” are supported
**\* FIX:** osm\_map: google maps are replaced with osm maps
**\* FIX:** osm\_map: routing link at marker text is fixed

**= 3.5.4 =**
**\* NEW:** zoom with mousewheel can be enabled with mwz=”true”
**\* NEW:** custom marker size can be set with marker\_size=”height,width, focus”
**\* FIX:** map with geotags with PHP version 5.5 and higher

**= 3.5.3 =**
**\* NEW:** added category filter for osm\_map\_v3

**= 3.5.2 =**
**\* NEW:** Added OpenCycleMap, Outdoor, Landscape, Spinal Map **= 3.5.1 =**
**\* NEW:** Performance improvements for geotagged posts (osm\_map\_v3)
**\* FIX:** Attribution according to OpenStreetMap

**= 3.4.1 =**
**\* FIX:** description @ kml file were missing

**= 3.4 =**
**\* FIX:** Marker anchor moved when zooming
**\* FIX:** French translation by Marc – thanks!
**\* NEW:** OpenLayers 3.10.1
**\* NEW:** Disable mousewheelzoom
**\* FIX:** undefined at marker
**\* NEW:** fullscreen button

**= 3.3.2 =**
**\* NEW:** Show description in KML file for osm\_map\_v3 shortcode

**= 3.3.1 =**
**\* FIX:** wrong icons at osm\_map\_v3 shortcode

**= 3.3 =**
**\* NEW:** update to OpenLayers 3.5
**\* NEW:** support KML files with osm\_map\_v3 shortcode
**\* NEW:** Change default lon & lat for geotagger & shortcode generator
**\* NEW:** Define to disable -404 Forbidden You don’t have permission to access- error

**= 3.2.1 =**
**\* FIX:** basemap.at

**= 3.2 =**
**\* NEW:** Add list of GPX files with waypoints using OpenLayers 3

**= 3.1.1 =**
**\* NEW:** Marker in Map with OpenLayers 3 library
**\* FIX:** Security update
**\* FIX:** Replace routing ORS by OSRM

**= 3.1 =**
**\* NEW:** replaced CC-By map icon collectin with CC0 map icons
**\* NEW:** widget for geotagged posts / pages with OpenLayers 3
**\* NEW:** gpx\_file\_list to show multiple gpx files in one map

**= 3.0 =**
**\* NEW:** Included OpenLayers 3
**\* NEW:** New UI at add post / add page in metabox

**= 2.9.4 =**
**\* NEW:** directly set geotag at edit post
**\* NEW:** icon added
**\* NEW:** italian translation
**\* FIX:** map image style

**= 2.9.3 =**
**\* NEW:** icons added
**\* NEW:** icon preview at shortcode generator when you set a marker

**= 2.9.2 =**
**\* FIX:** icon size for geotagged post / pages
**\* FIX:** generate map type at shortcodegenerator
**\* NEW:** add customfield for icon at shortcodegenerator
**\* NEW:** some new icons \* CHANGE: generate width in percentage instead of pixels

**= 2.9.1 =**
**\* FIX:** OpenWeatherMap
**\* NEW:** individual icons in map with all geotagged posts / pages

**= 2.9 =  **Dec 2014****
**\* FIX:** Pink tiles at OpenSeaMap
**\* NEW:** OpenLayers 3.0 preperations

**= 2.8.2 = Oct 6th 2014 (WP 2.5.1 – WP 3.9)**
**\* NEW:** tested with WordPress 4.0
**\* NEW:** Support of old geotags

**= 2.8.1 = **July 2014****
**\* NEW:** add excerpt (read more text) to popup of geotagged post
**\* NEW:** Add OSRM routing service
**\* FIX:** do not show widget at blogarchive
**\* FIX:** plugin directory
**\* FIX:** google max zoom level

**= 2.8 = May 10th 2014 (WP 2.5.1 – WP 3.9)**
**\* NEW:** OSM Widget for geotagged posts / pages
**\* NEW:** set width and height relative (perc.)
**\* NEW:** new icons added
**\* FIX:** Invalid argument supplied for foreach()

**= 2.7.1 = April 21st 2014 (WP 2.5.1 – WP 3.9)**
**\* NEW:** Add marker argument OSM\_geo
**\* NEW:** Add customfield OSM\_geo\_icon
**\* NEW:** Russian translation
**\* FIX:** Internal: use content\_url() function instead WP\_CONTENT\_URL

**= 2.7 = March 30th 2014 (WP 2.5.1 – WP 3.8.2)**
**\* FIX:** z-index argument was not considered
**\* NEW:** Map Icons Collection is included
**\* NEW:** Shortcode to add photos of the post/page vie EXIF meta data

**= 2.6.2 = March 1st 2014 (WP 2.5.1 – WP 3.8.1)**
**\* FIX:** Shortcode generator used GoogleStreet instead of Mapnik
**\* FIX:** OSM Plugin was linked twice at OpenWeather and OpenSeaMap
**\* FIX:** All is replaced by AllOsm automatically
**\* NEW:** Shortcode argument long is replaced by lon (backwards compatible)

**= 2.6 = Feb 25th 2014 (WP 2.5.1 – WP 3.8.1)**
**\* NEW:** Multiple geotags for one post/page
**\* NEW:** Update to OpenLayers 2.13
**\* NEW:** Update to Google API V3
**\* NEW:** Shortcode for OpenLayers 3 Beta-tests
**\* FIX:** Delete options at uninstall
**\* FIX:** Circle radius corrected
**\* FIX:** Scaleline correct

**= 2.5.3 = Feb 1st 2014 (WP 2.5.1 – WP 3.8.1)**
**\* FIX:** google maps with space in the argument do not work

**= 2.5.2 = Jan 31th 2014 (WP 2.5.1 – WP 3.8.1)**
**\* FIX:** Notice: Undefined offset

**= 2.5.1 = Jan 31th 2014 (WP 2.5.1 – WP 3.8.1)**
**\* FIX:** Fix for FF (pink tiles)

**= 2.5 = Jan 18th 2014 (WP 2.5.1 – WP 3.8.1)**
**\* NEW:** SSL support
**\* NEW:** GUI improvements
**\* NEW:** basemap tiles (Austrian gov)
**\* NEW:** stamen tiles (watercolor and toner)
**\* NEW:** Russian translations
**\* FIX:** pink tiles at some FF versions

**= 2.4.1 = Jan 4th 2013 (WP 2.5.1 – WP 3.8)**
**\* FIX:** New Server for OpenSeaMap
**\* NEW:** load OpenLayers locally (preperatin for SSL in backend)

**= 2.4 = Nov 23th 2013 (WP 2.5.1 – WP 3.7)**
**\* NEW:** OpenWeatherMap integration
**\* NEW:** geotag custom field name predefined to OSM\_geo\_data
**\* NEW:** Default value for php function zoomlevel **= 2.3 =**
**\* NEW:** php call supports theme for map integration
**\* NEW:** marker\_focus (5) added for map collection added
**\* NEW:** New arguments to filter: post\_type, custom\_taxonomy, import\_osm\_custom\_tax\_incl\_name
**\* NEW:** add several txt files in one map: marker\_file\_list

**= 2.2 =**
**\* FIX:** style rules are limited for OSM images
**\* FIX:** html comment is set if post / page is geotagged

**= 2.1 =**
**\* NEW:** ShortCode Generator also at pages
**\* FIX:** Pink Stripes at adaptive WP theme
**\* FIX:** Center of the map is not influenced by marker anymore

**= 2.0 = May 29th 2013 (WP 2.5.1 – WP 3.5.1)**
**\* NEW:** ShortCode Generator at edit posts
**\* NEW:** High precision to set a marker at the backend
**\* NEW:** Display circles / discs in your map
**\* NEW:** Upload and display KML files (Popup Points)
**\* NEW:** Draw line between geotagged posts automatically
**\* NEW:** OpenLayers 2.12
**\* NEW:** French translation
**\* NEW:** Predefined OSM themes for control and map border

**= 1.3 = Feb 9th 2013 (WP 2.5.1 – WP 3.5.1)**
**\* NEW:** Support of OpenSeaMap

**= 1.2.3 = Jun 30th 2012 (WP 2.5.1 – WP 3.5.1)**
**\* FIX:** Link OpenLayers 2.11 as GML layer is not supported anymore

**= 1.2.2 =**
**\* FIX:** Shortcode generator did not show anything since Osmarender service is not supported anymore.

**= 1.2.1 =**
**\* FIX:** Warning: explode() expects parameter 2 … on line 276 **= 1.2 =**
**\* FIX:** Warning: explode() expects parameter 2 … on line 272
**\* NEW:** use private theme for cntrols in /wp-content/uploads/osm/theme/
**\* NEW:** language: Japan

**= 1.1.1 = Fev 24th 2012 (WP 2.5.1 – WP 3.5.1)**
**\* NEW:** extended rights to upload GPX files in Mediathek
**\* NEW:** CSS file
**\* FIX:** WP-Theme zBench fix
**\* FIX:** HTML tag if post is geotagged
**\* FIX:** z-index at shortcode generator

**= 1.1 =** **\* NEW:** add the text for popup marker directly in the shortcode generator (settings => OSM) **\* NEW:** add a link to a routing service (settings => OSM) **\* NEW:** set the z-index if needed (eg. for Next Gen Gallery) **\* NEW:** choose a theme for the control icons **\* NEW:** add the mouse position directly in the shortcode generator (settins => OSM) **\* NEW:** plugin size less than 100kB

**= 1.0 = Nov 3rd 2011 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** Internationalization (languages: EN, DE) **\* FIX:** HTML code for geotagged posts **\* FIX:** WP-Theme Twenty Eleven

**= 0.9.6 = May 7th 2011 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** shortcode generator at Settings=>OSM extented **\* NEW:** marker filename is used for the map picker **\* FIX:** Warning: split() expects parameter 2 .. on line 211 **\* FIX:** car icon size corrected

**=** **0.9.5 = March 10th 2011 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** mark all geotagged posts can be filtered by category **\* NEW:** map\_border tag added to set border around the OSM map **\* NEW:** marker\_focus tag added to adjust the marker **\* NEW:** gpx filename is used for the map picker **\* FIX:** style correction for some WP-themes (eg Suffusion)

**= 0.9.4 = Oct 28th 2010 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** LIBS of diff. map types are loaded only when needed **\* NEW:** Shortcodegenerator at backend extented to get the chosen maptype **\* FIX:** Customfield marker error at IE

**= 0.9.3 = Sept 19th 2010 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** added Google Maps: Sattelite, Street, Hybrid, Physical

**= 0.9.2 = June 27th 2010 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** added osm\_l tag for map with linked marker to tagged posts. **\* FIX:** correct offset for pin-icons and non-osm-icons **\* FIX:** style correction for some WP-themes

**= 0.9.1 = May 24th 2010 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** popup marker with link for the map displaying all posts/pages of the blog **\* FIX:** licenselink is not displayed if an external map is loaded **\* FIX:** some WP-thems showed grids/lines in the map **\* FIX:** bug if several maps were shown at the same time

**= 0.9 = March 29th 2010 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** display several gpx files with diff. colours in one map **\* NEW:** template tags to be used in your theme to show maps at geotagged posts **\* NEW:** extend zoom level for mapnik to 18

**= 0.8.7 = Dec 24th 2009 (WP 2.5.1 – WP 3.5.1)** **\* FIX:** HTML-PopUp-Marker without Customfield-Text produced ‘Array’ (WP 2.9) **\* FIX:** size of bicycle icon

**= 0.8.6 =Dec 7th 2009 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** performance improvement: needed libraries are loaded only if maps are displayed – improves the whole blog! **\* NEW:** external maps can be included instead of standard OSM-maps **\* NEW:** controls (scale, scaleline, mouseposition) can be included by tag

**= 0.8.5 = May 29th 2009 (WP 2.5.1 – WP 3.5.1)** **\* NEW:** HTML marker for PopUps **= 0.8.4 =** **\* FIX:** plugin folder changed **\* FIX:** some internal stuff

**= 0.8.3 =** **\* FIX:** correct offset for indiv. marker

**= 0.8.1 =** **\* FIX:** check whether gcstats is activated or not **= 0.8.0 =** **\* NEW:** separate file for option and import; gcstats support; add marker in option page

**= 0.7.0 =** **\* NEW:** shortcode generator in option page added **= 0.6.0 =** **\* NEW:** options got prefix “osm\_”, therefore settings have to be made again at upgrade

**= 0.5.0 =** **\* NEW:**added type at shortcode (Mapnik, Osmarender, CycleMap, All) ; overviewmap in shortcode

**= 0.4.0 =** **\* NEW:** added KML support and colour interface for tracks

**= 0.3.0 =** **\* NEW:** added “marker\_all\_posts” at shortcode to set a marker for all posts

**= 0.2.0 =** **\* NEW:** loading GPX files with shortcode NEXT VERSION

```
Plugin-Vers    Released        WP-Version
V2.8.2        06.10.2014     2.8   - 4.0.1
V2.8.1                       2.8   - 4.0
V2.8          10.05.2014     2.8   - 3.9.1
V2.7.1        21.04.2014     2.8   - 3.9
V2.7          30.03.2014     2.8   - 3.8.2
V2.6.2        01.03.2014     2.8   - 3.8.1
V2.6          25.02.2014     2.8   - 3.8.1
V2.5.3        01.02.2014     2.8   - 3.8.1
V2.5.2        31.01.2014     2.8   - 3.8.1
V2.5.1        31.01.2014     2.8   - 3.8.1
V2.5          18.01.2014     2.8   - 3.8.1
V2.4.1        04.01.2014     2.8   - 3.8
V2.4          23.11.2013     2.8   - 3.7
V2.3                         2.8   - 3.5.1
V2.2                         2.8   - 3.5.1
V2.1                         2.8   - 3.5.1
V2.0          29.05.2013     2.8   - 3.5.1
V1.3          09.02.2013     2.5.1 - 3.5.1
V1.2.3        30.06.2012     2.5.1 - 3.5.1
V1.1.1        24.02.2012     2.5.1 - 3.5.1
V1.0.0        03.11.2011     2.5.1 - 3.5.1
V0.9.6        07.05.2011     2.5.1 - 3.5.1
V0.9.5        10.03.2011     2.5.1 - 3.5.1
V0.9.4        28.10.2010     2.5.1 - 3.5.1
V0.9.3        19.09.2010     2.5.1 - 3.5.1
V0.9.2        27.06.2010     2.5.1 - 3.5.1
V0.9.1        24.05.2010     2.5.1 - 3.5.1
V0.9.0        29.03.2010     2.5.1 - 3.5.1
V0.8.7        24.12.2009     2.5.1 - 3.5.1
V0.8.6        07.12.2009     2.5.1 - 3.5.1
V0.8.5        29.05.2009     2.5.1 - 3.5.1
```

Open:

* OSM copyright wit .articles .post-body ul { padding: 20px } (Bodo Gr.)
* Support subcategories
* Set Geotag in Asia (coordinates)?
* **NEW**: Cluster with color for KML ([OL6.1](https://openlayers.org/en/latest/examples/earthquake-clusters.html))
* show licenses in readme.txt
* px / kml mit fileselectbox
* max und min zoom level

Search for:

#### Recent Posts

* [blumax GPS Logger in Ubuntu Linux als GPX Datei auslesen und komprimieren](https://wp-osm-plugin.hyumika.com/blumax-gps-logger-in-ubuntu-linux-als-gpx-datei-auslesen-und-komprimieren/)
* [EXIF to KML with Geotag for OpenStreetMap in WordPress](https://wp-osm-plugin.hyumika.com/exif-to-kml-with-geotag-for-openstreetmap-in-wordpress/)
* [OpenStreetMap Landkarten in hoher Auflösung als PNG Datei runterladen](https://wp-osm-plugin.hyumika.com/openstreetmap-landkarten-in-hoher-auflosung-als-png-datei-runterladen/)
* [Garmin Forerunner 305 in Linux Ubuntu 20.10](https://wp-osm-plugin.hyumika.com/garmin-forerunner-305-in-linux-ubuntu-20-10/)
* [OSM Plugin V5.7 shows map with geotag](https://wp-osm-plugin.hyumika.com/osm-plugin-v5-7-shows-map-with-geotag/)
#### Recent Comments

* Julia on [OpenStreetMap Landkarten in hoher Auflösung als PNG Datei runterladen](https://wp-osm-plugin.hyumika.com/openstreetmap-landkarten-in-hoher-auflosung-als-png-datei-runterladen/#comment-13)
* Benjamin on [OpenStreetMap Landkarten in hoher Auflösung als PNG Datei runterladen](https://wp-osm-plugin.hyumika.com/openstreetmap-landkarten-in-hoher-auflosung-als-png-datei-runterladen/#comment-12)
* Lutz Hauptmann on [WordPress Reisebericht mit OpenStreetMap Landkarten und OSM PLugin](https://wp-osm-plugin.hyumika.com/wordpress-reisebericht-mit-openstreetmap-landkarten-und-osm-plugin/#comment-7)
* [Stephan Fennel](http://aktuell%20in%20Arbeit) on [WordPress Reisebericht mit OpenStreetMap Landkarten und OSM PLugin](https://wp-osm-plugin.hyumika.com/wordpress-reisebericht-mit-openstreetmap-landkarten-und-osm-plugin/#comment-6)
* [admin](https://hyumika.com) on [WordPress Reisebericht mit OpenStreetMap Landkarten und OSM PLugin](https://wp-osm-plugin.hyumika.com/wordpress-reisebericht-mit-openstreetmap-landkarten-und-osm-plugin/#comment-5)
#### Archives

* [May 2021](https://wp-osm-plugin.hyumika.com/2021/05/)
* [March 2021](https://wp-osm-plugin.hyumika.com/2021/03/)
* [January 2021](https://wp-osm-plugin.hyumika.com/2021/01/)
* [December 2020](https://wp-osm-plugin.hyumika.com/2020/12/)
* [May 2020](https://wp-osm-plugin.hyumika.com/2020/05/)
* [May 2019](https://wp-osm-plugin.hyumika.com/2019/05/)
* [November 2017](https://wp-osm-plugin.hyumika.com/2017/11/)
* [May 2014](https://wp-osm-plugin.hyumika.com/2014/05/)
#### Categories

* [announcement](https://wp-osm-plugin.hyumika.com/category/announcement/)
* [experience report](https://wp-osm-plugin.hyumika.com/category/experience-report/)
* [feedback](https://wp-osm-plugin.hyumika.com/category/feedback/)
* [tutorial](https://wp-osm-plugin.hyumika.com/category/tutorial/)
* [Uncategorized](https://wp-osm-plugin.hyumika.com/category/uncategorized/)

Copyright © 2025
www.hyumik.com \*  [impressum](https://wp-osm-plugin.hyumika.com/impressum/) \*  [privacy policy](https://wp-osm-plugin.hyumika.com/privacy-policy/)

By continuing to use the site, you agree to the use of cookies and load data from third parties. [more information](https://wp-osm-plugin.hyumika.com/privacy-policy/) Accept

The cookie settings on this website are set to "allow cookies" to give you the best browsing experience possible. If you continue to use this website without changing your cookie settings or you click "Accept" below then you are consenting to this.

Close



=== Content from plugins.trac.wordpress.org_a587c877_20250111_173157.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fosm%2Ftrunk%2Fosm-metabox.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/osm/trunk/osm-metabox.php?rev=3153019 "Revision 3153019")
* Next Revision →
* [Blame](/browser/osm/trunk/osm-metabox.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/osm/trunk/osm-metabox.php)

---

# [source:](/browser?order=name "Go to repository root") [osm](/browser/osm?order=name "View osm")/[trunk](/browser/osm/trunk?order=name "View trunk")/[osm-metabox.php](/browser/osm/trunk/osm-metabox.php?order=name "View osm-metabox.php")

View diff against:

View revision:

| [Last change](/changeset/3157069/osm/trunk/osm-metabox.php "View differences") on this file was [3157069](/changeset/3157069/ "View changeset 3157069"), checked in by photoweblog, [4 months ago](/timeline?from=2024-09-24T16%3A59%3A31Z&precision=second "See timeline at 09/24/2024 04:59:31 PM") |
| --- |
| V6.1.1 Bug at the shortcode generator (button) |
| **File size:** 21.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*  (c) Copyright 2024  MiKa (http://wp-osm-plugin.hyumika.com) |
| [3](#L3) |  |
| [4](#L4) | This program is free software; you can redistribute it and/or modify |
| [5](#L5) | it under the terms of the GNU General Public License as published by |
| [6](#L6) | the Free Software Foundation; either version 2 of the License, or |
| [7](#L7) | (at your option) any later version. |
| [8](#L8) |  |
| [9](#L9) | This program is distributed in the hope that it will be useful, |
| [10](#L10) | but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [11](#L11) | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [12](#L12) | GNU General Public License for more details. |
| [13](#L13) |  |
| [14](#L14) | You should have received a copy of the GNU General Public License |
| [15](#L15) | along with this program; if not, write to the Free Software |
| [16](#L16) | Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA |
| [17](#L17) | \*/ |
| [18](#L18) |  |
| [19](#L19) | function osm\_enqueue\_scripts\_styles() { |
| [20](#L20) |  |
| [21](#L21) | wp\_enqueue\_style( 'Osm\_OL\_3\_style', Osm\_OL\_3\_CSS); |
| [22](#L22) | wp\_enqueue\_style( 'Osm\_OL\_3\_Ext\_style', Osm\_OL\_3\_Ext\_CSS); |
| [23](#L23) | wp\_enqueue\_style( 'osm\_map\_style', Osm\_map\_CSS); |
| [24](#L24) |  |
| [25](#L25) | wp\_enqueue\_script('Osm\_OL\_3',Osm\_OL\_3\_LibraryLocation); |
| [26](#L26) | wp\_enqueue\_script('Osm\_OL\_3ext',Osm\_OL\_3\_Ext\_LibraryLocation); |
| [27](#L27) | wp\_enqueue\_script('OSM\_metabox\_event\_Script',Osm\_OL\_3\_MetaboxEvents\_LibraryLocation); |
| [28](#L28) | wp\_enqueue\_script('Osm\_map\_startup\_3',Osm\_map\_startup\_LibraryLocation); |
| [29](#L29) | wp\_enqueue\_script('OSM\_metabox-script',Osm\_OL\_3\_Metabox\_LibraryLocation, array('jquery') ); |
| [30](#L30) |  |
| [31](#L31) | wp\_enqueue\_script('ajax-script', plugins\_url( '/js/osm-plugin-lib.js', \_\_FILE\_\_ ), array('jquery') ); |
| [32](#L32) |  |
| [33](#L33) | wp\_localize\_script( 'ajax-script', 'osm\_ajax\_object', |
| [34](#L34) | array( 'ajax\_url' => admin\_url( 'admin-ajax.php' ), |
| [35](#L35) | 'lat' => '', |
| [36](#L36) | 'lon' => '', |
| [37](#L37) | 'icon' => '', |
| [38](#L38) | 'post\_id' => '', |
| [39](#L39) | 'MarkerLat' =>'', |
| [40](#L40) | 'MarkerLon' =>'', |
| [41](#L41) | 'MarkerIcon' => '', |
| [42](#L42) | 'MarkerName' => '', |
| [43](#L43) | 'MarkerText' => '', |
| [44](#L44) | 'map\_zoom' => '', |
| [45](#L45) | 'map\_type' => '', |
| [46](#L46) | 'map\_border' => '', |
| [47](#L47) | 'map\_controls' => '', |
| [48](#L48) | 'geotag\_nonce' => wp\_create\_nonce( 'osm\_geotag\_nonce'), |
| [49](#L49) | 'marker\_nonce' => wp\_create\_nonce( 'osm\_marker\_nonce'), |
| [50](#L50) | 'plugin\_url' => OSM\_PLUGIN\_URL, |
| [51](#L51) | 'map\_name' => '', |
| [52](#L52) | 'map\_attr' => 1 |
| [53](#L53) | )); |
| [54](#L54) | } |
| [55](#L55) |  |
| [56](#L56) | function osm\_map\_create() { |
| [57](#L57) | //create a custom meta box |
| [58](#L58) |  |
| [59](#L59) | add\_action( 'admin\_enqueue\_scripts', 'osm\_enqueue\_scripts\_styles' ); |
| [60](#L60) |  |
| [61](#L61) | $post\_types = get\_post\_types(); |
| [62](#L62) | foreach ($post\_types as $post\_type) { |
| [63](#L63) | add\_meta\_box( 'osm-sc-meta', 'WP OSM Plugin shortcode generator', 'osm\_map\_create\_shortcode\_function', $post\_type, 'normal', 'high' ); |
| [64](#L64) | } |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | function osm\_map\_create\_shortcode\_function( $post ) { |
| [68](#L68) | ?> |
| [69](#L69) |  |
| [70](#L70) | <div class="osm-tab-container"> |
| [71](#L71) | <ul class="osm-tabs"> |
| [72](#L72) | <li class="tab-link current" data-tab="tab\_welcome"><?php esc\_html\_e('Welcome', 'OSM'); ?></li> |
| [73](#L73) | <li class="tab-link" data-tab="tab\_add\_marker"><?php esc\_html\_e('Map & Marker', 'OSM'); ?></li> |
| [74](#L74) | <li class="tab-link" data-tab="tab\_file\_list"><?php esc\_html\_e('Map & GPX | KML', 'OSM'); ?></li> |
| [75](#L75) | <li class="tab-link" data-tab="tab\_geotag"><?php esc\_html\_e('Map & Locations', 'OSM'); ?></li> |
| [76](#L76) | <li class="tab-link" data-tab="tab\_set\_geotag"><?php esc\_html\_e('Add Location', 'OSM'); ?></li> |
| [77](#L77) | <li class="tab-link" data-tab="tab\_troubleshooting"><?php esc\_html\_e('Troubleshooting', 'OSM'); ?></li> |
| [78](#L78) | <li class="tab-link" data-tab="tab\_about"><?php esc\_html\_e('About', 'OSM'); ?></li> |
| [79](#L79) | </ul> |
| [80](#L80) |  |
| [81](#L81) |  |
| [82](#L82) | <!-- id="tab\_welcome" --> |
| [83](#L83) |  |
| [84](#L84) | <div id="tab\_welcome" class="osm-tab-content current"> |
| [85](#L85) | <?php echo '<p><img src="' . esc\_url(OSM\_PLUGIN\_URL . '/WP\_OSM\_Plugin\_Logo.png') . '" align="left" vspace="10" hspace="20" alt="' . esc\_attr\_\_('Osm Logo', 'OSM') . '"></p>'; ?> |
| [86](#L86) | <h3><?php echo esc\_html\_\_('WordPress OSM Plugin ', 'OSM') . esc\_html(PLUGIN\_VER) . ' '; ?></h3> |
| [87](#L87) | At the top of this panel / metabox you find tabs which allow you to generate a shorcode. You have to copy (Ctrl+C) this shortcode and paste (Ctrl+V) it to your post / page.<br></br> |
| [88](#L88) |  |
| [89](#L89) | <table border="0"> |
| [90](#L90) | <tr> |
| [91](#L91) | <th><?php esc\_html\_e('Tab', 'OSM'); ?></th> |
| [92](#L92) | <th><?php esc\_html\_e('... what to do', 'OSM'); ?></th> |
| [93](#L93) | </tr> |
| [94](#L94) | <tr> |
| [95](#L95) | <td><?php esc\_html\_e('Map & Marker', 'OSM'); ?></td> |
| [96](#L96) | <td><?php esc\_html\_e('... use this tab if you want to create a map with no or one marker.', 'OSM'); ?></td> |
| [97](#L97) | </tr> |
| [98](#L98) | <tr> |
| [99](#L99) | <td><?php esc\_html\_e('Map & GPX | KML', 'OSM'); ?></td> |
| [100](#L100) | <td><?php esc\_html\_e('... use this tab if you want to create a map with one or more tracks (GPX or KML) or if you want to load a file with more than one marker.', 'OSM'); ?></td> |
| [101](#L101) | </tr> |
| [102](#L102) | <tr> |
| [103](#L103) | <td><?php esc\_html\_e('Map & Locations', 'OSM'); ?></td> |
| [104](#L104) | <td><?php esc\_html\_e('... use this tab if you want to show a map with markers where posts or pages are geotagged. You can geotag a post / page at tab', 'OSM'); ?> <?php esc\_html\_e('Add Location', 'OSM'); ?>.</td> |
| [105](#L105) | </tr> |
| [106](#L106) | <tr> |
| [107](#L107) | <td><?php esc\_html\_e('Add Location', 'OSM'); ?></td> |
| [108](#L108) | <td><?php esc\_html\_e('... set a geotag to your post and page. This location is saved with your post / page. You can show a map with your geotags at tab', 'OSM'); ?> <?php esc\_html\_e('Map & Locations', 'OSM'); ?></td> |
| [109](#L109) | </tr> |
| [110](#L110) | <tr> |
| [111](#L111) | <td><?php esc\_html\_e('Troubleshooting', 'OSM'); ?></td> |
| [112](#L112) | <td><?php esc\_html\_e('... if it does not work', 'OSM'); ?></td> |
| [113](#L113) | </tr> |
| [114](#L114) | <tr> |
| [115](#L115) | <td><?php esc\_html\_e('About', 'OSM'); ?></td> |
| [116](#L116) | <td><?php esc\_html\_e('... some Information about the plugin', 'OSM'); ?></td> |
| [117](#L117) | </tr> |
| [118](#L118) | </table> |
| [119](#L119) |  |
| [120](#L120) |  |
| [121](#L121) |  |
| [122](#L122) | </div> <!-- id="tab\_welcome" --> |
| [123](#L123) |  |
| [124](#L124) | <!-- id="tab\_add\_marker" --> |
| [125](#L125) | <div id="tab\_add\_marker" class="osm-tab-content"><br/> |
| [126](#L126) | <?php esc\_html\_e('Add a map with one marker.', 'OSM'); ?><br/><br/> |
| [127](#L127) | <b>1. <?php esc\_html\_e('map type', 'OSM'); ?></b>: |
| [128](#L128) | <select name="osm\_add\_marker\_map\_type" id="osm\_add\_marker\_map\_type"> |
| [129](#L129) | <?php include('osm-maptype-select.php'); ?> |
| [130](#L130) | </select> |
| [131](#L131) | <b>2. <?php esc\_html\_e('map border', 'OSM'); ?></b>: |
| [132](#L132) | <select name="osm\_add\_marker\_border" id="osm\_add\_marker\_border"> |
| [133](#L133) | <?php include('osm-color-select.php'); ?> |
| [134](#L134) | </select><br/><br/> |
| [135](#L135) | <b>3. <?php esc\_html\_e('map controls', 'OSM'); ?></b>: |
| [136](#L136) | <input type="checkbox" name="osm\_add\_marker\_fullscreen" id="osm\_add\_marker\_fullscreen" value="fullscreen"> <?php esc\_html\_e('fullscreen button', 'OSM'); ?> |
| [137](#L137) | <input type="checkbox" name="osm\_add\_marker\_scaleline" id="osm\_add\_marker\_scaleline" value="scaleline"> <?php esc\_html\_e('scaleline', 'OSM'); ?> |
| [138](#L138) | <input type="checkbox" name="osm\_add\_marker\_mouseposition" id="osm\_add\_marker\_mouseposition" value="mouseposition"> <?php esc\_html\_e('mouse position', 'OSM'); ?> |
| [139](#L139) | <input type="checkbox" name="osm\_add\_marker\_overviewmap" id="osm\_add\_marker\_overviewmap" value="overviewmap"> <?php esc\_html\_e('overviewmap', 'OSM'); ?> |
| [140](#L140) | <input type="checkbox" name="osm\_add\_marker\_bckgrnd\_img" id="osm\_add\_marker\_bckgrnd\_img" value="osm\_add\_marker\_bckgrnd\_img"> <?php esc\_html\_e('background image (GDPR)', 'OSM'); ?> <br/><br/> |
| [141](#L141) | <input type="checkbox" name="osm\_add\_marker\_show\_attribution" id="osm\_add\_marker\_show\_attribution" value="osm\_add\_marker\_show\_attribution" checked> <?php esc\_html\_e('Display attribution (credit) in the map.', 'OSM'); ?> |
| [142](#L142) | <span style="color:red"><?php esc\_html\_e('Warning: If you do not check this box, it may violate the license of data or map and have legal consequences!', 'OSM'); ?></span> <!-- <br/> |
| [143](#L143) | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Why not enabled by default? Read <a target="\_new" href="https://developer.wordpress.org/plugins/wordpress-org/detailed-plugin-guidelines/#10-plugins-may-not-embed-external-links-or-credits-on-the-public-site-without-explicitly-asking-the-user%e2%80%99s-permission">Plugins may not embed external links or credits ...</a> --> <br/><br/> |
| [144](#L144) |  |
| [145](#L145) | <b>4. <?php esc\_html\_e('marker icon', 'OSM'); ?></b>:<br/> |
| [146](#L146) | <?php include('osm-marker-select.php'); ?><br/> |
| [147](#L147) | <b>5. <?php esc\_html\_e('marker text', 'OSM'); ?> (<?php esc\_html\_e('optional', 'OSM'); ?>)</b>:<br/> |
| [148](#L148) | <?php esc\_html\_e('Use &lt;b&gt;&lt;/b&gt; for bold, &lt;i&gt;&lt;/i&gt; for kursiv and &lt;br&gt; for new line.', 'OSM'); ?><br/> |
| [149](#L149) | <textarea id="osm\_add\_marker\_text" name="marker\_text" cols="35" rows="4" placeholder="<?php esc\_attr\_e('Use HTML Entities for special characters (eg HTML Tags)!', 'OSM'); ?>"></textarea><br/><br/> |
| [150](#L150) |  |
| [151](#L151) | <b>5. <?php esc\_html\_e('Adjust the map and click into the map to place the marker.', 'OSM'); ?></b> |
| [152](#L152) | <?php |
| [153](#L153) | $latlon = OSM\_default\_lat . ',' . OSM\_default\_lon; |
| [154](#L154) | $zoom = OSM\_default\_zoom; |
| [155](#L155) | echo Osm::sc\_OL3JS([ |
| [156](#L156) | 'map\_center' => $latlon, |
| [157](#L157) | 'zoom' => $zoom, |
| [158](#L158) | 'width' => '75%', |
| [159](#L159) | 'height' => '450', |
| [160](#L160) | 'map\_event' => 'AddMarker', |
| [161](#L161) | 'map\_div\_name' => 'AddMarker\_map' |
| [162](#L162) | ]); |
| [163](#L163) | ?> |
| [164](#L164) | <div id="Marker\_Div"><br/> |
| [165](#L165) | <!-- marker info is printed here when clicking in the map --> |
| [166](#L166) | </div><br/> |
| [167](#L167) | <a class="button" onClick="osm\_savePostMarker(); osm\_generateAddMarkerSC();"> <?php \_e('Save marker and generate shortcode','OSM')?> </a><br/><br/> |
| [168](#L168) |  |
| [169](#L169) | </div> <!-- id="tab\_add\_marker" --> |
| [170](#L170) |  |
| [171](#L171) | <!-- id="add map with gpx or kml file" --> |
| [172](#L172) | <div id="tab\_file\_list" class="osm-tab-content"> |
| [173](#L173) | <?php esc\_html\_e('Add a map with a GPX or KML file. <br/>Copy file address at Mediathek.', 'OSM'); ?><br/><br/> |
| [174](#L174) | <b>1. <?php esc\_html\_e('Map type', 'OSM'); ?></b>: |
| [175](#L175) | <select name="osm\_file\_list\_map\_type" id="osm\_file\_list\_map\_type"> |
| [176](#L176) | <?php include('osm-maptype-select.php'); ?> |
| [177](#L177) | </select> |
| [178](#L178) | <b>2. <?php esc\_html\_e('Map border', 'OSM'); ?></b>: |
| [179](#L179) | <select name="osm\_file\_border" id="osm\_file\_border"> |
| [180](#L180) | <?php include('osm-color-select.php'); ?> |
| [181](#L181) | </select> |
| [182](#L182) | <br/><br/> |
| [183](#L183) | <b>3. <?php esc\_html\_e('Map controls', 'OSM'); ?></b>: |
| [184](#L184) | <input type="checkbox" name="file\_fullscreen" id="file\_fullscreen" value="file\_fullscreen"> <?php esc\_html\_e('Fullscreen button', 'OSM'); ?> |
| [185](#L185) | <input type="checkbox" name="file\_scaleline" id="file\_scaleline" value="file\_scaleline"> <?php esc\_html\_e('Scaleline', 'OSM'); ?> |
| [186](#L186) | <input type="checkbox" name="file\_mouseposition" id="file\_mouseposition" value="file\_mouseposition"> <?php esc\_html\_e('Mouse position', 'OSM'); ?> |
| [187](#L187) | <input type="checkbox" name="file\_overviewmap" id="file\_overviewmap" value="file\_overviewmap"> <?php esc\_html\_e('Overview map', 'OSM'); ?> |
| [188](#L188) | <input type="checkbox" name="file\_bckgrnd\_img" id="file\_bckgrnd\_img" value="file\_bckgrnd\_img"> <?php esc\_html\_e('Background image (GDPR)', 'OSM'); ?> <br/><br/> |
| [189](#L189) | <input type="checkbox" name="osm\_file\_show\_attribution" id="osm\_file\_show\_attribution" value="osm\_file\_show\_attribution" checked> <?php esc\_html\_e('Display attribution (credit) in the map.', 'OSM'); ?> |
| [190](#L190) | <span style="color:red"><?php esc\_html\_e('Warning: If you do not check this box, it may violate the license of data or map and have legal consequences!', 'OSM'); ?></span><br/><br/> |
| [191](#L191) |  |
| [192](#L192) | <b>4. <?php esc\_html\_e('Paste the local URL of file here:', 'OSM'); ?></b> |
| [193](#L193) | <p><?php esc\_html\_e('Do not save any of your personal data in the plugins/osm folder but in the upload folder!', 'OSM'); ?></p> |
| [194](#L194) |  |
| [195](#L195) | <?php for ($i = 0; $i < 5; $i++) : ?> |
| [196](#L196) | <input type="text" class="osmFileName" name="osm\_file\_list\_URL[<?php echo $i; ?>]" placeholder="<?php esc\_attr\_e('../../../../wp-content/uploads/YOUR-FILE', 'OSM'); ?>" /> |
| [197](#L197) | <input type="text" class="osmFileTitle" name="osm\_file\_list\_title[<?php echo $i; ?>]" placeholder="<?php esc\_attr\_e('File title', 'OSM'); ?>" /> |
| [198](#L198) | <select class="osmFileColor" name="osm\_file\_list\_color[<?php echo $i; ?>]" id="osm\_file\_list\_color[<?php echo $i; ?>]"> |
| [199](#L199) | <?php include('osm-color-select.php'); ?> |
| [200](#L200) | </select> |
| [201](#L201) | <br /> |
| [202](#L202) | <?php endfor; ?> |
| [203](#L203) | <br/><br/> |
| [204](#L204) |  |
| [205](#L205) | <input type="checkbox" name="show\_selection\_box" id="show\_selection\_box" value="show\_selection\_box" onclick="osm\_showFileSCmap()"> <?php esc\_html\_e('Show track selection box under the map (only for two or more tracks)', 'OSM'); ?><br/><br/> |
| [206](#L206) |  |
| [207](#L207) | <b>5. <?php esc\_html\_e('Only if you enabled selection box you have to adjust the map manually.', 'OSM'); ?></b><br/><br/> |
| [208](#L208) |  |
| [209](#L209) | <?php |
| [210](#L210) | $latlon = OSM\_default\_lat . ',' . OSM\_default\_lon; |
| [211](#L211) | $zoom = OSM\_default\_zoom; |
| [212](#L212) | echo Osm::sc\_OL3JS([ |
| [213](#L213) | 'map\_center' => $latlon, |
| [214](#L214) | 'zoom' => $zoom, |
| [215](#L215) | 'width' => '100%', |
| [216](#L216) | 'height' => '450', |
| [217](#L217) | 'map\_div\_vis' => 'none', |
| [218](#L218) | 'map\_div\_name' => 'FileSC\_map' |
| [219](#L219) | ]); |
| [220](#L220) | ?> |
| [221](#L221) |  |
| [222](#L222) | <div id="File\_Div"><br/></div><br/> |
| [223](#L223) | <a class="button" onClick="osm\_generateFileSC();"> <?php esc\_html\_e('Generate shortcode for map with GPX/KML file', 'OSM'); ?> </a><br/> |
| [224](#L224) | </div> <!-- id="tab\_file\_list" --> |
| [225](#L225) |  |
| [226](#L226) |  |
| [227](#L227) | <!-- id="add map with geotag" --> |
| [228](#L228) | <div id="tab\_geotag" class="osm-tab-content"> |
| [229](#L229) |  |
| [230](#L230) | <?php esc\_html\_e('Add a map with all geotagged posts / pages of your site. <br/>Set geotag to your post at [Set geotag] tab.', 'OSM'); ?><br/><br/> |
| [231](#L231) | <ol> |
| [232](#L232) | <li> |
| [233](#L233) | <?php esc\_html\_e('Map type', 'OSM'); ?> |
| [234](#L234) | <select name="osm\_geotag\_map\_type" id="osm\_geotag\_map\_type"> |
| [235](#L235) | <?php include('osm-maptype-select.php'); ?> |
| [236](#L236) | </select> |
| [237](#L237) | </li> |
| [238](#L238) | <input type="checkbox" name="osm\_geotag\_show\_attribution" id="osm\_geotag\_show\_attribution" value="osm\_geotag\_show\_attribution" checked> <?php esc\_html\_e('Display attribution (credit) in the map.', 'OSM'); ?> |
| [239](#L239) | <span style="color:red"><?php esc\_html\_e('Warning: If you do not check this box, it may violate the license of data or map and have legal consequences!', 'OSM'); ?></span><br/><br/> |
| [240](#L240) | <li> |
| [241](#L241) | <?php esc\_html\_e('Marker icon', 'OSM'); ?><br/> |
| [242](#L242) | <?php include('osm-marker-tagged-select.php'); ?><br/><br/><br/> |
| [243](#L243) | </li> |
| [244](#L244) | <li> |
| [245](#L245) | <?php esc\_html\_e('Marker style', 'OSM'); ?><br/> |
| [246](#L246) | <label class="metabox-label"> |
| [247](#L247) | <input type="radio" name="tagged\_marker\_style" id="tagged\_marker\_style" onclick="osm\_showTaggedSCmap()" value="standard" checked="checked" /> |
| [248](#L248) | <?php echo '<img src="' . esc\_url(OSM\_PLUGIN\_URL . '/images/marker\_standard\_01.png') . '" align="left" hspace="5" alt="' . esc\_attr('marker\_standard\_01.png') . '">'; ?> |
| [249](#L249) | </label> |
| [250](#L250) | <label class="metabox-label"> |
| [251](#L251) | <input type="radio" name="tagged\_marker\_style" id="tagged\_marker\_style" onclick="osm\_showTaggedSCmap()" value="cluster" /> |
| [252](#L252) | <?php echo '<img src="' . esc\_url(OSM\_PLUGIN\_URL . '/images/marker\_cluster\_01.png') . '" align="left" hspace="5" alt="' . esc\_attr('marker\_cluster\_01.png') . '">'; ?> |
| [253](#L253) | </label> |
| [254](#L254) | </li> |
| [255](#L255) | <br/><br/><br/><br/><br/><br/><br/> |
| [256](#L256) | <li> |
| [257](#L257) | <?php esc\_html\_e('Post type', 'OSM'); ?> |
| [258](#L258) | <select name="osm\_geotag\_posttype" id="osm\_geotag\_posttype"> |
| [259](#L259) | <option value="post"><?php esc\_html\_e('All posts', 'OSM'); ?></option> |
| [260](#L260) | <option value="page"><?php esc\_html\_e('All pages', 'OSM'); ?></option> |
| [261](#L261) | <option value="actual"><?php esc\_html\_e('This post / page', 'OSM'); ?></option> |
| [262](#L262) | </select> |
| [263](#L263) | </li> |
| [264](#L264) | <li> |
| [265](#L265) | <?php |
| [266](#L266) | esc\_html\_e('Category Filter', 'OSM'); |
| [267](#L267) | wp\_dropdown\_categories([ |
| [268](#L268) | 'hide\_empty' => 0, |
| [269](#L269) | 'value\_field' => 'name', |
| [270](#L270) | 'name' => 'category\_parent', |
| [271](#L271) | 'orderby' => 'name', |
| [272](#L272) | 'selected' => '0', |
| [273](#L273) | 'hierarchical' => true, |
| [274](#L274) | 'show\_option\_none' => esc\_html\_\_('None', 'OSM') |
| [275](#L275) | ]); |
| [276](#L276) | esc\_html\_e(' OR ', 'OSM'); |
| [277](#L277) | ?> |
| [278](#L278) | <label for="tag\_filter"><?php esc\_html\_e('Tag Filter:', 'OSM'); ?></label> |
| [279](#L279) | <input type="text" id="tag\_filter" name="tag\_filter"> |
| [280](#L280) | </li> |
| [281](#L281) |  |
| [282](#L282) | <?php esc\_html\_e('Only if marker style is set to cluster you have to adjust the map manually.', 'OSM'); ?><br/><br/> |
| [283](#L283) |  |
| [284](#L284) | <?php |
| [285](#L285) | $latlon = OSM\_default\_lat . ',' . OSM\_default\_lon; |
| [286](#L286) | $zoom = OSM\_default\_zoom; |
| [287](#L287) | echo Osm::sc\_OL3JS([ |
| [288](#L288) | 'map\_center' => $latlon, |
| [289](#L289) | 'zoom' => $zoom, |
| [290](#L290) | 'width' => '100%', |
| [291](#L291) | 'height' => '450', |
| [292](#L292) | 'map\_div\_vis' => 'none', |
| [293](#L293) | 'map\_div\_name' => 'TaggedSC\_map' |
| [294](#L294) | ]); |
| [295](#L295) | ?> |
| [296](#L296) | <li> |
| [297](#L297) | <a class="button" onClick="osm\_generateTaggedPostsSC()"><?php esc\_html\_e('Generate shortcode', 'OSM'); ?></a><br/><br/> |
| [298](#L298) | <?php esc\_html\_e('Copy the shortcode and paste it to your post/page', 'OSM'); ?><br/> |
| [299](#L299) | </li> |
| [300](#L300) | </ol> |
| [301](#L301) | </div> <!-- id="tab\_geotag" --> |
| [302](#L302) |  |
| [303](#L303) |  |
| [304](#L304) | <!-- class="tab\_set\_geotag" --> |
| [305](#L305) | <div id="tab\_set\_geotag" class="osm-tab-content"> |
| [306](#L306) | <?php esc\_html\_e('You can set a geotag (lat/lon) and an icon for this post / page.', 'OSM'); ?><br/> |
| [307](#L307) | <b>1. <?php esc\_html\_e('Post icon', 'OSM'); ?></b>:<br/> |
| [308](#L308) | <?php include('osm-marker-geotag-select.php'); ?><br/><br/><br/> |
| [309](#L309) | <b>2. <?php esc\_html\_e('Click into the map for geotag!', 'OSM'); ?></b>: |
| [310](#L310) |  |
| [311](#L311) | <?php |
| [312](#L312) | $latlon = OSM\_default\_lat . ',' . OSM\_default\_lon; |
| [313](#L313) | $zoom = OSM\_default\_zoom; |
| [314](#L314) | echo Osm::sc\_OL3JS([ |
| [315](#L315) | 'map\_center' => $latlon, |
| [316](#L316) | 'zoom' => $zoom, |
| [317](#L317) | 'width' => '100%', |
| [318](#L318) | 'height' => '450', |
| [319](#L319) | 'map\_event' => 'SetGeotag', |
| [320](#L320) | 'map\_div\_name' => 'AddGeotag\_map' |
| [321](#L321) | ]); |
| [322](#L322) | ?> |
| [323](#L323) |  |
| [324](#L324) | <div id="Geotag\_Div"><br/></div><br/> |
| [325](#L325) | <a class="button" onClick="osm\_saveGeotag();"> <?php esc\_html\_e('Save', 'OSM'); ?> </a><br/><br/> |
| [326](#L326) | </div> <!-- class="tab\_set\_geotag" --> |
| [327](#L327) |  |
| [328](#L328) |  |
| [329](#L329) | <!-- id="tab\_troubleshooting" --> |
| [330](#L330) | <div id="tab\_troubleshooting" class="osm-tab-content"> |
| [331](#L331) | <table border="0"> |
| [332](#L332) | <tr> |
| [333](#L333) | <td><?php echo '<p><img src="' . esc\_url(OSM\_PLUGIN\_URL . '/WP\_OSM\_Plugin\_Logo.png') . '" align="left" vspace="10" hspace="20" alt="' . esc\_attr\_\_('Osm Logo', 'OSM') . '"></p>'; ?></td> |
| [334](#L334) | <td><h3><?php echo esc\_html\_\_('WordPress OSM Plugin ', 'OSM') . esc\_html(PLUGIN\_VER); ?></h3></td> |
| [335](#L335) | </tr> |
| [336](#L336) | </table> |
| [337](#L337) | <b><?php esc\_html\_e('Loading my GPX / KML file does not work', 'OSM'); ?></b><br> |
| [338](#L338) | <?php esc\_html\_e('There are three GPX files provided by the WP OSM Plugin. Try to use them and see if there is a generic problem or it is caused by your personal GPX / KML file:', 'OSM'); ?><br><br> |
| [339](#L339) | <?php echo esc\_url(OSM\_PLUGIN\_URL . 'examples/sample01.gpx'); ?><br> |
| [340](#L340) | <?php echo esc\_url(OSM\_PLUGIN\_URL . 'examples/sample02.gpx'); ?><br> |
| [341](#L341) | <?php echo esc\_url(OSM\_PLUGIN\_URL . 'examples/sample03.gpx'); ?><br><br> |
| [342](#L342) |  |
| [343](#L343) | <b><?php esc\_html\_e('How can I show more than one marker in a map?', 'OSM'); ?></b><br> |
| [344](#L344) | <?php esc\_html\_e('You have to use a KML file, find a sample here:', 'OSM'); ?><br><br> |
| [345](#L345) | <?php echo esc\_url(OSM\_PLUGIN\_URL . 'examples/MarkerSample.kml'); ?><br> |
| [346](#L346) | </div> <!-- id="tab\_troubleshooting" --> |
| [347](#L347) |  |
| [348](#L348) | <div id="tab\_about" class="osm-tab-content"> |
| [349](#L349) | <b><?php echo esc\_html\_\_('WordPress OSM Plugin ', 'OSM') . esc\_html(PLUGIN\_VER) . ' '; ?></b><br/> |
| [350](#L350) | <b><span style="color:#FF0000;"><?php esc\_html\_e('We need help for translations!', 'OSM'); ?></span></b> |
| [351](#L351) | <table border="0"> |
| [352](#L352) | <tr> |
| [353](#L353) | <td><?php echo '<p><img src="' . esc\_url(OSM\_PLUGIN\_URL . '/WP\_OSM\_Plugin\_Logo.png') . '" align="left" vspace="10" hspace="20" alt="' . esc\_attr\_\_('Osm Logo', 'OSM') . '"></p>'; ?></td> |
| [354](#L354) | <td> |
| [355](#L355) | <b><?php esc\_html\_e('Coordination', 'OSM'); echo ' & '; esc\_html\_e('Development', 'OSM'); ?>:</b> |
| [356](#L356) | <a target="\_blank" href="http://hyumika.com"> Michael Kang</a><br/><br/> |
| [357](#L357) | <b><?php esc\_html\_e('Thanks for Translation to', 'OSM'); ?>:</b><br/> |
| [358](#L358) | Вячеслав Стренадко, <a target="\_blank" href="http://tounoki.org/">Tounoki</a>, Sykane, <a target="\_blank" href="http://www.pibinko.org">Andrea Giacomelli</a>, <a target="\_blank" href="http://www.cspace.ro">Sorin Pop</a>, Olle Zettergren<br/><br/> |
| [359](#L359) | <b><?php esc\_html\_e('Thanks for Icons to', 'OSM'); ?>:</b><br/> |
| [360](#L360) | <a target="\_blank" href="http://rgb-labs.com">Dash</a>, <a target="\_blank" href="https://github.com/mapbox/maki">Maki</a>, <a target="\_blank" href="http://www.sjjb.co.uk/mapicons/">SJJB</a>, <a target="\_blank" href="http://publicdomainvectors.org/en/free-clipart/">Publicdomainvectors</a>, <a target="\_blank" href="https://pixabay.com/de/">Pixabay</a>, <a target="\_blank" href="https://thenounproject.com/">TheNounProject</a><br/><br/> |
| [361](#L361) | <?php |
| [362](#L362) | $wp\_url = "https://wordpress.org/support/view/plugin-reviews/osm"; |
| [363](#L363) | // Translators: %s is the URL to the WordPress plugin review page. |
| [364](#L364) | $rate\_txt = sprintf(esc\_html\_\_('If you like the OSM plugin rate it on WP %s', 'OSM'), '<a href="' . esc\_url($wp\_url) . '">' . esc\_html\_\_('here', 'OSM') . '</a>'); |
| [365](#L365) | echo $rate\_txt; |
| [366](#L366) | ?><br/> |
| [367](#L367) | <?php esc\_html\_e('Thanks!', 'OSM'); ?> |
| [368](#L368) | </td> |
| [369](#L369) | </tr> |
| [370](#L370) | </table> |
| [371](#L371) |  |
| [372](#L372) | <b><?php esc\_html\_e('Some useful sites for this plugin:', 'OSM'); ?></b> |
| [373](#L373) | <ol> |
| [374](#L374) | <li><?php esc\_html\_e('For advanced samples visit the', 'OSM'); ?> <a target="\_blank" href="http://wp-osm-plugin.hyumika.com">osm-plugin page</a>.</li> |
| [375](#L375) | <li><?php esc\_html\_e('For questions, bugs and other feedback visit the', 'OSM'); ?> <a target="\_blank" href="https://wp-osm-plugin.hyumika.com/survey/">EN | DE feedback</a></li> |
| [376](#L376) | <li><?php esc\_html\_e('Follow us on Twitter:', 'OSM'); ?> <a target="\_blank" href="https://twitter.com/wp\_osm\_plugin">wp-osm-plugin</a>.</li> |
| [377](#L377) | <li><?php esc\_html\_e('Download the latest version at WordPress.org', 'OSM'); ?> <a target="\_blank" href="http://wordpress.org/extend/plugins/osm/">osm-plugin download</a>.</li> |
| [378](#L378) | </ol> |
| [379](#L379) | </div> <!-- id="tab\_about" --> |
| [380](#L380) |  |
| [381](#L381) | </div>  <!-- class="tabs" --> |
| [382](#L382) | <h3><span style="color:green"><?php \_e('Copy the generated shortcode/customfield/argument: ','OSM') ?></span></h3> |
| [383](#L383) | <div id="ShortCode\_Div"><?php \_e('If you click into the map this text is replaced','OSM') ?> </div> <br/> |
| [384](#L384) | <?php |
| [385](#L385) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/osm/trunk/osm-metabox.php?format=txt)
* [Original Format](/export/3220792/osm/trunk/osm-metabox.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_ba46c95b_20250111_173203.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3157069)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3157068 "Changeset 3157068")
* [Next Changeset](/changeset/3157070 "Changeset 3157070") →

---

# Changeset 3157069

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/24/2024 04:59:31 PM
([4 months](/timeline?from=2024-09-24T16%3A59%3A31Z&precision=second "See timeline at 09/24/2024 04:59:31 PM") ago)

Author:
photoweblog
Message:

V6.1.1

Bug at the shortcode generator (button)

Location:
[osm/trunk](/browser/osm/trunk?rev=3157069)
Files:

4 edited

* [osm-args-class.php](/browser/osm/trunk/osm-args-class.php?rev=3157069 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [osm-metabox.php](/browser/osm/trunk/osm-metabox.php?rev=3157069 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [osm.php](/browser/osm/trunk/osm.php?rev=3157069 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [readme.txt](/browser/osm/trunk/readme.txt?rev=3157069 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [osm/trunk/osm-args-class.php](/changeset/3157069/osm/trunk/osm-args-class.php "Show the changeset 3157069 restricted to osm/trunk/osm-args-class.php")

  | [r3155900](/browser/osm/trunk/osm-args-class.php?rev=3155900#L83 "Show revision 3155900 of this file in browser") | [r3157069](/browser/osm/trunk/osm-args-class.php?rev=3157069#L83 "Show revision 3157069 of this file in browser") |  |
  | --- | --- | --- |
  | 83 | 83 |  |
  | 84 | 84 | private function setMapSize($a\_width,  $a\_height){ |
  |  | 85 |  |
  | 85 | 86 | $width = sanitize\_text\_field($a\_width); |
  | 86 |  | $height = sanitize\_text\_field($a\_height); |
  |  | 87 | $semicolon\_position = strpos($width, ';'); |
  |  | 88 | if ($semicolon\_position !== false) { |
  |  | 89 | $width = substr($width, 0, $semicolon\_position); |
  |  | 90 | } |
  |  | 91 |  |
  |  | 92 | $height = sanitize\_text\_field($a\_height); |
  |  | 93 | $semicolon\_position = strpos($height, ';'); |
  |  | 94 | if ($semicolon\_position !== false) { |
  |  | 95 | $height = substr($height, 0, $semicolon\_position); |
  |  | 96 | } |
  |  | 97 |  |
  | 87 | 98 |  |
  | 88 | 99 | $pos = strpos($width, "%"); |
* ## [osm/trunk/osm-metabox.php](/changeset/3157069/osm/trunk/osm-metabox.php "Show the changeset 3157069 restricted to osm/trunk/osm-metabox.php")

  | [r3153019](/browser/osm/trunk/osm-metabox.php?rev=3153019#L165 "Show revision 3153019 of this file in browser") | [r3157069](/browser/osm/trunk/osm-metabox.php?rev=3157069#L165 "Show revision 3157069 of this file in browser") |  |
  | --- | --- | --- |
  | 165 | 165 | <!-- marker info is printed here when clicking in the map --> |
  | 166 | 166 | </div><br/> |
  | 167 |  | ~~</div>~~ |
  | 168 | 167 | <a class="button" onClick="osm\_savePostMarker(); osm\_generateAddMarkerSC();"> <?php \_e('Save marker and generate shortcode','OSM')?> </a><br/><br/> |
  | 169 | 168 |  |
* ## [osm/trunk/osm.php](/changeset/3157069/osm/trunk/osm.php "Show the changeset 3157069 restricted to osm/trunk/osm.php")

  | [r3155900](/browser/osm/trunk/osm.php?rev=3155900#L4 "Show revision 3155900 of this file in browser") | [r3157069](/browser/osm/trunk/osm.php?rev=3157069#L4 "Show revision 3157069 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: https://wp-osm-plugin.hyumika.com |
  | 5 | 5 | Description: Embeds maps in your blog and adds geo data to your posts.  Find samples and a forum on the <a href="https://wp-osm-plugin.hyumika.com">OSM plugin page</a>. |
  | 6 |  | Version: 6.1.~~0~~ |
  |  | 6 | Version: 6.1.1 |
  | 7 | 7 | Author: MiKa |
  | 8 | 8 | Author URI: http://www.hyumika.com |
  | […](/browser/osm/trunk/osm.php?rev=3155900#L28) | […](/browser/osm/trunk/osm.php?rev=3157069#L28) |  |
  | 28 | 28 | load\_plugin\_textdomain('OSM', false, dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/'); |
  | 29 | 29 |  |
  | 30 |  | define ("PLUGIN\_VER", "V6.1.~~0~~"); |
  |  | 30 | define ("PLUGIN\_VER", "V6.1.1"); |
  | 31 | 31 |  |
  | 32 | 32 | // modify anything about the marker for tagged posts here |
* ## [osm/trunk/readme.txt](/changeset/3157069/osm/trunk/readme.txt "Show the changeset 3157069 restricted to osm/trunk/readme.txt")

  | [r3155900](/browser/osm/trunk/readme.txt?rev=3155900#L4 "Show revision 3155900 of this file in browser") | [r3157069](/browser/osm/trunk/readme.txt?rev=3157069#L4 "Show revision 3157069 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 3.0 |
  | 5 | 5 | Tested up to: 6.6.1 |
  | 6 |  | Stable tag: 6.1.~~0~~ |
  |  | 6 | Stable tag: 6.1.1 |
  | 7 | 7 | License: GPLv2 |
  | 8 | 8 | Requires PHP: 5.3 |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3157069)
* [Zip Archive](?format=zip&new=3157069)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


