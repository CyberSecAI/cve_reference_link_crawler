

[![Hack The Box: Cybersecurity Training ](/images/landingv3/logo-htb-blog.svg)](/blog)
Popular Topics

* [JOIN NOW](https://account.hackthebox.com/register%20)

[ALL](/blog)
[Red Teaming](/blog/category/red-teaming)
[Blue Teaming](/blog/category/blue-teaming)
[Cyber Teams](/blog/category/cyber-teams)
[Education](/blog/category/education)
[CISO Diaries](/blog/category/ciso-diaries)
[Events](/blog/category/events)
[HTB Insider](/blog/category/htb-insider)
[Customer Stories](/blog/category/customer-stories)
[Write-Ups](/blog/category/write-ups)
[CVE Explained](/blog/category/cve-explained)
[News](/blog/category/news)
[Career Stories](/blog/category/career-stories)
[Humans of HTB](/blog/category/humans-of-htb)

CVE Explained

8
min read

# Openfire CVEs explained (CVE-2024-25420 & CVE-2024-25421)

## An in-depth look at Openfire CVEs (CVE-2024-25420 & CVE-2024-25421): featuring two improper access control issues affecting the application.

[![xRogue avatar](/images/landingv3/blog/authors/placeholder.webp)](https://www.hackthebox.com/blog/author/xRogue)

[xRogue](https://www.hackthebox.com/blog/author/xRogue),

Mar 26

2024

![Hack The Box Article](https://www.hackthebox.com/storage/blog/gjLIGRDug2949V11AeJYQhFaQlOwi9Y2.jpg)

#### Table of Contents

* [What are CVE-2024-25420 & CVE-2024-25421?](#mcetoc_1hpt7q8ga6qd)
* [Steps to exploit CVE-2024-25420](#mcetoc_1hpt7q8ga6qe)
* [Steps to exploit CVE-2024-25421](#mcetoc_1hpt7q8ga6qf)
* [Analyzing CVE-2024-25420](#mcetoc_1hpt7q8ga6qg)
* [Analyzing CVE-2024-25421](#mcetoc_1hpt7q8ga6qh)
* [Impact of Openfire CVEs](#mcetoc_1hpt7q8ga6qi)
  + [CVE-2024-25420](#mcetoc_1hpt7q8ga6qj)
  + [CVE-2024-25421](#mcetoc_1hpt7q8ga6qk)
* [Stay ahead of threats with Hack The Box](#mcetoc_1hpt7q8ga6ql)

Openfire is a real-time collaboration (RTC) server licensed under the Open Source Apache License. It is written in Java and uses the XMPP protocol for instant messaging. During our work, Hack The Box was able to identify two improper access control issues affecting the application.

## What are CVE-2024-25420 & CVE-2024-25421?

The first issue lies in the way the application is managing deleted administrative users. When an administrative user is created, his admin privileges are saved in a system property called admin.authorizedJIDs and the key used is the account’s username. If the administrative user is deleted, his username is not deleted from the admin.authorizedJIDs system property.

This way, if a new user is created with the same username, the new user is automatically an administrator. The new user does not need to be created from the administrative panel of the application. It can be created through an XMPP registration. This issue is registered as CVE-2024-25420.

The second issue is similar, but the underlying cause is different.

If a user is added to a group chat, his affiliation along with other related data are stored in the cache.

When this user is deleted, the cache is not updated to reflect the new state of the group, allowing a new user with the same username to gain access to the group chat with the same level of privileges as the previously deleted user. This issue is registered as CVE-2024-25421.

## Steps to exploit CVE-2024-25420

To replicate this vulnerability, take the following steps:

1. Create an admin user.

![](data:image/png;base64...)

2. Delete the admin user.

![](data:image/png;base64...)

3. Create a new user with the same username as the deleted admin user. We created the user through XMPP using pidgin for this example.

![](data:image/png;base64...)

4. Log in with the new account through the web application.

![](data:image/png;base64...)

## Steps to exploit CVE-2024-25421

To replicate CVE-2024-25421, take the following steps:

1. Create a new user and add him to a group chat (under any affiliation – for this example, Admin).

![](data:image/png;base64...)

2. Delete the user.

![](data:image/png;base64...)

3. Notice that the user is still in the admin list of the group chat.

![](data:image/png;base64...)

4. Create a new user with the same username.

![](data:image/png;base64...)

5. Search through the group list and notice the user has access to the group chat.

![](data:image/png;base64...)

6. Notice that the user can see previous messages and perform the actions that correspond to his role (for example, if he was an owner he could do run/config).

![](data:image/png;base64...)

## Analyzing CVE-2024-25420

During user creation, when the admin checkbox is ticked, the isUserAdmin() function of the AdminManager class is called.

```
public boolean isUserAdmin(String username, boolean allowAdminIfEmpty) {
    if (adminList == null {
    loadAdminList() ;
    }
    if (allowAdminIfEmpty && adminList.isEmpty()) {
        return "admin".equals(username) ;
    }
    JID userJID = XMPPServer.getInstance().createJID(username, null);

    return adminlist.contains(userJID);
}

```

The function initially returns false, since the username is not present in the adminList variable, which contains the values of the admin.authorizedJIDs system property. If this function returns false, the addAdminAccount function of the AdminManager class is called, which adds the user to the adminList.

```
public void addAdminAccount(String username) {
    if (adminList == null) {
        loadAdminList();
    }

    JID userJID = XMPPServer.getInstance().createJID(username, null);
    if (adminList.contains(userJID)) {
        // Already have them.
        return;
    }

    // Add new admin to cache.
    adminList.add(userJID);
    // Store updated list of admins with provider.
    provider.setAdmins(adminList);
}

```

The function essentially leads to the setValue() function of the SystemProperty class which sets the property through the JiveGlobals.setProperty() function.

```
public void setValue(final T value) {
    JiveGlobals.setProperty(key, TO_STRING.get(getConverterClass()).apply(value, this), isEncrypted());
}

```

Although on user creation the admin.authorizedJIDs system property is edited accordingly, the same operation is not performed during user deletion. On user deletion, the deleteUser() function from the UserManager class is called.

```
public void deleteUser(final User user) {
    if (provider.isReadOnly()) {
        throw new UnsupportedOperationException("User provider is read-only.");
    }

    final String username = user.getUsername();
    // Make sure that the username is valid.
    try {
        /*username =*/ Stringprep.nodeprep(username);
    }
    catch (final StringprepException se) {
        throw new IllegalArgumentException("Invalid username: " + username, se);
    }

    // Fire event.
    final Map<String,Object> params = Collections.emptyMap();
    UserEventDispatcher.dispatchEvent(user, UserEventDispatcher.EventType.user_deleting, params);

    provider.deleteUser(user.getUsername());
    // Remove the user from cache.
    userCache.remove(user.getUsername());
}

```

This is the base function that fires off a series of events (especially through the dispatchEvent() function) that ensures proper user deletion.

At no point during these operations or the ones that come after, should you perform the same kind of operation (setProperty) on the system property as the create user operations did. The function for deletion of the username from the system property exists:

```
public void removeAdminAccount(String username) {
    if (adminList == null) {
        loadAdminList();
    }
    JID userJID = XMPPServer.getInstance().createJID(username, null);
    if (!adminList.contains(userJID)) {
        return;
    }
    // Remove user from admin list cache.
    adminList.remove(userJID);
    // Store updated list of admins with provider.
    provider.setAdmins(adminList);
}

```

(removeAdminAccount() on AdminManager class) but it is never called. The result is, that the username remains in the admin.authorizedJIDs system property even if the user is deleted.

This way, if another user creates a new user with the same username as the deleted user, the isUserAdmin() function will return true, granting access to the administration panel.

## Analyzing CVE-2024-25421

When the group chat management page is visited, one of the functions that is being called is the getChatRoom() function from the MultiUserChatService class.

This function tries to load the room properties from the ROOM\_CACHE, but if the room cache is not initialized, it initializes it from the database (which is where the room’s original properties are stored for consistency) and stores it in the ROOM\_CACHE at the end of the if condition.

```
public MUCRoom getChatRoom(@Nonnull final String roomName, @Nonnull final JID userjid) throws NotAllowedE
    MUCRoom room;
    boolean loaded = false;
    boolean created = false;
    final Lock lock = localMUCRoomManager.getLock(roomName);
    lock.lock();
    try {
        room = localMUCRoomManager.get(roomName); // Get from ROOM_CACHE
        if (room == null) {
            room = new MUCRoom(this, roomName);
            // If the room is persistent Load the configuration values from the DB
            try {
                // Try to load the room's configuration from the database (if the room is
                // persistent but was added to the DB after the server was started up or the
                // room may be an old room that was not present in memory)
                MUCPersistenceManager.loadFromDB(room); // Load from DB if not found
                loaded = true;
    }
}
localMUCRoomManager.add(room);

```

This ROOM\_CACHE value will not change until the web server is restarted, for two reasons:

1. The expiry date is set to never expire.

```
LocalMUCRoomManager(@Nonnull final MultiUserChatService service)
{
    this.serviceName = service.getServiceName();
    Log.debug("Instantiating for service '{}':, serviceName);
    ROOM_CACHE = CacheFactory.createCache("MUC Service '" + serviceName + "' Rooms");
    ROOM_CACHE.setMaxLifetime(-1);
    ROOM_CACHE.setMaxCacheSize(-1L);
    ROOM_CACHE_STATS = CacheFactory.createCache("MUC Service '" + serviceName + "' Room Statistics");
    ROOM_CACHE_STATS.setMaxLifetime(-1);
    ROOM_CACHE_STATS.setMaxCacheSize(-1L);
}

```

2. At no point in the communication between the client and the server, the ROOM\_CACHE is re-evaluated (not even after user deletion which is what we are after here).

Since the ROOM\_CACHE will continue to include the deleted user in its properties, and it is not refreshed after user deletion, a user that creates a new user with the same username, will have access to the group chat with the corresponding affiliation, until the ROOM\_CACHE is refreshed (which in this case, until the server restarts, since the expiry is to never expire).

## Impact of Openfire CVEs

### **CVE-2024-25420**

Users can bruteforce known commonly used administrator usernames during registration, in hopes of finding a deleted admin account to gain access to the admin panel. Deletion of the default “admin” user is common, making this attack easier to perform.

This attack vector is even more prevalent if the attacker has some internal knowledge of the organization (for example if they already have gained access to the company’s internal network) and tries to bruteforce known usernames.

Even from the public internet, attackers can figure out a wordlist of possible usernames through OSINT sources (e.g. LinkedIn), especially of former employees, to use against the service.

### **CVE-2024-25421**

Since websites are generally aiming for a constant workflow and don’t restart often, the impact of the specific bug can be quite significant.

An attacker can brute force registration of OSINT gathered usernames and then try to refresh the group chat list of each account they registered in hopes of gaining access to the group chats that a now-deleted user had.

This becomes even more prevalent in internal environments, where the attacker could gather information about users that have been deleted/left the organization etc.

## Stay ahead of threats with Hack The Box

At HTB, we release new content every month based on recent threats and vulnerabilities. Keep your team up to speed on the latest CVEs using HTB Enterprise Platform:

[Train on the latest threats](https://enterprise.hackthebox.com/login)

| **Author bio: Stavros Manis (xRogue), Content Engineer, Hack The Box**  Stavros Manis works as a Content Engineer at Hack the Box, where he ensures the Machines on the platform are high-quality and realistic.  He has experience as a penetration tester, working on security projects for big companies in finance, health, and construction. He also has experience in cybersecurity defense, having worked as a SOC analyst in Greece to help protect companies' users and assets.  You can find him on [LinkedIn](https://gr.linkedin.com/in/stavros-manis-9a93a41ab) and [Twitter](https://twitter.com/_xRogue__). |
| --- |

## Latest News

[![Hack the Box Blog](/storage/blog/AYGrs5RGIPsFvPrV1mPJbybUIZlUfOjo.jpg)

Red Teaming

10
min read

## How to write better security reports (for techies & execs)

[![Adam Luvshis (FalconSpy) avatar](/images/landingv3/blog/authors/placeholder.webp)](https://www.hackthebox.com/blog/author/Adam%20Luvshis%20%28FalconSpy%29)
[![Grahame Turner avatar](/images/landingv3/blog/authors/placeholder.webp)](https://www.hackthebox.com/blog/author/Grahame%20Turner)

[Adam Luvshis (FalconSpy)](https://www.hackthebox.com/blog/author/Adam%20Luvshis%20%28FalconSpy%29)
&

[Grahame Turner](https://www.hackthebox.com/blog/author/Grahame%20Turner)
,
Jan 08,
2025](https://www.hackthebox.com/blog/security-report-writing)

[![Hack the Box Blog](/storage/blog/jkT6J2CcLvBvFrfgPDMzENOuSe45NXfX.jpg)

Events

4
min read

## HTB University CTF 2024 recap

[![JXoaT avatar](/images/landingv3/blog/authors/JXoaT.png)](https://www.hackthebox.com/blog/author/JXoaT)
[JXoaT](https://www.hackthebox.com/blog/author/JXoaT), Dec 31,
2024](https://www.hackthebox.com/blog/htb-university-ctf-2024-recap)

[![Hack the Box Blog](/storage/blog/IS13beT8mIAYHkMCOJ8LcJyYmsZp2PcM.jpg)

Red Teaming

6
min read

## Hit the neon streets of Sunset Bay in Season 7 Vice!

[![JXoaT avatar](/images/landingv3/blog/authors/JXoaT.png)](https://www.hackthebox.com/blog/author/JXoaT)
[JXoaT](https://www.hackthebox.com/blog/author/JXoaT), Dec 30,
2024](https://www.hackthebox.com/blog/HTB-Season-7-Vice)

![Hack The Blog](/images/landingv3/logo-htb-blog.svg)
## The latest news and updates, direct from Hack The Box

[Read More](https://www.hackthebox.com/blog)

Products

Individuals

[HTB Academy](https://academy.hackthebox.com)
[HTB Labs](https://www.hackthebox.com/hacker/hacking-labs)
[Elite Red Team Labs](https://www.hackthebox.com/hacker/pro-labs)
[Capture The Flag](https://www.hackthebox.com/hacker/ctf)
[Certifications](https://academy.hackthebox.com/preview/certifications)

Teams

[Academy for Business](https://academy.hackthebox.com/academy-for-business)
[Dedicated Labs](https://www.hackthebox.com/business/dedicated-labs)
[Professional Labs](https://www.hackthebox.com/business/professional-labs)
[BlackSky: Cloud Labs](https://www.hackthebox.com/business/professional-labs/cloud-labs-blacksky)
[Start a free trial](https://enterprise.hackthebox.com/create-company)

Solutions

Industries

[Government](https://resources.hackthebox.com/government)
[Finance](https://www.hackthebox.com/industry/finance)
[Manufacturing](https://resources.hackthebox.com/manufacturing)
[Healthcare](https://resources.hackthebox.com/healthcare)
[Consulting](https://www.hackthebox.com/industry/professional-services)

Pricing

[For Individuals](https://www.hackthebox.com/hacker/pricing)
[For Teams](https://www.hackthebox.com/business/pricing)

Resources

Community

[Blog](https://www.hackthebox.com/blog)
[Upcoming Events](https://www.hackthebox.com/events)
[Meetups](https://www.hackthebox.com/meetups)
[Affiliate Program](https://resources.hackthebox.com/affiliates)
[SME Program](https://resources.hackthebox.com/become-an-htb-subject-matter-expert)
[Ambassador Program](https://www.hackthebox.com/host-a-meetup)
[Parrot OS](https://parrotsec.org/)

Get Help

[Help Center](https://help.hackthebox.com)
[Contact Support](https://www.hackthebox.com/contact-us)

Company

[About us](https://www.hackthebox.com/about-us)
[Careers](https://www.hackthebox.com/join-us)
[Social Impact](https://www.hackthebox.com/community)
[Brand Guidelines](https://drive.google.com/file/d/1HVUeR2Kk4zNEojqqgvow1RAQgKqhptFn/view)
[Certificate Validation](https://www.hackthebox.com/certificates)
[Legal](https://www.hackthebox.com/legal)

Contact us

[Press](https://www.hackthebox.com/blog/category/news)
[Partners](https://www.hackthebox.com/channel-partners)
[Enterprise Sales](https://www.hackthebox.com/business-cyber-security-training)

Store

[HTB Swag](https://hackthebox.store)
[Buy Gift Cards](https://www.hackthebox.com/giftcards)

Cookie
Settings
[Privacy Policy](https://resources.hackthebox.com/hubfs/Legal/PN.pdf)

[User Agreement](https://resources.hackthebox.com/hubfs/Legal/UA.pdf)

© 2025 Hack The Box

Products

Individuals

[HTB Academy](https://academy.hackthebox.com)
[HTB Labs](https://www.hackthebox.com/hacker/hacking-labs)
[Elite Red Team Labs](https://www.hackthebox.com/hacker/pro-labs)
[Capture The Flag](https://www.hackthebox.com/hacker/ctf)
[Certifications](https://academy.hackthebox.com/preview/certifications)

Teams

[Academy for Business](https://academy.hackthebox.com/academy-for-business)
[Dedicated Labs](https://www.hackthebox.com/business/dedicated-labs)
[Professional Labs](https://www.hackthebox.com/business/professional-labs)
[BlackSky: Cloud Labs](https://www.hackthebox.com/business/professional-labs/cloud-labs-blacksky)
[Start a free trial](https://enterprise.hackthebox.com/create-company)

Solutions

Industries

[Government](https://resources.hackthebox.com/government)
[Finance](https://www.hackthebox.com/industry/finance)
[Manufacturing](https://resources.hackthebox.com/manufacturing)
[Healthcare](https://resources.hackthebox.com/healthcare)
[Consulting](https://www.hackthebox.com/industry/professional-services)

Pricing

[For Individuals](https://www.hackthebox.com/hacker/pricing)
[For Teams](https://www.hackthebox.com/business/pricing)

Resources

Community

[Blog](https://www.hackthebox.com/blog)
[Upcoming Events](https://www.hackthebox.com/events)
[Meetups](https://www.hackthebox.com/meetups)
[Affiliate Program](https://resources.hackthebox.com/affiliates)
[SME Program](https://resources.hackthebox.com/become-an-htb-subject-matter-expert)
[Ambassador Program](https://www.hackthebox.com/host-a-meetup)
[Parrot OS](https://parrotsec.org/)

Get Help

[Help Center](https://help.hackthebox.com)
[Contact Support](https://www.hackthebox.com/contact-us)

Company

[About us](https://www.hackthebox.com/about-us)
[Careers](https://www.hackthebox.com/join-us)
[Social Impact](https://www.hackthebox.com/community)
[Brand Guidelines](https://drive.google.com/file/d/1HVUeR2Kk4zNEojqqgvow1RAQgKqhptFn/view)
[Certificate Validation](https://www.hackthebox.com/certificates)
[Legal](https://www.hackthebox.com/legal)

Contact us

[Press](https://www.hackthebox.com/blog/category/news)
[Partners](https://www.hackthebox.com/channel-partners)
[Enterprise Sales](https://www.hackthebox.com/business-cyber-security-training)

Store

[HTB Swag](https://hackthebox.store)
[Buy Gift Cards](https://www.hackthebox.com/giftcards)

Cookie
Settings
[Privacy Policy](https://resources.hackthebox.com/hubfs/Legal/PN.pdf)

[User Agreement](https://resources.hackthebox.com/hubfs/Legal/UA.pdf)

© 2025 Hack The Box

