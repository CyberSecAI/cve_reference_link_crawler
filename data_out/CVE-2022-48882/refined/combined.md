=== Content from git.kernel.org_167bed05_20250111_043311.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emeel Hakim <ehakim@nvidia.com> | 2022-12-11 13:22:23 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-01-18 11:58:30 +0100 |
| commit | [514d9c6a39213d8200884e70f60ce7faef1ee597](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=514d9c6a39213d8200884e70f60ce7faef1ee597) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)) | |
| tree | [e685cf52f19327abb62949b149246cc6de1ba4fb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=514d9c6a39213d8200884e70f60ce7faef1ee597) | |
| parent | [9be4e25bdc1fb6bacde61e3e35e276c821a485a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9be4e25bdc1fb6bacde61e3e35e276c821a485a0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=514d9c6a39213d8200884e70f60ce7faef1ee597&id2=9be4e25bdc1fb6bacde61e3e35e276c821a485a0)) | |
| download | [linux-514d9c6a39213d8200884e70f60ce7faef1ee597.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-514d9c6a39213d8200884e70f60ce7faef1ee597.tar.gz) | |

net/mlx5e: Fix macsec possible null dereference when updating MAC security entity (SecY)[ Upstream commit 9828994ac492e8e7de47fe66097b7e665328f348 ]
Upon updating MAC security entity (SecY) in hw offload path, the macsec
security association (SA) initialization routine is called. In case of
extended packet number (epn) is enabled the salt and ssci attributes are
retrieved using the MACsec driver rx\_sa context which is unavailable when
updating a SecY property such as encoding-sa hence the null dereference.
Fix by using the provided SA to set those attributes.
Fixes: 4411a6c0abd3 ("net/mlx5e: Support MACsec offload extended packet number (EPN)")
Signed-off-by: Emeel Hakim <ehakim@nvidia.com>
Reviewed-by: Raed Salem <raeds@nvidia.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=514d9c6a39213d8200884e70f60ce7faef1ee597)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=514d9c6a39213d8200884e70f60ce7faef1ee597) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 7 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.cindex 7c0085ba2fc5bd..b92d541b5286e3 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=9be4e25bdc1fb6bacde61e3e35e276c821a485a0)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=514d9c6a39213d8200884e70f60ce7faef1ee597)@@ -359,7 +359,6 @@ static int mlx5e\_macsec\_init\_sa(struct macsec\_context \*ctx, struct mlx5\_core\_dev \*mdev = priv->mdev; struct mlx5\_macsec\_obj\_attrs obj\_attrs; union mlx5e\_macsec\_rule \*macsec\_rule;- struct macsec\_key \*key; int err;  obj\_attrs.next\_pn = sa->next\_pn;@@ -369,13 +368,9 @@ static int mlx5e\_macsec\_init\_sa(struct macsec\_context \*ctx, obj\_attrs.aso\_pdn = macsec->aso.pdn; obj\_attrs.epn\_state = sa->epn\_state; - key = (is\_tx) ? &ctx->sa.tx\_sa->key : &ctx->sa.rx\_sa->key;- if (sa->epn\_state.epn\_enabled) {- obj\_attrs.ssci = (is\_tx) ? cpu\_to\_be32((\_\_force u32)ctx->sa.tx\_sa->ssci) :- cpu\_to\_be32((\_\_force u32)ctx->sa.rx\_sa->ssci);-- memcpy(&obj\_attrs.salt, &key->salt, sizeof(key->salt));+ obj\_attrs.ssci = cpu\_to\_be32((\_\_force u32)sa->ssci);+ memcpy(&obj\_attrs.salt, &sa->salt, sizeof(sa->salt)); }  obj\_attrs.replay\_window = ctx->secy->replay\_window; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:31:48 +0000



=== Content from git.kernel.org_56ad05d9_20250111_043312.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9828994ac492e8e7de47fe66097b7e665328f348)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9828994ac492e8e7de47fe66097b7e665328f348)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9828994ac492e8e7de47fe66097b7e665328f348)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9828994ac492e8e7de47fe66097b7e665328f348)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Emeel Hakim <ehakim@nvidia.com> | 2022-12-11 13:22:23 +0200 |
| --- | --- | --- |
| committer | Saeed Mahameed <saeedm@nvidia.com> | 2023-01-09 22:08:37 -0800 |
| commit | [9828994ac492e8e7de47fe66097b7e665328f348](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9828994ac492e8e7de47fe66097b7e665328f348) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9828994ac492e8e7de47fe66097b7e665328f348)) | |
| tree | [2a90f0a53df5f41cab660f5687b678a34e6137b3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9828994ac492e8e7de47fe66097b7e665328f348) | |
| parent | [f5e1ed04aa2ea665a796f0109091ca3f2b01024a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f5e1ed04aa2ea665a796f0109091ca3f2b01024a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9828994ac492e8e7de47fe66097b7e665328f348&id2=f5e1ed04aa2ea665a796f0109091ca3f2b01024a)) | |
| download | [linux-9828994ac492e8e7de47fe66097b7e665328f348.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9828994ac492e8e7de47fe66097b7e665328f348.tar.gz) | |

net/mlx5e: Fix macsec possible null dereference when updating MAC security entity (SecY)Upon updating MAC security entity (SecY) in hw offload path, the macsec
security association (SA) initialization routine is called. In case of
extended packet number (epn) is enabled the salt and ssci attributes are
retrieved using the MACsec driver rx\_sa context which is unavailable when
updating a SecY property such as encoding-sa hence the null dereference.
Fix by using the provided SA to set those attributes.
Fixes: 4411a6c0abd3 ("net/mlx5e: Support MACsec offload extended packet number (EPN)")
Signed-off-by: Emeel Hakim <ehakim@nvidia.com>
Reviewed-by: Raed Salem <raeds@nvidia.com>
Signed-off-by: Saeed Mahameed <saeedm@nvidia.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9828994ac492e8e7de47fe66097b7e665328f348)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=9828994ac492e8e7de47fe66097b7e665328f348) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 7 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c b/drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.cindex cf7b3bb54c8614..7f6b940830b314 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=f5e1ed04aa2ea665a796f0109091ca3f2b01024a)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en\_accel/macsec.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en_accel/macsec.c?id=9828994ac492e8e7de47fe66097b7e665328f348)@@ -359,7 +359,6 @@ static int mlx5e\_macsec\_init\_sa(struct macsec\_context \*ctx, struct mlx5\_core\_dev \*mdev = priv->mdev; struct mlx5\_macsec\_obj\_attrs obj\_attrs; union mlx5e\_macsec\_rule \*macsec\_rule;- struct macsec\_key \*key; int err;  obj\_attrs.next\_pn = sa->next\_pn;@@ -369,13 +368,9 @@ static int mlx5e\_macsec\_init\_sa(struct macsec\_context \*ctx, obj\_attrs.aso\_pdn = macsec->aso.pdn; obj\_attrs.epn\_state = sa->epn\_state; - key = (is\_tx) ? &ctx->sa.tx\_sa->key : &ctx->sa.rx\_sa->key;- if (sa->epn\_state.epn\_enabled) {- obj\_attrs.ssci = (is\_tx) ? cpu\_to\_be32((\_\_force u32)ctx->sa.tx\_sa->ssci) :- cpu\_to\_be32((\_\_force u32)ctx->sa.rx\_sa->ssci);-- memcpy(&obj\_attrs.salt, &key->salt, sizeof(key->salt));+ obj\_attrs.ssci = cpu\_to\_be32((\_\_force u32)sa->ssci);+ memcpy(&obj\_attrs.salt, &sa->salt, sizeof(sa->salt)); }  obj\_attrs.replay\_window = ctx->secy->replay\_window; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:31:49 +0000


