=== Content from git.kernel.org_841db913_20250111_164522.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=959ab6350add903e352890af53e86663739fcb9a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=959ab6350add903e352890af53e86663739fcb9a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=959ab6350add903e352890af53e86663739fcb9a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=959ab6350add903e352890af53e86663739fcb9a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chen Ridong <chenridong@huawei.com> | 2024-08-04 21:30:15 -0400 |
| --- | --- | --- |
| committer | Tejun Heo <tj@kernel.org> | 2024-08-05 10:52:40 -1000 |
| commit | [959ab6350add903e352890af53e86663739fcb9a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=959ab6350add903e352890af53e86663739fcb9a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=959ab6350add903e352890af53e86663739fcb9a)) | |
| tree | [377677874dd1c8ae0797c0c1282f11d7fbeec904](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=959ab6350add903e352890af53e86663739fcb9a) | |
| parent | [8400291e289ee6b2bf9779ff1c83a291501f017b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8400291e289ee6b2bf9779ff1c83a291501f017b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=959ab6350add903e352890af53e86663739fcb9a&id2=8400291e289ee6b2bf9779ff1c83a291501f017b)) | |
| download | [linux-959ab6350add903e352890af53e86663739fcb9a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-959ab6350add903e352890af53e86663739fcb9a.tar.gz) | |

cgroup/cpuset: fix panic caused by partcmd\_updateWe find a bug as below:
BUG: unable to handle page fault for address: 00000003
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP NOPTI
CPU: 3 PID: 358 Comm: bash Tainted: G W I 6.6.0-10893-g60d6
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/4
RIP: 0010:partition\_sched\_domains\_locked+0x483/0x600
Code: 01 48 85 d2 74 0d 48 83 05 29 3f f8 03 01 f3 48 0f bc c2 89 c0 48 9
RSP: 0018:ffffc90000fdbc58 EFLAGS: 00000202
RAX: 0000000100000003 RBX: ffff888100b3dfa0 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 000000000002fe80
RBP: ffff888100b3dfb0 R08: 0000000000000001 R09: 0000000000000000
R10: ffffc90000fdbcb0 R11: 0000000000000004 R12: 0000000000000002
R13: ffff888100a92b48 R14: 0000000000000000 R15: 0000000000000000
FS: 00007f44a5425740(0000) GS:ffff888237d80000(0000) knlGS:0000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000100030973 CR3: 000000010722c000 CR4: 00000000000006e0
Call Trace:
<TASK>
? show\_regs+0x8c/0xa0
? \_\_die\_body+0x23/0xa0
? \_\_die+0x3a/0x50
? page\_fault\_oops+0x1d2/0x5c0
? partition\_sched\_domains\_locked+0x483/0x600
? search\_module\_extables+0x2a/0xb0
? search\_exception\_tables+0x67/0x90
? kernelmode\_fixup\_or\_oops+0x144/0x1b0
? \_\_bad\_area\_nosemaphore+0x211/0x360
? up\_read+0x3b/0x50
? bad\_area\_nosemaphore+0x1a/0x30
? exc\_page\_fault+0x890/0xd90
? \_\_lock\_acquire.constprop.0+0x24f/0x8d0
? \_\_lock\_acquire.constprop.0+0x24f/0x8d0
? asm\_exc\_page\_fault+0x26/0x30
? partition\_sched\_domains\_locked+0x483/0x600
? partition\_sched\_domains\_locked+0xf0/0x600
rebuild\_sched\_domains\_locked+0x806/0xdc0
update\_partition\_sd\_lb+0x118/0x130
cpuset\_write\_resmask+0xffc/0x1420
cgroup\_file\_write+0xb2/0x290
kernfs\_fop\_write\_iter+0x194/0x290
new\_sync\_write+0xeb/0x160
vfs\_write+0x16f/0x1d0
ksys\_write+0x81/0x180
\_\_x64\_sys\_write+0x21/0x30
x64\_sys\_call+0x2f25/0x4630
do\_syscall\_64+0x44/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x78/0xe2
RIP: 0033:0x7f44a553c887
It can be reproduced with cammands:
cd /sys/fs/cgroup/
mkdir test
cd test/
echo +cpuset > ../cgroup.subtree\_control
echo root > cpuset.cpus.partition
cat /sys/fs/cgroup/cpuset.cpus.effective
0-3
echo 0-3 > cpuset.cpus // taking away all cpus from root
This issue is caused by the incorrect rebuilding of scheduling domains.
In this scenario, test/cpuset.cpus.partition should be an invalid root
and should not trigger the rebuilding of scheduling domains. When calling
update\_parent\_effective\_cpumask with partcmd\_update, if newmask is not
null, it should recheck newmask whether there are cpus is available
for parect/cs that has tasks.
Fixes: 0c7f293efc87 ("cgroup/cpuset: Add cpuset.cpus.exclusive.effective for v2")
Cc: stable@vger.kernel.org # v6.7+
Signed-off-by: Chen Ridong <chenridong@huawei.com>
Signed-off-by: Waiman Long <longman@redhat.com>
Signed-off-by: Tejun Heo <tj@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=959ab6350add903e352890af53e86663739fcb9a)

| -rw-r--r-- | [kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/cgroup/cpuset.c?id=959ab6350add903e352890af53e86663739fcb9a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/kernel/cgroup/cpuset.c b/kernel/cgroup/cpuset.cindex 40ec4abaf4408f..a9b6d56eeffabe 100644--- a/[kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cgroup/cpuset.c?id=8400291e289ee6b2bf9779ff1c83a291501f017b)+++ b/[kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cgroup/cpuset.c?id=959ab6350add903e352890af53e86663739fcb9a)@@ -1991,6 +1991,8 @@ static int update\_parent\_effective\_cpumask(struct cpuset \*cs, int cmd, part\_error = PERR\_CPUSEMPTY; goto write\_error; }+ /\* Check newmask again, whether cpus are available for parent/cs \*/+ nocpu |= tasks\_nocpu\_error(parent, cs, newmask);  /\* \* partcmd\_update with newmask: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:43:59 +0000



=== Content from git.kernel.org_3f9a2946_20250111_164521.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chen Ridong <chenridong@huawei.com> | 2024-08-04 21:30:15 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:36:09 +0200 |
| commit | [73d6c6cf8ef6a3c532aa159f5114077746a372d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)) | |
| tree | [c16d4097477eadc78209b74dac8013b727f2b6c0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6) | |
| parent | [2073132f6ed3079369e857a8deb33d11bdd983bc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2073132f6ed3079369e857a8deb33d11bdd983bc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6&id2=2073132f6ed3079369e857a8deb33d11bdd983bc)) | |
| download | [linux-73d6c6cf8ef6a3c532aa159f5114077746a372d6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-73d6c6cf8ef6a3c532aa159f5114077746a372d6.tar.gz) | |

cgroup/cpuset: fix panic caused by partcmd\_updatecommit 959ab6350add903e352890af53e86663739fcb9a upstream.
We find a bug as below:
BUG: unable to handle page fault for address: 00000003
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP NOPTI
CPU: 3 PID: 358 Comm: bash Tainted: G W I 6.6.0-10893-g60d6
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/4
RIP: 0010:partition\_sched\_domains\_locked+0x483/0x600
Code: 01 48 85 d2 74 0d 48 83 05 29 3f f8 03 01 f3 48 0f bc c2 89 c0 48 9
RSP: 0018:ffffc90000fdbc58 EFLAGS: 00000202
RAX: 0000000100000003 RBX: ffff888100b3dfa0 RCX: 0000000000000000
RDX: 0000000000000000 RSI: 0000000000000000 RDI: 000000000002fe80
RBP: ffff888100b3dfb0 R08: 0000000000000001 R09: 0000000000000000
R10: ffffc90000fdbcb0 R11: 0000000000000004 R12: 0000000000000002
R13: ffff888100a92b48 R14: 0000000000000000 R15: 0000000000000000
FS: 00007f44a5425740(0000) GS:ffff888237d80000(0000) knlGS:0000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000100030973 CR3: 000000010722c000 CR4: 00000000000006e0
Call Trace:
<TASK>
? show\_regs+0x8c/0xa0
? \_\_die\_body+0x23/0xa0
? \_\_die+0x3a/0x50
? page\_fault\_oops+0x1d2/0x5c0
? partition\_sched\_domains\_locked+0x483/0x600
? search\_module\_extables+0x2a/0xb0
? search\_exception\_tables+0x67/0x90
? kernelmode\_fixup\_or\_oops+0x144/0x1b0
? \_\_bad\_area\_nosemaphore+0x211/0x360
? up\_read+0x3b/0x50
? bad\_area\_nosemaphore+0x1a/0x30
? exc\_page\_fault+0x890/0xd90
? \_\_lock\_acquire.constprop.0+0x24f/0x8d0
? \_\_lock\_acquire.constprop.0+0x24f/0x8d0
? asm\_exc\_page\_fault+0x26/0x30
? partition\_sched\_domains\_locked+0x483/0x600
? partition\_sched\_domains\_locked+0xf0/0x600
rebuild\_sched\_domains\_locked+0x806/0xdc0
update\_partition\_sd\_lb+0x118/0x130
cpuset\_write\_resmask+0xffc/0x1420
cgroup\_file\_write+0xb2/0x290
kernfs\_fop\_write\_iter+0x194/0x290
new\_sync\_write+0xeb/0x160
vfs\_write+0x16f/0x1d0
ksys\_write+0x81/0x180
\_\_x64\_sys\_write+0x21/0x30
x64\_sys\_call+0x2f25/0x4630
do\_syscall\_64+0x44/0xb0
entry\_SYSCALL\_64\_after\_hwframe+0x78/0xe2
RIP: 0033:0x7f44a553c887
It can be reproduced with cammands:
cd /sys/fs/cgroup/
mkdir test
cd test/
echo +cpuset > ../cgroup.subtree\_control
echo root > cpuset.cpus.partition
cat /sys/fs/cgroup/cpuset.cpus.effective
0-3
echo 0-3 > cpuset.cpus // taking away all cpus from root
This issue is caused by the incorrect rebuilding of scheduling domains.
In this scenario, test/cpuset.cpus.partition should be an invalid root
and should not trigger the rebuilding of scheduling domains. When calling
update\_parent\_effective\_cpumask with partcmd\_update, if newmask is not
null, it should recheck newmask whether there are cpus is available
for parect/cs that has tasks.
Fixes: 0c7f293efc87 ("cgroup/cpuset: Add cpuset.cpus.exclusive.effective for v2")
Cc: stable@vger.kernel.org # v6.7+
Signed-off-by: Chen Ridong <chenridong@huawei.com>
Signed-off-by: Waiman Long <longman@redhat.com>
Signed-off-by: Tejun Heo <tj@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)

| -rw-r--r-- | [kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/cgroup/cpuset.c?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/kernel/cgroup/cpuset.c b/kernel/cgroup/cpuset.cindex 5e468db9581045..b782fffd3cec1b 100644--- a/[kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cgroup/cpuset.c?id=2073132f6ed3079369e857a8deb33d11bdd983bc)+++ b/[kernel/cgroup/cpuset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cgroup/cpuset.c?id=73d6c6cf8ef6a3c532aa159f5114077746a372d6)@@ -1940,6 +1940,8 @@ static int update\_parent\_effective\_cpumask(struct cpuset \*cs, int cmd, part\_error = PERR\_CPUSEMPTY; goto write\_error; }+ /\* Check newmask again, whether cpus are available for parent/cs \*/+ nocpu |= tasks\_nocpu\_error(parent, cs, newmask);  /\* \* partcmd\_update with newmask: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:43:58 +0000


