

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Aleksander Jan Bajkowski <olek2@wp.pl> | 2021-05-21 16:45:58 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-03 08:59:15 +0200 |
| commit | [8bb1077448d43a871ed667520763e3b9f9b7975d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bb1077448d43a871ed667520763e3b9f9b7975d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)) | |
| tree | [7dd2d52b55484192ff8fd00d08b2df9b4139cea3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8bb1077448d43a871ed667520763e3b9f9b7975d) | |
| parent | [fda8f74d39751654e5acac95d1ab6874db949865](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fda8f74d39751654e5acac95d1ab6874db949865) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb1077448d43a871ed667520763e3b9f9b7975d&id2=fda8f74d39751654e5acac95d1ab6874db949865)) | |
| download | [linux-8bb1077448d43a871ed667520763e3b9f9b7975d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8bb1077448d43a871ed667520763e3b9f9b7975d.tar.gz) | |

net: lantiq: fix memory corruption in RX ring[ Upstream commit c7718ee96dbc2f9c5fc3b578abdf296dd44b9c20 ]
In a situation where memory allocation or dma mapping fails, an
invalid address is programmed into the descriptor. This can lead
to memory corruption. If the memory allocation fails, DMA should
reuse the previous skb and mapping and drop the packet. This patch
also increments rx drop counter.
Fixes: fe1a56420cf2 ("net: lantiq: Add Lantiq / Intel VRX200 Ethernet driver ")
Signed-off-by: Aleksander Jan Bajkowski <olek2@wp.pl>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8bb1077448d43a871ed667520763e3b9f9b7975d)

| -rw-r--r-- | [drivers/net/ethernet/lantiq\_xrx200.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/lantiq_xrx200.c?id=8bb1077448d43a871ed667520763e3b9f9b7975d) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 5 deletions

| diff --git a/drivers/net/ethernet/lantiq\_xrx200.c b/drivers/net/ethernet/lantiq\_xrx200.cindex 4e44a39267eb35..6ece99e6b6dde4 100644--- a/[drivers/net/ethernet/lantiq\_xrx200.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/lantiq_xrx200.c?id=fda8f74d39751654e5acac95d1ab6874db949865)+++ b/[drivers/net/ethernet/lantiq\_xrx200.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/lantiq_xrx200.c?id=8bb1077448d43a871ed667520763e3b9f9b7975d)@@ -154,6 +154,7 @@ static int xrx200\_close(struct net\_device \*net\_dev)  static int xrx200\_alloc\_skb(struct xrx200\_chan \*ch) {+ dma\_addr\_t mapping; int ret = 0;  ch->skb[ch->dma.desc] = netdev\_alloc\_skb\_ip\_align(ch->priv->net\_dev,@@ -163,16 +164,17 @@ static int xrx200\_alloc\_skb(struct xrx200\_chan \*ch) goto skip; } - ch->dma.desc\_base[ch->dma.desc].addr = dma\_map\_single(ch->priv->dev,- ch->skb[ch->dma.desc]->data, XRX200\_DMA\_DATA\_LEN,- DMA\_FROM\_DEVICE);- if (unlikely(dma\_mapping\_error(ch->priv->dev,- ch->dma.desc\_base[ch->dma.desc].addr))) {+ mapping = dma\_map\_single(ch->priv->dev, ch->skb[ch->dma.desc]->data,+ XRX200\_DMA\_DATA\_LEN, DMA\_FROM\_DEVICE);+ if (unlikely(dma\_mapping\_error(ch->priv->dev, mapping))) { dev\_kfree\_skb\_any(ch->skb[ch->dma.desc]); ret = -ENOMEM; goto skip; } + ch->dma.desc\_base[ch->dma.desc].addr = mapping;+ /\* Make sure the address is written before we give it to HW \*/+ wmb(); skip: ch->dma.desc\_base[ch->dma.desc].ctl = LTQ\_DMA\_OWN | LTQ\_DMA\_RX\_OFFSET(NET\_IP\_ALIGN) |@@ -196,6 +198,8 @@ static int xrx200\_hw\_receive(struct xrx200\_chan \*ch) ch->dma.desc %= LTQ\_DESC\_NUM;  if (ret) {+ ch->skb[ch->dma.desc] = skb;+ net\_dev->stats.rx\_dropped++; netdev\_err(net\_dev, "failed to allocate new rx buffer\n"); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:30:08 +0000

