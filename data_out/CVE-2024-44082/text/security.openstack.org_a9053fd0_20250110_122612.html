

Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2024-003: Unvalidated image data passed to qemu-img

# OSSA-2024-003: Unvalidated image data passed to qemu-img[Â¶](#ossa-2024-003-unvalidated-image-data-passed-to-qemu-img "Link to this heading")

Date:

September 04, 2024

CVE:

CVE-2024-44082

## Affects[Â¶](#affects "Link to this heading")

* Ironic: <21.4.3, >=22.0.0 <23.0.2, >=23.1.0 <24.1.2, >=25.0.0 <26.0.1
* Ironic-python-agent: <9.4.2, >=9.5.0 <9.7.1, >=9.8.0 <9.11.1, >=9.12.0 <9.13.1

## Description[Â¶](#description "Link to this heading")

Dan Smith and Julia Kreger of Red Hat and Jay Faulkner of G-Research
noticed a vulnerability in image processing for Ironic, in which a
specially crafted image could be used by an authenticated user to
exploit undesired behaviors in qemu-img, including possible unauthorized
access to potentially sensitive data.

### Mitigation[Â¶](#mitigation "Link to this heading")

The attached patches contain code allowing Ironic and the Ironic-Python-Agent
(IPA) to pre-screen images before passing them to qemu-img. You should
patch both of them because in some popular deployment configurations, it is
possible for images to bypass the Ironic conductor for more efficient image
downloads.

In situations where it is not possible to patch IPA, there is a new
configuration option, `[conductor]conductor_always_validates_images`.
When this option is True, all image downloads are forced to occur through
the Ironic conductor, where they are validated. However, this may incur
a significant performance hit; hence our recommendation to patch both Ironic
and IPA.

Patches are available for both Ironic and IPA for all maintained branches,
namely, the Dalmatian development branch (current master) through Antelope.
For these branches, `conductor_always_validates_images` defaults to False.

For the unmaintained branches (Zed through Victoria), patches are not
available for IPA due to a significant risk of regressions. For these
branches, the Ironic patches set `conductor_always_validates_images` to
True, as this is the only safe way to run Ironic with an un-patched IPA.

### Cached images[Â¶](#cached-images "Link to this heading")

Images in the Ironic image cache should be purged. To purge the cache,
stop the Ironic conductor and remove the files in the
`[pxe]instance_master_path` directory on that conductor node.

### Supported image formats[Â¶](#supported-image-formats "Link to this heading")

A new configuration option, `[conductor]permitted_image_formats` controls
what image formats will be accepted by Ironic. By default, the allowed
formats are ârawâ and âqcow2â, which are the only formats that Ironic is
tested with. In previous releases, it was possible to use images of other,
unsupported formats with Ironic, but this is now blocked by default due to
security issues arising from the image conversion process. It is possible,
though not recommended, to expand the list of permitted formats.
Alternatively, users requiring the use of an image in an unsupported format
can convert the image offline into a supported format before uploading the
image to Glance or otherwise making the image available to Ironic. Consult
the Ironic documentation for details.

### Warning[Â¶](#warning "Link to this heading")

As is well-documented, the OpenStack Ironic project does not support the
use of ironic-lib for non-Ironic use cases. In its normal supported context,
ironic-lib assumes that images have been pre-screened before ironic-lib
comes in contact with them. Thus, unsupported use of ironic-lib leaves
you vulnerable to the exploit outlined in this OSSA.

The Ironic project intends eventually to explicitly remove the vulnerable
methods in ironic-lib, but reminds the reader that independent use of
ironic-lib is not supported.

### Bugfix branches[Â¶](#bugfix-branches "Link to this heading")

Patches are available for maintained bugfix branches. These patches will
be merged to the maintained branches, but no new releases will be triggered
from those branches.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.opendev.org/927972> (2023.1/antelope(ironic))
* <https://review.opendev.org/927979> (2023.1/antelope(ironic-python-agent))
* <https://review.opendev.org/927970> (2023.2/bobcat(ironic))
* <https://review.opendev.org/927978> (2023.2/bobcat(ironic-python-agent))
* <https://review.opendev.org/927968> (2024.1/caracal(ironic))
* <https://review.opendev.org/927976> (2024.1/caracal(ironic-python-agent))
* <https://review.opendev.org/927965> (2024.2/dalmatian(ironic))
* <https://review.opendev.org/927974> (2024.2/dalmatian(ironic-python-agent))
* <https://review.opendev.org/927969> (Bugfix/24.0 (ironic))
* <https://review.opendev.org/927967> (Bugfix/25.0 (ironic))
* <https://review.opendev.org/927966> (Bugfix/26.0 (ironic))
* <https://review.opendev.org/927983> (Bugfix/9.12 (ironic-python-agent))
* <https://review.opendev.org/927981> (Bugfix/9.13 (ironic-python-agent))
* <https://review.opendev.org/927984> (Bugfix/9.9 (ironic-python-agent))
* <https://review.opendev.org/927982> (Unmaintained/victoria(ironic))
* <https://review.opendev.org/927980> (Unmaintained/wallaby(ironic))
* <https://review.opendev.org/927977> (Unmaintained/xena(ironic))
* <https://review.opendev.org/927975> (Unmaintained/yoga(ironic))
* <https://review.opendev.org/927973> (Unmaintained/zed(ironic))

## Credits[Â¶](#credits "Link to this heading")

* Dan Smith from Red Hat (CVE-2024-44082)
* Jay Faulkner from G-Research (CVE-2024-44082)
* Julia Kreger from Red Hat (CVE-2024-44082)

## References[Â¶](#references "Link to this heading")

* <https://launchpad.net/bugs/2071740>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44082>

## Notes[Â¶](#notes "Link to this heading")

* For more information about the unadvisability of calling âqemu-img
  infoâ on untrusted images, see CVE-2024-04467.
* The ironic unmaintained/\* branches will receive no point releases, but
  patches for them are provided as a courtesy.
* The ironic-python-agent unmaintained/\* branches will receive no point
  releases, nor are patches for them available.
* The ironic and ironic-python-agent bugfix/\* branches will receive no
  point releases, but patches for them are provided as a courtesy.

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2024-003: Unvalidated image data passed to qemu-img
  + [Affects](#affects)
  + [Description](#description)
    - [Mitigation](#mitigation)
    - [Cached images](#cached-images)
    - [Supported image formats](#supported-image-formats)
    - [Warning](#warning)
    - [Bugfix branches](#bugfix-branches)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).

