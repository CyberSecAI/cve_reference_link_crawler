<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/ironic/+bug/2071740/+index" />

    <meta charset="UTF-8" />
    <title>Bug #2071740 “[OSSA-2024-003] Unvalidated image data passed to q...” : Bugs : Ironic</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/@@/apple-touch-icon.png?v=2022" />
    <link rel="icon" type="image/png" sizes="32x32" href="/@@/favicon-32x32.png?v=2022" />
    <link rel="icon" type="image/png" sizes="16x16" href="/@@/favicon-16x16.png?v=2022" />
    <link rel="manifest" href="/@@/site.webmanifest?v=2022" />
    <link rel="mask-icon" href="/@@/safari-pinned-tab.svg?v=2022" color="#e9531f" />
    <link rel="shortcut icon" href="/@@/favicon.ico?v=2022" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="msapplication-config" content="/@@/browserconfig.xml?v=2022" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/2071740" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/2071740/bug.atom" title="Bug 2071740 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev6394e03793719e8d73f5a60b5439440e693c92f1/combo.css" />


    

    
      <meta name="description" content="It recently came to light that processing untrusted image data with qemu-based tools, such as qemu-img, is not expected to be secure.

ironic-lib's qemu_img module should validate images are as expected, and don't contain potentially harmful things such as QCOW2 backing file.

Additionally, we should avoid calling qemu-img without specifying the image type specifically as this is an additional layer of validation.

https://bugs.launchpad.net/nova/+bug/2059809 and associated patches can be use..." />
      <meta property="og:description" content="It recently came to light that processing untrusted image data with qemu-based tools, such as qemu-img, is not expected to be secure.

ironic-lib's qemu_img module should validate images are as expected, and don't contain potentially harmful things such as QCOW2 backing file.

Additionally, we should avoid calling qemu-img without specifying the image type specifically as this is an additional layer of validation.

https://bugs.launchpad.net/nova/+bug/2059809 and associated patches can be use..." />
    

    
    
      <meta property="og:title" content="Bug #2071740 “[OSSA-2024-003] Unvalidated image data passed to q...” : Bugs : Ironic" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad-og-image.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/2071740" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?lp/',
                    comboBase: '/+combo/rev6394e03793719e8d73f5a60b5439440e693c92f1/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["agent", "api", "conductor", "db", "devstack", "docs", "docs-audit-2024", "documentation", "drac", "driver", "gate", "i18n", "ilo", "install-guide", "ipmi", "iscsi", "low-hanging-fruit", "needs-spec", "nova-driver", "ops", "oslo", "pxe", "redfish", "rfe", "rfe-approved", "security", "snmp", "uefi"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/ironic/+bug/2071740/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/ironic"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/294367848/Ironic_mascot_color_64x64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/ironic">Ironic</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/ironic">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/ironic">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/ironic">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/ironic">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/ironic">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/ironic">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #2071740 reported by
      <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner</a>
      <time title="2024-07-02 21:41:52 UTC" datetime="2024-07-02T21:41:52.307786+00:00">on 2024-07-02</time>
      
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">278</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary3217153">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3217153">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ironic">Ironic</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3217153">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~juliaashleykreger">Julia Kreger</a>
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  


        
        
          
  <tr id="tasksummary3243528">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3243528">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3243528">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~brian-rosmaita">Brian Rosmaita</a>
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  


        
        
          
  <tr id="tasksummary3227471">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3227471">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ironic-lib">ironic-lib</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusTRIAGED">Triaged</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3227471">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~jason-oldos">Jay Faulkner</a>
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  


        
        
          
  <tr id="tasksummary3227472">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary3227472">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ironic-python-agent">ironic-python-agent</a>
        </span>
        
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary3227472">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~jason-oldos">Jay Faulkner</a>
            
          </span>
          
          
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  


        
      </tbody>

    </table>








      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>It recently came to light that processing untrusted image data with qemu-based tools, such as qemu-img, is not expected to be secure.</p>
<p>ironic-lib&#x27;s qemu_img module should validate images are as expected, and don&#x27;t contain potentially harmful things such as QCOW2 backing file.</p>
<p>Additionally, we should avoid calling qemu-img without specifying the image type specifically as this is an additional layer of validation.</p>
<p><a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/2059809">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/2059809</a> and associated patches can be used as an example of the potential fix we should do.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=bug">bug</a>
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=in-unmaintained-victoria">in-unmaintained-victoria</a>
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=in-unmaintained-wallaby">in-unmaintained-wallaby</a>
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=in-unmaintained-xena">in-unmaintained-xena</a>
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=in-unmaintained-yoga">in-unmaintained-yoga</a>
            <a class="unofficial-tag" href="/ironic/+bugs?field.tag=in-unmaintained-zed">in-unmaintained-zed</a>
          </span>
          
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2024-44082" title="This CVE was automatically created fr...">2024-44082</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2024-44982" title="This CVE was automatically created fr...">2024-44982</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~rpittau" class="sprite person">Riccardo Pittau (rpittau)</a>
    
    <time title="2024-07-08 12:35:34 UTC" datetime="2024-07-08T12:35:34.647209+00:00">on 2024-07-08</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: bug
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-15T14:48:43.511261+00:00" title="2024-07-15 14:48:43 UTC">on 2024-07-15</time><span class="editable-message-last-edit-date">
                <a href="#" class="editable-message-last-edit-link">(last edit <time itemprop="editTime" datetime="2024-07-15T15:03:48.985479+00:00" title="2024-07-15 15:03:48 UTC">on 2024-07-15</time>)</a>:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>After a conversation with Dan, it&#x27;s clear that simply calling `qemu-img *` on any untrusted image can lead to data being exfiltrated remotely from that machine (over the network) OR data (provided over the network) being written to the machine running qemu-img.</p>
<p>We must take the format_inspector class from nova/glance and validate incoming images, use the inspection module to determine what image it is, then run the safety check against it to make sure it contains no scary stuff for *any* possible format . This is a high severity vulnerability.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">After a conversation with Dan, it's clear that simply calling `qemu-img *` on any untrusted image can lead to data being exfiltrated remotely from that machine (over the network) OR data (provided over the network) being written to the machine running qemu-img.

We must take the format_inspector class from nova/glance and validate incoming images, use the inspection module to determine what image it is, then run the safety check against it to make sure it contains no scary stuff for *any* possible format . This is a high severity vulnerability.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Public &#8594; Private Security
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-15T21:11:34.306154+00:00" title="2024-07-15 21:11:34 UTC">on 2024-07-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ironic/+bug/2071740/comments/2/+download">Download full text</a> (4.4 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I also had a discussion with Dan in order to validate perceptions and ensure my understanding is correct.</p>
<p>In order to avoid breakages, I also think it is important to detail out the overall entry path for this data and how it is then picked up and used.</p>
<p>qemu-img convert is invoked in the following locations:</p>
<p>repository - path - Description - Further context</p>
<p>And any further notes required pertinent to the aforementioned item.</p>
<p>------</p>
<p>ironic - ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />roles/deploy/<wbr />tasks/write.<wbr />yaml - example and default ansible deploy interface playbook - Source field is Ironic node instance_info field parameter &quot;image_source&quot;. Executes on the remote host being deployed via a temporary ramdisk. It appears to leverage ironic&#x27;s stock image logic used for the agent to prepare an accessible image, and execute qemu-img when the identified disk format != &#x27;raw&#x27;. The code shortens the name from image_url to image.url as a parameter, so rooted in whatever ironic saves as a known image_url. image_disk_format should also be consulted.</p>
<p>------</p>
<p>ironic-python-agent - ironic_<wbr />python_<wbr />agent/extension<wbr />s/standby.<wbr />py - not an actual invocation - The command is formatted for logging purposes for the user, but the actual call is via ironic_lib.qemu_img module.</p>
<p>In this specific case, it should be noted that in If8fae8210d85c6<wbr />1abb85c388b300e<wbr />40a75d0531c this was previously ironic_<wbr />lib.disk_<wbr />utils which is where the code was invoked.</p>
<p>In I0caa65561948f4<wbr />e0934943a7a0d3a<wbr />209701b5a59, dated May 26, 2021, (meaning after the wallaby branch, sometime in the xena branch), the code was changed from an external script to in-python code in ironic-lib.</p>
<p>It should be noted the partition image code path for the agent *always* invoked through ironic_lib as well with upfront identified image_info context.</p>
<p>These operations utilize the image transferred/<wbr />downloaded the ImageDownload class where the file is staged on disk (unless already raw), and then called to the write-out sequence. This uses the same format path as the image_source logic -&gt; image_url logic in the conductor, and thus independently needs to have guard logic applied.</p>
<p>----- End of list of non-ironic lib invocations</p>
<p>For the purposes of level settings: The overall flow is image_source is set to a file path on conductor, glance image uuid, or a URL to the image to write.</p>
<p>Then the deploy_interface driver triggers setting the state to facilitate deploy. Two call paths generally exist: Validation flows and then flows triggered through deployment actions where interfaces are called to trigger deployment and which actually attempts to access the image and it&#x27;s contents.</p>
<p>This uniformly happens through deploy_<wbr />utils.build_<wbr />instance_<wbr />info_for_<wbr />deploy for the AnacondaDeploy interface, Agent deploy interface, and Ansible deployment interface.</p>
<p>This means conductor side, the obvious place to perform any extra logic in ironic itself is deploy_<wbr />utils._<wbr />cache_and_<wbr />convert_<wbr />image along with deploy_<wbr />utils.build_<wbr />instance_<wbr />info_for_<wbr />deploy which rewrites the user_info and enumerates available URLs such as those from swift storage.</p>
<p>This may mean we also need to have a mandatory retrieval of the image in the event an agent would nor...</p></div>
    
    <p>
      <a href="/ironic/+bug/2071740/comments/2">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I also had a discussion with Dan in order to validate perceptions and ensure my understanding is correct. 

In order to avoid breakages, I also think it is important to detail out the overall entry path for this data and how it is then picked up and used.

qemu-img convert is invoked in the following locations:

repository - path - Description - Further context

And any further notes required pertinent to the aforementioned item.

------

ironic - ironic/drivers/modules/ansible/playbooks/roles/deploy/tasks/write.yaml - example and default ansible deploy interface playbook - Source field is Ironic node instance_info field parameter "image_source". Executes on the remote host being deployed via a temporary ramdisk. It appears to leverage ironic's stock image logic used for the agent to prepare an accessible image, and execute qemu-img when the identified disk format != 'raw'. The code shortens the name from image_url to image.url as a parameter, so rooted in whatever ironic saves as a known image_url. image_disk_format should also be consulted.

------

ironic-python-agent - ironic_python_agent/extensions/standby.py - not an actual invocation - The command is formatted for logging purposes for the user, but the actual call is via ironic_lib.qemu_img module.

In this specific case, it should be noted that in If8fae8210d85c61abb85c388b300e40a75d0531c this was previously ironic_lib.disk_utils which is where the code was invoked.

In I0caa65561948f4e0934943a7a0d3a209701b5a59, dated May 26, 2021, (meaning after the wallaby branch, sometime in the xena branch), the code was changed from an external script to in-python code in ironic-lib.

It should be noted the partition image code path for the agent *always* invoked through ironic_lib as well with upfront identified image_info context.

These operations utilize the image transferred/downloaded the ImageDownload class where the file is staged on disk (unless already raw), and then called to the write-out sequence. This uses the same format path as the image_source logic -&gt; image_url logic in the conductor, and thus independently needs to have guard logic applied.

----- End of list of non-ironic lib invocations

For the purposes of level settings: The overall flow is image_source is set to a file path on conductor, glance image uuid, or a URL to the image to write.

Then the deploy_interface driver triggers setting the state to facilitate deploy. Two call paths generally exist: Validation flows and then flows triggered through deployment actions where interfaces are called to trigger deployment and which actually attempts to access the image and it's contents.

This uniformly happens through deploy_utils.build_instance_info_for_deploy for the AnacondaDeploy interface, Agent deploy interface, and Ansible deployment interface. 

This means conductor side, the obvious place to perform any extra logic in ironic itself is deploy_utils._cache_and_convert_image along with deploy_utils.build_instance_info_for_deploy which rewrites the user_info and enumerates available URLs such as those from swift storage.

This may mean we also need to have a mandatory retrieval of the image in the event an agent would normally just download the supplied url so it can be pre-flight validated as well, which would likely be the sanest backportable high security path.

That way, the conductor would pre-flight validate content before any further action and guard the direct supplied argument path which is also inherently supported.

The big question largely is what shape, does it exactly take take with ironic-lib then wiring things through, on a plus side, the related data about the image is fairly uniformly handled and generated in that one place as well.

The code in ironic-lib has moved around some. In latest, this is all in ironic_lib/qemu-img.py in the methods image_info and convert image. Both of which will need additional arguments passed in to specify the input image form. In older versions of ironic_lib, those methods are in disk_utils.

Partly I have to wonder if we patch the library to take additional arguments, and put most of the inspection of the file base logic in ironic itself, since the actual ironic_lib methods are highly specific and backport fix wise, are likley going to also have to handle an intermediate fixed state where we cannot provide an argument of the input type to the conversion.

A little more discussion required before we should jump into the end of copying code.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-16T13:52:21.903024+00:00" title="2024-07-16 13:52:21 UTC">on 2024-07-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I recommend also subscribing Dan to this bug, since he&#x27;s very familiar with the malicious image mitigations that have been put into place in other OpenStack projects in recent years. Ideally, Ironic will take the same precautions that are planned for inclusion in the upcoming image inspector planned for Oslo.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I recommend also subscribing Dan to this bug, since he's very familiar with the malicious image mitigations that have been put into place in other OpenStack projects in recent years. Ideally, Ironic will take the same precautions that are planned for inclusion in the upcoming image inspector planned for Oslo.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-16T15:17:29.920411+00:00" title="2024-07-16 15:17:29 UTC">on 2024-07-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Dan has been consulting with us on this already, I added him to the bug for completeness.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Dan has been consulting with us on this already, I added him to the bug for completeness.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-16T15:42:31.100430+00:00" title="2024-07-16 15:42:31 UTC">on 2024-07-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>As a note: for the integrated Ironic case, we only use public glance images -- we believe this normally requires admin privs to mark an image as public? This should limit the blast radius for the integrated ironic case.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">As a note: for the integrated Ironic case, we only use public glance images -- we believe this normally requires admin privs to mark an image as public? This should limit the blast radius for the integrated ironic case.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-17T22:59:07.228434+00:00" title="2024-07-17 22:59:07 UTC">on 2024-07-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I chatted with JayF some more today, and I&#x27;ve been making good progress on a fix for ironic itself, but it has raised a couple questions we need to ask ourselves.</p>
<p>But first, the approach.</p>
<p>For ironic, I&#x27;ve wired in validation logic which calls the image format inspector, triggers it&#x27;s safety (rejects if it is false) check, records the image format which we detect, unwires the qemu-img info call and routes it to the image format inspector, compares that with what we are told by a user or glance (depending on flow &amp;&amp; rejects the request if they don&#x27;t match), all controlled by a giant knob.</p>
<p>This unfortunately has meant some extra wiring through the image cache and deployment utilities logic which all drivers use, but in the grand scheme it is not *that* bad.</p>
<p>If at any point in this flow things don&#x27;t look right, we will return with an InvalidImage error which will log a more verbose error in the logs. Ironic conductor will also inspect any image we tell a node to deploy *as well* which adds more conductor load, but it does provide a greater level of saftey and abort the overall process far before anything gets to the node or an instance of qemu-img.</p>
<p>For inspector, I suspect we&#x27;ll take a very similar approach, check/compare with image_inspector, and fail the write request if things don&#x27;t pass validation.</p>
<p>This leaves the outstanding major question of ironic-lib and the fact we&#x27;ve centralized all qemu-img call logic there. The basic issue is today, we&#x27;ve got to add another argument to inform the qemu-img execution of the expected file format. If we carry the qemu-img calls in the backports *instead*, that saves us the need to backport anything on ironic-lib, in other words saves us a third of backports, and saves us needing to have compatibility logic which could mask the fix from being in place in any changes we backport. Jay and I are both leaning towards lifting the ironic-lib qemu-img call stuffs directly out and placing in the same patch stream. This opens a window for us to determine the correct path for ironic-lib&#x27;s future, but that is outside of this issue&#x27;s scope. The plus side is ironic-lib&#x27;s docs say &quot;this is only for use by ironic, do not use&quot;.</p>
<p>As for where I&#x27;m at right now, I likely have another day or two of fixing and writing unit tests in order to get us into a preliminary patch position for Ironic, and then I&#x27;ll start on ironic-<wbr />python-<wbr />agent. The open question of the actual qemu-img calls will guide things from there.</p>
<p>I have a business trip next week which will impact the time I can focus on this next week, but we&#x27;re concurrently working to also get CI in a healthy shape for stable and open unmaintained branches.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I chatted with JayF some more today, and I've been making good progress on a fix for ironic itself, but it has raised a couple questions we need to ask ourselves.

But first, the approach.

For ironic, I've wired in validation logic which calls the image format inspector, triggers it's safety (rejects if it is false) check, records the image format which we detect, unwires the qemu-img info call and routes it to the image format inspector, compares that with what we are told by a user or glance (depending on flow &amp;&amp; rejects the request if they don't match), all controlled by a giant knob.

This unfortunately has meant some extra wiring through the image cache and deployment utilities logic which all drivers use, but in the grand scheme it is not *that* bad.

If at any point in this flow things don't look right, we will return with an InvalidImage error which will log a more verbose error in the logs. Ironic conductor will also inspect any image we tell a node to deploy *as well* which adds more conductor load, but it does provide a greater level of saftey and abort the overall process far before anything gets to the node or an instance of qemu-img.

For inspector, I suspect we'll take a very similar approach, check/compare with image_inspector, and fail the write request if things don't pass validation.

This leaves the outstanding major question of ironic-lib and the fact we've centralized all qemu-img call logic there. The basic issue is today, we've got to add another argument to inform the qemu-img execution of the expected file format. If we carry the qemu-img calls in the backports *instead*, that saves us the need to backport anything on ironic-lib, in other words saves us a third of backports, and saves us needing to have compatibility logic which could mask the fix from being in place in any changes we backport. Jay and I are both leaning towards lifting the ironic-lib qemu-img call stuffs directly out and placing in the same patch stream. This opens a window for us to determine the correct path for ironic-lib's future, but that is outside of this issue's scope. The plus side is ironic-lib's docs say "this is only for use by ironic, do not use".

As for where I'm at right now, I likely have another day or two of fixing and writing unit tests in order to get us into a preliminary patch position for Ironic, and then I'll start on ironic-python-agent. The open question of the actual qemu-img calls will guide things from there.

I have a business trip next week which will impact the time I can focus on this next week, but we're concurrently working to also get CI in a healthy shape for stable and open unmaintained branches.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-19T16:53:58.683165+00:00" title="2024-07-19 16:53:58 UTC">on 2024-07-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have a patch almost done for ironic, and the ironic-python-agent seems fairly straight forward to implement, and I should have patches up for both on Monday. The outstanding question is largely the how to handle the ironic-lib portion which impacts both patches. I&#x27;m anticipating to have that discussion with another core (Dmitry Tantsur) on Monday morning to help solidify the plan there.</p>
<p>In regards to ironic itself, I am a little worried the check logic might be a little bit *too* aggressive and possibly cause problems with retrieval of admins supplied kernels and ramdisks because I&#x27;ve wired this all into the image caching in ironic.</p>
<p>Once we have patches posted, we can likely start testing efforts since we&#x27;re going to need to do some extensive testing to ensure we didn&#x27;t inadvertently break anything else and have appropriate guards in place.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have a patch almost done for ironic, and the ironic-python-agent seems fairly straight forward to implement, and I should have patches up for both on Monday. The outstanding question is largely the how to handle the ironic-lib portion which impacts both patches. I'm anticipating to have that discussion with another core (Dmitry Tantsur) on Monday morning to help solidify the plan there.

In regards to ironic itself, I am a little worried the check logic might be a little bit *too* aggressive and possibly cause problems with retrieval of admins supplied kernels and ramdisks because I've wired this all into the image caching in ironic.

Once we have patches posted, we can likely start testing efforts since we're going to need to do some extensive testing to ensure we didn't inadvertently break anything else and have appropriate guards in place.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-19T17:21:37.887615+00:00" title="2024-07-19 17:21:37 UTC">on 2024-07-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Nova had a regression handling ISO files and the VMDK restrictions in place in format_inspector right now preclude the use of some VMDK files with an amended header (like a multi-session ISO). Both of these are either resolved now or have patches. I think it&#x27;s not unexpected that tightening things down a lot will have some unintended fallout here, which is arguably better than the alternative.</p>
<p>We also put a knob on the deep inspection so that someone who is willing to accept the risk (or mitigates it with another strategy, like airgap or disabling new image uploads) has a way out in the meantime while the fallout gets cleaned up. I expect the same would be appropriate for ironic.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Nova had a regression handling ISO files and the VMDK restrictions in place in format_inspector right now preclude the use of some VMDK files with an amended header (like a multi-session ISO). Both of these are either resolved now or have patches. I think it's not unexpected that tightening things down a lot will have some unintended fallout here, which is arguably better than the alternative.

We also put a knob on the deep inspection so that someone who is willing to accept the risk (or mitigates it with another strategy, like airgap or disabling new image uploads) has a way out in the meantime while the fallout gets cleaned up. I expect the same would be appropriate for ironic.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-19T17:55:19.507368+00:00" title="2024-07-19 17:55:19 UTC">on 2024-07-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Okay, I just realized I have a little more work to do on the ironic side because I also have to patch out the Ansible deployment interface as well. In the grand scheme of things, not that much more.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Okay, I just realized I have a little more work to do on the ironic side because I also have to patch out the Ansible deployment interface as well. In the grand scheme of things, not that much more.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-22T18:16:27.217887+00:00" title="2024-07-22 18:16:27 UTC">on 2024-07-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I had a chat with Dmitry Tantsur where he basically guessed we were looking at qemu. Initially he was very much into the model of patching ironic-lib, but upon discussion and explanation of the variety of issues with the full understanding that this is an embargoed issue, I think he is onboard with just carrying the convert call. He definitely is not a fan of the approach, but understands. I think that is kind of the same situation we&#x27;re all in, since trying to route around and enable ironic-lib backports also complicates shipping a complete fix overall.</p>
<p>As for patches, I doub&#x27;t I&#x27;ll have patches up today, but might. Basically my flight got cancelled because the crew would have timed out and fallout from the massive issues late last week, so I&#x27;m now booked to fly tonight.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I had a chat with Dmitry Tantsur where he basically guessed we were looking at qemu. Initially he was very much into the model of patching ironic-lib, but upon discussion and explanation of the variety of issues with the full understanding that this is an embargoed issue, I think he is onboard with just carrying the convert call. He definitely is not a fan of the approach, but understands. I think that is kind of the same situation we're all in, since trying to route around and enable ironic-lib backports also complicates shipping a complete fix overall.

As for patches, I doub't I'll have patches up today, but might. Basically my flight got cancelled because the crew would have timed out and fallout from the massive issues late last week, so I'm now booked to fly tonight.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-25T16:20:13.015987+00:00" title="2024-07-25 16:20:13 UTC">on 2024-07-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>First pass patch on a fix. Have not tested in a running environment, but passes unit tests/pep8.</p>
<p>It is a centralized fix for ironic so attempts get caught before IPA is engaged. We still need to patch IPA, but that is relatively trivial to do. This is fairly invasive and this ultimately doesn&#x27;t directly fix ironic-lib, but ceases ironic from using the ironic lib convert image code.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">First pass patch on a fix. Have not tested in a running environment, but passes unit tests/pep8.

It is a centralized fix for ironic so attempts get caught before IPA is engaged. We still need to patch IPA, but that is relatively trivial to do. This is fairly invasive and this ultimately doesn't directly fix ironic-lib, but ceases ironic from using the ironic lib convert image code.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
    
    <time title="2024-07-26 17:50:07 UTC" datetime="2024-07-26T17:50:07.810233+00:00">on 2024-07-26</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>affects</b>:
      </td>
      <td>
        ironic-lib &#8594; ironic
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ironic-lib: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Triaged
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ironic-python-agent: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Triaged
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-26T21:38:29.891151+00:00" title="2024-07-26 21:38:29 UTC">on 2024-07-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have a concern after reviewing the code, but I&#x27;m unsure if we can resolve it or just document it -- AFAICT, the ansible driver does not use the image cache code, and so even though we do the safer thing of passing the image type to qemu-img, we aren&#x27;t doing a safety check on that image. Given the ansible deploy driver is not intended for most use cases, we could document a limitation to only use it with trusted images and it&#x27;d potentially be fine?</p>
<p>That&#x27;s the only super concerning thing I&#x27;ve seen while reviewing it. I&#x27;ll do some testing in devstack with the bad images collection over the weekend to see if I can find a hole.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have a concern after reviewing the code, but I'm unsure if we can resolve it or just document it -- AFAICT, the ansible driver does not use the image cache code, and so even though we do the safer thing of passing the image type to qemu-img, we aren't doing a safety check on that image. Given the ansible deploy driver is not intended for most use cases, we could document a limitation to only use it with trusted images and it'd potentially be fine?

That's the only super concerning thing I've seen while reviewing it. I'll do some testing in devstack with the bad images collection over the weekend to see if I can find a hole.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-26T22:05:41.219456+00:00" title="2024-07-26 22:05:41 UTC">on 2024-07-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I chatted with Jay Faulkner and pointed out where the code path for the ansible deploy interface does indeed invoke the code which drives the caching action. It is slightly confusing because in deploy_utils it is the preparation of instance_info which also triggers image download/caching operations.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I chatted with Jay Faulkner and pointed out where the code path for the ansible deploy interface does indeed invoke the code which drives the caching action. It is slightly confusing because in deploy_utils it is the preparation of instance_info which also triggers image download/caching operations.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-26T22:12:14.347866+00:00" title="2024-07-26 22:12:14 UTC">on 2024-07-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>++ Confirmed my concern is dealt with.</p>
<p>The patch I&#x27;m about to post contains minimal changes:<br />
- Rebased against latest-master Ironic<br />
- Created patch with git format-patch so it can contain commit message + other metadata<br />
- Fixed various minor issues preventing all tox environments (codespell) from passing<br />
- Updated the release note to inform operators of the massive change in I/O use for conductors in swift-temp-url usage cases.</p>
<p>I&#x27;ll then dedicate some time this weekend to getting a bad image through the fix. I&#x27;ll update here if that testing ends up breaking something.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">++ Confirmed my concern is dealt with.

The patch I'm about to post contains minimal changes:
- Rebased against latest-master Ironic
- Created patch with git format-patch so it can contain commit message + other metadata
- Fixed various minor issues preventing all tox environments (codespell) from passing
- Updated the release note to inform operators of the massive change in I/O use for conductors in swift-temp-url usage cases.

I'll then dedicate some time this weekend to getting a bad image through the fix. I'll update here if that testing ends up breaking something.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          

          
              <div>
  <div id="comments-container"></div>
  <div class="boardComment comments-hidden-message" style="border-bottom: 0">
    <div class="boardCommentDetails">
      <table>
        <tbody>
          <tr>
            <td>
              <span class="sprite arrowRight"></span>
              1 comments hidden
              <span id="more-comments-spinner" class="hidden">
                Loading more comments
                <img src="/@@/spinner" />
              </span>
            </td>

            <td class="bug-comment-index">
              <a href="?comments=all" id="show-comments-link" class="show-comments-link sprite retry" style="white-space: nowrap">
                 view all 158 comments</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-28T21:20:12.602753+00:00" title="2024-07-28 21:20:12 UTC">on 2024-07-28</time><span class="editable-message-last-edit-date">
                <a href="#" class="editable-message-last-edit-link">(last edit <time itemprop="editTime" datetime="2024-07-28T21:22:37.857008+00:00" title="2024-07-28 21:22:37 UTC">on 2024-07-28</time>)</a>:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5801053/+files/image_test.bash" class="sprite download-icon">image_test.bash</a>
        <a class="sprite edit action-icon" href="/ironic/+bug/2071740/+attachment/5801053">Edit</a>
        
        (1.2 KiB,
        text/plain)
        
      </li>
    </ul>

    

    

  <a href="https://bugs.launchpad.net/ironic/+bug/2071740/comments/16/+download">Download full text</a> (5.3 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I performed some testing against the above patch, using the following methodology:</p>
<p>On a local vm configured with the &quot;Ironic w/Nova&quot; devstack config, as documented here: <a rel="nofollow" href="https://docs.openstack.org/ironic/latest/contributor/devstack-guide.html#ironic-with-nova">https:/<wbr />/docs.openstack<wbr />.org/ironic/<wbr />latest/<wbr />contributor/<wbr />devstack-<wbr />guide.html#<wbr />ironic-<wbr />with-nova</a> . After applying the above patch and restarting Ironic services, I used the attached script to setup Ironic for deployment and allow me to manually observe the results. Note that this does not do the proper network setup for a deployment to entirely succeed, but it does get them far enough to get the image cached which is sufficient for testing purposes. Below, when a failure or something interesting occurs, I will explain and provide log snippets if relevant.</p>
<p>The images used for test were provided to me by Dan Smith and I&#x27;m setting my success/failure expectations based on the self-documenting names. I hosted them on a local http server and exercised Ironic in standalone mode as to avoid any interaction with mitigations already merged in Glance/Nova. Each image was tested both with image_disk_format set to their actual format (iso, qcow2, vmdk, etc) and set to raw. An &quot;OK&quot; indicates in all cases the image was detected as expected and failed, or if it&#x27;s a known good image it worked if expected.</p>
<p>OK bad-iso-<wbr />with-qcow.<wbr />iso<br />
OK bad-qcow-<wbr />with-backing.<wbr />qcow2<br />
OK bad-qcow-<wbr />with-datafile.<wbr />qcow2<br />
OK bad-qed.qed<br />
----</p>
<p>FAILED bad-vmdk-<wbr />flat-expose.<wbr />qcow2</p>
<p>Did not detect this as a bad image, both with image_disk_format set to qcow2 and set to raw. I&#x27;ll note that the unexpected thing below is the *lack* of any messages indicating the image is dangerous, which were printed in the other cases.</p>
<p>image_disk_<wbr />format=<wbr />raw:</p>
<p>Jul 28 20:13:44 ubuntu ironic-<wbr />conductor[<wbr />858234]<wbr />: DEBUG ironic.<wbr />drivers.<wbr />modules.<wbr />deploy_<wbr />utils [None req-960a4ca2-<wbr />08ab-49d2-<wbr />af1b-e51a80efd6<wbr />53 None None] Computed sha512 checksum for image /var/lib/<wbr />ironic/<wbr />images/<wbr />cd4e6b83-<wbr />0148-42c9-<wbr />947e-ba00b2e44f<wbr />e1/disk in 0.00 seconds, checksum value: feb82444c3e39ef<wbr />0105128eaa5e065<wbr />46f6265cb02b6b5<wbr />274474d9d597dc8<wbr />91c19685d9c2f9d<wbr />21211ffbb70ad46<wbr />ef6c02f6d44720d<wbr />d47ad0f7aae8392<wbr />4bd0de19.<br />
Jul 28 20:13:44 ubuntu ironic-<wbr />conductor[<wbr />858234]<wbr />: DEBUG ironic.<wbr />drivers.<wbr />modules.<wbr />deploy_<wbr />utils [None req-960a4ca2-<wbr />08ab-49d2-<wbr />af1b-e51a80efd6<wbr />53 None None] Start computing sha512 checksum for image /var/lib/<wbr />ironic/<wbr />images/<wbr />cd4e6b83-<wbr />0148-42c9-<wbr />947e-ba00b2e44f<wbr />e1/disk.<br />
Jul 28 20:13:44 ubuntu ironic-<wbr />conductor[<wbr />858234]<wbr />: DEBUG ironic.<wbr />drivers.<wbr />modules.<wbr />deploy_<wbr />utils [None req-960a4ca2-<wbr />08ab-49d2-<wbr />af1b-e51a80efd6<wbr />53 None None] Recalculating checksum for image /var/lib/<wbr />ironic/<wbr />images/<wbr />cd4e6b83-<wbr />0148-42c9-<wbr />947e-ba00b2e44f<wbr />e1/disk for node cd4e6b83-<wbr />0148-42c9-<wbr />947e-ba00b2e44f<wbr />e1 due to image conversion<br />
Jul 28 20:13:44 ubuntu ironic-<wbr />conductor[<wbr />858234]<wbr />: DEBUG ironic.<wbr />drivers.<wbr />modules.<wbr />image_cache [None req-960a4ca2-<wbr />08ab-49d2-<wbr />af1b-e51a80efd6<wbr />53 None None] Master cache hit for image <a rel="nofollow" href="http://nope:8000/bad-vmdk-flat-expose.qcow2">http://<wbr />nope:8000/<wbr />bad-vmdk-<wbr />flat-expose.<wbr />qcow2</a><br />
Jul 28 20:13:44 ubuntu ironic-<wbr />conductor[<wbr />858234]<wbr />: DEBUG ironic.<wbr />drivers.<wbr />modules.<wbr />deploy_<wbr />utils [None req-960a4ca2-<wbr />08ab-49d2-<wbr />af1b-e51a80efd6<wbr />53 None None] Fetching image <a rel="nofollow" href="http://nope:8000/bad-vmdk-flat-expose.qcow2">http://<wbr />nope:8000/<wbr />bad-vmdk-<wbr />flat-expose.<wbr />qcow2</a> for node cd4e6b83-<wbr />0148-42c9-<wbr />947e-ba00b2e44f<wbr />e1</p>
<p>image_disk_<wbr />format=<wbr />qcow2:</p>
<p>Jul 28 20:07:42 ubuntu ironic...</p></div>
    
    <p>
      <a href="/ironic/+bug/2071740/comments/16">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I performed some testing against the above patch, using the following methodology:

On a local vm configured with the "Ironic w/Nova" devstack config, as documented here: https://docs.openstack.org/ironic/latest/contributor/devstack-guide.html#ironic-with-nova . After applying the above patch and restarting Ironic services, I used the attached script to setup Ironic for deployment and allow me to manually observe the results. Note that this does not do the proper network setup for a deployment to entirely succeed, but it does get them far enough to get the image cached which is sufficient for testing purposes. Below, when a failure or something interesting occurs, I will explain and provide log snippets if relevant.

The images used for test were provided to me by Dan Smith and I'm setting my success/failure expectations based on the self-documenting names. I hosted them on a local http server and exercised Ironic in standalone mode as to avoid any interaction with mitigations already merged in Glance/Nova. Each image was tested both with image_disk_format set to their actual format (iso, qcow2, vmdk, etc) and set to raw. An "OK" indicates in all cases the image was detected as expected and failed, or if it's a known good image it worked if expected.

OK bad-iso-with-qcow.iso
OK bad-qcow-with-backing.qcow2
OK bad-qcow-with-datafile.qcow2
OK bad-qed.qed
----

FAILED bad-vmdk-flat-expose.qcow2

Did not detect this as a bad image, both with image_disk_format set to qcow2 and set to raw. I'll note that the unexpected thing below is the *lack* of any messages indicating the image is dangerous, which were printed in the other cases.

image_disk_format=raw:

Jul 28 20:13:44 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.deploy_utils [None req-960a4ca2-08ab-49d2-af1b-e51a80efd653 None None] Computed sha512 checksum for image /var/lib/ironic/images/cd4e6b83-0148-42c9-947e-ba00b2e44fe1/disk in 0.00 seconds, checksum value: feb82444c3e39ef0105128eaa5e06546f6265cb02b6b5274474d9d597dc891c19685d9c2f9d21211ffbb70ad46ef6c02f6d44720dd47ad0f7aae83924bd0de19. 
Jul 28 20:13:44 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.deploy_utils [None req-960a4ca2-08ab-49d2-af1b-e51a80efd653 None None] Start computing sha512 checksum for image /var/lib/ironic/images/cd4e6b83-0148-42c9-947e-ba00b2e44fe1/disk. 
Jul 28 20:13:44 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.deploy_utils [None req-960a4ca2-08ab-49d2-af1b-e51a80efd653 None None] Recalculating checksum for image /var/lib/ironic/images/cd4e6b83-0148-42c9-947e-ba00b2e44fe1/disk for node cd4e6b83-0148-42c9-947e-ba00b2e44fe1 due to image conversion 
Jul 28 20:13:44 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.image_cache [None req-960a4ca2-08ab-49d2-af1b-e51a80efd653 None None] Master cache hit for image http://nope:8000/bad-vmdk-flat-expose.qcow2 
Jul 28 20:13:44 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.deploy_utils [None req-960a4ca2-08ab-49d2-af1b-e51a80efd653 None None] Fetching image http://nope:8000/bad-vmdk-flat-expose.qcow2 for node cd4e6b83-0148-42c9-947e-ba00b2e44fe1 

image_disk_format=qcow2:

Jul 28 20:07:42 ubuntu ironic-conductor[858234]: DEBUG ironic.common.images [None req-f06eee47-1d74-49ee-8d5d-ba77eb53db51 None None] Image http://nope:8000/bad-vmdk-flat-expose.qcow2 downloaded in 0.00 seconds.
Jul 28 20:07:42 ubuntu ironic-conductor[858234]: DEBUG ironic.common.images [None req-f06eee47-1d74-49ee-8d5d-ba77eb53db51 None None] Using HttpImageService to download image http://nope:8000/bad-vmdk-flat-expose.qcow2.
Jul 28 20:07:42 ubuntu ironic-conductor[858234]: INFO ironic.drivers.modules.image_cache [None req-f06eee47-1d74-49ee-8d5d-ba77eb53db51 None None] Master cache miss for image http://nope:8000/bad-vmdk-flat-expose.qcow2, will download
Jul 28 20:07:42 ubuntu ironic-conductor[858234]: DEBUG ironic.drivers.modules.deploy_utils [None req-f06eee47-1d74-49ee-8d5d-ba77eb53db51 None None] Fetching image http://nope:8000/bad-vmdk-flat-expose.qcow2 for node 81f534c2-5b8b-4eaf-a0f7-dae2cadbada8 

----

FAILED bad-vmdk-flat-expose.vmdk

When specifying vmdk, this fails as an image type mismatch: we specified vmdk; it was detected as raw. "Security: The requested deploy image for node image cache has a format (raw) which does not match the expected image format (vmdk)"

When specifying raw, this passed image sanity checking as a raw image.

----

OK bad-vmdk-sparse-nbdurl.vmdk

----

OK good.iso 

Note: regardless of image type set to iso or raw, we detected it as a good iso image but disallowed by the new, default config:

Jul 28 20:30:49 ubuntu ironic-conductor[858234]: WARNING ironic.common.images [None req-33c12d14-77ee-4677-9cbf-9a7e6fa31cb2 None None] Security: The requested deploy image for node image cache is of format image iso and is not in the [conductor]permitted_image_formats list.

OK good-qcow.qcow2
OK good-raw.raw

----

OK good-sparse-vmdk.vmdk
OK good-stream-vmdk.vmdk
-&gt; regardless of image type set to vmdk or raw, we detected it as a good vmdk image but disallowed by the new, default config (similar logs for all 4 cases)

Jul 28 20:44:58 ubuntu ironic-conductor[858234]: WARNING ironic.common.images [None req-17897f8e-69ee-419e-abf8-b3040885db2c None None] Security: The requested deploy image for node image cache is of format image vmdk and is not in the [conductor]permitted_image_formats list.

----
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~divius" class="sprite person">Dmitry Tantsur (divius)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T11:33:20.210650+00:00" title="2024-07-29 11:33:20 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>As I told Julia the other day, I have serious concerns with duplicating not just ironic_lib.qemu_img but also a huge new module in both Ironic and IPA. I&#x27;m still not sure why this code cannot go to ironic-lib where it is now. At this rate, I&#x27;ll probably -1 the patch once it&#x27;s public.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">As I told Julia the other day, I have serious concerns with duplicating not just ironic_lib.qemu_img but also a huge new module in both Ironic and IPA. I'm still not sure why this code cannot go to ironic-lib where it is now. At this rate, I'll probably -1 the patch once it's public.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~divius" class="sprite person">Dmitry Tantsur (divius)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T11:42:03.955606+00:00" title="2024-07-29 11:42:03 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>A positive side effect: doing it in ironic-lib will enforce that no access to qemu bypasses the security checks (ignoring the ansible deploy, which I&quot;m not even sure we should fix given its nature). Judging by comment 16, it&#x27;s still happening now.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">A positive side effect: doing it in ironic-lib will enforce that no access to qemu bypasses the security checks (ignoring the ansible deploy, which I"m not even sure we should fix given its nature). Judging by comment 16, it's still happening now.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T13:45:25.632459+00:00" title="2024-07-29 13:45:25 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Jay, the format_inspector you&#x27;re using doesn&#x27;t support the monolithicFlat type of VMDK (since it&#x27;s just a text file, of arbitrary length, can have things like comments which can make it very long, and because the other projects don&#x27;t support that subtype). I&#x27;ve got patches up to the oslo version that now catch it, but they&#x27;re based on other yet-to-be-merged infrastructure you won&#x27;t have.</p>
<p>It is safe to call `qemu-img info` on that type as long as you use a full path to the image file, and that&#x27;s what the other projects are currently relying on. We all have specific checks for VMDK files that only allow monolithicSparse and streamOptimized subtypes, based on the qemu-img output, and that behavior pre-dates this most recent CVE. Here&#x27;s an example in nova:</p>
<p><a rel="nofollow" href="https://github.com/openstack/nova/blob/master/nova/virt/images.py#L117">https:/<wbr />/github.<wbr />com/openstack/<wbr />nova/blob/<wbr />master/<wbr />nova/virt/<wbr />images.<wbr />py#L117</a></p>
<p>My recommendation would be that, unless you think you need to support booting a machine from a VMDK, that you just check the qemu-img output after you determine it&#x27;s safe to run, and if it&#x27;s a vmdk, reject it outright.</p>
<p>The point of the flat-expose test file is that running qemu-img convert on it will copy any file on the host machine into the target image (or worse if you don&#x27;t provide the full path to the image file when you call convert).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Jay, the format_inspector you're using doesn't support the monolithicFlat type of VMDK (since it's just a text file, of arbitrary length, can have things like comments which can make it very long, and because the other projects don't support that subtype). I've got patches up to the oslo version that now catch it, but they're based on other yet-to-be-merged infrastructure you won't have.

It is safe to call `qemu-img info` on that type as long as you use a full path to the image file, and that's what the other projects are currently relying on. We all have specific checks for VMDK files that only allow monolithicSparse and streamOptimized subtypes, based on the qemu-img output, and that behavior pre-dates this most recent CVE. Here's an example in nova:

https://github.com/openstack/nova/blob/master/nova/virt/images.py#L117

My recommendation would be that, unless you think you need to support booting a machine from a VMDK, that you just check the qemu-img output after you determine it's safe to run, and if it's a vmdk, reject it outright.

The point of the flat-expose test file is that running qemu-img convert on it will copy any file on the host machine into the target image (or worse if you don't provide the full path to the image file when you call convert).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T13:54:11.744509+00:00" title="2024-07-29 13:54:11 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>We likely need to be careful with longer comments due to the way launchpad handles them, it makes it a bit harder to work with it.</p>
<p>Anyway, Jay, regarding your testing:</p>
<p><span class="foldable-quoted">&gt; FAILED bad-vmdk-<wbr />flat-expose.<wbr />qcow2
</span></p>
<p>So, I&#x27;m guessing that in both cases, it was just allowed to try and detect it. I guess I&#x27;m wondering if the image format inspector code has gotten updates in the last week or so since it seems like we should have detected that. In both cases the file appears to have been downloaded based upon the logs. I guess we need to take a look around the checksum calculation code to make sure we don&#x27;t have a way for a check to slip through.</p>
<p>----</p>
<p><span class="foldable-quoted">&gt; FAILED bad-vmdk-<wbr />flat-expose.<wbr />vmdk<br />
[trim]<br />
&gt; When specifying raw, this passed image sanity checking as a raw image.
</span></p>
<p>The bottom line issue with this case, is it appears that the image format inspection code doesn&#x27;t properly identify the vmdk as a vmdk, but instead identifies it as a raw image which *is* permitted.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">We likely need to be careful with longer comments due to the way launchpad handles them, it makes it a bit harder to work with it.

Anyway, Jay, regarding your testing:

&gt; FAILED bad-vmdk-flat-expose.qcow2

So, I'm guessing that in both cases, it was just allowed to try and detect it. I guess I'm wondering if the image format inspector code has gotten updates in the last week or so since it seems like we should have detected that. In both cases the file appears to have been downloaded based upon the logs. I guess we need to take a look around the checksum calculation code to make sure we don't have a way for a check to slip through.

----

&gt; FAILED bad-vmdk-flat-expose.vmdk
[trim]
&gt; When specifying raw, this passed image sanity checking as a raw image.

The bottom line issue with this case, is it appears that the image format inspection code doesn't properly identify the vmdk as a vmdk, but instead identifies it as a raw image which *is* permitted.


</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T14:04:56.507011+00:00" title="2024-07-29 14:04:56 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Dmitry, it is very much a scope problem, which is why in my opinion it is cleaner just to fix Ironic in one patch, and separately do the lightweight needful in IPA. This is based upon:</p>
<p>* We cannot execute qemu-img without passing in a source format to the call. Changing this alone, even guessing it on qemu-img calls exclusively is problematic for enforcing consistency and security, besides, as-is, this breaks ironic&#x27;s unit testing which does mock the underlying execute call and verifies the format. So we&#x27;re back to matching paired patches and logic for upgrade compatibility, which increases the overall risk to a fix because it increases the complexity to verify &quot;fixed&quot;.</p>
<p>* To handle a separate fix in ironic lib or a dependent fix, we&#x27;re going to have to drop in new logic into ironic anyhow because ideally we&#x27;re passing in an argument, and we&#x27;re still needing to do upfront format checking *anyway*.</p>
<p>* We cannot use the image info call in ironic lib anymore, anyhow, because it loads the drivers which can cause issues in qemu-img, which means we functionally have to patch the call&#x27;s usage out in the dependencies of which removes half the usage in ironic-lib&#x27;s qemu call copy</p>
<p>I suspect the best path is to talk through this in detail.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Dmitry, it is very much a scope problem, which is why in my opinion it is cleaner just to fix Ironic in one patch, and separately do the lightweight needful in IPA. This is based upon:

* We cannot execute qemu-img without passing in a source format to the call. Changing this alone, even guessing it on qemu-img calls exclusively is problematic for enforcing consistency and security, besides, as-is, this breaks ironic's unit testing which does mock the underlying execute call and verifies the format. So we're back to matching paired patches and logic for upgrade compatibility, which increases the overall risk to a fix because it increases the complexity to verify "fixed".

* To handle a separate fix in ironic lib or a dependent fix, we're going to have to drop in new logic into ironic anyhow because ideally we're passing in an argument, and we're still needing to do upfront format checking *anyway*.

* We cannot use the image info call in ironic lib anymore, anyhow, because it loads the drivers which can cause issues in qemu-img, which means we functionally have to patch the call's usage out in the dependencies of which removes half the usage in ironic-lib's qemu call copy

I suspect the best path is to talk through this in detail.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T14:12:09.084444+00:00" title="2024-07-29 14:12:09 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Julia,</p>
<p><span class="foldable-quoted">&gt; The bottom line issue with this case, is it appears that the image format inspection code doesn&#x27;t properly identify the vmdk as a vmdk, but instead identifies it as a raw image which *is* permitted.
</span></p>
<p>If you are absolutely sure that when format_inspector fails to detect the subformats it doesn&#x27;t support, the resulting &quot;raw&quot; gets passed to `qemu-img convert -f $fmt` then that too is a valid solution. However, if the innocent user tries it, they won&#x27;t know why it&#x27;s not working the way they expect (i.e. laying down a vmdk file directly on the disk, byte-for-byte).</p>
<p>In nova, we lose track of the originally-detected format as the image goes through our image cache, which makes this not a solution for us, just FYI.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Julia,

&gt; The bottom line issue with this case, is it appears that the image format inspection code doesn't properly identify the vmdk as a vmdk, but instead identifies it as a raw image which *is* permitted.

If you are absolutely sure that when format_inspector fails to detect the subformats it doesn't support, the resulting "raw" gets passed to `qemu-img convert -f $fmt` then that too is a valid solution. However, if the innocent user tries it, they won't know why it's not working the way they expect (i.e. laying down a vmdk file directly on the disk, byte-for-byte).

In nova, we lose track of the originally-detected format as the image goes through our image cache, which makes this not a solution for us, just FYI.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T14:13:44.510887+00:00" title="2024-07-29 14:13:44 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Dan, Thanks for the comment in #19, that would definitely do it.</p>
<p>Could you point us to the patches your referring to so we can take a look?</p>
<p>I guess I&#x27;m really not a fan of the idea of trying to avoid one call all other cases, but then in one special then try to make a call to `qemu-img info` since that incurs risk as well, even if just in this specific case it does not.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Dan, Thanks for the comment in #19, that would definitely do it.

Could you point us to the patches your referring to so we can take a look?

I guess I'm really not a fan of the idea of trying to avoid one call all other cases, but then in one special then try to make a call to `qemu-img info` since that incurs risk as well, even if just in this specific case it does not. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T14:23:46.243434+00:00" title="2024-07-29 14:23:46 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Here&#x27;s the patch in the oslo series that makes this possible</p>
<p><a rel="nofollow" href="https://review.opendev.org/c/openstack/oslo.utils/+/924512">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/oslo.utils/<wbr />+/924512</a></p>
<p>As you can see, it needs more infrastructure changes in the FI itself, sits atop a bunch of other refactors , and while I have done some testing locally, it&#x27;s definitely not proven out to the same degree as the rest of the stuff.</p>
<p>So if you&#x27;re definitely going to run qemu-img with `-f $fmt`, where $fmt is the result of the format inspector (which will detect these as raw) you should be safe, you just won&#x27;t reject that format visibly.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Here's the patch in the oslo series that makes this possible

https://review.opendev.org/c/openstack/oslo.utils/+/924512

As you can see, it needs more infrastructure changes in the FI itself, sits atop a bunch of other refactors , and while I have done some testing locally, it's definitely not proven out to the same degree as the rest of the stuff.

So if you're definitely going to run qemu-img with `-f $fmt`, where $fmt is the result of the format inspector (which will detect these as raw) you should be safe, you just won't reject that format visibly.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T14:45:26.062065+00:00" title="2024-07-29 14:45:26 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ack, that is good to know, and realistically since it is just the descriptor file, that might make it on disk, but the machine would never, ever boot. So I guess it is likely okay.</p>
<p>The risk, AIUI, is if you could then snapshot that contents, but even if we had that supported as a thing, it would be in raw format, not as vmdk. So nothing to tickle anything but the raw driver as long as all qemu-img calls have a format defined.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ack, that is good to know, and realistically since it is just the descriptor file, that might make it on disk, but the machine would never, ever boot. So I guess it is likely okay.

The risk, AIUI, is if you could then snapshot that contents, but even if we had that supported as a thing, it would be in raw format, not as vmdk. So nothing to tickle anything but the raw driver as long as all qemu-img calls have a format defined.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T15:07:12.157913+00:00" title="2024-07-29 15:07:12 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Yes, as long as you actually coerce the snapshot to be raw. That&#x27;s probably an assumption ironic could make, but other services can&#x27;t (and haven&#x27;t and thus, had issues here).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Yes, as long as you actually coerce the snapshot to be raw. That's probably an assumption ironic could make, but other services can't (and haven't and thus, had issues here).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T15:22:00.638182+00:00" title="2024-07-29 15:22:00 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Indeed, since the starting point is always a raw block device. We don&#x27;t have snapshotting functionality, but we know some folks who have implemented it and not shared patches with upstream since it is not a terribly complicated operation overall. I suspect this is likely something we should explicitly note in the release note.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Indeed, since the starting point is always a raw block device. We don't have snapshotting functionality, but we know some folks who have implemented it and not shared patches with upstream since it is not a terribly complicated operation overall. I suspect this is likely something we should explicitly note in the release note.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-29T17:35:48.653513+00:00" title="2024-07-29 17:35:48 UTC">on 2024-07-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ironic/+bug/2071740/comments/28/+download">Download full text</a> (3.6 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Julia, Dmitry, and I met today in a video meeting to rapidly share context.</p>
<p>A few notes: Dmitry&#x27;s concerns around if this code should live in ironic-lib or if we&#x27;re OK patching Ironic/IPA only were resovled: we will be fine patching only IPA and Ironic.</p>
<p>Additionally, here are some notes for the meeting around the patch and the approach:</p>
<p>How to handle poisoned images in cache?<br />
&nbsp;&nbsp;* Ironic devs are OK with the cache getting cleared as time passed<br />
&nbsp;&nbsp;* Ironic devs should ensure the OSSA includes instructions to manually clear cache in paranoid situations</p>
<p>What changes are needed for each package?<br />
* ironic-lib<br />
&nbsp;&nbsp;* Patch to remove qemu-img module, not to be backported</p>
<p>* Ironic<br />
&nbsp;&nbsp;* Patch with embedded image inspector to be written and backported<br />
&nbsp;&nbsp;* Post-disclosure, once ready, master branch will remove embedded image inspector module in favor of the one in oslo-utils<br />
&nbsp;&nbsp;* The current patch may circumvent image streaming in some cases, which could cause a significant performance hit, almost to the point of a DoS. Instead, we should avoid significantly changing conductor performance by default, while giving users and option to inspect images earlier at the expense of performance.<br />
&nbsp;&nbsp;* We need to add a value, that regardless of the setting of image_download_<wbr />type, would force all images to be inspected on-conductor. This would be disabled by default.<br />
&nbsp;&nbsp;&nbsp;&nbsp;* conductor_<wbr />always_<wbr />validates_<wbr />images = false (default)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* For cases where we expect image streaming or image would&#x27;ve never touched conductor, trust IPA validation to catch and error<br />
&nbsp;&nbsp;&nbsp;&nbsp;* conductor_<wbr />always_<wbr />validates_<wbr />images = true<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Conductor downloads and security-checks all images by default<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* Major performance hit! Conductor DDoS possible with extreme-size raw images.<br />
&nbsp;&nbsp;* Ensure the description of &quot;supported image types&quot; config contains a list of images that we expect MAY work even though we don&#x27;t support them explicitly</p>
<p>* IPA<br />
&nbsp;&nbsp;* Needs to independently inspect images that are passed through qemu-img for writing/conversion.<br />
&nbsp;&nbsp;* Cannot assume conductor has validated image is safe, due to various image streaming options</p>
<p>* IPA + Ironic<br />
&nbsp;&nbsp;* Ensure there are comments documenting:<br />
&nbsp;&nbsp;&nbsp;&nbsp;* to check IPA/Ironic code, anywhere we may be slightly duplicating code formerly-<wbr />from-ironic-<wbr />lib, instructing a dev to check the other similar code.<br />
&nbsp;&nbsp;&nbsp;&nbsp;* this code migrating to oslo.utils in future versions (this comment can be removed from backports)</p>
<p>When we eventually draft the OSSA, we want to mention the following:<br />
&nbsp;&nbsp;* Operators can manually purge image cache if they are concerned about existing cached images (note: by default this cache cleans every hour)<br />
&nbsp;&nbsp;* Ironic-lib is documented to not be supported for non-Ironic use cases. If anyone is using ironic-lib directly against our will: STOP. We are not patching qemu_img module in Ironic-Lib as part of this fix.<br />
&nbsp;&nbsp;* Information on how to report regressions / self-serve fixes (e.g. adding a new image type to allowlist)<br />
&nbsp;&nbsp;* Documentation telling users who refuse to update their IPA ramdisks (a behavior seen in the wild by many Ironic devs) to set conductor_<wbr />always_<wbr />validate_<wbr />images to true.<br />
&nbsp;&nbsp;* Mention the new config blocking all but qcow2/raw images ...</p></div>
    
    <p>
      <a href="/ironic/+bug/2071740/comments/28">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Julia, Dmitry, and I met today in a video meeting to rapidly share context.

A few notes: Dmitry's concerns around if this code should live in ironic-lib or if we're OK patching Ironic/IPA only were resovled: we will be fine patching only IPA and Ironic.

Additionally, here are some notes for the meeting around the patch and the approach:

How to handle poisoned images in cache?
  * Ironic devs are OK with the cache getting cleared as time passed
  * Ironic devs should ensure the OSSA includes instructions to manually clear cache in paranoid situations


What changes are needed for each package?
* ironic-lib 
  * Patch to remove qemu-img module, not to be backported

* Ironic
  * Patch with embedded image inspector to be written and backported
  * Post-disclosure, once ready, master branch will remove embedded image inspector module in favor of the one in oslo-utils
  * The current patch may circumvent image streaming in some cases, which could cause a significant performance hit, almost to the point of a DoS. Instead, we should avoid significantly changing conductor performance by default, while giving users and option to inspect images earlier at the expense of performance.
  * We need to add a value, that regardless of the setting of image_download_type, would force all images to be inspected on-conductor. This would be disabled by default.
    * conductor_always_validates_images = false (default)
      * For cases where we expect image streaming or image would've never touched conductor, trust IPA validation to catch and error 
    * conductor_always_validates_images = true
      * Conductor downloads and security-checks all images by default
      * Major performance hit! Conductor DDoS possible with extreme-size raw images.
  * Ensure the description of "supported image types" config contains a list of images that we expect MAY work even though we don't support them explicitly


* IPA
  * Needs to independently inspect images that are passed through qemu-img for writing/conversion.
  * Cannot assume conductor has validated image is safe, due to various image streaming options

* IPA + Ironic
  * Ensure there are comments documenting:
    * to check IPA/Ironic code, anywhere we may be slightly duplicating code formerly-from-ironic-lib, instructing a dev to check the other similar code.
    * this code migrating to oslo.utils in future versions (this comment can be removed from backports)


When we eventually draft the OSSA, we want to mention the following:
  * Operators can manually purge image cache if they are concerned about existing cached images (note: by default this cache cleans every hour)
  * Ironic-lib is documented to not be supported for non-Ironic use cases. If anyone is using ironic-lib directly against our will: STOP. We are not patching qemu_img module in Ironic-Lib as part of this fix.
  * Information on how to report regressions / self-serve fixes (e.g. adding a new image type to allowlist)
  * Documentation telling users who refuse to update their IPA ramdisks (a behavior seen in the wild by many Ironic devs) to set conductor_always_validate_images to true.
  * Mention the new config blocking all but qcow2/raw images by default.


Additionally, as two of the people inside here are also Metal3 contributors, we discussed if it was valuable to do coordination cross-project. The Ironic consensus was that, after consulting with VMT team for their opinion, our preferred path is to notify the Metal3 security team, by emailing metal3-security@googlegroups.com (their equivalent to our VMT, with limited membership) at the point in time we release this patch under embargo. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-30T18:02:59.162638+00:00" title="2024-07-30 18:02:59 UTC">on 2024-07-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Attaching an updated patch for Ironic. Includes documentation updates *as well*.</p>
<p>We will need to get a CVE number reserved to make final updates to this patch and the release note which has grown in length.</p>
<p>It changes the behavior from the first revision to align with the discussion notes JayF posted yesterday, and while the details are slightly different the basic meaning and purpose aligns with two different image inspection knobs to cover the distinct cases.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Attaching an updated patch for Ironic. Includes documentation updates *as well*.

We will need to get a CVE number reserved to make final updates to this patch and the release note which has grown in length.

It changes the behavior from the first revision to align with the discussion notes JayF posted yesterday, and while the details are slightly different the basic meaning and purpose aligns with two different image inspection knobs to cover the distinct cases.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-30T18:23:54.036135+00:00" title="2024-07-30 18:23:54 UTC">on 2024-07-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This is an untested, rough draft patch for IPA. I&#x27;m primarily uploading it so it exists a place other than my laptop since I can&#x27;t back it up in gerrit :).</p>
<p>Next actions will be updating unit tests and spinning this up in a devstack. Feel free to give this a high level review if you&#x27;d like.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This is an untested, rough draft patch for IPA. I'm primarily uploading it so it exists a place other than my laptop since I can't back it up in gerrit :).

Next actions will be updating unit tests and spinning this up in a devstack. Feel free to give this a high level review if you'd like.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-31T00:03:46.456415+00:00" title="2024-07-31 00:03:46 UTC">on 2024-07-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Basic smoke testing with my latest patch against ironic *appears* to be generally okay when running the standalone test suite, although it also looks like it might have broken the ansible deployment interface. The test is still running and I&#x27;ll need to extract the logs once completed to get a better idea of why it failed.</p>
<p>Stdout: &#x27;ansible-playbook [core 2.17.2]\n  config file = /opt/stack/<wbr />ironic/<wbr />ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />ansible.<wbr />cfg\n  configured module search path = [\&#x27;/home/<wbr />stack/.<wbr />ansible/<wbr />plugins/<wbr />modules\<wbr />&#x27;, \&#x27;/usr/<wbr />share/ansible/<wbr />plugins/<wbr />modules\<wbr />&#x27;]\n  ansible python module location = /opt/stack/<wbr />data/venv/<wbr />lib/python3.<wbr />10/site-<wbr />packages/<wbr />ansible\<wbr />n  ansible collection location = /home/stack/<wbr />.ansible/<wbr />collections:<wbr />/usr/share/<wbr />ansible/<wbr />collections\<wbr />n  executable location = /opt/stack/<wbr />data/venv/<wbr />bin/ansible-<wbr />playbook\<wbr />n  python version = 3.10.12 (main, Jul 29 2024, 16:56:48) [GCC 11.4.0] (/opt/stack/<wbr />data/venv/<wbr />bin/python3.<wbr />10)\n  jinja version = 3.1.4\n  libyaml = True\nUsing /opt/stack/<wbr />ironic/<wbr />ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />ansible.<wbr />cfg as config file\nsetting up inventory plugins\nLoading collection ansible.builtin from \nhost_list declined parsing /opt/stack/<wbr />ironic/<wbr />ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />inventory as it did not pass its verify_file() method\nscript declined parsing /opt/stack/<wbr />ironic/<wbr />ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />inventory as it did not pass its verify_file() method\nauto declined parsing /opt/stack/<wbr />ironic/<wbr />ironic/<wbr />drivers/<wbr />modules/<wbr />ansible/<wbr />playbooks/<wbr />inventory as it did not pass its verify_file() method</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Basic smoke testing with my latest patch against ironic *appears* to be generally okay when running the standalone test suite, although it also looks like it might have broken the ansible deployment interface. The test is still running and I'll need to extract the logs once completed to get a better idea of why it failed.

Stdout: 'ansible-playbook [core 2.17.2]\n  config file = /opt/stack/ironic/ironic/drivers/modules/ansible/playbooks/ansible.cfg\n  configured module search path = [\'/home/stack/.ansible/plugins/modules\', \'/usr/share/ansible/plugins/modules\']\n  ansible python module location = /opt/stack/data/venv/lib/python3.10/site-packages/ansible\n  ansible collection location = /home/stack/.ansible/collections:/usr/share/ansible/collections\n  executable location = /opt/stack/data/venv/bin/ansible-playbook\n  python version = 3.10.12 (main, Jul 29 2024, 16:56:48) [GCC 11.4.0] (/opt/stack/data/venv/bin/python3.10)\n  jinja version = 3.1.4\n  libyaml = True\nUsing /opt/stack/ironic/ironic/drivers/modules/ansible/playbooks/ansible.cfg as config file\nsetting up inventory plugins\nLoading collection ansible.builtin from \nhost_list declined parsing /opt/stack/ironic/ironic/drivers/modules/ansible/playbooks/inventory as it did not pass its verify_file() method\nscript declined parsing /opt/stack/ironic/ironic/drivers/modules/ansible/playbooks/inventory as it did not pass its verify_file() method\nauto declined parsing /opt/stack/ironic/ironic/drivers/modules/ansible/playbooks/inventory as it did not pass its verify_file() method</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-31T17:07:39.274751+00:00" title="2024-07-31 17:07:39 UTC">on 2024-07-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Okay, My ansible deployment interface failures *appear?* to be more rooted in the environment I&#x27;m testing in than anything else. Given my local environment has been through some various different stacking/<wbr />restacking, there is a distinct possibility I&#x27;ve got the state a little broken for the more fragile drivers, and it does appear I&#x27;m having issues authenticating through to the ramdisk which is entirely unrelated.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Okay, My ansible deployment interface failures *appear?* to be more rooted in the environment I'm testing in than anything else. Given my local environment has been through some various different stacking/restacking, there is a distinct possibility I've got the state a little broken for the more fragile drivers, and it does appear I'm having issues authenticating through to the ramdisk which is entirely unrelated.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-31T17:23:38.530219+00:00" title="2024-07-31 17:23:38 UTC">on 2024-07-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ironic devs on the inside for this bug met this morning:<br />
- Did a review of the rough draft IPA change<br />
- Talked about strategies for backporting and configuration<br />
- Shared some context about format_inspector with Dmitry</p>
<p>We are syncing again Monday morning, with a goal of having patches for master Ironic and IPA tested working by then, even if they need further (minor) revision.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ironic devs on the inside for this bug met this morning:
- Did a review of the rough draft IPA change
- Talked about strategies for backporting and configuration
- Shared some context about format_inspector with Dmitry

We are syncing again Monday morning, with a goal of having patches for master Ironic and IPA tested working by then, even if they need further (minor) revision.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-07-31T17:48:14.090636+00:00" title="2024-07-31 17:48:14 UTC">on 2024-07-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Confirmed, it was my test environment.</p>
<p>$ tempest run --regex BaremetalDriver<wbr />AnsibleWholedis<wbr />k<br />
{0} ironic_<wbr />tempest_<wbr />plugin.<wbr />tests.scenario.<wbr />ironic_<wbr />standalone.<wbr />test_basic_<wbr />ops.BaremetalDr<wbr />iverAnsibleWhol<wbr />edisk.test_<wbr />ip_access_<wbr />to_server [294.144806s] ... ok</p>
<p>======<br />
Totals<br />
======<br />
Ran: 1 tests in 294.1448 sec.<br />
&nbsp;- Passed: 1<br />
&nbsp;- Skipped: 0<br />
&nbsp;- Expected Fail: 0<br />
&nbsp;- Unexpected Success: 0<br />
&nbsp;- Failed: 0<br />
Sum of execute time for each test: 294.1448 sec.</p>
<p>The plan right now in terms of smoke testing the master branch patch state is to walk through the scenario configurations and running them. So far, standalone jobs passes which is a really good sign.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Confirmed, it was my test environment.

$ tempest run --regex BaremetalDriverAnsibleWholedisk
{0} ironic_tempest_plugin.tests.scenario.ironic_standalone.test_basic_ops.BaremetalDriverAnsibleWholedisk.test_ip_access_to_server [294.144806s] ... ok

======
Totals
======
Ran: 1 tests in 294.1448 sec.
 - Passed: 1
 - Skipped: 0
 - Expected Fail: 0
 - Unexpected Success: 0
 - Failed: 0
Sum of execute time for each test: 294.1448 sec.

The plan right now in terms of smoke testing the master branch patch state is to walk through the scenario configurations and running them. So far, standalone jobs passes which is a really good sign.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T16:45:11.077058+00:00" title="2024-08-02 16:45:11 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve been able to successfully execute the following upstream tests which mix non-swift usage (standalone), swiftless glance usage, and usage with swift in integrated configurations. All of these were tested *with* and without the conductor_<wbr />always_<wbr />verifies_<wbr />image option set.</p>
<p>ironic-<wbr />standalone-<wbr />redfish<br />
ironic-<wbr />standalone-<wbr />anaconda<br />
ironic-<wbr />tempest-<wbr />bios-redfish-<wbr />pxe<br />
ironic-<wbr />tempest-<wbr />ipa-wholeisk-<wbr />bios-ipmi-<wbr />direct-<wbr />dib</p>
<p>The major variation in these jobs are largely a variety of scenarios and interfaces, so overall I have good confidence that the ironic patch, as-is, is not going to have any major issues when dropped into the gate (when we get to that point).</p>
<p>The team can discuss further test jobs, but we should repeat tests of the &quot;direct&quot; deployment interface (ironic-<wbr />standalone-<wbr />redfish and the tempest jobs will exercise this) when we have a IPA patch in a ready state.</p>
<p>Furthermore, I took Jay&#x27;s script, modified slightly and repeated tests, and did discover an issue as related to disqualification of images based upon user supplied input of the image_disk_format compared to what we have received url content wise. I&#x27;ll upload a new revision shortly, but the tl;dr is all of the expected failures failed, and all of the good images succeeded. In the script I&#x27;ll also upload, I denote what is expected. I also tested against, from a good measure standpoint of additional images just to ensure we have our bases covered ultimately ensure the fix is in the best shape possible.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've been able to successfully execute the following upstream tests which mix non-swift usage (standalone), swiftless glance usage, and usage with swift in integrated configurations. All of these were tested *with* and without the conductor_always_verifies_image option set.

ironic-standalone-redfish
ironic-standalone-anaconda
ironic-tempest-bios-redfish-pxe
ironic-tempest-ipa-wholeisk-bios-ipmi-direct-dib

The major variation in these jobs are largely a variety of scenarios and interfaces, so overall I have good confidence that the ironic patch, as-is, is not going to have any major issues when dropped into the gate (when we get to that point).

The team can discuss further test jobs, but we should repeat tests of the "direct" deployment interface (ironic-standalone-redfish and the tempest jobs will exercise this) when we have a IPA patch in a ready state.

Furthermore, I took Jay's script, modified slightly and repeated tests, and did discover an issue as related to disqualification of images based upon user supplied input of the image_disk_format compared to what we have received url content wise. I'll upload a new revision shortly, but the tl;dr is all of the expected failures failed, and all of the good images succeeded. In the script I'll also upload, I denote what is expected. I also tested against, from a good measure standpoint of additional images just to ensure we have our bases covered ultimately ensure the fix is in the best shape possible.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T17:15:49.402340+00:00" title="2024-08-02 17:15:49 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Attached is a revised patch for ironic, passes unit tests, pep8, and py3 testing locally. Started with 0002 just to signify a revision more than anything.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Attached is a revised patch for ironic, passes unit tests, pep8, and py3 testing locally. Started with 0002 just to signify a revision more than anything.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T17:22:44.256570+00:00" title="2024-08-02 17:22:44 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5802184/+files/test_image.sh" class="sprite download-icon">test_image.sh</a>
        <a class="sprite edit action-icon" href="/ironic/+bug/2071740/+attachment/5802184">Edit</a>
        
        (3.9 KiB,
        text/x-sh)
        
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Attached is my test script I used to test the direct/standalone usage of the path and behavior where I exercised *both* local file download and the option to have the conductor to explicitly inspect all of the files. The expected behavior is also noted inline, and everything seems to work as noted.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Attached is my test script I used to test the direct/standalone usage of the path and behavior where I exercised *both* local file download and the option to have the conductor to explicitly inspect all of the files. The expected behavior is also noted inline, and everything seems to work as noted.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T18:10:15.280379+00:00" title="2024-08-02 18:10:15 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>For ironic specifically, I took a look at the backporting order and complexity as compared to the current branch. It doesn&#x27;t backport cleanly considering it also has documentation, and there have been some refactoring. All of these notes are from a direct cherry-pick of the patch to each branch, to create the patches for each branch, we&#x27;ll need to go in order, which should resolve a lot of the differences I see in a direct cherry-pick as we go backwards in time.</p>
<p>Branch Name - Notes<br />
-------------------<br />
bugfix/25.0 - conflicts, but relatively clean</p>
<p>stable/2024.1 - conflicts, but relatively clean</p>
<p>bugfix/24.0 - conflicts, less clean, conflicts with the move of disk_utils-<wbr />&gt;qemu_img in ironic-lib.</p>
<p>bugfix 23.1 - conflicts, but appears to be the same as 24.0</p>
<p>stable/2023.2 - conflicts, but appears to be the same as 24.0 and 23.1</p>
<p>stable/2023.1 - conflicts, possibly a little bit more than 2023.2, but realistically thee same.</p>
<p>unmaintained/zed - conflicts, looks very similar to 2023.1, if not identical.</p>
<p>unmaintained/yoga - As-is, looks like a direct cherry-pick conflicts with docs and some fixes around Anaconda and redirect fixes. If bugfix/24.0 requires an hour, expect a two hours on this branch in large part just to sort out and correctly ensure we have applied the right logic/flow.</p>
<p>unmaintained/xena - About the same as Yoga, likely will be relatively clean from yoga based patch to xena.</p>
<p>unmaintained/<wbr />wallaby - A bit more complexity compared to Xena, esp. in deploy_<wbr />utils.build_<wbr />instance_<wbr />info_for_<wbr />deploy. Overall, the main issue at this branch is the iscsi deploy driver which will require some additional checking/testing. If yoga takes 2 hours, expect this to take about eight hours.</p>
<p>unmaintained/<wbr />victoria - This looks very similar to Wallaby.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">For ironic specifically, I took a look at the backporting order and complexity as compared to the current branch. It doesn't backport cleanly considering it also has documentation, and there have been some refactoring. All of these notes are from a direct cherry-pick of the patch to each branch, to create the patches for each branch, we'll need to go in order, which should resolve a lot of the differences I see in a direct cherry-pick as we go backwards in time.

Branch Name - Notes
-------------------
bugfix/25.0 - conflicts, but relatively clean

stable/2024.1 - conflicts, but relatively clean

bugfix/24.0 - conflicts, less clean, conflicts with the move of disk_utils-&gt;qemu_img in ironic-lib.

bugfix 23.1 - conflicts, but appears to be the same as 24.0

stable/2023.2 - conflicts, but appears to be the same as 24.0 and 23.1

stable/2023.1 - conflicts, possibly a little bit more than 2023.2, but realistically thee same.

unmaintained/zed - conflicts, looks very similar to 2023.1, if not identical.

unmaintained/yoga - As-is, looks like a direct cherry-pick conflicts with docs and some fixes around Anaconda and redirect fixes. If bugfix/24.0 requires an hour, expect a two hours on this branch in large part just to sort out and correctly ensure we have applied the right logic/flow.

unmaintained/xena - About the same as Yoga, likely will be relatively clean from yoga based patch to xena.

unmaintained/wallaby - A bit more complexity compared to Xena, esp. in deploy_utils.build_instance_info_for_deploy. Overall, the main issue at this branch is the iscsi deploy driver which will require some additional checking/testing. If yoga takes 2 hours, expect this to take about eight hours.

unmaintained/victoria - This looks very similar to Wallaby.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jason-oldos" class="sprite person">Jay Faulkner (jason-oldos)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-02T23:29:36.389485+00:00" title="2024-08-02 23:29:36 UTC">on 2024-08-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>v2 of the IPA patch.</p>
<p>Julia is a bit ahead of me. I hope to be where she&#x27;s at with Ironic by EOD Monday.</p>
<p>Code that exists is passing all tests, including some new tests I&#x27;ve already added and some bugfixes I&#x27;ve applied as a result of those tests.</p>
<p>Remaining todos:<br />
# TODO(JayF): Unit tests for _image_inspection<br />
# TODO(JayF): Unit tests for disabled deep image inspection<br />
# TODO(JayF): Migrate qemu_img tests, add some for deep image inspection conf<br />
# TODO(JayF): Migrate format_inspector tests, ensure I have latest copy<br />
# TODO(JayF): Addl devstack testing</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">v2 of the IPA patch.

Julia is a bit ahead of me. I hope to be where she's at with Ironic by EOD Monday.

Code that exists is passing all tests, including some new tests I've already added and some bugfixes I've applied as a result of those tests.

Remaining todos:
# TODO(JayF): Unit tests for _image_inspection
# TODO(JayF): Unit tests for disabled deep image inspection
# TODO(JayF): Migrate qemu_img tests, add some for deep image inspection conf
# TODO(JayF): Migrate format_inspector tests, ensure I have latest copy
# TODO(JayF): Addl devstack testing
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-08-05T18:16:30.193269+00:00" title="2024-08-05 18:16:30 UTC">on 2024-08-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ironic/+bug/2071740/comments/40/+download">Download full text</a> (3.8 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Dmitry, Jay, and I met this morning to discuss status and review the ironic patch specifically:</p>
<p>Notes/items to fix/amend/check.</p>
<p>security.rst<br />
* Disk images in the docs - line 416, &quot;bene&quot; should be &quot;been&quot;<br />
* typo: functioanlity in the 3rd item<br />
* Add note to 443 in to indicate IPA will independently perform these checks on files downloaded and require conversion.<br />
* check to see if we independently document image_download_<wbr />source and fix</p>
<p>troubleshooting<wbr />.rst:<br />
* line 1267: Awkward text, needs revision: as in if the contents appears safe, or not.<br />
* line 1282: We should note that final, late state check are also performed during the write process.<br />
* line 1273: uploading spelling needs to be fixed.</p>
<p>configure-<wbr />glance-<wbr />images.<wbr />rst<br />
* line 15:  permittedimage (need to be two words, missing space)</p>
<p>creating-<wbr />images.<wbr />rst.<br />
* line 50: &quot;image image&quot;<br />
* line 51: change confusion to use of this format may result in unexpected behavior.<br />
* line 55: note blocked by default<br />
* line 58: explicitly note this not based upon file extension.</p>
<p>General note for context around this, many of these checks are early, before starting provisioning.</p>
<p>release note:<br />
* first item - &quot;with a new image id&quot;<br />
* Third item: Add a note indicating IPA will perform additional checking.<br />
* forth item - image formats permitted - should add reference to the configuration parameter<br />
* ansible playbook item - change to &quot;now supply an input&quot;<br />
* line 44: functionality spelling fix.<br />
* line 50: make bolded text for at your own risk.<br />
* line 61: &quot;and *has* expressed as known working&quot;<br />
* Upgrade section: we need to add a thing... about the supported image list parameters.<br />
* Upgrade section should be split into multiple distinct items.</p>
<p>conf/conductor.py<br />
* line 438 or there about: Be more verbose about how this is super bad and can open the conductor to qemu-attacks.<br />
* line 450: might need a comma in the help text.</p>
<p>images.py:</p>
<p>* line 431: fallback to qcow2 default should be get_source_format<br />
* safety_check_image method, add a docstring<br />
* line: 840: Change warning to error<br />
* line 855: also change to error in check_if_<wbr />format_<wbr />is_permitted<br />
General item for images.py, add _cls to parameters which are classes.</p>
<p>deploy_utils.py:<br />
* fix docstring on fetch_images<br />
* fetch_images: Add a future todo around the returned list that it should be improved at some point.<br />
* cache_instance_<wbr />image also needs a docstring update.<br />
* change the FIXME on line 1203 to be *we explicitly delete for reasons like the cache really won&#x27;t work beyond the single node in this case.</p>
<p>* line 1148: incomplete docstring as _invalid_<wbr />image_Format.<br />
* line 1182: change logging from debug to info<br />
* line 1208 - Add notes around image_info and disk_format field generation so that we properly preserve the instance_<wbr />info\image_<wbr />disk_format to disk_format field as it is required for ipa and ansible deploy interfaces.<br />
* line 1337: change were to &quot;we are&quot;<br />
* line 1369: validate_results is getting the wrong field name</p>
<p>build_instance_<wbr />info_for_<wbr />deploy in deploy_utils.py<br />
* Add notes around the if/else statements on the paths so reviewers/future editors can grok it.</p>
<p>image_cache.py<br />
* line 373: change warning to error</p>
<p>To Check:<br />
* see how expensive how image_format_<wbr />inspecto.<wbr />..</p></div>
    
    <p>
      <a href="/ironic/+bug/2071740/comments/40">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Dmitry, Jay, and I met this morning to discuss status and review the ironic patch specifically:

Notes/items to fix/amend/check.

security.rst
* Disk images in the docs - line 416, "bene" should be "been"
* typo: functioanlity in the 3rd item
* Add note to 443 in to indicate IPA will independently perform these checks on files downloaded and require conversion.
* check to see if we independently document image_download_source and fix

troubleshooting.rst:
* line 1267: Awkward text, needs revision: as in if the contents appears safe, or not.
* line 1282: We should note that final, late state check are also performed during the write process.
* line 1273: uploading spelling needs to be fixed.

configure-glance-images.rst
* line 15:  permittedimage (need to be two words, missing space)

creating-images.rst.
* line 50: "image image"
* line 51: change confusion to use of this format may result in unexpected behavior.
* line 55: note blocked by default
* line 58: explicitly note this not based upon file extension.

General note for context around this, many of these checks are early, before starting provisioning.

release note:
* first item - "with a new image id"
* Third item: Add a note indicating IPA will perform additional checking.
* forth item - image formats permitted - should add reference to the configuration parameter
* ansible playbook item - change to "now supply an input"
* line 44: functionality spelling fix.
* line 50: make bolded text for at your own risk.
* line 61: "and *has* expressed as known working"
* Upgrade section: we need to add a thing... about the supported image list parameters.
* Upgrade section should be split into multiple distinct items.

conf/conductor.py
* line 438 or there about: Be more verbose about how this is super bad and can open the conductor to qemu-attacks.
* line 450: might need a comma in the help text.

images.py:

* line 431: fallback to qcow2 default should be get_source_format
* safety_check_image method, add a docstring
* line: 840: Change warning to error
* line 855: also change to error in check_if_format_is_permitted
General item for images.py, add _cls to parameters which are classes.

deploy_utils.py: 
* fix docstring on fetch_images
* fetch_images: Add a future todo around the returned list that it should be improved at some point.
* cache_instance_image also needs a docstring update.
* change the FIXME on line 1203 to be *we explicitly delete for reasons like the cache really won't work beyond the single node in this case.

* line 1148: incomplete docstring as _invalid_image_Format.
* line 1182: change logging from debug to info
* line 1208 - Add notes around image_info and disk_format field generation so that we properly preserve the instance_info\image_disk_format to disk_format field as it is required for ipa and ansible deploy interfaces.
* line 1337: change were to "we are"
* line 1369: validate_results is getting the wrong field name

build_instance_info_for_deploy in deploy_utils.py
* Add notes around the if/else statements on the paths so reviewers/future editors can grok it.

image_cache.py
* line 373: change warning to error

To Check:
* see how expensive how image_format_inspector.detect_file_format is in regards to accessing things like virtual_size.

Testing wise:
* Probably need to test turning the configuration options off entirely and ensure we're not creating regressions/breakages.
* Check/update the image inspector base code.
* There *is* concern that we're changing the pattern to use image format inspection to do detection and not qemu-img info

Also to do:
* File a bug for image cache - if deploy fails due to dhcp options not present, the cache is not refreshed.
* Also add a PTG topic on improving the image cache, specifically for "standalone" style usages to see if we could retool to maybe independently track metadata about items.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~brian-rosmaita" class="sprite person">Brian Rosmaita (brian-rosmaita)</a>
    
    <time title="2024-08-14 12:50:36 UTC" datetime="2024-08-14T12:50:36.310539+00:00">on 2024-08-14</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; In Progress
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Brian Rosmaita (brian-rosmaita)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~juliaashleykreger" class="sprite person">Julia Kreger (juliaashleykreger)</a>
    
    <time title="2024-08-14 13:49:57 UTC" datetime="2024-08-14T13:49:57.128352+00:00">on 2024-08-14</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ironic: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; In Progress
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Julia Kreger (juliaashleykreger)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ironic-python-agent: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; In Progress
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Jay Faulkner (jason-oldos)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ironic-lib: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Jay Faulkner (jason-oldos)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~brian-rosmaita" class="sprite person">Brian Rosmaita (brian-rosmaita)</a>
    
    <time title="2024-08-19 12:30:06 UTC" datetime="2024-08-19T12:30:06.304721+00:00">on 2024-08-19</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
          Hardening: don&#x27;t run qemu-img with unvalidated image data<br />+ (CVE-2024-44082)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~brian-rosmaita" class="sprite person">Brian Rosmaita (brian-rosmaita)</a>
    
    <time title="2024-08-19 12:47:27 UTC" datetime="2024-08-19T12:47:27.642622+00:00">on 2024-08-19</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Hardening: don&#x27;t run qemu-img with unvalidated image data<br />- (CVE-2024-44082)<br />+ Unvalidated image data passed to qemu-img (CVE-2024-44082)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~brian-rosmaita" class="sprite person">Brian Rosmaita (brian-rosmaita)</a>
    
    <time title="2024-09-04 14:05:58 UTC" datetime="2024-09-04T14:05:58.018469+00:00">on 2024-09-04</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Unvalidated image data passed to qemu-img (CVE-2024-44082)<br />+ [OSSA-2024-003] Unvalidated image data passed to qemu-img<br />+ (CVE-2024-44082)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          

          
              <div>
  <div id="comments-container"></div>
  <div class="boardComment comments-hidden-message" style="border-bottom: 0">
    <div class="boardCommentDetails">
      <table>
        <tbody>
          <tr>
            <td>
              <span class="sprite arrowRight"></span>
              78 comments hidden
              <span id="more-comments-spinner" class="hidden">
                Loading more comments
                <img src="/@@/spinner" />
              </span>
            </td>

            <td class="bug-comment-index">
              <a href="?comments=all" id="show-comments-link" class="show-comments-link sprite retry" style="white-space: nowrap">
                 view all 158 comments</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/119" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:11:38.592204+00:00" title="2024-09-04 14:11:38 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/119">
                <strong>Fix proposed to ironic-python-agent (bugfix/9.9)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/119"> #119</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: bugfix/9.9<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927984">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927984</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: bugfix/9.9
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927984</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/120" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:15:04.446588+00:00" title="2024-09-04 14:15:04 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/120">
                <strong>Related fix proposed to ironic-python-agent (unmaintained/zed)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/120"> #120</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: unmaintained/zed<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927985">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927985</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: unmaintained/zed
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927985</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/121" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:15:29.802131+00:00" title="2024-09-04 14:15:29 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/121">
                <strong>Related fix proposed to ironic-python-agent (unmaintained/yoga)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/121"> #121</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: unmaintained/yoga<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927986">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927986</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: unmaintained/yoga
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927986</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/122" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:16:48.779191+00:00" title="2024-09-04 14:16:48 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/122">
                <strong>Related fix proposed to ironic-python-agent (unmaintained/xena)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/122"> #122</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: unmaintained/xena<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927987">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927987</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: unmaintained/xena
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927987</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/123" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:20:31.342840+00:00" title="2024-09-04 14:20:31 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/123">
                <strong>Related fix proposed to ironic-python-agent (unmaintained/wallaby)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/123"> #123</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: unmaintained/<wbr />wallaby<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927988">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927988</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: unmaintained/wallaby
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927988</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/124" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:21:00.096100+00:00" title="2024-09-04 14:21:00 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/124">
                <strong>Related fix proposed to ironic-python-agent (unmaintained/victoria)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/124"> #124</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: unmaintained/<wbr />victoria<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927990">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927990</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: unmaintained/victoria
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927990</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/125" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T14:53:23.773146+00:00" title="2024-09-04 14:53:23 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/125">
                <strong>Fix proposed to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/125"> #125</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ossa/+/927995">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ossa/+<wbr />/927995</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/927995</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/126" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T15:22:08.576440+00:00" title="2024-09-04 15:22:08 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/126">
                <strong>Fix merged to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/126"> #126</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ossa/+/927995">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ossa/+<wbr />/927995</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ossa/commit/8d3e8bb3ae64e44b863ede07682952a2ef64e9b2">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ossa/commit/<wbr />8d3e8bb3ae64e44<wbr />b863ede07682952<wbr />a2ef64e9b2</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit 8d3e8bb3ae64e44<wbr />b863ede07682952<wbr />a2ef64e9b2<br />
Author: Brian Rosmaita &lt;email address hidden&gt;<br />
Date:   Fri Aug 23 18:17:28 2024 -0400</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add OSSA-2024-003 (CVE-2024-44082)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I4595429e698347<wbr />39dce2380a8a602<wbr />f521271cb03</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ossa/+/927995
Committed: https://opendev.org/openstack/ossa/commit/8d3e8bb3ae64e44b863ede07682952a2ef64e9b2
Submitter: "Zuul (22348)"
Branch:    master

commit 8d3e8bb3ae64e44b863ede07682952a2ef64e9b2
Author: Brian Rosmaita &lt;rosmaita.fossdev@gmail.com&gt;
Date:   Fri Aug 23 18:17:28 2024 -0400

    Add OSSA-2024-003 (CVE-2024-44082)
    
    Closes-bug: 2071740
    Change-Id: I4595429e69834739dce2380a8a602f521271cb03
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/127" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-04T20:04:53.858206+00:00" title="2024-09-04 20:04:53 UTC">on 2024-09-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/127">
                <strong>Fix merged to ironic-python-agent (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/127"> #127</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927974">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927974</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/e303a369dce6c4c5dd0402701b020888396406f3">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />e303a369dce6c4c<wbr />5dd0402701b0208<wbr />88396406f3</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit e303a369dce6c4c<wbr />5dd0402701b0208<wbr />88396406f3<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Jul 30 11:18:14 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927974
Committed: https://opendev.org/openstack/ironic-python-agent/commit/e303a369dce6c4c5dd0402701b020888396406f3
Submitter: "Zuul (22348)"
Branch:    master

commit e303a369dce6c4c5dd0402701b020888396406f3
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Jul 30 11:18:14 2024 -0700

    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ironic-python-agent: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/128" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T01:30:45.330700+00:00" title="2024-09-05 01:30:45 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/128">
                <strong>Fix merged to ironic-python-agent (stable/2024.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/128"> #128</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927976">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927976</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/06fe5ff1782551e6f94640d47ea942ab81f18909">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />06fe5ff1782551e<wbr />6f94640d47ea942<wbr />ab81f18909</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2024.1</p>
<p>commit 06fe5ff1782551e<wbr />6f94640d47ea942<wbr />ab81f18909<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Mon Mar 11 17:29:58 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This is a backport of two changes merged together to facilitate<br />
&nbsp;&nbsp;&nbsp;&nbsp;backporting:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The first is a refactor of disk utilities:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Import disk_{utils,<wbr />partitioner} from ironic-lib</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;With the iscsi deploy long gone, these modules are only used in IPA and<br />
&nbsp;&nbsp;&nbsp;&nbsp;in fact represent a large part of its critical logic. Having them<br />
&nbsp;&nbsp;&nbsp;&nbsp;separately sometimes makes fixing issues tricky if an interface of<br />
&nbsp;&nbsp;&nbsp;&nbsp;a function needs changing.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the code mostly as it is, just removing run_as_root and<br />
&nbsp;&nbsp;&nbsp;&nbsp;a deprecated function, as well as moving configuration options to config.py.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Also migrates one relevant function from ironic_lib.utils.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The second is the fix for the security issue:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Co-Authored-By: Dmitry Tantsur &lt;email address hidden&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927976
Committed: https://opendev.org/openstack/ironic-python-agent/commit/06fe5ff1782551e6f94640d47ea942ab81f18909
Submitter: "Zuul (22348)"
Branch:    stable/2024.1

commit 06fe5ff1782551e6f94640d47ea942ab81f18909
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Mon Mar 11 17:29:58 2024 +0100

    Inspect non-raw images for safety
    
    This is a backport of two changes merged together to facilitate
    backporting:
    
    The first is a refactor of disk utilities:
    
    Import disk_{utils,partitioner} from ironic-lib
    
    With the iscsi deploy long gone, these modules are only used in IPA and
    in fact represent a large part of its critical logic. Having them
    separately sometimes makes fixing issues tricky if an interface of
    a function needs changing.
    
    This change imports the code mostly as it is, just removing run_as_root and
    a deprecated function, as well as moving configuration options to config.py.
    
    Also migrates one relevant function from ironic_lib.utils.
    
    The second is the fix for the security issue:
    
    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Co-Authored-By: Dmitry Tantsur &lt;dtantsur@protonmail.com&gt;
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/129" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T01:30:49.407510+00:00" title="2024-09-05 01:30:49 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/129">
                <strong>Fix merged to ironic-python-agent (stable/2023.2)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/129"> #129</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927978">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927978</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/b7fa84dcc1284beef87480af8fd32784dd3a80f6">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />b7fa84dcc1284be<wbr />ef87480af8fd327<wbr />84dd3a80f6</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.2</p>
<p>commit b7fa84dcc1284be<wbr />ef87480af8fd327<wbr />84dd3a80f6<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Mon Mar 11 17:29:58 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This is a backport of two changes merged together to facilitate<br />
&nbsp;&nbsp;&nbsp;&nbsp;backporting:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The first is a refactor of disk utilities:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Import disk_{utils,<wbr />partitioner} from ironic-lib</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;With the iscsi deploy long gone, these modules are only used in IPA and<br />
&nbsp;&nbsp;&nbsp;&nbsp;in fact represent a large part of its critical logic. Having them<br />
&nbsp;&nbsp;&nbsp;&nbsp;separately sometimes makes fixing issues tricky if an interface of<br />
&nbsp;&nbsp;&nbsp;&nbsp;a function needs changing.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the code mostly as it is, just removing run_as_root and<br />
&nbsp;&nbsp;&nbsp;&nbsp;a deprecated function, as well as moving configuration options to config.py.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Also migrates one relevant function from ironic_lib.utils.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The second is the fix for the security issue:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Co-Authored-By: Dmitry Tantsur &lt;email address hidden&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927978
Committed: https://opendev.org/openstack/ironic-python-agent/commit/b7fa84dcc1284beef87480af8fd32784dd3a80f6
Submitter: "Zuul (22348)"
Branch:    stable/2023.2

commit b7fa84dcc1284beef87480af8fd32784dd3a80f6
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Mon Mar 11 17:29:58 2024 +0100

    Inspect non-raw images for safety
    
    This is a backport of two changes merged together to facilitate
    backporting:
    
    The first is a refactor of disk utilities:
    
    Import disk_{utils,partitioner} from ironic-lib
    
    With the iscsi deploy long gone, these modules are only used in IPA and
    in fact represent a large part of its critical logic. Having them
    separately sometimes makes fixing issues tricky if an interface of
    a function needs changing.
    
    This change imports the code mostly as it is, just removing run_as_root and
    a deprecated function, as well as moving configuration options to config.py.
    
    Also migrates one relevant function from ironic_lib.utils.
    
    The second is the fix for the security issue:
    
    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Co-Authored-By: Dmitry Tantsur &lt;dtantsur@protonmail.com&gt;
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/130" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T01:30:53.729335+00:00" title="2024-09-05 01:30:53 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/130">
                <strong>Fix merged to ironic-python-agent (bugfix/9.13)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/130"> #130</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927981">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927981</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/9be29ad1dd1ce7ddeec1c6c4498b99d17fd42625">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />9be29ad1dd1ce7d<wbr />deec1c6c4498b99<wbr />d17fd42625</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    bugfix/9.13</p>
<p>commit 9be29ad1dd1ce7d<wbr />deec1c6c4498b99<wbr />d17fd42625<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Jul 30 11:18:14 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927981
Committed: https://opendev.org/openstack/ironic-python-agent/commit/9be29ad1dd1ce7ddeec1c6c4498b99d17fd42625
Submitter: "Zuul (22348)"
Branch:    bugfix/9.13

commit 9be29ad1dd1ce7ddeec1c6c4498b99d17fd42625
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Jul 30 11:18:14 2024 -0700

    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/131" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T01:30:58.085082+00:00" title="2024-09-05 01:30:58 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/131">
                <strong>Fix merged to ironic-python-agent (bugfix/9.12)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/131"> #131</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927983">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927983</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/be8ee50ea1b0fbccf91ea4e4180af1f0e8154cdb">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />be8ee50ea1b0fbc<wbr />cf91ea4e4180af1<wbr />f0e8154cdb</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    bugfix/9.12</p>
<p>commit be8ee50ea1b0fbc<wbr />cf91ea4e4180af1<wbr />f0e8154cdb<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Jul 30 11:18:14 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927983
Committed: https://opendev.org/openstack/ironic-python-agent/commit/be8ee50ea1b0fbccf91ea4e4180af1f0e8154cdb
Submitter: "Zuul (22348)"
Branch:    bugfix/9.12

commit be8ee50ea1b0fbccf91ea4e4180af1f0e8154cdb
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Jul 30 11:18:14 2024 -0700

    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/132" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T02:43:39.811271+00:00" title="2024-09-05 02:43:39 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/132">
                <strong>Fix merged to ironic (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/132"> #132</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927965">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927965</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/c996aafa6d2fb7cb90da6f6126bf385635cdf32e">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />c996aafa6d2fb7c<wbr />b90da6f6126bf38<wbr />5635cdf32e</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    master</p>
<p>commit c996aafa6d2fb7c<wbr />b90da6f6126bf38<wbr />5635cdf32e<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on untrusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927965
Committed: https://opendev.org/openstack/ironic/commit/c996aafa6d2fb7cb90da6f6126bf385635cdf32e
Submitter: "Zuul (22348)"
Branch:    master

commit c996aafa6d2fb7cb90da6f6126bf385635cdf32e
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on untrusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ironic: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/133" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T03:00:11.758766+00:00" title="2024-09-05 03:00:11 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/133">
                <strong>Fix merged to ironic (bugfix/26.0)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/133"> #133</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927966">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927966</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/56ffe4f8ca7a7defaa45067f6a937f11d1305614">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />56ffe4f8ca7a7de<wbr />faa45067f6a937f<wbr />11d1305614</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    bugfix/26.0</p>
<p>commit 56ffe4f8ca7a7de<wbr />faa45067f6a937f<wbr />11d1305614<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on untrusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927966
Committed: https://opendev.org/openstack/ironic/commit/56ffe4f8ca7a7defaa45067f6a937f11d1305614
Submitter: "Zuul (22348)"
Branch:    bugfix/26.0

commit 56ffe4f8ca7a7defaa45067f6a937f11d1305614
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on untrusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/134" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T03:00:25.610683+00:00" title="2024-09-05 03:00:25 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/134">
                <strong>Fix merged to ironic (bugfix/25.0)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/134"> #134</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927967">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927967</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/019aff28f14a99961c364df6dfb3369160d811fb">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />019aff28f14a999<wbr />61c364df6dfb336<wbr />9160d811fb</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    bugfix/25.0</p>
<p>commit 019aff28f14a999<wbr />61c364df6dfb336<wbr />9160d811fb<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;master branch - ironic-<wbr />master-<wbr />branch-<a href="/bugs/2071740" class="bug-link">bug-2071740</a>-20240820.patch<br />
&nbsp;&nbsp;&nbsp;&nbsp;bugfix/26.0 - ironic-bugfix-26.0-<a href="/bugs/2071740" class="bug-link">bug-2071740</a>-20240820.patch</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927967
Committed: https://opendev.org/openstack/ironic/commit/019aff28f14a99961c364df6dfb3369160d811fb
Submitter: "Zuul (22348)"
Branch:    bugfix/25.0

commit 019aff28f14a99961c364df6dfb3369160d811fb
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    
    master branch - ironic-master-branch-bug-2071740-20240820.patch
    bugfix/26.0 - ironic-bugfix-26.0-bug-2071740-20240820.patch
    
    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/135" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T04:09:27.601163+00:00" title="2024-09-05 04:09:27 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/135">
                <strong>Fix merged to ironic (bugfix/24.0)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/135"> #135</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927969">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927969</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/07bb2caf3c75cda2b7a20e956836c72cdadca926">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />07bb2caf3c75cda<wbr />2b7a20e956836c7<wbr />2cdadca926</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    bugfix/24.0</p>
<p>commit 07bb2caf3c75cda<wbr />2b7a20e956836c7<wbr />2cdadca926<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927969
Committed: https://opendev.org/openstack/ironic/commit/07bb2caf3c75cda2b7a20e956836c72cdadca926
Submitter: "Zuul (22348)"
Branch:    bugfix/24.0

commit 07bb2caf3c75cda2b7a20e956836c72cdadca926
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/136" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T08:39:46.376090+00:00" title="2024-09-05 08:39:46 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/136">
                <strong>Fix merged to ironic (stable/2024.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/136"> #136</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927968">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927968</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/f7c7ea935ac5acfc22decbb51da316837b77e69b">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />f7c7ea935ac5acf<wbr />c22decbb51da316<wbr />837b77e69b</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2024.1</p>
<p>commit f7c7ea935ac5acf<wbr />c22decbb51da316<wbr />837b77e69b<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927968
Committed: https://opendev.org/openstack/ironic/commit/f7c7ea935ac5acfc22decbb51da316837b77e69b
Submitter: "Zuul (22348)"
Branch:    stable/2024.1

commit f7c7ea935ac5acfc22decbb51da316837b77e69b
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/137" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-05T11:16:30.725121+00:00" title="2024-09-05 11:16:30 UTC">on 2024-09-05</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/137">
                <strong>Fix merged to ironic (stable/2023.2)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/137"> #137</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927970">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927970</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/6a7c1ce16056276c2dd347b42ebb7f097d86b282">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />6a7c1ce16056276<wbr />c2dd347b42ebb7f<wbr />097d86b282</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.2</p>
<p>commit 6a7c1ce16056276<wbr />c2dd347b42ebb7f<wbr />097d86b282<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927970
Committed: https://opendev.org/openstack/ironic/commit/6a7c1ce16056276c2dd347b42ebb7f097d86b282
Submitter: "Zuul (22348)"
Branch:    stable/2023.2

commit 6a7c1ce16056276c2dd347b42ebb7f097d86b282
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/138" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-06T14:41:43.219738+00:00" title="2024-09-06 14:41:43 UTC">on 2024-09-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/138">
                <strong>Fix merged to ironic (stable/2023.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/138"> #138</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927972">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927972</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/188d43616121f8c6652c902ce6011cc6d42a9433">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />188d43616121f8c<wbr />6652c902ce6011c<wbr />c6d42a9433</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.1</p>
<p>commit 188d43616121f8c<wbr />6652c902ce6011c<wbr />c6d42a9433<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927972
Committed: https://opendev.org/openstack/ironic/commit/188d43616121f8c6652c902ce6011cc6d42a9433
Submitter: "Zuul (22348)"
Branch:    stable/2023.1

commit 188d43616121f8c6652c902ce6011cc6d42a9433
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/139" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-06T16:18:20.025945+00:00" title="2024-09-06 16:18:20 UTC">on 2024-09-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/139">
                <strong>Fix merged to ironic (unmaintained/zed)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/139"> #139</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927973">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927973</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/b4530e85b7754018584e1b364e772105a3605b24">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />b4530e85b775401<wbr />8584e1b364e7721<wbr />05a3605b24</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/zed</p>
<p>commit b4530e85b775401<wbr />8584e1b364e7721<wbr />05a3605b24<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927973
Committed: https://opendev.org/openstack/ironic/commit/b4530e85b7754018584e1b364e772105a3605b24
Submitter: "Zuul (22348)"
Branch:    unmaintained/zed

commit b4530e85b7754018584e1b364e772105a3605b24
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-zed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/140" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-06T19:47:08.094464+00:00" title="2024-09-06 19:47:08 UTC">on 2024-09-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/140">
                <strong>Fix merged to ironic-python-agent (stable/2023.1)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/140"> #140</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927979">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927979</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/a1da3c9322305a5540a23ca19048ce7aa552a405">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />a1da3c9322305a5<wbr />540a23ca19048ce<wbr />7aa552a405</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    stable/2023.1</p>
<p>commit a1da3c9322305a5<wbr />540a23ca19048ce<wbr />7aa552a405<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Mon Mar 11 17:29:58 2024 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This is a backport of two changes merged together to facilitate<br />
&nbsp;&nbsp;&nbsp;&nbsp;backporting:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The first is a refactor of disk utilities:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Import disk_{utils,<wbr />partitioner} from ironic-lib</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;With the iscsi deploy long gone, these modules are only used in IPA and<br />
&nbsp;&nbsp;&nbsp;&nbsp;in fact represent a large part of its critical logic. Having them<br />
&nbsp;&nbsp;&nbsp;&nbsp;separately sometimes makes fixing issues tricky if an interface of<br />
&nbsp;&nbsp;&nbsp;&nbsp;a function needs changing.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the code mostly as it is, just removing run_as_root and<br />
&nbsp;&nbsp;&nbsp;&nbsp;a deprecated function, as well as moving configuration options to config.py.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Also migrates one relevant function from ironic_lib.utils.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The second is the fix for the security issue:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Inspect non-raw images for safety</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When IPA gets a non-raw image, it performs an on-the-fly conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;using qemu-img convert, as well as running qemu-img frequently to get<br />
&nbsp;&nbsp;&nbsp;&nbsp;basic information about the image before validating it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Now, we ensure that before any qemu-img calls are made, that we have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspected the image for safety and pass through the detected format.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is enabled<br />
&nbsp;&nbsp;&nbsp;&nbsp;(default), we retain the existing behavior of not inspecting it in<br />
&nbsp;&nbsp;&nbsp;&nbsp;any way and streaming it bit-perfect to the device. In this case, we<br />
&nbsp;&nbsp;&nbsp;&nbsp;never use qemu-based tools on the image at all.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If given a disk_format=raw image and image streaming is disabled, this<br />
&nbsp;&nbsp;&nbsp;&nbsp;change fixes a bug where the image may have been converted if it was not<br />
&nbsp;&nbsp;&nbsp;&nbsp;actually raw in the first place. We now stream these bit-perfect to the<br />
&nbsp;&nbsp;&nbsp;&nbsp;device.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds two config options:<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/disable_<wbr />deep_image_<wbr />inspection, which can be set to &quot;True&quot; in<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order to disable all security features. Do not do this.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- [DEFAULT]<wbr />/permitted_<wbr />image_formats, default raw,qcow2, for image types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IPA should accept.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Both of these configuration options are wired up to be set by the lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;data returned by Ironic at lookup time.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This uses a image format inspection module imported from Nova; this<br />
&nbsp;&nbsp;&nbsp;&nbsp;inspector will eventually live in oslo.utils, at which point we&#x27;ll<br />
&nbsp;&nbsp;&nbsp;&nbsp;migrate our usage of the inspector to it.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Co-Authored-By: Dmitry Tantsur &lt;email address hidden&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5254b80717cb5a<wbr />7f9084e3eff32a0<wbr />0b968f987b7</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927979
Committed: https://opendev.org/openstack/ironic-python-agent/commit/a1da3c9322305a5540a23ca19048ce7aa552a405
Submitter: "Zuul (22348)"
Branch:    stable/2023.1

commit a1da3c9322305a5540a23ca19048ce7aa552a405
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Mon Mar 11 17:29:58 2024 +0100

    Inspect non-raw images for safety
    
    This is a backport of two changes merged together to facilitate
    backporting:
    
    The first is a refactor of disk utilities:
    
    Import disk_{utils,partitioner} from ironic-lib
    
    With the iscsi deploy long gone, these modules are only used in IPA and
    in fact represent a large part of its critical logic. Having them
    separately sometimes makes fixing issues tricky if an interface of
    a function needs changing.
    
    This change imports the code mostly as it is, just removing run_as_root and
    a deprecated function, as well as moving configuration options to config.py.
    
    Also migrates one relevant function from ironic_lib.utils.
    
    The second is the fix for the security issue:
    
    Inspect non-raw images for safety
    
    When IPA gets a non-raw image, it performs an on-the-fly conversion
    using qemu-img convert, as well as running qemu-img frequently to get
    basic information about the image before validating it.
    
    Now, we ensure that before any qemu-img calls are made, that we have
    inspected the image for safety and pass through the detected format.
    
    If given a disk_format=raw image and image streaming is enabled
    (default), we retain the existing behavior of not inspecting it in
    any way and streaming it bit-perfect to the device. In this case, we
    never use qemu-based tools on the image at all.
    
    If given a disk_format=raw image and image streaming is disabled, this
    change fixes a bug where the image may have been converted if it was not
    actually raw in the first place. We now stream these bit-perfect to the
    device.
    
    Adds two config options:
    - [DEFAULT]/disable_deep_image_inspection, which can be set to "True" in
      order to disable all security features. Do not do this.
    - [DEFAULT]/permitted_image_formats, default raw,qcow2, for image types
      IPA should accept.
    
    Both of these configuration options are wired up to be set by the lookup
    data returned by Ironic at lookup time.
    
    This uses a image format inspection module imported from Nova; this
    inspector will eventually live in oslo.utils, at which point we'll
    migrate our usage of the inspector to it.
    
    Closes-Bug: #2071740
    Co-Authored-By: Dmitry Tantsur &lt;dtantsur@protonmail.com&gt;
    Change-Id: I5254b80717cb5a7f9084e3eff32a00b968f987b7
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/141" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-07T17:09:14.398408+00:00" title="2024-09-07 17:09:14 UTC">on 2024-09-07</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/141">
                <strong>Fix merged to ironic (unmaintained/yoga)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/141"> #141</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927975">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927975</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/4b45309628d67f72eea3e7fef72ff72eb1997b12">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />4b45309628d67f7<wbr />2eea3e7fef72ff7<wbr />2eb1997b12</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/yoga</p>
<p>commit 4b45309628d67f7<wbr />2eea3e7fef72ff7<wbr />2eb1997b12<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927975
Committed: https://opendev.org/openstack/ironic/commit/4b45309628d67f72eea3e7fef72ff72eb1997b12
Submitter: "Zuul (22348)"
Branch:    unmaintained/yoga

commit 4b45309628d67f72eea3e7fef72ff72eb1997b12
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-yoga
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/142" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-09T03:10:00.084854+00:00" title="2024-09-09 03:10:00 UTC">on 2024-09-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/142">
                <strong>Fix merged to ironic (unmaintained/xena)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/142"> #142</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927977">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927977</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/77cbe2aca6fc8d300d4a9601a430a18856b6d216">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />77cbe2aca6fc8d3<wbr />00d4a9601a430a1<wbr />8856b6d216</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/xena</p>
<p>commit 77cbe2aca6fc8d3<wbr />00d4a9601a430a1<wbr />8856b6d216<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927977
Committed: https://opendev.org/openstack/ironic/commit/77cbe2aca6fc8d300d4a9601a430a18856b6d216
Submitter: "Zuul (22348)"
Branch:    unmaintained/xena

commit 77cbe2aca6fc8d300d4a9601a430a18856b6d216
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-xena
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/143" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-09T04:14:25.902668+00:00" title="2024-09-09 04:14:25 UTC">on 2024-09-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/143">
                <strong>Fix merged to ironic (unmaintained/wallaby)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/143"> #143</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927980">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927980</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/fb3d7a915debf329747212446bf8cad665fcd2d6">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />fb3d7a915debf32<wbr />9747212446bf8ca<wbr />d665fcd2d6</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/<wbr />wallaby</p>
<p>commit fb3d7a915debf32<wbr />9747212446bf8ca<wbr />d665fcd2d6<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927980
Committed: https://opendev.org/openstack/ironic/commit/fb3d7a915debf329747212446bf8cad665fcd2d6
Submitter: "Zuul (22348)"
Branch:    unmaintained/wallaby

commit fb3d7a915debf329747212446bf8cad665fcd2d6
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-wallaby
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/144" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-09T13:45:46.878720+00:00" title="2024-09-09 13:45:46 UTC">on 2024-09-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/144">
                <strong>Fix merged to ironic (unmaintained/victoria)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/144"> #144</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic/+/927982">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic/<wbr />+/927982</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic/commit/eafaea67aa9493a8ae3225629040c5829a1d73ae">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic/<wbr />commit/<wbr />eafaea67aa9493a<wbr />8ae3225629040c5<wbr />829a1d73ae</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/<wbr />victoria</p>
<p>commit eafaea67aa9493a<wbr />8ae3225629040c5<wbr />829a1d73ae<br />
Author: Julia Kreger &lt;email address hidden&gt;<br />
Date:   Thu Aug 8 12:42:20 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44982: Harden all image handling and conversion code</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It was recently learned by the OpenStack community that running qemu-img<br />
&nbsp;&nbsp;&nbsp;&nbsp;on un-trusted images without a format pre-specified can present a<br />
&nbsp;&nbsp;&nbsp;&nbsp;security risk. Furthermore, some of these specific image formats have<br />
&nbsp;&nbsp;&nbsp;&nbsp;inherently unsafe features. This is rooted in how qemu-img operates<br />
&nbsp;&nbsp;&nbsp;&nbsp;where all image drivers are loaded and attempt to evaluate the input data.<br />
&nbsp;&nbsp;&nbsp;&nbsp;This can result in several different vectors which this patch works to<br />
&nbsp;&nbsp;&nbsp;&nbsp;close.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This change imports the qemu-img handling code from Ironic-Lib into<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic, and image format inspection code, which has been developed by<br />
&nbsp;&nbsp;&nbsp;&nbsp;the wider community to validate general safety of images before converting<br />
&nbsp;&nbsp;&nbsp;&nbsp;them for use in a deployment.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch contains functional changes related to the hardening of these<br />
&nbsp;&nbsp;&nbsp;&nbsp;calls including how images are handled, and updates documentation to<br />
&nbsp;&nbsp;&nbsp;&nbsp;provide context and guidance to operators.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7fac5c64f89aec<wbr />39e9755f0930ee4<wbr />7ff8f7aed47<br />
&nbsp;&nbsp;&nbsp;&nbsp;Signed-off-by: Julia Kreger &lt;email address hidden&gt;</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic/+/927982
Committed: https://opendev.org/openstack/ironic/commit/eafaea67aa9493a8ae3225629040c5829a1d73ae
Submitter: "Zuul (22348)"
Branch:    unmaintained/victoria

commit eafaea67aa9493a8ae3225629040c5829a1d73ae
Author: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
Date:   Thu Aug 8 12:42:20 2024 -0700

    CVE-2024-44982: Harden all image handling and conversion code
    
    It was recently learned by the OpenStack community that running qemu-img
    on un-trusted images without a format pre-specified can present a
    security risk. Furthermore, some of these specific image formats have
    inherently unsafe features. This is rooted in how qemu-img operates
    where all image drivers are loaded and attempt to evaluate the input data.
    This can result in several different vectors which this patch works to
    close.
    
    This change imports the qemu-img handling code from Ironic-Lib into
    Ironic, and image format inspection code, which has been developed by
    the wider community to validate general safety of images before converting
    them for use in a deployment.
    
    This patch contains functional changes related to the hardening of these
    calls including how images are handled, and updates documentation to
    provide context and guidance to operators.
    
    Closes-Bug: 2071740
    Change-Id: I7fac5c64f89aec39e9755f0930ee47ff8f7aed47
    Signed-off-by: Julia Kreger &lt;juliaashleykreger@gmail.com&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-unmaintained-victoria
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/145" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:13:37.920580+00:00" title="2024-09-12 16:13:37 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/145">
                <strong>Fix included in openstack/ironic-python-agent 9.4.2</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/145"> #145</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/<wbr />ironic-<wbr />python-<wbr />agent 9.4.2  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic-python-agent 9.4.2  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/146" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:13:58.508979+00:00" title="2024-09-12 16:13:58 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/146">
                <strong>Fix included in openstack/ironic 21.4.3</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/146"> #146</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/ironic 21.4.3  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic 21.4.3  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/147" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:14:19.614555+00:00" title="2024-09-12 16:14:19 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/147">
                <strong>Fix included in openstack/ironic-python-agent 9.7.2</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/147"> #147</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/<wbr />ironic-<wbr />python-<wbr />agent 9.7.2  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic-python-agent 9.7.2  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/148" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:14:42.891397+00:00" title="2024-09-12 16:14:42 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/148">
                <strong>Fix included in openstack/ironic 23.0.2</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/148"> #148</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/ironic 23.0.2  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic 23.0.2  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/149" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:15:08.381783+00:00" title="2024-09-12 16:15:08 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/149">
                <strong>Fix included in openstack/ironic-python-agent 9.11.1</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/149"> #149</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/<wbr />ironic-<wbr />python-<wbr />agent 9.11.1  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic-python-agent 9.11.1  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/150" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T16:15:30.402138+00:00" title="2024-09-12 16:15:30 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/150">
                <strong>Fix included in openstack/ironic 24.1.2</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/150"> #150</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/ironic 24.1.2  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic 24.1.2  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/151" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T18:48:11.733356+00:00" title="2024-09-12 18:48:11 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/151">
                <strong>Related fix merged to ironic-python-agent (unmaintained/zed)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/151"> #151</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927985">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927985</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/a1b9170520696cf5d14972a31781e4770588cb41">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />a1b9170520696cf<wbr />5d14972a31781e4<wbr />770588cb41</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/zed</p>
<p>commit a1b9170520696cf<wbr />5d14972a31781e4<wbr />770588cb41<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Aug 20 15:09:33 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Warn about CVE-2024-44082</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Unmaintained Ironic-Python-Agent branches will not be patched against<br />
&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44082. This patch updates the release notes and readme<br />
&nbsp;&nbsp;&nbsp;&nbsp;instructing deployers how to mitigate their risk using the provided<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic conductor patches.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ie4aeef4af01ead<wbr />5c18b359a22ab48<wbr />8de0c35248a</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927985
Committed: https://opendev.org/openstack/ironic-python-agent/commit/a1b9170520696cf5d14972a31781e4770588cb41
Submitter: "Zuul (22348)"
Branch:    unmaintained/zed

commit a1b9170520696cf5d14972a31781e4770588cb41
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Aug 20 15:09:33 2024 -0700

    Warn about CVE-2024-44082
    
    Unmaintained Ironic-Python-Agent branches will not be patched against
    CVE-2024-44082. This patch updates the release notes and readme
    instructing deployers how to mitigate their risk using the provided
    Ironic conductor patches.
    
    Related-Bug: 2071740
    Change-Id: Ie4aeef4af01ead5c18b359a22ab488de0c35248a
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/152" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T18:48:18.725281+00:00" title="2024-09-12 18:48:18 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/152">
                <strong>Related fix merged to ironic-python-agent (unmaintained/yoga)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/152"> #152</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927986">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927986</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/54ec5860f4bd2c469071519e96e28aebb9a95615">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />54ec5860f4bd2c4<wbr />69071519e96e28a<wbr />ebb9a95615</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/yoga</p>
<p>commit 54ec5860f4bd2c4<wbr />69071519e96e28a<wbr />ebb9a95615<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Aug 20 15:09:33 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Warn about CVE-2024-44082</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Unmaintained Ironic-Python-Agent branches will not be patched against<br />
&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44082. This patch updates the release notes and readme<br />
&nbsp;&nbsp;&nbsp;&nbsp;instructing deployers how to mitigate their risk using the provided<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic conductor patches.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ie4aeef4af01ead<wbr />5c18b359a22ab48<wbr />8de0c35248a</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927986
Committed: https://opendev.org/openstack/ironic-python-agent/commit/54ec5860f4bd2c469071519e96e28aebb9a95615
Submitter: "Zuul (22348)"
Branch:    unmaintained/yoga

commit 54ec5860f4bd2c469071519e96e28aebb9a95615
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Aug 20 15:09:33 2024 -0700

    Warn about CVE-2024-44082
    
    Unmaintained Ironic-Python-Agent branches will not be patched against
    CVE-2024-44082. This patch updates the release notes and readme
    instructing deployers how to mitigate their risk using the provided
    Ironic conductor patches.
    
    Related-Bug: 2071740
    Change-Id: Ie4aeef4af01ead5c18b359a22ab488de0c35248a
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/153" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T19:11:04.252775+00:00" title="2024-09-12 19:11:04 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/153">
                <strong>Related fix merged to ironic-python-agent (unmaintained/xena)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/153"> #153</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927987">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927987</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/823f1f68cc1e465c0193d7e7f34b0a5e8f1eb329">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />823f1f68cc1e465<wbr />c0193d7e7f34b0a<wbr />5e8f1eb329</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/xena</p>
<p>commit 823f1f68cc1e465<wbr />c0193d7e7f34b0a<wbr />5e8f1eb329<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Aug 20 15:09:33 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Warn about CVE-2024-44082</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Unmaintained Ironic-Python-Agent branches will not be patched against<br />
&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44082. This patch updates the release notes and readme<br />
&nbsp;&nbsp;&nbsp;&nbsp;instructing deployers how to mitigate their risk using the provided<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic conductor patches.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ie4aeef4af01ead<wbr />5c18b359a22ab48<wbr />8de0c35248a</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927987
Committed: https://opendev.org/openstack/ironic-python-agent/commit/823f1f68cc1e465c0193d7e7f34b0a5e8f1eb329
Submitter: "Zuul (22348)"
Branch:    unmaintained/xena

commit 823f1f68cc1e465c0193d7e7f34b0a5e8f1eb329
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Aug 20 15:09:33 2024 -0700

    Warn about CVE-2024-44082
    
    Unmaintained Ironic-Python-Agent branches will not be patched against
    CVE-2024-44082. This patch updates the release notes and readme
    instructing deployers how to mitigate their risk using the provided
    Ironic conductor patches.
    
    Related-Bug: 2071740
    Change-Id: Ie4aeef4af01ead5c18b359a22ab488de0c35248a
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/154" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-12T19:11:09.909472+00:00" title="2024-09-12 19:11:09 UTC">on 2024-09-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/154">
                <strong>Related fix merged to ironic-python-agent (unmaintained/wallaby)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/154"> #154</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927988">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927988</a><br />
Committed: <a rel="nofollow" href="https://opendev.org/openstack/ironic-python-agent/commit/1622362097ea1957641e4674e1ff27b5613b4a5a">https:/<wbr />/opendev.<wbr />org/openstack/<wbr />ironic-<wbr />python-<wbr />agent/commit/<wbr />1622362097ea195<wbr />7641e4674e1ff27<wbr />b5613b4a5a</a><br />
Submitter: &quot;Zuul (22348)&quot;<br />
Branch:    unmaintained/<wbr />wallaby</p>
<p>commit 1622362097ea195<wbr />7641e4674e1ff27<wbr />b5613b4a5a<br />
Author: Jay Faulkner &lt;email address hidden&gt;<br />
Date:   Tue Aug 20 15:09:33 2024 -0700</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Warn about CVE-2024-44082</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Unmaintained Ironic-Python-Agent branches will not be patched against<br />
&nbsp;&nbsp;&nbsp;&nbsp;CVE-2024-44082. This patch updates the release notes and readme<br />
&nbsp;&nbsp;&nbsp;&nbsp;instructing deployers how to mitigate their risk using the provided<br />
&nbsp;&nbsp;&nbsp;&nbsp;Ironic conductor patches.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: 2071740<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ie4aeef4af01ead<wbr />5c18b359a22ab48<wbr />8de0c35248a</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.opendev.org/c/openstack/ironic-python-agent/+/927988
Committed: https://opendev.org/openstack/ironic-python-agent/commit/1622362097ea1957641e4674e1ff27b5613b4a5a
Submitter: "Zuul (22348)"
Branch:    unmaintained/wallaby

commit 1622362097ea1957641e4674e1ff27b5613b4a5a
Author: Jay Faulkner &lt;jay@jvf.cc&gt;
Date:   Tue Aug 20 15:09:33 2024 -0700

    Warn about CVE-2024-44082
    
    Unmaintained Ironic-Python-Agent branches will not be patched against
    CVE-2024-44082. This patch updates the release notes and readme
    instructing deployers how to mitigate their risk using the provided
    Ironic conductor patches.
    
    Related-Bug: 2071740
    Change-Id: Ie4aeef4af01ead5c18b359a22ab488de0c35248a
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/155" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-20T10:38:47.223695+00:00" title="2024-09-20 10:38:47 UTC">on 2024-09-20</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/155">
                <strong>Fix included in openstack/ironic-python-agent 9.14.0</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/155"> #155</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/<wbr />ironic-<wbr />python-<wbr />agent 9.14.0  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic-python-agent 9.14.0  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/156" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-09-20T12:43:59.926470+00:00" title="2024-09-20 12:43:59 UTC">on 2024-09-20</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/156">
                <strong>Fix included in openstack/ironic 26.1.0</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/156"> #156</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/ironic 26.1.0  release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/ironic 26.1.0  release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/157" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-11-06T23:13:06.162235+00:00" title="2024-11-06 23:13:06 UTC">on 2024-11-06</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/157">
                <strong>Change abandoned on ironic-python-agent (unmaintained/victoria)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/157"> #157</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Change abandoned by &quot;Jay Faulkner &lt;email address hidden&gt;&quot; on branch: unmaintained/<wbr />victoria<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927990">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927990</a><br />
Reason: This warning is not worth fixing CI on IPA victoria.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Change abandoned by "Jay Faulkner &lt;jay@jvf.cc&gt;" on branch: unmaintained/victoria
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927990
Reason: This warning is not worth fixing CI on IPA victoria.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ironic/+bug/2071740/comments/158" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2024-11-25T15:07:18.060798+00:00" title="2024-11-25 15:07:18 UTC">on 2024-11-25</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ironic/+bug/2071740/comments/158">
                <strong>Change abandoned on ironic-python-agent (bugfix/9.9)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ironic/+bug/2071740/comments/158"> #158</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Change abandoned by &quot;Riccardo Pittau &lt;email address hidden&gt;&quot; on branch: bugfix/9.9<br />
Review: <a rel="nofollow" href="https://review.opendev.org/c/openstack/ironic-python-agent/+/927984">https:/<wbr />/review.<wbr />opendev.<wbr />org/c/openstack<wbr />/ironic-<wbr />python-<wbr />agent/+<wbr />/927984</a><br />
Reason: bugfix/9.9 is not supported anymore</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Change abandoned by "Riccardo Pittau &lt;elfosardo@gmail.com&gt;" on branch: bugfix/9.9
Review: https://review.opendev.org/c/openstack/ironic-python-agent/+/927984
Reason: bugfix/9.9 is not supported anymore</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/ironic/+bug/2071740/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
        
          <div class="informational message comments-hidden-message">
            Displaying first 40
            and last 40
            comments.
            
              <a class="show-comments-link" href="/ironic/+bug/2071740?comments=all">
                View all 158
                comments</a> or <a href="/ironic/+bug/2071740?comments=all">add a comment</a>.
            
          </div>
            
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/ironic/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    
    
    
    
    
    
    
  </ul>
  <ul id="lock-status-actions">
    
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/ironic/+bug/2071740/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/ironic/+bug/2071740/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/ironic/+bug/2071740/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807498/+files/master-ipa-0001-Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">2024-08-20 Master IPA</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807498">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807499/+files/2024-1-ipa-0001-Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">2024-08-20 2024.1 IPA</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807499">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807500/+files/2023-2_IPA_Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">2024-08-20 2023.2 IPA</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807500">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807501/+files/2023-1_IPA_Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">2024-08-20 2023.1 IPA</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807501">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807502/+files/zed-ipa-0001-unmaintained-only-Warn-about-CVE-2024-44082.patch" class="sprite haspatch-icon">2024-08-20 um-zed ipa warning</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807502">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807522/+files/ironic-master-branch-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-master-branch-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807522">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807523/+files/ironic-bugfix-26.0-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-bugfix-26.0-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807523">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807524/+files/ironic-bugfix-25.0-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-bugfix-25.0-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807524">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807525/+files/ironic-stable-2024.1-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-stable-2024.1-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807525">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807526/+files/ironic-bugfix-24.0-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-bugfix-24.0-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807526">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807527/+files/ironic-stable-2023.2-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-stable-2023.2-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807527">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807528/+files/ironic-stable-2023.1-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-stable-2023.1-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807528">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807529/+files/ironic-unmaintained-zed-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-unmaintained-zed-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807529">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807530/+files/ironic-unmaintained-yoga-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-unmaintained-yoga-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807530">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807531/+files/ironic-unmaintained-xena-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-unmaintained-xena-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807531">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807532/+files/ironic-unmaintained-wallaby-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-unmaintained-wallaby-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807532">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5807533/+files/ironic-unmaintained-victoria-bug-2071740-20240820.patch" class="sprite haspatch-icon">ironic-unmaintained-victoria-bug-2071740-20240820.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5807533">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5809542/+files/bugfix-9-13-0001-Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">ipa-bugfix-9-13-0001-Inspect-non-raw-images-for-safety.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5809542">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5809543/+files/bugfix-9-12-0001-Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">ipa-bugfix-9-12-0001-Inspect-non-raw-images-for-safety.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5809543">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5809544/+files/bugfix-9-9-0001-Inspect-non-raw-images-for-safety.patch" class="sprite haspatch-icon">ipa-bugfix-9-9-0001-Inspect-non-raw-images-for-safety.patch</a>
        <a class="sprite edit action-icon" title="Change patch details" href="/ironic/+bug/2071740/+attachment/5809544">Edit</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/ironic/+bug/2071740/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5801053/+files/image_test.bash" class="sprite download-icon">image_test.bash</a>
        <a class="sprite edit action-icon" title="Change attachment details" href="/ironic/+bug/2071740/+attachment/5801053">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5802184/+files/test_image.sh" class="sprite download-icon">test_image.sh</a>
        <a class="sprite edit action-icon" title="Change attachment details" href="/ironic/+bug/2071740/+attachment/5802184">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5803651/+files/test_image.sh" class="sprite download-icon">test_image.sh</a>
        <a class="sprite edit action-icon" title="Change attachment details" href="/ironic/+bug/2071740/+attachment/5803651">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5808815/+files/OSSA-2024-003_draft.patch" class="sprite download-icon">OSSA-2024-003_draft.patch</a>
        <a class="sprite edit action-icon" title="Change attachment details" href="/ironic/+bug/2071740/+attachment/5808815">Edit</a>
      </li>
      <li class="download-attachment">
        <a href="https://bugs.launchpad.net/ironic/+bug/2071740/+attachment/5810401/+files/0001-Add-OSSA-2024-003-CVE-2024-44082.patch" class="sprite download-icon">Draft of OSSA-2024-003 (version of 2024-08-29</a>
        <a class="sprite edit action-icon" title="Change attachment details" href="/ironic/+bug/2071740/+attachment/5810401">Edit</a>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/ironic/+bug/2071740/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      <div class="portlet" id="portlet-watches">
  <h2>Remote bug watches</h2>
  <ul>
  </ul>
  <p>Bug watches keep track of this bug in other bug trackers.</p>
</div>

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-footer-logo.svg" alt="Launchpad" width="65" height="18" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://ubuntu.social/@launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        6394e03
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"related_features": {}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/2071740", "web_link": "https://bugs.launchpad.net/bugs/2071740", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 2071740, "private": false, "information_type": "Public Security", "name": null, "title": "[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)", "description": "It recently came to light that processing untrusted image data with qemu-based tools, such as qemu-img, is not expected to be secure.\n\nironic-lib's qemu_img module should validate images are as expected, and don't contain potentially harmful things such as QCOW2 backing file.\n\nAdditionally, we should avoid calling qemu-img without specifying the image type specifically as this is an additional layer of validation.\n\nhttps://bugs.launchpad.net/nova/+bug/2059809 and associated patches can be used as an example of the potential fix we should do.", "owner_link": "https://bugs.launchpad.net/api/devel/~jason-oldos", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/bug_tasks", "duplicate_of_link": null, "date_created": "2024-07-02T21:41:52.307786+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/subscriptions", "date_last_updated": "2024-11-25T15:07:18.941535+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 278, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/cves", "vulnerabilities_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/vulnerabilities", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/attachments", "security_related": true, "latest_patch_uploaded": "2024-08-26T20:38:59.765174+00:00", "tags": ["bug", "in-unmaintained-victoria", "in-unmaintained-wallaby", "in-unmaintained-xena", "in-unmaintained-yoga", "in-unmaintained-zed"], "date_last_message": "2024-11-25T15:07:18.060798+00:00", "number_of_duplicates": 0, "message_count": 159, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/messages", "lock_status": "Unlocked", "lock_reason": null, "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/2071740/linked_merge_proposals", "http_etag": "\"8f63338390d05606fd003ade20b1f4b92a94074b-dbff21acd90fdad10d75266b0bed0e98e3cd975e\""}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/2071740", "self_link": "https://bugs.launchpad.net/api/devel/bugs/2071740"}, "total_comments_and_activity": 254, "initial_comment_batch_offset": 41, "first visible_recent_comment": 118, "bugtask_data": {"3217153": {"id": 3217153, "row_id": "tasksummary3217153", "form_row_id": "task3217153", "bugtask_path": "/ironic/+bug/2071740", "prefix": "ironic", "targetname": "Ironic", "bug_title": "[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)", "assignee_value": "juliaashleykreger", "assignee_is_team": false, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/ironic/+bug/2071740/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "Critical", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}, "3243528": {"id": 3243528, "row_id": "tasksummary3243528", "form_row_id": "task3243528", "bugtask_path": "/ossa/+bug/2071740", "prefix": "ossa", "targetname": "OpenStack Security Advisory", "bug_title": "[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)", "assignee_value": "brian-rosmaita", "assignee_is_team": false, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/ossa/+bug/2071740/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "Critical", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}, "3227471": {"id": 3227471, "row_id": "tasksummary3227471", "form_row_id": "task3227471", "bugtask_path": "/ironic-lib/+bug/2071740", "prefix": "ironic-lib", "targetname": "ironic-lib", "bug_title": "[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)", "assignee_value": "jason-oldos", "assignee_is_team": false, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/ironic-lib/+bug/2071740/+delete", "target_is_product": true, "status_widget_items": [{"name": "Triaged", "value": "Triaged", "description": "Verified by the bug supervisor.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusTRIAGED"}], "status_value": "Triaged", "importance_widget_items": "[]", "importance_value": "Critical", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}, "3227472": {"id": 3227472, "row_id": "tasksummary3227472", "form_row_id": "task3227472", "bugtask_path": "/ironic-python-agent/+bug/2071740", "prefix": "ironic-python-agent", "targetname": "ironic-python-agent", "bug_title": "[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)", "assignee_value": "jason-oldos", "assignee_is_team": false, "assignee_vocabulary": "AllUserTeamsParticipation", "assignee_vocabulary_filters": [], "hide_assignee_team_selection": true, "user_can_unassign": false, "user_can_delete": false, "delete_link": "https://bugs.launchpad.net/ironic-python-agent/+bug/2071740/+delete", "target_is_product": true, "status_widget_items": [{"name": "Fix Released", "value": "Fix Released", "description": "The fix was released.\n", "description_css_class": "choice-description", "style": "", "help": "", "disabled": false, "css_class": "statusFIXRELEASED"}], "status_value": "Fix Released", "importance_widget_items": "[]", "importance_value": "Critical", "milestone_widget_items": "[]", "milestone_value": null, "user_can_edit_assignee": false, "user_can_edit_milestone": false, "user_can_edit_status": false, "user_can_edit_importance": false}}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "description": "Everyone can see this information.\n", "name": "Public", "order": 0, "is_private": false, "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "description": "Everyone can see this security related information.\n", "name": "Public Security", "order": 1, "is_private": false, "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "description": "Only the security group can see this information.\n ", "name": "Private Security", "order": 2, "is_private": true, "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "description": "Only shared with users permitted to see private user information.\n", "name": "Private", "order": 3, "is_private": true, "description_css_class": "choice-description"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/ironic/+bug/2071740", "web_link": "https://bugs.launchpad.net/ironic/+bug/2071740", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/2071740", "milestone_link": null, "status": "Fix Released", "status_explanation": null, "importance": "Critical", "importance_explanation": null, "assignee_link": "https://bugs.launchpad.net/api/devel/~juliaashleykreger", "bug_target_display_name": "Ironic", "bug_target_name": "ironic", "bug_watch_link": null, "date_assigned": "2024-08-14T13:50:00.150806+00:00", "date_created": "2024-07-02T21:41:52.307786+00:00", "date_confirmed": "2024-07-02T21:41:52.307786+00:00", "date_incomplete": null, "date_in_progress": "2024-08-14T13:49:57.383262+00:00", "date_closed": "2024-09-05T02:43:37.210186+00:00", "date_left_new": "2024-07-02T21:41:52.307786+00:00", "date_triaged": "2024-07-02T21:41:52.307786+00:00", "date_fix_committed": "2024-09-05T02:43:37.210186+00:00", "date_fix_released": "2024-09-05T02:43:37.210186+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~jason-oldos", "target_link": "https://bugs.launchpad.net/api/devel/ironic", "title": "Bug #2071740 in Ironic: \"[OSSA-2024-003] Unvalidated image data passed to qemu-img (CVE-2024-44082)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/ironic/+bug/2071740/related_tasks", "is_complete": true, "http_etag": "\"d16ddace760cfdc3b94dd135693119f24f06b657-db59ae94c664432c923669beb888f59fea6c1c24\""}};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 49 queries/external actions issued in 1.05 seconds

    Features: {'profiling.enabled': None, 'hard_timeout': '9000', 'app.mainsite_only.canonical_url': None, 'js.yui_version': None, 'app.maintenance_message': None, 'bugs.affected_count_includes_dupes.disabled': None, 'baselayout.careers_link.disabled': None, 'visible_render_time': None}

    r6394e03

    -->

</html>

