<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>oss-security - [OSSA-2024-003] OpenStack Ironic: Unvalidated image data passed to
 qemu-img (CVE-2024-44082)</title>

<link href="/style.css" type="text/css" rel="stylesheet">
<style type="text/css">
.calendar { text-align: center; }
.ccell { background: #ccc; width: 5ex; padding: 2px; }

.cal_brief { text-align: center; }
.cal_brief td:first-child { background: inherit; }
.cal_brief td { background: #ccc; width: 5ex; padding: 2px; }
.cal_big { text-align: center; padding: 0; margin: 0; }
.cal_big td { padding: 0 2px; }
.cal_mon { text-align: center; }
.cal_mon th { font-size: small; padding: 0; margin: 0; }
.cal_mon td { background: #ccc; width: 5ex; height: 1.5em;
	padding: 2px; text-align: right; }
.cal_mon td[colspan] { background: inherit; }
.cal_mon sup { color: #F0F0F0; text-align: left; float: left;
	margin-top: -2pt; font-weight: bold; }
.cal_mon a { text-align: right; margin-left: -4em; float: right; }
</style>
</head>

<BODY bgcolor="#E0E0E0" text="black" link="blue" alink="red" vlink="navy">


<table bgcolor="#ffffff" width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>

<td>
<a href="/"><img class="logo" src="/logo.png" border="0" width="182" height="80" alt="Openwall"></a>
<td width="100%">
<div class="nav">
<ul>
<li><a href="/">Products</a>
<ul>
<li><a href="/Owl/">Openwall GNU/*/Linux &nbsp; <i>server OS</i></a>
<li><a href="/lkrg/">Linux Kernel Runtime Guard</a>
<li><a href="/john/">John the Ripper &nbsp; <i>password cracker</i></a>
<ul>
<li><a href="/john/">Free &amp; Open Source for any platform</a>
<li><a href="/john/cloud/">in the cloud</a>
<li><a href="/john/pro/linux/">Pro for Linux</a>
<li><a href="/john/pro/macosx/">Pro for macOS</a>
</ul>
<li><a href="/wordlists/">Wordlists &nbsp; <i>for password cracking</i></a>
<li><a href="/passwdqc/">passwdqc &nbsp; <i>policy enforcement</i></a>
<ul>
<li><a href="/passwdqc/">Free &amp; Open Source for Unix</a>
<li><a href="/passwdqc/windows/">Pro for Windows (Active Directory)</a>
</ul>
<li><a href="/yescrypt/">yescrypt &nbsp; <i>KDF &amp; password hashing</i></a>
<li><a href="/yespower/">yespower &nbsp; <i>Proof-of-Work (PoW)</i></a>
<li><a href="/crypt/">crypt_blowfish &nbsp; <i>password hashing</i></a>
<li><a href="/phpass/">phpass &nbsp; <i>ditto in PHP</i></a>
<li><a href="/tcb/">tcb &nbsp; <i>better password shadowing</i></a>
<li><a href="/pam/">Pluggable Authentication Modules</a>
<li><a href="/scanlogd/">scanlogd &nbsp; <i>port scan detector</i></a>
<li><a href="/popa3d/">popa3d &nbsp; <i>tiny POP3 daemon</i></a>
<li><a href="/blists/">blists &nbsp; <i>web interface to mailing lists</i></a>
<li><a href="/msulogin/">msulogin &nbsp; <i>single user mode login</i></a>
<li><a href="/php_mt_seed/">php_mt_seed &nbsp; <i>mt_rand() cracker</i></a>
</ul>
<li><a href="/services/">Services</a>
<li id="narrow-li-1"><a>Publications</a>
<ul>
<li><a href="/articles/">Articles</a>
<li><a href="/presentations/">Presentations</a>
</ul>
<li><a>Resources</a>
<ul>
<li><a href="/lists/">Mailing lists</a>
<li><a href="https://openwall.info/wiki/">Community wiki</a>
<li><a href="https://github.com/openwall">Source code repositories (GitHub)</a>
<li><a href="https://cvsweb.openwall.com">Source code repositories (CVSweb)</a>
<li><a href="/mirrors/">File archive &amp; mirrors</a>
<li><a href="/signatures/">How to verify digital signatures</a>
<li><a href="/ove/">OVE IDs</a>
</ul>
<li id="last-li"><a href="/news">What's new</a>
</ul>
</div>


</table>


<TABLE bgcolor="#B4D0DC" width="100%" border="0" cellspacing="0" cellpadding="1">
<TR><TD>
<TABLE width="100%" border="0" cellspacing="0" cellpadding="2">
<TR><TD bgcolor="#ECF8FF">
<a href="https://twitter.com/openwall">
Follow @Openwall on Twitter for new release announcements and other news</a>

</TABLE>
</TABLE>

<a href="3">[&lt;prev]</a> <a href="../../../2024/09/05/1">[next&gt;]</a> <a href=".">[day]</a> <a href="..">[month]</a> <a href="../..">[year]</a> <a href="../../..">[list]</a>
<pre style="white-space: pre-wrap">
Message-ID: &lt;002f0d92-d247-bbec-cb7b-4709a5f5b195&#64;gmail.com&gt;
Date: Wed, 4 Sep 2024 11:52:07 -0400
From: Brian Rosmaita &lt;rosmaita.fossdev&#64;...il.com&gt;
To: oss-security&#64;...ts.openwall.com
Subject: [OSSA-2024-003] OpenStack Ironic: Unvalidated image data passed to
 qemu-img (CVE-2024-44082)

========================================================
OSSA-2024-003: Unvalidated image data passed to qemu-img
========================================================

:Date: September 04, 2024
:CVE: CVE-2024-44082


Affects
~~~~~~~
- Ironic: &lt;21.4.3, &gt;=22.0.0 &lt;23.0.2, &gt;=23.1.0 &lt;24.1.2, &gt;=25.0.0 &lt;26.0.1
- Ironic-python-agent: &lt;9.4.2, &gt;=9.5.0 &lt;9.7.1, &gt;=9.8.0 &lt;9.11.1, &gt;=9.12.0
&lt;9.13.1


Description
~~~~~~~~~~~
Dan Smith and Julia Kreger of Red Hat and Jay Faulkner of G-Research
noticed a vulnerability in image processing for Ironic, in which a
specially crafted image could be used by an authenticated user to
exploit undesired behaviors in qemu-img, including possible unauthorized
access to potentially sensitive data.

Mitigation
----------
The attached patches contain code allowing Ironic and the
Ironic-Python-Agent (IPA) to pre-screen images before passing them to
qemu-img.  You should patch both of them because in some popular
deployment configurations, it is possible for images to bypass the
Ironic conductor for more efficient image downloads.

In situations where it is not possible to patch IPA, there is a new
configuration option, ``[conductor]conductor_always_validates_images``.
When this option is True, all image downloads are forced to occur
through the Ironic conductor, where they are validated.  However, this
may incur a significant performance hit; hence our recommendation to
patch both Ironic and IPA.

Patches are available for both Ironic and IPA for all maintained
branches, namely, the Dalmatian development branch (current master)
through Antelope. For these branches,
``conductor_always_validates_images`` defaults to False.

For the unmaintained branches (Zed through Victoria), patches are not
available for IPA due to a significant risk of regressions.  For these
branches, the Ironic patches set ``conductor_always_validates_images``
to True, as this is the only safe way to run Ironic with an un-patched
IPA.

Cached images
-------------
Images in the Ironic image cache should be purged.  To purge the cache,
stop the Ironic conductor and remove the files in the
``[pxe]/instance_master_path`` directory on that conductor node.

Supported image formats
-----------------------
A new configuration option, ``[conductor]permitted_image_formats``
controls what image formats will be accepted by Ironic.  By default, the
allowed formats are 'raw' and 'qcow2', which are the only formats that
Ironic is tested with.  In previous releases, it was possible to use
images of other, unsupported formats with Ironic, but this is now
blocked by default due to security issues arising from the image
conversion process.  It is possible, though not recommended, to expand
the list of permitted formats.  Alternatively, users requiring the use
of an image in an unsupported format can convert the image offline into
a supported format before uploading the image to Glance or otherwise
making the image available to Ironic.  Consult the Ironic documentation
for details.

Warning
-------
As is well-documented, the OpenStack Ironic project does not support the
use of ironic-lib for non-Ironic use cases.  In its normal supported
context, ironic-lib assumes that images have been pre-screened before
ironic-lib comes in contact with them.  Thus, unsupported use of
ironic-lib leaves you vulnerable to the exploit outlined in this OSSA.

The Ironic project intends eventually to explicitly remove the
vulnerable methods in ironic-lib, but reminds the reader that
independent use of ironic-lib is not supported.

Bugfix branches
---------------
Patches are available for maintained bugfix branches.  These patches
will be merged to the maintained branches, but no new releases will be
triggered from those branches.




Patches
~~~~~~~
- <a href="https://review.opendev.org/927972" rel="nofollow">https://review.opendev.org/927972</a> (2023.1/antelope(ironic))
- <a href="https://review.opendev.org/927979" rel="nofollow">https://review.opendev.org/927979</a> (2023.1/antelope(ironic-python-agent))
- <a href="https://review.opendev.org/927970" rel="nofollow">https://review.opendev.org/927970</a> (2023.2/bobcat(ironic))
- <a href="https://review.opendev.org/927978" rel="nofollow">https://review.opendev.org/927978</a> (2023.2/bobcat(ironic-python-agent))
- <a href="https://review.opendev.org/927968" rel="nofollow">https://review.opendev.org/927968</a> (2024.1/caracal(ironic))
- <a href="https://review.opendev.org/927976" rel="nofollow">https://review.opendev.org/927976</a> (2024.1/caracal(ironic-python-agent))
- <a href="https://review.opendev.org/927965" rel="nofollow">https://review.opendev.org/927965</a> (2024.2/dalmatian(ironic))
- <a href="https://review.opendev.org/927974" rel="nofollow">https://review.opendev.org/927974</a> (2024.2/dalmatian(ironic-python-agent))
- <a href="https://review.opendev.org/927969" rel="nofollow">https://review.opendev.org/927969</a> (Bugfix/24.0 (ironic))
- <a href="https://review.opendev.org/927967" rel="nofollow">https://review.opendev.org/927967</a> (Bugfix/25.0 (ironic))
- <a href="https://review.opendev.org/927966" rel="nofollow">https://review.opendev.org/927966</a> (Bugfix/26.0 (ironic))
- <a href="https://review.opendev.org/927983" rel="nofollow">https://review.opendev.org/927983</a> (Bugfix/9.12 (ironic-python-agent))
- <a href="https://review.opendev.org/927981" rel="nofollow">https://review.opendev.org/927981</a> (Bugfix/9.13 (ironic-python-agent))
- <a href="https://review.opendev.org/927984" rel="nofollow">https://review.opendev.org/927984</a> (Bugfix/9.9 (ironic-python-agent))
- <a href="https://review.opendev.org/927982" rel="nofollow">https://review.opendev.org/927982</a> (Unmaintained/victoria(ironic))
- <a href="https://review.opendev.org/927980" rel="nofollow">https://review.opendev.org/927980</a> (Unmaintained/wallaby(ironic))
- <a href="https://review.opendev.org/927977" rel="nofollow">https://review.opendev.org/927977</a> (Unmaintained/xena(ironic))
- <a href="https://review.opendev.org/927975" rel="nofollow">https://review.opendev.org/927975</a> (Unmaintained/yoga(ironic))
- <a href="https://review.opendev.org/927973" rel="nofollow">https://review.opendev.org/927973</a> (Unmaintained/zed(ironic))


Credits
~~~~~~~
- Dan Smith from Red Hat (CVE-2024-44082)
- Jay Faulkner from G-Research (CVE-2024-44082)
- Julia Kreger from Red Hat (CVE-2024-44082)


References
~~~~~~~~~~
- <a href="https://launchpad.net/bugs/2071740" rel="nofollow">https://launchpad.net/bugs/2071740</a>
- <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44082" rel="nofollow">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-44082</a>


Notes
~~~~~
- For more information about the unadvisability of calling 'qemu-img
   info' on untrusted images, see CVE-2024-04467.
- The ironic unmaintained/* branches will receive no point releases, but
   patches for them are provided as a courtesy.
- The ironic-python-agent unmaintained/* branches will receive no point
   releases, nor are patches for them available.
- The ironic and ironic-python-agent bugfix/* branches will receive no
   point releases, but patches for them are provided as a courtesy.

--
Brian Rosmaita
OpenStack Vulnerability Management Team
<a href="https://security.openstack.org/vmt.html" rel="nofollow">https://security.openstack.org/vmt.html</a>


<span style="font-family: times;"><strong>Download attachment "</strong><a href="4/1" rel="nofollow" download>OpenPGP_0xE834C62762D8856C.asc</a><strong>" of type "</strong>application/pgp-keys<strong>" (678 bytes)</strong></span>

<span style="font-family: times;"><strong>Download attachment "</strong><a href="4/2" rel="nofollow" download>OpenPGP_signature</a><strong>" of type "</strong>application/pgp-signature<strong>" (237 bytes)</strong></span>
</pre>
<p><a href="https://www.openwall.com/blists/">Powered by blists</a> - <a href="https://lists.openwall.net">more mailing lists</a>


<p>
Please check out the
<a href="https://oss-security.openwall.org/wiki/">
Open Source Software Security Wiki</a>, which is counterpart to this
<a href="https://oss-security.openwall.org/wiki/mailing-lists/oss-security">mailing list</a>.
<p>
Confused about <a href="/lists/">mailing lists</a> and their use?
<a href="https://en.wikipedia.org/wiki/Electronic_mailing_list">Read about mailing lists on Wikipedia</a>
and check out these
<a href="https://www.complang.tuwien.ac.at/anton/mail-news-errors.html">guidelines on proper formatting of your messages</a>.
<p>

</body>
</html>
