

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1842766)
* [XML](/show_bug.cgi?ctype=xml&id=1842766)

Closed
[Bug 1842766](/show_bug.cgi?id=1842766)
(CVE-2023-4579)

Opened 2 years ago
Closed 1 years ago

# Persisted search terms get formatted as URL

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Persisted search terms get formatted as URL

## Categories

### (Firefox :: Address Bar, defect, P1)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Address%20Bar#Address%20Bar)

Address Bar
▾

Firefox :: Address Bar
For bugs in the Firefox "Smart Location Bar" (aka Awesome Bar) UI element, including the bookmark and history autocomplete matching behavior.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Address%20Bar&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Address%20Bar&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Address%20Bar)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

117 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox-esr115 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=-) | [disabled](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=disabled) |
| firefox115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix) |
| firefox116 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix) |
| firefox117 | [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified) |
| firefox118 | --- | [verified](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | - | disabled |
| firefox-esr128 | --- | --- |
| firefox115 |  | wontfix |
| firefox116 |  | wontfix |
| firefox117 | + | verified |
| firefox118 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: maltejur, Assigned: jteow)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/340026afff750352b49585c1642a5aa7?d=mm&size=40)  [jteow](/user_profile?user_id=701257)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/17d248f03648361388befa938d19eec7?d=mm&size=40)  [maltejur](/user_profile?user_id=698695)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/a65a0876b78fe449d63939aa44c86afc?d=mm&size=40)  [daisuke](/user_profile?user_id=439222)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[urlbar-persisted](/show_bug.cgi?id=1797754 "NEW - [meta] Persist search terms in the Urlbar")

Dependency [tree](/showdependencytree.cgi?id=1842766&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1842766)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[mozilla-hub.atlassian.net/browse/SNG-...](https://mozilla-hub.atlassian.net/browse/SNG-1227 "https://mozilla-hub.atlassian.net/browse/SNG-1227")

## Details

### (Keywords: sec-moderate, Whiteboard: [sng-security] [adv-main117+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-4579

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sng-security] [adv-main117+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Screenshot\_20230711\_111307.png](/attachment.cgi?id=9343232)  [2 years ago](#c0)  [Malte Jürgens [:maltejur]](/user_profile?user_id=698695)   311.03 KB, image/png |  | [Details](/attachment.cgi?id=9343232&action=edit) |
| --- | --- | --- |
| [Bug 1842766 - r?adw](/attachment.cgi?id=9344201)  [1 years ago](#c5)  [James Teow [:jteow]](/user_profile?user_id=701257)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9344201&action=edit) | [Review](/attachment.cgi?id=9344201) |
| [advisory.txt](/attachment.cgi?id=9350227)  [1 year ago](#c12)  [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341)   308 bytes, text/plain |  | [Details](/attachment.cgi?id=9350227&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Malte Jürgens [:maltejur]](/user_profile?user_id=698695)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1842766#c0)• 2 years ago |
|  | |

Attached image
[Screenshot\_20230711\_111307.png](attachment.cgi?id=9343232)
— [Details](attachment.cgi?id=9343232&action=edit)

To reproduce:

1. Set DuckDuckGo as the default search engine
2. Search anything on DuckDuckGo
3. On the same page, enter `https://addons.mozilla.org/en-US/firefox/` in the search box **on the site** and press enter

Expected Result: It is clear to the user that the content of the address bar is a search term, not the current URL.

Actual Result: The search term is being formatted as if it were a URL (see screenshot).

I don't think that this is that big of a big problem security-wise, because the search engine has to be the default and the page has to be loaded by the user entering a search term directly in Firefox. But if a malicious search engine could gain access to being set as the default, it could possibly abuse this, since it seems to me that the site itself can set the search query on its own once the page is loaded by a user search query.

A possible solution could be to remove the formatting from the address bar if it contains a search term, or, going one step further, also displaying an icon, like a magnifying glass, before the text, indicating that it is a search term.

Flags: needinfo?(jteow)

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1842766#c1)• 2 years ago |
|  | |

Thank you for reporting, this doesn't look good indeed and should be fixed ASAP.

Severity: -- → S3Priority: -- → P1

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1842766#c2)• 2 years ago |
|  | |

Agreed that this should be fixed soon.

Rating as `sec-moderate` as per <https://wiki.mozilla.org/Security_Severity_Ratings/Client>. We usually treat URL spoofs as sec-high, but this involves atypical user interaction.

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [James Teow [:jteow]](/user_profile?user_id=701257)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1842766#c3)• 2 years ago |
|  | |

> A possible solution could be to remove the formatting from the address bar if it contains a search term, or, going one step further, also displaying an icon, like a magnifying glass, before the text, indicating that it is a search term.

IMO, regardless of the formatting, I don't think a URL that differs from the search page should show in the urlbar unless it is in an invalid pageproxystate (aka, only the magnifying glass is visible). Because even without the formatting, I could see it being confusing to users, what with the collection of security icons.

This issue can also be reproduced with other SERPs using search mode with the default engine. And having a term that looks like a origin without a protocol can trigger it too, such as searching [www.nytimes.com](http://www.nytimes.com)

As for just showing a magnifying glass next to it, previously, we showed the urlbar in an invalid pageproxystate when search terms were visible, but because we had complaints about hiding the other icons, we had to find a middle ground of showing the other security icons along with the search term. Thus we landed on valid pageproxystate when the urlbar is non-focused, and invalid when it is focused.

One solution I would prefer would be to not show the search term in the urlbar if it looks like it could be interpreted as a URL, specifically if it is a single word that contains one or more periods and/or starts with either http:// or https://. Such a solution would cause situations where words like `www.` wouldn't show up as a search term unless it was followed by another word separated by a space, but I feel like that's a worthwhile tradeoff. I'll talk with product to get their opinion on this.

Flags: needinfo?(jteow)

|  | [Marco Bonardo [:mak]](/user_profile?user_id=240353) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1842766#c4)• 2 years ago |
|  | |

I like the idea of not showing search terms if they are interpreted as a url, though note that because of stripping "mozilla.org/test" will be formatted as a URL as well. So you should use the same code as formatting to discern what to do.

In this case just disabling formatting may not be sufficient since the whole url will then be shown as normal white/black test; not all the users can distinguish the difference between formatted and not formatted urls. Long term we should evaluate better ways to distinguish url mode from edited mode.

|  | [James Teow [:jteow]](/user_profile?user_id=701257)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1842766#c5)• 1 years ago |
|  | |

Attached file
[Bug 1842766 - r?adw](attachment.cgi?id=9344201)
— [Details](attachment.cgi?id=9344201&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a534891_600971)• 1 years ago |

Assignee: nobody → jteowStatus: NEW → ASSIGNED

|  | [James Teow [:jteow]](/user_profile?user_id=701257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a1143660_701257)• 1 years ago |

Whiteboard: [sng-security]

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1842766#c6)• 1 years ago |
|  | |

Pushed by jteow@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/d527a0783112>
r=adw

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1842766#c7)• 1 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/d527a0783112>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 1 years ago
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 117 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a1339480_75935)• 1 years ago |

[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix)
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B)

|  | [Adrian Florinescu [:aflorinescu]](/user_profile?user_id=556562) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a1823887_556562)• 1 years ago |

Flags: qe-verify+

|  | [Cristian Baica [:cbaica], Release Desktop QA](/user_profile?user_id=614785) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1842766#c8)• 1 years ago |
|  | |

I've managed to reproduce the issue using Fx117.0a1 2023-07-11.

The issue is verified fixed using Fx118.0a1 and Fx117.0b1 on Windows 10. The full URL is displayed when using websearch with a URL input.

Status: RESOLVED → VERIFIED
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified)
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1842766#c9)• 1 year ago |
|  | |

Please nominate this for ESR115 approval when you get a chance.

Flags: needinfo?(jteow)

|  | [James Teow [:jteow]](/user_profile?user_id=701257)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1842766#c10)• 1 year ago |
|  | |

Hey Ryan, I'm not familiar about when to nominate for ESR, especially since this is my first SEC patch.

The feature is only enabled in Nightly, and a subset of people on Release (users enrolled in an experiment). I'm just wondering for features that are not on by default do we still try to land patches for ESR before they are officially enabled in the future on release? Is it possible some people were enrolled in one of the experiments starting in 113 and were transitioned to ESR 115?

Flags: needinfo?(jteow) → needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1842766#c11)• 1 year ago |
|  | |

If the feature isn't enabled by default on ESR and we aren't running experiments there, we don't need to uplift. Thanks for checking!

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [disabled](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=disabled)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=-)Flags: needinfo?(ryanvm)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1842766#c12)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9350227)
— [Details](attachment.cgi?id=9350227&action=edit)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a3876622_626341)• 1 year ago |

Whiteboard: [sng-security] → [sng-security] [adv-main117+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a15285962_1689)• 1 year ago |

Group: core-security-release

|  | [Jira Integration Bot](/user_profile?user_id=672219) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a15285978_672219)• 1 year ago |

See Also: → <https://mozilla-hub.atlassian.net/browse/SNG-1227>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1842766#a15291771_1689)• 1 year ago |

Alias: CVE-2023-4579
You need to [log in](/show_bug.cgi?id=1842766&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Malte Jürgens [:maltejur]](/user_profile?user_id=698695)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

