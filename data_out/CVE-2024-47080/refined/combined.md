=== Content from github.com_8ed2e382_20250111_115243.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2F2fb1e659c81f75253c047832dc9dcc2beddfac5f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2F2fb1e659c81f75253c047832dc9dcc2beddfac5f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=matrix-org%2Fmatrix-js-sdk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-js-sdk](/matrix-org/matrix-js-sdk)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk) You must be signed in to change notification settings
* [Fork
  605](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)
* [Star
   1.7k](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)

* [Code](/matrix-org/matrix-js-sdk)
* [Issues
  228](/matrix-org/matrix-js-sdk/issues)
* [Pull requests
  28](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects
  0](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-js-sdk)
* [Issues](/matrix-org/matrix-js-sdk/issues)
* [Pull requests](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

## Commit

[Permalink](/matrix-org/matrix-js-sdk/commit/2fb1e659c81f75253c047832dc9dcc2beddfac5f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/matrix-org/matrix-js-sdk/tree/2fb1e659c81f75253c047832dc9dcc2beddfac5f)
Browse the repository at this point in the history

```
Remove insecure MatrixClient.sendSharedHistoryKeys method
```

* Loading branch information

[![@dbkr](https://avatars.githubusercontent.com/u/986903?s=40&v=4)](/dbkr)

[dbkr](/matrix-org/matrix-js-sdk/commits?author=dbkr "View all commits by dbkr")
authored
Oct 15, 2024

2 parents
[868bbfc](/matrix-org/matrix-js-sdk/commit/868bbfcb31f1681a76c74412984fd65982aedb40)
+
[1dcb7a6](/matrix-org/matrix-js-sdk/commit/1dcb7a6e7552471236b72dc0c420213b8b9db97f)

commit 2fb1e65

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**7 additions**
and
**110 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* spec/unit/models

  + spec/unit/models/MSC3089TreeSpace.spec.ts
    [MSC3089TreeSpace.spec.ts](#diff-38a15212ab6d38ece1b9b7e10fbb75f85e0081c52b8851bccc1f731719b4aa59)
* src

  + src/client.ts
    [client.ts](#diff-25d66d74617fe2e23d7946bd6e3ba95640ab1b9bc8947445d604fc271c7c1f12)
  + models

    - src/models/MSC3089TreeSpace.ts
      [MSC3089TreeSpace.ts](#diff-7e45c27c5b16c8b50211ed27821f474f47ea39b0268f5d673769a1449a5a0cf9)

## There are no files selected for viewing

59 changes: 4 additions & 55 deletions

59
[spec/unit/models/MSC3089TreeSpace.spec.ts](#diff-38a15212ab6d38ece1b9b7e10fbb75f85e0081c52b8851bccc1f731719b4aa59 "spec/unit/models/MSC3089TreeSpace.spec.ts")

Show comments

[View file](/matrix-org/matrix-js-sdk/blob/2fb1e659c81f75253c047832dc9dcc2beddfac5f/spec/unit/models/MSC3089TreeSpace.spec.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -107,7 +107,7 @@ describe("MSC3089TreeSpace", () => { |
|  |  | return Promise.resolve(); |
|  |  | }); |
|  |  | client.invite = fn; |
|  |  | await tree.invite(target, false, false); |
|  |  | await tree.invite(target, false); |
|  |  | expect(fn).toHaveBeenCalledTimes(1); |
|  |  | }); |
|  |  |  |
| Expand All | | @@ -120,7 +120,7 @@ describe("MSC3089TreeSpace", () => { |
|  |  | return Promise.resolve(); |
|  |  | }); |
|  |  | client.invite = fn; |
|  |  | await tree.invite(target, false, false); |
|  |  | await tree.invite(target, false); |
|  |  | expect(fn).toHaveBeenCalledTimes(2); |
|  |  | }); |
|  |  |  |
| Expand All | | @@ -133,7 +133,7 @@ describe("MSC3089TreeSpace", () => { |
|  |  | }); |
|  |  | client.invite = fn; |
|  |  |  |
|  |  | await expect(tree.invite(target, false, false)).rejects.toThrow("MatrixError: Sample Failure"); |
|  |  | await expect(tree.invite(target, false)).rejects.toThrow("MatrixError: Sample Failure"); |
|  |  |  |
|  |  | expect(fn).toHaveBeenCalledTimes(1); |
|  |  | }); |
| Expand All | | @@ -155,61 +155,10 @@ describe("MSC3089TreeSpace", () => { |
|  |  | { invite: (userId) => fn(tree.roomId, userId) } as MSC3089TreeSpace, |
|  |  | ]; |
|  |  |  |
|  |  | await tree.invite(target, true, false); |
|  |  | await tree.invite(target, true); |
|  |  | expect(fn).toHaveBeenCalledTimes(4); |
|  |  | }); |
|  |  |  |
|  |  | it("should share keys with invitees", async () => { |
|  |  | const target = targetUser; |
|  |  | const sendKeysFn = jest.fn().mockImplementation((inviteRoomId: string, userIds: string[]) => { |
|  |  | expect(inviteRoomId).toEqual(roomId); |
|  |  | expect(userIds).toMatchObject([target]); |
|  |  | return Promise.resolve(); |
|  |  | }); |
|  |  | client.invite = () => Promise.resolve({}); // we're not testing this here - see other tests |
|  |  | client.sendSharedHistoryKeys = sendKeysFn; |
|  |  |  |
|  |  | // Mock the history check as best as possible |
|  |  | const historyVis = "shared"; |
|  |  | const historyFn = jest.fn().mockImplementation((eventType: string, stateKey?: string) => { |
|  |  | // We're not expecting a super rigid test: the function that calls this internally isn't |
|  |  | // really being tested here. |
|  |  | expect(eventType).toEqual(EventType.RoomHistoryVisibility); |
|  |  | expect(stateKey).toEqual(""); |
|  |  | return { getContent: () => ({ history\_visibility: historyVis }) }; // eslint-disable-line camelcase |
|  |  | }); |
|  |  | room.currentState.getStateEvents = historyFn; |
|  |  |  |
|  |  | // Note: inverse test is implicit from other tests, which disable the call stack of this |
|  |  | // test in order to pass. |
|  |  | await tree.invite(target, false, true); |
|  |  | expect(sendKeysFn).toHaveBeenCalledTimes(1); |
|  |  | expect(historyFn).toHaveBeenCalledTimes(1); |
|  |  | }); |
|  |  |  |
|  |  | it("should not share keys with invitees if inappropriate history visibility", async () => { |
|  |  | const target = targetUser; |
|  |  | const sendKeysFn = jest.fn().mockImplementation((inviteRoomId: string, userIds: string[]) => { |
|  |  | expect(inviteRoomId).toEqual(roomId); |
|  |  | expect(userIds).toMatchObject([target]); |
|  |  | return Promise.resolve(); |
|  |  | }); |
|  |  | client.invite = () => Promise.resolve({}); // we're not testing this here - see other tests |
|  |  | client.sendSharedHistoryKeys = sendKeysFn; |
|  |  |  |
|  |  | const historyVis = "joined"; // NOTE: Changed. |
|  |  | const historyFn = jest.fn().mockImplementation((eventType: string, stateKey?: string) => { |
|  |  | expect(eventType).toEqual(EventType.RoomHistoryVisibility); |
|  |  | expect(stateKey).toEqual(""); |
|  |  | return { getContent: () => ({ history\_visibility: historyVis }) }; // eslint-disable-line camelcase |
|  |  | }); |
|  |  | room.currentState.getStateEvents = historyFn; |
|  |  |  |
|  |  | await tree.invite(target, false, true); |
|  |  | expect(sendKeysFn).toHaveBeenCalledTimes(0); |
|  |  | expect(historyFn).toHaveBeenCalledTimes(1); |
|  |  | }); |
|  |  |  |
|  |  | async function evaluatePowerLevels(pls: any, role: TreePermissions, expectedPl: number) { |
|  |  | makePowerLevels(pls); |
|  |  | const fn = jest |
| Expand Down | |  |

37 changes: 0 additions & 37 deletions

37
[src/client.ts](#diff-25d66d74617fe2e23d7946bd6e3ba95640ab1b9bc8947445d604fc271c7c1f12 "src/client.ts")

Show comments

[View file](/matrix-org/matrix-js-sdk/blob/2fb1e659c81f75253c047832dc9dcc2beddfac5f/src/client.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4087,43 +4087,6 @@ export class MatrixClient extends TypedEventEmitter<EmittedEvents, ClientEventHa |
|  |  | await this.http.authedRequest(Method.Delete, path.path, path.queryData, undefined, { prefix: ClientPrefix.V3 }); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Share shared-history decryption keys with the given users. |
|  |  | \* |
|  |  | \* @param roomId - the room for which keys should be shared. |
|  |  | \* @param userIds - a list of users to share with. The keys will be sent to |
|  |  | \* all of the user's current devices. |
|  |  | \* |
|  |  | \* @deprecated Do not use this method. It does not work with the Rust crypto stack, and even with the legacy |
|  |  | \* stack it introduces a security vulnerability. |
|  |  | \*/ |
|  |  | public async sendSharedHistoryKeys(roomId: string, userIds: string[]): Promise<void> { |
|  |  | if (!this.crypto) { |
|  |  | throw new Error("End-to-end encryption disabled"); |
|  |  | } |
|  |  |  |
|  |  | const roomEncryption = this.crypto?.getRoomEncryption(roomId); |
|  |  | if (!roomEncryption) { |
|  |  | // unknown room, or unencrypted room |
|  |  | this.logger.error("Unknown room. Not sharing decryption keys"); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | const deviceInfos = await this.crypto.downloadKeys(userIds); |
|  |  | const devicesByUser: Map<string, DeviceInfo[]> = new Map(); |
|  |  | for (const [userId, devices] of deviceInfos) { |
|  |  | devicesByUser.set(userId, Array.from(devices.values())); |
|  |  | } |
|  |  |  |
|  |  | // XXX: Private member access |
|  |  | const alg = this.crypto.getRoomDecryptor(roomId, roomEncryption.algorithm); |
|  |  | if (alg.sendSharedHistoryInboundSessions) { |
|  |  | await alg.sendSharedHistoryInboundSessions(devicesByUser); |
|  |  | } else { |
|  |  | this.logger.warn("Algorithm does not support sharing previous keys", roomEncryption.algorithm); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get the config for the media repository. |
|  |  | \* @returns Promise which resolves with an object containing the config. |
| Expand Down | |  |

21 changes: 3 additions & 18 deletions

21
[src/models/MSC3089TreeSpace.ts](#diff-7e45c27c5b16c8b50211ed27821f474f47ea39b0268f5d673769a1449a5a0cf9 "src/models/MSC3089TreeSpace.ts")

Show comments

[View file](/matrix-org/matrix-js-sdk/blob/2fb1e659c81f75253c047832dc9dcc2beddfac5f/src/models/MSC3089TreeSpace.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,7 +30,6 @@ import { |
|  |  | simpleRetryOperation, |
|  |  | } from "../utils.ts"; |
|  |  | import { MSC3089Branch } from "./MSC3089Branch.ts"; |
|  |  | import { isRoomSharedHistory } from "../crypto/algorithms/megolm.ts"; |
|  |  | import { ISendEventResponse } from "../@types/requests.ts"; |
|  |  | import { FileType } from "../http-api/index.ts"; |
|  |  | import { KnownMembership } from "../@types/membership.ts"; |
| Expand Down  Expand Up | | @@ -136,28 +135,14 @@ export class MSC3089TreeSpace { |
|  |  | \* @param userId - The user ID to invite. |
|  |  | \* @param andSubspaces - True (default) to invite the user to all |
|  |  | \* directories/subspaces too, recursively. |
|  |  | \* @param shareHistoryKeys - True (default) to share encryption keys |
|  |  | \* with the invited user. This will allow them to decrypt the events (files) |
|  |  | \* in the tree. Keys will not be shared if the room is lacking appropriate |
|  |  | \* history visibility (by default, history visibility is "shared" in trees, |
|  |  | \* which is an appropriate visibility for these purposes). |
|  |  | \* @returns Promise which resolves when complete. |
|  |  | \*/ |
|  |  | public async invite(userId: string, andSubspaces = true, shareHistoryKeys = true): Promise<void> { |
|  |  | public async invite(userId: string, andSubspaces = true): Promise<void> { |
|  |  | const promises: Promise<void>[] = [this.retryInvite(userId)]; |
|  |  | if (andSubspaces) { |
|  |  | promises.push(...this.getDirectories().map((d) => d.invite(userId, andSubspaces, shareHistoryKeys))); |
|  |  | promises.push(...this.getDirectories().map((d) => d.invite(userId, andSubspaces))); |
|  |  | } |
|  |  | return Promise.all(promises).then(() => { |
|  |  | // Note: key sharing is default on because for file trees it is relatively important that the invite |
|  |  | // target can actually decrypt the files. The implied use case is that by inviting a user to the tree |
|  |  | // it means the sender would like the receiver to view/download the files contained within, much like |
|  |  | // sharing a folder in other circles. |
|  |  | if (shareHistoryKeys && isRoomSharedHistory(this.room)) { |
|  |  | // noinspection JSIgnoredPromiseFromCall - we aren't concerned as much if this fails. |
|  |  | this.client.sendSharedHistoryKeys(this.roomId, [userId]); |
|  |  | } |
|  |  | }); |
|  |  | await Promise.all(promises); |
|  |  | } |
|  |  |  |
|  |  | private retryInvite(userId: string): Promise<void> { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2fb1e65`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fcommit%2F2fb1e659c81f75253c047832dc9dcc2beddfac5f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_20d0e2a2_20250111_115244.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fsecurity%2Fadvisories%2FGHSA-4jf8-g8wp-cx7c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-js-sdk%2Fsecurity%2Fadvisories%2FGHSA-4jf8-g8wp-cx7c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fmatrix-js-sdk)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-js-sdk](/matrix-org/matrix-js-sdk)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk) You must be signed in to change notification settings
* [Fork
  605](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)
* [Star
   1.7k](/login?return_to=%2Fmatrix-org%2Fmatrix-js-sdk)

* [Code](/matrix-org/matrix-js-sdk)
* [Issues
  228](/matrix-org/matrix-js-sdk/issues)
* [Pull requests
  28](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects
  0](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-js-sdk)
* [Issues](/matrix-org/matrix-js-sdk/issues)
* [Pull requests](/matrix-org/matrix-js-sdk/pulls)
* [Actions](/matrix-org/matrix-js-sdk/actions)
* [Projects](/matrix-org/matrix-js-sdk/projects)
* [Security](/matrix-org/matrix-js-sdk/security)
* [Insights](/matrix-org/matrix-js-sdk/pulse)

# Keys sent via `sendSharedHistoryKeys` vulnerable to interception by malicious homeserver

High

[dkasak](/dkasak)
published
GHSA-4jf8-g8wp-cx7c
Oct 15, 2024

## Package

npm

matrix-js-sdk
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>= 9.11.0, < 34.8.0

## Patched versions

34.8.0

## Description

### Impact

In matrix-js-sdk versions 9.11.0 through 34.7.0, the method `MatrixClient.sendSharedHistoryKeys` is vulnerable to interception by malicious homeservers. The method implements functionality proposed in [MSC3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061) and can be used by clients to share historical message keys with newly invited users, granting them access to past messages in the room.

However, it unconditionally sends these "shared" keys to all of the invited user's devices, regardless of whether the user's cryptographic identity is verified or whether the user's devices are signed by that identity. This allows the attacker to potentially inject its own devices to receive sensitive historical keys without proper security checks.

Note that this only affects clients running the SDK with the legacy crypto stack. Clients using the new Rust cryptography stack (i.e. those that call `MatrixClient.initRustCrypto()` instead of `MatrixClient.initCrypto()`) are unaffected by this vulnerability, because `MatrixClient.sendSharedHistoryKeys()` raises an exception in such environments.

### Patches

Fixed in matrix-js-sdk 34.8.0 by removing the vulnerable functionality.

### Workarounds

Remove use of affected functionality from clients.

### References

* [MSC3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)

### For more information

If you have any questions or comments about this advisory, please email us at security at matrix.org.

### Severity

High

### CVE ID

CVE-2024-47080

### Weaknesses

[CWE-200](/advisories?query=cwe%3A200) [CWE-287](/advisories?query=cwe%3A287)

### Credits

* [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak)
  [dkasak](/dkasak)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_12a1bef0_20250111_115246.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fmatrix-spec-proposals)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[matrix-org](/matrix-org)
/
**[matrix-spec-proposals](/matrix-org/matrix-spec-proposals)**
Public

* [Notifications](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals) You must be signed in to change notification settings
* [Fork
  385](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)
* [Star
   1k](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals)

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues
  15](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests
  500](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects
  1](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

Additional navigation options

* [Code](/matrix-org/matrix-spec-proposals)
* [Issues](/matrix-org/matrix-spec-proposals/issues)
* [Pull requests](/matrix-org/matrix-spec-proposals/pulls)
* [Actions](/matrix-org/matrix-spec-proposals/actions)
* [Projects](/matrix-org/matrix-spec-proposals/projects)
* [Security](/matrix-org/matrix-spec-proposals/security)
* [Insights](/matrix-org/matrix-spec-proposals/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmatrix-org%2Fmatrix-spec-proposals%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# MSC3061: Sharing room keys for past messages #3061

 Merged

[turt2live](/turt2live)
merged 5 commits into
[matrix-org:old\_master](/matrix-org/matrix-spec-proposals/tree/old_master "matrix-org/matrix-spec-proposals:old_master")
from
[uhoreg:shareable\_keys\_msc](/uhoreg/matrix-doc/tree/shareable_keys_msc "uhoreg/matrix-doc:shareable_keys_msc")

Aug 14, 2023

 Merged

# [MSC3061: Sharing room keys for past messages](#top) #3061

[turt2live](/turt2live)
merged 5 commits into
[matrix-org:old\_master](/matrix-org/matrix-spec-proposals/tree/old_master "matrix-org/matrix-spec-proposals:old_master")
from
[uhoreg:shareable\_keys\_msc](/uhoreg/matrix-doc/tree/shareable_keys_msc "uhoreg/matrix-doc:shareable_keys_msc")

Aug 14, 2023

[Conversation
37](/matrix-org/matrix-spec-proposals/pull/3061)
[Commits
5](/matrix-org/matrix-spec-proposals/pull/3061/commits)
[Checks
0](/matrix-org/matrix-spec-proposals/pull/3061/checks)
[Files changed](/matrix-org/matrix-spec-proposals/pull/3061/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![uhoreg](https://avatars.githubusercontent.com/u/1012976?s=60&v=4)](/uhoreg)

Copy link

Member

### @uhoreg **[uhoreg](/uhoreg)** commented [Mar 12, 2021](#issue-830646012) • edited by turt2live Loading

[Rendered](https://github.com/uhoreg/matrix-doc/blob/shareable_keys_msc/proposals/3061-shareable-room-keys.md)

Implementations:

* [JS SDK](https://github.com/matrix-org/matrix-js-sdk/pull/1640)
* [Polyjuice Client Test](https://gitlab.com/polyjuice/polyjuice_client_test/-/blob/develop/lib/polyjuice/client_test/test/historical_key_sharing.ex)
* [Element iOS](https://github.com/vector-im/element-ios/issues/4947)
* [Element Android](https://github.com/vector-im/element-android/issues/4153)

[FCP tickyboxes](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-1594770839)

Sorry, something went wrong.

 👍
12
 ShadowJonathan, SimonBrandner, ara4n, aWeinzierl, bb010g, MazeChaZer, BBaoVanC, cvwright, TheJJ, N1N74, and 2 more reacted with thumbs up emoji
 🎉
5
 SimonBrandner, aWeinzierl, BBaoVanC, N1N74, and gregblake reacted with hooray emoji
 ❤️
5
 SimonBrandner, aWeinzierl, BBaoVanC, N1N74, and gregblake reacted with heart emoji
 🚀
6
 SimonBrandner, aWeinzierl, 0-st, BBaoVanC, N1N74, and gregblake reacted with rocket emoji
 👀
3
 ShadowJonathan, aWeinzierl, and N1N74 reacted with eyes emoji

All reactions

* 👍
  12 reactions
* 🎉
  5 reactions
* ❤️
  5 reactions
* 🚀
  6 reactions
* 👀
  3 reactions

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)

`[initial version](/matrix-org/matrix-spec-proposals/pull/3061/commits/a24dbf0f156ad98bd9030855fb2595097fcb3e21 "initial version")`

`[a24dbf0](/matrix-org/matrix-spec-proposals/pull/3061/commits/a24dbf0f156ad98bd9030855fb2595097fcb3e21)`

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
changed the title
~~MSCxxxx: Sharing room keys for past messages~~
MSC3061: Sharing room keys for past messages
[Mar 12, 2021](#event-4453032751)

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)

`[use MSC number](/matrix-org/matrix-spec-proposals/pull/3061/commits/38f35c23e8cb013a59bbc9216eba7354de72ed2d "use MSC number")`

`[38f35c2](/matrix-org/matrix-spec-proposals/pull/3061/commits/38f35c23e8cb013a59bbc9216eba7354de72ed2d)`

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
added
[e2e](/matrix-org/matrix-spec-proposals/labels/e2e)
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal
[proposal-in-review](/matrix-org/matrix-spec-proposals/labels/proposal-in-review)
labels
[Mar 12, 2021](#event-4453038775)

[![ara4n](https://avatars.githubusercontent.com/u/1294269?s=60&v=4)](/ara4n)

**[ara4n](/ara4n)**
reviewed
[Mar 13, 2021](#pullrequestreview-611582104)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

Show resolved

Hide resolved

[![poljar](https://avatars.githubusercontent.com/u/552026?s=60&v=4)](/poljar)

**[poljar](/poljar)**
reviewed
[Mar 13, 2021](#pullrequestreview-611589465)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)

Show resolved

Hide resolved

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Mar 16, 2021](#ref-pullrequest-828543435)

[Add function to share megolm keys for historical messages, take 2
matrix-org/matrix-js-sdk#1640](/matrix-org/matrix-js-sdk/pull/1640)
 Merged

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=80&v=4)](/uhoreg)

Copy link

Member

Author

### **[uhoreg](/uhoreg)** commented [Mar 16, 2021](#issuecomment-799910767)

| Implemented by [matrix-org/matrix-js-sdk#1640](https://github.com/matrix-org/matrix-js-sdk/pull/1640) |
| --- |

 ❤️
2
 aWeinzierl and SimonBrandner reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
the
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
label
[Apr 8, 2021](#event-4571669257)

[jryans](/jryans)
added a commit
to matrix-org/matrix-react-sdk
that referenced
this pull request
[Apr 9, 2021](#ref-commit-7b0ab4a)
[![@jryans](https://avatars.githubusercontent.com/u/279572?s=40&u=753c3e4e4bdbf3f2a8e5649dc314ed7d1b3a43f6&v=4)](/jryans)

`[Enable sharing historical keys on invite](/matrix-org/matrix-react-sdk/commit/7b0ab4a0591029a28d011c0d66e021d5694cbe05 "Enable sharing historical keys on invite

After discussion with Product, we're ready to enable this key sharing work from
https://github.com/matrix-org/matrix-react-sdk/pull/5763 (based on
https://github.com/matrix-org/matrix-doc/pull/3061).")`
…

`[7b0ab4a](/matrix-org/matrix-react-sdk/commit/7b0ab4a0591029a28d011c0d66e021d5694cbe05)`

```
After discussion with Product, we're ready to enable this key sharing work from
[#5763](https://github.com/matrix-org/matrix-react-sdk/pull/5763) (based on
[matrix-org/matrix-spec-proposals#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)).
```

[![@jryans](https://avatars.githubusercontent.com/u/279572?s=40&u=753c3e4e4bdbf3f2a8e5649dc314ed7d1b3a43f6&v=4)](/jryans)
[jryans](/jryans)
mentioned this pull request
[Apr 9, 2021](#ref-pullrequest-854453423)

[Enable sharing historical keys on invite
matrix-org/matrix-react-sdk#5839](/matrix-org/matrix-react-sdk/pull/5839)
 Merged

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
the
[needs-implementation](/matrix-org/matrix-spec-proposals/labels/needs-implementation)
This MSC does not have a qualifying implementation for the SCT to review. The MSC cannot enter FCP.
label
[Jun 8, 2021](#event-4859239192)

[![@cvwright](https://avatars.githubusercontent.com/u/3451776?s=80&u=5d12cf7b063568cc1ece6ac092e1094dd49dcc20&v=4)](/cvwright)

Copy link

### **[cvwright](/cvwright)** commented [Aug 4, 2021](#issuecomment-893015870)

| Implemented by [matrix-org/matrix-js-sdk#1640](https://github.com/matrix-org/matrix-js-sdk/pull/1640)  Is anyone working on this for matrix-ios-sdk? |
| --- |

 👍
1
 korntom reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
[force-pushed](/matrix-org/matrix-spec-proposals/compare/e895827731bd5cd17fdc23f135602937e4f0d009..dca99ee2735773b3055b2ad697650217db65fc8a)
the
old\_master

branch
from
[`e895827`](/matrix-org/matrix-spec-proposals/commit/e895827731bd5cd17fdc23f135602937e4f0d009) to
[`dca99ee`](/matrix-org/matrix-spec-proposals/commit/dca99ee2735773b3055b2ad697650217db65fc8a)  [Compare](/matrix-org/matrix-spec-proposals/compare/e895827731bd5cd17fdc23f135602937e4f0d009..dca99ee2735773b3055b2ad697650217db65fc8a)
[August 30, 2021 22:34](#event-5229006621)

[![ara4n](https://avatars.githubusercontent.com/u/1294269?s=60&v=4)](/ara4n)

**[ara4n](/ara4n)**
reviewed
[Sep 23, 2021](#pullrequestreview-762242555)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)

Show resolved

Hide resolved

[![deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=60&v=4)](/deepbluev7)

**[deepbluev7](/deepbluev7)**
reviewed
[Oct 1, 2021](#pullrequestreview-768493564)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

|  |  | ## Security considerations |
| --- | --- | --- |
|  |  |  |
|  |  | Clients should still ensure that keys are only shared with authorized users and |
|  |  | devices. |

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 1, 2021](#discussion_r719877913)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How does this work? How does the client know, that a user should be in the room and wasn't maliciously added by the homeserver? Even if you set a room to shared history, you probably only want members to read the history, that you accepted as having been allowed into the room. Considering the end aspect in e2ee, we want the client to approve of a member having joined the room, before sharing history. We don't want to automatically share keys with anyone, who joins the room, because the server could for a short time "fake" a user in the room and as such get access to all the history and then make the user disappear again. Then encrypting the room would be useless. Should we require prompting the user once before sharing past history with a new user in the room?

Sorry, something went wrong.

 👍
1
 kevincox reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Oct 5, 2021](#discussion_r721845227)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is sort of a generic "make sure that you don't accidentally over-share when you implement this". In this case, clients only share the keys with users that the client invites, so it's decided that the user should be authorized. For determining which devices are authorized, in general, the client should probably just do what it normally does for determining which devices to send keys to.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 5, 2021](#discussion_r722095247)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think this is a really scary trap, because a client dev might forget, that the servers device list and member list isn't really that trustworthy. We somewhat get around that by warning for unverified devices, when sending a message, but that will never work for sharing past message keys.

Sorry, something went wrong.

All reactions

Copy link

Member

### @dkasak **[dkasak](/dkasak)** [Oct 25, 2021](#discussion_r735535240)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The proper solution here is to base the decision whether to share on the trust state of the user we're inviting.

If the invited user is untrusted (in cross-signing terms), the client should at least display a warning along with a list of devices that would get the keys. This would allow the inviter to at least review the list and consciously proceed with the action if they want to do so.

If the invited user is trusted, but some of their devices are not verified yet, the client should again display a warning with a list of those devices, again asking whether to proceed.

If the user is trusted *and* all of their devices are verified, then no warning is necessary.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @deepbluev7 **[deepbluev7](/deepbluev7)** [Oct 25, 2021](#discussion_r735585772)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So only the inviter will ever share keys?

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Oct 25, 2021](#discussion_r735647538)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It doesn't have to be just the inviter who shares keys; others can share keys as well, but it's up to them to ensure that they do so securely. Spec-wise, we try to avoid telling clients exactly how to handle keys, as different clients may wish to make different tradeoffs. But I will [add a comment](https://github.com/matrix-org/matrix-doc/pull/3061#discussion_r735638426) about checking device trust before sharing.

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @uhoreg **[uhoreg](/uhoreg)** [Dec 21, 2022](#discussion_r1054942291)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I've added some more words here. Hopefully it's clearer now.

Sorry, something went wrong.

All reactions

This was referenced Oct 4, 2021

[Sharing room keys for past messages
element-hq/element-ios#4947](/element-hq/element-ios/issues/4947)

Closed

[Sharing room keys for past messages
element-hq/element-android#4153](/element-hq/element-android/issues/4153)

Closed

[![uhoreg](https://avatars.githubusercontent.com/u/1012976?s=60&v=4)](/uhoreg)

**[uhoreg](/uhoreg)**
commented
[Oct 25, 2021](#pullrequestreview-788174929)

 [View reviewed changes](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d)

[proposals/3061-shareable-room-keys.md](/matrix-org/matrix-spec-proposals/pull/3061/files/38f35c23e8cb013a59bbc9216eba7354de72ed2d#diff-fc5260607fc2b4b86f41116d90f9c8d322d418470eb96b173060b1f82c4f54fb)
Outdated

Show resolved

Hide resolved

[![@manuroe](https://avatars.githubusercontent.com/u/8418515?s=40&v=4)](/manuroe)
[manuroe](/manuroe)
mentioned this pull request
[Nov 18, 2021](#ref-issue-1057200853)

[Android clients hides room history from newly invited users in a room
element-hq/element-android#4503](/element-hq/element-android/issues/4503)

Open

1 task

[![@BillCarsonFr](https://avatars.githubusercontent.com/u/9841565?s=40&v=4)](/BillCarsonFr)
[BillCarsonFr](/BillCarsonFr)
mentioned this pull request
[Dec 16, 2021](#ref-issue-1082478820)

[Improve history UISI Display
element-hq/element-meta#74](/element-hq/element-meta/issues/74)

Closed

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Jan 25, 2022](#ref-pullrequest-1113977388)

[MSC3673: Encrypted ephemeral data units
#3673](/matrix-org/matrix-spec-proposals/pull/3673)
 Open

[![@BillCarsonFr](https://avatars.githubusercontent.com/u/9841565?s=40&v=4)](/BillCarsonFr)
[BillCarsonFr](/BillCarsonFr)
mentioned this pull request
[Apr 11, 2022](#ref-issue-1200023451)

[Implement MSC3061: Sharing room keys for past messages
matrix-org/matrix-rust-sdk#580](/matrix-org/matrix-rust-sdk/issues/580)

Closed

This was referenced Apr 21, 2022

[Store `sharedHistory` flag for inbound Megolm sessions
matrix-org/matrix-ios-sdk#1444](/matrix-org/matrix-ios-sdk/pull/1444)
 Merged

[Share Megolm session keys when inviting a new user
matrix-org/matrix-ios-sdk#1447](/matrix-org/matrix-ios-sdk/pull/1447)
 Merged

[![@ariskotsomitopoulos](https://avatars.githubusercontent.com/u/60798129?s=40&v=4)](/ariskotsomitopoulos)
[ariskotsomitopoulos](/ariskotsomitopoulos)
mentioned this pull request
[Apr 27, 2022](#ref-pullrequest-1217114565)

[Share Megolm session keys when inviting a new user
element-hq/element-android#5853](/element-hq/element-android/pull/5853)
 Merged

[![@Anderas](https://avatars.githubusercontent.com/u/3922159?s=40&v=4)](/Anderas)
[Anderas](/Anderas)
mentioned this pull request
[Apr 28, 2022](#ref-pullrequest-1218530049)

[Change `sharedHistory` flag to unstable variant
matrix-org/matrix-ios-sdk#1449](/matrix-org/matrix-ios-sdk/pull/1449)
 Merged

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
removed
the
[proposal-in-review](/matrix-org/matrix-spec-proposals/labels/proposal-in-review)
label
[May 5, 2022](#event-6559706589)

27 hidden items

Load more…

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=80&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)

Copy link

Member

### **[turt2live](/turt2live)** commented [Aug 14, 2023](#issuecomment-1677617594)

| This MSC has completed FCP per the [above comment](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-1671589660). |
| --- |

All reactions

Sorry, something went wrong.

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
[finished-final-comment-period](/matrix-org/matrix-spec-proposals/labels/finished-final-comment-period)
and removed
[final-comment-period](/matrix-org/matrix-spec-proposals/labels/final-comment-period)
This MSC has entered a final comment period in interest to approval, postpone, or delete in 5 days.
labels
[Aug 14, 2023](#event-10088620699)

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
merged commit [`5c19d4f`](/matrix-org/matrix-spec-proposals/commit/5c19d4fdea9058533242e99b72b1776fd4a523cb)
into
matrix-org:old\_master

[Aug 14, 2023](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#event-10088622217)

[![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&u=4897d21a28d80c6f8e5762712720c6dc566e641e&v=4)](/turt2live)
[turt2live](/turt2live)
added
[spec-pr-missing](/matrix-org/matrix-spec-proposals/labels/spec-pr-missing)
Proposal has been implemented and is being used in the wild but hasn't yet been added to the spec
and removed
[finished-final-comment-period](/matrix-org/matrix-spec-proposals/labels/finished-final-comment-period)
labels
[Aug 14, 2023](#event-10088624270)

[turt2live](/turt2live)
pushed a commit
that referenced
this pull request
[Aug 16, 2023](#ref-commit-6a3ab1d)
[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh) [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=40&v=4)](/turt2live)

`[MSC3061](https://github.com/matrix-org/matrix-doc/pull/3061)[: Sharing room keys for past messages (](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280 "MSC3061: Sharing room keys for past messages (#3061)

* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>")[#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)[)](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280 "MSC3061: Sharing room keys for past messages (#3061)

* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>")`
…

`[6a3ab1d](/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280)`

```
* initial version

* use MSC number

* address comments from review

* fix list

* fix markdown

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>

---------

Co-authored-by: Richard van der Hoff <1389908+richvdh@users.noreply.github.com>
```

This was referenced Oct 2, 2023

[crypto: Implemented sharing room keys for past messages (MSC3061)
matrix-org/matrix-rust-sdk#2650](/matrix-org/matrix-rust-sdk/pull/2650)
 Closed

[Added shared\_history flag to room key events
ruma/ruma#1669](/ruma/ruma/pull/1669)
 Merged

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
mentioned this pull request
[Oct 4, 2023](#ref-pullrequest-1925181634)

[Add spec for shared-history room keys (MSC3061)
matrix-org/matrix-spec#1655](/matrix-org/matrix-spec/pull/1655)
 Closed

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=80&v=4)](/uhoreg)

Copy link

Member

Author

### **[uhoreg](/uhoreg)** commented [Oct 4, 2023](#issuecomment-1745970453)

| Spec PR: [matrix-org/matrix-spec#1655](https://github.com/matrix-org/matrix-spec/pull/1655) |
| --- |

All reactions

Sorry, something went wrong.

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg)
[uhoreg](/uhoreg)
added
[spec-pr-in-review](/matrix-org/matrix-spec-proposals/labels/spec-pr-in-review)
A proposal which has been PR'd against the spec and is in review
and removed
[spec-pr-missing](/matrix-org/matrix-spec-proposals/labels/spec-pr-missing)
Proposal has been implemented and is being used in the wild but hasn't yet been added to the spec
labels
[Oct 4, 2023](#event-10544895522)

This was referenced Feb 28, 2024

[Epic: Users should not see UTDs for messages they are not supposed to be able to read
element-hq/element-meta#2312](/element-hq/element-meta/issues/2312)

Closed

[Expected UTDs: Hide UTDs for messages sent while you were not in the room ("Pre-join UTDs")
element-hq/element-meta#2317](/element-hq/element-meta/issues/2317)

Closed

[![@Johennes](https://avatars.githubusercontent.com/u/1137962?s=40&v=4)](/Johennes)
[Johennes](/Johennes)
mentioned this pull request
[Mar 10, 2024](#ref-pullrequest-2152477871)

[MSC4114: Matrix as a password manager
#4114](/matrix-org/matrix-spec-proposals/pull/4114)
 Open

This was referenced Jul 2, 2024

[Inviting a user to an E2EE room does not share keys for history with them, causing UISIs everywhere.
element-hq/element-x-ios#1496](/element-hq/element-x-ios/issues/1496)

Open

[Let devices request keys to decrypt past history for a room.
element-hq/element-meta#647](/element-hq/element-meta/issues/647)

Closed

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=80&u=39d73e47728d2fc80f472acb7a3aa59facf7b54a&v=4)](/dkasak)

Copy link

Member

### **[dkasak](/dkasak)** commented [Oct 15, 2024](#issuecomment-2414282902) • edited Loading

| The [spec text PR](https://github.com/matrix-org/matrix-spec/pull/1655) for this MSC was (in)famously blocked on a security concern. This concern is now disclosed at <https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/>. |
| --- |

All reactions

Sorry, something went wrong.

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=80&v=4)](/richvdh)

Copy link

Member

### **[richvdh](/richvdh)** commented [Oct 29, 2024](#issuecomment-2444845098)

| Following the above disclosure, the Spec Core team have decided to revert the merging of this proposal. A future proposal is welcome to use this one as a basis. |
| --- |

All reactions

Sorry, something went wrong.

[richvdh](/richvdh)
added a commit
that referenced
this pull request
[Oct 29, 2024](#ref-commit-22c774d)
[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)

`[Revert "](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")[MSC3061](https://github.com/matrix-org/matrix-doc/pull/3061)[: Sharing room keys for past messages (](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")[#3061](https://github.com/matrix-org/matrix-spec-proposals/pull/3061)[)"](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952 "Revert \"MSC3061: Sharing room keys for past messages (#3061)\"

This reverts commit 6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280.

Per https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/
and https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098,
we are removing the merged status of this PR.")`
…

`[22c774d](/matrix-org/matrix-spec-proposals/commit/22c774de581a4fc3ee64fd90f78a999e0d3dd952)`

```
This reverts commit [6a3ab1d](https://github.com/matrix-org/matrix-spec-proposals/commit/6a3ab1d64cdf9f429a86b0e9d4df927dd36f0280).

Per <https://matrix.org/blog/2024/10/security-disclosure-matrix-js-sdk-and-matrix-react-sdk/>
and [#3061 (comment)](https://github.com/matrix-org/matrix-spec-proposals/pull/3061#issuecomment-2444845098),
we are removing the merged status of this PR.
```

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh)
[richvdh](/richvdh)
added
[abandoned](/matrix-org/matrix-spec-proposals/labels/abandoned)
A proposal where the author/shepherd is not responsive
[rejected](/matrix-org/matrix-spec-proposals/labels/rejected)
A proposal which has been rejected for inclusion in the spec
and removed
[spec-pr-in-review](/matrix-org/matrix-spec-proposals/labels/spec-pr-in-review)
A proposal which has been PR'd against the spec and is in review
[abandoned](/matrix-org/matrix-spec-proposals/labels/abandoned)
A proposal where the author/shepherd is not responsive
labels
[Oct 29, 2024](#event-14988275212)

[![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=80&u=ffe9ae6208c93f6240dcf2b92a31065ee5e26aad&v=4)](/HarHarLinks)

Copy link

Contributor

### **[HarHarLinks](/HarHarLinks)** commented [Dec 7, 2024](#issuecomment-2525304477)

| Removed from matrix-js-sdk in <https://github.com/matrix-org/matrix-js-sdk/releases/tag/v34.8.0> |
| --- |

All reactions

Sorry, something went wrong.

[![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=40&u=ffe9ae6208c93f6240dcf2b92a31065ee5e26aad&v=4)](/HarHarLinks)
[HarHarLinks](/HarHarLinks)
mentioned this pull request
[Jan 4, 2025](#ref-issue-860172978)

[Room history sometimes not visible even when historical room keys are shared.
element-hq/element-web#16983](/element-hq/element-web/issues/16983)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fmatrix-spec-proposals%2Fpull%2F3061)

Reviewers

[![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=40&v=4)](/deepbluev7) [deepbluev7](/deepbluev7)

deepbluev7 left review comments

[![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=40&v=4)](/richvdh) [richvdh](/richvdh)

richvdh left review comments

[![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=40&v=4)](/ara4n) [ara4n](/ara4n)

ara4n left review comments

[![@poljar](https://avatars.githubusercontent.com/u/552026?s=40&v=4)](/poljar) [poljar](/poljar)

poljar left review comments

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep) [clokep](/clokep)

clokep left review comments

[![@dkasak](https://avatars.githubusercontent.com/u/463342?s=40&v=4)](/dkasak) [dkasak](/dkasak)

dkasak left review comments

Assignees

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=40&v=4)](/uhoreg) [uhoreg](/uhoreg)

Labels

[disposition-merge](/matrix-org/matrix-spec-proposals/labels/disposition-merge)
[e2e](/matrix-org/matrix-spec-proposals/labels/e2e)
[kind:core](/matrix-org/matrix-spec-proposals/labels/kind%3Acore)
MSC which is critical to the protocol's success
[proposal](/matrix-org/matrix-spec-proposals/labels/proposal)
A matrix spec change proposal
[rejected](/matrix-org/matrix-spec-proposals/labels/rejected)
A proposal which has been rejected for inclusion in the spec

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

13 participants

[![@uhoreg](https://avatars.githubusercontent.com/u/1012976?s=52&v=4)](/uhoreg) [![@cvwright](https://avatars.githubusercontent.com/u/3451776?s=52&v=4)](/cvwright) [![@richvdh](https://avatars.githubusercontent.com/u/1389908?s=52&v=4)](/richvdh) [![@kristovatlas](https://avatars.githubusercontent.com/u/7227529?s=52&v=4)](/kristovatlas) [![@bradtgmurray](https://avatars.githubusercontent.com/u/33967?s=52&v=4)](/bradtgmurray) [![@mscbot](https://avatars.githubusercontent.com/u/40832866?s=52&v=4)](/mscbot) [![@turt2live](https://avatars.githubusercontent.com/u/1190097?s=52&v=4)](/turt2live) [![@dkasak](https://avatars.githubusercontent.com/u/463342?s=52&v=4)](/dkasak) [![@HarHarLinks](https://avatars.githubusercontent.com/u/2803622?s=52&v=4)](/HarHarLinks) [![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@poljar](https://avatars.githubusercontent.com/u/552026?s=52&v=4)](/poljar) [![@ara4n](https://avatars.githubusercontent.com/u/1294269?s=52&v=4)](/ara4n) [![@deepbluev7](https://avatars.githubusercontent.com/u/16312324?s=52&v=4)](/deepbluev7)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


