

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Core](https://make.wordpress.org/core/)

* [Blog](https://make.wordpress.org/core/)
* [Handbook](https://make.wordpress.org/core/handbook/)
* [Tickets](https://make.wordpress.org/core/reports/)
* [Components](https://make.wordpress.org/core/components/)
* [Browse Source](https://core.trac.wordpress.org/browser "Browse Source")
* [Trac Timeline](https://core.trac.wordpress.org/timeline "Trac Timeline")
* [Create a New Ticket](https://login.wordpress.org/?redirect_to=https://core.trac.wordpress.org/newticket "Create a New Ticket")

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fcore.trac.wordpress.org%2Fticket%2F56655)
* [Notifications](https://make.wordpress.org/core/notifications/)

## Context Navigation

* ← [Previous Ticket](/ticket/56654 "Ticket #56654")
* [Next Ticket](/ticket/56656 "Ticket #56656") →

---

Opened [2 years ago](/timeline?from=2022-09-26T08%3A26%3A59Z&precision=second "See timeline at 09/26/2022 08:26:59 AM")

Closed [2 years ago](/timeline?from=2022-11-09T03%3A00%3A19Z&precision=second "See timeline at 11/09/2022 03:00:19 AM")

## [#56655](/ticket/56655) [closed](/query?status=closed) [defect (bug)](/query?status=!closed&type=defect+(bug)) ([wontfix](/query?status=closed&resolution=wontfix))

# add\_menu\_page - escaping $page\_title, $menu\_title

| Reported by: | [soupia18's profile](https://profiles.wordpress.org/soupia18) [soupia18](/query?status=!closed&reporter=soupia18) | Owned by: |  |
| --- | --- | --- | --- |
| Milestone: |  | Priority: | [normal](/query?status=!closed&priority=normal) |
| Severity: | [normal](/query?status=!closed&severity=normal) | Version: |  |
| Component: | [Menus](/query?status=!closed&component=Menus) | Keywords: | [has-screenshots](/query?status=!closed&keywords=~has-screenshots) [has-patch](/query?status=!closed&keywords=~has-patch) [2nd-opinion](/query?status=!closed&keywords=~2nd-opinion) |
| Focuses: | [administration](/query?status=!closed&focuses=~administration) | Cc: |  |

### Description

Just wondering - shouldn't something like below, be escaped before the output?

```
<?php
add_menu_page(
        __('<script>alert("hi1")</script>Page Title','text-domain'),
        __('<script>alert("hi2")</script>Menu Title','text-domain'),
        'manage_options',
        'menu-slug',
        array($this, 'my_callback'),
        'dashicons-images-alt2',
);

```

Custom Post Types labels are going through escaping, but adding admin menus like above, it doesn't.

### Attachments (1)

[Screenshot 2022-09-26 at 12.42.34.png](/attachment/ticket/56655/Screenshot%202022-09-26%20at%2012.42.34.png "View attachment")[​](/raw-attachment/ticket/56655/Screenshot%202022-09-26%20at%2012.42.34.png "Download") (61.7 KB) - added by martin.krcho [2 years ago](/timeline?from=2022-09-26T10%3A43%3A39Z&precision=second "See timeline at 09/26/2022 10:43:39 AM").

Download all attachments as: [.zip](/zip-attachment/ticket/56655/)

Oldest first

Newest first

Threaded

Show comments

Show property changes

### Change History (10)

### [@martin.krcho](https://profiles.wordpress.org/martinkrcho) [2 years](/timeline?from=2022-09-26T10%3A43%3A39Z&precision=second "See timeline at 09/26/2022 10:43:39 AM") ago

* **Attachment**
  [*Screenshot 2022-09-26 at 12.42.34.png*](/attachment/ticket/56655/Screenshot%202022-09-26%20at%2012.42.34.png)[​](/raw-attachment/ticket/56655/Screenshot%202022-09-26%20at%2012.42.34.png "Download")
  added

### [#1](#comment:1) [@martin.krcho](https://profiles.wordpress.org/martinkrcho) [2 years](/timeline?from=2022-09-26T10%3A46%3A39Z&precision=second "See timeline at 09/26/2022 10:46:39 AM") ago

* **Focuses**
  *administration* added
* **Keywords**
  *needs-patch* *has-screenshots* added
* **Type**
  changed from *enhancement* to *defect (bug)*
* **Version**
  set to *trunk*

Hey @soupia18, thank you very much for creating this ticket. Also, congratulations on creating your first ticket in WordPress Trac.

I can confirm that this is an issue in the latest version of WordPress (trunk). I was able to replicate the issue using the following mu-plugin.

```
<?php
add_action( 'admin_init', function () {
        add_menu_page(
                __( '<script>alert("hi1")</script>Page Title', 'text-domain' ),
                __( '<script>alert("hi2")</script>Menu Title', 'text-domain' ),
                'manage_options',
                'menu-slug',
                function () {
                        echo 'testing XSS issue';
                },
                'dashicons-images-alt2'
        );
} );

```

I can see a JS alert saying "hi2" when loading the WP Admin - see the screenshot above.

### [#2](#comment:2) [@soupia18](https://profiles.wordpress.org/soupia18) [2 years](/timeline?from=2022-09-26T15%3A58%3A59Z&precision=second "See timeline at 09/26/2022 03:58:59 PM") ago

Hello @martinkrcho - thank you for the welcome.

The issue is in /wp-admin/menu-header.php

Both menu and submenus titles are printed unescaped.

It looks like wp\_kses() might be needed there - with some allowed\_html tags. E.g. the Plugins menu contains span elements.

There are 3 variables that need to be escaped there (at least with what I have tested so far).

### [#3](#comment:3) [@soupia18](https://profiles.wordpress.org/soupia18) [2 years](/timeline?from=2022-09-27T19%3A54%3A58Z&precision=second "See timeline at 09/27/2022 07:54:58 PM") ago

@martinkrcho

Hi! I just noticed that the same issue exists also when we use add\_meta\_boxes().

This example:

```
<?php
add_meta_box(
        'prefix_my_metabox',
        __('<script>alert('hola!');</script>Metabox Title', 'text-domain'),
        'prefix_my_callback',
        null,
        'normal',
        'default',
        array(),
);

```

Would make sense to create a new ticket/report for this one?

### *This ticket was mentioned in [​PR #3356](https://github.com/WordPress/wordpress-develop/pull/3356) on [​WordPress/wordpress-develop](https://github.com/WordPress/wordpress-develop/) by [​joomlabeat](https://github.com/joomlabeat).* [2 years](/timeline?from=2022-09-28T15%3A40%3A11Z&precision=second "See timeline at 09/28/2022 03:40:11 PM") ago [#4](#comment:4)

* **Keywords**
  *has-patch* added; *needs-patch* removed

Admin menu-header - Printing menu and submenu titles goes through escaping with `wp_kses()` and a custom list of `$allowed_html` tags. The `$allowed_html` is defined early in the `_wp_menu_output()` and later on, the `wp_kses()` is used in 3 locations, where the title is either printed or defined on a variable and is ready for printing.

Trac ticket: [](<https://core.trac.wordpress.org/ticket/56655>)

### *This ticket was mentioned in [​Slack](https://make.wordpress.org/chat/) in #core by desrosj. [​View the logs](https://wordpress.slack.com/archives/core/p1667227427198529).* [2 years](/timeline?from=2022-10-31T14%3A43%3A50Z&precision=second "See timeline at 10/31/2022 02:43:50 PM") ago

### [#6](#comment:6) [@desrosj](https://profiles.wordpress.org/desrosj) [2 years](/timeline?from=2022-10-31T14%3A45%3A53Z&precision=second "See timeline at 10/31/2022 02:45:53 PM") ago

* **Milestone**
  changed from *Awaiting Review* to *6.1.1*
* **Severity**
  changed from *critical* to *normal*
* **Version**
  *6.1* deleted

### [#7](#comment:7) [@azaozz](https://profiles.wordpress.org/azaozz) [2 years](/timeline?from=2022-11-02T18%3A07%3A19Z&precision=second "See timeline at 11/02/2022 06:07:19 PM") ago

* **Keywords**
  *2nd-opinion* added

> I can confirm that this is an issue...
>
> ...
>
> Both menu and submenus titles are printed unescaped.
>
> ...
>
> I just noticed that the same issue exists also when we use add\_meta\_boxes()

The question here is where these strings come from? Can they be entered by (unidentified) users or are they coming from plugins?

As far as I see the reason for not escaping the menu titles is that a plugin may want to add a bit of HTML to make a menu "bubble" with a count, like for comments, available updates, etc. These strings are not different than any other string outputted by a plugin, i.e. a plugin can add any HTML and any JS to pretty much any place in wp-admin. Don't see why menu titles should be restricted, doesn't seem to serve any purpose. :)

> It looks like wp\_kses() might be needed there

Not sure that is a good idea. KSES is pretty slow and is intended only for use when **user supplied content** is saved to the DB. All other uses of it, especially on outputting/displaying content, make WP slow.

For example: if a plugin would allow a user to enter a menu title, it should use KSES on saving the title entered by the user to make sue it is safe if it wanted to allow users to enter HTML tags at all. Usually a plugin would use `sanitize_text_field()` to remove tags and make the text "safe". This is the same for any other user input.

Last edited [2 years ago](/timeline?from=2022-11-04T17%3A18%3A53Z&precision=second "See timeline at 11/04/2022 05:18:53 PM")
by azaozz
([previous](/ticket/56655?cversion=1&cnum_hist=7#comment:7))
([diff](/ticket/56655?action=comment-diff&cnum=7&version=2))

### *This ticket was mentioned in [​Slack](https://make.wordpress.org/chat/) in #core by jeffpaul. [​View the logs](https://wordpress.slack.com/archives/core/p1667569848396439).* [2 years](/timeline?from=2022-11-04T13%3A50%3A51Z&precision=second "See timeline at 11/04/2022 01:50:51 PM") ago

### [#9](#comment:9) [@peterwilsoncc](https://profiles.wordpress.org/peterwilsoncc) [2 years](/timeline?from=2022-11-09T03%3A00%3A19Z&precision=second "See timeline at 11/09/2022 03:00:19 AM") ago

* **Milestone**
  *6.1.1* deleted
* **Resolution**
  set to *wontfix*
* **Status**
  changed from *new* to *closed*

> Can they be entered by (unidentified) users or are they coming from plugins?

The intent the function is that the strings come from plugins rather than users.

If a plugin developer creates a plugin that uses this function based on user input, then the plugin becomes responsible for sanitizing the user input appropriately. WordPress takes a similar approach with custom post type labels.

---

I think this can be closed without a fix.

Anything that requires PHP to exploit (for want of a better word) is generally considered fine as PHP code has full access to the WordPress install by definition. Anyone wishing to do something nasty via PHP can find far more suitable APIs to use to do far nastier things.

The plugin architectures flexibility has it's upsides and it's downsides.

Thanks for your report.

**Note:** See
[TracTickets](/wiki/TracTickets) for help on using
tickets.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Comma-delimited Text](/ticket/56655?format=csv)
* [Tab-delimited Text](/ticket/56655?format=tab)
* [RSS Feed](/ticket/56655?format=rss)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

