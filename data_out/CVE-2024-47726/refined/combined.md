=== Content from git.kernel.org_afa5dc96_20250111_084625.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chao Yu <chao@kernel.org> | 2024-06-27 15:17:11 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:38:47 +0200 |
| commit | [e3db757ff9b7101ae68650ac5f6dd5743b68164e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)) | |
| tree | [ce3733e0f20395d972f62058d9f7576b3663d504](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e) | |
| parent | [f91f17bd30de599fa7404bf12a38499951183a0a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f91f17bd30de599fa7404bf12a38499951183a0a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e&id2=f91f17bd30de599fa7404bf12a38499951183a0a)) | |
| download | [linux-e3db757ff9b7101ae68650ac5f6dd5743b68164e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e3db757ff9b7101ae68650ac5f6dd5743b68164e.tar.gz) | |

f2fs: fix to wait dio completioncommit 96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d upstream.
It should wait all existing dio write IOs before block removal,
otherwise, previous direct write IO may overwrite data in the
block which may be reused by other inode.
Cc: stable@vger.kernel.org
Signed-off-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)

| -rw-r--r-- | [fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/file.c?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 0 deletions

| diff --git a/fs/f2fs/file.c b/fs/f2fs/file.cindex 56381a0b63219b..919eef1163a4ee 100644--- a/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=f91f17bd30de599fa7404bf12a38499951183a0a)+++ b/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=e3db757ff9b7101ae68650ac5f6dd5743b68164e)@@ -1055,6 +1055,13 @@ int f2fs\_setattr(struct mnt\_idmap \*idmap, struct dentry \*dentry, return err; } + /\*+ \* wait for inflight dio, blocks should be removed after+ \* IO completion.+ \*/+ if (attr->ia\_size < old\_size)+ inode\_dio\_wait(inode);+ f2fs\_down\_write(&fi->i\_gc\_rwsem[WRITE]); filemap\_invalidate\_lock(inode->i\_mapping); @@ -1891,6 +1898,12 @@ static long f2fs\_fallocate(struct file \*file, int mode, if (ret) goto out; + /\*+ \* wait for inflight dio, blocks should be removed after IO+ \* completion.+ \*/+ inode\_dio\_wait(inode);+ if (mode & FALLOC\_FL\_PUNCH\_HOLE) { if (offset >= inode->i\_size) goto out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:45:02 +0000



=== Content from git.kernel.org_981b671b_20250111_084625.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chao Yu <chao@kernel.org> | 2024-06-27 15:17:11 +0800 |
| --- | --- | --- |
| committer | Jaegeuk Kim <jaegeuk@kernel.org> | 2024-08-15 15:26:39 +0000 |
| commit | [96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)) | |
| tree | [956171639692abec381b50914d500f99b47af262](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d) | |
| parent | [aaf8c0b9ae042494cb4585883b15c1332de77840](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aaf8c0b9ae042494cb4585883b15c1332de77840) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d&id2=aaf8c0b9ae042494cb4585883b15c1332de77840)) | |
| download | [linux-96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d.tar.gz) | |

f2fs: fix to wait dio completionIt should wait all existing dio write IOs before block removal,
otherwise, previous direct write IO may overwrite data in the
block which may be reused by other inode.
Cc: stable@vger.kernel.org
Signed-off-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)

| -rw-r--r-- | [fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/file.c?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d) | 13 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 0 deletions

| diff --git a/fs/f2fs/file.c b/fs/f2fs/file.cindex e3bea575ddc353..67e5c6060403df 100644--- a/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=aaf8c0b9ae042494cb4585883b15c1332de77840)+++ b/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=96cfeb0389530ae32ade8a48ae3ae1ac3b6c009d)@@ -1055,6 +1055,13 @@ int f2fs\_setattr(struct mnt\_idmap \*idmap, struct dentry \*dentry, return err; } + /\*+ \* wait for inflight dio, blocks should be removed after+ \* IO completion.+ \*/+ if (attr->ia\_size < old\_size)+ inode\_dio\_wait(inode);+ f2fs\_down\_write(&fi->i\_gc\_rwsem[WRITE]); filemap\_invalidate\_lock(inode->i\_mapping); @@ -1891,6 +1898,12 @@ static long f2fs\_fallocate(struct file \*file, int mode, if (ret) goto out; + /\*+ \* wait for inflight dio, blocks should be removed after IO+ \* completion.+ \*/+ inode\_dio\_wait(inode);+ if (mode & FALLOC\_FL\_PUNCH\_HOLE) { if (offset >= inode->i\_size) goto out; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:45:02 +0000


