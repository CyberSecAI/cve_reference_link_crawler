

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3146752%2Fpost-grid%2Ftags%2F2.2.91%2Fincludes%2Fblocks%2Fform-wrap%2Ffunctions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3130155/post-grid/trunk/includes/blocks/form-wrap/functions.php "Changeset 3130155 for post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php")
* Next Change →

---

# Changeset [3146752](/changeset/3146752 "Show full changeset") for [post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
09/05/2024 06:06:53 AM
([4 months](/timeline?from=2024-09-05T06%3A06%3A53Z&precision=second "See timeline at 09/05/2024 06:06:53 AM") ago)

Author:
pickplugins
Message:

Update to version 2.2.91 from GitHub

Location:
[post-grid/tags/2.2.91](/browser/post-grid/tags/2.2.91?rev=3146752)
Files:

1 edited
1 copied

* [.](/browser/post-grid/tags/2.2.91?rev=3146752 "Show entry in browser")
  (copied)
  *(copied from [post-grid/trunk](/browser/post-grid/trunk?rev=3138087 "Show original file (revision 3146743)"))*
* [includes/blocks/form-wrap/functions.php](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php](/changeset/3146752/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php "Show the changeset 3146752 restricted to post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php")

  | [r3130155](/browser/post-grid/trunk/includes/blocks/form-wrap/functions.php?rev=3130155#L2923 "Show revision 3130155 of this file in browser") | [r3146752](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752#L2923 "Show revision 3146752 of this file in browser") |  |
  | --- | --- | --- |
  | 2923 | 2923 |  |
  | 2924 | 2924 |  |
  |  | 2925 | $post\_grid\_block\_editor = get\_option("post\_grid\_block\_editor"); |
  |  | 2926 |  |
  |  | 2927 | $blockSettings = isset($post\_grid\_block\_editor['blockSettings']) ? $post\_grid\_block\_editor['blockSettings'] : []; |
  |  | 2928 | $formWrap = isset($blockSettings['formWrap']) ? $blockSettings['formWrap'] : []; |
  |  | 2929 | $allowedUserMetaKeys = isset($formWrap['allowedUserMetaKeys']) ? $formWrap['allowedUserMetaKeys'] : []; |
  |  | 2930 |  |
  |  | 2931 |  |
  |  | 2932 | error\_log(serialize($allowedUserMetaKeys)); |
  | 2925 | 2933 |  |
  | 2926 | 2934 |  |
  | […](/browser/post-grid/trunk/includes/blocks/form-wrap/functions.php?rev=3130155#L3012) | […](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752#L3020) |  |
  | 3012 | 3020 |  |
  | 3013 | 3021 |  |
  | 3014 |  | if (isset($response['errors'])) { |
  | 3015 |  |  |
  | 3016 |  | return $response; |
  | 3017 |  | } |
  | 3018 |  |  |
  | 3019 |  |  |
  | 3020 |  |  |
  | 3021 |  |  |
  | 3022 |  | $user\_update = wp\_update\_user($user\_new\_data); |
  |  | 3022 |  |
  |  | 3023 |  |
  |  | 3024 |  |
  |  | 3025 |  |
  |  | 3026 |  |
  | 3023 | 3027 |  |
  | 3024 | 3028 |  |
  | […](/browser/post-grid/trunk/includes/blocks/form-wrap/functions.php?rev=3130155#L3030) | […](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752#L3034) |  |
  | 3030 | 3034 | if (!empty($user\_meta)) { |
  | 3031 | 3035 | foreach ($user\_meta as $metaKey => $metavalue) { |
  | 3032 |  | update\_user\_meta($currentUserId, $metaKey, $metavalue); |
  | 3033 |  | } |
  | 3034 |  | } |
  | 3035 |  |  |
  | 3036 |  | $user\_meta\_files = $request->get\_file\_params()['user\_meta']; |
  | 3037 |  |  |
  | 3038 |  |  |
  | 3039 |  |  |
  | 3040 |  | $files = []; |
  | 3041 |  | if (!empty($user\_meta\_files)) { |
  | 3042 |  | $i = 0; |
  | 3043 |  | foreach ($user\_meta\_files as $index => $data) { |
  | 3044 |  |  |
  | 3045 |  | foreach ($data as $metaKey => $fileInfo) { |
  | 3046 |  | $files[$metaKey][$index] = $fileInfo; |
  | 3047 |  | } |
  | 3048 |  | } |
  | 3049 |  | } |
  | 3050 |  |  |
  | 3051 |  | if (!empty($files)) { |
  | 3052 |  | foreach ($files as $metaKey => $metavalue) { |
  | 3053 |  |  |
  | 3054 |  | $file\_response = post\_grid\_upload\_file($metavalue); |
  | 3055 |  |  |
  | 3056 |  | if ($file\_response['id']) { |
  | 3057 |  | update\_user\_meta($currentUserId, $metaKey, $file\_response['id']); |
  | 3058 |  | } |
  | 3059 |  | } |
  | 3060 |  | } |
  | 3061 |  |  |
  | 3062 |  |  |
  | 3063 |  |  |
  | 3064 |  |  |
  | 3065 |  |  |
  | 3066 |  |  |
  | 3067 |  |  |
  |  | 3036 |  |
  |  | 3037 | if (in\_array($metaKey, $allowedUserMetaKeys)) { |
  |  | 3038 | update\_user\_meta($currentUserId, $metaKey, $metavalue); |
  |  | 3039 | } else { |
  |  | 3040 | $response['errors']['profileUpdateFailed'] = \_\_("You dont\'t have access to update this field({$metaKey})", 'post-grid'); |
  |  | 3041 | } |
  |  | 3042 | } |
  |  | 3043 | } |
  |  | 3044 |  |
  |  | 3045 | if (isset($request->get\_file\_params()['user\_meta'])) { |
  |  | 3046 | $user\_meta\_files = $request->get\_file\_params()['user\_meta']; |
  |  | 3047 |  |
  |  | 3048 |  |
  |  | 3049 |  |
  |  | 3050 | $files = []; |
  |  | 3051 | if (!empty($user\_meta\_files)) { |
  |  | 3052 | $i = 0; |
  |  | 3053 | foreach ($user\_meta\_files as $index => $data) { |
  |  | 3054 |  |
  |  | 3055 | foreach ($data as $metaKey => $fileInfo) { |
  |  | 3056 | $files[$metaKey][$index] = $fileInfo; |
  |  | 3057 | } |
  |  | 3058 | } |
  |  | 3059 | } |
  |  | 3060 |  |
  |  | 3061 | if (!empty($files)) { |
  |  | 3062 | foreach ($files as $metaKey => $metavalue) { |
  |  | 3063 |  |
  |  | 3064 | $file\_response = post\_grid\_upload\_file($metavalue); |
  |  | 3065 |  |
  |  | 3066 | if ($file\_response['id']) { |
  |  | 3067 | if (in\_array($metaKey, $allowedUserMetaKeys)) { |
  |  | 3068 | update\_user\_meta($currentUserId, $metaKey, $file\_response['id']); |
  |  | 3069 | } else { |
  |  | 3070 | $response['errors']['profileUpdateFailed'] = \_\_("You dont\'t have access to update this field({$metaKey})", 'post-grid'); |
  |  | 3071 | } |
  |  | 3072 | } |
  |  | 3073 | } |
  |  | 3074 | } |
  |  | 3075 | } |
  |  | 3076 |  |
  |  | 3077 |  |
  |  | 3078 |  |
  |  | 3079 |  |
  |  | 3080 |  |
  |  | 3081 |  |
  |  | 3082 |  |
  |  | 3083 |  |
  |  | 3084 |  |
  |  | 3085 |  |
  |  | 3086 | if (isset($response['errors'])) { |
  |  | 3087 |  |
  |  | 3088 | return $response; |
  |  | 3089 | } |
  |  | 3090 |  |
  |  | 3091 | $user\_update = wp\_update\_user($user\_new\_data); |
  | 3068 | 3092 |  |
  | 3069 | 3093 |  |
  | […](/browser/post-grid/trunk/includes/blocks/form-wrap/functions.php?rev=3130155#L3072) | […](/browser/post-grid/tags/2.2.91/includes/blocks/form-wrap/functions.php?rev=3146752#L3096) |  |
  | 3072 | 3096 | $response['success']['profileUpdateSuccess'] = \_\_('User profile update success', 'post-grid'); |
  | 3073 | 3097 | } else { |
  | 3074 |  | $response['errors']['profileUpdate~~Success~~'] = \_\_('User profile update failed', 'post-grid'); |
  |  | 3098 | $response['errors']['profileUpdateFailed'] = \_\_('User profile update failed', 'post-grid'); |
  | 3075 | 3099 | } |
  | 3076 | 3100 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3146752)
* [Zip Archive](?format=zip&new=3146752)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

