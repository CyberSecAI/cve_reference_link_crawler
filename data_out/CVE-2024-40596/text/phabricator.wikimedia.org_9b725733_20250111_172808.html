Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT326866)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T326866
# CVE-2024-40596: Special:Investigate can expose suppressed information for log eventsClosed, Resolved[Public](/policy/explain/PHID-TASK-tygagflxfzy74ivpeptm/view/)2 Estimated Story PointsBUG REPORTActions

* [Edit Task](/maniphest/task/edit/326866/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/326866/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-tygagflxfzy74ivpeptm/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-tygagflxfzy74ivpeptm/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Protect as security issue](/wmf/escalate-task/326866/)
* [Award Token](/token/give/PHID-TASK-tygagflxfzy74ivpeptm/)
* [Flag For Later](/flag/edit/PHID-TASK-tygagflxfzy74ivpeptm/)

Assigned To

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

Authored By

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |
| Jan 12 2023, 9:07 PM2023-01-12 21:07:53 (UTC+0) |

Tags

* [Security](/tag/security/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [CheckUser](/tag/checkuser/) [(Investigate)](/project/board/203/)
* [Trust and Safety Product Team](/tag/trust_and_safety_product_team/) [(Inbox)](/project/board/6807/)
* [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/) [(Done)](/project/board/7129/)
* [MW-1.43-notes (1.43.0-wmf.7; 2024-05-28)](/project/view/7116/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [dom\_walden](/p/dom_walden/) |
| --- | --- |

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

# Description

Splitting from [T316414](/T316414). Not setting as a security ticket as the cat is out of the bag.

Log actions stored by CheckUser that are in the logging table (and thus can be suppressed) are not hidden as CheckUser does not store the log ID so that it can look up the revision deletion status. This means that checkusers who do not have the oversight permissions can access oversighted logs.

To do this CheckUser needs to store any associated log ID. This will be done in [T324907](/T324907). Once this has been achieved this can be fixed.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Add read new support to the TimelineService](https://gerrit.wikimedia.org/r/c/1034100) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +525 -87 |
|  | [Update TimelineRowFormatter to read new for event table migration](https://gerrit.wikimedia.org/r/c/1034524) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +260 -57 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T326866)
# Related ObjectsSearch...

* Task Graph
* Mentions

[View Standalone Graph](/maniphest/graph/326866/)This task is connected to more than 200 other tasks. Only direct parents and subtasks are shown here. Use **View Standalone Graph** to show more of the graph.

|  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- |
|  |  |  |  | · · · |
|  | Resolved | BUG REPORT | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T326866 [CVE-2024-40596: Special:Investigate can expose suppressed information for log events](/T326866) |
|  | Resolved |  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T253796 [Make CheckUser record the log\_id of logged actions](/T253796) |
|  |  |  |  | · · · |

Mentioned In [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
[T361296: CVE-2024-40608: Special:Investigate exposes suppressed usernames to those who do not have the rights to see them](/T361296)
[T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659)
[T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874)
[T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626)
[T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849)
[T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337) Mentioned Here [rECHUff30d8bf465b: Merge "ipReveal.js: Link to Special:IPContributions from the revealed IP"](/rECHUff30d8bf465b14df387ba23d141168f4c3b32e64)
[T316414: CVE-2022-39193: Special:Investigate can expose supressed information in check results](/T316414)
[T324907: Create separate tables for log events in CheckUser](/T324907)
### Event Timeline

[Dreamy\_Jazz](/p/Dreamy_Jazz/) created this task.[Jan 12 2023, 9:07 PM2023-01-12 21:07:53 (UTC+0)](#8521535)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5127858/)[Jan 12 2023, 9:07 PM2023-01-12 21:07:53 (UTC+0)](#8521548)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337).[Jan 12 2023, 9:11 PM2023-01-12 21:11:02 (UTC+0)](#8521578)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [Vuln-Infoleak](/tag/vuln-infoleak/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [Anti-Harassment](/tag/anti-harassment/).[Jan 12 2023, 9:33 PM2023-01-12 21:33:09 (UTC+0)](#8521655)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a subtask: [T253796: Make CheckUser record the log\_id of logged actions](/T253796).[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Jan 17 2023, 5:14 PM2023-01-17 17:14:17 (UTC+0)](#8531689)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [CheckUser](/tag/checkuser/).[Jan 18 2023, 9:48 PM2023-01-18 21:48:32 (UTC+0)](#8538464)[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Inbox](/project/board/203/) to [Investigate](/project/board/203/) on the [CheckUser](/tag/checkuser/) board.[sbassett](/p/sbassett/) mentioned this in [T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849).[Jan 23 2023, 6:14 PM2023-01-23 18:14:51 (UTC+0)](#8550289)[sbassett](/p/sbassett/) mentioned this in [T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626).[Apr 4 2023, 7:48 PM2023-04-04 19:48:43 (UTC+0)](#8756458)[sbassett](/p/sbassett/) mentioned this in [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874).[Jul 6 2023, 3:27 PM2023-07-06 15:27:54 (UTC+0)](#8994373)[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Untriaged](/project/board/2660/) to [CheckUser](/project/board/2660/) on the [Anti-Harassment](/tag/anti-harassment/) board.[Jul 22 2023, 5:49 PM2023-07-22 17:49:46 (UTC+0)](#9036098)[sbassett](/p/sbassett/) mentioned this in [T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659).[Oct 2 2023, 10:31 PM2023-10-02 22:31:38 (UTC+0)](#9218048)[Tchanders](/p/Tchanders/) mentioned this in [T361296: CVE-2024-40608: Special:Investigate exposes suppressed usernames to those who do not have the rights to see them](/T361296).[Apr 3 2024, 3:07 PM2024-04-03 15:07:05 (UTC+0)](#9684774)[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed subtask [T253796: Make CheckUser record the log\_id of logged actions](/T253796) as Resolved.[Apr 10 2024, 1:41 PM2024-04-10 13:41:19 (UTC+0)](#9703862)[TAdeleye\_WMF](/p/TAdeleye_WMF/) edited projects, added [Trust and Safety Product Team](/tag/trust_and_safety_product_team/); removed [Anti-Harassment](/tag/anti-harassment/).[May 14 2024, 4:16 PM2024-05-14 16:16:11 (UTC+0)](#9795649) · [gerritbot](/p/gerritbot/) added a comment.[May 21 2024, 3:18 PM2024-05-21 15:18:08 (UTC+0)](#9817251)Comment Actions

Change #1034100 had a related patch set uploaded (by Dreamy Jazz; author: Dreamy Jazz):

[mediawiki/extensions/CheckUser@master] [WIP] Add read new support to Timeline mode

<https://gerrit.wikimedia.org/r/1034100>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[May 21 2024, 3:18 PM2024-05-21 15:18:09 (UTC+0)](#9817252)[gerritbot](/p/gerritbot/) added a comment.[May 21 2024, 3:46 PM2024-05-21 15:46:21 (UTC+0)](#9817455)Comment Actions

Change #1034524 had a related patch set uploaded (by Dreamy Jazz; author: Dreamy Jazz):

[mediawiki/extensions/CheckUser@master] Update TimelineRowFormatter to read new for event table migration

<https://gerrit.wikimedia.org/r/1034524>

[Dreamy\_Jazz](/p/Dreamy_Jazz/) claimed this task.[May 21 2024, 5:51 PM2024-05-21 17:51:21 (UTC+0)](#9818218)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a project: [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) set the point value for this task to 2.[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Priority Backlog](/project/board/7129/) to [In Progress](/project/board/7129/) on the [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/) board.[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [In Progress](/project/board/7129/) to [Needs Review](/project/board/7129/) on the [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/) board.[May 22 2024, 3:55 PM2024-05-22 15:55:42 (UTC+0)](#9822170)[gerritbot](/p/gerritbot/) added a comment.[May 24 2024, 1:18 PM2024-05-24 13:18:03 (UTC+0)](#9829557)Comment Actions

Change #1034524 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] Update TimelineRowFormatter to read new for event table migration

<https://gerrit.wikimedia.org/r/1034524>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.43-notes (1.43.0-wmf.7; 2024-05-28)](/project/view/7116/).[May 24 2024, 2:00 PM2024-05-24 14:00:24 (UTC+0)](#9829733)[gerritbot](/p/gerritbot/) added a comment.[May 24 2024, 2:58 PM2024-05-24 14:58:45 (UTC+0)](#9829893)Comment Actions

Change #1034100 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] Add read new support to the TimelineService

<https://gerrit.wikimedia.org/r/1034100>

[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[May 24 2024, 3:30 PM2024-05-24 15:30:53 (UTC+0)](#9830040)[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Needs Review](/project/board/7129/) to [Needs QA](/project/board/7129/) on the [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/) board.[May 28 2024, 10:21 AM2024-05-28 10:21:49 (UTC+0)](#9837071)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321).[May 28 2024, 10:27 AM2024-05-28 10:27:06 (UTC+0)](#9837110)[dom\_walden](/p/dom_walden/) moved this task from [Needs QA](/project/board/7129/) to [Done](/project/board/7129/) on the [Trust and Safety Product Sprint (Sprint Shekere (13th May - 24th May))](/project/view/7129/) board.[May 29 2024, 6:39 AM2024-05-29 06:39:47 (UTC+0)](#9840802)[dom\_walden](/p/dom_walden/) subscribed.Comment Actions

I can no longer see suppressed information for log events as a user without suppressor rights.

**Test environment:** local docker CheckUser 2.5 ([ff30d8b](/rECHUff30d8bf465b14df387ba23d141168f4c3b32e64)) 12:09, 28 May 2024.

[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed this task as Resolved.[May 29 2024, 7:02 AM2024-05-29 07:02:38 (UTC+0)](#9840832)[mmartorana](/p/mmartorana/) renamed this task from Special:Investigate can expose suppressed information for log events to CVE-2024-40596: Special:Investigate can expose suppressed information for log events.[Jul 8 2024, 5:35 PM2024-07-08 17:35:06 (UTC+0)](#9962219)[Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)