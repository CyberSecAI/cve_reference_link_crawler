=== Content from git.kernel.org_218bcdbb_20250110_172057.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=22094f5f52e7bc16c5bf9613365049383650b02e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22094f5f52e7bc16c5bf9613365049383650b02e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22094f5f52e7bc16c5bf9613365049383650b02e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22094f5f52e7bc16c5bf9613365049383650b02e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 09:01:01 +0200 |
| commit | [22094f5f52e7bc16c5bf9613365049383650b02e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22094f5f52e7bc16c5bf9613365049383650b02e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=22094f5f52e7bc16c5bf9613365049383650b02e)) | |
| tree | [adcd09b532b91554b40b398c45923762dbf5ac1b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22094f5f52e7bc16c5bf9613365049383650b02e) | |
| parent | [1c939f94571b90c485fec66cc1c9464e89ed9663](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1c939f94571b90c485fec66cc1c9464e89ed9663) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22094f5f52e7bc16c5bf9613365049383650b02e&id2=1c939f94571b90c485fec66cc1c9464e89ed9663)) | |
| download | [linux-22094f5f52e7bc16c5bf9613365049383650b02e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-22094f5f52e7bc16c5bf9613365049383650b02e.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22094f5f52e7bc16c5bf9613365049383650b02e)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=22094f5f52e7bc16c5bf9613365049383650b02e) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex 81de84318ccc71..b1c18058d55f8d 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=1c939f94571b90c485fec66cc1c9464e89ed9663)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=22094f5f52e7bc16c5bf9613365049383650b02e)@@ -67,8 +67,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:34 +0000



=== Content from git.kernel.org_501946a1_20250110_172058.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Christoph Hellwig <hch@lst.de> | 2024-07-19 07:27:28 +0200 |
| commit | [28e8b7406d3a1f5329a03aa25a43aa28e087cb20](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)) | |
| tree | [acfc4bfde9d1b3718d43f4148c0a6eb88a7e5a80](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20) | |
| parent | [b69bdba5a37eb6224039e9572e0e98fc3a931fee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b69bdba5a37eb6224039e9572e0e98fc3a931fee) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20&id2=b69bdba5a37eb6224039e9572e0e98fc3a931fee)) | |
| download | [linux-28e8b7406d3a1f5329a03aa25a43aa28e087cb20.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-28e8b7406d3a1f5329a03aa25a43aa28e087cb20.tar.gz) | |

dma: fix call order in dmam\_free\_coherentdmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex 81de84318ccc71..b1c18058d55f8d 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=b69bdba5a37eb6224039e9572e0e98fc3a931fee)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=28e8b7406d3a1f5329a03aa25a43aa28e087cb20)@@ -67,8 +67,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:35 +0000



=== Content from git.kernel.org_76b1e5e4_20250110_172100.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:32:06 +0200 |
| commit | [fe2d246080f035e0af5793cb79067ba125e4fb63](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe2d246080f035e0af5793cb79067ba125e4fb63) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)) | |
| tree | [8cc088973c0c44eb2ab83e56f3fc4014981fb70d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe2d246080f035e0af5793cb79067ba125e4fb63) | |
| parent | [55b732c8b09b41148eaab2fa8e31b0af47671e00](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55b732c8b09b41148eaab2fa8e31b0af47671e00) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe2d246080f035e0af5793cb79067ba125e4fb63&id2=55b732c8b09b41148eaab2fa8e31b0af47671e00)) | |
| download | [linux-fe2d246080f035e0af5793cb79067ba125e4fb63.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fe2d246080f035e0af5793cb79067ba125e4fb63.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe2d246080f035e0af5793cb79067ba125e4fb63)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=fe2d246080f035e0af5793cb79067ba125e4fb63) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex d2a92ddaac4d14..34edceed643d36 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=55b732c8b09b41148eaab2fa8e31b0af47671e00)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=fe2d246080f035e0af5793cb79067ba125e4fb63)@@ -97,8 +97,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:38 +0000



=== Content from git.kernel.org_b29d206e_20250110_172057.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:41:04 +0200 |
| commit | [257193083e8f43907e99ea633820fc2b3bcd24c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=257193083e8f43907e99ea633820fc2b3bcd24c7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)) | |
| tree | [d7112f40590bb7ee1666136f22f8f47f6c24fe4c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=257193083e8f43907e99ea633820fc2b3bcd24c7) | |
| parent | [641b7a8920f44967184921ce5707eb180ee2cfdf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=641b7a8920f44967184921ce5707eb180ee2cfdf) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=257193083e8f43907e99ea633820fc2b3bcd24c7&id2=641b7a8920f44967184921ce5707eb180ee2cfdf)) | |
| download | [linux-257193083e8f43907e99ea633820fc2b3bcd24c7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-257193083e8f43907e99ea633820fc2b3bcd24c7.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=257193083e8f43907e99ea633820fc2b3bcd24c7)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=257193083e8f43907e99ea633820fc2b3bcd24c7) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex 51bb8fa8eb8948..453c0fbe87ff4a 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=641b7a8920f44967184921ce5707eb180ee2cfdf)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=257193083e8f43907e99ea633820fc2b3bcd24c7)@@ -60,8 +60,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:35 +0000



=== Content from git.kernel.org_c41f3cc5_20250110_172059.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87b34c8c94e29fa01d744e5147697f592998d954)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87b34c8c94e29fa01d744e5147697f592998d954)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87b34c8c94e29fa01d744e5147697f592998d954)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87b34c8c94e29fa01d744e5147697f592998d954)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:45:23 +0200 |
| commit | [87b34c8c94e29fa01d744e5147697f592998d954](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87b34c8c94e29fa01d744e5147697f592998d954) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87b34c8c94e29fa01d744e5147697f592998d954)) | |
| tree | [17fa026d8e6d8a24f99cced4b0117bc996ed768c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87b34c8c94e29fa01d744e5147697f592998d954) | |
| parent | [ca667c3c90ea82bff9cd2b345daa120ad62c55a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ca667c3c90ea82bff9cd2b345daa120ad62c55a6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87b34c8c94e29fa01d744e5147697f592998d954&id2=ca667c3c90ea82bff9cd2b345daa120ad62c55a6)) | |
| download | [linux-87b34c8c94e29fa01d744e5147697f592998d954.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87b34c8c94e29fa01d744e5147697f592998d954.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87b34c8c94e29fa01d744e5147697f592998d954)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=87b34c8c94e29fa01d744e5147697f592998d954) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex c9dbc8f5812b83..9e1a724ae7e7da 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=ca667c3c90ea82bff9cd2b345daa120ad62c55a6)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=87b34c8c94e29fa01d744e5147697f592998d954)@@ -62,8 +62,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:36 +0000



=== Content from git.kernel.org_237e9e9c_20250110_172056.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:54:36 +0200 |
| commit | [1fe97f68fce1ba24bf823bfb0eb0956003473130](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)) | |
| tree | [a5774aac906c72c7ffab736bc29f5c3756b0f7f8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130) | |
| parent | [772f9c31bfde0df64970f17b5995ca02565eb095](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=772f9c31bfde0df64970f17b5995ca02565eb095) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130&id2=772f9c31bfde0df64970f17b5995ca02565eb095)) | |
| download | [linux-1fe97f68fce1ba24bf823bfb0eb0956003473130.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1fe97f68fce1ba24bf823bfb0eb0956003473130.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=1fe97f68fce1ba24bf823bfb0eb0956003473130) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex e323ca48f7f2a4..f1d9f01b283d7d 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=772f9c31bfde0df64970f17b5995ca02565eb095)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=1fe97f68fce1ba24bf823bfb0eb0956003473130)@@ -67,8 +67,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:34 +0000



=== Content from git.kernel.org_1a98ec30_20250110_172100.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:49:49 +0200 |
| commit | [f993a4baf6b622232e4c190d34c220179e5d61eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f993a4baf6b622232e4c190d34c220179e5d61eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)) | |
| tree | [dfa6315b6ca76d5401e7cbc39a8ffffe575226cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f993a4baf6b622232e4c190d34c220179e5d61eb) | |
| parent | [ec7251fa8c9a0904fd131a0df905657df6cc4e9c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ec7251fa8c9a0904fd131a0df905657df6cc4e9c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f993a4baf6b622232e4c190d34c220179e5d61eb&id2=ec7251fa8c9a0904fd131a0df905657df6cc4e9c)) | |
| download | [linux-f993a4baf6b622232e4c190d34c220179e5d61eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f993a4baf6b622232e4c190d34c220179e5d61eb.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f993a4baf6b622232e4c190d34c220179e5d61eb)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=f993a4baf6b622232e4c190d34c220179e5d61eb) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex 33437d62064458..f1051ad0da7cc3 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=ec7251fa8c9a0904fd131a0df905657df6cc4e9c)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=f993a4baf6b622232e4c190d34c220179e5d61eb)@@ -63,8 +63,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:37 +0000



=== Content from git.kernel.org_2d898ff2_20250110_172059.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lance Richardson <rlance@google.com> | 2024-07-18 14:38:24 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:33:41 +0200 |
| commit | [2f7bbdc744f2e7051d1cb47c8e082162df1923c9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)) | |
| tree | [717720efea1748451be771102dcb2acbf8fe243c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9) | |
| parent | [6a8a0da4d84a4018c210c043d4331945a524ba29](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6a8a0da4d84a4018c210c043d4331945a524ba29) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9&id2=6a8a0da4d84a4018c210c043d4331945a524ba29)) | |
| download | [linux-2f7bbdc744f2e7051d1cb47c8e082162df1923c9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2f7bbdc744f2e7051d1cb47c8e082162df1923c9.tar.gz) | |

dma: fix call order in dmam\_free\_coherent[ Upstream commit 28e8b7406d3a1f5329a03aa25a43aa28e087cb20 ]
dmam\_free\_coherent() frees a DMA allocation, which makes the
freed vaddr available for reuse, then calls devres\_destroy()
to remove and free the data structure used to track the DMA
allocation. Between the two calls, it is possible for a
concurrent task to make an allocation with the same vaddr
and add it to the devres list.
If this happens, there will be two entries in the devres list
with the same vaddr and devres\_destroy() can free the wrong
entry, triggering the WARN\_ON() in dmam\_match.
Fix by destroying the devres entry before freeing the DMA
allocation.
Tested:
kokonut //net/encryption
http://sponge2/b9145fe6-0f72-4325-ac2f-a84d81075b03
Fixes: 9ac7849e35f7 ("devres: device resource management")
Signed-off-by: Lance Richardson <rlance@google.com>
Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)

| -rw-r--r-- | [kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/dma/mapping.c?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/kernel/dma/mapping.c b/kernel/dma/mapping.cindex 8682a5305cb368..942e489bc1fcbf 100644--- a/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=6a8a0da4d84a4018c210c043d4331945a524ba29)+++ b/[kernel/dma/mapping.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/dma/mapping.c?id=2f7bbdc744f2e7051d1cb47c8e082162df1923c9)@@ -59,8 +59,8 @@ void dmam\_free\_coherent(struct device \*dev, size\_t size, void \*vaddr, { struct dma\_devres match\_data = { size, vaddr, dma\_handle }; - dma\_free\_coherent(dev, size, vaddr, dma\_handle); WARN\_ON(devres\_destroy(dev, dmam\_release, dmam\_match, &match\_data));+ dma\_free\_coherent(dev, size, vaddr, dma\_handle); } EXPORT\_SYMBOL(dmam\_free\_coherent); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:19:36 +0000


