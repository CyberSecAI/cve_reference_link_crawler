=== Content from github.com_0dd01bee_20250111_045715.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fsecurity%2Fadvisories%2FGHSA-2vgg-9h6w-m454)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fsecurity%2Fadvisories%2FGHSA-2vgg-9h6w-m454)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.4k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  477](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

# Bypassing Rate Limit and Brute Force Protection Using Cache Overflow

Moderate

[crenshaw-dev](/crenshaw-dev)
published
GHSA-2vgg-9h6w-m454
Mar 18, 2024

## Package

gomod

github.com/argoproj/argo-cd
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<=2.8.4

## Patched versions

2.10.4, 2.9.9, 2.8.13

## Description

### Summary

An attacker can effectively bypass the rate limit and brute force protections by exploiting the application's weak cache-based mechanism. This loophole in security can be combined with other vulnerabilities to attack the default admin account. This flaw undermines a previously [patched CVE](https://argo-cd.readthedocs.io/en/stable/security_considerations/#cve-2020-8827-insufficient-anti-automationanti-brute-force) intended to protect against brute-force attacks.

### Details

The application's brute force protection relies on a cache mechanism that tracks login attempts for each user. This cache is limited to a `defaultMaxCacheSize` of 1000 entries. An attacker can overflow this cache by bombarding it with login attempts for different users, thereby pushing out the admin account's failed attempts and effectively resetting the rate limit for that account.

The brute force protection mechanism's code:

```
   if failed && len(failures) >= getMaximumCacheSize() {
       log.Warnf("Session cache size exceeds %d entries, removing random entry",

getMaximumCacheSize())
       idx := rand.Intn(len(failures) - 1)
       var rmUser string
       i := 0
       for key := range failures {

           if i == idx {
               rmUser = key

               delete(failures, key)

break

}

i++ }

       log.Infof("Deleted entry for user %s from cache", rmUser)
   }
```
### PoC

1. Set up the application environment and identify the login page.
2. Execute 4 failed login attempts for the admin account.
3. Run a Burp Intruder attack to populate the cache with login attempts for usernames ranging from 1 to 10000.
4. After 1000 attempts, start monitoring to see if the admin entries in the cache have been cleared.
5. At this point, brute-force the admin account.

In just 15 minutes, the PoC was able to perform 230 brute force attempts on the admin account. This rate allows for approximately 1000 requests per hour, effectively rendering the [older CVE](https://argo-cd.readthedocs.io/en/stable/security_considerations/#cve-2020-8827-insufficient-anti-automationanti-brute-force) rate limit patches useless.

### Impact

This is a severe vulnerability that enables attackers to perform brute force attacks at an accelerated rate, especially targeting the default admin account.

### Severity

Moderate

5.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:L/A:N

### CVE ID

CVE-2024-21662

### Weaknesses

No CWEs

### Credits

* [![@nadava669](https://avatars.githubusercontent.com/u/130667825?s=40&v=4)](/nadava669)
  [nadava669](/nadava669)
  Reporter
* [![@pasha-codefresh](https://avatars.githubusercontent.com/u/39732895?s=40&v=4)](/pasha-codefresh)
  [pasha-codefresh](/pasha-codefresh)
  Remediation developer
* [![@crenshaw-dev](https://avatars.githubusercontent.com/u/350466?s=40&v=4)](/crenshaw-dev)
  [crenshaw-dev](/crenshaw-dev)
  Remediation reviewer
* [![@todaywasawesome](https://avatars.githubusercontent.com/u/3849900?s=40&v=4)](/todaywasawesome)
  [todaywasawesome](/todaywasawesome)
  Coordinator
* [![@jannfis](https://avatars.githubusercontent.com/u/3942683?s=40&v=4)](/jannfis)
  [jannfis](/jannfis)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2c796cd5_20250111_045714.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F6e181d72b31522f886a2afa029d5b26d7912ec7b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F6e181d72b31522f886a2afa029d5b26d7912ec7b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.4k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  477](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

## Commit

[Permalink](/argoproj/argo-cd/commit/6e181d72b31522f886a2afa029d5b26d7912ec7b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-2vgg-9h6w-m454](https://github.com/advisories/GHSA-2vgg-9h6w-m454 "GHSA-2vgg-9h6w-m454")

[Browse files](/argoproj/argo-cd/tree/6e181d72b31522f886a2afa029d5b26d7912ec7b)
Browse the repository at this point in the history

```
* feat: pick random user and exclude admin user and current user from deletion candidates

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* feat: increase default max cache size

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* add nil protection

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* Update util/session/sessionmanager.go

Signed-off-by: Dan Garfield <dan@codefresh.io>

Signed-off-by: Dan Garfield <dan@codefresh.io>

* chore: fix linter issues

Signed-off-by: pashakostohrys <pavel@codefresh.io>

---------

Signed-off-by: pashakostohrys <pavel@codefresh.io>
Signed-off-by: Dan Garfield <dan@codefresh.io>
Co-authored-by: Dan Garfield <dan@codefresh.io>
```

* Loading branch information

[![@pasha-codefresh](https://avatars.githubusercontent.com/u/39732895?s=40&v=4)](/pasha-codefresh) [![@todaywasawesome](https://avatars.githubusercontent.com/u/3849900?s=40&v=4)](/todaywasawesome)

[pasha-codefresh](/argoproj/argo-cd/commits?author=pasha-codefresh "View all commits by pasha-codefresh")
and
[todaywasawesome](/argoproj/argo-cd/commits?author=todaywasawesome "View all commits by todaywasawesome")
authored
Mar 18, 2024

1 parent
[c415d3f](/argoproj/argo-cd/commit/c415d3f3d5b8c1873fa8117d21e5262f109586fb)

commit 6e181d7

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**60 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* util/session

  + util/session/sessionmanager.go
    [sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656)
  + util/session/sessionmanager\_test.go
    [sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d)

## There are no files selected for viewing

36 changes: 21 additions & 15 deletions

36
[util/session/sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656 "util/session/sessionmanager.go")

Show comments

[View file](/argoproj/argo-cd/blob/6e181d72b31522f886a2afa029d5b26d7912ec7b/util/session/sessionmanager.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,7 +69,7 @@ const ( |
|  |  | // Maximum length of username, too keep the cache's memory signature low |
|  |  | maxUsernameLength = 32 |
|  |  | // The default maximum session cache size |
|  |  | defaultMaxCacheSize = 1000 |
|  |  | defaultMaxCacheSize = 10000 |
|  |  | // The default number of maximum login failures before delay kicks in |
|  |  | defaultMaxLoginFailures = 5 |
|  |  | // The default time in seconds for the failure window |
| Expand Down  Expand Up | | @@ -310,6 +310,22 @@ func expireOldFailedAttempts(maxAge time.Duration, failures \*map[string]LoginAtt |
|  |  | return expiredCount |
|  |  | } |
|  |  |  |
|  |  | // Protect admin user from login attempt reset caused by attempts to overflow cache in a brute force attack. Instead remove random non-admin to make room in cache. |
|  |  | func pickRandomNonAdminLoginFailure(failures map[string]LoginAttempts, username string) \*string { |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | if key == common.ArgoCDAdminUsername || key == username { |
|  |  | return pickRandomNonAdminLoginFailure(failures, username) |
|  |  | } |
|  |  | return &key |
|  |  | } |
|  |  | i++ |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // Updates the failure count for a given username. If failed is true, increases the counter. Otherwise, sets counter back to 0. |
|  |  | func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  |  |
| Expand All | | @@ -327,23 +343,13 @@ func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  | // prevent overbloating the cache with fake entries, as this could lead to |
|  |  | // memory exhaustion and ultimately in a DoS. We remove a single entry to |
|  |  | // replace it with the new one. |
|  |  | // |
|  |  | // Chances are that we remove the one that is under active attack, but this |
|  |  | // chance is low (1:cache\_size) |
|  |  | if failed && len(failures) >= getMaximumCacheSize() { |
|  |  | log.Warnf("Session cache size exceeds %d entries, removing random entry", getMaximumCacheSize()) |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | var rmUser string |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | rmUser = key |
|  |  | delete(failures, key) |
|  |  | break |
|  |  | } |
|  |  | i++ |
|  |  | rmUser := pickRandomNonAdminLoginFailure(failures, username) |
|  |  | if rmUser != nil { |
|  |  | delete(failures, \*rmUser) |
|  |  | log.Infof("Deleted entry for user %s from cache", \*rmUser) |
|  |  | } |
|  |  | log.Infof("Deleted entry for user %s from cache", rmUser) |
|  |  | } |
|  |  |  |
|  |  | attempt, ok := failures[username] |
| Expand Down | |  |

39 changes: 39 additions & 0 deletions

39
[util/session/sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d "util/session/sessionmanager_test.go")

Show comments

[View file](/argoproj/argo-cd/blob/6e181d72b31522f886a2afa029d5b26d7912ec7b/util/session/sessionmanager_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1173,3 +1173,42 @@ requestedScopes: ["oidc"]`, oidcTestServer.URL), |
|  |  | assert.ErrorIs(t, err, common.TokenVerificationErr) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func Test\_PickFailureAttemptWhenOverflowed(t \*testing.T) { |
|  |  | t.Run("Not pick admin user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  |  |
|  |  | t.Run("Not pick admin user and current user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "test": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6e181d7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F6e181d72b31522f886a2afa029d5b26d7912ec7b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from argo-cd.readthedocs.io_9a75e2ac_20250111_045712.html ===


[Skip to content](#security-considerations)

[![logo](../assets/logo.png)](.. "Argo CD - Declarative GitOps CD for Kubernetes")

Argo CD - Declarative GitOps CD for Kubernetes

Security Considerations

Initializing search

[GitHub](https://github.com/argoproj/argo-cd "Go to repository")

[![logo](../assets/logo.png)](.. "Argo CD - Declarative GitOps CD for Kubernetes")
Argo CD - Declarative GitOps CD for Kubernetes

[GitHub](https://github.com/argoproj/argo-cd "Go to repository")

* [Overview](..)
* [Understand The Basics](../understand_the_basics/)
* [Core Concepts](../core_concepts/)
* [Getting Started](../getting_started/)
* Operator Manual

  Operator Manual
  + [Overview](../operator-manual/)
  + [Architectural Overview](../operator-manual/architecture/)
  + [Installation](../operator-manual/installation/)
  + [Argo CD Core](../operator-manual/core/)
  + [Declarative Setup](../operator-manual/declarative-setup/)
  + [Applications in any namespace](../operator-manual/app-any-namespace/)
  + [Ingress Configuration](../operator-manual/ingress/)
  + High Availability

    High Availability
    - [Overview](../operator-manual/high_availability/)
    - [Dynamic Cluster Distribution](../operator-manual/dynamic-cluster-distribution/)
  + User Management

    User Management
    - [Overview](../operator-manual/user-management/)
    - [Auth0](../operator-manual/user-management/auth0/)
    - [Microsoft](../operator-manual/user-management/microsoft/)
    - [Okta](../operator-manual/user-management/okta/)
    - [OneLogin](../operator-manual/user-management/onelogin/)
    - [Keycloak](../operator-manual/user-management/keycloak/)
    - [OpenUnison](../operator-manual/user-management/openunison/)
    - [Google](../operator-manual/user-management/google/)
    - [Zitadel](../operator-manual/user-management/zitadel/)
    - [Identity Center (AWS SSO)](../operator-manual/user-management/identity-center/)
    - [RBAC Configuration](../operator-manual/rbac/)
  + Security

    Security
    - [Overview](../operator-manual/security/)
    - [Snyk Scans](../snyk/)
    - [Verification of Argo CD Artifacts](../operator-manual/signed-release-assets/)
  + [TLS configuration](../operator-manual/tls/)
  + [Cluster Bootstrapping](../operator-manual/cluster-bootstrapping/)
  + [Secret Management](../operator-manual/secret-management/)
  + [Disaster Recovery](../operator-manual/disaster_recovery/)
  + [Reconcile Optimization](../operator-manual/reconcile/)
  + [Git Webhook Configuration](../operator-manual/webhook/)
  + [Resource Health](../operator-manual/health/)
  + [Resource Actions](../operator-manual/resource_actions/)
  + [Custom Tooling](../operator-manual/custom_tools/)
  + [Custom Styles](../operator-manual/custom-styles/)
  + [UI Customization](../operator-manual/ui-customization/)
  + [Metrics](../operator-manual/metrics/)
  + [Web-based Terminal](../operator-manual/web_based_terminal/)
  + [Config Management Plugins](../operator-manual/config-management-plugins/)
  + [Deep Links](../operator-manual/deep_links/)
  + Notifications

    Notifications
    - [Overview](../operator-manual/notifications/)
    - [Triggers](../operator-manual/notifications/triggers/)
    - [Templates](../operator-manual/notifications/templates/)
    - [Functions](../operator-manual/notifications/functions/)
    - [Triggers and Templates Catalog](../operator-manual/notifications/catalog/)
    - [Monitoring](../operator-manual/notifications/monitoring/)
    - [Subscriptions](../operator-manual/notifications/subscriptions/)
    - [Troubleshooting](../operator-manual/notifications/troubleshooting/)
    - [Troubleshooting commands](../operator-manual/notifications/troubleshooting-commands/)
    - [Troubleshooting errors](../operator-manual/notifications/troubleshooting-errors/)
    - Notification Services

      Notification Services
      * [Alertmanager](../operator-manual/notifications/services/alertmanager/)
      * [AWS SQS](../operator-manual/notifications/services/awssqs/)
      * [Email](../operator-manual/notifications/services/email/)
      * [GitHub](../operator-manual/notifications/services/github/)
      * [Google Chat](../operator-manual/notifications/services/googlechat/)
      * [Grafana](../operator-manual/notifications/services/grafana/)
      * [Mattermost](../operator-manual/notifications/services/mattermost/)
      * [NewRelic](../operator-manual/notifications/services/newrelic/)
      * [Opsgenie](../operator-manual/notifications/services/opsgenie/)
      * [Overview](../operator-manual/notifications/services/overview/)
      * [PagerDuty](../operator-manual/notifications/services/pagerduty/)
      * [PagerDuty V2](../operator-manual/notifications/services/pagerduty_v2/)
      * [Pushover](../operator-manual/notifications/services/pushover/)
      * [Rocket.Chat](../operator-manual/notifications/services/rocketchat/)
      * [Slack](../operator-manual/notifications/services/slack/)
      * [Teams](../operator-manual/notifications/services/teams/)
      * [Telegram](../operator-manual/notifications/services/telegram/)
      * [Webex Teams](../operator-manual/notifications/services/webex/)
      * [Webhook](../operator-manual/notifications/services/webhook/)
  + [Troubleshooting Tools](../operator-manual/troubleshooting/)
  + ApplicationSet

    ApplicationSet
    - [Introduction](../operator-manual/applicationset/)
    - [Installations](../operator-manual/applicationset/Getting-Started/)
    - [Use Cases](../operator-manual/applicationset/Use-Cases/)
    - [Security](../operator-manual/applicationset/Security/)
    - [How ApplicationSet controller interacts with Argo CD](../operator-manual/applicationset/Argo-CD-Integration/)
    - Generators

      Generators
      * [Generators](../operator-manual/applicationset/Generators/)
      * [List Generator](../operator-manual/applicationset/Generators-List/)
      * [Cluster Generator](../operator-manual/applicationset/Generators-Cluster/)
      * [Git Generator](../operator-manual/applicationset/Generators-Git/)
      * [Matrix Generator](../operator-manual/applicationset/Generators-Matrix/)
      * [Merge Generator](../operator-manual/applicationset/Generators-Merge/)
      * [SCM Provider Generator](../operator-manual/applicationset/Generators-SCM-Provider/)
      * [Cluster Decision Resource Generator](../operator-manual/applicationset/Generators-Cluster-Decision-Resource/)
      * [Pull Request Generator](../operator-manual/applicationset/Generators-Pull-Request/)
      * [Post Selector all generators](../operator-manual/applicationset/Generators-Post-Selector/)
      * [Plugin Generator](../operator-manual/applicationset/Generators-Plugin/)
    - Template fields

      Template fields
      * [Templates](../operator-manual/applicationset/Template/)
      * [Go Template](../operator-manual/applicationset/GoTemplate/)
    - [Controlling Resource Modification](../operator-manual/applicationset/Controlling-Resource-Modification/)
    - [Application Pruning & Resource Deletion](../operator-manual/applicationset/Application-Deletion/)
    - [Progressive Syncs](../operator-manual/applicationset/Progressive-Syncs/)
    - [Git File Generator Globbing](../operator-manual/applicationset/Generators-Git-File-Globbing/)
    - [ApplicationSet Specification Reference](../operator-manual/applicationset/applicationset-specification/)
    - [ApplicationSet in any namespace](../operator-manual/applicationset/Appset-Any-Namespace/)
  + Server Configuration Parameters

    Server Configuration Parameters
    - [`argocd-server` Command Reference](../operator-manual/server-commands/argocd-server/)
    - [`argocd-application-controller` Command Reference](../operator-manual/server-commands/argocd-application-controller/)
    - [`argocd-repo-server` Command Reference](../operator-manual/server-commands/argocd-repo-server/)
    - [`argocd-dex` Command Reference](../operator-manual/server-commands/argocd-dex/)
    - [Additional configuration method](../operator-manual/server-commands/additional-configuration-method/)
  + Upgrading

    Upgrading
    - [Overview](../operator-manual/upgrading/overview/)
    - [v2.12 to 2.13](../operator-manual/upgrading/2.12-2.13/)
    - [v2.11 to 2.12](../operator-manual/upgrading/2.11-2.12/)
    - [v2.10 to 2.11](../operator-manual/upgrading/2.10-2.11/)
    - [v2.9 to 2.10](../operator-manual/upgrading/2.9-2.10/)
    - [v2.8 to 2.9](../operator-manual/upgrading/2.8-2.9/)
    - [v2.7 to 2.8](../operator-manual/upgrading/2.7-2.8/)
    - [v2.6 to 2.7](../operator-manual/upgrading/2.6-2.7/)
    - [v2.5 to 2.6](../operator-manual/upgrading/2.5-2.6/)
    - [v2.4 to 2.5](../operator-manual/upgrading/2.4-2.5/)
    - [v2.3 to 2.4](../operator-manual/upgrading/2.3-2.4/)
    - [v2.2 to 2.3](../operator-manual/upgrading/2.2-2.3/)
    - [v2.1 to 2.2](../operator-manual/upgrading/2.1-2.2/)
    - [v2.0 to 2.1](../operator-manual/upgrading/2.0-2.1/)
    - [v1.8 to 2.0](../operator-manual/upgrading/1.8-2.0/)
    - [v1.7 to 1.8](../operator-manual/upgrading/1.7-1.8/)
    - [v1.6 to 1.7](../operator-manual/upgrading/1.6-1.7/)
    - [v1.5 to 1.6](../operator-manual/upgrading/1.5-1.6/)
    - [v1.4 to 1.5](../operator-manual/upgrading/1.4-1.5/)
    - [v1.3 to 1.4](../operator-manual/upgrading/1.3-1.4/)
    - [v1.2 to 1.3](../operator-manual/upgrading/1.2-1.3/)
    - [v1.1 to 1.2](../operator-manual/upgrading/1.1-1.2/)
    - [v1.0 to 1.1](../operator-manual/upgrading/1.0-1.1/)
  + [Project Specification Reference](../operator-manual/project-specification/)
* User Guide

  User Guide
  + [Overview](../user-guide/)
  + [Tools](../user-guide/application_sources/)
  + [Kustomize](../user-guide/kustomize/)
  + [Helm](../user-guide/helm/)
  + [Importing Argo CD go packages](../user-guide/import/)
  + [Jsonnet](../user-guide/jsonnet/)
  + [Directory](../user-guide/directory/)
  + [Tool Detection](../user-guide/tool_detection/)
  + [Projects](../user-guide/projects/)
  + [Private Repositories](../user-guide/private-repositories/)
  + [Multiple Sources for an Application](../user-guide/multiple_sources/)
  + [GnuPG verification](../user-guide/gpg-verification/)
  + [Automated Sync Policy](../user-guide/auto_sync/)
  + Diffing

    Diffing
    - [Diff Strategies](../user-guide/diff-strategies/)
    - [Diff Customization](../user-guide/diffing/)
  + [Orphaned Resources Monitoring](../user-guide/orphaned-resources/)
  + [Compare Options](../user-guide/compare-options/)
  + [Sync Options](../user-guide/sync-options/)
  + [Parameter Overrides](../user-guide/parameters/)
  + [Environment Variables](../user-guide/environment-variables/)
  + [Build Environment](../user-guide/build-environment/)
  + [Tracking and Deployment Strategies](../user-guide/tracking_strategies/)
  + [Resource Tracking](../user-guide/resource_tracking/)
  + [Resource Hooks](../user-guide/resource_hooks/)
  + [Selective Sync](../user-guide/selective_sync/)
  + [Sync Phases and Waves](../user-guide/sync-waves/)
  + [Sync Windows](../user-guide/sync_windows/)
  + [Sync Applications with Kubectl](../user-guide/sync-kubectl/)
  + [Skip Application Reconcile](../user-guide/skip_reconcile/)
  + [Generating Applications with ApplicationSet](../user-guide/application-set/)
  + [Automation from CI Pipelines](../user-guide/ci_automation/)
  + [App Deletion](../user-guide/app_deletion/)
  + [Best Practices](../user-guide/best_practices/)
  + [Status Badge](../user-guide/status-badge/)
  + [Add external URL](../user-guide/external-url/)
  + [Add extra Application info](../user-guide/extra_info/)
  + [Notification subscriptions](../user-guide/subscriptions/)
  + [Annotations and Labels used by Argo CD](../user-guide/annotations-and-labels/)
  + [Command Reference](../user-guide/commands/argocd/)
  + [Application Specification Reference](../user-guide/application-specification/)
* Developer Guide

  Developer Guide
  + [Overview](../developer-guide/)
  + Architecture

    Architecture
    - [Authentication and Authorization](../developer-guide/architecture/authz-authn/)
    - [Component Architecture](../developer-guide/architecture/components/)
  + [Code Contribution Guide](../developer-guide/code-contributions/)
  + [Toolchain Guide](../developer-guide/toolchain-guide/)
  + [Contributors Quick-Start](../developer-guide/contributors-quickstart/)
  + [Release Process And Cadence](../developer-guide/release-process-and-cadence/)
  + [Running Argo CD locally](../developer-guide/running-locally/)
  + [Debugging a Remote ArgoCD Environment](../developer-guide/debugging-remote-environment/)
  + [Use Gitpod](../developer-guide/use-gitpod/)
  + [API Docs](../developer-guide/api-docs/)
  + [E2E Tests](../developer-guide/test-e2e/)
  + [Managing Dependencies](../developer-guide/dependencies/)
  + [Continuous Integration (CI)](../developer-guide/ci/)
  + [Releasing](../developer-guide/releasing/)
  + [Documentation Site](../developer-guide/docs-site/)
  + [Static Code Analysis](../developer-guide/static-code-analysis/)
  + Extensions

    Extensions
    - [UI Extensions](../developer-guide/extensions/ui-extensions/)
    - [Proxy Extensions](../developer-guide/extensions/proxy-extensions/)
  + [Contribution FAQ](../developer-guide/faq/)
* [FAQ](../faq/)
* Security Considerations

  [Security Considerations](./)

  Table of contents
  + [Overview of past and current issues](#overview-of-past-and-current-issues)
  + [Known Issues And Workarounds](#known-issues-and-workarounds)
    - [CVE-2020-1747, CVE-2020-14343 - PyYAML library susceptible to arbitrary code execution](#cve-2020-1747-cve-2020-14343-pyyaml-library-susceptible-to-arbitrary-code-execution)
    - [CVE-2020-5260 - Possible Git credential leak](#cve-2020-5260-possible-git-credential-leak)
    - [CVE-2020-11576 - User Enumeration](#cve-2020-11576-user-enumeration)
    - [CVE-2020-8828 - Insecure default administrative password](#cve-2020-8828-insecure-default-administrative-password)
    - [CVE-2020-8827 - Insufficient anti-automation/anti-brute force](#cve-2020-8827-insufficient-anti-automationanti-brute-force)
    - [CVE-2020-8826 - Session-fixation](#cve-2020-8826-session-fixation)
    - [CVE-2018-21034 - Sensitive Information Disclosure](#cve-2018-21034-sensitive-information-disclosure)
  + [Reporting Vulnerabilities](#reporting-vulnerabilities)
* [Support](../SUPPORT/)
* [Roadmap](../roadmap/)
* [Releases ⧉](https://github.com/argoproj/argo-cd/releases)
* [Blog ⧉](https://blog.argoproj.io/)

Table of contents

* [Overview of past and current issues](#overview-of-past-and-current-issues)
* [Known Issues And Workarounds](#known-issues-and-workarounds)
  + [CVE-2020-1747, CVE-2020-14343 - PyYAML library susceptible to arbitrary code execution](#cve-2020-1747-cve-2020-14343-pyyaml-library-susceptible-to-arbitrary-code-execution)
  + [CVE-2020-5260 - Possible Git credential leak](#cve-2020-5260-possible-git-credential-leak)
  + [CVE-2020-11576 - User Enumeration](#cve-2020-11576-user-enumeration)
  + [CVE-2020-8828 - Insecure default administrative password](#cve-2020-8828-insecure-default-administrative-password)
  + [CVE-2020-8827 - Insufficient anti-automation/anti-brute force](#cve-2020-8827-insufficient-anti-automationanti-brute-force)
  + [CVE-2020-8826 - Session-fixation](#cve-2020-8826-session-fixation)
  + [CVE-2018-21034 - Sensitive Information Disclosure](#cve-2018-21034-sensitive-information-disclosure)
* [Reporting Vulnerabilities](#reporting-vulnerabilities)

# Security Considerations[¶](#security-considerations "Permanent link")

Deprecation notice

This page is now deprecated and serves as an archive only. For up-to-date
information, please have a look at our
[security policy](https://github.com/argoproj/argo-cd/security/policy) and
[published security advisories](https://github.com/argoproj/argo-cd/security/advisories).

As a deployment tool, Argo CD needs to have production access which makes security a very important topic.
The Argoproj team takes security very seriously and continuously working on improving it. Learn more about security
related features in [Security](../operator-manual/security/) section.

## Overview of past and current issues[¶](#overview-of-past-and-current-issues "Permanent link")

The following table gives a general overview about past and present issues known
to the Argo CD project. See in the [Known Issues](#known-issues-and-workarounds)
section if there is a work-around available if you cannot update or if there is
no fix yet.

| Date | CVE | Title | Risk | Affected version(s) | Fix version |
| --- | --- | --- | --- | --- | --- |
| 2020-06-16 | [CVE-2020-1747](https://nvd.nist.gov/vuln/detail/CVE-2020-1747) | PyYAML library susceptible to arbitrary code execution | High | all | v1.5.8 |
| 2020-06-16 | [CVE-2020-14343](https://nvd.nist.gov/vuln/detail/CVE-2020-14343) | PyYAML library susceptible to arbitrary code execution | High | all | v1.5.8 |
| 2020-04-14 | [CVE-2020-5260](https://nvd.nist.gov/vuln/detail/CVE-2020-5260) | Possible Git credential leak | High | all | v1.4.3,v1.5.2 |
| 2020-04-08 | [CVE-2020-11576](https://nvd.nist.gov/vuln/detail/CVE-2020-11576) | User Enumeration | Medium | v1.5.0 | v1.5.1 |
| 2020-04-08 | [CVE-2020-8826](https://nvd.nist.gov/vuln/detail/CVE-2020-8826) | Session-fixation | High | all | n/a |
| 2020-04-08 | [CVE-2020-8827](https://nvd.nist.gov/vuln/detail/CVE-2020-8827) | Insufficient anti-automation/anti-brute force | High | all <= 1.5.3 | v1.5.3 |
| 2020-04-08 | [CVE-2020-8828](https://nvd.nist.gov/vuln/detail/CVE-2020-8828) | Insecure default administrative password | High | all <= 1.8.0 | 1.8.0 |
| 2020-04-08 | [CVE-2018-21034](https://nvd.nist.gov/vuln/detail/CVE-2018-21034) | Sensitive Information Disclosure | Medium | all <= v1.5.0 | v1.5.0 |

## Known Issues And Workarounds[¶](#known-issues-and-workarounds "Permanent link")

A recent security audit (thanks a lot to [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> )
has revealed several limitations in Argo CD which could compromise security.
Most of the issues are related to the built-in user management implementation.

### CVE-2020-1747, CVE-2020-14343 - PyYAML library susceptible to arbitrary code execution[¶](#cve-2020-1747-cve-2020-14343-pyyaml-library-susceptible-to-arbitrary-code-execution "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| High | [infa-kparida](https://github.com/infa-kparida) | v1.5.8 | No |

**Details:**

PyYAML library susceptible to arbitrary code execution when it processes untrusted YAML files.
We do not believe Argo CD is affected by this vulnerability, because the impact of CVE-2020-1747 and CVE-2020-14343 is limited to usage of awscli.
The `awscli` only used for AWS IAM authentication, and the endpoint is the AWS API.

### CVE-2020-5260 - Possible Git credential leak[¶](#cve-2020-5260-possible-git-credential-leak "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| Critical | Felix Wilhelm of Google Project Zero | v1.4.3,v1.5.2 | Yes |

**Details:**

Argo CD relies on Git for many of its operations. The Git project released a
[security advisory](https://github.com/git/git/security/advisories/GHSA-qm7j-c969-7j4q)
on 2020-04-14, describing a serious vulnerability in Git which can lead to credential
leakage through credential helpers by feeding malicious URLs to the `git clone`
operation.

We do not believe Argo CD is affected by this vulnerability, because ArgoCD does neither
make use of Git credential helpers nor does it use `git clone` for repository operations.
However, we do not know whether our users might have configured Git credential helpers on
their own and chose to release new images which contain the bug fix for Git.

**Mitigation and/or workaround:**

We strongly recommend to upgrade your ArgoCD installation to either `v1.4.3` (if on v1.4
branch) or `v1.5.2` (if on v1.5 branch)

When you are running `v1.4.x`, you can upgrade to `v1.4.3` by simply changing the image
tags for `argocd-server`, `argocd-repo-server` and `argocd-controller` to `v1.4.3`.
The `v1.4.3` release does not contain additional functional bug fixes.

Likewise, hen you are running `v1.5.x`, you can upgrade to `v1.5.2` by simply changing
the image tags for `argocd-server`, `argocd-repo-server` and `argocd-controller` to `v1.5.2`.
The `v1.5.2` release does not contain additional functional bug fixes.

### CVE-2020-11576 - User Enumeration[¶](#cve-2020-11576-user-enumeration "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| Medium | [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> | v1.5.1 | Yes |

**Details:**

Argo version v1.5.0 was vulnerable to a user-enumeration vulnerability which allowed attackers to determine the usernames of valid (non-SSO) accounts within Argo.

**Mitigation and/or workaround:**

Upgrade to ArgoCD v1.5.1 or higher. As a workaround, disable local users and use only SSO authentication.

### CVE-2020-8828 - Insecure default administrative password[¶](#cve-2020-8828-insecure-default-administrative-password "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| High | [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> | 1.8.0 | Yes |

**Details:**

Argo CD uses the `argocd-server` pod name (ex: `argocd-server-55594fbdb9-ptsf5`) as the default admin password.

Kubernetes users able to list pods in the argo namespace are able to retrieve the default password.

Additionally, In most installations, [the Pod name contains a random "trail" of characters](https://github.com/kubernetes/kubernetes/blob/dda530cfb74b157f1d17b97818aa128a9db8e711/staging/src/k8s.io/apiserver/pkg/storage/names/generate.go#L37).
These characters are generated using [a time-seeded PRNG](https://github.com/kubernetes/apimachinery/blob/master/pkg/util/rand/rand.go#L26) and not a CSPRNG.
An attacker could use this information in an attempt to deduce the state of the internal PRNG, aiding bruteforce attacks.

**Mitigation and/or workaround:**

The recommended mitigation as described in the user documentation is to use SSO integration. The default admin password
should only be used for initial configuration and then [disabled](../operator-manual/user-management/#disable-admin-user)
or at least changed to a more secure password.

### CVE-2020-8827 - Insufficient anti-automation/anti-brute force[¶](#cve-2020-8827-insufficient-anti-automationanti-brute-force "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| High | [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> | n/a | Yes |

**Details:**

ArgoCD before v1.5.3 does not enforce rate-limiting or other anti-automation mechanisms which would mitigate admin password brute force.

**Mitigation and/or workaround:**

Rate-limiting and anti-automation mechanisms for local user accounts have been introduced with ArgoCD v1.5.3.

As a workaround for mitigation if you cannot upgrade ArgoCD to v1.5.3 yet, we recommend to disable local users and use SSO instead.

### CVE-2020-8826 - Session-fixation[¶](#cve-2020-8826-session-fixation "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| High | [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> | n/a | Yes |

**Details:**

The authentication tokens generated for built-in users have no expiry.

These issues might be acceptable in the controlled isolated environment but not acceptable if Argo CD user interface is
exposed to the Internet.

**Mitigation and/or workaround:**

The recommended mitigation is to change the password periodically to invalidate the authentication tokens.

### CVE-2018-21034 - Sensitive Information Disclosure[¶](#cve-2018-21034-sensitive-information-disclosure "Permanent link")

**Summary:**

| Risk | Reported by | Fix version | Workaround |
| --- | --- | --- | --- |
| Medium | [Matt Hamilton](https://github.com/Eriner) of <https://soluble.ai> | v1.5.0 | No |

**Details:**

In Argo versions prior to v1.5.0-rc1, it was possible for authenticated Argo users to submit API calls to retrieve secrets and other manifests which were stored within git.

**Mitigation and/or workaround:**

Upgrade to ArgoCD v1.5.0 or higher. No workaround available

## Reporting Vulnerabilities[¶](#reporting-vulnerabilities "Permanent link")

Please have a look at our
[security policy](https://github.com/argoproj/argo-cd/security/policy)
for more details on how to report security vulnerabilities for Argo CD.

[Previous

FAQ](../faq/)
[Next

Support](../SUPPORT/)

Made with
[Material for MkDocs](https://squidfunk.github.io/mkdocs-material/)



=== Content from github.com_4e91f480_20250111_045714.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2Fcebb6538f7944c87ca2fecb5d17f8baacc431456)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2Fcebb6538f7944c87ca2fecb5d17f8baacc431456)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.4k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  477](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

## Commit

[Permalink](/argoproj/argo-cd/commit/cebb6538f7944c87ca2fecb5d17f8baacc431456)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-2vgg-9h6w-m454](https://github.com/advisories/GHSA-2vgg-9h6w-m454 "GHSA-2vgg-9h6w-m454")

[Browse files](/argoproj/argo-cd/tree/cebb6538f7944c87ca2fecb5d17f8baacc431456)
Browse the repository at this point in the history

```
* feat: pick random user and exclude admin user and current user from deletion candidates

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* feat: increase default max cache size

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* add nil protection

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* Update util/session/sessionmanager.go

Signed-off-by: Dan Garfield <dan@codefresh.io>

Signed-off-by: Dan Garfield <dan@codefresh.io>

* chore: fix linter issues

Signed-off-by: pashakostohrys <pavel@codefresh.io>

---------

Signed-off-by: pashakostohrys <pavel@codefresh.io>
Signed-off-by: Dan Garfield <dan@codefresh.io>
Co-authored-by: Dan Garfield <dan@codefresh.io>
```

* Loading branch information

[![@pasha-codefresh](https://avatars.githubusercontent.com/u/39732895?s=40&v=4)](/pasha-codefresh) [![@todaywasawesome](https://avatars.githubusercontent.com/u/3849900?s=40&v=4)](/todaywasawesome)

[pasha-codefresh](/argoproj/argo-cd/commits?author=pasha-codefresh "View all commits by pasha-codefresh")
and
[todaywasawesome](/argoproj/argo-cd/commits?author=todaywasawesome "View all commits by todaywasawesome")
authored
Mar 18, 2024

1 parent
[ab7e45d](/argoproj/argo-cd/commit/ab7e45da13501cba8ef56e81f2b9f37ef615a6e1)

commit cebb653

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**60 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* util/session

  + util/session/sessionmanager.go
    [sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656)
  + util/session/sessionmanager\_test.go
    [sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d)

## There are no files selected for viewing

36 changes: 21 additions & 15 deletions

36
[util/session/sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656 "util/session/sessionmanager.go")

Show comments

[View file](/argoproj/argo-cd/blob/cebb6538f7944c87ca2fecb5d17f8baacc431456/util/session/sessionmanager.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,7 +69,7 @@ const ( |
|  |  | // Maximum length of username, too keep the cache's memory signature low |
|  |  | maxUsernameLength = 32 |
|  |  | // The default maximum session cache size |
|  |  | defaultMaxCacheSize = 1000 |
|  |  | defaultMaxCacheSize = 10000 |
|  |  | // The default number of maximum login failures before delay kicks in |
|  |  | defaultMaxLoginFailures = 5 |
|  |  | // The default time in seconds for the failure window |
| Expand Down  Expand Up | | @@ -310,6 +310,22 @@ func expireOldFailedAttempts(maxAge time.Duration, failures \*map[string]LoginAtt |
|  |  | return expiredCount |
|  |  | } |
|  |  |  |
|  |  | // Protect admin user from login attempt reset caused by attempts to overflow cache in a brute force attack. Instead remove random non-admin to make room in cache. |
|  |  | func pickRandomNonAdminLoginFailure(failures map[string]LoginAttempts, username string) \*string { |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | if key == common.ArgoCDAdminUsername || key == username { |
|  |  | return pickRandomNonAdminLoginFailure(failures, username) |
|  |  | } |
|  |  | return &key |
|  |  | } |
|  |  | i++ |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // Updates the failure count for a given username. If failed is true, increases the counter. Otherwise, sets counter back to 0. |
|  |  | func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  |  |
| Expand All | | @@ -327,23 +343,13 @@ func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  | // prevent overbloating the cache with fake entries, as this could lead to |
|  |  | // memory exhaustion and ultimately in a DoS. We remove a single entry to |
|  |  | // replace it with the new one. |
|  |  | // |
|  |  | // Chances are that we remove the one that is under active attack, but this |
|  |  | // chance is low (1:cache\_size) |
|  |  | if failed && len(failures) >= getMaximumCacheSize() { |
|  |  | log.Warnf("Session cache size exceeds %d entries, removing random entry", getMaximumCacheSize()) |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | var rmUser string |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | rmUser = key |
|  |  | delete(failures, key) |
|  |  | break |
|  |  | } |
|  |  | i++ |
|  |  | rmUser := pickRandomNonAdminLoginFailure(failures, username) |
|  |  | if rmUser != nil { |
|  |  | delete(failures, \*rmUser) |
|  |  | log.Infof("Deleted entry for user %s from cache", \*rmUser) |
|  |  | } |
|  |  | log.Infof("Deleted entry for user %s from cache", rmUser) |
|  |  | } |
|  |  |  |
|  |  | attempt, ok := failures[username] |
| Expand Down | |  |

39 changes: 39 additions & 0 deletions

39
[util/session/sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d "util/session/sessionmanager_test.go")

Show comments

[View file](/argoproj/argo-cd/blob/cebb6538f7944c87ca2fecb5d17f8baacc431456/util/session/sessionmanager_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1173,3 +1173,42 @@ requestedScopes: ["oidc"]`, oidcTestServer.URL), |
|  |  | assert.ErrorIs(t, err, common.TokenVerificationErr) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func Test\_PickFailureAttemptWhenOverflowed(t \*testing.T) { |
|  |  | t.Run("Not pick admin user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  |  |
|  |  | t.Run("Not pick admin user and current user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "test": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cebb653`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2Fcebb6538f7944c87ca2fecb5d17f8baacc431456) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8a160809_20250111_045713.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommit%2Fshow&source=header-repo&source_repo=argoproj%2Fargo-cd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[argoproj](/argoproj)
/
**[argo-cd](/argoproj/argo-cd)**
Public

* [Notifications](/login?return_to=%2Fargoproj%2Fargo-cd) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fargoproj%2Fargo-cd)
* [Star
   18.4k](/login?return_to=%2Fargoproj%2Fargo-cd)

* [Code](/argoproj/argo-cd)
* [Issues
  3.1k](/argoproj/argo-cd/issues)
* [Pull requests
  477](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects
  5](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

Additional navigation options

* [Code](/argoproj/argo-cd)
* [Issues](/argoproj/argo-cd/issues)
* [Pull requests](/argoproj/argo-cd/pulls)
* [Discussions](/argoproj/argo-cd/discussions)
* [Actions](/argoproj/argo-cd/actions)
* [Projects](/argoproj/argo-cd/projects)
* [Wiki](/argoproj/argo-cd/wiki)
* [Security](/argoproj/argo-cd/security)
* [Insights](/argoproj/argo-cd/pulse)

## Commit

[Permalink](/argoproj/argo-cd/commit/17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-2vgg-9h6w-m454](https://github.com/advisories/GHSA-2vgg-9h6w-m454 "GHSA-2vgg-9h6w-m454")

[Browse files](/argoproj/argo-cd/tree/17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d)
Browse the repository at this point in the history

```
* feat: pick random user and exclude admin user and current user from deletion candidates

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* feat: increase default max cache size

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* add nil protection

Signed-off-by: pashakostohrys <pavel@codefresh.io>

* Update util/session/sessionmanager.go

Signed-off-by: Dan Garfield <dan@codefresh.io>

Signed-off-by: Dan Garfield <dan@codefresh.io>

* chore: fix linter issues

Signed-off-by: pashakostohrys <pavel@codefresh.io>

---------

Signed-off-by: pashakostohrys <pavel@codefresh.io>
Signed-off-by: Dan Garfield <dan@codefresh.io>
Co-authored-by: Dan Garfield <dan@codefresh.io>
```

* Loading branch information

[![@pasha-codefresh](https://avatars.githubusercontent.com/u/39732895?s=40&v=4)](/pasha-codefresh) [![@todaywasawesome](https://avatars.githubusercontent.com/u/3849900?s=40&v=4)](/todaywasawesome)

[pasha-codefresh](/argoproj/argo-cd/commits?author=pasha-codefresh "View all commits by pasha-codefresh")
and
[todaywasawesome](/argoproj/argo-cd/commits?author=todaywasawesome "View all commits by todaywasawesome")
authored
Mar 18, 2024

1 parent
[4df9a46](/argoproj/argo-cd/commit/4df9a46e7224db12bed71c238ea8a6cfd942a6e2)

commit 17b0df1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**60 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* util/session

  + util/session/sessionmanager.go
    [sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656)
  + util/session/sessionmanager\_test.go
    [sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d)

## There are no files selected for viewing

36 changes: 21 additions & 15 deletions

36
[util/session/sessionmanager.go](#diff-346b4873606a33a956f876d3f1313a229e54181d71b14c5fbf833fe99679a656 "util/session/sessionmanager.go")

Show comments

[View file](/argoproj/argo-cd/blob/17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d/util/session/sessionmanager.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,7 +69,7 @@ const ( |
|  |  | // Maximum length of username, too keep the cache's memory signature low |
|  |  | maxUsernameLength = 32 |
|  |  | // The default maximum session cache size |
|  |  | defaultMaxCacheSize = 1000 |
|  |  | defaultMaxCacheSize = 10000 |
|  |  | // The default number of maximum login failures before delay kicks in |
|  |  | defaultMaxLoginFailures = 5 |
|  |  | // The default time in seconds for the failure window |
| Expand Down  Expand Up | | @@ -310,6 +310,22 @@ func expireOldFailedAttempts(maxAge time.Duration, failures \*map[string]LoginAtt |
|  |  | return expiredCount |
|  |  | } |
|  |  |  |
|  |  | // Protect admin user from login attempt reset caused by attempts to overflow cache in a brute force attack. Instead remove random non-admin to make room in cache. |
|  |  | func pickRandomNonAdminLoginFailure(failures map[string]LoginAttempts, username string) \*string { |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | if key == common.ArgoCDAdminUsername || key == username { |
|  |  | return pickRandomNonAdminLoginFailure(failures, username) |
|  |  | } |
|  |  | return &key |
|  |  | } |
|  |  | i++ |
|  |  | } |
|  |  | return nil |
|  |  | } |
|  |  |  |
|  |  | // Updates the failure count for a given username. If failed is true, increases the counter. Otherwise, sets counter back to 0. |
|  |  | func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  |  |
| Expand All | | @@ -327,23 +343,13 @@ func (mgr \*SessionManager) updateFailureCount(username string, failed bool) { |
|  |  | // prevent overbloating the cache with fake entries, as this could lead to |
|  |  | // memory exhaustion and ultimately in a DoS. We remove a single entry to |
|  |  | // replace it with the new one. |
|  |  | // |
|  |  | // Chances are that we remove the one that is under active attack, but this |
|  |  | // chance is low (1:cache\_size) |
|  |  | if failed && len(failures) >= getMaximumCacheSize() { |
|  |  | log.Warnf("Session cache size exceeds %d entries, removing random entry", getMaximumCacheSize()) |
|  |  | idx := rand.Intn(len(failures) - 1) |
|  |  | var rmUser string |
|  |  | i := 0 |
|  |  | for key := range failures { |
|  |  | if i == idx { |
|  |  | rmUser = key |
|  |  | delete(failures, key) |
|  |  | break |
|  |  | } |
|  |  | i++ |
|  |  | rmUser := pickRandomNonAdminLoginFailure(failures, username) |
|  |  | if rmUser != nil { |
|  |  | delete(failures, \*rmUser) |
|  |  | log.Infof("Deleted entry for user %s from cache", \*rmUser) |
|  |  | } |
|  |  | log.Infof("Deleted entry for user %s from cache", rmUser) |
|  |  | } |
|  |  |  |
|  |  | attempt, ok := failures[username] |
| Expand Down | |  |

39 changes: 39 additions & 0 deletions

39
[util/session/sessionmanager\_test.go](#diff-13951c9c1496ff4a76101c6ab92501e43a65bc3c8a0f9c9f0e2b6df2f386ef0d "util/session/sessionmanager_test.go")

Show comments

[View file](/argoproj/argo-cd/blob/17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d/util/session/sessionmanager_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1188,3 +1188,42 @@ requestedScopes: ["oidc"]`, oidcTestServer.URL), |
|  |  | assert.ErrorIs(t, err, common.TokenVerificationErr) |
|  |  | }) |
|  |  | } |
|  |  |  |
|  |  | func Test\_PickFailureAttemptWhenOverflowed(t \*testing.T) { |
|  |  | t.Run("Not pick admin user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  |  |
|  |  | t.Run("Not pick admin user and current user from the queue", func(t \*testing.T) { |
|  |  | failures := map[string]LoginAttempts{ |
|  |  | "test": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "admin": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | "test2": { |
|  |  | FailCount: 1, |
|  |  | }, |
|  |  | } |
|  |  |  |
|  |  | // inside pickRandomNonAdminLoginFailure, it uses random, so we need to test it multiple times |
|  |  | for i := 0; i < 1000; i++ { |
|  |  | user := pickRandomNonAdminLoginFailure(failures, "test") |
|  |  | assert.Equal(t, "test2", \*user) |
|  |  | } |
|  |  | }) |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `17b0df1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fargoproj%2Fargo-cd%2Fcommit%2F17b0df1168a4c535f6f37e95f25ed7cd81e1fa4d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


