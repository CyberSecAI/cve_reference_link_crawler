=== Content from plugins.trac.wordpress.org_12f227e5_20250110_170230.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fqa-heatmap-analytics%2Ftrunk%2Fclass-qahm-admin-page-config.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php?rev=3142031 "Revision 3142031")
* Next Revision →
* [Blame](/browser/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php)

---

# [source:](/browser?order=name "Go to repository root") [qa-heatmap-analytics](/browser/qa-heatmap-analytics?order=name "View qa-heatmap-analytics")/[trunk](/browser/qa-heatmap-analytics/trunk?order=name "View trunk")/[class-qahm-admin-page-config.php](/browser/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php?order=name "View class-qahm-admin-page-config.php")

View diff against:

View revision:

| [Last change](/changeset/3174701/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php "View differences") on this file was [3174701](/changeset/3174701/ "View changeset 3174701"), checked in by quarka, [3 months ago](/timeline?from=2024-10-24T04%3A03%3A57Z&precision=second "See timeline at 10/24/2024 04:03:57 AM") |
| --- |
| ver 4.1.2.0 |
| **File size:** 52.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* |
| [4](#L4) | \* |
| [5](#L5) | \* @package qa\_heatmap |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | $qahm\_admin\_page\_config = new QAHM\_Admin\_Page\_Config(); |
| [9](#L9) |  |
| [10](#L10) | class QAHM\_Admin\_Page\_Config extends QAHM\_Admin\_Page\_Base { |
| [11](#L11) |  |
| [12](#L12) | // スラッグ |
| [13](#L13) | const SLUG = QAHM\_NAME . '-config'; |
| [14](#L14) |  |
| [15](#L15) | // nonce |
| [16](#L16) | //const NONCE\_ACTION = self::SLUG . '-nonce-action'; |
| [17](#L17) | //const NONCE\_NAME   = self::SLUG . '-nonce-name'; |
| [18](#L18) | const NONCE\_ACTION\_GA = self::SLUG . '-nonce-action-googleapi'; |
| [19](#L19) | const NONCE\_NAME\_GA   = self::SLUG . '-nonce-name-googleapi'; |
| [20](#L20) | const NONCE\_ACTION\_QAOP = self::SLUG . '-nonce-action-qahm-options'; |
| [21](#L21) |  |
| [22](#L22) | private static $error\_msg = array(); |
| [23](#L23) | private $localize\_ary; |
| [24](#L24) |  |
| [25](#L25) | /\*\* |
| [26](#L26) | \* コンストラクタ |
| [27](#L27) | \*/ |
| [28](#L28) | public function \_\_construct() { |
| [29](#L29) | parent::\_\_construct(); |
| [30](#L30) |  |
| [31](#L31) | // コールバック |
| [32](#L32) | add\_action( 'init', array( $this, 'init\_wp\_filesystem' ) ); |
| [33](#L33) | add\_action( 'load-qa-analytics\_page\_qahm-config', array( $this, 'admin\_init' ) ); |
| [34](#L34) |  |
| [35](#L35) | $this->regist\_ajax\_func( 'ajax\_save\_plugin\_config' ); |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | // 管理画面の初期化 |
| [39](#L39) | public function admin\_init(){ |
| [40](#L40) | if( defined('DOING\_AJAX') && DOING\_AJAX ){ |
| [41](#L41) | return; |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | global $qahm\_google\_api; |
| [45](#L45) |  |
| [46](#L46) | $scope   = array( 'https://www.googleapis.com/auth/webmasters.readonly' ); |
| [47](#L47) |  |
| [48](#L48) | // nonceで設定したcredentialのチェック |
| [49](#L49) | // 設定画面 |
| [50](#L50) | if ( isset( $\_POST[ self::NONCE\_NAME\_GA ] ) && check\_admin\_referer( self::NONCE\_ACTION\_GA, self::NONCE\_NAME\_GA ) ) { |
| [51](#L51) | // フォームから値が送信されていればDBに保存 |
| [52](#L52) | $client\_id     = sanitize\_text\_field( wp\_unslash( $this->wrap\_filter\_input( INPUT\_POST, 'client\_id' ) ) ); |
| [53](#L53) | $client\_secret = sanitize\_text\_field( wp\_unslash( $this->wrap\_filter\_input( INPUT\_POST, 'client\_secret' ) ) ); |
| [54](#L54) | $qahm\_google\_api->set\_credentials( $client\_id, $client\_secret, null ); |
| [55](#L55) |  |
| [56](#L56) | $qahm\_google\_api->init( |
| [57](#L57) | 'Google API Integration', |
| [58](#L58) | $scope, |
| [59](#L59) | admin\_url( 'admin.php?page=qahm-config' ), |
| [60](#L60) | true |
| [61](#L61) | ); |
| [62](#L62) | } else { |
| [63](#L63) | $qahm\_google\_api->init( |
| [64](#L64) | 'Google API Integration', |
| [65](#L65) | $scope, |
| [66](#L66) | admin\_url( 'admin.php?page=qahm-config' ) |
| [67](#L67) | ); |
| [68](#L68) | } |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | /\*\* |
| [72](#L72) | \* 初期化 |
| [73](#L73) | \*/ |
| [74](#L74) | public function enqueue\_scripts( $hook\_suffix ) { |
| [75](#L75) | if( $this->hook\_suffix !== $hook\_suffix ) { |
| [76](#L76) | return; |
| [77](#L77) | } |
| [78](#L78) |  |
| [79](#L79) | if( ! $this->is\_enqueue\_jquery() ) { |
| [80](#L80) | return; |
| [81](#L81) | } |
| [82](#L82) |  |
| [83](#L83) | if( $this->is\_maintenance() ) { |
| [84](#L84) | return; |
| [85](#L85) | } |
| [86](#L86) |  |
| [87](#L87) | if( $this->wrap\_get\_option( 'plugin\_first\_launch' ) ) { |
| [88](#L88) | $this->common\_enqueue\_style(); |
| [89](#L89) | $this->common\_enqueue\_script(); |
| [90](#L90) | $scripts = $this->get\_common\_inline\_script(); |
| [91](#L91) | wp\_add\_inline\_script( QAHM\_NAME . '-common', 'var ' . QAHM\_NAME . ' = ' . QAHM\_NAME . ' || {}; let ' . QAHM\_NAME . 'Obj = ' . wp\_json\_encode( $scripts ) . '; ' . QAHM\_NAME . ' = Object.assign( ' . QAHM\_NAME . ', ' . QAHM\_NAME . 'Obj );', 'before' ); |
| [92](#L92) | $localize = $this->get\_common\_localize\_script(); |
| [93](#L93) | wp\_localize\_script( QAHM\_NAME . '-common', QAHM\_NAME . 'l10n', $localize ); |
| [94](#L94) | return; |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) | global $qahm\_time; |
| [98](#L98) | $js\_dir       = $this->get\_js\_dir\_url(); |
| [99](#L99) | $data\_dir     = $this->get\_data\_dir\_url(); |
| [100](#L100) | $license\_plan = $this->wrap\_get\_option( 'license\_plans' ); |
| [101](#L101) | $css\_dir\_url  = $this->get\_css\_dir\_url(); |
| [102](#L102) |  |
| [103](#L103) | $GOALMAX = 1; |
| [104](#L104) | if ( $this->get\_license\_plan( 'goal\_3' ) ) { |
| [105](#L105) | $GOALMAX = 3; |
| [106](#L106) | } |
| [107](#L107) | if ( $this->get\_license\_plan( 'goal\_10' ) ) { |
| [108](#L108) | $GOALMAX = 10; |
| [109](#L109) | } |
| [110](#L110) |  |
| [111](#L111) | // enqueue\_style |
| [112](#L112) | $this->common\_enqueue\_style(); |
| [113](#L113) | wp\_enqueue\_script( QAHM\_NAME . '-admin-page-config', $js\_dir . 'admin-page-config.js', array( QAHM\_NAME . '-admin-page-base' ), QAHM\_PLUGIN\_VERSION, false ); |
| [114](#L114) | wp\_enqueue\_style( QAHM\_NAME . '-admin-page-base-css', $css\_dir\_url . 'admin-page-base.css', array( QAHM\_NAME . '-reset' ), QAHM\_PLUGIN\_VERSION ); |
| [115](#L115) | wp\_enqueue\_style( QAHM\_NAME . '-admin-page-config-css', $css\_dir\_url . 'admin-page-config.css', array( QAHM\_NAME . '-reset' ), QAHM\_PLUGIN\_VERSION ); |
| [116](#L116) | if ( $license\_plan ) { |
| [117](#L117) | //                      wp\_enqueue\_script( QAHM\_NAME . '-powerup-config', $data\_dir . 'js/powerup-config.js', array( QAHM\_NAME . '-admin-page-base' ), $qahm\_time->now\_unixtime() ); |
| [118](#L118) | } |
| [119](#L119) | // enqueue script |
| [120](#L120) | $this->common\_enqueue\_script(); |
| [121](#L121) |  |
| [122](#L122) | // g\_clickpage の変数作成 |
| [123](#L123) | global $qahm\_data\_api; |
| [124](#L124) | $goals\_ary = $qahm\_data\_api->get\_goals\_array(); |
| [125](#L125) | $click\_iframe\_url = esc\_url( get\_home\_url() ); |
| [126](#L126) | $g\_clickpage\_ary = array(); |
| [127](#L127) | for ( $iii = 1; $iii <= $GOALMAX; $iii++ ) { |
| [128](#L128) | $g\_clickpage = isset( $goals\_ary[$iii]['g\_clickpage'] ) ? urldecode( $goals\_ary[$iii]['g\_clickpage'] ) : ''; |
| [129](#L129) | //set default |
| [130](#L130) | if ( ! $g\_clickpage ) { |
| [131](#L131) | $g\_clickpage = $click\_iframe\_url; |
| [132](#L132) | } |
| [133](#L133) | $g\_clickpage\_ary[$iii] = $g\_clickpage; |
| [134](#L134) | } |
| [135](#L135) | // inline script |
| [136](#L136) | $scripts = $this->get\_common\_inline\_script(); |
| [137](#L137) | $scripts['access\_role']     = $this->wrap\_get\_option( 'access\_role' ); |
| [138](#L138) | $scripts['wp\_time\_adj'] = get\_option('gmt\_offset'); |
| [139](#L139) | $scripts['wp\_lang\_set'] =  get\_bloginfo('language'); |
| [140](#L140) | $scripts['goalmax']     =  $GOALMAX; |
| [141](#L141) | $scripts['g\_clickpage'] = $g\_clickpage\_ary; |
| [142](#L142) | wp\_add\_inline\_script( QAHM\_NAME . '-common', 'var ' . QAHM\_NAME . ' = ' . QAHM\_NAME . ' || {}; let ' . QAHM\_NAME . 'Obj = ' . wp\_json\_encode( $scripts ) . '; ' . QAHM\_NAME . ' = Object.assign( ' . QAHM\_NAME . ', ' . QAHM\_NAME . 'Obj );', 'before' ); |
| [143](#L143) |  |
| [144](#L144) | // localize |
| [145](#L145) | $localize = $this->get\_common\_localize\_script(); |
| [146](#L146) | $localize['data\_save\_month\_title']     = esc\_html\_\_( 'Data Storage Period', 'qa-heatmap-analytics' ); |
| [147](#L147) | $localize['data\_save\_month\_desc']      = esc\_html\_\_( 'With free plans, to the previous month. For subscribed, there is no period limit in principal.', 'qa-heatmap-analytics' ); |
| [148](#L148) | $localize['all\_page\_measure\_title']    = esc\_html\_\_( 'Measure all pages', 'qa-heatmap-analytics' ); |
| [149](#L149) | $localize['all\_page\_measure\_desc']     = esc\_html\_\_( 'Ignore the individual measurement settings on Heatmap management screen and measure all pages. Measurement starts automatically including when a new page is added (published).', 'qa-heatmap-analytics' ); |
| [150](#L150) | $localize['access\_role\_title']         = esc\_html\_\_( 'Access Privileges', 'qa-heatmap-analytics' ); |
| [151](#L151) | $localize['access\_role\_desc']          = esc\_html\_\_( 'Set the privileges to access the heatmap view.', 'qa-heatmap-analytics' ); |
| [152](#L152) | $localize['access\_role\_option\_admin']  = esc\_html\_\_( 'Administrator only', 'qa-heatmap-analytics' ); |
| [153](#L153) | $localize['access\_role\_option\_editor'] = esc\_html\_\_( 'Editor or above', 'qa-heatmap-analytics' ); |
| [154](#L154) | $localize['settings\_saved']            = esc\_attr\_\_( 'Settings saved.', 'qa-heatmap-analytics' ); |
| [155](#L155) | $localize['goal\_saved']                = esc\_attr\_\_( 'Goal saved.', 'qa-heatmap-analytics' ); |
| [156](#L156) | $localize['cnv\_couldnt\_saved']         = esc\_html\_\_( 'Could not be saved. The value is same as before or is incorrect.', 'qa-heatmap-analytics' ); |
| [157](#L157) | /\* translators: placeholders are for a goal ID \*/ |
| [158](#L158) | $localize['cnv\_delete\_title']          = esc\_html\_\_( 'Delete Goal %d', 'qa-heatmap-analytics' ); |
| [159](#L159) | $localize['cnv\_delete\_confirm']        = esc\_html\_\_( 'Are you sure to delete this goal?', 'qa-heatmap-analytics' ); |
| [160](#L160) | /\* translators: placeholders are for a goal ID \*/ |
| [161](#L161) | $localize['cnv\_success\_delete']        = esc\_html\_\_( 'Goal %d deleted.', 'qa-heatmap-analytics' ); |
| [162](#L162) | $localize['cnv\_couldnt\_delete']        = esc\_html\_\_( 'Could not delete. The value is incorrect.', 'qa-heatmap-analytics' ); |
| [163](#L163) | $localize['cnv\_page\_set\_alert']        = esc\_html\_\_( 'You are trying to set all the pages as a goal.', 'qa-heatmap-analytics' ); |
| [164](#L164) | $localize['cnv\_goal\_numbering\_alert']  = esc\_html\_\_( 'There is a skip in goal numbers. Please set goals sequentially.', 'qa-heatmap-analytics' ); |
| [165](#L165) | $localize['cnv\_reaching\_goal\_notice']  = esc\_attr\_\_( 'You have the goal reached.', 'qa-heatmap-analytics' ); |
| [166](#L166) | $localize['cnv\_saving']                = esc\_attr\_\_( 'Saving...', 'qa-heatmap-analytics' ); |
| [167](#L167) | $localize['cnv\_load\_page']             = esc\_html\_\_( 'Load the Page', 'qa-heatmap-analytics' ); |
| [168](#L168) | $localize['cnv\_loading']               = esc\_html\_\_( 'Loading...', 'qa-heatmap-analytics' ); |
| [169](#L169) | /\* translators: placeholders are for a goal ID \*/ |
| [170](#L170) | $localize['cnv\_saved\_1']               = esc\_html\_\_( 'Goal %d saved successfully.', 'qa-heatmap-analytics' ); |
| [171](#L171) | $localize['cnv\_saved\_2']               = esc\_html\_\_( 'Due to data processing, it may take a few minutes to about 30 minutes for the data to be displayed in the conversion report.', 'qa-heatmap-analytics' ); |
| [172](#L172) | $localize['nothing\_page\_id']           = esc\_html\_\_( 'Sorry, a post or page that is either newly created or never visited cannot be set as a goal. Please allow at least one day.', 'qa-heatmap-analytics' ); |
| [173](#L173) | $localize['nothing\_page\_id2']          = esc\_html\_\_( 'Or, please ensure the URL belongs to this WordPress site.', 'qa-heatmap-analytics' ); |
| [174](#L174) | $localize['wrong\_regex\_delimiter']     = esc\_html\_\_( 'The pattern does not have a valid starting or ending delimiter.', 'qa-heatmap-analytics' ); |
| [175](#L175) | $localize['mail\_btn\_updating']         = esc\_html\_\_( 'Updating...', 'qa-heatmap-analytics' ); |
| [176](#L176) | $localize['mail\_alert\_update\_failed']  = esc\_html\_\_( 'Failed updating. Please retry again.', 'qa-heatmap-analytics' ); |
| [177](#L177) | $localize['setting\_option\_saved']      = esc\_html\_\_( 'Plugin options saved successfully.', 'qa-heatmap-analytics' ); |
| [178](#L178) | $localize['setting\_option\_failed']     = esc\_html\_\_( 'Failed saving plugin options.', 'qa-heatmap-analytics' ); |
| [179](#L179) | $localize['site\_info\_saved']           = esc\_html\_\_( 'Site category saved.', 'qa-heatmap-analytics' ); |
| [180](#L180) | $localize['site\_info\_failed']          = esc\_html\_\_( 'Failed to save Site Category.', 'qa-heatmap-analytics' ); |
| [181](#L181) | $localize['alert\_message\_success']     = esc\_html\_\_( 'Success', 'qa-heatmap-analytics' ); |
| [182](#L182) | $localize['alert\_message\_failed']      = esc\_html\_\_( 'Failed to update settings', 'qa-heatmap-analytics' ); |
| [183](#L183) |  |
| [184](#L184) | // nonce for saving plugin options |
| [185](#L185) | $localize['nonce\_qahm\_options'] = wp\_create\_nonce( self::NONCE\_ACTION\_QAOP ); |
| [186](#L186) |  |
| [187](#L187) | wp\_localize\_script( QAHM\_NAME . '-common', QAHM\_NAME . 'l10n', $localize ); |
| [188](#L188) | $this->localize\_ary = $localize; |
| [189](#L189) |  |
| [190](#L190) | } |
| [191](#L191) |  |
| [192](#L192) | /\*\* |
| [193](#L193) | \* ページの表示 |
| [194](#L194) | \*/ |
| [195](#L195) | public function create\_html() { |
| [196](#L196) | if( ! $this->is\_enqueue\_jquery() ) { |
| [197](#L197) | $this->view\_not\_enqueue\_jquery\_html(); |
| [198](#L198) | return; |
| [199](#L199) | } |
| [200](#L200) |  |
| [201](#L201) | if( $this->is\_maintenance() ) { |
| [202](#L202) | $this->view\_maintenance\_html(); |
| [203](#L203) | return; |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | if( $this->wrap\_get\_option( 'plugin\_first\_launch' ) ) { |
| [207](#L207) | $this->view\_first\_launch\_html(); |
| [208](#L208) | return; |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | // データを取得 |
| [212](#L212) | global $qahm\_data\_api; |
| [213](#L213) | global $qahm\_google\_api; |
| [214](#L214) |  |
| [215](#L215) | $GOALMAX = 1; |
| [216](#L216) | if ( $this->get\_license\_plan( 'goal\_3' ) ) { |
| [217](#L217) | $GOALMAX = 3; |
| [218](#L218) | } |
| [219](#L219) | if ( $this->get\_license\_plan( 'goal\_10' ) ) { |
| [220](#L220) | $GOALMAX = 10; |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | $siteinfo\_ary = $qahm\_data\_api->get\_siteinfo\_array(); |
| [224](#L224) |  |
| [225](#L225) |  |
| [226](#L226) |  |
| [227](#L227) | $goals\_ary = $qahm\_data\_api->get\_goals\_array(); |
| [228](#L228) |  |
| [229](#L229) | $sitetype\_ary = [ |
| [230](#L230) | "general\_company", |
| [231](#L231) | "media\_affiliate", |
| [232](#L232) | "service\_matching", |
| [233](#L233) | "ec\_ec" , |
| [234](#L234) | "general\_shop" , |
| [235](#L235) | "media\_owned" , |
| [236](#L236) | "service\_ugc" , |
| [237](#L237) | "ec\_contents" , |
| [238](#L238) | "general\_ir" , |
| [239](#L239) | "media\_other" , |
| [240](#L240) | "service\_membershi", |
| [241](#L241) | "ec\_license" , |
| [242](#L242) | "general\_recruit", |
| [243](#L243) | "service\_other" , |
| [244](#L244) | "ec\_other" , |
| [245](#L245) | ]; |
| [246](#L246) |  |
| [247](#L247) | $lang\_ja['target\_user\_question'] =  esc\_html\_\_( 'Which type of users do you want meet the goal?', 'qa-heatmap-analytics' ); |
| [248](#L248) | $lang\_ja['target\_individual'] =  esc\_html\_\_( 'Personal', 'qa-heatmap-analytics' ); |
| [249](#L249) | $lang\_ja['target\_corporation'] =  esc\_html\_\_( 'Corporations/Organizations', 'qa-heatmap-analytics' ); |
| [250](#L250) |  |
| [251](#L251) |  |
| [252](#L252) | $lang\_ja['select\_sitetype\_question'] =  esc\_html\_\_( 'Choose a category that describes your site best.', 'qa-heatmap-analytics' ); |
| [253](#L253) | $lang\_ja['general'] =  esc\_html\_\_( 'General', 'qa-heatmap-analytics' ); |
| [254](#L254) | $lang\_ja['media'] =  esc\_html\_\_( 'Media', 'qa-heatmap-analytics' ); |
| [255](#L255) | $lang\_ja['service'] =  esc\_html\_\_( 'Providing services', 'qa-heatmap-analytics' ); |
| [256](#L256) | $lang\_ja['ec\_mall'] =  esc\_html\_\_( 'EC/Mall', 'qa-heatmap-analytics' ); |
| [257](#L257) |  |
| [258](#L258) | $lang\_ja['general\_company'] = esc\_html\_\_( 'About a company/services', 'qa-heatmap-analytics' ); |
| [259](#L259) | $lang\_ja['media\_affiliate'] = esc\_html\_\_( 'Affiliate blogs/Media', 'qa-heatmap-analytics' ); |
| [260](#L260) | $lang\_ja['service\_matching'] = esc\_html\_\_( 'Matching', 'qa-heatmap-analytics' ); |
| [261](#L261) | $lang\_ja['ec\_ec'] = esc\_html\_\_( 'Product sales', 'qa-heatmap-analytics' ); |
| [262](#L262) | $lang\_ja['general\_shop'] = esc\_html\_\_( 'About stores/facilities', 'qa-heatmap-analytics' ); |
| [263](#L263) | $lang\_ja['media\_owned'] = esc\_html\_\_( 'Owned media', 'qa-heatmap-analytics' ); |
| [264](#L264) | $lang\_ja['service\_ugc'] = esc\_html\_\_( 'Posting', 'qa-heatmap-analytics' ); |
| [265](#L265) | $lang\_ja['ec\_contents'] = esc\_html\_\_( 'Online content sales', 'qa-heatmap-analytics' ); |
| [266](#L266) | $lang\_ja['general\_ir'] = esc\_html\_\_( 'IR', 'qa-heatmap-analytics' ); |
| [267](#L267) | $lang\_ja['media\_other'] = esc\_html\_\_( 'Other information dissemination', 'qa-heatmap-analytics' ); |
| [268](#L268) | $lang\_ja['service\_membershi'] = esc\_html\_\_( 'SNS/Member services', 'qa-heatmap-analytics' ); |
| [269](#L269) | $lang\_ja['ec\_license'] = esc\_html\_\_( 'License sales', 'qa-heatmap-analytics' ); |
| [270](#L270) | $lang\_ja['general\_recruit'] = esc\_html\_\_( 'Recruitment', 'qa-heatmap-analytics' ); |
| [271](#L271) | $lang\_ja['service\_other'] = esc\_html\_\_( 'Other services', 'qa-heatmap-analytics' ); |
| [272](#L272) | $lang\_ja['ec\_other'] = esc\_html\_\_( 'Other sales', 'qa-heatmap-analytics' ); |
| [273](#L273) |  |
| [274](#L274) | $lang\_ja['membership\_question'] = esc\_html\_\_( 'Does the site have "member registration"?', 'qa-heatmap-analytics' ); |
| [275](#L275) | $lang\_ja['payment\_question'] = esc\_html\_\_( 'Does the site have "payment function"?', 'qa-heatmap-analytics' ); |
| [276](#L276) | $lang\_ja['goal\_monthly\_access\_question'] = esc\_html\_\_( 'Enter the target number for monthly sessions.', 'qa-heatmap-analytics' ); |
| [277](#L277) |  |
| [278](#L278) | $lang\_ja['membership\_yes'] = esc\_html\_\_( 'Yes.', 'qa-heatmap-analytics' ); |
| [279](#L279) | $lang\_ja['membership\_no'] = esc\_html\_\_( 'No.', 'qa-heatmap-analytics' ); |
| [280](#L280) | $lang\_ja['next'] = esc\_html\_\_( 'Next', 'qa-heatmap-analytics' ); |
| [281](#L281) | $lang\_ja['save'] = esc\_attr\_\_( 'Save', 'qa-heatmap-analytics' ); |
| [282](#L282) |  |
| [283](#L283) | $lang\_ja['payment\_no'] = esc\_html\_\_( 'No.', 'qa-heatmap-analytics' ); |
| [284](#L284) | $lang\_ja['payment\_yes'] = esc\_html\_\_( 'Yes, using original system.', 'qa-heatmap-analytics' ); |
| [285](#L285) | $lang\_ja['payment\_cart'] = esc\_html\_\_( 'Using external cart system.', 'qa-heatmap-analytics' ); |
| [286](#L286) |  |
| [287](#L287) |  |
| [288](#L288) | $lang\_ja['month\_later'] = esc\_html\_\_( 'month(s) later, reaching', 'qa-heatmap-analytics' ); |
| [289](#L289) | $lang\_ja['session\_goal'] = esc\_html\_\_( 'sessions/month is the goal.', 'qa-heatmap-analytics' ); |
| [290](#L290) |  |
| [291](#L291) | $goal\_noun   = esc\_html\_\_( 'Goal', 'qa-heatmap-analytics' ); |
| [292](#L292) | $goal\_title  = esc\_html\_\_( 'Goal Name', 'qa-heatmap-analytics' ); |
| [293](#L293) | //$required\_mark    = esc\_html\_x( '\*', 'A mark that indicates it is required item.', 'qa-heatmap-analytics' ); |
| [294](#L294) | $goal\_number = esc\_html\_\_( 'Completions Target in a Month', 'qa-heatmap-analytics' ); |
| [295](#L295) | $num\_scale   = esc\_html\_\_( 'completion(s)', 'qa-heatmap-analytics' ); |
| [296](#L296) | $goal\_value  = esc\_html\_\_( 'Goal Value (avg. monetary amount per goal)', 'qa-heatmap-analytics' ); |
| [297](#L297) | $val\_scale   = esc\_html\_x( 'dollar(s)', 'Please put your currency. (This is only for a goal criterion.)', 'qa-heatmap-analytics' ); |
| [298](#L298) | $goal\_sales  = esc\_html\_\_( 'Estimated Total Goal Value', 'qa-heatmap-analytics' ); |
| [299](#L299) | $goal\_type   = esc\_html\_\_( 'Goal Type', 'qa-heatmap-analytics' ); |
| [300](#L300) | $goal\_type\_page  = esc\_html\_\_( 'Destination', 'qa-heatmap-analytics' ); |
| [301](#L301) | $goal\_type\_click = esc\_html\_\_( 'Click', 'qa-heatmap-analytics' ); |
| [302](#L302) | $goal\_type\_event = esc\_html\_\_( 'Event (Advanced)', 'qa-heatmap-analytics' ); |
| [303](#L303) | $goal\_page   = esc\_html\_\_( 'Web page URL', 'qa-heatmap-analytics' ); |
| [304](#L304) | $click\_page  = esc\_html\_\_( 'On which page?', 'qa-heatmap-analytics' ); |
| [305](#L305) | $eventtype   = esc\_html\_\_( 'Event Type', 'qa-heatmap-analytics' ); |
| [306](#L306) | $savechanges = esc\_attr\_\_( 'Save Changes', 'qa-heatmap-analytics' ); |
| [307](#L307) | $savegoal = esc\_attr\_\_( 'Save and Update', 'qa-heatmap-analytics' ); |
| [308](#L308) | $savesetting = esc\_attr\_\_( 'Settings saved.', 'qa-heatmap-analytics' ); |
| [309](#L309) | $clickselector = esc\_html\_\_( 'Click on the element shown below. (Its selector will be automatically detected and filled.)', 'qa-heatmap-analytics' ); |
| [310](#L310) | $eventselector = esc\_html\_\_( 'Hyperlink Reference (Regular Expression with delimiter)', 'qa-heatmap-analytics' ); |
| [311](#L311) | $example    = esc\_html\_\_( 'Example:', 'qa-heatmap-analytics' ); |
| [312](#L312) | $pagematch\_complete = esc\_html\_\_( 'Equals to', 'qa-heatmap-analytics' ); |
| [313](#L313) | $pagematch\_prefix   = esc\_html\_\_( 'Begins with', 'qa-heatmap-analytics' ); |
| [314](#L314) | $click\_sel\_load = esc\_html\_\_( 'Load the Page', 'qa-heatmap-analytics' ); |
| [315](#L315) | $click\_sel\_set  = esc\_html\_\_( 'Selector input completed.', 'qa-heatmap-analytics' ); |
| [316](#L316) | $unset\_goal = esc\_html\_x( 'Unset', 'unset a goal', 'qa-heatmap-analytics' ); |
| [317](#L317) |  |
| [318](#L318) |  |
| [319](#L319) | //each event |
| [320](#L320) | $event\_click   = esc\_html\_\_( 'Link Click', 'qa-heatmap-analytics' ); |
| [321](#L321) |  |
| [322](#L322) | // iframe |
| [323](#L323) | $click\_iframe\_url = esc\_url( get\_home\_url() ); |
| [324](#L324) |  |
| [325](#L325) |  |
| [326](#L326) |  |
| [327](#L327) | //1st which panel will be oepn? |
| [328](#L328) | /\* |
| [329](#L329) | $oepndetail = array\_fill(1, 2, '' ); |
| [330](#L330) | if ( isset( $siteinfo\_ary['session\_goal'] ) || isset( $siteinfo\_ary['sitetype'] ) ) { |
| [331](#L331) | $oepndetail[2] = 'open'; |
| [332](#L332) | }else{ |
| [333](#L333) | $oepndetail[1] = 'open'; |
| [334](#L334) | } |
| [335](#L335) | \*/ |
| [336](#L336) | $license\_plan = $this->wrap\_get\_option( 'license\_plans' ); |
| [337](#L337) |  |
| [338](#L338) | // Google API 認証情報 |
| [339](#L339) | $access\_token = null; |
| [340](#L340) | $credentials  = $qahm\_google\_api->get\_credentials(); |
| [341](#L341) | if ( $credentials && isset($credentials['token']) && isset($credentials['token']['access\_token']) ) { |
| [342](#L342) | $access\_token = $credentials['token']['access\_token']; |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | // create\_qa\_announce\_html用 |
| [346](#L346) | // 許可するHTMLタグと属性のリスト |
| [347](#L347) | $qa\_announce\_allowed\_tags = array( |
| [348](#L348) | 'div' => array( |
| [349](#L349) | 'class' => array(), |
| [350](#L350) | 'style' => array(), |
| [351](#L351) | ), |
| [352](#L352) | 'span' => array( |
| [353](#L353) | 'class' => array(), |
| [354](#L354) | 'style' => array(), |
| [355](#L355) | ), |
| [356](#L356) | 'p' => array( |
| [357](#L357) | 'class' => array(), |
| [358](#L358) | 'style' => array(), |
| [359](#L359) | ), |
| [360](#L360) | 'br' => array(), |
| [361](#L361) | 'blockquote' => array(), |
| [362](#L362) | 'ul' => array(), |
| [363](#L363) | 'ol' => array(), |
| [364](#L364) | 'li' => array(), |
| [365](#L365) | 'strong' => array(), |
| [366](#L366) | 'em' => array(), |
| [367](#L367) | 'b' => array(), |
| [368](#L368) | 'i' => array(), |
| [369](#L369) | 'a' => array( |
| [370](#L370) | 'href' => array(), |
| [371](#L371) | 'title' => array(), |
| [372](#L372) | 'target' => array(), |
| [373](#L373) | 'rel' => array(), |
| [374](#L374) | ), |
| [375](#L375) | 'img' => array( |
| [376](#L376) | 'src' => array(), |
| [377](#L377) | 'alt' => array(), |
| [378](#L378) | 'width' => array(), |
| [379](#L379) | 'height' => array(), |
| [380](#L380) | 'class' => array(), |
| [381](#L381) | ), |
| [382](#L382) | ); |
| [383](#L383) |  |
| [384](#L384) |  |
| [385](#L385) | ?> |
| [386](#L386) |  |
| [387](#L387) | <div id="<?php echo esc\_attr( basename( \_\_FILE\_\_, '.php' ) ); ?>" class="qahm-admin-page"> |
| [388](#L388) | <div class="wrap"> |
| [389](#L389) | <h1>QA <?php esc\_html\_e( 'Settings', 'qa-heatmap-analytics' ); ?></h1> |
| [390](#L390) | <?php |
| [391](#L391) | if ( $this->wrap\_get\_option( 'google\_is\_redirect' ) ) { |
| [392](#L392) | if ( $qahm\_google\_api->is\_auth() ) { |
| [393](#L393) | $qa\_announce = $this->create\_qa\_announce\_html( esc\_html( \_\_( 'Connected with Google API successfully.', 'qa-heatmap-analytics' ) ), 'success' ); |
| [394](#L394) | echo wp\_kses( $qa\_announce, $qa\_announce\_allowed\_tags ); |
| [395](#L395) | } else { |
| [396](#L396) | $qa\_announce = $this->create\_qa\_announce\_html( esc\_html( \_\_( 'Failed to connect with Google API.', 'qa-heatmap-analytics' ) ), 'error' ); |
| [397](#L397) | echo wp\_kses( $qa\_announce, $qa\_announce\_allowed\_tags ); |
| [398](#L398) | } |
| [399](#L399) | $this->wrap\_update\_option( 'google\_is\_redirect', false ); |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | $form\_google\_disabled = ''; |
| [403](#L403) | if ( $qahm\_google\_api->is\_auth() ) { |
| [404](#L404) | //      $form\_google\_disabled = ' disabled'; |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | $err\_ary = $qahm\_google\_api->test\_search\_console\_connect(); |
| [408](#L408) | if ( $err\_ary ) { |
| [409](#L409) | $err\_text  = esc\_html( \_\_( 'Failed to connect with Google API.', 'qa-heatmap-analytics' ) ) . '<br>'; |
| [410](#L410) | $err\_text .= '<br>'; |
| [411](#L411) | $err\_text .= 'error code: ' . $err\_ary['code'] . '<br>'; |
| [412](#L412) | $err\_text .= 'error message: ' . $err\_ary['message']; |
| [413](#L413) | $qa\_announce\_err = $this->create\_qa\_announce\_html( $err\_text, 'error' ); |
| [414](#L414) | echo wp\_kses( $qa\_announce\_err, $qa\_announce\_allowed\_tags ); |
| [415](#L415) | } |
| [416](#L416) | ?> |
| [417](#L417) | <div class="tabs"> |
| [418](#L418) | <!--mkdummy--> |
| [419](#L419) | <input id="tab\_plugin" type="radio" name="tab\_item" value="plugin" checked> |
| [420](#L420) | <label class="tab\_item" for="tab\_plugin"><span class="qahm\_margin-right4" style="pointer-events: none;"><i class="fas fa-cog"></i> </span><?php echo esc\_html( \_\_( 'Plugin Options', 'qa-heatmap-analytics' ) ); ?></label> |
| [421](#L421) | <input id="tab\_google" type="radio" name="tab\_item" value="google"> |
| [422](#L422) | <label class="tab\_item" for="tab\_google"><span class="qahm\_margin-right4" style="pointer-events: none;"><i class="fab fa-google"></i> </span><?php esc\_html\_e( 'Google API', 'qa-heatmap-analytics' ); ?></label> |
| [423](#L423) | <input id="tab\_goal" type="radio" name="tab\_item" value="goal"> |
| [424](#L424) | <label class="tab\_item" for="tab\_goal"><span class="qahm\_margin-right4" style="pointer-events: none;"><i class="fas fa-crosshairs"></i> </span><?php esc\_html\_e( 'Goals', 'qa-heatmap-analytics' ); ?></label> |
| [425](#L425) | <input id="tab\_attribute" type="radio" name="tab\_item" value="attribute"> |
| [426](#L426) | <label class="tab\_item" for="tab\_attribute"><span class="qahm\_margin-right4" style="pointer-events: none;"><i class="far fa-address-card"></i> </span><?php echo esc\_html( \_\_( 'Site Category', 'qa-heatmap-analytics' ) ); ?></label> |
| [427](#L427) | <!--mkdummy--> |
| [428](#L428) |  |
| [429](#L429) | <?php |
| [430](#L430) | /\*\* ---------------------------- |
| [431](#L431) | \* "Plugin" |
| [432](#L432) | \*/ |
| [433](#L433) | $is\_subscribed = $this->is\_subscribed(); |
| [434](#L434) | if ( $is\_subscribed ) { |
| [435](#L435) | $data\_disabled = ''; |
| [436](#L436) | } else { |
| [437](#L437) | $data\_disabled = ' disabled'; |
| [438](#L438) | } |
| [439](#L439) | $register    = esc\_attr\_\_( 'Register', 'qa-heatmap-analytics' ); |
| [440](#L440) | //$savechanges = esc\_attr\_\_( 'Save Changes', 'qa-heatmap-analytics' ); |
| [441](#L441) | $registerbtn   = $register; |
| [442](#L442) | $already\_registered = false; |
| [443](#L443) | $email = get\_option('admin\_email'); |
| [444](#L444) | $popmail\_cycle = ''; |
| [445](#L445) | $popmail\_day = ''; |
| [446](#L446) |  |
| [447](#L447) | $cb\_sup\_mode = $this->wrap\_get\_option( 'cb\_sup\_mode' ); |
| [448](#L448) | if ( $cb\_sup\_mode === 'yes' ) { |
| [449](#L449) | $cb\_sup\_mode\_checked = ' checked'; |
| [450](#L450) | } else { |
| [451](#L451) | $cb\_sup\_mode\_checked = ''; |
| [452](#L452) | } |
| [453](#L453) | ?> |
| [454](#L454) | <div class="tab\_content" id="tab\_plugin\_content"> |
| [455](#L455) | <div class="bl\_whitediv"> |
| [456](#L456) | <div style="width: 800px"> |
| [457](#L457) |  |
| [458](#L458) | <div class="mail\_config\_section"> |
| [459](#L459) | <h2><?php esc\_html\_e( 'Data Retention Period', 'qa-heatmap-analytics' ); ?></h2> |
| [460](#L460) | <div class="mail\_config\_inputpart"> |
| [461](#L461) | <p><?php echo esc\_html( \_\_( 'For premium plan users only: Set the number of days to retain data. Free plan users are limited to a fixed retention period of 90 days.', 'qa-heatmap-analytics' ) ); ?></p> |
| [462](#L462) | <p><input type="number" name="data\_retention\_dur" id="data\_retention\_dur" value="<?php echo esc\_attr( $this->wrap\_get\_option( 'data\_retention\_dur' ) ); ?>" min="1" max="30000" required<?php echo esc\_attr( $data\_disabled ); ?>> <?php echo esc\_html( \_\_( 'days', 'qa-heatmap-analytics' ) ); ?></p> |
| [463](#L463) | </div> |
| [464](#L464) | </div> |
| [465](#L465) |  |
| [466](#L466) | <div class="mail\_config\_section"> |
| [467](#L467) | <h2><?php echo esc\_html( \_\_( 'Cookie Banner Compatibility Mode', 'qa-heatmap-analytics' ) ); ?><span class="qahm-tooltip" data-qahm-tooltip="<?php echo esc\_attr\_\_('You may want to configure your cookie banner tool. Click to view the guide.', 'qa-heatmap-analytics'); ?>"><a href="https://mem.quarka.org/en/manual/about-cookie-banner-tool/" target="\_blank" rel="noopener" style="color: #1d2327; margin-left: 0.5em;"><i class="far fa-question-circle"></i></a></span></h2> |
| [468](#L468) | <div class="mail\_config\_inputpart"> |
| [469](#L469) | <p><?php echo esc\_html( \_\_( 'Please check this box if your site is using a cookie banner. If left unchecked, the plugin will utilize cookie-based tracking for web traffic measurement.', 'qa-heatmap-analytics' ) ); ?></p> |
| [470](#L470) | <p><input type="checkbox" name="cb\_sup\_mode" id="cb\_sup\_mode"<?php echo esc\_attr( $cb\_sup\_mode\_checked ); ?>></p> |
| [471](#L471) | </div> |
| [472](#L472) | </div> |
| [473](#L473) |  |
| [474](#L474) | <div class="mail\_config\_section"> |
| [475](#L475) | <h2><?php echo esc\_html( \_\_( 'Email Notifications', 'qa-heatmap-analytics' ) ); ?></h2> |
| [476](#L476) | <div class="mail\_config\_inputpart"> |
| [477](#L477) | <p><?php echo esc\_html( \_\_( 'Register an email address to receive notifications about your QA Analytics plugin. If you do not wish to receive notifications, leave this field blank. (This is not a newsletter. Notifications are automatically sent from your WordPress system.)', 'qa-heatmap-analytics' ) ); ?></p> |
| [478](#L478) | <p><input type="email" name="send\_email\_address" id="send\_email\_address" value="<?php echo esc\_attr( $this->wrap\_get\_option( 'send\_email\_address' ) ); ?>"></p> |
| [479](#L479) | </div> |
| [480](#L480) | </div> |
| [481](#L481) |  |
| [482](#L482) |  |
| [483](#L483) | <div> |
| [484](#L484) | <p><button name="plugin-submit" id="plugin-submit" class="button button-primary"><?php esc\_html\_e( 'Save Changes', 'qa-heatmap-analytics' ); ?></button></p> |
| [485](#L485) | </div> |
| [486](#L486) | </div> |
| [487](#L487) | </div> |
| [488](#L488) | </div> |
| [489](#L489) |  |
| [490](#L490) |  |
| [491](#L491) |  |
| [492](#L492) | <?php |
| [493](#L493) | /\*\* -------------------------------- |
| [494](#L494) | \* "Google API" |
| [495](#L495) | \*/ |
| [496](#L496) | ?> |
| [497](#L497) |  |
| [498](#L498) | <div class="tab\_content" id="tab\_google\_content"> |
| [499](#L499) | <h1><?php echo esc\_html\_\_( 'Connect to Google API', 'qa-heatmap-analytics' ); ?></h1> |
| [500](#L500) | <p> |
| [501](#L501) | <?php echo esc\_html( \_\_( 'Integrating with the Google API allows you to retrieve data from Google Search Console.', 'qa-heatmap-analytics' ) ); ?> |
| [502](#L502) | <span class="qahm\_hatena-mark"><i class="far fa-question-circle"></i></span> |
| [503](#L503) | <a href="https://mem.quarka.org/en/manual/connect-to-gsc/" target="\_blank" rel="noopener"><?php echo esc\_html( \_\_( 'How to connect with API', 'qa-heatmap-analytics' ) ); ?><span class="qahm\_link-mark"><i class="fas fa-external-link-alt"></i></span></a> |
| [504](#L504) | </p> |
| [505](#L505) | <form method="post" action=""> |
| [506](#L506) | <?php wp\_nonce\_field( self::NONCE\_ACTION\_GA, self::NONCE\_NAME\_GA, false ); ?> |
| [507](#L507) |  |
| [508](#L508) | <table class="form-table"> |
| [509](#L509) | <tbody> |
| [510](#L510) | <tr> |
| [511](#L511) | <th scope="row"> |
| [512](#L512) | <label for="client\_id"> |
| [513](#L513) | <?php echo esc\_html( \_\_( 'Client ID', 'qa-heatmap-analytics' ) ); ?> |
| [514](#L514) | </label> |
| [515](#L515) | </th> |
| [516](#L516) | <td> |
| [517](#L517) | <input name="client\_id" type="text" id="client\_id" value="<?php echo esc\_attr( $qahm\_google\_api->get\_client\_id() ); ?>" class="regular-text"<?php echo esc\_attr($form\_google\_disabled); ?>> |
| [518](#L518) | </td> |
| [519](#L519) | </tr> |
| [520](#L520) |  |
| [521](#L521) | <tr> |
| [522](#L522) | <th scope="row"> |
| [523](#L523) | <label for="client\_secret"> |
| [524](#L524) | <?php echo esc\_html( \_\_( 'Client Secret', 'qa-heatmap-analytics' ) ); ?> |
| [525](#L525) | </label> |
| [526](#L526) | </th> |
| [527](#L527) | <td> |
| [528](#L528) | <input name="client\_secret" type="text" id="client\_secret" value="<?php echo esc\_attr( $qahm\_google\_api->get\_client\_secret() ); ?>" class="regular-text"<?php echo esc\_attr($form\_google\_disabled); ?>> |
| [529](#L529) | <?php |
| [530](#L530) | if ( $form\_google\_disabled !== '' ) { |
| [531](#L531) | echo '<span id="client\_info\_disabled\_text" style="font size: 0.9em; color: #2271b1; cursor: pointer; text-decoration: underline;">&nbsp;' . esc\_html( \_\_( 'Unlock the button\'s disabled' , 'qa-heatmap-analytics' ) ) . '</span>'; |
| [532](#L532) | } |
| [533](#L533) | ?> |
| [534](#L534) | </td> |
| [535](#L535) | </tr> |
| [536](#L536) |  |
| [537](#L537) | <tr> |
| [538](#L538) | <th scope="row"> |
| [539](#L539) | <label for="redirect\_uri"> |
| [540](#L540) | <?php echo esc\_html( \_\_( 'Redirect URI', 'qa-heatmap-analytics' ) ); ?> |
| [541](#L541) | </label> |
| [542](#L542) | </th> |
| [543](#L543) | <td> |
| [544](#L544) | <p><?php echo esc\_attr( admin\_url( 'admin.php?page=qahm-config' ) ); ?></p> |
| [545](#L545) | </td> |
| [546](#L546) | </tr> |
| [547](#L547) |  |
| [548](#L548) | <tr> |
| [549](#L549) | <td colspan="2"> |
| [550](#L550) | <p class="submit" style="text-align: center"> |
| [551](#L551) | <input type="submit" name="submit" id="submit" class="button button-primary" value="<?php esc\_attr\_e( 'Authenticate', 'qa-heatmap-analytics' ); ?>"> |
| [552](#L552) | </p> |
| [553](#L553) | </td> |
| [554](#L554) | </tr> |
| [555](#L555) |  |
| [556](#L556) | <tr> |
| [557](#L557) | <td colspan="2"> |
| [558](#L558) | <p style="font-size: 13px;"> |
| [559](#L559) | <?php |
| [560](#L560) | if ( $access\_token ) { |
| [561](#L561) | echo esc\_html\_\_( 'Authentication is complete and the token has been obtained. If the integration isn\'t working properly, please click the "Authenticate" button again to re-authenticate.', 'qa-heatmap-analytics' ); |
| [562](#L562) | } |
| [563](#L563) | ?> |
| [564](#L564) | </p> |
| [565](#L565) | </td> |
| [566](#L566) | </tr> |
| [567](#L567) | </tbody> |
| [568](#L568) | </table> |
| [569](#L569) | </form> |
| [570](#L570) |  |
| [571](#L571) | </div><!-- endof #tab\_google\_content --> |
| [572](#L572) |  |
| [573](#L573) |  |
| [574](#L574) | <?php |
| [575](#L575) | /\*\* ---------------------------- |
| [576](#L576) | \* "Goal" |
| [577](#L577) | \*/ |
| [578](#L578) | ?> |
| [579](#L579) | <div class="tab\_content" id="tab\_goal\_content"> |
| [580](#L580) | <div class="tab\_content\_description"> |
| [581](#L581) | <p><?php esc\_html\_e( 'Your goals not only appear in the "Goals" report on the Home screen but also that relevant data is displayed in the goal metrics of each report. Set your goals to track your progress effectively!', 'qa-heatmap-analytics' ); ?></p> |
| [582](#L582) | <h2><?php esc\_html\_e( 'Goal setup', 'qa-heatmap-analytics' ); ?></h2> |
| [583](#L583) | <p class="el\_caption"><?php esc\_html\_e( 'You can change these goals at any time. This will not affect the collected data. The value will be recalculated each time.', 'qa-heatmap-analytics' ); ?> <span class="qahm\_hatena-mark"><i class="far fa-question-circle"></i></span><a href="https://mem.quarka.org/en/manual/goal-setting/" target="\_blank" rel="noopener"><?php esc\_html\_e( 'How to set goal', 'qa-heatmap-analytics' ); ?><span class="qahm\_link-mark"><i class="fas fa-external-link-alt"></i></span></a></p> |
| [584](#L584) |  |
| [585](#L585) | <div id="step2"> |
| [586](#L586) |  |
| [587](#L587) | <?php |
| [588](#L588) | $gtype\_iframe\_display = array\_fill(1, $GOALMAX, 'display: none'); |
| [589](#L589) | for ($iii = 1; $iii <= $GOALMAX; $iii++) { |
| [590](#L590) | $gtitle = isset($goals\_ary[$iii]['gtitle']) ? esc\_html(urldecode($goals\_ary[$iii]['gtitle'])) : ''; |
| [591](#L591) | $gnum\_scale = isset($goals\_ary[$iii]['gnum\_scale']) ? esc\_attr(urldecode($goals\_ary[$iii]['gnum\_scale'])) : 0; |
| [592](#L592) | $gnum\_value = isset($goals\_ary[$iii]['gnum\_value']) ? esc\_attr(urldecode($goals\_ary[$iii]['gnum\_value'])) : 0; |
| [593](#L593) | $gtype = isset($goals\_ary[$iii]['gtype']) ? esc\_attr(urldecode($goals\_ary[$iii]['gtype'])) : 'gtype\_page'; |
| [594](#L594) | $g\_goalpage = isset($goals\_ary[$iii]['g\_goalpage']) ? esc\_url(urldecode($goals\_ary[$iii]['g\_goalpage'])) : ''; |
| [595](#L595) | $g\_pagematch = isset($goals\_ary[$iii]['g\_pagematch']) ? esc\_attr(urldecode($goals\_ary[$iii]['g\_pagematch'])) : ''; |
| [596](#L596) | $g\_clickpage = isset($goals\_ary[$iii]['g\_clickpage']) ? esc\_url(urldecode($goals\_ary[$iii]['g\_clickpage'])) : ''; |
| [597](#L597) | $g\_eventtype = isset($goals\_ary[$iii]['g\_eventtype']) ? esc\_attr(urldecode($goals\_ary[$iii]['g\_eventtype'])) : ''; |
| [598](#L598) | $g\_clickselector = isset($goals\_ary[$iii]['g\_clickselector']) ? esc\_attr(urldecode($goals\_ary[$iii]['g\_clickselector'])) : ''; |
| [599](#L599) | $g\_eventselector = isset($goals\_ary[$iii]['g\_eventselector']) ? esc\_attr(urldecode($goals\_ary[$iii]['g\_eventselector'])) : ''; |
| [600](#L600) |  |
| [601](#L601) | $gtype\_checked = array\_fill(0, 3, ''); |
| [602](#L602) | $gtype\_required = array\_fill(0, 3, ''); |
| [603](#L603) | $pagematch\_checked = array\_fill(0, 2, ''); |
| [604](#L604) | //$gtype\_display = array\_fill(0, 3, 'style="display: none"'); |
| [605](#L605) | $gtype\_display = array\_fill(0, 3, 'display: none'); |
| [606](#L606) |  |
| [607](#L607) | if (!$g\_clickpage) { |
| [608](#L608) | $g\_clickpage = esc\_url($click\_iframe\_url); |
| [609](#L609) | } |
| [610](#L610) |  |
| [611](#L611) | switch ($gtype) { |
| [612](#L612) | case 'gtype\_click': |
| [613](#L613) | $gtype\_checked[1] = 'checked'; |
| [614](#L614) | $gtype\_required[1] = 'required'; |
| [615](#L615) | $gtype\_iframe\_display[$iii] = ''; |
| [616](#L616) | $gtype\_display[1] = ''; |
| [617](#L617) | break; |
| [618](#L618) | case 'gtype\_event': |
| [619](#L619) | $gtype\_checked[2] = 'checked'; |
| [620](#L620) | $gtype\_required[2] = 'required'; |
| [621](#L621) | $gtype\_display[2] = ''; |
| [622](#L622) | break; |
| [623](#L623) | default: |
| [624](#L624) | case 'gtype\_page': |
| [625](#L625) | $gtype\_checked[0] = 'checked'; |
| [626](#L626) | $gtype\_required[0] = 'required'; |
| [627](#L627) | $gtype\_display[0] = ''; |
| [628](#L628) | break; |
| [629](#L629) | } |
| [630](#L630) |  |
| [631](#L631) | switch ($g\_pagematch) { |
| [632](#L632) | case 'pagematch\_prefix': |
| [633](#L633) | $pagematch\_checked[1] = 'checked'; |
| [634](#L634) | break; |
| [635](#L635) | default: |
| [636](#L636) | case 'pagematch\_complete': |
| [637](#L637) | $pagematch\_checked[0] = 'checked'; |
| [638](#L638) | break; |
| [639](#L639) | } |
| [640](#L640) | ?> |
| [641](#L641) | <div class="bl\_goalbox" id="<?php echo esc\_attr( 'g'.$iii.'\_goalbox' ); ?>"> |
| [642](#L642) | <h3><?php echo esc\_html( $goal\_noun . $iii ); ?></h3> |
| [643](#L643) | <form id="<?php echo esc\_attr( 'g'.$iii.'\_form' ); ?>" onsubmit="saveChanges(this);return false"> |
| [644](#L644) | <table> |
| [645](#L645) | <colgroup> |
| [646](#L646) | <col style="width: 15%"> |
| [647](#L647) | <col style="width: 65%"> |
| [648](#L648) | <col style="width: 20%"> |
| [649](#L649) | </colgroup> |
| [650](#L650) | <tbody> |
| [651](#L651) | <tr> |
| [652](#L652) | <td><?php echo esc\_html( $goal\_title ); ?><span class="el\_attention">\*</span></td> |
| [653](#L653) | <td><input type="text" name="<?php echo esc\_attr( 'g'.$iii.'\_title' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_title' ); ?>" required value="<?php echo esc\_attr( $gtitle ); ?>" size="30"></td> |
| [654](#L654) | <td>&nbsp;</td> |
| [655](#L655) | </tr> |
| [656](#L656) | <tr> |
| [657](#L657) | <td><?php echo esc\_html( $goal\_number ); ?></td> |
| [658](#L658) | <td><input type="number" name="<?php echo esc\_attr( 'g'.$iii.'\_num' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_num' ); ?>" value="<?php echo esc\_attr( $gnum\_scale ); ?>" onchange="calcSales(this)"><?php echo esc\_html( $num\_scale ); ?></td> |
| [659](#L659) | <td>&nbsp;&nbsp;</td> |
| [660](#L660) | </tr> |
| [661](#L661) | <tr> |
| [662](#L662) | <td><?php echo esc\_html( $goal\_value ); ?></td> |
| [663](#L663) | <td><input type="number" name="<?php echo esc\_attr( 'g'.$iii.'\_val' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_val' ); ?>" value="<?php echo esc\_attr( $gnum\_value ); ?>" onchange="calcSales(this)"><?php echo esc\_html( $val\_scale ); ?>&nbsp;<p class="right"><?php echo esc\_html( $goal\_sales ); ?> = <span id="<?php echo esc\_attr( 'g'.$iii.'\_calcsales' ); ?>">0</span> <?php echo esc\_html( $val\_scale ); ?></p></td> |
| [664](#L664) | <td>&nbsp;</td> |
| [665](#L665) | </tr> |
| [666](#L666) | <tr> |
| [667](#L667) | <td><?php echo esc\_html( $goal\_type ); ?><span class="el\_attention">\*</span>&nbsp;<span class="el\_loading">Loading<span></span></span></td> |
| [668](#L668) | <td class="td\_gtype\_save" style="opacity: 0"> |
| [669](#L669) | <input type="radio" name="<?php echo esc\_attr( 'g'.$iii.'\_type' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_type\_page' ); ?>" value="gtype\_page" <?php echo esc\_attr( $gtype\_checked[0] ); ?>><label for="<?php echo esc\_attr( 'g'.$iii.'\_type\_page' ); ?>"><?php echo esc\_html( $goal\_type\_page ); ?></label> |
| [670](#L670) | <input type="radio" name="<?php echo esc\_attr( 'g'.$iii.'\_type' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_type\_click' ); ?>" value="gtype\_click" <?php echo esc\_attr( $gtype\_checked[1] ); ?>><label for="<?php echo esc\_attr( 'g'.$iii.'\_type\_click' ); ?>"><?php echo esc\_html( $goal\_type\_click ); ?></label>&nbsp; |
| [671](#L671) | <span><input type="radio" name="<?php echo esc\_attr( 'g'.$iii.'\_type' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_type\_event' ); ?>" value="gtype\_event" <?php echo esc\_attr( $gtype\_checked[2] ); ?>><label for="<?php echo esc\_attr( 'g'.$iii.'\_type\_event' ); ?>"><?php echo esc\_html( $goal\_type\_event ); ?></label></span>&nbsp; |
| [672](#L672) | <br> |
| [673](#L673) | <div id="<?php echo esc\_attr( 'g'.$iii.'\_page\_goal' ); ?>" style="<?php echo esc\_attr( $gtype\_display[0] ); ?>" class="bl\_eachGtypeBox"> |
| [674](#L674) | <label><?php echo esc\_html( $goal\_page ); ?></label><br> |
| [675](#L675) | <input type="radio" name="<?php echo esc\_attr( 'g'.$iii.'\_pagematch' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_pagematch\_prefix' ); ?>" value="pagematch\_prefix" <?php echo esc\_attr( $pagematch\_checked[1] ); ?>><label for="<?php echo esc\_attr( 'g'.$iii.'\_pagematch\_prefix' ); ?>"><?php echo esc\_html( $pagematch\_prefix ); ?></label> |
| [676](#L676) | <input type="radio" name="<?php echo esc\_attr( 'g'.$iii.'\_pagematch' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_pagematch\_complete' ); ?>" value="pagematch\_complete" <?php echo esc\_attr( $pagematch\_checked[0] ); ?>><label for="<?php echo esc\_attr( 'g'.$iii.'\_pagematch\_complete' ); ?>"><?php echo esc\_html( $pagematch\_complete ); ?></label><br> |
| [677](#L677) | <input type="text" name="<?php echo esc\_attr( 'g'.$iii.'\_goalpage' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_goalpage' ); ?>" value="<?php echo esc\_attr( $g\_goalpage ); ?>" <?php echo esc\_attr( $gtype\_required[0] ); ?> size="60"> |
| [678](#L678) | &nbsp; |
| [679](#L679) | </div> |
| [680](#L680) | <div id="<?php echo esc\_attr( 'g'.$iii.'\_click\_goal' ); ?>" style="<?php echo esc\_attr( $gtype\_display[1] ); ?>" class="bl\_eachGtypeBox"> |
| [681](#L681) | <label><?php echo esc\_html( $click\_page ); ?></label><input type="text" name="<?php echo esc\_attr('g'.$iii.'\_clickpage'); ?>" id="<?php echo esc\_attr('g'.$iii.'\_clickpage'); ?>" value="<?php echo esc\_url($g\_clickpage); ?>" <?php echo esc\_attr($gtype\_required[1]); ?> placeholder="<?php echo esc\_url($click\_iframe\_url); ?>" size="40"> |
| [682](#L682) |  |
| [683](#L683) | <button id="<?php echo esc\_attr( 'g'.$iii.'\_click\_pageload' ); ?>" class="button button-secondary" type="button"><?php echo esc\_html( $click\_sel\_load ); ?></button><br> |
| [684](#L684) | <label><?php echo esc\_html( $clickselector ); ?></label><br><input type="text" name="<?php echo esc\_attr( 'g'.$iii.'\_clickselector' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_clickselector' ); ?>" disabled value="<?php echo esc\_attr( $g\_clickselector ); ?>" <?php echo esc\_attr( $gtype\_required[1] ); ?> size="60"> |
| [685](#L685) | <div id="<?php echo esc\_attr( 'g'.$iii.'\_event-iframe-tooltip-right' ); ?>" class="event-iframe-tooltip-right"><?php echo esc\_html( $click\_sel\_set ); ?></div> |
| [686](#L686) | </div> |
| [687](#L687) | <div id="<?php echo esc\_attr( 'g'.$iii.'\_event\_goal' ); ?>" style="<?php echo esc\_attr( $gtype\_display[2] ); ?>" class="bl\_eachGtypeBox"> |
| [688](#L688) | <label><?php echo esc\_html( $eventtype ); ?></label><select name="<?php echo esc\_attr( 'g'.$iii.'\_eventtype' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_eventtype' ); ?>"><option value="onclick"><?php echo esc\_html( $event\_click ); ?></option></select> <br><br> |
| [689](#L689) | <label><?php echo esc\_html( $eventselector ); ?></label><br><input type="text" name="<?php echo esc\_attr( 'g'.$iii.'\_eventselector' ); ?>" id="<?php echo esc\_attr( 'g'.$iii.'\_eventselector' ); ?>" value="<?php echo esc\_attr( $g\_eventselector ); ?>" <?php echo esc\_attr( $gtype\_required[2] ); ?> size="80"> |
| [690](#L690) | <div style="background-color: #eee; padding: 0 10px;"><p><?php echo esc\_html( $example ); ?><br>/.\*ad-link.\*/<br>/\/my-goal-link\//</p></div> |
| [691](#L691) | </div> |
| [692](#L692) | </td> |
| [693](#L693) | <td class="td\_gtype\_save" style="opacity: 0"><input type="submit" name="submit" id="<?php echo esc\_attr( 'g'.$iii.'\_submit' ); ?>" value="<?php echo esc\_html( $savegoal ); ?>" class="button button-primary"><p class="el\_right"><a href="#<?php echo esc\_attr( 'g'.$iii.'\_goalbox' ); ?>" onclick="deleteGoalX(<?php echo esc\_attr( $iii ); ?>)"><?php echo esc\_html( $unset\_goal ); ?></a></p></td> |
| [694](#L694) | </tr> |
| [695](#L695) | </tbody> |
| [696](#L696) | </table> |
| [697](#L697) | <div id="<?php echo esc\_attr( 'g'.$iii.'\_event-iframe-containar' ); ?>" class=".event-iframe-containar" style="<?php echo esc\_attr( $gtype\_iframe\_display[$iii] ); ?>"> |
| [698](#L698) | <iframe id="<?php echo esc\_attr( 'g'.$iii.'\_event-iframe' ); ?>" class="event-iframe" src="<?php echo esc\_attr( $g\_clickpage ); ?>" frameborder="0" width="1200" height="400" scrolling="yes"></iframe> |
| [699](#L699) | </div> |
| [700](#L700) | </form> |
| [701](#L701) | </div> |
| [702](#L702) |  |
| [703](#L703) | <?php |
| [704](#L704) | }  //end for |
| [705](#L705) | ?> |
| [706](#L706) |  |
| [707](#L707) |  |
| [708](#L708) | </div> |
| [709](#L709) | </div> |
| [710](#L710) | </div><!-- endof #tab\_goal\_content --> |
| [711](#L711) |  |
| [712](#L712) |  |
| [713](#L713) |  |
| [714](#L714) | <?php |
| [715](#L715) | /\*\* -------------------------------- |
| [716](#L716) | \* "Site Category" |
| [717](#L717) | \*/ |
| [718](#L718) | ?> |
| [719](#L719) | <div class="tab\_content" id="tab\_attribute\_content"> |
| [720](#L720) | <div id="step1"> |
| [721](#L721) | <?php |
| [722](#L722) | $formtags[0] = <<<EOL |
| [723](#L723) | <form id="siteinfo\_form" onsubmit="siteinfoChanges(this);return false"> |
| [724](#L724) | <h3>{$lang\_ja['target\_user\_question']}</h3> |
| [725](#L725) | EOL; |
| [726](#L726) | echo wp\_kses($formtags[0], array( |
| [727](#L727) | 'form' => array('id' => array(), 'onsubmit' => array()), |
| [728](#L728) | 'h3' => array(), |
| [729](#L729) | )); |
| [730](#L730) |  |
| [731](#L731) | $target\_ary = ['target\_individual', 'target\_corporation']; |
| [732](#L732) | foreach ($target\_ary as $target) { |
| [733](#L733) | $checked = ''; |
| [734](#L734) | if (isset($siteinfo\_ary['target\_customer']) && $target === $siteinfo\_ary['target\_customer']) { |
| [735](#L735) | $checked = 'checked'; |
| [736](#L736) | } |
| [737](#L737) | $radio\_target = <<<EOL |
| [738](#L738) | <input type="radio" name="target\_customer" id="{$target}" value="{$target}" $checked><label for="{$target}">{$lang\_ja[$target]}</label> |
| [739](#L739) | EOL; |
| [740](#L740) | echo wp\_kses($radio\_target, array( |
| [741](#L741) | 'input' => array('type' => array(), 'name' => array(), 'id' => array(), 'value' => array(), 'checked' => array()), |
| [742](#L742) | 'label' => array('for' => array()), |
| [743](#L743) | )); |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | $formtags[1] = <<<EOL |
| [747](#L747) | <h3>{$lang\_ja['select\_sitetype\_question']}</h3> |
| [748](#L748) | <table> |
| [749](#L749) | <thead> |
| [750](#L750) | <th>{$lang\_ja['general']}</th> |
| [751](#L751) | <th>{$lang\_ja['media']}</th> |
| [752](#L752) | <th>{$lang\_ja['service']}</th> |
| [753](#L753) | <th>{$lang\_ja['ec\_mall']}</th> |
| [754](#L754) | </thead> |
| [755](#L755) | <tbody> |
| [756](#L756) | <tr> |
| [757](#L757) | EOL; |
| [758](#L758) | echo wp\_kses($formtags[1], array( |
| [759](#L759) | 'h3' => array(), |
| [760](#L760) | 'table' => array(), |
| [761](#L761) | 'thead' => array(), |
| [762](#L762) | 'tbody' => array(), |
| [763](#L763) | 'tr' => array(), |
| [764](#L764) | 'th' => array(), |
| [765](#L765) | )); |
| [766](#L766) |  |
| [767](#L767) | foreach ($sitetype\_ary as $lpcnt => $sitetype) { |
| [768](#L768) | $checked = ''; |
| [769](#L769) | if (isset($siteinfo\_ary['sitetype']) && $sitetype === $siteinfo\_ary['sitetype']) { |
| [770](#L770) | $checked = 'checked'; |
| [771](#L771) | } |
| [772](#L772) | $radio\_sitetype = <<<EOL |
| [773](#L773) | <td><input type="radio" name="sitetype" id="{$sitetype}" value="{$sitetype}" $checked><label for="{$sitetype}">{$lang\_ja[$sitetype]}</label></td> |
| [774](#L774) | EOL; |
| [775](#L775) | echo wp\_kses($radio\_sitetype, array( |
| [776](#L776) | 'td' => array(), |
| [777](#L777) | 'input' => array('type' => array(), 'name' => array(), 'id' => array(), 'value' => array(), 'checked' => array()), |
| [778](#L778) | 'label' => array('for' => array()), |
| [779](#L779) | )); |
| [780](#L780) |  |
| [781](#L781) | $nowtd = $lpcnt + 1; |
| [782](#L782) | if ($nowtd === 14) { |
| [783](#L783) | echo wp\_kses('<td>&nbsp;</td>' . PHP\_EOL, array('td' => array())); |
| [784](#L784) | } |
| [785](#L785) | if (14 <= $nowtd) { |
| [786](#L786) | $nowtd++; |
| [787](#L787) | } |
| [788](#L788) | if ($nowtd % 4 === 0) { |
| [789](#L789) | echo wp\_kses('</tr>' . PHP\_EOL, array('tr' => array())); |
| [790](#L790) | if ($nowtd !== 16) { |
| [791](#L791) | echo wp\_kses('<tr>' . PHP\_EOL, array('tr' => array())); |
| [792](#L792) | } |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | $formtags[2] = <<<EOL |
| [797](#L797) | </tbody> |
| [798](#L798) | </table> |
| [799](#L799) | <h3>{$lang\_ja['membership\_question']}</h3> |
| [800](#L800) | EOL; |
| [801](#L801) | echo wp\_kses($formtags[2], array( |
| [802](#L802) | 'h3' => array(), |
| [803](#L803) | 'table' => array(), |
| [804](#L804) | 'tbody' => array(), |
| [805](#L805) | 'tr' => array(), |
| [806](#L806) | )); |
| [807](#L807) |  |
| [808](#L808) | $membership\_ary = ['membership\_no', 'membership\_yes']; |
| [809](#L809) | foreach ($membership\_ary as $membership) { |
| [810](#L810) | $checked = ''; |
| [811](#L811) | if (isset($siteinfo\_ary['membership']) && $membership === $siteinfo\_ary['membership']) { |
| [812](#L812) | $checked = 'checked'; |
| [813](#L813) | } |
| [814](#L814) | $radio\_membership = <<<EOL |
| [815](#L815) | <input type="radio" name="membership" id="{$membership}" value="{$membership}" $checked><label for="{$membership}">{$lang\_ja[$membership]}</label> |
| [816](#L816) | EOL; |
| [817](#L817) | echo wp\_kses($radio\_membership, array( |
| [818](#L818) | 'input' => array('type' => array(), 'name' => array(), 'id' => array(), 'value' => array(), 'checked' => array()), |
| [819](#L819) | 'label' => array('for' => array()), |
| [820](#L820) | )); |
| [821](#L821) | } |
| [822](#L822) |  |
| [823](#L823) | $formtags[3] = <<<EOL |
| [824](#L824) | <h3>{$lang\_ja['payment\_question']}</h3> |
| [825](#L825) | EOL; |
| [826](#L826) | echo wp\_kses($formtags[3], array('h3' => array())); |
| [827](#L827) |  |
| [828](#L828) | $payment\_ary = ['payment\_no', 'payment\_yes', 'payment\_cart']; |
| [829](#L829) | foreach ($payment\_ary as $payment) { |
| [830](#L830) | $checked = ''; |
| [831](#L831) | if (isset($siteinfo\_ary['payment']) && $payment === $siteinfo\_ary['payment']) { |
| [832](#L832) | $checked = 'checked'; |
| [833](#L833) | } |
| [834](#L834) | $radio\_payment = <<<EOL |
| [835](#L835) | <input type="radio" name="payment" id="{$payment}" value="{$payment}" $checked><label for="{$payment}">{$lang\_ja[$payment]}</label> |
| [836](#L836) | EOL; |
| [837](#L837) | echo wp\_kses($radio\_payment, array( |
| [838](#L838) | 'input' => array('type' => array(), 'name' => array(), 'id' => array(), 'value' => array(), 'checked' => array()), |
| [839](#L839) | 'label' => array('for' => array()), |
| [840](#L840) | )); |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | $month\_later = isset($siteinfo\_ary['month\_later']) ? esc\_attr($siteinfo\_ary['month\_later']) : ''; |
| [844](#L844) | $session\_goal = isset($siteinfo\_ary['session\_goal']) ? esc\_attr($siteinfo\_ary['session\_goal']) : ''; |
| [845](#L845) | $formtags[4] = <<<EOL |
| [846](#L846) | <h3>{$lang\_ja['goal\_monthly\_access\_question']}</h3> |
| [847](#L847) | <input type="number" name="month\_later" id="month\_later" value="{$month\_later}"><label for="month\_later">{$lang\_ja['month\_later']}</label>&nbsp; |
| [848](#L848) | <input type="number" name="session\_goal" id="session\_goal" value="{$session\_goal}"><label for="session\_goal">{$lang\_ja['session\_goal']}</label> |
| [849](#L849) | <p><input type="submit" value="{$lang\_ja['save']}"></p> |
| [850](#L850) | </form> |
| [851](#L851) | EOL; |
| [852](#L852) | echo wp\_kses($formtags[4], array( |
| [853](#L853) | 'h3' => array(), |
| [854](#L854) | 'input' => array('type' => array(), 'name' => array(), 'id' => array(), 'value' => array(), 'checked' => array()), |
| [855](#L855) | 'label' => array('for' => array()), |
| [856](#L856) | 'p' => array(), |
| [857](#L857) | 'form' => array(), |
| [858](#L858) | )); |
| [859](#L859) | ?> |
| [860](#L860) | </div> |
| [861](#L861) | </div><!-- endof #tab\_attribute\_content --> |
| [862](#L862) |  |
| [863](#L863) | </div> |
| [864](#L864) | </div> |
| [865](#L865) | </div> |
| [866](#L866) |  |
| [867](#L867) |  |
| [868](#L868) | <?php |
| [869](#L869) | } |
| [870](#L870) |  |
| [871](#L871) | /\*\* |
| [872](#L872) | \* 設定画面の項目をデータベースに保存する |
| [873](#L873) | \*/ |
| [874](#L874) | public function ajax\_save\_plugin\_config() { |
| [875](#L875) |  |
| [876](#L876) | if ( !check\_ajax\_referer( self::NONCE\_ACTION\_QAOP, 'security', false ) ) { |
| [877](#L877) | wp\_send\_json\_error('Invalid nonce'); |
| [878](#L878) | wp\_die(); |
| [879](#L879) | } |
| [880](#L880) | if ( !$this->check\_qahm\_access\_cap('qahm\_manage\_settings') ) { |
| [881](#L881) | wp\_send\_json\_error('Permission denied'); |
| [882](#L882) | wp\_die(); |
| [883](#L883) | } |
| [884](#L884) | $data\_retention\_dur = (int) $this->wrap\_filter\_input( INPUT\_POST, 'data\_retention\_dur' ); |
| [885](#L885) | $cb\_sup\_mode        = $this->wrap\_filter\_input( INPUT\_POST, 'cb\_sup\_mode' ); |
| [886](#L886) | if ( $cb\_sup\_mode === 'true' ) { |
| [887](#L887) | $cb\_sup\_mode = 'yes'; |
| [888](#L888) | } else { |
| [889](#L889) | $cb\_sup\_mode = 'no'; |
| [890](#L890) | } |
| [891](#L891) | $send\_email\_address = $this->wrap\_filter\_input( INPUT\_POST, 'send\_email\_address' ); |
| [892](#L892) |  |
| [893](#L893) | $this->wrap\_update\_option( 'data\_retention\_dur', $data\_retention\_dur ); |
| [894](#L894) | $this->wrap\_update\_option( 'cb\_sup\_mode', $cb\_sup\_mode ); |
| [895](#L895) | $this->wrap\_update\_option( 'send\_email\_address', $send\_email\_address ); |
| [896](#L896) | } |
| [897](#L897) |  |
| [898](#L898) | } // end of class |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php?format=txt)
* [Original Format](/export/3220343/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_57c0a191_20250110_170231.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# QA Analytics <= 4.1.1.1 - Missing Authorization to Authenticated (Subscriber+) Settings Update

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   QA Analytics <= 4.1.1.1 - Missing Authorization to Authenticated (Subscriber+) Settings Update

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-8513](https://www.cve.org/CVERecord?id=CVE-2024-8513) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | October 9, 2024 |
| Last Updated | October 25, 2024 |
| Researcher | [Peter Thaleikis](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/spek) |

### Description

The QA Analytics – Web Analytics Tool with Heatmaps & Session Replay Across All Pages plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the ajax\_save\_plugin\_config() function in all versions up to, and including, 4.1.1.1. This makes it possible for unauthenticated attackers to update the plugin's settings.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php#L801)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3174701/qa-heatmap-analytics/trunk/class-qahm-admin-page-config.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fqa-heatmap-analytics%2Fqa-analytics-4100-missing-authorization-to-authenticated-subscriber-settings-update&t=QA%20Analytics%20%3C%3D%204.1.1.1%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fqa-heatmap-analytics%2Fqa-analytics-4100-missing-authorization-to-authenticated-subscriber-settings-update&text=QA%20Analytics%20%3C%3D%204.1.1.1%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fqa-heatmap-analytics%2Fqa-analytics-4100-missing-authorization-to-authenticated-subscriber-settings-update "LinkedIn")
Email

## Vulnerability Details for QA Analytics – with Heatmaps & Replay, Privacy Friendly

#### [QA Analytics – with Heatmaps & Replay, Privacy Friendly](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/qa-heatmap-analytics)

| Software Type | Plugin |
| --- | --- |
| Software Slug | qa-heatmap-analytics [(view on wordpress.org)](https://wordpress.org/plugins/qa-heatmap-analytics) |
| Patched? | Yes |
| Remediation | Update to version 4.1.1.2, or a newer patched version |
| Affected Version | * <= 4.1.1.1 |
| Patched Version | * 4.1.1.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


