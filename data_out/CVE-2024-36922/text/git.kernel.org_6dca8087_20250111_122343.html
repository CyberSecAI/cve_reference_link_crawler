

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Johannes Berg <johannes.berg@intel.com> | 2024-03-19 10:10:22 +0200 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-03-25 15:23:07 +0100 |
| commit | [c2ace6300600c634553657785dfe5ea0ed688ac2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2ace6300600c634553657785dfe5ea0ed688ac2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)) | |
| tree | [49daa49254a642c5f770826c3cc3d31990a9791a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c2ace6300600c634553657785dfe5ea0ed688ac2) | |
| parent | [045a5b645dd59929b0e05375f493cde3a0318271](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=045a5b645dd59929b0e05375f493cde3a0318271) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2ace6300600c634553657785dfe5ea0ed688ac2&id2=045a5b645dd59929b0e05375f493cde3a0318271)) | |
| download | [linux-c2ace6300600c634553657785dfe5ea0ed688ac2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c2ace6300600c634553657785dfe5ea0ed688ac2.tar.gz) | |

wifi: iwlwifi: read txq->read\_ptr under lockIf we read txq->read\_ptr without lock, we can read the same
value twice, then obtain the lock, and reclaim from there
to two different places, but crucially reclaim the same
entry twice, resulting in the WARN\_ONCE() a little later.
Fix that by reading txq->read\_ptr under lock.
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Miri Korenblit <miriam.rachel.korenblit@intel.com>
Link: [https://msgid.link/20240319100755.bf4c62196504.I978a7ca56c6bd6f1bf42c15aa923ba03366a840b@changeid](https://msgid.link/20240319100755.bf4c62196504.I978a7ca56c6bd6f1bf42c15aa923ba03366a840b%40changeid)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2ace6300600c634553657785dfe5ea0ed688ac2)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/queue/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/queue/tx.c?id=c2ace6300600c634553657785dfe5ea0ed688ac2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/queue/tx.c b/drivers/net/wireless/intel/iwlwifi/queue/tx.cindex 33973a60d0bf41..6229c785c84576 100644--- a/[drivers/net/wireless/intel/iwlwifi/queue/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/queue/tx.c?id=045a5b645dd59929b0e05375f493cde3a0318271)+++ b/[drivers/net/wireless/intel/iwlwifi/queue/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/queue/tx.c?id=c2ace6300600c634553657785dfe5ea0ed688ac2)@@ -1589,9 +1589,9 @@ void iwl\_txq\_reclaim(struct iwl\_trans \*trans, int txq\_id, int ssn, return;  tfd\_num = iwl\_txq\_get\_cmd\_index(txq, ssn);- read\_ptr = iwl\_txq\_get\_cmd\_index(txq, txq->read\_ptr);  spin\_lock\_bh(&txq->lock);+ read\_ptr = iwl\_txq\_get\_cmd\_index(txq, txq->read\_ptr);  if (!test\_bit(txq\_id, trans->txqs.queue\_used)) { IWL\_DEBUG\_TX\_QUEUES(trans, "Q %d inactive - ignoring idx %d\n", |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 12:22:20 +0000

