- **Root cause of vulnerability:** Improper implementation of the TP-Link MQTT Broker and API gateway fails to enforce consistency of device identity. Specifically, the API does not properly validate the `deviceId` in the request body of `/common/v1/uploadDeviceInfo`, while it does validate the `deviceId` and `deviceToken` in request parameters.
- **Weaknesses/vulnerabilities present:** Inadequate validation of the `deviceId` in the request body, leading to horizontal privilege escalation.
- **Impact of exploitation:** An authenticated attacker can impersonate another legitimate device, report false device properties, and potentially prevent the legitimate user from accessing the device through the mobile application. This can affect the device properties displayed on the mobile app and potentially make the device inaccessible.
- **Attack vectors:** The attacker exploits the vulnerability by intercepting MQTT messages, modifying the `deviceId` in the request body of `/common/v1/uploadDeviceInfo` and sending the modified request through an authenticated device. The attacker can perform the attack from any node between the device and the TP-Link Cloud service.
- **Required attacker capabilities/position:** The attacker needs to have a legitimate TP-Link device that can authenticate with the MQTT broker. They also need to be able to intercept and modify MQTT messages.