=== Content from phabricator.wikimedia.org_46f625f6_20250110_120257.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT326865)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T326865
# CVE-2024-40597: Special:CheckUser can expose suppressed information for log eventsClosed, Resolved[Public](/policy/explain/PHID-TASK-3wqebfckd6fbb42tbsqi/view/)2 Estimated Story PointsBUG REPORTActions

* [Edit Task](/maniphest/task/edit/326865/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/326865/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Protect as security issue](/wmf/escalate-task/326865/)
* [Award Token](/token/give/PHID-TASK-3wqebfckd6fbb42tbsqi/)
* [Flag For Later](/flag/edit/PHID-TASK-3wqebfckd6fbb42tbsqi/)

Assigned To

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

Authored By

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |
| Jan 12 2023, 9:05 PM2023-01-12 21:05:59 (UTC+0) |

Tags

* [Security](/tag/security/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [SecTeam-Processed](/tag/secteam-processed/) [(Completed)](/project/board/5180/)
* [CheckUser](/tag/checkuser/) [(CheckUser)](/project/board/203/)
* [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) [(Done)](/project/board/7061/)
* [Trust and Safety Product Team](/tag/trust_and_safety_product_team/) [(Inbox)](/project/board/6807/)
* [MW-1.43-notes (1.43.0-wmf.1; 2024-04-16)](/project/view/7085/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [DannyS712](/p/DannyS712/) |
| --- | --- |

|  | [dom\_walden](/p/dom_walden/) |
| --- | --- |

|  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) |
| --- | --- |

|  | [mmartorana](/p/mmartorana/) |
| --- | --- |

|  | [RoySmith](/p/RoySmith/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

[View All 10 Subscribers](/subscriptions/list/PHID-TASK-3wqebfckd6fbb42tbsqi/)
# Description

Splitting from [T311337](/T311337). Not setting as a security ticket as the cat is out of the bag.

Log actions stored by CheckUser that are in the logging table (and thus can be suppressed) are not hidden as CheckUser does not store the log ID so that it can look up the revision deletion status. This means that checkusers who do not have the oversight permissions can access oversighted logs.

To do this CheckUser needs to store any associated log ID. This will be done in [T324907](/T324907). Once this has been achieved this can be fixed.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [Respect log\_deleted in Special:CheckUser 'Get actions'](https://gerrit.wikimedia.org/r/c/1018782) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +89 -19 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T326865)
# Related ObjectsSearch...

* Task Graph
* Mentions

[View Standalone Graph](/maniphest/graph/326865/)This task is connected to more than 200 other tasks. Only direct parents and subtasks are shown here. Use **View Standalone Graph** to show more of the graph.

|  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- |
|  |  |  |  | · · · |
|  | Resolved | BUG REPORT | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T326865 [CVE-2024-40597: Special:CheckUser can expose suppressed information for log events](/T326865) |
|  | Resolved |  | [Dreamy\_Jazz](/p/Dreamy_Jazz/) | T253796 [Make CheckUser record the log\_id of logged actions](/T253796) |
|  |  |  |  | · · · |

Mentioned In [T268147: CVE-2024-40611: Special:CheckUser shows deleted edits to non-admins](/T268147)
[T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321)
[T316360: Oversighted action text is shown in Special:CheckUser when the checkuser does not have the right to see it](/T316360)
[T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659)
[T343983: Error: Call to a member function getTimestamp() on null](/T343983)
[T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874)
[T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626)
[T330968: CVE-2023-37252: Special:CheckUserLog shows usernames which have been hidden](/T330968)
[T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849)
[T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337) Mentioned Here [T326867: CVE-2024-40598: CheckUser API can expose suppressed information for log events](/T326867)
[T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337)
[T324907: Create separate tables for log events in CheckUser](/T324907)
### Event Timeline

[Dreamy\_Jazz](/p/Dreamy_Jazz/) created this task.[Jan 12 2023, 9:05 PM2023-01-12 21:05:59 (UTC+0)](#8521514)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5127852/)[Jan 12 2023, 9:05 PM2023-01-12 21:05:59 (UTC+0)](#8521527)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T311337: CVE-2022-39193: Edits with the performer suppressed still show the performer in results from the CheckUser extension](/T311337).[Jan 12 2023, 9:11 PM2023-01-12 21:11:02 (UTC+0)](#8521579)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a subtask: [T253796: Make CheckUser record the log\_id of logged actions](/T253796).[Jan 12 2023, 9:34 PM2023-01-12 21:34:09 (UTC+0)](#8521661)[sbassett](/p/sbassett/) edited projects, added [SecTeam-Processed](/tag/secteam-processed/); removed [Security-Team](/tag/security-team/).[Jan 17 2023, 5:13 PM2023-01-17 17:13:37 (UTC+0)](#8531688)[Aklapper](/p/Aklapper/) added a project: [CheckUser](/tag/checkuser/).[Jan 18 2023, 4:18 PM2023-01-18 16:18:31 (UTC+0)](#8535559)[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Inbox](/project/board/203/) to [CheckUser](/project/board/203/) on the [CheckUser](/tag/checkuser/) board.[Jan 18 2023, 9:48 PM2023-01-18 21:48:02 (UTC+0)](#8538462)[Dreamy\_Jazz](/p/Dreamy_Jazz/) triaged this task as High priority.[Jan 19 2023, 8:21 PM2023-01-19 20:21:46 (UTC+0)](#8541798)[sbassett](/p/sbassett/) mentioned this in [T325849: Write and send supplementary release announcement for extensions and skins with security patches (1.35.10/1.38.6/1.39.3)](/T325849).[Jan 23 2023, 6:14 PM2023-01-23 18:14:51 (UTC+0)](#8550290)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T330968: CVE-2023-37252: Special:CheckUserLog shows usernames which have been hidden](/T330968).[Mar 24 2023, 4:40 PM2023-03-24 16:40:44 (UTC+0)](#8725336)[Xaosflux](/p/Xaosflux/) subscribed.[Mar 24 2023, 5:30 PM2023-03-24 17:30:02 (UTC+0)](#8725437)[RoySmith](/p/RoySmith/) subscribed.[Mar 24 2023, 5:44 PM2023-03-24 17:44:08 (UTC+0)](#8725471)[sbassett](/p/sbassett/) mentioned this in [T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626).[Apr 4 2023, 7:48 PM2023-04-04 19:48:43 (UTC+0)](#8756459)[sbassett](/p/sbassett/) mentioned this in [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874).[Jul 6 2023, 3:27 PM2023-07-06 15:27:54 (UTC+0)](#8994374)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T343983: Error: Call to a member function getTimestamp() on null](/T343983).[Sep 15 2023, 8:07 AM2023-09-15 08:07:54 (UTC+0)](#9169077)[sbassett](/p/sbassett/) mentioned this in [T347659: Write and send supplementary release announcement for extensions and skins with security patches (1.35.14/1.39.6/1.40.2/1.41.0)](/T347659).[Oct 2 2023, 10:31 PM2023-10-02 22:31:38 (UTC+0)](#9218049)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T316360: Oversighted action text is shown in Special:CheckUser when the checkuser does not have the right to see it](/T316360).[Oct 4 2023, 2:43 PM2023-10-04 14:43:51 (UTC+0)](#9225139)[Dreamy\_Jazz](/p/Dreamy_Jazz/) claimed this task.[Apr 10 2024, 1:38 PM2024-04-10 13:38:43 (UTC+0)](#9703850)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added projects: [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/), [Trust and Safety Product Team](/tag/trust_and_safety_product_team/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Priority Backlog](/project/board/7061/) to [In Progress](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Dreamy\_Jazz](/p/Dreamy_Jazz/) set the point value for this task to 2.[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed subtask [T253796: Make CheckUser record the log\_id of logged actions](/T253796) as Resolved.[Apr 10 2024, 1:41 PM2024-04-10 13:41:20 (UTC+0)](#9703863)[Dreamy\_Jazz](/p/Dreamy_Jazz/) merged a task: Restricted Task.[Apr 10 2024, 1:49 PM2024-04-10 13:49:34 (UTC+0)](#9703905)[Dreamy\_Jazz](/p/Dreamy_Jazz/) merged a task: Restricted Task.[Dreamy\_Jazz](/p/Dreamy_Jazz/) added subscribers: [sbassett](/p/sbassett/), [DannyS712](/p/DannyS712/), [Urbanecm](/p/Urbanecm/), [Vermont](/p/Vermont/).[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a subscriber: [Umherirrender](/p/Umherirrender/).[gerritbot](/p/gerritbot/) added a comment.[Apr 10 2024, 8:13 PM2024-04-10 20:13:15 (UTC+0)](#9705192)Comment Actions

Change #1018782 had a related patch set uploaded (by Dreamy Jazz; author: Dreamy Jazz):

[mediawiki/extensions/CheckUser@master] Respect log\_deleted in Special:CheckUser 'Get actions'

<https://gerrit.wikimedia.org/r/1018782>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Apr 10 2024, 8:13 PM2024-04-10 20:13:16 (UTC+0)](#9705193)[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [In Progress](/project/board/7061/) to [Needs Review](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Apr 10 2024, 8:27 PM2024-04-10 20:27:15 (UTC+0)](#9705284)[Umherirrender](/p/Umherirrender/) unsubscribed.[Apr 10 2024, 8:40 PM2024-04-10 20:40:09 (UTC+0)](#9705307)[Dreamy\_Jazz](/p/Dreamy_Jazz/) merged a task: Restricted Task.[Apr 12 2024, 10:37 AM2024-04-12 10:37:00 (UTC+0)](#9709515)[Dreamy\_Jazz](/p/Dreamy_Jazz/) added a subscriber: [mmartorana](/p/mmartorana/).[gerritbot](/p/gerritbot/) added a comment.[Apr 15 2024, 5:13 PM2024-04-15 17:13:16 (UTC+0)](#9714695)Comment Actions

Change #1018782 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] Respect log\_deleted in Special:CheckUser 'Get actions'

<https://gerrit.wikimedia.org/r/1018782>

[Dreamy\_Jazz](/p/Dreamy_Jazz/) moved this task from [Needs Review](/project/board/7061/) to [Needs QA](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Apr 15 2024, 5:49 PM2024-04-15 17:49:10 (UTC+0)](#9714874)Comment Actions

My suggestion for testing this is to suppress a variety of information for log events and then try to see if any of it is shown in Special:CheckUser, in a similar vein to [T326867](/T326867).

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.43-notes (1.43.0-wmf.1; 2024-04-16)](/project/view/7085/).[Apr 15 2024, 6:00 PM2024-04-15 18:00:37 (UTC+0)](#9714963)[dom\_walden](/p/dom_walden/) moved this task from [Needs QA](/project/board/7061/) to [Done](/project/board/7061/) on the [Trust and Safety Product Sprint (Sprint Tabla (1st - 14th April))](/project/view/7061/) board.[Apr 16 2024, 9:23 AM2024-04-16 09:23:22 (UTC+0)](#9716952)[dom\_walden](/p/dom_walden/) subscribed.Comment Actions

I suppressed all the log entries on my local wiki and then I did a "Get actions" Special:CheckUser request for a username, IP and temporary user. I could not find any references to suppressed usernames for any log entries.

[Dreamy\_Jazz](/p/Dreamy_Jazz/) closed this task as Resolved.[Apr 16 2024, 11:21 AM2024-04-16 11:21:35 (UTC+0)](#9717448)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T361321: Write and send supplementary release announcement for extensions and skins with security patches (1.39.8/1.40.4/1.41.2/1.42.0)](/T361321).[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Apr 26 2024, 6:40 PM2024-04-26 18:40:13 (UTC+0)](#9749379)[Dreamy\_Jazz](/p/Dreamy_Jazz/) mentioned this in [T268147: CVE-2024-40611: Special:CheckUser shows deleted edits to non-admins](/T268147).[May 22 2024, 3:59 PM2024-05-22 15:59:58 (UTC+0)](#9822190)[mmartorana](/p/mmartorana/) renamed this task from Special:CheckUser can expose suppressed information for log events to CVE-2024-40597: Special:CheckUser can expose suppressed information for log events.[Jul 8 2024, 5:33 PM2024-07-08 17:33:59 (UTC+0)](#9962210)[Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
