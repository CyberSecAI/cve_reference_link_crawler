
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FConsensys%2Fgnark%2Fsecurity%2Fadvisories%2FGHSA-q3hw-3gm4-w5cr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FConsensys%2Fgnark%2Fsecurity%2Fadvisories%2FGHSA-q3hw-3gm4-w5cr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=Consensys%2Fgnark)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Consensys](/Consensys)
/
**[gnark](/Consensys/gnark)**
Public

* [Notifications](/login?return_to=%2FConsensys%2Fgnark) You must be signed in to change notification settings
* [Fork
  403](/login?return_to=%2FConsensys%2Fgnark)
* [Star
   1.5k](/login?return_to=%2FConsensys%2Fgnark)

* [Code](/Consensys/gnark)
* [Issues
  106](/Consensys/gnark/issues)
* [Pull requests
  29](/Consensys/gnark/pulls)
* [Discussions](/Consensys/gnark/discussions)
* [Actions](/Consensys/gnark/actions)
* [Security](/Consensys/gnark/security)
* [Insights](/Consensys/gnark/pulse)

Additional navigation options

* [Code](/Consensys/gnark)
* [Issues](/Consensys/gnark/issues)
* [Pull requests](/Consensys/gnark/pulls)
* [Discussions](/Consensys/gnark/discussions)
* [Actions](/Consensys/gnark/actions)
* [Security](/Consensys/gnark/security)
* [Insights](/Consensys/gnark/pulse)

# Groth16 commitment extension unsound for more than one commitment

Moderate

[ivokub](/ivokub)
published
GHSA-q3hw-3gm4-w5cr
Sep 6, 2024

## Package

gomod

github.com/consensys/gnark
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<=v0.10.0

## Patched versions

>=v0.11.0

## Description

### Description

Thanks [@maltezellic](https://github.com/maltezellic) for reporting the issue.

From the correspondence:

> I believe I found another vulnerability in gnark's Groth16 backend's commitments extension, this one impacts soundness whenever more than one commitment is used, making it more critical than the previous issue.
>
> The summary is that the proof of knowledge associated to a commitment is crucial to bind the commitment to the actual circuit variables that were supposed to be committed. However, the same σ is used for all proofs of knowledge for the commitments, which allows mixing between them, making it possible to fix the value of all but one commitment before choosing the circuit variable assignments.
>
> In more detail:
>
> To simplify notation, let us consider the case of two commitments, each to only a single variable. Let's say the basis elements for those commitments are `K_0` and `K_1`. Then the proving key will contain `K_0` and `K_1`, and also `σ*K_0` and `σ*K_1` for the proof of knowledge. The honest prover assigning a to the first circuit variable and b to the second will then produce commitments
>
> `D_0 = a*K_0`
>
> `D_1 = b*K_1`
>
> Out of the two D's, a challenge r for the commitment folding will be generated. The folded commitment will then be
>
> `D_folded = D_0 + r*D_1 = a*K_0 + r*b*K_1`
>
> The honest prover will supply a fitting proof of knowledge
>
> `P = a*(σ*K_0) + r*b*(σ*K_1)`
>
> Now the verifier will only use all of this in two ways:
>
> 1. In the check of the Groth16 proof itself, where only the sum `D_0 + D_1` is used.
> 2. In the proof of knowledge check, where it will be verified that P is indeed `σ*(D_0 + r*D_1)`, with r calculated from `D_0` and `D_1` as before.
>
> This has the following implications. In the following, a malicious prover's points will have an apostrophe appended, and we keep `D_0` etc. for the legitimate values:
>
> 1. A malicious prover is only forced to provide `D'_0` and `D'_1` such that the sum is correct. So they can use arbitrary `D'_0` as long as they set `D'_1 = D_0 + D_1 - D'_0`.
> 2. After choosing `D'_0` and `D'_1`, the prover can always calculate r. Evaluating `σ*(D'_0 + r*D'_1)` is then possible as long as both `D'_0` and `D'_1` are linear combinations of basis elements for which σ times that basis element is known. In particular, this works as long as `D'_0` and `D'_1` are linear combinations of `K_0` and `K_1`.
>
> The upshot is that a malicious prover can choose arbitrary a' and b', and then set
>
> `D'_0 = a'*K_0 + b'*K_1`
>
> `D'_1 = (a - a')*K_0 + (b - b')*K_1`
>
> Then they calculate r for this, and set
>
> `P = (a' + r*(a-a'))*(σ*K_0) + (b' + r*(b-b'))*(σ*K_1)`
>
> This will then be accepted as a valid proof. Yet the first commitment point can be chosen completely independently of a and b, so in particular the malicious prover can use a constant for this, so that they will know the in-circuit challenge that will be added to the public inputs before they have to choose the witness assignments. For most use cases of such challenges (for proving things with Fiat-Shamir, random linear combinations etc.) this causes a critical soundness problem.
>
> The problem generalizes to more than two commitments and commitments to more than one circuit variable each; one can freely choose all but one commitment as arbitrary linear combinations of the basis elements for all commitments, and then must choose the one remaining commitment in such a way that the sum is correct.
>
> The root cause of the issue is that the σ used for the proofs of knowledge is the same, allowing to mix between the basis elements, as one has σ times them available for all of them.
>
> So the fix is to have a separate σ for each commitment. So in our example above, the proving key would have the basis elements `K_0` and `K_1`, and for the proofs of knowledge now `σ_0*K_0` and `σ_1*K_1`. Folding the commitments would not be possible in the same way now, so the verifier will have to do more pairings. The prover could still provide a folded proof of knowledge however. With
>
> `D_0 = a*K_0`
>
> `D_1 = b*K_1`
>
> the proof of knowledge would be
>
> `P = a*(σ_0*K_0) + r*b*(σ_1*K_1)`
>
> For later, let us use notation for the unfolded proofs of knowledge
>
> `P_0 = a*(σ_0*K_0)`
>
> `P_1 = b*(σ_1*K_1)`
>
> so that
>
> `P = P_0 + r*P_1`
>
> The verifying key would need `G` and `σ_0*G` and `σ_1*G`. To check the two unfolded proofs of knowledge would be the checks
>
> `e(P_0, G) = e(D_0, σ_0*G)`
>
> `e(P_1, G) = e(D_1, σ_1*G)`
>
> As r is a challenge derived from D\_0 and D\_1, we may instead check
>
> `e(P_0, G) + r*e(P_1, G) = e(D_0, σ_0*G) + r*e(D_1, σ_1*G)`
>
> The left hand side is
>
> `e(P_0, G) + r*e(P_1, G) = e(P_0 + r*P_1, G) = e(P, G)`
>
> So the prover can just provide P and then the verifier checks
>
> `e(P, G) = e(D_0, σ_0*G) + r*e(D_1, σ_1*G)`
>
> Unfortunately, the right hand side can't be folded as before, as there isn't a side of the pairing that is kept constant between the pairings as before. So the verifier will need to have a pairing for each commitment on the right hand side.
>
> I have checked that the attack I described above works by producing a proof of concept. I attach go.mod and main.go for this, which defines a circuit with two circuit variables A and B, each of which are committed, but then uses fake commitments as discussed before, where the commitment to A will always be zero, even though we assign random values to A and B. To demonstrate that the commitment is actually the zero point, I constrain the challenge from that commitment to be the constant given by the hash of the zero point. To construct a fake proof like this, I patched the prover part of gnark by adding an additional argument for the commitments, and then instead of computing the commitment, the prover just takes those passed by argument. I attach the patch for those changes. If you want to run it, you will likely need to adjust the last line in go.mod that redirects the gnark package to use a local directory in which gnark has been cloned and the patch has been applied. I tried this with the master branch of gnark just now, commit [db299ce](https://github.com/Consensys/gnark/commit/db299cef6c78dc5acff8453b66c910c15ea88123).

### Impact

It is a soundness issue - in case of multiple commitments used inside the circuit the prover is able to choose all but the last commitment. As we use the commitments for optimized non-native multiplication, lookup checks etc. as random challenges, then it could impact the soundness of the whole circuit.

However, using multiple commitments has been discouraged due to the additional cost to the verifier and it has not been supported in the recursive in-circuit Groth16 verifier and Solidity verifier. So we expect the impact of the issue be very small - only for the users who have implemented the native Groth16 verifier or are using it with multiple commitments. We do not have information of such users.

### Patches

The issue has been patched in e7c66b000454f4d2a4ae48c005c34154d4cfc2a2

### Workarounds

The recommendation has been to use only a single commitment and then derive in-circuit commitments as needed using [std/multicommit](https://pkg.go.dev/github.com/consensys/gnark/std/multicommit) package.

### References

See the correspondence above.

### Severity

Moderate

6.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N

### CVE ID

CVE-2024-45039

### Weaknesses

No CWEs

### Credits

* [![@maltezellic](https://avatars.githubusercontent.com/u/147443723?s=40&v=4)](/maltezellic)
  [maltezellic](/maltezellic)
  Reporter
* [![@ivokub](https://avatars.githubusercontent.com/u/1309050?s=40&v=4)](/ivokub)
  [ivokub](/ivokub)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

