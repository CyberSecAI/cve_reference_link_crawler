
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Fmio%2Fpull%2F1760)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Fmio%2Fpull%2F1760)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=tokio-rs%2Fmio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tokio-rs](/tokio-rs)
/
**[mio](/tokio-rs/mio)**
Public

* [Notifications](/login?return_to=%2Ftokio-rs%2Fmio) You must be signed in to change notification settings
* [Fork
  744](/login?return_to=%2Ftokio-rs%2Fmio)
* [Star
   6.5k](/login?return_to=%2Ftokio-rs%2Fmio)

* [Code](/tokio-rs/mio)
* [Issues
  17](/tokio-rs/mio/issues)
* [Pull requests
  3](/tokio-rs/mio/pulls)
* [Actions](/tokio-rs/mio/actions)
* [Security](/tokio-rs/mio/security)
* [Insights](/tokio-rs/mio/pulse)

Additional navigation options

* [Code](/tokio-rs/mio)
* [Issues](/tokio-rs/mio/issues)
* [Pull requests](/tokio-rs/mio/pulls)
* [Actions](/tokio-rs/mio/actions)
* [Security](/tokio-rs/mio/security)
* [Insights](/tokio-rs/mio/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftokio-rs%2Fmio%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftokio-rs%2Fmio%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# named-pipes: fix receiving IOCP events after deregister #1760

 Merged

[Thomasdezeeuw](/Thomasdezeeuw)
merged 3 commits into
[master](/tokio-rs/mio/tree/master "tokio-rs/mio:master")
from
[named-pipe-fix](/tokio-rs/mio/tree/named-pipe-fix "tokio-rs/mio:named-pipe-fix")

Mar 1, 2024

 Merged

# [named-pipes: fix receiving IOCP events after deregister](#top) #1760

[Thomasdezeeuw](/Thomasdezeeuw)
merged 3 commits into
[master](/tokio-rs/mio/tree/master "tokio-rs/mio:master")
from
[named-pipe-fix](/tokio-rs/mio/tree/named-pipe-fix "tokio-rs/mio:named-pipe-fix")

Mar 1, 2024

[Conversation
16](/tokio-rs/mio/pull/1760)
[Commits
3](/tokio-rs/mio/pull/1760/commits)
[Checks
31](/tokio-rs/mio/pull/1760/checks)
[Files changed](/tokio-rs/mio/pull/1760/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![carllerche](https://avatars.githubusercontent.com/u/6180?s=60&v=4)](/carllerche)

Copy link

Member

### @carllerche **[carllerche](/carllerche)** commented [Feb 29, 2024](#issue-2162242108) • edited by Thomasdezeeuw Loading

There is a race condition with named pipes where it is possible to receive events for a named pipe after it has been deregistered with the selector. This is because named pipes use IOCP, and there is a path where it posts a raw event, and by the time that raw event is returned by the selector the user, the user could have deregistered the I/O resource.

The fix is to post the event while maintaining the association with the I/O resource. Then, before returning the event to the user, do a final check to ensure the I/O resource (named pipe) is still registered with the selector.

Fixes [#6369](https://github.com/tokio-rs/tokio/issues/6369)

Sorry, something went wrong.

All reactions

[![@atouchet](https://avatars.githubusercontent.com/u/26315797?s=80&v=4)](/atouchet)

Copy link

Contributor

### **[atouchet](/atouchet)** commented [Mar 1, 2024](#issuecomment-1972471473)

| That issue number doesn't exist. Typo? |
| --- |

All reactions

Sorry, something went wrong.

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=80&v=4)](/Thomasdezeeuw)

Copy link

Collaborator

### **[Thomasdezeeuw](/Thomasdezeeuw)** commented [Mar 1, 2024](#issuecomment-1973128136)

| That issue number doesn't exist. Typo?  It's a Tokio issue, I've added a link. |
| --- |

All reactions

Sorry, something went wrong.

[![Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=60&v=4)](/Thomasdezeeuw)

**[Thomasdezeeuw](/Thomasdezeeuw)**
approved these changes
[Mar 1, 2024](#pullrequestreview-1911051666)

 [View reviewed changes](/tokio-rs/mio/pull/1760/files)

Copy link

Collaborator

### @Thomasdezeeuw **[Thomasdezeeuw](/Thomasdezeeuw)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

A chance that [#1755](https://github.com/tokio-rs/mio/issues/1755) is related?

LGTM, but I've very jet lagged at the moment, so not the best reviewer. [@Darksonn](https://github.com/Darksonn) you want to take a look at this as well if you can?

Sorry, something went wrong.

All reactions

[src/sys/windows/named\_pipe.rs](/tokio-rs/mio/pull/1760/files#diff-8648c6b3c0e6fc7faf5a29bd380248e904852cb3bfaf6e0e2638af9d281b4960)

|  |  | match self.cp.as\_ref().unwrap().post(completion\_status) { |
| --- | --- | --- |
|  |  | Ok(\_) => { |
|  |  | // Increase the ref count of `Inner` for the completion event. |
|  |  | mem::forget(me.clone()); |

Copy link

Collaborator

### @Thomasdezeeuw **[Thomasdezeeuw](/Thomasdezeeuw)** [Mar 1, 2024](#discussion_r1508937076)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nit: we could use `Arc::increment_strong_count`, but I don't know if we use it anywhere else, if not it's ok to keep the current code.

Sorry, something went wrong.

All reactions

Copy link

Member

Author

### @carllerche **[carllerche](/carllerche)** [Mar 1, 2024](#discussion_r1509339161)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is the style in the rest of the file. It probably should be updated in one go.

Sorry, something went wrong.

 👍
1
 Thomasdezeeuw reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[src/sys/windows/named\_pipe.rs](/tokio-rs/mio/pull/1760/files#diff-8648c6b3c0e6fc7faf5a29bd380248e904852cb3bfaf6e0e2638af9d281b4960)

Show resolved

Hide resolved

[src/sys/windows/named\_pipe.rs](/tokio-rs/mio/pull/1760/files#diff-8648c6b3c0e6fc7faf5a29bd380248e904852cb3bfaf6e0e2638af9d281b4960)

Show resolved

Hide resolved

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=80&v=4)](/Thomasdezeeuw)

Copy link

Collaborator

### **[Thomasdezeeuw](/Thomasdezeeuw)** commented [Mar 1, 2024](#issuecomment-1973146895)

| The minimal CI seems to fail with a proper error: `STATUS_STACK_BUFFER_OVERRUN`: <https://github.com/tokio-rs/mio/actions/runs/8103773681/job/22149086129?pr=1760#step:5:274>. |
| --- |

All reactions

Sorry, something went wrong.

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=80&v=4)](/Thomasdezeeuw)

Copy link

Collaborator

### **[Thomasdezeeuw](/Thomasdezeeuw)** commented [Mar 1, 2024](#issuecomment-1973148595)

| Oh, I just noticed this target v0.8.x branch, can you change it to master? Then we can back port afterwards, that's how we usually do it. |
| --- |

All reactions

Sorry, something went wrong.

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=40&v=4)](/carllerche)

`[named-pipes: fix receiving IOCP events after deregister](/tokio-rs/mio/pull/1760/commits/10ff21b3645eff7d6e20c446e30c84f001eb4221 "named-pipes: fix receiving IOCP events after deregister")`

`[10ff21b](/tokio-rs/mio/pull/1760/commits/10ff21b3645eff7d6e20c446e30c84f001eb4221)`

 [![@carllerche](https://avatars.githubusercontent.com/u/6180?s=40&u=ea7e0c429239ff142185c1e2825eba5ec0454db8&v=4)](/carllerche)
[carllerche](/carllerche)
[force-pushed](/tokio-rs/mio/compare/491593a6dc432728ae6b434f072f7d5d0a0f917b..10ff21b3645eff7d6e20c446e30c84f001eb4221)
the
named-pipe-fix

branch
from
[`491593a`](/tokio-rs/mio/commit/491593a6dc432728ae6b434f072f7d5d0a0f917b) to
[`10ff21b`](/tokio-rs/mio/commit/10ff21b3645eff7d6e20c446e30c84f001eb4221)  [Compare](/tokio-rs/mio/compare/491593a6dc432728ae6b434f072f7d5d0a0f917b..10ff21b3645eff7d6e20c446e30c84f001eb4221)
[March 1, 2024 17:53](#event-11982453626)

 [![@carllerche](https://avatars.githubusercontent.com/u/6180?s=40&u=ea7e0c429239ff142185c1e2825eba5ec0454db8&v=4)](/carllerche)
[carllerche](/carllerche)
changed the base branch from
v0.8.x

to
master

[March 1, 2024 17:53](#event-11982455403)

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=80&u=ea7e0c429239ff142185c1e2825eba5ec0454db8&v=4)](/carllerche)

Copy link

Member

Author

### **[carllerche](/carllerche)** commented [Mar 1, 2024](#issuecomment-1973633089)

| I rebased against master. |
| --- |

All reactions

Sorry, something went wrong.

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=40&v=4)](/carllerche)

`[add an extra comment about the event.data shift](/tokio-rs/mio/pull/1760/commits/4d8c29849056a9f43b5f85d900a54f11dcf86ac5 "add an extra comment about the event.data shift")`

`[4d8c298](/tokio-rs/mio/pull/1760/commits/4d8c29849056a9f43b5f85d900a54f11dcf86ac5)`

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=80&u=ea7e0c429239ff142185c1e2825eba5ec0454db8&v=4)](/carllerche)

Copy link

Member

Author

### **[carllerche](/carllerche)** commented [Mar 1, 2024](#issuecomment-1973645736)

| This issue only applies to named pipes. [#1755](https://github.com/tokio-rs/mio/issues/1755) appears to be related to TCP, so it would not be related. |
| --- |

 👍
1
 Thomasdezeeuw reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=40&v=4)](/carllerche)

`[try fixing CI](/tokio-rs/mio/pull/1760/commits/931b581a7a81a85fe683de25baf5cb46e03b266f "try fixing CI")`

`[931b581](/tokio-rs/mio/pull/1760/commits/931b581a7a81a85fe683de25baf5cb46e03b266f)`

[![Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=60&v=4)](/Thomasdezeeuw)

**[Thomasdezeeuw](/Thomasdezeeuw)**
approved these changes
[Mar 1, 2024](#pullrequestreview-1911850419)

 [View reviewed changes](/tokio-rs/mio/pull/1760/files/931b581a7a81a85fe683de25baf5cb46e03b266f)

[src/sys/windows/named\_pipe.rs](/tokio-rs/mio/pull/1760/files#diff-8648c6b3c0e6fc7faf5a29bd380248e904852cb3bfaf6e0e2638af9d281b4960)

Show resolved

Hide resolved

 Hide details
View details

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=40&v=4)](/Thomasdezeeuw)
[Thomasdezeeuw](/Thomasdezeeuw)
merged commit [`6fd5dd0`](/tokio-rs/mio/commit/6fd5dd0d615a66a30a449d3f8eb1266dad96af62)
into
master

[Mar 1, 2024](https://github.com/tokio-rs/mio/pull/1760#event-11983253583)
31 checks passed

 [![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=40&v=4)](/Thomasdezeeuw)
[Thomasdezeeuw](/Thomasdezeeuw)
deleted the
named-pipe-fix

branch
[March 1, 2024 19:15](#event-11983254309)

[ryanfrishkorn](/ryanfrishkorn)
added a commit
to ryanfrishkorn/morpha
that referenced
this pull request
[Mar 4, 2024](#ref-commit-e285de7)
[![@ryanfrishkorn](https://avatars.githubusercontent.com/u/61361566?s=40&u=486913f6c8cc5605f4cbce18080395babf0fbb34&v=4)](/ryanfrishkorn)

`[Update dependencies](/ryanfrishkorn/morpha/commit/e285de75795e7e43ac74bc1bc30fc043e8972c92 "Update dependencies

Security Advisory
mio >= 0.7.2, <= 0.8.10

- https://github.com/tokio-rs/tokio/issues/6369
- https://github.com/tokio-rs/mio/pull/1760
- https://rustsec.org/advisories/RUSTSEC-2024-0019.html")`
…

`[e285de7](/ryanfrishkorn/morpha/commit/e285de75795e7e43ac74bc1bc30fc043e8972c92)`

```
Security Advisory
mio >= 0.7.2, <= 0.8.10

- [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
- [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)
- <https://rustsec.org/advisories/RUSTSEC-2024-0019.html>
```

[ryanfrishkorn](/ryanfrishkorn)
added a commit
to ryanfrishkorn/weather-rs
that referenced
this pull request
[Mar 4, 2024](#ref-commit-ba7d1d9)
[![@ryanfrishkorn](https://avatars.githubusercontent.com/u/61361566?s=40&u=486913f6c8cc5605f4cbce18080395babf0fbb34&v=4)](/ryanfrishkorn)

`[Update dependencies](/ryanfrishkorn/weather-rs/commit/ba7d1d935f5e0c8d8c6dcaf70a6e45576ed38ce4 "Update dependencies

Security Advisory
mio >= 0.7.2, <= 0.8.10

- https://github.com/tokio-rs/tokio/issues/6369
- https://github.com/tokio-rs/mio/pull/1760
- https://rustsec.org/advisories/RUSTSEC-2024-0019.html")`
…

`[ba7d1d9](/ryanfrishkorn/weather-rs/commit/ba7d1d935f5e0c8d8c6dcaf70a6e45576ed38ce4)`

```
Security Advisory
mio >= 0.7.2, <= 0.8.10

- [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
- [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)
- <https://rustsec.org/advisories/RUSTSEC-2024-0019.html>
```

This was referenced Mar 5, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
nervosnetwork/ckb#4367](/nervosnetwork/ckb/issues/4367)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
ISibboI/vocabulary-learning-application#125](/ISibboI/vocabulary-learning-application/issues/125)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
universal-inbox/universal-inbox#27](/universal-inbox/universal-inbox/issues/27)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
houseabsolute/ubi#50](/houseabsolute/ubi/issues/50)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
Net-Mist/tell-me-the-odds#9](/Net-Mist/tell-me-the-odds/issues/9)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
n8henrie/hc-runner#7](/n8henrie/hc-runner/issues/7)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
MahdiBaghbani/connect-your-books#7](/MahdiBaghbani/connect-your-books/issues/7)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
houseabsolute/precious#62](/houseabsolute/precious/issues/62)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
AMythicDev/rless#2](/AMythicDev/rless/issues/2)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tari-project/tari-dan#952](/tari-project/tari-dan/issues/952)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tari-project/tari#6181](/tari-project/tari/issues/6181)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
mullvad/mullvadvpn-app#5894](/mullvad/mullvadvpn-app/issues/5894)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
heim-rs/heim#370](/heim-rs/heim/issues/370)

Open

[![@daira](https://avatars.githubusercontent.com/u/643204?s=40&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)
[daira](/daira)
mentioned this pull request
[Mar 5, 2024](#ref-issue-2158533618)

[Windows Named pipes invalid memory access
tokio-rs/tokio#6369](/tokio-rs/tokio/issues/6369)

Closed

[![@daira](https://avatars.githubusercontent.com/u/643204?s=80&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)

Copy link

### **[daira](/daira)** commented [Mar 5, 2024](#issuecomment-1978318049)

| For tokio users: this is marked as fixing [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369) but I think it should not have been: [tokio-rs/tokio#6369 (comment)](https://github.com/tokio-rs/tokio/issues/6369#issuecomment-1978292853) |
| --- |

All reactions

Sorry, something went wrong.

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=80&v=4)](/Thomasdezeeuw)

Copy link

Collaborator

### **[Thomasdezeeuw](/Thomasdezeeuw)** commented [Mar 5, 2024](#issuecomment-1978387667)

| For Tokio users, run `cargo update -p mio` and you're good. |
| --- |

All reactions

Sorry, something went wrong.

[![@daira](https://avatars.githubusercontent.com/u/643204?s=40&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)
[daira](/daira)
mentioned this pull request
[Mar 5, 2024](#ref-issue-2169027018)

[Dependabot security alerts for Rust recommend updating a dependency that is only indirect, which is not the right fix
dependabot/dependabot-core#9210](/dependabot/dependabot-core/issues/9210)

Open

1 task

This was referenced Mar 5, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
starcoinorg/starcoin#4015](/starcoinorg/starcoin/issues/4015)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tracel-ai/burn#1419](/tracel-ai/burn/issues/1419)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
thinkgos/goup-rs#66](/thinkgos/goup-rs/issues/66)

Closed

[![@JunkuiZhang](https://avatars.githubusercontent.com/u/14981363?s=40&v=4)](/JunkuiZhang)
[JunkuiZhang](/JunkuiZhang)
mentioned this pull request
[Mar 6, 2024](#ref-pullrequest-2170808492)

[Update `mio`
zed-industries/zed#8935](/zed-industries/zed/pull/8935)
 Merged

[mikayla-maki](/mikayla-maki)
pushed a commit
to zed-industries/zed
that referenced
this pull request
[Mar 6, 2024](#ref-commit-59faef5)
[![@JunkuiZhang](https://avatars.githubusercontent.com/u/14981363?s=40&u=3eb91c2a721ffe39858cbe789c059b2660251f77&v=4)](/JunkuiZhang)

`[Update](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A") [mio](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A") [(](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A")[#8935](https://github.com/zed-industries/zed/pull/8935)[)](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A")`
…

`[59faef5](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815)`

```
### Description
This is a part of [#8809](https://github.com/zed-industries/zed/pull/8809)

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
[#1760](https://github.com/zed-industries/zed/pull/1760)]([tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760))

[Windows Named pipes invalid memory access
[#6369](https://github.com/zed-industries/zed/issues/6369)]([tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369))

Release Notes:

- N/A
```

This was referenced Mar 10, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
vorner/signal-hook#155](/vorner/signal-hook/issues/155)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
getsentry/symbolicator#1406](/getsentry/symbolicator/issues/1406)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
getsentry/symbolic#832](/getsentry/symbolic/issues/832)

Closed

This was referenced Apr 16, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
UnblockVPN/mullvadvpn-base#5](/UnblockVPN/mullvadvpn-base/issues/5)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
MahdiBaghbani/hayadi\_rs#3](/MahdiBaghbani/hayadi_rs/issues/3)

Open

[![@cdklabs-automation](https://avatars.githubusercontent.com/u/90142015?s=40&v=4)](/cdklabs-automation)
[cdklabs-automation](/cdklabs-automation)
mentioned this pull request
[May 11, 2024](#ref-issue-2290537455)

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
cdklabs/cdk-from-cfn#676](/cdklabs/cdk-from-cfn/issues/676)

Closed

[rustdesk](/rustdesk)
added a commit
to rustdesk/rustdesk
that referenced
this pull request
[May 12, 2024](#ref-commit-4c99b8c)
[![@rustdesk](https://avatars.githubusercontent.com/u/71636191?s=40&u=fcdfa5bbe724bd4ec02f6c3b2419ff25b7f5eb07&v=4)](/rustdesk)

`[upgrade tokio to 3.17 for a windows named pipe race condition,](/rustdesk/rustdesk/commit/4c99b8c70e306d76451487064fe930ffa7e7c985 "upgrade tokio to 3.17 for a windows named pipe race condition,
https://github.com/tokio-rs/mio/pull/1760, https://github.com/tokio-rs/tokio/issues/6369")`
…

`[4c99b8c](/rustdesk/rustdesk/commit/4c99b8c70e306d76451487064fe930ffa7e7c985)`

```
[tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760), [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Sep 25, 2024](#ref-issue-2546821797)

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
mthmulders/dsmr-rs#162](/mthmulders/dsmr-rs/issues/162)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Fmio%2Fpull%2F1760)

Reviewers

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=40&v=4)](/Thomasdezeeuw) [Thomasdezeeuw](/Thomasdezeeuw)

Thomasdezeeuw approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Windows Named pipes invalid memory access](https://github.com/tokio-rs/tokio/issues/6369)

4 participants

[![@carllerche](https://avatars.githubusercontent.com/u/6180?s=52&v=4)](/carllerche) [![@atouchet](https://avatars.githubusercontent.com/u/26315797?s=52&v=4)](/atouchet) [![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=52&v=4)](/Thomasdezeeuw) [![@daira](https://avatars.githubusercontent.com/u/643204?s=52&v=4)](/daira)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

