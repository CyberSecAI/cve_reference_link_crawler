
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Ftokio%2Fissues%2F6369)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Ftokio%2Fissues%2F6369)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=tokio-rs%2Ftokio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tokio-rs](/tokio-rs)
/
**[tokio](/tokio-rs/tokio)**
Public

* [Notifications](/login?return_to=%2Ftokio-rs%2Ftokio) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Ftokio-rs%2Ftokio)
* [Star
   27.6k](/login?return_to=%2Ftokio-rs%2Ftokio)

* [Code](/tokio-rs/tokio)
* [Issues
  285](/tokio-rs/tokio/issues)
* [Pull requests
  35](/tokio-rs/tokio/pulls)
* [Discussions](/tokio-rs/tokio/discussions)
* [Actions](/tokio-rs/tokio/actions)
* [Security](/tokio-rs/tokio/security)
* [Insights](/tokio-rs/tokio/pulse)

Additional navigation options

* [Code](/tokio-rs/tokio)
* [Issues](/tokio-rs/tokio/issues)
* [Pull requests](/tokio-rs/tokio/pulls)
* [Discussions](/tokio-rs/tokio/discussions)
* [Actions](/tokio-rs/tokio/actions)
* [Security](/tokio-rs/tokio/security)
* [Insights](/tokio-rs/tokio/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftokio-rs%2Ftokio%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftokio-rs%2Ftokio%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Windows Named pipes invalid memory access #6369

Closed

[radekvit](/radekvit) opened this issue
Feb 28, 2024
· 5 comments
 · Fixed by [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)

Closed

# [Windows Named pipes invalid memory access](#top) #6369

[radekvit](/radekvit) opened this issue
Feb 28, 2024
· 5 comments
 · Fixed by [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)

Labels
[A-tokio](/tokio-rs/tokio/labels/A-tokio)
Area: The main tokio crate
[C-bug](/tokio-rs/tokio/labels/C-bug)
Category: This is a bug.
[M-net](/tokio-rs/tokio/labels/M-net)
Module: tokio/net

## Comments

[![@radekvit](https://avatars.githubusercontent.com/u/25612317?s=80&u=915904614b3da54234e9d08a374855091c8343c2&v=4)](/radekvit)

Copy link

### **[radekvit](/radekvit)** commented [Feb 28, 2024](#issue-2158533618) • edited Loading

| **Version** tokio v1.36.0  **Platform** Windows 10 Enterprise 64-bit version 10.0.19045  **Description** When running a simple named pipes `tokio` program with Application Verifier with `heap` turned on, invalid memory access is detected in `ScheduledIo::set_readiness`.  Reproduction code:  Cargo.toml:  ``` [package] name = "tokio-heaptest" version = "0.1.0" edition = "2021"  [dependencies] tokio = { version = "1.36.0", features = ["net", "macros", "rt", "rt-multi-thread", "time"] } ```  main.rs:  ``` use std::time::Duration;  use tokio::net::windows::named_pipe::{ClientOptions, ServerOptions};  const PIPE_NAME: &str = r"\\.\pipe\tokio-heap-issue";  #[tokio::main] async fn main() {     let connect_client = tokio::spawn(connect_client());     tokio::spawn(client_fn());      let connected = tokio::time::timeout(Duration::from_millis(1000), connect_client)         .await         .unwrap_or(Ok(Ok(false)))         .unwrap_or(Ok(false))         .unwrap_or(false);     assert!(connected); }  async fn connect_client() -> std::io::Result<bool> {     let server = ServerOptions::new()         .first_pipe_instance(true)         .create(PIPE_NAME)?;      server.connect().await?;      Ok(true) }  async fn client_fn() {     // five tries to connect     for _ in 0..5 {         tokio::time::sleep(Duration::from_millis(20)).await;         match ClientOptions::new().read(true).write(true).open(PIPE_NAME) {             // Return after we've connected             Ok(_) => return,             Err(_) => {                 // pipe not created yet or busy, sleep and wait                 continue;             }         };     } } ```  With the following settings in [Application Verifier](https://learn.microsoft.com/en-us/windows-hardware/drivers/devtest/application-verifier) [image](https://private-user-images.githubusercontent.com/25612317/308496358-8fb400ce-c979-4c37-a958-5c2802abc5e1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2Mjg2NTcsIm5iZiI6MTczNjYyODM1NywicGF0aCI6Ii8yNTYxMjMxNy8zMDg0OTYzNTgtOGZiNDAwY2UtYzk3OS00YzM3LWE5NTgtNWMyODAyYWJjNWUxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTExVDIwNDU1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWMxNjRkODk2MzIwYmIzZGYwYzgwY2ZkOTE3MjUwMGQxNzFmN2FhNjM4YTY2OTE5Y2M0NDE5MDg1MTAxZDRmNGQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.erYfcmTzchi3nYb55wBPoC33vUTZ9jzIuZVf05afZoI)  You can produce crash dumps by adding the following settings in the registry (see [this article](https://learn.microsoft.com/en-us/windows/win32/wer/collecting-user-mode-dumps)): In `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\LocalDumps`:   * string `DumpFolder`: `C:\path\to\dump\folder` * DWORD `DumpCount`: The number of dumps to keep * DWORD `DumpType`: 2 for a full dump   I expected to see this happen: The program would run without accessing invalid memory. This happens in both debug and release builds.  Instead, this happened: The application crashes with `STATUS_ACCESS_VIOLATION`. The dump shows that the program is trying to access invalid memory in `ScheduledIo::set_readiness` when trying to load an atomic variable, which should mean that `ScheduledIo` itself has likely been freed. We observed this access violation in our larger application **when a named pipe client disconnects**. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@radekvit](https://avatars.githubusercontent.com/u/25612317?s=40&u=915904614b3da54234e9d08a374855091c8343c2&v=4)](/radekvit)
[radekvit](/radekvit)
added
[A-tokio](/tokio-rs/tokio/labels/A-tokio)
Area: The main tokio crate
[C-bug](/tokio-rs/tokio/labels/C-bug)
Category: This is a bug.
labels
[Feb 28, 2024](#event-11949033567)

[![@Darksonn](https://avatars.githubusercontent.com/u/928074?s=40&u=34b16e2e7d89c10be8992a845915ab8af13f5570&v=4)](/Darksonn)
[Darksonn](/Darksonn)
added
the
[M-net](/tokio-rs/tokio/labels/M-net)
Module: tokio/net
label
[Feb 28, 2024](#event-11949067257)

[![@radekvit](https://avatars.githubusercontent.com/u/25612317?s=80&u=915904614b3da54234e9d08a374855091c8343c2&v=4)](/radekvit)

Copy link

Author

### **[radekvit](/radekvit)** commented [Feb 29, 2024](#issuecomment-1970656903)

| The `ScheduledIo` is freed earlier in `io::registration_set::RegistrationSet::release`, as the `Arc` is stored in reduces its reference count to 0 (but is still used later in `io::Driver::turn`).  Looks like the safety assumption at `runtime::io::Driver::turn:178` is broken somewhere.  Here's the stack trace where the `ScheduledIo` is freed:  ``` 0:004> !heap -p -a 00000270E3249FD0     address 00000270e3249fd0 found in     _DPH_HEAP_ROOT @ 270dc9b1000     in free-ed allocation (  DPH_HEAP_BLOCK:         VirtAddr         VirtSize)                                 270dc9f8958:      270e3249000             2000     00007ff9ce6e9234 ntdll!RtlDebugFreeHeap+0x0000000000000038     00007ff9ce615cc1 ntdll!RtlpFreeHeap+0x00000000000000c1     00007ff9ce615b74 ntdll!RtlpFreeHeapInternal+0x0000000000000464     00007ff9ce6147b1 ntdll!RtlFreeHeap+0x0000000000000051     00007ff988d3c4fc vrfcore!VfCoreRtlFreeHeap+0x000000000000002c     00007ff981aa39af vfbasics!AVrfpRtlFreeHeap+0x000000000000011f     00007ff981aa6fe8 vfbasics!AVrfpHeapFree+0x0000000000000108     00007ff70b33ab57 tokio_heaptest!alloc::alloc::impl$1::deallocate+0x0000000000000087 [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\alloc\src\alloc.rs @ 256]     00007ff70b339ba0 tokio_heaptest!core::alloc::impl$2::deallocate<alloc::alloc::Global>+0x0000000000000020 [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\core\src\alloc\mod.rs @ 387]     00007ff70b2bf018 tokio_heaptest!alloc::sync::impl$42::drop<tokio::runtime::io::scheduled_io::ScheduledIo,ref$<alloc::alloc::Global> >+0x0000000000000198 [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\alloc\src\sync.rs @ 3001]     00007ff70b2d139e tokio_heaptest!core::ptr::drop_in_place<alloc::sync::Weak<tokio::runtime::io::scheduled_io::ScheduledIo,ref$<alloc::alloc::Global> > >+0x000000000000000e [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\core\src\ptr\mod.rs @ 498]     00007ff70b2bc1e2 tokio_heaptest!alloc::sync::Arc<tokio::runtime::io::scheduled_io::ScheduledIo,alloc::alloc::Global>::drop_slow<tokio::runtime::io::scheduled_io::ScheduledIo,alloc::alloc::Global>+0x0000000000000042 [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\alloc\src\sync.rs @ 1759]     00007ff70b2bd75c tokio_heaptest!alloc::sync::impl$33::drop<tokio::runtime::io::scheduled_io::ScheduledIo,alloc::alloc::Global>+0x000000000000007c [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\alloc\src\sync.rs @ 2408]     00007ff70b2d537e tokio_heaptest!core::ptr::drop_in_place<alloc::sync::Arc<tokio::runtime::io::scheduled_io::ScheduledIo,alloc::alloc::Global> >+0x000000000000000e [/rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\library\core\src\ptr\mod.rs @ 498]     00007ff70b2e9510 tokio_heaptest!tokio::runtime::io::registration_set::RegistrationSet::release+0x0000000000000110 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\io\registration_set.rs @ 108]     00007ff70b3127d8 tokio_heaptest!tokio::runtime::io::driver::Handle::release_pending_registrations+0x0000000000000068 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\io\driver.rs @ 255]     00007ff70b3120dc tokio_heaptest!tokio::runtime::io::driver::Driver::turn+0x00000000000000ac [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\io\driver.rs @ 143]     00007ff70b311e00 tokio_heaptest!tokio::runtime::io::driver::Driver::park_timeout+0x0000000000000070 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\io\driver.rs @ 128]     00007ff70b2fe385 tokio_heaptest!enum2$<tokio::runtime::driver::IoStack>::park_timeout+0x0000000000000065 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\driver.rs @ 180]     00007ff70b2ff07d tokio_heaptest!tokio::runtime::time::Driver::park_thread_timeout+0x000000000000001d [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\time\mod.rs @ 243]     00007ff70b2fee86 tokio_heaptest!tokio::runtime::time::Driver::park_internal+0x0000000000000316 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\time\mod.rs @ 198]     00007ff70b2fea95 tokio_heaptest!tokio::runtime::time::Driver::park+0x0000000000000025 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\time\mod.rs @ 149]     00007ff70b2fe716 tokio_heaptest!enum2$<tokio::runtime::driver::TimeDriver>::park+0x0000000000000036 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\driver.rs @ 329]     00007ff70b2fdbb3 tokio_heaptest!tokio::runtime::driver::Driver::park+0x0000000000000013 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\driver.rs @ 70]     00007ff70b2d74df tokio_heaptest!tokio::runtime::scheduler::multi_thread::park::Inner::park_driver+0x000000000000008f [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\park.rs @ 184]     00007ff70b2d7035 tokio_heaptest!tokio::runtime::scheduler::multi_thread::park::Inner::park+0x00000000000000e5 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\park.rs @ 117]     00007ff70b2d6c95 tokio_heaptest!tokio::runtime::scheduler::multi_thread::park::Parker::park+0x0000000000000025 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\park.rs @ 68]     00007ff70b2e1a98 tokio_heaptest!tokio::runtime::scheduler::multi_thread::worker::Context::park_timeout+0x0000000000000208 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\worker.rs @ 723]     00007ff70b2e1775 tokio_heaptest!tokio::runtime::scheduler::multi_thread::worker::Context::park+0x0000000000000185 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\worker.rs @ 693]     00007ff70b2e0729 tokio_heaptest!tokio::runtime::scheduler::multi_thread::worker::Context::run+0x00000000000004b9 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\worker.rs @ 544]     00007ff70b2e01a5 tokio_heaptest!tokio::runtime::scheduler::multi_thread::worker::run::closure$0::closure$0+0x0000000000000055 [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\scheduler\multi_thread\worker.rs @ 491]     00007ff70b2cf35b tokio_heaptest!tokio::runtime::context::scoped::Scoped<enum2$<tokio::runtime::scheduler::Context> >::set<enum2$<tokio::runtime::scheduler::Context>,tokio::runtime::scheduler::multi_thread::worker::run::closure$0::closure_env$0,tuple$<> >+0x000000000000007b [C:\Users\JohnDoe\.cargo\registry\src\index.crates.io-6f17d22bba15001f\tokio-1.36.0\src\runtime\context\scoped.rs @ 40]  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@radekvit](https://avatars.githubusercontent.com/u/25612317?s=80&u=915904614b3da54234e9d08a374855091c8343c2&v=4)](/radekvit)

Copy link

Author

### **[radekvit](/radekvit)** commented [Feb 29, 2024](#issuecomment-1970674262)

| I also tried older versions of `tokio` and found out that this worked fine with up to `1.29.1` and broke in `1.30`. |
| --- |

All reactions

Sorry, something went wrong.

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=40&v=4)](/Thomasdezeeuw)
[Thomasdezeeuw](/Thomasdezeeuw)
mentioned this issue
[Mar 1, 2024](#ref-pullrequest-2162242108)

[named-pipes: fix receiving IOCP events after deregister
tokio-rs/mio#1760](/tokio-rs/mio/pull/1760)
 Merged

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=40&v=4)](/Thomasdezeeuw)
[Thomasdezeeuw](/Thomasdezeeuw)
closed this as [completed](/tokio-rs/tokio/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[tokio-rs/mio#1760](/tokio-rs/mio/pull/1760)
[Mar 1, 2024](#event-11983253847)

[ryanfrishkorn](/ryanfrishkorn)
added a commit
to ryanfrishkorn/morpha
that referenced
this issue
[Mar 4, 2024](#ref-commit-e285de7)
[![@ryanfrishkorn](https://avatars.githubusercontent.com/u/61361566?s=40&u=486913f6c8cc5605f4cbce18080395babf0fbb34&v=4)](/ryanfrishkorn)

`[Update dependencies](/ryanfrishkorn/morpha/commit/e285de75795e7e43ac74bc1bc30fc043e8972c92 "Update dependencies

Security Advisory
mio >= 0.7.2, <= 0.8.10

- https://github.com/tokio-rs/tokio/issues/6369
- https://github.com/tokio-rs/mio/pull/1760
- https://rustsec.org/advisories/RUSTSEC-2024-0019.html")`
…

`[e285de7](/ryanfrishkorn/morpha/commit/e285de75795e7e43ac74bc1bc30fc043e8972c92)`

```
Security Advisory
mio >= 0.7.2, <= 0.8.10

- [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
- [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)
- <https://rustsec.org/advisories/RUSTSEC-2024-0019.html>
```

[ryanfrishkorn](/ryanfrishkorn)
added a commit
to ryanfrishkorn/weather-rs
that referenced
this issue
[Mar 4, 2024](#ref-commit-ba7d1d9)
[![@ryanfrishkorn](https://avatars.githubusercontent.com/u/61361566?s=40&u=486913f6c8cc5605f4cbce18080395babf0fbb34&v=4)](/ryanfrishkorn)

`[Update dependencies](/ryanfrishkorn/weather-rs/commit/ba7d1d935f5e0c8d8c6dcaf70a6e45576ed38ce4 "Update dependencies

Security Advisory
mio >= 0.7.2, <= 0.8.10

- https://github.com/tokio-rs/tokio/issues/6369
- https://github.com/tokio-rs/mio/pull/1760
- https://rustsec.org/advisories/RUSTSEC-2024-0019.html")`
…

`[ba7d1d9](/ryanfrishkorn/weather-rs/commit/ba7d1d935f5e0c8d8c6dcaf70a6e45576ed38ce4)`

```
Security Advisory
mio >= 0.7.2, <= 0.8.10

- [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
- [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)
- <https://rustsec.org/advisories/RUSTSEC-2024-0019.html>
```

This was referenced Mar 5, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
nervosnetwork/ckb#4367](/nervosnetwork/ckb/issues/4367)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
ISibboI/vocabulary-learning-application#125](/ISibboI/vocabulary-learning-application/issues/125)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
universal-inbox/universal-inbox#27](/universal-inbox/universal-inbox/issues/27)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
houseabsolute/ubi#50](/houseabsolute/ubi/issues/50)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
Net-Mist/tell-me-the-odds#9](/Net-Mist/tell-me-the-odds/issues/9)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
n8henrie/hc-runner#7](/n8henrie/hc-runner/issues/7)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
MahdiBaghbani/connect-your-books#7](/MahdiBaghbani/connect-your-books/issues/7)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
houseabsolute/precious#62](/houseabsolute/precious/issues/62)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
AMythicDev/rless#2](/AMythicDev/rless/issues/2)

Open

[passchaos](/passchaos)
pushed a commit
to passchaos/ydcv-rust
that referenced
this issue
[Mar 5, 2024](#ref-commit-41beebf)

`[fix: vulnerability](/passchaos/ydcv-rust/commit/41beebffb11f878056b1905e93e44fa68c5c9178 "fix: vulnerability https://github.com/tokio-rs/tokio/issues/6369") [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)`

`[41beebf](/passchaos/ydcv-rust/commit/41beebffb11f878056b1905e93e44fa68c5c9178)`

[passchaos](/passchaos)
added a commit
to passchaos/ydcv-rust
that referenced
this issue
[Mar 5, 2024](#ref-commit-c020280)
[![@passchaos](https://avatars.githubusercontent.com/u/8736961?s=40&u=d6ec5a3611d583bad4c31ab6ae466f19f2f721fd&v=4)](/passchaos)

`[fix: vulnerability](/passchaos/ydcv-rust/commit/c020280a0538746931082106b6c223c4742f256e "fix: vulnerability https://github.com/tokio-rs/tokio/issues/6369") [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)`

`[c020280](/passchaos/ydcv-rust/commit/c020280a0538746931082106b6c223c4742f256e)`

This was referenced Mar 5, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tari-project/tari-dan#952](/tari-project/tari-dan/issues/952)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tari-project/tari#6181](/tari-project/tari/issues/6181)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
mullvad/mullvadvpn-app#5894](/mullvad/mullvadvpn-app/issues/5894)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
heim-rs/heim#370](/heim-rs/heim/issues/370)

Open

[![@daira](https://avatars.githubusercontent.com/u/643204?s=80&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)

Copy link

### **[daira](/daira)** commented [Mar 5, 2024](#issuecomment-1978292853) • edited Loading

| [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760) is marked as fixing this bug, but note that tokio's (optional) dependency on mio is still at 0.8.9 which was vulnerable, e.g.:     [tokio/tokio/Cargo.toml](https://github.com/tokio-rs/tokio/blob/f6d061919f7a56eebf78edb1d1d379fadad33b6a/tokio/Cargo.toml#L98)  Line 98 in [f6d0619](/tokio-rs/tokio/commit/f6d061919f7a56eebf78edb1d1d379fadad33b6a)   |  | mio = { version = "0.8.9", optional = true, default-features = false } | | --- | --- |      I believe this shouldn't be considered fixed in tokio until no tokio crates depend on any vulnerable version of mio (or they otherwise mitigate the vulnerability).  This is important for downstream projects dependent on tokio since adding a dependency on mio is not the right fix for them, assuming they do not depend on it directly. The right fix is to update their tokio dependency/dependencies to a release that has updated its mio dependencies.  (I know that mio 0.8.11 is a compatible point-release relative to the version that tokio depends on, so in most cases it would be sufficient for downstream projects that are not libraries to just do a `cargo update` to update their pin on mio. The issue is with having a well-defined version of tokio that is not vulnerable, given how widely depended on tokio is. Upgrading to that version is when downstream projects will stop getting automated security alerts, for instance.) |
| --- | --- | --- |

 👍
2
 jalaziz and Davidster reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=80&v=4)](/Thomasdezeeuw)

Copy link

Contributor

### **[Thomasdezeeuw](/Thomasdezeeuw)** commented [Mar 5, 2024](#issuecomment-1978381286)

| [@daira](https://github.com/daira) you can run `cargo update -p mio` and you're good. |
| --- |

All reactions

Sorry, something went wrong.

[![@daira](https://avatars.githubusercontent.com/u/643204?s=80&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)

Copy link

### **[daira](/daira)** commented [Mar 5, 2024](#issuecomment-1978546126) • edited Loading

| I'm aware of that; see the last paragraph of my comment. (Also see [dependabot/dependabot-core#9210](https://github.com/dependabot/dependabot-core/issues/9210) which would fix an issue with getting potentially misleading Dependabot security alerts.) |
| --- |

 👍
1
 jalaziz reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@daira](https://avatars.githubusercontent.com/u/643204?s=40&u=b6b4d180483e0e9f7969140df3e16f344233eab1&v=4)](/daira)
[daira](/daira)
mentioned this issue
[Mar 5, 2024](#ref-issue-2169027018)

[Dependabot security alerts for Rust recommend updating a dependency that is only indirect, which is not the right fix
dependabot/dependabot-core#9210](/dependabot/dependabot-core/issues/9210)

Open

1 task

This was referenced Mar 5, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
starcoinorg/starcoin#4015](/starcoinorg/starcoin/issues/4015)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
tracel-ai/burn#1419](/tracel-ai/burn/issues/1419)

Closed

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Mar 5, 2024](#ref-issue-2170295473)

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
thinkgos/goup-rs#66](/thinkgos/goup-rs/issues/66)

Closed

[![@JunkuiZhang](https://avatars.githubusercontent.com/u/14981363?s=40&v=4)](/JunkuiZhang)
[JunkuiZhang](/JunkuiZhang)
mentioned this issue
[Mar 6, 2024](#ref-pullrequest-2170808492)

[Update `mio`
zed-industries/zed#8935](/zed-industries/zed/pull/8935)
 Merged

[mikayla-maki](/mikayla-maki)
pushed a commit
to zed-industries/zed
that referenced
this issue
[Mar 6, 2024](#ref-commit-59faef5)
[![@JunkuiZhang](https://avatars.githubusercontent.com/u/14981363?s=40&u=3eb91c2a721ffe39858cbe789c059b2660251f77&v=4)](/JunkuiZhang)

`[Update](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A") [mio](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A") [(](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A")[#8935](https://github.com/zed-industries/zed/pull/8935)[)](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815 "Update `mio` (#8935)

### Description
This is a part of #8809

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
#1760](https://github.com/tokio-rs/mio/pull/1760)

[Windows Named pipes invalid memory access
#6369](https://github.com/tokio-rs/tokio/issues/6369)

Release Notes:

- N/A")`
…

`[59faef5](/zed-industries/zed/commit/59faef5800ff515d7c30b64fc754154274376815)`

```
### Description
This is a part of [#8809](https://github.com/zed-industries/zed/pull/8809)

Update mio from 0.8.8 to 0.8.11.

When using named pipes on Windows, mio will under some circumstances
return invalid tokens that correspond to named pipes that have already
been deregistered from the mio registry. The impact of this
vulnerability depends on how mio is used. For some applications, invalid
tokens may be ignored or cause a warning or a crash. On the other hand,
for applications that store pointers in the tokens, this vulnerability
may result in a use-after-free.

### Connections

[named-pipes: fix receiving IOCP events after deregister
[#1760](https://github.com/zed-industries/zed/pull/1760)]([tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760))

[Windows Named pipes invalid memory access
[#6369](https://github.com/zed-industries/zed/issues/6369)]([tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369))

Release Notes:

- N/A
```

This was referenced Mar 10, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
vorner/signal-hook#155](/vorner/signal-hook/issues/155)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
getsentry/symbolicator#1406](/getsentry/symbolicator/issues/1406)

Closed

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
getsentry/symbolic#832](/getsentry/symbolic/issues/832)

Closed

[SpontanCombust](/SpontanCombust)
added a commit
to SpontanCombust/witcherscript-ide
that referenced
this issue
[Mar 16, 2024](#ref-commit-5771266)
[![@SpontanCombust](https://avatars.githubusercontent.com/u/61706594?s=40&u=85ca4f219434053f6506d67b28442abf8c5ba970&v=4)](/SpontanCombust)

`[Remove mio from okio features to address vulnerability](/SpontanCombust/witcherscript-ide/commit/5771266d31a15ec7119687f0f831942b3addb62b "Remove mio from 	okio features to address vulnerability tokio-rs/tokio#6369") [tokio-rs/tokio…](https://github.com/tokio-rs/tokio/issues/6369)`
…

`[5771266](/SpontanCombust/witcherscript-ide/commit/5771266d31a15ec7119687f0f831942b3addb62b)`

```
[…#6369](https://github.com/tokio-rs/tokio/issues/6369)
```

This was referenced Apr 16, 2024

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
UnblockVPN/mullvadvpn-base#5](/UnblockVPN/mullvadvpn-base/issues/5)

Open

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
MahdiBaghbani/hayadi\_rs#3](/MahdiBaghbani/hayadi_rs/issues/3)

Open

[![@cdklabs-automation](https://avatars.githubusercontent.com/u/90142015?s=40&v=4)](/cdklabs-automation)
[cdklabs-automation](/cdklabs-automation)
mentioned this issue
[May 11, 2024](#ref-issue-2290537455)

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
cdklabs/cdk-from-cfn#676](/cdklabs/cdk-from-cfn/issues/676)

Closed

[rustdesk](/rustdesk)
added a commit
to rustdesk/rustdesk
that referenced
this issue
[May 12, 2024](#ref-commit-4c99b8c)
[![@rustdesk](https://avatars.githubusercontent.com/u/71636191?s=40&u=fcdfa5bbe724bd4ec02f6c3b2419ff25b7f5eb07&v=4)](/rustdesk)

`[upgrade tokio to 3.17 for a windows named pipe race condition,](/rustdesk/rustdesk/commit/4c99b8c70e306d76451487064fe930ffa7e7c985 "upgrade tokio to 3.17 for a windows named pipe race condition,
https://github.com/tokio-rs/mio/pull/1760, https://github.com/tokio-rs/tokio/issues/6369")`
…

`[4c99b8c](/rustdesk/rustdesk/commit/4c99b8c70e306d76451487064fe930ffa7e7c985)`

```
[tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760), [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
```

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this issue
[Sep 25, 2024](#ref-issue-2546821797)

[RUSTSEC-2024-0019: Tokens for named pipes may be delivered after deregistration
mthmulders/dsmr-rs#162](/mthmulders/dsmr-rs/issues/162)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftokio-rs%2Ftokio%2Fissues%2F6369)

Assignees

No one assigned

Labels

[A-tokio](/tokio-rs/tokio/labels/A-tokio)
Area: The main tokio crate
[C-bug](/tokio-rs/tokio/labels/C-bug)
Category: This is a bug.
[M-net](/tokio-rs/tokio/labels/M-net)
Module: tokio/net

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [named-pipes: fix receiving IOCP events after deregister](/tokio-rs/mio/pull/1760)
 [tokio-rs/mio](/tokio-rs/mio)

4 participants

[![@daira](https://avatars.githubusercontent.com/u/643204?s=52&v=4)](/daira) [![@Darksonn](https://avatars.githubusercontent.com/u/928074?s=52&v=4)](/Darksonn) [![@Thomasdezeeuw](https://avatars.githubusercontent.com/u/3159064?s=52&v=4)](/Thomasdezeeuw) [![@radekvit](https://avatars.githubusercontent.com/u/25612317?s=52&v=4)](/radekvit)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

