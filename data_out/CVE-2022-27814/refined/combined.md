=== Content from github.com_b0d6426e_20250108_140734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwaycrate%2Fswhkd%2Freleases)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwaycrate%2Fswhkd%2Freleases)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Findex&source=header-repo&source_repo=waycrate%2Fswhkd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[waycrate](/waycrate)
/
**[swhkd](/waycrate/swhkd)**
Public

* [Notifications](/login?return_to=%2Fwaycrate%2Fswhkd) You must be signed in to change notification settings
* [Fork
  50](/login?return_to=%2Fwaycrate%2Fswhkd)
* [Star
   720](/login?return_to=%2Fwaycrate%2Fswhkd)

* [Code](/waycrate/swhkd)
* [Issues
  65](/waycrate/swhkd/issues)
* [Pull requests
  14](/waycrate/swhkd/pulls)
* [Actions](/waycrate/swhkd/actions)
* [Security](/waycrate/swhkd/security)
* [Insights](/waycrate/swhkd/pulse)

Additional navigation options

* [Code](/waycrate/swhkd)
* [Issues](/waycrate/swhkd/issues)
* [Pull requests](/waycrate/swhkd/pulls)
* [Actions](/waycrate/swhkd/actions)
* [Security](/waycrate/swhkd/security)
* [Insights](/waycrate/swhkd/pulse)

# Releases: waycrate/swhkd

[Releases](/waycrate/swhkd/releases)
[Tags](/waycrate/swhkd/tags)

Releases Â· waycrate/swhkd
## Swhkd 1.2.1

23 Jul 19:12

![@Shinyzenith](https://avatars.githubusercontent.com/u/60808802?s=40&v=4)
[Shinyzenith](/Shinyzenith)

[1.2.1](/waycrate/swhkd/tree/1.2.1)

[`7628ad2`](/waycrate/swhkd/commit/7628ad2d9030287f1590e087b892f96ef3794333)

This commit was signed with the committerâ€™s **verified signature**.

[![](https://avatars.githubusercontent.com/u/60808802?s=64&v=4)](/Shinyzenith)
[Shinyzenith](/Shinyzenith)
Aakash Sen Sharma

GPG key ID: 6DD485917B553B7B

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/waycrate/swhkd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.2.1)

 Loading

[View all tags](/waycrate/swhkd/tags)

[Swhkd 1.2.1](/waycrate/swhkd/releases/tag/1.2.1)
[Latest](/waycrate/swhkd/releases/latest)

[Latest](/waycrate/swhkd/releases/latest)

Changelog:

* Emacs style key chords developed by [@EdenQwQ](https://github.com/EdenQwQ) ( read man page for more info)
* Man pages with scdoc

### Contributors

* [![@EdenQwQ](https://avatars.githubusercontent.com/u/62473844?s=64&v=4)](https://github.com/EdenQwQ)

EdenQwQ

 Assets
3

 Loading

All reactions

## Swhkd 1.2.0 ( CVE fix edition )

11 May 09:37

![@Shinyzenith](https://avatars.githubusercontent.com/u/60808802?s=40&v=4)
[Shinyzenith](/Shinyzenith)

[1.2.0](/waycrate/swhkd/tree/1.2.0)

[`65686b5`](/waycrate/swhkd/commit/65686b59cd4a66d845214f0a50a43807a20aedfe)

This commit was signed with the committerâ€™s **verified signature**.

[![](https://avatars.githubusercontent.com/u/60808802?s=64&v=4)](/Shinyzenith)
[Shinyzenith](/Shinyzenith)
Aakash Sen Sharma

GPG key ID: 6DD485917B553B7B

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/waycrate/swhkd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.2.0)

 Loading

[View all tags](/waycrate/swhkd/tags)

[Swhkd 1.2.0 ( CVE fix edition )](/waycrate/swhkd/releases/tag/1.2.0)

Thanks to [@uncomfyhalomacro](https://github.com/uncomfyhalomacro) who packaged swhkd from open suse repos, a [multitude of security vulnerabilities](https://www.openwall.com/lists/oss-security/2022/04/14/1) were discovered by [@mgerstner](https://github.com/mgerstner) which primarily arose due to my incompetence and lack of careful review of all pull requests. I apologize for this.

The following CVE's have been fixed in this release:

```
CVE-2022-27815
CVE-2022-27814
CVE-2022-27819
CVE-2022-27818
CVE-2022-27816

```

Only [CVE-2022-27817](https://github.com/advisories/GHSA-h5wh-7h2j-h999 "CVE-2022-27817") remains as it is a genuinely difficult problem to solve for us right now. After a short conversation with Kenny Levinsen ( author of seatd ) we came to the conclusion that it's not possible to get access of a seat without complete control of the session hence any compositor which is launched after swhkd won't work. We can however get the fd's of the devices, release the seat, and then pass it along to evdev but that will require a complete application rewrite.

[@mgerstner](https://github.com/mgerstner) did suggest to try systemd context switching with elogind for supporting various inits. As far as I can tell this implementation will have a time complexity of O(2^n) so as the number of seats increase, swhkd will start to lag because there is a considerable amount of cold start to swhkd after which the application runs fine.

I'd also like to point out that the above solution will **NOT** be portable. Distributions that decide to not build elogind support into their init systems will not be able to run swhkd and hence it's not a path that I'd fancy even if it were to fix the problem.

For now [CVE-2022-27817](https://github.com/advisories/GHSA-h5wh-7h2j-h999 "CVE-2022-27817") will probably remain stale. For single user ( single seat ) systems swhkd will function just fine.

### Contributors

* [![@uncomfyhalomacro](https://avatars.githubusercontent.com/u/66054069?s=64&v=4)](https://github.com/uncomfyhalomacro)

uncomfyhalomacro

 Assets
4

 Loading

 ðŸ‘€
2
 actualdankcoder and uncomfyhalomacro reacted with eyes emoji

All reactions

* ðŸ‘€
  2 reactions

 2 people reacted

## 1.1.7

13 Mar 08:00

![@EdenQwQ](https://avatars.githubusercontent.com/u/62473844?s=40&v=4)
[EdenQwQ](/EdenQwQ)

[1.1.7](/waycrate/swhkd/tree/1.1.7)

[`549f960`](/waycrate/swhkd/commit/549f960ce7fb4d8bda704c1cc7df4faf21ee27dc)

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/waycrate/swhkd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.1.7)

 Loading

[View all tags](/waycrate/swhkd/tags)

[1.1.7](/waycrate/swhkd/releases/tag/1.1.7)

## New features

### Include multiple config files by using the `include` statement.

```
# /etc/swhkd/swhkdrc
include /home/user/.config/swhkd/swhkdrc

```
### `@` and `~` prefixes.

Add `@` before a keysym so that the command will run when the key is released.

Add `~` before a keysym so that the keysym would be sent to other clients.

## What's Changed

* Update release.sh by [@uncomfyhalomacro](https://github.com/uncomfyhalomacro) in [#84](https://github.com/waycrate/swhkd/pull/84)
* refactor: improve daemon / server code by [@angelofallars](https://github.com/angelofallars) in [#85](https://github.com/waycrate/swhkd/pull/85)
* feat: improve logs in daemon/server by [@angelofallars](https://github.com/angelofallars) in [#86](https://github.com/waycrate/swhkd/pull/86)
* Feat: multiple config file loading & '@' '~' prefix by [@EdenQwQ](https://github.com/EdenQwQ) in [#87](https://github.com/waycrate/swhkd/pull/87)

## New Contributors

* [@uncomfyhalomacro](https://github.com/uncomfyhalomacro) made their first contribution in [#84](https://github.com/waycrate/swhkd/pull/84)

**Full Changelog**: [1.1.5...1.1.7](https://github.com/waycrate/swhkd/compare/1.1.5...1.1.7)

### Contributors

* [![@angelofallars](https://avatars.githubusercontent.com/u/39676098?s=64&v=4)](https://github.com/angelofallars)
* [![@EdenQwQ](https://avatars.githubusercontent.com/u/62473844?s=64&v=4)](https://github.com/EdenQwQ)
* [![@uncomfyhalomacro](https://avatars.githubusercontent.com/u/66054069?s=64&v=4)](https://github.com/uncomfyhalomacro)

angelofallars, EdenQwQ, and uncomfyhalomacro

 Assets
4

 Loading

All reactions

## Swhkd 1.1.5

07 Mar 14:49

![@Shinyzenith](https://avatars.githubusercontent.com/u/60808802?s=40&v=4)
[Shinyzenith](/Shinyzenith)

[1.1.5](/waycrate/swhkd/tree/1.1.5)

[`21b9dfb`](/waycrate/swhkd/commit/21b9dfb2be1852d4acb79dab2ce5f136f05ec9d9)

This commit was signed with the committerâ€™s **verified signature**.
The key has expired.

[![](https://avatars.githubusercontent.com/u/60808802?s=64&v=4)](/Shinyzenith)
[Shinyzenith](/Shinyzenith)
Aakash Sen Sharma

GPG key ID: A3DFCDC66E9E2950
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/waycrate/swhkd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.1.5)

 Loading

[View all tags](/waycrate/swhkd/tags)

[Swhkd 1.1.5](/waycrate/swhkd/releases/tag/1.1.5)

```
[remove] Install.sh
```

 Assets
4

 Loading

All reactions

## Swhkd 1.1.4

06 Mar 20:20

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[1.1.4](/waycrate/swhkd/tree/1.1.4)

[`6046f14`](/waycrate/swhkd/commit/6046f1425336cce3034b76dc642af01434b0f2ab)

This commit was created on GitHub.com and signed with GitHubâ€™s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/waycrate/swhkd/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...1.1.4)

 Loading

[View all tags](/waycrate/swhkd/tags)

[Swhkd 1.1.4](/waycrate/swhkd/releases/tag/1.1.4)

## Features

* **daemon**: add message on Ctrl+C (SIGINT) exit [#77](https://github.com/waycrate/swhkd/pull/77) ([Angelo Fallaria](https://github.com/waycrate/swhkd/commit/185dbd09d2bb2128e3b1684825547341bb571ca3))

## Commits

* [b8daa1b](https://github.com/waycrate/swhkd/commit/b8daa1b6eea3d75d720e959c3b9b1d5d57cfa747): [update] Exit on SIGINT ( Control + c ). (Shinyzenith) [#77](https://github.com/waycrate/swhkd/pull/77)

 Assets
4

 Loading

All reactions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.openwall.com_aa35f420_20250108_140734.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2022/04/13/3) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <Ylf3kJDnYlodMRNW@f195.suse.de>
Date: Thu, 14 Apr 2022 12:29:36 +0200
From: Matthias Gerstner <mgerstner@...e.de>
To: oss-security@...ts.openwall.com
Subject: Multiple vulnerabilities in swhkd hotkey helper for Wayland

Hello list,

swhkd [1] is a pair of programs that allow to configure arbitrary
keyboard hotkey definitions for the Wayland graphics system, written in
the Rust programming language. The RPM package integration
submitted for openSUSE Tumbleweed contained an unusual Polkit rules
definition file that required a review by the SUSE security team [2].

As a result of the review multiple security issues have been identified.
The individual issues are described in the following detailed report.

1) Introduction
===============

1.a) swhkd Design and Operation
-------------------------------

swhkd consists of two components: `swhks` ("server") which runs in the
context of the unprivileged user to execute hotkey actions and `swhkd`
("daemon") which runs with root privileges to interact with keyboard
devices on uinput API level. The two components communicate with each
other via a UNIX domain socket.

It is a bit unclear if `swhkd` allows other modes of operation. The
function `permission_check()` is somewhat confusing in this regard. In
the end the only way to get it running is doing it as root, and the
README also points to `pkexec` for running it. So this is the only setup
that I analyzed for this report.

1.b) Scope of Review
--------------------

The target of this review was version 1.1.5 of swhkd.

1.c) Polkit pkexec Usage
========================

In version 1.1.5 of swhkd a Polkit rules file
"/usr/share/polkit-1/rules.d/swhkd.rules" is used containing the
following rule snippet:

```
polkit.addRule(function(action, subject) {
      if (action.lookup("program") == "/usr/bin/swhkd") {
                return polkit.Result.YES;
      }
})
```

This means that any user in the system independently of a session
context is able to execute /usr/bin/swhkd as root via pkexec passing
arbitrary parameters e.g. also a compromised 'nobody' user account could
do it.

According to my recommendation upstream switched to using a Polkit
policy file instead that only allows local users in an active session to
run swhkd as root.

2) Security Issues
==================

2.a) Use of Fixed Temporary File in /tmp/swhkd.pid (CVE-2022-27815)
-------------------------------------------------------------------

The daemon running as root uses this path to record its own PID for
instance monitoring. This fixed path has the following issues:

- local application DoS: if an attacker places the PID of an existing
  process there (e.g. PID 1), other users cannot start the daemon any
  more.

- local information leak if the kernel's symlink protection is turned
  off. The daemon logs the *full* content of the PID file to stdout.
  Example output of a run with a symlink pointing to a private root
  owned file containing the string "secret":

      [2022-03-21T15:44:28Z DEBUG swhkd] Previous PID: secret

- local system DoS if kernel symlink protection is off. The daemon will
  overwrite the target file with its own PID. This could also create a
  world-readable file in interesting locations that allow for further
  attack vectors in other programs.

- functional issue: such a setup is not suitable for multiple users
  using the software in parallel.

### Bugfix

The issue has been fixed upstream via the following commit:

<https://github.com/waycrate/swhkd/pull/93/commits/ee3534b401cba71fddf378f7e1cb18ada0e6fa75>

The PID file is now placed into /etc, which fixes the issue, albeit is
an incorrect location. I suggested upstream to place this file in /run
instead.

2.b) The `-c` Daemon Command Line Parameter Allows for Arbitrary File Existence Tests (CVE-2022-27814)
------------------------------------------------------------------------------------------------------

Example exploitation:

    $ pkexec /usr/bin/swhkd -d -c /root/.somefile
    [2022-03-22T12:32:25Z ERROR swhkd] "/root/.somefile" doesn't exist

    $ pkexec /usr/bin/swhkd -d -c /root/.bash_history
    [...] (daemon starts "normal" operation)

### Bugfix

Upstream tries to fix this via the following commit:

<https://github.com/waycrate/swhkd/pull/105/commits/3c111663f2dcf8f28214ff1907169aa669fcf791>

This commit now uses the external `cat` program to read in the
configuration file. Actually this is just a workaround, because the fix
for issue 2.c) is incomplete (only the root UID is dropped, not the root
GID, see [3]).

2.c) The `-c` Daemon Command Line Parameter Allows to Parse Arbitrary Files (CVE-2022-27819)
--------------------------------------------------------------------------------------------

The file passed to `swhkd` via `-c` will be completely read in by
`swhkd`. Any privileged file can thus also be processed. The daemon only
outputs the contents if something that looks like a hotkey definition is
found in the file, however. Since this syntax is pretty complex the
involved information leak is rather hard to exploit. Something like

    $ pkexec /usr/bin/swhkd -d -c /dev/sda

causes the daemon to "parse" the complete block device, exhausting
memory and causing high I/O load.

### Bugfix

Upstream addressed this by dropping privileges to the invoking user via
the following commit:

<https://github.com/waycrate/swhkd/commit/8ddd40fdc0f1a356816671d6a91f067c112e4724>

The privilege drop is still incomplete, because the root group ID
privilege is not dropped.

The security stance of swhkd can still be improved by dropping
privileges to the invoking user by default and only raising them for
privileged operations. I recommended this to upstream for follow up
changes of the codebase.

2.d) The Daemon Connects to a Fixed UNIX Domain Socket in /tmp/swhkd.sock (CVE-2022-27818)
------------------------------------------------------------------------------------------

For connecting to the unprivileged swhks sibbling process the swhkd
daemon connects to the fixed domain socket path /tmp/swhkd.sock. This
causes the following issues:

- local DoS: If an attacker pre-creates this pathname then the daemon
  cannot send out hotkey events and the unprivileged server component
  cannot start up successfully.
- local information leak: If an attacker places its *own* UNIX domain
  socket there, then the attacker will receive hotkey events instead of
  the legitimate user. The information contains the commands to be
  executed which is depending on the actual hotkey setup. In some cases
  this might even contain sensitive data.

### Bugfix

Upstream addressed this by placing the socket into the unprivileged
user's private /run/user/$UID directory. This is done via the following
commit:

<https://github.com/waycrate/swhkd/commit/3187d7fc75fe5833f903b342941eebc1a56e5979>

2.e) Input Events are Consumed For all Keyboard Input Devices in all Sessions (CVE-2022-27817)
----------------------------------------------------------------------------------------------

The daemon listens for input events on uinput device level. This means
even other users in other Wayland sessions or on the text mode consoles
will be affected by this. In theory this fact could be used to log
passwords and other sensitive information from other users. However,
recognized hotkey events will be discarded by the daemon i.e. if regular
key presses are configured as hotkeys then the keys seem to work no
longer. Therefore it is more like a local DoS for other users.

### Bugfix

This issue has not been addressed by upstream yet. My suggested fix is
as follows:

Establish a systemd Session Context: I think it is possible to determine
the current session the unprivileged user is in via systemd. Then the
daemon should pause its operation as soon as the active session is
changed to another one, and reactivate operation once the original user
session becomes active again.

2.f) The Unprivileged Server Process Uses a Fixed Temporary File in /tmp/swhks.pid (CVE-2022-27816)
---------------------------------------------------------------------------------------------------

This issue is similar to 2.a). The consequences are:

- local application DoS: if an attacker places the PID of an existing
  process there (e.g. PID 1), other users cannot start the server any
  more.
- local user file corruption: if kernel symlink protection is off, then
  the PID file can be a symlink to a private file in the user's home
  directory which will then be overwritten with the PID information.

### Bugfix

Upstream addressed this issue by placing the PID file in the respective
user's private /run/user/$UID directory. This is done in the following
commit:

<https://github.com/waycrate/swhkd/commit/4b8442fef512441c9155186956c767a120c12974>

2.g) The Unprivileged Server Process Receives Commands via /tmp/swhkd.sock
--------------------------------------------------------------------------

The socket used by the daemon (see 2.d) is created by the unprivileged
server. The daemon sends commands to be executed to this socket and the
server will execute them.

The UNIX socket `bind()` call only succeeds if the target file does not
exist yet and it also doesn't follow symlinks. Therefore an attacker
cannot pre-create this socket, without the server process failing to
`bind()`. For `connect()`ing to the socket the caller needs to have
write permissions on the socket. Therefore arbitrary other users cannot
send commands to the server process if a _sane_ umask is configured.

Should the user starting the server process *not* have a sane umask,
however, then the socket could become writable for other users and
therefore other users could execute arbitrary code in the context of the
unprivileged user:

    $ umask 0
    $ swhks &
    $ ls -lh /tmp/swhkd.sock
    srwxrwxrwx 1 mgerstner users 0 MÃ¤r 22 13:46 /tmp/swhkd.sock

Since an overly open umask is an issue in itself I did not request a CVE
for this issue.

### Bugfix

To protect against this scenario the socket file is now placed in the
respective user's private /run/user/$UID directory. Furthermore for
hardening purposes a sane umask is applied. The following upstream
commit contains this change:

<https://github.com/waycrate/swhkd/commit/707ea9915c9cf3d68b4a6729ac212a46a486e3fd>

3) Timeline
===========

- 2022-03-22: I reported these findings to upstream privately. I offered
  formal coordinated disclosure, no defined embargo and publication date
  have been established though.
- 2022-03-23: Upstream started quickly to work on bugfixes which have
  been published on GitHub right away. Therefore increasing parts of the
  information has become public over time.
- 2022-03-24: I received CVEs for the issues from Mitre and communicated
  them to upstream.
- 2022-04-13: I asked upstream for permission to publish the full
  report, since most CVEs have already public fixes, some of them still
  incomplete though.

References
==========

[1]: <https://github.com/waycrate/swhkd>
[2]: <https://bugzilla.suse.com/show_bug.cgi?id=1196890>
[3]: <https://github.com/waycrate/swhkd/pull/102#issuecomment-1088417911>

Best Regards

Matthias

--
Matthias Gerstner <matthias.gerstner@...e.de>
Security Engineer
<https://www.suse.com/security>
Phone: +49 911 740 53 290
GPG Key ID: 0x14C405C971923553

SUSE Software Solutions Germany GmbH
HRB 36809, AG NÃ¼rnberg
GeschÃ¤ftsfÃ¼hrer: Ivo Totev

Download attachment "[signature.asc](1/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


