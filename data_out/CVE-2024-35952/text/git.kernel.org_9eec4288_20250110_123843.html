

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bc004f5038220b1891ef4107134ccae44be55109)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bc004f5038220b1891ef4107134ccae44be55109)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bc004f5038220b1891ef4107134ccae44be55109)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc004f5038220b1891ef4107134ccae44be55109)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jammy Huang <jammy\_huang@aspeedtech.com> | 2024-04-03 17:02:46 +0800 |
| --- | --- | --- |
| committer | Thomas Zimmermann <tzimmermann@suse.de> | 2024-04-05 10:22:23 +0200 |
| commit | [bc004f5038220b1891ef4107134ccae44be55109](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bc004f5038220b1891ef4107134ccae44be55109) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bc004f5038220b1891ef4107134ccae44be55109)) | |
| tree | [36bc57cb303445c73b3d34041278058c65538cae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bc004f5038220b1891ef4107134ccae44be55109) | |
| parent | [1fc9af813b25e146d3607669247d0f970f5a87c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1fc9af813b25e146d3607669247d0f970f5a87c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc004f5038220b1891ef4107134ccae44be55109&id2=1fc9af813b25e146d3607669247d0f970f5a87c3)) | |
| download | [linux-bc004f5038220b1891ef4107134ccae44be55109.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bc004f5038220b1891ef4107134ccae44be55109.tar.gz) | |

drm/ast: Fix soft lockupThere is a while-loop in ast\_dp\_set\_on\_off() that could lead to
infinite-loop. This is because the register, VGACRI-Dx, checked in
this API is a scratch register actually controlled by a MCU, named
DPMCU, in BMC.
These scratch registers are protected by scu-lock. If suc-lock is not
off, DPMCU can not update these registers and then host will have soft
lockup due to never updated status.
DPMCU is used to control DP and relative registers to handshake with
host's VGA driver. Even the most time-consuming task, DP's link
training, is less than 100ms. 200ms should be enough.
Signed-off-by: Jammy Huang <jammy\_huang@aspeedtech.com>
Fixes: 594e9c04b586 ("drm/ast: Create the driver for ASPEED proprietory Display-Port")
Reviewed-by: Jocelyn Falempe <jfalempe@redhat.com>
Reviewed-by: Thomas Zimmermann <tzimmermann@suse.de>
Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
Cc: KuoHsiang Chou <kuohsiang\_chou@aspeedtech.com>
Cc: Thomas Zimmermann <tzimmermann@suse.de>
Cc: Dave Airlie <airlied@redhat.com>
Cc: Jocelyn Falempe <jfalempe@redhat.com>
Cc: dri-devel@lists.freedesktop.org
Cc: <stable@vger.kernel.org> # v5.19+
Link: [https://patchwork.freedesktop.org/patch/msgid/20240403090246.1495487-1-jammy\_huang@aspeedtech.com](https://patchwork.freedesktop.org/patch/msgid/20240403090246.1495487-1-jammy_huang%40aspeedtech.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bc004f5038220b1891ef4107134ccae44be55109)

| -rw-r--r-- | [drivers/gpu/drm/ast/ast\_dp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/ast/ast_dp.c?id=bc004f5038220b1891ef4107134ccae44be55109) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/ast/ast\_dp.c b/drivers/gpu/drm/ast/ast\_dp.cindex ebb6d8ebd44eb6..1e9259416980ec 100644--- a/[drivers/gpu/drm/ast/ast\_dp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/ast/ast_dp.c?id=1fc9af813b25e146d3607669247d0f970f5a87c3)+++ b/[drivers/gpu/drm/ast/ast\_dp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/ast/ast_dp.c?id=bc004f5038220b1891ef4107134ccae44be55109)@@ -180,6 +180,7 @@ void ast\_dp\_set\_on\_off(struct drm\_device \*dev, bool on) { struct ast\_device \*ast = to\_ast\_device(dev); u8 video\_on\_off = on;+ u32 i = 0;  // Video On/Off ast\_set\_index\_reg\_mask(ast, AST\_IO\_VGACRI, 0xE3, (u8) ~AST\_DP\_VIDEO\_ENABLE, on);@@ -192,6 +193,8 @@ void ast\_dp\_set\_on\_off(struct drm\_device \*dev, bool on) ASTDP\_MIRROR\_VIDEO\_ENABLE) != video\_on\_off) { // wait 1 ms mdelay(1);+ if (++i > 200)+ break; } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:37:20 +0000

