
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0branch%2Fboron%2Fissues%2F3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2F0branch%2Fboron%2Fissues%2F3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=0branch%2Fboron)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[0branch](/0branch)
/
**[boron](/0branch/boron)**
Public

* [Notifications](/login?return_to=%2F0branch%2Fboron) You must be signed in to change notification settings
* [Fork
  3](/login?return_to=%2F0branch%2Fboron)
* [Star
   21](/login?return_to=%2F0branch%2Fboron)

* [Code](/0branch/boron)
* [Issues
  0](/0branch/boron/issues)
* [Pull requests
  0](/0branch/boron/pulls)
* [Actions](/0branch/boron/actions)
* [Projects
  0](/0branch/boron/projects)
* [Wiki](/0branch/boron/wiki)
* [Security](/0branch/boron/security)
* [Insights](/0branch/boron/pulse)

Additional navigation options

* [Code](/0branch/boron)
* [Issues](/0branch/boron/issues)
* [Pull requests](/0branch/boron/pulls)
* [Actions](/0branch/boron/actions)
* [Projects](/0branch/boron/projects)
* [Wiki](/0branch/boron/wiki)
* [Security](/0branch/boron/security)
* [Insights](/0branch/boron/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2F0branch%2Fboron%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2F0branch%2Fboron%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Heap Overflows in Libboron v2.0.8 #3

Closed

[Halcy0nic](/Halcy0nic) opened this issue
Aug 4, 2023
· 3 comments

Closed

# [Heap Overflows in Libboron v2.0.8](#top) #3

[Halcy0nic](/Halcy0nic) opened this issue
Aug 4, 2023
· 3 comments

## Comments

[![@Halcy0nic](https://avatars.githubusercontent.com/u/42481692?s=80&u=2d33594f736ed622d96b4fa6f965ab39b433b7f1&v=4)](/Halcy0nic)

Copy link

### **[Halcy0nic](/Halcy0nic)** commented [Aug 4, 2023](#issue-1837133829)

| Hi!  While I was running boron in my environment, I happened to stumble upon 2 heap buffer overflows in the libboron library (libboron.so.2 version 2.0.8) when processing slightly malformed input. I have included reproduction files and tried my best to pinpoint the location of both heap buffer overflows. I tested this on both Mac (x86\_64) and Linux (x86\_64): Files for reproduction [reproduction.zip](https://github.com/0branch/boron/files/12263243/reproduction.zip) Compiling ``` git clone https://github.com/0branch/boron.git cd boron ./configure && make sudo make install && sudo ldconfig  ``` Heap buffer overflow in ur\_parseBlockI at i\_parse\_blk.c:    [boron/urlan/i\_parse\_blk.c](https://github.com/0branch/boron/blob/e98ed6cbc7911cf31a6e4ac8a0b00fd7c224e807/urlan/i_parse_blk.c#L21)  Line 21 in [e98ed6c](/0branch/boron/commit/e98ed6cbc7911cf31a6e4ac8a0b00fd7c224e807)   |  | int ur\_parseBlockI( UBlockParser\* par, const uint8\_t\* pc, const UCell\* it ) | | --- | --- |      First, I executed boron against the file that produced the crash:  ``` $ ./boron ur_parseBlockI_overflow.b  malloc(): invalid size (unsorted) zsh: IOT instruction  ./boron ur_parseBlockI_overflow.b  ```  The output made be believe that there was a heap overflow corrupting a heap chunk in the unsorted bin, so I compiled the project with address sanitizer and debug symbols to verify: Makefile ``` # Boron Makefile for UNIX systems.  VER=2.0.8  DESTDIR ?= /usr/local BIN_DIR=$(DESTDIR)/bin LIB_DIR=$(DESTDIR)/lib INC_DIR=$(DESTDIR)/include/boron MAN_DIR=$(DESTDIR)/share/man/man1 VIM_DIR=$(DESTDIR)/share/vim/vimfiles/syntax  OS := $(shell uname)  CFLAGS = -pipe -pedantic -Wall -W -Iinclude -Iurlan -Ieval -Isupport -g -fsanitize=address -DDEBUG #CFLAGS += -O3 -DNDEBUG #CFLAGS += -g -DDEBUG  ifeq ($(OS), Darwin) CFLAGS += -std=c99 AR_LIB = libtool -static -o else CFLAGS += -std=gnu99 -fPIC AR_LIB = ar rc ifneq (,$(wildcard /usr/lib64/libc.so)) LIB_DIR=$(DESTDIR)/lib64 else ifneq (,$(wildcard /usr/lib/x86_64-linux-gnu/.)) LIB_DIR=$(DESTDIR)/lib/x86_64-linux-gnu endif endif  CONFIG := $(shell cat config.opt) ifneq (,$(findstring _STATIC,$(CONFIG))) 	STATIC_LIB = true endif  LIBS := -lm  ODIR = .obj OBJ_FN = env.o array.o binary.o block.o coord.o date.o path.o \ 	string.o context.o gc.o serialize.o tokenize.o \ 	vector.o parse_block.o parse_string.o OBJ_FN += str.o mem_util.o quickSortIndex.o fpconv.o OBJ_FN += os.o boron.o port_file.o wait.o ifneq (,$(findstring _HASHMAP,$(CONFIG))) OBJ_FN += hashmap.o endif ifneq (,$(findstring _RANDOM,$(CONFIG))) OBJ_FN += well512.o random.o endif ifneq (,$(findstring _SOCKET,$(CONFIG))) OBJ_FN += port_socket.o endif ifneq (,$(findstring _THREAD,$(CONFIG))) OBJ_FN += port_thread.o ifeq ($(OS), Linux) LIBS += -lpthread endif endif LIB_OBJS = $(addprefix $(ODIR)/,$(OBJ_FN))   MAIN_FN = main.o  ifneq (,$(findstring _LINENOISE,$(CONFIG))) MAIN_FN += linenoise.o else EXE_LIBS += -lreadline -lhistory endif ifneq (,$(findstring _COMPRESS=1,$(CONFIG))) LIBS += -lz endif ifneq (,$(findstring _COMPRESS=2,$(CONFIG))) LIBS += -lbz2 endif EXE_OBJS = $(addprefix $(ODIR)/,$(MAIN_FN))  ifdef STATIC_LIB BORON_LIB = libboron.a EXE_LIBS += $(LIBS) else ifeq ($(OS), Darwin) BORON_LIB = libboron.dylib else BORON_LIB = libboron.so.$(VER) endif   $(ODIR)/%.o: urlan/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@ $(ODIR)/%.o: support/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@ $(ODIR)/%.o: eval/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@  boron: $(EXE_OBJS) $(BORON_LIB) 	cc $^ -o $@ $(EXE_LIBS) -g -fsanitize=address  $(ODIR)/os.o: unix/os.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@  $(EXE_OBJS): | $(ODIR) $(LIB_OBJS): | $(ODIR) $(ODIR): 	mkdir -p $@  $(BORON_LIB): $(LIB_OBJS) ifdef STATIC_LIB 	$(AR_LIB) $@ $^ 	ranlib $@ else ifeq ($(OS), Darwin) 	libtool -dynamiclib -o $@ $^ -install_name @rpath/$(BORON_LIB) $(LIBS) else 	cc -o $@  -shared -g -fsanitize=address -Wl,-soname,libboron.so.2 $^ $(LIBS) 	ln -sf $(BORON_LIB) libboron.so.2 	ln -sf $(BORON_LIB) libboron.so endif  .PHONY: clean install uninstall install-dev uninstall-dev  clean: 	rm -f boron $(BORON_LIB) $(LIB_OBJS) $(EXE_OBJS) ifndef STATIC_LIB 	rm -f libboron.so* endif 	rmdir $(ODIR)  install: 	mkdir -p $(BIN_DIR) $(LIB_DIR) $(MAN_DIR) ifndef STATIC_LIB ifeq ($(OS), Darwin) 	install_name_tool -id $(LIB_DIR)/libboron.dylib libboron.dylib 	install_name_tool -change libboron.dylib $(LIB_DIR)/libboron.dylib boron 	install -m 644 libboron.dylib $(LIB_DIR) else 	install -m 755 -s $(BORON_LIB) $(LIB_DIR) 	ln -s $(BORON_LIB) $(LIB_DIR)/libboron.so.2 endif endif 	install -s -m 755 boron $(BIN_DIR) 	gzip -c -n doc/boron.troff > doc/boron.1.gz 	install -m 644 doc/boron.1.gz $(MAN_DIR)  uninstall: 	rm -f $(BIN_DIR)/boron $(MAN_DIR)/boron.1 ifndef STATIC_LIB 	rm -f $(LIB_DIR)/$(BORON_LIB) ifneq ($(OS), Darwin) 	rm -f $(LIB_DIR)/libboron.so.2 endif endif  install-dev: 	mkdir -p $(INC_DIR) $(LIB_DIR) 	sed -e 's~"urlan.h"~<boron/urlan.h>~' include/boron.h >boron.tmp 	install -m 644 boron.tmp $(INC_DIR)/boron.h 	rm boron.tmp 	install -m 644 include/urlan.h        $(INC_DIR) 	install -m 644 include/urlan_atoms.h  $(INC_DIR) #	install -m 755 scripts/copr.b $(BIN_DIR)/copr ifdef STATIC_LIB 	install -m 644 $(BORON_LIB) $(LIB_DIR) endif ifneq ($(OS), Darwin) 	mkdir -p $(VIM_DIR) 	install -m 644 doc/boron.vim $(VIM_DIR) ifndef STATIC_LIB 	ln -s $(BORON_LIB) $(LIB_DIR)/libboron.so endif endif  uninstall-dev: ifdef STATIC_LIB 	rm -f $(LIB_DIR)/$(BORON_LIB) endif ifneq ($(OS), Darwin) ifndef STATIC_LIB 	rm -f $(LIB_DIR)/libboron.so endif 	rm -f $(VIM_DIR)/boron.vim endif #	rm -f $(BIN_DIR)/copr 	rm -f $(INC_DIR)/boron.h $(INC_DIR)/urlan.h $(INC_DIR)/urlan_atoms.h 	rmdir $(INC_DIR)  ```  Executing boron against ur\_parseBlockI\_overflow.b a second time produces the following output from ASAN, confirming the heap buffer overflow: Address Sanitizer Output ``` ================================================================= ==104977==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x603000000ce8 at pc 0x7ff8ed7c9b02 bp 0x7ffdcef68600 sp 0x7ffdcef685f8 WRITE of size 1 at 0x603000000ce8 thread T0     #0 0x7ff8ed7c9b01  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa1b01) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #1 0x7ff8ed7c8426 in ur_parseBlockI (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa0426) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #2 0x7ff8ed7c8e63 in ur_parseBlockI (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa0e63) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #3 0x7ff8ed7cbf88 in boron_compileArgProgram (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa3f88) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #4 0x7ff8ed7b1364  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x89364) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #5 0x7ff8ed7cdefe  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa5efe) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #6 0x7ff8ed7cfac0 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7ac0) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #7 0x7ff8ed7cfe44 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7e44) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #8 0x7ff8ed7d090c in boron_doBlock (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa890c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #9 0x7ff8ed7a119f in boron_doVoid (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x7919f) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #10 0x7ff8ed7b052d  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x8852d) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #11 0x7ff8ed7b071c  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x8871c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #12 0x7ff8ed7cdefe  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa5efe) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #13 0x7ff8ed7cfac0 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7ac0) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #14 0x7ff8ed7cf2f2  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa72f2) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #15 0x7ff8ed7cfb41 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7b41) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #16 0x7ff8ed7cfe44 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7e44) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #17 0x7ff8ed7d090c in boron_doBlock (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa890c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #18 0x55a6bcb4873f in main eval/main.c:354     #19 0x7ff8ed56d6c9 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58     #20 0x7ff8ed56d784 in __libc_start_main_impl ../csu/libc-start.c:360     #21 0x55a6bcb474d0 in _start (/dev/shm/boron/boron+0x34d0) (BuildId: bdf03d04eb6f48f8cccbd806f9b1261d304239a6)  0x603000000ce8 is located 0 bytes after 24-byte region [0x603000000cd0,0x603000000ce8) allocated by thread T0 here:     #0 0x7ff8ed8d85cf in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:69     #1 0x7ff8ed764cdf in ur_binReserve (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x3ccdf) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #2 0x7ff8ed7cbb5a in boron_compileArgProgram (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa3b5a) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #3 0x7ff8ed7b1364  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x89364) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #4 0x7ff8ed7cdefe  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa5efe) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #5 0x7ff8ed7cfac0 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7ac0) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #6 0x7ff8ed7cfe44 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7e44) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #7 0x7ff8ed7d090c in boron_doBlock (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa890c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #8 0x7ff8ed7a119f in boron_doVoid (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x7919f) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #9 0x7ff8ed7b052d  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x8852d) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #10 0x7ff8ed7b071c  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x8871c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #11 0x7ff8ed7cdefe  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa5efe) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #12 0x7ff8ed7cfac0 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7ac0) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #13 0x7ff8ed7cf2f2  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa72f2) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #14 0x7ff8ed7cfb41 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7b41) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #15 0x7ff8ed7cfe44 in boron_eval1 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa7e44) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #16 0x7ff8ed7d090c in boron_doBlock (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa890c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #17 0x55a6bcb4873f in main eval/main.c:354     #18 0x7ff8ed56d6c9 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58  SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xa1b01) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)  Shadow bytes around the buggy address:   0x603000000a00: 00 00 06 fa fa fa 00 00 04 fa fa fa 00 00 03 fa   0x603000000a80: fa fa 00 00 01 fa fa fa 00 00 02 fa fa fa 00 00   0x603000000b00: 00 03 fa fa 00 00 00 06 fa fa 00 00 00 fa fa fa   0x603000000b80: 00 00 00 03 fa fa 00 00 00 fa fa fa 00 00 00 fa   0x603000000c00: fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00 =>0x603000000c80: 00 fa fa fa 00 00 00 fa fa fa 00 00 00[fa]fa fa   0x603000000d00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x603000000d80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x603000000e00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x603000000e80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x603000000f00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==104977==ABORTING   ``` Heap buffer overflow in ur\_strInitUtf8 at string.c    [boron/urlan/string.c](https://github.com/0branch/boron/blob/e98ed6cbc7911cf31a6e4ac8a0b00fd7c224e807/urlan/string.c#L343)  Line 343 in [e98ed6c](/0branch/boron/commit/e98ed6cbc7911cf31a6e4ac8a0b00fd7c224e807)   |  | void ur\_strInitUtf8( UBuffer\* buf, const uint8\_t\* it, const uint8\_t\* end ) | | --- | --- |      Next, I executed boron against the file that produced the crash in ur\_strInitUtf8:  ``` ./boron ur_strInitUtf8_overflow.b  corrupted size vs. prev_size zsh: IOT instruction  ./boron ur_strInitUtf8_overflow.b   ```  The output made be believe that there was a heap overflow corrupting the heap chunk size/prev\_size, so I compiled the project with address sanitizer and debug symbols to verify:  ``` # Boron Makefile for UNIX systems.  VER=2.0.8  DESTDIR ?= /usr/local BIN_DIR=$(DESTDIR)/bin LIB_DIR=$(DESTDIR)/lib INC_DIR=$(DESTDIR)/include/boron MAN_DIR=$(DESTDIR)/share/man/man1 VIM_DIR=$(DESTDIR)/share/vim/vimfiles/syntax  OS := $(shell uname)  CFLAGS = -pipe -pedantic -Wall -W -Iinclude -Iurlan -Ieval -Isupport -g -fsanitize=address -DDEBUG #CFLAGS += -O3 -DNDEBUG #CFLAGS += -g -DDEBUG  ifeq ($(OS), Darwin) CFLAGS += -std=c99 AR_LIB = libtool -static -o else CFLAGS += -std=gnu99 -fPIC AR_LIB = ar rc ifneq (,$(wildcard /usr/lib64/libc.so)) LIB_DIR=$(DESTDIR)/lib64 else ifneq (,$(wildcard /usr/lib/x86_64-linux-gnu/.)) LIB_DIR=$(DESTDIR)/lib/x86_64-linux-gnu endif endif  CONFIG := $(shell cat config.opt) ifneq (,$(findstring _STATIC,$(CONFIG))) 	STATIC_LIB = true endif  LIBS := -lm  ODIR = .obj OBJ_FN = env.o array.o binary.o block.o coord.o date.o path.o \ 	string.o context.o gc.o serialize.o tokenize.o \ 	vector.o parse_block.o parse_string.o OBJ_FN += str.o mem_util.o quickSortIndex.o fpconv.o OBJ_FN += os.o boron.o port_file.o wait.o ifneq (,$(findstring _HASHMAP,$(CONFIG))) OBJ_FN += hashmap.o endif ifneq (,$(findstring _RANDOM,$(CONFIG))) OBJ_FN += well512.o random.o endif ifneq (,$(findstring _SOCKET,$(CONFIG))) OBJ_FN += port_socket.o endif ifneq (,$(findstring _THREAD,$(CONFIG))) OBJ_FN += port_thread.o ifeq ($(OS), Linux) LIBS += -lpthread endif endif LIB_OBJS = $(addprefix $(ODIR)/,$(OBJ_FN))   MAIN_FN = main.o  ifneq (,$(findstring _LINENOISE,$(CONFIG))) MAIN_FN += linenoise.o else EXE_LIBS += -lreadline -lhistory endif ifneq (,$(findstring _COMPRESS=1,$(CONFIG))) LIBS += -lz endif ifneq (,$(findstring _COMPRESS=2,$(CONFIG))) LIBS += -lbz2 endif EXE_OBJS = $(addprefix $(ODIR)/,$(MAIN_FN))  ifdef STATIC_LIB BORON_LIB = libboron.a EXE_LIBS += $(LIBS) else ifeq ($(OS), Darwin) BORON_LIB = libboron.dylib else BORON_LIB = libboron.so.$(VER) endif   $(ODIR)/%.o: urlan/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@ $(ODIR)/%.o: support/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@ $(ODIR)/%.o: eval/%.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@  boron: $(EXE_OBJS) $(BORON_LIB) 	cc $^ -o $@ $(EXE_LIBS) -g -fsanitize=address  $(ODIR)/os.o: unix/os.c 	cc -c $(CFLAGS) $(CONFIG) $< -o $@  $(EXE_OBJS): | $(ODIR) $(LIB_OBJS): | $(ODIR) $(ODIR): 	mkdir -p $@  $(BORON_LIB): $(LIB_OBJS) ifdef STATIC_LIB 	$(AR_LIB) $@ $^ 	ranlib $@ else ifeq ($(OS), Darwin) 	libtool -dynamiclib -o $@ $^ -install_name @rpath/$(BORON_LIB) $(LIBS) else 	cc -o $@  -shared -g -fsanitize=address -Wl,-soname,libboron.so.2 $^ $(LIBS) 	ln -sf $(BORON_LIB) libboron.so.2 	ln -sf $(BORON_LIB) libboron.so endif  .PHONY: clean install uninstall install-dev uninstall-dev  clean: 	rm -f boron $(BORON_LIB) $(LIB_OBJS) $(EXE_OBJS) ifndef STATIC_LIB 	rm -f libboron.so* endif 	rmdir $(ODIR)  install: 	mkdir -p $(BIN_DIR) $(LIB_DIR) $(MAN_DIR) ifndef STATIC_LIB ifeq ($(OS), Darwin) 	install_name_tool -id $(LIB_DIR)/libboron.dylib libboron.dylib 	install_name_tool -change libboron.dylib $(LIB_DIR)/libboron.dylib boron 	install -m 644 libboron.dylib $(LIB_DIR) else 	install -m 755 -s $(BORON_LIB) $(LIB_DIR) 	ln -s $(BORON_LIB) $(LIB_DIR)/libboron.so.2 endif endif 	install -s -m 755 boron $(BIN_DIR) 	gzip -c -n doc/boron.troff > doc/boron.1.gz 	install -m 644 doc/boron.1.gz $(MAN_DIR)  uninstall: 	rm -f $(BIN_DIR)/boron $(MAN_DIR)/boron.1 ifndef STATIC_LIB 	rm -f $(LIB_DIR)/$(BORON_LIB) ifneq ($(OS), Darwin) 	rm -f $(LIB_DIR)/libboron.so.2 endif endif  install-dev: 	mkdir -p $(INC_DIR) $(LIB_DIR) 	sed -e 's~"urlan.h"~<boron/urlan.h>~' include/boron.h >boron.tmp 	install -m 644 boron.tmp $(INC_DIR)/boron.h 	rm boron.tmp 	install -m 644 include/urlan.h        $(INC_DIR) 	install -m 644 include/urlan_atoms.h  $(INC_DIR) #	install -m 755 scripts/copr.b $(BIN_DIR)/copr ifdef STATIC_LIB 	install -m 644 $(BORON_LIB) $(LIB_DIR) endif ifneq ($(OS), Darwin) 	mkdir -p $(VIM_DIR) 	install -m 644 doc/boron.vim $(VIM_DIR) ifndef STATIC_LIB 	ln -s $(BORON_LIB) $(LIB_DIR)/libboron.so endif endif  uninstall-dev: ifdef STATIC_LIB 	rm -f $(LIB_DIR)/$(BORON_LIB) endif ifneq ($(OS), Darwin) ifndef STATIC_LIB 	rm -f $(LIB_DIR)/libboron.so endif 	rm -f $(VIM_DIR)/boron.vim endif #	rm -f $(BIN_DIR)/copr 	rm -f $(INC_DIR)/boron.h $(INC_DIR)/urlan.h $(INC_DIR)/urlan_atoms.h 	rmdir $(INC_DIR)  ```  Executing boron against ur\_strInitUtf8\_overflow.b a second time will produce the output from ASAN confirming the heap buffer overflow:  ``` └─$ ./boron overflows/ur_strInitUtf8_overflow.b  ================================================================= ==122297==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61a000001708 at pc 0x7f6b69141450 bp 0x7ffc47b562d0 sp 0x7ffc47b562c8 WRITE of size 1 at 0x61a000001708 thread T0     #0 0x7f6b6914144f in ur_strInitUtf8 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x4644f) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #1 0x7f6b6914185c in ur_makeStringUtf8 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x4685c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #2 0x7f6b69159959 in ur_tokenizeB (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x5e959) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #3 0x7f6b6915a3ac in ur_tokenize (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x5f3ac) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #4 0x7f6b69193e78  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x98e78) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #5 0x7f6b691a774b in boron_load (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xac74b) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #6 0x55e53db95707 in main eval/main.c:351     #7 0x7f6b688456c9 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58     #8 0x7f6b68845784 in __libc_start_main_impl ../csu/libc-start.c:360     #9 0x55e53db944d0 in _start (/dev/shm/boron/boron+0x34d0) (BuildId: bdf03d04eb6f48f8cccbd806f9b1261d304239a6)  0x61a000001708 is located 0 bytes after 1160-byte region [0x61a000001280,0x61a000001708) allocated by thread T0 here:     #0 0x7f6b68ad85cf in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:69     #1 0x7f6b69136c11 in ur_arrInit (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x3bc11) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #2 0x7f6b69141908 in ur_strInit (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x46908) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #3 0x7f6b691412bd in ur_strInitUtf8 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x462bd) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #4 0x7f6b6914185c in ur_makeStringUtf8 (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x4685c) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #5 0x7f6b69159959 in ur_tokenizeB (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x5e959) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #6 0x7f6b6915a3ac in ur_tokenize (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x5f3ac) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #7 0x7f6b69193e78  (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x98e78) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #8 0x7f6b691a774b in boron_load (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0xac74b) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a)     #9 0x55e53db95707 in main eval/main.c:351     #10 0x7f6b688456c9 in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58  SUMMARY: AddressSanitizer: heap-buffer-overflow (/usr/local/lib/x86_64-linux-gnu/libboron.so.2+0x4644f) (BuildId: 8604ed3373a7d0fad1d0ab72cbd67e9bc93ce54a) in ur_strInitUtf8 Shadow bytes around the buggy address:   0x61a000001480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x61a000001500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x61a000001580: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x61a000001600: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x61a000001680: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x61a000001700: 00[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x61a000001780: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x61a000001800: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x61a000001880: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x61a000001900: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x61a000001980: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==122297==ABORTING   ``` Mitigation For both of these heap overflows a check on the size of the data being copied over to the heap should do the trick.  Thanks! Halcy0nic |
| --- | --- | --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@WickedSmoke](https://avatars.githubusercontent.com/u/59343722?s=80&v=4)](/WickedSmoke)

Copy link

Contributor

### **[WickedSmoke](/WickedSmoke)** commented [Dec 12, 2023](#issuecomment-1851199946)

| Halcy0nic,  Thanks for reporting these issues, but you'll get a quicker response if you use email (the address at the bottom of README.md) rather than this mirror.  The ur\_strInitUtf8 bug is fixed in commit b22dd72f (in the official SourceForge repo.). I'll comment again when the other one is fixed. |
| --- |

All reactions

Sorry, something went wrong.

[![@WickedSmoke](https://avatars.githubusercontent.com/u/59343722?s=80&v=4)](/WickedSmoke)

Copy link

Contributor

### **[WickedSmoke](/WickedSmoke)** commented [Dec 12, 2023](#issuecomment-1851299787) • edited Loading

| The ur\_parseBlockI bug is fixed in commit dd793349.  [@0branch](https://github.com/0branch), there is new code on SourceForge you can sync with to close this issue. |
| --- |

All reactions

Sorry, something went wrong.

[![@Halcy0nic](https://avatars.githubusercontent.com/u/42481692?s=80&u=2d33594f736ed622d96b4fa6f965ab39b433b7f1&v=4)](/Halcy0nic)

Copy link

Author

### **[Halcy0nic](/Halcy0nic)** commented [Dec 12, 2023](#issuecomment-1852148521)

| Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Halcy0nic](https://avatars.githubusercontent.com/u/42481692?s=40&u=2d33594f736ed622d96b4fa6f965ab39b433b7f1&v=4)](/Halcy0nic)
[Halcy0nic](/Halcy0nic)
closed this as [completed](/0branch/boron/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Dec 12, 2023](#event-11224359697)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2F0branch%2Fboron%2Fissues%2F3)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@Halcy0nic](https://avatars.githubusercontent.com/u/42481692?s=52&v=4)](/Halcy0nic) [![@WickedSmoke](https://avatars.githubusercontent.com/u/59343722?s=52&v=4)](/WickedSmoke)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

