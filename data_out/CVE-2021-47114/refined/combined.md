=== Content from git.kernel.org_e154ea69_20250110_135251.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 13:24:06 +0200 |
| commit | [cec4e857ffaa8c447f51cd8ab4e72350077b6770](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)) | |
| tree | [2d1a84e200df06287e95b7107017ce30f1c44f7a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770) | |
| parent | [d106f05432e60f9f62d456ef017687f5c73cb414](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d106f05432e60f9f62d456ef017687f5c73cb414) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770&id2=d106f05432e60f9f62d456ef017687f5c73cb414)) | |
| download | [linux-cec4e857ffaa8c447f51cd8ab4e72350077b6770.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cec4e857ffaa8c447f51cd8ab4e72350077b6770.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex 5c507569ef7047..94df697e263856 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=d106f05432e60f9f62d456ef017687f5c73cb414)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=cec4e857ffaa8c447f51cd8ab4e72350077b6770)@@ -1864,6 +1864,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1873,7 +1912,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1904,6 +1943,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1911,7 +1951,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1965,6 +2005,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1981,9 +2029,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:28 +0000



=== Content from git.kernel.org_c936a43f_20250110_135248.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 13:39:26 +0200 |
| commit | [c8d5faee46242c3f33b8a71a4d7d52214785bfcc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)) | |
| tree | [8ecafef7260bfe024b5bb8aa8ccf57d9e6908bdc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc) | |
| parent | [7178be006d495ffb741c329012da289b62dddfe6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7178be006d495ffb741c329012da289b62dddfe6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc&id2=7178be006d495ffb741c329012da289b62dddfe6)) | |
| download | [linux-c8d5faee46242c3f33b8a71a4d7d52214785bfcc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c8d5faee46242c3f33b8a71a4d7d52214785bfcc.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex 8880071ee4ee0d..2b296d720c9fac 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=7178be006d495ffb741c329012da289b62dddfe6)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=c8d5faee46242c3f33b8a71a4d7d52214785bfcc)@@ -1856,6 +1856,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1865,7 +1904,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1896,6 +1935,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1903,7 +1943,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1957,6 +1997,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1973,9 +2021,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:25 +0000



=== Content from git.kernel.org_d6b02409_20250110_135247.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 12:43:51 +0200 |
| commit | [a1700479524bb9cb5e8ae720236a6fabd003acae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1700479524bb9cb5e8ae720236a6fabd003acae) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)) | |
| tree | [1d23ee706c419644dfcb97aa5968c44d5e5e6da4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1700479524bb9cb5e8ae720236a6fabd003acae) | |
| parent | [4dbd8808a591b49b717862e6e0081bcf14a87788](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4dbd8808a591b49b717862e6e0081bcf14a87788) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1700479524bb9cb5e8ae720236a6fabd003acae&id2=4dbd8808a591b49b717862e6e0081bcf14a87788)) | |
| download | [linux-a1700479524bb9cb5e8ae720236a6fabd003acae.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a1700479524bb9cb5e8ae720236a6fabd003acae.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1700479524bb9cb5e8ae720236a6fabd003acae)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=a1700479524bb9cb5e8ae720236a6fabd003acae) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex baf5c4028fd622..90e658caa8deb1 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=4dbd8808a591b49b717862e6e0081bcf14a87788)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=a1700479524bb9cb5e8ae720236a6fabd003acae)@@ -1862,6 +1862,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1871,7 +1910,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1902,6 +1941,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1909,7 +1949,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1963,6 +2003,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1979,9 +2027,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:24 +0000



=== Content from git.kernel.org_5a99e893_20250110_135250.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 13:37:12 +0200 |
| commit | [cc2edb99ea606a45182b5ea38cc8f4e583aa0774](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)) | |
| tree | [b74ee2fa655158ed45819211c268423c644929ba](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774) | |
| parent | [2cd6eedfa6344f5ef5c3dac3aee57a39b5b46dff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2cd6eedfa6344f5ef5c3dac3aee57a39b5b46dff) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774&id2=2cd6eedfa6344f5ef5c3dac3aee57a39b5b46dff)) | |
| download | [linux-cc2edb99ea606a45182b5ea38cc8f4e583aa0774.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cc2edb99ea606a45182b5ea38cc8f4e583aa0774.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex ab2b0d74ad03e5..c2852d7cc14d4e 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=2cd6eedfa6344f5ef5c3dac3aee57a39b5b46dff)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=cc2edb99ea606a45182b5ea38cc8f4e583aa0774)@@ -1856,6 +1856,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1865,7 +1904,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1896,6 +1935,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1903,7 +1943,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1957,6 +1997,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1973,9 +2021,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:27 +0000



=== Content from git.kernel.org_c090e181_20250110_135244.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 12:41:36 +0200 |
| commit | [624fa7baa3788dc9e57840ba5b94bc22b03cda57](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)) | |
| tree | [18715c4939f3849373f59968819c9a561a9ec15f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57) | |
| parent | [764c2e892d1fe895392aff62fb353fdce43bb529](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=764c2e892d1fe895392aff62fb353fdce43bb529) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57&id2=764c2e892d1fe895392aff62fb353fdce43bb529)) | |
| download | [linux-624fa7baa3788dc9e57840ba5b94bc22b03cda57.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-624fa7baa3788dc9e57840ba5b94bc22b03cda57.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex 1d738723a41ada..5b0f2c806f033c 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=764c2e892d1fe895392aff62fb353fdce43bb529)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=624fa7baa3788dc9e57840ba5b94bc22b03cda57)@@ -1860,6 +1860,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1869,7 +1908,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1900,6 +1939,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1907,7 +1947,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1961,6 +2001,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1977,9 +2025,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = CURRENT\_TIME; ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:22 +0000



=== Content from git.kernel.org_115abc65_20250110_135241.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 13:41:45 +0200 |
| commit | [0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)) | |
| tree | [53ee493b47a67fc70015d786f3888c079e9dcc4e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b) | |
| parent | [b8ff869f20152fbe66b6c2e2715d26a2f9897cca](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8ff869f20152fbe66b6c2e2715d26a2f9897cca) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b&id2=b8ff869f20152fbe66b6c2e2715d26a2f9897cca)) | |
| download | [linux-0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex 5edc1d0cf115fb..0e45893c0cda01 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=b8ff869f20152fbe66b6c2e2715d26a2f9897cca)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=0a31dd6fd2f4e7db538fb6eb1f06973d81f8dd3b)@@ -1858,6 +1858,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1867,7 +1906,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1898,6 +1937,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1905,7 +1945,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1959,6 +1999,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1975,9 +2023,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:19 +0000



=== Content from git.kernel.org_4418c8e6_20250110_135245.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2021-06-05 08:58:12 -0700 |
| commit | [6bba4471f0cc1296fe3c2089b9e52442d3074b2e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)) | |
| tree | [b38d8d6e8e9e0814c66fc6eec5400c800cb22ad0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e) | |
| parent | [415f0c835ba799e47ce077b01876568431da1ff3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=415f0c835ba799e47ce077b01876568431da1ff3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e&id2=415f0c835ba799e47ce077b01876568431da1ff3)) | |
| download | [linux-6bba4471f0cc1296fe3c2089b9e52442d3074b2e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6bba4471f0cc1296fe3c2089b9e52442d3074b2e.tar.gz) | |

ocfs2: fix data corruption by fallocateWhen fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex f17c3d33fb18a0..7756579430578b 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=415f0c835ba799e47ce077b01876568431da1ff3)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=6bba4471f0cc1296fe3c2089b9e52442d3074b2e)@@ -1856,6 +1856,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1865,7 +1904,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1896,6 +1935,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1903,7 +1943,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1957,6 +1997,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1973,9 +2021,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:22 +0000



=== Content from git.kernel.org_5bbcefbf_20250110_135243.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Junxiao Bi <junxiao.bi@oracle.com> | 2021-06-04 20:01:42 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 12:42:36 +0200 |
| commit | [33e03adafb29eedae1bae9cdb50c1385279fcf65](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)) | |
| tree | [f9c7b0aed6073b1641f875c6a933ca897c9916cd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65) | |
| parent | [f86c80515a8a3703e0ca2e56deb50fc2879c5ea4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f86c80515a8a3703e0ca2e56deb50fc2879c5ea4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65&id2=f86c80515a8a3703e0ca2e56deb50fc2879c5ea4)) | |
| download | [linux-33e03adafb29eedae1bae9cdb50c1385279fcf65.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-33e03adafb29eedae1bae9cdb50c1385279fcf65.tar.gz) | |

ocfs2: fix data corruption by fallocatecommit 6bba4471f0cc1296fe3c2089b9e52442d3074b2e upstream.
When fallocate punches holes out of inode size, if original isize is in
the middle of last cluster, then the part from isize to the end of the
cluster will be zeroed with buffer write, at that time isize is not yet
updated to match the new size, if writeback is kicked in, it will invoke
ocfs2\_writepage()->block\_write\_full\_page() where the pages out of inode
size will be dropped. That will cause file corruption. Fix this by
zero out eof blocks when extending the inode size.
Running the following command with qemu-image 4.2.1 can get a corrupted
coverted image file easily.
qemu-img convert -p -t none -T none -f qcow2 $qcow\_image \
-O qcow2 -o compat=1.1 $qcow\_image.conv
The usage of fallocate in qemu is like this, it first punches holes out
of inode size, then extend the inode size.
fallocate(11, FALLOC\_FL\_KEEP\_SIZE|FALLOC\_FL\_PUNCH\_HOLE, 2276196352, 65536) = 0
fallocate(11, 0, 2276196352, 65536) = 0
v1: https://www.spinics.net/lists/linux-fsdevel/msg193999.html
v2: https://lore.kernel.org/linux-fsdevel/20210525093034.GB4112@quack2.suse.cz/T/
Link: [https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi@oracle.com](https://lkml.kernel.org/r/20210528210648.9124-1-junxiao.bi%40oracle.com)
Signed-off-by: Junxiao Bi <junxiao.bi@oracle.com>
Reviewed-by: Joseph Qi <joseph.qi@linux.alibaba.com>
Cc: Jan Kara <jack@suse.cz>
Cc: Mark Fasheh <mark@fasheh.com>
Cc: Joel Becker <jlbec@evilplan.org>
Cc: Changwei Ge <gechangwei@live.cn>
Cc: Gang He <ghe@suse.com>
Cc: Jun Piao <piaojun@huawei.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)

| -rw-r--r-- | [fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/ocfs2/file.c?id=33e03adafb29eedae1bae9cdb50c1385279fcf65) | 55 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 5 deletions

| diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.cindex c17285df12be28..3aa4441f5ab507 100644--- a/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=f86c80515a8a3703e0ca2e56deb50fc2879c5ea4)+++ b/[fs/ocfs2/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/ocfs2/file.c?id=33e03adafb29eedae1bae9cdb50c1385279fcf65)@@ -1839,6 +1839,45 @@ out: }  /\*+ \* zero out partial blocks of one cluster.+ \*+ \* start: file offset where zero starts, will be made upper block aligned.+ \* len: it will be trimmed to the end of current cluster if "start + len"+ \* is bigger than it.+ \*/+static int ocfs2\_zeroout\_partial\_cluster(struct inode \*inode,+ u64 start, u64 len)+{+ int ret;+ u64 start\_block, end\_block, nr\_blocks;+ u64 p\_block, offset;+ u32 cluster, p\_cluster, nr\_clusters;+ struct super\_block \*sb = inode->i\_sb;+ u64 end = ocfs2\_align\_bytes\_to\_clusters(sb, start);++ if (start + len < end)+ end = start + len;++ start\_block = ocfs2\_blocks\_for\_bytes(sb, start);+ end\_block = ocfs2\_blocks\_for\_bytes(sb, end);+ nr\_blocks = end\_block - start\_block;+ if (!nr\_blocks)+ return 0;++ cluster = ocfs2\_bytes\_to\_clusters(sb, start);+ ret = ocfs2\_get\_clusters(inode, cluster, &p\_cluster,+ &nr\_clusters, NULL);+ if (ret)+ return ret;+ if (!p\_cluster)+ return 0;++ offset = start\_block - ocfs2\_clusters\_to\_blocks(sb, cluster);+ p\_block = ocfs2\_clusters\_to\_blocks(sb, p\_cluster) + offset;+ return sb\_issue\_zeroout(sb, p\_block, nr\_blocks, GFP\_NOFS);+}++/\* \* Parts of this function taken from xfs\_change\_file\_space() \*/ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode,@@ -1848,7 +1887,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, { int ret; s64 llen;- loff\_t size;+ loff\_t size, orig\_isize; struct ocfs2\_super \*osb = OCFS2\_SB(inode->i\_sb); struct buffer\_head \*di\_bh = NULL; handle\_t \*handle;@@ -1879,6 +1918,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } + orig\_isize = i\_size\_read(inode); switch (sr->l\_whence) { case 0: /\*SEEK\_SET\*/ break;@@ -1886,7 +1926,7 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, sr->l\_start += f\_pos; break; case 2: /\*SEEK\_END\*/- sr->l\_start += i\_size\_read(inode);+ sr->l\_start += orig\_isize; break; default: ret = -EINVAL;@@ -1940,6 +1980,14 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, default: ret = -EINVAL; }++ /\* zeroout eof blocks in the cluster. \*/+ if (!ret && change\_size && orig\_isize < size) {+ ret = ocfs2\_zeroout\_partial\_cluster(inode, orig\_isize,+ size - orig\_isize);+ if (!ret)+ i\_size\_write(inode, size);+ } up\_write(&OCFS2\_I(inode)->ip\_alloc\_sem); if (ret) { mlog\_errno(ret);@@ -1956,9 +2004,6 @@ static int \_\_ocfs2\_change\_file\_space(struct file \*file, struct inode \*inode, goto out\_inode\_unlock; } - if (change\_size && i\_size\_read(inode) < size)- i\_size\_write(inode, size);- inode->i\_ctime = inode->i\_mtime = current\_time(inode); ret = ocfs2\_mark\_inode\_dirty(handle, inode, di\_bh); if (ret < 0) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:51:20 +0000


