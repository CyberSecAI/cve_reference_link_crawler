=== Content from www.wordfence.com_799d424a_20250110_201515.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Visual Website Collaboration, Feedback & Project Management – Atarim <= 4.0.2 - Missing Authorization to Authenticated (Subscriber+) Settings Update

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Visual Website Collaboration, Feedback & Project Management – Atarim <= 4.0.2 - Missing Authorization to Authenticated (Subscriber+) Settings Update

5.4

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)

| CVE | [CVE-2024-7621](https://www.cve.org/CVERecord?id=CVE-2024-7621) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | August 9, 2024 |
| Last Updated | August 10, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The Visual Website Collaboration, Feedback & Project Management – Atarim plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the process\_wpfeedback\_misc\_options() function in all versions up to, and including, 4.0.2. This makes it possible for authenticated attackers, with Subscriber-level access and above, to update the plugins settings which can also be leveraged to gain access to the plugin's settings.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3116009#L235)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3133163/atarim-visual-collaboration/trunk/inc/wpf_function.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fatarim-visual-collaboration%2Fvisual-website-collaboration-feedback-project-management-atarim-402-missing-authorization-to-authenticated-subscriber-settings-update&t=Visual%20Website%20Collaboration%2C%20Feedback%20%26%20Project%20Management%20%E2%80%93%20Atarim%20%3C%3D%204.0.2%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fatarim-visual-collaboration%2Fvisual-website-collaboration-feedback-project-management-atarim-402-missing-authorization-to-authenticated-subscriber-settings-update&text=Visual%20Website%20Collaboration%2C%20Feedback%20%26%20Project%20Management%20%E2%80%93%20Atarim%20%3C%3D%204.0.2%20-%20Missing%20Authorization%20to%20Authenticated%20%28Subscriber%2B%29%20Settings%20Update "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fatarim-visual-collaboration%2Fvisual-website-collaboration-feedback-project-management-atarim-402-missing-authorization-to-authenticated-subscriber-settings-update "LinkedIn")
Email

## Vulnerability Details for Visual Website Collaboration, Feedback & Project Management – Atarim

#### [Visual Website Collaboration, Feedback & Project Management – Atarim](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/atarim-visual-collaboration)

| Software Type | Plugin |
| --- | --- |
| Software Slug | atarim-visual-collaboration [(view on wordpress.org)](https://wordpress.org/plugins/atarim-visual-collaboration) |
| Patched? | Yes |
| Remediation | Update to version 4.0.3, or a newer patched version |
| Affected Version | * <= 4.0.2 |
| Patched Version | * 4.0.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_bcbfa350_20250110_201513.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fatarim-visual-collaboration%2Ftrunk%2Finc%2Fwpf_function.php%3Frev%3D3116009)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3100890 "Revision 3100890")
* [Latest Revision](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php)
* [Next Revision](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979 "Revision 3124979") →
* [Blame](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?annotate=blame&rev=3116009 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3116009)

---

# [source:](/browser?rev=3116009&order=name "Go to repository root") [atarim-visual-collaboration](/browser/atarim-visual-collaboration?rev=3116009&order=name "View atarim-visual-collaboration")/[trunk](/browser/atarim-visual-collaboration/trunk?rev=3116009&order=name "View trunk")/[inc](/browser/atarim-visual-collaboration/trunk/inc?rev=3116009&order=name "View inc")/[wpf\_function.php](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3116009&order=name "View wpf_function.php") @ [3116009](/changeset/3116009/ "View changeset 3116009")

View diff against:

View revision:

| [Last change](/changeset/3116009/atarim-visual-collaboration/trunk/inc/wpf_function.php "View differences") on this file since 3116009 was [3116009](/changeset/3116009/ "View changeset 3116009"), checked in by wpfeedback, [6 months ago](/timeline?from=2024-07-11T04%3A47%3A43Z&precision=second "See timeline at 07/11/2024 04:47:43 AM") |
| --- |
| updated to version 4.0.1 |
| **File size:** 143.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | \* wpf\_functions.php |
| [4](#L4) | \* This file contains the helper functions called from across the plugin. |
| [5](#L5) | \*/ |
| [6](#L6) |  |
| [7](#L7) | /\* |
| [8](#L8) | \* This function is used to get the checkbox of task status / priority from the terms on website. |
| [9](#L9) | \* |
| [10](#L10) | \* @input String |
| [11](#L11) | \* @return String |
| [12](#L12) | \*/ |
| [13](#L13) | if ( ! function\_exists( 'wp\_feedback\_get\_texonomy' ) ) { |
| [14](#L14) | function wp\_feedback\_get\_texonomy( $my\_term ) { |
| [15](#L15) | $filter\_data = get\_option( 'filter\_data' ); |
| [16](#L16) | $filter\_data\_db = $filter\_data[$my\_term]; |
| [17](#L17) | if ( isset( $filter\_data\_db ) && ! empty( $filter\_data\_db ) ) { |
| [18](#L18) | echo '<ul class="wp\_feedback\_filter\_checkbox">'; |
| [19](#L19) | foreach ( $filter\_data\_db as $term ) { |
| [20](#L20) | if ( $term['label'] == 'In Progress' ) { |
| [21](#L21) | $term['label'] = 'In Prog'; |
| [22](#L22) | } elseif ( $term['label'] == 'Pending Review' ) { |
| [23](#L23) | $term['label'] = 'Pending'; |
| [24](#L24) | } else { |
| [25](#L25) | $term['label'] = $term['label']; |
| [26](#L26) | } |
| [27](#L27) | echo '<li><input onclick="wp\_feedback\_filter()" type="checkbox" name="' . $my\_term . '" value="' . $term['value'] . '" class="wp\_feedback\_task wpf\_checkbox"  id="' . $term['value'] . '"/><label for="' . $term['value'] . '">' . \_\_( $term['label'], 'atarim-visual-collaboration' ) . '</label></li>'; |
| [28](#L28) | } |
| [29](#L29) | echo '</ul>'; |
| [30](#L30) | } |
| [31](#L31) | } |
| [32](#L32) | } |
| [33](#L33) |  |
| [34](#L34) | /\* |
| [35](#L35) | \* This function is used to get all the roles allowed to use Atarim features. |
| [36](#L36) | \* |
| [37](#L37) | \* @input NULL |
| [38](#L38) | \* @return String |
| [39](#L39) | \*/ |
| [40](#L40) | if ( ! function\_exists( 'wp\_feedback\_get\_user\_role\_list' ) ) { |
| [41](#L41) | function wp\_feedback\_get\_user\_role\_list() { |
| [42](#L42) | $editable\_roles = get\_editable\_roles(); |
| [43](#L43) | return $editable\_roles; |
| [44](#L44) | } |
| [45](#L45) | } |
| [46](#L46) | add\_shortcode( 'wpf\_user\_role\_list', 'wp\_feedback\_get\_user\_role\_list' ); |
| [47](#L47) |  |
| [48](#L48) | /\* |
| [49](#L49) | \* This function is used to get all the users (based on role) which are supposed to get notified. This is called in the Tasks Center for "Filters" section. |
| [50](#L50) | \* |
| [51](#L51) | \* @input NULL |
| [52](#L52) | \* @return String |
| [53](#L53) | \*/ |
| [54](#L54) | if ( ! function\_exists( 'wp\_feedback\_get\_user\_list' ) ) { |
| [55](#L55) | function wp\_feedback\_get\_user\_list() { |
| [56](#L56) | $get\_notif\_user\_db = get\_option( 'notify\_users' ); |
| [57](#L57) | $notify\_users      = isset( $get\_notif\_user\_db ) ? $get\_notif\_user\_db : []; |
| [58](#L58) |  |
| [59](#L59) | if ( is\_array( $notify\_users ) ) { |
| [60](#L60) | if ( count( $notify\_users ) > 0) { |
| [61](#L61) | echo '<ul class="wp\_feedback\_filter\_checkbox user">'; |
| [62](#L62) | if ( ! empty( $notify\_users ) ) { |
| [63](#L63) | foreach ( $notify\_users as $user ) { |
| [64](#L64) | $wpfusr     = get\_user\_by( 'id', htmlspecialchars( $user['wpf\_id'], ENT\_QUOTES, 'UTF-8' ) ); |
| [65](#L65) | $wpfusrname = $wpfusr->display\_name; |
| [66](#L66) | echo '<li><input onclick="wp\_feedback\_filter()"  type="checkbox" name="author\_list" value="' . $user['value'] . '" class="wp\_feedback\_task wpf\_checkbox" data-wp-username="' . $user['label'] . '"  id="user\_' . $user['value'] . '" /><label for="user\_' . $user['value'] . '" class="wpf\_checkbox\_label">' . $wpfusrname . '</label></li>'; |
| [67](#L67) | } |
| [68](#L68) | } |
| [69](#L69) | echo '</ul>'; |
| [70](#L70) | } |
| [71](#L71) | } |
| [72](#L72) | } |
| [73](#L73) | } |
| [74](#L74) | add\_shortcode( 'wpf\_user\_list', 'wp\_feedback\_get\_user\_list' ); |
| [75](#L75) |  |
| [76](#L76) | /\* |
| [77](#L77) | \* This function is used to get all the users (based on role) which are supposed to get notified. This is called in the Tasks Center for the "Notify Users" section. |
| [78](#L78) | \* |
| [79](#L79) | \* @input NULL |
| [80](#L80) | \* @return String |
| [81](#L81) | \*/ |
| [82](#L82) | if ( ! function\_exists( 'wp\_feedback\_get\_user\_list\_task' ) ) { |
| [83](#L83) | function wp\_feedback\_get\_user\_list\_task() { |
| [84](#L84) | $get\_notif\_user\_db = get\_option( 'notify\_users' ); |
| [85](#L85) | $notify\_users      = isset( $get\_notif\_user\_db ) ? $get\_notif\_user\_db : []; |
| [86](#L86) | if ( is\_array( $notify\_users ) ) { |
| [87](#L87) | if ( count( $notify\_users ) > 0 ) { |
| [88](#L88) | echo '<ul class="wp\_feedback\_filter\_checkbox user">'; |
| [89](#L89) | if ( ! empty( $notify\_users ) ) { |
| [90](#L90) | foreach ( $notify\_users as $user ) { |
| [91](#L91) | $wpfusr      = get\_user\_by( 'id', htmlspecialchars( $user['wpf\_id'], ENT\_QUOTES, 'UTF-8' ) ); |
| [92](#L92) | $wpfusr\_meta = get\_user\_meta( $wpfusr->ID ); |
| [93](#L93) | $user\_name   = $wpfusr->display\_name; |
| [94](#L94) | echo '<li><input type="checkbox" name="author\_list\_task" value="' . $user['value'] . '" class="wp\_feedback\_task wpf\_checkbox" data-wp-username="' . $user['label'] . '" id="' . $user['value'] . '" onclick="update\_notify\_user(' . $user['value'] . ')" /><label for="' . $user['value'] . '" class="wpf\_checkbox\_label">' . $user\_name . '</label></li>'; //!push |
| [95](#L95) | } |
| [96](#L96) | } |
| [97](#L97) | echo '</ul>'; |
| [98](#L98) | } |
| [99](#L99) | } |
| [100](#L100) | } |
| [101](#L101) | } |
| [102](#L102) | add\_shortcode( 'wpf\_user\_list\_task', 'wp\_feedback\_get\_user\_list\_task' ); |
| [103](#L103) |  |
| [104](#L104) | /\* |
| [105](#L105) | \* This function is used to get all the users (based on role) which are supposed to get notified. This is called in the frontend on the Tasks Popup. |
| [106](#L106) | \* |
| [107](#L107) | \* @input NULL |
| [108](#L108) | \* @return String |
| [109](#L109) | \*/ |
| [110](#L110) | if ( ! function\_exists( 'wp\_feedback\_get\_user\_list\_front' ) ) { |
| [111](#L111) | function wp\_feedback\_get\_user\_list\_front() { |
| [112](#L112) | $response          = []; |
| [113](#L113) | $get\_notif\_user\_db = get\_option( 'notify\_users' ); |
| [114](#L114) | $notify\_users      = isset( $get\_notif\_user\_db ) ? $get\_notif\_user\_db : []; |
| [115](#L115) |  |
| [116](#L116) | if ( is\_array( $notify\_users ) ) { |
| [117](#L117) | if ( count( $notify\_users ) > 0 ) { |
| [118](#L118) | if ( ! empty( $notify\_users ) ) { |
| [119](#L119) | foreach ( $notify\_users as $user ) { |
| [120](#L120) | $userdetails              = get\_user\_by( 'id', htmlspecialchars( $user['wpf\_id'], ENT\_QUOTES, 'UTF-8' ) ); |
| [121](#L121) | $response[$user['value']] = array( |
| [122](#L122) | "id"          => htmlspecialchars( $userdetails->ID, ENT\_QUOTES, 'UTF-8' ), |
| [123](#L123) | "username"    => htmlspecialchars( $user['label'], ENT\_QUOTES, 'UTF-8' ), |
| [124](#L124) | "displayname" => htmlspecialchars( $userdetails->display\_name, ENT\_QUOTES, 'UTF-8' ), |
| [125](#L125) | "first\_name"  => htmlspecialchars( $userdetails->first\_name, ENT\_QUOTES, 'UTF-8' ), |
| [126](#L126) | "last\_name"   => htmlspecialchars( $userdetails->last\_name, ENT\_QUOTES, 'UTF-8' ) |
| [127](#L127) | ); |
| [128](#L128) | } |
| [129](#L129) | } |
| [130](#L130) | } |
| [131](#L131) | } |
| [132](#L132) | return wp\_json\_encode( $response ); |
| [133](#L133) | } |
| [134](#L134) | } |
| [135](#L135) | add\_shortcode( 'wpf\_user\_list\_front', 'wp\_feedback\_get\_user\_list\_front' ); |
| [136](#L136) |  |
| [137](#L137) | /\* |
| [138](#L138) | \* This function is used to save the Settings of the plugin when saved from the "Settings" tab. |
| [139](#L139) | \* |
| [140](#L140) | \* @input NULL |
| [141](#L141) | \* @return Redirect |
| [142](#L142) | \*/ |
| [143](#L143) | if ( ! function\_exists( 'process\_wpfeedback\_options' ) ) { |
| [144](#L144) | function process\_wpfeedback\_options() { |
| [145](#L145) | $options = []; |
| [146](#L146) | // Check that user has proper security level |
| [147](#L147) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [148](#L148) | wp\_die( 'Not allowed' ); |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | if ( ! empty( $\_FILES ) ) { |
| [152](#L152) | foreach ( $\_FILES as $key => $file ) { |
| [153](#L153) | if ( is\_array( $file ) ) { |
| [154](#L154) | $temp\_wpf\_file\_name = $file["name"]; |
| [155](#L155) | $temp\_wpf\_file\_type = $file["type"]; |
| [156](#L156) | $fname              = explode( ".", $temp\_wpf\_file\_name ); |
| [157](#L157) | $temp\_name          = $file['tmp\_name']; |
| [158](#L158) | if ( empty( $temp\_name ) ) { |
| [159](#L159) | continue; |
| [160](#L160) | } |
| [161](#L161) | $data    = file\_get\_contents( $temp\_name ); |
| [162](#L162) | $invalid = 0; |
| [163](#L163) | if ( ! in\_array( $temp\_wpf\_file\_type, array( 'image/jpeg', 'image/png' ) ) ) { |
| [164](#L164) | $invalid = 1; |
| [165](#L165) | } |
| [166](#L166) |  |
| [167](#L167) | if ( $invalid == 0 ) { |
| [168](#L168) | $base64\_image = 'data:' . $temp\_wpf\_file\_type . ';base64,' . base64\_encode( $data ); |
| [169](#L169) | if ( $key == 'wpf\_logo\_file' ) { |
| [170](#L170) | $options['logo']['image']     = $base64\_image; |
| [171](#L171) | $options['logo']['file\_name'] = str\_replace( ' ', '\_', trim( $fname[0] ) ); |
| [172](#L172) | $options['logo']['type']      = $temp\_wpf\_file\_type; |
| [173](#L173) | } |
| [174](#L174) | if ( $key == 'wpf\_favicon\_file' ) { |
| [175](#L175) | $options['favicon']['image']     = $base64\_image; |
| [176](#L176) | $options['favicon']['file\_name'] = str\_replace( ' ', '\_', trim( $fname[0] ) ); |
| [177](#L177) | $options['favicon']['type']      = $temp\_wpf\_file\_type; |
| [178](#L178) | } |
| [179](#L179) | } |
| [180](#L180) | } |
| [181](#L181) | } |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | $options['enabled\_wpfeedback']           = isset( $\_POST['enabled\_wpfeedback'] ) ? 'yes' : 'no'; |
| [185](#L185) | $options['wpf\_enable\_clear\_cache']       = isset( $\_POST['wpf\_enable\_clear\_cache'] ) ? 'yes' : 'no'; |
| [186](#L186) | $options['delete\_data\_wpfeedback']       = isset( $\_POST['delete\_data\_wpfeedback'] ) ? 'yes' : 'no'; |
| [187](#L187) | $options['wpf\_allow\_backend\_commenting'] = isset( $\_POST['wpf\_allow\_backend\_commenting'] ) ? 'yes' : 'no'; |
| [188](#L188) | $options['wpf\_show\_front\_stikers']       = isset( $\_POST['wpf\_show\_front\_stikers'] ) ? 'yes' : 'no'; |
| [189](#L189) | $options['wpf\_from\_email']               = $\_POST['wpf\_from\_email']; |
| [190](#L190) | $options['wpfeedback\_more\_emails']       = $\_POST['wpfeedback\_more\_emails']; |
| [191](#L191) | $options['wpfeedback\_powered\_by']        = isset( $\_POST['wpfeedback\_powered\_by'] ) ? 'yes' : 'no'; |
| [192](#L192) | $options['wpfeedback\_color']             = $\_POST['wpfeedback\_color']; |
| [193](#L193) | $options['wpf\_powered\_link']             = sanitize\_text\_field( $\_POST['wpf\_powered\_link'] ); |
| [194](#L194) | $options['wpfeedback\_powered\_by']        = isset( $\_POST['wpfeedback\_powered\_by'] ) ? 'yes' : 'no'; |
| [195](#L195) | $options['wpf\_every\_new\_task']           = isset( $\_POST['wpf\_every\_new\_task'] ) ? 'yes' : 'no'; |
| [196](#L196) | $options['wpf\_every\_new\_comment']        = isset( $\_POST['wpf\_every\_new\_comment'] ) ? 'yes' : 'no'; |
| [197](#L197) | $options['wpf\_every\_new\_complete']       = isset( $\_POST['wpf\_every\_new\_complete'] ) ? 'yes' : 'no'; |
| [198](#L198) | $options['wpf\_every\_status\_change']      = isset( $\_POST['wpf\_every\_status\_change'] ) ? 'yes' : 'no'; |
| [199](#L199) | $options['wpf\_daily\_report']             = isset( $\_POST['wpf\_daily\_report'] ) ? 'yes' : 'no'; |
| [200](#L200) | $options['wpf\_weekly\_report']            = isset( $\_POST['wpf\_weekly\_report'] ) ? 'yes' : 'no'; |
| [201](#L201) | $options['wpf\_auto\_daily\_report']        = isset( $\_POST['wpf\_auto\_daily\_report'] ) ? 'yes' : 'no'; |
| [202](#L202) | $options['wpf\_auto\_weekly\_report']       = isset( $\_POST['wpf\_auto\_weekly\_report'] ) ? 'yes' : 'no'; |
| [203](#L203) | $options['wpf\_site\_id']                  = get\_option( 'wpf\_site\_id' ); |
| [204](#L204) |  |
| [205](#L205) | $parms = []; |
| [206](#L206) | foreach ( $options as $key => $value ) { |
| [207](#L207) | array\_push( $parms, ['name' => $key,'value' => $value] ); |
| [208](#L208) | } |
| [209](#L209) | update\_site\_data( $parms ); |
| [210](#L210) |  |
| [211](#L211) | $wpf\_report\_register\_types = array(); |
| [212](#L212) | if ( isset( $\_POST['wpf\_auto\_daily\_report'] ) ) { |
| [213](#L213) | $wpf\_report\_register\_types['daily'] = 'yes'; |
| [214](#L214) | } else { |
| [215](#L215) | $wpf\_report\_register\_types['daily'] = 'no'; |
| [216](#L216) | } |
| [217](#L217) | if ( isset( $\_POST['wpf\_auto\_weekly\_report'] ) ) { |
| [218](#L218) | $wpf\_report\_register\_types['weekly'] = 'yes'; |
| [219](#L219) | } else { |
| [220](#L220) | $wpf\_report\_register\_types['weekly'] = 'no'; |
| [221](#L221) | } |
| [222](#L222) | wpf\_register\_auto\_reports\_cron( $wpf\_report\_register\_types ); |
| [223](#L223) | wp\_redirect( add\_query\_arg( 'page', 'wpfeedback\_page\_settings&wpf\_setting=1', admin\_url( 'admin.php' ) ) ); |
| [224](#L224) | exit; |
| [225](#L225) | } |
| [226](#L226) | } |
| [227](#L227) | add\_action( 'admin\_post\_save\_wpfeedback\_options', 'process\_wpfeedback\_options' ); |
| [228](#L228) |  |
| [229](#L229) | /\* |
| [230](#L230) | \* This function is used to save the Permissions options of the plugin when saved from the "Permissions" tab. |
| [231](#L231) | \* |
| [232](#L232) | \* @input Array ( $\_POST ) |
| [233](#L233) | \* @return Redirect |
| [234](#L234) | \*/ |
| [235](#L235) | if ( ! function\_exists( 'process\_wpfeedback\_misc\_options' ) ) { |
| [236](#L236) | function process\_wpfeedback\_misc\_options() { |
| [237](#L237) | $options = []; |
| [238](#L238) | if ( isset( $\_POST['wpf\_license\_deactivate'] ) ) { |
| [239](#L239) | update\_option( 'wpf\_license', 'invalid', 'no' ); |
| [240](#L240) | } |
| [241](#L241) | if ( isset( $\_POST ) ) { |
| [242](#L242) | $options['wpf\_allow\_guest']       =  isset( $\_POST['wpfeedback\_guest\_allowed'] ) ? sanitize\_text\_field( $\_POST['wpfeedback\_guest\_allowed'] ) : 'no'; |
| [243](#L243) | $options['wpf\_disable\_for\_admin'] =  isset( $\_POST['wpfeedback\_disable\_for\_admin'] ) ? sanitize\_text\_field( $\_POST['wpfeedback\_disable\_for\_admin'] ) : 'no'; |
| [244](#L244) | $options['wpf\_enable\_autologin']  =  isset( $\_POST['wpfeedback\_disable\_autologin'] ) ? sanitize\_text\_field( $\_POST['wpfeedback\_disable\_autologin'] ) : 'no'; |
| [245](#L245) | $options['wpf\_disable\_for\_app']   =  isset( $\_POST['wpfeedback\_disable\_for\_app'] ) ? sanitize\_text\_field( $\_POST['wpfeedback\_disable\_for\_app'] ) : 'no'; |
| [246](#L246) | $wpfeedback\_selected\_roles        = ''; |
| [247](#L247) | if ( isset( $\_POST['wpfeedback\_selcted\_role'] ) ) { |
| [248](#L248) | $wpfeedback\_selected\_roles = implode( ',', $\_POST['wpfeedback\_selcted\_role'] ); |
| [249](#L249) | } else { |
| [250](#L250) | $wpfeedback\_selected\_roles = "administrator"; |
| [251](#L251) | } |
| [252](#L252) | update\_option( 'wpf\_selcted\_role', $wpfeedback\_selected\_roles, 'no' ); |
| [253](#L253) | $options['wpf\_selcted\_role']                         = $wpfeedback\_selected\_roles; |
| [254](#L254) | $options['wpf\_customisations\_client']                = sanitize\_text\_field(  $\_POST['wpf\_customisations\_client'] ); |
| [255](#L255) | $options['wpf\_customisations\_webmaster']             = sanitize\_text\_field(  $\_POST['wpf\_customisations\_webmaster'] ); |
| [256](#L256) | $options['wpf\_customisations\_others']                = sanitize\_text\_field(  $\_POST['wpf\_customisations\_others'] ); |
| [257](#L257) | $options['wpf\_website\_client']                       = sanitize\_text\_field(  $\_POST['wpf\_website\_client'] ); |
| [258](#L258) | $options['wpf\_website\_developer']                    = sanitize\_text\_field(  $\_POST['wpf\_website\_developer'] ); |
| [259](#L259) | $options['wpf\_tab\_permission\_user\_client']           = isset( $\_POST['wpf\_tab\_permission\_user\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_user\_client'] ) : 'no'; |
| [260](#L260) | $options['wpf\_tab\_permission\_user\_webmaster']        = isset( $\_POST['wpf\_tab\_permission\_user\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_user\_webmaster'] ) : 'no'; |
| [261](#L261) | $options['wpf\_tab\_permission\_user\_others']           = isset( $\_POST['wpf\_tab\_permission\_user\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_user\_others'] ) : 'no'; |
| [262](#L262) | $options['wpf\_tab\_permission\_user\_guest']            = isset( $\_POST['wpf\_tab\_permission\_user\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_user\_guest'] ) : 'no'; |
| [263](#L263) | $options['wpf\_tab\_permission\_priority\_client']       = isset( $\_POST['wpf\_tab\_permission\_priority\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_priority\_client'] ) : 'no'; |
| [264](#L264) | $options['wpf\_tab\_permission\_priority\_webmaster']    = isset( $\_POST['wpf\_tab\_permission\_priority\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_priority\_webmaster'] ) : 'no'; |
| [265](#L265) | $options['wpf\_tab\_permission\_priority\_others']       = isset( $\_POST['wpf\_tab\_permission\_priority\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_priority\_others'] ) : 'no'; |
| [266](#L266) | $options['wpf\_tab\_permission\_priority\_guest']        = isset( $\_POST['wpf\_tab\_permission\_priority\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_priority\_guest'] ) : 'no'; |
| [267](#L267) | $options['wpf\_tab\_permission\_status\_client']         = isset( $\_POST['wpf\_tab\_permission\_status\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_status\_client'] ) : 'no'; |
| [268](#L268) | $options['wpf\_tab\_permission\_status\_webmaster']      = isset( $\_POST['wpf\_tab\_permission\_status\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_status\_webmaster'] ) : 'no'; |
| [269](#L269) | $options['wpf\_tab\_permission\_status\_others']         = isset( $\_POST['wpf\_tab\_permission\_status\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_status\_others'] ) : 'no'; |
| [270](#L270) | $options['wpf\_tab\_permission\_status\_guest']          = isset( $\_POST['wpf\_tab\_permission\_status\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_status\_guest'] ) : 'no'; |
| [271](#L271) | $options['wpf\_tab\_permission\_screenshot\_client']     = isset( $\_POST['wpf\_tab\_permission\_screenshot\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_screenshot\_client'] ) : 'no'; |
| [272](#L272) | $options['wpf\_tab\_permission\_screenshot\_webmaster']  = isset( $\_POST['wpf\_tab\_permission\_screenshot\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_screenshot\_webmaster'] ) : 'no'; |
| [273](#L273) | $options['wpf\_tab\_permission\_screenshot\_others']     = isset( $\_POST['wpf\_tab\_permission\_screenshot\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_screenshot\_others'] ) : 'no'; |
| [274](#L274) | $options['wpf\_tab\_permission\_screenshot\_guest']      = isset( $\_POST['wpf\_tab\_permission\_screenshot\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_screenshot\_guest'] ) : 'no'; |
| [275](#L275) | $options['wpf\_tab\_permission\_information\_client']    = isset( $\_POST['wpf\_tab\_permission\_information\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_information\_client'] ) : 'no'; |
| [276](#L276) | $options['wpf\_tab\_permission\_information\_webmaster'] = isset( $\_POST['wpf\_tab\_permission\_information\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_information\_webmaster'] ) : 'no'; |
| [277](#L277) | $options['wpf\_tab\_permission\_information\_others']    = isset( $\_POST['wpf\_tab\_permission\_information\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_information\_others'] ) : 'no'; |
| [278](#L278) | $options['wpf\_tab\_permission\_information\_guest']     = isset( $\_POST['wpf\_tab\_permission\_information\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_information\_guest'] ) : 'no'; |
| [279](#L279) | $options['wpf\_tab\_permission\_delete\_task\_client']    = isset( $\_POST['wpf\_tab\_permission\_delete\_task\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_delete\_task\_client'] ) : 'no'; |
| [280](#L280) | $options['wpf\_tab\_permission\_delete\_task\_webmaster'] = isset( $\_POST['wpf\_tab\_permission\_delete\_task\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_delete\_task\_webmaster'] ) : 'no'; |
| [281](#L281) | $options['wpf\_tab\_permission\_delete\_task\_others']    = isset( $\_POST['wpf\_tab\_permission\_delete\_task\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_delete\_task\_others'] ) : 'no'; |
| [282](#L282) | $options['wpf\_tab\_permission\_delete\_task\_guest']     = isset( $\_POST['wpf\_tab\_permission\_delete\_task\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_delete\_task\_guest'] ) : 'no'; |
| [283](#L283) | $options['wpf\_tab\_auto\_screenshot\_task\_client']      = isset( $\_POST['wpf\_tab\_auto\_screenshot\_task\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_auto\_screenshot\_task\_client'] ) : 'no'; |
| [284](#L284) | $options['wpf\_tab\_auto\_screenshot\_task\_webmaster']   = isset( $\_POST['wpf\_tab\_auto\_screenshot\_task\_webmaster'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_auto\_screenshot\_task\_webmaster'] ) : 'no'; |
| [285](#L285) | $options['wpf\_tab\_auto\_screenshot\_task\_others']      = isset( $\_POST['wpf\_tab\_auto\_screenshot\_task\_others'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_auto\_screenshot\_task\_others'] ) : 'no'; |
| [286](#L286) | $options['wpf\_tab\_auto\_screenshot\_task\_guest']       = isset( $\_POST['wpf\_tab\_auto\_screenshot\_task\_guest'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_auto\_screenshot\_task\_guest'] ) : 'no'; |
| [287](#L287) |  |
| [288](#L288) | /\* update settings for display stickers  \*/ |
| [289](#L289) | $webmaster\_sticker = 'no'; |
| [290](#L290) | if ( isset( $\_POST['wpf\_tab\_permission\_display\_stickers\_webmaster'] ) && $\_POST['wpf\_tab\_permission\_display\_stickers\_webmaster'] == 'yes' ) { |
| [291](#L291) | $webmaster\_sticker = 'yes'; |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | $options['wpf\_tab\_permission\_display\_stickers\_client']    = isset( $\_POST['wpf\_tab\_permission\_display\_stickers\_client'] ) ? sanitize\_text\_field(  $\_POST['wpf\_tab\_permission\_display\_stickers\_client'] ) : 'no'; |
| [295](#L295) | $options['wpf\_tab\_permission\_display\_stickers\_webmaster'] = $webmaster\_sticker; |
| [296](#L296) | $options['wpf\_tab\_permission\_display\_stickers\_others']    = isset( $\_POST['wpf\_tab\_permission\_display\_stickers\_others'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_display\_stickers\_others'] ) : 'no'; |
| [297](#L297) | $options['wpf\_tab\_permission\_display\_stickers\_guest']     = isset( $\_POST['wpf\_tab\_permission\_display\_stickers\_guest'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_display\_stickers\_guest'] ) : 'no'; |
| [298](#L298) |  |
| [299](#L299) | $webmaster\_taskid = 'no'; |
| [300](#L300) | if ( isset( $\_POST['wpf\_tab\_permission\_display\_task\_id\_webmaster'] ) && $\_POST['wpf\_tab\_permission\_display\_task\_id\_webmaster'] == 'yes' ) { |
| [301](#L301) | $webmaster\_taskid = 'yes'; |
| [302](#L302) | } |
| [303](#L303) | $options['wpf\_tab\_permission\_display\_task\_id\_client']    = isset( $\_POST['wpf\_tab\_permission\_display\_task\_id\_client'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_display\_task\_id\_client'] ) : 'no'; |
| [304](#L304) | $options['wpf\_tab\_permission\_display\_task\_id\_webmaster'] = $webmaster\_taskid; |
| [305](#L305) | $options['wpf\_tab\_permission\_display\_task\_id\_others']    = isset( $\_POST['wpf\_tab\_permission\_display\_task\_id\_others'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_display\_task\_id\_others'] ) : 'no'; |
| [306](#L306) | $options['wpf\_tab\_permission\_display\_task\_id\_guest']     = isset( $\_POST['wpf\_tab\_permission\_display\_task\_id\_guest'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_display\_task\_id\_guest'] ) : 'no'; |
| [307](#L307) |  |
| [308](#L308) | // => v2.1.0 |
| [309](#L309) | $keyboard\_shortcut = 'no'; |
| [310](#L310) |  |
| [311](#L311) | if ( isset( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_webmaster'] ) && $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_webmaster'] == 'yes' ) { |
| [312](#L312) | $keyboard\_shortcut = 'yes'; |
| [313](#L313) | } |
| [314](#L314) | $options['wpf\_tab\_permission\_keyboard\_shortcut\_client']    = isset( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_client'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_client'] ) : 'no'; |
| [315](#L315) | $options['wpf\_tab\_permission\_keyboard\_shortcut\_webmaster'] = $keyboard\_shortcut; |
| [316](#L316) | $options['wpf\_tab\_permission\_keyboard\_shortcut\_others']    = isset( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_others'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_others'] ) : 'no'; |
| [317](#L317) | $options['wpf\_tab\_permission\_keyboard\_shortcut\_guest']     = isset( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_guest'] ) ? sanitize\_text\_field( $\_POST['wpf\_tab\_permission\_keyboard\_shortcut\_guest'] ) : 'no'; |
| [318](#L318) |  |
| [319](#L319) | $parms1 = []; |
| [320](#L320) | foreach ( $options as $key => $value ) { |
| [321](#L321) | array\_push( $parms1, ['name' => $key, 'value' => $value] ); |
| [322](#L322) | } |
| [323](#L323) | syncUsers(); |
| [324](#L324) | update\_site\_data( $parms1 ); |
| [325](#L325) |  |
| [326](#L326) | if ( isset( $\_POST['wpfeedback\_licence\_key'] ) && $\_POST['wpfeedback\_licence\_key'] != "" ) { |
| [327](#L327) | if ( $\_POST['wpfeedback\_licence\_key'] != '00000000000000000000000000000000' ) { |
| [328](#L328) | $wpf\_license\_key = sanitize\_text\_field( $\_POST['wpfeedback\_licence\_key'] ); |
| [329](#L329) | $wpf\_result      = wpf\_license\_key\_license\_item( $wpf\_license\_key ); |
| [330](#L330) | if ( $wpf\_result['license'] == 'valid' ) { |
| [331](#L331) | $wpf\_crypt\_key = wpf\_crypt\_key( $wpf\_license\_key, 'e' ); |
| [332](#L332) | update\_option( 'wpf\_license\_key', $wpf\_crypt\_key, 'no' ); |
| [333](#L333) | update\_option( 'wpf\_license', $wpf\_result['license'], 'no' ); |
| [334](#L334) | update\_option( 'wpf\_license\_expires', $wpf\_result['expires'], 'no' ); |
| [335](#L335) | if ( ! get\_option( 'wpf\_decr\_key' ) ) { |
| [336](#L336) | update\_option( 'wpf\_decr\_key', $wpf\_result['payment\_id'], 'no' ); |
| [337](#L337) | update\_option( 'wpf\_decr\_checksum', $wpf\_result['checksum'], 'no' ); |
| [338](#L338) | $wpf\_crypt\_key = wpf\_crypt\_key( $wpf\_license\_key, 'e' ); |
| [339](#L339) | update\_option( 'wpf\_license\_key', $wpf\_crypt\_key, 'no' ); |
| [340](#L340) | } |
| [341](#L341) | do\_action( 'wpf\_initial\_sync', $wpf\_license\_key ); |
| [342](#L342) | } else { |
| [343](#L343) | update\_option( 'wpf\_license\_key', sanitize\_text\_field( $\_POST['wpfeedback\_licence\_key'] ), 'no' ); |
| [344](#L344) | update\_option( 'wpf\_license', $wpf\_result['license'], 'no' ); |
| [345](#L345) | } |
| [346](#L346) | } |
| [347](#L347) | } |
| [348](#L348) | } |
| [349](#L349) | wp\_redirect( add\_query\_arg( 'page', 'wpfeedback\_page\_permissions', admin\_url( 'admin.php' ) ) ); |
| [350](#L350) | exit; |
| [351](#L351) | } |
| [352](#L352) | } |
| [353](#L353) | add\_action( 'admin\_post\_save\_wpfeedback\_misc\_options', 'process\_wpfeedback\_misc\_options' ); |
| [354](#L354) |  |
| [355](#L355) | /\* |
| [356](#L356) | \* This function is used to create a dropdown of the roles available in website on the "Permissions" tab for the selection. |
| [357](#L357) | \* |
| [358](#L358) | \* @input Boolean |
| [359](#L359) | \* @return String |
| [360](#L360) | \*/ |
| [361](#L361) | if ( ! function\_exists( 'wpfeedback\_dropdown\_roles' ) ) { |
| [362](#L362) | function wpfeedback\_dropdown\_roles( $selected = false ) { |
| [363](#L363) | global $wp\_roles; |
| [364](#L364) | $p = ''; |
| [365](#L365) | $r = ''; |
| [366](#L366) | $editable\_roles = $wp\_roles->get\_names(); |
| [367](#L367) | $selected\_roles = get\_site\_data\_by\_key( 'wpf\_selcted\_role' ); |
| [368](#L368) | // For backwards compatibility |
| [369](#L369) | if ( is\_string( $selected\_roles ) ) { |
| [370](#L370) | $selected\_roles = explode( ',', $selected\_roles ); |
| [371](#L371) | foreach ( $editable\_roles as $role => $details ) { |
| [372](#L372) | if ( is\_array( $selected\_roles ) AND in\_array( $role, $selected\_roles ) ) // preselect specified role |
| [373](#L373) | $p .= "\n\t<option selected='selected' value='" . esc\_attr( $role ) . "'>$details</option>"; |
| [374](#L374) | else |
| [375](#L375) | $r .= "\n\t<option value='" . esc\_attr( $role ) . "'>$details</option>"; |
| [376](#L376) | } |
| [377](#L377) | } |
| [378](#L378) | return $p . $r; |
| [379](#L379) | } |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | /\* |
| [383](#L383) | \* This function is used to get the listing of all the wpfeedback tasks. |
| [384](#L384) | \* |
| [385](#L385) | \* @input NULL |
| [386](#L386) | \* @return String |
| [387](#L387) | \*/ |
| [388](#L388) | if ( ! function\_exists( 'wpfeedback\_get\_post\_list' ) ) { |
| [389](#L389) | function wpfeedback\_get\_post\_list() { |
| [390](#L390) | $output = ''; |
| [391](#L391) | $args   = array( |
| [392](#L392) | 'numberposts' => -1, |
| [393](#L393) | 'limit'       => 20, |
| [394](#L394) | 'page\_no'     => 1, |
| [395](#L395) | 'post\_type'   => 'wpfeedback', |
| [396](#L396) | 'orderby'     => 'title', |
| [397](#L397) | 'orderby'     => 'date', |
| [398](#L398) | 'order'       => 'DESC', |
| [399](#L399) | 'task\_center' => 1, |
| [400](#L400) | 'wpf\_site\_id' => get\_option( 'wpf\_site\_id' ), |
| [401](#L401) | ); |
| [402](#L402) |  |
| [403](#L403) |  |
| [404](#L404) | /\* START \*/ |
| [405](#L405) | $currnet\_user\_information = wpf\_get\_current\_user\_information(); |
| [406](#L406) | $current\_role             = $currnet\_user\_information['role']; |
| [407](#L407) | $current\_user\_name        = $currnet\_user\_information['display\_name']; |
| [408](#L408) | $current\_user\_id          = $currnet\_user\_information['user\_id']; |
| [409](#L409) | $wpf\_website\_builder      = get\_site\_data\_by\_key( 'wpf\_website\_developer' ) == 1 ? get\_site\_data\_by\_key( 'wpf\_website\_developer' ) : 0; |
| [410](#L410) | if ( $current\_user\_name == 'Guest' ) { |
| [411](#L411) | $wpf\_website\_client = get\_site\_data\_by\_key( 'wpf\_website\_client' ) == 1 ? get\_site\_data\_by\_key( 'wpf\_website\_client' ) : 0; |
| [412](#L412) | $wpf\_current\_role   = 'guest'; |
| [413](#L413) | if ( $wpf\_website\_client ) { |
| [414](#L414) | $wpf\_website\_client\_info = get\_userdata( $wpf\_website\_client ); |
| [415](#L415) | if ( $wpf\_website\_client\_info ) { |
| [416](#L416) | if ( $wpf\_website\_client\_info->display\_name == '' ) { |
| [417](#L417) | $current\_user\_name = $wpf\_website\_client\_info->user\_nicename; |
| [418](#L418) | } else { |
| [419](#L419) | $current\_user\_name = $wpf\_website\_client\_info->display\_name; |
| [420](#L420) | } |
| [421](#L421) | } |
| [422](#L422) | } |
| [423](#L423) | } else { |
| [424](#L424) | $wpf\_current\_role = wpf\_user\_type(); |
| [425](#L425) | } |
| [426](#L426) | $current\_user\_name = addslashes( $current\_user\_name ); |
| [427](#L427) | if ( $wpf\_current\_role == 'advisor' ) { |
| [428](#L428) | $wpf\_tab\_permission\_display\_stickers = ( get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_stickers\_webmaster' ) != 'no') ? 'yes' : 'no'; |
| [429](#L429) | $wpf\_tab\_permission\_display\_task\_id  = ( get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_task\_id\_webmaster' ) != 'no') ? 'yes' : 'no'; |
| [430](#L430) | } elseif ( $wpf\_current\_role == 'king' ) { |
| [431](#L431) | $wpf\_tab\_permission\_display\_stickers = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_stickers\_client' ) == 'yes' ? 'yes' : 'no'; |
| [432](#L432) | $wpf\_tab\_permission\_display\_task\_id  = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_task\_id\_client' ) == 'yes' ? 'yes' : 'no'; |
| [433](#L433) | } elseif ( $wpf\_current\_role == 'council' ) { |
| [434](#L434) | $wpf\_tab\_permission\_display\_stickers = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_stickers\_others' ) == 'yes' ? 'yes' : 'no'; |
| [435](#L435) | $wpf\_tab\_permission\_display\_task\_id  = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_task\_id\_others' ) == 'yes' ? 'yes' : 'no'; |
| [436](#L436) | } else { |
| [437](#L437) | $wpf\_tab\_permission\_display\_stickers = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_stickers\_guest' ) == 'yes' ? 'yes' : 'no'; |
| [438](#L438) | $wpf\_tab\_permission\_display\_task\_id  = get\_site\_data\_by\_key( 'wpf\_tab\_permission\_display\_task\_id\_guest' ) == 'yes' ? 'yes' : 'no'; |
| [439](#L439) | } |
| [440](#L440) | /\* END \*/ |
| [441](#L441) |  |
| [442](#L442) | $url         = WPF\_CRM\_API . 'wp-api/all/task-center-tasks'; |
| [443](#L443) | $sendtocloud = wp\_json\_encode( $args ); |
| [444](#L444) | $myposts     = wpf\_send\_remote\_post( $url, $sendtocloud ); |
| [445](#L445) | $data        = isset( $myposts['data'] ) ? $myposts['data'] : '' ; |
| [446](#L446) | $wpf\_orphans = array(); |
| [447](#L447) | if ( $myposts ) { |
| [448](#L448) | $output .= '<ul id="all\_wpf\_list" style="list-style-type: none; font-size:12px;">'; |
| [449](#L449) | if ( ! empty( $data ) ) { |
| [450](#L450) | $output .= return\_task\_list\_html\_taskcenter( $data, $current\_user\_id, $wpf\_tab\_permission\_display\_stickers, $wpf\_tab\_permission\_display\_task\_id ); |
| [451](#L451) | } |
| [452](#L452) | wp\_reset\_postdata(); |
| [453](#L453) | $output .= '</ul>'; |
| [454](#L454) | } else { |
| [455](#L455) | $output = '<div class="wpf\_no\_tasks\_found"><i class="gg-info"></i> No tasks found</div>'; |
| [456](#L456) | } |
| [457](#L457) | $response[0] = $output; |
| [458](#L458) | $response[1] = $wpf\_orphans; |
| [459](#L459) | return $response; |
| [460](#L460) | } |
| [461](#L461) | } |
| [462](#L462) |  |
| [463](#L463) | function return\_task\_list\_html\_taskcenter( $data, $current\_user\_id, $wpf\_tab\_permission\_display\_stickers, $wpf\_tab\_permission\_display\_task\_id ) { |
| [464](#L464) | $output = ''; |
| [465](#L465) | foreach ( $data as $mypost ) { |
| [466](#L466) | $user\_atarim\_type = get\_user\_meta( $current\_user\_id, 'wpf\_user\_type', true ); |
| [467](#L467) | if ( $mypost['task']['is\_internal'] == '1' ) { |
| [468](#L468) | if ( $user\_atarim\_type != 'advisor' ) { |
| [469](#L469) | continue; |
| [470](#L470) | } |
| [471](#L471) | } |
| [472](#L472) | $post\_id                 = $mypost['task']['id']; |
| [473](#L473) | $site\_task\_id            = $mypost['task']['site\_task\_id']; |
| [474](#L474) | $wpf\_task\_id             = $mypost['task']['wpf\_task\_id']; |
| [475](#L475) | $author\_id               = $mypost['task']['task\_config\_author\_id']; |
| [476](#L476) | $get\_post\_date           = $mypost['task']['created\_at']; |
| [477](#L477) | $date                    = strtotime( $get\_post\_date ); |
| [478](#L478) | $post\_date               = get\_date\_from\_gmt( date( 'Y-m-d H:i:s', $date ), 'd/m/Y H:i' ); |
| [479](#L479) | $post\_title              = $mypost['task']['task\_title']; |
| [480](#L480) | $task\_page\_url           = $mypost['task']['task\_page\_url']; |
| [481](#L481) | $wpf\_task\_screenshot     = $mypost['task']['wpf\_task\_screenshot']; |
| [482](#L482) | $task\_page\_title         = ( $mypost['task']['task\_page\_title'] != null ) ? $mypost['task']['task\_page\_title'] : ""; |
| [483](#L483) | $task\_config\_author\_name = $mypost['task']['task\_config\_author\_name']; |
| [484](#L484) | $task\_notify\_users       = $mypost['task']['task\_notify\_users']; |
| [485](#L485) | $task\_config\_author\_resX = $mypost['task']['task\_config\_author\_resX']; |
| [486](#L486) | $task\_config\_author\_resY = $mypost['task']['task\_config\_author\_resY']; |
| [487](#L487) | $get\_task\_type           = $mypost['task']['task\_type']; |
| [488](#L488) | $is\_internal             = $mypost['task']['is\_internal']; |
| [489](#L489) |  |
| [490](#L490) | if ( $get\_task\_type == 'general' ) { |
| [491](#L491) | $task\_type = 'general'; |
| [492](#L492) | $general   = '<span class="wpf\_task\_type">' . \_\_( "General", 'atarim-visual-collaboration' ) . '</span>'; |
| [493](#L493) | } elseif ( $get\_task\_type == 'email' ) { //!email |
| [494](#L494) | $task\_type = 'email'; |
| [495](#L495) | $general   = '<span class="wpf\_task\_type">' . \_\_( "Email", 'atarim-visual-collaboration' ) . '</span>'; |
| [496](#L496) | } else { |
| [497](#L497) | $task\_type = ''; |
| [498](#L498) | $general   = ''; |
| [499](#L499) | } |
| [500](#L500) | if ( $is\_internal == '1' ) { |
| [501](#L501) | $internal       = '<span class="wpf\_task\_type" title="Task type">' . \_\_( "Internal", 'atarim-visual-collaboration' ) . '</span>'; |
| [502](#L502) | $internal\_icon  = $internal\_icon\_html = '<span class="wpf\_chevron\_wrapper wpf\_internal\_task\_wrapper"><img src="' . WPF\_PLUGIN\_URL . 'images/eye-off-white.svg" alt="eye off white" class="wpf-internal-img"></span>'; |
| [503](#L503) | $internal\_class = 'wpfb-internal'; |
| [504](#L504) | } else { |
| [505](#L505) | $internal       = ''; |
| [506](#L506) | $internal\_icon  = ''; |
| [507](#L507) | $internal\_class = ''; |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | //create list of orphan tasks |
| [511](#L511) | if ( $get\_task\_type == "general" && ( $mypost['task']['wpfb\_task\_bubble'] != NULL ) ) { |
| [512](#L512) | $wpf\_orphans[] = $post\_id; |
| [513](#L513) | } |
| [514](#L514) | if ( $mypost['task']['is\_admin\_task'] == 1 ) { |
| [515](#L515) | $wpf\_task\_status = 'wpf\_admin'; |
| [516](#L516) | $admin\_tag       = '<span class="wpf\_task\_type">' . \_\_( "Admin", 'atarim-visual-collaboration' ) . '</span>'; |
| [517](#L517) | } else { |
| [518](#L518) | $wpf\_task\_status = 'public'; |
| [519](#L519) | $admin\_tag       = ''; |
| [520](#L520) | } |
| [521](#L521) |  |
| [522](#L522) | $task\_config\_author\_browser        = $mypost['task']['task\_config\_author\_browser']; |
| [523](#L523) | $task\_config\_author\_browserVersion = $mypost['task']['task\_config\_author\_browserVersion']; |
| [524](#L524) | $task\_comment\_id                   = $mypost['task']['wpf\_task\_id']; |
| [525](#L525) | $task\_priority                     = $mypost['task']['task\_priority']; |
| [526](#L526) | $task\_status                       = $mypost['task']['task\_status']; |
| [527](#L527) | $task\_tags                         = $mypost['task']['tags']; |
| [528](#L528) | $all\_other\_tag                     = ''; |
| [529](#L529) | $wpfb\_tags\_html                    = ''; |
| [530](#L530) |  |
| [531](#L531) | if ( $task\_tags ) { |
| [532](#L532) | $tag\_length     = count( $task\_tags ); |
| [533](#L533) | $wpfb\_tags\_html = '<div class="wpf\_task\_tags">'; |
| [534](#L534) | $i              = 1; |
| [535](#L535) | foreach ( $task\_tags as $task\_tag => $task\_tags\_value ) { |
| [536](#L536) | if ( $i == 1 ) { |
| [537](#L537) | $wpfb\_tags\_html .= '<span class="wpf\_task\_tag">' . $task\_tags\_value["tag"] . '</span>'; |
| [538](#L538) | } else { |
| [539](#L539) | if ( $tag\_length == $i ) { |
| [540](#L540) | $all\_other\_tag .= $task\_tags\_value['tag']; |
| [541](#L541) | } else { |
| [542](#L542) | $all\_other\_tag .= $task\_tags\_value["tag"].', '; |
| [543](#L543) | } |
| [544](#L544) | } |
| [545](#L545) | $i++; |
| [546](#L546) | } |
| [547](#L547) | if ( $tag\_length > 1 ) { |
| [548](#L548) | $wpfb\_tags\_html .= '<span class="wpf\_task\_tag\_more" title="' . $all\_other\_tag . '">...</span>'; |
| [549](#L549) | } |
| [550](#L550) | $wpfb\_tags\_html .= '</div>'; |
| [551](#L551) | } |
| [552](#L552) | $task\_date                = $mypost['task']['created\_at']; |
| [553](#L553) | $task\_date                = strtotime( $task\_date ); |
| [554](#L554) | $task\_date                = get\_date\_from\_gmt( date( 'Y-m-d H:i:s', $task\_date ), 'Y-m-d H:i:s' ); |
| [555](#L555) | $task\_date1               = date\_create($task\_date); |
| [556](#L556) | $wpf\_wp\_current\_timestamp = date( 'Y-m-d H:i:s', current\_time( 'timestamp', 0 ) ); |
| [557](#L557) | $task\_date2               = date\_create( $wpf\_wp\_current\_timestamp ); |
| [558](#L558) | $curr\_task\_time           = wpfb\_time\_difference( $task\_date1, $task\_date2 ); |
| [559](#L559) | $display\_span             = ''; |
| [560](#L560) | $custom\_class             = ''; |
| [561](#L561) | if ( $wpf\_tab\_permission\_display\_stickers == 'yes' ) { |
| [562](#L562) | $display\_span = '<span class="' . $task\_priority . '\_custom  wpf\_top\_badge"></span> '; |
| [563](#L563) | $custom\_class = $task\_status . "\_custom"; |
| [564](#L564) | } |
| [565](#L565) | $display\_check\_mark = ''; |
| [566](#L566) | if ( $wpf\_tab\_permission\_display\_task\_id != 'yes' ) { |
| [567](#L567) | $display\_check\_mark = '<i class="gg-check"></i>'; |
| [568](#L568) | } else { |
| [569](#L569) | $display\_check\_mark =  '<span class="wpf\_bubble\_num\_wrapper">' . $mypost['task']['site\_task\_id'] . '</span>' . $internal\_icon;//$task\_comment\_id; |
| [570](#L570) | } |
| [571](#L571) | if ( $task\_status == 'complete' ) { |
| [572](#L572) | $bubble\_label = $display\_span . $display\_check\_mark; |
| [573](#L573) | } else { |
| [574](#L574) | $bubble\_label = $display\_span . '<span class="wpf\_bubble\_num\_wrapper">' . $mypost['task']['site\_task\_id'] . '</span>' . $internal\_icon;//$task\_comment\_id; |
| [575](#L575) | } |
| [576](#L576) | $author                  = get\_task\_author( $mypost['task'] ); |
| [577](#L577) | $wpf\_task\_status\_label   = '<div class="wpf\_task\_label"><span class="task\_status wpf\_' . $task\_status . '" title="Status: ' . $task\_status . '">' . get\_wpf\_status\_icon() . '</span>'; |
| [578](#L578) | $wpf\_task\_priority\_label = '<span class="task\_priority wpf\_' . $task\_priority . '" title="Priority: ' . $task\_priority . '">' . get\_wpf\_priority\_icon() . '</span></div>'; |
| [579](#L579) | $author\_name             = "'" . $author . "'"; |
| [580](#L580) | $output                 .= '<li class="post\_' . $post\_id . ' ' . $task\_priority . ' ' . $task\_status . ' current\_page\_task wpf\_list"><a href="javascript:void(0)" class="' . $internal\_class . ' ' . $task\_status . ' ' . $internal\_class . '" id="wpf-task-' . $post\_id . '" data-wpf\_task\_status="' . $wpf\_task\_status . '"" data-task\_type="' . $task\_type . '" data-task\_author\_name="' . $task\_config\_author\_name . '" data-task\_config\_author\_browserVersion="' . $task\_config\_author\_browserVersion . '" data-task\_config\_author\_res="' . $task\_config\_author\_resX . ' X ' . $task\_config\_author\_resY . '" data-task\_config\_author\_browser="' . $task\_config\_author\_browser . '" data-task\_config\_author\_name="' . \_\_( 'By ', 'atarim-visual-collaboration' ) . $task\_config\_author\_name . ' ' . $post\_date . '" data-task\_notify\_users="' . $task\_notify\_users . '" data-task\_page\_url="' . $task\_page\_url . '" data-wpf\_task\_screenshot="' . $wpf\_task\_screenshot . '" data-task\_page\_title="' . $post\_title . '" data-task\_priority="' . $task\_priority . '" data-task\_status="' . $task\_status . '" data-disp-id="' . $site\_task\_id . '" data-is-internal="' . $is\_internal . '" onclick="get\_wpf\_chat(this,true,' . $author\_name . ')" data-postid="' . $post\_id . '" data-uid="' . $author\_id . '"  data-task\_no="' . $task\_comment\_id . '"><div class="wpf\_task\_info"><input type="checkbox" value="' . $post\_id . '" name="wpf\_task\_id" data-disp-id="' . $site\_task\_id . '" id="wpf\_' . $post\_id . '" class="wpf\_task\_id" style="display:none;"><div class="wpf\_task\_num\_top ' . $custom\_class . '">' . $bubble\_label . '</div><div class="wpf\_task\_main\_top"><level class="task-author">' . $author . ' <span>' . $curr\_task\_time['comment\_time'] . '</span></level><div class="current\_page\_task\_list">' . $post\_title . '</div></div></div><div class="wpf\_task\_meta"><div class="wpf\_task\_tagg">' . $internal . $general . '</div></div></a></li>'; |
| [581](#L581) | } |
| [582](#L582) | return $output; |
| [583](#L583) | } |
| [584](#L584) |  |
| [585](#L585) | // This function is used to get the logo. |
| [586](#L586) | function get\_wpf\_logo() { |
| [587](#L587) | $get\_logourl = get\_site\_data\_by\_key( 'wpfeedback\_logo' ); |
| [588](#L588) | $alterimg    = esc\_url( WPF\_PLUGIN\_URL . 'images/Atarim.svg' ); |
| [589](#L589) | return image\_exists\_checker( $get\_logourl, $alterimg ); |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | // This function is used to get the fevicon. |
| [593](#L593) | function get\_wpf\_favicon() { |
| [594](#L594) | $get\_faviconurl = get\_site\_data\_by\_key( 'wpfeedback\_favicon' ); |
| [595](#L595) | $alterimg       = esc\_url( WPF\_PLUGIN\_URL . 'images/atarim\_icon.svg' ); |
| [596](#L596) | return image\_exists\_checker( $get\_faviconurl, $alterimg ); |
| [597](#L597) | } |
| [598](#L598) |  |
| [599](#L599) | // Function to check if an image exists at a given URL |
| [600](#L600) | function image\_exists\_checker( $imageUrl, $alterimg ) { |
| [601](#L601) | $imageUrl = str\_replace(' ', '%20', $imageUrl); |
| [602](#L602) | // Check if the URL is reachable |
| [603](#L603) | if ( $imageUrl != '' ) { |
| [604](#L604) | if ( @getimagesize( $imageUrl ) ) { |
| [605](#L605) | return $imageUrl; |
| [606](#L606) | } |
| [607](#L607) | } |
| [608](#L608) | return $alterimg; |
| [609](#L609) | } |
| [610](#L610) |  |
| [611](#L611) | /\* |
| [612](#L612) | \* get user profile svg icon |
| [613](#L613) | \*/ |
| [614](#L614) | if ( ! function\_exists( 'get\_wpf\_user\_icon' ) ) { |
| [615](#L615) | function get\_wpf\_user\_icon() { |
| [616](#L616) | return '<svg version="1.1" id="Layer\_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="200px" height="166.5px" viewBox="0 0 200 166.5" enable-background="new 0 0 200 166.5" xml:space="preserve"> <path fill="none" stroke="#4B5668" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" d="M141.4,158.021V141.46 c0-18.29-14.83-33.119-33.12-33.119H42.04c-18.292,0-33.121,14.829-33.121,33.119v16.561"/> <circle fill="none" stroke="#4B5668" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" cx="75.16" cy="42.099" r="33.12"/> <path fill="none" stroke="#4B5668" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" d="M191.082,158.021V141.46 c-0.018-15.088-10.221-28.269-24.841-32.044"/> <path fill="none" stroke="#4B5668" stroke-width="16" stroke-linecap="round" stroke-linejoin="round" d="M133.122,10.054 c17.723,4.54,28.413,22.581,23.869,40.301c-2.993,11.725-12.146,20.875-23.869,23.87"/> </svg>'; |
| [617](#L617) | } |
| [618](#L618) | } |
| [619](#L619) |  |
| [620](#L620) | /\* |
| [621](#L621) | \* get user screenshot svg icon |
| [622](#L622) | \*/ |
| [623](#L623) | if ( ! function\_exists( 'get\_wpf\_screenshot\_icon' ) ) { |
| [624](#L624) | function get\_wpf\_screenshot\_icon() { |
| [625](#L625) | return '<svg enable-background="new 0 0 24 24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 23h-18c-1.654 0-3-1.346-3-3v-12c0-1.654 1.346-3 3-3 .853 0 1.619-.474 2-1.236l.211-.422c.722-1.445 2.174-2.342 3.789-2.342h6c1.615 0 3.067.897 3.789 2.342l.211.422c.381.762 1.147 1.236 2 1.236 1.654 0 3 1.346 3 3v12c0 1.654-1.346 3-3 3zm-12-20c-.853 0-1.619.474-2 1.236l-.211.422c-.722 1.445-2.174 2.342-3.789 2.342-.551 0-1 .449-1 1v12c0 .552.449 1 1 1h18c.552 0 1-.448 1-1v-12c0-.551-.448-1-1-1-1.615 0-3.067-.897-3.789-2.342l-.211-.422c-.381-.762-1.147-1.236-2-1.236h-6zm3 16c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zm0-10c-2.206 0-4 1.794-4 4s1.794 4 4 4 4-1.794 4-4-1.794-4-4-4z"/></svg>'; |
| [626](#L626) | } |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | /\* |
| [630](#L630) | \* get status svg icon |
| [631](#L631) | \*/ |
| [632](#L632) | if ( ! function\_exists( 'get\_wpf\_status\_icon' ) ) { |
| [633](#L633) | function get\_wpf\_status\_icon() { |
| [634](#L634) | return '<svg version="1.1" id="Layer\_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="200px" height="110.836px" viewBox="0 0 200 110.836" enable-background="new 0 0 200 110.836" xml:space="preserve"> <g> <path fill="#4B5668" stroke="#FFFFFF" stroke-width="3" stroke-miterlimit="10" d="M96.199,84.264 c3.212-8.122,5.887-14.854,8.54-21.596c6.955-17.673,14.016-35.305,20.766-53.054c1.697-4.463,3.078-8.703,8.865-8.447 c5.82,0.257,7.804,4.332,9.179,9.283c4.447,16.01,9.085,31.967,13.669,47.941c0.518,1.799,1.149,3.571,1.829,5.669 c10.653,0,21.103,0.078,31.551-0.034c5.134-0.054,9.407,1.354,9.421,7.142c0.014,5.783-4.243,7.199-9.379,7.208 c-12.833,0.021-25.67,0.222-38.504,0.363c-5.496,0.062-7.919-3.141-9.272-8.057c-3.298-11.993-6.843-23.916-10.682-37.219 c-1.465,2.919-2.413,4.478-3.063,6.153c-8.467,21.917-16.763,43.902-25.501,65.708c-1.02,2.545-4.559,5.876-6.71,5.726 c-2.753-0.194-6.52-3-7.705-5.638c-7.184-16.025-13.744-32.325-20.544-48.52c-0.972-2.317-2.113-4.565-3.642-7.844 c-4.028,8.057-7.796,15.156-11.148,22.445c-2.247,4.89-5.341,7.185-11.01,6.967c-10.686-0.407-21.399-0.201-32.1-0.085 c-5.209,0.056-10.13-0.729-10.255-7.028c-0.124-6.294,4.633-7.399,9.939-7.321c8.323,0.124,16.667-0.326,24.963,0.168 c4.906,0.292,7.171-1.588,9.085-5.808c4.018-8.863,8.283-17.642,13.061-26.11c1.543-2.737,5.344-6.432,7.502-6.07 c3.262,0.548,7.29,3.667,8.725,6.747c6.71,14.412,12.632,29.188,18.867,43.823C93.527,78.845,94.57,80.845,96.199,84.264z"/> </g> </svg>'; |
| [635](#L635) | } |
| [636](#L636) | } |
| [637](#L637) |  |
| [638](#L638) | /\* |
| [639](#L639) | \* get priority svg icon |
| [640](#L640) | \*/ |
| [641](#L641) | if ( ! function\_exists( 'get\_wpf\_priority\_icon' ) ) { |
| [642](#L642) | function get\_wpf\_priority\_icon() { |
| [643](#L643) | return '<svg version="1.1" id="Layer\_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="200px" height="200px" viewBox="0 0 200 200" enable-background="new 0 0 200 200" xml:space="preserve"> <path fill="#4B5668" d="M197.058,61.695L157.311,5.664c-2.004-2.826-5.271-4.514-8.736-4.515c-0.002,0-0.002,0-0.002,0 c-3.467,0-6.733,1.687-8.738,4.515l-39.747,56.032c-2.328,3.281-2.628,7.542-0.781,11.118c1.847,3.575,5.496,5.796,9.52,5.796 h16.558v108.869c0,6.141,4.994,11.135,11.135,11.135h24.106c6.141,0,11.136-4.995,11.136-11.135V78.609h16.558 c4.024,0,7.671-2.222,9.519-5.796C199.683,69.237,199.385,64.976,197.058,61.695z M164.363,63.817c-4.087,0-7.396,3.311-7.396,7.396 v112.61h-16.794V71.214c0-4.086-3.31-7.396-7.395-7.396h-16.063l31.854-44.907l31.855,44.907L164.363,63.817L164.363,63.817z"/> <path fill="#4B5668" d="M91.176,121.152h-16.56V12.282c0-6.141-4.994-11.136-11.135-11.136H39.375 c-6.141,0-11.135,4.995-11.135,11.136V52.68c0,4.086,3.31,7.396,7.396,7.396c4.085,0,7.396-3.31,7.396-7.396V15.939h16.792v112.61 c0,4.085,3.31,7.396,7.396,7.396h16.062L51.428,180.85l-31.853-44.905h16.062c4.085,0,7.396-3.311,7.396-7.396V87.077 c0-4.085-3.311-7.395-7.396-7.395c-4.086,0-7.396,3.31-7.396,7.395v34.075H11.683c-4.026,0-7.674,2.222-9.521,5.797 c-1.847,3.576-1.546,7.836,0.782,11.115l39.747,56.032c2.006,2.827,5.272,4.517,8.738,4.517h0.002 c3.468-0.001,6.733-1.691,8.737-4.517l39.746-56.03c2.329-3.281,2.63-7.541,0.782-11.117 C98.848,123.374,95.2,121.152,91.176,121.152L91.176,121.152z"/> </svg>'; |
| [644](#L644) | } |
| [645](#L645) | } |
| [646](#L646) |  |
| [647](#L647) | /\* |
| [648](#L648) | \* get info svg icon |
| [649](#L649) | \*/ |
| [650](#L650) | if ( ! function\_exists( 'get\_wpf\_info\_icon' ) ) { |
| [651](#L651) | function get\_wpf\_info\_icon() { |
| [652](#L652) | return '<svg height="100px" version="1.1" viewBox="0 0 100 100" width="100px" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><title/><desc/><defs/><g fill="none" fill-rule="evenodd" id="MiMedia---iOS/Android" stroke="none" stroke-width="1"><g fill="#4B5668" id="icon32pt\_info"><path d="M50,94 C74.300529,94 94,74.300529 94,50 C94,25.699471 74.300529,6 50,6 C25.699471,6 6,25.699471 6,50 C6,74.300529 25.699471,94 50,94 L50,94 Z M50,86 C69.882251,86 86,69.882251 86,50 C86,30.117749 69.882251,14 50,14 C30.117749,14 14,30.117749 14,50 C14,69.882251 30.117749,86 50,86 L50,86 Z M45,49.0044356 C45,46.2405621 47.2441952,44 50,44 C52.7614237,44 55,46.2303666 55,49.0044356 L55,68.9955644 C55,71.7594379 52.7558048,74 50,74 C47.2385763,74 45,71.7696334 45,68.9955644 L45,49.0044356 L45,49.0044356 Z M44,32 C44,28.6862915 46.6930342,26 50,26 C53.3137085,26 56,28.6930342 56,32 C56,35.3137085 53.3069658,38 50,38 C46.6862915,38 44,35.3069658 44,32 L44,32 Z" id="Oval-58"/></g></g></svg>'; |
| [653](#L653) | } |
| [654](#L654) | } |
| [655](#L655) |  |
| [656](#L656) | /\* |
| [657](#L657) | \* get close svg icon |
| [658](#L658) | \*/ |
| [659](#L659) | if ( ! function\_exists( 'get\_wpf\_close\_icon' ) ) { |
| [660](#L660) | function get\_wpf\_close\_icon() { |
| [661](#L661) | return '<svg data-v-07452373="" xmlns="http://www.w3.org/2000/svg" height="18" width="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x feather\_\_content"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'; |
| [662](#L662) | } |
| [663](#L663) | } |
| [664](#L664) |  |
| [665](#L665) | /\* |
| [666](#L666) | \* get right svg icon |
| [667](#L667) | \*/ |
| [668](#L668) | if ( ! function\_exists( 'get\_wpf\_right\_icon' ) ) { |
| [669](#L669) | function get\_wpf\_right\_icon() { |
| [670](#L670) | return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"> <polyline points="20 6 9 17 4 12"></polyline> </svg>'; |
| [671](#L671) | } |
| [672](#L672) | } |
| [673](#L673) |  |
| [674](#L674) | /\* |
| [675](#L675) | \* get pro svg icon |
| [676](#L676) | \*/ |
| [677](#L677) | if ( ! function\_exists( 'get\_wpf\_pro\_icon' ) ) { |
| [678](#L678) | function get\_wpf\_pro\_icon() { |
| [679](#L679) | return '<svg viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M19.0044 8.71143L19.0044 1.71143L12.0044 1.71143L12.0044 8.71143L19.0044 8.71143Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M19.0044 19.7114L19.0044 12.7114L12.0044 12.7114L12.0044 19.7114L19.0044 19.7114Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8.00439 19.7114L8.00439 12.7114L1.00439 12.7114L1.00439 19.7114L8.00439 19.7114Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M8.00439 8.71143L8.00439 1.71143L1.00439 1.71143L1.00439 8.71143L8.00439 8.71143Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </svg>'; |
| [680](#L680) | } |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) | /\* |
| [684](#L684) | \* get atarim svg icon |
| [685](#L685) | \*/ |
| [686](#L686) | if ( ! function\_exists( 'get\_wpf\_icon' ) ) { |
| [687](#L687) | function get\_wpf\_icon() { |
| [688](#L688) | return '<svg id="Layer\_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1080 1080"> <defs><style>.cls-1{fill:#052055}.cls-2{fill:#6d5df3}</style></defs><title>#9304 - New logo request</title> <g> <g> <polygon class="cls-1" points="937.344 785.955 746.1 856.215 851.972 1060.257 1080 1059.991 937.344 785.955"/> <polygon class="cls-1" points="539.938 19.669 0 1059.991 228.152 1059.991 539.873 458.766 652.263 675.369 843.507 605.108 539.938 19.669"/> </g> <polygon class="cls-2" points="227.659 1060.331 373.967 778.521 1055.074 519.371 227.659 1060.331"/> </g> </svg>'; |
| [689](#L689) | } |
| [690](#L690) | } |
| [691](#L691) |  |
| [692](#L692) | /\* |
| [693](#L693) | \* get download icon |
| [694](#L694) | \*/ |
| [695](#L695) | if ( ! function\_exists( 'get\_wpf\_image\_download\_icon' ) ) { |
| [696](#L696) | function get\_wpf\_image\_download\_icon() { |
| [697](#L697) | return '<svg viewBox="0 0 512 512" id="ion-android-download" width="18" height="18" fill="#fff"><path d="M403.002 217.001C388.998 148.002 328.998 96 256 96c-57.998 0-107.998 32.998-132.998 81.001C63.002 183.002 16 233.998 16 296c0 65.996 53.999 120 120 120h260c55 0 100-45 100-100 0-52.998-40.996-96.001-92.998-98.999zM224 268v-76h64v76h68L256 368 156 268h68z"></path></svg>'; |
| [698](#L698) | } |
| [699](#L699) | } |
| [700](#L700) |  |
| [701](#L701) | /\* |
| [702](#L702) | \* get open icon |
| [703](#L703) | \*/ |
| [704](#L704) | if ( ! function\_exists( 'get\_wpf\_image\_open\_icon' ) ) { |
| [705](#L705) | function get\_wpf\_image\_open\_icon() { |
| [706](#L706) | return '<svg height="18" version="1.1" viewBox="0 0 100 100" width="18" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><title/><desc/><defs/><g fill="none" fill-rule="evenodd" id="MiMedia---Web" stroke="none" stroke-width="1"><g fill="#fff" id="icon24pt\_new\_window" transform="translate(2.000000, 2.000000)"><path d="M73.7883228,16 L44.56401,45.2243128 C42.8484762,46.9398466 42.8459918,49.728257 44.5642987,51.4465639 C46.2791092,53.1613744 49.0684023,53.1650001 50.7865498,51.4468526 L80,22.2334024 L80,32.0031611 C80,34.2058797 81.790861,36 84,36 C86.2046438,36 88,34.2105543 88,32.0031611 L88,11.9968389 C88,10.8960049 87.5527117,9.89722307 86.8294627,9.17343595 C86.1051125,8.44841019 85.1063303,8 84.0031611,8 L63.9968389,8 C61.7941203,8 60,9.790861 60,12 C60,14.2046438 61.7894457,16 63.9968389,16 L73.7883228,16 L73.7883228,16 Z M88,56 L88,36.9851507 L88,78.0296986 C88,83.536144 84.0327876,88 79.1329365,88 L16.8670635,88 C11.9699196,88 8,83.5274312 8,78.0296986 L8,17.9703014 C8,12.463856 11.9672124,8 16.8670635,8 L59.5664682,8 L40,8 C42.209139,8 44,9.790861 44,12 C44,14.209139 42.209139,16 40,16 L18.2777939,16 C17.0052872,16 16,17.1947367 16,18.668519 L16,77.331481 C16,78.7786636 17.0198031,80 18.2777939,80 L77.7222061,80 C78.9947128,80 80,78.8052633 80,77.331481 L80,56 C80,53.790861 81.790861,52 84,52 C86.209139,52 88,53.790861 88,56 L88,56 Z" id="Rectangle-2064"/></g></g></svg>'; |
| [707](#L707) | } |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | /\* |
| [711](#L711) | \* push to media icon |
| [712](#L712) | \*/ |
| [713](#L713) | if ( ! function\_exists( 'get\_wpf\_push\_to\_media\_icon' ) ) { |
| [714](#L714) | function get\_wpf\_push\_to\_media\_icon() { |
| [715](#L715) | return '<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32pt" height="31pt" viewBox="0 0 32 31" version="1.1"><g id="surface1"><path style=" stroke:none;fill-rule:nonzero;fill:#ffffff;fill-opacity:1;" d="M 16.234375 16.746094 L 13.558594 24.3125 L 13.550781 24.3125 L 11.476562 30.09375 C 11.621094 30.132812 11.761719 30.164062 11.910156 30.203125 C 11.917969 30.203125 11.925781 30.203125 11.933594 30.203125 C 13.222656 30.535156 14.578125 30.71875 15.972656 30.71875 C 16.667969 30.71875 17.34375 30.679688 18.007812 30.574219 C 18.921875 30.464844 19.800781 30.277344 20.660156 30.015625 C 20.871094 29.953125 21.082031 29.878906 21.296875 29.808594 C 21.066406 29.335938 20.578125 28.28125 20.554688 28.234375 Z M 16.234375 16.746094 "/><path style=" stroke:none;fill-rule:nonzero;fill:#ffffff;fill-opacity:1;" d="M 1.6875 9.5625 C 0.871094 11.351562 0.316406 13.550781 0.316406 15.535156 C 0.316406 16.03125 0.339844 16.53125 0.390625 17.019531 C 0.953125 22.652344 4.707031 27.382812 9.867188 29.507812 C 10.078125 29.59375 10.300781 29.683594 10.519531 29.761719 L 2.929688 9.570312 C 2.277344 9.546875 2.152344 9.585938 1.6875 9.5625 Z M 1.6875 9.5625 "/><path style=" stroke:none;fill-rule:nonzero;fill:#ffffff;fill-opacity:1;" d="M 30.210938 9.160156 C 29.859375 8.425781 29.441406 7.722656 28.976562 7.058594 C 28.847656 6.867188 28.699219 6.675781 28.5625 6.488281 C 26.804688 4.210938 24.414062 2.421875 21.628906 1.378906 C 19.882812 0.714844 17.972656 0.351562 15.980469 0.351562 C 11.058594 0.351562 6.660156 2.566406 3.785156 6.019531 C 3.253906 6.652344 2.78125 7.332031 2.355469 8.046875 C 3.515625 8.054688 4.953125 8.054688 5.117188 8.054688 C 6.59375 8.054688 8.871094 7.878906 8.871094 7.878906 C 9.640625 7.832031 9.71875 8.914062 8.960938 9.003906 C 8.960938 9.003906 8.195312 9.089844 7.34375 9.128906 L 12.480469 23.917969 L 15.566406 14.957031 L 13.378906 9.136719 C 12.609375 9.097656 11.898438 9.011719 11.898438 9.011719 C 11.132812 8.972656 11.230469 7.839844 11.980469 7.886719 C 11.980469 7.886719 14.308594 8.0625 15.695312 8.0625 C 17.171875 8.0625 19.453125 7.886719 19.453125 7.886719 C 20.210938 7.839844 20.308594 8.921875 19.539062 9.011719 C 19.539062 9.011719 18.78125 9.097656 17.933594 9.136719 L 23.019531 23.816406 L 24.429688 19.257812 C 25.140625 17.488281 25.5 16.023438 25.5 14.855469 C 25.5 13.171875 24.871094 12 24.332031 11.089844 C 23.621094 9.960938 22.953125 9.011719 22.953125 7.894531 C 22.953125 6.636719 23.933594 5.46875 25.320312 5.46875 C 25.378906 5.46875 25.441406 5.46875 25.5 5.46875 C 27.640625 5.414062 28.339844 7.46875 28.429688 8.867188 C 28.429688 8.867188 28.429688 8.898438 28.429688 8.914062 C 28.464844 9.484375 28.4375 9.902344 28.4375 10.402344 C 28.4375 11.777344 28.167969 13.335938 27.371094 15.289062 L 24.1875 24.210938 L 22.367188 29.40625 C 22.511719 29.34375 22.652344 29.277344 22.796875 29.207031 C 27.425781 27.042969 30.796875 22.722656 31.507812 17.605469 C 31.613281 16.933594 31.664062 16.246094 31.664062 15.550781 C 31.664062 13.265625 31.140625 11.097656 30.210938 9.160156 Z M 30.210938 9.160156 "/></g></svg>'; |
| [716](#L716) | } |
| [717](#L717) | } |
| [718](#L718) |  |
| [719](#L719) | if ( ! function\_exists( 'wpf\_get\_current\_user\_information' ) ) { |
| [720](#L720) | function wpf\_get\_current\_user\_information( $author\_id = '' ) { |
| [721](#L721) | $response = array(); |
| [722](#L722) | $wpf\_website\_developer = 0; |
| [723](#L723) | if ( ! is\_user\_logged\_in() ) { |
| [724](#L724) | $wpfb\_users\_json       = do\_shortcode( '[wpf\_user\_list\_front]' ); |
| [725](#L725) | $wpfb\_users            = json\_decode( $wpfb\_users\_json ); |
| [726](#L726) | $wpf\_website\_developer = !empty( get\_site\_data\_by\_key( 'wpf\_website\_client' ) ) ? get\_site\_data\_by\_key( 'wpf\_website\_client' ) : 0; |
| [727](#L727) | // Allow user if used Share version 2 by Pratap |
| [728](#L728) | if ( isset( $\_COOKIE['wordpress\_avc\_allow\_guest'] ) && $\_COOKIE['wordpress\_avc\_allow\_guest'] != '' ) { |
| [729](#L729) | $user = json\_decode( stripslashes( $\_COOKIE['wordpress\_avc\_allow\_guest'] ), true ); |
| [730](#L730) | $response['first\_name']   = $user['fname']; |
| [731](#L731) | $response['display\_name'] = $user['dname']; |
| [732](#L732) | $response['role']         = $user['role']; |
| [733](#L733) | $response['user\_id']      = $user['id']; |
| [734](#L734) | return $response; |
| [735](#L735) | } |
| [736](#L736) | } |
| [737](#L737) |  |
| [738](#L738) | if ( $author\_id != '' ) { |
| [739](#L739) | $user                     = get\_userdata( $author\_id ); |
| [740](#L740) | $user\_details             = ( array )$user->data; |
| [741](#L741) | $roles                    = ( array )$user->roles; |
| [742](#L742) | $roles                    = array\_values( $roles ); |
| [743](#L743) | $response['first\_name']   = $user\_details['first\_name'] ?? ""; |
| [744](#L744) | $response['last\_name']    = $user\_details['last\_name'] ?? ""; |
| [745](#L745) | $response['display\_name'] = $user\_details['display\_name']; |
| [746](#L746) | $response['user\_id']      = $user\_details['ID']; |
| [747](#L747) | $response['role']         = $roles[0]; |
| [748](#L748) | return $response; |
| [749](#L749) | } elseif ( is\_user\_logged\_in() == true ) { |
| [750](#L750) | $user         = wp\_get\_current\_user(); |
| [751](#L751) | $user\_details = ( array )$user->data; |
| [752](#L752) | $roles        = ( array )$user->roles; |
| [753](#L753) | $roles        = array\_values( $roles ); |
| [754](#L754) | // to ge the first and last name |
| [755](#L755) | $user\_meta                = get\_user\_meta( $user\_details['ID'] ); |
| [756](#L756) | $response['first\_name']   = ( ! empty( $user\_meta['first\_name'][0] ) ) ? $user\_meta['first\_name'][0] : ""; |
| [757](#L757) | $response['last\_name']    = ( ! empty( $user\_meta['last\_name'][0] ) ) ? $user\_meta['last\_name'][0] : ""; |
| [758](#L758) | $response['display\_name'] = $user\_details['display\_name']; |
| [759](#L759) | $response['user\_id']      = $user\_details['ID']; |
| [760](#L760) | $response['role']         = $roles[0]; |
| [761](#L761) | return $response; |
| [762](#L762) | } elseif ( $wpf\_website\_developer != 0 ) { |
| [763](#L763) | foreach ( $wpfb\_users as $key => $val ) { |
| [764](#L764) | if ( $wpf\_website\_developer == $key ) { |
| [765](#L765) | /\*\* |
| [766](#L766) | \* user id was not matching in graphics page when guest mode on and default user selected |
| [767](#L767) | \* => v2.1.0 |
| [768](#L768) | \*/ |
| [769](#L769) | if ( intval( $wpf\_website\_developer ) > 0 ) { |
| [770](#L770) | $user                     = get\_user\_by( 'id', $val->username ); |
| [771](#L771) | $response['first\_name']   = $val->first\_name ?? ""; |
| [772](#L772) | $response['last\_name']    = $val->last\_name ?? ""; |
| [773](#L773) | $response['display\_name'] = $val->displayname; |
| [774](#L774) | $response['user\_id']      = $wpf\_website\_developer; |
| [775](#L775) |  |
| [776](#L776) | if ( ! empty( $user->roles ) ) { |
| [777](#L777) | $roles            = array\_values( $user->roles ); |
| [778](#L778) | $response['role'] = $roles[0]; |
| [779](#L779) | } else { |
| [780](#L780) | $response['role'] = 'Guest'; |
| [781](#L781) | } |
| [782](#L782) | } else { |
| [783](#L783) | $response['first\_name']   = $val->first\_name ?? ""; |
| [784](#L784) | $response['last\_name']    = $val->last\_name ?? ""; |
| [785](#L785) | $response['display\_name'] = $val->displayname; |
| [786](#L786) | $response['user\_id']      = 0; |
| [787](#L787) | $response['role']         = 'Guest'; |
| [788](#L788) | } |
| [789](#L789) | return $response; |
| [790](#L790) | } |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | $response['display\_name'] = 'Guest'; |
| [794](#L794) | $response['user\_id']      = 0; |
| [795](#L795) | $response['role']         = 'Guest'; |
| [796](#L796) | return $response; |
| [797](#L797) | } else { |
| [798](#L798) | $response['display\_name'] = 'Guest'; |
| [799](#L799) | $response['user\_id']      = 0; |
| [800](#L800) | $response['role']         = 'Guest'; |
| [801](#L801) | return $response; |
| [802](#L802) | } |
| [803](#L803) | } |
| [804](#L804) | } |
| [805](#L805) |  |
| [806](#L806) | /\* |
| [807](#L807) | \* This function is used to get the time difference between two timestamps. It is basically used to get  the time difference between current time and the time when comment was posted. |
| [808](#L808) | \* |
| [809](#L809) | \* @input Timestamp, Timestamp |
| [810](#L810) | \* @return Array |
| [811](#L811) | \*/ |
| [812](#L812) | if ( ! function\_exists( 'wpfb\_time\_difference' ) ) { |
| [813](#L813) | function wpfb\_time\_difference( $datetime1, $datetime2 ) { |
| [814](#L814) | $response = array(); |
| [815](#L815) | $interval = date\_diff( $datetime1, $datetime2 ); |
| [816](#L816) | if ( $interval->y == 0 ) { |
| [817](#L817) | if ( $interval->m == 0 ) { |
| [818](#L818) | if ( $interval->d == 0 ) { |
| [819](#L819) | if ( $interval->h == 0 ) { |
| [820](#L820) | if ( $interval->i == 0 ) { |
| [821](#L821) | $comment\_time = $interval->s . \_\_( 's', 'atarim-visual-collaboration' ); |
| [822](#L822) | } else { |
| [823](#L823) | $comment\_time = $interval->i . \_\_( 'm', 'atarim-visual-collaboration' ); |
| [824](#L824) | } |
| [825](#L825) | } else { |
| [826](#L826) | $comment\_time = $interval->h . \_\_( 'h', 'atarim-visual-collaboration' ); |
| [827](#L827) | } |
| [828](#L828) | } else { |
| [829](#L829) | $comment\_time = $interval->d . \_\_( 'd', 'atarim-visual-collaboration' ); |
| [830](#L830) | } |
| [831](#L831) | } else { |
| [832](#L832) | $comment\_time = $interval->m . \_\_( 'mth', 'atarim-visual-collaboration' ); |
| [833](#L833) | } |
| [834](#L834) | } else { |
| [835](#L835) | $comment\_time = $interval->y . \_\_( 'yr', 'atarim-visual-collaboration' ); |
| [836](#L836) | } |
| [837](#L837) | $response['interval']     = $interval; |
| [838](#L838) | $response['comment\_time'] = $comment\_time; |
| [839](#L839) | return $response; |
| [840](#L840) | } |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | /\* |
| [844](#L844) | \* This function is used to get the listing of status and priorities inside the Tasks Center. |
| [845](#L845) | \* |
| [846](#L846) | \* @input String |
| [847](#L847) | \* @return String |
| [848](#L848) | \*/ |
| [849](#L849) | if ( ! function\_exists( 'wp\_feedback\_get\_texonomy\_selectbox' ) ) { |
| [850](#L850) | function wp\_feedback\_get\_texonomy\_selectbox( $my\_term ) { |
| [851](#L851) | $filter\_data = get\_option( 'filter\_data' ); |
| [852](#L852) | $filter\_data\_db = $filter\_data[$my\_term]; |
| [853](#L853) |  |
| [854](#L854) | //edited by Pratap |
| [855](#L855) | $disable = ''; |
| [856](#L856) | if ( $my\_term == 'task\_status' || $my\_term == 'task\_priority' ) { |
| [857](#L857) | if ( !is\_feature\_enabled( 'task\_center' ) ) { |
| [858](#L858) | $disable = 'disabled'; |
| [859](#L859) | } |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | if ( isset( $filter\_data\_db ) && ! empty( $filter\_data\_db ) ) { |
| [863](#L863) | echo '<select id="task\_' . $my\_term . '\_attr" onchange="' . $my\_term . '\_changed(this);" '. $disable .'>'; |
| [864](#L864) | foreach ( $filter\_data\_db as $term ) { |
| [865](#L865) | if ( $term['label'] == 'In Progress' ) { |
| [866](#L866) | $term['label'] = 'In Prog'; |
| [867](#L867) | } elseif ( $term['label'] == 'Pending Review' ) { |
| [868](#L868) | $term['label'] = 'Pending'; |
| [869](#L869) | } else { |
| [870](#L870) | $term['label'] = $term['label']; |
| [871](#L871) | } |
| [872](#L872) | echo '<option name="' . $my\_term . '" value="' . $term['value'] . '" class="wpf\_task" id="wpf\_' . $term['value'] . '"/>' . \_\_( $term['label'], 'atarim-visual-collaboration' ) . '</option>'; |
| [873](#L873) | } |
| [874](#L874) | echo '</select>'; |
| [875](#L875) | } |
| [876](#L876) | } |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | /\* |
| [880](#L880) | \* This function is used to check if Atarim is enabled on the website. |
| [881](#L881) | \* |
| [882](#L882) | \* @input Int |
| [883](#L883) | \* @return Boolean |
| [884](#L884) | \*/ |
| [885](#L885) | if ( ! function\_exists( 'wpf\_check\_if\_enable' ) ) { |
| [886](#L886) | function wpf\_check\_if\_enable( $author\_id = '' ) { |
| [887](#L887) | if ( $author\_id == '' ) { |
| [888](#L888) | $current\_user\_information = wpf\_get\_current\_user\_information(); |
| [889](#L889) | $user                     = wp\_get\_current\_user(); |
| [890](#L890) | } else { |
| [891](#L891) | $current\_user\_information = wpf\_get\_current\_user\_information( $author\_id ); |
| [892](#L892) | $user                     = get\_userdata( $author\_id ); |
| [893](#L893) | } |
| [894](#L894) |  |
| [895](#L895) | $wpf\_license      = get\_option( 'wpf\_license' ); |
| [896](#L896) | $wpf\_enabled      = get\_site\_data\_by\_key( 'enabled\_wpfeedback' ); |
| [897](#L897) | $wpf\_selcted\_role = get\_site\_data\_by\_key( 'wpf\_selcted\_role' ); |
| [898](#L898) | $wpf\_allow\_guest  = get\_site\_data\_by\_key( 'wpf\_allow\_guest' ); |
| [899](#L899) | $selected\_roles   = explode( ',', $wpf\_selcted\_role ); |
| [900](#L900) | $user\_details     = ( array )$user->data; |
| [901](#L901) | $roles            = ( array )$user->roles; |
| [902](#L902) | $roles            = array\_values( $roles ); |
| [903](#L903) | // Allow user if used Share version 2 by Pratap |
| [904](#L904) | if ( isset( $\_COOKIE['wordpress\_avc\_allow\_guest'] ) ) { |
| [905](#L905) | $wpf\_allow\_guest = 'yes'; |
| [906](#L906) | } |
| [907](#L907) |  |
| [908](#L908) | if ( isset( $\_COOKIE['wordpress\_avc\_guest'] ) ) { |
| [909](#L909) | $wpf\_allow\_guest = 'yes'; |
| [910](#L910) | } |
| [911](#L911) |  |
| [912](#L912) | if ( $wpf\_license == 'valid' && $wpf\_enabled == 'yes' && ( ! empty( array\_intersect( $roles, $selected\_roles ) ) || $wpf\_allow\_guest == 'yes' ) ) { |
| [913](#L913) | $wpf\_access\_output = 1; |
| [914](#L914) | } else { |
| [915](#L915) | $wpf\_access\_output = 0; |
| [916](#L916) | } |
| [917](#L917) | return $wpf\_access\_output; |
| [918](#L918) | } |
| [919](#L919) | } |
| [920](#L920) |  |
| [921](#L921) | /\* |
| [922](#L922) | \* This function is used to get extra user settings for the Atarim. |
| [923](#L923) | \* |
| [924](#L924) | \* @input Object |
| [925](#L925) | \* @return NULL |
| [926](#L926) | \*/ |
| [927](#L927) | if ( ! function\_exists( 'wpf\_show\_extra\_profile\_fields' ) ) { |
| [928](#L928) | function wpf\_show\_extra\_profile\_fields( $user ) { |
| [929](#L929) | $wpf\_get\_user\_type = get\_user\_meta( $user->ID, 'wpf\_user\_type', true ); |
| [930](#L930) | $selected\_roles    = get\_site\_data\_by\_key( 'wpf\_selcted\_role' ); |
| [931](#L931) | $selected\_roles    = explode( ',', $selected\_roles ); |
| [932](#L932) | $wpf\_enabled       = get\_site\_data\_by\_key( 'enabled\_wpfeedback' ); |
| [933](#L933) | if ( ( array\_intersect( $user->roles, $selected\_roles ) && $wpf\_enabled == 'yes' ) || current\_user\_can( 'administrator' ) ) { |
| [934](#L934) | $notifications\_html = wpf\_get\_allowed\_notification\_list( $user->ID, 'no' ); |
| [935](#L935) | ?> |
| [936](#L936) | <h3><?php \_e( 'Collaborate Information', 'atarim-visual-collaboration' ); ?></h3> |
| [937](#L937) | <table class="form-table wpf\_fields"> |
| [938](#L938) | <tr> |
| [939](#L939) | <th><label for="wpf\_user\_type"><?php \_e( "User Type", 'atarim-visual-collaboration' ); ?></label></th> |
| [940](#L940) | <td> |
| [941](#L941) | <select id="wpf\_user\_type" name="wpf\_user\_type"> |
| [942](#L942) | <option value="" <?php if ( $wpf\_get\_user\_type == '' ) { echo 'selected'; } ?> ><?php \_e( 'Select', 'atarim-visual-collaboration' ) ?></option> |
| [943](#L943) | <option value="king" <?php if ( $wpf\_get\_user\_type == 'king' ) { echo 'selected'; } ?> ><?php echo ! empty( get\_site\_data\_by\_key( 'wpf\_customisations\_client' ) ) ? esc\_html( get\_site\_data\_by\_key( 'wpf\_customisations\_client' ) ) : 'Client (Website Owner)'; ?></option> |
| [944](#L944) | <option value="advisor" <?php if ( $wpf\_get\_user\_type == 'advisor' ) { echo 'selected'; } ?> ><?php echo ! empty( get\_site\_data\_by\_key( 'wpf\_customisations\_webmaster' ) ) ? esc\_html( get\_site\_data\_by\_key( 'wpf\_customisations\_webmaster' ) ) : 'Webmaster'; ?></option> |
| [945](#L945) | <option value="council" <?php if ( $wpf\_get\_user\_type == 'council' ) { echo 'selected'; } ?> ><?php echo ! empty( get\_site\_data\_by\_key( 'wpf\_customisations\_others' ) ) ? esc\_html( get\_site\_data\_by\_key( 'wpf\_customisations\_others' ) ) : 'Others'; ?></option> |
| [946](#L946) | </select> |
| [947](#L947) | </td> |
| [948](#L948) | </tr> |
| [949](#L949) | <tr> |
| [950](#L950) | <th><label for="city"><?php \_e( "Email notifications", 'atarim-visual-collaboration' ); ?></label></th> |
| [951](#L951) | <td> |
| [952](#L952) | <?php echo $notifications\_html; ?> |
| [953](#L953) | </td> |
| [954](#L954) | </tr> |
| [955](#L955) | </table> |
| [956](#L956) | <?php |
| [957](#L957) | } |
| [958](#L958) | } |
| [959](#L959) | } |
| [960](#L960) | add\_action( 'show\_user\_profile', 'wpf\_show\_extra\_profile\_fields' ); |
| [961](#L961) | add\_action( 'edit\_user\_profile', 'wpf\_show\_extra\_profile\_fields' ); |
| [962](#L962) |  |
| [963](#L963) | /\* |
| [964](#L964) | \* This function is used to save the extra user settings for the Atarim. |
| [965](#L965) | \* |
| [966](#L966) | \* @input Int |
| [967](#L967) | \* @return Boolean |
| [968](#L968) | \*/ |
| [969](#L969) | if ( ! function\_exists( 'wpf\_save\_user\_profile\_fields' ) ) { |
| [970](#L970) | function wpf\_save\_user\_profile\_fields( $user\_id ) { |
| [971](#L971) | syncUsers(); |
| [972](#L972) | $user           = get\_userdata( $user\_id ); |
| [973](#L973) | $selected\_roles = get\_site\_data\_by\_key( 'wpf\_selcted\_role' ); |
| [974](#L974) | $selected\_roles = explode( ',', $selected\_roles ); |
| [975](#L975) | $wpf\_enabled    = get\_site\_data\_by\_key( 'enabled\_wpfeedback' ); |
| [976](#L976) | $args           = array( |
| [977](#L977) | 'wpf\_site\_id'   => get\_option( 'wpf\_site\_id' ), |
| [978](#L978) | 'wpf\_id'        => sanitize\_text\_field( $\_POST['user\_id'] ), |
| [979](#L979) | 'username'      => $user->data->user\_login, |
| [980](#L980) | 'wpf\_email'     => sanitize\_email( $\_POST['email'] ), |
| [981](#L981) | 'first\_name'    => sanitize\_text\_field( $\_POST['first\_name'] ), |
| [982](#L982) | 'last\_name'     => sanitize\_text\_field( $\_POST['last\_name'] ), |
| [983](#L983) | 'wpf\_user\_type' => sanitize\_text\_field( $\_POST['wpf\_user\_type'] ), |
| [984](#L984) | ); |
| [985](#L985) |  |
| [986](#L986) | update\_user\_meta( $user->ID, 'wpf\_user\_type', sanitize\_text\_field( $\_POST['wpf\_user\_type'] ) ); |
| [987](#L987) |  |
| [988](#L988) | if ( ( array\_intersect( $user->roles, $selected\_roles ) && $wpf\_enabled == 'yes' && current\_user\_can( 'edit\_user', $user\_id ) ) || current\_user\_can( 'administrator' ) ) { |
| [989](#L989) | $options                            = []; |
| [990](#L990) | $options['wpf\_site\_id']             = get\_option( 'wpf\_site\_id' ); |
| [991](#L991) | $options['wpf\_every\_new\_task']      = isset( $\_POST['wpf\_every\_new\_task'] ) ? 1 : 0; |
| [992](#L992) | $options['wpf\_every\_new\_comment']   = isset( $\_POST['wpf\_every\_new\_comment'] ) ? 1 : 0; |
| [993](#L993) | $options['wpf\_every\_new\_complete']  = isset( $\_POST['wpf\_every\_new\_complete'] ) ? 1 : 0; |
| [994](#L994) | $options['wpf\_every\_status\_change'] = isset( $\_POST['wpf\_every\_status\_change'] ) ? 1 : 0; |
| [995](#L995) | $options['wpf\_daily\_report']        = isset( $\_POST['wpf\_daily\_report'] ) ? 1 : 0; |
| [996](#L996) | $options['wpf\_weekly\_report']       = isset( $\_POST['wpf\_weekly\_report'] ) ? 1 : 0; |
| [997](#L997) | $options['wpf\_auto\_daily\_report']   = isset( $\_POST['wpf\_auto\_daily\_report'] ) ? 1 : 0; |
| [998](#L998) | $options['wpf\_auto\_weekly\_report']  = isset( $\_POST['wpf\_auto\_weekly\_report'] ) ? 1 : 0; |
| [999](#L999) | $args['notifications']              = $options; |
| [1000](#L1000) | $url                                = WPF\_CRM\_API . 'wp-api/wpfuser/update'; |
| [1001](#L1001) | $res                                = wpf\_send\_remote\_post( $url, wp\_json\_encode( $args ) ); |
| [1002](#L1002) | } else { |
| [1003](#L1003) | return false; |
| [1004](#L1004) | } |
| [1005](#L1005) | } |
| [1006](#L1006) | } |
| [1007](#L1007) | add\_action( 'personal\_options\_update', 'wpf\_save\_user\_profile\_fields' ); |
| [1008](#L1008) | add\_action( 'edit\_user\_profile\_update', 'wpf\_save\_user\_profile\_fields' ); |
| [1009](#L1009) |  |
| [1010](#L1010) | // sync users |
| [1011](#L1011) | function wpf\_sync\_users( $user\_id ) { |
| [1012](#L1012) | syncUsers(); |
| [1013](#L1013) | } |
| [1014](#L1014) | add\_action( 'user\_register', 'wpf\_sync\_users' ); |
| [1015](#L1015) | add\_action( 'deleted\_user', 'wpf\_sync\_users', 10 ); |
| [1016](#L1016) | add\_action( 'profile\_update', 'wpf\_sync\_users', 10 ); |
| [1017](#L1017) |  |
| [1018](#L1018) | /\* update WP users into API \*/ |
| [1019](#L1019) | function syncUsers() { |
| [1020](#L1020) | $users                = wpf\_api\_func\_get\_users(); |
| [1021](#L1021) | $args                 = []; |
| [1022](#L1022) | $args['wpf\_site\_id']  = get\_option( 'wpf\_site\_id' ); |
| [1023](#L1023) | $args['responseBody'] = json\_decode( $users ); |
| [1024](#L1024) | // get all the user ID |
| [1025](#L1025) | $wp\_users = get\_users( array( 'fields' => array( 'ID' ) ) ); |
| [1026](#L1026) | // flaten the data to a single array and added to the request |
| [1027](#L1027) | $args['wpf\_wp\_user\_ids'] = array\_map( function( $user ) { |
| [1028](#L1028) | return $user->ID; |
| [1029](#L1029) | }, $wp\_users ); |
| [1030](#L1030) |  |
| [1031](#L1031) | $url         = WPF\_CRM\_API . "wp-api/sync/users"; |
| [1032](#L1032) | $sendtocloud = wp\_json\_encode( $args ); |
| [1033](#L1033) | $res         = wpf\_send\_remote\_post( $url, $sendtocloud ); |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) |  |
| [1037](#L1037) | function syncSite() { |
| [1038](#L1038) | $url                     = WPF\_CRM\_API . 'wp-api/wpfsite/update'; |
| [1039](#L1039) | $response                = array(); |
| [1040](#L1040) | $response['wpf\_site\_id'] = get\_option( 'wpf\_site\_id' ); |
| [1041](#L1041) | $response['url']         = get\_option( 'siteurl' ); |
| [1042](#L1042) | $response['name']        = get\_option( 'blogname' ); |
| [1043](#L1043) | $body                    = wp\_json\_encode( $response ); |
| [1044](#L1044) | $res                     = wpf\_send\_remote\_post( $url, $body ); |
| [1045](#L1045) | } |
| [1046](#L1046) |  |
| [1047](#L1047) | add\_action( 'update\_option\_blogname', function( $old\_value, $new\_value ) { |
| [1048](#L1048) | syncSite(); |
| [1049](#L1049) | }, 10, 2); |
| [1050](#L1050) |  |
| [1051](#L1051) | add\_action( 'update\_option\_siteurl', function( $old\_value, $new\_value ) { |
| [1052](#L1052) | syncSite(); |
| [1053](#L1053) | }, 10, 2); |
| [1054](#L1054) |  |
| [1055](#L1055) | /\* |
| [1056](#L1056) | \* This function is used to get the allowed notification list to be displayed on the users extra settings. |
| [1057](#L1057) | \* |
| [1058](#L1058) | \* @input Int, String |
| [1059](#L1059) | \* @return String |
| [1060](#L1060) | \*/ |
| [1061](#L1061) | if ( ! function\_exists( 'wpf\_get\_allowed\_notification\_list' ) ) { |
| [1062](#L1062) | function wpf\_get\_allowed\_notification\_list( $userid, $default = 'no' ) { |
| [1063](#L1063) | $wpf\_site\_id             = get\_option( 'wpf\_site\_id' ); |
| [1064](#L1064) | $args                    = []; |
| [1065](#L1065) | $args['wpf\_site\_id']     = $wpf\_site\_id; |
| [1066](#L1066) | $args['wpf\_user\_id']     = $userid; |
| [1067](#L1067) | $url                     = WPF\_CRM\_API . "wp-api/wpfuser/getWpfUser"; |
| [1068](#L1068) | $sendtocloud             = wp\_json\_encode( $args ); |
| [1069](#L1069) | $res                     = wpf\_send\_remote\_post( $url, $sendtocloud ); |
| [1070](#L1070) | $response                = ''; |
| [1071](#L1071) | $wpf\_every\_new\_task      = get\_site\_data\_by\_key( 'wpf\_every\_new\_task' ); |
| [1072](#L1072) | $wpf\_every\_new\_comment   = get\_site\_data\_by\_key( 'wpf\_every\_new\_comment' ); |
| [1073](#L1073) | $wpf\_every\_new\_complete  = get\_site\_data\_by\_key( 'wpf\_every\_new\_complete' ); |
| [1074](#L1074) | $wpf\_every\_status\_change = get\_site\_data\_by\_key( 'wpf\_every\_status\_change' ); |
| [1075](#L1075) | $wpf\_daily\_report        = get\_site\_data\_by\_key( 'wpf\_daily\_report' ); |
| [1076](#L1076) | $wpf\_weekly\_report       = get\_site\_data\_by\_key( 'wpf\_weekly\_report' ); |
| [1077](#L1077) | $wpf\_auto\_daily\_report   = get\_site\_data\_by\_key( 'wpf\_auto\_daily\_report' ); |
| [1078](#L1078) | $wpf\_auto\_weekly\_report  = get\_site\_data\_by\_key( 'wpf\_auto\_weekly\_report' ); |
| [1079](#L1079) | if ( $wpf\_every\_new\_task == 'yes' ) { |
| [1080](#L1080) | if ( isset( $res['data']['preference']['every\_new\_task'] ) && $res['data']['preference']['every\_new\_task'] == 1 ) { |
| [1081](#L1081) | $checked = 'checked'; |
| [1082](#L1082) | } else { |
| [1083](#L1083) | $checked = ''; |
| [1084](#L1084) | } |
| [1085](#L1085) | if ( $default == 'yes' ) { |
| [1086](#L1086) | $checked = 'checked'; |
| [1087](#L1087) | } |
| [1088](#L1088) | $response .= '<div><input type="checkbox" name="wpf\_every\_new\_task" value="yes" class="wpf\_checkbox" |
| [1089](#L1089) | id="wpf\_every\_new\_task" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_every\_new\_task">' . \_\_( 'Receive email notification for every new task', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1090](#L1090) | } |
| [1091](#L1091) | if ( $wpf\_every\_new\_comment == 'yes' ) { |
| [1092](#L1092) | if ( isset( $res['data']['preference']['every\_new\_comment'] ) && $res['data']['preference']['every\_new\_comment'] == 1 ) { |
| [1093](#L1093) | $checked = 'checked'; |
| [1094](#L1094) | } else { |
| [1095](#L1095) | $checked = ''; |
| [1096](#L1096) | } |
| [1097](#L1097) | if ( $default == 'yes' ) { |
| [1098](#L1098) | $checked = 'checked'; |
| [1099](#L1099) | } |
| [1100](#L1100) | $response .= '<div><input type="checkbox" name="wpf\_every\_new\_comment" value="yes" class="wpf\_checkbox" |
| [1101](#L1101) | id="wpf\_every\_new\_comment" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_every\_new\_comment">' . \_\_( 'Receive email notification for every new comment', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1102](#L1102) | } |
| [1103](#L1103) | if ( $wpf\_every\_new\_complete == 'yes' ) { |
| [1104](#L1104) | if ( isset( $res['data']['preference']['wpf\_every\_new\_complete'] ) && $res['data']['preference']['wpf\_every\_new\_complete'] == 1 ) { |
| [1105](#L1105) | $checked = 'checked'; |
| [1106](#L1106) | } else { |
| [1107](#L1107) | $checked = ''; |
| [1108](#L1108) | } |
| [1109](#L1109) | if ( $default == 'yes' ) { |
| [1110](#L1110) | $checked = 'checked'; |
| [1111](#L1111) | } |
| [1112](#L1112) | $response .= '<div><input type="checkbox" name="wpf\_every\_new\_complete" value="yes" class="wpf\_checkbox" |
| [1113](#L1113) | id="wpf\_every\_new\_complete" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_every\_new\_complete">' . \_\_( 'Receive email notification when a task is marked as complete', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1114](#L1114) | } |
| [1115](#L1115) | if ( $wpf\_every\_status\_change == 'yes' ) { |
| [1116](#L1116) | if ( isset( $res['data']['preference']['every\_status\_change'] ) && $res['data']['preference']['every\_status\_change'] == 1 ) { |
| [1117](#L1117) | $checked = 'checked'; |
| [1118](#L1118) | } else { |
| [1119](#L1119) | $checked = ''; |
| [1120](#L1120) | } |
| [1121](#L1121) | if ( $default == 'yes' ) { |
| [1122](#L1122) | $checked = 'checked'; |
| [1123](#L1123) | } |
| [1124](#L1124) | $response .= '<div><input type="checkbox" name="wpf\_every\_status\_change" value="yes" class="wpf\_checkbox" |
| [1125](#L1125) | id="wpf\_every\_status\_change" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_every\_status\_change">' . \_\_( 'Receive email notification for every status change', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1126](#L1126) | } |
| [1127](#L1127) | if ( $wpf\_daily\_report == 'yes' ) { |
| [1128](#L1128) | if ( isset( $res['data']['preference']['daily\_report'] ) && $res['data']['preference']['daily\_report'] == 1 ) { |
| [1129](#L1129) | $checked='checked'; |
| [1130](#L1130) | } else { |
| [1131](#L1131) | $checked = ''; |
| [1132](#L1132) | } |
| [1133](#L1133) | if ( $default == 'yes' ) { |
| [1134](#L1134) | $checked = 'checked'; |
| [1135](#L1135) | } |
| [1136](#L1136) | $response .= '<div><input type="checkbox" name="wpf\_daily\_report" value="yes" class="wpf\_checkbox" |
| [1137](#L1137) | id="wpf\_daily\_report" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_daily\_report">' . \_\_( 'Receive email notification for  daily report', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1138](#L1138) | } |
| [1139](#L1139) | if ( $wpf\_weekly\_report == 'yes' ) { |
| [1140](#L1140) | if ( isset( $res['data']['preference']['weekly\_report'] ) && $res['data']['preference']['weekly\_report'] == 1 ) { |
| [1141](#L1141) | $checked='checked'; |
| [1142](#L1142) | } else { |
| [1143](#L1143) | $checked = ''; |
| [1144](#L1144) | } |
| [1145](#L1145) | if ( $default == 'yes' ) { |
| [1146](#L1146) | $checked = 'checked'; |
| [1147](#L1147) | } |
| [1148](#L1148) | $response .= '<div><input type="checkbox" name="wpf\_weekly\_report" value="yes" class="wpf\_checkbox" |
| [1149](#L1149) | id="wpf\_weekly\_report" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_weekly\_report">' . \_\_( 'Receive email notification for weekly report', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1150](#L1150) | } |
| [1151](#L1151) | if ( is\_feature\_enabled( 'auto\_reports' ) ) { |
| [1152](#L1152) | if ( $wpf\_auto\_daily\_report == 'yes' ) { |
| [1153](#L1153) | if ( isset( $res['data']['preference']['wpf\_auto\_daily\_report'] ) && $res['data']['preference']['wpf\_auto\_daily\_report'] == 1 ) { |
| [1154](#L1154) | $checked = 'checked'; |
| [1155](#L1155) | } else { |
| [1156](#L1156) | $checked = ''; |
| [1157](#L1157) | } |
| [1158](#L1158) | if ( $default == 'yes' ) { |
| [1159](#L1159) | $checked = 'checked'; |
| [1160](#L1160) | } |
| [1161](#L1161) | $response .= '<div><input type="checkbox" class="wpf\_checkbox" name="wpf\_auto\_daily\_report" value="yes" id="wpf\_auto\_daily\_report" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_auto\_daily\_report">' . \_\_( 'Auto receive email notification for daily report', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1162](#L1162) | } |
| [1163](#L1163) | if ( $wpf\_auto\_weekly\_report == 'yes' ) { |
| [1164](#L1164) | if ( isset( $res['data']['preference']['wpf\_auto\_weekly\_report'] ) && $res['data']['preference']['wpf\_auto\_weekly\_report'] == 1 ) { |
| [1165](#L1165) | $checked = 'checked'; |
| [1166](#L1166) | } else { |
| [1167](#L1167) | $checked = ''; |
| [1168](#L1168) | } |
| [1169](#L1169) | if ( $default == 'yes' ) { |
| [1170](#L1170) | $checked = 'checked'; |
| [1171](#L1171) | } |
| [1172](#L1172) | $response .= '<div><input type="checkbox" name="wpf\_auto\_weekly\_report" value="yes" class="wpf\_checkbox" |
| [1173](#L1173) | id="wpf\_auto\_weekly\_report" ' . $checked . ' /><label class="wpf\_checkbox\_label" for="wpf\_auto\_weekly\_report">' . \_\_( 'Auto receive email notification for weekly report', 'atarim-visual-collaboration' ) . '</label></div>'; |
| [1174](#L1174) | } |
| [1175](#L1175) | } |
| [1176](#L1176) | return $response; |
| [1177](#L1177) | } |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | /\* |
| [1181](#L1181) | \* This function is used to get the Atarim user type. |
| [1182](#L1182) | \* |
| [1183](#L1183) | \* @input NULL |
| [1184](#L1184) | \* @return String |
| [1185](#L1185) | \*/ |
| [1186](#L1186) | if ( ! function\_exists( 'wpf\_user\_type' ) ) { |
| [1187](#L1187) | function wpf\_user\_type() { |
| [1188](#L1188) | global $current\_user; |
| [1189](#L1189) | return get\_user\_meta( $current\_user->ID, 'wpf\_user\_type', true ); |
| [1190](#L1190) | } |
| [1191](#L1191) | } |
| [1192](#L1192) |  |
| [1193](#L1193) | /\* |
| [1194](#L1194) | \* This function is used to verify if the uploaded file is valid or not. |
| [1195](#L1195) | \* |
| [1196](#L1196) | \* @input File |
| [1197](#L1197) | \* @return Boolean |
| [1198](#L1198) | \*/ |
| [1199](#L1199) | if ( ! function\_exists( 'wpf\_verify\_file\_upload' ) ) { |
| [1200](#L1200) | function wpf\_verify\_file\_upload( $server, $file\_data ) { |
| [1201](#L1201) | $allowed\_file\_types = array( 'image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'text/plain', 'application/octet-stream', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet','video/webm','video/mp4','video/mov','video/wmv','video/avi','font/ttf','text/plain' ); |
| [1202](#L1202) | if ( function\_exists( 'finfo\_open' ) ) { |
| [1203](#L1203) | $imgdata   = base64\_decode( $file\_data ); |
| [1204](#L1204) | $f         = finfo\_open(); |
| [1205](#L1205) | $mime\_type = finfo\_buffer( $f, $imgdata, FILEINFO\_MIME\_TYPE ); |
| [1206](#L1206) | if ( in\_array( $mime\_type, $allowed\_file\_types ) ) { |
| [1207](#L1207) | $response = 0; |
| [1208](#L1208) | } else { |
| [1209](#L1209) | $response = 1; |
| [1210](#L1210) | } |
| [1211](#L1211) | } else { |
| [1212](#L1212) | $response = 0; |
| [1213](#L1213) | } |
| [1214](#L1214) | return $response; |
| [1215](#L1215) | } |
| [1216](#L1216) | } |
| [1217](#L1217) |  |
| [1218](#L1218) | /\* |
| [1219](#L1219) | \* This function is used to verify if the uploaded file extension is proper or not. |
| [1220](#L1220) | \* |
| [1221](#L1221) | \* @input String |
| [1222](#L1222) | \* @return Boolean |
| [1223](#L1223) | \*/ |
| [1224](#L1224) | if ( ! function\_exists( 'wpf\_verify\_file\_upload\_type' ) ) { |
| [1225](#L1225) | function wpf\_verify\_file\_upload\_type( $server, $mime\_type ) { |
| [1226](#L1226) | $allowed\_file\_types = array( 'application/msword','image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'text/plain', 'application/octet-stream', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'video/webm', 'video/mp4', 'video/quicktime', 'video/x-ms-wmv', 'video/avi', 'font/ttf', 'text/plain' ); |
| [1227](#L1227) | if ( ! empty( $mime\_type ) ) { |
| [1228](#L1228) | if ( in\_array( $mime\_type, $allowed\_file\_types ) ) { |
| [1229](#L1229) | $response = 0; |
| [1230](#L1230) | } else { |
| [1231](#L1231) | $response = 1; |
| [1232](#L1232) | } |
| [1233](#L1233) | } else { |
| [1234](#L1234) | $response = 0; |
| [1235](#L1235) | } |
| [1236](#L1236) | return $response; |
| [1237](#L1237) | } |
| [1238](#L1238) | } |
| [1239](#L1239) |  |
| [1240](#L1240) | /\* |
| [1241](#L1241) | \* This function is used to get the list of the pages on the website. It is called to get the dropdown list when creating a general task from backend. |
| [1242](#L1242) | \* |
| [1243](#L1243) | \* @input String |
| [1244](#L1244) | \* @return JSON |
| [1245](#L1245) | \*/ |
| [1246](#L1246) | if ( ! function\_exists( 'wpf\_get\_page\_list' ) ) { |
| [1247](#L1247) | function wpf\_get\_page\_list( $type = 'task\_page' ) { |
| [1248](#L1248) | $response = array(); |
| [1249](#L1249) | if ( class\_exists( 'WooCommerce' ) ) { |
| [1250](#L1250) | $wpf\_default\_wp\_post\_types = array( "page" => "page", "post" => "post", "product" => "product" ); |
| [1251](#L1251) | } else { |
| [1252](#L1252) | $wpf\_default\_wp\_post\_types = array( "page" => "page", "post" => "post" ); |
| [1253](#L1253) | } |
| [1254](#L1254) | $wpf\_wp\_cpts    = get\_post\_types( array( 'public' => true, 'exclude\_from\_search' => true, '\_builtin' => false ) ); |
| [1255](#L1255) | $wpf\_post\_types = array\_merge( $wpf\_default\_wp\_post\_types, $wpf\_wp\_cpts ); |
| [1256](#L1256) |  |
| [1257](#L1257) | foreach ( $wpf\_post\_types as $wpf\_post\_type ) { |
| [1258](#L1258) | $objType = get\_post\_type\_object( $wpf\_post\_type ); |
| [1259](#L1259) | if ( $wpf\_post\_type == 'page' ) { |
| [1260](#L1260) | $numberposts = -1; |
| [1261](#L1261) | } else { |
| [1262](#L1262) | $numberposts = 10; |
| [1263](#L1263) | } |
| [1264](#L1264) | $wpf\_temp\_arg = array( |
| [1265](#L1265) | 'post\_type'   => $wpf\_post\_type, |
| [1266](#L1266) | 'numberposts' => $numberposts, |
| [1267](#L1267) | ); |
| [1268](#L1268) | $posts          = get\_posts( $wpf\_temp\_arg ); |
| [1269](#L1269) | $wpf\_count\_post = count( $posts ); |
| [1270](#L1270) | if ( $wpf\_count\_post ) { |
| [1271](#L1271) | foreach ( $posts as $post ) { |
| [1272](#L1272) | if ( $type == 'task\_page' ) { |
| [1273](#L1273) | $response[$objType->labels->singular\_name][$post->ID] = htmlspecialchars( $post->post\_title, ENT\_QUOTES, 'UTF-8' ); |
| [1274](#L1274) | } else { |
| [1275](#L1275) | $temp\_res = array( |
| [1276](#L1276) | 'id'    => $post->ID, |
| [1277](#L1277) | 'name'  => htmlspecialchars( $post->post\_title, ENT\_QUOTES, 'UTF-8' ), |
| [1278](#L1278) | 'type'  => $objType->labels->singular\_name, |
| [1279](#L1279) | 'url'   => get\_permalink( $post->ID ) |
| [1280](#L1280) | ); |
| [1281](#L1281) | $response[] = $temp\_res; |
| [1282](#L1282) | } |
| [1283](#L1283) | } |
| [1284](#L1284) | } |
| [1285](#L1285) | } |
| [1286](#L1286) | return wp\_json\_encode( $response ); |
| [1287](#L1287) | } |
| [1288](#L1288) | } |
| [1289](#L1289) |  |
| [1290](#L1290) | /\* |
| [1291](#L1291) | \* This function is used to deregister the scripts of the plugins that are conflicting with the Atarim. |
| [1292](#L1292) | \* |
| [1293](#L1293) | \* @input NULL |
| [1294](#L1294) | \* @return NULL |
| [1295](#L1295) | \*/ |
| [1296](#L1296) | if ( ! function\_exists( 'wpf\_mootools\_deregister\_javascript' ) ) { |
| [1297](#L1297) | function wpf\_mootools\_deregister\_javascript() { |
| [1298](#L1298) | if ( ! is\_admin() ) { |
| [1299](#L1299) | wp\_deregister\_script( 'mootools-local' ); |
| [1300](#L1300) | wp\_deregister\_script( 'enlighter-local' ); |
| [1301](#L1301) | wp\_deregister\_script( 'dct-carousel-jquery' ); |
| [1302](#L1302) | wp\_deregister\_script( 'onepress-js-plugins' ); |
| [1303](#L1303) | } |
| [1304](#L1304) | } |
| [1305](#L1305) | } |
| [1306](#L1306) | add\_action( 'wp\_print\_scripts', 'wpf\_mootools\_deregister\_javascript', 99 ); |
| [1307](#L1307) |  |
| [1308](#L1308) | /\* |
| [1309](#L1309) | \* This function is to remove script/tags that could be used for XSS attack by Pratap. |
| [1310](#L1310) | \* |
| [1311](#L1311) | \* @input NULL |
| [1312](#L1312) | \* @return NULL |
| [1313](#L1313) | \*/ |
| [1314](#L1314) | function wpf\_wp\_kses\_check( $content ) { |
| [1315](#L1315) | $allowed\_html = array( |
| [1316](#L1316) | 'a'      => array( |
| [1317](#L1317) | 'href'   => array(), |
| [1318](#L1318) | 'target' => array(), |
| [1319](#L1319) | ), |
| [1320](#L1320) | 'img' => array( |
| [1321](#L1321) | 'title' => array(), |
| [1322](#L1322) | 'src'       => array(), |
| [1323](#L1323) | 'alt'       => array(), |
| [1324](#L1324) | ), |
| [1325](#L1325) | 'p'     => array(), |
| [1326](#L1326) | 'br'     => array(), |
| [1327](#L1327) | 'em'     => array(), |
| [1328](#L1328) | 'strong' => array(), |
| [1329](#L1329) | 's'      => array(), |
| [1330](#L1330) | 'u'      => array(), |
| [1331](#L1331) | 'ul'     => array(), |
| [1332](#L1332) | 'ol'     => array(), |
| [1333](#L1333) | 'li'     => array(), |
| [1334](#L1334) | 'pre'    => array( |
| [1335](#L1335) | 'class'      => array(), |
| [1336](#L1336) | 'spellcheck' => array(), |
| [1337](#L1337) | ), |
| [1338](#L1338) | ); |
| [1339](#L1339) | return wp\_kses( $content, $allowed\_html ); |
| [1340](#L1340) | } |
| [1341](#L1341) |  |
| [1342](#L1342) |  |
| [1343](#L1343) | /\* |
| [1344](#L1344) | \* This function is used to strip all the code elements from the data. |
| [1345](#L1345) | \* |
| [1346](#L1346) | \* @input String |
| [1347](#L1347) | \* @return String |
| [1348](#L1348) | \*/ |
| [1349](#L1349) | if ( ! function\_exists( 'wpf\_test\_input' ) ) { |
| [1350](#L1350) | function wpf\_test\_input( $data ) { |
| [1351](#L1351) | $data = trim( $data ); |
| [1352](#L1352) | $data = stripslashes( $data ); |
| [1353](#L1353) | $data = htmlspecialchars( $data ); |
| [1354](#L1354) | return $data; |
| [1355](#L1355) | } |
| [1356](#L1356) | } |
| [1357](#L1357) |  |
| [1358](#L1358) | /\* |
| [1359](#L1359) | \* This function is used by all the ajax request to make user that they are coming from authentic source. |
| [1360](#L1360) | \* |
| [1361](#L1361) | \* @input NULL |
| [1362](#L1362) | \* @return String |
| [1363](#L1363) | \*/ |
| [1364](#L1364) | function wpf\_security\_check() { |
| [1365](#L1365) | $roles        = array(); |
| [1366](#L1366) | $user         = wp\_get\_current\_user(); |
| [1367](#L1367) | $user\_details = ( array )$user->data; |
| [1368](#L1368) | $roles        = ( array )$user->roles; |
| [1369](#L1369) | $roles        = array\_values( $roles ); |
| [1370](#L1370) | if ( ! check\_ajax\_referer( 'wpfeedback-script-nonce', 'wpf\_nonce' ) ) { |
| [1371](#L1371) | echo 'Invalid security token sent.'; |
| [1372](#L1372) | wp\_die(); |
| [1373](#L1373) | } else { |
| [1374](#L1374) | $selected\_roles = get\_site\_data\_by\_key( 'wpf\_selcted\_role' ); |
| [1375](#L1375) | $selected\_roles = explode( ',', $selected\_roles ); |
| [1376](#L1376) | if ( ! in\_array( "administrator", $selected\_roles ) ) { |
| [1377](#L1377) | array\_push( $selected\_roles, "administrator" ); |
| [1378](#L1378) | } |
| [1379](#L1379) | $wpf\_allow\_guest = get\_site\_data\_by\_key( 'wpf\_allow\_guest' ); |
| [1380](#L1380) | // Allow user if used Share version 2 by Pratap |
| [1381](#L1381) | if ( isset( $\_COOKIE['wordpress\_avc\_allow\_guest'] ) ) { |
| [1382](#L1382) | $wpf\_allow\_guest = 'yes'; |
| [1383](#L1383) | } |
| [1384](#L1384) | if ( isset( $\_COOKIE['wordpress\_avc\_guest'] ) ) { |
| [1385](#L1385) | $wpf\_allow\_guest = 'yes'; |
| [1386](#L1386) | } |
| [1387](#L1387) | if ( $wpf\_allow\_guest == 'yes' ) { |
| [1388](#L1388) | $selected\_roles[] = 'Guest'; |
| [1389](#L1389) | $roles[]          = 'Guest'; |
| [1390](#L1390) | } |
| [1391](#L1391) | if ( empty( array\_intersect( $roles, $selected\_roles ) ) ) { |
| [1392](#L1392) | echo 'Invalid user.'; |
| [1393](#L1393) | wp\_die(); |
| [1394](#L1394) | } |
| [1395](#L1395) | } |
| [1396](#L1396) | } |
| [1397](#L1397) | add\_filter( 'get\_comment\_text', 'make\_clickable', 99 ); |
| [1398](#L1398) |  |
| [1399](#L1399) | /\* |
| [1400](#L1400) | \* This function is to get the listing of status and priority for the sidebar filters. |
| [1401](#L1401) | \* |
| [1402](#L1402) | \* @input String |
| [1403](#L1403) | \* @return String |
| [1404](#L1404) | \*/ |
| [1405](#L1405) | if ( ! function\_exists( 'wp\_feedback\_get\_texonomy\_filter' ) ) { |
| [1406](#L1406) | function wp\_feedback\_get\_texonomy\_filter( $my\_term ) { |
| [1407](#L1407) | $output         = ''; |
| [1408](#L1408) | $filter\_data = get\_option( 'filter\_data' ); |
| [1409](#L1409) | $filter\_data\_db = $filter\_data[$my\_term]; |
| [1410](#L1410) |  |
| [1411](#L1411) | if ( isset( $filter\_data\_db ) && ! empty( $filter\_data\_db ) ) { |
| [1412](#L1412) | $output .=  '<ul class="wpf\_filter\_checkbox" id="wpf\_sidebar\_filter\_' . $my\_term . '">'; |
| [1413](#L1413) | foreach ( $filter\_data\_db as $term ) { |
| [1414](#L1414) | if ( $term['label'] == 'In Progress' ) { |
| [1415](#L1415) | $term['label'] = 'In Prog'; |
| [1416](#L1416) | } elseif ( $term['label'] == 'Pending Review' ) { |
| [1417](#L1417) | $term['label'] = 'Pending'; |
| [1418](#L1418) | } else { |
| [1419](#L1419) | $term['label'] = $term['label']; |
| [1420](#L1420) | } |
| [1421](#L1421) | $output .= '<li><input type="checkbox" name="wpf\_filter\_' . $my\_term . '" value="' . $term['value'] . '" class="wp\_feedback\_task wpf\_checkbox" id="wpf\_sidebar\_filter\_' . $term['value'] . '" /><label for="wpf\_sidebar\_filter\_' . $term['value'] . '" class="wpf\_checkbox\_label">' . \_\_( $term['label'], 'atarim-visual-collaboration' ) . '</label></li>'; |
| [1422](#L1422) | } |
| [1423](#L1423) | $output .= '</ul><a class="wpf\_sidebar\_filter\_reset\_' . $my\_term . '" href="javascript:void(0)">'. \_\_( 'Reset', 'atarim-visual-collaboration' ) . '</a>'; |
| [1424](#L1424) | return $output; |
| [1425](#L1425) | } |
| [1426](#L1426) | } |
| [1427](#L1427) | } |
| [1428](#L1428) |  |
| [1429](#L1429) | /\* |
| [1430](#L1430) | \* This function is used to encrypt and decrypt the license key. |
| [1431](#L1431) | \* |
| [1432](#L1432) | \* @input String, String |
| [1433](#L1433) | \* @return String |
| [1434](#L1434) | \*/ |
| [1435](#L1435) | function wpf\_crypt\_key( $string, $action = 'e' ) { |
| [1436](#L1436) | if ( strlen( $string ) == 32 ) { |
| [1437](#L1437) | return $string; |
| [1438](#L1438) | } |
| [1439](#L1439) | $wpf\_decr\_key      = get\_option( 'wpf\_decr\_key' ); |
| [1440](#L1440) | $wpf\_decr\_checksum = get\_option( 'wpf\_decr\_checksum' ); |
| [1441](#L1441) | $output            = false; |
| [1442](#L1442) | $encrypt\_method    = "AES-256-CBC"; |
| [1443](#L1443) | $key               = hash( 'sha256', $wpf\_decr\_key ); |
| [1444](#L1444) | $iv                = substr( hash( 'sha256', $wpf\_decr\_checksum ), 0, 16 ); |
| [1445](#L1445) |  |
| [1446](#L1446) | if ( $action == 'e' ) { |
| [1447](#L1447) | $output = base64\_encode( openssl\_encrypt( $string, $encrypt\_method, $key, 0, $iv ) ); |
| [1448](#L1448) | } elseif ( $action == 'd' ) { |
| [1449](#L1449) | $output = openssl\_decrypt( base64\_decode( $string ), $encrypt\_method, $key, 0, $iv ); |
| [1450](#L1450) | update\_option( 'wpf\_license\_key', $output, 'no' ); |
| [1451](#L1451) | } |
| [1452](#L1452) | return $output; |
| [1453](#L1453) | } |
| [1454](#L1454) |  |
| [1455](#L1455) | /\*========WPF Login Form========\*/ |
| [1456](#L1456) | /\* |
| [1457](#L1457) | \* This function is used to get the login form. |
| [1458](#L1458) | \* |
| [1459](#L1459) | \* @input NULL |
| [1460](#L1460) | \* @return String |
| [1461](#L1461) | \*/ |
| [1462](#L1462) | function wpf\_login\_form() { |
| [1463](#L1463) | $output      = ''; |
| [1464](#L1464) | $wpf\_enabled = get\_site\_data\_by\_key( 'enabled\_wpfeedback' ); |
| [1465](#L1465) | if ( ! is\_user\_logged\_in() && $wpf\_enabled == 'yes' ) { |
| [1466](#L1466) | $output = '<div id="login\_form\_content"> |
| [1467](#L1467) | <p> |
| [1468](#L1468) | <b>Dive straight into the feedback!</b></br> |
| [1469](#L1469) | Login below and you can start commenting using your own user instantly |
| [1470](#L1470) | </p> |
| [1471](#L1471) | <form id="wpf\_login" method="post"> |
| [1472](#L1472) | <div class="wpf\_user"> |
| [1473](#L1473) | <label for="username"></label> |
| [1474](#L1474) | <input id="username" placeholder="Username OR Email Address" type="text" name="username"> |
| [1475](#L1475) | </div> |
| [1476](#L1476) | <div class="wpf\_password"> |
| [1477](#L1477) | <label for="password"></label> |
| [1478](#L1478) | <input id="password" placeholder="Password" type="password" name="password"> |
| [1479](#L1479) | </div>' |
| [1480](#L1480) | . wp\_nonce\_field( 'wpfeedback-script-nonce', 'wpf\_security', true, false ) . |
| [1481](#L1481) | '<input class="wpf\_submit\_button" type="submit" value="Login and start commenting" name="submit"> |
| [1482](#L1482) | <p class="wpf\_status"></p> |
| [1483](#L1483) | </form> |
| [1484](#L1484) | </div>'; |
| [1485](#L1485) | $checkinguser    = \_\_( 'Sending user info, please wait...', 'atarim-visual-collaboration' ); |
| [1486](#L1486) | $wrongcredential = \_\_( 'Wrong username or password.', 'atarim-visual-collaboration' ); |
| [1487](#L1487) | $loginsuccessful = \_\_( 'Login successful, redirecting...', 'atarim-visual-collaboration' ); |
| [1488](#L1488) | $localize        = '<script>var checkinguser= "' . addslashes( $checkinguser ) . '", wrongcredential= "' . addslashes( $wrongcredential ) . '", loginsuccessful= "' . addslashes( $loginsuccessful ) . '"</script>'; |
| [1489](#L1489) | $output .= $localize; |
| [1490](#L1490) | } |
| [1491](#L1491) | return $output; |
| [1492](#L1492) | } |
| [1493](#L1493) | add\_shortcode( 'wpf\_login\_form', 'wpf\_login\_form' ); |
| [1494](#L1494) |  |
| [1495](#L1495) |  |
| [1496](#L1496) | /\* |
| [1497](#L1497) | \* This function is used to manage the errors generated while logging in from Atarim login modal. |
| [1498](#L1498) | \* |
| [1499](#L1499) | \* @input NULL |
| [1500](#L1500) | \* @return String |
| [1501](#L1501) | \*/ |
| [1502](#L1502) | function wpf\_user\_errors() { |
| [1503](#L1503) | static $wp\_error; // Will hold global variable safely |
| [1504](#L1504) | return isset( $wp\_error ) ? $wp\_error : ( $wp\_error = new WP\_Error( null, null, null ) ); |
| [1505](#L1505) | } |
| [1506](#L1506) |  |
| [1507](#L1507) | /\* |
| [1508](#L1508) | \* This function is used to handle login from the Atarim login modal. |
| [1509](#L1509) | \* |
| [1510](#L1510) | \* @input NULL |
| [1511](#L1511) | \* @return JSON |
| [1512](#L1512) | \*/ |
| [1513](#L1513) | function wpf\_ajax\_login() { |
| [1514](#L1514) | global $wpdb; |
| [1515](#L1515) | // First check the nonce, if it fails the function will break |
| [1516](#L1516) | check\_ajax\_referer( 'wpfeedback-script-nonce', 'wpf\_security' ); |
| [1517](#L1517) |  |
| [1518](#L1518) | // Nonce is checked, get the POST data and sign user on |
| [1519](#L1519) | $info                  = array(); |
| [1520](#L1520) | $info['user\_login']    = sanitize\_text\_field( $\_POST['username'] ); |
| [1521](#L1521) | $info['user\_password'] = sanitize\_text\_field( $\_POST['password'] ); |
| [1522](#L1522) | $info['remember']      = true; |
| [1523](#L1523) | $user\_name             = sanitize\_text\_field( $\_POST['username'] ); |
| [1524](#L1524) | $user\_login            = ''; |
| [1525](#L1525) | $user                  = ''; |
| [1526](#L1526) |  |
| [1527](#L1527) | $resultsap = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}users WHERE user\_login = %s OR user\_email = %s limit 1", $user\_name, $user\_name ) , ARRAY\_A ); |
| [1528](#L1528) | if ( $resultsap ) { |
| [1529](#L1529) | $user\_login = isset( $resultsap[0]['user\_login'] ) ? $resultsap[0]['user\_login'] : ""; |
| [1530](#L1530) | $user = get\_user\_by( 'login', $user\_login ); |
| [1531](#L1531) | } |
| [1532](#L1532) | if ( ! $user ) { |
| [1533](#L1533) | // if the user name doesn't exist |
| [1534](#L1534) | wpf\_user\_errors()->add( 'empty\_username', \_\_( 'Invalid username' ) ); |
| [1535](#L1535) | } |
| [1536](#L1536) |  |
| [1537](#L1537) | if ( ! isset( $\_POST['password'] ) || $\_POST['password'] == '' ) { |
| [1538](#L1538) | // if no password was entered |
| [1539](#L1539) | wpf\_user\_errors()->add( 'empty\_password', \_\_( 'Please enter a password' ) ); |
| [1540](#L1540) | } |
| [1541](#L1541) |  |
| [1542](#L1542) | // check the user's login with their password |
| [1543](#L1543) |  |
| [1544](#L1544) | if ( ! empty( $user ) && ! wp\_check\_password( $\_POST['password'], $user->user\_pass, $user->ID ) ) { |
| [1545](#L1545) | // if the password is incorrect for the specified user |
| [1546](#L1546) | wpf\_user\_errors()->add( 'empty\_password', \_\_( 'Incorrect password' ) ); |
| [1547](#L1547) | } |
| [1548](#L1548) |  |
| [1549](#L1549) | // retrieve all error messages |
| [1550](#L1550) | $errors = wpf\_user\_errors()->get\_error\_messages(); |
| [1551](#L1551) | if ( ! empty( $errors ) ) { |
| [1552](#L1552) | echo wp\_json\_encode( array( 'loggedin' => false ) ); |
| [1553](#L1553) | } else { |
| [1554](#L1554) | wp\_set\_auth\_cookie( $user->ID, true ); |
| [1555](#L1555) | wp\_set\_current\_user( $user->ID, $\_POST['username'] ); |
| [1556](#L1556) | echo wp\_json\_encode( array( 'loggedin' => true ) ); |
| [1557](#L1557) | } |
| [1558](#L1558) | die(); |
| [1559](#L1559) | } |
| [1560](#L1560) | // Enable the user with no privileges to run ajax\_login() in AJAX |
| [1561](#L1561) | add\_action( 'wp\_ajax\_nopriv\_wpf\_ajaxlogin', 'wpf\_ajax\_login' ); |
| [1562](#L1562) |  |
| [1563](#L1563) | /\* |
| [1564](#L1564) | \* This function is used to start the color picker. |
| [1565](#L1565) | \* |
| [1566](#L1566) | \* @input NULL |
| [1567](#L1567) | \* @return NULL |
| [1568](#L1568) | \*/ |
| [1569](#L1569) | if ( ! ( isset( $\_GET['ct\_builder'] ) ) && ! ( isset( $\_GET['ct\_inner'] ) ) ) { |
| [1570](#L1570) | function wpf\_enqueue\_color\_picker( $hook\_suffix ) { |
| [1571](#L1571) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [1572](#L1572) | if ( ! ( isset( $\_GET['et\_tb'] ) ) && ! ( isset( $\_GET['et\_fb'] ) ) ) { |
| [1573](#L1573) | wp\_enqueue\_script( 'iris', admin\_url( 'js/iris.min.js' ), array( 'jquery-ui-draggable', 'jquery-ui-slider', 'jquery-touch-punch' ), WPF\_VERSION, true ); |
| [1574](#L1574) | } |
| [1575](#L1575) | } |
| [1576](#L1576) | add\_action( 'wp\_enqueue\_scripts', 'wpf\_enqueue\_color\_picker' ); |
| [1577](#L1577) | } |
| [1578](#L1578) |  |
| [1579](#L1579) | /\* |
| [1580](#L1580) | \* This function is used to check if the caching plugin is active on the website and deregister the Atarim CSS and JS if found. |
| [1581](#L1581) | \* |
| [1582](#L1582) | \* @input NULL |
| [1583](#L1583) | \* @return NULL |
| [1584](#L1584) | \*/ |
| [1585](#L1585) | function wpf\_check\_for\_caching\_plugin() { |
| [1586](#L1586) | if ( is\_plugin\_active( 'wp-rocket/wp-rocket.php' ) ) { |
| [1587](#L1587) | $wp\_rocket\_settings                  = get\_option( 'wp\_rocket\_settings' ); |
| [1588](#L1588) | $wp\_rocket\_settings['exclude\_css'][] = plugins\_url() . '/atarim-client-interface-plugin/css/(.\*).css'; |
| [1589](#L1589) | $wp\_rocket\_settings['exclude\_js'][]  = plugins\_url() . '/atarim-client-interface-plugin/js/(.\*).js'; |
| [1590](#L1590) | if ( get\_option( 'wpr\_check' ) == "" ) { |
| [1591](#L1591) | update\_option( 'wp\_rocket\_settings', $wp\_rocket\_settings ); |
| [1592](#L1592) | update\_option( 'wpr\_check', 'true' ); |
| [1593](#L1593) | } |
| [1594](#L1594) | } |
| [1595](#L1595) |  |
| [1596](#L1596) | if ( is\_plugin\_active( 'fast-velocity-minify/fvm.php' ) ) { |
| [1597](#L1597) | $wpf\_fvm\_options                = get\_option( 'fastvelocity\_min\_ignorelist' ); |
| [1598](#L1598) | $wpf\_update\_fastvelocity\_option = get\_option( 'wpf\_update\_fastvelocity\_option' ); |
| [1599](#L1599) | $wpf\_fvm\_options                = explode( PHP\_EOL, $wpf\_fvm\_options ); |
| [1600](#L1600) | array\_push( $wpf\_fvm\_options, '/atarim-client-interface-plugin/' ); |
| [1601](#L1601) | if ( $wpf\_update\_fastvelocity\_option != 'yes' ) { |
| [1602](#L1602) | update\_option( 'wpf\_update\_fastvelocity\_option', 'yes','no' ); |
| [1603](#L1603) | update\_option( 'fastvelocity\_min\_ignorelist', implode( PHP\_EOL, $wpf\_fvm\_options ) ); |
| [1604](#L1604) | } |
| [1605](#L1605) | } |
| [1606](#L1606) | if ( is\_plugin\_active( 'breeze/breeze.php' ) ) { |
| [1607](#L1607) | $get\_breeze\_advanced\_settings                     = get\_option( 'wpf\_update\_breeze\_option' ); |
| [1608](#L1608) | $breeze\_advanced\_settings                         = get\_option( 'breeze\_advanced\_settings' ); |
| [1609](#L1609) | $breeze\_advanced\_settings['breeze-exclude-css'][] = '/wp-content/plugins/atarim-client-interface-plugin/css/(.\*).css'; |
| [1610](#L1610) | $breeze\_advanced\_settings['breeze-exclude-js'][]  = '/wp-content/plugins/atarim-client-interface-plugin/js/(.\*).js'; |
| [1611](#L1611) | if ( $get\_breeze\_advanced\_settings != 'yes' ) { |
| [1612](#L1612) | update\_option( 'breeze\_advanced\_settings', $breeze\_advanced\_settings ); |
| [1613](#L1613) | update\_option( 'wpf\_update\_breeze\_option', 'yes','no' ); |
| [1614](#L1614) | } |
| [1615](#L1615) | } |
| [1616](#L1616) | if ( defined( 'WPFC\_WP\_PLUGIN\_DIR' ) ) { |
| [1617](#L1617) | $rules\_std          = array(); |
| [1618](#L1618) | $new\_rule1          = new stdClass; |
| [1619](#L1619) | $new\_rule2          = new stdClass; |
| [1620](#L1620) | $new\_rule1->prefix  = "contain"; |
| [1621](#L1621) | $new\_rule1->content = "wp-content/plugins/atarim-client-interface-plugin/css"; |
| [1622](#L1622) | $new\_rule1->type    = "css"; |
| [1623](#L1623) | $new\_rule2->prefix  = "contain"; |
| [1624](#L1624) | $new\_rule2->content = "wp-content/plugins/atarim-client-interface-plugin/js"; |
| [1625](#L1625) | $new\_rule2->type    = "js"; |
| [1626](#L1626) |  |
| [1627](#L1627) | $wpfeedback\_WpFastestCache\_save = get\_option( "wpf\_WpFastestCache\_option" ); |
| [1628](#L1628) | if ( $wpfeedback\_WpFastestCache\_save != 'true' ) { |
| [1629](#L1629) | $get\_rules\_json = get\_option( "WpFastestCacheExclude" ); |
| [1630](#L1630) | if ( $get\_rules\_json === false ) { |
| [1631](#L1631) | array\_push( $rules\_std, $new\_rule1 ); |
| [1632](#L1632) | array\_push( $rules\_std, $new\_rule2 ); |
| [1633](#L1633) | update\_option( "WpFastestCacheExclude", wp\_json\_encode( $rules\_std ), "yes" ); |
| [1634](#L1634) | update\_option( "wpf\_WpFastestCache\_option", 'true', "no" ); |
| [1635](#L1635) | } else { |
| [1636](#L1636) | $rules\_std = json\_decode( $get\_rules\_json ); |
| [1637](#L1637) | if ( ! is\_array( $rules\_std ) ) { |
| [1638](#L1638) | $rules\_std = array(); |
| [1639](#L1639) | } |
| [1640](#L1640) | array\_push( $rules\_std, $new\_rule1 ); |
| [1641](#L1641) | array\_push( $rules\_std, $new\_rule2 ); |
| [1642](#L1642) | update\_option( "WpFastestCacheExclude", wp\_json\_encode( $rules\_std ), "yes" ); |
| [1643](#L1643) | update\_option( "wpf\_WpFastestCache\_option", 'true', "no" ); |
| [1644](#L1644) | } |
| [1645](#L1645) | } |
| [1646](#L1646) | } |
| [1647](#L1647) | } |
| [1648](#L1648) | add\_action( 'admin\_init', 'wpf\_check\_for\_caching\_plugin' ); |
| [1649](#L1649) |  |
| [1650](#L1650) | /\* |
| [1651](#L1651) | \* This function is used create the options for the bulk updates of status and priority. |
| [1652](#L1652) | \* |
| [1653](#L1653) | \* @input String |
| [1654](#L1654) | \* @return String |
| [1655](#L1655) | \*/ |
| [1656](#L1656) | if ( ! function\_exists( 'wpf\_bulk\_update\_get\_texonomy\_selectbox' ) ) { |
| [1657](#L1657) | function wpf\_bulk\_update\_get\_texonomy\_selectbox( $my\_term ) { |
| [1658](#L1658) | $filter\_data = get\_option( 'filter\_data' ); |
| [1659](#L1659) | $filter\_data\_db = $filter\_data[$my\_term]; |
| [1660](#L1660) | if ( isset( $filter\_data\_db ) && ! empty( $filter\_data\_db ) ) { |
| [1661](#L1661) | echo '<select id="task\_' . $my\_term . '\_attr" ><option name="' . $my\_term . '" value="" class="wpf\_task" id="wpf\_critical">'. \_\_( "Select Option", 'atarim-visual-collaboration' ) . '</option>'; |
| [1662](#L1662) | foreach ( $filter\_data\_db as $term ) { |
| [1663](#L1663) | if ( $term['label'] == 'In Progress' ) { |
| [1664](#L1664) | $term['label'] = 'In Prog'; |
| [1665](#L1665) | } elseif ( $term['label'] == 'Pending Review' ) { |
| [1666](#L1666) | $term['label'] = 'Pending'; |
| [1667](#L1667) | } else { |
| [1668](#L1668) | $term['label'] = $term['label']; |
| [1669](#L1669) | } |
| [1670](#L1670) | echo '<option name="' . $my\_term . '" value="' . $term['value'] . '" class="wpf\_task" id="wpf\_' . $term['value'] . '"/>' . \_\_( $term['label'], 'atarim-visual-collaboration' ) . '</option>'; |
| [1671](#L1671) | } |
| [1672](#L1672) | echo '</select>'; |
| [1673](#L1673) | } |
| [1674](#L1674) | } |
| [1675](#L1675) | } |
| [1676](#L1676) |  |
| [1677](#L1677) | /\* |
| [1678](#L1678) | \* function is used to generate |
| [1679](#L1679) | \* bottom task panel |
| [1680](#L1680) | \*/ |
| [1681](#L1681) | function generate\_bottom\_part\_html() { |
| [1682](#L1682) | global $wpdb, $wp\_query, $post; |
| [1683](#L1683) | global $wpf\_task\_status\_filter\_btn, $wpf\_task\_priority\_filter\_btn; |
| [1684](#L1684) | $current\_page\_id = ''; |
| [1685](#L1685) | if ( is\_feature\_enabled( 'bottom\_bar\_enabled' ) ) { |
| [1686](#L1686) | if ( is\_admin() ) { |
| [1687](#L1687) | $current\_page\_id = get\_the\_ID(); |
| [1688](#L1688) | } |
| [1689](#L1689) | if ( $current\_page\_id == '' ) { |
| [1690](#L1690) | if ( isset( $wp\_query->post->ID ) ) { |
| [1691](#L1691) | $current\_page\_id = $wp\_query->post->ID; |
| [1692](#L1692) | } |
| [1693](#L1693) | } |
| [1694](#L1694) |  |
| [1695](#L1695) | $current\_user           = wp\_get\_current\_user(); |
| [1696](#L1696) | $wpf\_user\_name          = $current\_user->display\_name; |
| [1697](#L1697) | $wpf\_user\_email         = $current\_user->user\_email; |
| [1698](#L1698) | $url                    = WPF\_CRM\_API . 'wp-api/page/is-approved'; |
| [1699](#L1699) | $sendarr                = array(); |
| [1700](#L1700) | $sendarr["wpf\_site\_id"] = get\_option( 'wpf\_site\_id' ); |
| [1701](#L1701) | $sendarr["page\_id"]     = $current\_page\_id; |
| [1702](#L1702) | $sendtocloud            = wp\_json\_encode( $sendarr ); |
| [1703](#L1703) | $response               = wpf\_send\_remote\_post( $url, $sendtocloud ); |
| [1704](#L1704) | $is\_approved            = 0; |
| [1705](#L1705) | $data                   = []; |
| [1706](#L1706) |  |
| [1707](#L1707) | if ( isset( $response['status'] ) && $response['status'] ) { |
| [1708](#L1708) | $is\_approved = 1; |
| [1709](#L1709) | } |
| [1710](#L1710) |  |
| [1711](#L1711) | $currnet\_user\_information = wpf\_get\_current\_user\_information(); |
| [1712](#L1712) | $current\_role             = $currnet\_user\_information['role']; |
| [1713](#L1713) | $current\_user\_name        = ( ! empty( $currnet\_user\_information['first\_name'] ) ) ? $currnet\_user\_information['first\_name'] : $currnet\_user\_information['display\_name']; |
| [1714](#L1714) | $current\_user\_id          = $currnet\_user\_information['user\_id']; |
| [1715](#L1715) |  |
| [1716](#L1716) | if ( $current\_user\_name == 'Guest' ) { |
| [1717](#L1717) | $wpf\_current\_role = 'guest'; |
| [1718](#L1718) | } else { |
| [1719](#L1719) | $wpf\_current\_role = wpf\_user\_type(); |
| [1720](#L1720) | } |
| [1721](#L1721) | $current\_user\_name = addslashes( $current\_user\_name ); |
| [1722](#L1722) | $wpf\_powered\_class = '\_blank'; |
| [1723](#L1723) | $wpf\_powered\_by    = get\_site\_data\_by\_key( 'wpfeedback\_powered\_by' ); |
| [1724](#L1724) | $wpf\_powerbylink   = WPF\_APP\_SITE\_URL; |
| [1725](#L1725) | $wpf\_powerbylogo   = get\_wpf\_logo(); |
| [1726](#L1726) | $wpf\_powerbyicon   = get\_wpf\_favicon(); |
| [1727](#L1727) | $inbox\_link        = WPF\_APP\_SITE\_URL . '/tasks?website=' . $sendarr["wpf\_site\_id"]; |
| [1728](#L1728) | if ( $wpf\_powered\_by == 'yes' ) { |
| [1729](#L1729) | $wpf\_powered\_class = '\_self'; |
| [1730](#L1730) | $wpf\_powered\_link  = get\_site\_data\_by\_key( 'wpf\_powered\_link' ); |
| [1731](#L1731) | if ( $wpf\_powered\_link != '' ) { |
| [1732](#L1732) | $wpf\_powerbylink   = esc\_html( $wpf\_powered\_link ); |
| [1733](#L1733) | $wpf\_powered\_class = '\_blank'; |
| [1734](#L1734) | } else { |
| [1735](#L1735) | $wpf\_powerbylink = "javascript:void(0)"; |
| [1736](#L1736) | } |
| [1737](#L1737) | } |
| [1738](#L1738) |  |
| [1739](#L1739) | $wpf\_show\_front\_stikers = get\_site\_data\_by\_key( 'wpf\_show\_front\_stikers' ); |
| [1740](#L1740) |  |
| [1741](#L1741) | /\* =====Start filter sidebar HTML Structure==== \*/ |
| [1742](#L1742) | if ( $wpf\_show\_front\_stikers == 'yes' ) { |
| [1743](#L1743) | $checkbox\_checked = "checked"; |
| [1744](#L1744) | } else { |
| [1745](#L1745) | $checkbox\_checked = ""; |
| [1746](#L1746) | } |
| [1747](#L1747) |  |
| [1748](#L1748) | $wpf\_current\_page\_url = get\_permalink() . '?wpf\_login=1'; |
| [1749](#L1749) |  |
| [1750](#L1750) | $inbox\_link\_html = '<a class="wpf\_inbox\_link\_wrapper" href="' . $inbox\_link . '" target="\_blank"> |
| [1751](#L1751) | <img src="' . WPF\_PLUGIN\_URL . 'images/app-project.svg" alt="link to inbox" > |
| [1752](#L1752) | </a>'; |
| [1753](#L1753) |  |
| [1754](#L1754) | if ( $is\_approved == 1 ) { |
| [1755](#L1755) | $btn\_title         = \_\_( "Approved", 'atarim-visual-collaboration' ); |
| [1756](#L1756) | $btn\_approve\_class = ""; |
| [1757](#L1757) | } else { |
| [1758](#L1758) | $btn\_title         = \_\_( "Approve Page", 'atarim-visual-collaboration' ); |
| [1759](#L1759) | $btn\_approve\_class = "wpf\_not\_approved"; |
| [1760](#L1760) | } |
| [1761](#L1761) |  |
| [1762](#L1762) | $approve\_btn = '<button class="wpf\_green\_btn wpf\_btn\_hover approve-page ' . $btn\_approve\_class . '" id="open\_approve\_modal" title="' . \_\_( "Approve Page", 'atarim-visual-collaboration' ) . '" data-is-approve="' . $is\_approved . '">' . get\_wpf\_right\_icon() . '<span>' . $btn\_title . '</span> </button>'; |
| [1763](#L1763) | $responsive\_btn = ''; |
| [1764](#L1764) | if ( !is\_admin() ) { |
| [1765](#L1765) | $responsive\_btn = '<div class="wpf\_responsive\_icons\_bar wpf\_btn\_hover"> |
| [1766](#L1766) | <img src="' . WPF\_PLUGIN\_URL . 'images/responsive.svg" alt="responsive box"> |
| [1767](#L1767) | <div class="wpf\_responsove\_options"> |
| [1768](#L1768) | <div class="wpf\_desktop\_view"><img src="' . WPF\_PLUGIN\_URL . 'images/desktop.svg" alt="desktop icon"><span>Desktop</span></div> |
| [1769](#L1769) | <div class="wpf\_tab\_view wpf\_responsive\_tablet"><img src="' . WPF\_PLUGIN\_URL . 'images/tablet.svg" alt="tablate icon"><span>Tablet</span></div> |
| [1770](#L1770) | <div class="wpf\_mobile\_view wpf\_responsive\_mobile"><img src="' . WPF\_PLUGIN\_URL . 'images/mobile.svg" alt="mobile icon"><span>Mobile</span></div> |
| [1771](#L1771) | </div> |
| [1772](#L1772) | </div>'; |
| [1773](#L1773) | } |
| [1774](#L1774) |  |
| [1775](#L1775) | if ( is\_admin() == 1 ) { |
| [1776](#L1776) | $approve\_btn = ""; |
| [1777](#L1777) | } |
| [1778](#L1778) |  |
| [1779](#L1779) | $bottom\_panel\_db     = get\_option( 'bottom\_panel', 1 ); |
| [1780](#L1780) | $bottom\_active\_class = 'active'; |
| [1781](#L1781) | $agency\_menu\_item    = ''; |
| [1782](#L1782) | if ( $wpf\_current\_role == 'advisor' || ( $wpf\_current\_role == '' && current\_user\_can( 'administrator' ) ) ) { |
| [1783](#L1783) | $agency\_menu\_item = '<li class="pro"> <a href="' . WPF\_APP\_SITE\_URL . '/login" target="\_blank" title="' . \_\_( "Atarim Dashboard", 'atarim-visual-collaboration' ) . '">' . get\_wpf\_pro\_icon() . '<span>' . \_\_( "Agency", 'atarim-visual-collaboration' ) . '</span> </a></li>'; |
| [1784](#L1784) | } |
| [1785](#L1785) | if ( ( isset( $bottom\_panel\_db ) && $bottom\_panel\_db == '0' ) ) { |
| [1786](#L1786) | $bottom\_active\_class = ''; |
| [1787](#L1787) | } |
| [1788](#L1788) |  |
| [1789](#L1789) | $milestone = '<div id="wpf\_site\_milestone"></div><div class="wpf\_list wpf\_hide" id="wpf\_site\_milestone\_wpf\_list"><div class="wpf\_loader wpf\_loader\_2 wpf\_hide"></div></div>'; |
| [1790](#L1790) |  |
| [1791](#L1791) | // Share version 2 popup structure by Pratap. |
| [1792](#L1792) | $share\_popup = ''; |
| [1793](#L1793) | if( current\_user\_can( 'administrator' ) ) { |
| [1794](#L1794) | $current\_page      = ''; |
| [1795](#L1795) | $page\_token\_url    = ''; |
| [1796](#L1796) | $current\_login\_url = ''; |
| [1797](#L1797) | if ( is\_admin() ) { |
| [1798](#L1798) | $screen = get\_current\_screen(); |
| [1799](#L1799) | if ( $screen -> id == 'dashboard' ) { |
| [1800](#L1800) | $current\_page = admin\_url(); |
| [1801](#L1801) | } else { |
| [1802](#L1802) | $current\_page = admin\_url( basename( $\_SERVER['REQUEST\_URI'] ) ); |
| [1803](#L1803) | } |
| [1804](#L1804) | /\* |
| [1805](#L1805) | \* Wordpress cannot allow accessing admin panel without login due to which guest access is not possible on admin side |
| [1806](#L1806) | \* Hence we set the frontend url in the invitation link |
| [1807](#L1807) | \*/ |
| [1808](#L1808) | $current\_page = get\_site\_url(); |
| [1809](#L1809) | } else { |
| [1810](#L1810) | global $wp; |
| [1811](#L1811) | $current\_page = add\_query\_arg( $wp->query\_vars, home\_url( $wp->request ) ); |
| [1812](#L1812) | } |
| [1813](#L1813) |  |
| [1814](#L1814) | $current\_page = rtrim( $current\_page, '/' ); |
| [1815](#L1815) | $guest\_token  = 'guest\_token=' . get\_option( 'wpf\_guest\_token' ) . '&action=atarim'; |
| [1816](#L1816) |  |
| [1817](#L1817) | if ( strpos( $current\_page, '?' ) !== false) { |
| [1818](#L1818) | $page\_token\_url    = $current\_page . '&collab\_token='; |
| [1819](#L1819) | $current\_login\_url = $current\_page . '&' . $guest\_token; |
| [1820](#L1820) | } else { |
| [1821](#L1821) | $page\_token\_url = $current\_page . '/?collab\_token='; |
| [1822](#L1822) | $current\_login\_url = $current\_page . '/?' . $guest\_token; |
| [1823](#L1823) | } |
| [1824](#L1824) |  |
| [1825](#L1825) | $site\_title = get\_bloginfo( 'name' ); |
| [1826](#L1826) |  |
| [1827](#L1827) | $args = array( |
| [1828](#L1828) | 'meta\_key' => 'avc\_user\_token', |
| [1829](#L1829) | 'meta\_value' => '', |
| [1830](#L1830) | 'meta\_compare' => '!=' |
| [1831](#L1831) | ); |
| [1832](#L1832) | $user\_query = new WP\_User\_Query( $args ); |
| [1833](#L1833) | $user\_list = $user\_query->get\_results(); |
| [1834](#L1834) | $user\_data = array(); |
| [1835](#L1835) | if ( ! empty( $user\_list ) ) { |
| [1836](#L1836) | foreach ( $user\_list as $user ) { |
| [1837](#L1837) | $user\_info = $user->data; |
| [1838](#L1838) | $user\_data[$user\_info->ID]['id'] = $user\_info->ID; |
| [1839](#L1839) | $user\_data[$user\_info->ID]['email'] = $user\_info->user\_email; |
| [1840](#L1840) | $user\_data[$user\_info->ID]['name'] = $user\_info->display\_name; |
| [1841](#L1841) | $token = get\_user\_meta( $user\_info->ID, 'avc\_user\_token', true ); |
| [1842](#L1842) | $link  = $page\_token\_url . $token; |
| [1843](#L1843) | $user\_data[$user\_info->ID]['link'] = $link . '&action=atarim'; |
| [1844](#L1844) | $user\_initial = substr( $user\_info->user\_email, 0, 2 ); |
| [1845](#L1845) | $user\_data[$user\_info->ID]['initial'] = strtoupper( $user\_initial ); |
| [1846](#L1846) | } |
| [1847](#L1847) | } |
| [1848](#L1848) |  |
| [1849](#L1849) | $share\_popup = '<div class="avc\_invite\_share\_wrapper"> |
| [1850](#L1850) | <div class="avc\_invite\_share\_container"> |
| [1851](#L1851) | <div class="avc\_close\_share\_container"><span>+</span></div> |
| [1852](#L1852) | <div class="avc\_invite\_title">Invite Collaborators</div> |
| [1853](#L1853) | <div class="avc\_invite\_subtitle">Invite clients and stakeholders to collaborate on this project.</div> |
| [1854](#L1854) | <div class="avc\_invite\_container"> |
| [1855](#L1855) | <div class="avc\_invite\_wrapper"> |
| [1856](#L1856) | <div class="avc\_each\_invite"> |
| [1857](#L1857) | <div class="avc\_invite\_fields"> |
| [1858](#L1858) | <input tpye="text" name="invite\_name" class="avc\_invite\_name" placeholder="Full name" > |
| [1859](#L1859) | <input type="email" name="invite\_email" class="avc\_invite\_email" placeholder="Email address" > |
| [1860](#L1860) | </div> |
| [1861](#L1861) | <div class="avc\_add\_remove\_invite"> |
| [1862](#L1862) | <button class="avc\_add\_invite" tabindex="0" type="button"> |
| [1863](#L1863) | <svg class="avc\_add\_inivite\_svg" focusable="false" viewBox="0 0 24 24" aria-hidden="true"> |
| [1864](#L1864) | <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path> |
| [1865](#L1865) | </svg> |
| [1866](#L1866) | </button> |
| [1867](#L1867) | <button class="avc\_remove\_invite" tabindex="0" type="button"> |
| [1868](#L1868) | <svg class="avc\_remove\_inivite\_svg" focusable="false" viewBox="0 0 24 24" aria-hidden="true"> |
| [1869](#L1869) | <path d="M19 13H5v-2h14v2z"></path> |
| [1870](#L1870) | </svg> |
| [1871](#L1871) | </button> |
| [1872](#L1872) | </div> |
| [1873](#L1873) | </div> |
| [1874](#L1874) | </div> |
| [1875](#L1875) | <div id="send\_invite">Invite Users</div> |
| [1876](#L1876) | </div> |
| [1877](#L1877) | <input type="hidden" name="avc\_current\_page" id="avc\_current\_page" value="'. $page\_token\_url .'" > |
| [1878](#L1878) | <input type="hidden" name="avc\_site\_title" id="avc\_site\_title" value="'. $site\_title .'" > |
| [1879](#L1879) | <div class="avc\_shared\_container"> |
| [1880](#L1880) | <div class="avc\_invited\_user\_title">People With Access</div> |
| [1881](#L1881) | <div class="avc\_shared\_user\_list">'; |
| [1882](#L1882) | if ( ! empty( $user\_data ) ) { |
| [1883](#L1883) | $i = 1; |
| [1884](#L1884) | foreach( $user\_data as $data ) { |
| [1885](#L1885) | $share\_popup .= '<div class="avc\_invited\_user"> |
| [1886](#L1886) | <div class="avc\_ivi\_user\_info"> |
| [1887](#L1887) | <div class="avc\_ivi\_user\_img">' . $data["initial"] . '</div> |
| [1888](#L1888) | <div class="avc\_ivi\_user\_name"><span>' . $data["name"] . '</span><br>' . $data["email"] . '</div> |
| [1889](#L1889) | <div class="avc\_user\_share\_action"> |
| [1890](#L1890) | <div class="avc\_share\_button"> |
| [1891](#L1891) | <input type="text" class="avc\_share\_page\_link\_input" id="share\_link\_input'. $i .'" value="' . $data["link"] . '"> |
| [1892](#L1892) | <a href="javascript:void(0);" onclick="avc\_copy\_to\_clipboard(\'share\_link\_input'. $i .'\')" class="avc\_copy\_link\_icon"> |
| [1893](#L1893) | <img src="'.WPF\_PLUGIN\_URL.'/images/link.svg" > <span>Reshare Link</span> |
| [1894](#L1894) | </a> |
| [1895](#L1895) | </div> |
| [1896](#L1896) | <div class="avc\_delete\_ivi\_user" data-id="' . $data["id"] . '"><img src="' . WPF\_PLUGIN\_URL . 'images/delete.svg" alt="delete invitation" ></div> |
| [1897](#L1897) | </div> |
| [1898](#L1898) | </div> |
| [1899](#L1899) | </div>'; |
| [1900](#L1900) | $i++; |
| [1901](#L1901) | } |
| [1902](#L1902) | } else { |
| [1903](#L1903) | echo '<style> |
| [1904](#L1904) | .avc\_shared\_container { |
| [1905](#L1905) | display: none; |
| [1906](#L1906) | } |
| [1907](#L1907) | </style>'; |
| [1908](#L1908) | } |
| [1909](#L1909) | $share\_popup .= '</div> |
| [1910](#L1910) | </div> |
| [1911](#L1911) | <div class="avc\_share\_page\_link"> |
| [1912](#L1912) | <div class="avc\_share\_or">Or Share This Link</div> |
| [1913](#L1913) | <div class="avc\_share\_page\_container"> |
| [1914](#L1914) | <div class="avc\_share\_link\_container"> |
| [1915](#L1915) | <div class="avc\_share\_link">' . $current\_login\_url . '</div> |
| [1916](#L1916) | <input type="text" class="avc\_share\_page\_link\_input" id="share\_link\_input" value="' . $current\_login\_url . '"> |
| [1917](#L1917) | <a href="javascript:void(0);" onclick="avc\_copypagelink\_to\_clipboard(\'share\_link\_input\')" class="avc\_copy\_pagelink">Copy</a> |
| [1918](#L1918) | </div> |
| [1919](#L1919) | </div> |
| [1920](#L1920) | </div> |
| [1921](#L1921) | </div> |
| [1922](#L1922) | <div class="avc\_invite\_error\_container"> |
| [1923](#L1923) | <div class="avc\_invite\_error\_msg1"><div class="avc\_err\_icon"></div>Please add the Full name.</div> |
| [1924](#L1924) | <div class="avc\_invite\_error\_msg2"><div class="avc\_err\_icon"></div>Please add an Email address.</div> |
| [1925](#L1925) | <div class="avc\_invite\_error\_msg3"><div class="avc\_err\_icon"></div>Name must be minimum 3 character long.</div> |
| [1926](#L1926) | <div class="avc\_invite\_error\_msg4"><div class="avc\_err\_icon"></div>Must be a valid Email address.</div> |
| [1927](#L1927) | </div> |
| [1928](#L1928) | <div class="wpf\_loader wpf\_hide"></div> |
| [1929](#L1929) | <div class="avc\_suc\_err\_container"> |
| [1930](#L1930) | <div class="avc\_invite\_success"><div class="avc\_succ\_icon"></div>Invitation has been sent</div> |
| [1931](#L1931) | <div class="avc\_delete\_success"><div class="avc\_succ\_icon"></div>Invitation has been deleted</div> |
| [1932](#L1932) | <div class="avc\_invite\_fail"><div class="avc\_err\_icon"></div>Invitation failed</div> |
| [1933](#L1933) | </div> |
| [1934](#L1934) | <div class="avc\_hidden\_user\_structure"> |
| [1935](#L1935) | <div class="avc\_invited\_user"> |
| [1936](#L1936) | <div class="avc\_ivi\_user\_info"> |
| [1937](#L1937) | <div class="avc\_ivi\_user\_img"></div> |
| [1938](#L1938) | <div class="avc\_ivi\_user\_name"></div> |
| [1939](#L1939) | <div class="avc\_user\_share\_action"> |
| [1940](#L1940) | <div class="avc\_share\_button"> |
| [1941](#L1941) | <input type="text" class="avc\_share\_page\_link\_input" id="" value=""> |
| [1942](#L1942) | <a href="javascript:void(0);" onclick="" class="avc\_copy\_link\_icon"> |
| [1943](#L1943) | <img src="'.WPF\_PLUGIN\_URL.'/images/link.svg" > <span>Reshare Link</span> |
| [1944](#L1944) | </a> |
| [1945](#L1945) | </div> |
| [1946](#L1946) | <div class="avc\_delete\_ivi\_user" data-id=""><img src="' . WPF\_PLUGIN\_URL . 'images/delete.svg" alt="delete invitation" ></div> |
| [1947](#L1947) | </div> |
| [1948](#L1948) | </div> |
| [1949](#L1949) | </div> |
| [1950](#L1950) | </div> |
| [1951](#L1951) | </div>'; |
| [1952](#L1952) | } |
| [1953](#L1953) | // share popup structure ends. |
| [1954](#L1954) |  |
| [1955](#L1955) | $general\_button = '<a class="wpf\_general\_btn wpf\_comment\_mode\_general\_task wpf\_btn\_hover" id="wpf\_comment\_mode\_general\_task" href="javascript:void(0)"> |
| [1956](#L1956) | <img src="' . WPF\_PLUGIN\_URL . 'images/general.svg" alt="general button icon"> |
| [1957](#L1957) | <span class="wpf\_tooltip">' . \_\_( 'Create a general task not tied to any page element, great for adding documents or engaging in wider project conversations.', 'atarim-visual-collaboration' ) . '</span> |
| [1958](#L1958) | </a>'; |
| [1959](#L1959) | $share\_btn = ''; |
| [1960](#L1960) | if ( is\_user\_logged\_in() ) { |
| [1961](#L1961) | $share\_btn = '<div class="wpf\_share\_btn wpf\_btn\_hover" href="javascript:void(0);"> |
| [1962](#L1962) | <img src="' . WPF\_PLUGIN\_URL . 'images/share.svg" alt="share icon"> |
| [1963](#L1963) | <span>' . \_\_( 'Share', 'atarim-visual-collaboration' ) . '</span> |
| [1964](#L1964) | <span class="wpf\_tooltip">' . \_\_( 'Get everyone on board – stakeholders, clients, and your team – for an exciting visual collaboration journey on this project!', 'atarim-visual-collaboration' ) . '</span> |
| [1965](#L1965) | </div>'; |
| [1966](#L1966) | } |
| [1967](#L1967) |  |
| [1968](#L1968) | $wpfb\_users\_json = do\_shortcode('[wpf\_user\_list\_front]'); |
| [1969](#L1969) | $wpfb\_users      = json\_decode($wpfb\_users\_json, true); |
| [1970](#L1970) | $collab\_user\_html = ''; |
| [1971](#L1971) | if ( ! empty( $wpfb\_users ) ) { |
| [1972](#L1972) | $collab\_user\_html .= '<div class="wpf\_collab\_users\_wrapper"> |
| [1973](#L1973) | <div class="wpf\_collab\_user\_container">'; |
| [1974](#L1974) | foreach( $wpfb\_users as $wpfb\_user ) { |
| [1975](#L1975) | $first\_name = $wpfb\_user['first\_name'] ? $wpfb\_user['first\_name'] : $wpfb\_user['displayname']; |
| [1976](#L1976) | $last\_name = $wpfb\_user['last\_name'] ? ' ' . $wpfb\_user['last\_name'] : ''; |
| [1977](#L1977) | $name = $first\_name . $last\_name; |
| [1978](#L1978) | $collab\_user\_html .= '<div class="wpf\_each\_collab\_user"> |
| [1979](#L1979) | <div class="wpf\_collab\_user\_avatar">' . substr( $name, 0, 2) . '</div> |
| [1980](#L1980) | <div class="wpf\_collab\_user\_name">' . $name . '</div> |
| [1981](#L1981) | </div>'; |
| [1982](#L1982) | } |
| [1983](#L1983) | $collab\_user\_html .= '</div></div>'; |
| [1984](#L1984) | $total\_users = count( $wpfb\_users ); |
| [1985](#L1985) | $collab\_user\_html .= '<div class="wpf\_total\_collab\_users">' . $total\_users . '</div>'; |
| [1986](#L1986) | } |
| [1987](#L1987) |  |
| [1988](#L1988) | $user\_list\_button = '<div class="wpf\_collab\_user\_list"> |
| [1989](#L1989) | <span class="wpf\_current\_user\_name">' . substr( $current\_user\_name, 0, 2) . '</span> |
| [1990](#L1990) | ' . $collab\_user\_html . ' |
| [1991](#L1991) | </div>'; |
| [1992](#L1992) |  |
| [1993](#L1993) | $wpf\_comment = '<span class="wpf\_bc\_text">Browse</span> |
| [1994](#L1994) | <label class="wpf\_bc\_switch"> |
| [1995](#L1995) | <span class="wpf\_bc\_switch\_slider wpf\_bc\_switch\_round active\_browse"></span> |
| [1996](#L1996) | </label> |
| [1997](#L1997) | <span class="wpf\_bc\_text">Comment</span>'; |
| [1998](#L1998) |  |
| [1999](#L1999) | return '<section class="wpf\_bottombar\_section"> <div id="wpf\_bottom\_bar" class="' . $bottom\_active\_class . '"><div class="wpf\_progress\_bar"><div class="red-pb" id="open\_progress"></div><div class="orange-pb" id="inprogress\_progress"></div><div class="yellow-pb" id="pending\_progress"></div><div class="green-pb" id="completed\_progress"></div></div><div id="wpf\_panel" class="wpf\_row"><div class="wpf\_bottom\_left"><div class="footer-logo" title="Logo"><a href="' . $wpf\_powerbylink . '" target="' . $wpf\_powered\_class . '"><img src="' . $wpf\_powerbyicon . '" alt="poweredby" /></a></div>  ' . $inbox\_link\_html . $approve\_btn . $responsive\_btn . $milestone . '</div><div class="wpf\_bottom\_middle">'. $wpf\_comment .'</div><div class="wpf\_bottom\_right">' . $user\_list\_button . $general\_button . $share\_btn . '</div></div><div id="wpf\_enable\_comment" class="wpf\_row" style="display:none;"><div class="wpf\_bottom\_left"><div class="footer-logo" title="Logo"> <img src="' . $wpf\_powerbylogo . '" alt="poweredby"></div> <span class="message">Choose a part of the page to add a message or, click the "General" button for a generic request</span></div><div class="wpf\_bottom\_right">  <a href="javascript:disable\_comment();" id="disable\_comment\_a" class="tasks-btn wpf\_red\_btn" title="' . \_\_( 'Cancel', 'atarim-visual-collaboration' ) . '">' . get\_wpf\_close\_icon() . '<span class="title">' . \_\_( 'Cancel', 'atarim-visual-collaboration' ) . '</span> </a></div></div><div class="wpf\_page\_loader"></div></div></section>'. $share\_popup; |
| [2000](#L2000) | } |
| [2001](#L2001) | } |
| [2002](#L2002) | add\_action( 'wpf\_generate\_bottom\_part\_html', 'generate\_bottom\_part\_html' ); |
| [2003](#L2003) |  |
| [2004](#L2004) | // Upgrade popup by Pratap |
| [2005](#L2005) | function wpf\_upgrade\_plan() { |
| [2006](#L2006) | $wpf\_user\_type      = wpf\_user\_type(); |
| [2007](#L2007) | $enabled\_wpfeedback = wpf\_check\_if\_enable(); |
| [2008](#L2008) | if ( $enabled\_wpfeedback ) { |
| [2009](#L2009) | ?> |
| [2010](#L2010) | <div class="wpf-uf-pop-wrapper" style="display:none"> |
| [2011](#L2011) | <div class="wpf-uf-pop-container"> |
| [2012](#L2012) | <div class="wpf-uf-popup"> |
| [2013](#L2013) | <div class="wpf-uf-close-popup"><i class="gg-close"></i></div> |
| [2014](#L2014) | <div class="wpf-uf-popup-title">Let's Unlock This Feature</div> |
| [2015](#L2015) | <p>Unlock this feature and improve your workflow even further by upgrading your plan.</p> |
| [2016](#L2016) | <div class="wpf-uf-popup-plans"> |
| [2017](#L2017) | <div class="wpf-uf-popup-image"> |
| [2018](#L2018) | <img alt="" src=""> |
| [2019](#L2019) | </div> |
| [2020](#L2020) | <div class="wpf-uf-plan"> |
| [2021](#L2021) | <div class="wpf-uf-plan-title"></div> |
| [2022](#L2022) | <div class="wpf-uf-plan-detail"></div> |
| [2023](#L2023) | <a class="wpf-uf-plan-link" href="#" target="\_blank"><div class="wpf-uf-plan-btn">Upgrade To Unlock</div></a> |
| [2024](#L2024) | </div> |
| [2025](#L2025) | </div> |
| [2026](#L2026) | <?php if ( $wpf\_user\_type = 'advisor' ) { ?> |
| [2027](#L2027) | <div class="wpf-uf-webmaster-notice">\*This is only shown to you as a webmaster, other users will not see this</div> |
| [2028](#L2028) | <?php } else { ?> |
| [2029](#L2029) | <div class="wpf-uf-otheruser-notice">Please contact your webmaster to unlock this feature</div> |
| [2030](#L2030) | <?php } ?> |
| [2031](#L2031) | </div> |
| [2032](#L2032) | </div> |
| [2033](#L2033) | </div> |
| [2034](#L2034) | <?php |
| [2035](#L2035) | } |
| [2036](#L2036) | } |
| [2037](#L2037) | add\_action( 'wp\_footer', 'wpf\_upgrade\_plan' ); |
| [2038](#L2038) | add\_action( 'admin\_footer', 'wpf\_upgrade\_plan' ); |
| [2039](#L2039) |  |
| [2040](#L2040) | // Upgrade popup on license expires by Pratap |
| [2041](#L2041) | function wpf\_subscribe\_plan() { |
| [2042](#L2042) | $wpf\_user\_type      = wpf\_user\_type(); |
| [2043](#L2043) | $enabled\_wpfeedback = wpf\_check\_if\_enable(); |
| [2044](#L2044) | if ( $enabled\_wpfeedback ) { |
| [2045](#L2045) | ?> |
| [2046](#L2046) | <div class="wpf-le-pop-wrapper" style="display:none"> |
| [2047](#L2047) | <div class="wpf-le-pop-container"> |
| [2048](#L2048) | <div class="wpf-le-popup"> |
| [2049](#L2049) | <div class="wpf-le-close-popup"><i class="gg-close"></i></div> |
| [2050](#L2050) | <div class="wpf-le-popup-plans"> |
| [2051](#L2051) | <div class="wpf-le-plan"> |
| [2052](#L2052) | <div class="wpf-le-icon"><img src= "<?php echo WPF\_PLUGIN\_URL; ?>/images/lock.svg" alt="lock image"></div> |
| [2053](#L2053) | <div class="wpf-le-title">Renew or upgrade your subscription</div> |
| [2054](#L2054) | <div class="wpf-le-detail">It looks like your subscription has expired or doesn’t exist, please upgrade your account to unlock this feature.</div> |
| [2055](#L2055) | <a class="wpf-le-plan-link" href="https://atarim.io/pricing" target="\_blank"><div class="wpf-le-plan-btn">Upgrade Now</div></a> |
| [2056](#L2056) | </div> |
| [2057](#L2057) | </div> |
| [2058](#L2058) | </div> |
| [2059](#L2059) | </div> |
| [2060](#L2060) | </div> |
| [2061](#L2061) | <?php |
| [2062](#L2062) | } |
| [2063](#L2063) | } |
| [2064](#L2064) | add\_action( 'wp\_footer', 'wpf\_subscribe\_plan' ); |
| [2065](#L2065) | add\_action( 'admin\_footer', 'wpf\_subscribe\_plan' ); |
| [2066](#L2066) |  |
| [2067](#L2067) | function wpf\_multifile\_upload() { |
| [2068](#L2068) | $wpf\_user\_type      = wpf\_user\_type(); |
| [2069](#L2069) | $enabled\_wpfeedback = wpf\_check\_if\_enable(); |
| [2070](#L2070) | $wpf\_check\_page\_builder\_active = wpf\_check\_page\_builder\_active(); |
| [2071](#L2071) | if ( $enabled\_wpfeedback && $wpf\_check\_page\_builder\_active == 0 ) { |
| [2072](#L2072) | echo '<div class="wpf\_multifile\_wrapper"> |
| [2073](#L2073) | <div class="wpf\_multifile\_container"> |
| [2074](#L2074) | <div class="wpf\_multifile\_box"> |
| [2075](#L2075) | <h2>Upload Files |
| [2076](#L2076) | <span>Drag and drop your files here or click the button to upload your files from your computer</span> |
| [2077](#L2077) | <button class="wpf\_multifile\_close" role="button" tabindex="0"><img src="' . WPF\_PLUGIN\_URL . 'images/cross.svg" ></button> |
| [2078](#L2078) | </h2> |
| [2079](#L2079) | <div class="wpf\_multifile\_form\_container"> |
| [2080](#L2080) | <div class="wpf\_multifile\_form"> |
| [2081](#L2081) | <img src="' . WPF\_PLUGIN\_URL . 'images/multi-file.svg" alt="multi file upload" > |
| [2082](#L2082) | <span>Drag and drop your files</span> |
| [2083](#L2083) | <span>Max Upload: 20 MB</span> |
| [2084](#L2084) | <button class="wpf\_file\_upload\_button"> |
| [2085](#L2085) | <input multiple type="file" name="wpf\_uploadfile\_" id="wpf\_uploadfile\_" data-elemid="" class="wpf\_uploadfile"> |
| [2086](#L2086) | <img src="' . WPF\_PLUGIN\_URL . 'images/upload.svg" > Upload Files</button> |
| [2087](#L2087) | </div> |
| [2088](#L2088) | <div class="wpf\_selectedfile\_list"></div> |
| [2089](#L2089) | <div class="wpf\_multifile\_actions"> |
| [2090](#L2090) | <button class="wpf\_multifile\_cancel">Cancel</button> |
| [2091](#L2091) | <button class="wpf\_multifile\_submit wpf\_multifile\_submit\_disabled">Upload Files</button> |
| [2092](#L2092) | </div> |
| [2093](#L2093) | </div> |
| [2094](#L2094) | </div> |
| [2095](#L2095) | </div> |
| [2096](#L2096) | </div>'; |
| [2097](#L2097) | } |
| [2098](#L2098) | } |
| [2099](#L2099) | add\_action( 'wp\_footer', 'wpf\_multifile\_upload' ); |
| [2100](#L2100) | add\_action( 'admin\_footer', 'wpf\_multifile\_upload' ); |
| [2101](#L2101) |  |
| [2102](#L2102) | function image\_preview() { |
| [2103](#L2103) | $wpf\_user\_type      = wpf\_user\_type(); |
| [2104](#L2104) | $enabled\_wpfeedback = wpf\_check\_if\_enable(); |
| [2105](#L2105) | $wpf\_check\_page\_builder\_active = wpf\_check\_page\_builder\_active(); |
| [2106](#L2106) | if ( $enabled\_wpfeedback && $wpf\_check\_page\_builder\_active == 0 ) { |
| [2107](#L2107) | echo '<div class="wpf\_image\_preview\_wrappper"> |
| [2108](#L2108) | <div class="wpf\_image\_preview\_container"> |
| [2109](#L2109) | <div class="wpf\_image\_preview\_box"> |
| [2110](#L2110) | <span class="wpf\_close\_image\_preview"><img src="' . WPF\_PLUGIN\_URL . 'images/cross.svg" alt="close image preview" ></span> |
| [2111](#L2111) | <div class="wpf\_image\_preview"> |
| [2112](#L2112) | <img src="" alt="image preview" class="wpf\_preview\_image"> |
| [2113](#L2113) | </div> |
| [2114](#L2114) | </div> |
| [2115](#L2115) | </div> |
| [2116](#L2116) | </div>'; |
| [2117](#L2117) | } |
| [2118](#L2118) | } |
| [2119](#L2119) | add\_action( 'wp\_footer', 'image\_preview' ); |
| [2120](#L2120) | add\_action( 'admin\_footer', 'image\_preview' ); |
| [2121](#L2121) |  |
| [2122](#L2122) | /\*\* |
| [2123](#L2123) | \* Get the author name of the tasks |
| [2124](#L2124) | \*/ |
| [2125](#L2125) | function get\_task\_author( $mypost ) { |
| [2126](#L2126) | /\* assign the WP names (first & last name / nickname) if the author is on the site \*/ |
| [2127](#L2127) |  |
| [2128](#L2128) | // by default, we take name that is coming from the API |
| [2129](#L2129) | $author = $mypost['task\_config\_author\_name'] ?? "Guest"; |
| [2130](#L2130) |  |
| [2131](#L2131) | // Task author name for Share version 2 by Pratap. |
| [2132](#L2132) | if ( $mypost['task\_config\_author\_id'] > 0 ) { |
| [2133](#L2133) | $userInfo = get\_userdata( $mypost['task\_config\_author\_id'] ); |
| [2134](#L2134) | if ( ! empty( $userInfo ) ) { |
| [2135](#L2135) | $userr = $userInfo->data; |
| [2136](#L2136) | return $userr->display\_name; |
| [2137](#L2137) | } |
| [2138](#L2138) | } |
| [2139](#L2139) |  |
| [2140](#L2140) | // list all the usere who's roles are allowed to create tasks |
| [2141](#L2141) | $wpf\_front\_users = do\_shortcode( '[wpf\_user\_list\_front]' ); |
| [2142](#L2142) |  |
| [2143](#L2143) | if ( $wpf\_front\_users ) { |
| [2144](#L2144) |  |
| [2145](#L2145) | // convert JSON to array |
| [2146](#L2146) | $wpf\_front\_users\_arr = json\_decode( $wpf\_front\_users, true ); |
| [2147](#L2147) |  |
| [2148](#L2148) | // get the user data by filtering the roles allowed to create tasks |
| [2149](#L2149) | $front\_user\_meta = array\_filter( $wpf\_front\_users\_arr, function( $user ) use( $mypost ) { |
| [2150](#L2150) | return intval( $user['id'] ) === intval( $mypost['task\_config\_author\_id'] ); |
| [2151](#L2151) | } ); |
| [2152](#L2152) |  |
| [2153](#L2153) | // if the user dats found, we will assign the appropriate name |
| [2154](#L2154) | if ( is\_array( $front\_user\_meta ) ) { // if ( !empty( $front\_user\_name ) && is\_array( $front\_user\_meta ) ) |
| [2155](#L2155) |  |
| [2156](#L2156) | // as the filter returns the array with the task's id as key, we only need the data in the array by unpacking |
| [2157](#L2157) | $front\_user\_metas = array\_merge( $front\_user\_meta ); |
| [2158](#L2158) |  |
| [2159](#L2159) | // assign the first and last name if present, nickname otherwise. |
| [2160](#L2160) | return $front\_user\_metas[0]['displayname'] ?? $author; |
| [2161](#L2161) | } |
| [2162](#L2162) | } |
| [2163](#L2163) | return $author; |
| [2164](#L2164) | } |
| [2165](#L2165) |  |
| [2166](#L2166) |  |
| [2167](#L2167) | /\*\* |
| [2168](#L2168) | \* Checks if the feature has enabled by the plan or not |
| [2169](#L2169) | \*/ |
| [2170](#L2170) | function is\_feature\_enabled( $feature\_name ) { |
| [2171](#L2171) | $wpf\_user\_plan = get\_option( 'wpf\_user\_plan', false ); |
| [2172](#L2172) | if ( $wpf\_user\_plan ) { |
| [2173](#L2173) | $wpf\_user\_plan = unserialize( $wpf\_user\_plan ); |
| [2174](#L2174) | } |
| [2175](#L2175) |  |
| [2176](#L2176) | // Enable the feature if the data not in the DB |
| [2177](#L2177) | if ( empty( $wpf\_user\_plan ) ) { |
| [2178](#L2178) | return true; |
| [2179](#L2179) | } |
| [2180](#L2180) | return ( ! empty( $wpf\_user\_plan[$feature\_name] ) && $wpf\_user\_plan[$feature\_name] === 'yes' ); |
| [2181](#L2181) | } |
| [2182](#L2182) |  |
| [2183](#L2183) | /\*\* |
| [2184](#L2184) | \* This function is to add sidebar header |
| [2185](#L2185) | \*/ |
| [2186](#L2186) | function sidebar\_header() { |
| [2187](#L2187) | return '<div class="wpf\_sidebar\_header"> |
| [2188](#L2188) | <div class="top\_tabs"> |
| [2189](#L2189) | <div class="wpf\_sidebar\_top1"> |
| [2190](#L2190) | <div class="wpf\_hide\_sidebar\_wrapper"> |
| [2191](#L2191) | <div class="wpf\_hide\_sidebar"> |
| [2192](#L2192) | <img src="' . WPF\_PLUGIN\_URL . "images/cross.svg" . '"  class="wpf\_hide\_sidebar\_icon" alt="hide sidebar icon" > |
| [2193](#L2193) | </div> |
| [2194](#L2194) | </div> |
| [2195](#L2195) | <div class="wpf\_side\_switch"> |
| [2196](#L2196) | <img src="' . WPF\_PLUGIN\_URL . "images/sidebar-left.svg" . '"  class="wpf\_sidebar\_left" alt="sidebar left" > |
| [2197](#L2197) | </div> |
| [2198](#L2198) | </div> |
| [2199](#L2199) | <div class="wpf\_sidebar\_top2"> |
| [2200](#L2200) | <div class="wpf\_sidebar\_search"> |
| [2201](#L2201) | <img src="' . WPF\_PLUGIN\_URL . "images/search.svg" . '"  class="wpf\_search\_img" alt="search icon" > |
| [2202](#L2202) | </div> |
| [2203](#L2203) | <div class="wpf\_sidebarmenu"> |
| [2204](#L2204) | <img src="' . WPF\_PLUGIN\_URL . "images/sidebarmenu.svg" . '"  class="wpf\_sidebarmenu\_img" alt="sidebar menu" > |
| [2205](#L2205) | <div class="wpf\_sidebar\_submenu"> |
| [2206](#L2206) | <div class="wpf\_tab\_sidebar wpf\_thispage" onclick="openWPFTab(\'wpf\_thispage\')"><span class="wpf\_filter\_check active\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>This Page</div> |
| [2207](#L2207) | <div class="wpf\_tab\_sidebar wpf\_allpages" onclick="openWPFTab(\'wpf\_allpages\')"><span class="wpf\_filter\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>All Pages</div> |
| [2208](#L2208) | <div class="wpf\_tab\_sidebar wpf\_showcomp" onclick="openWPFTab(\'wpf\_showcomp\')"><span class="wpf\_filter\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>Show Complete Tasks</div> |
| [2209](#L2209) | <div class="wpf\_tab\_sidebar wpf\_showint" onclick="openWPFTab(\'wpf\_showint\')"><span class="wpf\_filter\_check active\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>Show Internal Tasks</div> |
| [2210](#L2210) | <div class="wpf\_tab\_sidebar wpf\_bydate" onclick="openWPFTab(\'wpf\_bydate\')"><span class="wpf\_filter\_check active\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>Sort by Date</div> |
| [2211](#L2211) | <div class="wpf\_tab\_sidebar wpf\_byprior" onclick="openWPFTab(\'wpf\_byprior\')"><span class="wpf\_filter\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>Sort by Priority</div> |
| [2212](#L2212) | <div class="wpf\_tab\_sidebar wpf\_bystatus" onclick="openWPFTab(\'wpf\_bystatus\')"><span class="wpf\_filter\_check"><img src="' . WPF\_PLUGIN\_URL . "images/checked.svg" . '" alt="sidebar menu" ></span>Sort by Status</div> |
| [2213](#L2213) | </div> |
| [2214](#L2214) | </div> |
| [2215](#L2215) | </div> |
| [2216](#L2216) | </div> |
| [2217](#L2217) | <div class="wpf\_search\_field"> |
| [2218](#L2218) | <input onkeyup="wp\_feedback\_task\_filter(event, this)" type="text" name="wpf\_search\_title" placeholder="Search" class="wpf\_search\_title" id="wpf\_search\_title"> |
| [2219](#L2219) | </div> |
| [2220](#L2220) | </div>'; |
| [2221](#L2221) | } |
| [2222](#L2222) | /\*\* |
| [2223](#L2223) | \* This function is to add sidebar tabs |
| [2224](#L2224) | \*/ |
| [2225](#L2225) | function sidebar\_tabs() { |
| [2226](#L2226) | return '<div class="wpf\_sidebar\_tabs"> |
| [2227](#L2227) | <div class="wpf\_tab\_wrapper"> |
| [2228](#L2228) | <div class="wpf\_tab\_container"> |
| [2229](#L2229) | <div class="wpf\_task\_tab wpf\_active\_tab">Tasks</div> |
| [2230](#L2230) | <div class="wpf\_page\_tab">Pages</div> |
| [2231](#L2231) | <div class="wpf\_tab\_active"></div> |
| [2232](#L2232) | </div> |
| [2233](#L2233) | </div> |
| [2234](#L2234) | </div>'; |
| [2235](#L2235) | } |
| [2236](#L2236) | /\*\* |
| [2237](#L2237) | \* This function is to add no task found message on sidebar |
| [2238](#L2238) | \*/ |
| [2239](#L2239) | function sidebar\_content() { |
| [2240](#L2240) | global $wp; |
| [2241](#L2241) | return '<div class="wpf\_sidebar\_content"> |
| [2242](#L2242) | <div class="wpf\_no\_task wpf\_hide"> |
| [2243](#L2243) | <div class="wpf\_no\_task\_img"> |
| [2244](#L2244) | <img src="' . WPF\_PLUGIN\_URL . "images/no-task.svg" . '" alt="no task in sidebar" > |
| [2245](#L2245) | </div> |
| [2246](#L2246) | <div class="wpf\_no\_task\_title">Add your comments</div> |
| [2247](#L2247) | <div class="wpf\_no\_task\_desc">Click any part of the page to start collaborating</div> |
| [2248](#L2248) | </div> |
| [2249](#L2249) | <div class="wpf\_sidebar\_loader wpf\_hide"></div> |
| [2250](#L2250) | <div id="wpf\_thispage" class="wpf\_thispage\_tab wpf\_container wpf\_active\_filter"><!--<div class="custom\_today">today</div>--><ul id="wpf\_thispage\_container\_today"></ul><!--<div class="custom\_yesterday">yesterday</div> --> <ul id="wpf\_thispage\_container\_yesterday"></ul><!-- <div class="custom\_Weekly">Weekly</div> --> <ul id="wpf\_thispage\_container\_this\_week"></ul><!-- <div class="custom\_this\_month">This Month</div> --> <ul id="wpf\_thispage\_container\_this\_month"></ul><!-- <div class="custom\_year">This Year</div> --> <ul id="wpf\_thispage\_container\_year"></ul> <!-- <div class="custom\_other">Other</div> --> <ul id="wpf\_thispage\_container\_other"></ul></div> |
| [2251](#L2251) | <div id="wpf\_allpages" class="wpf\_allpages\_tab wpf\_container" style="display:none;"><!--<div class="custom\_today">today</div>--><ul id="wpf\_allpages\_container\_today"></ul><!--<div class="custom\_yesterday">yesterday</div> --> <ul id="wpf\_allpages\_container\_yesterday"></ul><!-- <div class="custom\_Weekly">Weekly</div> --> <ul id="wpf\_allpages\_container\_this\_week"></ul><!-- <div class="custom\_this\_month">This Month</div> --> <ul id="wpf\_allpages\_container\_this\_month"></ul><!-- <div class="custom\_year">This Year</div> --> <ul id="wpf\_allpages\_container\_year"></ul> <!-- <div class="custom\_other">Other</div> --> <ul id="wpf\_allpages\_container\_other"></ul></div> |
| [2252](#L2252) | <div id="wpf\_all\_pages" style="display:none;"> |
| [2253](#L2253) | <div class="wpf\_page\_list"> |
| [2254](#L2254) |  |
| [2255](#L2255) | </div> |
| [2256](#L2256) | <div class="wpf\_add\_page">Add This Page</div> |
| [2257](#L2257) | </div> |
| [2258](#L2258) | <div class="wpf\_loading">Loading...</div> |
| [2259](#L2259) | </div>'; |
| [2260](#L2260) | } |
| [2261](#L2261) |  |
| [2262](#L2262) | function wpf\_launcher() { |
| [2263](#L2263) | $wpf\_powerbyicon = get\_wpf\_favicon(); |
| [2264](#L2264) | return '<div class="wpf\_launch\_comment\_mode"> |
| [2265](#L2265) | <img src="' . $wpf\_powerbyicon . '" alt="poweredby" /> |
| [2266](#L2266) | <div class="wpf\_total\_task\_number"></div> |
| [2267](#L2267) | </div>'; |
| [2268](#L2268) | } |
| [2269](#L2269) |  |
| [2270](#L2270) | function page\_tab\_content( $wpside ) { |
| [2271](#L2271) | $post\_data = array( |
| [2272](#L2272) | 'wpf\_site\_id'  => get\_option( 'wpf\_site\_id' ), |
| [2273](#L2273) | 'wpf\_is\_front' => ( $wpside == 'backend' ) ? false : true , |
| [2274](#L2274) | ); |
| [2275](#L2275) | $args = array( |
| [2276](#L2276) | 'body'        => $post\_data, |
| [2277](#L2277) | 'method'      => 'GET', |
| [2278](#L2278) | 'data\_format' => 'body', |
| [2279](#L2279) | 'timeout'     => 100, |
| [2280](#L2280) | ); |
| [2281](#L2281) | $url = WPF\_CRM\_API . 'wp-api/site/pages'; |
| [2282](#L2282) | $response = wp\_remote\_post( $url, $args ); |
| [2283](#L2283) | $pages\_html = ''; |
| [2284](#L2284) | if( $response['response']['code'] == 200 ) { |
| [2285](#L2285) | if( $response['body'] != '' ) { |
| [2286](#L2286) | $body = json\_decode($response['body']); |
| [2287](#L2287) | $data = $body->data; |
| [2288](#L2288) | $pages = $data->wp\_pages; |
| [2289](#L2289) | if ( ! empty( $pages ) ) { |
| [2290](#L2290) | $pages\_html = get\_all\_pages( $pages ); |
| [2291](#L2291) | } else { |
| [2292](#L2292) | $pages\_html = get\_no\_page\_html(); |
| [2293](#L2293) | } |
| [2294](#L2294) | } |
| [2295](#L2295) | } |
| [2296](#L2296) | return $pages\_html; |
| [2297](#L2297) | } |
| [2298](#L2298) |  |
| [2299](#L2299) | function get\_all\_pages( $pages ) { |
| [2300](#L2300) | $pages\_html = ''; |
| [2301](#L2301) | foreach( $pages as $page ) { |
| [2302](#L2302) | $page\_url = $page->url; |
| [2303](#L2303) | $page\_id = $page->id; |
| [2304](#L2304) | $page\_title = $page->label; |
| [2305](#L2305) | $total\_tasks = $page->total\_tasks; |
| [2306](#L2306) | $alterimg = WPF\_PLUGIN\_URL . 'images/placeholder-image.png'; |
| [2307](#L2307) | $page\_screenshot = image\_exists\_checker( $page->screenshot, $alterimg ); |
| [2308](#L2308) | $is\_approved = $page->is\_approved; |
| [2309](#L2309) | $total\_task\_html = '<div class="wpf\_task\_cout">' . $total\_tasks . '</div>'; |
| [2310](#L2310) | $approved\_class = ''; |
| [2311](#L2311) | $approved\_label = ''; |
| [2312](#L2312) | $pages\_html .= page\_html( $page\_id, $page\_url, $page\_title, $total\_tasks, $is\_approved, $page\_screenshot ); |
| [2313](#L2313) | } |
| [2314](#L2314) | return $pages\_html; |
| [2315](#L2315) | } |
| [2316](#L2316) |  |
| [2317](#L2317) | function page\_html( $page\_id, $page\_url, $page\_title, $total\_tasks, $is\_approved, $page\_screenshot ) { |
| [2318](#L2318) | $total\_task\_html = '<div class="wpf\_task\_cout">' . $total\_tasks . '</div>'; |
| [2319](#L2319) | $approved\_class = ''; |
| [2320](#L2320) | $approved\_label = ''; |
| [2321](#L2321) | $active = ''; |
| [2322](#L2322) | $current\_url = ''; |
| [2323](#L2323) | if ( is\_admin() ) { |
| [2324](#L2324) | $current\_url = site\_url($\_SERVER['REQUEST\_URI']); |
| [2325](#L2325) | } else { |
| [2326](#L2326) | $current\_url = home\_url(add\_query\_arg(array(), $\_SERVER['REQUEST\_URI'])); |
| [2327](#L2327) | } |
| [2328](#L2328) | if ( $current\_url == $page\_url ) { |
| [2329](#L2329) | $active = 'active'; |
| [2330](#L2330) | } |
| [2331](#L2331) | if ( $is\_approved == 1 ) { |
| [2332](#L2332) | $approved\_class = 'approved'; |
| [2333](#L2333) | $approved\_label = '<span class="wpf\_approved\_label">Approved</span>'; |
| [2334](#L2334) | $total\_task\_html = '<img src="' . WPF\_PLUGIN\_URL . "images/approved.svg" . '" alt="page approved icon">'; |
| [2335](#L2335) | } |
| [2336](#L2336) | return '<div class="wpf\_each\_page ' . $active . '" data-page-id="' . $page\_id . '" data-page-url="' . $page\_url . '"> |
| [2337](#L2337) | <div class="wpf\_page\_header"> |
| [2338](#L2338) | <span class="wpf\_page\_title">' . $page\_title . '</span> |
| [2339](#L2339) | <span class="wpf\_page\_task\_total">' . $total\_task\_html . '</span> |
| [2340](#L2340) | <span class="wpf\_delete\_page"><img src="' . WPF\_PLUGIN\_URL . "images/delete.svg" . '" alt="delete icon" class="wpf\_delete\_page\_icon"></span> |
| [2341](#L2341) | </div> |
| [2342](#L2342) | <div class="wpf\_page\_content '. $approved\_class .'" style="background-image: url(' . WPF\_PLUGIN\_URL . 'images/placeholder-image.png); background-position: bottom; background-size: cover;"> |
| [2343](#L2343) | <img src="' . $page\_screenshot . '" alt="page screenshot"> |
| [2344](#L2344) | ' . $approved\_label . ' |
| [2345](#L2345) | </div> |
| [2346](#L2346) | </div>'; |
| [2347](#L2347) | } |
| [2348](#L2348) |  |
| [2349](#L2349) | function get\_no\_page\_html() { |
| [2350](#L2350) | return '<div class="wpf\_no\_page\_found"> |
| [2351](#L2351) | <div class="wpf\_no\_page\_img"> |
| [2352](#L2352) | <img src="' . WPF\_PLUGIN\_URL . "images/no-pages.svg" . '" alt="no page image" > |
| [2353](#L2353) | </div> |
| [2354](#L2354) | <div class="wpf\_no\_page\_header">' . \_\_( "Let's get started", "atarim-visual-collaboration" ) . '</div> |
| [2355](#L2355) | <div class="wpf\_no\_page\_body">' . \_\_( "Join forces - click the button below to add this page", "atarim-visual-collaboration" ) . '</div> |
| [2356](#L2356) | </div>'; |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) | function is\_non\_collab\_screen() { |
| [2360](#L2360) | if ( is\_admin() ) { |
| [2361](#L2361) | $wpf\_current\_screen = get\_current\_screen(); |
| [2362](#L2362) | $wpf\_current\_screen = $wpf\_current\_screen->id; |
| [2363](#L2363) | if ( $wpf\_current\_screen == 'collaborate\_page\_wpfeedback\_page\_permissions' || $wpf\_current\_screen == 'collaborate\_page\_wpfeedback\_page\_settings' || $wpf\_current\_screen == 'toplevel\_page\_wpfeedback\_page\_tasks' || $wpf\_current\_screen == 'collaborate\_page\_wpfeedback\_page\_integrate' ) { |
| [2364](#L2364) | return true; |
| [2365](#L2365) | } |
| [2366](#L2366) | } |
| [2367](#L2367) | return false; |
| [2368](#L2368) | } |
| [2369](#L2369) |  |
| [2370](#L2370) | // funciton to return uploaded file html for task center by Pratap. |
| [2371](#L2371) | function get\_files\_html($files) { |
| [2372](#L2372) | $files\_html = ''; |
| [2373](#L2373) | if( count($files) > 0 ) { |
| [2374](#L2374) | $img\_html = ''; |
| [2375](#L2375) | $docu\_html = ''; |
| [2376](#L2376) | $each\_img\_html = ''; |
| [2377](#L2377) | $each\_docu\_html = ''; |
| [2378](#L2378) | $has\_img = false; |
| [2379](#L2379) | $has\_docu = false; |
| [2380](#L2380) | foreach( $files as $file ) { |
| [2381](#L2381) | $file\_name = explode('\_', $file['name'])[1]; |
| [2382](#L2382) | $file\_size = get\_file\_size($file['size']); |
| [2383](#L2383) | $bg\_class = ''; |
| [2384](#L2384) | if( $file['type'] == 'image/png' || $file['type'] == 'image/jpeg' || $file['type'] == 'image/gif' ) { |
| [2385](#L2385) | $has\_img = true; |
| [2386](#L2386) | $each\_img\_html .= '<div class="wpf\_comment\_each\_img wpf\_uploaded\_doc"><img src="' . $file['url'] . '" alt="file upload"><div class="wpf\_file\_icons" data-file-id="' . $file['id'] . '">' . $preview\_image\_icon . $delete\_icon . '</div></div>'; |
| [2387](#L2387) | } else { |
| [2388](#L2388) | $has\_docu = true; |
| [2389](#L2389) | if( $file['type'] == 'application/pdf' ) { |
| [2390](#L2390) | $src = WPF\_PLUGIN\_URL . 'images/pdf.svg'; |
| [2391](#L2391) | $bg\_class = 'pdf'; |
| [2392](#L2392) | } else if( $file['type'] == 'text/plain' ) { |
| [2393](#L2393) | $src = WPF\_PLUGIN\_URL . 'images/txt.svg'; |
| [2394](#L2394) | $bg\_class = 'txt'; |
| [2395](#L2395) | } else { |
| [2396](#L2396) | $src = WPF\_PLUGIN\_URL . 'images/docs.svg'; |
| [2397](#L2397) | } |
| [2398](#L2398) | $each\_docu\_html .= '<div class="wpf\_comment\_each\_doc wpf\_uploaded\_doc"><div class="wpf\_doc\_container"><div class="wpf\_doc\_img\_container ' . $bg\_class . '"><img src="' . $src . '" alt="file upload"></div><div class="wpf\_doc\_meta\_container"><div class="wpf\_doc\_name" data-link="' . $file['url'] . '">' . $file\_name . '</div><span class="wpf\_doc\_size">' . $file\_size . '</span></div></div><div class="wpf\_file\_icons" data-file-id="' . $file['id'] . '">' . $download\_file\_icon . $delete\_icon . '</div></div>'; |
| [2399](#L2399) | } |
| [2400](#L2400) | } |
| [2401](#L2401) | if( $has\_img ) { |
| [2402](#L2402) | $img\_html = '<div class="wpf\_comment\_images">' . $each\_img\_html . '</div>'; |
| [2403](#L2403) | } |
| [2404](#L2404) | if( $has\_docu ) { |
| [2405](#L2405) | $docu\_html = '<div class="wpf\_comment\_documents">' . $each\_docu\_html . '</div>'; |
| [2406](#L2406) | } |
| [2407](#L2407) | $files\_html .= '<div class="wpf\_comment\_files\_wrapper">' . $img\_html . $docu\_html . '</div>'; |
| [2408](#L2408) | } |
| [2409](#L2409) | return $files\_html; |
| [2410](#L2410) | } |
| [2411](#L2411) |  |
| [2412](#L2412) | function get\_file\_size($size, $precision = 2) { |
| [2413](#L2413) | $base = log($size, 1024); |
| [2414](#L2414) | $suffixes = array('', 'K', 'M', 'G', 'T'); |
| [2415](#L2415) |  |
| [2416](#L2416) | return round(pow(1024, $base - floor($base)), $precision) .' '. $suffixes[floor($base)]; |
| [2417](#L2417) | } |
| [2418](#L2418) |  |
| [2419](#L2419) | // Function to encrypt the integer ID |
| [2420](#L2420) | function encrypt\_id( $id ) { |
| [2421](#L2421) | $ciphering = "AES-128-CTR"; |
| [2422](#L2422) | $iv\_length = openssl\_cipher\_iv\_length($ciphering); |
| [2423](#L2423) | $options = 0; |
| [2424](#L2424) |  |
| [2425](#L2425) | // Convert the ID to a string |
| [2426](#L2426) | $id\_string = (string)$id; |
| [2427](#L2427) |  |
| [2428](#L2428) | // Generate a secure, random IV |
| [2429](#L2429) | $encryption\_iv = openssl\_random\_pseudo\_bytes($iv\_length); |
| [2430](#L2430) |  |
| [2431](#L2431) | $encryption\_key = "atarim"; |
| [2432](#L2432) |  |
| [2433](#L2433) | // openssl\_encrypt() function to encrypt the data |
| [2434](#L2434) | $encryption = openssl\_encrypt($id\_string, $ciphering, $encryption\_key, $options, $encryption\_iv); |
| [2435](#L2435) |  |
| [2436](#L2436) | // Encode the IV and the encrypted string together |
| [2437](#L2437) | $encrypted\_string = base64\_encode($encryption\_iv . $encryption); |
| [2438](#L2438) |  |
| [2439](#L2439) | // Make the base64 URL-safe |
| [2440](#L2440) | $encrypted\_string = str\_replace(['+', '/', '='], ['-', '\_', ''], $encrypted\_string); |
| [2441](#L2441) |  |
| [2442](#L2442) | return $encrypted\_string; |
| [2443](#L2443) | } |
| [2444](#L2444) |  |
| [2445](#L2445) | // Function to decrypt the encrypted string back to the integer ID |
| [2446](#L2446) | function decrypt\_id( $encrypted\_string ) { |
| [2447](#L2447) | $ciphering = "AES-128-CTR"; |
| [2448](#L2448) | $iv\_length = openssl\_cipher\_iv\_length($ciphering); |
| [2449](#L2449) | $options = 0; |
| [2450](#L2450) |  |
| [2451](#L2451) | $encryption\_key = "atarim"; |
| [2452](#L2452) |  |
| [2453](#L2453) | // Reverse the URL-safe base64 encoding |
| [2454](#L2454) | $encrypted\_string = str\_replace(['-', '\_'], ['+', '/'], $encrypted\_string); |
| [2455](#L2455) |  |
| [2456](#L2456) | // Ensure proper padding for base64 decoding |
| [2457](#L2457) | $mod4 = strlen($encrypted\_string) % 4; |
| [2458](#L2458) | if ($mod4) { |
| [2459](#L2459) | $encrypted\_string .= substr('====', $mod4); |
| [2460](#L2460) | } |
| [2461](#L2461) |  |
| [2462](#L2462) | // Decode the encrypted string |
| [2463](#L2463) | $decoded\_encrypted\_string = base64\_decode($encrypted\_string); |
| [2464](#L2464) |  |
| [2465](#L2465) | // Extract the IV and the encrypted data |
| [2466](#L2466) | $extracted\_iv = substr($decoded\_encrypted\_string, 0, $iv\_length); |
| [2467](#L2467) | $extracted\_encrypted\_data = substr($decoded\_encrypted\_string, $iv\_length); |
| [2468](#L2468) |  |
| [2469](#L2469) | // Decrypt the data |
| [2470](#L2470) | $decryption = openssl\_decrypt($extracted\_encrypted\_data, $ciphering, $encryption\_key, $options, $extracted\_iv); |
| [2471](#L2471) |  |
| [2472](#L2472) | // Convert the decrypted string back to an integer |
| [2473](#L2473) | $id = (int)$decryption; |
| [2474](#L2474) |  |
| [2475](#L2475) | return $id; |
| [2476](#L2476) | } |
| [2477](#L2477) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3116009&format=txt)
* [Original Format](/export/3116009/atarim-visual-collaboration/trunk/inc/wpf_function.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_809c1bd0_20250110_201514.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3133163%2Fatarim-visual-collaboration%2Ftrunk%2Finc%2Fwpf_function.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3124979/atarim-visual-collaboration/trunk/inc/wpf_function.php "Changeset 3124979 for atarim-visual-collaboration/trunk/inc/wpf_function.php")
* [Next Change](/changeset/3138174/atarim-visual-collaboration/trunk/inc/wpf_function.php "Changeset 3138174 for atarim-visual-collaboration/trunk/inc/wpf_function.php") →

---

# Changeset [3133163](/changeset/3133163 "Show full changeset") for [atarim-visual-collaboration/trunk/inc/wpf\_function.php](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/09/2024 11:32:22 AM
([5 months](/timeline?from=2024-08-09T11%3A32%3A22Z&precision=second "See timeline at 08/09/2024 11:32:22 AM") ago)

Author:
wpfeedback
Message:

updated to version 4.0.3

File:

1 edited

* [atarim-visual-collaboration/trunk/inc/wpf\_function.php](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163 "Show entry in browser")
  (modified)
  ([6 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [atarim-visual-collaboration/trunk/inc/wpf\_function.php](/changeset/3133163/atarim-visual-collaboration/trunk/inc/wpf_function.php "Show the changeset 3133163 restricted to atarim-visual-collaboration/trunk/inc/wpf_function.php")

  | [r3124979](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L143 "Show revision 3124979 of this file in browser") | [r3133163](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L143 "Show revision 3133163 of this file in browser") |  |
  | --- | --- | --- |
  | 143 | 143 | if ( ! function\_exists( 'process\_wpfeedback\_options' ) ) { |
  | 144 | 144 | function process\_wpfeedback\_options() { |
  |  | 145 | if ( !check\_if\_allowed\_to\_save\_settings() ) { |
  |  | 146 | wp\_die( 'Unauthorized access' ); |
  |  | 147 | } |
  | 145 | 148 | $options = []; |
  | 146 | 149 | // Check that user has proper security level |
  | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L208) | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L211) |  |
  | 208 | 211 | } |
  | 209 | 212 | update\_site\_data( $parms ); |
  | 210 |  | wp\_redirect( add\_query\_arg( 'page', '~~wpfeedback~~\_page\_settings&wpf\_setting=1', admin\_url( 'admin.php' ) ) ); |
  |  | 213 | wp\_redirect( add\_query\_arg( 'page', 'collaboration\_page\_settings&wpf\_setting=1', admin\_url( 'admin.php' ) ) ); |
  | 211 | 214 | exit; |
  | 212 | 215 | } |
  | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L222) | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L225) |  |
  | 222 | 225 | if ( ! function\_exists( 'process\_wpfeedback\_misc\_options' ) ) { |
  | 223 | 226 | function process\_wpfeedback\_misc\_options() { |
  |  | 227 | if ( !check\_if\_allowed\_to\_save\_settings() ) { |
  |  | 228 | wp\_die( 'Unauthorized access' ); |
  |  | 229 | } |
  | 224 | 230 | $options = []; |
  | 225 | 231 | if ( isset( $\_POST['wpf\_license\_deactivate'] ) ) { |
  | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L334) | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L340) |  |
  | 334 | 340 | } |
  | 335 | 341 | } |
  | 336 |  | wp\_redirect( add\_query\_arg( 'page', '~~wpfeedback~~\_page\_permissions', admin\_url( 'admin.php' ) ) ); |
  |  | 342 | wp\_redirect( add\_query\_arg( 'page', 'collaboration\_page\_permissions', admin\_url( 'admin.php' ) ) ); |
  | 337 | 343 | exit; |
  | 338 | 344 | } |
  | 339 | 345 | } |
  | 340 | 346 | add\_action( 'admin\_post\_save\_wpfeedback\_misc\_options', 'process\_wpfeedback\_misc\_options' ); |
  |  | 347 |  |
  |  | 348 | // This function checks if the user is allowed to change the plugin settings or not. |
  |  | 349 | function check\_if\_allowed\_to\_save\_settings() { |
  |  | 350 | // Verify nonce |
  |  | 351 | if ( ! isset( $\_POST['\_wpnonce'] ) || ! wp\_verify\_nonce( $\_POST['\_wpnonce'], 'wpfeedback' ) ) { |
  |  | 352 | return false; |
  |  | 353 | } |
  |  | 354 | if ( is\_user\_logged\_in() ) { |
  |  | 355 | // Get the current logged-in user ID |
  |  | 356 | $user\_id = get\_current\_user\_id(); |
  |  | 357 |  |
  |  | 358 | // Retrieve the user meta value |
  |  | 359 | $user\_meta\_value = get\_user\_meta( $user\_id, 'wpf\_user\_type', true ); |
  |  | 360 |  |
  |  | 361 | // Check if the user is Webmaster or not. |
  |  | 362 | if ( $user\_meta\_value === 'advisor' ) { |
  |  | 363 | return true; |
  |  | 364 | } |
  |  | 365 | return false; |
  |  | 366 | } |
  |  | 367 | } |
  | 341 | 368 |  |
  | 342 | 369 | /\* |
  | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L1762) | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L1789) |  |
  | 1762 | 1789 | if ( is\_admin() == 1 ) { |
  | 1763 | 1790 | $approve\_btn = ""; |
  | 1764 |  | ~~}~~ |
  | 1765 |  |  |
  | 1766 |  | ~~$agency\_menu\_item    = '';~~ |
  | 1767 |  | ~~if ( $wpf\_current\_role == 'advisor' || ( $wpf\_current\_role == '' && current\_user\_can( 'administrator' ) ) ) {~~ |
  | 1768 |  | ~~$agency\_menu\_item = '<li class="pro"> <a href="' . WPF\_APP\_SITE\_URL . '/login" target="\_blank" title="' . \_\_( "Atarim Dashboard", 'atarim-visual-collaboration' ) . '">' . get\_wpf\_pro\_icon() . '<span>' . \_\_( "Agency", 'atarim-visual-collaboration' ) . '</span> </a></li>';~~ |
  | 1769 | 1791 | } |
  | 1770 | 1792 |  |
  | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3124979#L2344) | […](/browser/atarim-visual-collaboration/trunk/inc/wpf_function.php?rev=3133163#L2366) |  |
  | 2344 | 2366 | $wpf\_current\_screen = get\_current\_screen(); |
  | 2345 | 2367 | $wpf\_current\_screen = $wpf\_current\_screen->id; |
  | 2346 |  | if ( $wpf\_current\_screen == 'collaborate\_page\_~~wpfeedback\_page\_permissions' || $wpf\_current\_screen == 'collaborate\_page\_wpfeedback\_page\_settings' || $wpf\_current\_screen == 'toplevel\_page\_wpfeedback\_page\_tasks' || $wpf\_current\_screen == 'collaborate\_page\_wpfeedback~~\_page\_integrate' ) { |
  |  | 2368 | if ( $wpf\_current\_screen == 'collaborate\_page\_collaboration\_page\_permissions' || $wpf\_current\_screen == 'collaborate\_page\_collaboration\_page\_settings' || $wpf\_current\_screen == 'toplevel\_page\_collaboration\_page\_tasks' || $wpf\_current\_screen == 'collaborate\_page\_collaboration\_page\_integrate' ) { |
  | 2347 | 2369 | return true; |
  | 2348 | 2370 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3133163)
* [Zip Archive](?format=zip&new=3133163)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


