<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>d97c05d2301799ed585620a9c5c739d36e7b5d3d - fuchsia - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><link rel="stylesheet" type="text/css" href="/+static/doc.css"><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?faa=1&amp;service=gerritcodereview&amp;continue=https://fuchsia.googlesource.com/login/fuchsia/%2B/d97c05d2301799ed585620a9c5c739d36e7b5d3d">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">fuchsia</a> / <a class="Breadcrumbs-crumb" href="/fuchsia/">fuchsia</a> / <span class="Breadcrumbs-crumb">d97c05d2301799ed585620a9c5c739d36e7b5d3d</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>d97c05d2301799ed585620a9c5c739d36e7b5d3d</td><td><span>[<a href="/fuchsia/+log/d97c05d2301799ed585620a9c5c739d36e7b5d3d">log</a>]</span> <span>[<a href="/fuchsia/+archive/d97c05d2301799ed585620a9c5c739d36e7b5d3d.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Adrian Danis &lt;adanis@google.com&gt;</td><td>Mon Jan 03 23:44:30 2022 +0000</td></tr><tr><th class="Metadata-title">committer</th><td>Commit Bot &lt;commit-bot@chromium.org&gt;</td><td>Mon Jan 03 23:44:30 2022 +0000</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/">c66b2f6788b8dc7444a28dd44354ef0c2f13db91</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d%5E">3e79f6c82dcf4921726f18d9f380715284843407</a> <span>[<a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">[kernel][vm] Optimize protect ranges

Optimizes the protection of ranges by taking into account the previous
arch mmu flags for each range being modified. Knowing the previous
flags lets us skip manipulating the arch aspace in some circumstances
where we know it would be redundant.

In particular, without knowing the previous permissions if the new
permissions had WRITE, we would have to protect to the new permissions
minus WRITE, even if the new permissions were the same as the old ones.
Now this scenario can be identified and skipped.

Bug: 90014
Change-Id: <a href="https://fuchsia-review.googlesource.com/#/q/I9d2bd3993eecb64cadb5bdcb0cb308fa8a9ea1c3">I9d2bd3993eecb64cadb5bdcb0cb308fa8a9ea1c3</a>
Reviewed-on: <a href="https://fuchsia-review.googlesource.com/c/fuchsia/+/622424">https://fuchsia-review.googlesource.com/c/fuchsia/+/622424</a>
Reviewed-by: Rasha Eqbal &lt;rashaeqbal@google.com&gt;
Commit-Queue: Adrian Danis &lt;adanis@google.com&gt;
</pre><ul class="DiffTree"><li><a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/zircon/kernel/vm/include/vm/vm_address_region.h">zircon/kernel/vm/include/vm/vm_address_region.h</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d%5E%21/#F0">diff</a>]</span></li><li><a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/zircon/kernel/vm/vm_mapping.cc">zircon/kernel/vm/vm_mapping.cc</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d%5E%21/#F1">diff</a>]</span></li></ul><div class="DiffSummary">2 files changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: c66b2f6788b8dc7444a28dd44354ef0c2f13db91</div><ol class="FileList"><li class="FileList-item FileList-item--gitTree" title="Tree - boards/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/boards/">boards/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - build/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/build/">build/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - bundles/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/bundles/">bundles/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - docs/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/docs/">docs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - examples/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/examples/">examples/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - garnet/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/garnet/">garnet/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - products/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/products/">products/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - scripts/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/scripts/">scripts/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - sdk/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/sdk/">sdk/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - src/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/src/">src/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - third_party/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/third_party/">third_party/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tools/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/tools/">tools/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - zircon/"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/zircon/">zircon/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .clang-format"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.clang-format">.clang-format</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .clang-tidy"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.clang-tidy">.clang-tidy</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .git-blame-ignore-revs"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.git-blame-ignore-revs">.git-blame-ignore-revs</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .gitattributes"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.gitattributes">.gitattributes</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .gitignore"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.gitignore">.gitignore</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .gn"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.gn">.gn</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .style.yapf"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/.style.yapf">.style.yapf</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - analysis_options.yaml"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/analysis_options.yaml">analysis_options.yaml</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - AUTHORS"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/AUTHORS">AUTHORS</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - BUILD.gn"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/BUILD.gn">BUILD.gn</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CODE_OF_CONDUCT.md"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/CODE_OF_CONDUCT.md">CODE_OF_CONDUCT.md</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CONTRIBUTING.md"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/CONTRIBUTING.md">CONTRIBUTING.md</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - LICENSE"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/LICENSE">LICENSE</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - OWNERS"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/OWNERS">OWNERS</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - PATENTS"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/PATENTS">PATENTS</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - pyrightconfig.json"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/pyrightconfig.json">pyrightconfig.json</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - README.md"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/README.md">README.md</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - rustfmt.toml"><a class="FileList-itemLink" href="/fuchsia/+/d97c05d2301799ed585620a9c5c739d36e7b5d3d/rustfmt.toml">rustfmt.toml</a></li></ol><div class="InlineReadme"><div class="InlineReadme-path">README.md</div><div class="doc"><h1><a class="h" name="Fuchsia" href="#Fuchsia"><span></span></a><a class="h" name="fuchsia" href="#fuchsia"><span></span></a>Fuchsia</h1><h2><a class="h" name="What-is-Fuchsia" href="#What-is-Fuchsia"><span></span></a><a class="h" name="what-is-fuchsia" href="#what-is-fuchsia"><span></span></a>What is Fuchsia?</h2><p>Fuchsia is an open source, general purpose operating system supporting modern 64-bit Intel and ARM processors.</p><p>We expect everyone interacting with our project to respect our <a href="d97c05d2301799ed585620a9c5c739d36e7b5d3d/CODE_OF_CONDUCT.md">code of conduct</a>.</p><p><a href="https://fuchsia.dev/fuchsia-src/concepts.md">Read more about Fuchsia&#39;s principles</a>.</p><h2><a class="h" name="How-can-I-build-and-run-Fuchsia" href="#How-can-I-build-and-run-Fuchsia"><span></span></a><a class="h" name="how-can-i-build-and-run-fuchsia" href="#how-can-i-build-and-run-fuchsia"><span></span></a>How can I build and run Fuchsia?</h2><p>See <a href="https://fuchsia.dev/fuchsia-src/getting_started.md">Getting Started</a>.</p><h2><a class="h" name="Where-can-I-learn-more-about-Fuchsia" href="#Where-can-I-learn-more-about-Fuchsia"><span></span></a><a class="h" name="where-can-i-learn-more-about-fuchsia" href="#where-can-i-learn-more-about-fuchsia"><span></span></a>Where can I learn more about Fuchsia?</h2><p>See <a href="https://fuchsia.dev">fuchsia.dev</a>.</p></div></div></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a>| <a href="https://policies.google.com/terms">Terms</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>