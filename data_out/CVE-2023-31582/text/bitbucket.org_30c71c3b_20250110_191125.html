

1. [![Brian Campbell Avatar](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/default_workspace_avatar/workspace_code.svg)

   Brian Campbell](/b_c/)
2. [Untitled project](/b_c/workspace/projects/PROJ)
3. [jose4j](/b_c/jose4j)
4. [Issues](/b_c/jose4j/issues?status=new&status=open)

# Insecure support of setting PBE less then 1000 iteration count

Issue #203

[closed](/b_c/jose4j/issues?status=closed)

![](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/default_avatar/user_blue.svg)

KANII
created an issue
2023-01-20

Hi, we are a research group to help developers build secure applications. We designed a cryptographic misuse detector on Java language(Our main concern is the secure implementation and use of Json Web Token). We found your great public repository and several security issues detected by our detector are shown in the following.

We found it is supported to set iteration count toward setting header parameter “p2c”，when using PBE algorithm to generate JWE. And the library does not check the count of iterations, so users may set the number of iterations to be less than 1000.

```
        long iterationCount = 500L;\\
        encryptingJwe.setHeader(HeaderParameterNames.PBES2_ITERATION_COUNT, iterationCount);

```

We think that the library need also limit the number of iterations specified by the user, and not allow to set the iteration count less than 1000. Because some inexperienced developers may set an insecure iteration count.

‌

## Comments (3)

1. ![](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/default_avatar/user_blue.svg)

   Brian Campbell

   I think it’d make sense to put a check in `Pbes2HmacShaWithAesKeyWrapAlgorithm.deriveForEncrypt(...)` that fails if the iteration count is less than 1000.

   ‌

   * [2023-01-20T23:54:04+00:00](#comment-64738897 "Link directly to this comment")
2. ![](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/default_avatar/user_blue.svg)

   Brian Campbell
   repo owner
   * changed status to
     [resolved](/b_c/jose4j/issues?status=resolved)

   addressed with [1929fe3](https://bitbucket.org/b_c/jose4j/commits/1929fe3) “PBES2 - disallow iteration count < 1000 (Issue ~~[~~#203~~](https://bitbucket.org/b_c/jose4j/issues/203/insecure-support-of-setting-pbe-less-then "Insecure support of setting PBE less then 1000 iteration count")~~) and salt < 8 bytes. Also increased the default iteration count”

   * [2023-02-02T00:26:07+00:00](#comment-64785357 "Link directly to this comment")
3. ![](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/default_avatar/user_blue.svg)

   Brian Campbell
   repo owner
   * changed status to
     [closed](/b_c/jose4j/issues?status=closed)

   in jose4j/0.9.3

   * [2023-02-08T19:36:05+00:00](#comment-64810510 "Link directly to this comment")
4. [Log in to comment](/account/signin/?next=/b_c/jose4j/issues/203/insecure-support-of-setting-pbe-less-then)

Assignee
–

Type
[enhancement](/b_c/jose4j/issues?kind=enhancement)

Priority
[minor](/b_c/jose4j/issues?priority=minor)

Status
[closed](/b_c/jose4j/issues?status=closed)

Votes
0

Watchers
1

[![Jira: the preferred issue tracker for Bitbucket. Join the team!](https://bbc-object-storage--frontbucket.us-east-1.prod.public.atl-paas.net/6c64d0aa3151/img/promos/jira-promo-issue.png)](https://www.atlassian.com/software/jira/bitbucket-integration?utm_source=bitbucket&utm_medium=in_product_ad&utm_campaign=bitbucket_issues&utm_content=issues_view)

