

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:47:46 +0200 |
| commit | [4c0bfb4e867c1ec6616a5049bd3618021e127056](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)) | |
| tree | [363419a51ed70cc2ee4aabb4aa594401ccae56c7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) | |
| parent | [b2b685c77ee3b92f3fbb94cfa50bafaea4959344](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b2b685c77ee3b92f3fbb94cfa50bafaea4959344) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056&id2=b2b685c77ee3b92f3fbb94cfa50bafaea4959344)) | |
| download | [linux-4c0bfb4e867c1ec6616a5049bd3618021e127056.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4c0bfb4e867c1ec6616a5049bd3618021e127056.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex d6ad437883fade..93351452184ab5 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=b2b685c77ee3b92f3fbb94cfa50bafaea4959344)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)@@ -1098,7 +1098,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:33 +0000

