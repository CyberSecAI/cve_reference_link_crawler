=== Content from git.kernel.org_2836971b_20250110_104958.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:41:41 +0200 |
| commit | [8c5f5911c1b13170d3404eb992c6a0deaa8d81ad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)) | |
| tree | [60cebca41aae1b2a8f38d7248ad90fc5f67da41b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad) | |
| parent | [ff19ea00a50f958826624d9ac9dc332d162b5bfe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ff19ea00a50f958826624d9ac9dc332d162b5bfe) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad&id2=ff19ea00a50f958826624d9ac9dc332d162b5bfe)) | |
| download | [linux-8c5f5911c1b13170d3404eb992c6a0deaa8d81ad.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8c5f5911c1b13170d3404eb992c6a0deaa8d81ad.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex 4c0f9fe1ba7791..c692b55dd1169b 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=ff19ea00a50f958826624d9ac9dc332d162b5bfe)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=8c5f5911c1b13170d3404eb992c6a0deaa8d81ad)@@ -1088,7 +1088,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:04:28 +0000



=== Content from git.kernel.org_4caeca6a_20250110_104955.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:23:45 +0200 |
| commit | [2062e3f1f2374102f8014d7ca286b9aa527bd558](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)) | |
| tree | [5e68a4ac087c66d3683f819ba93b34f1ede4e517](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558) | |
| parent | [9ad75e78747b5a50dc5a52f0f8e92e920a653f16](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9ad75e78747b5a50dc5a52f0f8e92e920a653f16) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558&id2=9ad75e78747b5a50dc5a52f0f8e92e920a653f16)) | |
| download | [linux-2062e3f1f2374102f8014d7ca286b9aa527bd558.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2062e3f1f2374102f8014d7ca286b9aa527bd558.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=2062e3f1f2374102f8014d7ca286b9aa527bd558) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex 027a53eec42a53..91500365edec78 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=9ad75e78747b5a50dc5a52f0f8e92e920a653f16)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=2062e3f1f2374102f8014d7ca286b9aa527bd558)@@ -916,7 +916,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:32 +0000



=== Content from git.kernel.org_2154d4bb_20250110_104956.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=67011123453b91ec03671d40712fa213e94a01b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=67011123453b91ec03671d40712fa213e94a01b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=67011123453b91ec03671d40712fa213e94a01b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=67011123453b91ec03671d40712fa213e94a01b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:40:00 +0200 |
| commit | [67011123453b91ec03671d40712fa213e94a01b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=67011123453b91ec03671d40712fa213e94a01b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=67011123453b91ec03671d40712fa213e94a01b9)) | |
| tree | [9e414d58db6ec82991c030d6061891ff0e0af327](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=67011123453b91ec03671d40712fa213e94a01b9) | |
| parent | [681ff9a09accd8a4379f8bd30b7a1641ee19bb3e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=681ff9a09accd8a4379f8bd30b7a1641ee19bb3e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=67011123453b91ec03671d40712fa213e94a01b9&id2=681ff9a09accd8a4379f8bd30b7a1641ee19bb3e)) | |
| download | [linux-67011123453b91ec03671d40712fa213e94a01b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-67011123453b91ec03671d40712fa213e94a01b9.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=67011123453b91ec03671d40712fa213e94a01b9)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=67011123453b91ec03671d40712fa213e94a01b9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex 4968964ac5def0..1dd6dd2ed7fbc2 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=681ff9a09accd8a4379f8bd30b7a1641ee19bb3e)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=67011123453b91ec03671d40712fa213e94a01b9)@@ -1031,7 +1031,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:33 +0000



=== Content from git.kernel.org_46ec48a2_20250110_104957.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:51:11 +0200 |
| commit | [7dabe54a016defe11bb2a278cd9f1ff6db3feba6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)) | |
| tree | [d3bb1988c54c50c3d6dd5b47f5fab3240067edc0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6) | |
| parent | [abab22295603f259bc3a0c4c14f2e1157360118e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=abab22295603f259bc3a0c4c14f2e1157360118e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6&id2=abab22295603f259bc3a0c4c14f2e1157360118e)) | |
| download | [linux-7dabe54a016defe11bb2a278cd9f1ff6db3feba6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7dabe54a016defe11bb2a278cd9f1ff6db3feba6.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex f13837907bd5e2..ca7e626a97a4b3 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=abab22295603f259bc3a0c4c14f2e1157360118e)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=7dabe54a016defe11bb2a278cd9f1ff6db3feba6)@@ -1129,7 +1129,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:04:30 +0000



=== Content from git.kernel.org_9ef2d4a4_20250110_104957.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:32:36 +0200 |
| commit | [7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)) | |
| tree | [26ae54b1254da9af1479f90557eff4d760a6b041](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0) | |
| parent | [76dc776153a47372719d664e0fc50d6355791abb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76dc776153a47372719d664e0fc50d6355791abb) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0&id2=76dc776153a47372719d664e0fc50d6355791abb)) | |
| download | [linux-7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex c00a288a4eca27..13e56a23e41ec4 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=76dc776153a47372719d664e0fc50d6355791abb)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=7360cef95aa1ea2b5efb7b5e2ed32e941664e1f0)@@ -859,7 +859,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:34 +0000



=== Content from git.kernel.org_3d38a971_20250110_104958.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Heiko Carstens <hca@linux.ibm.com> | 2024-05-16 10:17:11 +0200 |
| commit | [d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)) | |
| tree | [ace0bf1cc2db6340a021d6bbb75f870ea7866fb6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9) | |
| parent | [32e8bd6423fc127d2b37bdcf804fd76af3bbec79](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32e8bd6423fc127d2b37bdcf804fd76af3bbec79) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9&id2=32e8bd6423fc127d2b37bdcf804fd76af3bbec79)) | |
| download | [linux-d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex c20b4509207980..8b7703f7da760c 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=32e8bd6423fc127d2b37bdcf804fd76af3bbec79)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9)@@ -1091,7 +1091,7 @@ EXPORT\_SYMBOL(ap\_hex2bitmap); \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:35 +0000



=== Content from git.kernel.org_6646b02f_20250110_104956.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:47:46 +0200 |
| commit | [4c0bfb4e867c1ec6616a5049bd3618021e127056](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)) | |
| tree | [363419a51ed70cc2ee4aabb4aa594401ccae56c7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) | |
| parent | [b2b685c77ee3b92f3fbb94cfa50bafaea4959344](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b2b685c77ee3b92f3fbb94cfa50bafaea4959344) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056&id2=b2b685c77ee3b92f3fbb94cfa50bafaea4959344)) | |
| download | [linux-4c0bfb4e867c1ec6616a5049bd3618021e127056.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4c0bfb4e867c1ec6616a5049bd3618021e127056.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=4c0bfb4e867c1ec6616a5049bd3618021e127056) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex d6ad437883fade..93351452184ab5 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=b2b685c77ee3b92f3fbb94cfa50bafaea4959344)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=4c0bfb4e867c1ec6616a5049bd3618021e127056)@@ -1098,7 +1098,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:33 +0000



=== Content from git.kernel.org_eea7d203_20250110_104957.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7c72af16abf2ec7520407098360bbba312289e05)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7c72af16abf2ec7520407098360bbba312289e05)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7c72af16abf2ec7520407098360bbba312289e05)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7c72af16abf2ec7520407098360bbba312289e05)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harald Freudenberger <freude@linux.ibm.com> | 2024-05-13 14:49:13 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:28:52 +0200 |
| commit | [7c72af16abf2ec7520407098360bbba312289e05](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7c72af16abf2ec7520407098360bbba312289e05) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7c72af16abf2ec7520407098360bbba312289e05)) | |
| tree | [75963c4d23589eb12c0c9ea8df82516975b3433a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7c72af16abf2ec7520407098360bbba312289e05) | |
| parent | [896a7e7d0d555ad8b2b46af0c2fa7de7467f9483](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=896a7e7d0d555ad8b2b46af0c2fa7de7467f9483) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7c72af16abf2ec7520407098360bbba312289e05&id2=896a7e7d0d555ad8b2b46af0c2fa7de7467f9483)) | |
| download | [linux-7c72af16abf2ec7520407098360bbba312289e05.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7c72af16abf2ec7520407098360bbba312289e05.tar.gz) | |

s390/ap: Fix crash in AP internal function modify\_bitmap()commit d4f9d5a99a3fd1b1c691b7a1a6f8f3f25f4116c9 upstream.
A system crash like this
Failing address: 200000cb7df6f000 TEID: 200000cb7df6f403
Fault in home space mode while using kernel ASCE.
AS:00000002d71bc007 R3:00000003fe5b8007 S:000000011a446000 P:000000015660c13d
Oops: 0038 ilc:3 [#1] PREEMPT SMP
Modules linked in: mlx5\_ib ...
CPU: 8 PID: 7556 Comm: bash Not tainted 6.9.0-rc7 #8
Hardware name: IBM 3931 A01 704 (LPAR)
Krnl PSW : 0704e00180000000 0000014b75e7b606 (ap\_parse\_bitmap\_str+0x10e/0x1f8)
R:0 T:1 IO:1 EX:1 Key:0 M:1 W:0 P:0 AS:3 CC:2 PM:0 RI:0 EA:3
Krnl GPRS: 0000000000000001 ffffffffffffffc0 0000000000000001 00000048f96b75d3
000000cb00000100 ffffffffffffffff ffffffffffffffff 000000cb7df6fce0
000000cb7df6fce0 00000000ffffffff 000000000000002b 00000048ffffffff
000003ff9b2dbc80 200000cb7df6fcd8 0000014bffffffc0 000000cb7df6fbc8
Krnl Code: 0000014b75e7b5fc: a7840047 brc 8,0000014b75e7b68a
0000014b75e7b600: 18b2 lr %r11,%r2
#0000014b75e7b602: a7f4000a brc 15,0000014b75e7b616
>0000014b75e7b606: eb22d00000e6 laog %r2,%r2,0(%r13)
0000014b75e7b60c: a7680001 lhi %r6,1
0000014b75e7b610: 187b lr %r7,%r11
0000014b75e7b612: 84960021 brxh %r9,%r6,0000014b75e7b654
0000014b75e7b616: 18e9 lr %r14,%r9
Call Trace:
[<0000014b75e7b606>] ap\_parse\_bitmap\_str+0x10e/0x1f8
([<0000014b75e7b5dc>] ap\_parse\_bitmap\_str+0xe4/0x1f8)
[<0000014b75e7b758>] apmask\_store+0x68/0x140
[<0000014b75679196>] kernfs\_fop\_write\_iter+0x14e/0x1e8
[<0000014b75598524>] vfs\_write+0x1b4/0x448
[<0000014b7559894c>] ksys\_write+0x74/0x100
[<0000014b7618a440>] \_\_do\_syscall+0x268/0x328
[<0000014b761a3558>] system\_call+0x70/0x98
INFO: lockdep is turned off.
Last Breaking-Event-Address:
[<0000014b75e7b636>] ap\_parse\_bitmap\_str+0x13e/0x1f8
Kernel panic - not syncing: Fatal exception: panic\_on\_oops
occured when /sys/bus/ap/a[pq]mask was updated with a relative mask value
(like +0x10-0x12,+60,-90) with one of the numeric values exceeding INT\_MAX.
The fix is simple: use unsigned long values for the internal variables. The
correct checks are already in place in the function but a simple int for
the internal variables was used with the possibility to overflow.
Reported-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Signed-off-by: Harald Freudenberger <freude@linux.ibm.com>
Tested-by: Marc Hartmayer <mhartmay@linux.ibm.com>
Reviewed-by: Holger Dengler <dengler@linux.ibm.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7c72af16abf2ec7520407098360bbba312289e05)

| -rw-r--r-- | [drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/crypto/ap_bus.c?id=7c72af16abf2ec7520407098360bbba312289e05) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/s390/crypto/ap\_bus.c b/drivers/s390/crypto/ap\_bus.cindex fb1de363fb288f..7033d61cca6bc1 100644--- a/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=896a7e7d0d555ad8b2b46af0c2fa7de7467f9483)+++ b/[drivers/s390/crypto/ap\_bus.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/crypto/ap_bus.c?id=7c72af16abf2ec7520407098360bbba312289e05)@@ -947,7 +947,7 @@ static int hex2bitmap(const char \*str, unsigned long \*bitmap, int bits) \*/ static int modify\_bitmap(const char \*str, unsigned long \*bitmap, int bits) {- int a, i, z;+ unsigned long a, i, z; char \*np, sign;  /\* bits needs to be a multiple of 8 \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:48:35 +0000


