=== Content from www.mozilla.org_a7bbffe0_20250110_121450.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-25

## Security Vulnerabilities fixed in Firefox 127

Announced
June 11, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 127

#### [#CVE-2024-5687: An incorrect principal could have been used when opening new tabs](#CVE-2024-5687)

Reporter
jackyzy823
Impact
high
##### Description

If a specific sequence of actions is performed when opening a new tab, the triggering principal associated with the new tab may have been incorrect. The triggering principal is used to calculate many values, including the `Referer` and `Sec-` headers, meaning there is the potential for incorrect security checks within the browser in addition to incorrect or misleading information sent to remote websites.
This bug only affects Firefox for Android. Other versions of Firefox are unaffected.\*

##### References

* [Bug 1889066](https://bugzilla.mozilla.org/show_bug.cgi?id=1889066)

#### [#CVE-2024-5688: Use-after-free in JavaScript object transplant](#CVE-2024-5688)

Reporter
Lukas Bernhard
Impact
high
##### Description

If a garbage collection was triggered at the right time, a use-after-free could have occurred during object transplant.

##### References

* [Bug 1895086](https://bugzilla.mozilla.org/show_bug.cgi?id=1895086)

#### [#CVE-2024-5689: User confusion and possible phishing vector via Firefox Screenshots](#CVE-2024-5689)

Reporter
Fabian Fäßler
Impact
moderate
##### Description

In addition to detecting when a user was taking a screenshot (XXX), a website was able to overlay the 'My Shots' button that appeared, and direct the user to a replica Firefox Screenshots page that could be used for phishing.

##### References

* [Bug 1389707](https://bugzilla.mozilla.org/show_bug.cgi?id=1389707)

#### [#CVE-2024-5690: External protocol handlers leaked by timing attack](#CVE-2024-5690)

Reporter
Satoki Tsuji
Impact
moderate
##### Description

By monitoring the time certain operations take, an attacker could have guessed which external protocol handlers were functional on a user's system.

##### References

* [Bug 1883693](https://bugzilla.mozilla.org/show_bug.cgi?id=1883693)

#### [#CVE-2024-5691: Sandboxed iframes were able to bypass sandbox restrictions to open a new window](#CVE-2024-5691)

Reporter
Luan Herrera
Impact
moderate
##### Description

By tricking the browser with a `X-Frame-Options` header, a sandboxed iframe could have presented a button that, if clicked by a user, would bypass restrictions to open a new window.

##### References

* [Bug 1888695](https://bugzilla.mozilla.org/show_bug.cgi?id=1888695)

#### [#CVE-2024-5692: Bypass of file name restrictions during saving](#CVE-2024-5692)

Reporter
Raphael Shaniyazov and Axel Chong (@Haxatron)
Impact
moderate
##### Description

On Windows, when using the 'Save As' functionality, an attacker could have tricked the browser into saving the file with a disallowed extension such as `.url` by including an invalid character in the extension. *Note:* This issue only affected Windows operating systems. Other operating systems are unaffected.

##### References

* [Bug 1891234](https://bugzilla.mozilla.org/show_bug.cgi?id=1891234)
* [Bug 1837514](https://bugzilla.mozilla.org/show_bug.cgi?id=1837514)

#### [#CVE-2024-5693: Cross-Origin Image leak via Offscreen Canvas](#CVE-2024-5693)

Reporter
Kirtikumar Anandrao Ramchandani
Impact
moderate
##### Description

Offscreen Canvas did not properly track cross-origin tainting, which could be used to access image data from another site in violation of same-origin policy.

##### References

* [Bug 1891319](https://bugzilla.mozilla.org/show_bug.cgi?id=1891319)

#### [#CVE-2024-5694: Use-after-free in JavaScript Strings](#CVE-2024-5694)

Reporter
Lukas Bernhard
Impact
moderate
##### Description

An attacker could have caused a use-after-free in the JavaScript engine to read memory in the JavaScript string section of the heap.

##### References

* [Bug 1895055](https://bugzilla.mozilla.org/show_bug.cgi?id=1895055)

#### [#CVE-2024-5695: Memory Corruption using allocation using out-of-memory conditions](#CVE-2024-5695)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

If an out-of-memory condition occurs at a specific point using allocations in the probabilistic heap checker, an assertion could have been triggered, and in rarer situations, memory corruption could have occurred.

##### References

* [Bug 1895579](https://bugzilla.mozilla.org/show_bug.cgi?id=1895579)

#### [#CVE-2024-5696: Memory Corruption in Text Fragments](#CVE-2024-5696)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

By manipulating the text in an `<input>` tag, an attacker could have caused corrupt memory leading to a potentially exploitable crash.

##### References

* [Bug 1896555](https://bugzilla.mozilla.org/show_bug.cgi?id=1896555)

#### [#CVE-2024-5697: Website was able to detect when Firefox was taking a screenshot of them](#CVE-2024-5697)

Reporter
Wil Clouser
Impact
low
##### Description

A website was able to detect when a user took a screenshot of a page using the built-in Screenshot functionality in Firefox.

##### References

* [Bug 1414937](https://bugzilla.mozilla.org/show_bug.cgi?id=1414937)

#### [#CVE-2024-5698: Data-list could have overlaid address bar](#CVE-2024-5698)

Reporter
Hafiizh
Impact
low
##### Description

By manipulating the fullscreen feature while opening a data-list, an attacker could have overlaid a text box over the address bar. This could have led to user confusion and possible spoofing attacks.

##### References

* [Bug 1828259](https://bugzilla.mozilla.org/show_bug.cgi?id=1828259)

#### [#CVE-2024-5699: Cookie prefixes not treated as case-sensitive](#CVE-2024-5699)

Reporter
Konstantin Preißer
Impact
low
##### Description

In violation of spec, cookie prefixes such as `__Secure` were being ignored if they were not correctly capitalized - by spec they should be checked with a case-insensitive comparison. This could have resulted in the browser not correctly honoring the behaviors specified by the prefix.

##### References

* [Bug 1891349](https://bugzilla.mozilla.org/show_bug.cgi?id=1891349)

#### [#CVE-2024-5700: Memory safety bugs fixed in Firefox 127, Firefox ESR 115.12, and Thunderbird 115.12](#CVE-2024-5700)

Reporter
The Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 126, Firefox ESR 115.11, and Thunderbird 115.11. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 127, Firefox ESR 115.12, and Thunderbird 115.12](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1862809%2C1889355%2C1893388%2C1895123)

#### [#CVE-2024-5701: Memory safety bugs fixed in Firefox 127](#CVE-2024-5701)

Reporter
Randell Jesup and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 126. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 127](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1890909%2C1891422%2C1893915%2C1894047%2C1896024)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_a6383f8a_20250110_121449.html ===


![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1891349)
* [XML](/show_bug.cgi?ctype=xml&id=1891349)

Closed
[Bug 1891349](/show_bug.cgi?id=1891349)
(CVE-2024-5699)

Opened 9 months ago
Closed 9 months ago

# Firefox doesn't treat cookie name prefixes as case-insensitive

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Firefox doesn't treat cookie name prefixes as case-insensitive

## Categories

### (Core :: Networking: Cookies, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20Cookies#Networking%3A%20Cookies)

Networking: Cookies
▾

Core :: Networking: Cookies
A general mechanism which server side connections (such as CGI scripts) can use to both store and retrieve information on the client side of the connection. This refers to HTML cookies; little blobs of data we store and share with sites
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cookies&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20Cookies&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20Cookies)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Firefox 126

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

127 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox127 | [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox127 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: preissa, Assigned: longsonr)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/c5d912dac5c74b47bbaff7164f5f8bb8?d=mm&size=40)  [longsonr](/user_profile?user_id=218550)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/23a195d557070a41965aaace38f4daec?d=mm&size=40)  [preissa](/user_profile?user_id=422534)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/b032108dab3ccfada1140fb485c6e182?d=mm&size=40)  [smayya](/user_profile?user_id=711499)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

3 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[cookie](/show_bug.cgi?id=1484287 "NEW - [meta] Cookie bugs")

[1891941](/show_bug.cgi?id=1891941 "RESOLVED FIXED - Use StringBeginsWith in CookieService")

Dependency [tree](/showdependencytree.cgi?id=1891349&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1891349)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1892450](/show_bug.cgi?id=1892450 "VERIFIED FIXED - Perma Late Beta TEST-UNEXPECTED-PASS | /cookies/prefix/__secure.header.https.html | __SeCuRe: secure origin: Should not set 'Path=/;domain=not-web-platform.test' - expected FAIL | when Gecko 127 switches from Early Beta to Late Beta on 2024-05-24")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-low, Whiteboard: [necko-triaged][adv-main127+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-5699

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged][adv-main127+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1891349 - Treat cookie name prefixes as case-insensitive r=dveditz](/attachment.cgi?id=9396610)  [9 months ago](#c5)  [Robert Longson [:longsonr]](/user_profile?user_id=218550)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9396610&action=edit) | [Review](/attachment.cgi?id=9396610) |
| --- | --- | --- |
| [Bug 1891349 - set cookies/prefix/\_\_host.header.https.html as passing test steps on Windows x86](/attachment.cgi?id=9397283)  [9 months ago](#c11)  [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9397283&action=edit) | [Review](/attachment.cgi?id=9397283) |
| [advisory.txt](/attachment.cgi?id=9405341)  [7 months ago](#c15)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   365 bytes, text/plain |  | [Details](/attachment.cgi?id=9405341&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Konstantin Preißer](/user_profile?user_id=422534)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1891349#c0)• 9 months ago |
|  | |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:124.0) Gecko/20100101 Firefox/124.0

Steps to reproduce:

Hi there, I'm sorry if this is not the right location to report this.

"draft-ietf-httpbis-rfc6265bis-13" (Cookies: HTTP State Management Mechanism) [1] says at "5.4. Cookie Name Prefixes":

User agents' requirements for cookie name prefixes differ slightly

from servers' (Section 4.1.3) in that UAs MUST match the prefix

string case-insensitively.

The normative requirements for the prefixes are detailed in the

storage model algorithm defined in Section 5.6.

This is because some servers will process cookie case-insensitively,

resulting in them unintentionally miscapitalizing and accepting

miscapitalized prefixes.

For example, if a server sends the following Set-Cookie header field

Set-Cookie: \_\_SECURE-SID=12345

to a UA which checks prefixes case-sensitively it will accept this

cookie and the server would incorrectly believe the cookie is subject

the same guarantees as one spelled \_\_Secure-.

(This section is present since draft version 11 ("draft-ietf-httpbis-rfc6265bis-11"), published on 2022-11-07.)

One such example of a server/framework is ASP.NET Core, where a code like

```
context.Request.Cookies.TryGetValue("__Secure-SID", ...)

```

will also return a cookie whose name is "\_\_SECURE-SID", "\_\_secure-SID" etc.

However, I noticed Firefox Nightly (version 126.0a1 (2024-04-13)) seems to still treat the cookie prefixes "\_\_Host-" and "\_\_Secure-" as case-sensitive. For example, if I send the following header in a HTTP response (with the correct "\_\_Secure-" prefix):

```
Set-Cookie: __Secure-SID=123456; path=/; samesite=lax; httponly

```

then Firefox correctly rejects the cookie as it's missing the "secure" attribute, as shown in the warning logged to the console:

```
Cookie “__Secure-SID” has been rejected for invalid prefix.

```

However, if I send the following header in the HTTP response:

```
Set-Cookie: __secure-SID=123456; path=/; samesite=lax; httponly

```

then Firefox doesn't log a warning and instead accepts the cookie. However, this means servers that treat cookie names case-insensitively, as shown above, might think the cookie name matches "\_\_Secure-SID" and might therefore rely on the UA to only have accepted it if it has the "secure" attribute and was sent over a secure origin, which isn't the case here.

In contrast, Chromium seems to check the prefix with a case-insensitive comparison for the prefix name [2] (depending on the `net::features::kCaseInsensitiveCookiePrefix` feature, which seems to be enabled by default [3]).

Is there a plan to also implement a case-insensitive check for the cookie name prefixes soon? Otherwise, the security guarantees intended by the cookie name prefixes currently doesn't seem to be provided by Firefox for web servers/frameworks that treat cookie names as case-insensitive.

(As a precaution, I checked the "security issue" checkbox, as maybe this could be treated as a security issue.)

Thanks!

[1] <https://datatracker.ietf.org/doc/draft-ietf-httpbis-rfc6265bis/13/>

[2] [https://source.chromium.org/chromium/chromium/src/+/main:net/cookies/canonical\_cookie.cc;l=409-416?q=canonical\_cookie.cc&ss=chromium%2Fchromium%2Fsrc](https://source.chromium.org/chromium/chromium/src/%2B/main%3Anet/cookies/canonical_cookie.cc;l=409-416?q=canonical_cookie.cc&ss=chromium%2Fchromium%2Fsrc)

[3] [https://source.chromium.org/chromium/chromium/src/+/main:net/base/features.cc;l=303-305?q=kCaseInsensitiveCookiePrefix&ss=chromium%2Fchromium%2Fsrc](https://source.chromium.org/chromium/chromium/src/%2B/main%3Anet/base/features.cc;l=303-305?q=kCaseInsensitiveCookiePrefix&ss=chromium%2Fchromium%2Fsrc)

Actual results:

When sending the following header in a HTTP response:

```
Set-Cookie: __secure-SID=123456; path=/; samesite=lax; httponly

```

Firefox accepted the cookie, even though it misses the "secure" attribute and "draft-ietf-httpbis-rfc6265bis-13" requires the cookie prefix name ("\_\_Secure-") to be matched case-insensitively

Expected results:

When sending the following header in a HTTP response:

```
Set-Cookie: __secure-SID=123456; path=/; samesite=lax; httponly

```

Firefox should have rejected the cookie, because it misses the "secure" attribute and "draft-ietf-httpbis-rfc6265bis-13" requires the cookie prefix name ("\_\_Secure-") to be matched case-insensitively.

|  | [Konstantin Preißer](/user_profile?user_id=422534)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1891349#c1)• 9 months ago |
|  | |

Sorry, I forgot to include a reference about ASP.NET Core: This code [1] (`RequestCookieCollection`) creates the store (`Dictionary<string, string>`) for cookie names and values, specifying `StringComparer.OrdinalIgnoreCase` for matching the keys, which means cookie names are matched case-insensitively.

[1] <https://github.com/dotnet/aspnetcore/blob/81355450754f0e6471244b7f1f457b866e982a15/src/Http/Http/src/Internal/RequestCookieCollection.cs#L28-L36>

|  | [Konstantin Preißer](/user_profile?user_id=422534)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1891349#c2)• 9 months ago |
|  | |

For reference, the change in Chromium that introduced a case-insensitive match of cookie name prefixes is: <https://issues.chromium.org/issues/40236421>

Relevant issue in `whatwg/http-extensions`: <https://github.com/httpwg/http-extensions/issues/2231>

Thanks!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1891349#c3)• 9 months ago |
|  | |

I thought we had fixed this but apparently not:

<https://searchfox.org/mozilla-central/rev/b1cffa04131a77e5e118d86d6366e0d660a3072b/netwerk/cookie/CookieService.cpp#2061-2062>

We should use `strncasecmp` there for a quick fix.

I notice we have two copies of the prefix string constants in this file so it would be nice to clean up the duplication between `CookieService::CheckHiddenPrefix()` and `CookieService::CheckPrefixes()`, both called sequentially from `CookieService::CanSetCookie()`

There's probably a dupe on this because surely we're failing the WPT tests that landed for this spec change. In any case the issue is essentially public

Group: firefox-core-securityComponent: Untriaged → Networking: CookiesKeywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)Product: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a43975_1689)• 9 months ago |

Blocks: [cookie](/show_bug.cgi?id=1484287 "NEW - [meta] Cookie bugs")Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1891349#c4)• 9 months ago |
|  | |

yup (only one of many): <https://wpt.fyi/results/cookies/prefix/__host.header.https.html?label=master>

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1891349#c5)• 9 months ago |
|  | |

Attached file
[Bug 1891349 - Treat cookie name prefixes as case-insensitive r=dveditz](attachment.cgi?id=9396610)
— [Details](attachment.cgi?id=9396610&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a74803_600971)• 9 months ago |

Assignee: nobody → longsonrStatus: NEW → ASSIGNED

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a88986_11539)• 9 months ago |

Severity: -- → S2Priority: -- → P2Whiteboard: [necko-triaged][necko-priority-new]

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1891349#c6)• 9 months ago |
|  | |

<https://treeherder.mozilla.org/jobs?repo=try&revision=45f0a96f2acb965d9a5169d1bc1a5aece3fc6ea6>

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1891349#c7)• 9 months ago |
|  | |

<https://treeherder.mozilla.org/jobs?repo=try&revision=327b64fd3f3837dda88294ee883e7b2f6c55b36e>

|  | [Kershaw Chang [:kershaw]](/user_profile?user_id=505624) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a181467_505624)• 9 months ago |

Whiteboard: [necko-triaged][necko-priority-new] → [necko-triaged]

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1891349#c8)• 9 months ago |
|  | |

Pushed by longsonr@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/715ecd9aaf75>
Treat cookie name prefixes as case-insensitive r=dveditz,cookie-reviewers,valentin

|  | [tszentpeteri](/user_profile?user_id=744499) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1891349#c9)• 9 months ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/715ecd9aaf75>

Status: ASSIGNED → RESOLVEDClosed: 9 months ago
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 127 Branch

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a280123_218550)• 9 months ago |

Blocks: [1891941](/show_bug.cgi?id=1891941 "RESOLVED FIXED - Use StringBeginsWith in CookieService")

|  | [Konstantin Preißer](/user_profile?user_id=422534)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1891349#c10)• 9 months ago |
|  | |

Thank you for quickly fixing this!

(According to the tests dashboard, Safari now seems to be the only browser which doesn't yet treat cookie name prefixes case-insensitively.)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1891349#c11)• 9 months ago |
|  | |

Attached file
[Bug 1891349 - set cookies/prefix/\_\_host.header.https.html as passing test steps on Windows x86](attachment.cgi?id=9397283)
— [Details](attachment.cgi?id=9397283&action=edit)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1891349#c12)• 9 months ago |
|  | |

Pushed by imoraru@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/48ea6b3c1cc7>
set cookies/prefix/\_\_host.header.https.html as passing test steps on Windows x86

|  | [Aron Cseh](/user_profile?user_id=743348) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1891349#c13)• 9 months ago |
| bugherder | |

<https://hg.mozilla.org/mozilla-central/rev/48ea6b3c1cc7>

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1891349#c14)• 9 months ago |
|  | |

A patch has been attached on this bug, which was already closed. Filing a separate bug will ensure better tracking. If this was not by mistake and further action is needed, please alert the appropriate party. (Or: if the patch doesn't change behavior -- e.g. landing a test case, or fixing a typo -- then feel free to disregard this message)

|  | [pstanciu](/user_profile?user_id=741343) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a439786_741343)• 9 months ago |

Regressions: [1892450](/show_bug.cgi?id=1892450 "VERIFIED FIXED - Perma Late Beta TEST-UNEXPECTED-PASS | /cookies/prefix/__secure.header.https.html | __SeCuRe: secure origin: Should not set 'Path=/;domain=not-web-platform.test' - expected FAIL | when Gecko 127 switches from Early Beta to Late Beta on 2024-05-24")

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a1313517_578488)• 9 months ago |

[tracking-firefox127](/buglist.cgi?f1=cf_tracking_firefox127&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a4335031_578488)• 7 months ago |

Whiteboard: [necko-triaged] → [necko-triaged][adv-main127+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1891349#c15)• 7 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9405341)
— [Details](attachment.cgi?id=9405341&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a4591495_578488)• 7 months ago |

Alias: CVE-2024-5699

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1891349#a5155375_1689)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1891349&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Robert Longson [:longsonr]](/user_profile?user_id=218550)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


