=== Content from plugins.trac.wordpress.org_6008f119_20250110_153619.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3145430%2540wpextended%252Ftrunk%26old%3D3134345%2540wpextended%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3134345/wpextended/trunk?old=3145430&old_path=%2Fwpextended%2Ftrunk)

---

# Changes in [wpextended/trunk](/browser/wpextended/trunk?rev=3145430 "Show entry in browser") [[3134345:3145430]](/log/wpextended/trunk?rev=3145430&stop_rev=3134345 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[wpextended/trunk](/browser/wpextended/trunk?rev=3145430)
Files:

23 edited

* [admin/class-wp-extended-admin.php](/browser/wpextended/trunk/admin/class-wp-extended-admin.php?rev=3145393 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [admin/js/wp\_extended-admin.js](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3145393 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [admin/partials/wp-extend-admin-display.php](/browser/wpextended/trunk/admin/partials/wp-extend-admin-display.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [includes/libraries/wpext\_export/wpext\_export.php](/browser/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?rev=3145393 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [includes/modules/core\_extensions/wpext\_block\_user\_name\_admin/wpext\_block\_user\_name\_admin.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?rev=3145430 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [includes/modules/core\_extensions/wpext\_change\_wp\_admin\_url/wpext\_change\_wp\_admin\_url.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_change_wp_admin_url/wpext_change_wp_admin_url.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [includes/modules/core\_extensions/wpext\_duplicate\_menu/wpext\_duplicate\_menu.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicate_menu/wpext_duplicate_menu.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [includes/modules/core\_extensions/wpext\_duplicator/wpext\_duplicator.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3145393 "Show entry in browser")
  (modified)
  ([4 diffs](#file7 "Show differences"))
* [includes/modules/core\_extensions/wpext\_export\_users/wpext\_export\_users.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?rev=3145393 "Show entry in browser")
  (modified)
  ([2 diffs](#file8 "Show differences"))
* [includes/modules/core\_extensions/wpext\_external\_permalinks/wpext\_external\_permalinks.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_external_permalinks/wpext_external_permalinks.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [includes/modules/core\_extensions/wpext\_hide\_admin\_bar/wpext\_hide\_admin\_bar.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_hide_admin_bar/wpext_hide_admin_bar.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [includes/modules/core\_extensions/wpext\_limit\_login\_attempts/wpext\_limit\_login\_attempts.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_limit_login_attempts/wpext_limit_login_attempts.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [includes/modules/core\_extensions/wpext\_maintenance\_mode/wpext\_maintenance\_mode.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_maintenance_mode/wpext_maintenance_mode.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [includes/modules/core\_extensions/wpext\_pixel\_tag\_manager/wpext\_pixel\_tag\_manager.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_pixel_tag_manager/wpext_pixel_tag_manager.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [includes/modules/core\_extensions/wpext\_post\_order/wpext\_post\_order.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_post_order/wpext_post_order.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [includes/modules/core\_extensions/wpext\_smtp\_email/wpext\_smtp\_email.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_smtp_email/wpext_smtp_email.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [includes/modules/core\_extensions/wpext\_snippets/old/wpext\_snippets.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?rev=3145393 "Show entry in browser")
  (modified)
  ([2 diffs](#file16 "Show differences"))
* [includes/modules/core\_extensions/wpext\_snippets/wp-extend-module-listing.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3145393 "Show entry in browser")
  (modified)
  ([3 diffs](#file17 "Show differences"))
* [includes/modules/core\_extensions/wpext\_snippets/wpext\_snippets.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3145393 "Show entry in browser")
  (modified)
  ([4 diffs](#file18 "Show differences"))
* [includes/modules/core\_extensions/wpext\_tidy\_nav/wpext\_tidy\_nav.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_tidy_nav/wpext_tidy_nav.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file19 "Show differences"))
* [includes/modules/core\_extensions/wpext\_user\_sections/wpext\_user\_sections.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_user_sections/wpext_user_sections.php?rev=3145393 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [readme.txt](/browser/wpextended/trunk/readme.txt?rev=3145393 "Show entry in browser")
  (modified)
  ([3 diffs](#file21 "Show differences"))
* [wp-extended.php](/browser/wpextended/trunk/wp-extended.php?rev=3145393 "Show entry in browser")
  (modified)
  ([2 diffs](#file22 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wpextended/trunk/admin/class-wp-extended-admin.php](/changeset/3145393/wpextended/trunk/admin/class-wp-extended-admin.php?old=3131199&old_path=wpextended%2Ftrunk%2Fadmin%2Fclass-wp-extended-admin.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/admin/class-wp-extended-admin.php")

  | [r3134345](/browser/wpextended/trunk/admin/class-wp-extended-admin.php?rev=3131199#L41 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/admin/class-wp-extended-admin.php?rev=3145393#L41 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 41 | 41 | add\_action('admin\_enqueue\_scripts', array( $this, 'enqueue\_styles' ) ); |
  | 42 | 42 | add\_action('admin\_enqueue\_scripts', array( $this, 'enqueue\_scripts' ), 99 ); |
  | 43 |  |  |
  | 44 | 43 | add\_action('wp\_ajax\_wp-extended-module-toggle',   array( $this, 'module\_toggle\_ajax') ); |
  | 45 |  | ~~add\_action('wp\_ajax\_wp-extended-module-all-toggle',   array( $this, 'module\_all\_toggle\_ajax') );~~ |
  | 46 | 44 | add\_action('wpext\_plugin\_sidebar', array( $this, 'admin\_plugin\_info\_sidebar' ), 100 ); |
  | 47 | 45 | add\_action('admin\_plugin\_top\_info', array( $this, 'wpext\_admin\_plugin\_top\_info' ), 100 ); |
  | […](/browser/wpextended/trunk/admin/class-wp-extended-admin.php?rev=3131199#L255) | […](/browser/wpextended/trunk/admin/class-wp-extended-admin.php?rev=3145393#L253) |  |
  | 255 | 253 | include \_\_DIR\_\_ . '/partials/wp-extend-admin-display.php'; |
  | 256 | 254 | } // admin\_display |
  | 257 |  |  |
  | 258 |  | /\* |
  | 259 |  | \* AJAX endpoint for all module activation/dectivation |
  | 260 |  | \*/ |
  | 261 |  |  |
  | 262 |  | public function module\_all\_toggle\_ajax(){ |
  | 263 |  |  |
  | 264 |  | $status = $\_POST['status']; |
  | 265 |  | $allaction = $\_POST['allaction']; |
  | 266 |  |  |
  | 267 |  | $groups = $this->groups(); |
  | 268 |  | $modules = $this->modules(); |
  | 269 |  |  |
  | 270 |  | update\_option( $allaction, $status); |
  | 271 |  | $response = get\_option( $allaction); |
  | 272 |  |  |
  | 273 |  | foreach ($modules['core\_extensions'] as  $modulename) { |
  | 274 |  | $module = $modulename['dirname']; |
  | 275 |  | if ($modulename['available']){ |
  | 276 |  | $this->module\_toggle( $module, $status ); |
  | 277 |  | } |
  | 278 |  | } |
  | 279 |  | wp\_send\_json( $response ); |
  | 280 |  | die('0'); |
  | 281 |  | } |
  |  | 255 |  |
  | 282 | 256 | /\* |
  | 283 | 257 | \* AJAX endpoint for module activation |
* ## [wpextended/trunk/admin/js/wp\_extended-admin.js](/changeset/3145393/wpextended/trunk/admin/js/wp_extended-admin.js?old=3131199&old_path=wpextended%2Ftrunk%2Fadmin%2Fjs%2Fwp_extended-admin.js "Show the [3134345:3145430] differences restricted to wpextended/trunk/admin/js/wp_extended-admin.js")

  | [r3134345](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3131199#L541 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3145393#L541 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 541 | 541 | .attr('onclick') |
  | 542 | 542 | .match(/'([^']+)'/)[1]; |
  | 543 |  |  |
  |  | 543 |  |
  | 544 | 544 | jQuery('.item.list-group-item, .item.grid-group-item').each(function () { |
  | 545 | 545 | var checkbox = jQuery(this).find('.form-check-input'); |
  | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3131199#L582) | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3145393#L582) |  |
  | 582 | 582 |  |
  | 583 | 583 | var urlParams = new URLSearchParams(window.location.search); |
  | 584 |  | if (urlParams.get('page') === 'wp-extended') { |
  |  | 584 | if (urlParams.get('page') === 'wp-extended') { |
  | 585 | 585 | // Attach the change event listener to the Active Modules checkbox |
  | 586 | 586 | jQuery('#wpext\_active\_modules').change(function () { |
  | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3131199#L595) | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3145393#L595) |  |
  | 595 | 595 | } |
  | 596 | 596 |  |
  |  | 597 | // Delay the visibility toggle when the page reloads |
  |  | 598 | setTimeout(function() { |
  |  | 599 | toggleItemsVisibility(); |
  |  | 600 | }, 100); |
  |  | 601 |  |
  | 597 | 602 | jQuery('#wpext\_active\_modules').on('change', function () { |
  | 598 | 603 | var isChecked = this.checked; |
  | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3131199#L608) | […](/browser/wpextended/trunk/admin/js/wp_extended-admin.js?rev=3145393#L613) |  |
  | 608 | 613 | }); |
  | 609 | 614 | }); |
  |  | 615 |  |
  |  | 616 | /\*Hide show active module \*/ |
  |  | 617 | jQuery(document).ready(function($) { |
  |  | 618 | // Function to toggle visibility of the container based on checkboxes' state |
  |  | 619 | function toggleActiveModulesContainer() { |
  |  | 620 | var $checkboxes = $('.wpext\_toggle\_settings .card-footer input[type="checkbox"]'); |
  |  | 621 | var $activeModulesContainer = $('.wpext\_toggle\_settings .wpext\_active\_modules\_container'); |
  |  | 622 | var anyChecked = $checkboxes.is(':checked'); |
  |  | 623 | if (anyChecked) { |
  |  | 624 | $activeModulesContainer.show(); |
  |  | 625 | } else { |
  |  | 626 | $activeModulesContainer.hide(); |
  |  | 627 | } |
  |  | 628 | } |
  |  | 629 | $('.wpext\_toggle\_settings .card-footer input[type="checkbox"]').click(function() { |
  |  | 630 | toggleActiveModulesContainer(); |
  |  | 631 | }); |
  |  | 632 |  |
  |  | 633 | // Initial call to set the correct visibility based on checkbox states |
  |  | 634 | toggleActiveModulesContainer(); |
  |  | 635 | }); |
  |  | 636 | /\*Hide show active module end here \*/ |
* ## [wpextended/trunk/admin/partials/wp-extend-admin-display.php](/changeset/3145393/wpextended/trunk/admin/partials/wp-extend-admin-display.php?old=3131199&old_path=wpextended%2Ftrunk%2Fadmin%2Fpartials%2Fwp-extend-admin-display.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/admin/partials/wp-extend-admin-display.php")

  | [r3134345](/browser/wpextended/trunk/admin/partials/wp-extend-admin-display.php?rev=3131199#L72 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/admin/partials/wp-extend-admin-display.php?rev=3145393#L72 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 72 | 72 | </div> |
  | 73 | 73 | <div class="wpext\_active\_modules\_container me-lg-3"> |
  | 74 |  | <label for="wpext\_active\_modules" class="mt-1"><?php \_e('Active Modules',WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
  | 75 |  | <div class="field form-check form-switch form-switch-md"> |
  | 76 |  | <?php |
  | 77 |  | $action\_module\_status = get\_option('wpext\_active\_modules\_status'); |
  | 78 |  |  |
  | 79 |  | if($action\_module\_status == 'true'){ |
  | 80 |  | $status = 'checked'; |
  | 81 |  | }else{ |
  | 82 |  | $status = ''; |
  | 83 |  | } |
  | 84 |  | ?> |
  | 85 |  | <input id="wpext\_active\_modules" name="wpext\_active\_modules" type="checkbox" class="form-check-input" <?php echo $status; ?> role="switch"> |
  | 86 |  | </div> |
  | 87 |  | </div> |
  |  | 74 | <?php |
  |  | 75 | $wpext\_module\_status = get\_option('wp-extended-modules'); |
  |  | 76 | $has\_displayed = false; |
  |  | 77 | foreach($wpext\_module\_status as $key => $module\_status) { |
  |  | 78 | if(!empty($module\_status) && !$has\_displayed) { ?> |
  |  | 79 | <label for="wpext\_active\_modules" class="mt-1"><?php \_e('Active Modules', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
  |  | 80 | <div class="field form-check form-switch form-switch-md"> |
  |  | 81 | <?php |
  |  | 82 | $action\_module\_status = get\_option('wpext\_active\_modules\_status'); |
  |  | 83 | if($action\_module\_status == 'true'){ |
  |  | 84 | $status = 'checked'; |
  |  | 85 | } else { |
  |  | 86 | $status = ''; |
  |  | 87 | } |
  |  | 88 | ?> |
  |  | 89 | <input id="wpext\_active\_modules" name="wpext\_active\_modules" type="checkbox" class="form-check-input" <?php echo $status; ?>  role="switch"> |
  |  | 90 | </div> |
  |  | 91 | <?php |
  |  | 92 | $has\_displayed = true; // Set the flag to true to prevent further display |
  |  | 93 | } |
  |  | 94 | } ?> |
  |  | 95 | </div> |
  | 88 | 96 | </div> |
  | 89 | 97 | <!-- end grid section --> |
* ## [wpextended/trunk/includes/libraries/wpext\_export/wpext\_export.php](/changeset/3145393/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?old=3134252&old_path=wpextended%2Ftrunk%2Fincludes%2Flibraries%2Fwpext_export%2Fwpext_export.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/libraries/wpext_export/wpext_export.php")

  | [r3134345](/browser/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?rev=3134252#L136 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?rev=3145393#L136 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 136 | 136 |  |
  | 137 | 137 | public function download\_file\_ajax(){ |
  | 138 |  | $filename = $\_GET['filename']; |
  | 139 |  |  |
  |  | 138 |  |
  |  | 139 | /\* Security Issues fixed \*/ |
  |  | 140 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 141 | wp\_send\_json\_error( \_\_( 'You do not have permission to access this file.', WP\_EXTENDED\_TEXT\_DOMAIN ) ); |
  |  | 142 | wp\_die(); |
  |  | 143 | } |
  |  | 144 | // Verify the nonce for security. |
  |  | 145 | check\_ajax\_referer( 'wpext-ajax-nonce', 'wpext\_nonce' ); |
  |  | 146 |  |
  |  | 147 | // Sanitize the filename. |
  |  | 148 | $filename = isset( $\_GET['filename'] ) ? sanitize\_file\_name( $\_GET['filename'] ) : ''; |
  |  | 149 |  |
  |  | 150 | if ( empty( $filename ) ) { |
  |  | 151 | wp\_send\_json\_error( \_\_( 'Invalid file request.', WP\_EXTENDED\_TEXT\_DOMAIN ) ); |
  |  | 152 | wp\_die(); |
  |  | 153 | } |
  |  | 154 | /\* Security Issues fixed end here\*/ |
  |  | 155 |  |
  | 140 | 156 | $sent = $this->download\_file( $filename ); |
  | 141 |  |  |
  | 142 | 157 | if( $sent !== true ) { |
  | 143 | 158 | wp\_send\_json( $sent ); |
  | […](/browser/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?rev=3134252#L152) | […](/browser/wpextended/trunk/includes/libraries/wpext_export/wpext_export.php?rev=3145393#L167) |  |
  | 152 | 167 | try { |
  | 153 | 168 | $dir = $this->\_get\_files\_dir(); |
  | 154 |  |  |
  | 155 |  |  |
  | 156 |  | $file\_path = $dir . "/" . $filename; |
  | 157 |  |  |
  | 158 |  |  |
  |  | 169 | $file\_path = realpath( $dir . '/' . $filename ); |
  |  | 170 |  |
  | 159 | 171 | if( !file\_exists( $file\_path ) ) { |
  | 160 | 172 | throw new \Exception( "File not found" ); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_block\_user\_name\_admin/wpext\_block\_user\_name\_admin.php](/changeset/3145430/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_block_user_name_admin%2Fwpext_block_user_name_admin.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?rev=3099195#L21 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?rev=3145430#L21 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | 23 |  | public function wpext\_check\_the\_current\_username(){ |
  | 24 |  | $admin\_user = get\_user\_by('login', 'admin'); |
  | 25 |  | if ($admin\_user) { |
  | 26 |  | add\_action('admin\_notices', array($this, 'wpext\_admin\_notice')); |
  | 27 |  | } |
  |  | 23 | public function wpext\_check\_the\_current\_username() { |
  |  | 24 | $admin\_user = get\_user\_by('login', 'admin'); |
  |  | 25 | $user = wp\_get\_current\_user(); |
  |  | 26 | $roles = is\_array($user->roles) ? $user->roles : array(); |
  |  | 27 | // Validate that the current user is an administrator and the 'admin' user exists |
  |  | 28 | if ($admin\_user && isset($roles[0]) && sanitize\_text\_field($roles[0]) === 'administrator') { |
  |  | 29 | add\_action('admin\_notices', array($this, 'wpext\_admin\_notice')); |
  |  | 30 | } |
  | 28 | 31 | } |
  | 29 | 32 |  |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?rev=3099195#L49) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_block_user_name_admin/wpext_block_user_name_admin.php?rev=3145430#L52) |  |
  | 49 | 52 | public function wpext\_change\_admin\_name(){ |
  | 50 | 53 | global $wpdb; |
  | 51 |  | if( ! wp\_verify\_nonce(sanitize\_text\_field($\_REQUEST['nonce']), 'wpext-nonce' ) ) { |
  | 52 |  | $result = array( |
  | 53 |  | 'status' => false, |
  | 54 |  | 'error' => \_\_( 'Invalid nonce!', WP\_EXTENDED\_TEXT\_DOMAIN ) |
  | 55 |  | ); |
  | 56 |  | wp\_send\_json( $result ); |
  | 57 |  | die(); |
  |  | 54 |  |
  |  | 55 | // Verify nonce |
  |  | 56 |  |
  |  | 57 | if ( ! isset( $\_REQUEST['nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_REQUEST['nonce'] ), 'wpext-nonce' ) ) { |
  |  | 58 | wp\_send\_json( array( 'status' => false, 'error' => \_\_( 'Invalid nonce!', WP\_EXTENDED\_TEXT\_DOMAIN ) ) ); |
  |  | 59 | die(); |
  | 58 | 60 | } |
  |  | 61 |  |
  |  | 62 | // Capability check: Allow only administrators |
  |  | 63 |  |
  |  | 64 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 65 | wp\_send\_json( array( 'status' => false, 'error' => \_\_( 'You do not have sufficient permissions to perform this action.', WP\_EXTENDED\_TEXT\_DOMAIN ) ) ); |
  |  | 66 | die(); |
  |  | 67 | } |
  |  | 68 |  |
  | 59 | 69 | $new\_username = sanitize\_text\_field($\_POST['username']); |
  | 60 | 70 | $admin\_user = get\_user\_by('login', 'admin'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_change\_wp\_admin\_url/wpext\_change\_wp\_admin\_url.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_change_wp_admin_url/wpext_change_wp_admin_url.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_change_wp_admin_url%2Fwpext_change_wp_admin_url.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_change_wp_admin_url/wpext_change_wp_admin_url.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_change_wp_admin_url/wpext_change_wp_admin_url.php?rev=3099195#L93 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_change_wp_admin_url/wpext_change_wp_admin_url.php?rev=3145393#L93 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 93 | 93 | $slug = 'wp-extended-changes-wp-admin-url'; |
  | 94 | 94 | $callback = [ get\_called\_class(), 'settings\_changes\_wp\_admin\_url']; |
  | 95 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 95 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 96 | 96 | add\_rewrite\_rule('^wp-extended-changes-wp-admin-url/?', 'index.php?wp\_extended\_changes\_wp\_admin-url=1', 'top'); |
  | 97 | 97 | add\_rewrite\_tag('%wp\_extended\_changes\_wp\_admin%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_duplicate\_menu/wpext\_duplicate\_menu.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_duplicate_menu/wpext_duplicate_menu.php?old=3112929&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_duplicate_menu%2Fwpext_duplicate_menu.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_duplicate_menu/wpext_duplicate_menu.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicate_menu/wpext_duplicate_menu.php?rev=3112929#L62 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicate_menu/wpext_duplicate_menu.php?rev=3145393#L62 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | $capability = 'manage\_options'; |
  | 63 | 63 | $callback = [get\_called\_class(), 'settings\_duplicate\_menu']; |
  | 64 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 64 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 65 | 65 | add\_rewrite\_rule('^wp-extended-duplicate-menu/?', 'index.php?wp\_extended\_duplicate\_menu=1', 'top'); |
  | 66 | 66 | add\_rewrite\_tag('%wp\_extended\_duplicate\_menu%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_duplicator/wpext\_duplicator.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_duplicator%2Fwpext_duplicator.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3099195#L24 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3145393#L24 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 |  |
  | 25 | 25 | try { |
  | 26 |  | if ( ! wp\_verify\_nonce( $\_REQUEST['wpext\_nonce'], 'wpext-ajax-nonce' ) ) { |
  | 27 |  | throw new \Exception( "Invalid nonce!" ); |
  | 28 |  | } |
  | 29 |  | $post\_ID = intval($\_REQUEST['post\_ID']); |
  | 30 |  | if( empty($post\_ID) ) { |
  | 31 |  | throw new \Exception( "Post ID not specified" ); |
  | 32 |  | } |
  | 33 |  | $duplicate = $this->duplicate\_post( $post\_ID ); |
  | 34 |  | if( is\_wp\_error( $duplicate ) ) { |
  | 35 |  | throw new \Exception( $duplicate->get\_error\_message() ); |
  | 36 |  | } |
  | 37 |  | $duplicate->url = get\_the\_permalink( $duplicate->ID ); |
  | 38 |  | $duplicate->edit\_url = get\_edit\_post\_link( $duplicate, 'json' ); |
  | 39 |  | $result = array( 'status' => true, 'duplicate' => $duplicate ); |
  |  | 26 | if ( ! current\_user\_can( 'edit\_post', $post\_ID ) ) { |
  |  | 27 | throw new \Exception( \_\_( "You are not allowed to duplicate this post.", WP\_EXTENDED\_TEXT\_DOMAIN ) ); |
  |  | 28 | } |
  |  | 29 | if ( ! wp\_verify\_nonce( $\_REQUEST['wpext\_nonce'], 'wpext-ajax-nonce' ) ) { |
  |  | 30 | throw new \Exception( "Invalid nonce!" ); |
  |  | 31 | } |
  |  | 32 | $post\_ID = intval($\_REQUEST['post\_ID']); |
  |  | 33 | if( empty($post\_ID) ) { |
  |  | 34 | throw new \Exception( "Post ID not specified" ); |
  |  | 35 | } |
  |  | 36 | $duplicate = $this->duplicate\_post( $post\_ID ); |
  |  | 37 | if( is\_wp\_error( $duplicate ) ) { |
  |  | 38 | throw new \Exception( $duplicate->get\_error\_message() ); |
  |  | 39 | } |
  |  | 40 | $duplicate->url = get\_the\_permalink( $duplicate->ID ); |
  |  | 41 | $duplicate->edit\_url = get\_edit\_post\_link( $duplicate, 'json' ); |
  |  | 42 | $result = array( 'status' => true, 'duplicate' => $duplicate ); |
  | 40 | 43 | } |
  | 41 | 44 | catch( \Exception $e ) { |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3099195#L47) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3145393#L50) |  |
  | 47 | 50 |  |
  | 48 | 51 | public function duplicate\_post( $post\_ID ) { |
  |  | 52 |  |
  | 49 | 53 | try { |
  | 50 |  | if~~( !current\_user\_can('edit\_posts'~~) ) { |
  | 51 |  | throw new \Exception( ~~"Not allowed"~~ ); |
  |  | 54 | if ( ! current\_user\_can( 'edit\_post', $post\_ID ) ) { |
  |  | 55 | throw new \Exception( \_\_( "You are not allowed to duplicate this post.", WP\_EXTENDED\_TEXT\_DOMAIN ) ); |
  | 52 | 56 | } |
  | 53 | 57 | if( empty($post\_ID) ) { |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3099195#L58) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3145393#L62) |  |
  | 58 | 62 | throw new \Exception( "Source post not found" ); |
  | 59 | 63 | } |
  |  | 64 | // Ensure that contributors can't duplicate password-protected posts. |
  |  | 65 | if ( 'private' === $post->post\_status && ! current\_user\_can( 'read\_private\_posts' ) ) { |
  |  | 66 | throw new \Exception( \_\_( "You cannot duplicate this private post.", WP\_EXTENDED\_TEXT\_DOMAIN ) ); |
  |  | 67 | } |
  |  | 68 |  |
  | 60 | 69 | // copy |
  | 61 | 70 | $newPost = json\_decode( json\_encode($post), true ); |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3099195#L64) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_duplicator/wpext_duplicator.php?rev=3145393#L73) |  |
  | 64 | 73 | 'comment\_status' => $post->comment\_status, |
  | 65 | 74 | 'ping\_status'    => $post->ping\_status, |
  | 66 |  | 'post\_author'    => ~~$new\_post\_author~~, |
  |  | 75 | 'post\_author'    => get\_current\_user\_id(), |
  | 67 | 76 | 'post\_content'   => $post->post\_content, |
  | 68 | 77 | 'post\_excerpt'   => $post->post\_excerpt, |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_export\_users/wpext\_export\_users.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?old=3112929&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_export_users%2Fwpext_export_users.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?rev=3112929#L53 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?rev=3145393#L53 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 53 | 53 | } // get\_items |
  | 54 | 54 | public function download\_user\_ajax(){ |
  |  | 55 | check\_ajax\_referer('wpext-ajax-nonce', 'wpext\_nonce'); |
  |  | 56 | if (!current\_user\_can('export')) { |
  |  | 57 | wp\_send\_json\_error(\_\_('You do not have permission to export users.', WP\_EXTENDED\_TEXT\_DOMAIN)); |
  |  | 58 | wp\_die(); |
  |  | 59 | } |
  | 55 | 60 | try { |
  | 56 |  | $id = $\_GET['id']; |
  | 57 |  | $format = !empty($\_GET['format']) ? $\_GET['format'] : 'csv'; |
  |  | 61 | $id = isset($\_GET['id']) ? intval($\_GET['id']) : 0; |
  |  | 62 | $format = !empty($\_GET['format']) ? sanitize\_text\_field($\_GET['format']) : 'csv'; |
  |  | 63 |  |
  | 58 | 64 | $user = get\_userdata( $id ); |
  | 59 | 65 | if( !$user ) { |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?rev=3112929#L79) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_export_users/wpext_export_users.php?rev=3145393#L85) |  |
  | 79 | 85 | wp\_die(); |
  | 80 | 86 | } // download\_user\_ajax |
  |  | 87 |  |
  | 81 | 88 | public function profile\_button( $user ) { |
  |  | 89 | if (!current\_user\_can('edit\_user', $user->ID)) { |
  |  | 90 | return; |
  |  | 91 | } |
  | 82 | 92 | $actions = $this->add\_export\_action( array(), $user ); |
  | 83 | 93 | ?> |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_external\_permalinks/wpext\_external\_permalinks.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_external_permalinks/wpext_external_permalinks.php?old=3105485&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_external_permalinks%2Fwpext_external_permalinks.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_external_permalinks/wpext_external_permalinks.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_external_permalinks/wpext_external_permalinks.php?rev=3105485#L58 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_external_permalinks/wpext_external_permalinks.php?rev=3145393#L58 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 58 | 58 | $slug = 'wp-extended-external\_permalink'; |
  | 59 | 59 | $callback = [ get\_called\_class(), 'wpext\_external\_permalink\_interface']; |
  | 60 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 60 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 61 | 61 | add\_rewrite\_rule('^wp-extended-external\_permalink/?', 'index.php?wp\_extended\_external\_permalink=1', 'top'); |
  | 62 | 62 | add\_rewrite\_tag('%wp\_extended\_external\_permalink%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_hide\_admin\_bar/wpext\_hide\_admin\_bar.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_hide_admin_bar/wpext_hide_admin_bar.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_hide_admin_bar%2Fwpext_hide_admin_bar.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_hide_admin_bar/wpext_hide_admin_bar.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_hide_admin_bar/wpext_hide_admin_bar.php?rev=3099195#L48 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_hide_admin_bar/wpext_hide_admin_bar.php?rev=3145393#L48 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 48 | 48 | $slug = 'wp-extended-hide-adminbar'; |
  | 49 | 49 | $callback = [ get\_called\_class(), 'settings\_hide\_admin\_bar']; |
  | 50 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 50 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 51 | 51 | add\_rewrite\_rule('^wp-extended-hide-adminbar/?', 'index.php?wp\_extended\_hide\_adminbar=1', 'top'); |
  | 52 | 52 | add\_rewrite\_tag('%wp\_extended\_hide\_adminbar%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_limit\_login\_attempts/wpext\_limit\_login\_attempts.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_limit_login_attempts/wpext_limit_login_attempts.php?old=3109167&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_limit_login_attempts%2Fwpext_limit_login_attempts.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_limit_login_attempts/wpext_limit_login_attempts.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_limit_login_attempts/wpext_limit_login_attempts.php?rev=3109167#L56 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_limit_login_attempts/wpext_limit_login_attempts.php?rev=3145393#L56 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 56 | 56 | $slug = 'wp-extended\_login\_attempt'; |
  | 57 | 57 | $callback = [ get\_called\_class(), 'settings\_admin\_login\_attempt']; |
  | 58 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 58 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 59 | 59 | add\_rewrite\_rule('^wp-extended\_login\_attempt/?', 'index.php?wp\_extended\_login\_attempt=1', 'top'); |
  | 60 | 60 | add\_rewrite\_tag('%wp\_extended\_login\_attempt%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_maintenance\_mode/wpext\_maintenance\_mode.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_maintenance_mode/wpext_maintenance_mode.php?old=3112929&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_maintenance_mode%2Fwpext_maintenance_mode.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_maintenance_mode/wpext_maintenance_mode.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_maintenance_mode/wpext_maintenance_mode.php?rev=3112929#L92 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_maintenance_mode/wpext_maintenance_mode.php?rev=3145393#L92 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 92 | 92 | $slug = 'wp-extended-maintenance-mode'; |
  | 93 | 93 | $callback = [ get\_called\_class(), 'settings\_admin\_maintenance\_mode']; |
  | 94 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 94 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 95 | 95 | add\_rewrite\_rule('^wp-extended-maintenance-mode/?', 'index.php?wp\_extended\_maintenance\_mode=1', 'top'); |
  | 96 | 96 | add\_rewrite\_tag('%wp\_extended\_maintenance\_mode%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_pixel\_tag\_manager/wpext\_pixel\_tag\_manager.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_pixel_tag_manager/wpext_pixel_tag_manager.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_pixel_tag_manager%2Fwpext_pixel_tag_manager.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_pixel_tag_manager/wpext_pixel_tag_manager.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_pixel_tag_manager/wpext_pixel_tag_manager.php?rev=3099195#L48 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_pixel_tag_manager/wpext_pixel_tag_manager.php?rev=3145393#L48 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 48 | 48 | $capability = 'manage\_options'; |
  | 49 | 49 | $callback = [get\_called\_class(), 'settings\_pixel\_tag\_manager']; |
  | 50 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 50 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 51 | 51 | add\_rewrite\_rule('^wp-extended-pixel-tag-manager/?', 'index.php?wp\_extended\_pixel\_tag\_manager=1', 'top'); |
  | 52 | 52 | add\_rewrite\_tag('%wp\_extended\_pixel\_tag\_manager%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_post\_order/wpext\_post\_order.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_post_order/wpext_post_order.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_post_order%2Fwpext_post_order.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_post_order/wpext_post_order.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_post_order/wpext_post_order.php?rev=3099195#L80 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_post_order/wpext_post_order.php?rev=3145393#L80 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 80 | 80 | $query .= ( $query ? "&" : "" ) . $extra; |
  | 81 | 81 | $url = $path . "?" . $query; |
  | 82 |  | wp\_redirect( $url, 302, 'WP-Extended-Post-order' ); |
  | 83 |  | exit; |
  |  | 82 | if($screen->post\_type != 'page'){ |
  |  | 83 | wp\_redirect($url, 302, 'WP-Extended-Post-order'); |
  |  | 84 | exit; |
  |  | 85 | } |
  | 84 | 86 | } |
  | 85 | 87 | else if( $\_REQUEST['orderby'] === 'menu\_order' ) { |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_smtp\_email/wpext\_smtp\_email.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_smtp_email/wpext_smtp_email.php?old=3131199&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_smtp_email%2Fwpext_smtp_email.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_smtp_email/wpext_smtp_email.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_smtp_email/wpext_smtp_email.php?rev=3131199#L37 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_smtp_email/wpext_smtp_email.php?rev=3145393#L37 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 37 | 37 | $callback = [$this, 'wp\_extended\_smtp\_settings\_page']; |
  | 38 | 38 | $icon = 'dashicons-admin-plugins'; |
  | 39 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 39 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 40 | 40 | add\_rewrite\_rule('^wp-extended\_smtp-settings/?', 'index.php?wp\_extended\_smtp-settings=1', 'top'); |
  | 41 | 41 | add\_rewrite\_tag('%wp\_extended\_smtp-settings%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_snippets/old/wpext\_snippets.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?old=3128457&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_snippets%2Fold%2Fwpext_snippets.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?rev=3128457#L42 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?rev=3145393#L42 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 42 | 42 | if((isset($menustatus) && $menustatus == 'true') && !empty($flagfavorite) ) { |
  | 43 | 43 | add\_submenu\_page( |
  | 44 |  | ~~null~~, |
  |  | 44 | '', |
  | 45 | 45 | \_\_( 'Code Snippets Old', WP\_EXTENDED\_TEXT\_DOMAIN ), // page title |
  | 46 | 46 | \_\_( 'Code Snippets Old', WP\_EXTENDED\_TEXT\_DOMAIN ), // menu title |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?rev=3128457#L52) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/old/wpext_snippets.php?rev=3145393#L52) |  |
  | 52 | 52 | $slug = 'wp-extended-snippets-old'; |
  | 53 | 53 | $callback = [ $this, 'page\_cb\_old']; |
  | 54 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 54 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 55 | 55 | add\_rewrite\_rule('^wp-extended-snippets-old/?', 'index.php?wp\_extended\_snippets=1', 'top'); |
  | 56 | 56 | add\_rewrite\_tag('%wp\_extended\_snippets%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_snippets/wp-extend-module-listing.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?old=3134252&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_snippets%2Fwp-extend-module-listing.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3134252#L113 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3145393#L113 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 113 | 113 | if ('duplicate' === $this->current\_action() && isset($\_GET['snippet\_id'])) { |
  | 114 | 114 | $nonce = $\_REQUEST['\_wpnonce']; |
  | 115 |  | if (~~!wp\_verify\_nonce($nonce, 'duplicate\_snippet\_' . $\_GET['snippet\_id'])~~) { |
  |  | 115 | if ( !wp\_verify\_nonce( $nonce, 'duplicate\_snippet\_' . sanitize\_text\_field( $\_GET['snippet\_id'] ) ) ) { |
  | 116 | 116 | die('Security check failed'); |
  | 117 | 117 | } |
  | 118 |  | $this->duplicate\_snippet(~~$\_GET['snippet\_id']~~); |
  |  | 118 | $this->duplicate\_snippet( sanitize\_text\_field($\_GET['snippet\_id']) ); |
  | 119 | 119 | } |
  | 120 | 120 | } |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3134252#L155) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3145393#L155) |  |
  | 155 | 155 | public function current\_action() { |
  | 156 | 156 | if (isset($\_REQUEST['action']) && $\_REQUEST['action'] !== -1) { |
  | 157 |  | return ~~$\_REQUEST['action']~~; |
  |  | 157 | return sanitize\_key($\_REQUEST['action']); |
  | 158 | 158 | } |
  | 159 | 159 |  |
  | 160 | 160 | if (isset($\_REQUEST['action2']) && $\_REQUEST['action2'] !== -1) { |
  | 161 |  | return ~~$\_REQUEST['action2']~~; |
  |  | 161 | return sanitize\_key($\_REQUEST['action2']); |
  | 162 | 162 | } |
  | 163 | 163 |  |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3134252#L214) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wp-extend-module-listing.php?rev=3145393#L214) |  |
  | 214 | 214 | $items = $custom\_list\_table->get\_items(); ?> |
  | 215 | 215 | <form method="get"> |
  | 216 |  | <input type="hidden" name="page" value="<?php echo ~~$\_REQUEST['page']~~; ?>"> |
  |  | 216 | <input type="hidden" name="page" value="<?php echo esc\_attr( sanitize\_text\_field( $\_REQUEST['page'] ) ); ?>"> |
  | 217 | 217 | <?php $custom\_list\_table->search\_box('Search Snippets', 'search\_id'); ?> |
  | 218 | 218 | </form> |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_snippets/wpext\_snippets.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?old=3128457&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_snippets%2Fwpext_snippets.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3128457#L104 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3145393#L104 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 104 | 104 | $slug = 'wp-extended-snippets'; |
  | 105 | 105 | $callback = [ $this, 'list\_snippets\_page']; |
  | 106 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 106 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 107 | 107 | add\_rewrite\_rule('^wp-extended-snippets/?', 'index.php?wp\_extended\_snippets=1', 'top'); |
  | 108 | 108 | add\_rewrite\_tag('%wp\_extended\_snippets%', '([^&]+)'); |
  | 109 | 109 | } |
  | 110 |  | add\_submenu\_page(~~null~~, \_\_('Add New Snippet', 'wp-extended-snippets'), \_\_('Add New Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-add-snippet', array($this, 'wpext\_add\_snippet\_page')); |
  | 111 |  | add\_submenu\_page(~~null~~, \_\_('Edit Snippet', 'wp-extended-snippets'), \_\_('Edit Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-edit-snippet', array($this, 'edit\_snippet\_page')); |
  |  | 110 | add\_submenu\_page('', \_\_('Add New Snippet', 'wp-extended-snippets'), \_\_('Add New Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-add-snippet', array($this, 'wpext\_add\_snippet\_page')); |
  |  | 111 | add\_submenu\_page('', \_\_('Edit Snippet', 'wp-extended-snippets'), \_\_('Edit Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-edit-snippet', array($this, 'edit\_snippet\_page')); |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3128457#L291) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3145393#L291) |  |
  | 291 | 291 | <div class="wpext\_snippet\_top\_section d-flex mb-3"> |
  | 292 | 292 | <div class="col-3"> |
  | 293 |  | <h2 class="wpext\_snippet\_title"> <?php echo $selected\_option = isset($\_GET['selected\_option']) ? $\_GET['selected\_option'] : ''; ?></h2> |
  |  | 293 | <h2 class="wpext\_snippet\_title"> |
  |  | 294 | <?php |
  |  | 295 | $selected\_option = isset($\_GET['selected\_option']) ? sanitize\_text\_field($\_GET['selected\_option']) : ''; |
  |  | 296 | echo esc\_html($selected\_option); |
  |  | 297 | ?> |
  |  | 298 | </h2> |
  | 294 | 299 | <?php self::wpext\_custom\_css\_content($selected\_option); ?> |
  | 295 | 300 | <input type="hidden" name="snippet\_position" value="<?php echo $selected\_option; ?>" id="snippet\_code\_type"> |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3128457#L548) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3145393#L553) |  |
  | 548 | 553 | } |
  | 549 | 554 | // Additional check for the specific snippets page |
  | 550 |  | if ($pagenow === 'admin.php' && isset($\_GET['page']) && ~~$\_GET['page']~~ === 'wp-extended-snippets') { |
  |  | 555 | if ($pagenow === 'admin.php' && isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) === 'wp-extended-snippets') { |
  | 551 | 556 | return false; |
  | 552 | 557 | } |
  | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3128457#L680) | […](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3145393#L685) |  |
  | 680 | 685 | <div class="col-lg-6 wp\_brand\_sub\_header\_right mx-lg-0 px-2"> |
  | 681 | 686 | <div class="wpext-return-module-wrap wpext\_snippet\_action"> |
  | 682 |  | <?php if(isset($\_GET['page']) && ~~$\_GET['page']~~ == 'wp-extended-snippets') { ?> |
  |  | 687 | <?php if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-snippets') { ?> |
  | 683 | 688 | <button class="page-title-action wp-ext-btn-prim" ><?php \_e('Add New', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
  | 684 | 689 | <?php } ?> |
  | 685 |  | <?php if(isset($\_GET['page']) && ~~$\_GET['page']~~ == 'wp-extended-add-snippet') { ?> |
  |  | 690 | <?php if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-add-snippet') { ?> |
  | 686 | 691 | <a href='<?php echo admin\_url('admin.php?page=wp-extended-snippets'); ?>' class="wp-ext-btn-sec"><?php \_e('Back to Snippets', WP\_EXTENDED\_TEXT\_DOMAIN);?></a> |
  | 687 | 692 | <button class="wpext\_module\_action wp-ext-btn-prim wpext\_save\_snippet" ><?php \_e('Save', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
  | 688 | 693 | <?php } |
  | 689 |  | if(isset($\_GET['page']) && ~~$\_GET['page']~~ == 'wp-extended-edit-snippet') { ?> |
  |  | 694 | if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-edit-snippet') { ?> |
  | 690 | 695 | <a href='<?php echo admin\_url('admin.php?page=wp-extended-snippets'); ?>' class="wp-ext-btn-sec"><?php \_e('Back to Snippets', WP\_EXTENDED\_TEXT\_DOMAIN);?></a> |
  | 691 | 696 | <button class="wpext\_module\_action wp-ext-btn-prim wpext\_updeate\_code\_snippets" ><?php \_e('Save', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_tidy\_nav/wpext\_tidy\_nav.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_tidy_nav/wpext_tidy_nav.php?old=3112929&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_tidy_nav%2Fwpext_tidy_nav.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_tidy_nav/wpext_tidy_nav.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_tidy_nav/wpext_tidy_nav.php?rev=3112929#L79 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_tidy_nav/wpext_tidy_nav.php?rev=3145393#L79 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 79 | 79 | $slug = 'wp-extended-tidymenu'; |
  | 80 | 80 | $callback = [ get\_called\_class(), 'settings\_tidy\_menu']; |
  | 81 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 81 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 82 | 82 | add\_rewrite\_rule('^wp-extended-tidymenu/?', 'index.php?wp\_extended\_tidymenu=1', 'top'); |
  | 83 | 83 | add\_rewrite\_tag('%wp\_extended\_tidymenu%', '([^&]+)'); |
* ## [wpextended/trunk/includes/modules/core\_extensions/wpext\_user\_sections/wpext\_user\_sections.php](/changeset/3145393/wpextended/trunk/includes/modules/core_extensions/wpext_user_sections/wpext_user_sections.php?old=3099195&old_path=wpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_user_sections%2Fwpext_user_sections.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/includes/modules/core_extensions/wpext_user_sections/wpext_user_sections.php")

  | [r3134345](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_user_sections/wpext_user_sections.php?rev=3099195#L76 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_user_sections/wpext_user_sections.php?rev=3145393#L76 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 76 | 76 | $slug = 'wp-extended-user-sections'; |
  | 77 | 77 | $callback = [ $this, 'page\_cb']; |
  | 78 |  | add\_submenu\_page(~~null~~, '', '', $capability, $slug, $callback); |
  |  | 78 | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
  | 79 | 79 | add\_rewrite\_rule('^wp-extended-user-sections/?', 'index.php?wp\_extended\_user\_sections=1', 'top'); |
  | 80 | 80 | add\_rewrite\_tag('%wp\_extended\_user\_sections%', '([^&]+)'); |
* ## [wpextended/trunk/readme.txt](/changeset/3145393/wpextended/trunk/readme.txt?old=3134345&old_path=wpextended%2Ftrunk%2Freadme.txt "Show the [3134345:3145430] differences restricted to wpextended/trunk/readme.txt")

  | [r3134345](/browser/wpextended/trunk/readme.txt?rev=3134345#L4 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/readme.txt?rev=3145393#L4 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 5.6 |
  | 5 | 5 | Tested up to: 6.6.1 |
  | 6 |  | Stable tag: 3.0.~~8~~ |
  |  | 6 | Stable tag: 3.0.9 |
  | 7 | 7 | Requires PHP: 7.4 |
  | 8 | 8 | License: GPLv2 or later |
  | […](/browser/wpextended/trunk/readme.txt?rev=3134345#L141) | […](/browser/wpextended/trunk/readme.txt?rev=3145393#L141) |  |
  | 141 | 141 | == Changelog == |
  | 142 | 142 |  |
  |  | 143 | = 3.0.9 - 02 September 2024 = |
  |  | 144 | \* Improvement: Hide "Active Modules" until enabled any one module. |
  |  | 145 | \* Update: Part of the Patchstack VDP Program. |
  |  | 146 | \* Fix: Post Type Order - Post type order not working with hierarchical parent/children. |
  |  | 147 | \* Fix: Warnings fixed for PHP 8.\* |
  |  | 148 | \* Security Fix: Code snippet module - Escaping and sanitising output. |
  |  | 149 | \* Security Fix: Duplicate Duplicate Pages/Posts module - Added user capability checks. |
  |  | 150 | \* Security Fix: Block username module - Added user capability checks. |
  |  | 151 |  |
  | 143 | 152 | = 3.0.8 - 12 August 2024 = |
  | 144 | 153 | \* Improvement: Code snippet - Duplicate functionality. |
  | 145 |  | \* Improvement:  Quick Add Post - Updated module description. |
  |  | 154 | \* Improvement: Hide "Active Modules" until active any one module. |
  |  | 155 | \* Improvement:  Quick Add Post - Updated module description |
  | 146 | 156 | \* Fix: mkdir issue on some servers. |
  | 147 |  | \* Fix: Duplicate Menu - Updated correct Read Documentation link~~.~~ |
  |  | 157 | \* Fix: Duplicate Menu - Updated correct Read Documentation link |
  | 148 | 158 |  |
  | 149 | 159 | = 3.0.7 - 5 August 2024 = |
  | […](/browser/wpextended/trunk/readme.txt?rev=3134345#L409) | […](/browser/wpextended/trunk/readme.txt?rev=3145393#L419) |  |
  | 409 | 419 | The "Disable Blog" module is designed for websites that don't require a blog feature. By disabling blog-related functionalities, this module helps streamline your admin area. |
  | 410 | 420 |  |
  |  | 421 | = How can I report security bugs? = |
  |  | 422 |  |
  |  | 423 | You can report security bugs through the Patchstack Vulnerability Disclosure Program. The Patchstack team help validate, triage and handle any security vulnerabilities. [Report a security vulnerability.](https://patchstack.com/database/vdp/wpextended) |
* ## [wpextended/trunk/wp-extended.php](/changeset/3145393/wpextended/trunk/wp-extended.php?old=3134252&old_path=wpextended%2Ftrunk%2Fwp-extended.php "Show the [3134345:3145430] differences restricted to wpextended/trunk/wp-extended.php")

  | [r3134345](/browser/wpextended/trunk/wp-extended.php?rev=3134252#L4 "Show revision 3134345 of this file in browser") | [r3145430](/browser/wpextended/trunk/wp-extended.php?rev=3145393#L4 "Show revision 3145430 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://wordpress.org/plugins/wpextended |
  | 5 | 5 | \* Description: Many of your favourite plugins rolled up into 1 modular plugin making your WordPress faster and easier to manage. |
  | 6 |  | \* Version: 3.0.~~8~~ |
  |  | 6 | \* Version: 3.0.9 |
  | 7 | 7 | \* Requires at least: 5.6 |
  | 8 | 8 | \* Requires PHP:      7.4 |
  | […](/browser/wpextended/trunk/wp-extended.php?rev=3134252#L28) | […](/browser/wpextended/trunk/wp-extended.php?rev=3145393#L28) |  |
  | 28 | 28 |  |
  | 29 | 29 | }else{ |
  | 30 |  | define( 'WP\_EXTENDED\_VERSION', '3.0.~~8~~' ); |
  |  | 30 | define( 'WP\_EXTENDED\_VERSION', '3.0.9' ); |
  | 31 | 31 | define( 'WP\_EXTENDED\_TEXT\_DOMAIN', 'wp-extended' ); |
  | 32 | 32 | define( 'WP\_EXTENDED\_PATH', plugin\_dir\_path( \_\_FILE\_\_ ) ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3145430&old=3134345&new_path=%2Fwpextended%2Ftrunk&old_path=%2Fwpextended%2Ftrunk)
* [Zip Archive](?format=zip&new=3145430&old=3134345&new_path=%2Fwpextended%2Ftrunk&old_path=%2Fwpextended%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_54fcc3d4_20250110_153620.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# The Ultimate WordPress Toolkit – WP Extended <= 3.0.8 - Reflected Cross-Site Scripting via selected\_option

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   The Ultimate WordPress Toolkit – WP Extended <= 3.0.8 - Reflected Cross-Site Scripting via selected\_option

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-8117](https://www.cve.org/CVERecord?id=CVE-2024-8117) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | September 3, 2024 |
| Last Updated | September 4, 2024 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The The Ultimate WordPress Toolkit – WP Extended plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the ‘selected\_option’ parameter in all versions up to, and including, 3.0.8 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php#L293)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=3145430%40wpextended%2Ftrunk&old=3134345%40wpextended%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpextended%2Fthe-ultimate-wordpress-toolkit-wp-extended-308-reflected-cross-site-scripting-via-selected-option&t=The%20Ultimate%20WordPress%20Toolkit%20%E2%80%93%20WP%20Extended%20%3C%3D%203.0.8%20-%20Reflected%20Cross-Site%20Scripting%20via%20selected_option "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpextended%2Fthe-ultimate-wordpress-toolkit-wp-extended-308-reflected-cross-site-scripting-via-selected-option&text=The%20Ultimate%20WordPress%20Toolkit%20%E2%80%93%20WP%20Extended%20%3C%3D%203.0.8%20-%20Reflected%20Cross-Site%20Scripting%20via%20selected_option "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwpextended%2Fthe-ultimate-wordpress-toolkit-wp-extended-308-reflected-cross-site-scripting-via-selected-option "LinkedIn")
Email

## Vulnerability Details for The Ultimate WordPress Toolkit – WP Extended

#### [The Ultimate WordPress Toolkit – WP Extended](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wpextended)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wpextended [(view on wordpress.org)](https://wordpress.org/plugins/wpextended) |
| Patched? | Yes |
| Remediation | Update to version 3.0.9, or a newer patched version |
| Affected Version | * <= 3.0.8 |
| Patched Version | * 3.0.9 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_dfbb2820_20250110_153617.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwpextended%2Ftrunk%2Fincludes%2Fmodules%2Fcore_extensions%2Fwpext_snippets%2Fwpext_snippets.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?rev=3213331 "Revision 3213331")
* Next Revision →
* [Blame](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php)

---

# [source:](/browser?order=name "Go to repository root") [wpextended](/browser/wpextended?order=name "View wpextended")/[trunk](/browser/wpextended/trunk?order=name "View trunk")/[includes](/browser/wpextended/trunk/includes?order=name "View includes")/[modules](/browser/wpextended/trunk/includes/modules?order=name "View modules")/[core\_extensions](/browser/wpextended/trunk/includes/modules/core_extensions?order=name "View core_extensions")/[wpext\_snippets](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets?order=name "View wpext_snippets")/[wpext\_snippets.php](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?order=name "View wpext_snippets.php")

View diff against:

View revision:

| [Last change](/changeset/3220003/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php "View differences") on this file was [3220003](/changeset/3220003/ "View changeset 3220003"), checked in by wpextended, [10 hours ago](/timeline?from=2025-01-10T05%3A41%3A46Z&precision=second "See timeline at 01/10/2025 05:41:46 AM") |
| --- |
| Fix: Login Attempts Module - Unauthenticated SQL Injection and sanitization and uses values. Fix: Duplication module, There is an issue with the post-duplication module with a block theme. Security Fix: The esc\_url is missing in the export for posts/pages/users export. |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 47.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | // Exit if accessed directly |
| [4](#L4) | if (!defined('ABSPATH')) { |
| [5](#L5) | exit; |
| [6](#L6) | } |
| [7](#L7) |  |
| [8](#L8) | require\_once plugin\_dir\_path( \_\_FILE\_\_ ) . 'wp-extend-module-listing.php'; |
| [9](#L9) | require\_once plugin\_dir\_path( \_\_FILE\_\_ ) . 'old/wpext\_snippets.php'; |
| [10](#L10) |  |
| [11](#L11) | // Initialize the plugin |
| [12](#L12) | class Wp\_Extended\_Snippets extends Custom\_List\_Table { |
| [13](#L13) | public function \_\_construct() { |
| [14](#L14) | add\_action('init', array($this, 'wpext\_register\_snippet\_post\_type')); |
| [15](#L15) | add\_action('admin\_menu', array($this, 'admin\_menu')); |
| [16](#L16) | add\_action('admin\_enqueue\_scripts', array($this, 'wpext\_admin\_scripts\_snippets')); |
| [17](#L17) | add\_action('wp\_enqueue\_scripts', array($this, 'wpext\_frontend\_scripts\_snippets')); |
| [18](#L18) | if(!isset($\_GET['wpext\_safe\_mode']) || $\_GET['wpext\_safe\_mode'] != '1') { |
| [19](#L19) | add\_action('wp\_head', array($this, 'wpext\_output\_snippets\_in\_head')); |
| [20](#L20) | add\_action('wp\_footer', array($this, 'wpext\_output\_snippets\_in\_footer')); |
| [21](#L21) | add\_action('init', array($this, 'wpext\_output\_snippets\_in\_admin\_head'), 120); |
| [22](#L22) | } |
| [23](#L23) | add\_action('admin\_footer', array($this, 'wpext\_output\_snippets\_in\_admin\_footer')); |
| [24](#L24) | add\_action('wp\_ajax\_wpext\_update\_snippet\_status', array($this, 'wpext\_update\_snippet\_status')); |
| [25](#L25) | add\_action('wp\_ajax\_wpext\_delete\_code\_snippet', array($this, 'wpext\_delete\_code\_snippet')); |
| [26](#L26) | add\_action('wp\_ajax\_handle\_snippet\_update', array($this, 'wpext\_handle\_snippet\_update')); |
| [27](#L27) | add\_action('wp\_ajax\_save\_snippet', array($this, 'wpext\_create\_snippet\_page')); |
| [28](#L28) | add\_action('wp\_ajax\_nopriv\_save\_snippet', array($this, 'wpext\_create\_snippet\_page')); // For non logged-in users |
| [29](#L29) | add\_action('admin\_init', array($this, 'wpext\_website\_safe\_mode\_callback')); |
| [30](#L30) | add\_action('admin\_notices', array($this, 'wpext\_show\_safe\_mode\_notice')); |
| [31](#L31) | } |
| [32](#L32) |  |
| [33](#L33) | public function wpext\_admin\_scripts\_snippets($hook) { |
| [34](#L34) | wp\_enqueue\_script('jquery'); |
| [35](#L35) | if (in\_array($hook, [ |
| [36](#L36) | 'snippets\_page\_wp-extended-add-snippet', |
| [37](#L37) | 'snippets\_page\_wp-extended-snippets', |
| [38](#L38) | 'snippets\_page\_wp-extended-edit-snippet', |
| [39](#L39) | 'wp-extended\_page\_wp-extended-snippets', |
| [40](#L40) | 'admin\_page\_wp-extended-edit-snippet', |
| [41](#L41) | 'admin\_page\_wp-extended-add-snippet', |
| [42](#L42) | 'admin\_page\_wp-extended-snippets', |
| [43](#L43) | 'wp-extended\_page\_wp-extended-snippets' |
| [44](#L44) | ])) { |
| [45](#L45) | wp\_enqueue\_style('wpext\_snippets\_css', plugin\_dir\_url(\_\_FILE\_\_) . "css/wpext\_snippets.css", array()); |
| [46](#L46) | wp\_enqueue\_script('snippet-action', plugin\_dir\_url(\_\_FILE\_\_) . 'js/wpext-snippets.js', array('jquery'), false, true); |
| [47](#L47) | wp\_enqueue\_script('snippet-css-hints', plugin\_dir\_url(\_\_FILE\_\_) . 'js/csslint.js', array('jquery'), false, true); |
| [48](#L48) | wp\_enqueue\_script('snippet-js-hints', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jshint.js', array('jquery'), false, true); |
| [49](#L49) | $ajax\_nonce = wp\_create\_nonce('update\_snippet\_status'); |
| [50](#L50) | $ajax\_url = admin\_url('admin-ajax.php'); |
| [51](#L51) | wp\_localize\_script('snippet-action', 'wp\_ajax\_object', array('ajax\_url' => $ajax\_url, 'ajax\_nonce' => $ajax\_nonce)); |
| [52](#L52) | // Enqueue CodeMirror |
| [53](#L53) | wp\_enqueue\_script('wp-codemirror'); |
| [54](#L54) | wp\_enqueue\_style('wp-codemirror'); |
| [55](#L55) | wp\_enqueue\_script( 'htmlhint' ); |
| [56](#L56) | wp\_enqueue\_script( 'csslint' ); |
| [57](#L57) | wp\_enqueue\_script( 'jshint' ); |
| [58](#L58) |  |
| [59](#L59) | // Enqueue code editor |
| [60](#L60) | $settings = wp\_enqueue\_code\_editor(array('type' => 'application/x-httpd-php')); |
| [61](#L61) | wp\_localize\_script('snippet-action', 'codeEditorSettings', $settings); |
| [62](#L62) | } |
| [63](#L63) | } |
| [64](#L64) |  |
| [65](#L65) | public function wpext\_register\_snippet\_post\_type() { |
| [66](#L66) | register\_post\_type('snippet', array( |
| [67](#L67) | 'labels' => array( |
| [68](#L68) | 'name' => \_\_('Snippets'), |
| [69](#L69) | 'singular\_name' => \_\_('Snippet'), |
| [70](#L70) | 'add\_new' => \_\_('Add New'), |
| [71](#L71) | 'add\_new\_item' => \_\_('Add New Snippet'), |
| [72](#L72) | 'edit\_item' => \_\_('Edit Snippet'), |
| [73](#L73) | 'new\_item' => \_\_('New Snippet'), |
| [74](#L74) | 'view\_item' => \_\_('View Snippet'), |
| [75](#L75) | 'search\_items' => \_\_('Search Snippets'), |
| [76](#L76) | 'not\_found' => \_\_('No snippets found'), |
| [77](#L77) | 'not\_found\_in\_trash' => \_\_('No snippets found in Trash') |
| [78](#L78) | ), |
| [79](#L79) | 'public' => false, |
| [80](#L80) | 'show\_ui' => true, |
| [81](#L81) | 'show\_in\_menu' => 'wp-extended', |
| [82](#L82) | 'capability\_type' => 'post', |
| [83](#L83) | 'supports' => array('title', 'editor'), |
| [84](#L84) | 'menu\_position' => 100, |
| [85](#L85) | 'rewrite' => false, |
| [86](#L86) | 'map\_meta\_cap' => true, |
| [87](#L87) | 'publicly\_queryable' => false |
| [88](#L88) | )); |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) | public function admin\_menu() { |
| [92](#L92) | $menustatus = get\_option('wpext\_show\_plugin\_menu\_action'); |
| [93](#L93) | $wpext\_admin\_menu\_favorite = get\_option('wpext\_admin\_menu\_favorite'); |
| [94](#L94) | $flagfavorite = false; |
| [95](#L95) | if (!empty($wpext\_admin\_menu\_favorite)) { |
| [96](#L96) | if (array\_key\_exists('wpext\_snippets', $wpext\_admin\_menu\_favorite)) { |
| [97](#L97) | if ($wpext\_admin\_menu\_favorite['wpext\_snippets'] == 'true') { |
| [98](#L98) | $flagfavorite = true; |
| [99](#L99) | } |
| [100](#L100) | } |
| [101](#L101) | } |
| [102](#L102) | if((isset($menustatus) && $menustatus == 'true') && !empty($flagfavorite) ) { |
| [103](#L103) | add\_submenu\_page('wp-extended', \_\_('Code Snippets', 'wp-extended-snippets'), \_\_('Code Snippets', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-snippets', array($this, 'list\_snippets\_page')); |
| [104](#L104) | }else{ |
| [105](#L105) | $capability = 'manage\_options'; |
| [106](#L106) | $slug = 'wp-extended-snippets'; |
| [107](#L107) | $callback = [ $this, 'list\_snippets\_page']; |
| [108](#L108) | add\_submenu\_page('', '', '', $capability, $slug, $callback); |
| [109](#L109) | add\_rewrite\_rule('^wp-extended-snippets/?', 'index.php?wp\_extended\_snippets=1', 'top'); |
| [110](#L110) | add\_rewrite\_tag('%wp\_extended\_snippets%', '([^&]+)'); |
| [111](#L111) | } |
| [112](#L112) | add\_submenu\_page('', \_\_('Add New Snippet', 'wp-extended-snippets'), \_\_('Add New Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-add-snippet', array($this, 'wpext\_add\_snippet\_page')); |
| [113](#L113) | add\_submenu\_page('', \_\_('Edit Snippet', 'wp-extended-snippets'), \_\_('Edit Snippet', 'wp-extended-snippets'), 'manage\_options', 'wp-extended-edit-snippet', array($this, 'edit\_snippet\_page')); |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | public function list\_snippets\_page() { |
| [117](#L117) |  |
| [118](#L118) | $snippets = new WP\_Query(array( 'post\_type' => 'snippet', 'posts\_per\_page' => -1 )); ?> |
| [119](#L119) | <div class="position-fixed top-0 end-0 p-3 license\_status"> |
| [120](#L120) | <div id="liveToast" class="toast bg-danger fade hide" role="alert" aria-live="assertive" aria-atomic="true"> |
| [121](#L121) | <div class="toast-header"> |
| [122](#L122) | <div class="toast-body"><strong></strong></div> |
| [123](#L123) | </div> |
| [124](#L124) | </div> |
| [125](#L125) | </div> |
| [126](#L126) | <!-- Header button --> |
| [127](#L127) | <?php $this->wpext\_header\_button(); ?> |
| [128](#L128) | <!-- Header button end here --> |
| [129](#L129) | <div class="container wpext-container wpext\_code\_snippet wpext\_code\_snippet\_layout" id="wp-extended-app"> |
| [130](#L130) | <div class="row"> |
| [131](#L131) | <div class="col-sm-12 gx-5 p-0 rounded-2"> |
| [132](#L132) | <div class="container text-dark rounded-2"> |
| [133](#L133) | <?php |
| [134](#L134) | $codes = get\_option('wpext-snippets', '[]' ); |
| [135](#L135) | // Check if the retrieved option is an array or a JSON string |
| [136](#L136) | if (is\_array($codes)) { |
| [137](#L137) | $codes\_array = $codes; |
| [138](#L138) | } else { |
| [139](#L139) | $codes\_array = json\_decode($codes, true); |
| [140](#L140) | } |
| [141](#L141) | if (!empty($codes\_array) && (!isset($\_GET['wpext\_safe\_mode']) || $\_GET['wpext\_safe\_mode'] != '1')) { |
| [142](#L142) | ?> |
| [143](#L143) | <div class="container wpext-container px-0"> |
| [144](#L144) | <div class="row"> |
| [145](#L145) | <div class="wpext-help-message rounded-2"> |
| [146](#L146) | <span>ⓘ <?php \_e('Important!', WP\_EXTENDED\_TEXT\_DOMAIN); ?> </span> |
| [147](#L147) | <?php \_e('Welcome to the new code snippets module. To find your existing code snippets please', WP\_EXTENDED\_TEXT\_DOMAIN); ?> |
| [148](#L148) | <a href="<?php echo admin\_url('admin.php?page=wp-extended-snippets-old'); ?>" class="wp\_brand\_sub\_header\_back\_document" target="\_blank"> |
| [149](#L149) | <?php \_e('click here', WP\_EXTENDED\_TEXT\_DOMAIN); ?></a> |
| [150](#L150) | </div> |
| [151](#L151) |  |
| [152](#L152) | </div> |
| [153](#L153) | </div> |
| [154](#L154) | <?php } elseif (isset($\_GET['page']) && $\_GET['page'] === 'wp-extended-snippets' && isset($\_GET['wpext\_safe\_mode']) && $\_GET['wpext\_safe\_mode'] === '1') { ?> |
| [155](#L155) | <div class="container wpext-container px-0"> |
| [156](#L156) | <div class="row"> |
| [157](#L157) | <div class="wpext\_notice\_message rounded-2 px-0"> |
| [158](#L158) | <div class="wpext-success-message rounded-2"><span>✓ Success</span> |
| [159](#L159) | <?php \_e('Safe mode is active due to an error in all PHP snippet. All custom PHP code has been temporarily disabled.', WP\_EXTENDED\_TEXT\_DOMAIN); ?> |
| [160](#L160) | </div> |
| [161](#L161) | </div> |
| [162](#L162) |  |
| [163](#L163) | </div> |
| [164](#L164) | </div> |
| [165](#L165) | <?php } ?> |
| [166](#L166) | </div> |
| [167](#L167) | </div> |
| [168](#L168) | </div> |
| [169](#L169) | <div class="row"> |
| [170](#L170) | <div class="col-sm-12 gx-5 mb-3 p-0"> |
| [171](#L171) | <div id="snippet\_del\_message" class="d-none"> |
| [172](#L172) | <div class="wpext-success-message rounded-2"> |
| [173](#L173) | <span>ⓘ <?php \_e('Success!', WP\_EXTENDED\_TEXT\_DOMAIN); ?></span> <?php \_e('1 Code Snippets deleted.', WP\_EXTENDED\_TEXT\_DOMAIN ); ?></div> |
| [174](#L174) | </div> |
| [175](#L175) | <div class="wpext\_activationerror px-0"></div> |
| [176](#L176) | <?php |
| [177](#L177) | $display\_toc = new Custom\_List\_Table(); |
| [178](#L178) | $del = ''; |
| [179](#L179) | $snippet\_del = $display\_toc->process\_bulk\_action($del); |
| [180](#L180) | if(!empty($snippet\_del) && $snippet\_del == 1){ |
| [181](#L181) | $this->wpext\_show\_snippets\_deleted\_notice(); |
| [182](#L182) | } |
| [183](#L183) | ?> |
| [184](#L184) |  |
| [185](#L185) | <div class="container text-dark p-4 bg-white border rounded-2"> |
| [186](#L186) | <div class="row"> |
| [187](#L187) | <?php $display\_toc->custom\_list\_table\_page(); ?> |
| [188](#L188) | </div> |
| [189](#L189) | </div> |
| [190](#L190) | </div> |
| [191](#L191) | </div> |
| [192](#L192) | </div> |
| [193](#L193) | <?php  } |
| [194](#L194) |  |
| [195](#L195) | public function wpext\_create\_snippet\_page() { |
| [196](#L196) | if (isset($\_POST['action']) && $\_POST['action'] == 'save\_snippet') { |
| [197](#L197) | check\_admin\_referer('save\_snippet', 'wpext\_snippet\_nonce'); |
| [198](#L198) | $snippet\_name = isset($\_POST['snippet\_name']) ? sanitize\_text\_field($\_POST['snippet\_name']) : ''; |
| [199](#L199) |  |
| [200](#L200) | $snippet\_code\_type = isset($\_POST['snippet\_code\_type']) ? sanitize\_text\_field($\_POST['snippet\_code\_type']) : ''; |
| [201](#L201) | $snippet\_position = isset($\_POST['snippet\_position']) ? sanitize\_text\_field($\_POST['snippet\_position']) : ''; |
| [202](#L202) | if(isset($snippet\_code\_type) && $snippet\_code\_type == 'PHP'){ |
| [203](#L203) | $snippet\_position = 'head'; |
| [204](#L204) | }else{ |
| [205](#L205) | $snippet\_position = $snippet\_position; |
| [206](#L206) | } |
| [207](#L207) | $snippet\_code\_sesc = isset($\_POST['snippet\_code\_sesc']) ? sanitize\_text\_field($\_POST['snippet\_code\_sesc']) : ''; |
| [208](#L208) | $snippet\_active = isset($\_POST['snippet\_active']) ? sanitize\_text\_field($\_POST['snippet\_active']) : ''; |
| [209](#L209) | $snippet\_code = isset($\_POST['snippet\_code']) ? wp\_unslash($\_POST['snippet\_code']) : "<?php echo 'Hello World'; ?>"; |
| [210](#L210) | if ($snippet\_code\_type == 'PHP') { |
| [211](#L211) | $syntax\_error = $this->check\_php\_syntax\_error($snippet\_code); |
| [212](#L212) | if ($syntax\_error) { |
| [213](#L213) | wp\_send\_json\_error(['message' => $syntax\_error]); |
| [214](#L214) | } |
| [215](#L215) | } |
| [216](#L216) | try { |
| [217](#L217) | // Check if a snippet with the same title already exists |
| [218](#L218) | $args = array( |
| [219](#L219) | 'post\_type' => 'snippet', |
| [220](#L220) | 'post\_status' => 'any', |
| [221](#L221) | 'name' => $snippet\_name, |
| [222](#L222) | 'posts\_per\_page' => 1, |
| [223](#L223) | ); |
| [224](#L224) | $query = new WP\_Query($args); |
| [225](#L225) |  |
| [226](#L226) | if ($query->have\_posts()) { |
| [227](#L227) | $existing\_post = $query->post; |
| [228](#L228) | $post\_id = $existing\_post->ID; |
| [229](#L229) | $post\_update\_result = wp\_update\_post(array( |
| [230](#L230) | 'ID'            => $post\_id, |
| [231](#L231) | 'post\_title'    => $snippet\_name, |
| [232](#L232) | 'post\_content'  => $snippet\_code, |
| [233](#L233) | 'post\_status'   => 'publish', |
| [234](#L234) | 'post\_type'     => 'snippet' |
| [235](#L235) | )); |
| [236](#L236) |  |
| [237](#L237) | if (is\_wp\_error($post\_update\_result)) { |
| [238](#L238) | wp\_send\_json\_error(['message' => $post\_update\_result->get\_error\_message()]); |
| [239](#L239) | } |
| [240](#L240) |  |
| [241](#L241) | update\_post\_meta($post\_id, 'snippet\_position', $snippet\_position); |
| [242](#L242) | update\_post\_meta($post\_id, 'snippet\_code\_type', $snippet\_code\_type); |
| [243](#L243) | update\_post\_meta($post\_id, 'snippet\_active', $snippet\_active); |
| [244](#L244) | update\_post\_meta($post\_id, 'snippet\_code\_sesc', $snippet\_code\_sesc); |
| [245](#L245) | wp\_send\_json\_success(['message' => \_\_('Snippet updated successfully.', WP\_EXTENDED\_TEXT\_DOMAIN)]); |
| [246](#L246) | } else { |
| [247](#L247) | // If no existing post found, create a new one |
| [248](#L248) | $post\_id = wp\_insert\_post(array( |
| [249](#L249) | 'post\_title'   => $snippet\_name, |
| [250](#L250) | 'post\_content' => $snippet\_code, |
| [251](#L251) | 'post\_status'  => 'publish', |
| [252](#L252) | 'post\_type'    => 'snippet' |
| [253](#L253) | )); |
| [254](#L254) |  |
| [255](#L255) | if (is\_wp\_error($post\_id)) { |
| [256](#L256) | wp\_send\_json\_error(['message' => $post\_id->get\_error\_message()]); |
| [257](#L257) | } |
| [258](#L258) |  |
| [259](#L259) | update\_post\_meta($post\_id, 'snippet\_position', $snippet\_position); |
| [260](#L260) | update\_post\_meta($post\_id, 'snippet\_code\_type', $snippet\_code\_type); |
| [261](#L261) | update\_post\_meta($post\_id, 'snippet\_active', $snippet\_active); |
| [262](#L262) | update\_post\_meta($post\_id, 'snippet\_code\_sesc', $snippet\_code\_sesc); |
| [263](#L263) |  |
| [264](#L264) | wp\_send\_json\_success(['message' => \_\_('Snippet created successfully.', WP\_EXTENDED\_TEXT\_DOMAIN)]); |
| [265](#L265) | } |
| [266](#L266) |  |
| [267](#L267) | // Restore global post data |
| [268](#L268) | wp\_reset\_postdata(); |
| [269](#L269) |  |
| [270](#L270) | } catch (Exception $e) { |
| [271](#L271) | wp\_send\_json\_error(['message' => $e->getMessage()]); |
| [272](#L272) | } |
| [273](#L273) | } |
| [274](#L274) |  |
| [275](#L275) | exit; |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | public function wpext\_add\_snippet\_page() { ?> |
| [279](#L279) | <?php $this->wpext\_header\_button(); ?> |
| [280](#L280) | <div class="container wpext-container"> |
| [281](#L281) | <div class="row"> |
| [282](#L282) | <div class="wpext\_add\_new\_mainsection p-0 rounded-2"> |
| [283](#L283) | <div id="wpext\_notice\_message"></div> |
| [284](#L284) | </div> |
| [285](#L285) | <div class="wpext\_add\_new\_mainsection gx-5 mb-3 bg-white p-0 border rounded-2"> |
| [286](#L286) | <div class="container"> |
| [287](#L287) | <form method="post" action="" class="wpext\_add\_newsnippets" id="wpext\_save\_snippet\_form"> |
| [288](#L288) | <?php wp\_nonce\_field('save\_snippet', 'wpext\_snippet\_nonce'); ?> |
| [289](#L289) | <div class="wrap addnew"> |
| [290](#L290) | <div class="container"> |
| [291](#L291) | <div class="wpext\_code\_snippet\_body" id="poststuff"> |
| [292](#L292) | <div class="row justify-content-between wpext\_add\_snippet\_body"> |
| [293](#L293) | <div class="wpext\_snippet\_top\_section d-flex mb-3"> |
| [294](#L294) | <div class="col-3"> |
| [295](#L295) | <h2 class="wpext\_snippet\_title"> |
| [296](#L296) | <?php |
| [297](#L297) | $selected\_option = isset($\_GET['selected\_option']) ? sanitize\_text\_field($\_GET['selected\_option']) : ''; |
| [298](#L298) | echo esc\_html($selected\_option); |
| [299](#L299) | ?> |
| [300](#L300) | </h2> |
| [301](#L301) | <?php self::wpext\_custom\_css\_content($selected\_option); ?> |
| [302](#L302) | <input type="hidden" name="snippet\_position" value="<?php echo $selected\_option; ?>" id="snippet\_code\_type"> |
| [303](#L303) | </div> |
| [304](#L304) | <div class="col-9 d-flex wpext\_snippet\_position\_action"> |
| [305](#L305) | <?php if(!empty($selected\_option) && $selected\_option != 'PHP') { ?> |
| [306](#L306) | <div id="wpext\_login\_action"> |
| [307](#L307) | <label for="snippet\_position"><?php \_e('Display In', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [308](#L308) | <select name="snippet\_position" id="snippet\_position"> |
| [309](#L309) | <option value="head"><?php \_e('Head', WP\_EXTENDED\_TEXT\_DOMAIN); ?></option> |
| [310](#L310) | <option value="footer"><?php \_e('Footer', WP\_EXTENDED\_TEXT\_DOMAIN); ?></option> |
| [311](#L311) | </select> |
| [312](#L312) | </div> |
| [313](#L313) | <?php } ?> |
| [314](#L314) | <div class="field form-check form-switch form-switch-md d-flex align-items-center gap-5 wpext\_action\_switch"> |
| [315](#L315) | <label for="snippet\_active" class="wpext\_module\_status"><?php \_e('Enable', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [316](#L316) | <input type="checkbox" name="snippet\_active" id="snippet\_active" class="form-check-input addnew\_snippet\_active"> |
| [317](#L317) | </div> |
| [318](#L318) | </div> |
| [319](#L319) | </div> |
| [320](#L320) | <div id="post-body-content"> |
| [321](#L321) | <div class="wpext\_snippet\_short\_desc mb-3"> |
| [322](#L322) |  |
| [323](#L323) | <div id="titlewrap" class="wpext\_snippet\_code\_title mb-3"> |
| [324](#L324) | <label class="screen-reader-text" for="snippet\_name"><?php \_e('Enter title here', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [325](#L325) | <input type="text" name="snippet\_name" size="30" value="" spellcheck="true" autocomplete="off" placeholder="<?php \_e('Snippet Title', WP\_EXTENDED\_TEXT\_DOMAIN); ?>" class="form-control wpext\_smtp\_config\_from  wpext\_snippet\_name mb-2" required> |
| [326](#L326) | </div> |
| [327](#L327) |  |
| [328](#L328) | <div class="wpext\_snippet\_description mb-2"> |
| [329](#L329) | <div class="inside"> |
| [330](#L330) | <textarea name="snippet\_code\_sesc" id="snippet\_code\_sesc" class="w-100 large-text code-editor" placeholder="<?php \_e('Description', WP\_EXTENDED\_TEXT\_DOMAIN ); ?>" rows="4"></textarea> |
| [331](#L331) | </div> |
| [332](#L332) | </div> |
| [333](#L333) | </div> |
| [334](#L334) | <!-- Code Editor --> |
| [335](#L335) | <div class="code\_teaxarea\_box postbox mb-0"> |
| [336](#L336) | <h2 class="hndle ui-sortable-handle"><span><?php \_e('', WP\_EXTENDED\_TEXT\_DOMAIN); ?></span></h2> |
| [337](#L337) | <div class="inside"> |
| [338](#L338) | <textarea name="snippet\_code" id="snippet\_codess" rows="50" class="large-text code-editor"></textarea> |
| [339](#L339) | </div> |
| [340](#L340) | </div> |
| [341](#L341) |  |
| [342](#L342) | </div> |
| [343](#L343) | </div> |
| [344](#L344) | </div> |
| [345](#L345) | </div> |
| [346](#L346) | </div> |
| [347](#L347) | </form> |
| [348](#L348) | <?php |
| [349](#L349) | $mode = ''; |
| [350](#L350) | if (isset($selected\_option) && $selected\_option == 'JAVASCRIPT') { |
| [351](#L351) | $mode = 'text/javascript'; |
| [352](#L352) | }else if(isset($selected\_option) && $selected\_option == 'PHP'){ |
| [353](#L353) | $mode = 'application/x-httpd-php-open'; |
| [354](#L354) | }else if(isset($selected\_option) && $selected\_option == 'CSS'){ |
| [355](#L355) | $mode = 'text/css'; |
| [356](#L356) | } |
| [357](#L357) | ?> |
| [358](#L358) | <script type="text/javascript"> |
| [359](#L359) | jQuery(document).ready(function($) { |
| [360](#L360) | var editorSettings = wp.codeEditor.defaultSettings ? \_.clone(wp.codeEditor.defaultSettings) : {}; |
| [361](#L361) | var editorSettings = wp.codeEditor.defaultSettings ? \_.clone(wp.codeEditor.defaultSettings) : {}; |
| [362](#L362) | editorSettings.codemirror = \_.extend( |
| [363](#L363) | {}, |
| [364](#L364) | editorSettings.codemirror, |
| [365](#L365) | { |
| [366](#L366) | mode: '<?php echo $mode; ?>', |
| [367](#L367) | indentUnit: 4, |
| [368](#L368) | indentWithTabs: true, |
| [369](#L369) | lineNumbers: true, |
| [370](#L370) | tabSize: 4, |
| [371](#L371) | lineWrapping: true, |
| [372](#L372) | autoCloseBrackets: true, |
| [373](#L373) | gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"], |
| [374](#L374) | lint: true, // Enable linting |
| [375](#L375) | extraKeys: { |
| [376](#L376) | "Ctrl-Space": "autocomplete", |
| [377](#L377) | "Ctrl-Q": function(cm) { cm.foldCode(cm.getCursor()); } |
| [378](#L378) | }, |
| [379](#L379) | foldGutter: true, |
| [380](#L380) | matchBrackets: true |
| [381](#L381) | } |
| [382](#L382) | ); |
| [383](#L383) | if ('<?php echo $selected\_option; ?>' === 'JAVASCRIPT') { |
| [384](#L384) | wp.codeEditor.initialize($('.addnew #snippet\_codess'), editorSettings); |
| [385](#L385) | } else if ('<?php echo $selected\_option; ?>' === 'CSS') { |
| [386](#L386) | wp.codeEditor.initialize($('.addnew #snippet\_codess'), editorSettings); |
| [387](#L387) | } else { |
| [388](#L388) | // Initialize editor without additional linting for other modes |
| [389](#L389) | wp.codeEditor.initialize($('.addnew #snippet\_codess'), editorSettings); |
| [390](#L390) | } |
| [391](#L391) | }); |
| [392](#L392) | </script> |
| [393](#L393) | </div> |
| [394](#L394) | </div> |
| [395](#L395) | </div> |
| [396](#L396) | </div> |
| [397](#L397) | </div> |
| [398](#L398) | <?php  } |
| [399](#L399) |  |
| [400](#L400) | public function edit\_snippet\_page() { |
| [401](#L401) | $snippet\_id = isset($\_GET['snippet\_id']) ? intval($\_GET['snippet\_id']) : 0; |
| [402](#L402) | $snippet = get\_post($snippet\_id); |
| [403](#L403) | if (!$snippet || $snippet->post\_type !== 'snippet') { |
| [404](#L404) | wp\_die(\_\_('Invalid snippet', 'wp-extended-snippets')); |
| [405](#L405) | } |
| [406](#L406) | $snippet\_position = get\_post\_meta($snippet\_id, 'snippet\_position', true); |
| [407](#L407) | $snippet\_code\_type = get\_post\_meta($snippet\_id, 'snippet\_code\_type', true); |
| [408](#L408) |  |
| [409](#L409) | ?> |
| [410](#L410) |  |
| [411](#L411) | <!-- Header button --> |
| [412](#L412) | <?php $this->wpext\_header\_button(); ?> |
| [413](#L413) | <!-- Header button end here --> |
| [414](#L414) |  |
| [415](#L415) | <div class="container wpext-container wpext\_update\_section"> |
| [416](#L416) | <div class="row"> |
| [417](#L417) | <div class="wpext\_add\_new\_mainsection p-0 rounded-2"> |
| [418](#L418) | <div id="wpext\_notice\_message"></div> |
| [419](#L419) | </div> |
| [420](#L420) | <div class="wpext\_add\_new\_mainsection gx-5 mb-3 bg-white p-0 border rounded-2"> |
| [421](#L421) | <div class="container"> |
| [422](#L422) | <div class="wrap"> |
| [423](#L423) | <form method="post" action="" class="wpext\_add\_newsnippets" id="wpext\_save\_snippet\_form"> |
| [424](#L424) | <?php wp\_nonce\_field('update\_snippet', 'wpext\_snippet\_nonce'); ?> |
| [425](#L425) | <div class="wrap addnew\_edit"> |
| [426](#L426) | <div class="container"> |
| [427](#L427) | <div class="wpext\_code\_snippet\_body" id="poststuff"> |
| [428](#L428) | <div class="row justify-content-between wpext\_add\_snippet\_body"> |
| [429](#L429) | <div class="wpext\_snippet\_top\_section d-flex mb-3"> |
| [430](#L430) | <div class="col-3"> |
| [431](#L431) | <h2 class="wpext\_snippet\_title"> <?php echo $snippet\_code\_type; ?></h2> |
| [432](#L432) | <?php self::wpext\_custom\_css\_content($snippet\_code\_type); ?> |
| [433](#L433) | <input type="hidden" name="snippet\_position" value="<?php if(!empty($snippet\_code\_type)){ echo $snippet\_code\_type; } ?>" id="snippet\_code\_type"> |
| [434](#L434) | </div> |
| [435](#L435) | <div class="col-9 d-flex wpext\_snippet\_position\_action"> |
| [436](#L436) | <?php if(!empty($snippet\_code\_type) && $snippet\_code\_type != 'PHP') { ?> |
| [437](#L437) | <div id="wpext\_login\_action"> |
| [438](#L438) | <label for="snippet\_position"><?php \_e('Display In', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [439](#L439) | <select name="snippet\_position" id="snippet\_position"> |
| [440](#L440) | <option value="head" <?php selected($snippet\_position, 'head'); ?>><?php \_e('Head', WP\_EXTENDED\_TEXT\_DOMAIN); ?></option> |
| [441](#L441) | <option value="footer" <?php selected($snippet\_position, 'footer'); ?>><?php \_e('Footer', WP\_EXTENDED\_TEXT\_DOMAIN); ?></option> |
| [442](#L442) | </select> |
| [443](#L443) | </div> |
| [444](#L444) | <?php } ?> |
| [445](#L445) | <div class="field form-check form-switch form-switch-md d-flex align-items-center gap-5 wpext\_action\_switch"> |
| [446](#L446) | <?php $\_snippet\_active = get\_post\_meta($snippet\_id, 'snippet\_active', true); ?> |
| [447](#L447) | <label for="snippet\_active" class="wpext\_module\_status"><?php \_e('Enable', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [448](#L448) | <input type="checkbox" class="form-check-input"  name="snippet\_active" id="snippet\_active" <?php checked($\_snippet\_active, 1); ?>> |
| [449](#L449) | </div> |
| [450](#L450) | </div> |
| [451](#L451) | </div> |
| [452](#L452) | <div id="post-body-content"> |
| [453](#L453) | <div class="wpext\_snippet\_short\_desc mb-3"> |
| [454](#L454) | <div id="titlewrap" class="wpext\_snippet\_code\_title mb-3"> |
| [455](#L455) | <label class="screen-reader-text" for="snippet\_name"><?php \_e('Enter title here', WP\_EXTENDED\_TEXT\_DOMAIN); ?></label> |
| [456](#L456) | <input type="text" name="snippet\_name" size="30" value="<?php echo esc\_attr($snippet->post\_title); ?>" spellcheck="true" autocomplete="off" placeholder="<?php \_e('Snippet Title', 'wp-extended-snippets'); ?>" class="form-control wpext\_smtp\_config\_from snippet\_name mb-2" required> |
| [457](#L457) | </div> |
| [458](#L458) | <div class="wpext\_snippet\_description mb-2"> |
| [459](#L459) | <div class="inside"> |
| [460](#L460) | <?php $code\_snipet\_desc = get\_post\_meta($snippet\_id, 'snippet\_code\_sesc', true); ?> |
| [461](#L461) | <textarea name="snippet\_code\_sesc" id="snippet\_code\_sesc" class="w-100 large-text code-editor" rows="4" placeholder="Description"><?php echo esc\_textarea($code\_snipet\_desc); ?></textarea> |
| [462](#L462) | </div> |
| [463](#L463) | </div> |
| [464](#L464) | </div> |
| [465](#L465) | <!-- Code Editor --> |
| [466](#L466) | <div class="code\_teaxarea\_box postbox mb-0"> |
| [467](#L467) | <h2 class="hndle ui-sortable-handle"><span><?php \_e('', WP\_EXTENDED\_TEXT\_DOMAIN); ?></span></h2> |
| [468](#L468) | <div class="inside"> |
| [469](#L469) | <textarea name="snippet\_code" id="snippet\_code" rows="50" cols="50" class="w-100 large-text code-editor"><?php echo htmlspecialchars($snippet->post\_content); ?></textarea> |
| [470](#L470) | <input type="hidden" name="wpext\_snippet\_id" value="<?php echo $snippet\_id; ?>" id="snippet\_id"> |
| [471](#L471) | </div> |
| [472](#L472) | </div> |
| [473](#L473) | <!-- Code Editor --> |
| [474](#L474) | </div> |
| [475](#L475) | </div> |
| [476](#L476) | </div> |
| [477](#L477) | </div> |
| [478](#L478) | </div> |
| [479](#L479) | </form> |
| [480](#L480) | <?php |
| [481](#L481) |  |
| [482](#L482) | $mode = ''; |
| [483](#L483) | if (isset($snippet\_code\_type) && $snippet\_code\_type == 'JAVASCRIPT') { |
| [484](#L484) | $mode = 'text/javascript'; |
| [485](#L485) | } else if (isset($snippet\_code\_type) && $snippet\_code\_type == 'PHP') { |
| [486](#L486) | $mode = 'application/x-httpd-php-open'; |
| [487](#L487) | } else if (isset($snippet\_code\_type) && $snippet\_code\_type == 'CSS') { |
| [488](#L488) | $mode = 'text/css'; |
| [489](#L489) | } |
| [490](#L490) | ?> |
| [491](#L491) | <script> |
| [492](#L492) | jQuery(document).ready(function($) { |
| [493](#L493) | var editorSettings = wp.codeEditor.defaultSettings ? \_.clone(wp.codeEditor.defaultSettings) : {}; |
| [494](#L494) | editorSettings.codemirror = \_.extend( |
| [495](#L495) | {}, |
| [496](#L496) | editorSettings.codemirror, |
| [497](#L497) | { |
| [498](#L498) | mode: '<?php echo $mode; ?>', |
| [499](#L499) | indentUnit: 4, |
| [500](#L500) | indentWithTabs: true, |
| [501](#L501) | lineNumbers: true, |
| [502](#L502) | tabSize: 4, |
| [503](#L503) | lineWrapping: true, |
| [504](#L504) | autoCloseBrackets: true, |
| [505](#L505) | gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"], |
| [506](#L506) | lint: true, // Enable linting |
| [507](#L507) | extraKeys: { |
| [508](#L508) | "Ctrl-Space": "autocomplete", |
| [509](#L509) | "Ctrl-Q": function(cm) { cm.foldCode(cm.getCursor()); } |
| [510](#L510) | }, |
| [511](#L511) | foldGutter: true, |
| [512](#L512) | matchBrackets: true |
| [513](#L513) | } |
| [514](#L514) | ); |
| [515](#L515) | if ('<?php echo $snippet\_code\_type; ?>' === 'JAVASCRIPT') { |
| [516](#L516) | wp.codeEditor.initialize($('#snippet\_code'), editorSettings); |
| [517](#L517) | } else if ('<?php echo $snippet\_code\_type; ?>' === 'CSS') { |
| [518](#L518) | wp.codeEditor.initialize($('#snippet\_code'), editorSettings); |
| [519](#L519) | } else { |
| [520](#L520) | // Initialize editor without additional linting for other modes |
| [521](#L521) | wp.codeEditor.initialize($('#snippet\_code'), editorSettings); |
| [522](#L522) | } |
| [523](#L523) | }); |
| [524](#L524) | </script> |
| [525](#L525) | </div> |
| [526](#L526) | </div> |
| [527](#L527) | </div> |
| [528](#L528) | </div> |
| [529](#L529) | </div> |
| [530](#L530) |  |
| [531](#L531) | <?php  } |
| [532](#L532) | public function wpext\_output\_snippets\_in\_head() { |
| [533](#L533) | $this->wpext\_output\_snippets('head', 'frontend'); |
| [534](#L534) | } |
| [535](#L535) |  |
| [536](#L536) | public function wpext\_output\_snippets\_in\_footer() { |
| [537](#L537) | $this->wpext\_output\_snippets('footer', 'frontend'); |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | public function wpext\_output\_snippets\_in\_admin\_head() { |
| [541](#L541) | if ($this->wpext\_should\_output\_snippets('head', 'admin')) { |
| [542](#L542) | $this->wpext\_output\_snippets('head', 'admin', 'PHP'); |
| [543](#L543) | } |
| [544](#L544) | } |
| [545](#L545) | public function wpext\_output\_snippets\_in\_admin\_footer() { |
| [546](#L546) | if ($this->wpext\_should\_output\_snippets('footer', 'admin')) { |
| [547](#L547) | $this->wpext\_output\_snippets('footer', 'admin', 'PHP'); |
| [548](#L548) | } |
| [549](#L549) | } |
| [550](#L550) | private function wpext\_should\_output\_snippets($pagenow, $position) { |
| [551](#L551) | if (is\_admin()) { |
| [552](#L552) | // Exclude the edit post and post-new pages |
| [553](#L553) | if (in\_array($pagenow, ['post.php', 'post-new.php'])) { |
| [554](#L554) | return false; |
| [555](#L555) | } |
| [556](#L556) | // Additional check for the specific snippets page |
| [557](#L557) | if ($pagenow === 'admin.php' && isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) === 'wp-extended-snippets') { |
| [558](#L558) | return false; |
| [559](#L559) | } |
| [560](#L560) | // Check the post type in the global post variable |
| [561](#L561) | global $post; |
| [562](#L562) | if (isset($post) && $post->post\_type !== 'snippet') { |
| [563](#L563) | return false; |
| [564](#L564) | } |
| [565](#L565) | return true; |
| [566](#L566) | } |
| [567](#L567) | return false; |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) | private function wpext\_output\_snippets($position, $context, $allowed\_code\_type = 'null') { |
| [571](#L571) | if (!defined('ABSPATH')) { |
| [572](#L572) | define('ABSPATH', dirname(\_\_FILE\_\_) . '/'); |
| [573](#L573) | } |
| [574](#L574) | $snippets = new WP\_Query(array( |
| [575](#L575) | 'post\_type' => 'snippet', |
| [576](#L576) | 'meta\_key' => 'snippet\_position', |
| [577](#L577) | 'meta\_value' => $position, |
| [578](#L578) | 'posts\_per\_page' => -1 |
| [579](#L579) | )); |
| [580](#L580) | if ($snippets->have\_posts()) { |
| [581](#L581) | while ($snippets->have\_posts()) { |
| [582](#L582) | $snippets->the\_post(); |
| [583](#L583) | $scope = get\_post\_meta(get\_the\_ID(), 'snippet\_scope', true); |
| [584](#L584) | $snippet\_active = get\_post\_meta(get\_the\_ID(), 'snippet\_active', true); |
| [585](#L585) | $code = get\_the\_content(); |
| [586](#L586) | $code\_type = get\_post\_meta(get\_the\_ID(), 'snippet\_code\_type', true); |
| [587](#L587) | if ($snippet\_active != 1) { |
| [588](#L588) | continue; |
| [589](#L589) | } |
| [590](#L590) | if ($code\_type === 'PHP' && (!isset($\_POST['wpext\_update\_flag']) || $\_POST['wpext\_update\_flag'] != 'update\_token')) { |
| [591](#L591) | eval($code); |
| [592](#L592) | } else if ($code\_type === 'CSS' && $context === 'frontend') { |
| [593](#L593) | echo "<style type='text/css' id='wpextended-css-".get\_the\_ID()."'>" . $code . "</style>"; |
| [594](#L594) | } else if ($code\_type === 'JAVASCRIPT' && $context === 'frontend') { |
| [595](#L595) | echo "<script type='text/javascript'  id='wpextended-js-".get\_the\_ID()."'>" . $code . "</script>"; |
| [596](#L596) | } else if ($code\_type === 'CSS' && $context === 'admin') { |
| [597](#L597) | add\_action('admin\_head', function() use ($code) { |
| [598](#L598) | // echo "<style>" . $code . "</style>"; |
| [599](#L599) | }); |
| [600](#L600) | } else if ($code\_type === 'JAVASCRIPT' && $context === 'admin') { |
| [601](#L601) | add\_action('admin\_head', function() use ($code) { |
| [602](#L602) | //echo "<script>" . $code . "</script>"; |
| [603](#L603) | }); |
| [604](#L604) | } |
| [605](#L605) | if ($scope === 'once') { |
| [606](#L606) | update\_post\_meta(get\_the\_ID(), 'snippet\_executed', true); |
| [607](#L607) | } |
| [608](#L608) | } |
| [609](#L609) | } |
| [610](#L610) | wp\_reset\_postdata(); |
| [611](#L611) | } |
| [612](#L612) | public function wpext\_update\_snippet\_status() { |
| [613](#L613) | check\_ajax\_referer('update\_snippet\_status', 'security'); |
| [614](#L614) |  |
| [615](#L615) | $snippet\_title = sanitize\_text\_field($\_POST['snippet\_title']); |
| [616](#L616) | $snippet\_id = intval($\_POST['snippet\_id']); |
| [617](#L617) | $snippet\_active = get\_post\_meta($snippet\_id, 'snippet\_active', true); |
| [618](#L618) | if (!current\_user\_can('edit\_post', $snippet\_id)) { |
| [619](#L619) | wp\_send\_json\_error('You do not have permission to edit this snippet.'); |
| [620](#L620) | return; |
| [621](#L621) | } |
| [622](#L622) | $post = get\_post($snippet\_id); |
| [623](#L623) | if($post) { |
| [624](#L624) | $snippet\_code = $post->post\_content; |
| [625](#L625) | $snippet\_code\_type = get\_post\_meta($snippet\_id, 'snippet\_code\_type', true); |
| [626](#L626) | if(isset($snippet\_code\_type) && $snippet\_code\_type == 'PHP' && $\_POST['wpext\_update\_flag'] == 'status\_token' && $snippet\_active != 1){ |
| [627](#L627) | $syntax\_error = $this->check\_php\_syntax\_error($snippet\_code); |
| [628](#L628) | if ($syntax\_error) { |
| [629](#L629) | wp\_send\_json\_error(['message' => $syntax\_error]); |
| [630](#L630) | } |
| [631](#L631) | } |
| [632](#L632) | try { |
| [633](#L633) | $code\_snippet\_title = \_\_('Code Snippets ', WP\_EXTENDED\_TEXT\_DOMAIN); |
| [634](#L634) | $snippet\_active = intval($\_POST['snippet\_active']); |
| [635](#L635) | if($snippet\_active == 1){ |
| [636](#L636) | $action = \_\_('Activated', WP\_EXTENDED\_TEXT\_DOMAIN); |
| [637](#L637) | }else{ |
| [638](#L638) | $action = \_\_('Deactivated', WP\_EXTENDED\_TEXT\_DOMAIN); |
| [639](#L639) | } |
| [640](#L640) | if (update\_post\_meta($snippet\_id, 'snippet\_active', $snippet\_active)) { |
| [641](#L641) | wp\_send\_json\_success(array('success' => $snippet\_active, 'snippet\_title' => $code\_snippet\_title, 'action' => $action)); |
| [642](#L642) | } else { |
| [643](#L643) | wp\_send\_json\_error('Failed to update snippet status.'); |
| [644](#L644) | } |
| [645](#L645) |  |
| [646](#L646) | } catch (Exception $e) { |
| [647](#L647) | // Catch any other potential errors |
| [648](#L648) | wp\_send\_json\_error(['message' => $e->getMessage()]); |
| [649](#L649) | } |
| [650](#L650) | } |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | public function wpext\_delete\_code\_snippet() { |
| [654](#L654) | check\_ajax\_referer('update\_snippet\_status', 'security'); |
| [655](#L655) | if ( get\_post\_type( $\_POST['post\_id'] ) != 'snippet' ) { |
| [656](#L656) | wp\_send\_json\_error('Post type is not "snippet".'); |
| [657](#L657) | return; |
| [658](#L658) | } |
| [659](#L659) | $post\_id = intval($\_POST['post\_id']); |
| [660](#L660) |  |
| [661](#L661) | if (wp\_trash\_post($post\_id)) { |
| [662](#L662) | $snippet\_del = \_\_('Post deleted successfully.', WP\_EXTENDED\_TEXT\_DOMAIN); |
| [663](#L663) | echo wp\_send\_json\_success($snippet\_del); |
| [664](#L664) | } else { |
| [665](#L665) | $snippet\_del\_failed = \_\_('Failed to delete post.', WP\_EXTENDED\_TEXT\_DOMAIN); |
| [666](#L666) | wp\_send\_json\_error($snippet\_del\_failed); |
| [667](#L667) | } |
| [668](#L668) | die; |
| [669](#L669) | } |
| [670](#L670) |  |
| [671](#L671) | public static function wpext\_header\_button(){ |
| [672](#L672) | $snippetList = new WP\_List\_Table(); |
| [673](#L673) | $items = $snippetList->get\_items(); |
| [674](#L674) | ?> |
| [675](#L675) | <!-- Header button --> |
| [676](#L676) | <div class="container-fluid wpe\_brand\_header"> |
| [677](#L677) | <div class="container ps-2 p-4"> |
| [678](#L678) | <div class="row"> |
| [679](#L679) | <div class="col-sm-8 col-md-6 ps-0"> |
| [680](#L680) | <h4 class="text-white ps-1 m-0 wpe\_brand\_header\_title wpext\_code\_snippet\_title"><?php \_e('WP Extended Code Snippets', WP\_EXTENDED\_TEXT\_DOMAIN); ?><sub>Beta</sub></h4> |
| [681](#L681) | </div> |
| [682](#L682) | <?php do\_action('admin\_plugin\_top\_info'); ?> |
| [683](#L683) | </div> |
| [684](#L684) |  |
| [685](#L685) | </div> |
| [686](#L686) | </div> |
| [687](#L687) | <div class="container-fluid wp\_brand\_sub\_header"> |
| [688](#L688) | <div class="container"> |
| [689](#L689) | <div class="row align-items-baseline"> |
| [690](#L690) | <div class="col-lg-6 px-1"> |
| [691](#L691) | <p class="wp\_brand\_sub\_header\_left"><a href="<?php echo get\_admin\_url(); ?>admin.php?page=wp-extended" class="wp\_brand\_sub\_header\_back\_link">&#x2190; <?php \_e('Back to Modules', WP\_EXTENDED\_TEXT\_DOMAIN ); ?></a> | <a href="https://wpextended.io/module\_resources/smtp-email/" class="wp\_brand\_sub\_header\_back\_document" target="\_blank"> |
| [692](#L692) | <?php \_e('Documentation', WP\_EXTENDED\_TEXT\_DOMAIN);?></a></p> |
| [693](#L693) | </div> |
| [694](#L694) | <div class="col-lg-6 wp\_brand\_sub\_header\_right mx-lg-0 px-2"> |
| [695](#L695) | <div class="wpext-return-module-wrap wpext\_snippet\_action"> |
| [696](#L696) | <?php if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-snippets') { ?> |
| [697](#L697) | <button class="page-title-action wp-ext-btn-prim" ><?php \_e('Add New', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
| [698](#L698) | <?php } ?> |
| [699](#L699) | <?php if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-add-snippet') { ?> |
| [700](#L700) | <a href='<?php echo admin\_url('admin.php?page=wp-extended-snippets'); ?>' class="wp-ext-btn-sec"><?php \_e('Back to Snippets', WP\_EXTENDED\_TEXT\_DOMAIN);?></a> |
| [701](#L701) | <button class="wpext\_module\_action wp-ext-btn-prim wpext\_save\_snippet" ><?php \_e('Save', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
| [702](#L702) | <?php } |
| [703](#L703) | if(isset($\_GET['page']) && sanitize\_text\_field($\_GET['page']) == 'wp-extended-edit-snippet') { ?> |
| [704](#L704) | <a href='<?php echo admin\_url('admin.php?page=wp-extended-snippets'); ?>' class="wp-ext-btn-sec"><?php \_e('Back to Snippets', WP\_EXTENDED\_TEXT\_DOMAIN);?></a> |
| [705](#L705) | <button class="wpext\_module\_action wp-ext-btn-prim wpext\_update\_code\_snippets" ><?php \_e('Save', WP\_EXTENDED\_TEXT\_DOMAIN);?></button> |
| [706](#L706) | <?php } ?> |
| [707](#L707) | </div> |
| [708](#L708) | </div> |
| [709](#L709) | </div> |
| [710](#L710) | </div> |
| [711](#L711) | </div> |
| [712](#L712) | <?php } |
| [713](#L713) |  |
| [714](#L714) | public function wpext\_handle\_snippet\_update() { |
| [715](#L715) |  |
| [716](#L716) | ob\_start(); |
| [717](#L717) | check\_admin\_referer('update\_snippet', 'wpext\_snippet\_nonce'); |
| [718](#L718) |  |
| [719](#L719) | // Check if user has admin capabilities |
| [720](#L720) | if (!current\_user\_can('manage\_options')) { |
| [721](#L721) | wp\_send\_json\_error(['message' => \_\_('You do not have permission to perform this action.', WP\_EXTENDED\_TEXT\_DOMAIN)]); |
| [722](#L722) | return; |
| [723](#L723) | } |
| [724](#L724) |  |
| [725](#L725) | $snippet\_id = isset($\_POST['snippet\_id']) ? intval($\_POST['snippet\_id']) : 0; |
| [726](#L726) | $snippet\_name = sanitize\_text\_field($\_POST['snippet\_name']); |
| [727](#L727) | $snippet\_code = isset($\_POST['snippet\_code']) ? wp\_unslash($\_POST['snippet\_code']) : "<?php echo 'Hello World'; ?>"; |
| [728](#L728) |  |
| [729](#L729) | $snippet\_code\_type = sanitize\_text\_field($\_POST['snippet\_code\_type']); |
| [730](#L730) | $snippet\_position = isset($\_POST['snippet\_position']) ? sanitize\_text\_field($\_POST['snippet\_position']) : ''; |
| [731](#L731) | if(isset($snippet\_code\_type) && $snippet\_code\_type == 'PHP'){ |
| [732](#L732) | $snippet\_position = 'head'; |
| [733](#L733) | }else{ |
| [734](#L734) | $snippet\_position = $snippet\_position; |
| [735](#L735) | } |
| [736](#L736) | $snippet\_code\_sesc = sanitize\_text\_field($\_POST['snippet\_code\_sesc']); |
| [737](#L737) | $snippet\_active = sanitize\_text\_field($\_POST['snippet\_active']); |
| [738](#L738) | if(isset($snippet\_code\_type) && $snippet\_code\_type == 'PHP' && $\_POST['wpext\_update\_flag'] == 'update\_token'){ |
| [739](#L739) | $syntax\_error = $this->check\_php\_syntax\_error($snippet\_code); |
| [740](#L740) | if ($syntax\_error) { |
| [741](#L741) | wp\_send\_json\_error(['message' => $syntax\_error]); |
| [742](#L742) | } |
| [743](#L743) | } |
| [744](#L744) | try { |
| [745](#L745) |  |
| [746](#L746) | $post\_id = wp\_update\_post(array( |
| [747](#L747) | 'ID' => $snippet\_id, |
| [748](#L748) | 'post\_title' => $snippet\_name, |
| [749](#L749) | 'post\_content' => $snippet\_code |
| [750](#L750) | )); |
| [751](#L751) | if (is\_wp\_error($post\_id)) { |
| [752](#L752) | wp\_send\_json\_error(array('message' => $post\_id->get\_error\_message())); |
| [753](#L753) | } |
| [754](#L754) | if ($post\_id !== 0) { |
| [755](#L755) | // Update meta fields |
| [756](#L756) | update\_post\_meta($post\_id, 'snippet\_position', $snippet\_position); |
| [757](#L757) |  |
| [758](#L758) | update\_post\_meta($post\_id, 'snippet\_code\_type', $snippet\_code\_type); |
| [759](#L759) | update\_post\_meta($post\_id, 'snippet\_code\_sesc', $snippet\_code\_sesc); |
| [760](#L760) | update\_post\_meta($post\_id, 'snippet\_active', $snippet\_active); |
| [761](#L761) | wp\_send\_json\_success(array('message' => \_\_('Snippet updated successfully.', WP\_EXTENDED\_TEXT\_DOMAIN))); |
| [762](#L762) | } else { |
| [763](#L763) | wp\_send\_json\_error(array('message' => \_\_('Failed to update snippet.', WP\_EXTENDED\_TEXT\_DOMAIN))); |
| [764](#L764) | } |
| [765](#L765) | } catch (Exception $e) { |
| [766](#L766) | // Catch any other potential errors |
| [767](#L767) | wp\_send\_json\_error(['message' => $e->getMessage()]); |
| [768](#L768) | } |
| [769](#L769) | ob\_end\_clean(); |
| [770](#L770) | wp\_die(); |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | public function wpext\_custom\_css\_content($code){ |
| [774](#L774) | if(!empty($code) && $code == 'PHP'){ |
| [775](#L775) | echo '<style type="text/css"> .wpext\_add\_newsnippets .CodeMirror-sizer:before {  content: "<?php"; padding-bottom: 5px; opacity: 0.5; } </style>'; |
| [776](#L776) | }else if(!empty($code) && $code == 'CSS'){ |
| [777](#L777) | echo '<style type="text/css"> .wpext\_add\_newsnippets .CodeMirror-sizer:before { content: "<style>"; padding-bottom: 5px; opacity: 0.5; } </style>'; |
| [778](#L778) | }else if(!empty($code) && $code == 'HTML'){ |
| [779](#L779) | echo '<style type="text/css"> .wpext\_add\_newsnippets .CodeMirror-sizer:before { content: "<HTML>"; padding-bottom: 5px; opacity: 0.5; } </style>'; |
| [780](#L780) | }else{ |
| [781](#L781) | echo '<style type="text/css"> .wpext\_add\_newsnippets .CodeMirror-sizer:before { content: "<script>"; padding-bottom: 5px; opacity: 0.5; } </style>'; |
| [782](#L782) | } |
| [783](#L783) | } |
| [784](#L784) |  |
| [785](#L785) | private function check\_php\_syntax\_error($snippet\_code) { |
| [786](#L786) | error\_reporting(E\_ALL); |
| [787](#L787) | ini\_set('display\_errors', 1); |
| [788](#L788) | $error = null; |
| [789](#L789) |  |
| [790](#L790) | // Define a custom error handler |
| [791](#L791) | set\_error\_handler(function($errno, $errstr, $errfile, $errline) { |
| [792](#L792) | throw new ErrorException($errstr, $errno, 0, $errfile, $errline); |
| [793](#L793) | }); |
| [794](#L794) |  |
| [795](#L795) | // Define a custom shutdown function to catch fatal errors |
| [796](#L796) | register\_shutdown\_function(function() { |
| [797](#L797) | $error = error\_get\_last(); |
| [798](#L798) | if ($error && ($error['type'] & (E\_ERROR | E\_PARSE | E\_CORE\_ERROR | E\_COMPILE\_ERROR | E\_USER\_ERROR))) { |
| [799](#L799) | // This is a fatal error, return a ParseError-like message |
| [800](#L800) | return 'Fatal error detected on line'; |
| [801](#L801) | echo 'Fatal error detected on line ' . $error['line'] . ' in file ' . $error['file'] . ': ' . $error['message']; |
| [802](#L802) | } |
| [803](#L803) | }); |
| [804](#L804) | try { |
| [805](#L805) | // Attempt to parse the code to check for syntax errors |
| [806](#L806) | $tokens = @token\_get\_all('<?php ' . $snippet\_code); |
| [807](#L807) | if ($tokens === false) { |
| [808](#L808) | return 'Syntax error detected: Invalid PHP code.'; |
| [809](#L809) | } |
| [810](#L810) | ob\_start(); |
| [811](#L811) | eval($snippet\_code); |
| [812](#L812) | ob\_end\_clean(); |
| [813](#L813) | } catch (ParseError $e) { |
| [814](#L814) | return 'Syntax error detected on line ' . $e->getLine() . ': ' . $e->getMessage(); |
| [815](#L815) | } catch (ErrorException $e) { |
| [816](#L816) | return 'Runtime error detected on line ' . $e->getLine() . ': ' . $e->getMessage(); |
| [817](#L817) | } catch (Throwable $e) { |
| [818](#L818) | return 'Error detected on line ' . $e->getLine(); |
| [819](#L819) | } finally { |
| [820](#L820) | // Restore the original error handler |
| [821](#L821) | restore\_error\_handler(); |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | return false; |
| [825](#L825) | } |
| [826](#L826) |  |
| [827](#L827) | public function wpext\_website\_safe\_mode\_callback(){ |
| [828](#L828) | if (is\_admin() && isset($\_GET['page']) && $\_GET['page'] === 'wp-extended-snippets') { |
| [829](#L829) | if (isset($\_GET['wpext\_safe\_mode']) && $\_GET['wpext\_safe\_mode'] === '1') { |
| [830](#L830) | $this->wpext\_deactivate\_all\_snippets(); |
| [831](#L831) | } |
| [832](#L832) | } |
| [833](#L833) | } |
| [834](#L834) | function wpext\_deactivate\_all\_snippets() { |
| [835](#L835) | if (current\_user\_can('manage\_options')) { |
| [836](#L836) | $args = array(  'post\_type'      => 'snippet', 'posts\_per\_page' => -1, 'post\_status'    => 'publish', ); |
| [837](#L837) | $snippets = new WP\_Query($args); |
| [838](#L838) | if ($snippets->have\_posts()) { |
| [839](#L839) | while ($snippets->have\_posts()) { |
| [840](#L840) | $snippets->the\_post(); |
| [841](#L841) | $post\_id = get\_the\_ID(); |
| [842](#L842) | $code\_type = get\_post\_meta($post\_id, 'snippet\_code\_type', true); |
| [843](#L843) | if(!empty($code\_type) && $code\_type == 'PHP'){ |
| [844](#L844) | update\_post\_meta($post\_id, 'snippet\_active', '0'); |
| [845](#L845) | } |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | wp\_reset\_postdata(); |
| [849](#L849) | } |
| [850](#L850) | } |
| [851](#L851) | } |
| [852](#L852) |  |
| [853](#L853) | public function wpext\_show\_snippets\_deleted\_notice() { |
| [854](#L854) | if ($deleted\_count = get\_transient('snippets\_deleted')) { |
| [855](#L855) | $delete\_snippet\_message = sprintf(\_n('%d Code Snippet deleted.', '%d Code Snippets deleted.', $deleted\_count, WP\_EXTENDED\_TEXT\_DOMAIN), $deleted\_count); |
| [856](#L856) | ?> |
| [857](#L857) | <div class="wpext-success-message rounded-2"> |
| [858](#L858) | <span>ⓘ <?php \_e('Success!', WP\_EXTENDED\_TEXT\_DOMAIN ); ?></span>  <?php echo $delete\_snippet\_message; ?> </div> |
| [859](#L859) | <?php |
| [860](#L860) | } |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) |  |
| [864](#L864) | } |
| [865](#L865) |  |
| [866](#L866) | new Wp\_Extended\_Snippets(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php?format=txt)
* [Original Format](/export/3220305/wpextended/trunk/includes/modules/core_extensions/wpext_snippets/wpext_snippets.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


