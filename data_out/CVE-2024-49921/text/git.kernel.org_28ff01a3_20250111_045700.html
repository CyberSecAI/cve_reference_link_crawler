

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alex Hung <alex.hung@amd.com> | 2024-06-25 10:35:52 -0600 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2024-07-23 17:07:12 -0400 |
| commit | [be1fb44389ca3038ad2430dac4234669bc177ee3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be1fb44389ca3038ad2430dac4234669bc177ee3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)) | |
| tree | [5648d7c80fd2f3764c40da4e447a505091603f34](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | |
| parent | [0beca868cde8742240cd0038141c30482d2b7eb8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0beca868cde8742240cd0038141c30482d2b7eb8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be1fb44389ca3038ad2430dac4234669bc177ee3&id2=0beca868cde8742240cd0038141c30482d2b7eb8)) | |
| download | [linux-be1fb44389ca3038ad2430dac4234669bc177ee3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-be1fb44389ca3038ad2430dac4234669bc177ee3.tar.gz) | |

drm/amd/display: Check null pointers before used[WHAT & HOW]
Poniters, such as dc->clk\_mgr, are null checked previously in the same
function, so Coverity warns "implies that "dc->clk\_mgr" might be null".
As a result, these pointers need to be checked when used again.
This fixes 10 FORWARD\_NULL issues reported by Coverity.
Reviewed-by: Rodrigo Siqueira <rodrigo.siqueira@amd.com>
Signed-off-by: Jerry Zuo <jerry.zuo@amd.com>
Signed-off-by: Alex Hung <alex.hung@amd.com>
Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be1fb44389ca3038ad2430dac4234669bc177ee3)

| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/clk\_mgr/dce110/dce110\_clk\_mgr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dce110/dce110_clk_mgr.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10_hubp.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20_hubp.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/protocols/link\_dp\_capability.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3) | 2 | |  |  |  | | --- | --- | --- | |

8 files changed, 17 insertions, 14 deletions

| diff --git a/drivers/gpu/drm/amd/display/dc/clk\_mgr/dce110/dce110\_clk\_mgr.c b/drivers/gpu/drm/amd/display/dc/clk\_mgr/dce110/dce110\_clk\_mgr.cindex 78df96882d6ec5..f8409453434c1c 100644--- a/[drivers/gpu/drm/amd/display/dc/clk\_mgr/dce110/dce110\_clk\_mgr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dce110/dce110_clk_mgr.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/clk\_mgr/dce110/dce110\_clk\_mgr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dce110/dce110_clk_mgr.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -195,7 +195,7 @@ void dce11\_pplib\_apply\_display\_requirements( \* , then change minimum memory clock based on real-time bandwidth \* limitation. \*/- if ((dc->ctx->asic\_id.chip\_family == FAMILY\_AI) &&+ if (dc->bw\_vbios && (dc->ctx->asic\_id.chip\_family == FAMILY\_AI) && ASICREV\_IS\_VEGA20\_P(dc->ctx->asic\_id.hw\_internal\_rev) && (context->stream\_count >= 2)) { pp\_display\_cfg->min\_memory\_clock\_khz = max(pp\_display\_cfg->min\_memory\_clock\_khz, (uint32\_t) div64\_s64(diff --git a/drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10\_hubp.c b/drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10\_hubp.cindex bf399819ca800e..22ac2b7e49aeae 100644--- a/[drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10_hubp.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hubp/dcn10/dcn10_hubp.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -749,7 +749,8 @@ bool hubp1\_is\_flip\_pending(struct hubp \*hubp) if (flip\_pending) return true; - if (earliest\_inuse\_address.grph.addr.quad\_part != hubp->request\_address.grph.addr.quad\_part)+ if (hubp &&+ earliest\_inuse\_address.grph.addr.quad\_part != hubp->request\_address.grph.addr.quad\_part) return true;  return false;diff --git a/drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20\_hubp.c b/drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20\_hubp.cindex 6bba020ad6fbfe..0637e4c552d8a2 100644--- a/[drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20_hubp.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20\_hubp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hubp/dcn20/dcn20_hubp.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -927,7 +927,8 @@ bool hubp2\_is\_flip\_pending(struct hubp \*hubp) if (flip\_pending) return true; - if (earliest\_inuse\_address.grph.addr.quad\_part != hubp->request\_address.grph.addr.quad\_part)+ if (hubp &&+ earliest\_inuse\_address.grph.addr.quad\_part != hubp->request\_address.grph.addr.quad\_part) return true;  return false;diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110\_hwseq.cindex 849b41f886d33c..4593fb2a0536ba 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110_hwseq.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dce110/dce110_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -949,7 +949,7 @@ void dce110\_edp\_backlight\_control( { struct dc\_context \*ctx = link->ctx; struct bp\_transmitter\_control cntl = { 0 };- uint8\_t pwrseq\_instance;+ uint8\_t pwrseq\_instance = 0; unsigned int pre\_T11\_delay = OLED\_PRE\_T11\_DELAY; unsigned int post\_T7\_delay = OLED\_POST\_T7\_DELAY; @@ -1002,7 +1002,8 @@ void dce110\_edp\_backlight\_control( \*/ /\* dc\_service\_sleep\_in\_milliseconds(50); \*/ /\*edp 1.2\*/- pwrseq\_instance = link->panel\_cntl->pwrseq\_inst;+ if (link->panel\_cntl)+ pwrseq\_instance = link->panel\_cntl->pwrseq\_inst;  if (cntl.action == TRANSMITTER\_CONTROL\_BACKLIGHT\_ON) { if (!link->dc->config.edp\_no\_power\_sequencing)diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10\_hwseq.cindex 4846601c612dda..212576dbc3362b 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10_hwseq.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn10/dcn10_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -1553,7 +1553,7 @@ void dcn10\_init\_hw(struct dc \*dc) dc->clk\_mgr->funcs->init\_clocks(dc->clk\_mgr);  /\* Align bw context with hw config when system resume. \*/- if (dc->clk\_mgr->clks.dispclk\_khz != 0 && dc->clk\_mgr->clks.dppclk\_khz != 0) {+ if (dc->clk\_mgr && dc->clk\_mgr->clks.dispclk\_khz != 0 && dc->clk\_mgr->clks.dppclk\_khz != 0) { dc->current\_state->bw\_ctx.bw.dcn.clk.dispclk\_khz = dc->clk\_mgr->clks.dispclk\_khz; dc->current\_state->bw\_ctx.bw.dcn.clk.dppclk\_khz = dc->clk\_mgr->clks.dppclk\_khz; }@@ -1673,7 +1673,7 @@ void dcn10\_init\_hw(struct dc \*dc) REG\_UPDATE(DCFCLK\_CNTL, DCFCLK\_GATE\_DIS, 0); } - if (dc->clk\_mgr->funcs->notify\_wm\_ranges)+ if (dc->clk\_mgr && dc->clk\_mgr->funcs->notify\_wm\_ranges) dc->clk\_mgr->funcs->notify\_wm\_ranges(dc->clk\_mgr); } diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31\_hwseq.cindex 746c522adf84ca..3d4b31bd994691 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -256,10 +256,10 @@ void dcn31\_init\_hw(struct dc \*dc) if (!dcb->funcs->is\_accelerated\_mode(dcb) && dc->res\_pool->hubbub->funcs->init\_watermarks) dc->res\_pool->hubbub->funcs->init\_watermarks(dc->res\_pool->hubbub); - if (dc->clk\_mgr->funcs->notify\_wm\_ranges)+ if (dc->clk\_mgr && dc->clk\_mgr->funcs->notify\_wm\_ranges) dc->clk\_mgr->funcs->notify\_wm\_ranges(dc->clk\_mgr); - if (dc->clk\_mgr->funcs->set\_hard\_max\_memclk && !dc->clk\_mgr->dc\_mode\_softmax\_enabled)+ if (dc->clk\_mgr && dc->clk\_mgr->funcs->set\_hard\_max\_memclk && !dc->clk\_mgr->dc\_mode\_softmax\_enabled) dc->clk\_mgr->funcs->set\_hard\_max\_memclk(dc->clk\_mgr);  if (dc->res\_pool->hubbub->funcs->force\_pstate\_change\_control)diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35\_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35\_hwseq.cindex e4f7078c10269f..ddf0807db627ba 100644--- a/[drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35_hwseq.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35\_hwseq.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn35/dcn35_hwseq.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -235,7 +235,7 @@ void dcn35\_init\_hw(struct dc \*dc) if (hws->funcs.enable\_power\_gating\_plane) hws->funcs.enable\_power\_gating\_plane(dc->hwseq, true); \*/- if (res\_pool->hubbub->funcs->dchubbub\_init)+ if (res\_pool->hubbub && res\_pool->hubbub->funcs->dchubbub\_init) res\_pool->hubbub->funcs->dchubbub\_init(dc->res\_pool->hubbub); /\* If taking control over from VBIOS, we may want to optimize our first \* mode set, so we need to skip powering down pipes until we know which@@ -328,10 +328,10 @@ void dcn35\_init\_hw(struct dc \*dc) if (!dcb->funcs->is\_accelerated\_mode(dcb) && dc->res\_pool->hubbub->funcs->init\_watermarks) dc->res\_pool->hubbub->funcs->init\_watermarks(dc->res\_pool->hubbub); - if (dc->clk\_mgr->funcs->notify\_wm\_ranges)+ if (dc->clk\_mgr && dc->clk\_mgr->funcs->notify\_wm\_ranges) dc->clk\_mgr->funcs->notify\_wm\_ranges(dc->clk\_mgr); - if (dc->clk\_mgr->funcs->set\_hard\_max\_memclk && !dc->clk\_mgr->dc\_mode\_softmax\_enabled)+ if (dc->clk\_mgr && dc->clk\_mgr->funcs->set\_hard\_max\_memclk && !dc->clk\_mgr->dc\_mode\_softmax\_enabled) dc->clk\_mgr->funcs->set\_hard\_max\_memclk(dc->clk\_mgr);  @@ -1039,7 +1039,7 @@ void dcn35\_calc\_blocks\_to\_gate(struct dc \*dc, struct dc\_state \*context, if (pipe\_ctx->plane\_res.hubp) update\_state->pg\_pipe\_res\_update[PG\_HUBP][pipe\_ctx->plane\_res.hubp->inst] = false; - if (pipe\_ctx->plane\_res.dpp)+ if (pipe\_ctx->plane\_res.dpp && pipe\_ctx->plane\_res.hubp) update\_state->pg\_pipe\_res\_update[PG\_DPP][pipe\_ctx->plane\_res.hubp->inst] = false;  if (pipe\_ctx->plane\_res.dpp || pipe\_ctx->stream\_res.opp)diff --git a/drivers/gpu/drm/amd/display/dc/link/protocols/link\_dp\_capability.c b/drivers/gpu/drm/amd/display/dc/link/protocols/link\_dp\_capability.cindex c257e733044a64..f3b6d8936f91fd 100644--- a/[drivers/gpu/drm/amd/display/dc/link/protocols/link\_dp\_capability.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=0beca868cde8742240cd0038141c30482d2b7eb8)+++ b/[drivers/gpu/drm/amd/display/dc/link/protocols/link\_dp\_capability.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=be1fb44389ca3038ad2430dac4234669bc177ee3)@@ -2258,7 +2258,7 @@ bool dp\_verify\_link\_cap\_with\_retries(  memset(&link->verified\_link\_cap, 0, sizeof(struct dc\_link\_settings));- if (!link\_detect\_connection\_type(link, &type) || type == dc\_connection\_none) {+ if (link->link\_enc && (!link\_detect\_connection\_type(link, &type) || type == dc\_connection\_none)) { link->verified\_link\_cap = fail\_safe\_link\_settings; break; } else if (dp\_verify\_link\_cap(link, known\_limit\_link\_setting, &fail\_count)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 04:55:37 +0000

