- **Root cause of vulnerability:** The vulnerability lies in the NUMA node search logic within the `__sgx_alloc_epc_page` function. When the current node lacks an EPC section, and all other EPC sections are exhausted, the function could get stuck in an infinite loop while searching for an available EPC page from remote nodes, causing a soft lockup. The `nid_of_current` was not part of the `sgx_numa_mask`, causing the loop to never terminate if the node didn't have SGX support.
- **Weaknesses/vulnerabilities present:** The main vulnerability is a deadlock scenario within the allocation logic due to a flawed loop condition when searching for an EPC page across NUMA nodes.
- **Impact of exploitation:** The primary impact of exploiting this vulnerability is a soft lockup, effectively rendering the affected CPU core unresponsive.
- **Attack vectors:** This isn't an externally triggered vulnerability. The deadlock can be triggered internally in the allocation process if an SGX application requests EPC memory and the system's NUMA configuration leads to the described deadlock conditions.
- **Required attacker capabilities/position:** The attacker does not directly exploit the vulnerability. It is triggered by the normal SGX memory allocation mechanism under specific circumstances involving node configuration and resource usage.