

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-02-07 18:49:51 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-16 19:10:57 +0100 |
| commit | [b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)) | |
| tree | [3cccfe26b4770fcc4866756627dfff64dc2ac175](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7) | |
| parent | [d850a1f8dbbe6ea7bf6476b215a527e1314bdfe0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d850a1f8dbbe6ea7bf6476b215a527e1314bdfe0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7&id2=d850a1f8dbbe6ea7bf6476b215a527e1314bdfe0)) | |
| download | [linux-b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7.tar.gz) | |

netfilter: nft\_set\_rbtree: skip end interval element from gccommit 60c0c230c6f046da536d3df8b39a20b9a9fd6af0 upstream.
rbtree lazy gc on insert might collect an end interval element that has
been just added in this transactions, skip end interval elements that
are not yet active.
Fixes: f718863aca46 ("netfilter: nft\_set\_rbtree: fix overlap expiration walk")
Cc: stable@vger.kernel.org
Reported-by: lonial con <kongln9170@gmail.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)

| -rw-r--r-- | [net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nft_set_rbtree.c?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/net/netfilter/nft\_set\_rbtree.c b/net/netfilter/nft\_set\_rbtree.cindex e34662f4a71e0f..5bf5572e945cc3 100644--- a/[net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nft_set_rbtree.c?id=d850a1f8dbbe6ea7bf6476b215a527e1314bdfe0)+++ b/[net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nft_set_rbtree.c?id=b734f7a47aeb32a5ba298e4ccc16bb0c52b6dbf7)@@ -235,7 +235,7 @@ static void nft\_rbtree\_gc\_remove(struct net \*net, struct nft\_set \*set,  static const struct nft\_rbtree\_elem \* nft\_rbtree\_gc\_elem(const struct nft\_set \*\_\_set, struct nft\_rbtree \*priv,- struct nft\_rbtree\_elem \*rbe, u8 genmask)+ struct nft\_rbtree\_elem \*rbe) { struct nft\_set \*set = (struct nft\_set \*)\_\_set; struct rb\_node \*prev = rb\_prev(&rbe->node);@@ -254,7 +254,7 @@ nft\_rbtree\_gc\_elem(const struct nft\_set \*\_\_set, struct nft\_rbtree \*priv, while (prev) { rbe\_prev = rb\_entry(prev, struct nft\_rbtree\_elem, node); if (nft\_rbtree\_interval\_end(rbe\_prev) &&- nft\_set\_elem\_active(&rbe\_prev->ext, genmask))+ nft\_set\_elem\_active(&rbe\_prev->ext, NFT\_GENMASK\_ANY)) break;  prev = rb\_prev(prev);@@ -365,7 +365,7 @@ static int \_\_nft\_rbtree\_insert(const struct net \*net, const struct nft\_set \*set, nft\_set\_elem\_active(&rbe->ext, cur\_genmask)) { const struct nft\_rbtree\_elem \*removed\_end; - removed\_end = nft\_rbtree\_gc\_elem(set, priv, rbe, genmask);+ removed\_end = nft\_rbtree\_gc\_elem(set, priv, rbe); if (IS\_ERR(removed\_end)) return PTR\_ERR(removed\_end); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:28:08 +0000

