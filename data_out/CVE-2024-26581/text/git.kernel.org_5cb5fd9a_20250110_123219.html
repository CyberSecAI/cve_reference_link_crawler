

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2024-02-07 18:49:51 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:25:08 +0100 |
| commit | [10e9cb39313627f2eae4cd70c4b742074e998fd8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)) | |
| tree | [530a47355dcfcdbc777d198c809a258cb7968977](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8) | |
| parent | [7fde2acc6d4be689401ff6ed466a707f2f8c1c27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7fde2acc6d4be689401ff6ed466a707f2f8c1c27) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8&id2=7fde2acc6d4be689401ff6ed466a707f2f8c1c27)) | |
| download | [linux-10e9cb39313627f2eae4cd70c4b742074e998fd8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-10e9cb39313627f2eae4cd70c4b742074e998fd8.tar.gz) | |

netfilter: nft\_set\_rbtree: skip end interval element from gccommit 60c0c230c6f046da536d3df8b39a20b9a9fd6af0 upstream.
rbtree lazy gc on insert might collect an end interval element that has
been just added in this transactions, skip end interval elements that
are not yet active.
Fixes: f718863aca46 ("netfilter: nft\_set\_rbtree: fix overlap expiration walk")
Cc: stable@vger.kernel.org
Reported-by: lonial con <kongln9170@gmail.com>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)

| -rw-r--r-- | [net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netfilter/nft_set_rbtree.c?id=10e9cb39313627f2eae4cd70c4b742074e998fd8) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 4 deletions

| diff --git a/net/netfilter/nft\_set\_rbtree.c b/net/netfilter/nft\_set\_rbtree.cindex d9c436fa91b510..2b5f65a424b7e9 100644--- a/[net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nft_set_rbtree.c?id=7fde2acc6d4be689401ff6ed466a707f2f8c1c27)+++ b/[net/netfilter/nft\_set\_rbtree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netfilter/nft_set_rbtree.c?id=10e9cb39313627f2eae4cd70c4b742074e998fd8)@@ -237,8 +237,7 @@ static void nft\_rbtree\_gc\_remove(struct net \*net, struct nft\_set \*set,  static int nft\_rbtree\_gc\_elem(const struct nft\_set \*\_\_set, struct nft\_rbtree \*priv,- struct nft\_rbtree\_elem \*rbe,- u8 genmask)+ struct nft\_rbtree\_elem \*rbe) { struct nft\_set \*set = (struct nft\_set \*)\_\_set; struct rb\_node \*prev = rb\_prev(&rbe->node);@@ -257,7 +256,7 @@ static int nft\_rbtree\_gc\_elem(const struct nft\_set \*\_\_set, while (prev) { rbe\_prev = rb\_entry(prev, struct nft\_rbtree\_elem, node); if (nft\_rbtree\_interval\_end(rbe\_prev) &&- nft\_set\_elem\_active(&rbe\_prev->ext, genmask))+ nft\_set\_elem\_active(&rbe\_prev->ext, NFT\_GENMASK\_ANY)) break;  prev = rb\_prev(prev);@@ -365,7 +364,7 @@ static int \_\_nft\_rbtree\_insert(const struct net \*net, const struct nft\_set \*set, \*/ if (nft\_set\_elem\_expired(&rbe->ext) && nft\_set\_elem\_active(&rbe->ext, cur\_genmask)) {- err = nft\_rbtree\_gc\_elem(set, priv, rbe, genmask);+ err = nft\_rbtree\_gc\_elem(set, priv, rbe); if (err < 0) return err; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:28:12 +0000

