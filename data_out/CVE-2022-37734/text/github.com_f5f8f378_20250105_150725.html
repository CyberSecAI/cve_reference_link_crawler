
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-java%2Fgraphql-java%2Fpull%2F2892)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-java%2Fgraphql-java%2Fpull%2F2892)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=graphql-java%2Fgraphql-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[graphql-java](/graphql-java)
/
**[graphql-java](/graphql-java/graphql-java)**
Public

* [Notifications](/login?return_to=%2Fgraphql-java%2Fgraphql-java) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fgraphql-java%2Fgraphql-java)
* [Star
   6.1k](/login?return_to=%2Fgraphql-java%2Fgraphql-java)

* [Code](/graphql-java/graphql-java)
* [Issues
  22](/graphql-java/graphql-java/issues)
* [Pull requests
  12](/graphql-java/graphql-java/pulls)
* [Discussions](/graphql-java/graphql-java/discussions)
* [Actions](/graphql-java/graphql-java/actions)
* [Projects
  0](/graphql-java/graphql-java/projects)
* [Wiki](/graphql-java/graphql-java/wiki)
* [Security](/graphql-java/graphql-java/security)
* [Insights](/graphql-java/graphql-java/pulse)

Additional navigation options

* [Code](/graphql-java/graphql-java)
* [Issues](/graphql-java/graphql-java/issues)
* [Pull requests](/graphql-java/graphql-java/pulls)
* [Discussions](/graphql-java/graphql-java/discussions)
* [Actions](/graphql-java/graphql-java/actions)
* [Projects](/graphql-java/graphql-java/projects)
* [Wiki](/graphql-java/graphql-java/wiki)
* [Security](/graphql-java/graphql-java/security)
* [Insights](/graphql-java/graphql-java/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgraphql-java%2Fgraphql-java%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgraphql-java%2Fgraphql-java%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# READY - Stop DOS attacks by making the lexer stop early on evil input. #2892

 Merged

[bbakerman](/bbakerman)
merged 11 commits into
[master](/graphql-java/graphql-java/tree/master "graphql-java/graphql-java:master")
from
[ddos\_stop\_lexer\_early](/graphql-java/graphql-java/tree/ddos_stop_lexer_early "graphql-java/graphql-java:ddos_stop_lexer_early")

Jul 26, 2022

 Merged

# [READY - Stop DOS attacks by making the lexer stop early on evil input.](#top) #2892

[bbakerman](/bbakerman)
merged 11 commits into
[master](/graphql-java/graphql-java/tree/master "graphql-java/graphql-java:master")
from
[ddos\_stop\_lexer\_early](/graphql-java/graphql-java/tree/ddos_stop_lexer_early "graphql-java/graphql-java:ddos_stop_lexer_early")

Jul 26, 2022

[Conversation
14](/graphql-java/graphql-java/pull/2892)
[Commits
11](/graphql-java/graphql-java/pull/2892/commits)
[Checks
0](/graphql-java/graphql-java/pull/2892/checks)
[Files changed](/graphql-java/graphql-java/pull/2892/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![bbakerman](https://avatars.githubusercontent.com/u/1661769?s=60&v=4)](/bbakerman)

Copy link

Member

### @bbakerman **[bbakerman](/bbakerman)** commented [Jul 21, 2022](#issue-1312904138) ‚Ä¢ edited Loading

This is related to [#2888](https://github.com/graphql-java/graphql-java/issues/2888)

The bug was that we do indeed have a max token counting mechanism in graphql-java BUt it was being enacted too late.

Testing showed that the max token code was indeed being hit BUT the ANTLR lexing and parsing code was taking proportionally longer to get to the max token state as the input size increased

This is cause bv the greedy nature of the ANTLR Lexer - it will look ahead and store tokens in memory under certain grammar conditions and butted directives like `@lol@lol` are one of them. This meant that the lexer was the code contributing to CPU time and not the parser - BUT the max token code check was in the parser.

This PR puts the same max token checks on the lexer as it does in the parser. In fact it debatable if the parser checks should still be retained (since the lexer will be the main way this will be hit) but the logic is common so I left it in place.

The current existing billion `@lols` test still parse with this change - The difference is where cancel parse exception is being thrown.

The use of the lexer as the place to count means the counting checks are done in constant time. As soon as the max tokens is encountered, the parse is stopped.

graphql-java also uses 3 channels for tokens (0 for the grammar and 2 and 3 for comments and whitespace). The lexing of whitespace and comments also take up CPU time so they counters have been put in place to watch tokens on those channels as well.

This will stop a "mostly whitespace" attack, even though whitespace costs less to aggregate in practice

Sorry, something went wrong.

 üëç
2
 dondonz and pnarozny reacted with thumbs up emoji

All reactions

* üëç
  2 reactions

 [bbakerman](/bbakerman)
added 3 commits
[July 21, 2022 18:47](#commits-pushed-772084a)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early.](/graphql-java/graphql-java/pull/2892/commits/772084a1807ca6101f331ea7362f91533f2c2cb6 "This stops DOS attacks by making the lexer stop early.")`

`[772084a](/graphql-java/graphql-java/pull/2892/commits/772084a1807ca6101f331ea7362f91533f2c2cb6)`

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added BadSitua‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/2caa273c856fe72a4833fb163d082473e8103ed6 "This stops DOS attacks by making the lexer stop early. Added BadSituationsRunner")`
 ‚Ä¶

`[2caa273](/graphql-java/graphql-java/pull/2892/commits/2caa273c856fe72a4833fb163d082473e8103ed6)`

```
‚Ä¶tionsRunner
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added BadSitua‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/30ee65a3c3cb1526f0ecdf16b0a2a087516645da "This stops DOS attacks by making the lexer stop early. Added BadSituationsRunner with comments")`
 ‚Ä¶

`[30ee65a](/graphql-java/graphql-java/pull/2892/commits/30ee65a3c3cb1526f0ecdf16b0a2a087516645da)`

```
‚Ä¶tionsRunner with comments
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)
[bbakerman](/bbakerman)
changed the title
~~Stop DOS attacks by making the lexer stop early on evil input.~~
WIP - Stop DOS attacks by making the lexer stop early on evil input.
[Jul 21, 2022](#event-7037554227)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=80&v=4)](/bbakerman)

Copy link

Member

Author

### **[bbakerman](/bbakerman)** commented [Jul 21, 2022](#issuecomment-1191384576) ‚Ä¢ edited Loading

| The questions to be answered here is whether to track the whitespace and line comment channels or not. They are fast BUT they still take some time BUT not like the grammar channel does.  when we run the ParserBadSituations program with unlimited tokens the numbers for whitespace and comments are something like  ```  Whitespace Bad Payloads(run #2)(1 of 15) - | query length 50020 | bad payloads 5000 | duration 4ms  Whitespace Bad Payloads(run #2)(2 of 15) - | query length 100020 | bad payloads 10000 | duration 9ms  Whitespace Bad Payloads(run #2)(3 of 15) - | query length 150020 | bad payloads 15000 | duration 16ms  Whitespace Bad Payloads(run #2)(4 of 15) - | query length 200020 | bad payloads 20000 | duration 19ms  Whitespace Bad Payloads(run #2)(5 of 15) - | query length 250020 | bad payloads 25000 | duration 28ms  Whitespace Bad Payloads(run #2)(6 of 15) - | query length 300020 | bad payloads 30000 | duration 28ms  Whitespace Bad Payloads(run #2)(7 of 15) - | query length 350020 | bad payloads 35000 | duration 50ms  Whitespace Bad Payloads(run #2)(8 of 15) - | query length 400020 | bad payloads 40000 | duration 41ms  Whitespace Bad Payloads(run #2)(9 of 15) - | query length 450020 | bad payloads 45000 | duration 46ms  Whitespace Bad Payloads(run #2)(10 of 15) - | query length 500020 | bad payloads 50000 | duration 48ms  Whitespace Bad Payloads(run #2)(11 of 15) - | query length 550020 | bad payloads 55000 | duration 55ms  Whitespace Bad Payloads(run #2)(12 of 15) - | query length 600020 | bad payloads 60000 | duration 52ms  Whitespace Bad Payloads(run #2)(13 of 15) - | query length 650020 | bad payloads 65000 | duration 87ms  Whitespace Bad Payloads(run #2)(14 of 15) - | query length 700020 | bad payloads 70000 | duration 84ms  Whitespace Bad Payloads(run #2) - finished | max time was 87 ms  =======================  Comment Bad Payloads(run #2)(1 of 15) - | query length 75022 | bad payloads 5000 | duration 14ms  Comment Bad Payloads(run #2)(2 of 15) - | query length 150022 | bad payloads 10000 | duration 25ms  Comment Bad Payloads(run #2)(3 of 15) - | query length 225022 | bad payloads 15000 | duration 31ms  Comment Bad Payloads(run #2)(4 of 15) - | query length 300022 | bad payloads 20000 | duration 34ms  Comment Bad Payloads(run #2)(5 of 15) - | query length 375022 | bad payloads 25000 | duration 26ms  Comment Bad Payloads(run #2)(6 of 15) - | query length 450022 | bad payloads 30000 | duration 25ms  Comment Bad Payloads(run #2)(7 of 15) - | query length 525022 | bad payloads 35000 | duration 32ms  Comment Bad Payloads(run #2)(8 of 15) - | query length 600022 | bad payloads 40000 | duration 37ms  Comment Bad Payloads(run #2)(9 of 15) - | query length 675022 | bad payloads 45000 | duration 48ms  Comment Bad Payloads(run #2)(10 of 15) - | query length 750022 | bad payloads 50000 | duration 51ms  Comment Bad Payloads(run #2)(11 of 15) - | query length 825022 | bad payloads 55000 | duration 48ms  Comment Bad Payloads(run #2)(12 of 15) - | query length 900022 | bad payloads 60000 | duration 48ms  Comment Bad Payloads(run #2)(13 of 15) - | query length 975022 | bad payloads 65000 | duration 52ms  Comment Bad Payloads(run #2)(14 of 15) - | query length 1050022 | bad payloads 70000 | duration 70ms  Comment Bad Payloads(run #2) - finished | max time was 70 ms  =======================  ```  So it starts to creep up BUT nothing like the grammar file which is 2 orders of magnitude slower!  This is what is discovered debugging. Channel 0 (grammar tokens) get put into the parse tree and this is quite costly when you have 10s of 1000s of them. The cost is in the lexing AND in the parse tree building so it makes total sense for them to be strongly limited.  However there is 2 other channels - whitespace and line comments (`# comments`). Now it turns out that they are NOT anywhere near as costly. The whitespace (while lexed as single tokens per whitespace character) are accumulated (burns some CPU and memory since each becomes a Token) but they are not placed into the parse tree - but rather accumulated. As you can see above it happens relatively fast.  And then when the parser is called back - this line means we throw them away.  ```     private void addIgnoredChars(ParserRuleContext ctx, NodeBuilder nodeBuilder) {         if (!parserOptions.isCaptureIgnoredChars()) {             return;         }  ```  So they accumulate fast enough and then are never used.  The line comments are also accumulated, not as fast because they are actually used in the parser tree.  ```     protected List<Comment> getComments(ParserRuleContext ctx) {         if (!parserOptions.isCaptureLineComments()) {             return NO_COMMENTS;         }  ```  By default (even for queries) we keep the line comments. So an attack vector is to send in  ``` # lots of comments # lots of comments # lots of comments # lots of comments query x { f }  ```  However as the numbers above show even this is fast-ish.  My fear is around whitespace. That 15,000 whitespace characters will catch some queries out. I mean some queries might be say 512KB in size - they will likely be below 15,000 grammar tokens BUT could they be 1/3 whitespace - (170,000 whitespace chars say) - yeah why not.  So this PR as it is (counting whitespace the same as grammar tokens or line comments) will stop them sending in such a query.  I think this leads us towards having 2 `max` values in ParserOptions - the max tokens and a max whitespace number. |
| --- |

All reactions

Sorry, something went wrong.

 [bbakerman](/bbakerman)
added 5 commits
[July 22, 2022 10:32](#commits-pushed-79b989c)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added per quer‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/79b989c582952426beb419888756ba75d56a5f98 "This stops DOS attacks by making the lexer stop early. Added per query jvm settings")`
 ‚Ä¶

`[79b989c](/graphql-java/graphql-java/pull/2892/commits/79b989c582952426beb419888756ba75d56a5f98)`

```
‚Ä¶y jvm settings
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added whitespa‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/888d12380b43c6ced425c2f667542a16015e754b "This stops DOS attacks by making the lexer stop early. Added whitespace counts separate from token counts")`
 ‚Ä¶

`[888d123](/graphql-java/graphql-java/pull/2892/commits/888d12380b43c6ced425c2f667542a16015e754b)`

```
‚Ä¶ce counts separate from token counts
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added whitespa‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/1669ca745630b6971dbef717eca7da442eef5d97 "This stops DOS attacks by making the lexer stop early. Added whitespace counts separate from token counts - tweaks")`
 ‚Ä¶

`[1669ca7](/graphql-java/graphql-java/pull/2892/commits/1669ca745630b6971dbef717eca7da442eef5d97)`

```
‚Ä¶ce counts separate from token counts - tweaks
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added whitespa‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/077e64a906708f6ff23108024af226adcb9c377f "This stops DOS attacks by making the lexer stop early. Added whitespace counts separate from token counts - tweaks")`
 ‚Ä¶

`[077e64a](/graphql-java/graphql-java/pull/2892/commits/077e64a906708f6ff23108024af226adcb9c377f)`

```
‚Ä¶ce counts separate from token counts - tweaks
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early. Added whitespa‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/17ec04b8a1faa0af82fe0679702e961b1c5318cd "This stops DOS attacks by making the lexer stop early. Added whitespace counts separate from token counts - tweaks")`
 ‚Ä¶

`[17ec04b](/graphql-java/graphql-java/pull/2892/commits/17ec04b8a1faa0af82fe0679702e961b1c5318cd)`

```
‚Ä¶ce counts separate from token counts - tweaks
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)
[bbakerman](/bbakerman)
changed the title
~~WIP - Stop DOS attacks by making the lexer stop early on evil input.~~
READY - Stop DOS attacks by making the lexer stop early on evil input.
[Jul 22, 2022](#event-7043256305)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=80&v=4)](/bbakerman)

Copy link

Member

Author

### **[bbakerman](/bbakerman)** commented [Jul 22, 2022](#issuecomment-1192189915)

| After chats with Andi and Donna, we decided to   * add a separate whitespace max token count - this is set at 200\_000 whitespace tokens * add a separate set of default parser options for "operation" parsing versus DSL   + We don't want comment lines captured by default on operation AST elements |
| --- |

All reactions

Sorry, something went wrong.

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)
[bbakerman](/bbakerman)
mentioned this pull request
[Jul 22, 2022](#ref-issue-1307718616)

[Denial of Service via Directive overloading
#2888](/graphql-java/graphql-java/issues/2888)

Closed

 [![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)
[bbakerman](/bbakerman)
requested review from
[andimarek](/andimarek) and
[dondonz](/dondonz)
[July 22, 2022 06:47](#event-7043809224)

 [bbakerman](/bbakerman)
added 2 commits
[July 23, 2022 07:51](#commits-pushed-a0a7cfd)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early.Use array inste‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/a0a7cfd4be7a5848dcf17e46172f64ca2a84ac32 "This stops DOS attacks by making the lexer stop early.Use array instead of map")`
 ‚Ä¶

`[a0a7cfd](/graphql-java/graphql-java/pull/2892/commits/a0a7cfd4be7a5848dcf17e46172f64ca2a84ac32)`

```
‚Ä¶ad of map
```

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[This stops DOS attacks by making the lexer stop early.Use array inste‚Ä¶](/graphql-java/graphql-java/pull/2892/commits/50206dd13d4deccd7e969dd4c2fdff23a115a871 "This stops DOS attacks by making the lexer stop early.Use array instead of map with comments")`
 ‚Ä¶

`[50206dd](/graphql-java/graphql-java/pull/2892/commits/50206dd13d4deccd7e969dd4c2fdff23a115a871)`

```
‚Ä¶ad of map with comments
```

[![andimarek](https://avatars.githubusercontent.com/u/1706744?s=60&v=4)](/andimarek)

**[andimarek](/andimarek)**
requested changes
[Jul 26, 2022](#pullrequestreview-1050224424)

 [View reviewed changes](/graphql-java/graphql-java/pull/2892/files/50206dd13d4deccd7e969dd4c2fdff23a115a871)

Copy link

Member

### @andimarek **[andimarek](/andimarek)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

1: Small naming change

2: I think with introducing defaultOperationParserOptions we should rethink the `SchemaParser.parseImpl` where we overwrite the `maxTokens`. I think we don't need this anymore if we have two different ParserOptions.

Sorry, something went wrong.

All reactions

[src/main/java/graphql/parser/Parser.java](/graphql-java/graphql-java/pull/2892/files/50206dd13d4deccd7e969dd4c2fdff23a115a871#diff-24ba77f7c181cfd66deb300610d9d36d8ad43a42defd2d8d899da88a8c77f989)

|  |  | @@ -46,6 +49,11 @@ | |
| --- | --- | --- | --- |
|  |  | @PublicApi |
|  |  | public class Parser { |
|  |  |  |
|  |  | @Internal |
|  |  | public static final int CHANNEL\_COMMENTS = 2; |
|  |  | @Internal |

Copy link

Member

### @andimarek **[andimarek](/andimarek)** [Jul 26, 2022](#discussion_r929415622)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

lets call this also whitespace channel and not ignored ones to make it consistent with the options.

Sorry, something went wrong.

All reactions

[src/main/java/graphql/parser/ParserOptions.java](/graphql-java/graphql-java/pull/2892/files/50206dd13d4deccd7e969dd4c2fdff23a115a871#diff-cc1fab9887f0cf77d8caf9afdf45a006206cf0a572a09b1c4992af7c06ce53f6)

|  |  | \* If you want to allow more, then {@link #setDefaultParserOptions(ParserOptions)} allows you to change this |
| --- | --- | --- |
|  |  | \* JVM wide. |
|  |  | \*/ |
|  |  | public static final int MAX\_WHITESPACE\_TOKENS = 200\_000; |
|  |  |  |

Copy link

Member

### @andimarek **[andimarek](/andimarek)** [Jul 26, 2022](#discussion_r929420793)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I think we should name this `SDL` parser options or so to make clear it will be used for Schema Parsing. See also my general review comment.

Sorry, something went wrong.

All reactions

[![@andimarek](https://avatars.githubusercontent.com/u/1706744?s=40&u=50064e7ee447e4855942224cd3347d4ba93ba242&v=4)](/andimarek)
[andimarek](/andimarek)
added this to the [19.0](/graphql-java/graphql-java/milestone/38) milestone
[Jul 26, 2022](#event-7061523875)

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[PR feedback - renamed options and added SDL options](/graphql-java/graphql-java/pull/2892/commits/0bd81e7c09fa60ad5a43ee119e4e271e69bc085e "PR feedback - renamed options and added SDL options")`

`[0bd81e7](/graphql-java/graphql-java/pull/2892/commits/0bd81e7c09fa60ad5a43ee119e4e271e69bc085e)`

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)
[bbakerman](/bbakerman)
merged commit [`226aabd`](/graphql-java/graphql-java/commit/226aabd9ffa863387085483e6b73799507b90b2c)
into
master

[Jul 26, 2022](https://github.com/graphql-java/graphql-java/pull/2892#event-7061786896)

[bbakerman](/bbakerman)
added a commit
that referenced
this pull request
[Jul 26, 2022](#ref-commit-1511839)
[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[READY - Stop DOS attacks by making the lexer stop early on evil input. (](/graphql-java/graphql-java/commit/1511839ad6ed7e7ec397b9060926a4d219fc245e "READY - Stop DOS attacks by making the lexer stop early on evil input. (#2892)

Port to 18.x")`
‚Ä¶

`[1511839](/graphql-java/graphql-java/commit/1511839ad6ed7e7ec397b9060926a4d219fc245e)`

```
[#2892](https://github.com/graphql-java/graphql-java/pull/2892))

Port to 18.x
```

This was referenced Jul 26, 2022

[18.x port - Stop DOS attacks by making the lexer stop early on evil input
#2897](/graphql-java/graphql-java/pull/2897)
 Merged

[17.x port - Stop DOS attacks by making the lexer stop early on evil input
#2898](/graphql-java/graphql-java/pull/2898)
 Closed

[17.x port - Stop DOS attacks by making the lexer stop early on evil input
#2901](/graphql-java/graphql-java/pull/2901)
 Closed

[17.x port - Stop DOS attacks by making the lexer stop early on evil input
#2902](/graphql-java/graphql-java/pull/2902)
 Merged

[bbakerman](/bbakerman)
added a commit
that referenced
this pull request
[Jul 26, 2022](#ref-commit-0256fd0)
[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=40&v=4)](/bbakerman)

`[18.x port - Stop DOS attacks by making the lexer stop early on evil i‚Ä¶](/graphql-java/graphql-java/commit/0256fd0627148e5b71218e424c310f48b066a041 "18.x port - Stop DOS attacks by making the lexer stop early on evil input (#2897)

* READY - Stop DOS attacks by making the lexer stop early on evil input. (#2892)

Port to 18.x

* Test stability")`
‚Ä¶

`[0256fd0](/graphql-java/graphql-java/commit/0256fd0627148e5b71218e424c310f48b066a041)`

```
‚Ä¶nput ([#2897](https://github.com/graphql-java/graphql-java/pull/2897))

* READY - Stop DOS attacks by making the lexer stop early on evil input. ([#2892](https://github.com/graphql-java/graphql-java/pull/2892))

Port to 18.x

* Test stability
```

This was referenced Jul 27, 2022

[Bump com.graphql-java:graphql-java from 18.2 to 19.0
vert-x3/vertx-web#2244](/vert-x3/vertx-web/pull/2244)
 Merged

[Bump com.graphql-java:graphql-java from 18.2 to 18.3
vert-x3/vertx-web#2245](/vert-x3/vertx-web/pull/2245)
 Closed

[![@yeikel](https://avatars.githubusercontent.com/u/8935151?s=80&u=4bca54f3f4091b760417174a2e2d96f370d27343&v=4)](/yeikel)

Copy link

Contributor

### **[yeikel](/yeikel)** commented [Jul 28, 2022](#issuecomment-1198314284) ‚Ä¢ edited Loading

| Do you have( or are planning to create) a CVE for this? |
| --- |

All reactions

Sorry, something went wrong.

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=80&v=4)](/bbakerman)

Copy link

Member

Author

### **[bbakerman](/bbakerman)** commented [Jul 29, 2022](#issuecomment-1200004409)

| Do you have( or are planning to create) a CVE for this?  We don't have concrete plans - mainly because we are unsure of the process and the work involved.  If you know more about this works and could coach us on process that would great because we aren't against the idea, we just know very little about the how of it |
| --- |

All reactions

Sorry, something went wrong.

[![@act1on3](https://avatars.githubusercontent.com/u/26700606?s=80&u=4bc520ceab031ff7533b15d607685f97923d3c7c&v=4)](/act1on3)

Copy link

Contributor

### **[act1on3](/act1on3)** commented [Aug 3, 2022](#issuecomment-1203815851) ‚Ä¢ edited Loading

| UPD. [CVE-2022-37734](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-37734) is assigned.  Hi [@bbakerman](https://github.com/bbakerman) , I've requested a CVE with the form: <https://cveform.mitre.org/> |
| --- |

 ‚ù§Ô∏è
1
 yeikel reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@dondonz](https://avatars.githubusercontent.com/u/13839920?s=80&u=743570247659164727a8d67519515874aaac2186&v=4)](/dondonz)

Copy link

Member

### **[dondonz](/dondonz)** commented [Sep 14, 2022](#issuecomment-1246218996)

| [@act1on3](https://github.com/act1on3) I'd like to update the CVE with all versions containing the fix: v19.0/19.1/19.2, v18.3, and v17.4.  I've never had to update a CVE before - do you have any way to edit the text from your end? |
| --- |

 üëç
1
 seanf reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@act1on3](https://avatars.githubusercontent.com/u/26700606?s=80&u=4bc520ceab031ff7533b15d607685f97923d3c7c&v=4)](/act1on3)

Copy link

Contributor

### **[act1on3](/act1on3)** commented [Sep 14, 2022](#issuecomment-1246382607) ‚Ä¢ edited Loading

| Hi [@dondonz](https://github.com/dondonz) , I believe an analyst from MITRE updated it already. Thanks for info. I also have no idea how to update the description :) |
| --- |

All reactions

Sorry, something went wrong.

[![@yeikel](https://avatars.githubusercontent.com/u/8935151?s=80&u=4bca54f3f4091b760417174a2e2d96f370d27343&v=4)](/yeikel)

Copy link

Contributor

### **[yeikel](/yeikel)** commented [Sep 14, 2022](#issuecomment-1246466309)

| Considering the different packports, is the range correct? Ie: are users with 17.x versions that have the backport vulnerable? |
| --- |

All reactions

Sorry, something went wrong.

[![@dondonz](https://avatars.githubusercontent.com/u/13839920?s=80&u=743570247659164727a8d67519515874aaac2186&v=4)](/dondonz)

Copy link

Member

### **[dondonz](/dondonz)** commented [Sep 14, 2022](#issuecomment-1247388136)

| Thanks [@act1on3](https://github.com/act1on3), I ended up contacting MITRE to fix it.  [@yeikel](https://github.com/yeikel) Yes version v17.4 contains the backport, see the release notes <https://github.com/graphql-java/graphql-java/releases/tag/v17.4> |
| --- |

 ‚ù§Ô∏è
1
 yeikel reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@yeikel](https://avatars.githubusercontent.com/u/8935151?s=80&u=4bca54f3f4091b760417174a2e2d96f370d27343&v=4)](/yeikel)

Copy link

Contributor

### **[yeikel](/yeikel)** commented [Sep 14, 2022](#issuecomment-1247410857)

| Thanks [@act1on3](https://github.com/act1on3), I ended up contacting MITRE to fix it.  [@yeikel](https://github.com/yeikel) Yes version v17.4 contains the backport, see the release notes <https://github.com/graphql-java/graphql-java/releases/tag/v17.4>  If that's the case, then we should explicitly state that in the CVE. Otherwise, scanning systems will flag versions that are safe |
| --- |

All reactions

Sorry, something went wrong.

[![@dondonz](https://avatars.githubusercontent.com/u/13839920?s=80&u=743570247659164727a8d67519515874aaac2186&v=4)](/dondonz)

Copy link

Member

### **[dondonz](/dondonz)** commented [Sep 15, 2022](#issuecomment-1247448021)

| [@yeikel](https://github.com/yeikel) I agree, I'm getting automated tickets myself at work. The CVE text has been updated to reference the backported versions.  ``` graphql-java before19.0 is vulnerable to Denial of Service. An attacker can send a malicious GraphQL query that consumes CPU resources. The fixed versions are 19.0 and later, 18.3, and 17.4.  ```  <https://www.cve.org/CVERecord?id=CVE-2022-37734>  I am also speaking to Snyk to fix their recommendation. |
| --- |

 ‚ù§Ô∏è
1
 yeikel reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@hzariv](https://avatars.githubusercontent.com/u/4632611?s=40&v=4)](/hzariv)
[hzariv](/hzariv)
mentioned this pull request
[Sep 21, 2022](#ref-issue-1381268410)

[CVE-2022-37734: Denial of Service (DoS) in graphql-java
Netflix/dgs-framework#1238](/Netflix/dgs-framework/issues/1238)

Closed

[![@benjaminjkraft](https://avatars.githubusercontent.com/u/111238?s=40&v=4)](/benjaminjkraft)
[benjaminjkraft](/benjaminjkraft)
mentioned this pull request
[Jan 5, 2024](#ref-pullrequest-2064074144)

[Add directive limit to prevent overloading
vektah/gqlparser#287](/vektah/gqlparser/pull/287)
 Closed

[estal011](/estal011)
added a commit
to 8btc-OnePiece/graphql-java
that referenced
this pull request
[Jun 6, 2024](#ref-commit-1c6d119)
[![@estal011](https://avatars.githubusercontent.com/u/69830570?s=40&v=4)](/estal011)

`[Merge branch '19.3' into v19.3.Onepiece-10.0.X](/8btc-OnePiece/graphql-java/commit/1c6d1194d563be4f6240ab9e8047700f263e2413 "Merge branch '19.3' into v19.3.Onepiece-10.0.X

* 19.3: (709 commits)
  use class loader in getResource (#3038)
  Stable port of #2940 (#2947)
  Stable port of Diff counts are the same (#2946)
  Stable port of Fix printing directives when they contain something like a formatting specifier (#2919) (#2920) (#2945)
  Stable port of Fix field visibility bug with enum with enum args (#2926) (#2944)
  Stable fix for #2943 (#2943)
  Added test fore intersection
  Xuorig Fix PR - Edge case with GraphQLTypeReference and Schema Transforms (#2906)
  Fix typo in description of skip directive (#2915)
  Add smaller set first optimisation
  Cheaper calculation for narrowing down possible objects in ENO
  Handles isDeprecated not being present in the json
  Defaults Locale when calling validation (#2908)
  DF SelectionSet Benchmark (#2893)
  Test stability (#2903)
  Donna's catch! (#2900)
  Deprecate Apollo Cache Control
  READY - Stop DOS attacks by making the lexer stop early on evil input. (#2892)
  Bump java-dataloader ahead of release
  State is passed explicitly to instrumentation and parameters are NOT mutated (#2769)
  ...

# Conflicts:
#	README.md
#	build.gradle
#	src/main/java/graphql/GraphQL.java
#	src/main/java/graphql/Scalars.java
#	src/main/java/graphql/execution/ValuesResolver.java
#	src/main/java/graphql/relay/SimpleListConnection.java
#	src/main/java/graphql/schema/DataFetchingEnvironmentImpl.java")`
‚Ä¶

`[1c6d119](/8btc-OnePiece/graphql-java/commit/1c6d1194d563be4f6240ab9e8047700f263e2413)`

```
* 19.3: (709 commits)
  use class loader in getResource ([graphql-java#3038](https://github.com/graphql-java/graphql-java/pull/3038))
  Stable port of [graphql-java#2940](https://github.com/graphql-java/graphql-java/pull/2940) ([graphql-java#2947](https://github.com/graphql-java/graphql-java/pull/2947))
  Stable port of Diff counts are the same ([graphql-java#2946](https://github.com/graphql-java/graphql-java/pull/2946))
  Stable port of Fix printing directives when they contain something like a formatting specifier ([graphql-java#2919](https://github.com/graphql-java/graphql-java/issues/2919)) ([graphql-java#2920](https://github.com/graphql-java/graphql-java/pull/2920)) ([graphql-java#2945](https://github.com/graphql-java/graphql-java/pull/2945))
  Stable port of Fix field visibility bug with enum with enum args ([graphql-java#2926](https://github.com/graphql-java/graphql-java/pull/2926)) ([graphql-java#2944](https://github.com/graphql-java/graphql-java/pull/2944))
  Stable fix for [graphql-java#2943](https://github.com/graphql-java/graphql-java/pull/2943) ([graphql-java#2943](https://github.com/graphql-java/graphql-java/pull/2943))
  Added test fore intersection
  Xuorig Fix PR - Edge case with GraphQLTypeReference and Schema Transforms ([graphql-java#2906](https://github.com/graphql-java/graphql-java/pull/2906))
  Fix typo in description of skip directive ([graphql-java#2915](https://github.com/graphql-java/graphql-java/pull/2915))
  Add smaller set first optimisation
  Cheaper calculation for narrowing down possible objects in ENO
  Handles isDeprecated not being present in the json
  Defaults Locale when calling validation ([graphql-java#2908](https://github.com/graphql-java/graphql-java/pull/2908))
  DF SelectionSet Benchmark ([graphql-java#2893](https://github.com/graphql-java/graphql-java/pull/2893))
  Test stability ([graphql-java#2903](https://github.com/graphql-java/graphql-java/pull/2903))
  Donna's catch! ([graphql-java#2900](https://github.com/graphql-java/graphql-java/pull/2900))
  Deprecate Apollo Cache Control
  READY - Stop DOS attacks by making the lexer stop early on evil input. ([graphql-java#2892](https://github.com/graphql-java/graphql-java/pull/2892))
  Bump java-dataloader ahead of release
  State is passed explicitly to instrumentation and parameters are NOT mutated ([graphql-java#2769](https://github.com/graphql-java/graphql-java/pull/2769))
  ...

# Conflicts:
#	README.md
#	build.gradle
#	src/main/java/graphql/GraphQL.java
#	src/main/java/graphql/Scalars.java
#	src/main/java/graphql/execution/ValuesResolver.java
#	src/main/java/graphql/relay/SimpleListConnection.java
#	src/main/java/graphql/schema/DataFetchingEnvironmentImpl.java
```

[![@StevenACoffman](https://avatars.githubusercontent.com/u/1942608?s=40&v=4)](/StevenACoffman)
[StevenACoffman](/StevenACoffman)
mentioned this pull request
[Jun 12, 2024](#ref-issue-2331467251)

[possible denial of service attack due to unlimited errors CVE-2023-49559
99designs/gqlgen#3118](/99designs/gqlgen/issues/3118)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgraphql-java%2Fgraphql-java%2Fpull%2F2892)

Reviewers

[![@andimarek](https://avatars.githubusercontent.com/u/1706744?s=40&v=4)](/andimarek) [andimarek](/andimarek)

andimarek requested changes

[![@dondonz](https://avatars.githubusercontent.com/u/13839920?s=40&v=4)](/dondonz) [dondonz](/dondonz)

 Awaiting requested review from dondonz

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

 [**19.0**](/graphql-java/graphql-java/milestone/38 "19.0")

Development

Successfully merging this pull request may close these issues.

5 participants

[![@bbakerman](https://avatars.githubusercontent.com/u/1661769?s=52&v=4)](/bbakerman) [![@yeikel](https://avatars.githubusercontent.com/u/8935151?s=52&v=4)](/yeikel) [![@act1on3](https://avatars.githubusercontent.com/u/26700606?s=52&v=4)](/act1on3) [![@dondonz](https://avatars.githubusercontent.com/u/13839920?s=52&v=4)](/dondonz) [![@andimarek](https://avatars.githubusercontent.com/u/1706744?s=52&v=4)](/andimarek)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

