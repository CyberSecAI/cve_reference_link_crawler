=== Content from github.com_3345f929_20250111_132129.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F833)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F833)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libsndfile%2Flibsndfile)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libsndfile](/libsndfile)
/
**[libsndfile](/libsndfile/libsndfile)**
Public

* [Notifications](/login?return_to=%2Flibsndfile%2Flibsndfile) You must be signed in to change notification settings
* [Fork
  398](/login?return_to=%2Flibsndfile%2Flibsndfile)
* [Star
   1.5k](/login?return_to=%2Flibsndfile%2Flibsndfile)

* [Code](/libsndfile/libsndfile)
* [Issues
  144](/libsndfile/libsndfile/issues)
* [Pull requests
  27](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects
  0](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

Additional navigation options

* [Code](/libsndfile/libsndfile)
* [Issues](/libsndfile/libsndfile/issues)
* [Pull requests](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# UndefinedBehaviorSanitizer: multiple signed integer overflow #833

Closed

[pietroborrello](/pietroborrello) opened this issue
Apr 29, 2022
· 4 comments

Closed

# [UndefinedBehaviorSanitizer: multiple signed integer overflow](#top) #833

[pietroborrello](/pietroborrello) opened this issue
Apr 29, 2022
· 4 comments

## Comments

[![@pietroborrello](https://avatars.githubusercontent.com/u/18199462?s=80&v=4)](/pietroborrello)

Copy link

### **[pietroborrello](/pietroborrello)** commented [Apr 29, 2022](#issue-1221099891)

| **Describe the bug** UndefinedBehaviorSanitizer: multiple signed integers overflow in the codebase. I attach different testcases that trigger different overflows. **To Reproduce** Built libsndfile using clang-10 according to [the oss-fuzz script](https://github.com/google/oss-fuzz/blob/master/projects/libsndfile/build.sh) with `CXXFLAGS='-O1 -fsanitize=address -fsanitize=array-bounds,bool,builtin,enum,float-divide-by-zero,function,integer-divide-by-zero,null,object-size,return,returns-nonnull-attribute,shift,signed-integer-overflow,unreachable,vla-bound,vptr'`  commit: [4b01368](https://github.com/libsndfile/libsndfile/commit/4b01368fd8a1e4541d7a5d125f70e99d30851718) **Example UBSAN Output** ``` $ ./sndfile_alt_fuzzer id:000006,sig:06,src:001126,time:22443,op:havoc,rep:4,trial:0 INFO: Seed: 3120870912 INFO: Loaded 1 modules   (33759 inline 8-bit counters): 33759 [0x8977c3, 0x89fba2),  INFO: Loaded 1 PC tables (33759 PCs): 33759 [0x6f6b48,0x77a938),  sndfile_alt_fuzzer: Running 1 inputs 1 time(s) each. Running: id:000006,sig:06,src:001126,time:22443,op:havoc,rep:4,trial:0 src/au.c:324:54: runtime error: signed integer overflow: 1684960000 + 779316836 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/au.c:324:54 in  src/au.c:326:29: runtime error: signed integer overflow: 1684960000 + 779316836 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/au.c:326:29 in  src/au.c:327:40: runtime error: signed integer overflow: 1684960000 + 779316836 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/au.c:327:40 in  Executed id:000006,sig:06,src:001126,time:22443,op:havoc,rep:4,trial:0 in 1 ms *** *** NOTE: fuzzing was not performed, you have only ***       executed the target code on a fixed set of inputs. ***  or for example  $ ./sndfile_alt_fuzzer id:000011,sig:06,src:001848,time:296603,op:havoc,rep:4,trial:4 INFO: Seed: 3162641945 INFO: Loaded 1 modules   (33759 inline 8-bit counters): 33759 [0x8977c3, 0x89fba2),  INFO: Loaded 1 PC tables (33759 PCs): 33759 [0x6f6b48,0x77a938),  sndfile_alt_fuzzer: Running 1 inputs 1 time(s) each. Running: id:000011,sig:06,src:001848,time:296603,op:havoc,rep:4,trial:4 src/mat4.c:323:41: runtime error: signed integer overflow: -587202559 * 553648128 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in  src/mat4.c:323:48: runtime error: signed integer overflow: 553648128 * 8 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in  src/mat4.c:107:35: runtime error: signed integer overflow: 8 * -587202559 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:107:35 in  Executed id:000011,sig:06,src:001848,time:296603,op:havoc,rep:4,trial:4 in 1 ms  ```  testcases: [int overflow.zip](https://github.com/libsndfile/libsndfile/files/8591956/int.overflow.zip) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=80&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)

Copy link

Member

### **[evpobr](/evpobr)** commented [May 2, 2022](#issuecomment-1114582082)

| Looks like [OSS-Fuzz 25359](https://oss-fuzz.com/testcase-detail/5925957146509312). |
| --- |

All reactions

Sorry, something went wrong.

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=80&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)

Copy link

Member

### **[evpobr](/evpobr)** commented [May 2, 2022](#issuecomment-1114583518)

| Dublicate of [#789](https://github.com/libsndfile/libsndfile/issues/789) |
| --- |

All reactions

Sorry, something went wrong.

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)
[evpobr](/evpobr)
closed this as [completed](/libsndfile/libsndfile/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[May 2, 2022](#event-6531666624)

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=80&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)

Copy link

Member

### **[evpobr](/evpobr)** commented [May 2, 2022](#issuecomment-1114587840)

| Closed as dublicate. |
| --- |

All reactions

Sorry, something went wrong.

[![@pietroborrello](https://avatars.githubusercontent.com/u/18199462?s=80&v=4)](/pietroborrello)

Copy link

Author

### **[pietroborrello](/pietroborrello)** commented [May 2, 2022](#issuecomment-1114607710)

| Hello, thank you for your reply. The issue 789 linked seems a subset of the bugs reported here. Not sure about the oss-fuzz report, as I do not have access to it |
| --- |

All reactions

Sorry, something went wrong.

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-85515d8)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow in dataend calculation](/amstewart/libsndfile/commit/85515d8306b305a961e4de51398d335aaf8b5028 "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `st_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[85515d8](/amstewart/libsndfile/commit/85515d8306b305a961e4de51398d335aaf8b5028)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `st_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-f193782)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[au: avoid int overflow while calculating data_end](/amstewart/libsndfile/commit/f193782c3d0eea20086c2ac8b3e63ea00794f83e "au: avoid int overflow while calculating data_end

At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(st_count_t)data_end variable.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[f193782](/amstewart/libsndfile/commit/f193782c3d0eea20086c2ac8b3e63ea00794f83e)`

```
At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(st_count_t)data_end variable.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-a5fa6ae)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[avr: fix int overflow in avr_read_header()](/amstewart/libsndfile/commit/a5fa6ae2d16d2145df62f1366afacab0374317fc "avr: fix int overflow in avr_read_header()

Pre-cast hdr.frames to st_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[a5fa6ae](/amstewart/libsndfile/commit/a5fa6ae2d16d2145df62f1366afacab0374317fc)`

```
Pre-cast hdr.frames to st_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-d2a5c0c)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[sds: fix int overflow warning in sample calculation](/amstewart/libsndfile/commit/d2a5c0ce5dd06bf040915a4a23f32d16f38111e9 "sds: fix int overflow warning in sample calculation

The sds_2byte_read() function seems to be composing its uint_32 sample
buffer by shifting the kth and kth+1 bytes into the top 2 bytes of
the sample. It does this by adding the left-shifted bytes together,
which while reasonable in this context, scares the clang sanitizer into
thinking that the ints might overflow.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[d2a5c0c](/amstewart/libsndfile/commit/d2a5c0ce5dd06bf040915a4a23f32d16f38111e9)`

```
The sds_2byte_read() function seems to be composing its uint_32 sample
buffer by shifting the kth and kth+1 bytes into the top 2 bytes of
the sample. It does this by adding the left-shifted bytes together,
which while reasonable in this context, scares the clang sanitizer into
thinking that the ints might overflow.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-ae3e682)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[aiff: fix int overflow when counting header elements](/amstewart/libsndfile/commit/ae3e68234faaa4e4ad90e0cebf50bc0c1d6be6f0 "aiff: fix int overflow when counting header elements

aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[ae3e682](/amstewart/libsndfile/commit/ae3e68234faaa4e4ad90e0cebf50bc0c1d6be6f0)`

```
aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-67e6cf8)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[ircam: fix int overflow in ircam_read_header()](/amstewart/libsndfile/commit/67e6cf81411823e0588fcdce5694a91dc25e53dd "ircam: fix int overflow in ircam_read_header()

When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit st_count_t to store the blockwidth.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[67e6cf8](/amstewart/libsndfile/commit/67e6cf81411823e0588fcdce5694a91dc25e53dd)`

```
When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit st_count_t to store the blockwidth.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-2e4e4d7)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow when calculating blockwidth](/amstewart/libsndfile/commit/2e4e4d78c61ca3d120e4638db04d5dc5051e2f5f "mat4/mat5: fix int overflow when calculating blockwidth

Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[2e4e4d7](/amstewart/libsndfile/commit/2e4e4d78c61ca3d120e4638db04d5dc5051e2f5f)`

```
Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-a063f5c)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[common: fix int overflow in psf_binheader_readf()](/amstewart/libsndfile/commit/a063f5c85e38ff9cbfc4f7a5548de21446ab31f5 "common: fix int overflow in psf_binheader_readf()

The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[a063f5c](/amstewart/libsndfile/commit/a063f5c85e38ff9cbfc4f7a5548de21446ab31f5)`

```
The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-45ce89e)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[nms_adpcm: fix int overflow in signal estimate calculation](/amstewart/libsndfile/commit/45ce89e91e4576289ade4cc9da30f14feff32932 "nms_adpcm: fix int overflow in signal estimate calculation

When computing the ADPCM-state signal-estimate in the nms_adpcm_update()
function, it is possible for the signal-state components to overflow
their integer bounds, leading to undefined behavior.

Calculate the signal estimate within an int64_t to provide enough
numeric space, and clamp the resulting value to within the int
boundaries.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[45ce89e](/amstewart/libsndfile/commit/45ce89e91e4576289ade4cc9da30f14feff32932)`

```
When computing the ADPCM-state signal-estimate in the nms_adpcm_update()
function, it is possible for the signal-state components to overflow
their integer bounds, leading to undefined behavior.

Calculate the signal estimate within an int64_t to provide enough
numeric space, and clamp the resulting value to within the int
boundaries.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-cd852c1)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[nms_adpcm: fix int overflow in sf.frames calc](/amstewart/libsndfile/commit/cd852c1eb72440b7f6ca054a487533a337a347ec "nms_adpcm: fix int overflow in sf.frames calc

When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[cd852c1](/amstewart/libsndfile/commit/cd852c1eb72440b7f6ca054a487533a337a347ec)`

```
When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-7c5d228)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[pcm: fix int overflow in pcm_init()](/amstewart/libsndfile/commit/7c5d228ed12e17b9c5b01c37e3c556eafd40f428 "pcm: fix int overflow in pcm_init()

Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[7c5d228](/amstewart/libsndfile/commit/7c5d228ed12e17b9c5b01c37e3c556eafd40f428)`

```
Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-ef95298)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[rf64: fix int overflow in rf64_read_header()](/amstewart/libsndfile/commit/ef952988dc276c188a2578312969db1ceedd1497 "rf64: fix int overflow in rf64_read_header()

When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[ef95298](/amstewart/libsndfile/commit/ef952988dc276c188a2578312969db1ceedd1497)`

```
When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-03f3473)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[ima_adpcm: fix int overflow in ima_reader_init()](/amstewart/libsndfile/commit/03f3473c90b54802a3e933f050dd37f99224105e "ima_adpcm: fix int overflow in ima_reader_init()

When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[03f3473](/amstewart/libsndfile/commit/03f3473c90b54802a3e933f050dd37f99224105e)`

```
When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)
[amstewart](/amstewart)
mentioned this issue
[Oct 17, 2023](#ref-pullrequest-1948274664)

[Fix various numeric overflow vulns throughout code (CVE-2022-33065)
#979](/libsndfile/libsndfile/pull/979)
 Merged

3 tasks

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-57ad7b6)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow in dataend calculation](/amstewart/libsndfile/commit/57ad7b69431073d52312a69addd46221029ccb08 "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[57ad7b6](/amstewart/libsndfile/commit/57ad7b69431073d52312a69addd46221029ccb08)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-56e6c54)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[au: avoid int overflow while calculating data_end](/amstewart/libsndfile/commit/56e6c5408f1ee6d476b234c105fb28b4998e811b "au: avoid int overflow while calculating data_end

At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[56e6c54](/amstewart/libsndfile/commit/56e6c5408f1ee6d476b234c105fb28b4998e811b)`

```
At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-839fa91)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[avr: fix int overflow in avr_read_header()](/amstewart/libsndfile/commit/839fa9131820d689b2038c81531b618b2932fbe3 "avr: fix int overflow in avr_read_header()

Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[839fa91](/amstewart/libsndfile/commit/839fa9131820d689b2038c81531b618b2932fbe3)`

```
Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-1116fa1)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[sds: fix int overflow warning in sample calculations](/amstewart/libsndfile/commit/1116fa173ea8785c9d881936b2174be6a58c0055 "sds: fix int overflow warning in sample calculations

The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.")`
…

`[1116fa1](/amstewart/libsndfile/commit/1116fa173ea8785c9d881936b2174be6a58c0055)`

```
The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-23188c9)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[aiff: fix int overflow when counting header elements](/amstewart/libsndfile/commit/23188c9b1c34f06ca7f17243425d59403e9eb0db "aiff: fix int overflow when counting header elements

aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[23188c9](/amstewart/libsndfile/commit/23188c9b1c34f06ca7f17243425d59403e9eb0db)`

```
aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-00bd032)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[ircam: fix int overflow in ircam_read_header()](/amstewart/libsndfile/commit/00bd0320d895ef5f3027c75a9df26546bc18f8b7 "ircam: fix int overflow in ircam_read_header()

When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[00bd032](/amstewart/libsndfile/commit/00bd0320d895ef5f3027c75a9df26546bc18f8b7)`

```
When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-590608b)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow when calculating blockwidth](/amstewart/libsndfile/commit/590608bbbded2ca0966dc89c5d9b6bf659f4cb71 "mat4/mat5: fix int overflow when calculating blockwidth

Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[590608b](/amstewart/libsndfile/commit/590608bbbded2ca0966dc89c5d9b6bf659f4cb71)`

```
Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-4ec8609)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[common: fix int overflow in psf_binheader_readf()](/amstewart/libsndfile/commit/4ec860910a4ee91ed4fdf1c0a49f2dad96d595c9 "common: fix int overflow in psf_binheader_readf()

The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[4ec8609](/amstewart/libsndfile/commit/4ec860910a4ee91ed4fdf1c0a49f2dad96d595c9)`

```
The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-0bceb43)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[nms_adpcm: fix int overflow in sf.frames calc](/amstewart/libsndfile/commit/0bceb43f74155bb27d7e02d40618184d1f1b529f "nms_adpcm: fix int overflow in sf.frames calc

When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[0bceb43](/amstewart/libsndfile/commit/0bceb43f74155bb27d7e02d40618184d1f1b529f)`

```
When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-76cd2d9)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[pcm: fix int overflow in pcm_init()](/amstewart/libsndfile/commit/76cd2d930dba1c5807e0005423befcaad6ba15b1 "pcm: fix int overflow in pcm_init()

Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[76cd2d9](/amstewart/libsndfile/commit/76cd2d930dba1c5807e0005423befcaad6ba15b1)`

```
Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-f293929)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[rf64: fix int overflow in rf64_read_header()](/amstewart/libsndfile/commit/f29392987ce767390195069be07976d941791d69 "rf64: fix int overflow in rf64_read_header()

When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[f293929](/amstewart/libsndfile/commit/f29392987ce767390195069be07976d941791d69)`

```
When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

15 hidden items

Load more…

[evpobr](/evpobr)
pushed a commit
that referenced
this issue
[Oct 20, 2023](#ref-commit-3fb27a2)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&v=4)](/evpobr)

`[nms_adpcm: fix int overflow in sf.frames calc](/libsndfile/libsndfile/commit/3fb27a2c93a11dd3321b0b13140d89ebb39060cb "nms_adpcm: fix int overflow in sf.frames calc

When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[3fb27a2](/libsndfile/libsndfile/commit/3fb27a2c93a11dd3321b0b13140d89ebb39060cb)`

```
When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[evpobr](/evpobr)
pushed a commit
that referenced
this issue
[Oct 20, 2023](#ref-commit-09f8f8d)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&v=4)](/evpobr)

`[pcm: fix int overflow in pcm_init()](/libsndfile/libsndfile/commit/09f8f8d5544d98a5a2d28504c02314a2a816ac37 "pcm: fix int overflow in pcm_init()

Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[09f8f8d](/libsndfile/libsndfile/commit/09f8f8d5544d98a5a2d28504c02314a2a816ac37)`

```
Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[evpobr](/evpobr)
pushed a commit
that referenced
this issue
[Oct 20, 2023](#ref-commit-4970402)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&v=4)](/evpobr)

`[rf64: fix int overflow in rf64_read_header()](/libsndfile/libsndfile/commit/49704025956f03751d3436a0bb42287cd7f434b6 "rf64: fix int overflow in rf64_read_header()

When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[4970402](/libsndfile/libsndfile/commit/49704025956f03751d3436a0bb42287cd7f434b6)`

```
When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[evpobr](/evpobr)
pushed a commit
that referenced
this issue
[Oct 20, 2023](#ref-commit-9a82911)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&v=4)](/evpobr)

`[ima_adpcm: fix int overflow in ima_reader_init()](/libsndfile/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151 "ima_adpcm: fix int overflow in ima_reader_init()

When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[9a82911](/libsndfile/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151)`

```
When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-4538e81)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow in dataend calculation](/jpautler/libsndfile/commit/4538e815d47defc080882a1f350028f80d9c704d "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Upstream-Status: Backport [9a829113c88a51e57c1e46473e90609e4b7df151]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[4538e81](/jpautler/libsndfile/commit/4538e815d47defc080882a1f350028f80d9c704d)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Upstream-Status: Backport [[9a82911](https://github.com/jpautler/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151)]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-f11aa2b)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[au: avoid int overflow while calculating data_end](/jpautler/libsndfile/commit/f11aa2b06f1a6fdb178993969cf3d4b9358822b3 "au: avoid int overflow while calculating data_end

At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[f11aa2b](/jpautler/libsndfile/commit/f11aa2b06f1a6fdb178993969cf3d4b9358822b3)`

```
At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-4adfa70)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[avr: fix int overflow in avr_read_header()](/jpautler/libsndfile/commit/4adfa70218c94a2572a19081a8b374f5dde5a73b "avr: fix int overflow in avr_read_header()

Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[4adfa70](/jpautler/libsndfile/commit/4adfa70218c94a2572a19081a8b374f5dde5a73b)`

```
Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-7b308a1)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[sds: fix int overflow warning in sample calculations](/jpautler/libsndfile/commit/7b308a1432411532be82190b8cc2214d06da06b2 "sds: fix int overflow warning in sample calculations

The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.")`
…

`[7b308a1](/jpautler/libsndfile/commit/7b308a1432411532be82190b8cc2214d06da06b2)`

```
The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-f51c0ca)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[aiff: fix int overflow when counting header elements](/jpautler/libsndfile/commit/f51c0ca7d5948f960395953dccb6ee7acb6295c7 "aiff: fix int overflow when counting header elements

aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[f51c0ca](/jpautler/libsndfile/commit/f51c0ca7d5948f960395953dccb6ee7acb6295c7)`

```
aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-397d7b0)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[ircam: fix int overflow in ircam_read_header()](/jpautler/libsndfile/commit/397d7b0986173c4331bef37cbfb9215ba01b500a "ircam: fix int overflow in ircam_read_header()

When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[397d7b0](/jpautler/libsndfile/commit/397d7b0986173c4331bef37cbfb9215ba01b500a)`

```
When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-d9a429f)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow when calculating blockwidth](/jpautler/libsndfile/commit/d9a429f426e3aa32b07fc7f24d3ce5b4288e2bc9 "mat4/mat5: fix int overflow when calculating blockwidth

Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[d9a429f](/jpautler/libsndfile/commit/d9a429f426e3aa32b07fc7f24d3ce5b4288e2bc9)`

```
Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-abf2bab)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[common: fix int overflow in psf_binheader_readf()](/jpautler/libsndfile/commit/abf2bab0e2606b279a209e515ca29c51b7dbc009 "common: fix int overflow in psf_binheader_readf()

The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[abf2bab](/jpautler/libsndfile/commit/abf2bab0e2606b279a209e515ca29c51b7dbc009)`

```
The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-0220390)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[nms_adpcm: fix int overflow in signal estimate](/jpautler/libsndfile/commit/0220390f524b110e2187bf3b508ad3486391dde1 "nms_adpcm: fix int overflow in signal estimate

It is possible (though functionally incorrect) for the signal estimate
calculation in nms_adpcm_update() to overflow the int value of s_e,
resulting in undefined behavior.

Since adpcm state signal values are never practically larger than
16 bits, use smaller numeric sizes throughout the file to avoid the
overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Authored-by: Arthur Taylor <art@ified.ca>
Signed-off-by: Alex Stewart <alex.stewart@ni.com>
Rebased-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[0220390](/jpautler/libsndfile/commit/0220390f524b110e2187bf3b508ad3486391dde1)`

```
It is possible (though functionally incorrect) for the signal estimate
calculation in nms_adpcm_update() to overflow the int value of s_e,
resulting in undefined behavior.

Since adpcm state signal values are never practically larger than
16 bits, use smaller numeric sizes throughout the file to avoid the
overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Authored-by: Arthur Taylor <art@ified.ca>
Signed-off-by: Alex Stewart <alex.stewart@ni.com>
Rebased-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-7bf4881)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow in dataend calculation](/jpautler/libsndfile/commit/7bf488189d5a0b0da15ade4ecf8a7cd666260c5a "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Upstream-Status: Backport [9a829113c88a51e57c1e46473e90609e4b7df151]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[7bf4881](/jpautler/libsndfile/commit/7bf488189d5a0b0da15ade4ecf8a7cd666260c5a)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Upstream-Status: Backport [[9a82911](https://github.com/jpautler/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151)]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-65f84b4)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[au: avoid int overflow while calculating data_end](/jpautler/libsndfile/commit/65f84b47d2d88dc395da602176779b01e2441e5b "au: avoid int overflow while calculating data_end

At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[65f84b4](/jpautler/libsndfile/commit/65f84b47d2d88dc395da602176779b01e2441e5b)`

```
At several points in au_read_header(), we calculate the functional end
of the data segment by adding the (int)au_fmt.dataoffset and the
(int)au_fmt.datasize. This can overflow the implicit int_32 return value
and cause undefined behavior.

Instead, precalculate the value and assign it to a 64-bit
(sf_count_t)data_end variable.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-0b5929a)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[avr: fix int overflow in avr_read_header()](/jpautler/libsndfile/commit/0b5929a43a2ba4203fb6fb84ab51aa1f38aacad3 "avr: fix int overflow in avr_read_header()

Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[0b5929a](/jpautler/libsndfile/commit/0b5929a43a2ba4203fb6fb84ab51aa1f38aacad3)`

```
Pre-cast hdr.frames to sf_count_t, to provide the calculation with
enough numeric space to avoid an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-8ef4ddb)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[sds: fix int overflow warning in sample calculations](/jpautler/libsndfile/commit/8ef4ddb1d5872fc7e243eeec9cfce363bd14af88 "sds: fix int overflow warning in sample calculations

The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.")`
…

`[8ef4ddb](/jpautler/libsndfile/commit/8ef4ddb1d5872fc7e243eeec9cfce363bd14af88)`

```
The sds_*byte_read() functions compose their uint_32 sample buffers by
shifting 7bit samples into a 32bit wide buffer, and adding them
together. Because the 7bit samples are stored in 32bit ints, code
fuzzers become concerned that the addition operation can overflow and
cause undefined behavior.

Instead, bitwise-OR the bytes together - which should accomplish the
same arithmetic operation, without risking an int-overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Do the same for the 3byte and 4byte read functions.
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-8305247)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[aiff: fix int overflow when counting header elements](/jpautler/libsndfile/commit/8305247f365b43298babdb2eae6941c159c34e4f "aiff: fix int overflow when counting header elements

aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[8305247](/jpautler/libsndfile/commit/8305247f365b43298babdb2eae6941c159c34e4f)`

```
aiff_read_basc_chunk() tries to count the AIFF header size by keeping
track of the bytes returned by psf_binheader_readf(). Though improbable,
it is technically possible for these added bytes to exceed the int-sized
`count` accumulator.

Use a 64-bit sf_count_t type for `count`, to ensure that it always has
enough numeric space.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-b9cd0c6)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[ircam: fix int overflow in ircam_read_header()](/jpautler/libsndfile/commit/b9cd0c655ea6efe0853437073fe703ab97c75dae "ircam: fix int overflow in ircam_read_header()

When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[b9cd0c6](/jpautler/libsndfile/commit/b9cd0c655ea6efe0853437073fe703ab97c75dae)`

```
When reading the IRCAM header, it is possible for the calculated
blockwidth to exceed the bounds of a signed int32.

Use a 64bit sf_count_t to store the blockwidth.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-8a2b002)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow when calculating blockwidth](/jpautler/libsndfile/commit/8a2b0023d3ffdd60720e5f01826d9fffc0cbed2b "mat4/mat5: fix int overflow when calculating blockwidth

Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[8a2b002](/jpautler/libsndfile/commit/8a2b0023d3ffdd60720e5f01826d9fffc0cbed2b)`

```
Pre-cast the components of the blockwidth calculation to sf_count_t to
avoid overflowing integers during calculation.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-1b1ea1a)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[common: fix int overflow in psf_binheader_readf()](/jpautler/libsndfile/commit/1b1ea1a8abf3dd15898782b409f1cde852adaee9 "common: fix int overflow in psf_binheader_readf()

The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[1b1ea1a](/jpautler/libsndfile/commit/1b1ea1a8abf3dd15898782b409f1cde852adaee9)`

```
The psf_binheader_readf() function attempts to count and return the
number of bytes traversed in the header. During this accumulation, it is
possible to overflow the int-sized byte_count variable.

Avoid this overflow by checking that the accumulated bytes do not exceed
INT_MAX and throwing an error if they do. This implies that files with
multi-gigabyte headers threaten to produce this error, but I imagine
those files don't really exist - and this error is better than the
undefined behavior which would have resulted previously.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-889de32)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[nms_adpcm: fix int overflow in signal estimate](/jpautler/libsndfile/commit/889de3224fed15923baea78ab1a480816ab98d17 "nms_adpcm: fix int overflow in signal estimate

It is possible (though functionally incorrect) for the signal estimate
calculation in nms_adpcm_update() to overflow the int value of s_e,
resulting in undefined behavior.

Since adpcm state signal values are never practically larger than
16 bits, use smaller numeric sizes throughout the file to avoid the
overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Authored-by: Arthur Taylor <art@ified.ca>
Signed-off-by: Alex Stewart <alex.stewart@ni.com>
Rebased-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[889de32](/jpautler/libsndfile/commit/889de3224fed15923baea78ab1a480816ab98d17)`

```
It is possible (though functionally incorrect) for the signal estimate
calculation in nms_adpcm_update() to overflow the int value of s_e,
resulting in undefined behavior.

Since adpcm state signal values are never practically larger than
16 bits, use smaller numeric sizes throughout the file to avoid the
overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Authored-by: Arthur Taylor <art@ified.ca>
Signed-off-by: Alex Stewart <alex.stewart@ni.com>
Rebased-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-052db7e)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[nms_adpcm: fix int overflow in sf.frames calc](/jpautler/libsndfile/commit/052db7e7b21012081f2c86ca3006a0b53c350667 "nms_adpcm: fix int overflow in sf.frames calc

When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[052db7e](/jpautler/libsndfile/commit/052db7e7b21012081f2c86ca3006a0b53c350667)`

```
When calculating sf.frames from the blocks_total PNMS variable, it is
theoretically possible to overflow the blocks_total int boundaries,
leading to undefined behavior.

Cast blocks_total to a long-sized sf_count_t before the calculation, to
provide it with enough numeric space and because that is the final
typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-497fa83)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[pcm: fix int overflow in pcm_init()](/jpautler/libsndfile/commit/497fa83676f412ffdfb8a4f3c969147bbe52c492 "pcm: fix int overflow in pcm_init()

Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[497fa83](/jpautler/libsndfile/commit/497fa83676f412ffdfb8a4f3c969147bbe52c492)`

```
Cast the int-sized bytewidth variable to a long-sized sf_count_t type
prior to calculating the blockwidth, to provide the calculation with
enough numeric space and sf_count_t is the final typing regardless.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-b5c25b8)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[rf64: fix int overflow in rf64_read_header()](/jpautler/libsndfile/commit/b5c25b85bf71d33e9faac4d1fb6fabadbdc5ba89 "rf64: fix int overflow in rf64_read_header()

When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[b5c25b8](/jpautler/libsndfile/commit/b5c25b85bf71d33e9faac4d1fb6fabadbdc5ba89)`

```
When checking for mismatches between the filelength and riff_size, it is
possible to overflow the temporary riff_size value used in the
comparison by adding a static offset; which is probably fine, but it is
offensive to overflow fuzzers.

Since filelength is always a positive value, simply move the offset to
the other side of the comparison operator as a negative value, avoid the
possibility of an overflow.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-a2c7996)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[ima_adpcm: fix int overflow in ima_reader_init()](/jpautler/libsndfile/commit/a2c79968dbe32a45a4e2f9296d8e5f3113b67776 "ima_adpcm: fix int overflow in ima_reader_init()

When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[a2c7996](/jpautler/libsndfile/commit/a2c79968dbe32a45a4e2f9296d8e5f3113b67776)`

```
When calculating sf.frames, pre-cast samplesperblock to sf_count_t, to
provide the calculation with enough numeric space to avoid overflows.

Other changes in this commit are syntactic, and only to satisfy the git
pre-commit syntax checker.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[mmitchel](/mmitchel)
pushed a commit
to distro-core-curated-mirrors/poky-contrib
that referenced
this issue
[Dec 20, 2024](#ref-commit-7b2df42)
[![@anusurivijay](https://avatars.githubusercontent.com/u/165146323?s=40&v=4)](/anusurivijay) [![@sakoman](https://avatars.githubusercontent.com/u/20076?s=40&v=4)](/sakoman)

`[libsndfile1: Backport fix for](/distro-core-curated-mirrors/poky-contrib/commit/7b2df422347850751d7dbfacb0200ca829d9cf55 "libsndfile1: Backport fix for CVE-2022-33065

Added missing commits for complete CVE fix

Ref: https://github.com/libsndfile/libsndfile/issues/833
     https://ubuntu.com/security/CVE-2022-33065

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>") [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")`
…

`[7b2df42](/distro-core-curated-mirrors/poky-contrib/commit/7b2df422347850751d7dbfacb0200ca829d9cf55)`

```
Added missing commits for complete CVE fix

Ref: [libsndfile/libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)
     <https://ubuntu.com/security/CVE-2022-33065>

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>
```

[brainhoard-github](/brainhoard-github)
pushed a commit
to distro-core-curated-mirrors/poky-contrib
that referenced
this issue
[Jan 3, 2025](#ref-commit-e180f4a)
[![@anusurivijay](https://avatars.githubusercontent.com/u/165146323?s=40&v=4)](/anusurivijay) [![@sakoman](https://avatars.githubusercontent.com/u/20076?s=40&v=4)](/sakoman)

`[libsndfile1: Backport fix for](/distro-core-curated-mirrors/poky-contrib/commit/e180f4ae02614899e293e10d18eaa4f4e261a496 "libsndfile1: Backport fix for CVE-2022-33065

Added missing commits for complete CVE fix

Ref: https://github.com/libsndfile/libsndfile/issues/833
     https://ubuntu.com/security/CVE-2022-33065

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>") [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")`
…

`[e180f4a](/distro-core-curated-mirrors/poky-contrib/commit/e180f4ae02614899e293e10d18eaa4f4e261a496)`

```
Added missing commits for complete CVE fix

Ref: [libsndfile/libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)
     <https://ubuntu.com/security/CVE-2022-33065>

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>
```

[halstead](/halstead)
pushed a commit
to openembedded/openembedded-core
that referenced
this issue
[Jan 9, 2025](#ref-commit-fc34dde)
[![@anusurivijay](https://avatars.githubusercontent.com/u/165146323?s=40&v=4)](/anusurivijay) [![@sakoman](https://avatars.githubusercontent.com/u/20076?s=40&v=4)](/sakoman)

`[libsndfile1: Backport fix for](/openembedded/openembedded-core/commit/fc34dde58e8be19d703479c8e025e27294cdb579 "libsndfile1: Backport fix for CVE-2022-33065

Added missing commits for complete CVE fix

Ref: https://github.com/libsndfile/libsndfile/issues/833
     https://ubuntu.com/security/CVE-2022-33065

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>") [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")`
…

`[fc34dde](/openembedded/openembedded-core/commit/fc34dde58e8be19d703479c8e025e27294cdb579)`

```
Added missing commits for complete CVE fix

Ref: [libsndfile/libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)
     <https://ubuntu.com/security/CVE-2022-33065>

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>
```

[halstead](/halstead)
pushed a commit
to yoctoproject/poky
that referenced
this issue
[Jan 9, 2025](#ref-commit-284b56a)
[![@anusurivijay](https://avatars.githubusercontent.com/u/165146323?s=40&v=4)](/anusurivijay) [![@sakoman](https://avatars.githubusercontent.com/u/20076?s=40&v=4)](/sakoman)

`[libsndfile1: Backport fix for](/yoctoproject/poky/commit/284b56a2e2e51dfafd412b8db4668f852deeeb7a "libsndfile1: Backport fix for CVE-2022-33065

Added missing commits for complete CVE fix

Ref: https://github.com/libsndfile/libsndfile/issues/833
     https://ubuntu.com/security/CVE-2022-33065

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>") [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")`
…

`[284b56a](/yoctoproject/poky/commit/284b56a2e2e51dfafd412b8db4668f852deeeb7a)`

```
Added missing commits for complete CVE fix

Ref: [libsndfile/libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)
     <https://ubuntu.com/security/CVE-2022-33065>

(From OE-Core rev: fc34dde58e8be19d703479c8e025e27294cdb579)

Signed-off-by: Vijay Anusuri <vanusuri@mvista.com>
Signed-off-by: Steve Sakoman <steve@sakoman.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F833)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=52&v=4)](/evpobr) [![@pietroborrello](https://avatars.githubusercontent.com/u/18199462?s=52&v=4)](/pietroborrello)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cf6c86c8_20250111_132127.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F789)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F789)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libsndfile%2Flibsndfile)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libsndfile](/libsndfile)
/
**[libsndfile](/libsndfile/libsndfile)**
Public

* [Notifications](/login?return_to=%2Flibsndfile%2Flibsndfile) You must be signed in to change notification settings
* [Fork
  398](/login?return_to=%2Flibsndfile%2Flibsndfile)
* [Star
   1.5k](/login?return_to=%2Flibsndfile%2Flibsndfile)

* [Code](/libsndfile/libsndfile)
* [Issues
  144](/libsndfile/libsndfile/issues)
* [Pull requests
  27](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects
  0](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

Additional navigation options

* [Code](/libsndfile/libsndfile)
* [Issues](/libsndfile/libsndfile/issues)
* [Pull requests](/libsndfile/libsndfile/pulls)
* [Discussions](/libsndfile/libsndfile/discussions)
* [Actions](/libsndfile/libsndfile/actions)
* [Projects](/libsndfile/libsndfile/projects)
* [Security](/libsndfile/libsndfile/security)
* [Insights](/libsndfile/libsndfile/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flibsndfile%2Flibsndfile%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Signed integer overflow in src/mat4.c:323 #789

Closed

[shao-hua-li](/shao-hua-li) opened this issue
Nov 14, 2021
· 3 comments

Closed

# [Signed integer overflow in src/mat4.c:323](#top) #789

[shao-hua-li](/shao-hua-li) opened this issue
Nov 14, 2021
· 3 comments

Labels
[Bug](/libsndfile/libsndfile/labels/Bug)
Something isn't working

## Comments

[![@shao-hua-li](https://avatars.githubusercontent.com/u/7196360?s=80&u=5ebd324b83545d235b2d0d8eb081122a12754015&v=4)](/shao-hua-li)

Copy link

Contributor

### **[shao-hua-li](/shao-hua-li)** commented [Nov 14, 2021](#issue-1053067692) • edited Loading

| Hi there,  I found an undefined behavior in src/mat4.c:323, which is a signed integer overflow.   * libsndfile version: commit [c7b69d7](https://github.com/libsndfile/libsndfile/commit/c7b69d7589d70de3765d0aab15dad8d6b307d3c7) * Compile args: CFLAGS='-fsanitize=undefined' ./configure --disable-shared && make * Compiler: clang13 * Platform: Ubuntu 20.04.2 LTS, x86\_64 * Reproduce: `./programs/sndfile-metadata-get mat4.c_int_overflow` * POC: [mat4.c\_int\_overflow.tar.gz](https://github.com/libsndfile/libsndfile/files/7534888/mat4.c_int_overflow.tar.gz)   Undefined Behavior Sanitizer report:  ``` src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int' SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in  ```  A possible quick fix is to add explicit type casting in mat4.c:323, like `psf->dataend = psf->dataoffset + (long)rows * cols * psf->bytewidth ;`  Another consequence of this bug is for `clang -O1` and `clang -O2`, the `frame` filed in outputs would be different. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)
[evpobr](/evpobr)
added
the
[Bug](/libsndfile/libsndfile/labels/Bug)
Something isn't working
label
[Nov 16, 2021](#event-5622522626)

[![@arthurt](https://avatars.githubusercontent.com/u/233916?s=80&u=c7f3ee9046152c26954a8984b7d70b548ca920ec&v=4)](/arthurt)

Copy link

Member

### **[arthurt](/arthurt)** commented [Jan 28, 2022](#issuecomment-1024437583) • edited Loading

| mat4.c  ``` 	int		rows, cols, imag ; ... 		psf->dataend = psf->dataoffset + rows * cols * psf->bytewidth ;  ```  So clang is complaining that the result of `rows * cols` overflows a 32-bit int. (Rows and cols are read from the file, and are stored as 32-bit there.)  `psf->dataend` is a sf\_count\_t, so 64-bits. A change of bracketing, or casting rows and cols each to (sf\_count\_t) before the multiplication would fix this. |
| --- |

All reactions

Sorry, something went wrong.

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)
[evpobr](/evpobr)
mentioned this issue
[May 2, 2022](#ref-issue-1221099891)

[UndefinedBehaviorSanitizer: multiple signed integer overflow
#833](/libsndfile/libsndfile/issues/833)

Closed

[![@rfrohl](https://avatars.githubusercontent.com/u/1474150?s=80&u=76b9f7025ea6e851f5857d243560a53c1a610ee5&v=4)](/rfrohl)

Copy link

### **[rfrohl](/rfrohl)** commented [Jul 19, 2023](#issuecomment-1641672529)

| FTR: someone assigned a CVE to this bug report: [CVE-2022-33065](https://nvd.nist.gov/vuln/detail/CVE-2022-33065) |
| --- |

 👍
1
 stiepan reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@stiepan](https://avatars.githubusercontent.com/u/11878086?s=80&u=e43e0a78531e9c6e8131701de3c5eae5cc64a383&v=4)](/stiepan)

Copy link

### **[stiepan](/stiepan)** commented [Aug 9, 2023](#issuecomment-1671176593)

| Hi, Are there any plans/timeline to address this issue and the [CVE-2022-33065](https://nvd.nist.gov/vuln/detail/CVE-2022-33065) vulnerability? |
| --- |

All reactions

Sorry, something went wrong.

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 17, 2023](#ref-commit-85515d8)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow in dataend calculation](/amstewart/libsndfile/commit/85515d8306b305a961e4de51398d335aaf8b5028 "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `st_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[85515d8](/amstewart/libsndfile/commit/85515d8306b305a961e4de51398d335aaf8b5028)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `st_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)
[amstewart](/amstewart)
mentioned this issue
[Oct 17, 2023](#ref-pullrequest-1948274664)

[Fix various numeric overflow vulns throughout code (CVE-2022-33065)
#979](/libsndfile/libsndfile/pull/979)
 Merged

3 tasks

[amstewart](/amstewart)
added a commit
to amstewart/libsndfile
that referenced
this issue
[Oct 19, 2023](#ref-commit-57ad7b6)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart)

`[mat4/mat5: fix int overflow in dataend calculation](/amstewart/libsndfile/commit/57ad7b69431073d52312a69addd46221029ccb08 "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[57ad7b6](/amstewart/libsndfile/commit/57ad7b69431073d52312a69addd46221029ccb08)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=40&u=699d041b284fb2eef783f20786afc842f7d68fba&v=4)](/evpobr)
[evpobr](/evpobr)
closed this as [completed](/libsndfile/libsndfile/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[0754562](/libsndfile/libsndfile/commit/0754562e13d2e63a248a1c82f90b30bc0ffe307c)`
[Oct 20, 2023](#event-10721820501)

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 28, 2023](#ref-commit-4538e81)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow in dataend calculation](/jpautler/libsndfile/commit/4538e815d47defc080882a1f350028f80d9c704d "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Upstream-Status: Backport [9a829113c88a51e57c1e46473e90609e4b7df151]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[4538e81](/jpautler/libsndfile/commit/4538e815d47defc080882a1f350028f80d9c704d)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Upstream-Status: Backport [[9a82911](https://github.com/jpautler/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151)]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[jpautler](/jpautler)
pushed a commit
to jpautler/libsndfile
that referenced
this issue
[Nov 29, 2023](#ref-commit-7bf4881)
[![@amstewart](https://avatars.githubusercontent.com/u/10503146?s=40&u=1c55d4659f03442bd1a1052f10db93e861fd0a03&v=4)](/amstewart) [![@jpautler](https://avatars.githubusercontent.com/u/28267154?s=40&v=4)](/jpautler)

`[mat4/mat5: fix int overflow in dataend calculation](/jpautler/libsndfile/commit/7bf488189d5a0b0da15ade4ecf8a7cd666260c5a "mat4/mat5: fix int overflow in dataend calculation

The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: CVE-2022-33065
Fixes: https://github.com/libsndfile/libsndfile/issues/789
Fixes: https://github.com/libsndfile/libsndfile/issues/833

Upstream-Status: Backport [9a829113c88a51e57c1e46473e90609e4b7df151]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>")`
…

`[7bf4881](/jpautler/libsndfile/commit/7bf488189d5a0b0da15ade4ecf8a7cd666260c5a)`

```
The clang sanitizer warns of a possible signed integer overflow when
calculating the `dataend` value in `mat4_read_header()`.

```
src/mat4.c:323:41: runtime error: signed integer overflow: 205 * -100663296 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:41 in
src/mat4.c:323:48: runtime error: signed integer overflow: 838860800 * 4 cannot be represented in type 'int'
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior src/mat4.c:323:48 in
```

Cast the offending `rows` and `cols` ints to `sf_count_t` (the type of
`dataend` before performing the calculation, to avoid the issue.

CVE: [CVE-2022-33065](https://github.com/advisories/GHSA-q72h-h33r-r8j8 "CVE-2022-33065")
Fixes: [libsndfile#789](https://github.com/libsndfile/libsndfile/issues/789)
Fixes: [libsndfile#833](https://github.com/libsndfile/libsndfile/issues/833)

Upstream-Status: Backport [[9a82911](https://github.com/jpautler/libsndfile/commit/9a829113c88a51e57c1e46473e90609e4b7df151)]

Signed-off-by: Alex Stewart <alex.stewart@ni.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flibsndfile%2Flibsndfile%2Fissues%2F789)

Assignees

No one assigned

Labels

[Bug](/libsndfile/libsndfile/labels/Bug)
Something isn't working

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

5 participants

[![@arthurt](https://avatars.githubusercontent.com/u/233916?s=52&v=4)](/arthurt) [![@rfrohl](https://avatars.githubusercontent.com/u/1474150?s=52&v=4)](/rfrohl) [![@shao-hua-li](https://avatars.githubusercontent.com/u/7196360?s=52&v=4)](/shao-hua-li) [![@evpobr](https://avatars.githubusercontent.com/u/11195016?s=52&v=4)](/evpobr) [![@stiepan](https://avatars.githubusercontent.com/u/11878086?s=52&v=4)](/stiepan)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


