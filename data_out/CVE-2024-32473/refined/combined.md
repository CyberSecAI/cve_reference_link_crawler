=== Content from github.com_3ba5c6e8_20250111_003247.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fsecurity%2Fadvisories%2FGHSA-x84c-p2g9-rqv9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fsecurity%2Fadvisories%2FGHSA-x84c-p2g9-rqv9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

# IPv6 enabled on IPv4-only network interfaces

Moderate

[thaJeztah](/thaJeztah)
published
GHSA-x84c-p2g9-rqv9
Apr 18, 2024

## Package

gomod

github.com/docker/docker
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

26.0.0, 26.0.1

## Patched versions

>= 26.0.2

## Description

In 26.0.0 and 26.0.1, IPv6 is not disabled on network interfaces, including those belonging to networks where `--ipv6=false`.

### Impact

A container with an `ipvlan` or `macvlan` interface will normally be configured to share an external network link with the host machine. Because of this direct access, with IPv6 enabled:

* Containers may be able to communicate with other hosts on the local network over link-local IPv6 addresses.
* If router advertisements are being broadcast over the local network, containers may get SLAAC-assigned addresses.
* The interface will be a member of IPv6 multicast groups.

This means interfaces in IPv4-only networks present an unexpectedly and unnecessarily increased attack surface.

A container with an unexpected IPv6 address can do anything a container configured with an IPv6 address can do. That is, listen for connections on its IPv6 address, open connections to other nodes on the network over IPv6, or attempt a DoS attack by flooding packets from its IPv6 address. This has CVSS score AV:L/AC:H/PR:N/UI:R/S:C/C:N/I:N/A:L (2.7).

Because the container may not be constrained by an IPv6 firewall, there is increased potential for data exfiltration from the container. This has CVSS score AV:L/AC:H/PR:N/UI:R/S:U/C:H/I:N/A:N (4.7).

A remote attacker could send malicious Router Advertisements to divert traffic to itself, a black-hole, or another device. The same attack is possible today for IPv4 macvlan/ipvlan endpoints with ARP spoofing, TLS is commonly used by Internet APIs to mitigate this risk. The presence of an IPv6 route could impact the container's availability by indirectly abusing the behaviour of software which behaves poorly in a dual-stack environment. For example, it could resolve a name to a DNS AAAA record and keep trying to connect over IPv6 without ever falling back to IPv4, potentially denying service to the container. This has CVSS score AV:A/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H (4.5).

### Patches

The issue is patched in 26.0.2.

### Workarounds

To completely disable IPv6 in a container, use `--sysctl=net.ipv6.conf.all.disable_ipv6=1` in the `docker create` or `docker run` command. Or, in the service configuration of a `compose` file, the equivalent:

```
        sysctls:
            - net.ipv6.conf.all.disable_ipv6=1

```
### References

* sysctl configuration using `docker run`:
  + <https://docs.docker.com/reference/cli/docker/container/run/#sysctl>
* sysctl configuration using `docker compose`:
  + <https://docs.docker.com/compose/compose-file/compose-file-v3/#sysctls>

### Severity

Moderate

### CVE ID

CVE-2024-32473

### Weaknesses

No CWEs

### Credits

* [![@robmry](https://avatars.githubusercontent.com/u/148866618?s=40&v=4)](/robmry)
  [robmry](/robmry)
  Remediation developer
* [![@corhere](https://avatars.githubusercontent.com/u/274527?s=40&v=4)](/corhere)
  [corhere](/corhere)
  Analyst
* [![@gabriellavengeo](https://avatars.githubusercontent.com/u/23005021?s=40&v=4)](/gabriellavengeo)
  [gabriellavengeo](/gabriellavengeo)
  Analyst
* [![@akerouanton](https://avatars.githubusercontent.com/u/557933?s=40&v=4)](/akerouanton)
  [akerouanton](/akerouanton)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_720ba8ba_20250111_003247.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F7cef0d9cd1cf221d8c0b7b7aeda69552649e0642)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F7cef0d9cd1cf221d8c0b7b7aeda69552649e0642)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moby%2Fmoby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moby](/moby)
/
**[moby](/moby/moby)**
Public

* [Notifications](/login?return_to=%2Fmoby%2Fmoby) You must be signed in to change notification settings
* [Fork
  18.7k](/login?return_to=%2Fmoby%2Fmoby)
* [Star
   69k](/login?return_to=%2Fmoby%2Fmoby)

* [Code](/moby/moby)
* [Issues
  3.1k](/moby/moby/issues)
* [Pull requests
  419](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects
  4](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

Additional navigation options

* [Code](/moby/moby)
* [Issues](/moby/moby/issues)
* [Pull requests](/moby/moby/pulls)
* [Discussions](/moby/moby/discussions)
* [Actions](/moby/moby/actions)
* [Projects](/moby/moby/projects)
* [Wiki](/moby/moby/wiki)
* [Security](/moby/moby/security)
* [Insights](/moby/moby/pulse)

## Commit

[Permalink](/moby/moby/commit/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-x84c-p2g9-rqv9](https://github.com/advisories/GHSA-x84c-p2g9-rqv9 "GHSA-x84c-p2g9-rqv9")

[Browse files](/moby/moby/tree/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642)
Browse the repository at this point in the history

```
[26.0 backport] Disable IPv6 for endpoints in '--ipv6=false' networks.
```

* Loading branch information

[![@thaJeztah](https://avatars.githubusercontent.com/u/1804568?s=40&v=4)](/thaJeztah)

[thaJeztah](/moby/moby/commits?author=thaJeztah "View all commits by thaJeztah")
authored
Apr 18, 2024

2 parents
[60b9add](/moby/moby/commit/60b9add796ae6bcd25accbb36dc1394eac973ec9)
+
[841c4c8](/moby/moby/commit/841c4c8057bcf5317d6565875595a3f0c046e3fa)

commit 7cef0d9

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**105 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* integration

  + network

    - ipvlan

      * integration/network/ipvlan/ipvlan\_test.go
        [ipvlan\_test.go](#diff-4e77af3183f9a807d8e452a8304267621ea7a08690629e7f3500903ca5f59616)
    - macvlan

      * integration/network/macvlan/macvlan\_test.go
        [macvlan\_test.go](#diff-709b51834959035c1056a8b928724b750a77fefbf0f63169c7f56a7930729426)
  + networking

    - integration/networking/bridge\_test.go
      [bridge\_test.go](#diff-0df09b9999cd98d61a3d5c1e2ce1881f9660fc39dc4b25d4a849c8aa35515d32)
* libnetwork/osl

  + libnetwork/osl/interface\_linux.go
    [interface\_linux.go](#diff-20c7903724a9fdd8d0567bfd74e3279072bd230d2671057a5ae33f3d6d12892a)

## There are no files selected for viewing

26 changes: 25 additions & 1 deletion

26
[integration/network/ipvlan/ipvlan\_test.go](#diff-4e77af3183f9a807d8e452a8304267621ea7a08690629e7f3500903ca5f59616 "integration/network/ipvlan/ipvlan_test.go")

Show comments

[View file](/moby/moby/blob/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642/integration/network/ipvlan/ipvlan_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -94,6 +94,9 @@ func TestDockerNetworkIpvlan(t \*testing.T) { |
|  |  | }, { |
|  |  | name: "L3Addressing", |
|  |  | test: testIpvlanL3Addressing, |
|  |  | }, { |
|  |  | name: "NoIPv6", |
|  |  | test: testIpvlanNoIPv6, |
|  |  | }, |
|  |  | } { |
|  |  |  |
| Expand Down  Expand Up | | @@ -441,6 +444,28 @@ func testIpvlanL3Addressing(t \*testing.T, ctx context.Context, client dclient.AP |
|  |  | assert.Check(t, is.Contains(result.Combined(), "default dev eth0")) |
|  |  | } |
|  |  |  |
|  |  | // Check that an ipvlan interface with '--ipv6=false' doesn't get kernel-assigned |
|  |  | // IPv6 addresses, but the loopback interface does still have an IPv6 address ('::1'). |
|  |  | func testIpvlanNoIPv6(t \*testing.T, ctx context.Context, client dclient.APIClient) { |
|  |  | const netName = "ipvlannet" |
|  |  | net.CreateNoError(ctx, t, client, netName, net.WithIPvlan("", "l3")) |
|  |  | assert.Check(t, n.IsNetworkAvailable(ctx, client, netName)) |
|  |  |  |
|  |  | id := container.Run(ctx, t, client, container.WithNetworkMode(netName)) |
|  |  |  |
|  |  | loRes := container.ExecT(ctx, t, client, id, []string{"ip", "a", "show", "dev", "lo"}) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet ")) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet6 ")) |
|  |  |  |
|  |  | eth0Res := container.ExecT(ctx, t, client, id, []string{"ip", "a", "show", "dev", "eth0"}) |
|  |  | assert.Check(t, is.Contains(eth0Res.Combined(), " inet ")) |
|  |  | assert.Check(t, !strings.Contains(eth0Res.Combined(), " inet6 "), |
|  |  | "result.Combined(): %s", eth0Res.Combined()) |
|  |  |  |
|  |  | sysctlRes := container.ExecT(ctx, t, client, id, []string{"sysctl", "-n", "net.ipv6.conf.eth0.disable\_ipv6"}) |
|  |  | assert.Check(t, is.Equal(strings.TrimSpace(sysctlRes.Combined()), "1")) |
|  |  | } |
|  |  |  |
|  |  | // TestIPVlanDNS checks whether DNS is forwarded, for combinations of l2/l3 mode, |
|  |  | // with/without a parent interface, and with '--internal'. Note that, there's no |
|  |  | // attempt here to give the ipvlan network external connectivity - when this test |
| Expand All | | @@ -452,7 +477,6 @@ func testIpvlanL3Addressing(t \*testing.T, ctx context.Context, client dclient.AP |
|  |  | // https://github.com/moby/moby/issues/47662 |
|  |  | func TestIPVlanDNS(t \*testing.T) { |
|  |  | skip.If(t, testEnv.IsRootless, "rootless mode has different view of network") |
|  |  |  |
|  |  | ctx := testutil.StartSpan(baseContext, t) |
|  |  |  |
|  |  | net.StartDaftDNS(t, "127.0.0.1") |
| Expand Down | |  |

29 changes: 29 additions & 0 deletions

29
[integration/network/macvlan/macvlan\_test.go](#diff-709b51834959035c1056a8b928724b750a77fefbf0f63169c7f56a7930729426 "integration/network/macvlan/macvlan_test.go")

Show comments

[View file](/moby/moby/blob/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642/integration/network/macvlan/macvlan_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -77,6 +77,9 @@ func TestDockerNetworkMacvlan(t \*testing.T) { |
|  |  | }, { |
|  |  | name: "Addressing", |
|  |  | test: testMacvlanAddressing, |
|  |  | }, { |
|  |  | name: "NoIPv6", |
|  |  | test: testMacvlanNoIPv6, |
|  |  | }, |
|  |  | } { |
|  |  | tc := tc |
| Expand Down  Expand Up | | @@ -298,6 +301,32 @@ func testMacvlanAddressing(t \*testing.T, ctx context.Context, client client.APIC |
|  |  | assert.Check(t, strings.Contains(result.Combined(), "default via 2001:db8:abca::254 dev eth0")) |
|  |  | } |
|  |  |  |
|  |  | // Check that a macvlan interface with '--ipv6=false' doesn't get kernel-assigned |
|  |  | // IPv6 addresses, but the loopback interface does still have an IPv6 address ('::1'). |
|  |  | func testMacvlanNoIPv6(t \*testing.T, ctx context.Context, client client.APIClient) { |
|  |  | const netName = "macvlannet" |
|  |  |  |
|  |  | net.CreateNoError(ctx, t, client, netName, |
|  |  | net.WithMacvlan(""), |
|  |  | net.WithOption("macvlan\_mode", "bridge"), |
|  |  | ) |
|  |  | assert.Check(t, n.IsNetworkAvailable(ctx, client, netName)) |
|  |  |  |
|  |  | id := container.Run(ctx, t, client, container.WithNetworkMode(netName)) |
|  |  |  |
|  |  | loRes := container.ExecT(ctx, t, client, id, []string{"ip", "a", "show", "dev", "lo"}) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet ")) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet6 ")) |
|  |  |  |
|  |  | eth0Res := container.ExecT(ctx, t, client, id, []string{"ip", "a", "show", "dev", "eth0"}) |
|  |  | assert.Check(t, is.Contains(eth0Res.Combined(), " inet ")) |
|  |  | assert.Check(t, !strings.Contains(eth0Res.Combined(), " inet6 "), |
|  |  | "result.Combined(): %s", eth0Res.Combined()) |
|  |  |  |
|  |  | sysctlRes := container.ExecT(ctx, t, client, id, []string{"sysctl", "-n", "net.ipv6.conf.eth0.disable\_ipv6"}) |
|  |  | assert.Check(t, is.Equal(strings.TrimSpace(sysctlRes.Combined()), "1")) |
|  |  | } |
|  |  |  |
|  |  | // TestMACVlanDNS checks whether DNS is forwarded, with/without a parent |
|  |  | // interface, and with '--internal'. Note that there's no attempt here to give |
|  |  | // the macvlan network external connectivity - when this test supplies a parent |
| Expand Down | |  |

39 changes: 37 additions & 2 deletions

39
[integration/networking/bridge\_test.go](#diff-0df09b9999cd98d61a3d5c1e2ce1881f9660fc39dc4b25d4a849c8aa35515d32 "integration/networking/bridge_test.go")

Show comments

[View file](/moby/moby/blob/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642/integration/networking/bridge_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,6 +4,7 @@ import ( |
|  |  | "context" |
|  |  | "fmt" |
|  |  | "regexp" |
|  |  | "strings" |
|  |  | "testing" |
|  |  | "time" |
|  |  |  |
| Expand Down  Expand Up | | @@ -611,8 +612,8 @@ func TestInternalNwConnectivity(t \*testing.T) { |
|  |  | assert.Check(t, is.Contains(res.Stderr(), "Network is unreachable")) |
|  |  | } |
|  |  |  |
|  |  | // Check that the container's interface has no IPv6 address when IPv6 is |
|  |  | // disabled in a container via sysctl. |
|  |  | // Check that the container's interfaces have no IPv6 address when IPv6 is |
|  |  | // disabled in a container via sysctl (including 'lo'). |
|  |  | func TestDisableIPv6Addrs(t \*testing.T) { |
|  |  | skip.If(t, testEnv.DaemonInfo.OSType == "windows") |
|  |  |  |
| Expand Down  Expand Up | | @@ -676,6 +677,40 @@ func TestDisableIPv6Addrs(t \*testing.T) { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Check that an interface to an '--ipv6=false' network has no IPv6 |
|  |  | // address - either IPAM assigned, or kernel-assigned LL, but the loopback |
|  |  | // interface does still have an IPv6 address ('::1'). |
|  |  | func TestNonIPv6Network(t \*testing.T) { |
|  |  | skip.If(t, testEnv.DaemonInfo.OSType == "windows") |
|  |  |  |
|  |  | ctx := setupTest(t) |
|  |  | d := daemon.New(t) |
|  |  | d.StartWithBusybox(ctx, t) |
|  |  | defer d.Stop(t) |
|  |  |  |
|  |  | c := d.NewClientT(t) |
|  |  | defer c.Close() |
|  |  |  |
|  |  | const netName = "testnet" |
|  |  | network.CreateNoError(ctx, t, c, netName) |
|  |  | defer network.RemoveNoError(ctx, t, c, netName) |
|  |  |  |
|  |  | id := container.Run(ctx, t, c, container.WithNetworkMode(netName)) |
|  |  | defer c.ContainerRemove(ctx, id, containertypes.RemoveOptions{Force: true}) |
|  |  |  |
|  |  | loRes := container.ExecT(ctx, t, c, id, []string{"ip", "a", "show", "dev", "lo"}) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet ")) |
|  |  | assert.Check(t, is.Contains(loRes.Combined(), " inet6 ")) |
|  |  |  |
|  |  | eth0Res := container.ExecT(ctx, t, c, id, []string{"ip", "a", "show", "dev", "eth0"}) |
|  |  | assert.Check(t, is.Contains(eth0Res.Combined(), " inet ")) |
|  |  | assert.Check(t, !strings.Contains(eth0Res.Combined(), " inet6 "), |
|  |  | "result.Combined(): %s", eth0Res.Combined()) |
|  |  |  |
|  |  | sysctlRes := container.ExecT(ctx, t, c, id, []string{"sysctl", "-n", "net.ipv6.conf.eth0.disable\_ipv6"}) |
|  |  | assert.Check(t, is.Equal(strings.TrimSpace(sysctlRes.Combined()), "1")) |
|  |  | } |
|  |  |  |
|  |  | // Test that it's possible to set a sysctl on an interface in the container. |
|  |  | // Regression test for https://github.com/moby/moby/issues/47619 |
|  |  | func TestSetInterfaceSysctl(t \*testing.T) { |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[libnetwork/osl/interface\_linux.go](#diff-20c7903724a9fdd8d0567bfd74e3279072bd230d2671057a5ae33f3d6d12892a "libnetwork/osl/interface_linux.go")

Show comments

[View file](/moby/moby/blob/7cef0d9cd1cf221d8c0b7b7aeda69552649e0642/libnetwork/osl/interface_linux.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -363,17 +363,24 @@ func setInterfaceIP(nlh \*netlink.Handle, iface netlink.Link, i \*Interface) error |
|  |  | } |
|  |  |  |
|  |  | func setInterfaceIPv6(nlh \*netlink.Handle, iface netlink.Link, i \*Interface) error { |
|  |  | if i.AddressIPv6() == nil { |
|  |  | addr := i.AddressIPv6() |
|  |  | // IPv6 must be enabled on the interface if and only if the network is |
|  |  | // IPv6-enabled. For an interface on an IPv4-only network, if IPv6 isn't |
|  |  | // disabled, the interface will be put into IPv6 multicast groups making |
|  |  | // it unexpectedly susceptible to NDP cache poisoning, route injection, etc. |
|  |  | // (At present, there will always be a pre-configured IPv6 address if the |
|  |  | // network is IPv6-enabled.) |
|  |  | if err := setIPv6(i.ns.path, i.DstName(), addr != nil); err != nil { |
|  |  | return fmt.Errorf("failed to configure ipv6: %v", err) |
|  |  | } |
|  |  | if addr == nil { |
|  |  | return nil |
|  |  | } |
|  |  | if err := checkRouteConflict(nlh, i.AddressIPv6(), netlink.FAMILY\_V6); err != nil { |
|  |  | if err := checkRouteConflict(nlh, addr, netlink.FAMILY\_V6); err != nil { |
|  |  | return err |
|  |  | } |
|  |  | if err := setIPv6(i.ns.path, i.DstName(), true); err != nil { |
|  |  | return fmt.Errorf("failed to enable ipv6: %v", err) |
|  |  | } |
|  |  | ipAddr := &netlink.Addr{IPNet: i.AddressIPv6(), Label: "", Flags: syscall.IFA\_F\_NODAD} |
|  |  | return nlh.AddrAdd(iface, ipAddr) |
|  |  | nlAddr := &netlink.Addr{IPNet: addr, Label: "", Flags: syscall.IFA\_F\_NODAD} |
|  |  | return nlh.AddrAdd(iface, nlAddr) |
|  |  | } |
|  |  |  |
|  |  | func setInterfaceLinkLocalIPs(nlh \*netlink.Handle, iface netlink.Link, i \*Interface) error { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7cef0d9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoby%2Fmoby%2Fcommit%2F7cef0d9cd1cf221d8c0b7b7aeda69552649e0642) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


