From 450259e501b94c9d483efb167cb2bf875605e111 Mon Sep 17 00:00:00 2001
From: dvz <devilshakerz@gmail.com>
Date: Tue, 30 Apr 2024 18:13:10 +0200
Subject: [PATCH] Fix backups directory .htaccess deletion

---
 admin/modules/tools/backupdb.php | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/admin/modules/tools/backupdb.php b/admin/modules/tools/backupdb.php
index 88919b9bb8..8d986c8460 100644
--- a/admin/modules/tools/backupdb.php
+++ b/admin/modules/tools/backupdb.php
@@ -100,8 +100,9 @@ function clear_overflow($fp, &$contents)
 	}
 
 	$file = basename($mybb->input['file']);
+    $ext = get_extension($file);
 
-	if(!trim($mybb->input['file']) || !file_exists(MYBB_ADMIN_DIR.'backups/'.$file))
+    if(!trim($mybb->input['file']) || !file_exists(MYBB_ADMIN_DIR.'backups/'.$file) || filetype(MYBB_ADMIN_DIR.'backups/'.$file) != 'file' || ($ext != 'gz' && $ext != 'sql'))
 	{
 		flash_message($lang->error_backup_doesnt_exist, 'error');
 		admin_redirect("index.php?module=tools-backupdb");
