```
{
  "cveId": "CVE-2024-35955",
  "description": "The provided documents describe a use-after-free vulnerability in the kprobes module of the Linux kernel. This vulnerability arises due to an issue with how kprobes verifies if an address is in module text. The vulnerability is addressed in multiple commits.",
  "vulnerabilityDetails": {
    "rootCause": "The vulnerability stems from the fact that module states can change during the kprobe registration process. Specifically, a module can transition from MODULE_STATE_LIVE to MODULE_STATE_GOING to MODULE_STATE_UNFORMED. The functions `is_module_text_address()` and `__module_text_address()` only work when a module's state is either `MODULE_STATE_LIVE` or `MODULE_STATE_GOING`. If these functions are called separately, there is a window of opportunity where the first call succeeds, but the second fails due to the module transitioning to MODULE_STATE_UNFORMED.  When the second call fails, the code doesn't properly account for the state change and proceeds as if the address were in kernel text. This leads to attempting to modify freed module memory, resulting in use-after-free when `arm_kprobe()` is called.",
    "weaknesses": [
      "Use-After-Free",
      "Race Condition",
      "Incorrect State Handling"
    ],
    "impact": "The impact of this vulnerability is a use-after-free condition which could potentially allow an attacker to corrupt kernel memory or cause a denial of service.",
    "attackVectors": "The vulnerability can be exploited when registering a kprobe on a module that is in the process of being unloaded. Specifically, when an attacker uses kprobes to probe a module address which is being unloaded.",
    "requiredCapabilities": "The attacker would require the capability to register a kprobe with a module address, and cause a module to unload during the kprobe registration process."
  },
  "affectedVersions": [
        "Linux kernel versions prior to the fixes"
  ],
    "fixes": [
        "The fix addresses the vulnerability by replacing the separate calls to `is_module_text_address()` and `__module_text_address()` with a single call to `__module_text_address()` and also ensures the module is active by using `try_module_get(module)`. This change prevents the race condition where module states can change between checks."
    ],
  "additionalNotes": "The fixes are present in multiple commits: 325f3fb551f8cd672dbbfc4cf58b14f9ee3fc9e8, d15023fb407337028a654237d8968fefdcf87c2f, 36b57c7d2f8b7de224980f1a284432846ad71ca0, 2df2dd27066cdba8041e46a64362325626bdfb2e, 93eb31e7c3399e326259f2caa17be1e821f5a412, b5808d40093403334d939e2c3c417144d12a6f33 and 5062d1f4f07facbdade0f402d9a04a788f52e26d"
}
```