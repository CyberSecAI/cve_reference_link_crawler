<!DOCTYPE html>
<html lang='en'>
<head>
<title>KVM: Stop looking for coalesced MMIO zones if the bus is destroyed - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='50cbad42bfea8c052b7ca590bd4126cdc898713c'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='50cbad42bfea8c052b7ca590bd4126cdc898713c'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='50cbad42bfea8c052b7ca590bd4126cdc898713c'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Sean Christopherson &lt;seanjc@google.com&gt;</td><td class='right'>2021-04-12 15:20:49 -0700</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2021-05-14 10:52:13 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>50cbad42bfea8c052b7ca590bd4126cdc898713c</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>f5da776f97bc1485b0c90f36fa492630c42d4950</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=30f46c6993731efb2a690c9197c0fd9ed425da2d'>30f46c6993731efb2a690c9197c0fd9ed425da2d</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c&amp;id2=30f46c6993731efb2a690c9197c0fd9ed425da2d'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-50cbad42bfea8c052b7ca590bd4126cdc898713c.tar.gz'>linux-50cbad42bfea8c052b7ca590bd4126cdc898713c.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>KVM: Stop looking for coalesced MMIO zones if the bus is destroyed</div><div class='commit-msg'>commit 5d3c4c79384af06e3c8e25b7770b6247496b4417 upstream.

Abort the walk of coalesced MMIO zones if kvm_io_bus_unregister_dev()
fails to allocate memory for the new instance of the bus.  If it can't
instantiate a new bus, unregister_dev() destroys all devices _except_ the
target device.   But, it doesn't tell the caller that it obliterated the
bus and invoked the destructor for all devices that were on the bus.  In
the coalesced MMIO case, this can result in a deleted list entry
dereference due to attempting to continue iterating on coalesced_zones
after future entries (in the walk) have been deleted.

Opportunistically add curly braces to the for-loop, which encompasses
many lines but sneaks by without braces due to the guts being a single
if statement.

Fixes: f65886606c2d ("KVM: fix memory leak in kvm_io_bus_unregister_dev()")
Cc: stable@vger.kernel.org
Reported-by: Hao Sun &lt;sunhao.th@gmail.com&gt;
Signed-off-by: Sean Christopherson &lt;seanjc@google.com&gt;
Message-Id: &lt;20210412222050.876100-3-seanjc@google.com&gt;
Signed-off-by: Paolo Bonzini &lt;pbonzini@redhat.com&gt;
Signed-off-by: Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/kvm_host.h?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>include/linux/kvm_host.h</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='19%'><tr><td class='add' style='width: 10.5%;'/><td class='rem' style='width: 10.5%;'/><td class='none' style='width: 78.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/virt/kvm/coalesced_mmio.c?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>virt/kvm/coalesced_mmio.c</a></td><td class='right'>19</td><td class='graph'><table summary='file diffstat' width='19%'><tr><td class='add' style='width: 89.5%;'/><td class='rem' style='width: 10.5%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/virt/kvm/kvm_main.c?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>virt/kvm/kvm_main.c</a></td><td class='right'>10</td><td class='graph'><table summary='file diffstat' width='19%'><tr><td class='add' style='width: 26.3%;'/><td class='rem' style='width: 26.3%;'/><td class='none' style='width: 47.4%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>3 files changed, 24 insertions, 9 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/linux/kvm_host.h b/include/linux/kvm_host.h<br/>index 1b65e7204344a5..99dccea4293c63 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/kvm_host.h?id=30f46c6993731efb2a690c9197c0fd9ed425da2d'>include/linux/kvm_host.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/kvm_host.h?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>include/linux/kvm_host.h</a></div><div class='hunk'>@@ -192,8 +192,8 @@ int kvm_io_bus_read(struct kvm_vcpu *vcpu, enum kvm_bus bus_idx, gpa_t addr,</div><div class='ctx'> 		    int len, void *val);</div><div class='ctx'> int kvm_io_bus_register_dev(struct kvm *kvm, enum kvm_bus bus_idx, gpa_t addr,</div><div class='ctx'> 			    int len, struct kvm_io_device *dev);</div><div class='del'>-void kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='del'>-			       struct kvm_io_device *dev);</div><div class='add'>+int kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='add'>+			      struct kvm_io_device *dev);</div><div class='ctx'> struct kvm_io_device *kvm_io_bus_get_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='ctx'> 					 gpa_t addr);</div><div class='ctx'> </div><div class='head'>diff --git a/virt/kvm/coalesced_mmio.c b/virt/kvm/coalesced_mmio.c<br/>index 62bd908ecd580a..f08f5e82460b1d 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/virt/kvm/coalesced_mmio.c?id=30f46c6993731efb2a690c9197c0fd9ed425da2d'>virt/kvm/coalesced_mmio.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/virt/kvm/coalesced_mmio.c?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>virt/kvm/coalesced_mmio.c</a></div><div class='hunk'>@@ -174,21 +174,36 @@ int kvm_vm_ioctl_unregister_coalesced_mmio(struct kvm *kvm,</div><div class='ctx'> 					   struct kvm_coalesced_mmio_zone *zone)</div><div class='ctx'> {</div><div class='ctx'> 	struct kvm_coalesced_mmio_dev *dev, *tmp;</div><div class='add'>+	int r;</div><div class='ctx'> </div><div class='ctx'> 	if (zone-&gt;pio != 1 &amp;&amp; zone-&gt;pio != 0)</div><div class='ctx'> 		return -EINVAL;</div><div class='ctx'> </div><div class='ctx'> 	mutex_lock(&amp;kvm-&gt;slots_lock);</div><div class='ctx'> </div><div class='del'>-	list_for_each_entry_safe(dev, tmp, &amp;kvm-&gt;coalesced_zones, list)</div><div class='add'>+	list_for_each_entry_safe(dev, tmp, &amp;kvm-&gt;coalesced_zones, list) {</div><div class='ctx'> 		if (zone-&gt;pio == dev-&gt;zone.pio &amp;&amp;</div><div class='ctx'> 		    coalesced_mmio_in_range(dev, zone-&gt;addr, zone-&gt;size)) {</div><div class='del'>-			kvm_io_bus_unregister_dev(kvm,</div><div class='add'>+			r = kvm_io_bus_unregister_dev(kvm,</div><div class='ctx'> 				zone-&gt;pio ? KVM_PIO_BUS : KVM_MMIO_BUS, &amp;dev-&gt;dev);</div><div class='ctx'> 			kvm_iodevice_destructor(&amp;dev-&gt;dev);</div><div class='add'>+</div><div class='add'>+			/*</div><div class='add'>+			 * On failure, unregister destroys all devices on the</div><div class='add'>+			 * bus _except_ the target device, i.e. coalesced_zones</div><div class='add'>+			 * has been modified.  No need to restart the walk as</div><div class='add'>+			 * there aren't any zones left.</div><div class='add'>+			 */</div><div class='add'>+			if (r)</div><div class='add'>+				break;</div><div class='ctx'> 		}</div><div class='add'>+	}</div><div class='ctx'> </div><div class='ctx'> 	mutex_unlock(&amp;kvm-&gt;slots_lock);</div><div class='ctx'> </div><div class='add'>+	/*</div><div class='add'>+	 * Ignore the result of kvm_io_bus_unregister_dev(), from userspace's</div><div class='add'>+	 * perspective, the coalesced MMIO is most definitely unregistered.</div><div class='add'>+	 */</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='head'>diff --git a/virt/kvm/kvm_main.c b/virt/kvm/kvm_main.c<br/>index d6e2b570e43092..ab1fa6f92c8250 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/virt/kvm/kvm_main.c?id=30f46c6993731efb2a690c9197c0fd9ed425da2d'>virt/kvm/kvm_main.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/virt/kvm/kvm_main.c?id=50cbad42bfea8c052b7ca590bd4126cdc898713c'>virt/kvm/kvm_main.c</a></div><div class='hunk'>@@ -4486,15 +4486,15 @@ int kvm_io_bus_register_dev(struct kvm *kvm, enum kvm_bus bus_idx, gpa_t addr,</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /* Caller must hold slots_lock. */</div><div class='del'>-void kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='del'>-			       struct kvm_io_device *dev)</div><div class='add'>+int kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='add'>+			      struct kvm_io_device *dev)</div><div class='ctx'> {</div><div class='ctx'> 	int i, j;</div><div class='ctx'> 	struct kvm_io_bus *new_bus, *bus;</div><div class='ctx'> </div><div class='ctx'> 	bus = kvm_get_bus(kvm, bus_idx);</div><div class='ctx'> 	if (!bus)</div><div class='del'>-		return;</div><div class='add'>+		return 0;</div><div class='ctx'> </div><div class='ctx'> 	for (i = 0; i &lt; bus-&gt;dev_count; i++)</div><div class='ctx'> 		if (bus-&gt;range[i].dev == dev) {</div><div class='hunk'>@@ -4502,7 +4502,7 @@ void kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='ctx'> 		}</div><div class='ctx'> </div><div class='ctx'> 	if (i == bus-&gt;dev_count)</div><div class='del'>-		return;</div><div class='add'>+		return 0;</div><div class='ctx'> </div><div class='ctx'> 	new_bus = kmalloc(struct_size(bus, range, bus-&gt;dev_count - 1),</div><div class='ctx'> 			  GFP_KERNEL_ACCOUNT);</div><div class='hunk'>@@ -4527,7 +4527,7 @@ void kvm_io_bus_unregister_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	kfree(bus);</div><div class='del'>-	return;</div><div class='add'>+	return new_bus ? 0 : -ENOMEM;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> struct kvm_io_device *kvm_io_bus_get_dev(struct kvm *kvm, enum kvm_bus bus_idx,</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 16:41:19 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
