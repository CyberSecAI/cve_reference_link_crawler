=== Content from www.wordfence.com_6cb4bfee_20250110_141638.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Login by Auth0 <= 4.6.0 - Reflected Cross-Site Scripting via wle

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Login by Auth0 <= 4.6.0 - Reflected Cross-Site Scripting via wle

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-6813](https://www.cve.org/CVERecord?id=CVE-2023-6813) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | July 9, 2024 |
| Last Updated | July 10, 2024 |
| Researcher | [Krzysztof Zając - CERT PL](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/krzysztof-zajac) |

### Description

The Login by Auth0 plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the ‘wle’ parameter in all versions up to, and including, 4.6.0 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3114611%40auth0&new=3114611%40auth0&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fauth0%2Flogin-by-auth0-460-reflected-cross-site-scripting-via-wle&t=Login%20by%20Auth0%20%3C%3D%204.6.0%20-%20Reflected%20Cross-Site%20Scripting%20via%20wle "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fauth0%2Flogin-by-auth0-460-reflected-cross-site-scripting-via-wle&text=Login%20by%20Auth0%20%3C%3D%204.6.0%20-%20Reflected%20Cross-Site%20Scripting%20via%20wle "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fauth0%2Flogin-by-auth0-460-reflected-cross-site-scripting-via-wle "LinkedIn")
Email

## Vulnerability Details for Login by Auth0

#### [Login by Auth0](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/auth0)

| Software Type | Plugin |
| --- | --- |
| Software Slug | auth0 [(view on wordpress.org)](https://wordpress.org/plugins/auth0) |
| Patched? | Yes |
| Remediation | Update to version 4.6.1, or a newer patched version |
| Affected Version | * <= 4.6.0 |
| Patched Version | * 4.6.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_5966caf1_20250110_141637.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3114611%2540auth0%26old%3D3114611%2540auth0)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3114606/auth0 "Changeset 3114606 for auth0")
* [Next Change](/changeset/3114612/auth0 "Changeset 3114612 for auth0") →

---

# Changeset [3114611](/changeset/3114611 "Show full changeset") for [auth0](/browser/auth0?rev=3114611 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
07/08/2024 11:53:06 PM
([6 months](/timeline?from=2024-07-08T23%3A53%3A06Z&precision=second "See timeline at 07/08/2024 11:53:06 PM") ago)

Author:
evansims
Message:

Release 4.6.1

Location:
[auth0/trunk](/browser/auth0/trunk?rev=3114611)
Files:

111 added
66 edited

* [WP\_Auth0.php](/browser/auth0/trunk/WP_Auth0.php?rev=3114611 "Show entry in browser")
  (modified)
  ([27 diffs](#file0 "Show differences"))
* [lib/WP\_Auth0\_Api\_Client.php](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611 "Show entry in browser")
  (modified)
  ([22 diffs](#file1 "Show differences"))
* [lib/WP\_Auth0\_Api\_Operations.php](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file2 "Show differences"))
* [lib/WP\_Auth0\_DBManager.php](/browser/auth0/trunk/lib/WP_Auth0_DBManager.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [lib/WP\_Auth0\_Email\_Verification.php](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))
* [lib/WP\_Auth0\_Embed\_Widget.php](/browser/auth0/trunk/lib/WP_Auth0_Embed_Widget.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [lib/WP\_Auth0\_ErrorLog.php](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611 "Show entry in browser")
  (modified)
  ([10 diffs](#file6 "Show differences"))
* [lib/WP\_Auth0\_Import\_Settings.php](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file7 "Show differences"))
* [lib/WP\_Auth0\_Ip\_Check.php](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611 "Show entry in browser")
  (modified)
  ([10 diffs](#file8 "Show differences"))
* [lib/WP\_Auth0\_Lock.php](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611 "Show entry in browser")
  (modified)
  ([11 diffs](#file9 "Show differences"))
* [lib/WP\_Auth0\_LoginManager.php](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611 "Show entry in browser")
  (modified)
  ([30 diffs](#file10 "Show differences"))
* [lib/WP\_Auth0\_Nonce\_Handler.php](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611 "Show entry in browser")
  (modified)
  ([15 diffs](#file11 "Show differences"))
* [lib/WP\_Auth0\_Options.php](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611 "Show entry in browser")
  (modified)
  ([26 diffs](#file12 "Show differences"))
* [lib/WP\_Auth0\_Popup\_Widget.php](/browser/auth0/trunk/lib/WP_Auth0_Popup_Widget.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file13 "Show differences"))
* [lib/WP\_Auth0\_Routes.php](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611 "Show entry in browser")
  (modified)
  ([17 diffs](#file14 "Show differences"))
* [lib/WP\_Auth0\_Serializer.php](/browser/auth0/trunk/lib/WP_Auth0_Serializer.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [lib/WP\_Auth0\_State\_Handler.php](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file16 "Show differences"))
* [lib/WP\_Auth0\_Users.php](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file17 "Show differences"))
* [lib/WP\_Auth0\_UsersRepo.php](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611 "Show entry in browser")
  (modified)
  ([17 diffs](#file18 "Show differences"))
* [lib/WP\_Auth0\_WooCommerceOverrides.php](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611 "Show entry in browser")
  (modified)
  ([6 diffs](#file19 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611 "Show entry in browser")
  (modified)
  ([9 diffs](#file20 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin\_Advanced.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611 "Show entry in browser")
  (modified)
  ([33 diffs](#file21 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin\_Appearance.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611 "Show entry in browser")
  (modified)
  ([25 diffs](#file22 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin\_Basic.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611 "Show entry in browser")
  (modified)
  ([22 diffs](#file23 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin\_Features.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611 "Show entry in browser")
  (modified)
  ([14 diffs](#file24 "Show differences"))
* [lib/admin/WP\_Auth0\_Admin\_Generic.php](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611 "Show entry in browser")
  (modified)
  ([18 diffs](#file25 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Abstract.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611 "Show entry in browser")
  (modified)
  ([25 diffs](#file26 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Change\_Email.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file27 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Change\_Password.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file28 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Client\_Credentials.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611 "Show entry in browser")
  (modified)
  ([8 diffs](#file29 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Exchange\_Code.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file30 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Get\_Jwks.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file31 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Get\_User.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file32 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Jobs\_Verification.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file33 "Show differences"))
* [lib/api/WP\_Auth0\_Api\_Refresh\_Access\_Token.php](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file34 "Show differences"))
* [lib/exceptions/WP\_Auth0\_BeforeLoginException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_BeforeLoginException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [lib/exceptions/WP\_Auth0\_CouldNotCreateUserException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_CouldNotCreateUserException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file36 "Show differences"))
* [lib/exceptions/WP\_Auth0\_EmailNotVerifiedException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([2 diffs](#file37 "Show differences"))
* [lib/exceptions/WP\_Auth0\_InvalidIdTokenException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_InvalidIdTokenException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file38 "Show differences"))
* [lib/exceptions/WP\_Auth0\_LoginFlowValidationException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_LoginFlowValidationException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file39 "Show differences"))
* [lib/exceptions/WP\_Auth0\_RegistrationNotEnabledException.php](/browser/auth0/trunk/lib/exceptions/WP_Auth0_RegistrationNotEnabledException.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file40 "Show differences"))
* [lib/profile/WP\_Auth0\_Profile\_Change\_Email.php](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611 "Show entry in browser")
  (modified)
  ([7 diffs](#file41 "Show differences"))
* [lib/profile/WP\_Auth0\_Profile\_Change\_Password.php](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file42 "Show differences"))
* [lib/profile/WP\_Auth0\_Profile\_Delete\_Data.php](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file43 "Show differences"))
* [lib/scripts-js/db-get-user.js](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file44 "Show differences"))
* [lib/scripts-js/db-login.js](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file45 "Show differences"))
* [lib/token-verifier/WP\_Auth0\_AsymmetricVerifier.php](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file46 "Show differences"))
* [lib/token-verifier/WP\_Auth0\_IdTokenVerifier.php](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611 "Show entry in browser")
  (modified)
  ([16 diffs](#file47 "Show differences"))
* [lib/token-verifier/WP\_Auth0\_JwksFetcher.php](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611 "Show entry in browser")
  (modified)
  ([7 diffs](#file48 "Show differences"))
* [lib/token-verifier/WP\_Auth0\_SignatureVerifier.php](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file49 "Show differences"))
* [lib/token-verifier/WP\_Auth0\_SymmetricVerifier.php](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611 "Show entry in browser")
  (modified)
  ([5 diffs](#file50 "Show differences"))
* [license.txt](/browser/auth0/trunk/license.txt?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file51 "Show differences"))
* [readme.txt](/browser/auth0/trunk/readme.txt?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file52 "Show differences"))
* [templates/a0-error-log.php](/browser/auth0/trunk/templates/a0-error-log.php?rev=3114611 "Show entry in browser")
  (modified)
  ([2 diffs](#file53 "Show differences"))
* [templates/a0-widget-setup-form.php](/browser/auth0/trunk/templates/a0-widget-setup-form.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file54 "Show differences"))
* [templates/auth0-login-form.php](/browser/auth0/trunk/templates/auth0-login-form.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [templates/import\_settings.php](/browser/auth0/trunk/templates/import_settings.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file56 "Show differences"))
* [templates/login-interim.php](/browser/auth0/trunk/templates/login-interim.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file57 "Show differences"))
* [templates/settings.php](/browser/auth0/trunk/templates/settings.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file58 "Show differences"))
* [vendor/autoload.php](/browser/auth0/trunk/vendor/autoload.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file59 "Show differences"))
* [vendor/composer/autoload\_classmap.php](/browser/auth0/trunk/vendor/composer/autoload_classmap.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [vendor/composer/autoload\_psr4.php](/browser/auth0/trunk/vendor/composer/autoload_psr4.php?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file61 "Show differences"))
* [vendor/composer/autoload\_real.php](/browser/auth0/trunk/vendor/composer/autoload_real.php?rev=3114611 "Show entry in browser")
  (modified)
  ([2 diffs](#file62 "Show differences"))
* [vendor/composer/autoload\_static.php](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3114611 "Show entry in browser")
  (modified)
  ([4 diffs](#file63 "Show differences"))
* [vendor/composer/installed.json](/browser/auth0/trunk/vendor/composer/installed.json?rev=3114611 "Show entry in browser")
  (modified)
  ([1 diff](#file64 "Show differences"))
* [vendor/composer/installed.php](/browser/auth0/trunk/vendor/composer/installed.php?rev=3114611 "Show entry in browser")
  (modified)
  ([3 diffs](#file65 "Show differences"))
* [vendor/composer/installers](/browser/auth0/trunk/vendor/composer/installers?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/.github](/browser/auth0/trunk/vendor/composer/installers/.github?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/.github/workflows](/browser/auth0/trunk/vendor/composer/installers/.github/workflows?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/.github/workflows/continuous-integration.yml](/browser/auth0/trunk/vendor/composer/installers/.github/workflows/continuous-integration.yml?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/.github/workflows/lint.yml](/browser/auth0/trunk/vendor/composer/installers/.github/workflows/lint.yml?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/.github/workflows/phpstan.yml](/browser/auth0/trunk/vendor/composer/installers/.github/workflows/phpstan.yml?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/LICENSE](/browser/auth0/trunk/vendor/composer/installers/LICENSE?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/composer.json](/browser/auth0/trunk/vendor/composer/installers/composer.json?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src](/browser/auth0/trunk/vendor/composer/installers/src?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer](/browser/auth0/trunk/vendor/composer/installers/src/Composer?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/AglInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/AglInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/AkauntingInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/AkauntingInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/AnnotateCmsInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/AnnotateCmsInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/AsgardInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/AsgardInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/AttogramInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/AttogramInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/BaseInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/BaseInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/BitrixInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/BitrixInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/BonefishInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/BonefishInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/BotbleInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/BotbleInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/CakePHPInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/CakePHPInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ChefInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ChefInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/CiviCrmInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/CiviCrmInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ClanCatsFrameworkInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ClanCatsFrameworkInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/CockpitInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/CockpitInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/CodeIgniterInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/CodeIgniterInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/Concrete5Installer.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/Concrete5Installer.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ConcreteCMSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ConcreteCMSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/CroogoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/CroogoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/DecibelInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/DecibelInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/DframeInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/DframeInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/DokuWikiInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/DokuWikiInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/DolibarrInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/DolibarrInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/DrupalInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/DrupalInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ElggInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ElggInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/EliasisInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/EliasisInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ExpressionEngineInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ExpressionEngineInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/EzPlatformInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/EzPlatformInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ForkCMSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ForkCMSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/FuelInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/FuelInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/FuelphpInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/FuelphpInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/GravInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/GravInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/HuradInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/HuradInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ImageCMSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ImageCMSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/Installer.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/Installer.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ItopInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ItopInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/KanboardInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/KanboardInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/KnownInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/KnownInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/KodiCMSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/KodiCMSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/KohanaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/KohanaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/LanManagementSystemInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/LanManagementSystemInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/LaravelInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/LaravelInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/LavaLiteInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/LavaLiteInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/LithiumInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/LithiumInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MODULEWorkInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MODULEWorkInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MODXEvoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MODXEvoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MagentoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MagentoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MajimaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MajimaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MakoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MakoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MantisBTInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MantisBTInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MatomoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MatomoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MauticInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MauticInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MayaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MayaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MediaWikiInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MediaWikiInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MiaoxingInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MiaoxingInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MicroweberInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MicroweberInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ModxInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ModxInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/MoodleInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/MoodleInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/OctoberInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/OctoberInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/OntoWikiInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/OntoWikiInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/OsclassInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/OsclassInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/OxidInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/OxidInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PPIInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PPIInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PantheonInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PantheonInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PhiftyInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PhiftyInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PhpBBInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PhpBBInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PiwikInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PiwikInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PlentymarketsInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PlentymarketsInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/Plugin.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/Plugin.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PortoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PortoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PrestashopInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PrestashopInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ProcessWireInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ProcessWireInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PuppetInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PuppetInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/PxcmsInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/PxcmsInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/RadPHPInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/RadPHPInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ReIndexInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ReIndexInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/Redaxo5Installer.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/Redaxo5Installer.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/RedaxoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/RedaxoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/RoundcubeInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/RoundcubeInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/SMFInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/SMFInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ShopwareInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ShopwareInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/SilverStripeInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/SilverStripeInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/SiteDirectInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/SiteDirectInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/StarbugInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/StarbugInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/SyDESInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/SyDESInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/SyliusInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/SyliusInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/TaoInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/TaoInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/TastyIgniterInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/TastyIgniterInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/TheliaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/TheliaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/TuskInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/TuskInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/UserFrostingInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/UserFrostingInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/VanillaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/VanillaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/VgmcpInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/VgmcpInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/WHMCSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/WHMCSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/WinterInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/WinterInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/WolfCMSInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/WolfCMSInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/WordPressInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/WordPressInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/YawikInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/YawikInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ZendInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ZendInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/Composer/Installers/ZikulaInstaller.php](/browser/auth0/trunk/vendor/composer/installers/src/Composer/Installers/ZikulaInstaller.php?rev=3114611 "Show entry in browser")
  (added)
* [vendor/composer/installers/src/bootstrap.php](/browser/auth0/trunk/vendor/composer/installers/src/bootstrap.php?rev=3114611 "Show entry in browser")
  (added)

### Legend:

Unmodified
Added
Removed

* ## [auth0/trunk/WP\_Auth0.php](/changeset/3114611/auth0/trunk/WP_Auth0.php "Show the changeset 3114611 restricted to auth0/trunk/WP_Auth0.php")

  | [r3020639](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Plugin Name: Login by Auth0 |
  | 4 | 5 | \* Plugin URL: https://github.com/auth0/wordpress |
  | 5 | 6 | \* Description: Login by Auth0 provides improved username/password login, passwordless login, social login, multi-factor authentication, and single sign-on for all your sites. |
  | 6 |  | \* Version: 4.6.~~0~~ |
  |  | 7 | \* Version: 4.6.1 |
  | 7 | 8 | \* Author: Auth0 |
  | 8 | 9 | \* Author URI: https://auth0.com |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L10) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L11) |  |
  | 10 | 11 | \*/ |
  | 11 | 12 |  |
  | 12 |  | define(~~'WPA0\_VERSION', '4.6.0'~~ ); |
  | 13 |  | define(~~'AUTH0\_DB\_VERSION', 23~~ ); |
  | 14 |  |  |
  | 15 |  | define(~~'WPA0\_PLUGIN\_FILE', \_\_FILE\_\_~~ ); |
  | 16 |  | define(~~'WPA0\_PLUGIN\_DIR', plugin\_dir\_path( \_\_FILE\_\_ )~~ ); // Includes trailing slash |
  | 17 |  | define(~~'WPA0\_PLUGIN\_URL', plugin\_dir\_url( \_\_FILE\_\_ )~~ ); |
  | 18 |  | define(~~'WPA0\_PLUGIN\_BASENAME', plugin\_basename( \_\_FILE\_\_ )~~ ); |
  | 19 |  | define(~~'WPA0\_PLUGIN\_JS\_URL', WPA0\_PLUGIN\_URL . 'assets/js/'~~ ); |
  | 20 |  | define(~~'WPA0\_PLUGIN\_CSS\_URL', WPA0\_PLUGIN\_URL . 'assets/css/'~~ ); |
  | 21 |  | define(~~'WPA0\_PLUGIN\_IMG\_URL', WPA0\_PLUGIN\_URL . 'assets/img/'~~ ); |
  | 22 |  | define(~~'WPA0\_PLUGIN\_LIB\_URL', WPA0\_PLUGIN\_URL . 'assets/lib/'~~ ); |
  | 23 |  | define(~~'WPA0\_PLUGIN\_BS\_URL', WPA0\_PLUGIN\_URL . 'assets/bootstrap/'~~ ); |
  | 24 |  |  |
  | 25 |  | define(~~'WPA0\_LOCK\_CDN\_URL', 'https://cdn.auth0.com/js/lock/11.30/lock.min.js'~~ ); |
  | 26 |  | define(~~'WPA0\_AUTH0\_JS\_CDN\_URL', 'https://cdn.auth0.com/js/auth0/9.16/auth0.min.js'~~ ); |
  | 27 |  |  |
  | 28 |  | define(~~'WPA0\_AUTH0\_LOGIN\_FORM\_ID', 'auth0-login-form'~~ ); |
  | 29 |  | define(~~'WPA0\_CACHE\_GROUP', 'wp\_auth0'~~ ); |
  | 30 |  | define(~~'WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME', 'WP\_Auth0\_JWKS\_cache'~~ ); |
  | 31 |  |  |
  | 32 |  | define(~~'WPA0\_LANG', 'wp-auth0'~~ ); // deprecated; do not use for translations |
  | 33 |  |  |
  | 34 |  | if (~~is\_readable( \_\_DIR\_\_ . '/vendor/autoload.php' )~~ ) { |
  |  | 13 | define('WPA0\_VERSION', '4.6.1'); |
  |  | 14 | define('AUTH0\_DB\_VERSION', 23); |
  |  | 15 |  |
  |  | 16 | define('WPA0\_PLUGIN\_FILE', \_\_FILE\_\_); |
  |  | 17 | define('WPA0\_PLUGIN\_DIR', plugin\_dir\_path(\_\_FILE\_\_)); // Includes trailing slash |
  |  | 18 | define('WPA0\_PLUGIN\_URL', plugin\_dir\_url(\_\_FILE\_\_)); |
  |  | 19 | define('WPA0\_PLUGIN\_BASENAME', plugin\_basename(\_\_FILE\_\_)); |
  |  | 20 | define('WPA0\_PLUGIN\_JS\_URL', WPA0\_PLUGIN\_URL . 'assets/js/'); |
  |  | 21 | define('WPA0\_PLUGIN\_CSS\_URL', WPA0\_PLUGIN\_URL . 'assets/css/'); |
  |  | 22 | define('WPA0\_PLUGIN\_IMG\_URL', WPA0\_PLUGIN\_URL . 'assets/img/'); |
  |  | 23 | define('WPA0\_PLUGIN\_LIB\_URL', WPA0\_PLUGIN\_URL . 'assets/lib/'); |
  |  | 24 | define('WPA0\_PLUGIN\_BS\_URL', WPA0\_PLUGIN\_URL . 'assets/bootstrap/'); |
  |  | 25 |  |
  |  | 26 | define('WPA0\_LOCK\_CDN\_URL', 'https://cdn.auth0.com/js/lock/11.30/lock.min.js'); |
  |  | 27 | define('WPA0\_AUTH0\_JS\_CDN\_URL', 'https://cdn.auth0.com/js/auth0/9.16/auth0.min.js'); |
  |  | 28 |  |
  |  | 29 | define('WPA0\_AUTH0\_LOGIN\_FORM\_ID', 'auth0-login-form'); |
  |  | 30 | define('WPA0\_CACHE\_GROUP', 'wp\_auth0'); |
  |  | 31 | define('WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME', 'WP\_Auth0\_JWKS\_cache'); |
  |  | 32 |  |
  |  | 33 | define('WPA0\_LANG', 'wp-auth0'); // deprecated; do not use for translations |
  |  | 34 |  |
  |  | 35 | if (is\_readable(\_\_DIR\_\_ . '/vendor/autoload.php')) { |
  | 35 | 36 | require\_once \_\_DIR\_\_ . '/vendor/autoload.php'; |
  | 36 | 37 | } |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L43) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L44) |  |
  | 43 | 44 | \* @deprecated 4.1.0 |
  | 44 | 45 | \*/ |
  | 45 |  | function wp\_auth0\_autoloader( $class ) { |
  |  | 46 | function wp\_auth0\_autoloader($class) |
  |  | 47 | { |
  | 46 | 48 | return false; |
  | 47 | 49 | } |
  | 48 | 50 |  |
  | 49 |  | function wp\_auth0\_plugins\_loaded() { |
  | 50 |  | load\_plugin\_textdomain( 'wp-auth0', false, basename( dirname( \_\_FILE\_\_ ) ) . '/languages/' ); |
  | 51 |  |  |
  | 52 |  | $db\_manager = new WP\_Auth0\_DBManager( WP\_Auth0\_Options::Instance() ); |
  |  | 51 | function wp\_auth0\_plugins\_loaded() |
  |  | 52 | { |
  |  | 53 | load\_plugin\_textdomain('wp-auth0', false, basename(dirname(\_\_FILE\_\_)) . '/languages/'); |
  |  | 54 |  |
  |  | 55 | $db\_manager = new WP\_Auth0\_DBManager(WP\_Auth0\_Options::Instance()); |
  | 53 | 56 | $db\_manager->install\_db(); |
  | 54 | 57 | } |
  | 55 |  | add\_action( 'plugins\_loaded', 'wp\_auth0\_plugins\_loaded' ); |
  | 56 |  |  |
  | 57 |  | function wp\_auth0\_init() { |
  | 58 |  | $router = new WP\_Auth0\_Routes( WP\_Auth0\_Options::Instance() ); |
  |  | 58 | add\_action('plugins\_loaded', 'wp\_auth0\_plugins\_loaded'); |
  |  | 59 |  |
  |  | 60 | function wp\_auth0\_init() |
  |  | 61 | { |
  |  | 62 | $router = new WP\_Auth0\_Routes(WP\_Auth0\_Options::Instance()); |
  | 59 | 63 | $router->setup\_rewrites(); |
  | 60 | 64 | } |
  | 61 |  | add\_action( 'init', 'wp\_auth0\_init' ); |
  | 62 |  |  |
  | 63 |  | function wp\_auth0\_shortcode( $atts ) { |
  | 64 |  | if ( empty( $atts ) ) { |
  |  | 65 | add\_action('init', 'wp\_auth0\_init'); |
  |  | 66 |  |
  |  | 67 | function wp\_auth0\_shortcode($atts) |
  |  | 68 | { |
  |  | 69 | if (empty($atts)) { |
  | 65 | 70 | $atts = []; |
  | 66 | 71 | } |
  | 67 | 72 |  |
  | 68 |  | if (~~empty( $atts['redirect\_to'] ) && ! empty( $\_SERVER['REQUEST\_URI'] )~~ ) { |
  | 69 |  | $atts['redirect\_to'] = home\_url(~~sanitize\_text\_field( wp\_unslash( $\_SERVER['REQUEST\_URI'] ) )~~ ); |
  |  | 73 | if (empty($atts['redirect\_to']) && !empty($\_SERVER['REQUEST\_URI'])) { |
  |  | 74 | $atts['redirect\_to'] = home\_url(sanitize\_text\_field(wp\_unslash($\_SERVER['REQUEST\_URI']))); |
  | 70 | 75 | } |
  | 71 | 76 |  |
  | 72 | 77 | ob\_start(); |
  | 73 |  | \WP\_Auth0\_Lock::render(~~false, $atts~~ ); |
  |  | 78 | \WP\_Auth0\_Lock::render(false, $atts); |
  | 74 | 79 | return ob\_get\_clean(); |
  | 75 | 80 | } |
  | 76 |  | add\_shortcode(~~'auth0', 'wp\_auth0\_shortcode'~~ ); |
  |  | 81 | add\_shortcode('auth0', 'wp\_auth0\_shortcode'); |
  | 77 | 82 |  |
  | 78 | 83 | /\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L80) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L85) |  |
  | 80 | 85 | \*/ |
  | 81 | 86 |  |
  | 82 |  | function wp\_auth0\_activation\_hook() { |
  |  | 87 | function wp\_auth0\_activation\_hook() |
  |  | 88 | { |
  | 83 | 89 | $options    = WP\_Auth0\_Options::Instance(); |
  | 84 |  | $db\_manager = new WP\_Auth0\_DBManager(~~$options~~ ); |
  | 85 |  | $router     = new WP\_Auth0\_Routes(~~$options~~ ); |
  |  | 90 | $db\_manager = new WP\_Auth0\_DBManager($options); |
  |  | 91 | $router     = new WP\_Auth0\_Routes($options); |
  | 86 | 92 |  |
  | 87 | 93 | $db\_manager->install\_db(); |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L91) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L97) |  |
  | 91 | 97 | flush\_rewrite\_rules(); |
  | 92 | 98 | } |
  | 93 |  | register\_activation\_hook( WPA0\_PLUGIN\_FILE, 'wp\_auth0\_activation\_hook' ); |
  | 94 |  |  |
  | 95 |  | function wp\_auth0\_deactivation\_hook() { |
  |  | 99 | register\_activation\_hook(WPA0\_PLUGIN\_FILE, 'wp\_auth0\_activation\_hook'); |
  |  | 100 |  |
  |  | 101 | function wp\_auth0\_deactivation\_hook() |
  |  | 102 | { |
  | 96 | 103 | flush\_rewrite\_rules(); |
  | 97 | 104 | } |
  | 98 |  | register\_deactivation\_hook( WPA0\_PLUGIN\_FILE, 'wp\_auth0\_deactivation\_hook' ); |
  | 99 |  |  |
  | 100 |  | function wp\_auth0\_uninstall\_hook() { |
  |  | 105 | register\_deactivation\_hook(WPA0\_PLUGIN\_FILE, 'wp\_auth0\_deactivation\_hook'); |
  |  | 106 |  |
  |  | 107 | function wp\_auth0\_uninstall\_hook() |
  |  | 108 | { |
  | 101 | 109 | $a0\_options = WP\_Auth0\_Options::Instance(); |
  | 102 | 110 | $a0\_options->delete(); |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L105) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L113) |  |
  | 105 | 113 | $error\_log->delete(); |
  | 106 | 114 |  |
  | 107 |  | delete\_option( 'auth0\_db\_version' ); |
  | 108 |  |  |
  | 109 |  | delete\_option( 'widget\_wp\_auth0\_popup\_widget' ); |
  | 110 |  | delete\_option( 'widget\_wp\_auth0\_widget' ); |
  | 111 |  | delete\_option( 'widget\_wp\_auth0\_social\_amplification\_widget' ); |
  | 112 |  |  |
  | 113 |  | delete\_transient( WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME ); |
  | 114 |  | } |
  | 115 |  | register\_uninstall\_hook( WPA0\_PLUGIN\_FILE, 'wp\_auth0\_uninstall\_hook' ); |
  | 116 |  |  |
  | 117 |  | function wp\_auth0\_activated\_plugin\_redirect( $plugin ) { |
  | 118 |  |  |
  | 119 |  | if ( defined( 'WP\_CLI' ) || $plugin !== WPA0\_PLUGIN\_BASENAME ) { |
  |  | 115 | delete\_option('auth0\_db\_version'); |
  |  | 116 |  |
  |  | 117 | delete\_option('widget\_wp\_auth0\_popup\_widget'); |
  |  | 118 | delete\_option('widget\_wp\_auth0\_widget'); |
  |  | 119 | delete\_option('widget\_wp\_auth0\_social\_amplification\_widget'); |
  |  | 120 |  |
  |  | 121 | delete\_transient(WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME); |
  |  | 122 | } |
  |  | 123 | register\_uninstall\_hook(WPA0\_PLUGIN\_FILE, 'wp\_auth0\_uninstall\_hook'); |
  |  | 124 |  |
  |  | 125 | function wp\_auth0\_activated\_plugin\_redirect($plugin) |
  |  | 126 | { |
  |  | 127 |  |
  |  | 128 | if (defined('WP\_CLI') || $plugin !== WPA0\_PLUGIN\_BASENAME) { |
  | 120 | 129 | return; |
  | 121 | 130 | } |
  | 122 | 131 |  |
  | 123 | 132 | $redirect\_query = wp\_auth0\_is\_ready() ? 'page=wpa0' : 'page=wpa0-setup&activation=1'; |
  | 124 |  | wp\_safe\_redirect(~~admin\_url( 'admin.php?' . $redirect\_query )~~ ); |
  |  | 133 | wp\_safe\_redirect(admin\_url('admin.php?' . $redirect\_query)); |
  | 125 | 134 | exit; |
  | 126 | 135 | } |
  | 127 |  | add\_action(~~'activated\_plugin', 'wp\_auth0\_activated\_plugin\_redirect'~~ ); |
  |  | 136 | add\_action('activated\_plugin', 'wp\_auth0\_activated\_plugin\_redirect'); |
  | 128 | 137 |  |
  | 129 | 138 | /\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L131) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L140) |  |
  | 131 | 140 | \*/ |
  | 132 | 141 |  |
  | 133 |  | function wp\_auth0\_add\_allowed\_redirect\_hosts( $hosts ) { |
  |  | 142 | function wp\_auth0\_add\_allowed\_redirect\_hosts($hosts) |
  |  | 143 | { |
  | 134 | 144 | $hosts[] = 'auth0.auth0.com'; |
  | 135 |  | $hosts[] = wp\_auth0\_get\_option(~~'domain'~~ ); |
  | 136 |  | $hosts[] = wp\_auth0\_get\_option(~~'custom\_domain'~~ ); |
  | 137 |  | $hosts[] = wp\_auth0\_get\_option(~~'auth0\_server\_domain'~~ ); |
  |  | 145 | $hosts[] = wp\_auth0\_get\_option('domain'); |
  |  | 146 | $hosts[] = wp\_auth0\_get\_option('custom\_domain'); |
  |  | 147 | $hosts[] = wp\_auth0\_get\_option('auth0\_server\_domain'); |
  | 138 | 148 | return $hosts; |
  | 139 | 149 | } |
  | 140 | 150 |  |
  | 141 |  | add\_filter(~~'allowed\_redirect\_hosts', 'wp\_auth0\_add\_allowed\_redirect\_hosts'~~ ); |
  |  | 151 | add\_filter('allowed\_redirect\_hosts', 'wp\_auth0\_add\_allowed\_redirect\_hosts'); |
  | 142 | 152 |  |
  | 143 | 153 | /\*\* |
  | 144 | 154 | \* Enqueue login page CSS if plugin is configured. |
  | 145 | 155 | \*/ |
  | 146 |  | function wp\_auth0\_login\_enqueue\_scripts() { |
  | 147 |  | if ( wp\_auth0\_is\_ready() ) { |
  | 148 |  | wp\_enqueue\_style( 'auth0', WPA0\_PLUGIN\_CSS\_URL . 'login.css', false, WPA0\_VERSION ); |
  | 149 |  | } |
  | 150 |  | } |
  | 151 |  | add\_action( 'login\_enqueue\_scripts', 'wp\_auth0\_login\_enqueue\_scripts' ); |
  |  | 156 | function wp\_auth0\_login\_enqueue\_scripts() |
  |  | 157 | { |
  |  | 158 | if (wp\_auth0\_is\_ready()) { |
  |  | 159 | wp\_enqueue\_style('auth0', WPA0\_PLUGIN\_CSS\_URL . 'login.css', false, WPA0\_VERSION); |
  |  | 160 | } |
  |  | 161 | } |
  |  | 162 | add\_action('login\_enqueue\_scripts', 'wp\_auth0\_login\_enqueue\_scripts'); |
  | 152 | 163 |  |
  | 153 | 164 | /\*\* |
  | 154 | 165 | \* Enqueue login widget CSS if plugin is configured. |
  | 155 | 166 | \*/ |
  | 156 |  | function wp\_auth0\_enqueue\_scripts() { |
  | 157 |  | if ( wp\_auth0\_is\_ready() ) { |
  | 158 |  | wp\_enqueue\_style( 'auth0-widget', WPA0\_PLUGIN\_CSS\_URL . 'main.css' ); |
  | 159 |  | } |
  | 160 |  | } |
  | 161 |  | add\_action( 'wp\_enqueue\_scripts', 'wp\_auth0\_enqueue\_scripts' ); |
  | 162 |  |  |
  | 163 |  | function wp\_auth0\_register\_widget() { |
  | 164 |  | register\_widget( 'WP\_Auth0\_Embed\_Widget' ); |
  | 165 |  | register\_widget( 'WP\_Auth0\_Popup\_Widget' ); |
  | 166 |  | } |
  | 167 |  | add\_action( 'widgets\_init', 'wp\_auth0\_register\_widget' ); |
  | 168 |  |  |
  | 169 |  | function wp\_auth0\_register\_query\_vars( $qvars ) { |
  | 170 |  | return array\_merge( $qvars, [ 'error', 'error\_description', 'a0\_action', 'auth0', 'state', 'code', 'invitation', 'organization', 'organization\_name' ] ); |
  | 171 |  | } |
  | 172 |  | add\_filter( 'query\_vars', 'wp\_auth0\_register\_query\_vars' ); |
  |  | 167 | function wp\_auth0\_enqueue\_scripts() |
  |  | 168 | { |
  |  | 169 | if (wp\_auth0\_is\_ready()) { |
  |  | 170 | wp\_enqueue\_style('auth0-widget', WPA0\_PLUGIN\_CSS\_URL . 'main.css', false, WPA0\_VERSION); |
  |  | 171 | } |
  |  | 172 | } |
  |  | 173 | add\_action('wp\_enqueue\_scripts', 'wp\_auth0\_enqueue\_scripts'); |
  |  | 174 |  |
  |  | 175 | function wp\_auth0\_register\_widget() |
  |  | 176 | { |
  |  | 177 | register\_widget('WP\_Auth0\_Embed\_Widget'); |
  |  | 178 | register\_widget('WP\_Auth0\_Popup\_Widget'); |
  |  | 179 | } |
  |  | 180 | add\_action('widgets\_init', 'wp\_auth0\_register\_widget'); |
  |  | 181 |  |
  |  | 182 | function wp\_auth0\_register\_query\_vars($qvars) |
  |  | 183 | { |
  |  | 184 | return array\_merge($qvars, ['error', 'error\_description', 'a0\_action', 'auth0', 'state', 'code', 'invitation', 'organization', 'organization\_name']); |
  |  | 185 | } |
  |  | 186 | add\_filter('query\_vars', 'wp\_auth0\_register\_query\_vars'); |
  | 173 | 187 |  |
  | 174 | 188 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L181) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L195) |  |
  | 181 | 195 | \* @return string |
  | 182 | 196 | \*/ |
  | 183 |  | function wp\_auth0\_render\_lock\_form( $html ) { |
  |  | 197 | function wp\_auth0\_render\_lock\_form($html) |
  |  | 198 | { |
  | 184 | 199 | ob\_start(); |
  | 185 | 200 | \WP\_Auth0\_Lock::render(); |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L187) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L202) |  |
  | 187 | 202 | return $auth0\_form ? $auth0\_form : $html; |
  | 188 | 203 | } |
  | 189 |  | add\_filter(~~'login\_message', 'wp\_auth0\_render\_lock\_form', 5~~ ); |
  |  | 204 | add\_filter('login\_message', 'wp\_auth0\_render\_lock\_form', 5); |
  | 190 | 205 |  |
  | 191 | 206 | /\*\* |
  | 192 | 207 | \* Add settings link on plugin page. |
  | 193 | 208 | \*/ |
  | 194 |  | function wp\_auth0\_plugin\_action\_links( $links ) { |
  |  | 209 | function wp\_auth0\_plugin\_action\_links($links) |
  |  | 210 | { |
  | 195 | 211 |  |
  | 196 | 212 | array\_unshift( |
  | 197 | 213 | $links, |
  | 198 |  | sprintf( |
  |  | 214 | wp\_kses(sprintf( |
  | 199 | 215 | '<a href="%s">%s</a>', |
  | 200 |  | admin\_url(~~'admin.php?page=wpa0'~~ ), |
  | 201 |  | ~~\_\_( 'Settings', 'wp-auth0'~~ ) |
  | 202 |  | ) |
  |  | 216 | admin\_url('admin.php?page=wpa0'), |
  |  | 217 | esc\_html\_\_('Settings', 'wp-auth0') |
  |  | 218 | ), ['a' => ['href' => true]]) |
  | 203 | 219 | ); |
  | 204 | 220 |  |
  | 205 | 221 | return $links; |
  | 206 | 222 | } |
  | 207 |  | add\_filter(~~'plugin\_action\_links\_' . WPA0\_PLUGIN\_BASENAME, 'wp\_auth0\_plugin\_action\_links'~~ ); |
  |  | 223 | add\_filter('plugin\_action\_links\_' . WPA0\_PLUGIN\_BASENAME, 'wp\_auth0\_plugin\_action\_links'); |
  | 208 | 224 |  |
  | 209 | 225 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L218) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L234) |  |
  | 218 | 234 | \* @return string |
  | 219 | 235 | \*/ |
  | 220 |  | function wp\_auth0\_filter\_get\_avatar( $avatar, $id\_or\_email, $size, $default, $alt ) { |
  | 221 |  | if ( ! wp\_auth0\_get\_option( 'override\_wp\_avatars' ) ) { |
  |  | 236 | function wp\_auth0\_filter\_get\_avatar($avatar, $id\_or\_email, $size, $default, $alt) |
  |  | 237 | { |
  |  | 238 | if (!wp\_auth0\_get\_option('override\_wp\_avatars')) { |
  | 222 | 239 | return $avatar; |
  | 223 | 240 | } |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L225) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L242) |  |
  | 225 | 242 | $user\_id = null; |
  | 226 | 243 |  |
  | 227 |  | if (~~$id\_or\_email instanceof WP\_User~~ ) { |
  |  | 244 | if ($id\_or\_email instanceof WP\_User) { |
  | 228 | 245 | $user\_id = $id\_or\_email->ID; |
  | 229 |  | } elseif (~~$id\_or\_email instanceof WP\_Comment~~ ) { |
  |  | 246 | } elseif ($id\_or\_email instanceof WP\_Comment) { |
  | 230 | 247 | $user\_id = $id\_or\_email->user\_id; |
  | 231 |  | } elseif (~~$id\_or\_email instanceof WP\_Post~~ ) { |
  |  | 248 | } elseif ($id\_or\_email instanceof WP\_Post) { |
  | 232 | 249 | $user\_id = $id\_or\_email->post\_author; |
  | 233 |  | } elseif (~~is\_email( $id\_or\_email )~~ ) { |
  | 234 |  | $maybe\_user = get\_user\_by(~~'email', $id\_or\_email~~ ); |
  | 235 |  |  |
  | 236 |  | if (~~$maybe\_user instanceof WP\_User~~ ) { |
  |  | 250 | } elseif (is\_email($id\_or\_email)) { |
  |  | 251 | $maybe\_user = get\_user\_by('email', $id\_or\_email); |
  |  | 252 |  |
  |  | 253 | if ($maybe\_user instanceof WP\_User) { |
  | 237 | 254 | $user\_id = $maybe\_user->ID; |
  | 238 | 255 | } |
  | 239 |  | } elseif (~~is\_numeric( $id\_or\_email )~~ ) { |
  | 240 |  | $user\_id = absint(~~$id\_or\_email~~ ); |
  | 241 |  | } |
  | 242 |  |  |
  | 243 |  | if (~~! $user\_id~~ ) { |
  |  | 256 | } elseif (is\_numeric($id\_or\_email)) { |
  |  | 257 | $user\_id = absint($id\_or\_email); |
  |  | 258 | } |
  |  | 259 |  |
  |  | 260 | if (!$user\_id) { |
  | 244 | 261 | return $avatar; |
  | 245 | 262 | } |
  | 246 | 263 |  |
  | 247 |  | $auth0Profile = get\_auth0userinfo(~~$user\_id~~ ); |
  | 248 |  |  |
  | 249 |  | if (~~! $auth0Profile || empty( $auth0Profile->picture )~~ ) { |
  |  | 264 | $auth0Profile = get\_auth0userinfo($user\_id); |
  |  | 265 |  |
  |  | 266 | if (!$auth0Profile || empty($auth0Profile->picture)) { |
  | 250 | 267 | return $avatar; |
  | 251 | 268 | } |
  | 252 | 269 |  |
  | 253 |  | return sprintf( |
  |  | 270 | return wp\_kses(sprintf( |
  | 254 | 271 | '<img alt="%s" src="%s" class="avatar avatar-%d photo avatar-auth0" width="%d" height="%d"/>', |
  | 255 |  | esc\_attr(~~$alt~~ ), |
  | 256 |  | esc\_url(~~$auth0Profile->picture~~ ), |
  | 257 |  | absint(~~$size~~ ), |
  | 258 |  | absint(~~$size~~ ), |
  | 259 |  | absint(~~$size~~ ) |
  | 260 |  | ); |
  | 261 |  | } |
  | 262 |  | add\_filter(~~'get\_avatar', 'wp\_auth0\_filter\_get\_avatar', 1, 5~~ ); |
  |  | 272 | esc\_attr($alt), |
  |  | 273 | esc\_url($auth0Profile->picture), |
  |  | 274 | absint($size), |
  |  | 275 | absint($size), |
  |  | 276 | absint($size) |
  |  | 277 | ), ['img' => ['alt' => true, 'src' => true, 'class' => true, 'width' => true, 'height' => true]]); |
  |  | 278 | } |
  |  | 279 | add\_filter('get\_avatar', 'wp\_auth0\_filter\_get\_avatar', 1, 5); |
  | 263 | 280 |  |
  | 264 | 281 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L267) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L284) |  |
  | 267 | 284 | \* @hook admin\_action\_wpauth0\_clear\_error\_log |
  | 268 | 285 | \*/ |
  | 269 |  | function wp\_auth0\_errorlog\_clear\_error\_log() { |
  |  | 286 | function wp\_auth0\_errorlog\_clear\_error\_log() |
  |  | 287 | { |
  | 270 | 288 |  |
  | 271 | 289 | // Null coalescing validates input variable. |
  | 272 | 290 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 273 |  | if (~~! wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ?? '' ), WP\_Auth0\_ErrorLog::CLEAR\_LOG\_NONCE )~~ ) { |
  | 274 |  | wp\_die(~~\_\_( 'Not allowed.', 'wp-auth0' )~~ ); |
  | 275 |  | } |
  | 276 |  |  |
  | 277 |  | if (~~! current\_user\_can( 'manage\_options' )~~ ) { |
  | 278 |  | wp\_die(~~\_\_( 'Not authorized.', 'wp-auth0' )~~ ); |
  |  | 291 | if (!wp\_verify\_nonce(wp\_unslash($\_POST['\_wpnonce'] ?? ''), WP\_Auth0\_ErrorLog::CLEAR\_LOG\_NONCE)) { |
  |  | 292 | wp\_die(esc\_html\_\_('Not allowed.', 'wp-auth0')); |
  |  | 293 | } |
  |  | 294 |  |
  |  | 295 | if (!current\_user\_can('manage\_options')) { |
  |  | 296 | wp\_die(esc\_html\_\_('Not authorized.', 'wp-auth0')); |
  | 279 | 297 | } |
  | 280 | 298 |  |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L282) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L300) |  |
  | 282 | 300 | $error\_log->clear(); |
  | 283 | 301 |  |
  | 284 |  | wp\_safe\_redirect(~~admin\_url( 'admin.php?page=wpa0-errors&cleared=1' )~~ ); |
  |  | 302 | wp\_safe\_redirect(admin\_url('admin.php?page=wpa0-errors&cleared=1')); |
  | 285 | 303 | exit; |
  | 286 | 304 | } |
  | 287 |  | add\_action( 'admin\_action\_wpauth0\_clear\_error\_log', 'wp\_auth0\_errorlog\_clear\_error\_log' ); |
  | 288 |  |  |
  | 289 |  | function wp\_auth0\_export\_settings\_admin\_action() { |
  |  | 305 | add\_action('admin\_action\_wpauth0\_clear\_error\_log', 'wp\_auth0\_errorlog\_clear\_error\_log'); |
  |  | 306 |  |
  |  | 307 | function wp\_auth0\_export\_settings\_admin\_action() |
  |  | 308 | { |
  | 290 | 309 |  |
  | 291 | 310 | // Null coalescing validates input variable. |
  | 292 | 311 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 293 |  | if (~~! wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ?? '' ), WP\_Auth0\_Import\_Settings::EXPORT\_NONCE\_ACTION )~~ ) { |
  | 294 |  | wp\_nonce\_ays(~~WP\_Auth0\_Import\_Settings::IMPORT\_NONCE\_ACTION~~ ); |
  |  | 312 | if (!wp\_verify\_nonce(wp\_unslash($\_POST['\_wpnonce'] ?? ''), WP\_Auth0\_Import\_Settings::EXPORT\_NONCE\_ACTION)) { |
  |  | 313 | wp\_nonce\_ays(WP\_Auth0\_Import\_Settings::IMPORT\_NONCE\_ACTION); |
  | 295 | 314 | exit; |
  | 296 | 315 | } |
  | 297 | 316 |  |
  | 298 |  | if (~~! current\_user\_can( 'manage\_options' )~~ ) { |
  | 299 |  | wp\_die(~~\_\_( 'Unauthorized.', 'wp-auth0' )~~ ); |
  |  | 317 | if (!current\_user\_can('manage\_options')) { |
  |  | 318 | wp\_die(esc\_html\_\_('Unauthorized.', 'wp-auth0')); |
  | 300 | 319 | exit; |
  | 301 | 320 | } |
  | 302 | 321 |  |
  | 303 | 322 | $options  = WP\_Auth0\_Options::Instance(); |
  | 304 |  | $name     = urlencode(~~get\_auth0\_curatedBlogName()~~ ); |
  | 305 |  | $settings = get\_option(~~$options->get\_options\_name()~~ ); |
  | 306 |  |  |
  | 307 |  | header(~~'Content-Type: application/json'~~ ); |
  | 308 |  | header(~~"Content-Disposition: attachment; filename=auth0\_for\_wordpress\_settings-$name.json"~~ ); |
  | 309 |  | header(~~'Pragma: no-cache'~~ ); |
  | 310 |  |  |
  | 311 |  | echo wp\_json\_encode(~~$settings~~ ); |
  |  | 323 | $name     = urlencode(get\_auth0\_curatedBlogName()); |
  |  | 324 | $settings = get\_option($options->get\_options\_name()); |
  |  | 325 |  |
  |  | 326 | header('Content-Type: application/json'); |
  |  | 327 | header("Content-Disposition: attachment; filename=auth0\_for\_wordpress\_settings-$name.json"); |
  |  | 328 | header('Pragma: no-cache'); |
  |  | 329 |  |
  |  | 330 | echo wp\_json\_encode($settings); |
  | 312 | 331 | exit; |
  | 313 | 332 | } |
  | 314 |  | add\_action( 'admin\_action\_wpauth0\_export\_settings', 'wp\_auth0\_export\_settings\_admin\_action' ); |
  | 315 |  |  |
  | 316 |  | function wp\_auth0\_import\_settings\_admin\_action() { |
  |  | 333 | add\_action('admin\_action\_wpauth0\_export\_settings', 'wp\_auth0\_export\_settings\_admin\_action'); |
  |  | 334 |  |
  |  | 335 | function wp\_auth0\_import\_settings\_admin\_action() |
  |  | 336 | { |
  | 317 | 337 | $options         = WP\_Auth0\_Options::Instance(); |
  | 318 |  | $import\_settings = new WP\_Auth0\_Import\_Settings(~~$options~~ ); |
  |  | 338 | $import\_settings = new WP\_Auth0\_Import\_Settings($options); |
  | 319 | 339 | $import\_settings->import\_settings(); |
  | 320 | 340 | } |
  | 321 |  | add\_action( 'admin\_action\_wpauth0\_import\_settings', 'wp\_auth0\_import\_settings\_admin\_action' ); |
  | 322 |  |  |
  | 323 |  | function wp\_auth0\_settings\_admin\_action\_error() { |
  |  | 341 | add\_action('admin\_action\_wpauth0\_import\_settings', 'wp\_auth0\_import\_settings\_admin\_action'); |
  |  | 342 |  |
  |  | 343 | function wp\_auth0\_settings\_admin\_action\_error() |
  |  | 344 | { |
  | 324 | 345 | // Not processing form data, using an error URL parameter to indicate a problem with the import. |
  | 325 | 346 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 326 | 347 |  |
  | 327 |  | if (~~! wp\_auth0\_is\_admin\_page( 'wpa0-import-settings' ) || empty( $\_REQUEST['error'] )~~ ) { |
  |  | 348 | if (!wp\_auth0\_is\_admin\_page('wpa0-import-settings') || empty($\_REQUEST['error'])) { |
  | 328 | 349 | return false; |
  | 329 | 350 | } |
  | 330 | 351 |  |
  | 331 |  | printf( |
  |  | 352 | echo wp\_kses(sprintf( |
  | 332 | 353 | '<div class="notice notice-error is-dismissible"><p><strong>%s</strong></p></div>', |
  | 333 |  | sanitize\_text\_field(~~wp\_unslash( $\_REQUEST['error'] )~~ ) |
  | 334 |  | ); |
  |  | 354 | sanitize\_text\_field(wp\_unslash($\_REQUEST['error'])) |
  |  | 355 | ), ['div' => ['class' => true], 'p' => [], 'strong' => []]); |
  | 335 | 356 | return true; |
  | 336 | 357 |  |
  | 337 | 358 | // phpcs:enable WordPress.Security.NonceVerification.NoNonceVerification |
  | 338 | 359 | } |
  | 339 |  | add\_action( 'admin\_notices', 'wp\_auth0\_settings\_admin\_action\_error' ); |
  | 340 |  |  |
  | 341 |  | function wp\_auth0\_profile\_change\_email( $wp\_user\_id, $old\_user\_data ) { |
  |  | 360 | add\_action('admin\_notices', 'wp\_auth0\_settings\_admin\_action\_error'); |
  |  | 361 |  |
  |  | 362 | function wp\_auth0\_profile\_change\_email($wp\_user\_id, $old\_user\_data) |
  |  | 363 | { |
  | 342 | 364 | $options              = WP\_Auth0\_Options::Instance(); |
  | 343 |  | $api\_client\_creds     = new WP\_Auth0\_Api\_Client\_Credentials( $options ); |
  | 344 |  | $api\_change\_email     = new WP\_Auth0\_Api\_Change\_Email( $options, $api\_client\_creds ); |
  | 345 |  | $profile\_change\_email = new WP\_Auth0\_Profile\_Change\_Email( $api\_change\_email ); |
  | 346 |  | return $profile\_change\_email->update\_email( $wp\_user\_id, $old\_user\_data ); |
  | 347 |  | } |
  | 348 |  | add\_action( 'profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2 ); |
  | 349 |  |  |
  | 350 |  | function wp\_auth0\_validate\_new\_password( $errors, $user ) { |
  |  | 365 | $api\_client\_creds     = new WP\_Auth0\_Api\_Client\_Credentials($options); |
  |  | 366 | $api\_change\_email     = new WP\_Auth0\_Api\_Change\_Email($options, $api\_client\_creds); |
  |  | 367 | $profile\_change\_email = new WP\_Auth0\_Profile\_Change\_Email($api\_change\_email); |
  |  | 368 | return $profile\_change\_email->update\_email($wp\_user\_id, $old\_user\_data); |
  |  | 369 | } |
  |  | 370 | add\_action('profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2); |
  |  | 371 |  |
  |  | 372 | function wp\_auth0\_validate\_new\_password($errors, $user) |
  |  | 373 | { |
  | 351 | 374 | $options             = WP\_Auth0\_Options::Instance(); |
  | 352 |  | $api\_client\_creds    = new WP\_Auth0\_Api\_Client\_Credentials(~~$options~~ ); |
  | 353 |  | $api\_change\_password = new WP\_Auth0\_Api\_Change\_Password(~~$options, $api\_client\_creds~~ ); |
  | 354 |  | $profile\_change\_pwd  = new WP\_Auth0\_Profile\_Change\_Password(~~$api\_change\_password~~ ); |
  | 355 |  | return $profile\_change\_pwd->validate\_new\_password(~~$errors, $user~~ ); |
  |  | 375 | $api\_client\_creds    = new WP\_Auth0\_Api\_Client\_Credentials($options); |
  |  | 376 | $api\_change\_password = new WP\_Auth0\_Api\_Change\_Password($options, $api\_client\_creds); |
  |  | 377 | $profile\_change\_pwd  = new WP\_Auth0\_Profile\_Change\_Password($api\_change\_password); |
  |  | 378 | return $profile\_change\_pwd->validate\_new\_password($errors, $user); |
  | 356 | 379 | } |
  | 357 | 380 |  |
  | 358 | 381 | // Used during profile update in wp-admin. |
  | 359 |  | add\_action(~~'user\_profile\_update\_errors', 'wp\_auth0\_validate\_new\_password', 10, 2~~ ); |
  |  | 382 | add\_action('user\_profile\_update\_errors', 'wp\_auth0\_validate\_new\_password', 10, 2); |
  | 360 | 383 |  |
  | 361 | 384 | // Used during password reset on wp-login.php. |
  | 362 |  | add\_action(~~'validate\_password\_reset', 'wp\_auth0\_validate\_new\_password', 10, 2~~ ); |
  |  | 385 | add\_action('validate\_password\_reset', 'wp\_auth0\_validate\_new\_password', 10, 2); |
  | 363 | 386 |  |
  | 364 | 387 | // Used during WooCommerce edit account save. |
  | 365 |  | add\_action( 'woocommerce\_save\_account\_details\_errors', 'wp\_auth0\_validate\_new\_password', 10, 2 ); |
  | 366 |  |  |
  | 367 |  | function wp\_auth0\_show\_delete\_identity() { |
  |  | 388 | add\_action('woocommerce\_save\_account\_details\_errors', 'wp\_auth0\_validate\_new\_password', 10, 2); |
  |  | 389 |  |
  |  | 390 | function wp\_auth0\_show\_delete\_identity() |
  |  | 391 | { |
  | 368 | 392 | $profile\_delete\_data = new WP\_Auth0\_Profile\_Delete\_Data(); |
  | 369 | 393 | $profile\_delete\_data->show\_delete\_identity(); |
  | 370 | 394 | } |
  | 371 |  | add\_action( 'edit\_user\_profile', 'wp\_auth0\_show\_delete\_identity' ); |
  | 372 |  | add\_action( 'show\_user\_profile', 'wp\_auth0\_show\_delete\_identity' ); |
  | 373 |  |  |
  | 374 |  | function wp\_auth0\_delete\_user\_data() { |
  |  | 395 | add\_action('edit\_user\_profile', 'wp\_auth0\_show\_delete\_identity'); |
  |  | 396 | add\_action('show\_user\_profile', 'wp\_auth0\_show\_delete\_identity'); |
  |  | 397 |  |
  |  | 398 | function wp\_auth0\_delete\_user\_data() |
  |  | 399 | { |
  | 375 | 400 | $profile\_delete\_data = new WP\_Auth0\_Profile\_Delete\_Data(); |
  | 376 | 401 | $profile\_delete\_data->delete\_user\_data(); |
  | 377 | 402 | } |
  | 378 |  | add\_action( 'wp\_ajax\_auth0\_delete\_data', 'wp\_auth0\_delete\_user\_data' ); |
  | 379 |  |  |
  | 380 |  | function wp\_auth0\_init\_admin\_menu() { |
  | 381 |  |  |
  | 382 |  | if ( wp\_auth0\_is\_admin\_page( 'wpa0-help' ) ) { |
  | 383 |  | wp\_safe\_redirect( admin\_url( 'admin.php?page=wpa0#help' ), 301 ); |
  |  | 403 | add\_action('wp\_ajax\_auth0\_delete\_data', 'wp\_auth0\_delete\_user\_data'); |
  |  | 404 |  |
  |  | 405 | function wp\_auth0\_init\_admin\_menu() |
  |  | 406 | { |
  |  | 407 |  |
  |  | 408 | if (wp\_auth0\_is\_admin\_page('wpa0-help')) { |
  |  | 409 | wp\_safe\_redirect(admin\_url('admin.php?page=wpa0#help'), 301); |
  | 384 | 410 | exit; |
  | 385 | 411 | } |
  | 386 | 412 |  |
  | 387 | 413 | $options       = WP\_Auth0\_Options::Instance(); |
  | 388 |  | $routes        = new WP\_Auth0\_Routes(~~$options~~ ); |
  | 389 |  | $admin         = new WP\_Auth0\_Admin(~~$options, $routes~~ ); |
  |  | 414 | $routes        = new WP\_Auth0\_Routes($options); |
  |  | 415 | $admin         = new WP\_Auth0\_Admin($options, $routes); |
  | 390 | 416 |  |
  | 391 | 417 | $settings\_slug  = 'wpa0'; |
  | 392 |  | $settings\_title = ~~\_\_( 'Settings', 'wp-auth0'~~ ); |
  | 393 |  | $settings\_func  = [~~$admin, 'render\_settings\_page'~~ ]; |
  |  | 418 | $settings\_title = esc\_html\_\_('Settings', 'wp-auth0'); |
  |  | 419 | $settings\_func  = [$admin, 'render\_settings\_page']; |
  | 394 | 420 |  |
  | 395 | 421 | $menu\_parent = $settings\_slug; |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L406) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L432) |  |
  | 406 | 432 | ); |
  | 407 | 433 |  |
  | 408 |  | if (~~! wp\_auth0\_is\_ready()~~ ) { |
  | 409 |  | add\_submenu\_page(~~$menu\_parent, $settings\_title, $settings\_title, $cap, $settings\_slug, $settings\_func~~ ); |
  |  | 434 | if (!wp\_auth0\_is\_ready()) { |
  |  | 435 | add\_submenu\_page($menu\_parent, $settings\_title, $settings\_title, $cap, $settings\_slug, $settings\_func); |
  | 410 | 436 | } else { |
  | 411 |  | add\_submenu\_page(~~$menu\_parent, $settings\_title, $settings\_title, $cap, $settings\_slug, $settings\_func~~ ); |
  |  | 437 | add\_submenu\_page($menu\_parent, $settings\_title, $settings\_title, $cap, $settings\_slug, $settings\_func); |
  | 412 | 438 | add\_submenu\_page( |
  | 413 | 439 | $menu\_parent, |
  | 414 |  | ~~\_\_( 'Help', 'wp-auth0'~~ ), |
  | 415 |  | ~~\_\_( 'Help', 'wp-auth0'~~ ), |
  |  | 440 | esc\_html\_\_('Help', 'wp-auth0'), |
  |  | 441 | esc\_html\_\_('Help', 'wp-auth0'), |
  | 416 | 442 | $cap, |
  | 417 | 443 | 'wpa0-help', |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L422) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L448) |  |
  | 422 | 448 | add\_submenu\_page( |
  | 423 | 449 | $menu\_parent, |
  | 424 |  | ~~\_\_( 'Error Log', 'wp-auth0'~~ ), |
  | 425 |  | ~~\_\_( 'Error Log', 'wp-auth0'~~ ), |
  |  | 450 | esc\_html\_\_('Error Log', 'wp-auth0'), |
  |  | 451 | esc\_html\_\_('Error Log', 'wp-auth0'), |
  | 426 | 452 | $cap, |
  | 427 | 453 | 'wpa0-errors', |
  | 428 |  | [~~new WP\_Auth0\_ErrorLog(), 'render\_settings\_page'~~ ] |
  |  | 454 | [new WP\_Auth0\_ErrorLog(), 'render\_settings\_page'] |
  | 429 | 455 | ); |
  | 430 | 456 |  |
  | 431 | 457 | add\_submenu\_page( |
  | 432 | 458 | $menu\_parent, |
  | 433 |  | ~~\_\_( 'Import-Export Settings', 'wp-auth0'~~ ), |
  | 434 |  | ~~\_\_( 'Import-Export settings', 'wp-auth0'~~ ), |
  |  | 459 | esc\_html\_\_('Import-Export Settings', 'wp-auth0'), |
  |  | 460 | esc\_html\_\_('Import-Export settings', 'wp-auth0'), |
  | 435 | 461 | $cap, |
  | 436 | 462 | 'wpa0-import-settings', |
  | 437 |  | [~~new WP\_Auth0\_Import\_Settings( $options ), 'render\_import\_settings\_page'~~ ] |
  |  | 463 | [new WP\_Auth0\_Import\_Settings($options), 'render\_import\_settings\_page'] |
  | 438 | 464 | ); |
  | 439 | 465 | } |
  | 440 |  | add\_action( 'admin\_menu', 'wp\_auth0\_init\_admin\_menu', 96, 0 ); |
  | 441 |  |  |
  | 442 |  | function wp\_auth0\_create\_account\_message() { |
  |  | 466 | add\_action('admin\_menu', 'wp\_auth0\_init\_admin\_menu', 96, 0); |
  |  | 467 |  |
  |  | 468 | function wp\_auth0\_create\_account\_message() |
  |  | 469 | { |
  | 443 | 470 | // Not processing form data, just using a redirect parameter if present. |
  | 444 | 471 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L447) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L474) |  |
  | 447 | 474 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 448 | 475 | $current\_page     = $\_GET['page'] ?? null; |
  | 449 |  | $is\_correct\_admin = in\_array(~~$current\_page, [ 'wpa0', 'wpa0-errors', 'wpa0-import-settings' ]~~ ); |
  | 450 |  | if (~~wp\_auth0\_is\_ready() || ! $is\_correct\_admin~~ ) { |
  |  | 476 | $is\_correct\_admin = in\_array($current\_page, ['wpa0', 'wpa0-errors', 'wpa0-import-settings']); |
  |  | 477 | if (wp\_auth0\_is\_ready() || !$is\_correct\_admin) { |
  | 451 | 478 | return false; |
  | 452 | 479 | } |
  | 453 | 480 |  |
  | 454 |  | printf( |
  | 455 |  | '<div ~~class="update-nag~~">%s |
  | 456 |  | <strong><a href="https://auth0.com/docs/cms/wordpress/installation#manual-setup" target="\_blank"> |
  |  | 481 | echo wp\_kses(sprintf( |
  |  | 482 | '<div style="margin: 1rem 2rem 1rem 0; padding: 1.5rem; background: gray; color: white; border-radius: 4px">%s |
  |  | 483 | <strong><a href="https://auth0.com/docs/cms/wordpress/installation#manual-setup" target="\_blank" style="font-weight: bold; color: white"> |
  | 457 | 484 | %s</a></strong>.</div>', |
  | 458 |  | ~~\_\_( 'Plugin is not yet configured. Please follow the ', 'wp-auth0'~~ ), |
  | 459 |  | ~~\_\_( 'setup instructions', 'wp-auth0'~~ ) |
  | 460 |  | ); |
  |  | 485 | esc\_html\_\_('Plugin is not yet configured. Please follow the ', 'wp-auth0'), |
  |  | 486 | esc\_html\_\_('setup instructions', 'wp-auth0') |
  |  | 487 | ), ['div' => ['style' => true], 'strong' => [], 'a' => ['href' => true, 'target' => true, 'style' => true]]); |
  | 461 | 488 | return true; |
  | 462 | 489 |  |
  | 463 | 490 | // phpcs:enable WordPress.Security.NonceVerification.NoNonceVerification |
  | 464 | 491 | } |
  | 465 |  | add\_action( 'admin\_notices', 'wp\_auth0\_create\_account\_message' ); |
  | 466 |  |  |
  | 467 |  | function wp\_auth0\_init\_admin() { |
  |  | 492 | function wp\_auth0\_deprecated\_version() |
  |  | 493 | { |
  |  | 494 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  |  | 495 |  |
  |  | 496 | // Null coalescing validates input variable. |
  |  | 497 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  |  | 498 | $current\_page     = $\_GET['page'] ?? null; |
  |  | 499 | $is\_correct\_admin = in\_array($current\_page, ['wpa0', 'wpa0-errors', 'wpa0-import-settings']); |
  |  | 500 | if (wp\_auth0\_is\_ready() || !$is\_correct\_admin) { |
  |  | 501 | return false; |
  |  | 502 | } |
  |  | 503 |  |
  |  | 504 | echo wp\_kses(sprintf( |
  |  | 505 | '<div style="margin: 1rem 2rem 1rem 0; padding: 1.5rem; background: orange; color: white; border-radius: 4px">%s |
  |  | 506 | <strong><a href="https://github.com/auth0/wordpress#upgrade" target="\_blank" style="font-weight: bold; color: white"> |
  |  | 507 | %s</a></strong>.</div>', |
  |  | 508 | esc\_html\_\_('This version of the Auth0 WordPress plugin is no longer supported. Please ', 'wp-auth0'), |
  |  | 509 | esc\_html\_\_('upgrade to v5.', 'wp-auth0') |
  |  | 510 | ), ['div' => ['style' => true], 'strong' => [], 'a' => ['href' => true, 'target' => true, 'style' => true]]); |
  |  | 511 | return true; |
  |  | 512 |  |
  |  | 513 | // phpcs:enable WordPress.Security.NonceVerification.NoNonceVerification |
  |  | 514 | } |
  |  | 515 | // add\_action('admin\_notices', 'wp\_auth0\_deprecated\_version'); |
  |  | 516 | add\_action('admin\_notices', 'wp\_auth0\_create\_account\_message'); |
  |  | 517 |  |
  |  | 518 | function wp\_auth0\_init\_admin() |
  |  | 519 | { |
  | 468 | 520 | $options = WP\_Auth0\_Options::Instance(); |
  | 469 |  | $routes  = new WP\_Auth0\_Routes(~~$options~~ ); |
  | 470 |  | $admin   = new WP\_Auth0\_Admin(~~$options, $routes~~ ); |
  |  | 521 | $routes  = new WP\_Auth0\_Routes($options); |
  |  | 522 | $admin   = new WP\_Auth0\_Admin($options, $routes); |
  | 471 | 523 | $admin->init\_admin(); |
  | 472 | 524 | } |
  | 473 |  | add\_action( 'admin\_init', 'wp\_auth0\_init\_admin' ); |
  | 474 |  |  |
  | 475 |  | function wp\_auth0\_admin\_enqueue\_scripts() { |
  |  | 525 | add\_action('admin\_init', 'wp\_auth0\_init\_admin'); |
  |  | 526 |  |
  |  | 527 | function wp\_auth0\_admin\_enqueue\_scripts() |
  |  | 528 | { |
  | 476 | 529 | $options = WP\_Auth0\_Options::Instance(); |
  | 477 |  | $routes  = new WP\_Auth0\_Routes(~~$options~~ ); |
  | 478 |  | $admin   = new WP\_Auth0\_Admin(~~$options, $routes~~ ); |
  |  | 530 | $routes  = new WP\_Auth0\_Routes($options); |
  |  | 531 | $admin   = new WP\_Auth0\_Admin($options, $routes); |
  | 479 | 532 | return $admin->admin\_enqueue(); |
  | 480 | 533 | } |
  | 481 |  | add\_action( 'admin\_enqueue\_scripts', 'wp\_auth0\_admin\_enqueue\_scripts', 1 ); |
  | 482 |  |  |
  | 483 |  | function wp\_auth0\_custom\_requests( $wp, $return = false ) { |
  | 484 |  | $routes = new WP\_Auth0\_Routes( WP\_Auth0\_Options::Instance() ); |
  | 485 |  | return $routes->custom\_requests( $wp, $return ); |
  | 486 |  | } |
  | 487 |  | add\_action( 'parse\_request', 'wp\_auth0\_custom\_requests' ); |
  | 488 |  |  |
  | 489 |  | function wp\_auth0\_profile\_enqueue\_scripts() { |
  |  | 534 | add\_action('admin\_enqueue\_scripts', 'wp\_auth0\_admin\_enqueue\_scripts', 1); |
  |  | 535 |  |
  |  | 536 | function wp\_auth0\_custom\_requests($wp, $return = false) |
  |  | 537 | { |
  |  | 538 | $routes = new WP\_Auth0\_Routes(WP\_Auth0\_Options::Instance()); |
  |  | 539 | return $routes->custom\_requests($wp, $return); |
  |  | 540 | } |
  |  | 541 | add\_action('parse\_request', 'wp\_auth0\_custom\_requests'); |
  |  | 542 |  |
  |  | 543 | function wp\_auth0\_profile\_enqueue\_scripts() |
  |  | 544 | { |
  | 490 | 545 | global $pagenow; |
  | 491 | 546 |  |
  | 492 |  | if (~~! in\_array( $pagenow, [ 'profile.php', 'user-edit.php' ] )~~ ) { |
  |  | 547 | if (!in\_array($pagenow, ['profile.php', 'user-edit.php'])) { |
  | 493 | 548 | return false; |
  | 494 | 549 | } |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L497) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L552) |  |
  | 497 | 552 | 'wpa0\_user\_profile', |
  | 498 | 553 | WPA0\_PLUGIN\_JS\_URL . 'edit-user-profile.js', |
  | 499 |  | [ 'jquery' ], |
  | 500 |  | WPA0\_VERSION |
  |  | 554 | ['jquery'], |
  |  | 555 | WPA0\_VERSION, |
  |  | 556 | true |
  | 501 | 557 | ); |
  | 502 | 558 |  |
  | 503 |  | $profile  = get\_auth0userinfo(~~$GLOBALS['user\_id']~~ ); |
  | 504 |  | $strategy = isset(~~$profile->sub ) ? WP\_Auth0\_Users::get\_strategy( $profile->sub~~ ) : ''; |
  |  | 559 | $profile  = get\_auth0userinfo($GLOBALS['user\_id']); |
  |  | 560 | $strategy = isset($profile->sub) ? WP\_Auth0\_Users::get\_strategy($profile->sub) : ''; |
  | 505 | 561 |  |
  | 506 | 562 | wp\_localize\_script( |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L508) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L564) |  |
  | 508 | 564 | 'wpa0UserProfile', |
  | 509 | 565 | [ |
  | 510 |  | 'userId'        => intval(~~$GLOBALS['user\_id']~~ ), |
  | 511 |  | 'userStrategy'  => sanitize\_text\_field(~~$strategy~~ ), |
  | 512 |  | 'deleteIdNonce' => wp\_create\_nonce(~~'delete\_auth0\_identity'~~ ), |
  | 513 |  | 'ajaxUrl'       => admin\_url(~~'admin-ajax.php'~~ ), |
  |  | 566 | 'userId'        => intval($GLOBALS['user\_id']), |
  |  | 567 | 'userStrategy'  => sanitize\_text\_field($strategy), |
  |  | 568 | 'deleteIdNonce' => wp\_create\_nonce('delete\_auth0\_identity'), |
  |  | 569 | 'ajaxUrl'       => admin\_url('admin-ajax.php'), |
  | 514 | 570 | 'i18n'          => [ |
  | 515 |  | 'confirmDeleteId'   => ~~\_\_( 'Are you sure you want to delete the Auth0 user data for this user?', 'wp-auth0'~~ ), |
  | 516 |  | 'actionComplete'    => ~~\_\_( 'Deleted', 'wp-auth0'~~ ), |
  | 517 |  | 'actionFailed'      => ~~\_\_( 'Action failed, please see the Auth0 error log for details.', 'wp-auth0'~~ ), |
  | 518 |  | 'cannotChangeEmail' => ~~\_\_( 'Email cannot be changed for non-database connections.', 'wp-auth0'~~ ), |
  |  | 571 | 'confirmDeleteId'   => esc\_html\_\_('Are you sure you want to delete the Auth0 user data for this user?', 'wp-auth0'), |
  |  | 572 | 'actionComplete'    => esc\_html\_\_('Deleted', 'wp-auth0'), |
  |  | 573 | 'actionFailed'      => esc\_html\_\_('Action failed, please see the Auth0 error log for details.', 'wp-auth0'), |
  |  | 574 | 'cannotChangeEmail' => esc\_html\_\_('Email cannot be changed for non-database connections.', 'wp-auth0'), |
  | 519 | 575 | ], |
  | 520 | 576 | ] |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L523) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L579) |  |
  | 523 | 579 | return true; |
  | 524 | 580 | } |
  | 525 |  | add\_action( 'admin\_enqueue\_scripts', 'wp\_auth0\_profile\_enqueue\_scripts' ); |
  | 526 |  |  |
  | 527 |  | function wp\_auth0\_process\_auth\_callback() { |
  | 528 |  | $users\_repo    = new WP\_Auth0\_UsersRepo( WP\_Auth0\_Options::Instance() ); |
  | 529 |  | $login\_manager = new WP\_Auth0\_LoginManager( $users\_repo, WP\_Auth0\_Options::Instance() ); |
  |  | 581 | add\_action('admin\_enqueue\_scripts', 'wp\_auth0\_profile\_enqueue\_scripts'); |
  |  | 582 |  |
  |  | 583 | function wp\_auth0\_process\_auth\_callback() |
  |  | 584 | { |
  |  | 585 | $users\_repo    = new WP\_Auth0\_UsersRepo(WP\_Auth0\_Options::Instance()); |
  |  | 586 | $login\_manager = new WP\_Auth0\_LoginManager($users\_repo, WP\_Auth0\_Options::Instance()); |
  | 530 | 587 | return $login\_manager->init\_auth0(); |
  | 531 | 588 | } |
  | 532 |  | add\_action( 'template\_redirect', 'wp\_auth0\_process\_auth\_callback', 1 ); |
  | 533 |  |  |
  | 534 |  | function wp\_auth0\_login\_ulp\_redirect() { |
  | 535 |  | $users\_repo    = new WP\_Auth0\_UsersRepo( WP\_Auth0\_Options::Instance() ); |
  | 536 |  | $login\_manager = new WP\_Auth0\_LoginManager( $users\_repo, WP\_Auth0\_Options::Instance() ); |
  |  | 589 | add\_action('template\_redirect', 'wp\_auth0\_process\_auth\_callback', 1); |
  |  | 590 |  |
  |  | 591 | function wp\_auth0\_login\_ulp\_redirect() |
  |  | 592 | { |
  |  | 593 | $users\_repo    = new WP\_Auth0\_UsersRepo(WP\_Auth0\_Options::Instance()); |
  |  | 594 | $login\_manager = new WP\_Auth0\_LoginManager($users\_repo, WP\_Auth0\_Options::Instance()); |
  | 537 | 595 | return $login\_manager->login\_auto(); |
  | 538 | 596 | } |
  | 539 |  | add\_action( 'login\_init', 'wp\_auth0\_login\_ulp\_redirect' ); |
  | 540 |  |  |
  | 541 |  | function wp\_auth0\_process\_logout() { |
  | 542 |  | $users\_repo    = new WP\_Auth0\_UsersRepo( WP\_Auth0\_Options::Instance() ); |
  | 543 |  | $login\_manager = new WP\_Auth0\_LoginManager( $users\_repo, WP\_Auth0\_Options::Instance() ); |
  |  | 597 | add\_action('login\_init', 'wp\_auth0\_login\_ulp\_redirect'); |
  |  | 598 |  |
  |  | 599 | function wp\_auth0\_process\_logout() |
  |  | 600 | { |
  |  | 601 | $users\_repo    = new WP\_Auth0\_UsersRepo(WP\_Auth0\_Options::Instance()); |
  |  | 602 | $login\_manager = new WP\_Auth0\_LoginManager($users\_repo, WP\_Auth0\_Options::Instance()); |
  | 544 | 603 | $login\_manager->logout(); |
  | 545 | 604 | } |
  | 546 |  | add\_action( 'wp\_logout', 'wp\_auth0\_process\_logout' ); |
  | 547 |  |  |
  | 548 |  | function wp\_auth0\_ajax\_delete\_cache\_transient() { |
  | 549 |  | check\_ajax\_referer( 'auth0\_delete\_cache\_transient' ); |
  | 550 |  | delete\_transient( WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME ); |
  |  | 605 | add\_action('wp\_logout', 'wp\_auth0\_process\_logout'); |
  |  | 606 |  |
  |  | 607 | function wp\_auth0\_ajax\_delete\_cache\_transient() |
  |  | 608 | { |
  |  | 609 | check\_ajax\_referer('auth0\_delete\_cache\_transient'); |
  |  | 610 | delete\_transient(WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME); |
  | 551 | 611 | wp\_send\_json\_success(); |
  | 552 | 612 | } |
  | 553 |  | add\_action(~~'wp\_ajax\_auth0\_delete\_cache\_transient', 'wp\_auth0\_ajax\_delete\_cache\_transient'~~ ); |
  |  | 613 | add\_action('wp\_ajax\_auth0\_delete\_cache\_transient', 'wp\_auth0\_ajax\_delete\_cache\_transient'); |
  | 554 | 614 |  |
  | 555 | 615 | /\*\* |
  | 556 | 616 | \* AJAX endpoint to rotate the migration token. |
  | 557 | 617 | \*/ |
  | 558 |  | function wp\_auth0\_ajax\_rotate\_migration\_token() { |
  | 559 |  | check\_ajax\_referer( WP\_Auth0\_Admin\_Advanced::ROTATE\_TOKEN\_NONCE\_ACTION ); |
  | 560 |  |  |
  | 561 |  | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  | 562 |  | wp\_send\_json\_error( [ 'error' => \_\_( 'Not authorized.', 'wp-auth0' ) ] ); |
  |  | 618 | function wp\_auth0\_ajax\_rotate\_migration\_token() |
  |  | 619 | { |
  |  | 620 | check\_ajax\_referer(WP\_Auth0\_Admin\_Advanced::ROTATE\_TOKEN\_NONCE\_ACTION); |
  |  | 621 |  |
  |  | 622 | if (!current\_user\_can('manage\_options')) { |
  |  | 623 | wp\_send\_json\_error(['error' => esc\_html\_\_('Not authorized.', 'wp-auth0')]); |
  | 563 | 624 | return; |
  | 564 | 625 | } |
  | 565 | 626 |  |
  | 566 |  | WP\_Auth0\_Options::Instance()->set(~~'migration\_token', wp\_auth0\_generate\_token()~~ ); |
  |  | 627 | WP\_Auth0\_Options::Instance()->set('migration\_token', wp\_auth0\_generate\_token()); |
  | 567 | 628 | wp\_send\_json\_success(); |
  | 568 | 629 | } |
  | 569 |  | add\_action(~~'wp\_ajax\_auth0\_rotate\_migration\_token', 'wp\_auth0\_ajax\_rotate\_migration\_token'~~ ); |
  |  | 630 | add\_action('wp\_ajax\_auth0\_rotate\_migration\_token', 'wp\_auth0\_ajax\_rotate\_migration\_token'); |
  | 570 | 631 |  |
  | 571 | 632 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L575) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L636) |  |
  | 575 | 636 | \* @codeCoverageIgnore - Tested in TestEmailVerification::testResendVerificationEmail() |
  | 576 | 637 | \*/ |
  | 577 |  | function wp\_auth0\_ajax\_resend\_verification\_email() { |
  | 578 |  | check\_ajax\_referer( WP\_Auth0\_Email\_Verification::RESEND\_NONCE\_ACTION ); |
  |  | 638 | function wp\_auth0\_ajax\_resend\_verification\_email() |
  |  | 639 | { |
  |  | 640 | check\_ajax\_referer(WP\_Auth0\_Email\_Verification::RESEND\_NONCE\_ACTION); |
  | 579 | 641 |  |
  | 580 | 642 | $options               = WP\_Auth0\_Options::Instance(); |
  | 581 |  | $api\_client\_creds      = new WP\_Auth0\_Api\_Client\_Credentials(~~$options~~ ); |
  | 582 |  | $api\_jobs\_verification = new WP\_Auth0\_Api\_Jobs\_Verification(~~$options, $api\_client\_creds~~ ); |
  | 583 |  |  |
  | 584 |  | if (~~empty( $\_POST['sub'] )~~ ) { |
  | 585 |  | wp\_send\_json\_error(~~[ 'error' => \_\_( 'No Auth0 user ID provided.', 'wp-auth0' ) ]~~ ); |
  |  | 643 | $api\_client\_creds      = new WP\_Auth0\_Api\_Client\_Credentials($options); |
  |  | 644 | $api\_jobs\_verification = new WP\_Auth0\_Api\_Jobs\_Verification($options, $api\_client\_creds); |
  |  | 645 |  |
  |  | 646 | if (empty($\_POST['sub'])) { |
  |  | 647 | wp\_send\_json\_error(['error' => esc\_html\_\_('No Auth0 user ID provided.', 'wp-auth0')]); |
  | 586 | 648 | } |
  | 587 | 649 |  |
  | 588 | 650 | // Validated above and only sent to the change signup API endpoint. |
  | 589 | 651 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 590 |  | if (~~! $api\_jobs\_verification->call( wp\_unslash( $\_POST['sub'] ) )~~ ) { |
  | 591 |  | wp\_send\_json\_error(~~[ 'error' => \_\_( 'API call failed.', 'wp-auth0' ) ]~~ ); |
  |  | 652 | if (!$api\_jobs\_verification->call(wp\_unslash($\_POST['sub']))) { |
  |  | 653 | wp\_send\_json\_error(['error' => esc\_html\_\_('API call failed.', 'wp-auth0')]); |
  | 592 | 654 | } |
  | 593 | 655 |  |
  | 594 | 656 | wp\_send\_json\_success(); |
  | 595 | 657 | } |
  | 596 |  | add\_action(~~'wp\_ajax\_nopriv\_resend\_verification\_email', 'wp\_auth0\_ajax\_resend\_verification\_email'~~ ); |
  |  | 658 | add\_action('wp\_ajax\_nopriv\_resend\_verification\_email', 'wp\_auth0\_ajax\_resend\_verification\_email'); |
  | 597 | 659 |  |
  | 598 | 660 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L603) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L665) |  |
  | 603 | 665 | \* @return string |
  | 604 | 666 | \*/ |
  | 605 |  | function wp\_auth0\_filter\_wp\_redirect\_lostpassword( $location ) { |
  |  | 667 | function wp\_auth0\_filter\_wp\_redirect\_lostpassword($location) |
  |  | 668 | { |
  | 606 | 669 | // Make sure we're going to the check email action on the wp-login page. |
  | 607 |  | if (~~'wp-login.php?checkemail=confirm' !== $location~~ ) { |
  |  | 670 | if ('wp-login.php?checkemail=confirm' !== $location) { |
  | 608 | 671 | return $location; |
  | 609 | 672 | } |
  | 610 | 673 |  |
  | 611 | 674 | // Make sure we're on the lost password action on the wp-login page. |
  | 612 |  | if (~~! wp\_auth0\_is\_current\_login\_action( [ 'lostpassword' ] )~~ ) { |
  |  | 675 | if (!wp\_auth0\_is\_current\_login\_action(['lostpassword'])) { |
  | 613 | 676 | return $location; |
  | 614 | 677 | } |
  | 615 | 678 |  |
  | 616 | 679 | // Make sure plugin settings allow core WP login form overrides |
  | 617 |  | if (~~'never' === wp\_auth0\_get\_option( 'wordpress\_login\_enabled' )~~ ) { |
  |  | 680 | if ('never' === wp\_auth0\_get\_option('wordpress\_login\_enabled')) { |
  | 618 | 681 | return $location; |
  | 619 | 682 | } |
  | 620 | 683 |  |
  | 621 | 684 | // Make sure we're coming from an override page. |
  | 622 |  | $required\_referrer = remove\_query\_arg(~~'wle', wp\_login\_url()~~ ); |
  | 623 |  | $required\_referrer = add\_query\_arg(~~'action', 'lostpassword', $required\_referrer~~ ); |
  | 624 |  | $required\_referrer = wp\_auth0\_login\_override\_url(~~$required\_referrer~~ ); |
  | 625 |  | if (~~! isset( $\_SERVER['HTTP\_REFERER'] ) || $required\_referrer !== $\_SERVER['HTTP\_REFERER']~~ ) { |
  |  | 685 | $required\_referrer = remove\_query\_arg('wle', wp\_login\_url()); |
  |  | 686 | $required\_referrer = add\_query\_arg('action', 'lostpassword', $required\_referrer); |
  |  | 687 | $required\_referrer = wp\_auth0\_login\_override\_url($required\_referrer); |
  |  | 688 | if (!isset($\_SERVER['HTTP\_REFERER']) || $required\_referrer !== $\_SERVER['HTTP\_REFERER']) { |
  | 626 | 689 | return $location; |
  | 627 | 690 | } |
  | 628 | 691 |  |
  | 629 |  | return wp\_auth0\_login\_override\_url(~~$location~~ ); |
  | 630 |  | } |
  | 631 |  |  |
  | 632 |  | add\_filter(~~'wp\_redirect', 'wp\_auth0\_filter\_wp\_redirect\_lostpassword', 100~~ ); |
  |  | 692 | return wp\_auth0\_login\_override\_url($location); |
  |  | 693 | } |
  |  | 694 |  |
  |  | 695 | add\_filter('wp\_redirect', 'wp\_auth0\_filter\_wp\_redirect\_lostpassword', 100); |
  | 633 | 696 |  |
  | 634 | 697 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L639) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L702) |  |
  | 639 | 702 | \* @return string |
  | 640 | 703 | \*/ |
  | 641 |  | function wp\_auth0\_filter\_login\_override\_url( $wp\_login\_url ) { |
  |  | 704 | function wp\_auth0\_filter\_login\_override\_url($wp\_login\_url) |
  |  | 705 | { |
  | 642 | 706 | // Not processing form data, just using a redirect parameter if present. |
  | 643 | 707 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 644 | 708 |  |
  | 645 |  | if ( wp\_auth0\_can\_show\_wp\_login\_form() && isset( $\_REQUEST['wle'] ) ) { |
  |  | 709 | $options = WP\_Auth0\_Options::Instance(); |
  |  | 710 | $wle = $options->get('wle\_code'); |
  |  | 711 |  |
  |  | 712 | if (wp\_auth0\_can\_show\_wp\_login\_form() && $wle !== null) { |
  | 646 | 713 | // We are on an override page. |
  | 647 |  | $wp\_login\_url = add\_query\_arg( 'wle', sanitize\_text\_field( wp\_unslash( $\_REQUEST['wle'] ) ), $wp\_login\_url ); |
  | 648 |  | } elseif ( wp\_auth0\_is\_current\_login\_action( [ 'resetpass' ] ) ) { |
  |  | 714 | } elseif (wp\_auth0\_is\_current\_login\_action(['resetpass'])) { |
  | 649 | 715 | // We are on the reset password page with a link to login. |
  | 650 | 716 | // This page will not be shown unless we get here via a valid reset password request. |
  | 651 |  | $wp\_login\_url = wp\_auth0\_login\_override\_url(~~$wp\_login\_url~~ ); |
  | 652 |  | } |
  | 653 |  | return ~~$wp\_login\_url~~; |
  |  | 717 | $wp\_login\_url = wp\_auth0\_login\_override\_url($wp\_login\_url); |
  |  | 718 | } |
  |  | 719 | return esc\_url($wp\_login\_url); |
  | 654 | 720 |  |
  | 655 | 721 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 656 | 722 | } |
  | 657 | 723 |  |
  | 658 |  | add\_filter(~~'lostpassword\_url', 'wp\_auth0\_filter\_login\_override\_url', 100~~ ); |
  | 659 |  | add\_filter(~~'login\_url', 'wp\_auth0\_filter\_login\_override\_url', 100~~ ); |
  |  | 724 | add\_filter('lostpassword\_url', 'wp\_auth0\_filter\_login\_override\_url', 100); |
  |  | 725 | add\_filter('login\_url', 'wp\_auth0\_filter\_login\_override\_url', 100); |
  | 660 | 726 |  |
  | 661 | 727 | /\*\* |
  | 662 | 728 | \* Add the core WP form override to the lost password and login forms. |
  | 663 | 729 | \*/ |
  | 664 |  | function wp\_auth0\_filter\_login\_override\_form() { |
  |  | 730 | function wp\_auth0\_filter\_login\_override\_form() |
  |  | 731 | { |
  | 665 | 732 | // Not processing form data, just using a redirect parameter if present. |
  | 666 | 733 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 667 | 734 |  |
  | 668 |  | if (~~wp\_auth0\_can\_show\_wp\_login\_form() && isset( $\_REQUEST['wle'] )~~ ) { |
  |  | 735 | if (wp\_auth0\_can\_show\_wp\_login\_form() && isset($\_REQUEST['wle'])) { |
  | 669 | 736 | // Input is being output, not stored. |
  | 670 | 737 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 671 |  | ~~printf( '<input type="hidden" name="wle" value="%s" />', esc\_attr( wp\_unslash( $\_REQUEST['wle'] ) )~~ ); |
  |  | 738 | echo wp\_kses(sprintf('<input type="hidden" name="wle" value="%s" />', esc\_attr(wp\_unslash($\_REQUEST['wle']))), ['input' => ['type' => true, 'name' => true, 'value' => true]]); |
  | 672 | 739 | } |
  | 673 | 740 |  |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L675) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L742) |  |
  | 675 | 742 | } |
  | 676 | 743 |  |
  | 677 |  | add\_action(~~'login\_form', 'wp\_auth0\_filter\_login\_override\_form', 100~~ ); |
  | 678 |  | add\_action(~~'lostpassword\_form', 'wp\_auth0\_filter\_login\_override\_form', 100~~ ); |
  |  | 744 | add\_action('login\_form', 'wp\_auth0\_filter\_login\_override\_form', 100); |
  |  | 745 | add\_action('lostpassword\_form', 'wp\_auth0\_filter\_login\_override\_form', 100); |
  | 679 | 746 |  |
  | 680 | 747 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L685) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L752) |  |
  | 685 | 752 | \* @return array |
  | 686 | 753 | \*/ |
  | 687 |  | function wp\_auth0\_filter\_body\_class( array $classes ) { |
  | 688 |  | if ( wp\_auth0\_can\_show\_wp\_login\_form() ) { |
  |  | 754 | function wp\_auth0\_filter\_body\_class(array $classes) |
  |  | 755 | { |
  |  | 756 | if (wp\_auth0\_can\_show\_wp\_login\_form()) { |
  | 689 | 757 | $classes[] = 'a0-show-core-login'; |
  | 690 | 758 | } |
  | 691 | 759 | return $classes; |
  | 692 | 760 | } |
  | 693 |  | add\_filter(~~'body\_class', 'wp\_auth0\_filter\_body\_class'~~ ); |
  | 694 |  | add\_filter(~~'login\_body\_class', 'wp\_auth0\_filter\_body\_class'~~ ); |
  |  | 761 | add\_filter('body\_class', 'wp\_auth0\_filter\_body\_class'); |
  |  | 762 | add\_filter('login\_body\_class', 'wp\_auth0\_filter\_body\_class'); |
  | 695 | 763 |  |
  | 696 | 764 | /\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L705) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L773) |  |
  | 705 | 773 | \* @return mixed |
  | 706 | 774 | \*/ |
  | 707 |  | function wp\_auth0\_filter\_woocommerce\_checkout\_login\_message( $html ) { |
  | 708 |  | $wp\_auth0\_woocommerce = new WP\_Auth0\_WooCommerceOverrides( WP\_Auth0\_Options::Instance() ); |
  | 709 |  | return $wp\_auth0\_woocommerce->override\_woocommerce\_checkout\_login\_form( $html ); |
  | 710 |  | } |
  | 711 |  | add\_filter( 'woocommerce\_checkout\_login\_message', 'wp\_auth0\_filter\_woocommerce\_checkout\_login\_message' ); |
  |  | 775 | function wp\_auth0\_filter\_woocommerce\_checkout\_login\_message($html) |
  |  | 776 | { |
  |  | 777 | $wp\_auth0\_woocommerce = new WP\_Auth0\_WooCommerceOverrides(WP\_Auth0\_Options::Instance()); |
  |  | 778 | return $wp\_auth0\_woocommerce->override\_woocommerce\_checkout\_login\_form($html); |
  |  | 779 | } |
  |  | 780 | add\_filter('woocommerce\_checkout\_login\_message', 'wp\_auth0\_filter\_woocommerce\_checkout\_login\_message'); |
  | 712 | 781 |  |
  | 713 | 782 | /\*\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L718) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L787) |  |
  | 718 | 787 | \* @return mixed |
  | 719 | 788 | \*/ |
  | 720 |  | function wp\_auth0\_filter\_woocommerce\_before\_customer\_login\_form( $html ) { |
  | 721 |  | $wp\_auth0\_woocommerce = new WP\_Auth0\_WooCommerceOverrides( WP\_Auth0\_Options::Instance() ); |
  | 722 |  | return $wp\_auth0\_woocommerce->override\_woocommerce\_login\_form( $html ); |
  | 723 |  | } |
  | 724 |  | add\_filter( 'woocommerce\_before\_customer\_login\_form', 'wp\_auth0\_filter\_woocommerce\_before\_customer\_login\_form' ); |
  |  | 789 | function wp\_auth0\_filter\_woocommerce\_before\_customer\_login\_form($html) |
  |  | 790 | { |
  |  | 791 | $wp\_auth0\_woocommerce = new WP\_Auth0\_WooCommerceOverrides(WP\_Auth0\_Options::Instance()); |
  |  | 792 | return $wp\_auth0\_woocommerce->override\_woocommerce\_login\_form($html); |
  |  | 793 | } |
  |  | 794 | add\_filter('woocommerce\_before\_customer\_login\_form', 'wp\_auth0\_filter\_woocommerce\_before\_customer\_login\_form'); |
  | 725 | 795 |  |
  | 726 | 796 | /\* |
  | […](/browser/auth0/trunk/WP_Auth0.php?rev=3020639#L729) | […](/browser/auth0/trunk/WP_Auth0.php?rev=3114611#L799) |  |
  | 729 | 799 |  |
  | 730 | 800 | // Passwordless beta testing - https://github.com/auth0/wp-auth0/issues/400 |
  | 731 |  | remove\_filter(~~'login\_message', 'wp\_auth0\_pwl\_plugin\_login\_message\_before', 5~~ ); |
  | 732 |  | remove\_filter(~~'login\_message', 'wp\_auth0\_pwl\_plugin\_login\_message\_after', 6~~ ); |
  |  | 801 | remove\_filter('login\_message', 'wp\_auth0\_pwl\_plugin\_login\_message\_before', 5); |
  |  | 802 | remove\_filter('login\_message', 'wp\_auth0\_pwl\_plugin\_login\_message\_after', 6); |
* ## [auth0/trunk/lib/WP\_Auth0\_Api\_Client.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Api_Client.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Api_Client.php")

  | [r2271973](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Class WP\_Auth0\_Api\_Client class. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L11) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Client |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Client { |
  |  | 14 | class WP\_Auth0\_Api\_Client |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | const DEFAULT\_CLIENT\_ALG = 'RS256'; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L32) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L34) |  |
  | 32 | 34 | \* @return string |
  | 33 | 35 | \*/ |
  | 34 |  | private static function get\_endpoint( $path = '', $domain = '' ) { |
  | 35 |  |  |
  | 36 |  | if ( empty( $domain ) ) { |
  | 37 |  | $domain = wp\_auth0\_get\_option( 'domain' ); |
  | 38 |  | } |
  | 39 |  |  |
  | 40 |  | if ( ! empty( $path[0] ) && '/' === $path[0] ) { |
  | 41 |  | $path = substr( $path, 1 ); |
  |  | 36 | private static function get\_endpoint($path = '', $domain = '') |
  |  | 37 | { |
  |  | 38 |  |
  |  | 39 | if (empty($domain)) { |
  |  | 40 | $domain = wp\_auth0\_get\_option('domain'); |
  |  | 41 | } |
  |  | 42 |  |
  |  | 43 | if (!empty($path[0]) && '/' === $path[0]) { |
  |  | 44 | $path = substr($path, 1); |
  | 42 | 45 | } |
  | 43 | 46 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L54) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L57) |  |
  | 54 | 57 | \* @return string|array |
  | 55 | 58 | \*/ |
  | 56 |  | public static function get\_connect\_info( $opt = '' ) { |
  | 57 |  |  |
  | 58 |  | if ( is\_null( self::$connect\_info ) ) { |
  |  | 59 | public static function get\_connect\_info($opt = '') |
  |  | 60 | { |
  |  | 61 |  |
  |  | 62 | if (is\_null(self::$connect\_info)) { |
  | 59 | 63 | self::$connect\_info = [ |
  | 60 |  | 'domain'        => wp\_auth0\_get\_option(~~'domain'~~ ), |
  | 61 |  | 'client\_id'     => wp\_auth0\_get\_option(~~'client\_id'~~ ), |
  | 62 |  | 'client\_secret' => wp\_auth0\_get\_option(~~'client\_secret'~~ ), |
  |  | 64 | 'domain'        => wp\_auth0\_get\_option('domain'), |
  |  | 65 | 'client\_id'     => wp\_auth0\_get\_option('client\_id'), |
  |  | 66 | 'client\_secret' => wp\_auth0\_get\_option('client\_secret'), |
  | 63 | 67 | 'app\_token'     => null, |
  | 64 |  | 'audience'      => self::get\_endpoint(~~'api/v2/'~~ ), |
  |  | 68 | 'audience'      => self::get\_endpoint('api/v2/'), |
  | 65 | 69 | ]; |
  | 66 | 70 | } |
  | 67 | 71 |  |
  | 68 |  | if (~~empty( $opt )~~ ) { |
  |  | 72 | if (empty($opt)) { |
  | 69 | 73 | return self::$connect\_info; |
  | 70 | 74 | } else { |
  | 71 |  | return !~~empty( self::$connect\_info[ $opt ] ) ? self::$connect\_info[ $opt~~ ] : ''; |
  |  | 75 | return !empty(self::$connect\_info[$opt]) ? self::$connect\_info[$opt] : ''; |
  | 72 | 76 | } |
  | 73 | 77 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L83) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L87) |  |
  | 83 | 87 | \* @return array |
  | 84 | 88 | \*/ |
  | 85 |  | private static function get\_headers( $token = '', $content\_type = 'application/json' ) { |
  |  | 89 | private static function get\_headers($token = '', $content\_type = 'application/json') |
  |  | 90 | { |
  | 86 | 91 |  |
  | 87 | 92 | $headers = WP\_Auth0\_Api\_Abstract::get\_info\_headers(); |
  | 88 | 93 |  |
  | 89 |  | if (~~! empty( $token )~~ ) { |
  |  | 94 | if (!empty($token)) { |
  | 90 | 95 | $headers['Authorization'] = "Bearer {$token}"; |
  | 91 | 96 | } |
  | 92 | 97 |  |
  | 93 |  | if (~~! empty( $content\_type )~~ ) { |
  |  | 98 | if (!empty($content\_type)) { |
  | 94 | 99 | $headers['Content-Type'] = $content\_type; |
  | 95 | 100 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L106) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L111) |  |
  | 106 | 111 | \* @return mixed |
  | 107 | 112 | \*/ |
  | 108 |  | public static function signup\_user( $domain, $data ) { |
  |  | 113 | public static function signup\_user($domain, $data) |
  |  | 114 | { |
  | 109 | 115 |  |
  | 110 | 116 | $endpoint = "https://$domain/dbconnections/signup"; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L118) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L124) |  |
  | 118 | 124 | [ |
  | 119 | 125 | 'headers' => $headers, |
  | 120 |  | 'body'    => json\_encode(~~$data~~ ), |
  | 121 |  | ] |
  | 122 |  | ); |
  | 123 |  |  |
  | 124 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 125 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response~~ ); |
  | 126 |  | return false; |
  | 127 |  | } |
  | 128 |  |  |
  | 129 |  | if (~~$response['response']['code'] !== 200~~ ) { |
  | 130 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response['body']~~ ); |
  | 131 |  | return false; |
  | 132 |  | } |
  | 133 |  |  |
  | 134 |  | return json\_decode(~~$response['body']~~ ); |
  |  | 126 | 'body'    => json\_encode($data), |
  |  | 127 | ] |
  |  | 128 | ); |
  |  | 129 |  |
  |  | 130 | if ($response instanceof WP\_Error) { |
  |  | 131 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response); |
  |  | 132 | return false; |
  |  | 133 | } |
  |  | 134 |  |
  |  | 135 | if ($response['response']['code'] !== 200) { |
  |  | 136 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 137 | return false; |
  |  | 138 | } |
  |  | 139 |  |
  |  | 140 | return json\_decode($response['body']); |
  | 135 | 141 | } |
  | 136 | 142 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L140) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L146) |  |
  | 140 | 146 | \* @return array |
  | 141 | 147 | \*/ |
  | 142 |  | public static function get\_required\_scopes() { |
  |  | 148 | public static function get\_required\_scopes() |
  |  | 149 | { |
  | 143 | 150 | return [ |
  | 144 | 151 | 'read:users', |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L159) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L166) |  |
  | 159 | 166 | \* @return bool|object|array |
  | 160 | 167 | \*/ |
  | 161 |  | public static function create\_client( $domain, $app\_token, $name ) { |
  |  | 168 | public static function create\_client($domain, $app\_token, $name) |
  |  | 169 | { |
  | 162 | 170 |  |
  | 163 | 171 | $options = WP\_Auth0\_Options::Instance(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L176) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L184) |  |
  | 176 | 184 |  |
  | 177 | 185 | // Force SSL, will not work without it |
  | 178 |  | 'cross\_origin\_loc'    => add\_query\_arg(~~'auth0fallback', '1', site\_url( 'index.php', 'https' )~~ ), |
  |  | 186 | 'cross\_origin\_loc'    => add\_query\_arg('auth0fallback', '1', site\_url('index.php', 'https')), |
  | 179 | 187 | 'cross\_origin\_auth'   => true, |
  | 180 | 188 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L202) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L210) |  |
  | 202 | 210 |  |
  | 203 | 211 | $response = wp\_remote\_post( |
  | 204 |  | self::get\_endpoint(~~'api/v2/clients', $domain~~ ), |
  | 205 |  | [ |
  | 206 |  | 'headers' => self::get\_headers(~~$app\_token~~ ), |
  | 207 |  | 'body'    => json\_encode(~~$payload~~ ), |
  | 208 |  | ] |
  | 209 |  | ); |
  | 210 |  |  |
  | 211 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 212 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response->get\_error\_message()~~ ); |
  | 213 |  | return false; |
  | 214 |  | } |
  | 215 |  |  |
  | 216 |  | if (~~$response['response']['code'] != 201~~ ) { |
  | 217 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response['body']~~ ); |
  | 218 |  | return false; |
  | 219 |  | } |
  | 220 |  |  |
  | 221 |  | return json\_decode(~~$response['body']~~ ); |
  |  | 212 | self::get\_endpoint('api/v2/clients', $domain), |
  |  | 213 | [ |
  |  | 214 | 'headers' => self::get\_headers($app\_token), |
  |  | 215 | 'body'    => json\_encode($payload), |
  |  | 216 | ] |
  |  | 217 | ); |
  |  | 218 |  |
  |  | 219 | if ($response instanceof WP\_Error) { |
  |  | 220 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response->get\_error\_message()); |
  |  | 221 | return false; |
  |  | 222 | } |
  |  | 223 |  |
  |  | 224 | if ($response['response']['code'] != 201) { |
  |  | 225 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 226 | return false; |
  |  | 227 | } |
  |  | 228 |  |
  |  | 229 | return json\_decode($response['body']); |
  | 222 | 230 | } |
  | 223 | 231 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L231) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L239) |  |
  | 231 | 239 | \* @return array|bool|mixed|object |
  | 232 | 240 | \*/ |
  | 233 |  | public static function create\_client\_grant( $app\_token, $client\_id ) { |
  |  | 241 | public static function create\_client\_grant($app\_token, $client\_id) |
  |  | 242 | { |
  | 234 | 243 |  |
  | 235 | 244 | $data = [ |
  | 236 | 245 | 'client\_id' => $client\_id, |
  | 237 |  | 'audience'  => self::get\_connect\_info(~~'audience'~~ ), |
  |  | 246 | 'audience'  => self::get\_connect\_info('audience'), |
  | 238 | 247 | 'scope'     => self::get\_required\_scopes(), |
  | 239 | 248 | ]; |
  | 240 | 249 |  |
  | 241 | 250 | $response = wp\_remote\_post( |
  | 242 |  | self::get\_endpoint(~~'api/v2/client-grants'~~ ), |
  | 243 |  | [ |
  | 244 |  | 'headers' => self::get\_headers(~~$app\_token~~ ), |
  | 245 |  | 'body'    => json\_encode(~~$data~~ ), |
  | 246 |  | ] |
  | 247 |  | ); |
  | 248 |  |  |
  | 249 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 250 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response~~ ); |
  | 251 |  | return false; |
  | 252 |  | } |
  | 253 |  |  |
  | 254 |  | if (~~409 === $response['response']['code']~~ ) { |
  |  | 251 | self::get\_endpoint('api/v2/client-grants'), |
  |  | 252 | [ |
  |  | 253 | 'headers' => self::get\_headers($app\_token), |
  |  | 254 | 'body'    => json\_encode($data), |
  |  | 255 | ] |
  |  | 256 | ); |
  |  | 257 |  |
  |  | 258 | if ($response instanceof WP\_Error) { |
  |  | 259 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response); |
  |  | 260 | return false; |
  |  | 261 | } |
  |  | 262 |  |
  |  | 263 | if (409 === $response['response']['code']) { |
  | 255 | 264 |  |
  | 256 | 265 | // Client grant from WP-created client to Management API already exists |
  | 257 | 266 | WP\_Auth0\_ErrorLog::insert\_error( |
  | 258 | 267 | \_\_METHOD\_\_, |
  | 259 |  | sprintf( |
  |  | 268 | esc\_html(sprintf( |
  | 260 | 269 | // translators: placeholders are machine names stored for this WP instance and must be included. |
  | 261 |  | ~~\_\_( 'A client grant for %1$s to %2$s already exists. Make sure this grant at least includes %3$s.', 'wp-auth0'~~ ), |
  | 262 |  | self::get\_connect\_info(~~'client\_id'~~ ), |
  | 263 |  | self::get\_connect\_info(~~'audience'~~ ), |
  | 264 |  | implode(~~', ', self::get\_required\_scopes()~~ ) |
  | 265 |  | ) |
  |  | 270 | esc\_html\_\_('A client grant for %1$s to %2$s already exists. Make sure this grant at least includes %3$s.', 'wp-auth0'), |
  |  | 271 | self::get\_connect\_info('client\_id'), |
  |  | 272 | self::get\_connect\_info('audience'), |
  |  | 273 | implode(', ', self::get\_required\_scopes()) |
  |  | 274 | )) |
  | 266 | 275 | ); |
  | 267 | 276 |  |
  | 268 |  | return json\_decode( $response['body'] ); |
  | 269 |  |  |
  | 270 |  | } elseif ( $response['response']['code'] != 201 ) { |
  | 271 |  |  |
  | 272 |  | WP\_Auth0\_ErrorLog::insert\_error( \_\_METHOD\_\_, $response['body'] ); |
  | 273 |  | return false; |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | return json\_decode( $response['body'] ); |
  |  | 277 | return json\_decode($response['body']); |
  |  | 278 | } elseif ($response['response']['code'] != 201) { |
  |  | 279 |  |
  |  | 280 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 281 | return false; |
  |  | 282 | } |
  |  | 283 |  |
  |  | 284 | return json\_decode($response['body']); |
  | 277 | 285 | } |
  | 278 | 286 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L286) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L294) |  |
  | 286 | 294 | \* @return mixed |
  | 287 | 295 | \*/ |
  | 288 |  | public static function create\_connection( $domain, $app\_token, $payload ) { |
  |  | 296 | public static function create\_connection($domain, $app\_token, $payload) |
  |  | 297 | { |
  | 289 | 298 | $endpoint = "https://$domain/api/v2/connections"; |
  | 290 | 299 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L299) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L308) |  |
  | 299 | 308 | 'method'  => 'POST', |
  | 300 | 309 | 'headers' => $headers, |
  | 301 |  | 'body'    => json\_encode(~~$payload~~ ), |
  | 302 |  | ] |
  | 303 |  | ); |
  | 304 |  |  |
  | 305 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 306 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response~~ ); |
  | 307 |  | return false; |
  | 308 |  | } |
  | 309 |  |  |
  | 310 |  | if (~~$response['response']['code'] != 201~~ ) { |
  | 311 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response['body']~~ ); |
  | 312 |  | return false; |
  | 313 |  | } |
  | 314 |  |  |
  | 315 |  | return json\_decode(~~$response['body']~~ ); |
  |  | 310 | 'body'    => json\_encode($payload), |
  |  | 311 | ] |
  |  | 312 | ); |
  |  | 313 |  |
  |  | 314 | if ($response instanceof WP\_Error) { |
  |  | 315 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response); |
  |  | 316 | return false; |
  |  | 317 | } |
  |  | 318 |  |
  |  | 319 | if ($response['response']['code'] != 201) { |
  |  | 320 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 321 | return false; |
  |  | 322 | } |
  |  | 323 |  |
  |  | 324 | return json\_decode($response['body']); |
  | 316 | 325 | } |
  | 317 | 326 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L326) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L335) |  |
  | 326 | 335 | \* @return array|bool|mixed|object |
  | 327 | 336 | \*/ |
  | 328 |  | public static function search\_connection( $domain, $app\_token, $strategy = null, $name = null ) { |
  |  | 337 | public static function search\_connection($domain, $app\_token, $strategy = null, $name = null) |
  |  | 338 | { |
  | 329 | 339 |  |
  | 330 | 340 | $add\_queries = []; |
  | 331 |  | if (~~$strategy~~ ) { |
  |  | 341 | if ($strategy) { |
  | 332 | 342 | $add\_queries['strategy'] = $strategy; |
  | 333 | 343 | } |
  | 334 | 344 |  |
  | 335 |  | if (~~$name~~ ) { |
  |  | 345 | if ($name) { |
  | 336 | 346 | $add\_queries['name'] = $name; |
  | 337 | 347 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L342) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L352) |  |
  | 342 | 352 |  |
  | 343 | 353 | $response = wp\_remote\_get( |
  | 344 |  | add\_query\_arg(~~$add\_queries, 'https://' . $domain . '/api/v2/connections'~~ ), |
  |  | 354 | add\_query\_arg($add\_queries, 'https://' . $domain . '/api/v2/connections'), |
  | 345 | 355 | [ |
  | 346 | 356 | 'headers' => $headers, |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L348) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L358) |  |
  | 348 | 358 | ); |
  | 349 | 359 |  |
  | 350 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 351 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response~~ ); |
  | 352 |  | return false; |
  | 353 |  | } |
  | 354 |  |  |
  | 355 |  | if (~~$response['response']['code'] != 200~~ ) { |
  | 356 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response['body']~~ ); |
  | 357 |  | return false; |
  | 358 |  | } |
  | 359 |  |  |
  | 360 |  | if (~~$response['response']['code'] >= 300~~ ) { |
  | 361 |  | return false; |
  | 362 |  | } |
  | 363 |  |  |
  | 364 |  | return json\_decode(~~$response['body']~~ ); |
  |  | 360 | if ($response instanceof WP\_Error) { |
  |  | 361 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response); |
  |  | 362 | return false; |
  |  | 363 | } |
  |  | 364 |  |
  |  | 365 | if ($response['response']['code'] != 200) { |
  |  | 366 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 367 | return false; |
  |  | 368 | } |
  |  | 369 |  |
  |  | 370 | if ($response['response']['code'] >= 300) { |
  |  | 371 | return false; |
  |  | 372 | } |
  |  | 373 |  |
  |  | 374 | return json\_decode($response['body']); |
  | 365 | 375 | } |
  | 366 | 376 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L376) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L386) |  |
  | 376 | 386 | \* @return bool|object |
  | 377 | 387 | \*/ |
  | 378 |  | public static function update\_connection( $domain, $app\_token, $id, $payload ) { |
  |  | 388 | public static function update\_connection($domain, $app\_token, $id, $payload) |
  |  | 389 | { |
  | 379 | 390 | $endpoint = "https://$domain/api/v2/connections/$id"; |
  | 380 | 391 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L384) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L395) |  |
  | 384 | 395 | $headers['content-type']  = 'application/json'; |
  | 385 | 396 |  |
  | 386 |  | unset(~~$payload->name~~ ); |
  | 387 |  | unset(~~$payload->strategy~~ ); |
  | 388 |  | unset(~~$payload->id~~ ); |
  | 389 |  |  |
  | 390 |  | if (~~! empty( $payload->enabled\_clients )~~ ) { |
  | 391 |  | $payload->enabled\_clients = array\_values(~~$payload->enabled\_clients~~ ); |
  |  | 397 | unset($payload->name); |
  |  | 398 | unset($payload->strategy); |
  |  | 399 | unset($payload->id); |
  |  | 400 |  |
  |  | 401 | if (!empty($payload->enabled\_clients)) { |
  |  | 402 | $payload->enabled\_clients = array\_values($payload->enabled\_clients); |
  | 392 | 403 | } |
  | 393 | 404 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L397) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L408) |  |
  | 397 | 408 | 'method'  => 'PATCH', |
  | 398 | 409 | 'headers' => $headers, |
  | 399 |  | 'body'    => json\_encode(~~$payload~~ ), |
  | 400 |  | ] |
  | 401 |  | ); |
  | 402 |  |  |
  | 403 |  | if (~~$response instanceof WP\_Error~~ ) { |
  | 404 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response~~ ); |
  | 405 |  | return false; |
  | 406 |  | } |
  | 407 |  |  |
  | 408 |  | if (~~$response['response']['code'] != 200~~ ) { |
  | 409 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_, $response['body']~~ ); |
  | 410 |  | return false; |
  | 411 |  | } |
  | 412 |  |  |
  | 413 |  | if (~~$response['response']['code'] >= 300~~ ) { |
  | 414 |  | return false; |
  | 415 |  | } |
  | 416 |  |  |
  | 417 |  | return json\_decode(~~$response['body']~~ ); |
  |  | 410 | 'body'    => json\_encode($payload), |
  |  | 411 | ] |
  |  | 412 | ); |
  |  | 413 |  |
  |  | 414 | if ($response instanceof WP\_Error) { |
  |  | 415 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response); |
  |  | 416 | return false; |
  |  | 417 | } |
  |  | 418 |  |
  |  | 419 | if ($response['response']['code'] != 200) { |
  |  | 420 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $response['body']); |
  |  | 421 | return false; |
  |  | 422 | } |
  |  | 423 |  |
  |  | 424 | if ($response['response']['code'] >= 300) { |
  |  | 425 | return false; |
  |  | 426 | } |
  |  | 427 |  |
  |  | 428 | return json\_decode($response['body']); |
  | 418 | 429 | } |
  | 419 | 430 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L423) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L434) |  |
  | 423 | 434 | \* @return array |
  | 424 | 435 | \*/ |
  | 425 |  | public static function ConsentRequiredScopes() { |
  |  | 436 | public static function ConsentRequiredScopes() |
  |  | 437 | { |
  | 426 | 438 | return [ |
  | 427 | 439 | 'create:clients', |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=2271973#L440) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Client.php?rev=3114611#L452) |  |
  | 440 | 452 | \* @return array |
  | 441 | 453 | \*/ |
  | 442 |  | public static function get\_client\_grant\_types() { |
  |  | 454 | public static function get\_client\_grant\_types() |
  |  | 455 | { |
  | 443 | 456 |  |
  | 444 | 457 | return [ |
* ## [auth0/trunk/lib/WP\_Auth0\_Api\_Operations.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Api_Operations.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Api_Operations.php")

  | [r2271973](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | class WP\_Auth0\_Api\_Operations { |
  |  | 2 | class WP\_Auth0\_Api\_Operations |
  |  | 3 | { |
  | 3 | 4 |  |
  | 4 | 5 | protected $a0\_options; |
  | 5 | 6 |  |
  | 6 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options ) { |
  |  | 7 | public function \_\_construct(WP\_Auth0\_Options $a0\_options) |
  |  | 8 | { |
  | 7 | 9 | $this->a0\_options = $a0\_options; |
  | 8 | 10 | } |
  | 9 | 11 |  |
  | 10 |  | public function create\_wordpress\_connection( $app\_token, $migration\_enabled, $password\_policy = '', $migration\_token = null ) { |
  |  | 12 | public function create\_wordpress\_connection($app\_token, $migration\_enabled, $password\_policy = '', $migration\_token = null) |
  |  | 13 | { |
  | 11 | 14 |  |
  | 12 |  | $domain             = $this->a0\_options->get(~~'domain'~~ ); |
  | 13 |  | $client\_id          = $this->a0\_options->get(~~'client\_id'~~ ); |
  |  | 15 | $domain             = $this->a0\_options->get('domain'); |
  |  | 16 | $client\_id          = $this->a0\_options->get('client\_id'); |
  | 14 | 17 | $db\_connection\_name = 'DB-' . get\_auth0\_curatedBlogName(); |
  | 15 | 18 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=2271973#L25) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=3114611#L28) |  |
  | 25 | 28 | ]; |
  | 26 | 29 |  |
  | 27 |  | if (~~$migration\_enabled~~ ) { |
  |  | 30 | if ($migration\_enabled) { |
  | 28 | 31 |  |
  | 29 | 32 | $ipCheck = new WP\_Auth0\_Ip\_Check(); |
  | 30 |  | $ips     = $ipCheck->get\_ips\_by\_domain(~~$domain~~ ); |
  |  | 33 | $ips     = $ipCheck->get\_ips\_by\_domain($domain); |
  | 31 | 34 |  |
  | 32 |  | if (~~$ips~~ ) { |
  | 33 |  | $this->a0\_options->set(~~'migration\_ips', $ips~~ ); |
  | 34 |  | $this->a0\_options->set(~~'migration\_ips\_filter', true~~ ); |
  |  | 35 | if ($ips) { |
  |  | 36 | $this->a0\_options->set('migration\_ips', $ips); |
  |  | 37 | $this->a0\_options->set('migration\_ips\_filter', true); |
  | 35 | 38 | } else { |
  | 36 |  | $this->a0\_options->set(~~'migration\_ips', null~~ ); |
  | 37 |  | $this->a0\_options->set(~~'migration\_ips\_filter', false~~ ); |
  |  | 39 | $this->a0\_options->set('migration\_ips', null); |
  |  | 40 | $this->a0\_options->set('migration\_ips\_filter', false); |
  | 38 | 41 | } |
  | 39 | 42 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=2271973#L51) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=3114611#L54) |  |
  | 51 | 54 | ], |
  | 52 | 55 | 'customScripts'                => [ |
  | 53 |  | 'login'    => $this->get\_script(~~'login'~~ ), |
  | 54 |  | 'get\_user' => $this->get\_script(~~'get-user'~~ ), |
  |  | 56 | 'login'    => $this->get\_script('login'), |
  |  | 57 | 'get\_user' => $this->get\_script('get-user'), |
  | 55 | 58 | ], |
  | 56 | 59 | 'bareConfiguration'            => [ |
  | 57 |  | 'endpointUrl'    => site\_url(~~'index.php?a0\_action='~~ ), |
  |  | 60 | 'endpointUrl'    => site\_url('index.php?a0\_action='), |
  | 58 | 61 | 'migrationToken' => $migration\_token, |
  | 59 | 62 | 'userNamespace'  => 'DB-' . get\_auth0\_curatedBlogName(), |
  | 60 | 63 | ], |
  | 61 | 64 | ]; |
  | 62 |  |  |
  | 63 | 65 | } |
  | 64 | 66 |  |
  | 65 |  | $this->a0\_options->set(~~'db\_connection\_name', $db\_connection\_name~~ ); |
  |  | 67 | $this->a0\_options->set('db\_connection\_name', $db\_connection\_name); |
  | 66 | 68 |  |
  | 67 |  | $response = WP\_Auth0\_Api\_Client::create\_connection(~~$domain, $app\_token, $body~~ ); |
  |  | 69 | $response = WP\_Auth0\_Api\_Client::create\_connection($domain, $app\_token, $body); |
  | 68 | 70 |  |
  | 69 |  | if (~~$response === false~~ ) { |
  |  | 71 | if ($response === false) { |
  | 70 | 72 | return false; |
  | 71 | 73 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=2271973#L82) | […](/browser/auth0/trunk/lib/WP_Auth0_Api_Operations.php?rev=3114611#L84) |  |
  | 82 | 84 | \* @return string |
  | 83 | 85 | \*/ |
  | 84 |  | protected function get\_script( $name ) { |
  | 85 |  | return (string) file\_get\_contents( WPA0\_PLUGIN\_DIR . 'lib/scripts-js/db-' . $name . '.js' ); |
  |  | 86 | protected function get\_script($name) |
  |  | 87 | { |
  |  | 88 | return (string) file\_get\_contents(WPA0\_PLUGIN\_DIR . 'lib/scripts-js/db-' . $name . '.js'); |
  | 86 | 89 | } |
  | 87 | 90 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_DBManager.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_DBManager.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_DBManager.php")

  | [r2271973](/browser/auth0/trunk/lib/WP_Auth0_DBManager.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_DBManager.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_DBManager { |
  |  | 3 | class WP\_Auth0\_DBManager |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 | 6 | protected $current\_db\_version = null; |
  | 6 | 7 | protected $a0\_options; |
  | 7 | 8 |  |
  | 8 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options ) { |
  |  | 9 | public function \_\_construct(WP\_Auth0\_Options $a0\_options) |
  |  | 10 | { |
  | 9 | 11 | $this->a0\_options = $a0\_options; |
  | 10 | 12 | } |
  | 11 | 13 |  |
  | 12 |  | public function install\_db( $version\_to\_install = null ) { |
  |  | 14 | public function install\_db($version\_to\_install = null) |
  |  | 15 | { |
  | 13 | 16 |  |
  | 14 |  | $current\_ver = (int) get\_option(~~'auth0\_db\_version', 0~~ ); |
  | 15 |  | if (~~$current\_ver === 0~~ ) { |
  | 16 |  | $current\_ver = (int) get\_site\_option(~~'auth0\_db\_version', 0~~ ); |
  |  | 17 | $current\_ver = (int) get\_option('auth0\_db\_version', 0); |
  |  | 18 | if ($current\_ver === 0) { |
  |  | 19 | $current\_ver = (int) get\_site\_option('auth0\_db\_version', 0); |
  | 17 | 20 | } |
  | 18 | 21 |  |
  | 19 |  | if (~~empty( $current\_ver ) || $current\_ver === AUTH0\_DB\_VERSION~~ ) { |
  | 20 |  | update\_option(~~'auth0\_db\_version', AUTH0\_DB\_VERSION~~ ); |
  |  | 22 | if (empty($current\_ver) || $current\_ver === AUTH0\_DB\_VERSION) { |
  |  | 23 | update\_option('auth0\_db\_version', AUTH0\_DB\_VERSION); |
  | 21 | 24 | return; |
  | 22 | 25 | } |
  | 23 | 26 |  |
  | 24 |  | wp\_cache\_set(~~'doing\_db\_update', true, WPA0\_CACHE\_GROUP~~ ); |
  |  | 27 | wp\_cache\_set('doing\_db\_update', true, WPA0\_CACHE\_GROUP); |
  | 25 | 28 |  |
  | 26 | 29 | $options = $this->a0\_options; |
  | 27 | 30 |  |
  | 28 | 31 | // Plugin version < 3.4.0 |
  | 29 |  | if (~~$current\_ver < 15 || 15 === $version\_to\_install~~ ) { |
  | 30 |  | $options->set(~~'cdn\_url', WPA0\_LOCK\_CDN\_URL, false~~ ); |
  | 31 |  | $options->set(~~'cache\_expiration', 1440, false~~ ); |
  |  | 32 | if ($current\_ver < 15 || 15 === $version\_to\_install) { |
  |  | 33 | $options->set('cdn\_url', WPA0\_LOCK\_CDN\_URL, false); |
  |  | 34 | $options->set('cache\_expiration', 1440, false); |
  | 32 | 35 |  |
  | 33 | 36 | // Update Client |
  | 34 |  | if (~~wp\_auth0\_is\_ready()~~ ) { |
  | 35 |  | $options->set(~~'client\_signing\_algorithm', 'HS256', false~~ ); |
  |  | 37 | if (wp\_auth0\_is\_ready()) { |
  |  | 38 | $options->set('client\_signing\_algorithm', 'HS256', false); |
  | 36 | 39 | } |
  | 37 | 40 | } |
  | 38 | 41 |  |
  | 39 | 42 | // Plugin version < 3.5.0 |
  | 40 |  | if (~~$current\_ver < 16 || 16 === $version\_to\_install~~ ) { |
  |  | 43 | if ($current\_ver < 16 || 16 === $version\_to\_install) { |
  | 41 | 44 |  |
  | 42 | 45 | // Update Lock and Auth versions |
  | 43 |  | if (~~'//cdn.auth0.com/js/lock/11.0.0/lock.min.js' === $options->get( 'cdn\_url' )~~ ) { |
  | 44 |  | $options->set(~~'cdn\_url', WPA0\_LOCK\_CDN\_URL, false~~ ); |
  |  | 46 | if ('//cdn.auth0.com/js/lock/11.0.0/lock.min.js' === $options->get('cdn\_url')) { |
  |  | 47 | $options->set('cdn\_url', WPA0\_LOCK\_CDN\_URL, false); |
  | 45 | 48 | } |
  | 46 | 49 | } |
  | 47 | 50 |  |
  | 48 | 51 | // Plugin version < 3.6.0 |
  | 49 |  | if (~~$current\_ver < 18 || 18 === $version\_to\_install~~ ) { |
  |  | 52 | if ($current\_ver < 18 || 18 === $version\_to\_install) { |
  | 50 | 53 |  |
  | 51 | 54 | // Migrate passwordless\_method |
  | 52 |  | if (~~$options->get( 'passwordless\_enabled', false )~~ ) { |
  | 53 |  | $pwl\_method = $options->get(~~'passwordless\_method'~~ ); |
  | 54 |  | switch (~~$pwl\_method~~ ) { |
  |  | 55 | if ($options->get('passwordless\_enabled', false)) { |
  |  | 56 | $pwl\_method = $options->get('passwordless\_method'); |
  |  | 57 | switch ($pwl\_method) { |
  | 55 | 58 |  |
  | 56 |  | // SMS passwordless just needs 'sms' as a connection |
  |  | 59 | // SMS passwordless just needs 'sms' as a connection |
  | 57 | 60 | case 'sms': |
  | 58 |  | $options->set(~~'lock\_connections', 'sms', false~~ ); |
  |  | 61 | $options->set('lock\_connections', 'sms', false); |
  | 59 | 62 | break; |
  | 60 | 63 |  |
  | 61 |  | // Social + SMS means there are existing social connections we want to keep |
  |  | 64 | // Social + SMS means there are existing social connections we want to keep |
  | 62 | 65 | case 'socialOrSms': |
  | 63 |  | $options->add\_lock\_connection(~~'sms'~~ ); |
  |  | 66 | $options->add\_lock\_connection('sms'); |
  | 64 | 67 | break; |
  | 65 | 68 |  |
  | 66 |  | // Email link passwordless just needs 'email' as a connection |
  |  | 69 | // Email link passwordless just needs 'email' as a connection |
  | 67 | 70 | case 'emailcode': |
  | 68 | 71 | case 'magiclink': |
  | 69 |  | $options->set(~~'lock\_connections', 'email', false~~ ); |
  |  | 72 | $options->set('lock\_connections', 'email', false); |
  | 70 | 73 | break; |
  | 71 | 74 |  |
  | 72 |  | // Social + Email means there are social connections be want to keep |
  |  | 75 | // Social + Email means there are social connections be want to keep |
  | 73 | 76 | case 'socialOrMagiclink': |
  | 74 | 77 | case 'socialOrEmailcode': |
  | 75 |  | $options->add\_lock\_connection(~~'email'~~ ); |
  |  | 78 | $options->add\_lock\_connection('email'); |
  | 76 | 79 | break; |
  | 77 | 80 | } |
  | 78 | 81 |  |
  | 79 | 82 | // Need to set a special passwordlessMethod flag if using email code |
  | 80 |  | $lock\_json                               = trim(~~$options->get( 'extra\_conf' )~~ ); |
  | 81 |  | $lock\_json\_decoded                       = !~~empty( $lock\_json ) ? json\_decode( $lock\_json, true~~ ) : []; |
  | 82 |  | $lock\_json\_decoded['passwordlessMethod'] = strpos(~~$pwl\_method, 'code'~~ ) ? 'code' : 'link'; |
  | 83 |  | $options->set(~~'extra\_conf', json\_encode( $lock\_json\_decoded ), false~~ ); |
  |  | 83 | $lock\_json                               = trim($options->get('extra\_conf')); |
  |  | 84 | $lock\_json\_decoded                       = !empty($lock\_json) ? json\_decode($lock\_json, true) : []; |
  |  | 85 | $lock\_json\_decoded['passwordlessMethod'] = strpos($pwl\_method, 'code') ? 'code' : 'link'; |
  |  | 86 | $options->set('extra\_conf', json\_encode($lock\_json\_decoded), false); |
  | 84 | 87 | } |
  | 85 | 88 |  |
  | 86 |  | $options->remove(~~'passwordless\_method'~~ ); |
  |  | 89 | $options->remove('passwordless\_method'); |
  | 87 | 90 | } |
  | 88 | 91 |  |
  | 89 | 92 | // 3.9.0 |
  | 90 |  | if (~~$current\_ver < 20 || 20 === $version\_to\_install~~ ) { |
  |  | 93 | if ($current\_ver < 20 || 20 === $version\_to\_install) { |
  | 91 | 94 |  |
  | 92 | 95 | // Remove default IP addresses from saved field. |
  | 93 |  | $migration\_ips = trim(~~$options->get( 'migration\_ips' )~~ ); |
  | 94 |  | if (~~$migration\_ips~~ ) { |
  | 95 |  | $migration\_ips = array\_map(~~'trim', explode( ',', $migration\_ips )~~ ); |
  | 96 |  | $ip\_check      = new WP\_Auth0\_Ip\_Check(~~$options~~ ); |
  | 97 |  | $default\_ips   = explode(~~',', $ip\_check->get\_ips\_by\_domain()~~ ); |
  | 98 |  | $custom\_ips    = array\_diff(~~$migration\_ips, $default\_ips~~ ); |
  | 99 |  | $options->set(~~'migration\_ips', implode( ',', $custom\_ips ), false~~ ); |
  |  | 96 | $migration\_ips = trim($options->get('migration\_ips')); |
  |  | 97 | if ($migration\_ips) { |
  |  | 98 | $migration\_ips = array\_map('trim', explode(',', $migration\_ips)); |
  |  | 99 | $ip\_check      = new WP\_Auth0\_Ip\_Check($options); |
  |  | 100 | $default\_ips   = explode(',', $ip\_check->get\_ips\_by\_domain()); |
  |  | 101 | $custom\_ips    = array\_diff($migration\_ips, $default\_ips); |
  |  | 102 | $options->set('migration\_ips', implode(',', $custom\_ips), false); |
  | 100 | 103 | } |
  | 101 | 104 | } |
  | 102 | 105 |  |
  | 103 | 106 | // 3.10.0 |
  | 104 |  | if (~~$current\_ver < 21 || 21 === $version\_to\_install~~ ) { |
  |  | 107 | if ($current\_ver < 21 || 21 === $version\_to\_install) { |
  | 105 | 108 |  |
  | 106 |  | if (~~'https://cdn.auth0.com/js/lock/11.5/lock.min.js' === $options->get( 'cdn\_url' )~~ ) { |
  | 107 |  | $options->set(~~'cdn\_url', WPA0\_LOCK\_CDN\_URL, false~~ ); |
  | 108 |  | $options->set(~~'custom\_cdn\_url', false, false~~ ); |
  |  | 109 | if ('https://cdn.auth0.com/js/lock/11.5/lock.min.js' === $options->get('cdn\_url')) { |
  |  | 110 | $options->set('cdn\_url', WPA0\_LOCK\_CDN\_URL, false); |
  |  | 111 | $options->set('custom\_cdn\_url', false, false); |
  | 109 | 112 | } else { |
  | 110 |  | $options->set(~~'custom\_cdn\_url', true, false~~ ); |
  |  | 113 | $options->set('custom\_cdn\_url', true, false); |
  | 111 | 114 | } |
  | 112 | 115 |  |
  | 113 | 116 | // Nullify and delete all removed options. |
  | 114 |  | $options->remove(~~'auth0js-cdn'~~ ); |
  | 115 |  | $options->remove(~~'passwordless\_cdn\_url'~~ ); |
  | 116 |  | $options->remove(~~'cdn\_url\_legacy'~~ ); |
  |  | 117 | $options->remove('auth0js-cdn'); |
  |  | 118 | $options->remove('passwordless\_cdn\_url'); |
  |  | 119 | $options->remove('cdn\_url\_legacy'); |
  | 117 | 120 |  |
  | 118 |  | $options->remove(~~'social\_twitter\_key'~~ ); |
  | 119 |  | $options->remove(~~'social\_twitter\_secret'~~ ); |
  | 120 |  | $options->remove(~~'social\_facebook\_key'~~ ); |
  | 121 |  | $options->remove(~~'social\_facebook\_secret'~~ ); |
  | 122 |  | $options->remove(~~'connections'~~ ); |
  |  | 121 | $options->remove('social\_twitter\_key'); |
  |  | 122 | $options->remove('social\_twitter\_secret'); |
  |  | 123 | $options->remove('social\_facebook\_key'); |
  |  | 124 | $options->remove('social\_facebook\_secret'); |
  |  | 125 | $options->remove('connections'); |
  | 123 | 126 |  |
  | 124 |  | $options->remove(~~'chart\_idp\_type'~~ ); |
  | 125 |  | $options->remove(~~'chart\_gender\_type'~~ ); |
  | 126 |  | $options->remove(~~'chart\_age\_type'~~ ); |
  | 127 |  | $options->remove(~~'chart\_age\_from'~~ ); |
  | 128 |  | $options->remove(~~'chart\_age\_to'~~ ); |
  | 129 |  | $options->remove(~~'chart\_age\_step'~~ ); |
  |  | 127 | $options->remove('chart\_idp\_type'); |
  |  | 128 | $options->remove('chart\_gender\_type'); |
  |  | 129 | $options->remove('chart\_age\_type'); |
  |  | 130 | $options->remove('chart\_age\_from'); |
  |  | 131 | $options->remove('chart\_age\_to'); |
  |  | 132 | $options->remove('chart\_age\_step'); |
  | 130 | 133 |  |
  | 131 | 134 | // Migrate WLE setting |
  | 132 |  | $new\_wle\_value = $options->get(~~'wordpress\_login\_enabled'~~ ) ? 'link' : 'isset'; |
  | 133 |  | $options->set(~~'wordpress\_login\_enabled', $new\_wle\_value, false~~ ); |
  | 134 |  | $options->set(~~'wle\_code', str\_shuffle( uniqid() . uniqid() ), false~~ ); |
  |  | 135 | $new\_wle\_value = $options->get('wordpress\_login\_enabled') ? 'link' : 'isset'; |
  |  | 136 | $options->set('wordpress\_login\_enabled', $new\_wle\_value, false); |
  |  | 137 | $options->set('wle\_code', str\_shuffle(uniqid() . uniqid()), false); |
  | 135 | 138 |  |
  | 136 | 139 | // Remove Client Grant update notifications. |
  | 137 |  | delete\_option(~~'wp\_auth0\_client\_grant\_failed'~~ ); |
  | 138 |  | delete\_option(~~'wp\_auth0\_grant\_types\_failed'~~ ); |
  | 139 |  | delete\_option(~~'wp\_auth0\_client\_grant\_success'~~ ); |
  | 140 |  | delete\_option(~~'wp\_auth0\_grant\_types\_success'~~ ); |
  |  | 140 | delete\_option('wp\_auth0\_client\_grant\_failed'); |
  |  | 141 | delete\_option('wp\_auth0\_grant\_types\_failed'); |
  |  | 142 | delete\_option('wp\_auth0\_client\_grant\_success'); |
  |  | 143 | delete\_option('wp\_auth0\_grant\_types\_success'); |
  | 141 | 144 | } |
  | 142 | 145 |  |
  | 143 | 146 | // 3.11.0 |
  | 144 |  | if (~~$current\_ver < 22 || 22 === $version\_to\_install~~ ) { |
  | 145 |  | $options->remove(~~'social\_big\_buttons'~~ ); |
  |  | 147 | if ($current\_ver < 22 || 22 === $version\_to\_install) { |
  |  | 148 | $options->remove('social\_big\_buttons'); |
  | 146 | 149 | } |
  | 147 | 150 |  |
  | 148 | 151 | // 4.0.0 |
  | 149 |  | if (~~$current\_ver < 23 || 23 === $version\_to\_install~~ ) { |
  | 150 |  | $extra\_conf = json\_decode(~~$options->get( 'extra\_conf' ), true~~ ); |
  | 151 |  | if (~~empty( $extra\_conf )~~ ) { |
  |  | 152 | if ($current\_ver < 23 || 23 === $version\_to\_install) { |
  |  | 153 | $extra\_conf = json\_decode($options->get('extra\_conf'), true); |
  |  | 154 | if (empty($extra\_conf)) { |
  | 152 | 155 | $extra\_conf = []; |
  | 153 | 156 | } |
  | 154 | 157 |  |
  | 155 |  | $language = $options->get(~~'language'~~ ); |
  | 156 |  | if (~~$language~~ ) { |
  |  | 158 | $language = $options->get('language'); |
  |  | 159 | if ($language) { |
  | 157 | 160 | $extra\_conf['language'] = $language; |
  | 158 | 161 | } |
  | 159 |  | $options->remove(~~'language'~~ ); |
  |  | 162 | $options->remove('language'); |
  | 160 | 163 |  |
  | 161 |  | $language\_dict = json\_decode(~~$options->get( 'language\_dictionary' ), true~~ ); |
  | 162 |  | if (~~$language\_dict~~ ) { |
  |  | 164 | $language\_dict = json\_decode($options->get('language\_dictionary'), true); |
  |  | 165 | if ($language\_dict) { |
  | 163 | 166 | $extra\_conf['languageDictionary'] = $language\_dict; |
  | 164 | 167 | } |
  | 165 |  | $options->remove(~~'language\_dictionary'~~ ); |
  |  | 168 | $options->remove('language\_dictionary'); |
  | 166 | 169 |  |
  | 167 |  | if (~~! empty( $extra\_conf )~~ ) { |
  | 168 |  | $options->set(~~'extra\_conf', wp\_json\_encode( $extra\_conf )~~ ); |
  |  | 170 | if (!empty($extra\_conf)) { |
  |  | 171 | $options->set('extra\_conf', wp\_json\_encode($extra\_conf)); |
  | 169 | 172 | } |
  | 170 | 173 |  |
  | 171 |  | $options->remove(~~'jwt\_auth\_integration'~~ ); |
  | 172 |  | $options->remove(~~'link\_auth0\_users'~~ ); |
  | 173 |  | $options->remove(~~'custom\_css'~~ ); |
  | 174 |  | $options->remove(~~'custom\_js'~~ ); |
  | 175 |  | $options->remove(~~'auth0\_implicit\_workflow'~~ ); |
  | 176 |  | $options->remove(~~'client\_secret\_b64\_encoded'~~ ); |
  | 177 |  | $options->remove(~~'custom\_signup\_fields'~~ ); |
  | 178 |  | $options->remove(~~'migration\_token\_id'~~ ); |
  |  | 174 | $options->remove('jwt\_auth\_integration'); |
  |  | 175 | $options->remove('link\_auth0\_users'); |
  |  | 176 | $options->remove('custom\_css'); |
  |  | 177 | $options->remove('custom\_js'); |
  |  | 178 | $options->remove('auth0\_implicit\_workflow'); |
  |  | 179 | $options->remove('client\_secret\_b64\_encoded'); |
  |  | 180 | $options->remove('custom\_signup\_fields'); |
  |  | 181 | $options->remove('migration\_token\_id'); |
  | 179 | 182 | } |
  | 180 | 183 |  |
  | 181 | 184 | $options->update\_all(); |
  | 182 |  | update\_option(~~'auth0\_db\_version', AUTH0\_DB\_VERSION~~ ); |
  | 183 |  | wp\_cache\_set(~~'doing\_db\_update', false, WPA0\_CACHE\_GROUP~~ ); |
  |  | 185 | update\_option('auth0\_db\_version', AUTH0\_DB\_VERSION); |
  |  | 186 | wp\_cache\_set('doing\_db\_update', false, WPA0\_CACHE\_GROUP); |
  | 184 | 187 | } |
  | 185 | 188 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Email\_Verification.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Email_Verification.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Email_Verification.php")

  | [r2271973](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Email\_Verification |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=2271973#L11) | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Email\_Verification. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Email\_Verification { |
  |  | 14 | class WP\_Auth0\_Email\_Verification |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | const RESEND\_NONCE\_ACTION = 'auth0\_resend\_verification\_email'; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=2271973#L20) | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=3114611#L22) |  |
  | 20 | 22 | \* @param object $userinfo - User profile object returned from Auth0. |
  | 21 | 23 | \*/ |
  | 22 |  | public static function render\_die( $userinfo ) { |
  | 23 |  | $user\_id = isset( $userinfo->user\_id ) ? $userinfo->user\_id : $userinfo->sub; |
  |  | 24 | public static function render\_die($userinfo) |
  |  | 25 | { |
  |  | 26 | $user\_id = isset($userinfo->user\_id) ? $userinfo->user\_id : $userinfo->sub; |
  | 24 | 27 |  |
  | 25 |  | $html = ~~sprintf( '<p>%s</p>', \_\_( 'This site requires a verified email address.', 'wp-auth0' )~~ ); |
  |  | 28 | $html = wp\_kses(sprintf('<p>%s</p>', esc\_html\_\_('This site requires a verified email address.', 'wp-auth0')), ['p' => []]); |
  | 26 | 29 |  |
  | 27 | 30 | // Only provide resend verification link for DB connection users. |
  | 28 |  | if (~~0 === strpos( $user\_id, 'auth0|' )~~ ) { |
  | 29 |  | $html .= sprintf( |
  |  | 31 | if (0 === strpos($user\_id, 'auth0|')) { |
  |  | 32 | $html .= wp\_kses(sprintf( |
  | 30 | 33 | '<p><a id="js-a0-resend-verification" href="#">%s</a></p> |
  | 31 | 34 | <p><a href="%s?%d">%s</a></p> |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=2271973#L33) | […](/browser/auth0/trunk/lib/WP_Auth0_Email_Verification.php?rev=3114611#L36) |  |
  | 33 | 36 | <script src="%s"></script> |
  | 34 | 37 | <script src="%s"></script>', |
  | 35 |  | ~~\_\_( 'Resend verification email.', 'wp-auth0'~~ ), |
  |  | 38 | esc\_html\_\_('Resend verification email.', 'wp-auth0'), |
  | 36 | 39 | wp\_login\_url(), |
  | 37 | 40 | time(), |
  | 38 |  | ~~\_\_( '← Login', 'wp-auth0'~~ ), |
  | 39 |  | esc\_url(~~admin\_url( 'admin-ajax.php' )~~ ), |
  | 40 |  | esc\_js(~~$user\_id~~ ), |
  | 41 |  | esc\_js(~~wp\_create\_nonce( self::RESEND\_NONCE\_ACTION )~~ ), |
  | 42 |  | esc\_js(~~\_\_( 'Something went wrong; please login and try again.', 'wp-auth0' )~~ ), |
  | 43 |  | esc\_js(~~\_\_( 'Email successfully re-sent to ', 'wp-auth0' ) . $userinfo->email~~ ), |
  |  | 41 | esc\_html\_\_('← Login', 'wp-auth0'), |
  |  | 42 | esc\_url(admin\_url('admin-ajax.php')), |
  |  | 43 | esc\_js($user\_id), |
  |  | 44 | esc\_js(wp\_create\_nonce(self::RESEND\_NONCE\_ACTION)), |
  |  | 45 | esc\_js(esc\_html\_\_('Something went wrong; please login and try again.', 'wp-auth0')), |
  |  | 46 | esc\_js(esc\_html\_\_('Email successfully re-sent to ', 'wp-auth0') . $userinfo->email), |
  | 44 | 47 | '//code.jquery.com/jquery-1.12.4.js', |
  | 45 | 48 | WPA0\_PLUGIN\_URL . 'assets/js/die-with-verify-email.js?ver=' . WPA0\_VERSION |
  | 46 |  | ); |
  |  | 49 | ), ['p', 'a' => ['id' => true, 'href' => true], 'script' => ['src' => true]]); |
  | 47 | 50 | } |
  | 48 | 51 |  |
  | 49 |  | $html = apply\_filters( 'auth0\_verify\_email\_page', $html, $userinfo, '' ); |
  | 50 |  | wp\_die( $html ); |
  |  | 52 | $html = apply\_filters('auth0\_verify\_email\_page', $html, $userinfo, ''); |
  |  | 53 |  |
  |  | 54 | wp\_die(wp\_kses($html, ['p' => [], 'a' => ['id' => true, 'href' => true], 'script' => ['src' => true]])); |
  | 51 | 55 | } |
  | 52 | 56 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Embed\_Widget.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Embed_Widget.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Embed_Widget.php")

  | [r2310480](/browser/auth0/trunk/lib/WP_Auth0_Embed_Widget.php?rev=2310480#L1 "Show revision 2310480 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Embed_Widget.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Embed\_Widget extends WP\_Widget { |
  |  | 3 | class WP\_Auth0\_Embed\_Widget extends WP\_Widget |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 |  | function \_\_construct() { |
  |  | 6 | function \_\_construct() |
  |  | 7 | { |
  | 6 | 8 | parent::\_\_construct( |
  | 7 | 9 | $this->getWidgetId(), |
  | 8 | 10 | $this->getWidgetName(), |
  | 9 |  | [~~'description' => $this->getWidgetDescription()~~ ] |
  |  | 11 | ['description' => $this->getWidgetDescription()] |
  | 10 | 12 | ); |
  | 11 | 13 | } |
  | 12 | 14 |  |
  | 13 |  | protected function getWidgetId() { |
  |  | 15 | protected function getWidgetId() |
  |  | 16 | { |
  | 14 | 17 | return 'wp\_auth0\_widget'; |
  | 15 | 18 | } |
  | 16 | 19 |  |
  | 17 |  | protected function getWidgetName() { |
  | 18 |  | return \_\_( 'Auth0 Login', 'wp-auth0' ); |
  |  | 20 | protected function getWidgetName() |
  |  | 21 | { |
  |  | 22 | return esc\_html\_\_('Auth0 Login', 'wp-auth0'); |
  | 19 | 23 | } |
  | 20 | 24 |  |
  | 21 |  | protected function getWidgetDescription() { |
  | 22 |  | return \_\_( 'Shows Auth0 login form in your sidebar', 'wp-auth0' ); |
  |  | 25 | protected function getWidgetDescription() |
  |  | 26 | { |
  |  | 27 | return esc\_html\_\_('Shows Auth0 login form in your sidebar', 'wp-auth0'); |
  | 23 | 28 | } |
  | 24 | 29 |  |
  | 25 |  | protected function showAsModal() { |
  |  | 30 | protected function showAsModal() |
  |  | 31 | { |
  | 26 | 32 | return false; |
  | 27 | 33 | } |
  | 28 | 34 |  |
  | 29 |  | public function form( $instance ) { |
  |  | 35 | public function form($instance) |
  |  | 36 | { |
  | 30 | 37 | wp\_enqueue\_media(); |
  | 31 |  | wp\_enqueue\_script(~~'wpa0\_admin'~~ ); |
  | 32 |  | wp\_enqueue\_style(~~'media'~~ ); |
  |  | 38 | wp\_enqueue\_script('wpa0\_admin'); |
  |  | 39 | wp\_enqueue\_style('media'); |
  | 33 | 40 | require WPA0\_PLUGIN\_DIR . 'templates/a0-widget-setup-form.php'; |
  | 34 | 41 | return 'form'; |
  | 35 | 42 | } |
  | 36 | 43 |  |
  | 37 |  | public function widget( $args, $instance ) { |
  |  | 44 | public function widget($args, $instance) |
  |  | 45 | { |
  | 38 | 46 |  |
  | 39 |  | if (~~wp\_auth0\_is\_ready()~~ ) { |
  |  | 47 | if (wp\_auth0\_is\_ready()) { |
  | 40 | 48 |  |
  | 41 | 49 | $instance['show\_as\_modal']      = $this->showAsModal(); |
  | 42 |  | $instance['modal\_trigger\_name'] = isset(~~$instance['modal\_trigger\_name']~~ ) |
  |  | 50 | $instance['modal\_trigger\_name'] = isset($instance['modal\_trigger\_name']) |
  | 43 | 51 | ? $instance['modal\_trigger\_name'] |
  | 44 |  | : ~~\_\_( 'Login', 'wp-auth0'~~ ); |
  |  | 52 | : esc\_html\_\_('Login', 'wp-auth0'); |
  | 45 | 53 |  |
  | 46 |  | if (~~! isset( $instance['redirect\_to'] ) || empty( $instance['redirect\_to'] )~~ ) { |
  |  | 54 | if (!isset($instance['redirect\_to']) || empty($instance['redirect\_to'])) { |
  | 47 | 55 | // Null coalescing validates the input variable. |
  | 48 | 56 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 49 |  | $instance['redirect\_to'] = home\_url(~~$\_SERVER['REQUEST\_URI'] ?? ''~~ ); |
  |  | 57 | $instance['redirect\_to'] = home\_url($\_SERVER['REQUEST\_URI'] ?? ''); |
  | 50 | 58 | } |
  | 51 | 59 |  |
  | 52 |  | echo $args['before\_widget']; |
  | 53 |  | \WP\_Auth0\_Lock::render( false, $instance ); |
  | 54 |  | echo $args['after\_widget']; |
  | 55 |  |  |
  |  | 60 | echo wp\_kses\_post($args['before\_widget']); |
  |  | 61 | \WP\_Auth0\_Lock::render(false, $instance); |
  |  | 62 | echo wp\_kses\_post($args['after\_widget']); |
  | 56 | 63 | } else { |
  | 57 |  | ~~\_e( 'Please check your Auth0 configuration', 'wp-auth0'~~ ); |
  |  | 64 | esc\_html\_e('Please check your Auth0 configuration', 'wp-auth0'); |
  | 58 | 65 | } |
  | 59 | 66 | } |
  | 60 | 67 |  |
  | 61 |  | public function update( $new\_instance, $old\_instance ) { |
  | 62 |  | $new\_instance['dict'] = trim( $new\_instance['dict'] ); |
  | 63 |  | if ( $new\_instance['dict'] && json\_decode( $new\_instance['dict'] ) === null ) { |
  |  | 68 | public function update($new\_instance, $old\_instance) |
  |  | 69 | { |
  |  | 70 | $new\_instance['dict'] = trim($new\_instance['dict']); |
  |  | 71 | if ($new\_instance['dict'] && json\_decode($new\_instance['dict']) === null) { |
  | 64 | 72 | $new\_instance['dict'] = $old\_instance['dict']; |
  | 65 | 73 | } |
  | 66 | 74 |  |
  | 67 |  | $new\_instance['extra\_conf'] = trim(~~$new\_instance['extra\_conf']~~ ); |
  | 68 |  | if (~~$new\_instance['extra\_conf'] && json\_decode( $new\_instance['extra\_conf'] ) === null~~ ) { |
  |  | 75 | $new\_instance['extra\_conf'] = trim($new\_instance['extra\_conf']); |
  |  | 76 | if ($new\_instance['extra\_conf'] && json\_decode($new\_instance['extra\_conf']) === null) { |
  | 69 | 77 | $new\_instance['extra\_conf'] = $old\_instance['extra\_conf']; |
  | 70 | 78 | } |
  | 71 | 79 |  |
  | 72 |  | if (~~! empty( $new\_instance['redirect\_to'] )~~ ) { |
  |  | 80 | if (!empty($new\_instance['redirect\_to'])) { |
  | 73 | 81 | $admin\_advanced = new WP\_Auth0\_Admin\_Advanced( |
  | 74 | 82 | WP\_Auth0\_Options::Instance(), |
  | 75 |  | new WP\_Auth0\_Routes(~~WP\_Auth0\_Options::Instance()~~ ) |
  |  | 83 | new WP\_Auth0\_Routes(WP\_Auth0\_Options::Instance()) |
  | 76 | 84 | ); |
  | 77 | 85 |  |
* ## [auth0/trunk/lib/WP\_Auth0\_ErrorLog.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_ErrorLog.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_ErrorLog.php")

  | [r2856828](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L1 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains the WP\_Auth0\_ErrorLog class. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L11) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Handles error log CRUD actions and hooks. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_ErrorLog { |
  |  | 14 | class WP\_Auth0\_ErrorLog |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L33) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L35) |  |
  | 33 | 35 | \* @see WP\_Auth0\_Settings\_Section::init\_menu() |
  | 34 | 36 | \*/ |
  | 35 |  | public function render\_settings\_page() { |
  |  | 37 | public function render\_settings\_page() |
  |  | 38 | { |
  | 36 | 39 | include WPA0\_PLUGIN\_DIR . 'templates/a0-error-log.php'; |
  | 37 | 40 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L42) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L45) |  |
  | 42 | 45 | \* @return array |
  | 43 | 46 | \*/ |
  | 44 |  | public function get() { |
  | 45 |  | $log = get\_option( self::OPTION\_NAME ); |
  |  | 47 | public function get() |
  |  | 48 | { |
  |  | 49 | $log = get\_option(self::OPTION\_NAME); |
  | 46 | 50 |  |
  | 47 |  | if (~~empty( $log )~~ ) { |
  |  | 51 | if (empty($log)) { |
  | 48 | 52 | $log = []; |
  | 49 | 53 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L59) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L63) |  |
  | 59 | 63 | \* @return bool |
  | 60 | 64 | \*/ |
  | 61 |  | public function add( array $new\_entry ) { |
  |  | 65 | public function add(array $new\_entry) |
  |  | 66 | { |
  | 62 | 67 | $log = $this->get(); |
  | 63 | 68 |  |
  | 64 | 69 | // Prepare the last error log entry to compare with the new one. |
  | 65 | 70 | $last\_entry = null; |
  | 66 |  | if (~~! empty( $log )~~ ) { |
  |  | 71 | if (!empty($log)) { |
  | 67 | 72 | // Get the last error logged. |
  | 68 | 73 | $last\_entry = $log[0]; |
  | 69 | 74 |  |
  | 70 | 75 | // Remove date and count fields so it can be compared with the new error. |
  | 71 |  | $last\_entry = array\_diff\_key(~~$last\_entry, array\_flip( [ 'date', 'count' ] )~~ ); |
  |  | 76 | $last\_entry = array\_diff\_key($last\_entry, array\_flip(['date', 'count'])); |
  | 72 | 77 | } |
  | 73 | 78 |  |
  | 74 |  | if (~~serialize( $last\_entry ) === serialize( $new\_entry )~~ ) { |
  |  | 79 | if (serialize($last\_entry) === serialize($new\_entry)) { |
  | 75 | 80 | // New error and last error are the same so set the current time and increment the counter. |
  | 76 | 81 | $log[0]['date']  = time(); |
  | 77 |  | $log[0]['count'] = isset(~~$log[0]['count'] ) ? intval( $log[0]['count']~~ ) + 1 : 2; |
  |  | 82 | $log[0]['count'] = isset($log[0]['count']) ? intval($log[0]['count']) + 1 : 2; |
  | 78 | 83 | } else { |
  | 79 | 84 | // New error is not a repeat to set required fields. |
  | 80 | 85 | $new\_entry['date']  = time(); |
  | 81 | 86 | $new\_entry['count'] = 1; |
  | 82 |  | array\_unshift(~~$log, $new\_entry~~ ); |
  |  | 87 | array\_unshift($log, $new\_entry); |
  | 83 | 88 | } |
  | 84 | 89 |  |
  | 85 |  | return $this->update(~~$log~~ ); |
  |  | 90 | return $this->update($log); |
  | 86 | 91 | } |
  | 87 | 92 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L91) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L96) |  |
  | 91 | 96 | \* @return bool |
  | 92 | 97 | \*/ |
  | 93 |  | public function clear() { |
  | 94 |  | return update\_option( self::OPTION\_NAME, [] ); |
  |  | 98 | public function clear() |
  |  | 99 | { |
  |  | 100 | return update\_option(self::OPTION\_NAME, []); |
  | 95 | 101 | } |
  | 96 | 102 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L100) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L106) |  |
  | 100 | 106 | \* @return bool |
  | 101 | 107 | \*/ |
  | 102 |  | public function delete() { |
  | 103 |  | return delete\_option( self::OPTION\_NAME ); |
  |  | 108 | public function delete() |
  |  | 109 | { |
  |  | 110 | return delete\_option(self::OPTION\_NAME); |
  | 104 | 111 | } |
  | 105 | 112 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L111) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L118) |  |
  | 111 | 118 | \* @return bool |
  | 112 | 119 | \*/ |
  | 113 |  | private function update( array $log ) { |
  | 114 |  | if ( count( $log ) > self::ERROR\_LOG\_ENTRY\_LIMIT ) { |
  | 115 |  | array\_pop( $log ); |
  |  | 120 | private function update(array $log) |
  |  | 121 | { |
  |  | 122 | if (count($log) > self::ERROR\_LOG\_ENTRY\_LIMIT) { |
  |  | 123 | array\_pop($log); |
  | 116 | 124 | } |
  | 117 |  | return update\_option(~~self::OPTION\_NAME, $log~~ ); |
  |  | 125 | return update\_option(self::OPTION\_NAME, $log); |
  | 118 | 126 | } |
  | 119 | 127 |  |
  | 120 |  | public static function check\_is\_disabled() { |
  | 121 |  | $flag = wp\_auth0\_get\_option( 'disable\_logging' ); |
  | 122 |  | if ( is\_bool( $flag ) ) { |
  |  | 128 | public static function check\_is\_disabled() |
  |  | 129 | { |
  |  | 130 | $flag = wp\_auth0\_get\_option('disable\_logging'); |
  |  | 131 | if (is\_bool($flag)) { |
  | 123 | 132 | return $flag; |
  | 124 | 133 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L134) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L143) |  |
  | 134 | 143 | \* @return bool |
  | 135 | 144 | \*/ |
  | 136 |  | public static function insert\_error( $section, $error ) { |
  |  | 145 | public static function insert\_error($section, $error) |
  |  | 146 | { |
  | 137 | 147 |  |
  | 138 |  | if (~~self::check\_is\_disabled()~~ ) { |
  |  | 148 | if (self::check\_is\_disabled()) { |
  | 139 | 149 | return false; |
  | 140 | 150 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=2856828#L143) | […](/browser/auth0/trunk/lib/WP_Auth0_ErrorLog.php?rev=3114611#L153) |  |
  | 143 | 153 | 'section' => $section, |
  | 144 | 154 | 'code'    => 'unknown\_code', |
  | 145 |  | 'message' => ~~\_\_( 'Unknown error message', 'wp-auth0'~~ ), |
  |  | 155 | 'message' => esc\_html\_\_('Unknown error message', 'wp-auth0'), |
  | 146 | 156 | ]; |
  | 147 | 157 |  |
  | 148 |  | if (~~$error instanceof WP\_Error~~ ) { |
  |  | 158 | if ($error instanceof WP\_Error) { |
  | 149 | 159 | $new\_entry['code']    = $error->get\_error\_code(); |
  | 150 | 160 | $new\_entry['message'] = $error->get\_error\_message(); |
  | 151 |  | } elseif (~~$error instanceof Exception~~ ) { |
  |  | 161 | } elseif ($error instanceof Exception) { |
  | 152 | 162 | $new\_entry['code']    = $error->getCode(); |
  | 153 | 163 | $new\_entry['message'] = $error->getMessage(); |
  | 154 |  | } elseif (~~is\_array( $error ) && ! empty( $error['response'] )~~ ) { |
  | 155 |  | if (~~! empty( $error['response']['code'] )~~ ) { |
  | 156 |  | $new\_entry['code'] = sanitize\_text\_field(~~$error['response']['code']~~ ); |
  |  | 164 | } elseif (is\_array($error) && !empty($error['response'])) { |
  |  | 165 | if (!empty($error['response']['code'])) { |
  |  | 166 | $new\_entry['code'] = sanitize\_text\_field($error['response']['code']); |
  | 157 | 167 | } |
  | 158 |  | if (~~! empty( $error['response']['message'] )~~ ) { |
  | 159 |  | $new\_entry['message'] = sanitize\_text\_field(~~$error['response']['message']~~ ); |
  |  | 168 | if (!empty($error['response']['message'])) { |
  |  | 169 | $new\_entry['message'] = sanitize\_text\_field($error['response']['message']); |
  | 160 | 170 | } |
  | 161 | 171 | } else { |
  | 162 |  | $new\_entry['message'] = is\_object(~~$error ) || is\_array( $error ) ? serialize( $error~~ ) : $error; |
  |  | 172 | $new\_entry['message'] = is\_object($error) || is\_array($error) ? serialize($error) : $error; |
  | 163 | 173 | } |
  | 164 | 174 |  |
  | 165 |  | do\_action(~~'auth0\_insert\_error', $new\_entry, $error, $section~~ ); |
  | 166 |  | return (~~new self() )->add( $new\_entry~~ ); |
  |  | 175 | do\_action('auth0\_insert\_error', $new\_entry, $error, $section); |
  |  | 176 | return (new self())->add($new\_entry); |
  | 167 | 177 | } |
  | 168 | 178 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Import\_Settings.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Import_Settings.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Import_Settings.php")

  | [r2473902](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Import\_Settings { |
  |  | 3 | class WP\_Auth0\_Import\_Settings |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 | 6 | const IMPORT\_NONCE\_ACTION = 'wp\_auth0\_import\_settings'; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=2473902#L9) | […](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=3114611#L10) |  |
  | 9 | 10 | protected $a0\_options; |
  | 10 | 11 |  |
  | 11 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options ) { |
  |  | 12 | public function \_\_construct(WP\_Auth0\_Options $a0\_options) |
  |  | 13 | { |
  | 12 | 14 | $this->a0\_options = $a0\_options; |
  | 13 | 15 | } |
  | 14 | 16 |  |
  | 15 |  | public function render\_import\_settings\_page() { |
  |  | 17 | public function render\_import\_settings\_page() |
  |  | 18 | { |
  | 16 | 19 | include WPA0\_PLUGIN\_DIR . 'templates/import\_settings.php'; |
  | 17 | 20 | } |
  | 18 | 21 |  |
  | 19 |  | public function import\_settings() { |
  |  | 22 | public function import\_settings() |
  |  | 23 | { |
  | 20 | 24 |  |
  | 21 | 25 | // Null coalescing validates input variable. |
  | 22 | 26 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 23 |  | if (~~! wp\_verify\_nonce( wp\_unslash( $\_POST['\_wpnonce'] ?? '' ), self::IMPORT\_NONCE\_ACTION )~~ ) { |
  | 24 |  | wp\_nonce\_ays(~~self::IMPORT\_NONCE\_ACTION~~ ); |
  |  | 27 | if (!wp\_verify\_nonce(wp\_unslash($\_POST['\_wpnonce'] ?? ''), self::IMPORT\_NONCE\_ACTION)) { |
  |  | 28 | wp\_nonce\_ays(self::IMPORT\_NONCE\_ACTION); |
  | 25 | 29 | } |
  | 26 | 30 |  |
  | 27 |  | if (~~! current\_user\_can( 'manage\_options' )~~ ) { |
  | 28 |  | wp\_die(~~\_\_( 'Unauthorized.', 'wp-auth0' )~~ ); |
  |  | 31 | if (!current\_user\_can('manage\_options')) { |
  |  | 32 | wp\_die(esc\_html\_\_('Unauthorized.', 'wp-auth0')); |
  | 29 | 33 | } |
  | 30 | 34 |  |
  | 31 | 35 | // Null coalescing validates input variable. |
  | 32 | 36 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 33 |  | $settings\_json = trim(~~stripslashes( $\_POST['settings-json'] ?? '' )~~ ); |
  | 34 |  | if (~~empty( $settings\_json )~~ ) { |
  | 35 |  | wp\_safe\_redirect(~~$this->make\_error\_url( \_\_( 'No settings JSON entered.', 'wp-auth0' ) )~~ ); |
  |  | 37 | $settings\_json = trim(stripslashes($\_POST['settings-json'] ?? '')); |
  |  | 38 | if (empty($settings\_json)) { |
  |  | 39 | wp\_safe\_redirect(esc\_url($this->make\_error\_url(esc\_html\_\_('No settings JSON entered.', 'wp-auth0')))); |
  | 36 | 40 | exit; |
  | 37 | 41 | } |
  | 38 | 42 |  |
  | 39 |  | $settings = json\_decode(~~$settings\_json, true~~ ); |
  | 40 |  | if (~~! $settings || ! is\_array( $settings )~~ ) { |
  | 41 |  | wp\_safe\_redirect(~~$this->make\_error\_url( \_\_( 'Settings JSON entered is not valid.', 'wp-auth0' ) )~~ ); |
  |  | 43 | $settings = json\_decode($settings\_json, true); |
  |  | 44 | if (!$settings || !is\_array($settings)) { |
  |  | 45 | wp\_safe\_redirect(esc\_url($this->make\_error\_url(esc\_html\_\_('Settings JSON entered is not valid.', 'wp-auth0')))); |
  | 42 | 46 | exit; |
  | 43 | 47 | } |
  | 44 | 48 |  |
  | 45 | 49 | // Keep original settings keys so we only save imported values. |
  | 46 |  | $settings\_keys = array\_keys(~~$settings~~ ); |
  |  | 50 | $settings\_keys = array\_keys($settings); |
  | 47 | 51 |  |
  | 48 |  | $admin = new WP\_Auth0\_Admin(~~$this->a0\_options, new WP\_Auth0\_Routes( $this->a0\_options )~~ ); |
  |  | 52 | $admin = new WP\_Auth0\_Admin($this->a0\_options, new WP\_Auth0\_Routes($this->a0\_options)); |
  | 49 | 53 |  |
  | 50 | 54 | // Default setting values will be added to the array. |
  | 51 |  | $settings\_validated = $admin->input\_validator(~~$settings~~ ); |
  |  | 55 | $settings\_validated = $admin->input\_validator($settings); |
  | 52 | 56 |  |
  | 53 |  | foreach (~~$settings\_keys as $settings\_key~~ ) { |
  |  | 57 | foreach ($settings\_keys as $settings\_key) { |
  | 54 | 58 | // Invalid settings keys are removed in WP\_Auth0\_Admin::input\_validator(). |
  | 55 |  | if (~~isset( $settings\_validated[ $settings\_key ] )~~ ) { |
  | 56 |  | $this->a0\_options->set(~~$settings\_key, $settings\_validated[ $settings\_key ], false~~ ); |
  |  | 59 | if (isset($settings\_validated[$settings\_key])) { |
  |  | 60 | $this->a0\_options->set($settings\_key, $settings\_validated[$settings\_key], false); |
  | 57 | 61 | } |
  | 58 | 62 | } |
  | 59 | 63 |  |
  | 60 | 64 | $this->a0\_options->update\_all(); |
  | 61 |  | wp\_safe\_redirect(~~admin\_url( 'admin.php?page=wpa0' )~~ ); |
  |  | 65 | wp\_safe\_redirect(admin\_url('admin.php?page=wpa0')); |
  | 62 | 66 | exit; |
  | 63 | 67 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=2473902#L66) | […](/browser/auth0/trunk/lib/WP_Auth0_Import_Settings.php?rev=3114611#L70) |  |
  | 66 | 70 | \* @codeCoverageIgnore |
  | 67 | 71 | \*/ |
  | 68 |  | private function make\_error\_url( $error ) { |
  | 69 |  | return admin\_url( 'admin.php?page=wpa0-import-settings&error=' . rawurlencode( $error ) ); |
  |  | 72 | private function make\_error\_url($error) |
  |  | 73 | { |
  |  | 74 | return admin\_url('admin.php?page=wpa0-import-settings&error=' . rawurlencode($error)); |
  | 70 | 75 | } |
  | 71 | 76 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Ip\_Check.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Ip_Check.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Ip_Check.php")

  | [r2473902](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Ip\_Check. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L12) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Used for checking IP addresses against whitelists and default Auth0 IPs. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Ip\_Check { |
  |  | 15 | class WP\_Auth0\_Ip\_Check |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | const IP\_STRING\_GLUE = ','; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L96) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L98) |  |
  | 96 | 98 | \* @param WP\_Auth0\_Options|null $a0\_options WP\_Auth0\_Options instance. |
  | 97 | 99 | \*/ |
  | 98 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options = null ) { |
  |  | 100 | public function \_\_construct(WP\_Auth0\_Options $a0\_options = null) |
  |  | 101 | { |
  | 99 | 102 | $this->a0\_options = $a0\_options; |
  | 100 | 103 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L108) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L111) |  |
  | 108 | 111 | \* @return string|array |
  | 109 | 112 | \*/ |
  | 110 |  | public function get\_ips\_by\_domain( $domain = null, $glue = self::IP\_STRING\_GLUE ) { |
  | 111 |  | if ( empty( $domain ) ) { |
  | 112 |  | $domain = $this->a0\_options->get( 'domain' ); |
  | 113 |  | } |
  | 114 |  | $region = wp\_auth0\_get\_tenant\_region( $domain ); |
  | 115 |  | return $this->get\_ip\_by\_region( $region, $glue ); |
  |  | 113 | public function get\_ips\_by\_domain($domain = null, $glue = self::IP\_STRING\_GLUE) |
  |  | 114 | { |
  |  | 115 | if (empty($domain)) { |
  |  | 116 | $domain = $this->a0\_options->get('domain'); |
  |  | 117 | } |
  |  | 118 | $region = wp\_auth0\_get\_tenant\_region($domain); |
  |  | 119 | return $this->get\_ip\_by\_region($region, $glue); |
  | 116 | 120 | } |
  | 117 | 121 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L124) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L128) |  |
  | 124 | 128 | \* @return string|array |
  | 125 | 129 | \*/ |
  | 126 |  | public function get\_ip\_by\_region( $region, $glue = self::IP\_STRING\_GLUE ) { |
  | 127 |  | $ip\_addresses = $this->valid\_webtask\_ips[ $region ]; |
  | 128 |  | return is\_null( $glue ) ? $ip\_addresses : implode( $glue, $ip\_addresses ); |
  |  | 130 | public function get\_ip\_by\_region($region, $glue = self::IP\_STRING\_GLUE) |
  |  | 131 | { |
  |  | 132 | $ip\_addresses = $this->valid\_webtask\_ips[$region]; |
  |  | 133 | return is\_null($glue) ? $ip\_addresses : implode($glue, $ip\_addresses); |
  | 129 | 134 | } |
  | 130 | 135 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L134) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L139) |  |
  | 134 | 139 | \* @return string |
  | 135 | 140 | \*/ |
  | 136 |  | protected function get\_request\_ip() { |
  | 137 |  | $valid\_proxy\_ip = $this->a0\_options->get( 'valid\_proxy\_ip' ); |
  |  | 141 | protected function get\_request\_ip() |
  |  | 142 | { |
  |  | 143 | $valid\_proxy\_ip = $this->a0\_options->get('valid\_proxy\_ip'); |
  | 138 | 144 |  |
  | 139 | 145 | // Null coalescing validates the input variable. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L141) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L147) |  |
  | 141 | 147 | $remote\_addr = $\_SERVER['REMOTE\_ADDR'] ?? null; |
  | 142 | 148 |  |
  | 143 |  | if (~~$valid\_proxy\_ip && $remote\_addr === $valid\_proxy\_ip~~ ) { |
  |  | 149 | if ($valid\_proxy\_ip && $remote\_addr === $valid\_proxy\_ip) { |
  | 144 | 150 |  |
  | 145 | 151 | // Null coalescing validates the input variable. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L158) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L164) |  |
  | 158 | 164 | \* @return array |
  | 159 | 165 | \*/ |
  | 160 |  | protected function process\_ip\_list( $ip\_list ) { |
  | 161 |  | $raw = is\_array( $ip\_list ) ? $ip\_list : explode( self::IP\_STRING\_GLUE, $ip\_list ); |
  |  | 166 | protected function process\_ip\_list($ip\_list) |
  |  | 167 | { |
  |  | 168 | $raw = is\_array($ip\_list) ? $ip\_list : explode(self::IP\_STRING\_GLUE, $ip\_list); |
  | 162 | 169 |  |
  | 163 | 170 | $ranges = []; |
  | 164 |  | foreach (~~$raw as $r~~ ) { |
  | 165 |  | $d = explode(~~'-', $r~~ ); |
  | 166 |  |  |
  | 167 |  | if (~~count( $d ) < 2~~ ) { |
  |  | 171 | foreach ($raw as $r) { |
  |  | 172 | $d = explode('-', $r); |
  |  | 173 |  |
  |  | 174 | if (count($d) < 2) { |
  | 168 | 175 | $ranges[] = [ |
  | 169 |  | 'from' => trim(~~$d[0]~~ ), |
  | 170 |  | 'to'   => trim(~~$d[0]~~ ), |
  |  | 176 | 'from' => trim($d[0]), |
  |  | 177 | 'to'   => trim($d[0]), |
  | 171 | 178 | ]; |
  | 172 | 179 | } else { |
  | 173 | 180 | $ranges[] = [ |
  | 174 |  | 'from' => trim(~~$d[0]~~ ), |
  | 175 |  | 'to'   => trim(~~$d[1]~~ ), |
  |  | 181 | 'from' => trim($d[0]), |
  |  | 182 | 'to'   => trim($d[1]), |
  | 176 | 183 | ]; |
  | 177 | 184 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L187) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L194) |  |
  | 187 | 194 | \* @return bool |
  | 188 | 195 | \*/ |
  | 189 |  | public function connection\_is\_valid( $valid\_ips = '' ) { |
  | 190 |  | $valid\_ips   = explode( self::IP\_STRING\_GLUE, $valid\_ips ); |
  | 191 |  | $default\_ips = explode( self::IP\_STRING\_GLUE, $this->get\_ips\_by\_domain() ); |
  | 192 |  | $allowed\_ips = array\_merge( $valid\_ips, $default\_ips ); |
  | 193 |  | $allowed\_ips = array\_unique( $allowed\_ips ); |
  | 194 |  |  |
  | 195 |  | foreach ( $this->process\_ip\_list( $allowed\_ips ) as $range ) { |
  | 196 |  | if ( $this->in\_range( $this->get\_request\_ip(), $range ) ) { |
  |  | 196 | public function connection\_is\_valid($valid\_ips = '') |
  |  | 197 | { |
  |  | 198 | $valid\_ips   = explode(self::IP\_STRING\_GLUE, $valid\_ips); |
  |  | 199 | $default\_ips = explode(self::IP\_STRING\_GLUE, $this->get\_ips\_by\_domain()); |
  |  | 200 | $allowed\_ips = array\_merge($valid\_ips, $default\_ips); |
  |  | 201 | $allowed\_ips = array\_unique($allowed\_ips); |
  |  | 202 |  |
  |  | 203 | foreach ($this->process\_ip\_list($allowed\_ips) as $range) { |
  |  | 204 | if ($this->in\_range($this->get\_request\_ip(), $range)) { |
  | 197 | 205 | return true; |
  | 198 | 206 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=2473902#L210) | […](/browser/auth0/trunk/lib/WP_Auth0_Ip_Check.php?rev=3114611#L218) |  |
  | 210 | 218 | \* @return bool |
  | 211 | 219 | \*/ |
  | 212 |  | private function in\_range( $ip, array $range ) { |
  | 213 |  | $from = ip2long( $range['from'] ); |
  | 214 |  | $to   = ip2long( $range['to'] ); |
  | 215 |  | $ip   = ip2long( $ip ); |
  |  | 220 | private function in\_range($ip, array $range) |
  |  | 221 | { |
  |  | 222 | $from = ip2long($range['from']); |
  |  | 223 | $to   = ip2long($range['to']); |
  |  | 224 | $ip   = ip2long($ip); |
  | 216 | 225 |  |
  | 217 | 226 | return $ip >= $from && $ip <= $to; |
* ## [auth0/trunk/lib/WP\_Auth0\_Lock.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Lock.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Lock.php")

  | [r2599514](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L1 "Show revision 2599514 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Lock { |
  |  | 3 | class WP\_Auth0\_Lock |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 | 6 | const LOCK\_GLOBAL\_JS\_VAR\_NAME = 'wpAuth0LockGlobal'; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L15) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L16) |  |
  | 15 | 16 | \* @param null|WP\_Auth0\_Options $opts WP\_Auth0\_Options instance. |
  | 16 | 17 | \*/ |
  | 17 |  | public function \_\_construct( $extended\_settings = [], $opts = null ) { |
  | 18 |  | $this->wp\_options        = ! empty( $opts ) ? $opts : WP\_Auth0\_Options::Instance(); |
  |  | 18 | public function \_\_construct($extended\_settings = [], $opts = null) |
  |  | 19 | { |
  |  | 20 | $this->wp\_options        = !empty($opts) ? $opts : WP\_Auth0\_Options::Instance(); |
  | 19 | 21 | $this->extended\_settings = $extended\_settings; |
  | 20 | 22 | } |
  | 21 | 23 |  |
  | 22 |  | public function get\_state\_obj( $redirect\_to = null ) { |
  |  | 24 | public function get\_state\_obj($redirect\_to = null) |
  |  | 25 | { |
  | 23 | 26 | // Nonce is not needed here as this is not processing form data. |
  | 24 | 27 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 25 | 28 |  |
  | 26 | 29 | $stateObj = [ |
  | 27 |  | 'interim' => (~~isset( $\_GET['interim-login'] ) && $\_GET['interim-login'] === 1~~ ), |
  |  | 30 | 'interim' => (isset($\_GET['interim-login']) && $\_GET['interim-login'] === 1), |
  | 28 | 31 | 'nonce'   => WP\_Auth0\_State\_Handler::get\_instance()->get\_unique(), |
  | 29 | 32 | ]; |
  | 30 | 33 |  |
  | 31 |  | if (~~! empty( $redirect\_to )~~ ) { |
  | 32 |  | $stateObj['redirect\_to'] = addslashes(~~$redirect\_to~~ ); |
  | 33 |  | } elseif (~~isset( $\_GET['redirect\_to'] )~~ ) { |
  | 34 |  | $stateObj['redirect\_to'] = addslashes(~~sanitize\_text\_field( wp\_unslash( $\_GET['redirect\_to'] ) )~~ ); |
  | 35 |  | } |
  | 36 |  |  |
  | 37 |  | return base64\_encode(~~json\_encode( $stateObj )~~ ); |
  |  | 34 | if (!empty($redirect\_to)) { |
  |  | 35 | $stateObj['redirect\_to'] = addslashes($redirect\_to); |
  |  | 36 | } elseif (isset($\_GET['redirect\_to'])) { |
  |  | 37 | $stateObj['redirect\_to'] = addslashes(sanitize\_text\_field(wp\_unslash($\_GET['redirect\_to']))); |
  |  | 38 | } |
  |  | 39 |  |
  |  | 40 | return base64\_encode(json\_encode($stateObj)); |
  | 38 | 41 |  |
  | 39 | 42 | // phpcs:enable WordPress.Security.NonceVerification.NoNonceVerification |
  | 40 | 43 | } |
  | 41 | 44 |  |
  | 42 |  | protected function \_is\_valid( $array, $key ) { |
  | 43 |  | return isset( $array[ $key ] ) && trim( $array[ $key ] ) !== ''; |
  | 44 |  | } |
  | 45 |  |  |
  | 46 |  | protected function build\_settings( $settings ) { |
  |  | 45 | protected function \_is\_valid($array, $key) |
  |  | 46 | { |
  |  | 47 | return isset($array[$key]) && trim($array[$key]) !== ''; |
  |  | 48 | } |
  |  | 49 |  |
  |  | 50 | protected function build\_settings($settings) |
  |  | 51 | { |
  | 47 | 52 | $options\_obj = []; |
  | 48 | 53 |  |
  | 49 | 54 | // Widget or shortcode languageDictionary. |
  | 50 |  | if (~~! empty( $settings['dict'] )~~ ) { |
  |  | 55 | if (!empty($settings['dict'])) { |
  | 51 | 56 | $options\_obj['languageDictionary'] = $settings['dict']; |
  | 52 | 57 | } |
  | 53 | 58 |  |
  | 54 |  | if (~~isset( $settings['form\_title'] ) && trim( $settings['form\_title'] ) !== ''~~ ) { |
  | 55 |  |  |
  | 56 |  | if (~~! isset( $options\_obj['languageDictionary'] )~~ ) { |
  |  | 59 | if (isset($settings['form\_title']) && trim($settings['form\_title']) !== '') { |
  |  | 60 |  |
  |  | 61 | if (!isset($options\_obj['languageDictionary'])) { |
  | 57 | 62 | $options\_obj['languageDictionary'] = []; |
  | 58 | 63 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L63) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L68) |  |
  | 63 | 68 | $options\_obj['socialButtonStyle'] = 'big'; |
  | 64 | 69 |  |
  | 65 |  | if (~~isset( $settings['gravatar'] ) && '' !== $settings['gravatar'] && empty( $settings['gravatar'] )~~ ) { |
  |  | 70 | if (isset($settings['gravatar']) && '' !== $settings['gravatar'] && empty($settings['gravatar'])) { |
  | 66 | 71 | $options\_obj['avatar'] = null; |
  | 67 | 72 | } |
  | 68 | 73 |  |
  | 69 |  | if (~~! empty( $settings['gravatar'] )~~ ) { |
  |  | 74 | if (!empty($settings['gravatar'])) { |
  | 70 | 75 | $options\_obj['avatar'] = true; |
  | 71 | 76 | } |
  | 72 | 77 |  |
  | 73 |  | if (~~$this->\_is\_valid( $settings, 'username\_style' )~~ ) { |
  |  | 78 | if ($this->\_is\_valid($settings, 'username\_style')) { |
  | 74 | 79 | $options\_obj['usernameStyle'] = $settings['username\_style']; |
  | 75 | 80 | } |
  | 76 | 81 |  |
  | 77 |  | if (~~$this->\_is\_valid( $settings, 'icon\_url' ) || $this->\_is\_valid( $settings, 'primary\_color' )~~ ) { |
  |  | 82 | if ($this->\_is\_valid($settings, 'icon\_url') || $this->\_is\_valid($settings, 'primary\_color')) { |
  | 78 | 83 | $options\_obj['theme'] = []; |
  | 79 |  | if (~~$this->\_is\_valid( $settings, 'icon\_url' )~~ ) { |
  |  | 84 | if ($this->\_is\_valid($settings, 'icon\_url')) { |
  | 80 | 85 | $options\_obj['theme']['logo'] = $settings['icon\_url']; |
  | 81 | 86 | } |
  | 82 |  | if (~~$this->\_is\_valid( $settings, 'primary\_color' )~~ ) { |
  |  | 87 | if ($this->\_is\_valid($settings, 'primary\_color')) { |
  | 83 | 88 | $options\_obj['theme']['primaryColor'] = $settings['primary\_color']; |
  | 84 | 89 | } |
  | 85 | 90 | } |
  | 86 |  | if (~~$this->\_is\_valid( $settings, 'lock\_connections' )~~ ) { |
  |  | 91 | if ($this->\_is\_valid($settings, 'lock\_connections')) { |
  | 87 | 92 | $options\_obj['allowedConnections'] = $this->wp\_options->get\_lock\_connections(); |
  | 88 | 93 | } |
  | 89 |  | if (~~isset( $settings['extra\_conf'] ) && trim( $settings['extra\_conf'] ) !== ''~~ ) { |
  | 90 |  | $extra\_conf\_arr = json\_decode(~~$settings['extra\_conf'], true~~ ); |
  | 91 |  | $options\_obj    = array\_merge\_recursive(~~$extra\_conf\_arr, $options\_obj~~ ); |
  |  | 94 | if (isset($settings['extra\_conf']) && trim($settings['extra\_conf']) !== '') { |
  |  | 95 | $extra\_conf\_arr = json\_decode($settings['extra\_conf'], true); |
  |  | 96 | $options\_obj    = array\_merge\_recursive($extra\_conf\_arr, $options\_obj); |
  | 92 | 97 | } |
  | 93 | 98 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L95) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L100) |  |
  | 95 | 100 | } |
  | 96 | 101 |  |
  | 97 |  | public function get\_lock\_options() { |
  |  | 102 | public function get\_lock\_options() |
  |  | 103 | { |
  | 98 | 104 | $extended\_settings = $this->extended\_settings; |
  | 99 |  | if (~~isset( $extended\_settings['show\_as\_modal'] )~~ ) { |
  | 100 |  | unset(~~$extended\_settings['show\_as\_modal']~~ ); |
  | 101 |  | } |
  | 102 |  | if (~~isset( $extended\_settings['modal\_trigger\_name'] )~~ ) { |
  | 103 |  | unset(~~$extended\_settings['modal\_trigger\_name']~~ ); |
  |  | 105 | if (isset($extended\_settings['show\_as\_modal'])) { |
  |  | 106 | unset($extended\_settings['show\_as\_modal']); |
  |  | 107 | } |
  |  | 108 | if (isset($extended\_settings['modal\_trigger\_name'])) { |
  |  | 109 | unset($extended\_settings['modal\_trigger\_name']); |
  | 104 | 110 | } |
  | 105 | 111 |  |
  | 106 | 112 | $redirect\_to = null; |
  | 107 |  | if (~~isset( $this->extended\_settings['redirect\_to'] )~~ ) { |
  |  | 113 | if (isset($this->extended\_settings['redirect\_to'])) { |
  | 108 | 114 | $redirect\_to = $this->extended\_settings['redirect\_to']; |
  | 109 | 115 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L112) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L118) |  |
  | 112 | 118 | 'auth' => [ |
  | 113 | 119 | 'params' => [ |
  | 114 |  | 'state' => $this->get\_state\_obj(~~$redirect\_to~~ ), |
  | 115 |  | 'scope' => WP\_Auth0\_LoginManager::get\_userinfo\_scope(~~'lock'~~ ), |
  |  | 120 | 'state' => $this->get\_state\_obj($redirect\_to), |
  |  | 121 | 'scope' => WP\_Auth0\_LoginManager::get\_userinfo\_scope('lock'), |
  | 116 | 122 | ], |
  | 117 | 123 | ], |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L120) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L126) |  |
  | 120 | 126 | $extraOptions['auth']['params']['nonce'] = WP\_Auth0\_Nonce\_Handler::get\_instance()->get\_unique(); |
  | 121 | 127 | $extraOptions['auth']['responseType']    = 'code'; |
  | 122 |  | $extraOptions['auth']['redirectUrl']     = $this->wp\_options->get\_wp\_auth0\_url(~~$this->get\_callback\_protocol()~~ ); |
  | 123 |  |  |
  | 124 |  | if (~~$this->wp\_options->get( 'custom\_domain' )~~ ) { |
  |  | 128 | $extraOptions['auth']['redirectUrl']     = $this->wp\_options->get\_wp\_auth0\_url($this->get\_callback\_protocol()); |
  |  | 129 |  |
  |  | 130 | if ($this->wp\_options->get('custom\_domain')) { |
  | 125 | 131 | $extraOptions['configurationBaseUrl'] = sprintf( |
  | 126 | 132 | 'https://%s', |
  | 127 |  | $this->wp\_options->get(~~'custom\_domain'~~ ) |
  |  | 133 | $this->wp\_options->get('custom\_domain') |
  | 128 | 134 | ); |
  | 129 | 135 | } |
  | 130 | 136 |  |
  | 131 |  | $options\_obj       = $this->build\_settings(~~$this->wp\_options->get\_options()~~ ); |
  | 132 |  | $extended\_settings = $this->build\_settings(~~$extended\_settings~~ ); |
  | 133 |  |  |
  | 134 |  | $options\_obj = array\_replace\_recursive(~~$extraOptions, $options\_obj, $extended\_settings~~ ); |
  | 135 |  |  |
  | 136 |  | if (~~! $this->wp\_options->is\_wp\_registration\_enabled() && ! isset( $options\_obj['allowSignUp'] )~~ ) { |
  |  | 137 | $options\_obj       = $this->build\_settings($this->wp\_options->get\_options()); |
  |  | 138 | $extended\_settings = $this->build\_settings($extended\_settings); |
  |  | 139 |  |
  |  | 140 | $options\_obj = array\_replace\_recursive($extraOptions, $options\_obj, $extended\_settings); |
  |  | 141 |  |
  |  | 142 | if (!$this->wp\_options->is\_wp\_registration\_enabled() && !isset($options\_obj['allowSignUp'])) { |
  | 137 | 143 | $options\_obj['allowSignUp'] = false; |
  | 138 | 144 | } |
  | 139 | 145 |  |
  | 140 |  | $show\_as\_modal = isset(~~$this->extended\_settings['show\_as\_modal']~~ ) && $this->extended\_settings['show\_as\_modal']; |
  | 141 |  | if (~~! $show\_as\_modal~~ ) { |
  |  | 146 | $show\_as\_modal = isset($this->extended\_settings['show\_as\_modal']) && $this->extended\_settings['show\_as\_modal']; |
  |  | 147 | if (!$show\_as\_modal) { |
  | 142 | 148 | $options\_obj['container'] = WPA0\_AUTH0\_LOGIN\_FORM\_ID; |
  | 143 | 149 | } |
  | 144 | 150 |  |
  | 145 |  | if (~~! $this->wp\_options->is\_wp\_registration\_enabled()~~ ) { |
  |  | 151 | if (!$this->wp\_options->is\_wp\_registration\_enabled()) { |
  | 146 | 152 | $options\_obj['disableSignupAction'] = true; |
  | 147 | 153 | } |
  | 148 | 154 |  |
  | 149 |  | if (~~wp\_auth0\_is\_current\_login\_action( [ 'register' ] )~~ ) { |
  |  | 155 | if (wp\_auth0\_is\_current\_login\_action(['register'])) { |
  | 150 | 156 | $options\_obj['initialScreen'] = 'signUp'; |
  | 151 | 157 | } |
  | 152 | 158 |  |
  | 153 |  | return apply\_filters(~~'auth0\_lock\_options', $options\_obj~~ ); |
  |  | 159 | return apply\_filters('auth0\_lock\_options', $options\_obj); |
  | 154 | 160 | } |
  | 155 | 161 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L159) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L165) |  |
  | 159 | 165 | \* @return null|string - Returns 'https' if forced, null (use site default) if not. |
  | 160 | 166 | \*/ |
  | 161 |  | private function get\_callback\_protocol() { |
  | 162 |  | return $this->wp\_options->get( 'force\_https\_callback' ) ? 'https' : null; |
  |  | 167 | private function get\_callback\_protocol() |
  |  | 168 | { |
  |  | 169 | return $this->wp\_options->get('force\_https\_callback') ? 'https' : null; |
  | 163 | 170 | } |
  | 164 | 171 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L166) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L173) |  |
  | 166 | 173 | \* Render a link at the bottom of a WordPress core login form back to Lock. |
  | 167 | 174 | \*/ |
  | 168 |  | public static function render\_back\_to\_lock() { |
  | 169 |  | $title = wp\_auth0\_get\_option( 'form\_title' ); |
  | 170 |  | if ( empty( $title ) ) { |
  |  | 175 | public static function render\_back\_to\_lock() |
  |  | 176 | { |
  |  | 177 | $title = wp\_auth0\_get\_option('form\_title'); |
  |  | 178 | if (empty($title)) { |
  | 171 | 179 | $title = 'Auth0'; |
  | 172 | 180 | } |
  | 173 | 181 |  |
  | 174 |  | printf( |
  |  | 182 | echo wp\_kses(sprintf( |
  | 175 | 183 | '<div id="extra-options"><a href="?">%s</a></div>', |
  | 176 | 184 | // translators: The $title variable is the admin-controlled form title. |
  | 177 |  | sanitize\_text\_field(~~sprintf( \_\_( '← Back to %s login', 'wp-auth0' ), $title )~~ ) |
  | 178 |  | ); |
  |  | 185 | sanitize\_text\_field(sprintf(esc\_html\_\_('← Back to %s login', 'wp-auth0'), $title)) |
  |  | 186 | ), ['div' => ['id' => true], 'a' => ['href' => true]]); |
  | 179 | 187 | } |
  | 180 | 188 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L185) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L193) |  |
  | 185 | 193 | \* @param array $specialSettings - Additional settings from widget or shortcode. |
  | 186 | 194 | \*/ |
  | 187 |  | public static function render( $canShowLegacyLogin = true, $specialSettings = [] ) { |
  | 188 |  | if ( is\_user\_logged\_in() ) { |
  |  | 195 | public static function render($canShowLegacyLogin = true, $specialSettings = []) |
  |  | 196 | { |
  |  | 197 | if (is\_user\_logged\_in()) { |
  | 189 | 198 | return; |
  | 190 | 199 | } |
  | 191 | 200 |  |
  | 192 |  | if (~~$canShowLegacyLogin && wp\_auth0\_can\_show\_wp\_login\_form()~~ ) { |
  | 193 |  | add\_action(~~'login\_footer', [ 'WP\_Auth0\_Lock', 'render\_back\_to\_lock' ]~~ ); |
  | 194 |  | add\_action(~~'woocommerce\_after\_customer\_login\_form', [ 'WP\_Auth0\_Lock', 'render\_back\_to\_lock' ]~~ ); |
  |  | 201 | if ($canShowLegacyLogin && wp\_auth0\_can\_show\_wp\_login\_form()) { |
  |  | 202 | add\_action('login\_footer', ['WP\_Auth0\_Lock', 'render\_back\_to\_lock']); |
  |  | 203 | add\_action('woocommerce\_after\_customer\_login\_form', ['WP\_Auth0\_Lock', 'render\_back\_to\_lock']); |
  | 195 | 204 | return; |
  | 196 | 205 | } |
  | 197 | 206 |  |
  | 198 | 207 | $options      = WP\_Auth0\_Options::Instance(); |
  | 199 |  | $lock\_options = new self(~~$specialSettings~~ ); |
  | 200 |  |  |
  | 201 |  | wp\_enqueue\_script(~~'wpa0\_lock', $options->get\_lock\_url(), [ 'jquery' ], null, true~~ ); |
  | 202 |  | wp\_enqueue\_script(~~'js-cookie', WPA0\_PLUGIN\_LIB\_URL . 'js.cookie.min.js', [], '2.2.0', true~~ ); |
  | 203 |  | wp\_enqueue\_script(~~'wpa0\_lock\_init', WPA0\_PLUGIN\_JS\_URL . 'lock-init.js', [ 'jquery' ], WPA0\_VERSION, true~~ ); |
  |  | 208 | $lock\_options = new self($specialSettings); |
  |  | 209 |  |
  |  | 210 | wp\_enqueue\_script('wpa0\_lock', $options->get\_lock\_url(), ['jquery'], WPA0\_VERSION, true); |
  |  | 211 | wp\_enqueue\_script('js-cookie', WPA0\_PLUGIN\_LIB\_URL . 'js.cookie.min.js', [], '2.2.0', true); |
  |  | 212 | wp\_enqueue\_script('wpa0\_lock\_init', WPA0\_PLUGIN\_JS\_URL . 'lock-init.js', ['jquery'], WPA0\_VERSION, true); |
  | 204 | 213 |  |
  | 205 | 214 | wp\_localize\_script( |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L210) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L219) |  |
  | 210 | 219 | 'ready'           => wp\_auth0\_is\_ready(), |
  | 211 | 220 | 'domain'          => $options->get\_auth\_domain(), |
  | 212 |  | 'clientId'        => $options->get(~~'client\_id'~~ ), |
  |  | 221 | 'clientId'        => $options->get('client\_id'), |
  | 213 | 222 | 'stateCookieName' => WP\_Auth0\_State\_Handler::get\_storage\_cookie\_name(), |
  | 214 | 223 | 'nonceCookieName' => WP\_Auth0\_Nonce\_Handler::get\_storage\_cookie\_name(), |
  | 215 |  | 'usePasswordless' => $options->get(~~'passwordless\_enabled'~~ ), |
  |  | 224 | 'usePasswordless' => $options->get('passwordless\_enabled'), |
  | 216 | 225 | 'loginFormId'     => WPA0\_AUTH0\_LOGIN\_FORM\_ID, |
  | 217 |  | 'showAsModal'     => !~~empty( $specialSettings['show\_as\_modal']~~ ), |
  |  | 226 | 'showAsModal'     => !empty($specialSettings['show\_as\_modal']), |
  | 218 | 227 | 'i18n'            => [ |
  | 219 |  | 'notReadyText'       => ~~\_\_( 'Auth0 is not configured', 'wp-auth0'~~ ), |
  | 220 |  | 'cannotFindNodeText' => ~~\_\_( 'Auth0 cannot find node with id ', 'wp-auth0'~~ ), |
  | 221 |  | 'modalButtonText'    => !~~empty( $specialSettings['modal\_trigger\_name']~~ ) |
  | 222 |  | ? sanitize\_text\_field(~~$specialSettings['modal\_trigger\_name']~~ ) |
  | 223 |  | : ~~\_\_( 'Login', 'wp-auth0'~~ ), |
  |  | 228 | 'notReadyText'       => esc\_html\_\_('Auth0 is not configured', 'wp-auth0'), |
  |  | 229 | 'cannotFindNodeText' => esc\_html\_\_('Auth0 cannot find node with id ', 'wp-auth0'), |
  |  | 230 | 'modalButtonText'    => !empty($specialSettings['modal\_trigger\_name']) |
  |  | 231 | ? sanitize\_text\_field($specialSettings['modal\_trigger\_name']) |
  |  | 232 | : esc\_html\_\_('Login', 'wp-auth0'), |
  | 224 | 233 | ], |
  | 225 | 234 | ] |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=2599514#L227) | […](/browser/auth0/trunk/lib/WP_Auth0_Lock.php?rev=3114611#L236) |  |
  | 227 | 236 |  |
  | 228 | 237 | $login\_tpl = WPA0\_PLUGIN\_DIR . 'templates/auth0-login-form.php'; |
  | 229 |  | $login\_tpl = apply\_filters(~~'auth0\_login\_form\_tpl', $login\_tpl, $lock\_options, $canShowLegacyLogin~~ ); |
  |  | 238 | $login\_tpl = apply\_filters('auth0\_login\_form\_tpl', $login\_tpl, $lock\_options, $canShowLegacyLogin); |
  | 230 | 239 | require $login\_tpl; |
  | 231 | 240 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_LoginManager.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_LoginManager.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_LoginManager.php")

  | [r3020639](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* WP\_Auth0\_LoginManager class |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L13) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L14) |  |
  | 13 | 14 | \* @since 2.0.0 |
  | 14 | 15 | \*/ |
  | 15 |  | class WP\_Auth0\_LoginManager { |
  |  | 16 | class WP\_Auth0\_LoginManager |
  |  | 17 | { |
  | 16 | 18 |  |
  | 17 | 19 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L35) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L37) |  |
  | 35 | 37 | \* @param WP\_Auth0\_Options   $a0\_options - see member variable doc comment. |
  | 36 | 38 | \*/ |
  | 37 |  | public function \_\_construct( WP\_Auth0\_UsersRepo $users\_repo, WP\_Auth0\_Options $a0\_options ) { |
  |  | 39 | public function \_\_construct(WP\_Auth0\_UsersRepo $users\_repo, WP\_Auth0\_Options $a0\_options) |
  |  | 40 | { |
  | 38 | 41 | $this->users\_repo = $users\_repo; |
  | 39 | 42 | $this->a0\_options = $a0\_options; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L46) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L49) |  |
  | 46 | 49 | \* @return bool |
  | 47 | 50 | \*/ |
  | 48 |  | public function login\_auto() { |
  |  | 51 | public function login\_auto() |
  |  | 52 | { |
  | 49 | 53 | // Not processing form data, just using a redirect parameter if present. |
  | 50 | 54 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 51 | 55 |  |
  | 52 | 56 | // Do not redirect anywhere if this is a logout action. |
  | 53 |  | if (~~wp\_auth0\_is\_current\_login\_action( [ 'logout' ] )~~ ) { |
  |  | 57 | if (wp\_auth0\_is\_current\_login\_action(['logout'])) { |
  | 54 | 58 | return false; |
  | 55 | 59 | } |
  | 56 | 60 |  |
  | 57 | 61 | // Do not redirect login page override. |
  | 58 |  | if (~~wp\_auth0\_can\_show\_wp\_login\_form()~~ ) { |
  |  | 62 | if (wp\_auth0\_can\_show\_wp\_login\_form()) { |
  | 59 | 63 | return false; |
  | 60 | 64 | } |
  | 61 | 65 |  |
  | 62 | 66 | // If the user has a WP session, determine where they should end up and redirect. |
  | 63 |  | if (~~is\_user\_logged\_in()~~ ) { |
  | 64 |  | if (~~isset($\_REQUEST['reauth']) && $\_REQUEST['reauth']==1~~ ) { |
  |  | 67 | if (is\_user\_logged\_in()) { |
  |  | 68 | if (isset($\_REQUEST['reauth']) && $\_REQUEST['reauth'] == 1) { |
  | 65 | 69 | //  Skip the default login redirection as 'reauth' has been requsted |
  | 66 | 70 | } else { |
  | 67 |  | $login\_redirect = empty(~~$\_REQUEST['redirect\_to']~~ ) ? |
  | 68 |  | $this->a0\_options->get(~~'default\_login\_redirection'~~ ) : |
  | 69 |  | filter\_var(~~wp\_unslash( $\_REQUEST['redirect\_to'] ), FILTER\_SANITIZE\_URL~~ ); |
  |  | 71 | $login\_redirect = empty($\_REQUEST['redirect\_to']) ? |
  |  | 72 | $this->a0\_options->get('default\_login\_redirection') : |
  |  | 73 | filter\_var(wp\_unslash($\_REQUEST['redirect\_to']), FILTER\_SANITIZE\_URL); |
  | 70 | 74 |  |
  | 71 | 75 | // Add a cache buster to avoid an infinite redirect loop on pages that check for auth. |
  | 72 |  | $login\_redirect = add\_query\_arg(~~time(), '', $login\_redirect~~ ); |
  | 73 |  | wp\_safe\_redirect(~~$login\_redirect~~ ); |
  |  | 76 | $login\_redirect = add\_query\_arg(time(), '', $login\_redirect); |
  |  | 77 | wp\_safe\_redirect($login\_redirect); |
  | 74 | 78 | exit; |
  | 75 | 79 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L77) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L81) |  |
  | 77 | 81 |  |
  | 78 | 82 | // Do not use the ULP if the setting is off or if the plugin is not configured. |
  | 79 |  | if (~~! $this->a0\_options->get( 'auto\_login', false )~~ ) { |
  |  | 83 | if (!$this->a0\_options->get('auto\_login', false)) { |
  | 80 | 84 | return false; |
  | 81 | 85 | } |
  | 82 | 86 |  |
  | 83 |  | $connection  = apply\_filters(~~'auth0\_get\_auto\_login\_connection', $this->a0\_options->get( 'auto\_login\_method' )~~ ); |
  | 84 |  | $auth\_params = self::get\_authorize\_params(~~$connection~~ ); |
  | 85 |  |  |
  | 86 |  | WP\_Auth0\_State\_Handler::get\_instance()->set\_cookie(~~$auth\_params['state']~~ ); |
  | 87 |  | WP\_Auth0\_Nonce\_Handler::get\_instance()->set\_cookie(~~$auth\_params['nonce']~~ ); |
  | 88 |  |  |
  | 89 |  | $auth\_url = self::build\_authorize\_url(~~$auth\_params~~ ); |
  | 90 |  |  |
  | 91 |  | wp\_safe\_redirect(~~$auth\_url~~ ); |
  |  | 87 | $connection  = apply\_filters('auth0\_get\_auto\_login\_connection', $this->a0\_options->get('auto\_login\_method')); |
  |  | 88 | $auth\_params = self::get\_authorize\_params($connection); |
  |  | 89 |  |
  |  | 90 | WP\_Auth0\_State\_Handler::get\_instance()->set\_cookie($auth\_params['state']); |
  |  | 91 | WP\_Auth0\_Nonce\_Handler::get\_instance()->set\_cookie($auth\_params['nonce']); |
  |  | 92 |  |
  |  | 93 | $auth\_url = self::build\_authorize\_url($auth\_params); |
  |  | 94 |  |
  |  | 95 | wp\_safe\_redirect($auth\_url); |
  | 92 | 96 | exit; |
  | 93 | 97 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L100) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L104) |  |
  | 100 | 104 | \* Handles errors and state validation |
  | 101 | 105 | \*/ |
  | 102 |  | public function init\_auth0() { |
  |  | 106 | public function init\_auth0() |
  |  | 107 | { |
  | 103 | 108 | // WP nonce is not needed here, nonce and state parameters provide replay and CSRF protection. |
  | 104 | 109 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 105 | 110 |  |
  | 106 |  | set\_query\_var(~~'auth0\_login\_successful', false~~ ); |
  | 107 |  |  |
  | 108 |  | $invitation   = $this->query\_vars(~~'invitation'~~ ); |
  | 109 |  | $organization = $this->query\_vars(~~'organization'~~ ); |
  | 110 |  |  |
  | 111 |  | if (~~$invitation && $organization~~ ) { |
  | 112 |  | $connection  = apply\_filters(~~'auth0\_get\_auto\_login\_connection', $this->a0\_options->get( 'auto\_login\_method' )~~ ); |
  | 113 |  | $auth\_params = self::get\_authorize\_params(~~$connection~~ ); |
  | 114 |  |  |
  | 115 |  | WP\_Auth0\_State\_Handler::get\_instance()->set\_cookie(~~$auth\_params['state']~~ ); |
  | 116 |  | WP\_Auth0\_Nonce\_Handler::get\_instance()->set\_cookie(~~$auth\_params['nonce']~~ ); |
  |  | 111 | set\_query\_var('auth0\_login\_successful', false); |
  |  | 112 |  |
  |  | 113 | $invitation   = $this->query\_vars('invitation'); |
  |  | 114 | $organization = $this->query\_vars('organization'); |
  |  | 115 |  |
  |  | 116 | if ($invitation && $organization) { |
  |  | 117 | $connection  = apply\_filters('auth0\_get\_auto\_login\_connection', $this->a0\_options->get('auto\_login\_method')); |
  |  | 118 | $auth\_params = self::get\_authorize\_params($connection); |
  |  | 119 |  |
  |  | 120 | WP\_Auth0\_State\_Handler::get\_instance()->set\_cookie($auth\_params['state']); |
  |  | 121 | WP\_Auth0\_Nonce\_Handler::get\_instance()->set\_cookie($auth\_params['nonce']); |
  | 117 | 122 |  |
  | 118 | 123 | $auth\_params['invitation'] = $invitation; |
  | 119 | 124 |  |
  | 120 |  | $auth\_url = self::build\_authorize\_url(~~$auth\_params~~ ); |
  | 121 |  |  |
  | 122 |  | wp\_safe\_redirect(~~$auth\_url~~ ); |
  |  | 125 | $auth\_url = self::build\_authorize\_url($auth\_params); |
  |  | 126 |  |
  |  | 127 | wp\_safe\_redirect($auth\_url); |
  | 123 | 128 | exit; |
  | 124 | 129 | } |
  | 125 | 130 |  |
  | 126 |  | $cb\_type = $this->query\_vars(~~'auth0'~~ ); |
  |  | 131 | $cb\_type = $this->query\_vars('auth0'); |
  | 127 | 132 |  |
  | 128 | 133 | // Not an Auth0 login process or settings are not configured to allow logins. |
  | 129 |  | if (~~! $cb\_type || ! wp\_auth0\_is\_ready()~~ ) { |
  |  | 134 | if (!$cb\_type || !wp\_auth0\_is\_ready()) { |
  | 130 | 135 | return false; |
  | 131 | 136 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L133) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L138) |  |
  | 133 | 138 | // Catch any incoming errors and stop the login process. |
  | 134 | 139 | // See https://auth0.com/docs/libraries/error-messages for more info. |
  | 135 |  | if (~~! empty( $\_REQUEST['error'] ) || ! empty( $\_REQUEST['error\_description'] )~~ ) { |
  |  | 140 | if (!empty($\_REQUEST['error']) || !empty($\_REQUEST['error\_description'])) { |
  | 136 | 141 | // Input variable is sanitized. |
  | 137 | 142 | // phpcs:disable WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 138 |  | $error\_msg  = sanitize\_text\_field(~~rawurldecode( wp\_unslash( $\_REQUEST['error\_description'] ) )~~ ); |
  | 139 |  | $error\_code = sanitize\_text\_field(~~rawurldecode( wp\_unslash( $\_REQUEST['error'] ) )~~ ); |
  |  | 143 | $error\_msg  = sanitize\_text\_field(rawurldecode(wp\_unslash($\_REQUEST['error\_description']))); |
  |  | 144 | $error\_code = sanitize\_text\_field(rawurldecode(wp\_unslash($\_REQUEST['error']))); |
  | 140 | 145 | // phpcs:enable WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 141 |  | $this->die\_on\_login(~~$error\_msg, $error\_code~~ ); |
  |  | 146 | $this->die\_on\_login($error\_msg, $error\_code); |
  | 142 | 147 | } |
  | 143 | 148 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L145) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L150) |  |
  | 145 | 150 | // Null coalescing validates; value is checked in validate, not stored or output. |
  | 146 | 151 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 147 |  | $state = wp\_unslash(~~$\_GET['state'] ?? ''~~ ); |
  | 148 |  | if (~~! $state~~ ) { |
  | 149 |  | $this->die\_on\_login(~~\_\_( 'Missing state', 'wp-auth0' )~~ ); |
  | 150 |  | } |
  | 151 |  |  |
  | 152 |  | if (~~! WP\_Auth0\_State\_Handler::get\_instance()->validate( $state )~~ ) { |
  | 153 |  | $this->die\_on\_login(~~\_\_( 'Invalid state', 'wp-auth0' )~~ ); |
  |  | 152 | $state = wp\_unslash($\_GET['state'] ?? ''); |
  |  | 153 | if (!$state) { |
  |  | 154 | $this->die\_on\_login(esc\_html\_\_('Missing state', 'wp-auth0')); |
  |  | 155 | } |
  |  | 156 |  |
  |  | 157 | if (!WP\_Auth0\_State\_Handler::get\_instance()->validate($state)) { |
  |  | 158 | $this->die\_on\_login(esc\_html\_\_('Invalid state', 'wp-auth0')); |
  | 154 | 159 | } |
  | 155 | 160 |  |
  | 156 | 161 | try { |
  | 157 | 162 | $this->redirect\_login(); |
  | 158 |  | } catch (~~WP\_Auth0\_LoginFlowValidationException $e~~ ) { |
  |  | 163 | } catch (WP\_Auth0\_LoginFlowValidationException $e) { |
  | 159 | 164 |  |
  | 160 | 165 | // Errors encountered during the OAuth login flow. |
  | 161 |  | $this->die\_on\_login(~~$e->getMessage(), $e->getCode()~~ ); |
  | 162 |  | } catch (~~WP\_Auth0\_BeforeLoginException $e~~ ) { |
  |  | 166 | $this->die\_on\_login($e->getMessage(), $e->getCode()); |
  |  | 167 | } catch (WP\_Auth0\_BeforeLoginException $e) { |
  | 163 | 168 |  |
  | 164 | 169 | // Errors encountered during the WordPress login flow. |
  | 165 |  | $this->die\_on\_login(~~$e->getMessage(), $e->getCode()~~ ); |
  | 166 |  | } catch (~~WP\_Auth0\_InvalidIdTokenException $e~~ ) { |
  |  | 170 | $this->die\_on\_login($e->getMessage(), $e->getCode()); |
  |  | 171 | } catch (WP\_Auth0\_InvalidIdTokenException $e) { |
  | 167 | 172 | $code            = 'invalid\_id\_token'; |
  | 168 |  | $display\_message = ~~\_\_( 'Invalid ID token', 'wp-auth0'~~ ); |
  |  | 173 | $display\_message = esc\_html\_\_('Invalid ID token', 'wp-auth0'); |
  | 169 | 174 | WP\_Auth0\_ErrorLog::insert\_error( |
  | 170 | 175 | \_\_METHOD\_\_ . ' L:' . \_\_LINE\_\_, |
  | 171 |  | new WP\_Error(~~$code, $display\_message . ': ' . $e->getMessage()~~ ) |
  |  | 176 | new WP\_Error($code, $display\_message . ': ' . $e->getMessage()) |
  | 172 | 177 | ); |
  | 173 |  | $this->die\_on\_login(~~$display\_message, $code~~ ); |
  |  | 178 | $this->die\_on\_login($display\_message, $code); |
  | 174 | 179 | } |
  | 175 | 180 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L186) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L191) |  |
  | 186 | 191 | \* @link https://auth0.com/docs/api-auth/tutorials/authorization-code-grant |
  | 187 | 192 | \*/ |
  | 188 |  | public function redirect\_login() { |
  |  | 193 | public function redirect\_login() |
  |  | 194 | { |
  | 189 | 195 |  |
  | 190 | 196 | // Exchange authorization code for tokens. |
  | 191 |  | $exchange\_api       = new WP\_Auth0\_Api\_Exchange\_Code(~~$this->a0\_options, $this->a0\_options->get\_auth\_domain()~~ ); |
  | 192 |  | $exchange\_resp\_body = $exchange\_api->call(~~$this->query\_vars( 'code' )~~ ); |
  | 193 |  |  |
  | 194 |  | if (~~! $exchange\_resp\_body~~ ) { |
  | 195 |  | throw new WP\_Auth0\_LoginFlowValidationException(~~\_\_( 'Error exchanging code', 'wp-auth0' )~~ ); |
  | 196 |  | } |
  | 197 |  |  |
  | 198 |  | $data = json\_decode(~~$exchange\_resp\_body~~ ); |
  | 199 |  |  |
  | 200 |  | $access\_token  = isset(~~$data->access\_token~~ ) ? $data->access\_token : null; |
  |  | 197 | $exchange\_api       = new WP\_Auth0\_Api\_Exchange\_Code($this->a0\_options, $this->a0\_options->get\_auth\_domain()); |
  |  | 198 | $exchange\_resp\_body = $exchange\_api->call($this->query\_vars('code')); |
  |  | 199 |  |
  |  | 200 | if (!$exchange\_resp\_body) { |
  |  | 201 | throw new WP\_Auth0\_LoginFlowValidationException(esc\_html\_\_('Error exchanging code', 'wp-auth0')); |
  |  | 202 | } |
  |  | 203 |  |
  |  | 204 | $data = json\_decode($exchange\_resp\_body); |
  |  | 205 |  |
  |  | 206 | $access\_token  = isset($data->access\_token) ? $data->access\_token : null; |
  | 201 | 207 | $id\_token      = $data->id\_token; |
  | 202 |  | $refresh\_token = isset(~~$data->refresh\_token~~ ) ? $data->refresh\_token : null; |
  |  | 208 | $refresh\_token = isset($data->refresh\_token) ? $data->refresh\_token : null; |
  | 203 | 209 |  |
  | 204 | 210 | // Decode the incoming ID token for the Auth0 user. |
  | 205 |  | $decoded\_token = $this->decode\_id\_token(~~$id\_token~~ ); |
  |  | 211 | $decoded\_token = $this->decode\_id\_token($id\_token); |
  | 206 | 212 |  |
  | 207 | 213 | // Attempt to authenticate with the Management API, if allowed. |
  | 208 | 214 | $userinfo = null; |
  | 209 |  | if (~~apply\_filters( 'auth0\_use\_management\_api\_for\_userinfo', true )~~ ) { |
  | 210 |  | $cc\_api        = new WP\_Auth0\_Api\_Client\_Credentials(~~$this->a0\_options~~ ); |
  | 211 |  | $get\_user\_api  = new WP\_Auth0\_Api\_Get\_User(~~$this->a0\_options, $cc\_api~~ ); |
  | 212 |  | $get\_user\_resp = $get\_user\_api->call(~~$decoded\_token->sub~~ ); |
  | 213 |  | $userinfo      = !~~empty( $get\_user\_resp ) ? json\_decode( $get\_user\_resp~~ ) : null; |
  |  | 215 | if (apply\_filters('auth0\_use\_management\_api\_for\_userinfo', true)) { |
  |  | 216 | $cc\_api        = new WP\_Auth0\_Api\_Client\_Credentials($this->a0\_options); |
  |  | 217 | $get\_user\_api  = new WP\_Auth0\_Api\_Get\_User($this->a0\_options, $cc\_api); |
  |  | 218 | $get\_user\_resp = $get\_user\_api->call($decoded\_token->sub); |
  |  | 219 | $userinfo      = !empty($get\_user\_resp) ? json\_decode($get\_user\_resp) : null; |
  | 214 | 220 | } |
  | 215 | 221 |  |
  | 216 | 222 | // Management API call failed, fallback to ID token. |
  | 217 |  | if (~~! $userinfo~~ ) { |
  | 218 |  | $userinfo = $this->clean\_id\_token(~~$decoded\_token~~ ); |
  |  | 223 | if (!$userinfo) { |
  |  | 224 | $userinfo = $this->clean\_id\_token($decoded\_token); |
  | 219 | 225 | } |
  | 220 | 226 |  |
  | 221 | 227 | // Populate sub property, if not provided. |
  | 222 |  | if (~~! isset( $userinfo->sub )~~ ) { |
  |  | 228 | if (!isset($userinfo->sub)) { |
  | 223 | 229 | $userinfo->sub = $userinfo->user\_id; |
  | 224 | 230 | } |
  | 225 | 231 |  |
  | 226 |  | if (~~$this->login\_user( $userinfo, $id\_token, $access\_token, $refresh\_token )~~ ) { |
  |  | 232 | if ($this->login\_user($userinfo, $id\_token, $access\_token, $refresh\_token)) { |
  | 227 | 233 | $state\_decoded = $this->get\_state(); |
  | 228 |  | if (~~! empty( $state\_decoded->interim )~~ ) { |
  |  | 234 | if (!empty($state\_decoded->interim)) { |
  | 229 | 235 | include WPA0\_PLUGIN\_DIR . 'templates/login-interim.php'; |
  | 230 | 236 | } else { |
  | 231 |  | if (~~! empty( $state\_decoded->redirect\_to ) && wp\_login\_url() !== $state\_decoded->redirect\_to~~ ) { |
  |  | 237 | if (!empty($state\_decoded->redirect\_to) && wp\_login\_url() !== $state\_decoded->redirect\_to) { |
  | 232 | 238 | $redirect\_url = $state\_decoded->redirect\_to; |
  | 233 | 239 | } else { |
  | 234 |  | $redirect\_url = $this->a0\_options->get(~~'default\_login\_redirection'~~ ); |
  |  | 240 | $redirect\_url = $this->a0\_options->get('default\_login\_redirection'); |
  | 235 | 241 | } |
  | 236 |  | wp\_safe\_redirect(~~$redirect\_url~~ ); |
  |  | 242 | wp\_safe\_redirect($redirect\_url); |
  | 237 | 243 | } |
  | 238 | 244 | exit(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L253) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L259) |  |
  | 253 | 259 | \* @throws WP\_Auth0\_BeforeLoginException - Errors encountered during the auth0\_before\_login action. |
  | 254 | 260 | \*/ |
  | 255 |  | public function login\_user( $userinfo, $id\_token = null, $access\_token = null, $refresh\_token = null ) { |
  |  | 261 | public function login\_user($userinfo, $id\_token = null, $access\_token = null, $refresh\_token = null) |
  |  | 262 | { |
  | 256 | 263 | $auth0\_sub        = $userinfo->sub; |
  | 257 |  | list(~~$strategy ) = explode( '|', $auth0\_sub~~ ); |
  |  | 264 | list($strategy) = explode('|', $auth0\_sub); |
  | 258 | 265 | $user             = null; |
  | 259 | 266 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L261) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L268) |  |
  | 261 | 268 | if ( |
  | 262 | 269 | // Admin settings enforce verified email. |
  | 263 |  | $this->a0\_options->get(~~'requires\_verified\_email'~~ ) && |
  |  | 270 | $this->a0\_options->get('requires\_verified\_email') && |
  | 264 | 271 | // Strategy for the user is not skipped. |
  | 265 |  | !~~$this->a0\_options->strategy\_skips\_verified\_email( $strategy~~ ) |
  |  | 272 | !$this->a0\_options->strategy\_skips\_verified\_email($strategy) |
  | 266 | 273 | ) { |
  | 267 | 274 |  |
  | 268 | 275 | // Email address is empty so cannot proceed. |
  | 269 |  | if (~~empty( $userinfo->email )~~ ) { |
  |  | 276 | if (empty($userinfo->email)) { |
  | 270 | 277 | throw new WP\_Auth0\_LoginFlowValidationException( |
  | 271 |  | ~~\_\_( 'This account does not have an email associated, as required by your site administrator.', 'wp-auth0'~~ ) |
  |  | 278 | esc\_html\_\_('This account does not have an email associated, as required by your site administrator.', 'wp-auth0') |
  | 272 | 279 | ); |
  | 273 | 280 | } |
  | 274 | 281 |  |
  | 275 | 282 | // Die with an action to re-send email verification. |
  | 276 |  | if (~~empty( $userinfo->email\_verified )~~ ) { |
  | 277 |  | WP\_Auth0\_Email\_Verification::render\_die(~~$userinfo~~ ); |
  |  | 283 | if (empty($userinfo->email\_verified)) { |
  |  | 284 | WP\_Auth0\_Email\_Verification::render\_die($userinfo); |
  | 278 | 285 | } |
  | 279 | 286 | } |
  | 280 | 287 |  |
  | 281 | 288 | // See if there is a user linked to the same Auth0 user\_id. |
  | 282 |  | if (~~isset( $userinfo->identities )~~ ) { |
  | 283 |  | foreach (~~$userinfo->identities as $identity~~ ) { |
  | 284 |  | $user = $this->users\_repo->find\_auth0\_user(~~"{$identity->provider}|{$identity->user\_id}"~~ ); |
  | 285 |  | if (~~$user~~ ) { |
  |  | 289 | if (isset($userinfo->identities)) { |
  |  | 290 | foreach ($userinfo->identities as $identity) { |
  |  | 291 | $user = $this->users\_repo->find\_auth0\_user("{$identity->provider}|{$identity->user\_id}"); |
  |  | 292 | if ($user) { |
  | 286 | 293 | break; |
  | 287 | 294 | } |
  | 288 | 295 | } |
  | 289 | 296 | } else { |
  | 290 |  | $user = $this->users\_repo->find\_auth0\_user(~~$auth0\_sub~~ ); |
  | 291 |  | } |
  | 292 |  |  |
  | 293 |  | $user = apply\_filters(~~'auth0\_get\_wp\_user', $user, $userinfo~~ ); |
  | 294 |  |  |
  | 295 |  | if (~~! is\_null( $user )~~ ) { |
  |  | 297 | $user = $this->users\_repo->find\_auth0\_user($auth0\_sub); |
  |  | 298 | } |
  |  | 299 |  |
  |  | 300 | $user = apply\_filters('auth0\_get\_wp\_user', $user, $userinfo); |
  |  | 301 |  |
  |  | 302 | if (!is\_null($user)) { |
  | 296 | 303 | // User exists so log them in. |
  | 297 |  | if (~~isset( $userinfo->email ) && $user->data->user\_email !== $userinfo->email~~ ) { |
  |  | 304 | if (isset($userinfo->email) && $user->data->user\_email !== $userinfo->email) { |
  | 298 | 305 | $description = $user->data->description; |
  | 299 |  | if (~~empty( $description )~~ ) { |
  | 300 |  | if (~~isset( $userinfo->headline )~~ ) { |
  |  | 306 | if (empty($description)) { |
  |  | 307 | if (isset($userinfo->headline)) { |
  | 301 | 308 | $description = $userinfo->headline; |
  | 302 | 309 | } |
  | 303 |  | if (~~isset( $userinfo->description )~~ ) { |
  |  | 310 | if (isset($userinfo->description)) { |
  | 304 | 311 | $description = $userinfo->description; |
  | 305 | 312 | } |
  | 306 |  | if (~~isset( $userinfo->bio )~~ ) { |
  |  | 313 | if (isset($userinfo->bio)) { |
  | 307 | 314 | $description = $userinfo->bio; |
  | 308 | 315 | } |
  | 309 |  | if (~~isset( $userinfo->about )~~ ) { |
  |  | 316 | if (isset($userinfo->about)) { |
  | 310 | 317 | $description = $userinfo->about; |
  | 311 | 318 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L313) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L320) |  |
  | 313 | 320 |  |
  | 314 | 321 | // Temporarily disable the email sync, since the changes are coming from Auth0, no need to update them there. |
  | 315 |  | remove\_action(~~'profile\_update', 'wp\_auth0\_profile\_change\_email', 100~~ ); |
  |  | 322 | remove\_action('profile\_update', 'wp\_auth0\_profile\_change\_email', 100); |
  | 316 | 323 |  |
  | 317 | 324 | wp\_update\_user( |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L324) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L331) |  |
  | 324 | 331 |  |
  | 325 | 332 | // Turn the email sync back on |
  | 326 |  | add\_action(~~'profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2~~ ); |
  |  | 333 | add\_action('profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2); |
  | 327 | 334 | } |
  | 328 | 335 |  |
  | 329 |  | $this->users\_repo->update\_auth0\_object(~~$user->data->ID, $userinfo~~ ); |
  | 330 |  | $user = apply\_filters(~~'auth0\_get\_wp\_user', $user, $userinfo~~ ); |
  | 331 |  | $this->do\_login(~~$user, $userinfo, false, $id\_token, $access\_token, $refresh\_token~~ ); |
  |  | 336 | $this->users\_repo->update\_auth0\_object($user->data->ID, $userinfo); |
  |  | 337 | $user = apply\_filters('auth0\_get\_wp\_user', $user, $userinfo); |
  |  | 338 | $this->do\_login($user, $userinfo, false, $id\_token, $access\_token, $refresh\_token); |
  | 332 | 339 | return true; |
  | 333 | 340 | } else { |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L335) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L342) |  |
  | 335 | 342 | try { |
  | 336 | 343 |  |
  | 337 |  | $creator = new WP\_Auth0\_UsersRepo(~~$this->a0\_options~~ ); |
  | 338 |  | $user\_id = $creator->create(~~$userinfo, $id\_token~~ ); |
  | 339 |  | $user    = get\_user\_by(~~'id', $user\_id~~ ); |
  | 340 |  | $this->do\_login(~~$user, $userinfo, true, $id\_token, $access\_token, $refresh\_token~~ ); |
  | 341 |  | } catch (~~WP\_Auth0\_CouldNotCreateUserException $e~~ ) { |
  | 342 |  |  |
  | 343 |  | throw new WP\_Auth0\_LoginFlowValidationException(~~$e->getMessage()~~ ); |
  | 344 |  | } catch (~~WP\_Auth0\_RegistrationNotEnabledException $e~~ ) { |
  | 345 |  |  |
  | 346 |  | $msg = \_\_( |
  |  | 344 | $creator = new WP\_Auth0\_UsersRepo($this->a0\_options); |
  |  | 345 | $user\_id = $creator->create($userinfo, $id\_token); |
  |  | 346 | $user    = get\_user\_by('id', $user\_id); |
  |  | 347 | $this->do\_login($user, $userinfo, true, $id\_token, $access\_token, $refresh\_token); |
  |  | 348 | } catch (WP\_Auth0\_CouldNotCreateUserException $e) { |
  |  | 349 |  |
  |  | 350 | throw new WP\_Auth0\_LoginFlowValidationException(esc\_html($e->getMessage())); |
  |  | 351 | } catch (WP\_Auth0\_RegistrationNotEnabledException $e) { |
  |  | 352 |  |
  |  | 353 | $msg = esc\_html\_\_( |
  | 347 | 354 | 'Could not create user. The registration process is not available. Please contact your site’s administrator.', |
  | 348 | 355 | 'wp-auth0' |
  | 349 | 356 | ); |
  | 350 |  | throw new WP\_Auth0\_LoginFlowValidationException(~~$msg~~ ); |
  | 351 |  | } catch (~~WP\_Auth0\_EmailNotVerifiedException $e~~ ) { |
  | 352 |  |  |
  | 353 |  | WP\_Auth0\_Email\_Verification::render\_die(~~$e->userinfo~~ ); |
  |  | 357 | throw new WP\_Auth0\_LoginFlowValidationException(esc\_html($msg)); |
  |  | 358 | } catch (WP\_Auth0\_EmailNotVerifiedException $e) { |
  |  | 359 |  |
  |  | 360 | WP\_Auth0\_Email\_Verification::render\_die($e->userinfo); |
  | 354 | 361 | } |
  | 355 | 362 | return true; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L369) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L376) |  |
  | 369 | 376 | \* @throws WP\_Auth0\_BeforeLoginException - Errors encountered during the auth0\_before\_login action. |
  | 370 | 377 | \*/ |
  | 371 |  | private function do\_login( $user, $userinfo, $is\_new, $id\_token, $access\_token, $refresh\_token ) { |
  | 372 |  | $remember\_users\_session = $this->a0\_options->get( 'remember\_users\_session' ); |
  |  | 378 | private function do\_login($user, $userinfo, $is\_new, $id\_token, $access\_token, $refresh\_token) |
  |  | 379 | { |
  |  | 380 | $remember\_users\_session = $this->a0\_options->get('remember\_users\_session'); |
  | 373 | 381 |  |
  | 374 | 382 | try { |
  | 375 |  | do\_action(~~'auth0\_before\_login', $user, $userinfo~~ ); |
  | 376 |  | } catch (~~Exception $e~~ ) { |
  | 377 |  | throw new WP\_Auth0\_BeforeLoginException(~~$e->getMessage()~~ ); |
  | 378 |  | } |
  | 379 |  |  |
  | 380 |  | set\_query\_var(~~'auth0\_login\_successful', true~~ ); |
  |  | 383 | do\_action('auth0\_before\_login', $user, $userinfo); |
  |  | 384 | } catch (Exception $e) { |
  |  | 385 | throw new WP\_Auth0\_BeforeLoginException(esc\_html($e->getMessage())); |
  |  | 386 | } |
  |  | 387 |  |
  |  | 388 | set\_query\_var('auth0\_login\_successful', true); |
  | 381 | 389 |  |
  | 382 | 390 | $secure\_cookie = is\_ssl(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L393) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L401) |  |
  | 393 | 401 | ); |
  | 394 | 402 |  |
  | 395 |  | wp\_set\_auth\_cookie(~~$user->ID, $remember\_users\_session, $secure\_cookie~~ ); |
  | 396 |  | do\_action(~~'wp\_login', $user->user\_login, $user~~ ); |
  | 397 |  | do\_action(~~'auth0\_user\_login', $user->ID, $userinfo, $is\_new, $id\_token, $access\_token, $refresh\_token~~ ); |
  |  | 403 | wp\_set\_auth\_cookie($user->ID, $remember\_users\_session, $secure\_cookie); |
  |  | 404 | do\_action('wp\_login', $user->user\_login, $user); |
  |  | 405 | do\_action('auth0\_user\_login', $user->ID, $userinfo, $is\_new, $id\_token, $access\_token, $refresh\_token); |
  | 398 | 406 | } |
  | 399 | 407 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L407) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L415) |  |
  | 407 | 415 | \* @link https://codex.wordpress.org/Plugin\_API/Action\_Reference/wp\_logout |
  | 408 | 416 | \*/ |
  | 409 |  | public function logout() { |
  | 410 |  | if ( ! wp\_auth0\_is\_ready() ) { |
  |  | 417 | public function logout() |
  |  | 418 | { |
  |  | 419 | if (!wp\_auth0\_is\_ready()) { |
  | 411 | 420 | return; |
  | 412 | 421 | } |
  | 413 | 422 |  |
  | 414 | 423 | // If SLO is in use, redirect to Auth0 to logout there as well. |
  | 415 |  | if (~~$this->a0\_options->get( 'singlelogout' )~~ ) { |
  | 416 |  | $return\_to    = apply\_filters(~~'auth0\_slo\_return\_to', home\_url()~~ ); |
  | 417 |  | $redirect\_url = $this->auth0\_logout\_url(~~$return\_to~~ ); |
  | 418 |  | $redirect\_url = apply\_filters(~~'auth0\_logout\_url', $redirect\_url~~ ); |
  | 419 |  | wp\_safe\_redirect(~~$redirect\_url~~ ); |
  |  | 424 | if ($this->a0\_options->get('singlelogout')) { |
  |  | 425 | $return\_to    = apply\_filters('auth0\_slo\_return\_to', home\_url()); |
  |  | 426 | $redirect\_url = $this->auth0\_logout\_url($return\_to); |
  |  | 427 | $redirect\_url = apply\_filters('auth0\_logout\_url', $redirect\_url); |
  |  | 428 | wp\_safe\_redirect($redirect\_url); |
  | 420 | 429 | exit; |
  | 421 | 430 | } |
  | 422 | 431 |  |
  | 423 | 432 | // If auto-login is in use, cannot redirect back to login page. |
  | 424 |  | if (~~$this->a0\_options->get( 'auto\_login' )~~ ) { |
  | 425 |  | wp\_safe\_redirect(~~home\_url()~~ ); |
  |  | 433 | if ($this->a0\_options->get('auto\_login')) { |
  |  | 434 | wp\_safe\_redirect(home\_url()); |
  | 426 | 435 | exit; |
  | 427 | 436 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L435) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L444) |  |
  | 435 | 444 | \* @return string |
  | 436 | 445 | \*/ |
  | 437 |  | public static function get\_userinfo\_scope( $context = '' ) { |
  | 438 |  | $default\_scope  = [ 'openid', 'email', 'profile' ]; |
  | 439 |  | $filtered\_scope = apply\_filters( 'auth0\_auth\_scope', $default\_scope, $context ); |
  | 440 |  | return implode( ' ', $filtered\_scope ); |
  |  | 446 | public static function get\_userinfo\_scope($context = '') |
  |  | 447 | { |
  |  | 448 | $default\_scope  = ['openid', 'email', 'profile']; |
  |  | 449 | $filtered\_scope = apply\_filters('auth0\_auth\_scope', $default\_scope, $context); |
  |  | 450 | return implode(' ', $filtered\_scope); |
  | 441 | 451 | } |
  | 442 | 452 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L449) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L459) |  |
  | 449 | 459 | \* @return array |
  | 450 | 460 | \*/ |
  | 451 |  | public static function get\_authorize\_params( $connection = null, $redirect\_to = null ) { |
  |  | 461 | public static function get\_authorize\_params($connection = null, $redirect\_to = null) |
  |  | 462 | { |
  | 452 | 463 | // Nonce is not needed here as this is not processing form data. |
  | 453 | 464 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 454 | 465 |  |
  | 455 | 466 | $opts         = WP\_Auth0\_Options::Instance(); |
  | 456 |  | $customParams = trim(~~$opts->get( 'auto\_login\_params' ) ?? ''~~ ); |
  |  | 467 | $customParams = trim($opts->get('auto\_login\_params') ?? ''); |
  | 457 | 468 | $params       = []; |
  | 458 | 469 |  |
  | 459 |  | if (~~$customParams~~ ) { |
  | 460 |  | parse\_str(~~$customParams, $params~~ ); |
  |  | 470 | if ($customParams) { |
  |  | 471 | parse\_str($customParams, $params); |
  | 461 | 472 | } |
  | 462 | 473 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L465) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L476) |  |
  | 465 | 476 | [ |
  | 466 | 477 | 'connection'    => $connection, |
  | 467 |  | 'client\_id'     => $opts->get(~~'client\_id'~~ ), |
  | 468 |  | 'organization'  => $opts->get(~~'organization'~~ ), |
  | 469 |  | 'scope'         => self::get\_userinfo\_scope(~~'authorize\_url'~~ ), |
  |  | 478 | 'client\_id'     => $opts->get('client\_id'), |
  |  | 479 | 'organization'  => $opts->get('organization'), |
  |  | 480 | 'scope'         => self::get\_userinfo\_scope('authorize\_url'), |
  | 470 | 481 | 'nonce'         => WP\_Auth0\_Nonce\_Handler::get\_instance()->get\_unique(), |
  | 471 |  | 'max\_age'       => absint(~~apply\_filters( 'auth0\_jwt\_max\_age', null )~~ ), |
  |  | 482 | 'max\_age'       => absint(apply\_filters('auth0\_jwt\_max\_age', null)), |
  | 472 | 483 | 'response\_type' => 'code', |
  | 473 | 484 | 'response\_mode' => 'query', |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L477) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L488) |  |
  | 477 | 488 |  |
  | 478 | 489 | // Where should the user be redirected after logging in? |
  | 479 |  | if (~~empty( $redirect\_to )~~ ) { |
  | 480 |  | $redirect\_to = empty(~~$\_GET['redirect\_to']~~ ) |
  | 481 |  | ? $opts->get(~~'default\_login\_redirection'~~ ) |
  | 482 |  | : filter\_var(~~wp\_unslash( $\_GET['redirect\_to'] ), FILTER\_SANITIZE\_URL~~ ); |
  | 483 |  | } |
  | 484 |  |  |
  | 485 |  | $filtered\_params = apply\_filters(~~'auth0\_authorize\_url\_params', $params, $connection, $redirect\_to~~ ); |
  |  | 490 | if (empty($redirect\_to)) { |
  |  | 491 | $redirect\_to = empty($\_GET['redirect\_to']) |
  |  | 492 | ? $opts->get('default\_login\_redirection') |
  |  | 493 | : filter\_var(wp\_unslash($\_GET['redirect\_to']), FILTER\_SANITIZE\_URL); |
  |  | 494 | } |
  |  | 495 |  |
  |  | 496 | $filtered\_params = apply\_filters('auth0\_authorize\_url\_params', $params, $connection, $redirect\_to); |
  | 486 | 497 |  |
  | 487 | 498 | // State parameter, checked during login callback. |
  | 488 |  | if (~~empty( $filtered\_params['state'] )~~ ) { |
  |  | 499 | if (empty($filtered\_params['state'])) { |
  | 489 | 500 | $state                    = [ |
  | 490 | 501 | 'interim'     => false, |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L492) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L503) |  |
  | 492 | 503 | 'redirect\_to' => $redirect\_to, |
  | 493 | 504 | ]; |
  | 494 |  | $filtered\_state           = apply\_filters(~~'auth0\_authorize\_state', $state, $filtered\_params~~ ); |
  | 495 |  | $filtered\_params['state'] = base64\_encode(~~json\_encode( $filtered\_state )~~ ); |
  | 496 |  | } |
  | 497 |  |  |
  | 498 |  | return array\_filter(~~$filtered\_params~~ ); |
  |  | 505 | $filtered\_state           = apply\_filters('auth0\_authorize\_state', $state, $filtered\_params); |
  |  | 506 | $filtered\_params['state'] = base64\_encode(json\_encode($filtered\_state)); |
  |  | 507 | } |
  |  | 508 |  |
  |  | 509 | return array\_filter($filtered\_params); |
  | 499 | 510 |  |
  | 500 | 511 | // phpcs:enable WordPress.Security.NonceVerification.NoNonceVerification |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L508) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L519) |  |
  | 508 | 519 | \* @return string |
  | 509 | 520 | \*/ |
  | 510 |  | public static function build\_authorize\_url( array $params = [] ) { |
  |  | 521 | public static function build\_authorize\_url(array $params = []) |
  |  | 522 | { |
  | 511 | 523 | $auth\_url = 'https://' . WP\_Auth0\_Options::Instance()->get\_auth\_domain() . '/authorize'; |
  | 512 |  | $auth\_url = add\_query\_arg(~~array\_map( 'rawurlencode', $params ), $auth\_url~~ ); |
  | 513 |  | return apply\_filters(~~'auth0\_authorize\_url', $auth\_url, $params~~ ); |
  |  | 524 | $auth\_url = add\_query\_arg(array\_map('rawurlencode', $params), $auth\_url); |
  |  | 525 | return apply\_filters('auth0\_authorize\_url', $auth\_url, $params); |
  | 514 | 526 | } |
  | 515 | 527 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L528) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L540) |  |
  | 528 | 540 | \* @return string|null |
  | 529 | 541 | \*/ |
  | 530 |  | protected function query\_vars( $key ) { |
  |  | 542 | protected function query\_vars($key) |
  |  | 543 | { |
  | 531 | 544 | // Neither nonce nor sanitization is needed here as this is not processing form data, just returning it. |
  | 532 | 545 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L535) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L548) |  |
  | 535 | 548 | global $wp\_query; |
  | 536 | 549 |  |
  | 537 |  | if (~~isset( $wp\_query->query\_vars[ $key ] )~~ ) { |
  | 538 |  | return $wp\_query->query\_vars[~~$key~~ ]; |
  | 539 |  | } |
  | 540 |  |  |
  | 541 |  | if (~~isset( $\_REQUEST[ $key ] )~~ ) { |
  | 542 |  | return wp\_unslash(~~$\_REQUEST[ $key ]~~ ); |
  |  | 550 | if (isset($wp\_query->query\_vars[$key])) { |
  |  | 551 | return $wp\_query->query\_vars[$key]; |
  |  | 552 | } |
  |  | 553 |  |
  |  | 554 | if (isset($\_REQUEST[$key])) { |
  |  | 555 | return wp\_unslash($\_REQUEST[$key]); |
  | 543 | 556 | } |
  | 544 | 557 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L555) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L568) |  |
  | 555 | 568 | \* @return string|object|null |
  | 556 | 569 | \*/ |
  | 557 |  | protected function get\_state() { |
  |  | 570 | protected function get\_state() |
  |  | 571 | { |
  | 558 | 572 | // Neither nonce nor sanitization is needed here as this is not processing form data, just returning it. |
  | 559 | 573 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 560 | 574 | // phpcs:disable WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 561 | 575 |  |
  | 562 |  | if (~~! isset( $\_REQUEST['state'] )~~ ) { |
  |  | 576 | if (!isset($\_REQUEST['state'])) { |
  | 563 | 577 | return null; |
  | 564 | 578 | } |
  | 565 | 579 |  |
  | 566 |  | $state\_val = wp\_unslash(~~$\_REQUEST['state']~~ ); |
  | 567 |  | $state\_val = rawurldecode(~~$state\_val~~ ); |
  | 568 |  | $state\_val = base64\_decode(~~$state\_val~~ ); |
  | 569 |  | $state\_val = json\_decode(~~$state\_val~~ ); |
  |  | 580 | $state\_val = wp\_unslash($\_REQUEST['state']); |
  |  | 581 | $state\_val = rawurldecode($state\_val); |
  |  | 582 | $state\_val = base64\_decode($state\_val); |
  |  | 583 | $state\_val = json\_decode($state\_val); |
  | 570 | 584 |  |
  | 571 | 585 | return $state\_val; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L581) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L595) |  |
  | 581 | 595 | \* @param string|int $code - error code, if given. |
  | 582 | 596 | \*/ |
  | 583 |  | protected function die\_on\_login( $msg = '', $code = 0 ) { |
  |  | 597 | protected function die\_on\_login($msg = '', $code = 0) |
  |  | 598 | { |
  | 584 | 599 |  |
  | 585 | 600 | // Log the user out completely. |
  | 586 | 601 | wp\_destroy\_current\_session(); |
  | 587 | 602 | wp\_clear\_auth\_cookie(); |
  | 588 |  | wp\_set\_current\_user(~~0~~ ); |
  | 589 |  |  |
  | 590 |  | $html = sprintf( |
  |  | 603 | wp\_set\_current\_user(0); |
  |  | 604 |  |
  |  | 605 | $html = wp\_kses(sprintf( |
  | 591 | 606 | '%s: %s [%s: %s]<br><br><a href="%s">%s</a>', |
  | 592 |  | \_\_( 'There was a problem with your log in', 'wp-auth0' ), |
  | 593 |  | ! empty( $msg ) |
  | 594 |  | ? sanitize\_text\_field( $msg ) |
  | 595 |  | : \_\_( 'Please see the site administrator', 'wp-auth0' ), |
  | 596 |  | \_\_( 'error code', 'wp-auth0' ), |
  | 597 |  | $code ? sanitize\_text\_field( $code ) : \_\_( 'unknown', 'wp-auth0' ), |
  | 598 |  | $this->auth0\_logout\_url( wp\_login\_url() ), |
  | 599 |  | \_\_( '← Login', 'wp-auth0' ) |
  | 600 |  | ); |
  | 601 |  |  |
  | 602 |  | $html = apply\_filters( 'auth0\_die\_on\_login\_output', $html, $msg, $code, false ); |
  | 603 |  | wp\_die( $html ); |
  |  | 607 | esc\_html\_\_('There was a problem with your log in', 'wp-auth0'), |
  |  | 608 | !empty($msg) |
  |  | 609 | ? sanitize\_text\_field($msg) |
  |  | 610 | : esc\_html\_\_('Please see the site administrator', 'wp-auth0'), |
  |  | 611 | esc\_html\_\_('error code', 'wp-auth0'), |
  |  | 612 | esc\_html($code ? sanitize\_text\_field($code) : esc\_html\_\_('unknown', 'wp-auth0')), |
  |  | 613 | $this->auth0\_logout\_url(wp\_login\_url()), |
  |  | 614 | esc\_html\_\_('← Login', 'wp-auth0') |
  |  | 615 | ), ['br' => [], 'a' => ['href' => []]]); |
  |  | 616 |  |
  |  | 617 | $html = apply\_filters('auth0\_die\_on\_login\_output', esc\_html($html), esc\_html($msg), esc\_html($code), false); |
  |  | 618 |  |
  |  | 619 | wp\_die(wp\_kses($html, ['br' => [], 'a' => ['href' => []]])); |
  | 604 | 620 | } |
  | 605 | 621 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L609) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L625) |  |
  | 609 | 625 | \* @throws WP\_Auth0\_InvalidIdTokenException |
  | 610 | 626 | \*/ |
  | 611 |  | private function decode\_id\_token( $id\_token ) { |
  | 612 |  | $expectedIss = apply\_filters( 'auth0\_id\_token\_issuer', 'https://' . $this->a0\_options->get\_auth\_domain() . '/' ); |
  | 613 |  | $expectedAlg = $this->a0\_options->get( 'client\_signing\_algorithm' ); |
  | 614 |  | if ( 'RS256' === $expectedAlg ) { |
  | 615 |  | $sigVerifier = new WP\_Auth0\_AsymmetricVerifier( new WP\_Auth0\_JwksFetcher() ); |
  | 616 |  | } elseif ( 'HS256' === $expectedAlg ) { |
  | 617 |  | $sigVerifier = new WP\_Auth0\_SymmetricVerifier( $this->a0\_options->get( 'client\_secret' ) ); |
  |  | 627 | private function decode\_id\_token($id\_token) |
  |  | 628 | { |
  |  | 629 | $expectedIss = apply\_filters('auth0\_id\_token\_issuer', 'https://' . $this->a0\_options->get\_auth\_domain() . '/'); |
  |  | 630 | $expectedAlg = $this->a0\_options->get('client\_signing\_algorithm'); |
  |  | 631 | if ('RS256' === $expectedAlg) { |
  |  | 632 | $sigVerifier = new WP\_Auth0\_AsymmetricVerifier(new WP\_Auth0\_JwksFetcher()); |
  |  | 633 | } elseif ('HS256' === $expectedAlg) { |
  |  | 634 | $sigVerifier = new WP\_Auth0\_SymmetricVerifier($this->a0\_options->get('client\_secret')); |
  | 618 | 635 | } else { |
  | 619 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Signing algorithm of "' . $expectedAlg . '" is not supported.'~~ ); |
  |  | 636 | throw new WP\_Auth0\_InvalidIdTokenException(esc\_html('Signing algorithm of "' . $expectedAlg . '" is not supported.')); |
  | 620 | 637 | } |
  | 621 | 638 |  |
  | 622 | 639 | $verifierOptions = [ |
  | 623 | 640 | 'nonce'   => WP\_Auth0\_Nonce\_Handler::get\_instance()->get\_once(), |
  | 624 |  | 'leeway'  => absint(~~apply\_filters( 'auth0\_jwt\_leeway', null )~~ ), |
  | 625 |  | 'max\_age' => absint(~~apply\_filters( 'auth0\_jwt\_max\_age', null )~~ ), |
  | 626 |  | 'org\_id'  => apply\_filters(~~'auth0\_jwt\_org\_id', $this->a0\_options->get\_auth\_organization()~~ ), |
  |  | 641 | 'leeway'  => absint(apply\_filters('auth0\_jwt\_leeway', null)), |
  |  | 642 | 'max\_age' => absint(apply\_filters('auth0\_jwt\_max\_age', null)), |
  |  | 643 | 'org\_id'  => apply\_filters('auth0\_jwt\_org\_id', $this->a0\_options->get\_auth\_organization()), |
  | 627 | 644 | ]; |
  | 628 | 645 |  |
  | 629 |  | $idTokenVerifier = new WP\_Auth0\_IdTokenVerifier(~~$expectedIss, $this->a0\_options->get( 'client\_id' ), $sigVerifier~~ ); |
  | 630 |  | return (object) $idTokenVerifier->verify(~~$id\_token, $verifierOptions~~ ); |
  |  | 646 | $idTokenVerifier = new WP\_Auth0\_IdTokenVerifier($expectedIss, $this->a0\_options->get('client\_id'), $sigVerifier); |
  |  | 647 | return (object) $idTokenVerifier->verify($id\_token, $verifierOptions); |
  | 631 | 648 | } |
  | 632 | 649 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L640) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L657) |  |
  | 640 | 657 | \* @codeCoverageIgnore - Private method |
  | 641 | 658 | \*/ |
  | 642 |  | private function clean\_id\_token( $id\_token\_obj ) { |
  | 643 |  | foreach ( [ 'iss', 'aud', 'iat', 'exp', 'nonce' ] as $attr ) { |
  | 644 |  | unset( $id\_token\_obj->$attr ); |
  | 645 |  | } |
  | 646 |  | if ( ! isset( $id\_token\_obj->user\_id ) && isset( $id\_token\_obj->sub ) ) { |
  |  | 659 | private function clean\_id\_token($id\_token\_obj) |
  |  | 660 | { |
  |  | 661 | foreach (['iss', 'aud', 'iat', 'exp', 'nonce'] as $attr) { |
  |  | 662 | unset($id\_token\_obj->$attr); |
  |  | 663 | } |
  |  | 664 | if (!isset($id\_token\_obj->user\_id) && isset($id\_token\_obj->sub)) { |
  | 647 | 665 | $id\_token\_obj->user\_id = $id\_token\_obj->sub; |
  | 648 |  | } elseif (~~! isset( $id\_token\_obj->sub ) && isset( $id\_token\_obj->user\_id )~~ ) { |
  |  | 666 | } elseif (!isset($id\_token\_obj->sub) && isset($id\_token\_obj->user\_id)) { |
  | 649 | 667 | $id\_token\_obj->sub = $id\_token\_obj->user\_id; |
  | 650 | 668 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3020639#L661) | […](/browser/auth0/trunk/lib/WP_Auth0_LoginManager.php?rev=3114611#L679) |  |
  | 661 | 679 | \* @codeCoverageIgnore - Private method |
  | 662 | 680 | \*/ |
  | 663 |  | private function auth0\_logout\_url( $return\_to = null ) { |
  |  | 681 | private function auth0\_logout\_url($return\_to = null) |
  |  | 682 | { |
  | 664 | 683 | return sprintf( |
  | 665 | 684 | 'https://%s/v2/logout?client\_id=%s&returnTo=%s', |
  | 666 | 685 | $this->a0\_options->get\_auth\_domain(), |
  | 667 |  | $this->a0\_options->get(~~'client\_id'~~ ), |
  | 668 |  | rawurlencode(~~$return\_to ?: home\_url()~~ ) |
  |  | 686 | $this->a0\_options->get('client\_id'), |
  |  | 687 | rawurlencode($return\_to ?: home\_url()) |
  | 669 | 688 | ); |
  | 670 | 689 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Nonce\_Handler.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Nonce_Handler.php")

  | [r3020639](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Nonce\_Handler. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L9) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L10) |  |
  | 9 | 10 | \* Class WP\_Auth0\_Nonce\_Handler for generating and storing nonce-type values. |
  | 10 | 11 | \*/ |
  | 11 |  | class WP\_Auth0\_Nonce\_Handler { |
  |  | 12 | class WP\_Auth0\_Nonce\_Handler |
  |  | 13 | { |
  | 12 | 14 |  |
  | 13 | 15 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L43) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L45) |  |
  | 43 | 45 | \* Private to prevent cloning. |
  | 44 | 46 | \*/ |
  | 45 |  | private function \_\_clone() {} |
  | 46 |  |  |
  | 47 |  | public function \_\_wakeup() {} |
  |  | 47 | private function \_\_clone() |
  |  | 48 | { |
  |  | 49 | } |
  |  | 50 |  |
  |  | 51 | public function \_\_wakeup() |
  |  | 52 | { |
  |  | 53 | } |
  | 48 | 54 |  |
  | 49 | 55 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L51) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L57) |  |
  | 51 | 57 | \* Private to prevent new instances of this class. |
  | 52 | 58 | \*/ |
  | 53 |  | private function \_\_construct() { |
  |  | 59 | private function \_\_construct() |
  |  | 60 | { |
  | 54 | 61 | $this->init(); |
  | 55 | 62 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L58) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L65) |  |
  | 58 | 65 | \* Start-up process to make sure we have something stored. |
  | 59 | 66 | \*/ |
  | 60 |  | protected function init() { |
  |  | 67 | protected function init() |
  |  | 68 | { |
  | 61 | 69 | // If a NONCE\_COOKIE\_NAME is not defined then we don't need to persist the nonce value. |
  | 62 |  | if (~~defined( static::NONCE\_COOKIE\_NAME ) && isset( $\_COOKIE[ static::get\_storage\_cookie\_name() ] )~~ ) { |
  |  | 70 | if (defined(static::NONCE\_COOKIE\_NAME) && isset($\_COOKIE[static::get\_storage\_cookie\_name()])) { |
  | 63 | 71 | // Have a cookie, don't want to generate a new one. |
  | 64 | 72 | // TODO: validate whether we need to persist this value and sanitize if so. |
  | 65 | 73 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 66 |  | $this->unique = $\_COOKIE[~~static::get\_storage\_cookie\_name()~~ ]; |
  |  | 74 | $this->unique = $\_COOKIE[static::get\_storage\_cookie\_name()]; |
  | 67 | 75 | } else { |
  | 68 | 76 | // No cookie, need to create one. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L76) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L84) |  |
  | 76 | 84 | \* @return WP\_Auth0\_State\_Handler|WP\_Auth0\_Nonce\_Handler |
  | 77 | 85 | \*/ |
  | 78 |  | final public static function get\_instance() { |
  | 79 |  | if ( is\_null( static::$\_instance ) ) { |
  |  | 86 | final public static function get\_instance() |
  |  | 87 | { |
  |  | 88 | if (is\_null(static::$\_instance)) { |
  | 80 | 89 | static::$\_instance = new static(); |
  | 81 | 90 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L88) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L97) |  |
  | 88 | 97 | \* @return string |
  | 89 | 98 | \*/ |
  | 90 |  | public function get\_unique() { |
  |  | 99 | public function get\_unique() |
  |  | 100 | { |
  | 91 | 101 | return $this->unique; |
  | 92 | 102 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L97) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L107) |  |
  | 97 | 107 | \* @return integer |
  | 98 | 108 | \*/ |
  | 99 |  | public function get\_cookie\_exp() { |
  |  | 109 | public function get\_cookie\_exp() |
  |  | 110 | { |
  | 100 | 111 | return time() + self::COOKIE\_EXPIRES; |
  | 101 | 112 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L108) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L119) |  |
  | 108 | 119 | \* @return bool |
  | 109 | 120 | \*/ |
  | 110 |  | public function set\_cookie( $value = null ) { |
  | 111 |  | if ( is\_null( $value ) ) { |
  |  | 121 | public function set\_cookie($value = null) |
  |  | 122 | { |
  |  | 123 | if (is\_null($value)) { |
  | 112 | 124 | $value = $this->unique; |
  | 113 | 125 | } |
  | 114 |  | return $this->handle\_cookie(~~static::get\_storage\_cookie\_name(), $value, $this->get\_cookie\_exp()~~ ); |
  |  | 126 | return $this->handle\_cookie(static::get\_storage\_cookie\_name(), $value, $this->get\_cookie\_exp()); |
  | 115 | 127 | } |
  | 116 | 128 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L122) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L134) |  |
  | 122 | 134 | \* @return bool |
  | 123 | 135 | \*/ |
  | 124 |  | public function validate( $value ) { |
  |  | 136 | public function validate($value) |
  |  | 137 | { |
  | 125 | 138 | $cookie\_name = static::get\_storage\_cookie\_name(); |
  | 126 |  | $valid       = isset(~~$\_COOKIE[ $cookie\_name ] ) ? $\_COOKIE[ $cookie\_name~~ ] === $value : false; |
  |  | 139 | $valid       = isset($\_COOKIE[$cookie\_name]) ? $\_COOKIE[$cookie\_name] === $value : false; |
  | 127 | 140 | $this->reset(); |
  | 128 | 141 | return $valid; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L134) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L147) |  |
  | 134 | 147 | \* @return string|null |
  | 135 | 148 | \*/ |
  | 136 |  | public function get\_once() { |
  |  | 149 | public function get\_once() |
  |  | 150 | { |
  | 137 | 151 | $cookie\_name = static::get\_storage\_cookie\_name(); |
  | 138 | 152 | // Null coalescing validates the input variable. |
  | 139 | 153 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotValidated |
  | 140 |  | $value = $\_COOKIE[~~$cookie\_name~~ ] ?? null; |
  |  | 154 | $value = $\_COOKIE[$cookie\_name] ?? null; |
  | 141 | 155 | $this->reset(); |
  | 142 | 156 | return $value; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L148) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L162) |  |
  | 148 | 162 | \* @return bool |
  | 149 | 163 | \*/ |
  | 150 |  | public function reset() { |
  | 151 |  | return $this->handle\_cookie( static::get\_storage\_cookie\_name(), '', 0 ); |
  |  | 164 | public function reset() |
  |  | 165 | { |
  |  | 166 | return $this->handle\_cookie(static::get\_storage\_cookie\_name(), '', 0); |
  | 152 | 167 | } |
  | 153 | 168 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L161) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L176) |  |
  | 161 | 176 | \* @return string |
  | 162 | 177 | \*/ |
  | 163 |  | public function generate\_unique( $bytes = 32 ) { |
  | 164 |  | return bin2hex( random\_bytes( $bytes ) ); |
  |  | 178 | public function generate\_unique($bytes = 32) |
  |  | 179 | { |
  |  | 180 | return bin2hex(random\_bytes($bytes)); |
  | 165 | 181 | } |
  | 166 | 182 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L174) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L190) |  |
  | 174 | 190 | \* @return bool |
  | 175 | 191 | \*/ |
  | 176 |  | protected function handle\_cookie( $cookie\_name, $cookie\_value, $cookie\_exp, $cookie\_domain = null ) { |
  |  | 192 | protected function handle\_cookie($cookie\_name, $cookie\_value, $cookie\_exp, $cookie\_domain = null) |
  |  | 193 | { |
  | 177 | 194 | $options = WP\_Auth0\_Options::Instance(); |
  | 178 |  | $cookie\_domain ??= $options->get(~~'cookie\_domain'~~ ) ?? ''; |
  |  | 195 | $cookie\_domain ??= $options->get('cookie\_domain') ?? ''; |
  | 179 | 196 | $cookie\_domain = trim($cookie\_domain); |
  | 180 | 197 |  |
  | 181 | 198 | if ('' === $cookie\_domain) { |
  | 182 |  | $cookie\_domain = trim($options->get(~~'cookie\_domain'~~ ) ?? ''); |
  | 183 |  | } |
  | 184 |  |  |
  | 185 |  | if (~~$cookie\_exp <= time()~~ ) { |
  | 186 |  | unset(~~$\_COOKIE[ $cookie\_name ]~~ ); |
  | 187 |  | return setcookie(~~$cookie\_name, $cookie\_value, 0, '/', $cookie\_domain ?? ''~~ ); |
  |  | 199 | $cookie\_domain = trim($options->get('cookie\_domain') ?? ''); |
  |  | 200 | } |
  |  | 201 |  |
  |  | 202 | if ($cookie\_exp <= time()) { |
  |  | 203 | unset($\_COOKIE[$cookie\_name]); |
  |  | 204 | return setcookie($cookie\_name, $cookie\_value, 0, '/', $cookie\_domain ?? ''); |
  | 188 | 205 | } else { |
  | 189 |  | $\_COOKIE[~~$cookie\_name~~ ] = $cookie\_value; |
  | 190 |  | return setcookie(~~$cookie\_name, $cookie\_value, $cookie\_exp, '/', $cookie\_domain ?? '', false, true~~ ); |
  |  | 206 | $\_COOKIE[$cookie\_name] = $cookie\_value; |
  |  | 207 | return setcookie($cookie\_name, $cookie\_value, $cookie\_exp, '/', $cookie\_domain ?? '', false, true); |
  | 191 | 208 | } |
  | 192 | 209 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3020639#L197) | […](/browser/auth0/trunk/lib/WP_Auth0_Nonce_Handler.php?rev=3114611#L214) |  |
  | 197 | 214 | \* @return string |
  | 198 | 215 | \*/ |
  | 199 |  | public static function get\_storage\_cookie\_name() { |
  | 200 |  | return apply\_filters( 'auth0\_nonce\_cookie\_name', static::NONCE\_COOKIE\_NAME ); |
  |  | 216 | public static function get\_storage\_cookie\_name() |
  |  | 217 | { |
  |  | 218 | return apply\_filters('auth0\_nonce\_cookie\_name', static::NONCE\_COOKIE\_NAME); |
  | 201 | 219 | } |
  | 202 | 220 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Options.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Options.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Options.php")

  | [r3020639](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Options { |
  |  | 3 | class WP\_Auth0\_Options |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 | 6 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L33) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L34) |  |
  | 33 | 34 | \* Finds and stores all constant-defined settings values. |
  | 34 | 35 | \*/ |
  | 35 |  | public function \_\_construct() { |
  | 36 |  | $option\_keys = $this->get\_defaults( true ); |
  | 37 |  | foreach ( $option\_keys as $key ) { |
  | 38 |  | $setting\_const = $this->get\_constant\_name( $key ); |
  | 39 |  | if ( defined( $setting\_const ) ) { |
  | 40 |  | $this->constant\_opts[ $key ] = constant( $setting\_const ); |
  |  | 36 | public function \_\_construct() |
  |  | 37 | { |
  |  | 38 | $option\_keys = $this->get\_defaults(true); |
  |  | 39 | foreach ($option\_keys as $key) { |
  |  | 40 | $setting\_const = $this->get\_constant\_name($key); |
  |  | 41 | if (defined($setting\_const)) { |
  |  | 42 | $this->constant\_opts[$key] = constant($setting\_const); |
  | 41 | 43 | } |
  | 42 | 44 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L46) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L48) |  |
  | 46 | 48 | \* @return WP\_Auth0\_Options |
  | 47 | 49 | \*/ |
  | 48 |  | public static function Instance() { |
  | 49 |  | if ( null === self::$\_instance ) { |
  |  | 50 | public static function Instance() |
  |  | 51 | { |
  |  | 52 | if (null === self::$\_instance) { |
  | 50 | 53 | self::$\_instance = new self(); |
  | 51 | 54 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L60) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L63) |  |
  | 60 | 63 | \* @return string |
  | 61 | 64 | \*/ |
  | 62 |  | public function get\_constant\_name( $key ) { |
  |  | 65 | public function get\_constant\_name($key) |
  |  | 66 | { |
  | 63 | 67 | // NOTE: the add\_filter call must load before WP\_Auth0::init() so it cannot be used in a theme. |
  | 64 |  | $constant\_prefix = apply\_filters(~~'auth0\_settings\_constant\_prefix', 'AUTH0\_ENV\_'~~ ); |
  | 65 |  | return $constant\_prefix . strtoupper(~~$key~~ ); |
  |  | 68 | $constant\_prefix = apply\_filters('auth0\_settings\_constant\_prefix', 'AUTH0\_ENV\_'); |
  |  | 69 | return $constant\_prefix . strtoupper($key); |
  | 66 | 70 | } |
  | 67 | 71 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L73) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L77) |  |
  | 73 | 77 | \* @return boolean |
  | 74 | 78 | \*/ |
  | 75 |  | public function has\_constant\_val( $key ) { |
  | 76 |  | return isset( $this->constant\_opts[ $key ] ); |
  |  | 79 | public function has\_constant\_val($key) |
  |  | 80 | { |
  |  | 81 | return isset($this->constant\_opts[$key]); |
  | 77 | 82 | } |
  | 78 | 83 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L84) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L89) |  |
  | 84 | 89 | \* @return string|null |
  | 85 | 90 | \*/ |
  | 86 |  | public function get\_constant\_val( $key ) { |
  | 87 |  | return $this->has\_constant\_val( $key ) ? constant( $this->get\_constant\_name( $key ) ) : null; |
  |  | 91 | public function get\_constant\_val($key) |
  |  | 92 | { |
  |  | 93 | return $this->has\_constant\_val($key) ? constant($this->get\_constant\_name($key)) : null; |
  | 88 | 94 | } |
  | 89 | 95 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L93) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L99) |  |
  | 93 | 99 | \* @return array |
  | 94 | 100 | \*/ |
  | 95 |  | public function get\_all\_constant\_keys() { |
  | 96 |  | return array\_keys( $this->constant\_opts ); |
  |  | 101 | public function get\_all\_constant\_keys() |
  |  | 102 | { |
  |  | 103 | return array\_keys($this->constant\_opts); |
  | 97 | 104 | } |
  | 98 | 105 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L102) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L109) |  |
  | 102 | 109 | \* @return string |
  | 103 | 110 | \*/ |
  | 104 |  | public function get\_options\_name() { |
  |  | 111 | public function get\_options\_name() |
  |  | 112 | { |
  | 105 | 113 | return $this->\_options\_name; |
  | 106 | 114 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L111) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L119) |  |
  | 111 | 119 | \* @return array |
  | 112 | 120 | \*/ |
  | 113 |  | public function get\_options() { |
  | 114 |  | if ( empty( $this->\_opts ) ) { |
  | 115 |  | $options = get\_option( $this->\_options\_name, [] ); |
  |  | 121 | public function get\_options() |
  |  | 122 | { |
  |  | 123 | if (empty($this->\_opts)) { |
  |  | 124 | $options = get\_option($this->\_options\_name, []); |
  | 116 | 125 | // Brand new install, no saved options so get all defaults. |
  | 117 |  | if (~~empty( $options ) || ! is\_array( $options )~~ ) { |
  |  | 126 | if (empty($options) || !is\_array($options)) { |
  | 118 | 127 | $options = $this->defaults(); |
  | 119 | 128 | } |
  | 120 | 129 |  |
  | 121 | 130 | // Check for constant overrides and replace. |
  | 122 |  | if (~~! empty( $this->constant\_opts )~~ ) { |
  | 123 |  | $options = array\_replace\_recursive(~~$options, $this->constant\_opts~~ ); |
  |  | 131 | if (!empty($this->constant\_opts)) { |
  |  | 132 | $options = array\_replace\_recursive($options, $this->constant\_opts); |
  | 124 | 133 | } |
  | 125 | 134 | $this->\_opts = $options; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L138) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L147) |  |
  | 138 | 147 | \* @link https://auth0.com/docs/cms/wordpress/extending#wp\_auth0\_get\_option |
  | 139 | 148 | \*/ |
  | 140 |  | public function get( $key, $default = null ) { |
  |  | 149 | public function get($key, $default = null) |
  |  | 150 | { |
  | 141 | 151 | $options = $this->get\_options(); |
  | 142 |  | $value   = isset(~~$options[ $key ] ) ? $options[ $key~~ ] : $default; |
  | 143 |  | return apply\_filters(~~'wp\_auth0\_get\_option', $value, $key~~ ); |
  |  | 152 | $value   = isset($options[$key]) ? $options[$key] : $default; |
  |  | 153 | return apply\_filters('wp\_auth0\_get\_option', $value, $key); |
  | 144 | 154 | } |
  | 145 | 155 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L154) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L164) |  |
  | 154 | 164 | \* @return bool |
  | 155 | 165 | \*/ |
  | 156 |  | public function set( $key, $value, $should\_update = true ) { |
  |  | 166 | public function set($key, $value, $should\_update = true) |
  |  | 167 | { |
  | 157 | 168 |  |
  | 158 | 169 | // Cannot set a setting that is being overridden by a constant. |
  | 159 |  | if (~~$this->has\_constant\_val( $key )~~ ) { |
  |  | 170 | if ($this->has\_constant\_val($key)) { |
  | 160 | 171 | return false; |
  | 161 | 172 | } |
  | 162 | 173 |  |
  | 163 | 174 | $options         = $this->get\_options(); |
  | 164 |  | $options[~~$key~~ ] = $value; |
  |  | 175 | $options[$key] = $value; |
  | 165 | 176 | $this->\_opts     = $options; |
  | 166 | 177 |  |
  | 167 | 178 | // No database update so process completed successfully. |
  | 168 |  | if (~~! $should\_update~~ ) { |
  |  | 179 | if (!$should\_update) { |
  | 169 | 180 | return true; |
  | 170 | 181 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L178) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L189) |  |
  | 178 | 189 | \* @param string $key - Option key name to remove. |
  | 179 | 190 | \*/ |
  | 180 |  | public function remove( $key ) { |
  |  | 191 | public function remove($key) |
  |  | 192 | { |
  | 181 | 193 |  |
  | 182 | 194 | // Cannot remove a setting that is being overridden by a constant. |
  | 183 |  | if (~~$this->has\_constant\_val( $key )~~ ) { |
  |  | 195 | if ($this->has\_constant\_val($key)) { |
  | 184 | 196 | return; |
  | 185 | 197 | } |
  | 186 | 198 |  |
  | 187 | 199 | $options = $this->get\_options(); |
  | 188 |  | unset(~~$options[ $key ]~~ ); |
  |  | 200 | unset($options[$key]); |
  | 189 | 201 | $this->\_opts = $options; |
  | 190 | 202 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L195) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L207) |  |
  | 195 | 207 | \* @return bool |
  | 196 | 208 | \*/ |
  | 197 |  | public function update\_all() { |
  |  | 209 | public function update\_all() |
  |  | 210 | { |
  | 198 | 211 | $options = $this->get\_options(); |
  | 199 | 212 |  |
  | 200 |  | foreach (~~$this->get\_all\_constant\_keys() as $key~~ ) { |
  | 201 |  | unset(~~$options[ $key ]~~ ); |
  | 202 |  | } |
  | 203 |  | return update\_option(~~$this->\_options\_name, $options~~ ); |
  |  | 213 | foreach ($this->get\_all\_constant\_keys() as $key) { |
  |  | 214 | unset($options[$key]); |
  |  | 215 | } |
  |  | 216 | return update\_option($this->\_options\_name, $options); |
  | 204 | 217 | } |
  | 205 | 218 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L207) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L220) |  |
  | 207 | 220 | \* Save the options array for the first time. |
  | 208 | 221 | \*/ |
  | 209 |  | public function save() { |
  |  | 222 | public function save() |
  |  | 223 | { |
  | 210 | 224 | $this->get\_options(); |
  | 211 | 225 | $this->update\_all(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L217) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L231) |  |
  | 217 | 231 | \* @return bool |
  | 218 | 232 | \*/ |
  | 219 |  | public function delete() { |
  | 220 |  | return delete\_option( $this->\_options\_name ); |
  |  | 233 | public function delete() |
  |  | 234 | { |
  |  | 235 | return delete\_option($this->\_options\_name); |
  | 221 | 236 | } |
  | 222 | 237 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L224) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L239) |  |
  | 224 | 239 | \* Reset options to defaults. |
  | 225 | 240 | \*/ |
  | 226 |  | public function reset() { |
  |  | 241 | public function reset() |
  |  | 242 | { |
  | 227 | 243 | $this->\_opts = null; |
  | 228 | 244 | $this->delete(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L237) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L253) |  |
  | 237 | 253 | \* @return array |
  | 238 | 254 | \*/ |
  | 239 |  | public function get\_defaults( $keys\_only = false ) { |
  |  | 255 | public function get\_defaults($keys\_only = false) |
  |  | 256 | { |
  | 240 | 257 | $default\_opts = $this->defaults(); |
  | 241 |  | return $keys\_only ? array\_keys( $default\_opts ) : $default\_opts; |
  | 242 |  | } |
  | 243 |  |  |
  | 244 |  | public function is\_wp\_registration\_enabled() { |
  | 245 |  | return is\_multisite() ? users\_can\_register\_signup\_filter() : get\_site\_option( 'users\_can\_register' ); |
  | 246 |  | } |
  | 247 |  |  |
  | 248 |  | public function get\_default( $key ) { |
  |  | 258 | return $keys\_only ? array\_keys($default\_opts) : $default\_opts; |
  |  | 259 | } |
  |  | 260 |  |
  |  | 261 | public function is\_wp\_registration\_enabled() |
  |  | 262 | { |
  |  | 263 | return is\_multisite() ? users\_can\_register\_signup\_filter() : get\_site\_option('users\_can\_register'); |
  |  | 264 | } |
  |  | 265 |  |
  |  | 266 | public function get\_default($key) |
  |  | 267 | { |
  | 249 | 268 | $defaults = $this->defaults(); |
  | 250 |  | return $defaults[~~$key~~ ]; |
  |  | 269 | return $defaults[$key]; |
  | 251 | 270 | } |
  | 252 | 271 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L256) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L275) |  |
  | 256 | 275 | \* @return array |
  | 257 | 276 | \*/ |
  | 258 |  | public function get\_web\_origins() { |
  | 259 |  | $home\_url\_parsed = wp\_parse\_url( home\_url() ); |
  | 260 |  | $home\_url\_origin = ! empty( $home\_url\_parsed['path'] ) |
  | 261 |  | ? str\_replace( $home\_url\_parsed['path'], '', home\_url() ) |
  |  | 277 | public function get\_web\_origins() |
  |  | 278 | { |
  |  | 279 | $home\_url\_parsed = wp\_parse\_url(home\_url()); |
  |  | 280 | $home\_url\_origin = !empty($home\_url\_parsed['path']) |
  |  | 281 | ? str\_replace($home\_url\_parsed['path'], '', home\_url()) |
  | 262 | 282 | : home\_url(); |
  | 263 | 283 |  |
  | 264 |  | $site\_url\_parsed = wp\_parse\_url(~~site\_url()~~ ); |
  | 265 |  | $site\_url\_origin = !~~empty( $site\_url\_parsed['path']~~ ) |
  | 266 |  | ? str\_replace(~~$site\_url\_parsed['path'], '', site\_url()~~ ) |
  |  | 284 | $site\_url\_parsed = wp\_parse\_url(site\_url()); |
  |  | 285 | $site\_url\_origin = !empty($site\_url\_parsed['path']) |
  |  | 286 | ? str\_replace($site\_url\_parsed['path'], '', site\_url()) |
  | 267 | 287 | : site\_url(); |
  | 268 | 288 |  |
  | 269 | 289 | return $home\_url\_origin === $site\_url\_origin |
  | 270 |  | ? [~~$home\_url\_origin~~ ] |
  | 271 |  | : [~~$home\_url\_origin, $site\_url\_origin~~ ]; |
  |  | 290 | ? [$home\_url\_origin] |
  |  | 291 | : [$home\_url\_origin, $site\_url\_origin]; |
  | 272 | 292 | } |
  | 273 | 293 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L279) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L299) |  |
  | 279 | 299 | \* @return string |
  | 280 | 300 | \*/ |
  | 281 |  | public function get\_wp\_auth0\_url( $protocol = null ) { |
  | 282 |  | if ( is\_null( $protocol ) && $this->get( 'force\_https\_callback' ) ) { |
  |  | 301 | public function get\_wp\_auth0\_url($protocol = null) |
  |  | 302 | { |
  |  | 303 | if (is\_null($protocol) && $this->get('force\_https\_callback')) { |
  | 283 | 304 | $protocol = 'https'; |
  | 284 | 305 | } |
  | 285 |  | $site\_url = site\_url(~~'index.php', $protocol~~ ); |
  | 286 |  | return add\_query\_arg(~~'auth0', 1, $site\_url~~ ); |
  |  | 306 | $site\_url = site\_url('index.php', $protocol); |
  |  | 307 | return add\_query\_arg('auth0', 1, $site\_url); |
  | 287 | 308 | } |
  | 288 | 309 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L292) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L313) |  |
  | 292 | 313 | \* @return string |
  | 293 | 314 | \*/ |
  | 294 |  | public function get\_lock\_url() { |
  | 295 |  | $cdn\_url = $this->get( 'cdn\_url' ); |
  | 296 |  | return ( $cdn\_url && $this->get( 'custom\_cdn\_url' ) ) ? $cdn\_url : WPA0\_LOCK\_CDN\_URL; |
  |  | 315 | public function get\_lock\_url() |
  |  | 316 | { |
  |  | 317 | $cdn\_url = $this->get('cdn\_url'); |
  |  | 318 | return ($cdn\_url && $this->get('custom\_cdn\_url')) ? $cdn\_url : WPA0\_LOCK\_CDN\_URL; |
  | 297 | 319 | } |
  | 298 | 320 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L302) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L324) |  |
  | 302 | 324 | \* @return string |
  | 303 | 325 | \*/ |
  | 304 |  | public function get\_auth\_domain() { |
  | 305 |  | $domain = $this->get( 'custom\_domain' ); |
  | 306 |  | if ( empty( $domain ) ) { |
  | 307 |  | $domain = $this->get( 'domain' ); |
  |  | 326 | public function get\_auth\_domain() |
  |  | 327 | { |
  |  | 328 | $domain = $this->get('custom\_domain'); |
  |  | 329 | if (empty($domain)) { |
  |  | 330 | $domain = $this->get('domain'); |
  | 308 | 331 | } |
  | 309 | 332 | return $domain; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L315) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L338) |  |
  | 315 | 338 | \* @return string |
  | 316 | 339 | \*/ |
  | 317 |  | public function get\_auth\_organization() { |
  | 318 |  | return $this->get( 'organization', '' ); |
  |  | 340 | public function get\_auth\_organization() |
  |  | 341 | { |
  |  | 342 | return $this->get('organization', ''); |
  | 319 | 343 | } |
  | 320 | 344 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L324) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L348) |  |
  | 324 | 348 | \* @return array |
  | 325 | 349 | \*/ |
  | 326 |  | public function get\_lock\_connections() { |
  | 327 |  | $connections = $this->get( 'lock\_connections' ); |
  | 328 |  | $connections = empty( $connections ) ? [] : explode( ',', $connections ); |
  | 329 |  | return array\_map( 'trim', $connections ); |
  |  | 350 | public function get\_lock\_connections() |
  |  | 351 | { |
  |  | 352 | $connections = $this->get('lock\_connections'); |
  |  | 353 | $connections = empty($connections) ? [] : explode(',', $connections); |
  |  | 354 | return array\_map('trim', $connections); |
  | 330 | 355 | } |
  | 331 | 356 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L335) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L360) |  |
  | 335 | 360 | \* @param string $connection - connection name to add |
  | 336 | 361 | \*/ |
  | 337 |  | public function add\_lock\_connection( $connection ) { |
  |  | 362 | public function add\_lock\_connection($connection) |
  |  | 363 | { |
  | 338 | 364 | $connections = $this->get\_lock\_connections(); |
  | 339 | 365 |  |
  | 340 | 366 | // Add if it doesn't exist already |
  | 341 |  | if (~~! array\_key\_exists( $connection, $connections )~~ ) { |
  |  | 367 | if (!array\_key\_exists($connection, $connections)) { |
  | 342 | 368 | $connections[] = $connection; |
  | 343 |  | $connections   = implode(~~',', $connections~~ ); |
  | 344 |  | $this->set(~~'lock\_connections', $connections~~ ); |
  |  | 369 | $connections   = implode(',', $connections); |
  |  | 370 | $this->set('lock\_connections', $connections); |
  | 345 | 371 | } |
  | 346 | 372 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L356) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L382) |  |
  | 356 | 382 | \* @since 3.8.0 |
  | 357 | 383 | \*/ |
  | 358 |  | public function strategy\_skips\_verified\_email( $strategy ) { |
  | 359 |  | $skip\_strategies = trim( $this->get( 'skip\_strategies' ) ); |
  |  | 384 | public function strategy\_skips\_verified\_email($strategy) |
  |  | 385 | { |
  |  | 386 | $skip\_strategies = trim($this->get('skip\_strategies')); |
  | 360 | 387 |  |
  | 361 | 388 | // No strategies to skip. |
  | 362 |  | if (~~empty( $skip\_strategies )~~ ) { |
  |  | 389 | if (empty($skip\_strategies)) { |
  | 363 | 390 | return false; |
  | 364 | 391 | } |
  | 365 | 392 |  |
  | 366 |  | $skip\_strategies = explode(~~',', $skip\_strategies~~ ); |
  | 367 |  | $skip\_strategies = array\_map(~~'trim', $skip\_strategies~~ ); |
  | 368 |  | return in\_array(~~$strategy, $skip\_strategies~~ ); |
  |  | 393 | $skip\_strategies = explode(',', $skip\_strategies); |
  |  | 394 | $skip\_strategies = array\_map('trim', $skip\_strategies); |
  |  | 395 | return in\_array($strategy, $skip\_strategies); |
  | 369 | 396 | } |
  | 370 | 397 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3020639#L374) | […](/browser/auth0/trunk/lib/WP_Auth0_Options.php?rev=3114611#L401) |  |
  | 374 | 401 | \* @return array |
  | 375 | 402 | \*/ |
  | 376 |  | protected function defaults() { |
  |  | 403 | protected function defaults() |
  |  | 404 | { |
  | 377 | 405 | return [ |
  | 378 | 406 |  |
* ## [auth0/trunk/lib/WP\_Auth0\_Popup\_Widget.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Popup_Widget.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Popup_Widget.php")

  | [r1889096](/browser/auth0/trunk/lib/WP_Auth0_Popup_Widget.php?rev=1889096#L1 "Show revision 1889096 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Popup_Widget.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Popup\_Widget extends WP\_Auth0\_Embed\_Widget { |
  |  | 3 | class WP\_Auth0\_Popup\_Widget extends WP\_Auth0\_Embed\_Widget |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 |  | protected function getWidgetId() { |
  |  | 6 | protected function getWidgetId() |
  |  | 7 | { |
  | 6 | 8 | return 'wp\_auth0\_popup\_widget'; |
  | 7 | 9 | } |
  | 8 | 10 |  |
  | 9 |  | protected function getWidgetName() { |
  | 10 |  | return \_\_( 'Auth0 Popup Login', 'wp-auth0' ); |
  |  | 11 | protected function getWidgetName() |
  |  | 12 | { |
  |  | 13 | return esc\_html\_\_('Auth0 Popup Login', 'wp-auth0'); |
  | 11 | 14 | } |
  | 12 | 15 |  |
  | 13 |  | protected function getWidgetDescription() { |
  | 14 |  | return \_\_( 'Shows a button to pop up an Auth0 login form in your sidebar', 'wp-auth0' ); |
  |  | 16 | protected function getWidgetDescription() |
  |  | 17 | { |
  |  | 18 | return esc\_html\_\_('Shows a button to pop up an Auth0 login form in your sidebar', 'wp-auth0'); |
  | 15 | 19 | } |
  | 16 | 20 |  |
  | 17 |  | protected function showAsModal() { |
  |  | 21 | protected function showAsModal() |
  |  | 22 | { |
  | 18 | 23 | return true; |
  | 19 | 24 | } |
  | 20 |  |  |
  | 21 | 25 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Routes.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Routes.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Routes.php")

  | [r3020639](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Routes. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L12) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Handles all custom routes used by Auth0 except login callback. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Routes { |
  |  | 15 | class WP\_Auth0\_Routes |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L34) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L36) |  |
  | 34 | 36 | \* @param WP\_Auth0\_Ip\_Check|null $ip\_check - WP\_Auth0\_Ip\_Check instance. |
  | 35 | 37 | \*/ |
  | 36 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options, WP\_Auth0\_Ip\_Check $ip\_check = null ) { |
  |  | 38 | public function \_\_construct(WP\_Auth0\_Options $a0\_options, WP\_Auth0\_Ip\_Check $ip\_check = null) |
  |  | 39 | { |
  | 37 | 40 | $this->a0\_options = $a0\_options; |
  | 38 |  | $this->ip\_check   = $ip\_check instanceof WP\_Auth0\_Ip\_Check ? $ip\_check : new WP\_Auth0\_Ip\_Check(~~$a0\_options~~ ); |
  |  | 41 | $this->ip\_check   = $ip\_check instanceof WP\_Auth0\_Ip\_Check ? $ip\_check : new WP\_Auth0\_Ip\_Check($a0\_options); |
  | 39 | 42 | } |
  | 40 | 43 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L42) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L45) |  |
  | 42 | 45 | \* Add rewrite tags and rules. |
  | 43 | 46 | \*/ |
  | 44 |  | public function setup\_rewrites() { |
  | 45 |  | add\_rewrite\_tag( '%auth0%', '([^&]+)' ); |
  | 46 |  | add\_rewrite\_tag( '%auth0fallback%', '([^&]+)' ); |
  | 47 |  | add\_rewrite\_tag( '%code%', '([^&]+)' ); |
  | 48 |  | add\_rewrite\_tag( '%state%', '([^&]+)' ); |
  | 49 |  | add\_rewrite\_tag( '%auth0\_error%', '([^&]+)' ); |
  | 50 |  | add\_rewrite\_tag( '%a0\_action%', '([^&]+)' ); |
  | 51 |  |  |
  | 52 |  | add\_rewrite\_rule( '^\.well-known/oauth2-client-configuration', 'index.php?a0\_action=oauth2-config', 'top' ); |
  |  | 47 | public function setup\_rewrites() |
  |  | 48 | { |
  |  | 49 | add\_rewrite\_tag('%auth0%', '([^&]+)'); |
  |  | 50 | add\_rewrite\_tag('%auth0fallback%', '([^&]+)'); |
  |  | 51 | add\_rewrite\_tag('%code%', '([^&]+)'); |
  |  | 52 | add\_rewrite\_tag('%state%', '([^&]+)'); |
  |  | 53 | add\_rewrite\_tag('%auth0\_error%', '([^&]+)'); |
  |  | 54 | add\_rewrite\_tag('%a0\_action%', '([^&]+)'); |
  |  | 55 |  |
  |  | 56 | add\_rewrite\_rule('^\.well-known/oauth2-client-configuration', 'index.php?a0\_action=oauth2-config', 'top'); |
  | 53 | 57 | } |
  | 54 | 58 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L61) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L65) |  |
  | 61 | 65 | \* @return bool|string |
  | 62 | 66 | \*/ |
  | 63 |  | public function custom\_requests( $wp, $return = false ) { |
  |  | 67 | public function custom\_requests($wp, $return = false) |
  |  | 68 | { |
  | 64 | 69 | $page = null; |
  | 65 | 70 |  |
  | 66 |  | if (~~isset( $wp->query\_vars['auth0fallback'] )~~ ) { |
  |  | 71 | if (isset($wp->query\_vars['auth0fallback'])) { |
  | 67 | 72 | $page = 'coo-fallback'; |
  | 68 | 73 | } |
  | 69 | 74 |  |
  | 70 |  | if (~~isset( $wp->query\_vars['a0\_action'] )~~ ) { |
  |  | 75 | if (isset($wp->query\_vars['a0\_action'])) { |
  | 71 | 76 | $page = $wp->query\_vars['a0\_action']; |
  | 72 | 77 | } |
  | 73 | 78 |  |
  | 74 |  | if (~~null === $page && isset( $wp->query\_vars['pagename'] )~~ ) { |
  |  | 79 | if (null === $page && isset($wp->query\_vars['pagename'])) { |
  | 75 | 80 | $page = $wp->query\_vars['pagename']; |
  | 76 | 81 | } |
  | 77 | 82 |  |
  | 78 |  | if (~~empty( $page )~~ ) { |
  |  | 83 | if (empty($page)) { |
  | 79 | 84 | return false; |
  | 80 | 85 | } |
  | 81 | 86 |  |
  | 82 | 87 | $json\_header = true; |
  | 83 |  | switch (~~$page~~ ) { |
  |  | 88 | switch ($page) { |
  | 84 | 89 | case 'migration-ws-login': |
  | 85 |  | $output = wp\_json\_encode(~~$this->migration\_ws\_login()~~ ); |
  |  | 90 | $output = wp\_json\_encode($this->migration\_ws\_login()); |
  | 86 | 91 | break; |
  | 87 | 92 | case 'migration-ws-get-user': |
  | 88 |  | $output = wp\_json\_encode(~~$this->migration\_ws\_get\_user()~~ ); |
  |  | 93 | $output = wp\_json\_encode($this->migration\_ws\_get\_user()); |
  | 89 | 94 | break; |
  | 90 | 95 | case 'coo-fallback': |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L96) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L101) |  |
  | 96 | 101 | } |
  | 97 | 102 |  |
  | 98 |  | if (~~$return~~ ) { |
  |  | 103 | if ($return) { |
  | 99 | 104 | return $output; |
  | 100 | 105 | } |
  | 101 | 106 |  |
  | 102 |  | if (~~$json\_header~~ ) { |
  | 103 |  | add\_filter(~~'wp\_headers', [ $this, 'add\_json\_header' ]~~ ); |
  |  | 107 | if ($json\_header) { |
  |  | 108 | add\_filter('wp\_headers', [$this, 'add\_json\_header']); |
  | 104 | 109 | $wp->send\_headers(); |
  | 105 | 110 | } |
  | 106 | 111 |  |
  | 107 |  | echo ~~$output~~; |
  |  | 112 | echo esc\_js($output); |
  | 108 | 113 | exit; |
  | 109 | 114 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L116) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L121) |  |
  | 116 | 121 | \* @return mixed |
  | 117 | 122 | \*/ |
  | 118 |  | public function add\_json\_header( array $headers ) { |
  | 119 |  | $headers['Content-Type'] = 'application/json; charset=' . get\_bloginfo( 'charset' ); |
  |  | 123 | public function add\_json\_header(array $headers) |
  |  | 124 | { |
  |  | 125 | $headers['Content-Type'] = 'application/json; charset=' . get\_bloginfo('charset'); |
  | 120 | 126 | return $headers; |
  | 121 | 127 | } |
  | 122 | 128 |  |
  | 123 |  | protected function coo\_fallback() { |
  | 124 |  | $protocol = $this->a0\_options->get( 'force\_https\_callback', false ) ? 'https' : null; |
  |  | 129 | protected function coo\_fallback() |
  |  | 130 | { |
  |  | 131 | $protocol = $this->a0\_options->get('force\_https\_callback', false) ? 'https' : null; |
  | 125 | 132 | return sprintf( |
  | 126 | 133 | '<!DOCTYPE html><html><head><script src="%s"></script><script type="text/javascript"> |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L128) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L135) |  |
  | 128 | 135 | auth0.crossOriginAuthenticationCallback(); |
  | 129 | 136 | </script></head><body></body></html>', |
  | 130 |  | esc\_url(~~apply\_filters( 'auth0\_coo\_auth0js\_url', WPA0\_AUTH0\_JS\_CDN\_URL )~~ ), |
  | 131 |  | esc\_attr(~~$this->a0\_options->get( 'client\_id' )~~ ), |
  | 132 |  | esc\_attr(~~$this->a0\_options->get\_auth\_domain()~~ ), |
  | 133 |  | esc\_url(~~$this->a0\_options->get\_wp\_auth0\_url( $protocol )~~ ) |
  |  | 137 | esc\_url(apply\_filters('auth0\_coo\_auth0js\_url', WPA0\_AUTH0\_JS\_CDN\_URL)), |
  |  | 138 | esc\_attr($this->a0\_options->get('client\_id')), |
  |  | 139 | esc\_attr($this->a0\_options->get\_auth\_domain()), |
  |  | 140 | esc\_url($this->a0\_options->get\_wp\_auth0\_url($protocol)) |
  | 134 | 141 | ); |
  | 135 | 142 | } |
  | 136 | 143 |  |
  | 137 |  | protected function getAuthorizationHeader() { |
  |  | 144 | protected function getAuthorizationHeader() |
  |  | 145 | { |
  | 138 | 146 | // Nonce is not needed here as this is an API endpoint. |
  | 139 | 147 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L141) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L149) |  |
  | 141 | 149 | $authorization = false; |
  | 142 | 150 |  |
  | 143 |  | if (~~isset( $\_POST['access\_token'] )~~ ) { |
  |  | 151 | if (isset($\_POST['access\_token'])) { |
  | 144 | 152 | // No need to sanitize, value is returned and checked. |
  | 145 | 153 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 146 |  | $authorization = wp\_unslash(~~$\_POST['access\_token']~~ ); |
  | 147 |  | } elseif (~~function\_exists( 'getallheaders' )~~ ) { |
  |  | 154 | $authorization = wp\_unslash($\_POST['access\_token']); |
  |  | 155 | } elseif (function\_exists('getallheaders')) { |
  | 148 | 156 | $headers = getallheaders(); |
  | 149 |  | if (~~isset( $headers['Authorization'] )~~ ) { |
  |  | 157 | if (isset($headers['Authorization'])) { |
  | 150 | 158 | $authorization = $headers['Authorization']; |
  | 151 |  | } elseif (~~isset( $headers['authorization'] )~~ ) { |
  |  | 159 | } elseif (isset($headers['authorization'])) { |
  | 152 | 160 | $authorization = $headers['authorization']; |
  | 153 | 161 | } |
  | 154 |  | } elseif (~~isset( $\_SERVER['Authorization'] )~~ ) { |
  |  | 162 | } elseif (isset($\_SERVER['Authorization'])) { |
  | 155 | 163 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 156 |  | $authorization = wp\_unslash(~~$\_SERVER['Authorization']~~ ); |
  | 157 |  | } elseif (~~isset( $\_SERVER['HTTP\_AUTHORIZATION'] )~~ ) { |
  |  | 164 | $authorization = wp\_unslash($\_SERVER['Authorization']); |
  |  | 165 | } elseif (isset($\_SERVER['HTTP\_AUTHORIZATION'])) { |
  | 158 | 166 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 159 |  | $authorization = wp\_unslash(~~$\_SERVER['HTTP\_AUTHORIZATION']~~ ); |
  |  | 167 | $authorization = wp\_unslash($\_SERVER['HTTP\_AUTHORIZATION']); |
  | 160 | 168 | } |
  | 161 | 169 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L172) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L180) |  |
  | 172 | 180 | \* @see lib/scripts-js/db-login.js |
  | 173 | 181 | \*/ |
  | 174 |  | protected function migration\_ws\_login() { |
  |  | 182 | protected function migration\_ws\_login() |
  |  | 183 | { |
  | 175 | 184 | // Nonce is not needed here as this is an API endpoint. |
  | 176 | 185 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 177 | 186 |  |
  | 178 | 187 | $code = $this->check\_endpoint\_access\_error(); |
  | 179 |  | if (~~$code~~ ) { |
  | 180 |  | return $this->error\_return\_array(~~$code~~ ); |
  |  | 188 | if ($code) { |
  |  | 189 | return $this->error\_return\_array($code); |
  | 181 | 190 | } |
  | 182 | 191 |  |
  | 183 | 192 | try { |
  | 184 |  | $this->check\_endpoint\_request(~~true~~ ); |
  |  | 193 | $this->check\_endpoint\_request(true); |
  | 185 | 194 |  |
  | 186 | 195 | // Input is sanitized by core wp\_authenticate function. |
  | 187 | 196 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 188 |  | $user = wp\_authenticate( $\_POST['username'], $\_POST['password'] ); |
  | 189 |  |  |
  | 190 |  | if ( is\_wp\_error( $user ) ) { |
  | 191 |  | throw new Exception( \_\_( 'Invalid credentials', 'wp-auth0' ), 401 ); |
  | 192 |  | } |
  | 193 |  |  |
  | 194 |  | unset( $user->data->user\_pass ); |
  | 195 |  | return apply\_filters( 'auth0\_migration\_ws\_authenticated', $user ); |
  | 196 |  |  |
  | 197 |  | } catch ( Exception $e ) { |
  | 198 |  | WP\_Auth0\_ErrorLog::insert\_error( \_\_METHOD\_\_, $e ); |
  |  | 197 | $user = wp\_authenticate($\_POST['username'], $\_POST['password']); |
  |  | 198 |  |
  |  | 199 | if (is\_wp\_error($user)) { |
  |  | 200 | throw new Exception(esc\_html\_\_('Invalid credentials', 'wp-auth0'), 401); |
  |  | 201 | } |
  |  | 202 |  |
  |  | 203 | unset($user->data->user\_pass); |
  |  | 204 | return apply\_filters('auth0\_migration\_ws\_authenticated', $user); |
  |  | 205 | } catch (Exception $e) { |
  |  | 206 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $e); |
  | 199 | 207 | return [ |
  | 200 | 208 | 'status' => $e->getCode() ?: 400, |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L214) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L222) |  |
  | 214 | 222 | \* @see lib/scripts-js/db-get-user.js |
  | 215 | 223 | \*/ |
  | 216 |  | protected function migration\_ws\_get\_user() { |
  |  | 224 | protected function migration\_ws\_get\_user() |
  |  | 225 | { |
  | 217 | 226 | // Nonce is not needed here as this is an API endpoint. |
  | 218 | 227 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 219 | 228 |  |
  | 220 | 229 | $code = $this->check\_endpoint\_access\_error(); |
  | 221 |  | if (~~$code~~ ) { |
  | 222 |  | return $this->error\_return\_array(~~$code~~ ); |
  |  | 230 | if ($code) { |
  |  | 231 | return $this->error\_return\_array($code); |
  | 223 | 232 | } |
  | 224 | 233 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L228) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L237) |  |
  | 228 | 237 | // Input is sanitized by core get\_user\_by function. |
  | 229 | 238 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 230 |  | $user = get\_user\_by(~~'email', $\_POST['username']~~ ); |
  | 231 |  |  |
  | 232 |  | if (~~! $user~~ ) { |
  | 233 |  | throw new Exception(~~\_\_( 'User not found', 'wp-auth0' ), 401~~ ); |
  | 234 |  | } |
  | 235 |  |  |
  | 236 |  | $updated\_email = WP\_Auth0\_UsersRepo::get\_meta(~~$user->ID, WP\_Auth0\_Profile\_Change\_Email::UPDATED\_EMAIL~~ ); |
  | 237 |  | if (~~$updated\_email === $user->data->user\_email~~ ) { |
  |  | 239 | $user = get\_user\_by('email', $\_POST['username']); |
  |  | 240 |  |
  |  | 241 | if (!$user) { |
  |  | 242 | throw new Exception(esc\_html\_\_('User not found', 'wp-auth0'), 401); |
  |  | 243 | } |
  |  | 244 |  |
  |  | 245 | $updated\_email = WP\_Auth0\_UsersRepo::get\_meta($user->ID, WP\_Auth0\_Profile\_Change\_Email::UPDATED\_EMAIL); |
  |  | 246 | if ($updated\_email === $user->data->user\_email) { |
  | 238 | 247 | return [ |
  | 239 | 248 | 'status' => 200, |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L242) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L251) |  |
  | 242 | 251 | } |
  | 243 | 252 |  |
  | 244 |  | unset( $user->data->user\_pass ); |
  | 245 |  | return apply\_filters( 'auth0\_migration\_ws\_authenticated', $user ); |
  | 246 |  |  |
  | 247 |  | } catch ( Exception $e ) { |
  | 248 |  | WP\_Auth0\_ErrorLog::insert\_error( \_\_METHOD\_\_, $e ); |
  |  | 253 | unset($user->data->user\_pass); |
  |  | 254 | return apply\_filters('auth0\_migration\_ws\_authenticated', $user); |
  |  | 255 | } catch (Exception $e) { |
  |  | 256 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, $e); |
  | 249 | 257 | return [ |
  | 250 | 258 | 'status' => $e->getCode() ?: 400, |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L261) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L269) |  |
  | 261 | 269 | \* @return int |
  | 262 | 270 | \*/ |
  | 263 |  | private function check\_endpoint\_access\_error() { |
  |  | 271 | private function check\_endpoint\_access\_error() |
  |  | 272 | { |
  | 264 | 273 |  |
  | 265 | 274 | // Migration web service is not turned on. |
  | 266 |  | if (~~! $this->a0\_options->get( 'migration\_ws' )~~ ) { |
  |  | 275 | if (!$this->a0\_options->get('migration\_ws')) { |
  | 267 | 276 | return 403; |
  | 268 | 277 | } |
  | 269 | 278 |  |
  | 270 | 279 | // IP filtering is on and incoming IP address does not match filter. |
  | 271 |  | if (~~$this->a0\_options->get( 'migration\_ips\_filter' )~~ ) { |
  | 272 |  | $allowed\_ips = $this->a0\_options->get(~~'migration\_ips'~~ ); |
  | 273 |  | if (~~! $this->ip\_check->connection\_is\_valid( $allowed\_ips )~~ ) { |
  |  | 280 | if ($this->a0\_options->get('migration\_ips\_filter')) { |
  |  | 281 | $allowed\_ips = $this->a0\_options->get('migration\_ips'); |
  |  | 282 | if (!$this->ip\_check->connection\_is\_valid($allowed\_ips)) { |
  | 274 | 283 | return 401; |
  | 275 | 284 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L286) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L295) |  |
  | 286 | 295 | \* @throws Exception |
  | 287 | 296 | \*/ |
  | 288 |  | private function check\_endpoint\_request( $require\_password = false ) { |
  |  | 297 | private function check\_endpoint\_request($require\_password = false) |
  |  | 298 | { |
  | 289 | 299 | // Nonce is not needed here as this is an API endpoint. |
  | 290 | 300 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 291 | 301 |  |
  | 292 | 302 | $authorization = $this->getAuthorizationHeader(); |
  | 293 |  | $authorization = trim(~~str\_replace( 'Bearer ', '', $authorization )~~ ); |
  | 294 |  |  |
  | 295 |  | if (~~empty( $authorization )~~ ) { |
  | 296 |  | throw new Exception(~~\_\_( 'Unauthorized: missing authorization header', 'wp-auth0' ), 401~~ ); |
  | 297 |  | } |
  | 298 |  |  |
  | 299 |  | if (~~$authorization !== $this->a0\_options->get( 'migration\_token' )~~ ) { |
  | 300 |  | throw new Exception(~~\_\_( 'Invalid token', 'wp-auth0' ), 401~~ ); |
  | 301 |  | } |
  | 302 |  |  |
  | 303 |  | if (~~empty( $\_POST['username'] )~~ ) { |
  | 304 |  | throw new Exception(~~\_\_( 'Username is required', 'wp-auth0' )~~ ); |
  | 305 |  | } |
  | 306 |  |  |
  | 307 |  | if (~~$require\_password && empty( $\_POST['password'] )~~ ) { |
  | 308 |  | throw new Exception(~~\_\_( 'Password is required', 'wp-auth0' )~~ ); |
  |  | 303 | $authorization = trim(str\_replace('Bearer ', '', $authorization)); |
  |  | 304 |  |
  |  | 305 | if (empty($authorization)) { |
  |  | 306 | throw new Exception(esc\_html\_\_('Unauthorized: missing authorization header', 'wp-auth0'), 401); |
  |  | 307 | } |
  |  | 308 |  |
  |  | 309 | if ($authorization !== $this->a0\_options->get('migration\_token')) { |
  |  | 310 | throw new Exception(esc\_html\_\_('Invalid token', 'wp-auth0'), 401); |
  |  | 311 | } |
  |  | 312 |  |
  |  | 313 | if (empty($\_POST['username'])) { |
  |  | 314 | throw new Exception(esc\_html\_\_('Username is required', 'wp-auth0')); |
  |  | 315 | } |
  |  | 316 |  |
  |  | 317 | if ($require\_password && empty($\_POST['password'])) { |
  |  | 318 | throw new Exception(esc\_html\_\_('Password is required', 'wp-auth0')); |
  | 309 | 319 | } |
  | 310 | 320 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L319) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L329) |  |
  | 319 | 329 | \* @return array |
  | 320 | 330 | \*/ |
  | 321 |  | private function error\_return\_array( $code ) { |
  | 322 |  |  |
  | 323 |  | switch ( $code ) { |
  |  | 331 | private function error\_return\_array($code) |
  |  | 332 | { |
  |  | 333 |  |
  |  | 334 | switch ($code) { |
  | 324 | 335 | case 401: |
  | 325 | 336 | return [ |
  | 326 | 337 | 'status' => 401, |
  | 327 |  | 'error'  => ~~\_\_( 'Unauthorized', 'wp-auth0'~~ ), |
  |  | 338 | 'error'  => esc\_html\_\_('Unauthorized', 'wp-auth0'), |
  | 328 | 339 | ]; |
  | 329 | 340 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3020639#L331) | […](/browser/auth0/trunk/lib/WP_Auth0_Routes.php?rev=3114611#L342) |  |
  | 331 | 342 | return [ |
  | 332 | 343 | 'status' => 403, |
  | 333 |  | 'error'  => ~~\_\_( 'Forbidden', 'wp-auth0'~~ ), |
  |  | 344 | 'error'  => esc\_html\_\_('Forbidden', 'wp-auth0'), |
  | 334 | 345 | ]; |
  | 335 | 346 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Serializer.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Serializer.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Serializer.php")

  | [r1924242](/browser/auth0/trunk/lib/WP_Auth0_Serializer.php?rev=1924242#L1 "Show revision 1924242 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Serializer.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | class WP\_Auth0\_Serializer { |
  |  | 2 | class WP\_Auth0\_Serializer |
  |  | 3 | { |
  | 3 | 4 |  |
  | 4 |  | public static function serialize( $o ) { |
  | 5 |  | return json\_encode( $o ); |
  |  | 5 | public static function serialize($o) |
  |  | 6 | { |
  |  | 7 | return json\_encode($o); |
  | 6 | 8 | } |
  | 7 | 9 |  |
  | 8 |  | public static function unserialize( $s ) { |
  | 9 |  | if ( ! is\_string( $s ) || trim( $s ) === '' ) { |
  |  | 10 | public static function unserialize($s) |
  |  | 11 | { |
  |  | 12 | if (!is\_string($s) || trim($s) === '') { |
  | 10 | 13 | return null; |
  | 11 | 14 | } |
  | 12 | 15 |  |
  | 13 |  | if (~~$s[0] === '{'~~ ) { |
  | 14 |  | return json\_decode(~~$s~~ ); |
  |  | 16 | if ($s[0] === '{') { |
  |  | 17 | return json\_decode($s); |
  | 15 | 18 | } |
  | 16 | 19 |  |
  | 17 |  | return @unserialize(~~$s~~ ); |
  |  | 20 | return @unserialize($s); |
  | 18 | 21 | } |
  | 19 |  |  |
  | 20 | 22 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_State\_Handler.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_State_Handler.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_State_Handler.php")

  | [r1902902](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=1902902#L1 "Show revision 1902902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_State\_Handler. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=1902902#L9) | […](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=3114611#L10) |  |
  | 9 | 10 | \* Class WP\_Auth0\_State\_Handler for handling state storage and verification. |
  | 10 | 11 | \*/ |
  | 11 |  | final class WP\_Auth0\_State\_Handler extends WP\_Auth0\_Nonce\_Handler { |
  |  | 12 | final class WP\_Auth0\_State\_Handler extends WP\_Auth0\_Nonce\_Handler |
  |  | 13 | { |
  | 12 | 14 |  |
  | 13 | 15 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=1902902#L30) | […](/browser/auth0/trunk/lib/WP_Auth0_State_Handler.php?rev=3114611#L32) |  |
  | 30 | 32 | \* @return string |
  | 31 | 33 | \*/ |
  | 32 |  | public static function get\_storage\_cookie\_name() { |
  | 33 |  | return apply\_filters( 'auth0\_state\_cookie\_name', self::STATE\_COOKIE\_NAME ); |
  |  | 34 | public static function get\_storage\_cookie\_name() |
  |  | 35 | { |
  |  | 36 | return apply\_filters('auth0\_state\_cookie\_name', self::STATE\_COOKIE\_NAME); |
  | 34 | 37 | } |
  | 35 | 38 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_Users.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_Users.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_Users.php")

  | [r2271973](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | class WP\_Auth0\_Users { |
  |  | 2 | class WP\_Auth0\_Users |
  |  | 3 | { |
  | 3 | 4 |  |
  | 4 | 5 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=2271973#L9) | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611#L10) |  |
  | 9 | 10 | \* @return int|WP\_Error |
  | 10 | 11 | \*/ |
  | 11 |  | public static function create\_user( $userinfo ) { |
  |  | 12 | public static function create\_user($userinfo) |
  |  | 13 | { |
  | 12 | 14 | $email = null; |
  | 13 |  | if (~~isset( $userinfo->email )~~ ) { |
  |  | 15 | if (isset($userinfo->email)) { |
  | 14 | 16 | $email = $userinfo->email; |
  | 15 | 17 | } |
  | 16 |  | if (~~empty( $email )~~ ) { |
  |  | 18 | if (empty($email)) { |
  | 17 | 19 | $email = 'change\_this\_email@' . uniqid() . '.com'; |
  | 18 | 20 | } |
  | 19 | 21 |  |
  | 20 |  | $valid\_user = apply\_filters(~~'wpa0\_should\_create\_user', true, $userinfo~~ ); |
  | 21 |  | if (~~! $valid\_user~~ ) { |
  |  | 22 | $valid\_user = apply\_filters('wpa0\_should\_create\_user', true, $userinfo); |
  |  | 23 | if (!$valid\_user) { |
  | 22 | 24 | return -2; |
  | 23 | 25 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=2271973#L29) | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611#L31) |  |
  | 29 | 31 | $lastname  = ''; |
  | 30 | 32 |  |
  | 31 |  | if (~~isset( $userinfo->name )~~ ) { |
  |  | 33 | if (isset($userinfo->name)) { |
  | 32 | 34 | // Split the name into first- and lastname |
  | 33 |  | $names = explode(~~' ', $userinfo->name~~ ); |
  |  | 35 | $names = explode(' ', $userinfo->name); |
  | 34 | 36 |  |
  | 35 |  | if (~~count( $names ) == 1~~ ) { |
  |  | 37 | if (count($names) == 1) { |
  | 36 | 38 | $firstname = $userinfo->name; |
  | 37 |  | } elseif (~~count( $names ) == 2~~ ) { |
  |  | 39 | } elseif (count($names) == 2) { |
  | 38 | 40 | $firstname = $names[0]; |
  | 39 | 41 | $lastname  = $names[1]; |
  | 40 | 42 | } else { |
  | 41 |  | $lastname  = array\_pop(~~$names~~ ); |
  | 42 |  | $firstname = implode(~~' ', $names~~ ); |
  |  | 43 | $lastname  = array\_pop($names); |
  |  | 44 | $firstname = implode(' ', $names); |
  | 43 | 45 | } |
  | 44 | 46 | } |
  | 45 | 47 |  |
  | 46 | 48 | $username = ''; |
  | 47 |  | if (~~isset( $userinfo->username )~~ ) { |
  |  | 49 | if (isset($userinfo->username)) { |
  | 48 | 50 | $username = $userinfo->username; |
  | 49 |  | } elseif (~~isset( $userinfo->nickname )~~ ) { |
  |  | 51 | } elseif (isset($userinfo->nickname)) { |
  | 50 | 52 | $username = $userinfo->nickname; |
  | 51 | 53 | } |
  | 52 |  | if (~~empty( $username )~~ ) { |
  |  | 54 | if (empty($username)) { |
  | 53 | 55 | $username = $email; |
  | 54 | 56 | } |
  | 55 |  | while (~~username\_exists( $username )~~ ) { |
  | 56 |  | $username = $username . rand(~~0, 9~~ ); |
  |  | 57 | while (username\_exists($username)) { |
  |  | 58 | $username = $username . rand(0, 9); |
  | 57 | 59 | } |
  | 58 | 60 |  |
  | 59 | 61 | $description = ''; |
  | 60 | 62 |  |
  | 61 |  | if (~~empty( $description )~~ ) { |
  | 62 |  | if (~~isset( $userinfo->headline )~~ ) { |
  |  | 63 | if (empty($description)) { |
  |  | 64 | if (isset($userinfo->headline)) { |
  | 63 | 65 | $description = $userinfo->headline; |
  | 64 | 66 | } |
  | 65 |  | if (~~isset( $userinfo->description )~~ ) { |
  |  | 67 | if (isset($userinfo->description)) { |
  | 66 | 68 | $description = $userinfo->description; |
  | 67 | 69 | } |
  | 68 |  | if (~~isset( $userinfo->bio )~~ ) { |
  |  | 70 | if (isset($userinfo->bio)) { |
  | 69 | 71 | $description = $userinfo->bio; |
  | 70 | 72 | } |
  | 71 |  | if (~~isset( $userinfo->about )~~ ) { |
  |  | 73 | if (isset($userinfo->about)) { |
  | 72 | 74 | $description = $userinfo->about; |
  | 73 | 75 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=2271973#L84) | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611#L86) |  |
  | 84 | 86 | ]; |
  | 85 | 87 |  |
  | 86 |  | $user\_data = apply\_filters(~~'auth0\_create\_user\_data', $user\_data, $userinfo~~ ); |
  |  | 88 | $user\_data = apply\_filters('auth0\_create\_user\_data', $user\_data, $userinfo); |
  | 87 | 89 |  |
  | 88 | 90 | // Update the user |
  | 89 |  | $user\_id = wp\_insert\_user(~~$user\_data~~ ); |
  |  | 91 | $user\_id = wp\_insert\_user($user\_data); |
  | 90 | 92 |  |
  | 91 |  | if (~~! is\_numeric( $user\_id )~~ ) { |
  |  | 93 | if (!is\_numeric($user\_id)) { |
  | 92 | 94 | return $user\_id; |
  | 93 | 95 | } |
  | 94 | 96 |  |
  | 95 |  | do\_action(~~'wpa0\_user\_created', $user\_id, $email, $password, $firstname, $lastname~~ ); |
  |  | 97 | do\_action('wpa0\_user\_created', $user\_id, $email, $password, $firstname, $lastname); |
  | 96 | 98 |  |
  | 97 | 99 | // Return the user ID |
  | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=2271973#L106) | […](/browser/auth0/trunk/lib/WP_Auth0_Users.php?rev=3114611#L108) |  |
  | 106 | 108 | \* @return string |
  | 107 | 109 | \*/ |
  | 108 |  | public static function get\_strategy( $auth0\_id ) { |
  | 109 |  | if ( false === strpos( $auth0\_id, '|' ) ) { |
  |  | 110 | public static function get\_strategy($auth0\_id) |
  |  | 111 | { |
  |  | 112 | if (false === strpos($auth0\_id, '|')) { |
  | 110 | 113 | return ''; |
  | 111 | 114 | } |
  | 112 |  | $auth0\_id\_parts = explode(~~'|', $auth0\_id~~ ); |
  |  | 115 | $auth0\_id\_parts = explode('|', $auth0\_id); |
  | 113 | 116 | return $auth0\_id\_parts[0]; |
  | 114 | 117 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_UsersRepo.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_UsersRepo.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_UsersRepo.php")

  | [r2856828](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L1 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_UsersRepo. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L11) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_UsersRepo. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_UsersRepo { |
  |  | 14 | class WP\_Auth0\_UsersRepo |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L25) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L27) |  |
  | 25 | 27 | \* @param WP\_Auth0\_Options $a0\_options - Options instance used in this class. |
  | 26 | 28 | \*/ |
  | 27 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options ) { |
  |  | 29 | public function \_\_construct(WP\_Auth0\_Options $a0\_options) |
  |  | 30 | { |
  | 28 | 31 | $this->a0\_options = $a0\_options; |
  | 29 | 32 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L41) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L44) |  |
  | 41 | 44 | \* @throws WP\_Auth0\_RegistrationNotEnabledException - When registration is not turned on for this site. |
  | 42 | 45 | \*/ |
  | 43 |  | public function create( $userinfo, $token ) { |
  |  | 46 | public function create($userinfo, $token) |
  |  | 47 | { |
  | 44 | 48 |  |
  | 45 | 49 | $auth0\_sub      = $userinfo->sub; |
  | 46 |  | list($strategy) = explode(~~'|', $auth0\_sub~~ ); |
  |  | 50 | list($strategy) = explode('|', $auth0\_sub); |
  | 47 | 51 | $wp\_user        = null; |
  | 48 | 52 | $user\_id        = null; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L50) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L54) |  |
  | 50 | 54 | // Check legacy identities profile object for a DB connection. |
  | 51 | 55 | $is\_db\_connection = 'auth0' === $strategy; |
  | 52 |  | if (~~! $is\_db\_connection && ! empty( $userinfo->identities )~~ ) { |
  | 53 |  | foreach (~~$userinfo->identities as $identity~~ ) { |
  | 54 |  | if (~~'auth0' === $identity->provider~~ ) { |
  |  | 56 | if (!$is\_db\_connection && !empty($userinfo->identities)) { |
  |  | 57 | foreach ($userinfo->identities as $identity) { |
  |  | 58 | if ('auth0' === $identity->provider) { |
  | 55 | 59 | $is\_db\_connection = true; |
  | 56 | 60 | break; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L60) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L64) |  |
  | 60 | 64 |  |
  | 61 | 65 | // Email is considered verified if flagged as such, if we ignore the requirement, or if the strategy is skipped. |
  | 62 |  | $email\_verified = !~~empty( $userinfo->email\_verified~~ ) |
  | 63 |  | || $this->a0\_options->strategy\_skips\_verified\_email(~~$strategy~~ ); |
  |  | 66 | $email\_verified = !empty($userinfo->email\_verified) |
  |  | 67 | || $this->a0\_options->strategy\_skips\_verified\_email($strategy); |
  | 64 | 68 |  |
  | 65 | 69 | // WP user to join with incoming Auth0 user. |
  | 66 |  | if (~~! empty( $userinfo->email )~~ ) { |
  | 67 |  | $wp\_user = get\_user\_by(~~'email', $userinfo->email~~ ); |
  | 68 |  | } |
  | 69 |  |  |
  | 70 |  | if (~~is\_object( $wp\_user ) && $wp\_user instanceof WP\_User~~ ) { |
  |  | 70 | if (!empty($userinfo->email)) { |
  |  | 71 | $wp\_user = get\_user\_by('email', $userinfo->email); |
  |  | 72 | } |
  |  | 73 |  |
  |  | 74 | if (is\_object($wp\_user) && $wp\_user instanceof WP\_User) { |
  | 71 | 75 | // WP user exists, check if we can join. |
  | 72 | 76 | $user\_id = $wp\_user->ID; |
  | 73 | 77 |  |
  | 74 | 78 | // Cannot join a DB connection user without a verified email. |
  | 75 |  | if (~~$is\_db\_connection && ! $email\_verified~~ ) { |
  | 76 |  | throw new WP\_Auth0\_EmailNotVerifiedException(~~$userinfo, $token~~ ); |
  |  | 79 | if ($is\_db\_connection && !$email\_verified) { |
  |  | 80 | throw new WP\_Auth0\_EmailNotVerifiedException(esc\_html($userinfo), esc\_html($token)); |
  | 77 | 81 | } |
  | 78 | 82 |  |
  | 79 | 83 | // If the user has a different Auth0 ID, we cannot join it. |
  | 80 |  | $current\_auth0\_id = self::get\_meta(~~$user\_id, 'auth0\_id'~~ ); |
  | 81 |  | if (~~! empty( $current\_auth0\_id ) && $auth0\_sub !== $current\_auth0\_id~~ ) { |
  | 82 |  | throw new WP\_Auth0\_CouldNotCreateUserException(~~\_\_( 'There is a user with the same email.', 'wp-auth0' )~~ ); |
  | 83 |  | } |
  | 84 |  | } elseif (~~$this->a0\_options->is\_wp\_registration\_enabled() || $this->a0\_options->get( 'auto\_provisioning' )~~ ) { |
  |  | 84 | $current\_auth0\_id = self::get\_meta($user\_id, 'auth0\_id'); |
  |  | 85 | if (!empty($current\_auth0\_id) && $auth0\_sub !== $current\_auth0\_id) { |
  |  | 86 | throw new WP\_Auth0\_CouldNotCreateUserException(esc\_html\_\_('There is a user with the same email.', 'wp-auth0')); |
  |  | 87 | } |
  |  | 88 | } elseif ($this->a0\_options->is\_wp\_registration\_enabled() || $this->a0\_options->get('auto\_provisioning')) { |
  | 85 | 89 | // WP user does not exist and registration is allowed. |
  | 86 |  | $user\_id = WP\_Auth0\_Users::create\_user(~~$userinfo~~ ); |
  |  | 90 | $user\_id = WP\_Auth0\_Users::create\_user($userinfo); |
  | 87 | 91 |  |
  | 88 | 92 | // Check if user was created. |
  | 89 |  | if (~~is\_wp\_error( $user\_id )~~ ) { |
  | 90 |  | throw new WP\_Auth0\_CouldNotCreateUserException(~~$user\_id->get\_error\_message()~~ ); |
  | 91 |  | } elseif (~~-2 === $user\_id~~ ) { |
  |  | 93 | if (is\_wp\_error($user\_id)) { |
  |  | 94 | throw new WP\_Auth0\_CouldNotCreateUserException(esc\_html($user\_id->get\_error\_message())); |
  |  | 95 | } elseif (-2 === $user\_id) { |
  | 92 | 96 | // Registration rejected by wpa0\_should\_create\_user filter in WP\_Auth0\_Users::create\_user(). |
  | 93 |  | throw new WP\_Auth0\_CouldNotCreateUserException(~~\_\_( 'Registration rejected.', 'wp-auth0' )~~ ); |
  | 94 |  | } elseif (~~$user\_id < 0~~ ) { |
  |  | 97 | throw new WP\_Auth0\_CouldNotCreateUserException(esc\_html\_\_('Registration rejected.', 'wp-auth0')); |
  |  | 98 | } elseif ($user\_id < 0) { |
  | 95 | 99 | // Registration failed for another reason. |
  | 96 | 100 | throw new WP\_Auth0\_CouldNotCreateUserException(); |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L101) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L105) |  |
  | 101 | 105 | } |
  | 102 | 106 |  |
  | 103 |  | $this->update\_auth0\_object(~~$user\_id, $userinfo~~ ); |
  |  | 107 | $this->update\_auth0\_object($user\_id, $userinfo); |
  | 104 | 108 | return $user\_id; |
  | 105 | 109 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L112) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L116) |  |
  | 112 | 116 | \* @return null|WP\_User |
  | 113 | 117 | \*/ |
  | 114 |  | public function find\_auth0\_user( $id ) { |
  | 115 |  | global $wpdb; |
  | 116 |  |  |
  | 117 |  | if ( empty( $id ) ) { |
  | 118 |  | WP\_Auth0\_ErrorLog::insert\_error( \_\_METHOD\_\_, \_\_( 'Empty user id', 'wp-auth0' ) ); |
  |  | 118 | public function find\_auth0\_user($id) |
  |  | 119 | { |
  |  | 120 | global $wpdb; |
  |  | 121 |  |
  |  | 122 | if (empty($id)) { |
  |  | 123 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_, esc\_html\_\_('Empty user id', 'wp-auth0')); |
  | 119 | 124 |  |
  | 120 | 125 | return null; |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L128) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L133) |  |
  | 128 | 133 | \* @param string $id The Auth0 ID. |
  | 129 | 134 | \*/ |
  | 130 |  | $check = apply\_filters(~~'find\_auth0\_user', null, $id~~ ); |
  | 131 |  | if (~~$check instanceof WP\_User~~ ) { |
  |  | 135 | $check = apply\_filters('find\_auth0\_user', null, $id); |
  |  | 136 | if ($check instanceof WP\_User) { |
  | 132 | 137 | return $check; |
  | 133 | 138 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L143) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L148) |  |
  | 143 | 148 | ]; |
  | 144 | 149 |  |
  | 145 |  | $users = get\_users(~~$query~~ ); |
  | 146 |  |  |
  | 147 |  | if (~~$users === []~~ ) { |
  | 148 |  | WP\_Auth0\_ErrorLog::insert\_error(~~\_\_METHOD\_\_ . ' => get\_users() ', \_\_( 'User not found', 'wp-auth0' )~~ ); |
  |  | 150 | $users = get\_users($query); |
  |  | 151 |  |
  |  | 152 | if ($users === []) { |
  |  | 153 | WP\_Auth0\_ErrorLog::insert\_error(\_\_METHOD\_\_ . ' => get\_users() ', esc\_html\_\_('User not found', 'wp-auth0')); |
  | 149 | 154 | return null; |
  | 150 | 155 | } |
  | 151 | 156 |  |
  | 152 |  | return !~~empty( $users[0]~~ ) ? $users[0] : null; |
  |  | 157 | return !empty($users[0]) ? $users[0] : null; |
  | 153 | 158 | } |
  | 154 | 159 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L159) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L164) |  |
  | 159 | 164 | \* @param stdClass $userinfo - User profile object from Auth0. |
  | 160 | 165 | \*/ |
  | 161 |  | public function update\_auth0\_object( $user\_id, $userinfo ) { |
  | 162 |  | $auth0\_user\_id = isset( $userinfo->user\_id ) ? $userinfo->user\_id : $userinfo->sub; |
  | 163 |  | self::update\_meta( $user\_id, 'auth0\_id', $auth0\_user\_id ); |
  | 164 |  |  |
  | 165 |  | $userinfo\_encoded = WP\_Auth0\_Serializer::serialize( $userinfo ); |
  | 166 |  | $userinfo\_encoded = wp\_slash( $userinfo\_encoded ); |
  | 167 |  | self::update\_meta( $user\_id, 'auth0\_obj', $userinfo\_encoded ); |
  | 168 |  |  |
  | 169 |  | self::update\_meta( $user\_id, 'last\_update', date( 'c' ) ); |
  |  | 166 | public function update\_auth0\_object($user\_id, $userinfo) |
  |  | 167 | { |
  |  | 168 | $auth0\_user\_id = isset($userinfo->user\_id) ? $userinfo->user\_id : $userinfo->sub; |
  |  | 169 | self::update\_meta($user\_id, 'auth0\_id', $auth0\_user\_id); |
  |  | 170 |  |
  |  | 171 | $userinfo\_encoded = WP\_Auth0\_Serializer::serialize($userinfo); |
  |  | 172 | $userinfo\_encoded = wp\_slash($userinfo\_encoded); |
  |  | 173 | self::update\_meta($user\_id, 'auth0\_obj', $userinfo\_encoded); |
  |  | 174 |  |
  |  | 175 | self::update\_meta($user\_id, 'last\_update', date('c')); |
  | 170 | 176 | } |
  | 171 | 177 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L180) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L186) |  |
  | 180 | 186 | \* @since 3.8.0 |
  | 181 | 187 | \*/ |
  | 182 |  | public static function get\_meta( $user\_id, $key ) { |
  |  | 188 | public static function get\_meta($user\_id, $key) |
  |  | 189 | { |
  | 183 | 190 |  |
  | 184 | 191 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L190) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L197) |  |
  | 190 | 197 | \* @param string  $key     The meta key. |
  | 191 | 198 | \*/ |
  | 192 |  | $check = apply\_filters(~~'auth0\_get\_meta', null, $user\_id, $key~~ ); |
  | 193 |  | if (~~$check !== null~~ ) { |
  |  | 199 | $check = apply\_filters('auth0\_get\_meta', null, $user\_id, $key); |
  |  | 200 | if ($check !== null) { |
  | 194 | 201 | return $check; |
  | 195 | 202 | } |
  | 196 | 203 |  |
  | 197 | 204 | global $wpdb; |
  | 198 |  | return get\_user\_meta(~~$user\_id, $wpdb->prefix . $key, true~~ ); |
  |  | 205 | return get\_user\_meta($user\_id, $wpdb->prefix . $key, true); |
  | 199 | 206 | } |
  | 200 | 207 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L210) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L217) |  |
  | 210 | 217 | \* @since 3.11.0 |
  | 211 | 218 | \*/ |
  | 212 |  | public static function update\_meta( $user\_id, $key, $value ) { |
  |  | 219 | public static function update\_meta($user\_id, $key, $value) |
  |  | 220 | { |
  | 213 | 221 |  |
  | 214 | 222 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L222) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L230) |  |
  | 222 | 230 | \* @param mixed   $value   The meta value. |
  | 223 | 231 | \*/ |
  | 224 |  | $check = apply\_filters(~~'auth0\_update\_meta', null, $user\_id, $key, $value~~ ); |
  | 225 |  | if (~~$check !== null~~ ) { |
  |  | 232 | $check = apply\_filters('auth0\_update\_meta', null, $user\_id, $key, $value); |
  |  | 233 | if ($check !== null) { |
  | 226 | 234 | return (bool) $check; |
  | 227 | 235 | } |
  | 228 | 236 |  |
  | 229 | 237 | global $wpdb; |
  | 230 |  | return update\_user\_meta(~~$user\_id, $wpdb->prefix . $key, $value~~ ); |
  |  | 238 | return update\_user\_meta($user\_id, $wpdb->prefix . $key, $value); |
  | 231 | 239 | } |
  | 232 | 240 |  |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L241) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L249) |  |
  | 241 | 249 | \* @since 3.11.0 |
  | 242 | 250 | \*/ |
  | 243 |  | public static function delete\_meta( $user\_id, $key ) { |
  |  | 251 | public static function delete\_meta($user\_id, $key) |
  |  | 252 | { |
  | 244 | 253 |  |
  | 245 | 254 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=2856828#L252) | […](/browser/auth0/trunk/lib/WP_Auth0_UsersRepo.php?rev=3114611#L261) |  |
  | 252 | 261 | \* @param string  $key     The meta key. |
  | 253 | 262 | \*/ |
  | 254 |  | $check = apply\_filters(~~'auth0\_delete\_meta', null, $user\_id, $key~~ ); |
  | 255 |  | if (~~$check !== null~~ ) { |
  |  | 263 | $check = apply\_filters('auth0\_delete\_meta', null, $user\_id, $key); |
  |  | 264 | if ($check !== null) { |
  | 256 | 265 | return (bool) $check; |
  | 257 | 266 | } |
  | 258 | 267 | global $wpdb; |
  | 259 |  | return delete\_user\_meta(~~$user\_id, $wpdb->prefix . $key~~ ); |
  |  | 268 | return delete\_user\_meta($user\_id, $wpdb->prefix . $key); |
  | 260 | 269 | } |
  | 261 | 270 | } |
* ## [auth0/trunk/lib/WP\_Auth0\_WooCommerceOverrides.php](/changeset/3114611/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php "Show the changeset 3114611 restricted to auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php")

  | [r2310480](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L1 "Show revision 2310480 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Class WP\_Auth0\_WooCommerceOverrides class. |
  | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L11) | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_WooCommerceOverrides. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_WooCommerceOverrides { |
  |  | 14 | class WP\_Auth0\_WooCommerceOverrides |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L25) | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L27) |  |
  | 25 | 27 | \* @param WP\_Auth0\_Options $options - WP\_Auth0\_Options instance. |
  | 26 | 28 | \*/ |
  | 27 |  | public function \_\_construct( WP\_Auth0\_Options $options ) { |
  |  | 29 | public function \_\_construct(WP\_Auth0\_Options $options) |
  |  | 30 | { |
  | 28 | 31 | $this->options = $options; |
  | 29 | 32 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L34) | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L37) |  |
  | 34 | 37 | \* @param string $redirect\_page - Page slug to redirect to after logging in. |
  | 35 | 38 | \*/ |
  | 36 |  | private function render\_login\_form( $redirect\_page ) { |
  |  | 39 | private function render\_login\_form($redirect\_page) |
  |  | 40 | { |
  | 37 | 41 | wp\_auth0\_login\_enqueue\_scripts(); |
  | 38 |  | if (~~$this->options->get( 'auto\_login', false )~~ ) { |
  |  | 42 | if ($this->options->get('auto\_login', false)) { |
  | 39 | 43 | // Redirecting to WordPress login page. |
  | 40 |  | $redirect\_url = get\_permalink(~~wc\_get\_page\_id( $redirect\_page )~~ ); |
  | 41 |  | $login\_url    = wp\_login\_url(~~$redirect\_url~~ ); |
  |  | 44 | $redirect\_url = get\_permalink(wc\_get\_page\_id($redirect\_page)); |
  |  | 45 | $login\_url    = wp\_login\_url($redirect\_url); |
  | 42 | 46 |  |
  | 43 |  | ~~printf( "<a class='button' href='%s'>%s</a>", $login\_url, \_\_( 'Login', 'wp-auth0' )~~ ); |
  |  | 47 | echo wp\_kses(sprintf("<a class='button' href='%s'>%s</a>", $login\_url, esc\_html\_\_('Login', 'wp-auth0')), ['a' => ['class' => true, 'href' => true]]); |
  | 44 | 48 | } else { |
  | 45 |  | echo wp\_~~auth0\_render\_lock\_form( ''~~ ); |
  |  | 49 | echo wp\_kses\_post(wp\_auth0\_render\_lock\_form('')); |
  | 46 | 50 | } |
  | 47 | 51 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L54) | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L58) |  |
  | 54 | 58 | \* @return mixed |
  | 55 | 59 | \*/ |
  | 56 |  | public function override\_woocommerce\_checkout\_login\_form( $html ) { |
  |  | 60 | public function override\_woocommerce\_checkout\_login\_form($html) |
  |  | 61 | { |
  | 57 | 62 |  |
  | 58 |  | if (~~! wp\_auth0\_is\_ready()~~ ) { |
  |  | 63 | if (!wp\_auth0\_is\_ready()) { |
  | 59 | 64 | return $html; |
  | 60 | 65 | } |
  | 61 | 66 |  |
  | 62 |  | $this->render\_login\_form(~~'checkout'~~ ); |
  |  | 67 | $this->render\_login\_form('checkout'); |
  | 63 | 68 |  |
  | 64 |  | if (~~wp\_auth0\_can\_show\_wp\_login\_form()~~ ) { |
  | 65 |  | echo ~~'<style>.woocommerce-checkout .woocommerce-info{display:block;}</style>'~~; |
  |  | 69 | if (wp\_auth0\_can\_show\_wp\_login\_form()) { |
  |  | 70 | echo wp\_kses('<style>.woocommerce-checkout .woocommerce-info{display:block;}</style>', ['style' => []]); |
  | 66 | 71 | } |
  | 67 | 72 | } |
  | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=2310480#L74) | […](/browser/auth0/trunk/lib/WP_Auth0_WooCommerceOverrides.php?rev=3114611#L79) |  |
  | 74 | 79 | \* @return mixed |
  | 75 | 80 | \*/ |
  | 76 |  | public function override\_woocommerce\_login\_form( $html ) { |
  |  | 81 | public function override\_woocommerce\_login\_form($html) |
  |  | 82 | { |
  | 77 | 83 |  |
  | 78 |  | if (~~! wp\_auth0\_is\_ready()~~ ) { |
  |  | 84 | if (!wp\_auth0\_is\_ready()) { |
  | 79 | 85 | return $html; |
  | 80 | 86 | } |
  | 81 | 87 |  |
  | 82 |  | $this->render\_login\_form(~~'myaccount'~~ ); |
  |  | 88 | $this->render\_login\_form('myaccount'); |
  | 83 | 89 | } |
  | 84 | 90 | } |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin.php")

  | [r2271973](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Admin { |
  |  | 3 | class WP\_Auth0\_Admin |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 |  | const OPT\_SECTIONS = [~~'basic', 'features', 'appearance', 'advanced'~~ ]; |
  |  | 6 | const OPT\_SECTIONS = ['basic', 'features', 'appearance', 'advanced']; |
  | 6 | 7 |  |
  | 7 | 8 | protected $a0\_options; |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L11) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L12) |  |
  | 11 | 12 | protected $sections = []; |
  | 12 | 13 |  |
  | 13 |  | public function \_\_construct( WP\_Auth0\_Options $a0\_options, WP\_Auth0\_Routes $router ) { |
  |  | 14 | public function \_\_construct(WP\_Auth0\_Options $a0\_options, WP\_Auth0\_Routes $router) |
  |  | 15 | { |
  | 14 | 16 | $this->a0\_options = $a0\_options; |
  | 15 | 17 | $this->router     = $router; |
  | 16 | 18 |  |
  | 17 | 19 | $this->sections = [ |
  | 18 |  | 'basic'      => new WP\_Auth0\_Admin\_Basic(~~$this->a0\_options~~ ), |
  | 19 |  | 'features'   => new WP\_Auth0\_Admin\_Features(~~$this->a0\_options~~ ), |
  | 20 |  | 'appearance' => new WP\_Auth0\_Admin\_Appearance(~~$this->a0\_options~~ ), |
  | 21 |  | 'advanced'   => new WP\_Auth0\_Admin\_Advanced(~~$this->a0\_options, $this->router~~ ), |
  |  | 20 | 'basic'      => new WP\_Auth0\_Admin\_Basic($this->a0\_options), |
  |  | 21 | 'features'   => new WP\_Auth0\_Admin\_Features($this->a0\_options), |
  |  | 22 | 'appearance' => new WP\_Auth0\_Admin\_Appearance($this->a0\_options), |
  |  | 23 | 'advanced'   => new WP\_Auth0\_Admin\_Advanced($this->a0\_options, $this->router), |
  | 22 | 24 | ]; |
  | 23 | 25 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L26) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L28) |  |
  | 26 | 28 | \* Enqueue scripts for all Auth0 wp-admin pages |
  | 27 | 29 | \*/ |
  | 28 |  | public function admin\_enqueue() { |
  |  | 30 | public function admin\_enqueue() |
  |  | 31 | { |
  | 29 | 32 | // Nonce is not needed here as this is not processing form data. |
  | 30 | 33 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | 31 | 34 |  |
  | 32 | 35 | // Register admin styles |
  | 33 |  | wp\_register\_style(~~'wpa0\_admin\_initial\_setup', WPA0\_PLUGIN\_CSS\_URL . 'initial-setup.css', false, WPA0\_VERSION~~ ); |
  |  | 36 | wp\_register\_style('wpa0\_admin\_initial\_setup', WPA0\_PLUGIN\_CSS\_URL . 'initial-setup.css', false, WPA0\_VERSION); |
  | 34 | 37 |  |
  | 35 | 38 | // Register admin scripts |
  | 36 |  | wp\_register\_script(~~'wpa0\_async', WPA0\_PLUGIN\_LIB\_URL . 'async.min.js', false, WPA0\_VERSION~~ ); |
  | 37 |  | wp\_register\_script(~~'wpa0\_admin', WPA0\_PLUGIN\_JS\_URL . 'admin.js', [ 'jquery' ], WPA0\_VERSION~~ ); |
  |  | 39 | wp\_register\_script('wpa0\_async', WPA0\_PLUGIN\_LIB\_URL . 'async.min.js', false, WPA0\_VERSION, true); |
  |  | 40 | wp\_register\_script('wpa0\_admin', WPA0\_PLUGIN\_JS\_URL . 'admin.js', ['jquery'], WPA0\_VERSION, true); |
  | 38 | 41 | wp\_localize\_script( |
  | 39 | 42 | 'wpa0\_admin', |
  | 40 | 43 | 'wpa0', |
  | 41 | 44 | [ |
  | 42 |  | 'media\_title'             => ~~\_\_( 'Choose your icon', 'wp-auth0'~~ ), |
  | 43 |  | 'media\_button'            => ~~\_\_( 'Choose icon', 'wp-auth0'~~ ), |
  | 44 |  | 'ajax\_working'            => ~~\_\_( 'Working ...', 'wp-auth0'~~ ), |
  | 45 |  | 'ajax\_done'               => ~~\_\_( 'Done!', 'wp-auth0'~~ ), |
  | 46 |  | 'refresh\_prompt'          => ~~\_\_( 'Save or refresh this page to see changes.', 'wp-auth0'~~ ), |
  | 47 |  | 'clear\_cache\_nonce'       => wp\_create\_nonce(~~'auth0\_delete\_cache\_transient'~~ ), |
  | 48 |  | 'rotate\_token\_nonce'      => wp\_create\_nonce(~~WP\_Auth0\_Admin\_Advanced::ROTATE\_TOKEN\_NONCE\_ACTION~~ ), |
  | 49 |  | 'form\_confirm\_submit\_msg' => ~~\_\_( 'Are you sure?', 'wp-auth0'~~ ), |
  | 50 |  | 'ajax\_url'                => admin\_url(~~'admin-ajax.php'~~ ), |
  |  | 45 | 'media\_title'             => esc\_html\_\_('Choose your icon', 'wp-auth0'), |
  |  | 46 | 'media\_button'            => esc\_html\_\_('Choose icon', 'wp-auth0'), |
  |  | 47 | 'ajax\_working'            => esc\_html\_\_('Working ...', 'wp-auth0'), |
  |  | 48 | 'ajax\_done'               => esc\_html\_\_('Done!', 'wp-auth0'), |
  |  | 49 | 'refresh\_prompt'          => esc\_html\_\_('Save or refresh this page to see changes.', 'wp-auth0'), |
  |  | 50 | 'clear\_cache\_nonce'       => wp\_create\_nonce('auth0\_delete\_cache\_transient'), |
  |  | 51 | 'rotate\_token\_nonce'      => wp\_create\_nonce(WP\_Auth0\_Admin\_Advanced::ROTATE\_TOKEN\_NONCE\_ACTION), |
  |  | 52 | 'form\_confirm\_submit\_msg' => esc\_html\_\_('Are you sure?', 'wp-auth0'), |
  |  | 53 | 'ajax\_url'                => admin\_url('admin-ajax.php'), |
  | 51 | 54 | ] |
  | 52 | 55 | ); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L54) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L57) |  |
  | 54 | 57 | // Only checking the value, not processing. |
  | 55 | 58 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
  | 56 |  | $wpa0\_curr\_page = !~~empty( $\_REQUEST['page'] ) ? wp\_unslash( $\_REQUEST['page']~~ ) : ''; |
  | 57 |  | $wpa0\_pages     = [~~'wpa0', 'wpa0-errors', 'wpa0-import-settings', 'wpa0-setup'~~ ]; |
  | 58 |  | if (~~! in\_array( $wpa0\_curr\_page, $wpa0\_pages )~~ ) { |
  |  | 59 | $wpa0\_curr\_page = !empty($\_REQUEST['page']) ? wp\_unslash($\_REQUEST['page']) : ''; |
  |  | 60 | $wpa0\_pages     = ['wpa0', 'wpa0-errors', 'wpa0-import-settings', 'wpa0-setup']; |
  |  | 61 | if (!in\_array($wpa0\_curr\_page, $wpa0\_pages)) { |
  | 59 | 62 | return false; |
  | 60 | 63 | } |
  | 61 | 64 |  |
  | 62 |  | wp\_enqueue\_script(~~'wpa0\_admin'~~ ); |
  | 63 |  | wp\_enqueue\_script(~~'wpa0\_async'~~ ); |
  |  | 65 | wp\_enqueue\_script('wpa0\_admin'); |
  |  | 66 | wp\_enqueue\_script('wpa0\_async'); |
  | 64 | 67 |  |
  | 65 |  | if (~~'wpa0' === $wpa0\_curr\_page~~ ) { |
  |  | 68 | if ('wpa0' === $wpa0\_curr\_page) { |
  | 66 | 69 | wp\_enqueue\_media(); |
  | 67 |  | wp\_enqueue\_style(~~'media'~~ ); |
  |  | 70 | wp\_enqueue\_style('media'); |
  | 68 | 71 | } |
  | 69 | 72 |  |
  | 70 |  | wp\_enqueue\_style(~~'wpa0\_admin\_initial\_setup'~~ ); |
  |  | 73 | wp\_enqueue\_style('wpa0\_admin\_initial\_setup'); |
  | 71 | 74 | return true; |
  | 72 | 75 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L74) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L77) |  |
  | 74 | 77 | } |
  | 75 | 78 |  |
  | 76 |  | public function init\_admin() { |
  |  | 79 | public function init\_admin() |
  |  | 80 | { |
  | 77 | 81 |  |
  | 78 |  | foreach (~~$this->sections as $section~~ ) { |
  |  | 82 | foreach ($this->sections as $section) { |
  | 79 | 83 | $section->init(); |
  | 80 | 84 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L84) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L88) |  |
  | 84 | 88 | $this->a0\_options->get\_options\_name(), |
  | 85 | 89 | [ |
  | 86 |  | 'sanitize\_callback' => [~~$this, 'input\_validator'~~ ], |
  |  | 90 | 'sanitize\_callback' => [$this, 'input\_validator'], |
  | 87 | 91 | ] |
  | 88 | 92 | ); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L97) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L101) |  |
  | 97 | 101 | \* @return mixed |
  | 98 | 102 | \*/ |
  | 99 |  | public function input\_validator( array $input ) { |
  |  | 103 | public function input\_validator(array $input) |
  |  | 104 | { |
  | 100 | 105 | $constant\_keys = $this->a0\_options->get\_all\_constant\_keys(); |
  | 101 | 106 |  |
  | 102 | 107 | // Look for and set constant overrides so validation is still possible. |
  | 103 |  | foreach (~~$constant\_keys as $key~~ ) { |
  | 104 |  | $input[~~$key ] = $this->a0\_options->get\_constant\_val( $key~~ ); |
  |  | 108 | foreach ($constant\_keys as $key) { |
  |  | 109 | $input[$key] = $this->a0\_options->get\_constant\_val($key); |
  | 105 | 110 | } |
  | 106 | 111 |  |
  | 107 |  | $option\_keys = $this->a0\_options->get\_defaults(~~true~~ ); |
  |  | 112 | $option\_keys = $this->a0\_options->get\_defaults(true); |
  | 108 | 113 |  |
  | 109 | 114 | // Look for custom settings fields. |
  | 110 | 115 | $custom\_opts = []; |
  | 111 |  | foreach (~~self::OPT\_SECTIONS as $section~~ ) { |
  | 112 |  | $custom\_opts = array\_merge(~~$custom\_opts, apply\_filters( 'auth0\_settings\_fields', [], $section )~~ ); |
  |  | 116 | foreach (self::OPT\_SECTIONS as $section) { |
  |  | 117 | $custom\_opts = array\_merge($custom\_opts, apply\_filters('auth0\_settings\_fields', [], $section)); |
  | 113 | 118 | } |
  | 114 | 119 |  |
  | 115 | 120 | // Merge in any custom setting option keys. |
  | 116 |  | foreach (~~$custom\_opts as $custom\_opt~~ ) { |
  | 117 |  | if (~~$custom\_opt && $custom\_opt['opt']~~ ) { |
  |  | 121 | foreach ($custom\_opts as $custom\_opt) { |
  |  | 122 | if ($custom\_opt && $custom\_opt['opt']) { |
  | 118 | 123 | $option\_keys[] = $custom\_opt['opt']; |
  | 119 | 124 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L121) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L126) |  |
  | 121 | 126 |  |
  | 122 | 127 | // Remove unknown keys. |
  | 123 |  | foreach (~~$input as $key => $val~~ ) { |
  | 124 |  | if (~~! in\_array( $key, $option\_keys )~~ ) { |
  | 125 |  | unset(~~$input[ $key ]~~ ); |
  |  | 128 | foreach ($input as $key => $val) { |
  |  | 129 | if (!in\_array($key, $option\_keys)) { |
  |  | 130 | unset($input[$key]); |
  | 126 | 131 | } |
  | 127 | 132 | } |
  | 128 | 133 |  |
  | 129 |  | foreach (~~$this->sections as $name => $section~~ ) { |
  | 130 |  | $input = $section->input\_validator(~~$input~~ ); |
  |  | 134 | foreach ($this->sections as $name => $section) { |
  |  | 135 | $input = $section->input\_validator($input); |
  | 131 | 136 | } |
  | 132 | 137 |  |
  | 133 | 138 | // Remove constant overrides so they are not saved to the database. |
  | 134 |  | foreach (~~$constant\_keys as $key~~ ) { |
  | 135 |  | unset(~~$input[ $key ]~~ ); |
  |  | 139 | foreach ($constant\_keys as $key) { |
  |  | 140 | unset($input[$key]); |
  | 136 | 141 | } |
  | 137 | 142 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=2271973#L139) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin.php?rev=3114611#L144) |  |
  | 139 | 144 | } |
  | 140 | 145 |  |
  | 141 |  | public function render\_settings\_page() { |
  |  | 146 | public function render\_settings\_page() |
  |  | 147 | { |
  | 142 | 148 | include WPA0\_PLUGIN\_DIR . 'templates/settings.php'; |
  | 143 | 149 | } |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin\_Advanced.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php")

  | [r3020639](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Admin\_Advanced. |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L12) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L13) |  |
  | 12 | 13 | \* All setting fields and validations for wp-admin > Auth0 > Settings > Advanced tab. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Admin\_Advanced extends WP\_Auth0\_Admin\_Generic { |
  |  | 15 | class WP\_Auth0\_Admin\_Advanced extends WP\_Auth0\_Admin\_Generic |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L34) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L36) |  |
  | 34 | 36 | \* @param WP\_Auth0\_Routes  $router - WP\_Auth0\_Routes instance. |
  | 35 | 37 | \*/ |
  | 36 |  | public function \_\_construct( WP\_Auth0\_Options $options, WP\_Auth0\_Routes $router ) { |
  | 37 |  | parent::\_\_construct( $options ); |
  |  | 38 | public function \_\_construct(WP\_Auth0\_Options $options, WP\_Auth0\_Routes $router) |
  |  | 39 | { |
  |  | 40 | parent::\_\_construct($options); |
  | 38 | 41 | $this->router                = $router; |
  | 39 | 42 | $this->actions\_middlewares[] = 'migration\_ws\_validation'; |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L47) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L50) |  |
  | 47 | 50 | \* @see \WP\_Auth0\_Admin\_Generic::init\_option\_section |
  | 48 | 51 | \*/ |
  | 49 |  | public function init() { |
  |  | 52 | public function init() |
  |  | 53 | { |
  | 50 | 54 | $options = [ |
  | 51 | 55 | [ |
  | 52 |  | 'name'     => ~~\_\_( 'Require Verified Email', 'wp-auth0'~~ ), |
  |  | 56 | 'name'     => esc\_html\_\_('Require Verified Email', 'wp-auth0'), |
  | 53 | 57 | 'opt'      => 'requires\_verified\_email', |
  | 54 | 58 | 'id'       => 'wpa0\_verified\_email', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L56) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L60) |  |
  | 56 | 60 | ], |
  | 57 | 61 | [ |
  | 58 |  | 'name'     => ~~\_\_( 'Skip Strategies', 'wp-auth0'~~ ), |
  |  | 62 | 'name'     => esc\_html\_\_('Skip Strategies', 'wp-auth0'), |
  | 59 | 63 | 'opt'      => 'skip\_strategies', |
  | 60 | 64 | 'id'       => 'wpa0\_skip\_strategies', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L62) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L66) |  |
  | 62 | 66 | ], |
  | 63 | 67 | [ |
  | 64 |  | 'name'     => ~~\_\_( 'Remember User Session', 'wp-auth0'~~ ), |
  |  | 68 | 'name'     => esc\_html\_\_('Remember User Session', 'wp-auth0'), |
  | 65 | 69 | 'opt'      => 'remember\_users\_session', |
  | 66 | 70 | 'id'       => 'wpa0\_remember\_users\_session', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L68) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L72) |  |
  | 68 | 72 | ], |
  | 69 | 73 | [ |
  | 70 |  | 'name'     => ~~\_\_( 'Login Redirection URL', 'wp-auth0'~~ ), |
  |  | 74 | 'name'     => esc\_html\_\_('Login Redirection URL', 'wp-auth0'), |
  | 71 | 75 | 'opt'      => 'default\_login\_redirection', |
  | 72 | 76 | 'id'       => 'wpa0\_default\_login\_redirection', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L74) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L78) |  |
  | 74 | 78 | ], |
  | 75 | 79 | [ |
  | 76 |  | 'name'     => ~~\_\_( 'Force HTTPS Callback', 'wp-auth0'~~ ), |
  |  | 80 | 'name'     => esc\_html\_\_('Force HTTPS Callback', 'wp-auth0'), |
  | 77 | 81 | 'opt'      => 'force\_https\_callback', |
  | 78 | 82 | 'id'       => 'wpa0\_force\_https\_callback', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L80) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L84) |  |
  | 80 | 84 | ], |
  | 81 | 85 | [ |
  | 82 |  | 'name'     => ~~\_\_( 'Auto Provisioning', 'wp-auth0'~~ ), |
  |  | 86 | 'name'     => esc\_html\_\_('Auto Provisioning', 'wp-auth0'), |
  | 83 | 87 | 'opt'      => 'auto\_provisioning', |
  | 84 | 88 | 'id'       => 'wpa0\_auto\_provisioning', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L86) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L90) |  |
  | 86 | 90 | ], |
  | 87 | 91 | [ |
  | 88 |  | 'name'     => ~~\_\_( 'User Migration Endpoints', 'wp-auth0'~~ ), |
  |  | 92 | 'name'     => esc\_html\_\_('User Migration Endpoints', 'wp-auth0'), |
  | 89 | 93 | 'opt'      => 'migration\_ws', |
  | 90 | 94 | 'id'       => 'wpa0\_migration\_ws', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L92) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L96) |  |
  | 92 | 96 | ], |
  | 93 | 97 | [ |
  | 94 |  | 'name'     => ~~\_\_( 'Migration IPs Whitelist', 'wp-auth0'~~ ), |
  |  | 98 | 'name'     => esc\_html\_\_('Migration IPs Whitelist', 'wp-auth0'), |
  | 95 | 99 | 'opt'      => 'migration\_ips\_filter', |
  | 96 | 100 | 'id'       => 'wpa0\_migration\_ws\_ips\_filter', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L104) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L108) |  |
  | 104 | 108 | ], |
  | 105 | 109 | [ |
  | 106 |  | 'name'     => ~~\_\_( 'Valid Proxy IP', 'wp-auth0'~~ ), |
  |  | 110 | 'name'     => esc\_html\_\_('Valid Proxy IP', 'wp-auth0'), |
  | 107 | 111 | 'opt'      => 'valid\_proxy\_ip', |
  | 108 | 112 | 'id'       => 'wpa0\_valid\_proxy\_ip', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L110) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L114) |  |
  | 110 | 114 | ], |
  | 111 | 115 | [ |
  | 112 |  | 'name'     => ~~\_\_( 'Cookie Domain', 'wp-auth0'~~ ), |
  |  | 116 | 'name'     => esc\_html\_\_('Cookie Domain', 'wp-auth0'), |
  | 113 | 117 | 'opt'      => 'cookie\_domain', |
  | 114 | 118 | 'id'       => 'wpa0\_cookie\_domain', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L116) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L120) |  |
  | 116 | 120 | ], |
  | 117 | 121 | [ |
  | 118 |  | 'name'     => ~~\_\_( 'Disable Auth0 logging in Wordpress', 'wp-auth0'~~ ), |
  |  | 122 | 'name'     => esc\_html\_\_('Disable Auth0 logging in Wordpress', 'wp-auth0'), |
  | 119 | 123 | 'opt'      => 'disable\_logging', |
  | 120 | 124 | 'id'       => 'wpa0\_disable\_logging', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L123) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L127) |  |
  | 123 | 127 | ]; |
  | 124 | 128 |  |
  | 125 |  | $this->init\_option\_section(~~'', 'advanced', $options~~ ); |
  |  | 129 | $this->init\_option\_section('', 'advanced', $options); |
  | 126 | 130 | } |
  | 127 | 131 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L135) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L139) |  |
  | 135 | 139 | \* @see add\_settings\_field() |
  | 136 | 140 | \*/ |
  | 137 |  | public function render\_verified\_email( $args = [] ) { |
  | 138 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'], 'wpa0\_skip\_strategies' ); |
  | 139 |  | $this->render\_field\_description( |
  | 140 |  | \_\_( 'Require new users to both provide and verify their email before logging in. ', 'wp-auth0' ) . |
  | 141 |  | \_\_( 'An email address is verified manually by an email from Auth0 or automatically by the provider. ', 'wp-auth0' ) . |
  | 142 |  | \_\_( 'This will disallow logins from social connections that do not provide email (like Twitter)', 'wp-auth0' ) |
  |  | 141 | public function render\_verified\_email($args = []) |
  |  | 142 | { |
  |  | 143 | $this->render\_switch($args['label\_for'], $args['opt\_name'], 'wpa0\_skip\_strategies'); |
  |  | 144 | $this->render\_field\_description( |
  |  | 145 | esc\_html\_\_('Require new users to both provide and verify their email before logging in. ', 'wp-auth0') . |
  |  | 146 | esc\_html\_\_('An email address is verified manually by an email from Auth0 or automatically by the provider. ', 'wp-auth0') . |
  |  | 147 | esc\_html\_\_('This will disallow logins from social connections that do not provide email (like Twitter)', 'wp-auth0') |
  | 143 | 148 | ); |
  | 144 | 149 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L155) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L160) |  |
  | 155 | 160 | \* @since 3.8.0 |
  | 156 | 161 | \*/ |
  | 157 |  | public function render\_skip\_strategies( $args = [] ) { |
  | 158 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', 'e.g. "twitter,ldap"' ); |
  | 159 |  | $this->render\_field\_description( |
  | 160 |  | \_\_( 'Enter one or more strategies, separated by commas, to skip email verification. ', 'wp-auth0' ) . |
  | 161 |  | \_\_( 'You can find the strategy under the "Connection Name" field in the Auth0 dashboard. ', 'wp-auth0' ) . |
  | 162 |  | \_\_( 'Leave this field blank to require email for all strategies. ', 'wp-auth0' ) . |
  | 163 |  | \_\_( 'This could introduce a security risk and should be used sparingly, if at all', 'wp-auth0' ) |
  |  | 162 | public function render\_skip\_strategies($args = []) |
  |  | 163 | { |
  |  | 164 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', 'e.g. "twitter,ldap"'); |
  |  | 165 | $this->render\_field\_description( |
  |  | 166 | esc\_html\_\_('Enter one or more strategies, separated by commas, to skip email verification. ', 'wp-auth0') . |
  |  | 167 | esc\_html\_\_('You can find the strategy under the "Connection Name" field in the Auth0 dashboard. ', 'wp-auth0') . |
  |  | 168 | esc\_html\_\_('Leave this field blank to require email for all strategies. ', 'wp-auth0') . |
  |  | 169 | esc\_html\_\_('This could introduce a security risk and should be used sparingly, if at all', 'wp-auth0') |
  | 164 | 170 | ); |
  | 165 | 171 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L174) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L180) |  |
  | 174 | 180 | \* @see add\_settings\_field() |
  | 175 | 181 | \*/ |
  | 176 |  | public function render\_remember\_users\_session( $args = [] ) { |
  | 177 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 178 |  | $this->render\_field\_description( |
  | 179 |  | \_\_( 'A user session by default is kept for two days. ', 'wp-auth0' ) . |
  | 180 |  | \_\_( 'Enabling this setting will extend that and make the session be kept for 14 days', 'wp-auth0' ) |
  |  | 182 | public function render\_remember\_users\_session($args = []) |
  |  | 183 | { |
  |  | 184 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 185 | $this->render\_field\_description( |
  |  | 186 | esc\_html\_\_('A user session by default is kept for two days. ', 'wp-auth0') . |
  |  | 187 | esc\_html\_\_('Enabling this setting will extend that and make the session be kept for 14 days', 'wp-auth0') |
  | 181 | 188 | ); |
  | 182 | 189 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L191) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L198) |  |
  | 191 | 198 | \* @see add\_settings\_field() |
  | 192 | 199 | \*/ |
  | 193 |  | public function render\_default\_login\_redirection( $args = [] ) { |
  | 194 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 195 |  | $this->render\_field\_description( |
  | 196 |  | \_\_( 'URL where successfully logged-in users are redirected when using the wp-login.php page. ', 'wp-auth0' ) . |
  | 197 |  | \_\_( 'This can be overridden with the <code>redirect\_to</code> URL parameter', 'wp-auth0' ) |
  |  | 200 | public function render\_default\_login\_redirection($args = []) |
  |  | 201 | { |
  |  | 202 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 203 | $this->render\_field\_description( |
  |  | 204 | esc\_html\_\_('URL where successfully logged-in users are redirected when using the wp-login.php page. ', 'wp-auth0') . |
  |  | 205 | wp\_kses(\_\_('This can be overridden with the <code>redirect\_to</code> URL parameter', 'wp-auth0'), ['code' => []]) |
  | 198 | 206 | ); |
  | 199 | 207 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L208) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L216) |  |
  | 208 | 216 | \* @see add\_settings\_field() |
  | 209 | 217 | \*/ |
  | 210 |  | public function render\_force\_https\_callback( $args = [] ) { |
  | 211 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 212 |  | $this->render\_field\_description( |
  | 213 |  | \_\_( 'Forces the plugin to use HTTPS for the callback URL when a site supports both; ', 'wp-auth0' ) . |
  | 214 |  | \_\_( 'if disabled, the protocol from the WordPress home URL will be used', 'wp-auth0' ) |
  |  | 218 | public function render\_force\_https\_callback($args = []) |
  |  | 219 | { |
  |  | 220 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 221 | $this->render\_field\_description( |
  |  | 222 | esc\_html\_\_('Forces the plugin to use HTTPS for the callback URL when a site supports both; ', 'wp-auth0') . |
  |  | 223 | esc\_html\_\_('if disabled, the protocol from the WordPress home URL will be used', 'wp-auth0') |
  | 215 | 224 | ); |
  | 216 | 225 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L225) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L234) |  |
  | 225 | 234 | \* @see add\_settings\_field() |
  | 226 | 235 | \*/ |
  | 227 |  | public function render\_auto\_provisioning( $args = [] ) { |
  | 228 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 229 |  | $this->render\_field\_description( |
  | 230 |  | \_\_( 'Create new users in the WordPress database when signups are off. ', 'wp-auth0' ) . |
  | 231 |  | \_\_( 'Signups will not be allowed but successful Auth0 logins will add the user in WordPress', 'wp-auth0' ) |
  |  | 236 | public function render\_auto\_provisioning($args = []) |
  |  | 237 | { |
  |  | 238 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 239 | $this->render\_field\_description( |
  |  | 240 | esc\_html\_\_('Create new users in the WordPress database when signups are off. ', 'wp-auth0') . |
  |  | 241 | esc\_html\_\_('Signups will not be allowed but successful Auth0 logins will add the user in WordPress', 'wp-auth0') |
  | 232 | 242 | ); |
  | 233 | 243 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L242) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L252) |  |
  | 242 | 252 | \* @see add\_settings\_field() |
  | 243 | 253 | \*/ |
  | 244 |  | public function render\_disable\_logging( $args = [] ) { |
  | 245 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 246 |  | $this->render\_field\_description( |
  | 247 |  | \_\_( 'Disables Auth0 logging within WordPress. ', 'wp-auth0' ) . |
  | 248 |  | \_\_( 'If enabled, Auth0 logging will be disabled in WordPress. Other Auth0 logs are unaffected by this switch', 'wp-auth0' ) |
  |  | 254 | public function render\_disable\_logging($args = []) |
  |  | 255 | { |
  |  | 256 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 257 | $this->render\_field\_description( |
  |  | 258 | esc\_html\_\_('Disables Auth0 logging within WordPress. ', 'wp-auth0') . |
  |  | 259 | esc\_html\_\_('If enabled, Auth0 logging will be disabled in WordPress. Other Auth0 logs are unaffected by this switch', 'wp-auth0') |
  | 249 | 260 | ); |
  | 250 | 261 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L259) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L270) |  |
  | 259 | 270 | \* @see add\_settings\_field() |
  | 260 | 271 | \*/ |
  | 261 |  | public function render\_cookie\_domain( $args = [] ) { |
  | 262 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 263 |  | $this->render\_field\_description( |
  | 264 |  | \_\_( 'Overrides the default domain assignment for cookie storage. Use with caution.', 'wp-auth0' ) |
  |  | 272 | public function render\_cookie\_domain($args = []) |
  |  | 273 | { |
  |  | 274 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 275 | $this->render\_field\_description( |
  |  | 276 | esc\_html\_\_('Overrides the default domain assignment for cookie storage. Use with caution.', 'wp-auth0') |
  | 265 | 277 | ); |
  | 266 | 278 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L275) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L287) |  |
  | 275 | 287 | \* @see add\_settings\_field() |
  | 276 | 288 | \*/ |
  | 277 |  | public function render\_migration\_ws( $args = [] ) { |
  | 278 |  | $value = $this->options->get( $args['opt\_name'] ); |
  | 279 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 280 |  |  |
  | 281 |  | if ( $value ) { |
  |  | 289 | public function render\_migration\_ws($args = []) |
  |  | 290 | { |
  |  | 291 | $value = $this->options->get($args['opt\_name']); |
  |  | 292 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 293 |  |
  |  | 294 | if ($value) { |
  | 282 | 295 | $this->render\_field\_description( |
  | 283 |  | ~~\_\_( 'User migration endpoints activated. ', 'wp-auth0'~~ ) . |
  | 284 |  | ~~\_\_( 'See below for the token to use. ', 'wp-auth0'~~ ) . |
  | 285 |  | ~~\_\_( 'The custom database scripts need to be configured manually as described ', 'wp-auth0'~~ ) . |
  | 286 |  | ~~$this->get\_docs\_link( 'cms/wordpress/user-migration'~~ ) |
  |  | 296 | esc\_html\_\_('User migration endpoints activated. ', 'wp-auth0') . |
  |  | 297 | esc\_html\_\_('See below for the token to use. ', 'wp-auth0') . |
  |  | 298 | esc\_html\_\_('The custom database scripts need to be configured manually as described ', 'wp-auth0') . |
  |  | 299 | $this->get\_docs\_link('cms/wordpress/user-migration') |
  | 287 | 300 | ); |
  | 288 |  | $this->render\_field\_description(~~'Migration token:'~~ ); |
  | 289 |  | if (~~$this->options->has\_constant\_val( 'migration\_token' )~~ ) { |
  | 290 |  | $this->render\_const\_notice(~~'migration\_token'~~ ); |
  |  | 301 | $this->render\_field\_description('Migration token:'); |
  |  | 302 | if ($this->options->has\_constant\_val('migration\_token')) { |
  |  | 303 | $this->render\_const\_notice('migration\_token'); |
  | 291 | 304 | } |
  | 292 | 305 |  |
  | 293 |  | $migration\_token = $this->options->get(~~'migration\_token'~~ ); |
  |  | 306 | $migration\_token = $this->options->get('migration\_token'); |
  | 294 | 307 | printf( |
  | 295 | 308 | '<code class="code-block" id="auth0\_migration\_token" disabled>%s</code><br>', |
  | 296 |  | ~~$migration\_token ? sanitize\_text\_field( $migration\_token ) : \_\_( 'No migration token', 'wp-auth0'~~ ) |
  |  | 309 | esc\_html($migration\_token ? sanitize\_text\_field($migration\_token) : esc\_html\_\_('No migration token', 'wp-auth0')) |
  | 297 | 310 | ); |
  | 298 | 311 |  |
  | 299 |  | if (~~! $this->options->has\_constant\_val( 'migration\_token' )~~ ) { |
  | 300 |  | printf( |
  |  | 312 | if (!$this->options->has\_constant\_val('migration\_token')) { |
  |  | 313 | echo wp\_kses(sprintf( |
  | 301 | 314 | '<button id="%s" class="button button-secondary" data-confirm-msg="%s">%s</button>', |
  | 302 |  | esc\_attr(~~self::ROTATE\_TOKEN\_NONCE\_ACTION~~ ), |
  |  | 315 | esc\_attr(self::ROTATE\_TOKEN\_NONCE\_ACTION), |
  | 303 | 316 | esc\_attr( |
  | 304 |  | ~~\_\_( 'This will change your migration token immediately. ', 'wp-auth0'~~ ) . |
  | 305 |  | ~~\_\_( 'The new token must be changed in the custom scripts for your database Connection. ', 'wp-auth0'~~ ) . |
  | 306 |  | ~~\_\_( 'Continue?', 'wp-auth0'~~ ) |
  |  | 317 | esc\_html\_\_('This will change your migration token immediately. ', 'wp-auth0') . |
  |  | 318 | esc\_html\_\_('The new token must be changed in the custom scripts for your database Connection. ', 'wp-auth0') . |
  |  | 319 | esc\_html\_\_('Continue?', 'wp-auth0') |
  | 307 | 320 | ), |
  | 308 |  | ~~\_\_( 'Generate New Migration Token', 'wp-auth0'~~ ) |
  | 309 |  | ); |
  |  | 321 | esc\_html\_\_('Generate New Migration Token', 'wp-auth0') |
  |  | 322 | ), ['button' => ['id' => true, 'class' => true, 'data-confirm-msg' => true]]); |
  | 310 | 323 | } |
  | 311 | 324 | } else { |
  | 312 | 325 | $this->render\_field\_description( |
  | 313 |  | ~~\_\_( 'User migration endpoints deactivated. ', 'wp-auth0'~~ ) . |
  | 314 |  | ~~\_\_( 'Custom database connections can be deactivated in the ', 'wp-auth0'~~ ) . |
  | 315 |  | ~~$this->get\_dashboard\_link( 'connections/database'~~ ) |
  |  | 326 | esc\_html\_\_('User migration endpoints deactivated. ', 'wp-auth0') . |
  |  | 327 | esc\_html\_\_('Custom database connections can be deactivated in the ', 'wp-auth0') . |
  |  | 328 | $this->get\_dashboard\_link('connections/database') |
  | 316 | 329 | ); |
  | 317 | 330 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L327) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L340) |  |
  | 327 | 340 | \* @see add\_settings\_field() |
  | 328 | 341 | \*/ |
  | 329 |  | public function render\_migration\_ws\_ips\_filter( $args = [] ) { |
  | 330 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'], 'wpa0\_migration\_ws\_ips' ); |
  |  | 342 | public function render\_migration\_ws\_ips\_filter($args = []) |
  |  | 343 | { |
  |  | 344 | $this->render\_switch($args['label\_for'], $args['opt\_name'], 'wpa0\_migration\_ws\_ips'); |
  | 331 | 345 | } |
  | 332 | 346 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L340) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L354) |  |
  | 340 | 354 | \* @see add\_settings\_field() |
  | 341 | 355 | \*/ |
  | 342 |  | public function render\_migration\_ws\_ips( $args = [] ) { |
  | 343 |  | $ip\_check = new WP\_Auth0\_Ip\_Check( WP\_Auth0\_Options::Instance() ); |
  | 344 |  | $this->render\_textarea\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 345 |  | $this->render\_field\_description( |
  | 346 |  | \_\_( 'Only requests from these IPs will be allowed to access the migration endpoints. ', 'wp-auth0' ) . |
  | 347 |  | \_\_( 'Separate multiple IPs with commas. ', 'wp-auth0' ) . |
  | 348 |  | \_\_( 'The following Auth0 IPs are automatically whitelisted: ', 'wp-auth0' ) . |
  | 349 |  | '<br><br><code>' . $ip\_check->get\_ips\_by\_domain( null, '</code> <code>' ) . '</code>' |
  |  | 356 | public function render\_migration\_ws\_ips($args = []) |
  |  | 357 | { |
  |  | 358 | $ip\_check = new WP\_Auth0\_Ip\_Check(WP\_Auth0\_Options::Instance()); |
  |  | 359 | $this->render\_textarea\_field($args['label\_for'], $args['opt\_name']); |
  |  | 360 | $this->render\_field\_description( |
  |  | 361 | esc\_html\_\_('Only requests from these IPs will be allowed to access the migration endpoints. ', 'wp-auth0') . |
  |  | 362 | esc\_html\_\_('Separate multiple IPs with commas. ', 'wp-auth0') . |
  |  | 363 | esc\_html\_\_('The following Auth0 IPs are automatically whitelisted: ', 'wp-auth0') . |
  |  | 364 | '<br><br><code>' . $ip\_check->get\_ips\_by\_domain(null, '</code> <code>') . '</code>' |
  | 350 | 365 | ); |
  | 351 | 366 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L360) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L375) |  |
  | 360 | 375 | \* @see add\_settings\_field() |
  | 361 | 376 | \*/ |
  | 362 |  | public function render\_valid\_proxy\_ip( $args = [] ) { |
  | 363 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 364 |  | $this->render\_field\_description( |
  | 365 |  | \_\_( 'Whitelist for proxy and load balancer IPs to enable logins and migration webservices', 'wp-auth0' ) |
  |  | 377 | public function render\_valid\_proxy\_ip($args = []) |
  |  | 378 | { |
  |  | 379 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 380 | $this->render\_field\_description( |
  |  | 381 | esc\_html\_\_('Whitelist for proxy and load balancer IPs to enable logins and migration webservices', 'wp-auth0') |
  | 366 | 382 | ); |
  | 367 | 383 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L374) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L390) |  |
  | 374 | 390 | \* @return array |
  | 375 | 391 | \*/ |
  | 376 |  | public function basic\_validation( array $input ) { |
  | 377 |  | $input['requires\_verified\_email']   = $this->sanitize\_switch\_val( $input['requires\_verified\_email'] ?? null ); |
  | 378 |  | $input['skip\_strategies']           = $this->sanitize\_text\_val( $input['skip\_strategies'] ?? null ); |
  | 379 |  | $input['remember\_users\_session']    = $this->sanitize\_switch\_val( $input['remember\_users\_session'] ?? null ); |
  | 380 |  | $input['default\_login\_redirection'] = $this->validate\_login\_redirect( $input['default\_login\_redirection'] ?? null ); |
  | 381 |  | $input['force\_https\_callback']      = $this->sanitize\_switch\_val( $input['force\_https\_callback'] ?? null ); |
  | 382 |  | $input['auto\_provisioning']         = $this->sanitize\_switch\_val( $input['auto\_provisioning'] ?? null ); |
  |  | 392 | public function basic\_validation(array $input) |
  |  | 393 | { |
  |  | 394 | $input['requires\_verified\_email']   = $this->sanitize\_switch\_val($input['requires\_verified\_email'] ?? null); |
  |  | 395 | $input['skip\_strategies']           = $this->sanitize\_text\_val($input['skip\_strategies'] ?? null); |
  |  | 396 | $input['remember\_users\_session']    = $this->sanitize\_switch\_val($input['remember\_users\_session'] ?? null); |
  |  | 397 | $input['default\_login\_redirection'] = $this->validate\_login\_redirect($input['default\_login\_redirection'] ?? null); |
  |  | 398 | $input['force\_https\_callback']      = $this->sanitize\_switch\_val($input['force\_https\_callback'] ?? null); |
  |  | 399 | $input['auto\_provisioning']         = $this->sanitize\_switch\_val($input['auto\_provisioning'] ?? null); |
  | 383 | 400 | // `migration\_ws` is sanitized in $this->migration\_ws\_validation() below. |
  | 384 | 401 | // `migration\_token` is sanitized in $this->migration\_ws\_validation() below. |
  | 385 |  | $input['migration\_ips\_filter'] = $this->sanitize\_switch\_val(~~$input['migration\_ips\_filter'] ?? null~~ ); |
  |  | 402 | $input['migration\_ips\_filter'] = $this->sanitize\_switch\_val($input['migration\_ips\_filter'] ?? null); |
  | 386 | 403 | // `migration\_ips` is sanitized in $this->migration\_ips\_validation() below. |
  | 387 |  | $input['valid\_proxy\_ip']        = (~~isset( $input['valid\_proxy\_ip'] ) ? $input['valid\_proxy\_ip'] : null~~ ); |
  | 388 |  | $input['cookie\_domain']   = $this->sanitize\_text\_val(~~$input['cookie\_domain'] ?? null~~ ); |
  | 389 |  | $input['disable\_logging'] = $this->sanitize\_switch\_val(~~$input['disable\_logging'] ?? null~~ ); |
  |  | 404 | $input['valid\_proxy\_ip']        = (isset($input['valid\_proxy\_ip']) ? $input['valid\_proxy\_ip'] : null); |
  |  | 405 | $input['cookie\_domain']   = $this->sanitize\_text\_val($input['cookie\_domain'] ?? null); |
  |  | 406 | $input['disable\_logging'] = $this->sanitize\_switch\_val($input['disable\_logging'] ?? null); |
  | 390 | 407 | return $input; |
  | 391 | 408 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L399) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L416) |  |
  | 399 | 416 | \* @return array |
  | 400 | 417 | \*/ |
  | 401 |  | public function migration\_ws\_validation( array $input ) { |
  | 402 |  | $input['migration\_ws']    = $this->sanitize\_switch\_val( $input['migration\_ws'] ?? null ); |
  | 403 |  | $input['migration\_token'] = $this->options->get( 'migration\_token' ); |
  | 404 |  |  |
  | 405 |  | if ( empty( $input['migration\_token'] ) ) { |
  |  | 418 | public function migration\_ws\_validation(array $input) |
  |  | 419 | { |
  |  | 420 | $input['migration\_ws']    = $this->sanitize\_switch\_val($input['migration\_ws'] ?? null); |
  |  | 421 | $input['migration\_token'] = $this->options->get('migration\_token'); |
  |  | 422 |  |
  |  | 423 | if (empty($input['migration\_token'])) { |
  | 406 | 424 | $input['migration\_token'] = wp\_auth0\_generate\_token(); |
  | 407 | 425 | } |
  | 408 | 426 |  |
  | 409 |  | if (~~$input['migration\_ws']~~ ) { |
  |  | 427 | if ($input['migration\_ws']) { |
  | 410 | 428 | $this->router->setup\_rewrites(); |
  | 411 | 429 | flush\_rewrite\_rules(); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L423) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L441) |  |
  | 423 | 441 | \* @return array |
  | 424 | 442 | \*/ |
  | 425 |  | public function migration\_ips\_validation( array $input ) { |
  | 426 |  |  |
  | 427 |  | if ( empty( $input['migration\_ips'] ) ) { |
  |  | 443 | public function migration\_ips\_validation(array $input) |
  |  | 444 | { |
  |  | 445 |  |
  |  | 446 | if (empty($input['migration\_ips'])) { |
  | 428 | 447 | $input['migration\_ips'] = ''; |
  | 429 | 448 | return $input; |
  | 430 | 449 | } |
  | 431 | 450 |  |
  | 432 |  | $ip\_addresses = explode(~~',', $this->sanitize\_text\_val( $input['migration\_ips'] )~~ ); |
  | 433 |  | $ip\_addresses = array\_map(~~'trim', $ip\_addresses~~ ); |
  | 434 |  | $ip\_addresses = array\_filter(~~$ip\_addresses~~ ); |
  | 435 |  | $ip\_addresses = array\_unique(~~$ip\_addresses~~ ); |
  | 436 |  |  |
  | 437 |  | if (~~! empty( $input['domain'] )~~ ) { |
  |  | 451 | $ip\_addresses = explode(',', $this->sanitize\_text\_val($input['migration\_ips'])); |
  |  | 452 | $ip\_addresses = array\_map('trim', $ip\_addresses); |
  |  | 453 | $ip\_addresses = array\_filter($ip\_addresses); |
  |  | 454 | $ip\_addresses = array\_unique($ip\_addresses); |
  |  | 455 |  |
  |  | 456 | if (!empty($input['domain'])) { |
  | 438 | 457 | $ip\_check      = new WP\_Auth0\_Ip\_Check(); |
  | 439 |  | $whitelist\_ips = $ip\_check->get\_ips\_by\_domain(~~$input['domain'], null~~ ); |
  | 440 |  | $ip\_addresses  = array\_diff(~~$ip\_addresses, $whitelist\_ips~~ ); |
  | 441 |  | } |
  | 442 |  |  |
  | 443 |  | $input['migration\_ips'] = implode(~~', ', $ip\_addresses~~ ); |
  |  | 458 | $whitelist\_ips = $ip\_check->get\_ips\_by\_domain($input['domain'], null); |
  |  | 459 | $ip\_addresses  = array\_diff($ip\_addresses, $whitelist\_ips); |
  |  | 460 | } |
  |  | 461 |  |
  |  | 462 | $input['migration\_ips'] = implode(', ', $ip\_addresses); |
  | 444 | 463 | return $input; |
  | 445 | 464 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L453) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L472) |  |
  | 453 | 472 | \* @return string |
  | 454 | 473 | \*/ |
  | 455 |  | public function validate\_login\_redirect( $new\_url, $existing\_url = null ) { |
  | 456 |  | $new\_redirect\_url = esc\_url\_raw( strtolower( $new\_url ) ); |
  | 457 |  | $old\_redirect\_url = $existing\_url ?? $this->options->get( 'default\_login\_redirection' ); |
  |  | 474 | public function validate\_login\_redirect($new\_url, $existing\_url = null) |
  |  | 475 | { |
  |  | 476 | $new\_redirect\_url = esc\_url\_raw(strtolower($new\_url)); |
  |  | 477 | $old\_redirect\_url = $existing\_url ?? $this->options->get('default\_login\_redirection'); |
  | 458 | 478 |  |
  | 459 | 479 | // No change so no validation needed. |
  | 460 |  | if (~~$new\_redirect\_url === strtolower( $old\_redirect\_url )~~ ) { |
  |  | 480 | if ($new\_redirect\_url === strtolower($old\_redirect\_url)) { |
  | 461 | 481 | return $new\_url; |
  | 462 | 482 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L465) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L485) |  |
  | 465 | 485 |  |
  | 466 | 486 | // Set the default redirection URL to be the homepage. |
  | 467 |  | if (~~empty( $new\_redirect\_url )~~ ) { |
  |  | 487 | if (empty($new\_redirect\_url)) { |
  | 468 | 488 | return $home\_url; |
  | 469 | 489 | } |
  | 470 | 490 |  |
  | 471 | 491 | // Allow subdomains within the same domain. |
  | 472 |  | $home\_domain     = $this->get\_domain(~~$home\_url~~ ); |
  | 473 |  | $redirect\_domain = $this->get\_domain(~~$new\_redirect\_url~~ ); |
  | 474 |  | if (~~$home\_domain === $redirect\_domain~~ ) { |
  |  | 492 | $home\_domain     = $this->get\_domain($home\_url); |
  |  | 493 | $redirect\_domain = $this->get\_domain($new\_redirect\_url); |
  |  | 494 | if ($home\_domain === $redirect\_domain) { |
  | 475 | 495 | return $new\_url; |
  | 476 | 496 | } |
  | 477 | 497 |  |
  | 478 | 498 | // If we get here, the redirect URL is a page outside of the WordPress install. |
  | 479 |  | $error = ~~\_\_( 'Advanced > "Login Redirection URL" cannot point to another site.', 'wp-auth0'~~ ); |
  | 480 |  | $this->add\_validation\_error(~~$error~~ ); |
  |  | 499 | $error = esc\_html\_\_('Advanced > "Login Redirection URL" cannot point to another site.', 'wp-auth0'); |
  |  | 500 | $this->add\_validation\_error($error); |
  | 481 | 501 |  |
  | 482 | 502 | // Either revert to the previous (validated) value or set as the homepage. |
  | 483 |  | return !~~empty( $old\_redirect\_url~~ ) ? $old\_redirect\_url : $home\_url; |
  |  | 503 | return !empty($old\_redirect\_url) ? $old\_redirect\_url : $home\_url; |
  | 484 | 504 | } |
  | 485 | 505 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3020639#L491) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Advanced.php?rev=3114611#L511) |  |
  | 491 | 511 | \* @return mixed|string |
  | 492 | 512 | \*/ |
  | 493 |  | private function get\_domain( $url ) { |
  | 494 |  | $host\_pieces = explode( '.', wp\_parse\_url( $url, PHP\_URL\_HOST ) ); |
  | 495 |  | $domain      = array\_pop( $host\_pieces ); |
  | 496 |  | if ( count( $host\_pieces ) ) { |
  | 497 |  | $domain = array\_pop( $host\_pieces ) . '.' . $domain; |
  |  | 513 | private function get\_domain($url) |
  |  | 514 | { |
  |  | 515 | $host\_pieces = explode('.', wp\_parse\_url($url, PHP\_URL\_HOST)); |
  |  | 516 | $domain      = array\_pop($host\_pieces); |
  |  | 517 | if (count($host\_pieces)) { |
  |  | 518 | $domain = array\_pop($host\_pieces) . '.' . $domain; |
  | 498 | 519 | } |
  | 499 | 520 | return $domain; |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin\_Appearance.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php")

  | [r2271973](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Admin\_Appearance. |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L12) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Fields and validations for the Embedded settings tab. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Admin\_Appearance extends WP\_Auth0\_Admin\_Generic { |
  |  | 15 | class WP\_Auth0\_Admin\_Appearance extends WP\_Auth0\_Admin\_Generic |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L20) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L22) |  |
  | 20 | 22 | \* @see \WP\_Auth0\_Admin\_Generic::init\_option\_section |
  | 21 | 23 | \*/ |
  | 22 |  | public function init() { |
  |  | 24 | public function init() |
  |  | 25 | { |
  | 23 | 26 | $options = [ |
  | 24 | 27 | [ |
  | 25 |  | 'name'     => ~~\_\_( 'Passwordless Login', 'wp-auth0'~~ ), |
  |  | 28 | 'name'     => esc\_html\_\_('Passwordless Login', 'wp-auth0'), |
  | 26 | 29 | 'opt'      => 'passwordless\_enabled', |
  | 27 | 30 | 'id'       => 'wpa0\_passwordless\_enabled', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L29) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L32) |  |
  | 29 | 32 | ], |
  | 30 | 33 | [ |
  | 31 |  | 'name'     => ~~\_\_( 'Icon URL', 'wp-auth0'~~ ), |
  |  | 34 | 'name'     => esc\_html\_\_('Icon URL', 'wp-auth0'), |
  | 32 | 35 | 'opt'      => 'icon\_url', |
  | 33 | 36 | 'id'       => 'wpa0\_icon\_url', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L35) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L38) |  |
  | 35 | 38 | ], |
  | 36 | 39 | [ |
  | 37 |  | 'name'     => ~~\_\_( 'Form Title', 'wp-auth0'~~ ), |
  |  | 40 | 'name'     => esc\_html\_\_('Form Title', 'wp-auth0'), |
  | 38 | 41 | 'opt'      => 'form\_title', |
  | 39 | 42 | 'id'       => 'wpa0\_form\_title', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L41) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L44) |  |
  | 41 | 44 | ], |
  | 42 | 45 | [ |
  | 43 |  | 'name'     => ~~\_\_( 'Enable Gravatar Integration', 'wp-auth0'~~ ), |
  |  | 46 | 'name'     => esc\_html\_\_('Enable Gravatar Integration', 'wp-auth0'), |
  | 44 | 47 | 'opt'      => 'gravatar', |
  | 45 | 48 | 'id'       => 'wpa0\_gravatar', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L47) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L50) |  |
  | 47 | 50 | ], |
  | 48 | 51 | [ |
  | 49 |  | 'name'     => ~~\_\_( 'Login Name Style', 'wp-auth0'~~ ), |
  |  | 52 | 'name'     => esc\_html\_\_('Login Name Style', 'wp-auth0'), |
  | 50 | 53 | 'opt'      => 'username\_style', |
  | 51 | 54 | 'id'       => 'wpa0\_username\_style', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L53) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L56) |  |
  | 53 | 56 | ], |
  | 54 | 57 | [ |
  | 55 |  | 'name'     => ~~\_\_( 'Primary Color', 'wp-auth0'~~ ), |
  |  | 58 | 'name'     => esc\_html\_\_('Primary Color', 'wp-auth0'), |
  | 56 | 59 | 'opt'      => 'primary\_color', |
  | 57 | 60 | 'id'       => 'wpa0\_primary\_color', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L59) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L62) |  |
  | 59 | 62 | ], |
  | 60 | 63 | [ |
  | 61 |  | 'name'     => ~~\_\_( 'Extra Settings', 'wp-auth0'~~ ), |
  |  | 64 | 'name'     => esc\_html\_\_('Extra Settings', 'wp-auth0'), |
  | 62 | 65 | 'opt'      => 'extra\_conf', |
  | 63 | 66 | 'id'       => 'wpa0\_extra\_conf', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L65) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L68) |  |
  | 65 | 68 | ], |
  | 66 | 69 | [ |
  | 67 |  | 'name'     => ~~\_\_( 'Use Custom Lock JS URL', 'wp-auth0'~~ ), |
  |  | 70 | 'name'     => esc\_html\_\_('Use Custom Lock JS URL', 'wp-auth0'), |
  | 68 | 71 | 'opt'      => 'custom\_cdn\_url', |
  | 69 | 72 | 'id'       => 'wpa0\_custom\_cdn\_url', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L71) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L74) |  |
  | 71 | 74 | ], |
  | 72 | 75 | [ |
  | 73 |  | 'name'     => ~~\_\_( 'Custom Lock JS URL', 'wp-auth0'~~ ), |
  |  | 76 | 'name'     => esc\_html\_\_('Custom Lock JS URL', 'wp-auth0'), |
  | 74 | 77 | 'opt'      => 'cdn\_url', |
  | 75 | 78 | 'id'       => 'wpa0\_cdn\_url', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L77) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L80) |  |
  | 77 | 80 | ], |
  | 78 | 81 | [ |
  | 79 |  | 'name'     => ~~\_\_( 'Connections to Show', 'wp-auth0'~~ ), |
  |  | 82 | 'name'     => esc\_html\_\_('Connections to Show', 'wp-auth0'), |
  | 80 | 83 | 'opt'      => 'lock\_connections', |
  | 81 | 84 | 'id'       => 'wpa0\_connections', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L83) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L86) |  |
  | 83 | 86 | ], |
  | 84 | 87 | ]; |
  | 85 |  | $this->init\_option\_section(~~'', 'appearance', $options~~ ); |
  |  | 88 | $this->init\_option\_section('', 'appearance', $options); |
  | 86 | 89 | } |
  | 87 | 90 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L95) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L98) |  |
  | 95 | 98 | \* @see add\_settings\_field() |
  | 96 | 99 | \*/ |
  | 97 |  | public function render\_custom\_cdn\_url( $args = [] ) { |
  | 98 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'], 'wpa0\_cdn\_url' ); |
  | 99 |  | $this->render\_field\_description( \_\_( 'Use a custom Lock CDN URL instead of the default. ', 'wp-auth0' ) ); |
  | 100 |  |  |
  | 101 |  | if ( ! $this->options->get( $args['opt\_name'] ) ) { |
  |  | 100 | public function render\_custom\_cdn\_url($args = []) |
  |  | 101 | { |
  |  | 102 | $this->render\_switch($args['label\_for'], $args['opt\_name'], 'wpa0\_cdn\_url'); |
  |  | 103 | $this->render\_field\_description(esc\_html\_\_('Use a custom Lock CDN URL instead of the default. ', 'wp-auth0')); |
  |  | 104 |  |
  |  | 105 | if (!$this->options->get($args['opt\_name'])) { |
  | 102 | 106 | $this->render\_field\_description( |
  | 103 |  | ~~\_\_( 'Currently using:', 'wp-auth0'~~ ) . |
  | 104 |  | ' <code>' . WPA0\_LOCK\_CDN\_URL . '</code>' |
  |  | 107 | esc\_html\_\_('Currently using:', 'wp-auth0') . |
  |  | 108 | ' <code>' . WPA0\_LOCK\_CDN\_URL . '</code>' |
  | 105 | 109 | ); |
  | 106 | 110 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L116) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L120) |  |
  | 116 | 120 | \* @see add\_settings\_field() |
  | 117 | 121 | \*/ |
  | 118 |  | public function render\_cdn\_url( $args = [] ) { |
  | 119 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text' ); |
  | 120 |  | $this->render\_field\_description( |
  | 121 |  | \_\_( 'This should point to the latest Lock JS available in the CDN and rarely needs to change', 'wp-auth0' ) |
  |  | 122 | public function render\_cdn\_url($args = []) |
  |  | 123 | { |
  |  | 124 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text'); |
  |  | 125 | $this->render\_field\_description( |
  |  | 126 | esc\_html\_\_('This should point to the latest Lock JS available in the CDN and rarely needs to change', 'wp-auth0') |
  | 122 | 127 | ); |
  | 123 | 128 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L132) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L137) |  |
  | 132 | 137 | \* @see add\_settings\_field() |
  | 133 | 138 | \*/ |
  | 134 |  | public function render\_passwordless\_enabled( $args = [] ) { |
  | 135 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 136 |  | $this->render\_field\_description( |
  | 137 |  | \_\_( 'Turn on Passwordless login (email or SMS) in the Auth0 form. ', 'wp-auth0' ) . |
  | 138 |  | \_\_( 'Passwordless connections are managed in the ', 'wp-auth0' ) . |
  | 139 |  | $this->get\_dashboard\_link( 'connections/passwordless' ) . |
  | 140 |  | \_\_( ' and at least one must be active and enabled on this Application for this to work. ', 'wp-auth0' ) . |
  | 141 |  | \_\_( 'Username/password login is not enabled when Passwordless is on', 'wp-auth0' ) |
  |  | 139 | public function render\_passwordless\_enabled($args = []) |
  |  | 140 | { |
  |  | 141 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 142 | $this->render\_field\_description( |
  |  | 143 | esc\_html\_\_('Turn on Passwordless login (email or SMS) in the Auth0 form. ', 'wp-auth0') . |
  |  | 144 | esc\_html\_\_('Passwordless connections are managed in the ', 'wp-auth0') . |
  |  | 145 | $this->get\_dashboard\_link('connections/passwordless') . |
  |  | 146 | esc\_html\_\_(' and at least one must be active and enabled on this Application for this to work. ', 'wp-auth0') . |
  |  | 147 | esc\_html\_\_('Username/password login is not enabled when Passwordless is on', 'wp-auth0') |
  | 142 | 148 | ); |
  | 143 | 149 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L152) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L158) |  |
  | 152 | 158 | \* @see add\_settings\_field() |
  | 153 | 159 | \*/ |
  | 154 |  | public function render\_connections( $args = [] ) { |
  | 155 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', 'eg: "sms, google-oauth2, github"' ); |
  | 156 |  | $this->render\_field\_description( |
  | 157 |  | \_\_( 'Specify which Social, Database, or Passwordless connections to display in the Auth0 form. ', 'wp-auth0' ) . |
  | 158 |  | \_\_( 'If this is empty, all enabled connections for this Application will be shown. ', 'wp-auth0' ) . |
  | 159 |  | \_\_( 'Separate multiple connection names with a comma. ', 'wp-auth0' ) . |
  | 160 |  | sprintf( |
  | 161 |  | // translators: HTML link to the Auth0 dashboard. |
  | 162 |  | \_\_( 'Connections listed here must already be active in your %s', 'wp-auth0' ), |
  | 163 |  | $this->get\_dashboard\_link( 'connections/social' ) |
  | 164 |  | ) . |
  | 165 |  | \_\_( ' and enabled for this Application. ', 'wp-auth0' ) . |
  | 166 |  | \_\_( 'Click on a Connection and use the "Name" value in this field', 'wp-auth0' ) |
  |  | 160 | public function render\_connections($args = []) |
  |  | 161 | { |
  |  | 162 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', 'eg: "sms, google-oauth2, github"'); |
  |  | 163 | $this->render\_field\_description( |
  |  | 164 | esc\_html\_\_('Specify which Social, Database, or Passwordless connections to display in the Auth0 form. ', 'wp-auth0') . |
  |  | 165 | esc\_html\_\_('If this is empty, all enabled connections for this Application will be shown. ', 'wp-auth0') . |
  |  | 166 | esc\_html\_\_('Separate multiple connection names with a comma. ', 'wp-auth0') . |
  |  | 167 | sprintf( |
  |  | 168 | // translators: HTML link to the Auth0 dashboard. |
  |  | 169 | esc\_html\_\_('Connections listed here must already be active in your %s', 'wp-auth0'), |
  |  | 170 | $this->get\_dashboard\_link('connections/social') |
  |  | 171 | ) . |
  |  | 172 | esc\_html\_\_(' and enabled for this Application. ', 'wp-auth0') . |
  |  | 173 | esc\_html\_\_('Click on a Connection and use the "Name" value in this field', 'wp-auth0') |
  | 167 | 174 | ); |
  | 168 | 175 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L177) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L184) |  |
  | 177 | 184 | \* @see add\_settings\_field() |
  | 178 | 185 | \*/ |
  | 179 |  | public function render\_icon\_url( $args = [] ) { |
  | 180 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 181 |  | printf( ' <a id="wpa0\_choose\_icon" class="button button-secondary">%s</a>', \_\_( 'Choose Icon', 'wp-auth0' ) ); |
  | 182 |  | $this->render\_field\_description( |
  | 183 |  | \_\_( 'Icon above the title on the Auth0 login form. ', 'wp-auth0' ) . |
  | 184 |  | \_\_( 'This image works best as a PNG with a transparent background less than 120px tall', 'wp-auth0' ) |
  |  | 186 | public function render\_icon\_url($args = []) |
  |  | 187 | { |
  |  | 188 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 189 | echo wp\_kses(sprintf(' <a id="wpa0\_choose\_icon" class="button button-secondary">%s</a>', esc\_html\_\_('Choose Icon', 'wp-auth0')), ['a' => ['id' => true, 'class' => true]]); |
  |  | 190 | $this->render\_field\_description( |
  |  | 191 | esc\_html\_\_('Icon above the title on the Auth0 login form. ', 'wp-auth0') . |
  |  | 192 | esc\_html\_\_('This image works best as a PNG with a transparent background less than 120px tall', 'wp-auth0') |
  | 185 | 193 | ); |
  | 186 | 194 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L195) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L203) |  |
  | 195 | 203 | \* @see add\_settings\_field() |
  | 196 | 204 | \*/ |
  | 197 |  | public function render\_form\_title( $args = [] ) { |
  | 198 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 199 |  | $this->render\_field\_description( \_\_( 'Title used on the Auth0 login form', 'wp-auth0' ) ); |
  |  | 205 | public function render\_form\_title($args = []) |
  |  | 206 | { |
  |  | 207 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 208 | $this->render\_field\_description(esc\_html\_\_('Title used on the Auth0 login form', 'wp-auth0')); |
  | 200 | 209 | } |
  | 201 | 210 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L209) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L218) |  |
  | 209 | 218 | \* @see add\_settings\_field() |
  | 210 | 219 | \*/ |
  | 211 |  | public function render\_gravatar( $args = [] ) { |
  | 212 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  | 213 |  | $this->render\_field\_description( |
  | 214 |  | \_\_( 'Automatically display an avatar (from Gravatar) on the Auth0 login form', 'wp-auth0' ) |
  |  | 220 | public function render\_gravatar($args = []) |
  |  | 221 | { |
  |  | 222 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  |  | 223 | $this->render\_field\_description( |
  |  | 224 | esc\_html\_\_('Automatically display an avatar (from Gravatar) on the Auth0 login form', 'wp-auth0') |
  | 215 | 225 | ); |
  | 216 | 226 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L225) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L235) |  |
  | 225 | 235 | \* @see add\_settings\_field() |
  | 226 | 236 | \*/ |
  | 227 |  | public function render\_username\_style( $args = [] ) { |
  |  | 237 | public function render\_username\_style($args = []) |
  |  | 238 | { |
  | 228 | 239 | $this->render\_radio\_buttons( |
  | 229 | 240 | [ |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L237) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L248) |  |
  | 237 | 248 | $args['label\_for'], |
  | 238 | 249 | $args['opt\_name'], |
  | 239 |  | $this->options->get(~~$args['opt\_name'], ''~~ ) |
  | 240 |  | ); |
  | 241 |  | $this->render\_field\_description( |
  | 242 |  | ~~\_\_( 'To allow the user to use either email or username to login, leave this as "Auto." ', 'wp-auth0'~~ ) . |
  | 243 |  | ~~\_\_( 'Only database connections that require a username will allow username logins', 'wp-auth0'~~ ) |
  |  | 250 | $this->options->get($args['opt\_name'], '') |
  |  | 251 | ); |
  |  | 252 | $this->render\_field\_description( |
  |  | 253 | esc\_html\_\_('To allow the user to use either email or username to login, leave this as "Auto." ', 'wp-auth0') . |
  |  | 254 | esc\_html\_\_('Only database connections that require a username will allow username logins', 'wp-auth0') |
  | 244 | 255 | ); |
  | 245 | 256 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L254) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L265) |  |
  | 254 | 265 | \* @see add\_settings\_field() |
  | 255 | 266 | \*/ |
  | 256 |  | public function render\_primary\_color( $args = [] ) { |
  | 257 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 258 |  | $this->render\_field\_description( |
  | 259 |  | \_\_( 'Primary color for the Auth0 login form in hex format. ', 'wp-auth0' ) . |
  | 260 |  | $this->get\_docs\_link( |
  | 261 |  | 'libraries/lock/v11/configuration#primarycolor-string-', |
  | 262 |  | \_\_( 'More information on this settings', 'wp-auth0' ) |
  | 263 |  | ) |
  |  | 267 | public function render\_primary\_color($args = []) |
  |  | 268 | { |
  |  | 269 | $this->render\_text\_field($args['label\_for'], $args['opt\_name']); |
  |  | 270 | $this->render\_field\_description( |
  |  | 271 | esc\_html\_\_('Primary color for the Auth0 login form in hex format. ', 'wp-auth0') . |
  |  | 272 | $this->get\_docs\_link( |
  |  | 273 | 'libraries/lock/v11/configuration#primarycolor-string-', |
  |  | 274 | esc\_html\_\_('More information on this settings', 'wp-auth0') |
  |  | 275 | ) |
  | 264 | 276 | ); |
  | 265 | 277 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L274) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L286) |  |
  | 274 | 286 | \* @see add\_settings\_field() |
  | 275 | 287 | \*/ |
  | 276 |  | public function render\_extra\_conf( $args = [] ) { |
  | 277 |  | $this->render\_textarea\_field( $args['label\_for'], $args['opt\_name'] ); |
  | 278 |  | $this->render\_field\_description( |
  | 279 |  | \_\_( 'Valid JSON for Lock options configuration; will override all options set elsewhere. ', 'wp-auth0' ) . |
  | 280 |  | $this->get\_docs\_link( 'libraries/lock/customization', 'See options and examples' ) |
  |  | 288 | public function render\_extra\_conf($args = []) |
  |  | 289 | { |
  |  | 290 | $this->render\_textarea\_field($args['label\_for'], $args['opt\_name']); |
  |  | 291 | $this->render\_field\_description( |
  |  | 292 | esc\_html\_\_('Valid JSON for Lock options configuration; will override all options set elsewhere. ', 'wp-auth0') . |
  |  | 293 | $this->get\_docs\_link('libraries/lock/customization', 'See options and examples') |
  | 281 | 294 | ); |
  | 282 | 295 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=2271973#L289) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Appearance.php?rev=3114611#L302) |  |
  | 289 | 302 | \* @return array |
  | 290 | 303 | \*/ |
  | 291 |  | public function basic\_validation( array $input ) { |
  | 292 |  | $input['passwordless\_enabled'] = $this->sanitize\_switch\_val( $input['passwordless\_enabled'] ?? null ); |
  | 293 |  |  |
  | 294 |  | $input['icon\_url'] = esc\_url\_raw( $this->sanitize\_text\_val( $input['icon\_url'] ?? null ) ); |
  | 295 |  | if ( ! empty( $input['icon\_url'] ) && ! filter\_var( $input['icon\_url'], FILTER\_VALIDATE\_URL ) ) { |
  | 296 |  | $input['icon\_url'] = $this->options->get( 'icon\_url' ); |
  | 297 |  | self::add\_validation\_error( \_\_( 'The Icon URL used is not valid.', 'wp-auth0' ) ); |
  |  | 304 | public function basic\_validation(array $input) |
  |  | 305 | { |
  |  | 306 | $input['passwordless\_enabled'] = $this->sanitize\_switch\_val($input['passwordless\_enabled'] ?? null); |
  |  | 307 |  |
  |  | 308 | $input['icon\_url'] = esc\_url\_raw($this->sanitize\_text\_val($input['icon\_url'] ?? null)); |
  |  | 309 | if (!empty($input['icon\_url']) && !filter\_var($input['icon\_url'], FILTER\_VALIDATE\_URL)) { |
  |  | 310 | $input['icon\_url'] = $this->options->get('icon\_url'); |
  |  | 311 | self::add\_validation\_error(esc\_html\_\_('The Icon URL used is not valid.', 'wp-auth0')); |
  | 298 | 312 | } |
  | 299 | 313 |  |
  | 300 |  | $input['form\_title']     = $this->sanitize\_text\_val(~~$input['form\_title'] ?? null~~ ); |
  | 301 |  | $input['gravatar']       = $this->sanitize\_switch\_val(~~$input['gravatar'] ?? null~~ ); |
  | 302 |  | $input['username\_style'] = $this->sanitize\_text\_val(~~$input['username\_style'] ?? null~~ ); |
  | 303 |  | $input['primary\_color']  = $this->sanitize\_text\_val(~~$input['primary\_color'] ?? null~~ ); |
  | 304 |  |  |
  | 305 |  | $input['extra\_conf'] = $this->sanitize\_text\_val(~~$input['extra\_conf'] ?? null~~ ); |
  | 306 |  | if (~~! empty( $input['extra\_conf'] ) && ! json\_decode( $input['extra\_conf'] )~~ ) { |
  | 307 |  | $input['extra\_conf'] = $this->options->get(~~'extra\_conf', ''~~ ); |
  | 308 |  | $error               = ~~\_\_( 'The Extra Settings parameter should be a valid JSON object.', 'wp-auth0'~~ ); |
  | 309 |  | self::add\_validation\_error(~~$error~~ ); |
  |  | 314 | $input['form\_title']     = $this->sanitize\_text\_val($input['form\_title'] ?? null); |
  |  | 315 | $input['gravatar']       = $this->sanitize\_switch\_val($input['gravatar'] ?? null); |
  |  | 316 | $input['username\_style'] = $this->sanitize\_text\_val($input['username\_style'] ?? null); |
  |  | 317 | $input['primary\_color']  = $this->sanitize\_text\_val($input['primary\_color'] ?? null); |
  |  | 318 |  |
  |  | 319 | $input['extra\_conf'] = $this->sanitize\_text\_val($input['extra\_conf'] ?? null); |
  |  | 320 | if (!empty($input['extra\_conf']) && !json\_decode($input['extra\_conf'])) { |
  |  | 321 | $input['extra\_conf'] = $this->options->get('extra\_conf', ''); |
  |  | 322 | $error               = esc\_html\_\_('The Extra Settings parameter should be a valid JSON object.', 'wp-auth0'); |
  |  | 323 | self::add\_validation\_error($error); |
  | 310 | 324 | } |
  | 311 | 325 |  |
  | 312 |  | $input['custom\_cdn\_url'] = $this->sanitize\_switch\_val(~~$input['custom\_cdn\_url'] ?? null~~ ); |
  | 313 |  |  |
  | 314 |  | $input['cdn\_url'] = esc\_url\_raw(~~$this->sanitize\_text\_val( $input['cdn\_url'] ?? null )~~ ); |
  | 315 |  | if (~~$input['custom\_cdn\_url'] && ! filter\_var( $input['cdn\_url'], FILTER\_VALIDATE\_URL )~~ ) { |
  | 316 |  | $input['cdn\_url'] = $this->options->get(~~'cdn\_url', WPA0\_LOCK\_CDN\_URL~~ ); |
  | 317 |  | self::add\_validation\_error(~~\_\_( 'The Custom Lock JS URL used is not valid.', 'wp-auth0' )~~ ); |
  |  | 326 | $input['custom\_cdn\_url'] = $this->sanitize\_switch\_val($input['custom\_cdn\_url'] ?? null); |
  |  | 327 |  |
  |  | 328 | $input['cdn\_url'] = esc\_url\_raw($this->sanitize\_text\_val($input['cdn\_url'] ?? null)); |
  |  | 329 | if ($input['custom\_cdn\_url'] && !filter\_var($input['cdn\_url'], FILTER\_VALIDATE\_URL)) { |
  |  | 330 | $input['cdn\_url'] = $this->options->get('cdn\_url', WPA0\_LOCK\_CDN\_URL); |
  |  | 331 | self::add\_validation\_error(esc\_html\_\_('The Custom Lock JS URL used is not valid.', 'wp-auth0')); |
  | 318 | 332 | } |
  | 319 | 333 |  |
  | 320 |  | $input['lock\_connections'] = $this->sanitize\_text\_val(~~$input['lock\_connections'] ?? null~~ ); |
  |  | 334 | $input['lock\_connections'] = $this->sanitize\_text\_val($input['lock\_connections'] ?? null); |
  | 321 | 335 |  |
  | 322 | 336 | return $input; |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin\_Basic.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php")

  | [r2599514](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L1 "Show revision 2599514 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Admin\_Basic. |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L12) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Fields and validations for the Basic settings tab. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Admin\_Basic extends WP\_Auth0\_Admin\_Generic { |
  | 15 |  |  |
  | 16 |  | const ALLOWED\_ID\_TOKEN\_ALGS = [ 'HS256', 'RS256' ]; |
  |  | 15 | class WP\_Auth0\_Admin\_Basic extends WP\_Auth0\_Admin\_Generic |
  |  | 16 | { |
  |  | 17 |  |
  |  | 18 | const ALLOWED\_ID\_TOKEN\_ALGS = ['HS256', 'RS256']; |
  | 17 | 19 |  |
  | 18 | 20 | /\*\* |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L22) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L24) |  |
  | 22 | 24 | \* @see \WP\_Auth0\_Admin\_Generic::init\_option\_section |
  | 23 | 25 | \*/ |
  | 24 |  | public function init() { |
  |  | 26 | public function init() |
  |  | 27 | { |
  | 25 | 28 |  |
  | 26 | 29 | $options = [ |
  | 27 | 30 | [ |
  | 28 |  | 'name'     => ~~\_\_( 'Domain', 'wp-auth0'~~ ), |
  |  | 31 | 'name'     => esc\_html\_\_('Domain', 'wp-auth0'), |
  | 29 | 32 | 'opt'      => 'domain', |
  | 30 | 33 | 'id'       => 'wpa0\_domain', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L32) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L35) |  |
  | 32 | 35 | ], |
  | 33 | 36 | [ |
  | 34 |  | 'name'     => ~~\_\_( 'Custom Domain', 'wp-auth0'~~ ), |
  |  | 37 | 'name'     => esc\_html\_\_('Custom Domain', 'wp-auth0'), |
  | 35 | 38 | 'opt'      => 'custom\_domain', |
  | 36 | 39 | 'id'       => 'wpa0\_custom\_domain', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L38) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L41) |  |
  | 38 | 41 | ], |
  | 39 | 42 | [ |
  | 40 |  | 'name'     => ~~\_\_( 'Client ID', 'wp-auth0'~~ ), |
  |  | 43 | 'name'     => esc\_html\_\_('Client ID', 'wp-auth0'), |
  | 41 | 44 | 'opt'      => 'client\_id', |
  | 42 | 45 | 'id'       => 'wpa0\_client\_id', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L44) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L47) |  |
  | 44 | 47 | ], |
  | 45 | 48 | [ |
  | 46 |  | 'name'     => ~~\_\_( 'Client Secret', 'wp-auth0'~~ ), |
  |  | 49 | 'name'     => esc\_html\_\_('Client Secret', 'wp-auth0'), |
  | 47 | 50 | 'opt'      => 'client\_secret', |
  | 48 | 51 | 'id'       => 'wpa0\_client\_secret', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L50) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L53) |  |
  | 50 | 53 | ], |
  | 51 | 54 | [ |
  | 52 |  | 'name'     => ~~\_\_( 'Organization', 'wp-auth0'~~ ), |
  |  | 55 | 'name'     => esc\_html\_\_('Organization', 'wp-auth0'), |
  | 53 | 56 | 'opt'      => 'organization', |
  | 54 | 57 | 'id'       => 'wpa0\_organization', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L56) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L59) |  |
  | 56 | 59 | ], |
  | 57 | 60 | [ |
  | 58 |  | 'name'     => ~~\_\_( 'JWT Signature Algorithm', 'wp-auth0'~~ ), |
  |  | 61 | 'name'     => esc\_html\_\_('JWT Signature Algorithm', 'wp-auth0'), |
  | 59 | 62 | 'opt'      => 'client\_signing\_algorithm', |
  | 60 | 63 | 'id'       => 'wpa0\_client\_signing\_algorithm', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L62) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L65) |  |
  | 62 | 65 | ], |
  | 63 | 66 | [ |
  | 64 |  | 'name'     => ~~\_\_( 'JWKS Cache Time (in minutes)', 'wp-auth0'~~ ), |
  |  | 67 | 'name'     => esc\_html\_\_('JWKS Cache Time (in minutes)', 'wp-auth0'), |
  | 65 | 68 | 'opt'      => 'cache\_expiration', |
  | 66 | 69 | 'id'       => 'wpa0\_cache\_expiration', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L68) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L71) |  |
  | 68 | 71 | ], |
  | 69 | 72 | [ |
  | 70 |  | 'name'     => ~~\_\_( 'Original Login Form on wp-login.php', 'wp-auth0'~~ ), |
  |  | 73 | 'name'     => esc\_html\_\_('Original Login Form on wp-login.php', 'wp-auth0'), |
  | 71 | 74 | 'opt'      => 'wordpress\_login\_enabled', |
  | 72 | 75 | 'id'       => 'wpa0\_login\_enabled', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L74) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L77) |  |
  | 74 | 77 | ], |
  | 75 | 78 | [ |
  | 76 |  | 'name'     => ~~\_\_( 'Allow Signups', 'wp-auth0'~~ ), |
  |  | 79 | 'name'     => esc\_html\_\_('Allow Signups', 'wp-auth0'), |
  | 77 | 80 | 'id'       => 'wpa0\_allow\_signup', |
  | 78 | 81 | 'function' => 'render\_allow\_signup', |
  | 79 | 82 | ], |
  | 80 | 83 | ]; |
  | 81 |  | $this->init\_option\_section(~~'', 'basic', $options~~ ); |
  |  | 84 | $this->init\_option\_section('', 'basic', $options); |
  | 82 | 85 | } |
  | 83 | 86 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L91) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L94) |  |
  | 91 | 94 | \* @see add\_settings\_field() |
  | 92 | 95 | \*/ |
  | 93 |  | public function render\_domain( $args = [] ) { |
  | 94 |  |  |
  | 95 |  | $style = $this->options->get( $args['opt\_name'] ) ? '' : self::ERROR\_FIELD\_STYLE; |
  | 96 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', 'your-tenant.auth0.com', $style ); |
  | 97 |  | $this->render\_field\_description( |
  | 98 |  | \_\_( 'Auth0 Domain, found in your Application settings in the ', 'wp-auth0' ) . |
  | 99 |  | $this->get\_dashboard\_link( 'applications' ) |
  |  | 96 | public function render\_domain($args = []) |
  |  | 97 | { |
  |  | 98 |  |
  |  | 99 | $style = $this->options->get($args['opt\_name']) ? '' : self::ERROR\_FIELD\_STYLE; |
  |  | 100 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', 'your-tenant.auth0.com', $style); |
  |  | 101 | $this->render\_field\_description( |
  |  | 102 | esc\_html\_\_('Auth0 Domain, found in your Application settings in the ', 'wp-auth0') . |
  |  | 103 | $this->get\_dashboard\_link('applications') |
  | 100 | 104 | ); |
  | 101 | 105 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L112) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L116) |  |
  | 112 | 116 | \* @since 3.7.0 |
  | 113 | 117 | \*/ |
  | 114 |  | public function render\_custom\_domain( $args = [] ) { |
  | 115 |  |  |
  | 116 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', 'login.yourdomain.com' ); |
  | 117 |  | $this->render\_field\_description( |
  | 118 |  | \_\_( 'Custom login domain. ', 'wp-auth0' ) . |
  | 119 |  | $this->get\_docs\_link( 'custom-domains', \_\_( 'More information here', 'wp-auth0' ) ) |
  |  | 118 | public function render\_custom\_domain($args = []) |
  |  | 119 | { |
  |  | 120 |  |
  |  | 121 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', 'login.yourdomain.com'); |
  |  | 122 | $this->render\_field\_description( |
  |  | 123 | esc\_html\_\_('Custom login domain. ', 'wp-auth0') . |
  |  | 124 | $this->get\_docs\_link('custom-domains', esc\_html\_\_('More information here', 'wp-auth0')) |
  | 120 | 125 | ); |
  | 121 | 126 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L130) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L135) |  |
  | 130 | 135 | \* @see add\_settings\_field() |
  | 131 | 136 | \*/ |
  | 132 |  | public function render\_client\_id( $args = [] ) { |
  | 133 |  |  |
  | 134 |  | $style = $this->options->get( $args['opt\_name'] ) ? '' : self::ERROR\_FIELD\_STYLE; |
  | 135 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', '', $style ); |
  | 136 |  | $this->render\_field\_description( |
  | 137 |  | \_\_( 'Client ID, found in your Application settings in the ', 'wp-auth0' ) . |
  | 138 |  | $this->get\_dashboard\_link( 'applications' ) |
  |  | 137 | public function render\_client\_id($args = []) |
  |  | 138 | { |
  |  | 139 |  |
  |  | 140 | $style = $this->options->get($args['opt\_name']) ? '' : self::ERROR\_FIELD\_STYLE; |
  |  | 141 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', '', $style); |
  |  | 142 | $this->render\_field\_description( |
  |  | 143 | esc\_html\_\_('Client ID, found in your Application settings in the ', 'wp-auth0') . |
  |  | 144 | $this->get\_dashboard\_link('applications') |
  | 139 | 145 | ); |
  | 140 | 146 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L149) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L155) |  |
  | 149 | 155 | \* @see add\_settings\_field() |
  | 150 | 156 | \*/ |
  | 151 |  | public function render\_client\_secret( $args = [] ) { |
  | 152 |  |  |
  | 153 |  | $style = $this->options->get( $args['opt\_name'] ) ? '' : self::ERROR\_FIELD\_STYLE; |
  | 154 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'password', '', $style ); |
  | 155 |  | $this->render\_field\_description( |
  | 156 |  | \_\_( 'Client Secret, found in your Application settings in the ', 'wp-auth0' ) . |
  | 157 |  | $this->get\_dashboard\_link( 'applications' ) |
  |  | 157 | public function render\_client\_secret($args = []) |
  |  | 158 | { |
  |  | 159 |  |
  |  | 160 | $style = $this->options->get($args['opt\_name']) ? '' : self::ERROR\_FIELD\_STYLE; |
  |  | 161 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'password', '', $style); |
  |  | 162 | $this->render\_field\_description( |
  |  | 163 | esc\_html\_\_('Client Secret, found in your Application settings in the ', 'wp-auth0') . |
  |  | 164 | $this->get\_dashboard\_link('applications') |
  | 158 | 165 | ); |
  | 159 | 166 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L168) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L175) |  |
  | 168 | 175 | \* @see add\_settings\_field() |
  | 169 | 176 | \*/ |
  | 170 |  | public function render\_organization( $args = [] ) { |
  | 171 |  |  |
  | 172 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'text', '' ); |
  | 173 |  | $this->render\_field\_description( |
  | 174 |  | \_\_( 'Optional. Organization Id, found in your Organizations settings in the ', 'wp-auth0' ) . |
  | 175 |  | $this->get\_dashboard\_link( 'applications' ) |
  |  | 177 | public function render\_organization($args = []) |
  |  | 178 | { |
  |  | 179 |  |
  |  | 180 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', ''); |
  |  | 181 | $this->render\_field\_description( |
  |  | 182 | esc\_html\_\_('Optional. Organization Id, found in your Organizations settings in the ', 'wp-auth0') . |
  |  | 183 | $this->get\_dashboard\_link('applications') |
  | 176 | 184 | ); |
  | 177 | 185 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L186) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L194) |  |
  | 186 | 194 | \* @see add\_settings\_field() |
  | 187 | 195 | \*/ |
  | 188 |  | public function render\_client\_signing\_algorithm( $args = [] ) { |
  | 189 |  |  |
  | 190 |  | $curr\_value = $this->options->get( $args['opt\_name'] ) ?: WP\_Auth0\_Api\_Client::DEFAULT\_CLIENT\_ALG; |
  |  | 196 | public function render\_client\_signing\_algorithm($args = []) |
  |  | 197 | { |
  |  | 198 |  |
  |  | 199 | $curr\_value = $this->options->get($args['opt\_name']) ?: WP\_Auth0\_Api\_Client::DEFAULT\_CLIENT\_ALG; |
  | 191 | 200 | $this->render\_radio\_buttons( |
  | 192 | 201 | self::ALLOWED\_ID\_TOKEN\_ALGS, |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L196) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L205) |  |
  | 196 | 205 | ); |
  | 197 | 206 | $this->render\_field\_description( |
  | 198 |  | ~~\_\_( 'This value can be found the Application settings in the ', 'wp-auth0'~~ ) . |
  | 199 |  | ~~$this->get\_dashboard\_link( 'applications'~~ ) . |
  | 200 |  | ~~\_\_( ' under Show Advanced Settings > OAuth > "JsonWebToken Signature Algorithm"', 'wp-auth0'~~ ) |
  |  | 207 | esc\_html\_\_('This value can be found the Application settings in the ', 'wp-auth0') . |
  |  | 208 | $this->get\_dashboard\_link('applications') . |
  |  | 209 | esc\_html\_\_(' under Show Advanced Settings > OAuth > "JsonWebToken Signature Algorithm"', 'wp-auth0') |
  | 201 | 210 | ); |
  | 202 | 211 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L211) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L220) |  |
  | 211 | 220 | \* @see add\_settings\_field() |
  | 212 | 221 | \*/ |
  | 213 |  | public function render\_cache\_expiration( $args = [] ) { |
  | 214 |  |  |
  | 215 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], 'number' ); |
  | 216 |  | printf( |
  |  | 222 | public function render\_cache\_expiration($args = []) |
  |  | 223 | { |
  |  | 224 |  |
  |  | 225 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'number'); |
  |  | 226 | echo wp\_kses(sprintf( |
  | 217 | 227 | ' <button id="auth0\_delete\_cache\_transient" class="button button-secondary">%s</button>', |
  | 218 |  | ~~\_\_( 'Delete Cache', 'wp-auth0'~~ ) |
  | 219 |  | ); |
  | 220 |  | $this->render\_field\_description(~~\_\_( 'JWKS cache expiration in minutes (use 0 for no caching)', 'wp-auth0' )~~ ); |
  | 221 |  | $domain = $this->options->get(~~'domain'~~ ); |
  | 222 |  | if (~~$domain~~ ) { |
  |  | 228 | esc\_html\_\_('Delete Cache', 'wp-auth0') |
  |  | 229 | ), ['button' => ['id' => true, 'class' => true]]); |
  |  | 230 | $this->render\_field\_description(esc\_html\_\_('JWKS cache expiration in minutes (use 0 for no caching)', 'wp-auth0')); |
  |  | 231 | $domain = $this->options->get('domain'); |
  |  | 232 | if ($domain) { |
  | 223 | 233 | $this->render\_field\_description( |
  | 224 |  | sprintf( |
  |  | 234 | wp\_kses(sprintf( |
  | 225 | 235 | '<a href="https://%s/.well-known/jwks.json" target="\_blank">%s</a>', |
  | 226 | 236 | $domain, |
  | 227 |  | ~~\_\_( 'View your JWKS here', 'wp-auth0'~~ ) |
  | 228 |  | ) |
  |  | 237 | esc\_html\_\_('View your JWKS here', 'wp-auth0') |
  |  | 238 | ), ['a' => ['href' => true, 'target' => true]]) |
  | 229 | 239 | ); |
  | 230 | 240 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L240) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L250) |  |
  | 240 | 250 | \* @see add\_settings\_field() |
  | 241 | 251 | \*/ |
  | 242 |  | public function render\_allow\_wordpress\_login( $args = [] ) { |
  | 243 |  |  |
  | 244 |  | $isset\_desc = sprintf( |
  |  | 252 | public function render\_allow\_wordpress\_login($args = []) |
  |  | 253 | { |
  |  | 254 |  |
  |  | 255 | $isset\_desc = wp\_kses(sprintf( |
  | 245 | 256 | '<code class="code-block"><a href="%s?wle" target="\_blank">%s?wle</a></code>', |
  | 246 | 257 | wp\_login\_url(), |
  | 247 | 258 | wp\_login\_url() |
  | 248 |  | ); |
  | 249 |  | $code\_desc  = '<code class="code-block">' . \_\_( 'Save settings to generate URL.', 'wp-auth0' ) . '</code>'; |
  | 250 |  | $wle\_code   = $this->options->get( 'wle\_code' ); |
  | 251 |  | if ( $wle\_code ) { |
  | 252 |  | $code\_desc = str\_replace( '?wle', '?wle=' . $wle\_code, $isset\_desc ); |
  | 253 |  | } |
  |  | 259 | ), ['code' => ['class' => true], 'a' => ['href' => true, 'target' => true]]); |
  |  | 260 |  |
  |  | 261 | $code\_desc  = wp\_kses('<code class="code-block">' . esc\_html\_\_('Save settings to generate URL.', 'wp-auth0') . '</code>', ['code' => ['class' => true]]); |
  |  | 262 | $wle\_code   = $this->options->get('wle\_code'); |
  |  | 263 |  |
  |  | 264 | if ($wle\_code) { |
  |  | 265 | $code\_desc = str\_replace('?wle', '?wle=' . $wle\_code, $isset\_desc); |
  |  | 266 | } |
  |  | 267 |  |
  | 254 | 268 | $buttons = [ |
  | 255 | 269 | [ |
  | 256 |  | 'label' => ~~\_\_( 'Never', 'wp-auth0'~~ ), |
  |  | 270 | 'label' => esc\_html\_\_('Never', 'wp-auth0'), |
  | 257 | 271 | 'value' => 'no', |
  | 258 | 272 | ], |
  | 259 | 273 | [ |
  | 260 |  | 'label' => ~~\_\_( 'Via a link under the Auth0 form', 'wp-auth0'~~ ), |
  |  | 274 | 'label' => esc\_html\_\_('Via a link under the Auth0 form', 'wp-auth0'), |
  | 261 | 275 | 'value' => 'link', |
  | 262 |  | 'desc'  => ~~\_\_( 'URL is the same as below', 'wp-auth0'~~ ), |
  | 263 |  | ], |
  | 264 |  | [ |
  | 265 |  | 'label' => ~~\_\_( 'When "wle" query parameter is present', 'wp-auth0'~~ ), |
  |  | 276 | 'desc'  => esc\_html\_\_('URL is the same as below', 'wp-auth0'), |
  |  | 277 | ], |
  |  | 278 | [ |
  |  | 279 | 'label' => esc\_html\_\_('When "wle" query parameter is present', 'wp-auth0'), |
  | 266 | 280 | 'value' => 'isset', |
  | 267 | 281 | 'desc'  => $isset\_desc, |
  | 268 | 282 | ], |
  | 269 | 283 | [ |
  | 270 |  | 'label' => ~~\_\_( 'When "wle" query parameter contains specific code', 'wp-auth0'~~ ), |
  |  | 284 | 'label' => esc\_html\_\_('When "wle" query parameter contains specific code', 'wp-auth0'), |
  | 271 | 285 | 'value' => 'code', |
  | 272 | 286 | 'desc'  => $code\_desc, |
  | 273 | 287 | ], |
  | 274 | 288 | ]; |
  | 275 |  | printf( |
  |  | 289 |  |
  |  | 290 | echo wp\_kses(sprintf( |
  | 276 | 291 | '<div class="subelement"><span class="description">%s.</span></div><br>', |
  | 277 |  | \_\_( 'Logins and signups using the original form will NOT be pushed to Auth0', 'wp-auth0' ) |
  | 278 |  | ); |
  |  | 292 | esc\_html\_\_('Logins and signups using the original form will NOT be pushed to Auth0', 'wp-auth0') |
  |  | 293 | ), ['div' => ['class' => true], 'span' => ['class' => true], 'br' => []]); |
  |  | 294 |  |
  | 279 | 295 | $this->render\_radio\_buttons( |
  | 280 | 296 | $buttons, |
  | 281 | 297 | $args['label\_for'], |
  | 282 | 298 | $args['opt\_name'], |
  | 283 |  | $this->options->get(~~$args['opt\_name']~~ ), |
  |  | 299 | $this->options->get($args['opt\_name']), |
  | 284 | 300 | true |
  | 285 | 301 | ); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L293) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L309) |  |
  | 293 | 309 | \* @see add\_settings\_field() |
  | 294 | 310 | \*/ |
  | 295 |  | public function render\_allow\_signup() { |
  | 296 |  |  |
  | 297 |  | if ( is\_multisite() ) { |
  | 298 |  | $settings\_text = \_\_( |
  |  | 311 | public function render\_allow\_signup() |
  |  | 312 | { |
  |  | 313 |  |
  |  | 314 | if (is\_multisite()) { |
  |  | 315 | $settings\_text = esc\_html\_\_( |
  | 299 | 316 | '"Allow new registrations" in the Network Admin > Settings > Network Settings', |
  | 300 | 317 | 'wp-auth0' |
  | 301 | 318 | ); |
  | 302 | 319 | } else { |
  | 303 |  | $settings\_text = ~~\_\_( '"Anyone can register" in the WordPress General Settings', 'wp-auth0'~~ ); |
  |  | 320 | $settings\_text = esc\_html\_\_('"Anyone can register" in the WordPress General Settings', 'wp-auth0'); |
  | 304 | 321 | } |
  | 305 | 322 | $allow\_signup = $this->options->is\_wp\_registration\_enabled(); |
  | 306 | 323 | $this->render\_field\_description( |
  | 307 |  | ~~\_\_( 'Signups are currently ', 'wp-auth0'~~ ) . '<b>' . |
  | 308 |  | ~~( $allow\_signup ? \_\_( 'enabled', 'wp-auth0' ) : \_\_( 'disabled', 'wp-auth0' )~~ ) . |
  | 309 |  | ~~'</b>' . \_\_( ' by this setting ', 'wp-auth0'~~ ) . $settings\_text |
  |  | 324 | esc\_html\_\_('Signups are currently ', 'wp-auth0') . '<b>' . |
  |  | 325 | ($allow\_signup ? esc\_html\_\_('enabled', 'wp-auth0') : esc\_html\_\_('disabled', 'wp-auth0')) . |
  |  | 326 | '</b>' . esc\_html\_\_(' by this setting ', 'wp-auth0') . $settings\_text |
  | 310 | 327 | ); |
  | 311 | 328 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=2599514#L318) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Basic.php?rev=3114611#L335) |  |
  | 318 | 335 | \* @return array |
  | 319 | 336 | \*/ |
  | 320 |  | public function basic\_validation( array $input ) { |
  | 321 |  |  |
  | 322 |  | if ( wp\_cache\_get( 'doing\_db\_update', WPA0\_CACHE\_GROUP ) ) { |
  |  | 337 | public function basic\_validation(array $input) |
  |  | 338 | { |
  |  | 339 |  |
  |  | 340 | if (wp\_cache\_get('doing\_db\_update', WPA0\_CACHE\_GROUP)) { |
  | 323 | 341 | return $input; |
  | 324 | 342 | } |
  | 325 | 343 |  |
  | 326 |  | $input['domain'] = $this->sanitize\_text\_val(~~$input['domain'] ?? null~~ ); |
  | 327 |  | if (~~empty( $input['domain'] )~~ ) { |
  | 328 |  | $this->add\_validation\_error(~~\_\_( 'You need to specify a domain', 'wp-auth0' )~~ ); |
  | 329 |  | } |
  | 330 |  |  |
  | 331 |  | $input['custom\_domain'] = $this->sanitize\_text\_val(~~$input['custom\_domain'] ?? null~~ ); |
  | 332 |  |  |
  | 333 |  | $input['client\_id'] = $this->sanitize\_text\_val(~~$input['client\_id'] ?? null~~ ); |
  | 334 |  | if (~~empty( $input['client\_id'] )~~ ) { |
  | 335 |  | $this->add\_validation\_error(~~\_\_( 'You need to specify a Client ID', 'wp-auth0' )~~ ); |
  | 336 |  | } |
  | 337 |  |  |
  | 338 |  | $input['client\_secret'] = $this->sanitize\_text\_val(~~$input['client\_secret'] ?? null~~ ); |
  | 339 |  | if (~~\_\_( '[REDACTED]', 'wp-auth0' ) === $input['client\_secret']~~ ) { |
  |  | 344 | $input['domain'] = $this->sanitize\_text\_val($input['domain'] ?? null); |
  |  | 345 | if (empty($input['domain'])) { |
  |  | 346 | $this->add\_validation\_error(esc\_html\_\_('You need to specify a domain', 'wp-auth0')); |
  |  | 347 | } |
  |  | 348 |  |
  |  | 349 | $input['custom\_domain'] = $this->sanitize\_text\_val($input['custom\_domain'] ?? null); |
  |  | 350 |  |
  |  | 351 | $input['client\_id'] = $this->sanitize\_text\_val($input['client\_id'] ?? null); |
  |  | 352 | if (empty($input['client\_id'])) { |
  |  | 353 | $this->add\_validation\_error(esc\_html\_\_('You need to specify a Client ID', 'wp-auth0')); |
  |  | 354 | } |
  |  | 355 |  |
  |  | 356 | $input['client\_secret'] = $this->sanitize\_text\_val($input['client\_secret'] ?? null); |
  |  | 357 | if (esc\_html\_\_('[REDACTED]', 'wp-auth0') === $input['client\_secret']) { |
  | 340 | 358 | // The field is loaded with "[REDACTED]" so if that value is saved, we keep the existing secret. |
  | 341 |  | $input['client\_secret'] = $this->options->get(~~'client\_secret'~~ ); |
  | 342 |  | } |
  | 343 |  | if (~~empty( $input['client\_secret'] )~~ ) { |
  | 344 |  | $this->add\_validation\_error(~~\_\_( 'You need to specify a Client Secret', 'wp-auth0' )~~ ); |
  | 345 |  | } |
  | 346 |  |  |
  | 347 |  | $input['organization'] = $this->sanitize\_text\_val(~~$input['organization'] ?? null~~ ); |
  |  | 359 | $input['client\_secret'] = $this->options->get('client\_secret'); |
  |  | 360 | } |
  |  | 361 | if (empty($input['client\_secret'])) { |
  |  | 362 | $this->add\_validation\_error(esc\_html\_\_('You need to specify a Client Secret', 'wp-auth0')); |
  |  | 363 | } |
  |  | 364 |  |
  |  | 365 | $input['organization'] = $this->sanitize\_text\_val($input['organization'] ?? null); |
  | 348 | 366 |  |
  | 349 | 367 | $id\_token\_alg = $input['client\_signing\_algorithm'] ?? null; |
  | 350 |  | if (~~! in\_array( $id\_token\_alg, self::ALLOWED\_ID\_TOKEN\_ALGS )~~ ) { |
  | 351 |  | $input['client\_signing\_algorithm'] = $this->options->get\_default(~~'client\_signing\_algorithm'~~ ); |
  | 352 |  | } |
  | 353 |  |  |
  | 354 |  | $input['cache\_expiration'] = absint(~~$input['cache\_expiration'] ?? 0~~ ); |
  |  | 368 | if (!in\_array($id\_token\_alg, self::ALLOWED\_ID\_TOKEN\_ALGS)) { |
  |  | 369 | $input['client\_signing\_algorithm'] = $this->options->get\_default('client\_signing\_algorithm'); |
  |  | 370 | } |
  |  | 371 |  |
  |  | 372 | $input['cache\_expiration'] = absint($input['cache\_expiration'] ?? 0); |
  | 355 | 373 |  |
  | 356 | 374 | $wle = $input['wordpress\_login\_enabled'] ?? null; |
  | 357 |  | if (~~! in\_array( $wle, [ 'link', 'isset', 'code', 'no' ] )~~ ) { |
  | 358 |  | $input['wordpress\_login\_enabled'] = $this->options->get\_default(~~'wordpress\_login\_enabled'~~ ); |
  | 359 |  | } |
  | 360 |  |  |
  | 361 |  | $input['wle\_code'] = $this->options->get(~~'wle\_code' ) ?: wp\_auth0\_generate\_token( 24~~ ); |
  |  | 375 | if (!in\_array($wle, ['link', 'isset', 'code', 'no'])) { |
  |  | 376 | $input['wordpress\_login\_enabled'] = $this->options->get\_default('wordpress\_login\_enabled'); |
  |  | 377 | } |
  |  | 378 |  |
  |  | 379 | $input['wle\_code'] = $this->options->get('wle\_code') ?: wp\_auth0\_generate\_token(24); |
  | 362 | 380 |  |
  | 363 | 381 | return $input; |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin\_Features.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php")

  | [r2856828](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L1 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Admin\_Features. |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L12) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Fields and validations for the Features settings tab. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Admin\_Features extends WP\_Auth0\_Admin\_Generic { |
  |  | 15 | class WP\_Auth0\_Admin\_Features extends WP\_Auth0\_Admin\_Generic |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L20) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L22) |  |
  | 20 | 22 | \* @see \WP\_Auth0\_Admin\_Generic::init\_option\_section |
  | 21 | 23 | \*/ |
  | 22 |  | public function init() { |
  |  | 24 | public function init() |
  |  | 25 | { |
  | 23 | 26 | $options = [ |
  | 24 | 27 | [ |
  | 25 |  | 'name'     => ~~\_\_( 'Universal Login Page', 'wp-auth0'~~ ), |
  |  | 28 | 'name'     => esc\_html\_\_('Universal Login Page', 'wp-auth0'), |
  | 26 | 29 | 'opt'      => 'auto\_login', |
  | 27 | 30 | 'id'       => 'wpa0\_auto\_login', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L29) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L32) |  |
  | 29 | 32 | ], |
  | 30 | 33 | [ |
  | 31 |  | 'name'     => ~~\_\_( 'Auto Login Parameters', 'wp-auth0'~~ ), |
  |  | 34 | 'name'     => esc\_html\_\_('Auto Login Parameters', 'wp-auth0'), |
  | 32 | 35 | 'opt'      => 'auto\_login\_params', |
  | 33 | 36 | 'id'       => 'wpa0\_auto\_login\_params', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L35) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L38) |  |
  | 35 | 38 | ], |
  | 36 | 39 | [ |
  | 37 |  | 'name'     => ~~\_\_( 'Auto Login Method', 'wp-auth0'~~ ), |
  |  | 40 | 'name'     => esc\_html\_\_('Auto Login Method', 'wp-auth0'), |
  | 38 | 41 | 'opt'      => 'auto\_login\_method', |
  | 39 | 42 | 'id'       => 'wpa0\_auto\_login\_method', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L41) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L44) |  |
  | 41 | 44 | ], |
  | 42 | 45 | [ |
  | 43 |  | 'name'     => ~~\_\_( 'Auth0 Logout', 'wp-auth0'~~ ), |
  |  | 46 | 'name'     => esc\_html\_\_('Auth0 Logout', 'wp-auth0'), |
  | 44 | 47 | 'opt'      => 'singlelogout', |
  | 45 | 48 | 'id'       => 'wpa0\_singlelogout', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L47) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L50) |  |
  | 47 | 50 | ], |
  | 48 | 51 | [ |
  | 49 |  | 'name'     => ~~\_\_( 'Override WordPress Avatars', 'wp-auth0'~~ ), |
  |  | 52 | 'name'     => esc\_html\_\_('Override WordPress Avatars', 'wp-auth0'), |
  | 50 | 53 | 'opt'      => 'override\_wp\_avatars', |
  | 51 | 54 | 'id'       => 'wpa0\_override\_wp\_avatars', |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L54) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L57) |  |
  | 54 | 57 | ]; |
  | 55 | 58 |  |
  | 56 |  | $this->init\_option\_section(~~'', 'features', $options~~ ); |
  |  | 59 | $this->init\_option\_section('', 'features', $options); |
  | 57 | 60 | } |
  | 58 | 61 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L66) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L69) |  |
  | 66 | 69 | \* @see add\_settings\_field() |
  | 67 | 70 | \*/ |
  | 68 |  | public function render\_singlelogout( $args = [] ) { |
  | 69 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  |  | 71 | public function render\_singlelogout($args = []) |
  |  | 72 | { |
  |  | 73 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  | 70 | 74 | $this->render\_field\_description( |
  | 71 |  | ~~\_\_( 'Turning this on will log users out of Auth0 when they log out of WordPress.', 'wp-auth0'~~ ) |
  |  | 75 | esc\_html\_\_('Turning this on will log users out of Auth0 when they log out of WordPress.', 'wp-auth0') |
  | 72 | 76 | ); |
  | 73 | 77 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L82) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L86) |  |
  | 82 | 86 | \* @see add\_settings\_field() |
  | 83 | 87 | \*/ |
  | 84 |  | public function render\_auto\_login( $args = [] ) { |
  | 85 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'], 'wpa0\_auto\_login\_options' ); |
  |  | 88 | public function render\_auto\_login($args = []) |
  |  | 89 | { |
  |  | 90 | $this->render\_switch($args['label\_for'], $args['opt\_name'], 'wpa0\_auto\_login\_options'); |
  | 86 | 91 | $this->render\_field\_description( |
  | 87 |  | ~~\_\_( 'Use the Universal Login Page (ULP) for authentication and SSO. ', 'wp-auth0'~~ ) . |
  | 88 |  | ~~\_\_( 'When turned on, <code>wp-login.php</code> will redirect to the hosted login page. ', 'wp-auth0'~~ ) . |
  | 89 |  | ~~\_\_( 'When turned off, <code>wp-login.php</code> will show an embedded login form. ', 'wp-auth0'~~ ) . |
  | 90 |  | ~~$this->get\_docs\_link( 'guides/login/universal-vs-embedded', \_\_( 'More on ULP vs embedded here', 'wp-auth0' )~~ ) |
  |  | 92 | esc\_html\_\_('Use the Universal Login Page (ULP) for authentication and SSO. ', 'wp-auth0') . |
  |  | 93 | wp\_kses(\_\_('When turned on, <code>wp-login.php</code> will redirect to the hosted login page. ', 'wp-auth0'), ['code' => []]) . |
  |  | 94 | wp\_kses(\_\_('When turned off, <code>wp-login.php</code> will show an embedded login form. ', 'wp-auth0'), ['code' => []]) . |
  |  | 95 | $this->get\_docs\_link('guides/login/universal-vs-embedded', esc\_html\_\_('More on ULP vs embedded here', 'wp-auth0')) |
  | 91 | 96 | ); |
  | 92 | 97 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L101) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L106) |  |
  | 101 | 106 | \* @see add\_settings\_field() |
  | 102 | 107 | \*/ |
  | 103 |  | public function render\_auto\_login\_params( $args = [] ) { |
  | 104 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], '', '', '', 'wpa0\_auto\_login\_options' ); |
  |  | 108 | public function render\_auto\_login\_params($args = []) |
  |  | 109 | { |
  |  | 110 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', '', '', 'wpa0\_auto\_login\_options'); |
  | 105 | 111 | $this->render\_field\_description( |
  | 106 |  | ~~\_\_( 'Optional. Here you can specify additional parameters to pass to the the Universal Login Page (ULP) during authentication. ', 'wp-auth0'~~ ) . |
  | 107 |  | ~~\_\_( 'For example, you can specify <code>screen\_hint=signup</code> or <code>prompt=login</code> parameters here. ', 'wp-auth0'~~ ) . |
  | 108 |  | ~~$this->get\_docs\_link( 'docs/login/universal-login/new-experience', \_\_( 'Learn more about available ULP parameters here', 'wp-auth0' )~~ ) |
  |  | 112 | esc\_html\_\_('Optional. Here you can specify additional parameters to pass to the the Universal Login Page (ULP) during authentication. ', 'wp-auth0') . |
  |  | 113 | wp\_kses(\_\_('For example, you can specify <code>screen\_hint=signup</code> or <code>prompt=login</code> parameters here. ', 'wp-auth0'), ['code' => []]) . |
  |  | 114 | $this->get\_docs\_link('docs/login/universal-login/new-experience', esc\_html\_\_('Learn more about available ULP parameters here', 'wp-auth0')) |
  | 109 | 115 | ); |
  | 110 | 116 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L119) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L125) |  |
  | 119 | 125 | \* @see add\_settings\_field() |
  | 120 | 126 | \*/ |
  | 121 |  | public function render\_auto\_login\_method( $args = [] ) { |
  | 122 |  | $this->render\_text\_field( $args['label\_for'], $args['opt\_name'], '', '', '', 'wpa0\_auto\_login\_options' ); |
  |  | 127 | public function render\_auto\_login\_method($args = []) |
  |  | 128 | { |
  |  | 129 | $this->render\_text\_field($args['label\_for'], $args['opt\_name'], 'text', '', '', 'wpa0\_auto\_login\_options'); |
  | 123 | 130 | $this->render\_field\_description( |
  | 124 |  | ~~\_\_( 'Enter a name here to automatically use a single, specific connection to login . ', 'wp-auth0'~~ ) . |
  | 125 |  | sprintf( |
  | 126 |  | // translators: Placeholder is an HTML link to the Auth0 dashboard. |
  | 127 |  | ~~\_\_( 'Find the method name to use under Connections > [Connection Type] in your %s. ', 'wp-auth0'~~ ), |
  | 128 |  | $this->get\_dashboard\_link() |
  | 129 |  | ) . |
  | 130 |  | ~~\_\_( 'Click the expand icon and use the value in the "Name" field (like "google-oauth2")', 'wp-auth0'~~ ) |
  |  | 131 | esc\_html\_\_('Enter a name here to automatically use a single, specific connection to login . ', 'wp-auth0') . |
  |  | 132 | wp\_kses(sprintf( |
  |  | 133 | // translators: Placeholder is an HTML link to the Auth0 dashboard. |
  |  | 134 | esc\_html\_\_('Find the method name to use under Connections > [Connection Type] in your %s. ', 'wp-auth0'), |
  |  | 135 | $this->get\_dashboard\_link() |
  |  | 136 | ), ['a' => ['href' => true, 'target' => true]]) . |
  |  | 137 | esc\_html\_\_('Click the expand icon and use the value in the "Name" field (like "google-oauth2")', 'wp-auth0') |
  | 131 | 138 | ); |
  | 132 | 139 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L141) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L148) |  |
  | 141 | 148 | \* @see add\_settings\_field() |
  | 142 | 149 | \*/ |
  | 143 |  | public function render\_override\_wp\_avatars( $args = [] ) { |
  | 144 |  | $this->render\_switch( $args['label\_for'], $args['opt\_name'] ); |
  |  | 150 | public function render\_override\_wp\_avatars($args = []) |
  |  | 151 | { |
  |  | 152 | $this->render\_switch($args['label\_for'], $args['opt\_name']); |
  | 145 | 153 | $this->render\_field\_description( |
  | 146 |  | ~~\_\_( 'Overrides the WordPress avatar with the Auth0 profile avatar', 'wp-auth0'~~ ) |
  |  | 154 | esc\_html\_\_('Overrides the WordPress avatar with the Auth0 profile avatar', 'wp-auth0') |
  | 147 | 155 | ); |
  | 148 | 156 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=2856828#L155) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Features.php?rev=3114611#L163) |  |
  | 155 | 163 | \* @return array |
  | 156 | 164 | \*/ |
  | 157 |  | public function basic\_validation( array $input ) { |
  | 158 |  | $input['auto\_login']          = $this->sanitize\_switch\_val( $input['auto\_login'] ?? null ); |
  | 159 |  | $input['auto\_login\_params']   = $this->sanitize\_query\_parameters( $input['auto\_login\_params'] ?? null ); |
  | 160 |  | $input['auto\_login\_method']   = $this->sanitize\_text\_val( $input['auto\_login\_method'] ?? null ); |
  | 161 |  | $input['singlelogout']        = $this->sanitize\_switch\_val( $input['singlelogout'] ?? null ); |
  | 162 |  | $input['override\_wp\_avatars'] = $this->sanitize\_switch\_val( $input['override\_wp\_avatars'] ?? null ); |
  |  | 165 | public function basic\_validation(array $input) |
  |  | 166 | { |
  |  | 167 | $input['auto\_login']          = $this->sanitize\_switch\_val($input['auto\_login'] ?? null); |
  |  | 168 | $input['auto\_login\_params']   = $this->sanitize\_query\_parameters($input['auto\_login\_params'] ?? null); |
  |  | 169 | $input['auto\_login\_method']   = $this->sanitize\_text\_val($input['auto\_login\_method'] ?? null); |
  |  | 170 | $input['singlelogout']        = $this->sanitize\_switch\_val($input['singlelogout'] ?? null); |
  |  | 171 | $input['override\_wp\_avatars'] = $this->sanitize\_switch\_val($input['override\_wp\_avatars'] ?? null); |
  | 163 | 172 | return $input; |
  | 164 | 173 | } |
* ## [auth0/trunk/lib/admin/WP\_Auth0\_Admin\_Generic.php](/changeset/3114611/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php "Show the changeset 3114611 restricted to auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php")

  | [r2856828](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L1 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_Admin\_Generic { |
  |  | 3 | class WP\_Auth0\_Admin\_Generic |
  |  | 4 | { |
  | 4 | 5 |  |
  | 5 | 6 | const ERROR\_FIELD\_STYLE = 'border: 1px solid red;'; |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L16) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L17) |  |
  | 16 | 17 | \* @var array |
  | 17 | 18 | \*/ |
  | 18 |  | protected $actions\_middlewares = [~~'basic\_validation'~~ ]; |
  |  | 19 | protected $actions\_middlewares = ['basic\_validation']; |
  | 19 | 20 |  |
  | 20 | 21 | /\*\* |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L23) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L24) |  |
  | 23 | 24 | \* @param WP\_Auth0\_Options $options |
  | 24 | 25 | \*/ |
  | 25 |  | public function \_\_construct( WP\_Auth0\_Options $options ) { |
  |  | 26 | public function \_\_construct(WP\_Auth0\_Options $options) |
  |  | 27 | { |
  | 26 | 28 | $this->options      = $options; |
  | 27 | 29 | $this->\_option\_name = $options->get\_options\_name(); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L35) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L37) |  |
  | 35 | 37 | \* @param array  $options - array of settings fields |
  | 36 | 38 | \*/ |
  | 37 |  | protected function init\_option\_section( $section\_name, $id, $options ) { |
  | 38 |  | $options\_name = $this->\_option\_name . '\_' . strtolower( $id ); |
  |  | 39 | protected function init\_option\_section($section\_name, $id, $options) |
  |  | 40 | { |
  |  | 41 | $options\_name = $this->\_option\_name . '\_' . strtolower($id); |
  | 39 | 42 | $section\_id   = "wp\_auth0\_{$id}\_settings\_section"; |
  | 40 | 43 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L46) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L49) |  |
  | 46 | 49 | ); |
  | 47 | 50 |  |
  | 48 |  | $options = apply\_filters(~~'auth0\_settings\_fields', $options, $id~~ ); |
  | 49 |  |  |
  | 50 |  | foreach (~~$options as $setting~~ ) { |
  | 51 |  | $callback = function\_exists(~~$setting['function']~~ ) |
  |  | 51 | $options = apply\_filters('auth0\_settings\_fields', $options, $id); |
  |  | 52 |  |
  |  | 53 | foreach ($options as $setting) { |
  |  | 54 | $callback = function\_exists($setting['function']) |
  | 52 | 55 | ? $setting['function'] |
  | 53 |  | : [~~$this, $setting['function']~~ ]; |
  |  | 56 | : [$this, $setting['function']]; |
  | 54 | 57 |  |
  | 55 | 58 | add\_settings\_field( |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L61) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L64) |  |
  | 61 | 64 | [ |
  | 62 | 65 | 'label\_for' => $setting['id'], |
  | 63 |  | 'opt\_name'  => isset(~~$setting['opt']~~ ) ? $setting['opt'] : null, |
  |  | 66 | 'opt\_name'  => isset($setting['opt']) ? $setting['opt'] : null, |
  | 64 | 67 | ] |
  | 65 | 68 | ); |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L67) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L70) |  |
  | 67 | 70 | } |
  | 68 | 71 |  |
  | 69 |  | public function input\_validator( $input ) { |
  | 70 |  |  |
  | 71 |  | foreach ( $this->actions\_middlewares as $action ) { |
  | 72 |  | $input = $this->$action( $input ); |
  |  | 72 | public function input\_validator($input) |
  |  | 73 | { |
  |  | 74 |  |
  |  | 75 | foreach ($this->actions\_middlewares as $action) { |
  |  | 76 | $input = $this->$action($input); |
  | 73 | 77 | } |
  | 74 | 78 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L82) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L86) |  |
  | 82 | 86 | \* @param string $type - Notice type, "error" by default or "updated". |
  | 83 | 87 | \*/ |
  | 84 |  | protected function add\_validation\_error( $error, $type = 'error' ) { |
  |  | 88 | protected function add\_validation\_error($error, $type = 'error') |
  |  | 89 | { |
  | 85 | 90 | add\_settings\_error( |
  | 86 | 91 | $this->\_option\_name, |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L98) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L103) |  |
  | 98 | 103 | \* @param string $expand\_id - id of a field that should be hidden until this switch is active |
  | 99 | 104 | \*/ |
  | 100 |  | protected function render\_switch( $id, $input\_name, $expand\_id = '' ) { |
  | 101 |  | $value = $this->options->get( $input\_name ); |
  | 102 |  | if ( $field\_is\_const = $this->options->has\_constant\_val( $input\_name ) ) { |
  | 103 |  | $this->render\_const\_notice( $input\_name ); |
  | 104 |  | } |
  | 105 |  | printf( |
  |  | 105 | protected function render\_switch($id, $input\_name, $expand\_id = '') |
  |  | 106 | { |
  |  | 107 | $value = $this->options->get($input\_name); |
  |  | 108 |  |
  |  | 109 | if ($field\_is\_const = $this->options->has\_constant\_val($input\_name)) { |
  |  | 110 | $this->render\_const\_notice($input\_name); |
  |  | 111 | } |
  |  | 112 |  |
  |  | 113 | echo wp\_kses(sprintf( |
  | 106 | 114 | '<div class="a0-switch"><input type="checkbox" name="%s[%s]" id="%s" data-expand="%s" value="1" %s %s> |
  | 107 | 115 | <label for="%s"></label></div>', |
  | 108 |  | esc\_attr(~~$this->\_option\_name~~ ), |
  | 109 |  | esc\_attr(~~$input\_name~~ ), |
  | 110 |  | esc\_attr(~~$id~~ ), |
  | 111 |  | !~~empty( $expand\_id ) ? esc\_attr( $expand\_id~~ ) : '', |
  | 112 |  | checked(~~empty( $value ), false, false~~ ), |
  |  | 116 | esc\_attr($this->\_option\_name), |
  |  | 117 | esc\_attr($input\_name), |
  |  | 118 | esc\_attr($id), |
  |  | 119 | !empty($expand\_id) ? esc\_attr($expand\_id) : '', |
  |  | 120 | checked(empty($value), false, false), |
  | 113 | 121 | $field\_is\_const ? 'disabled' : '', |
  | 114 |  | esc\_attr(~~$id~~ ) |
  | 115 |  | ); |
  |  | 122 | esc\_attr($id) |
  |  | 123 | ), ['div' => ['class' => true], 'input' => ['type' => true, 'name' => true, 'id' => true, 'data-expand' => true, 'value' => true, 'checked' => true, 'disabled' => true], 'label' => ['for' => true]]); |
  | 116 | 124 | } |
  | 117 | 125 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L126) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L134) |  |
  | 126 | 134 | \* @param string $grouping - A string representing a one or more items in a grouping of related settings that will have their visibility toggled by a switch state. |
  | 127 | 135 | \*/ |
  | 128 |  | protected function render\_text\_field( $id, $input\_name, $type = 'text', $placeholder = '', $style = '', $grouping = '' ) { |
  | 129 |  | $value = $this->options->get( $input\_name ); |
  |  | 136 | protected function render\_text\_field($id, $input\_name, $type = 'text', $placeholder = '', $style = '', $grouping = '') |
  |  | 137 | { |
  |  | 138 | $value = $this->options->get($input\_name); |
  | 130 | 139 |  |
  | 131 | 140 | // Secure fields are not output by default; validation keeps last value if a new one is not entered |
  | 132 |  | if (~~'password' === $type~~ ) { |
  | 133 |  | $value = empty(~~$value ) ? '' : \_\_( '[REDACTED]', 'wp-auth0'~~ ); |
  |  | 141 | if ('password' === $type) { |
  |  | 142 | $value = empty($value) ? '' : esc\_html\_\_('[REDACTED]', 'wp-auth0'); |
  | 134 | 143 | $type  = 'text'; |
  | 135 | 144 | } |
  | 136 |  | if (~~$field\_is\_const = $this->options->has\_constant\_val( $input\_name )~~ ) { |
  | 137 |  | $this->render\_const\_notice(~~$input\_name~~ ); |
  | 138 |  | } |
  | 139 |  | printf( |
  | 140 |  | '<input data-group="%s" type="%s" name="%s[%s]" id="%s" value="%s" placeholder="%s" style="%s" %s>', |
  | 141 |  | esc\_attr(~~$grouping~~ ), |
  | 142 |  | esc\_attr(~~$type~~ ), |
  | 143 |  | esc\_attr(~~$this->\_option\_name~~ ), |
  | 144 |  | esc\_attr(~~$input\_name~~ ), |
  | 145 |  | esc\_attr(~~$id~~ ), |
  | 146 |  | esc\_attr(~~$value~~ ), |
  | 147 |  | $placeholder ? esc\_attr(~~$placeholder~~ ) : '', |
  | 148 |  | $style ? esc\_attr(~~$style~~ ) : '', |
  |  | 145 | if ($field\_is\_const = $this->options->has\_constant\_val($input\_name)) { |
  |  | 146 | $this->render\_const\_notice($input\_name); |
  |  | 147 | } |
  |  | 148 | echo wp\_kses(sprintf( |
  |  | 149 | '<input data-group="%s" type="%s" name="%s[%s]" id="%s" value="%s" placeholder="%s" style="%s" %s />', |
  |  | 150 | esc\_attr($grouping), |
  |  | 151 | esc\_attr($type), |
  |  | 152 | esc\_attr($this->\_option\_name), |
  |  | 153 | esc\_attr($input\_name), |
  |  | 154 | esc\_attr($id), |
  |  | 155 | esc\_attr($value), |
  |  | 156 | $placeholder ? esc\_attr($placeholder) : '', |
  |  | 157 | $style ? esc\_attr($style) : '', |
  | 149 | 158 | $field\_is\_const ? 'disabled' : '' |
  | 150 |  | ); |
  |  | 159 | ), ['input' => ['data-group' => true, 'type' => true, 'name' => true, 'id' => true, 'value' => true, 'placeholder' => true, 'style' => true, 'disabled' => true]]); |
  | 151 | 160 | } |
  | 152 | 161 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L157) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L166) |  |
  | 157 | 166 | \* @param string $input\_name - input name attribute |
  | 158 | 167 | \*/ |
  | 159 |  | protected function render\_textarea\_field( $id, $input\_name ) { |
  | 160 |  | $value = $this->options->get( $input\_name ); |
  | 161 |  | if ( $field\_is\_const = $this->options->has\_constant\_val( $input\_name ) ) { |
  | 162 |  | $this->render\_const\_notice( $input\_name ); |
  | 163 |  | } |
  | 164 |  | printf( |
  |  | 168 | protected function render\_textarea\_field($id, $input\_name) |
  |  | 169 | { |
  |  | 170 | $value = $this->options->get($input\_name); |
  |  | 171 | if ($field\_is\_const = $this->options->has\_constant\_val($input\_name)) { |
  |  | 172 | $this->render\_const\_notice($input\_name); |
  |  | 173 | } |
  |  | 174 | echo wp\_kses(sprintf( |
  | 165 | 175 | '<textarea name="%s[%s]" id="%s" rows="%d" class="code" %s>%s</textarea>', |
  | 166 |  | esc\_attr(~~$this->\_option\_name~~ ), |
  | 167 |  | esc\_attr(~~$input\_name~~ ), |
  | 168 |  | esc\_attr(~~$id~~ ), |
  |  | 176 | esc\_attr($this->\_option\_name), |
  |  | 177 | esc\_attr($input\_name), |
  |  | 178 | esc\_attr($id), |
  | 169 | 179 | $this->\_textarea\_rows, |
  | 170 | 180 | $field\_is\_const ? 'disabled' : '', |
  | 171 |  | esc\_textarea(~~$value~~ ) |
  | 172 |  | ); |
  |  | 181 | esc\_textarea($value) |
  |  | 182 | ), ['textarea' => ['name' => true, 'id' => true, 'rows' => true, 'class' => true, 'disabled' => true]]); |
  | 173 | 183 | } |
  | 174 | 184 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L182) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L192) |  |
  | 182 | 192 | \* @param bool             $vert - True to use vertical orientation for buttons. |
  | 183 | 193 | \*/ |
  | 184 |  | protected function render\_radio\_buttons( array $buttons, $id, $input\_name, $curr\_value, $vert = false ) { |
  | 185 |  | if ( $field\_is\_const = $this->options->has\_constant\_val( $input\_name ) ) { |
  | 186 |  | $this->render\_const\_notice( $input\_name ); |
  | 187 |  | } |
  | 188 |  | foreach ( $buttons as $index => $button ) { |
  |  | 194 | protected function render\_radio\_buttons(array $buttons, $id, $input\_name, $curr\_value, $vert = false) |
  |  | 195 | { |
  |  | 196 | if ($field\_is\_const = $this->options->has\_constant\_val($input\_name)) { |
  |  | 197 | $this->render\_const\_notice($input\_name); |
  |  | 198 | } |
  |  | 199 |  |
  |  | 200 | foreach ($buttons as $index => $button) { |
  | 189 | 201 | $id\_attr = $id . '\_' . $index; |
  | 190 |  | $label   = is\_array( $button ) ? $button['label'] : ucfirst( $button ); |
  | 191 |  | $value   = is\_array( $button ) ? $button['value'] : $button; |
  | 192 |  | $desc    = isset( $button['desc'] ) ? '<p class="description">' . $button['desc'] . '</p>' : ''; |
  | 193 |  | printf( |
  |  | 202 | $label   = is\_array($button) ? $button['label'] : ucfirst($button); |
  |  | 203 | $value   = is\_array($button) ? $button['value'] : $button; |
  |  | 204 | $desc    = isset($button['desc']) ? '<p class="description">' . $button['desc'] . '</p>' : ''; |
  |  | 205 |  |
  |  | 206 | echo wp\_kses(sprintf( |
  | 194 | 207 | '%s<label for="%s"><input type="radio" name="%s[%s]" id="%s" value="%s" %s %s>%s</label> %s', |
  | 195 | 208 | $vert ? '<div class="a0-vert-radio">' : '', |
  | 196 |  | esc\_attr(~~$id\_attr~~ ), |
  | 197 |  | esc\_attr(~~$this->\_option\_name~~ ), |
  | 198 |  | esc\_attr(~~$input\_name~~ ), |
  | 199 |  | esc\_attr(~~$id\_attr~~ ), |
  | 200 |  | esc\_attr(~~$value~~ ), |
  | 201 |  | checked(~~$value === $curr\_value, true, false~~ ), |
  |  | 209 | esc\_attr($id\_attr), |
  |  | 210 | esc\_attr($this->\_option\_name), |
  |  | 211 | esc\_attr($input\_name), |
  |  | 212 | esc\_attr($id\_attr), |
  |  | 213 | esc\_attr($value), |
  |  | 214 | checked($value === $curr\_value, true, false), |
  | 202 | 215 | $field\_is\_const ? 'disabled' : '', |
  | 203 |  | sanitize\_text\_field(~~$label~~ ), |
  |  | 216 | sanitize\_text\_field($label), |
  | 204 | 217 | $vert ? $desc . '</div>' : '' |
  | 205 |  | ); |
  |  | 218 | ), ['label' => ['for' => true], 'input' => ['type' => true, 'name' => true, 'id' => true, 'value' => true, 'checked' => true, 'disabled' => true], 'div' => ['class' => true], 'code' => ['class' => true], 'a' => ['href' => true, 'target' => true], 'span' => ['class' => true], 'br' => []]); |
  | 206 | 219 | } |
  | 207 | 220 | } |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L212) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L225) |  |
  | 212 | 225 | \* @param string $text - description text to display |
  | 213 | 226 | \*/ |
  | 214 |  | protected function render\_field\_description( $text ) { |
  | 215 |  | $period = ! in\_array( $text[ strlen( $text ) - 1 ], [ '.', ':' ] ) ? '.' : ''; |
  | 216 |  | printf( '<div class="subelement"><span class="description">%s%s</span></div>', $text, $period ); |
  |  | 227 | protected function render\_field\_description($text) |
  |  | 228 | { |
  |  | 229 | $period = !in\_array($text[strlen($text) - 1], ['.', ':']) ? '.' : ''; |
  |  | 230 | echo wp\_kses(sprintf('<div class="subelement"><span class="description">%s%s</span></div>', $text, $period), ['div' => ['class' => true], 'span' => ['class' => true], 'a' => ['href' => true, 'target' => true], 'code' => ['class' => true]]); |
  | 217 | 231 | } |
  | 218 | 232 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L222) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L236) |  |
  | 222 | 236 | \* @param string $input\_name - Input name for the field, used as option key. |
  | 223 | 237 | \*/ |
  | 224 |  | protected function render\_const\_notice( $input\_name ) { |
  | 225 |  | printf( |
  |  | 238 | protected function render\_const\_notice($input\_name) |
  |  | 239 | { |
  |  | 240 | echo wp\_kses(sprintf( |
  | 226 | 241 | '<p class="const-setting-notice"><span class="description">%s <code>%s</code></span></p>', |
  | 227 |  | ~~\_\_( 'Value is set in the constant ', 'wp-auth0'~~ ), |
  | 228 |  | $this->options->get\_constant\_name(~~$input\_name~~ ) |
  | 229 |  | ); |
  |  | 242 | esc\_html\_\_('Value is set in the constant ', 'wp-auth0'), |
  |  | 243 | $this->options->get\_constant\_name($input\_name) |
  |  | 244 | ), ['p' => ['class' => true], 'span' => ['class' => true]], ['code' => []]); |
  | 230 | 245 | } |
  | 231 | 246 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L237) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L252) |  |
  | 237 | 252 | \* @return string |
  | 238 | 253 | \*/ |
  | 239 |  | protected function get\_dashboard\_link( $path = '' ) { |
  | 240 |  | return sprintf( |
  |  | 254 | protected function get\_dashboard\_link($path = '') |
  |  | 255 | { |
  |  | 256 | return wp\_kses(sprintf( |
  | 241 | 257 | '<a href="https://manage.auth0.com/#/%s" target="\_blank">%s</a>', |
  | 242 | 258 | $path, |
  | 243 |  | ~~\_\_( 'Auth0 dashboard', 'wp-auth0'~~ ) |
  | 244 |  | ); |
  |  | 259 | esc\_html\_\_('Auth0 dashboard', 'wp-auth0') |
  |  | 260 | ), ['a' => ['href' => true, 'target' => true]]); |
  | 245 | 261 | } |
  | 246 | 262 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L253) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L269) |  |
  | 253 | 269 | \* @return string |
  | 254 | 270 | \*/ |
  | 255 |  | protected function get\_docs\_link( $path, $text = '' ) { |
  | 256 |  | $path = '/' === $path[0] ? substr( $path, 1 ) : $path; |
  | 257 |  | $text = empty( $text ) ? \_\_( 'here', 'wp-auth0' ) : sanitize\_text\_field( $text ); |
  | 258 |  | return sprintf( '<a href="https://auth0.com/docs/%s" target="\_blank">%s</a>', $path, $text ); |
  |  | 271 | protected function get\_docs\_link($path, $text = '') |
  |  | 272 | { |
  |  | 273 | $path = '/' === $path[0] ? substr($path, 1) : $path; |
  |  | 274 | $text = empty($text) ? esc\_html\_\_('here', 'wp-auth0') : sanitize\_text\_field($text); |
  |  | 275 | return wp\_kses(sprintf('<a href="https://auth0.com/docs/%s" target="\_blank">%s</a>', $path, $text), ['a' => ['href' => true, 'target' => true]]); |
  | 259 | 276 | } |
  | 260 | 277 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L266) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L283) |  |
  | 266 | 283 | \* @return bool |
  | 267 | 284 | \*/ |
  | 268 |  | protected function sanitize\_switch\_val( $val ) { |
  | 269 |  | return in\_array( $val, [ 1, '1', true ], true ) ? true : false; |
  | 270 |  | } |
  | 271 |  |  |
  | 272 |  | protected function sanitize\_text\_val( $val ) { |
  | 273 |  | return sanitize\_text\_field( trim( strval( $val ) ) ); |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | protected function sanitize\_query\_parameters( $val ) { |
  | 277 |  | $val = trim( strval( $val ) ); |
  | 278 |  |  |
  | 279 |  | if ( strlen( $val ) === 0 ) { |
  |  | 285 | protected function sanitize\_switch\_val($val) |
  |  | 286 | { |
  |  | 287 | return in\_array($val, [1, '1', true], true) ? true : false; |
  |  | 288 | } |
  |  | 289 |  |
  |  | 290 | protected function sanitize\_text\_val($val) |
  |  | 291 | { |
  |  | 292 | return sanitize\_text\_field(trim(strval($val))); |
  |  | 293 | } |
  |  | 294 |  |
  |  | 295 | protected function sanitize\_query\_parameters($val) |
  |  | 296 | { |
  |  | 297 | $val = trim(strval($val)); |
  |  | 298 |  |
  |  | 299 | if (strlen($val) === 0) { |
  | 280 | 300 | return ''; |
  | 281 | 301 | } |
  | 282 | 302 |  |
  | 283 |  | parse\_str(~~$val, $parsed~~ ); |
  |  | 303 | parse\_str($val, $parsed); |
  | 284 | 304 | $sanitized = []; |
  | 285 | 305 |  |
  | 286 |  | foreach (~~$parsed as $key => $value~~ ) { |
  | 287 |  | $sanitized[~~$this->sanitize\_text\_val( $key ) ] = $this->sanitize\_text\_val( $value~~ ); |
  |  | 306 | foreach ($parsed as $key => $value) { |
  |  | 307 | $sanitized[$this->sanitize\_text\_val($key)] = $this->sanitize\_text\_val($value); |
  | 288 | 308 | } |
  | 289 | 309 |  |
  | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=2856828#L291) | […](/browser/auth0/trunk/lib/admin/WP_Auth0_Admin_Generic.php?rev=3114611#L311) |  |
  | 291 | 311 | array\_filter( |
  | 292 | 312 | $sanitized, |
  | 293 |  | function~~( $var~~ ) { |
  | 294 |  | ~~return ( $var !== null && $var !== false && trim( $var ) !== ''~~ ); |
  |  | 313 | function ($var) { |
  |  | 314 | return ($var !== null && $var !== false && trim($var) !== ''); |
  | 295 | 315 | } |
  | 296 | 316 | ) |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Abstract.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php")

  | [r2599514](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L1 "Show revision 2599514 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Abstract. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Abstract for API calls. |
  | 12 | 13 | \*/ |
  | 13 |  | abstract class WP\_Auth0\_Api\_Abstract { |
  |  | 14 | abstract class WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L110) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L112) |  |
  | 110 | 112 | \* @param string|null      $domain - Domain to use. |
  | 111 | 113 | \*/ |
  | 112 |  | public function \_\_construct( WP\_Auth0\_Options $options, $domain = null ) { |
  |  | 114 | public function \_\_construct(WP\_Auth0\_Options $options, $domain = null) |
  |  | 115 | { |
  | 113 | 116 | $this->options = $options; |
  | 114 | 117 |  |
  | 115 | 118 | // Required settings in the plugin. |
  | 116 |  | $this->domain        = $domain ?: $this->options->get(~~'domain'~~ ); |
  | 117 |  | $this->client\_id     = $this->options->get(~~'client\_id'~~ ); |
  | 118 |  | $this->client\_secret = $this->options->get(~~'client\_secret'~~ ); |
  | 119 |  | $this->organization  = $this->options->get(~~'organization'~~ ); |
  |  | 119 | $this->domain        = $domain ?: $this->options->get('domain'); |
  |  | 120 | $this->client\_id     = $this->options->get('client\_id'); |
  |  | 121 | $this->client\_secret = $this->options->get('client\_secret'); |
  |  | 122 | $this->organization  = $this->options->get('organization'); |
  | 120 | 123 |  |
  | 121 | 124 | // Headers sent with every request. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L128) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L131) |  |
  | 128 | 131 | \* @return array |
  | 129 | 132 | \*/ |
  | 130 |  | public static function get\_info\_headers() { |
  |  | 133 | public static function get\_info\_headers() |
  |  | 134 | { |
  | 131 | 135 | $header\_value = [ |
  | 132 | 136 | 'name'    => 'wp-auth0', |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L134) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L138) |  |
  | 134 | 138 | 'env'     => [ |
  | 135 | 139 | 'php' => phpversion(), |
  | 136 |  | 'wp'  => get\_bloginfo(~~'version'~~ ), |
  |  | 140 | 'wp'  => get\_bloginfo('version'), |
  | 137 | 141 | ], |
  | 138 | 142 | ]; |
  | 139 |  | return [~~'Auth0-Client' => base64\_encode( wp\_json\_encode( $header\_value ) )~~ ]; |
  |  | 143 | return ['Auth0-Client' => base64\_encode(wp\_json\_encode($header\_value))]; |
  | 140 | 144 | } |
  | 141 | 145 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L154) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L158) |  |
  | 154 | 158 | \* @return mixed |
  | 155 | 159 | \*/ |
  | 156 |  | abstract protected function handle\_response(~~$method~~ ); |
  |  | 160 | abstract protected function handle\_response($method); |
  | 157 | 161 |  |
  | 158 | 162 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L163) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L167) |  |
  | 163 | 167 | \* @return $this |
  | 164 | 168 | \*/ |
  | 165 |  | protected function set\_path( $path ) { |
  | 166 |  | $this->remote\_path = $this->clean\_path( $path ); |
  |  | 169 | protected function set\_path($path) |
  |  | 170 | { |
  |  | 171 | $this->remote\_path = $this->clean\_path($path); |
  | 167 | 172 | return $this; |
  | 168 | 173 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L175) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L180) |  |
  | 175 | 180 | \* @return bool |
  | 176 | 181 | \*/ |
  | 177 |  | protected function set\_bearer( $scope ) { |
  | 178 |  |  |
  | 179 |  | if ( ! $this->api\_client\_creds instanceof WP\_Auth0\_Api\_Client\_Credentials ) { |
  |  | 182 | protected function set\_bearer($scope) |
  |  | 183 | { |
  |  | 184 |  |
  |  | 185 | if (!$this->api\_client\_creds instanceof WP\_Auth0\_Api\_Client\_Credentials) { |
  | 180 | 186 | return false; |
  | 181 | 187 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L185) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L191) |  |
  | 185 | 191 |  |
  | 186 | 192 | // No stored API token so need to get a new one. |
  | 187 |  | if (~~! $api\_token~~ ) { |
  |  | 193 | if (!$api\_token) { |
  | 188 | 194 | $api\_token = $this->api\_client\_creds->call(); |
  | 189 | 195 | } |
  | 190 | 196 |  |
  | 191 | 197 | // No token to use, error recorded in previous steps. |
  | 192 |  | if (~~! $api\_token~~ ) { |
  |  | 198 | if (!$api\_token) { |
  | 193 | 199 | return false; |
  | 194 | 200 | } |
  | 195 | 201 |  |
  | 196 |  | if (~~$cc\_api::check\_stored\_scope( $scope )~~ ) { |
  |  | 202 | if ($cc\_api::check\_stored\_scope($scope)) { |
  | 197 | 203 | // Scope exists, add to the header and cache. |
  | 198 |  | $this->add\_header(~~'Authorization', 'Bearer ' . $api\_token~~ ); |
  |  | 204 | $this->add\_header('Authorization', 'Bearer ' . $api\_token); |
  | 199 | 205 | return true; |
  | 200 | 206 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L206) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L212) |  |
  | 206 | 212 | 'insufficient\_scope', |
  | 207 | 213 | // translators: The $scope var here is a machine term and should not be translated. |
  | 208 |  | sprintf(~~\_\_( 'API token does not include the scope %s.', 'wp-auth0' ), $scope~~ ) |
  |  | 214 | sprintf(esc\_html\_\_('API token does not include the scope %s.', 'wp-auth0'), $scope) |
  | 209 | 215 | ) |
  | 210 | 216 | ); |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L220) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L226) |  |
  | 220 | 226 | \* @return $this |
  | 221 | 227 | \*/ |
  | 222 |  | protected function send\_audience() { |
  |  | 228 | protected function send\_audience() |
  |  | 229 | { |
  | 223 | 230 | $this->body['audience'] = 'https://' . $this->domain . '/api/v2/'; |
  | 224 | 231 | return $this; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L230) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L237) |  |
  | 230 | 237 | \* @return $this |
  | 231 | 238 | \*/ |
  | 232 |  | protected function send\_client\_id() { |
  |  | 239 | protected function send\_client\_id() |
  |  | 240 | { |
  | 233 | 241 | $this->body['client\_id'] = $this->client\_id; |
  | 234 | 242 | return $this; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L240) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L248) |  |
  | 240 | 248 | \* @return $this |
  | 241 | 249 | \*/ |
  | 242 |  | protected function send\_client\_secret() { |
  |  | 250 | protected function send\_client\_secret() |
  |  | 251 | { |
  | 243 | 252 | $this->body['client\_secret'] = $this->client\_secret; |
  | 244 | 253 | return $this; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L250) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L259) |  |
  | 250 | 259 | \* @return $this |
  | 251 | 260 | \*/ |
  | 252 |  | protected function send\_organization() { |
  |  | 261 | protected function send\_organization() |
  |  | 262 | { |
  | 253 | 263 | $this->body['organization'] = $this->organization; |
  | 254 | 264 | return $this; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L263) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L273) |  |
  | 263 | 273 | \* @return $this |
  | 264 | 274 | \*/ |
  | 265 |  | protected function add\_header( $header, $value ) { |
  | 266 |  | $this->headers[ $header ] = $value; |
  |  | 275 | protected function add\_header($header, $value) |
  |  | 276 | { |
  |  | 277 | $this->headers[$header] = $value; |
  | 267 | 278 | return $this; |
  | 268 | 279 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L276) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L287) |  |
  | 276 | 287 | \* @return $this |
  | 277 | 288 | \*/ |
  | 278 |  | protected function add\_body( $key, $value ) { |
  | 279 |  | $this->body[ $key ] = $value; |
  |  | 289 | protected function add\_body($key, $value) |
  |  | 290 | { |
  |  | 291 | $this->body[$key] = $value; |
  | 280 | 292 | return $this; |
  | 281 | 293 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L286) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L298) |  |
  | 286 | 298 | \* @return string |
  | 287 | 299 | \*/ |
  | 288 |  | protected function build\_url() { |
  |  | 300 | protected function build\_url() |
  |  | 301 | { |
  | 289 | 302 | return 'https://' . $this->domain . '/' . $this->remote\_path; |
  | 290 | 303 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L295) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L308) |  |
  | 295 | 308 | \* @return $this |
  | 296 | 309 | \*/ |
  | 297 |  | protected function get() { |
  | 298 |  | return $this->request( 'GET' ); |
  |  | 310 | protected function get() |
  |  | 311 | { |
  |  | 312 | return $this->request('GET'); |
  | 299 | 313 | } |
  | 300 | 314 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L304) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L318) |  |
  | 304 | 318 | \* @return $this |
  | 305 | 319 | \*/ |
  | 306 |  | protected function post() { |
  | 307 |  | return $this->add\_header( 'Content-Type', 'application/json' )->request( 'POST' ); |
  |  | 320 | protected function post() |
  |  | 321 | { |
  |  | 322 | return $this->add\_header('Content-Type', 'application/json')->request('POST'); |
  | 308 | 323 | } |
  | 309 | 324 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L313) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L328) |  |
  | 313 | 328 | \* @return $this |
  | 314 | 329 | \*/ |
  | 315 |  | protected function delete() { |
  | 316 |  | return $this->request( 'DELETE' ); |
  |  | 330 | protected function delete() |
  |  | 331 | { |
  |  | 332 | return $this->request('DELETE'); |
  | 317 | 333 | } |
  | 318 | 334 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L322) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L338) |  |
  | 322 | 338 | \* @return $this |
  | 323 | 339 | \*/ |
  | 324 |  | protected function patch() { |
  | 325 |  | return $this->add\_header( 'Content-Type', 'application/json' )->request( 'PATCH' ); |
  |  | 340 | protected function patch() |
  |  | 341 | { |
  |  | 342 | return $this->add\_header('Content-Type', 'application/json')->request('PATCH'); |
  | 326 | 343 | } |
  | 327 | 344 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L334) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L351) |  |
  | 334 | 351 | \* @return bool - True if there was a WP\_Error, false if not. |
  | 335 | 352 | \*/ |
  | 336 |  | protected function handle\_wp\_error( $method ) { |
  | 337 |  | if ( $this->response instanceof WP\_Error ) { |
  | 338 |  | WP\_Auth0\_ErrorLog::insert\_error( $method, $this->response ); |
  |  | 353 | protected function handle\_wp\_error($method) |
  |  | 354 | { |
  |  | 355 | if ($this->response instanceof WP\_Error) { |
  |  | 356 | WP\_Auth0\_ErrorLog::insert\_error($method, $this->response); |
  | 339 | 357 | return true; |
  | 340 | 358 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L351) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L369) |  |
  | 351 | 369 | \* @return bool - True if there was an error, false if not. |
  | 352 | 370 | \*/ |
  | 353 |  | protected function handle\_failed\_response( $method, $success\_code = 200 ) { |
  | 354 |  |  |
  | 355 |  | if ( $this->response\_code === $success\_code ) { |
  |  | 371 | protected function handle\_failed\_response($method, $success\_code = 200) |
  |  | 372 | { |
  |  | 373 |  |
  |  | 374 | if ($this->response\_code === $success\_code) { |
  | 356 | 375 | return false; |
  | 357 | 376 | } |
  | 358 | 377 |  |
  | 359 |  | $response\_body = json\_decode(~~$this->response\_body, true~~ ); |
  | 360 |  | $message       = ~~\_\_( 'Error returned', 'wp-auth0'~~ ); |
  | 361 |  |  |
  | 362 |  | if (~~isset( $response\_body['statusCode'] )~~ ) { |
  | 363 |  |  |
  | 364 |  | if (~~isset( $response\_body['message'] )~~ ) { |
  | 365 |  | $message .= ' - ' . sanitize\_text\_field(~~$response\_body['message']~~ ); |
  |  | 378 | $response\_body = json\_decode($this->response\_body, true); |
  |  | 379 | $message       = esc\_html\_\_('Error returned', 'wp-auth0'); |
  |  | 380 |  |
  |  | 381 | if (isset($response\_body['statusCode'])) { |
  |  | 382 |  |
  |  | 383 | if (isset($response\_body['message'])) { |
  |  | 384 | $message .= ' - ' . sanitize\_text\_field($response\_body['message']); |
  | 366 | 385 | } |
  | 367 |  | if (~~isset( $response\_body['errorCode'] )~~ ) { |
  | 368 |  | $message .= ' [' . sanitize\_text\_field(~~$response\_body['errorCode']~~ ) . ']'; |
  |  | 386 | if (isset($response\_body['errorCode'])) { |
  |  | 387 | $message .= ' [' . sanitize\_text\_field($response\_body['errorCode']) . ']'; |
  | 369 | 388 | } |
  | 370 |  | WP\_Auth0\_ErrorLog::insert\_error(~~$method, new WP\_Error( $response\_body['statusCode'], $message )~~ ); |
  |  | 389 | WP\_Auth0\_ErrorLog::insert\_error($method, new WP\_Error($response\_body['statusCode'], $message)); |
  | 371 | 390 | return true; |
  | 372 | 391 | } |
  | 373 | 392 |  |
  | 374 |  | if (~~isset( $response\_body['error'] )~~ ) { |
  | 375 |  | if (~~isset( $response\_body['error\_description'] )~~ ) { |
  | 376 |  | $message .= ' - ' . sanitize\_text\_field(~~$response\_body['error\_description']~~ ); |
  |  | 393 | if (isset($response\_body['error'])) { |
  |  | 394 | if (isset($response\_body['error\_description'])) { |
  |  | 395 | $message .= ' - ' . sanitize\_text\_field($response\_body['error\_description']); |
  | 377 | 396 | } |
  | 378 |  | WP\_Auth0\_ErrorLog::insert\_error(~~$method, new WP\_Error( $response\_body['error'], $message )~~ ); |
  |  | 397 | WP\_Auth0\_ErrorLog::insert\_error($method, new WP\_Error($response\_body['error'], $message)); |
  | 379 | 398 | return true; |
  | 380 | 399 | } |
  | 381 | 400 |  |
  | 382 |  | WP\_Auth0\_ErrorLog::insert\_error(~~$method, $this->response\_body~~ ); |
  |  | 401 | WP\_Auth0\_ErrorLog::insert\_error($method, $this->response\_body); |
  | 383 | 402 | return true; |
  | 384 | 403 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L393) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L412) |  |
  | 393 | 412 | \* @codeCoverageIgnore - Tested by individual HTTP methods in TestApiAbstract::testHttpRequests() |
  | 394 | 413 | \*/ |
  | 395 |  | private function request( $method ) { |
  |  | 414 | private function request($method) |
  |  | 415 | { |
  | 396 | 416 | $remote\_url = $this->build\_url(); |
  | 397 | 417 | $http\_args  = [ |
  | 398 | 418 | 'headers' => $this->headers, |
  | 399 | 419 | 'method'  => $method, |
  | 400 |  | 'body'    => !~~empty( $this->body ) ? json\_encode( $this->body~~ ) : null, |
  |  | 420 | 'body'    => !empty($this->body) ? json\_encode($this->body) : null, |
  | 401 | 421 | ]; |
  | 402 | 422 |  |
  | 403 |  | $this->response      = wp\_remote\_request(~~$remote\_url, $http\_args~~ ); |
  | 404 |  | $this->response\_code = (int) wp\_remote\_retrieve\_response\_code(~~$this->response~~ ); |
  | 405 |  | $this->response\_body = wp\_remote\_retrieve\_body(~~$this->response~~ ); |
  |  | 423 | $this->response      = wp\_remote\_request($remote\_url, $http\_args); |
  |  | 424 | $this->response\_code = (int) wp\_remote\_retrieve\_response\_code($this->response); |
  |  | 425 | $this->response\_body = wp\_remote\_retrieve\_body($this->response); |
  | 406 | 426 |  |
  | 407 | 427 | return $this; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=2599514#L417) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Abstract.php?rev=3114611#L437) |  |
  | 417 | 437 | \* @codeCoverageIgnore |
  | 418 | 438 | \*/ |
  | 419 |  | private function clean\_path( $path ) { |
  | 420 |  | if ( ! empty( $path[0] ) && '/' === $path[0] ) { |
  | 421 |  | $path = substr( $path, 1 ); |
  |  | 439 | private function clean\_path($path) |
  |  | 440 | { |
  |  | 441 | if (!empty($path[0]) && '/' === $path[0]) { |
  |  | 442 | $path = substr($path, 1); |
  | 422 | 443 | } |
  | 423 | 444 | return $path; |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Change\_Email.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Change\_Email. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=2473902#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Change\_Email to update a user's email at Auth0. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Change\_Email extends WP\_Auth0\_Api\_Abstract { |
  |  | 14 | class WP\_Auth0\_Api\_Change\_Email extends WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=2473902#L40) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611#L42) |  |
  | 40 | 42 | WP\_Auth0\_Api\_Client\_Credentials $api\_client\_creds |
  | 41 | 43 | ) { |
  | 42 |  | parent::\_\_construct(~~$options~~ ); |
  |  | 44 | parent::\_\_construct($options); |
  | 43 | 45 | $this->api\_client\_creds = $api\_client\_creds; |
  | 44 | 46 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=2473902#L52) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611#L54) |  |
  | 52 | 54 | \* @return bool |
  | 53 | 55 | \*/ |
  | 54 |  | public function call( $user\_id = null, $email = null ) { |
  |  | 56 | public function call($user\_id = null, $email = null) |
  |  | 57 | { |
  | 55 | 58 |  |
  | 56 |  | if (~~empty( $user\_id ) || empty( $email )~~ ) { |
  |  | 59 | if (empty($user\_id) || empty($email)) { |
  | 57 | 60 | return self::RETURN\_ON\_FAILURE; |
  | 58 | 61 | } |
  | 59 | 62 |  |
  | 60 |  | if (~~! $this->set\_bearer( self::API\_SCOPE )~~ ) { |
  |  | 63 | if (!$this->set\_bearer(self::API\_SCOPE)) { |
  | 61 | 64 | return self::RETURN\_ON\_FAILURE; |
  | 62 | 65 | } |
  | 63 | 66 |  |
  | 64 | 67 | return $this |
  | 65 |  | ->set\_path(~~'api/v2/users/' . rawurlencode( $user\_id )~~ ) |
  | 66 |  | ->add\_body(~~'email', $email~~ ) |
  |  | 68 | ->set\_path('api/v2/users/' . rawurlencode($user\_id)) |
  |  | 69 | ->add\_body('email', $email) |
  | 67 | 70 | // Email is either changed by an admin or verified by WP. |
  | 68 |  | ->add\_body(~~'email\_verified', true~~ ) |
  | 69 |  | ->add\_body(~~'client\_id', $this->options->get( 'client\_id' )~~ ) |
  |  | 71 | ->add\_body('email\_verified', true) |
  |  | 72 | ->add\_body('client\_id', $this->options->get('client\_id')) |
  | 70 | 73 | ->patch() |
  | 71 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 74 | ->handle\_response(\_\_METHOD\_\_); |
  | 72 | 75 | } |
  | 73 | 76 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=2473902#L79) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Email.php?rev=3114611#L82) |  |
  | 79 | 82 | \* @return bool |
  | 80 | 83 | \*/ |
  | 81 |  | protected function handle\_response( $method ) { |
  |  | 84 | protected function handle\_response($method) |
  |  | 85 | { |
  | 82 | 86 |  |
  | 83 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 87 | if ($this->handle\_wp\_error($method)) { |
  | 84 | 88 | return self::RETURN\_ON\_FAILURE; |
  | 85 | 89 | } |
  | 86 | 90 |  |
  | 87 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 91 | if ($this->handle\_failed\_response($method)) { |
  | 88 | 92 | return self::RETURN\_ON\_FAILURE; |
  | 89 | 93 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Change\_Password.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Change\_Password. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=2473902#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Change\_Password to update a user's password at Auth0. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Change\_Password extends WP\_Auth0\_Api\_Abstract { |
  |  | 14 | class WP\_Auth0\_Api\_Change\_Password extends WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=2473902#L40) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611#L42) |  |
  | 40 | 42 | WP\_Auth0\_Api\_Client\_Credentials $api\_client\_creds |
  | 41 | 43 | ) { |
  | 42 |  | parent::\_\_construct(~~$options~~ ); |
  |  | 44 | parent::\_\_construct($options); |
  | 43 | 45 | $this->api\_client\_creds = $api\_client\_creds; |
  | 44 | 46 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=2473902#L52) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611#L54) |  |
  | 52 | 54 | \* @return bool|string|null |
  | 53 | 55 | \*/ |
  | 54 |  | public function call( $user\_id = null, $password = null ) { |
  |  | 56 | public function call($user\_id = null, $password = null) |
  |  | 57 | { |
  | 55 | 58 |  |
  | 56 |  | if (~~empty( $user\_id ) || empty( $password )~~ ) { |
  |  | 59 | if (empty($user\_id) || empty($password)) { |
  | 57 | 60 | return self::RETURN\_ON\_FAILURE; |
  | 58 | 61 | } |
  | 59 | 62 |  |
  | 60 |  | if (~~! $this->set\_bearer( self::API\_SCOPE )~~ ) { |
  |  | 63 | if (!$this->set\_bearer(self::API\_SCOPE)) { |
  | 61 | 64 | return self::RETURN\_ON\_FAILURE; |
  | 62 | 65 | } |
  | 63 | 66 |  |
  | 64 | 67 | return $this |
  | 65 |  | ->set\_path(~~'api/v2/users/' . rawurlencode( $user\_id )~~ ) |
  | 66 |  | ->add\_body(~~'password', $password~~ ) |
  |  | 68 | ->set\_path('api/v2/users/' . rawurlencode($user\_id)) |
  |  | 69 | ->add\_body('password', $password) |
  | 67 | 70 | ->patch() |
  | 68 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 71 | ->handle\_response(\_\_METHOD\_\_); |
  | 69 | 72 | } |
  | 70 | 73 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=2473902#L76) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Change_Password.php?rev=3114611#L79) |  |
  | 76 | 79 | \* @return bool|string |
  | 77 | 80 | \*/ |
  | 78 |  | protected function handle\_response( $method ) { |
  |  | 81 | protected function handle\_response($method) |
  |  | 82 | { |
  | 79 | 83 |  |
  | 80 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 84 | if ($this->handle\_wp\_error($method)) { |
  | 81 | 85 | return self::RETURN\_ON\_FAILURE; |
  | 82 | 86 | } |
  | 83 | 87 |  |
  | 84 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  | 85 |  | $response\_body = json\_decode(~~$this->response\_body~~ ); |
  | 86 |  | if (~~isset( $response\_body->message ) && false !== strpos( $response\_body->message, 'PasswordStrengthError' )~~ ) { |
  | 87 |  | return ~~\_\_( 'Password is too weak, please choose a different one.', 'wp-auth0'~~ ); |
  |  | 88 | if ($this->handle\_failed\_response($method)) { |
  |  | 89 | $response\_body = json\_decode($this->response\_body); |
  |  | 90 | if (isset($response\_body->message) && false !== strpos($response\_body->message, 'PasswordStrengthError')) { |
  |  | 91 | return esc\_html\_\_('Password is too weak, please choose a different one.', 'wp-auth0'); |
  | 88 | 92 | } |
  | 89 | 93 | return self::RETURN\_ON\_FAILURE; |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Client\_Credentials.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Client\_Credentials. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Client\_Credentials to perform a client credentials grant. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Client\_Credentials extends WP\_Auth0\_Api\_Abstract { |
  |  | 14 | class WP\_Auth0\_Api\_Client\_Credentials extends WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L33) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L35) |  |
  | 33 | 35 | \* @param WP\_Auth0\_Options $options - WP\_Auth0\_Options instance. |
  | 34 | 36 | \*/ |
  | 35 |  | public function \_\_construct( WP\_Auth0\_Options $options ) { |
  | 36 |  | parent::\_\_construct( $options ); |
  | 37 |  | $this->set\_path( 'oauth/token' ) |
  |  | 37 | public function \_\_construct(WP\_Auth0\_Options $options) |
  |  | 38 | { |
  |  | 39 | parent::\_\_construct($options); |
  |  | 40 | $this->set\_path('oauth/token') |
  | 38 | 41 | ->send\_client\_id() |
  | 39 | 42 | ->send\_client\_secret() |
  | 40 | 43 | ->send\_audience() |
  | 41 |  | ->add\_body(~~'grant\_type', 'client\_credentials'~~ ); |
  |  | 44 | ->add\_body('grant\_type', 'client\_credentials'); |
  | 42 | 45 | } |
  | 43 | 46 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L47) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L50) |  |
  | 47 | 50 | \* @return mixed|null |
  | 48 | 51 | \*/ |
  | 49 |  | public function call() { |
  | 50 |  | return $this->post()->handle\_response( \_\_METHOD\_\_ ); |
  |  | 52 | public function call() |
  |  | 53 | { |
  |  | 54 | return $this->post()->handle\_response(\_\_METHOD\_\_); |
  | 51 | 55 | } |
  | 52 | 56 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L58) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L62) |  |
  | 58 | 62 | \* @return string|null |
  | 59 | 63 | \*/ |
  | 60 |  | protected function handle\_response( $method ) { |
  |  | 64 | protected function handle\_response($method) |
  |  | 65 | { |
  | 61 | 66 |  |
  | 62 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 67 | if ($this->handle\_wp\_error($method)) { |
  | 63 | 68 | return self::RETURN\_ON\_FAILURE; |
  | 64 | 69 | } |
  | 65 | 70 |  |
  | 66 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 71 | if ($this->handle\_failed\_response($method)) { |
  | 67 | 72 | return self::RETURN\_ON\_FAILURE; |
  | 68 | 73 | } |
  | 69 | 74 |  |
  | 70 |  | $response\_body = json\_decode(~~$this->response\_body, true~~ ); |
  |  | 75 | $response\_body = json\_decode($this->response\_body, true); |
  | 71 | 76 |  |
  | 72 | 77 | // If we have no access token, something went wrong upstream. |
  | 73 |  | if (~~! isset( $response\_body['access\_token'] )~~ ) { |
  | 74 |  | WP\_Auth0\_ErrorLog::insert\_error(~~$method, \_\_( 'No access\_token returned.', 'wp-auth0' )~~ ); |
  |  | 78 | if (!isset($response\_body['access\_token'])) { |
  |  | 79 | WP\_Auth0\_ErrorLog::insert\_error($method, esc\_html\_\_('No access\_token returned.', 'wp-auth0')); |
  | 75 | 80 | return self::RETURN\_ON\_FAILURE; |
  | 76 | 81 | } |
  | 77 | 82 |  |
  | 78 | 83 | // Set the transient to expire 1 minute before the token does. |
  | 79 |  | $expires\_in  = !~~isset( $response\_body['expires\_in'] ) ? HOUR\_IN\_SECONDS : absint( $response\_body['expires\_in']~~ ); |
  |  | 84 | $expires\_in  = !isset($response\_body['expires\_in']) ? HOUR\_IN\_SECONDS : absint($response\_body['expires\_in']); |
  | 80 | 85 | $expires\_in -= MINUTE\_IN\_SECONDS; |
  | 81 | 86 |  |
  | 82 | 87 | // Store the token and scope to check when used. |
  | 83 |  | set\_transient(~~self::TOKEN\_TRANSIENT\_KEY, $response\_body['access\_token'], $expires\_in~~ ); |
  | 84 |  | set\_transient(~~self::SCOPE\_TRANSIENT\_KEY, $response\_body['scope'], $expires\_in~~ ); |
  |  | 88 | set\_transient(self::TOKEN\_TRANSIENT\_KEY, $response\_body['access\_token'], $expires\_in); |
  |  | 89 | set\_transient(self::SCOPE\_TRANSIENT\_KEY, $response\_body['scope'], $expires\_in); |
  | 85 | 90 |  |
  | 86 | 91 | return $response\_body['access\_token']; |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L92) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L97) |  |
  | 92 | 97 | \* @return string |
  | 93 | 98 | \*/ |
  | 94 |  | public static function get\_stored\_token() { |
  | 95 |  | return get\_transient( self::TOKEN\_TRANSIENT\_KEY ); |
  |  | 99 | public static function get\_stored\_token() |
  |  | 100 | { |
  |  | 101 | return get\_transient(self::TOKEN\_TRANSIENT\_KEY); |
  | 96 | 102 | } |
  | 97 | 103 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L99) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L105) |  |
  | 99 | 105 | \* Delete the stored access token and scope from transients. |
  | 100 | 106 | \*/ |
  | 101 |  | public static function delete\_store() { |
  | 102 |  | delete\_transient( self::TOKEN\_TRANSIENT\_KEY ); |
  | 103 |  | delete\_transient( self::SCOPE\_TRANSIENT\_KEY ); |
  |  | 107 | public static function delete\_store() |
  |  | 108 | { |
  |  | 109 | delete\_transient(self::TOKEN\_TRANSIENT\_KEY); |
  |  | 110 | delete\_transient(self::SCOPE\_TRANSIENT\_KEY); |
  | 104 | 111 | } |
  | 105 | 112 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=2473902#L111) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Client_Credentials.php?rev=3114611#L118) |  |
  | 111 | 118 | \* @return bool |
  | 112 | 119 | \*/ |
  | 113 |  | public static function check\_stored\_scope( $scope ) { |
  | 114 |  | $stored\_scope = get\_transient( self::SCOPE\_TRANSIENT\_KEY ); |
  | 115 |  | $scopes       = explode( ' ', $stored\_scope ); |
  | 116 |  | return in\_array( $scope, $scopes ); |
  |  | 120 | public static function check\_stored\_scope($scope) |
  |  | 121 | { |
  |  | 122 | $stored\_scope = get\_transient(self::SCOPE\_TRANSIENT\_KEY); |
  |  | 123 | $scopes       = explode(' ', $stored\_scope); |
  |  | 124 | return in\_array($scope, $scopes); |
  | 117 | 125 | } |
  | 118 | 126 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Exchange\_Code.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Exchange\_Code. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=2473902#L14) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=3114611#L15) |  |
  | 14 | 15 | \* @see https://auth0.com/docs/api/authentication#authorization-code-flow |
  | 15 | 16 | \*/ |
  | 16 |  | class WP\_Auth0\_Api\_Exchange\_Code extends WP\_Auth0\_Api\_Abstract { |
  |  | 17 | class WP\_Auth0\_Api\_Exchange\_Code extends WP\_Auth0\_Api\_Abstract |
  |  | 18 | { |
  | 17 | 19 |  |
  | 18 | 20 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=2473902#L30) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=3114611#L32) |  |
  | 30 | 32 | \* @return string|null |
  | 31 | 33 | \*/ |
  | 32 |  | public function call( $code = null, $client\_id = null, $redirect\_uri = null ) { |
  |  | 34 | public function call($code = null, $client\_id = null, $redirect\_uri = null) |
  |  | 35 | { |
  | 33 | 36 |  |
  | 34 |  | if (~~empty( $code )~~ ) { |
  |  | 37 | if (empty($code)) { |
  | 35 | 38 | return self::RETURN\_ON\_FAILURE; |
  | 36 | 39 | } |
  | 37 | 40 |  |
  | 38 |  | $client\_id = $client\_id ?: $this->options->get(~~'client\_id'~~ ); |
  | 39 |  | if (~~empty( $client\_id )~~ ) { |
  |  | 41 | $client\_id = $client\_id ?: $this->options->get('client\_id'); |
  |  | 42 | if (empty($client\_id)) { |
  | 40 | 43 | return self::RETURN\_ON\_FAILURE; |
  | 41 | 44 | } |
  | 42 | 45 |  |
  | 43 |  | $client\_secret = $this->options->get(~~'client\_secret'~~ ) ?: ''; |
  |  | 46 | $client\_secret = $this->options->get('client\_secret') ?: ''; |
  | 44 | 47 | $redirect\_uri  = $redirect\_uri ?: $this->options->get\_wp\_auth0\_url(); |
  | 45 | 48 |  |
  | 46 | 49 | return $this |
  | 47 |  | ->set\_path(~~'oauth/token'~~ ) |
  | 48 |  | ->add\_body(~~'grant\_type', 'authorization\_code'~~ ) |
  | 49 |  | ->add\_body(~~'code', $code~~ ) |
  | 50 |  | ->add\_body(~~'redirect\_uri', $redirect\_uri~~ ) |
  | 51 |  | ->add\_body(~~'client\_id', $client\_id~~ ) |
  | 52 |  | ->add\_body(~~'client\_secret', $client\_secret~~ ) |
  |  | 50 | ->set\_path('oauth/token') |
  |  | 51 | ->add\_body('grant\_type', 'authorization\_code') |
  |  | 52 | ->add\_body('code', $code) |
  |  | 53 | ->add\_body('redirect\_uri', $redirect\_uri) |
  |  | 54 | ->add\_body('client\_id', $client\_id) |
  |  | 55 | ->add\_body('client\_secret', $client\_secret) |
  | 53 | 56 | ->post() |
  | 54 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 57 | ->handle\_response(\_\_METHOD\_\_); |
  | 55 | 58 | } |
  | 56 | 59 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=2473902#L62) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Exchange_Code.php?rev=3114611#L65) |  |
  | 62 | 65 | \* @return string|null |
  | 63 | 66 | \*/ |
  | 64 |  | protected function handle\_response( $method ) { |
  |  | 67 | protected function handle\_response($method) |
  |  | 68 | { |
  | 65 | 69 |  |
  | 66 |  | if (~~401 == $this->response\_code~~ ) { |
  |  | 70 | if (401 == $this->response\_code) { |
  | 67 | 71 | WP\_Auth0\_ErrorLog::insert\_error( |
  | 68 | 72 | \_\_METHOD\_\_ . ' L:' . \_\_LINE\_\_, |
  | 69 |  | ~~\_\_( 'An /oauth/token call triggered a 401 response from Auth0. ', 'wp-auth0'~~ ) . |
  | 70 |  | ~~\_\_( 'Please check the Client Secret saved in the Auth0 plugin settings. ', 'wp-auth0'~~ ) |
  |  | 73 | esc\_html\_\_('An /oauth/token call triggered a 401 response from Auth0. ', 'wp-auth0') . |
  |  | 74 | esc\_html\_\_('Please check the Client Secret saved in the Auth0 plugin settings. ', 'wp-auth0') |
  | 71 | 75 | ); |
  | 72 | 76 | return self::RETURN\_ON\_FAILURE; |
  | 73 | 77 | } |
  | 74 | 78 |  |
  | 75 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 79 | if ($this->handle\_wp\_error($method)) { |
  | 76 | 80 | return self::RETURN\_ON\_FAILURE; |
  | 77 | 81 | } |
  | 78 | 82 |  |
  | 79 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 83 | if ($this->handle\_failed\_response($method)) { |
  | 80 | 84 | return self::RETURN\_ON\_FAILURE; |
  | 81 | 85 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Get\_Jwks.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php")

  | [r2271973](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Get\_Jwks. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=2271973#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Get\_Jwks |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Get\_Jwks extends WP\_Auth0\_Api\_Abstract { |
  |  | 14 | class WP\_Auth0\_Api\_Get\_Jwks extends WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=2271973#L23) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=3114611#L25) |  |
  | 23 | 25 | \* @return array |
  | 24 | 26 | \*/ |
  | 25 |  | public function call() { |
  |  | 27 | public function call() |
  |  | 28 | { |
  | 26 | 29 |  |
  | 27 | 30 | return $this |
  | 28 |  | ->set\_path(~~'.well-known/jwks.json'~~ ) |
  |  | 31 | ->set\_path('.well-known/jwks.json') |
  | 29 | 32 | ->get() |
  | 30 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 33 | ->handle\_response(\_\_METHOD\_\_); |
  | 31 | 34 | } |
  | 32 | 35 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=2271973#L38) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_Jwks.php?rev=3114611#L41) |  |
  | 38 | 41 | \* @return array |
  | 39 | 42 | \*/ |
  | 40 |  | protected function handle\_response( $method ) { |
  |  | 43 | protected function handle\_response($method) |
  |  | 44 | { |
  | 41 | 45 |  |
  | 42 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 46 | if ($this->handle\_wp\_error($method)) { |
  | 43 | 47 | return self::RETURN\_ON\_FAILURE; |
  | 44 | 48 | } |
  | 45 | 49 |  |
  | 46 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 50 | if ($this->handle\_failed\_response($method)) { |
  | 47 | 51 | return self::RETURN\_ON\_FAILURE; |
  | 48 | 52 | } |
  | 49 | 53 |  |
  | 50 |  | return json\_decode(~~$this->response\_body, true~~ ); |
  |  | 54 | return json\_decode($this->response\_body, true); |
  | 51 | 55 | } |
  | 52 | 56 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Get\_User.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Get\_User. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=2473902#L12) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Get user information for an Auth0 user ID. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Api\_Get\_User extends WP\_Auth0\_Api\_Abstract { |
  |  | 15 | class WP\_Auth0\_Api\_Get\_User extends WP\_Auth0\_Api\_Abstract |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=2473902#L34) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611#L36) |  |
  | 34 | 36 | WP\_Auth0\_Api\_Client\_Credentials $api\_client\_creds |
  | 35 | 37 | ) { |
  | 36 |  | parent::\_\_construct(~~$options~~ ); |
  |  | 38 | parent::\_\_construct($options); |
  | 37 | 39 | $this->api\_client\_creds = $api\_client\_creds; |
  | 38 | 40 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=2473902#L45) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611#L47) |  |
  | 45 | 47 | \* @return null|string |
  | 46 | 48 | \*/ |
  | 47 |  | public function call( $user\_id = null ) { |
  |  | 49 | public function call($user\_id = null) |
  |  | 50 | { |
  | 48 | 51 |  |
  | 49 |  | if (~~empty( $user\_id )~~ ) { |
  |  | 52 | if (empty($user\_id)) { |
  | 50 | 53 | return self::RETURN\_ON\_FAILURE; |
  | 51 | 54 | } |
  | 52 | 55 |  |
  | 53 |  | if (~~! $this->set\_bearer( self::API\_SCOPE )~~ ) { |
  |  | 56 | if (!$this->set\_bearer(self::API\_SCOPE)) { |
  | 54 | 57 | return self::RETURN\_ON\_FAILURE; |
  | 55 | 58 | } |
  | 56 | 59 |  |
  | 57 | 60 | return $this |
  | 58 |  | ->set\_path(~~'api/v2/users/' . rawurlencode( $user\_id )~~ ) |
  |  | 61 | ->set\_path('api/v2/users/' . rawurlencode($user\_id)) |
  | 59 | 62 | ->get() |
  | 60 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 63 | ->handle\_response(\_\_METHOD\_\_); |
  | 61 | 64 | } |
  | 62 | 65 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=2473902#L68) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Get_User.php?rev=3114611#L71) |  |
  | 68 | 71 | \* @return string|null |
  | 69 | 72 | \*/ |
  | 70 |  | protected function handle\_response( $method ) { |
  |  | 73 | protected function handle\_response($method) |
  |  | 74 | { |
  | 71 | 75 |  |
  | 72 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 76 | if ($this->handle\_wp\_error($method)) { |
  | 73 | 77 | return self::RETURN\_ON\_FAILURE; |
  | 74 | 78 | } |
  | 75 | 79 |  |
  | 76 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 80 | if ($this->handle\_failed\_response($method)) { |
  | 77 | 81 | return self::RETURN\_ON\_FAILURE; |
  | 78 | 82 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Jobs\_Verification.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php")

  | [r1970198](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=1970198#L1 "Show revision 1970198 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Jobs\_Verification. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=1970198#L11) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Api\_Jobs\_Verification to resend a verification email. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Api\_Jobs\_Verification extends WP\_Auth0\_Api\_Abstract { |
  |  | 14 | class WP\_Auth0\_Api\_Jobs\_Verification extends WP\_Auth0\_Api\_Abstract |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=1970198#L40) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611#L42) |  |
  | 40 | 42 | WP\_Auth0\_Api\_Client\_Credentials $api\_client\_creds |
  | 41 | 43 | ) { |
  | 42 |  | parent::\_\_construct(~~$options~~ ); |
  |  | 44 | parent::\_\_construct($options); |
  | 43 | 45 | $this->api\_client\_creds = $api\_client\_creds; |
  | 44 |  | $this->set\_path(~~'api/v2/jobs/verification-email'~~ ) |
  |  | 46 | $this->set\_path('api/v2/jobs/verification-email') |
  | 45 | 47 | ->send\_client\_id(); |
  | 46 | 48 | } |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=1970198#L53) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611#L55) |  |
  | 53 | 55 | \* @return bool|mixed|null |
  | 54 | 56 | \*/ |
  | 55 |  | public function call( $user\_id = null ) { |
  |  | 57 | public function call($user\_id = null) |
  |  | 58 | { |
  | 56 | 59 |  |
  | 57 |  | if (~~empty( $user\_id )~~ ) { |
  |  | 60 | if (empty($user\_id)) { |
  | 58 | 61 | return self::RETURN\_ON\_FAILURE; |
  | 59 | 62 | } |
  | 60 | 63 |  |
  | 61 |  | if (~~! $this->set\_bearer( self::API\_SCOPE )~~ ) { |
  |  | 64 | if (!$this->set\_bearer(self::API\_SCOPE)) { |
  | 62 | 65 | return self::RETURN\_ON\_FAILURE; |
  | 63 | 66 | } |
  | 64 | 67 |  |
  | 65 |  | return $this->add\_body(~~'user\_id', $user\_id~~ ) |
  |  | 68 | return $this->add\_body('user\_id', $user\_id) |
  | 66 | 69 | ->post() |
  | 67 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 70 | ->handle\_response(\_\_METHOD\_\_); |
  | 68 | 71 | } |
  | 69 | 72 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=1970198#L75) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Jobs_Verification.php?rev=3114611#L78) |  |
  | 75 | 78 | \* @return mixed|null |
  | 76 | 79 | \*/ |
  | 77 |  | protected function handle\_response( $method ) { |
  |  | 80 | protected function handle\_response($method) |
  |  | 81 | { |
  | 78 | 82 |  |
  | 79 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 83 | if ($this->handle\_wp\_error($method)) { |
  | 80 | 84 | return self::RETURN\_ON\_FAILURE; |
  | 81 | 85 | } |
  | 82 | 86 |  |
  | 83 |  | if (~~$this->handle\_failed\_response( $method, 201 )~~ ) { |
  |  | 87 | if ($this->handle\_failed\_response($method, 201)) { |
  | 84 | 88 | return self::RETURN\_ON\_FAILURE; |
  | 85 | 89 | } |
* ## [auth0/trunk/lib/api/WP\_Auth0\_Api\_Refresh\_Access\_Token.php](/changeset/3114611/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php "Show the changeset 3114611 restricted to auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php")

  | [r2473902](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=2473902#L1 "Show revision 2473902 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains WP\_Auth0\_Api\_Refresh\_Access\_Token. |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=2473902#L15) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=3114611#L16) |  |
  | 15 | 16 | \* @see https://auth0.com/docs/api/authentication#refresh-token |
  | 16 | 17 | \*/ |
  | 17 |  | class WP\_Auth0\_Api\_Refresh\_Access\_Token extends WP\_Auth0\_Api\_Abstract { |
  |  | 18 | class WP\_Auth0\_Api\_Refresh\_Access\_Token extends WP\_Auth0\_Api\_Abstract |
  |  | 19 | { |
  | 18 | 20 |  |
  | 19 | 21 | /\*\* |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=2473902#L31) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=3114611#L33) |  |
  | 31 | 33 | \* @return string|null |
  | 32 | 34 | \*/ |
  | 33 |  | public function call( $client\_id = null, $client\_secret = null, $refresh\_token = null ) { |
  |  | 35 | public function call($client\_id = null, $client\_secret = null, $refresh\_token = null) |
  |  | 36 | { |
  | 34 | 37 |  |
  | 35 |  | if (~~empty( $refresh\_token )~~ ) { |
  |  | 38 | if (empty($refresh\_token)) { |
  | 36 | 39 | return self::RETURN\_ON\_FAILURE; |
  | 37 | 40 | } |
  | 38 | 41 |  |
  | 39 |  | $client\_id = $client\_id ?: $this->options->get(~~'client\_id'~~ ); |
  | 40 |  | if (~~empty( $client\_id )~~ ) { |
  |  | 42 | $client\_id = $client\_id ?: $this->options->get('client\_id'); |
  |  | 43 | if (empty($client\_id)) { |
  | 41 | 44 | return self::RETURN\_ON\_FAILURE; |
  | 42 | 45 | } |
  | 43 | 46 |  |
  | 44 |  | $client\_secret = $client\_secret ?: $this->options->get(~~'client\_secret'~~ ); |
  | 45 |  | if (~~empty( $client\_secret )~~ ) { |
  |  | 47 | $client\_secret = $client\_secret ?: $this->options->get('client\_secret'); |
  |  | 48 | if (empty($client\_secret)) { |
  | 46 | 49 | return self::RETURN\_ON\_FAILURE; |
  | 47 | 50 | } |
  | 48 | 51 |  |
  | 49 | 52 | return $this |
  | 50 |  | ->set\_path(~~'oauth/token'~~ ) |
  | 51 |  | ->add\_body(~~'grant\_type', 'refresh\_token'~~ ) |
  | 52 |  | ->add\_body(~~'client\_id', $client\_id~~ ) |
  | 53 |  | ->add\_body(~~'client\_secret', $client\_secret~~ ) |
  | 54 |  | ->add\_body(~~'refresh\_token', $refresh\_token~~ ) |
  |  | 53 | ->set\_path('oauth/token') |
  |  | 54 | ->add\_body('grant\_type', 'refresh\_token') |
  |  | 55 | ->add\_body('client\_id', $client\_id) |
  |  | 56 | ->add\_body('client\_secret', $client\_secret) |
  |  | 57 | ->add\_body('refresh\_token', $refresh\_token) |
  | 55 | 58 | ->post() |
  | 56 |  | ->handle\_response(~~\_\_METHOD\_\_~~ ); |
  |  | 59 | ->handle\_response(\_\_METHOD\_\_); |
  | 57 | 60 | } |
  | 58 | 61 |  |
  | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=2473902#L64) | […](/browser/auth0/trunk/lib/api/WP_Auth0_Api_Refresh_Access_Token.php?rev=3114611#L67) |  |
  | 64 | 67 | \* @return string|null |
  | 65 | 68 | \*/ |
  | 66 |  | protected function handle\_response( $method ) { |
  |  | 69 | protected function handle\_response($method) |
  |  | 70 | { |
  | 67 | 71 |  |
  | 68 |  | if (~~401 == $this->response\_code~~ ) { |
  |  | 72 | if (401 == $this->response\_code) { |
  | 69 | 73 | WP\_Auth0\_ErrorLog::insert\_error( |
  | 70 | 74 | \_\_METHOD\_\_ . ' L:' . \_\_LINE\_\_, |
  | 71 |  | ~~\_\_( 'An /oauth/token call triggered a 401 response from Auth0. ', 'wp-auth0'~~ ) . |
  | 72 |  | ~~\_\_( 'Please check the Client ID and Client Secret saved in the Auth0 plugin settings. ', 'wp-auth0'~~ ) |
  |  | 75 | esc\_html\_\_('An /oauth/token call triggered a 401 response from Auth0. ', 'wp-auth0') . |
  |  | 76 | esc\_html\_\_('Please check the Client ID and Client Secret saved in the Auth0 plugin settings. ', 'wp-auth0') |
  | 73 | 77 | ); |
  | 74 | 78 | return self::RETURN\_ON\_FAILURE; |
  | 75 | 79 | } |
  | 76 | 80 |  |
  | 77 |  | if (~~$this->handle\_wp\_error( $method )~~ ) { |
  |  | 81 | if ($this->handle\_wp\_error($method)) { |
  | 78 | 82 | return self::RETURN\_ON\_FAILURE; |
  | 79 | 83 | } |
  | 80 | 84 |  |
  | 81 |  | if (~~$this->handle\_failed\_response( $method )~~ ) { |
  |  | 85 | if ($this->handle\_failed\_response($method)) { |
  | 82 | 86 | return self::RETURN\_ON\_FAILURE; |
  | 83 | 87 | } |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_BeforeLoginException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_BeforeLoginException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_BeforeLoginException.php")

  | [r1437129](/browser/auth0/trunk/lib/exceptions/WP_Auth0_BeforeLoginException.php?rev=1437129#L1 "Show revision 1437129 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_BeforeLoginException.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_BeforeLoginException extends Exception {} |
  |  | 3 | class WP\_Auth0\_BeforeLoginException extends Exception |
  |  | 4 | { |
  |  | 5 | } |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_CouldNotCreateUserException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_CouldNotCreateUserException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_CouldNotCreateUserException.php")

  | [r1431502](/browser/auth0/trunk/lib/exceptions/WP_Auth0_CouldNotCreateUserException.php?rev=1431502#L1 "Show revision 1431502 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_CouldNotCreateUserException.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_CouldNotCreateUserException extends Exception {} |
  |  | 3 | class WP\_Auth0\_CouldNotCreateUserException extends Exception |
  |  | 4 | { |
  |  | 5 | } |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_EmailNotVerifiedException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php")

  | [r1924242](/browser/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php?rev=1924242#L4 "Show revision 1924242 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php?rev=3114611#L4 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Class WP\_Auth0\_EmailNotVerifiedException |
  | 5 | 5 | \*/ |
  | 6 |  | class WP\_Auth0\_EmailNotVerifiedException extends Exception { |
  |  | 6 | class WP\_Auth0\_EmailNotVerifiedException extends Exception |
  |  | 7 | { |
  | 7 | 8 |  |
  | 8 | 9 | public $userinfo; |
  | […](/browser/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php?rev=1924242#L15) | […](/browser/auth0/trunk/lib/exceptions/WP_Auth0_EmailNotVerifiedException.php?rev=3114611#L16) |  |
  | 15 | 16 | \* @param string   $id\_token - should not be output in any template |
  | 16 | 17 | \*/ |
  | 17 |  | public function \_\_construct( $userinfo, $id\_token ) { |
  |  | 18 | public function \_\_construct($userinfo, $id\_token) |
  |  | 19 | { |
  | 18 | 20 | $this->userinfo = $userinfo; |
  | 19 | 21 | $this->id\_token = $id\_token; |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_InvalidIdTokenException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_InvalidIdTokenException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_InvalidIdTokenException.php")

  | [r2100699](/browser/auth0/trunk/lib/exceptions/WP_Auth0_InvalidIdTokenException.php?rev=2100699#L6 "Show revision 2100699 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_InvalidIdTokenException.php?rev=3114611#L6 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @since 3.11.0 |
  | 7 | 7 | \*/ |
  | 8 |  | class WP\_Auth0\_InvalidIdTokenException extends Exception {} |
  |  | 8 | class WP\_Auth0\_InvalidIdTokenException extends Exception |
  |  | 9 | { |
  |  | 10 | } |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_LoginFlowValidationException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_LoginFlowValidationException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_LoginFlowValidationException.php")

  | [r1435847](/browser/auth0/trunk/lib/exceptions/WP_Auth0_LoginFlowValidationException.php?rev=1435847#L1 "Show revision 1435847 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_LoginFlowValidationException.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_LoginFlowValidationException extends Exception {} |
  |  | 3 | class WP\_Auth0\_LoginFlowValidationException extends Exception |
  |  | 4 | { |
  |  | 5 | } |
* ## [auth0/trunk/lib/exceptions/WP\_Auth0\_RegistrationNotEnabledException.php](/changeset/3114611/auth0/trunk/lib/exceptions/WP_Auth0_RegistrationNotEnabledException.php "Show the changeset 3114611 restricted to auth0/trunk/lib/exceptions/WP_Auth0_RegistrationNotEnabledException.php")

  | [r1431502](/browser/auth0/trunk/lib/exceptions/WP_Auth0_RegistrationNotEnabledException.php?rev=1431502#L1 "Show revision 1431502 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/exceptions/WP_Auth0_RegistrationNotEnabledException.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | class WP\_Auth0\_RegistrationNotEnabledException extends Exception {} |
  |  | 3 | class WP\_Auth0\_RegistrationNotEnabledException extends Exception |
  |  | 4 | { |
  |  | 5 | } |
* ## [auth0/trunk/lib/profile/WP\_Auth0\_Profile\_Change\_Email.php](/changeset/3114611/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php "Show the changeset 3114611 restricted to auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php")

  | [r2405569](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L1 "Show revision 2405569 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Profile\_Change\_Email. |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L11) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Profile\_Change\_Email. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Profile\_Change\_Email { |
  |  | 14 | class WP\_Auth0\_Profile\_Change\_Email |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L30) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L32) |  |
  | 30 | 32 | \* @param WP\_Auth0\_Api\_Change\_Email $api\_change\_email - WP\_Auth0\_Api\_Change\_Email instance. |
  | 31 | 33 | \*/ |
  | 32 |  | public function \_\_construct( WP\_Auth0\_Api\_Change\_Email $api\_change\_email ) { |
  |  | 34 | public function \_\_construct(WP\_Auth0\_Api\_Change\_Email $api\_change\_email) |
  |  | 35 | { |
  | 33 | 36 | $this->api\_change\_email = $api\_change\_email; |
  | 34 | 37 | } |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L45) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L48) |  |
  | 45 | 48 | \* @return boolean |
  | 46 | 49 | \*/ |
  | 47 |  | public function update\_email( $wp\_user\_id, $old\_user\_data ) { |
  |  | 50 | public function update\_email($wp\_user\_id, $old\_user\_data) |
  |  | 51 | { |
  | 48 | 52 |  |
  | 49 | 53 | // Exit if this is not an Auth0 user. |
  | 50 |  | $auth0\_id = WP\_Auth0\_UsersRepo::get\_meta(~~$wp\_user\_id, 'auth0\_id'~~ ); |
  | 51 |  | if (~~empty( $auth0\_id )~~ ) { |
  |  | 54 | $auth0\_id = WP\_Auth0\_UsersRepo::get\_meta($wp\_user\_id, 'auth0\_id'); |
  |  | 55 | if (empty($auth0\_id)) { |
  | 52 | 56 | return false; |
  | 53 | 57 | } |
  | 54 | 58 |  |
  | 55 | 59 | // Exit if this is not a database strategy user. |
  | 56 |  | if (~~'auth0' !== WP\_Auth0\_Users::get\_strategy( $auth0\_id )~~ ) { |
  |  | 60 | if ('auth0' !== WP\_Auth0\_Users::get\_strategy($auth0\_id)) { |
  | 57 | 61 | return false; |
  | 58 | 62 | } |
  | 59 | 63 |  |
  | 60 |  | $wp\_user = get\_user\_by(~~'id', $wp\_user\_id~~ ); |
  |  | 64 | $wp\_user = get\_user\_by('id', $wp\_user\_id); |
  | 61 | 65 |  |
  | 62 | 66 | $current\_email = $wp\_user->data->user\_email; |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L64) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L68) |  |
  | 64 | 68 |  |
  | 65 | 69 | // No email address changes, exit. |
  | 66 |  | if (~~$old\_email === $current\_email~~ ) { |
  |  | 70 | if ($old\_email === $current\_email) { |
  | 67 | 71 | return false; |
  | 68 | 72 | } |
  | 69 | 73 |  |
  | 70 | 74 | // Set a flag so the Get User call to other processes know the email is in the process of changing. |
  | 71 |  | WP\_Auth0\_UsersRepo::update\_meta(~~$wp\_user\_id, self::UPDATED\_EMAIL, $current\_email~~ ); |
  |  | 75 | WP\_Auth0\_UsersRepo::update\_meta($wp\_user\_id, self::UPDATED\_EMAIL, $current\_email); |
  | 72 | 76 |  |
  | 73 | 77 | // Attempt to update the email address at Auth0. |
  | 74 | 78 | // For custom database setups, this will trigger a Get User script call from Auth0. |
  | 75 | 79 | // See: WP\_Auth0\_Routes::migration\_ws\_get\_user() |
  | 76 |  | if (~~$this->api\_change\_email->call( $auth0\_id, $current\_email )~~ ) { |
  | 77 |  | WP\_Auth0\_UsersRepo::delete\_meta(~~$wp\_user\_id, self::UPDATED\_EMAIL~~ ); |
  |  | 80 | if ($this->api\_change\_email->call($auth0\_id, $current\_email)) { |
  |  | 81 | WP\_Auth0\_UsersRepo::delete\_meta($wp\_user\_id, self::UPDATED\_EMAIL); |
  | 78 | 82 | return true; |
  | 79 | 83 | } |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L81) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L85) |  |
  | 81 | 85 | // Past this point, email update with Auth0 has failed so we need to revert changes saved in WP. |
  | 82 | 86 | // Remove the pending email address change flags so it can be tried again. |
  | 83 |  | delete\_user\_meta(~~$wp\_user\_id, '\_new\_email'~~ ); |
  | 84 |  | WP\_Auth0\_UsersRepo::delete\_meta(~~$wp\_user\_id, self::UPDATED\_EMAIL~~ ); |
  |  | 87 | delete\_user\_meta($wp\_user\_id, '\_new\_email'); |
  |  | 88 | WP\_Auth0\_UsersRepo::delete\_meta($wp\_user\_id, self::UPDATED\_EMAIL); |
  | 85 | 89 |  |
  | 86 | 90 | // Suppress the notification for email change. |
  | 87 |  | add\_filter(~~'email\_change\_email', [ $this, 'suppress\_email\_change\_notification' ], 100~~ ); |
  |  | 91 | add\_filter('email\_change\_email', [$this, 'suppress\_email\_change\_notification'], 100); |
  | 88 | 92 |  |
  | 89 | 93 | // Remove this method from profile\_update, which is called by wp\_update\_user, to avoid an infinite loop. |
  | 90 |  | remove\_action(~~'profile\_update', 'wp\_auth0\_profile\_change\_email', 100~~ ); |
  |  | 94 | remove\_action('profile\_update', 'wp\_auth0\_profile\_change\_email', 100); |
  | 91 | 95 |  |
  | 92 | 96 | // Revert the email address to previous. |
  | 93 | 97 | $wp\_user->data->user\_email = $old\_email; |
  | 94 |  | wp\_update\_user(~~$wp\_user~~ ); |
  |  | 98 | wp\_update\_user($wp\_user); |
  | 95 | 99 |  |
  | 96 | 100 | // Revert hooks from above. |
  | 97 |  | add\_action(~~'profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2~~ ); |
  | 98 |  | remove\_filter(~~'email\_change\_email', [ $this, 'suppress\_email\_change\_notification' ], 100~~ ); |
  |  | 101 | add\_action('profile\_update', 'wp\_auth0\_profile\_change\_email', 100, 2); |
  |  | 102 | remove\_filter('email\_change\_email', [$this, 'suppress\_email\_change\_notification'], 100); |
  | 99 | 103 |  |
  | 100 | 104 | // Can't set a custom message here so redirect with an error for WP to pick up. |
  | 101 |  | if (~~in\_array( $GLOBALS['pagenow'], [ 'user-edit.php', 'profile.php' ] )~~ ) { |
  | 102 |  | $redirect\_url = admin\_url(~~$GLOBALS['pagenow']~~ ); |
  | 103 |  | $redirect\_url = add\_query\_arg(~~'user\_id', $wp\_user\_id, $redirect\_url~~ ); |
  | 104 |  | $redirect\_url = add\_query\_arg(~~'error', 'new-email', $redirect\_url~~ ); |
  | 105 |  | wp\_safe\_redirect(~~$redirect\_url~~ ); |
  |  | 105 | if (in\_array($GLOBALS['pagenow'], ['user-edit.php', 'profile.php'])) { |
  |  | 106 | $redirect\_url = admin\_url($GLOBALS['pagenow']); |
  |  | 107 | $redirect\_url = add\_query\_arg('user\_id', $wp\_user\_id, $redirect\_url); |
  |  | 108 | $redirect\_url = add\_query\_arg('error', 'new-email', $redirect\_url); |
  |  | 109 | wp\_safe\_redirect($redirect\_url); |
  | 106 | 110 | exit; |
  | 107 | 111 | } |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=2405569#L119) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Email.php?rev=3114611#L123) |  |
  | 119 | 123 | \* @see wp\_update\_user() |
  | 120 | 124 | \*/ |
  | 121 |  | public function suppress\_email\_change\_notification( array $email ) { |
  |  | 125 | public function suppress\_email\_change\_notification(array $email) |
  |  | 126 | { |
  | 122 | 127 | $email['to']      = null; |
  | 123 | 128 | $email['message'] = null; |
  | 124 |  | $email['subject'] = ~~\_\_( 'Email suppressed - Auth0 email change failed.', 'wp-auth0'~~ ); |
  |  | 129 | $email['subject'] = esc\_html\_\_('Email suppressed - Auth0 email change failed.', 'wp-auth0'); |
  | 125 | 130 | return $email; |
  | 126 | 131 | } |
* ## [auth0/trunk/lib/profile/WP\_Auth0\_Profile\_Change\_Password.php](/changeset/3114611/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php "Show the changeset 3114611 restricted to auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php")

  | [r2271973](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Profile\_Change\_Password. |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=2271973#L11) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611#L12) |  |
  | 11 | 12 | \* Class WP\_Auth0\_Profile\_Change\_Password. |
  | 12 | 13 | \*/ |
  | 13 |  | class WP\_Auth0\_Profile\_Change\_Password { |
  |  | 14 | class WP\_Auth0\_Profile\_Change\_Password |
  |  | 15 | { |
  | 14 | 16 |  |
  | 15 | 17 | /\*\* |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=2271973#L25) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611#L27) |  |
  | 25 | 27 | \* @param WP\_Auth0\_Api\_Change\_Password $api\_change\_password - WP\_Auth0\_Api\_Change\_Password instance. |
  | 26 | 28 | \*/ |
  | 27 |  | public function \_\_construct( WP\_Auth0\_Api\_Change\_Password $api\_change\_password ) { |
  |  | 29 | public function \_\_construct(WP\_Auth0\_Api\_Change\_Password $api\_change\_password) |
  |  | 30 | { |
  | 28 | 31 | $this->api\_change\_password = $api\_change\_password; |
  | 29 | 32 | } |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=2271973#L39) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611#L42) |  |
  | 39 | 42 | \* @return boolean |
  | 40 | 43 | \*/ |
  | 41 |  | public function validate\_new\_password( $errors, $user ) { |
  |  | 44 | public function validate\_new\_password($errors, $user) |
  |  | 45 | { |
  | 42 | 46 | // Nonce was verified during core process this is hooked to. |
  | 43 | 47 | // phpcs:disable WordPress.Security.NonceVerification.NoNonceVerification |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=2271973#L45) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Change_Password.php?rev=3114611#L49) |  |
  | 45 | 49 | // Exit if we're not changing the password. |
  | 46 | 50 | // The pass1 key is for core WP, password\_1 is WooCommerce. |
  | 47 |  | if (~~empty( $\_POST['pass1'] ) && empty( $\_POST['password\_1'] )~~ ) { |
  |  | 51 | if (empty($\_POST['pass1']) && empty($\_POST['password\_1'])) { |
  | 48 | 52 | return false; |
  | 49 | 53 | } |
  | 50 | 54 |  |
  | 51 | 55 | // Do we have a user to edit? |
  | 52 |  | $is\_user\_from\_hook = is\_object(~~$user ) && ! empty( $user->ID~~ ); |
  | 53 |  | if (~~! $is\_user\_from\_hook && ! isset( $\_POST['user\_id'] )~~ ) { |
  |  | 56 | $is\_user\_from\_hook = is\_object($user) && !empty($user->ID); |
  |  | 57 | if (!$is\_user\_from\_hook && !isset($\_POST['user\_id'])) { |
  | 54 | 58 | return false; |
  | 55 | 59 | } |
  | 56 | 60 |  |
  | 57 |  | $wp\_user\_id = absint(~~$is\_user\_from\_hook ? $user->ID : $\_POST['user\_id']~~ ); |
  |  | 61 | $wp\_user\_id = absint($is\_user\_from\_hook ? $user->ID : $\_POST['user\_id']); |
  | 58 | 62 |  |
  | 59 | 63 | // Does the current user have permission to edit this user? |
  | 60 |  | if (~~! current\_user\_can( 'edit\_users' ) && $wp\_user\_id !== get\_current\_user\_id()~~ ) { |
  |  | 64 | if (!current\_user\_can('edit\_users') && $wp\_user\_id !== get\_current\_user\_id()) { |
  | 61 | 65 | return false; |
  | 62 | 66 | } |
  | 63 | 67 |  |
  | 64 | 68 | // Is the user being edited an Auth0 user? |
  | 65 |  | $auth0\_id = WP\_Auth0\_UsersRepo::get\_meta(~~$wp\_user\_id, 'auth0\_id'~~ ); |
  | 66 |  | if (~~empty( $auth0\_id )~~ ) { |
  |  | 69 | $auth0\_id = WP\_Auth0\_UsersRepo::get\_meta($wp\_user\_id, 'auth0\_id'); |
  |  | 70 | if (empty($auth0\_id)) { |
  | 67 | 71 | return false; |
  | 68 | 72 | } |
  | 69 | 73 |  |
  | 70 | 74 | // Is the user being edited a DB strategy user? |
  | 71 |  | $strategy = WP\_Auth0\_Users::get\_strategy(~~$auth0\_id~~ ); |
  | 72 |  | if (~~'auth0' !== $strategy~~ ) { |
  |  | 75 | $strategy = WP\_Auth0\_Users::get\_strategy($auth0\_id); |
  |  | 76 | if ('auth0' !== $strategy) { |
  | 73 | 77 | return false; |
  | 74 | 78 | } |
  | 75 | 79 |  |
  | 76 |  | $field\_name = !~~empty( $\_POST['pass1']~~ ) ? 'pass1' : 'password\_1'; |
  |  | 80 | $field\_name = !empty($\_POST['pass1']) ? 'pass1' : 'password\_1'; |
  | 77 | 81 |  |
  | 78 | 82 | // Validated above and only sent to the change password API endpoint. |
  | 79 | 83 | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput |
  | 80 |  | $new\_password = wp\_unslash(~~$\_POST[ $field\_name ]~~ ); |
  |  | 84 | $new\_password = wp\_unslash($\_POST[$field\_name]); |
  | 81 | 85 |  |
  | 82 |  | $result = $this->api\_change\_password->call(~~$auth0\_id, $new\_password~~ ); |
  |  | 86 | $result = $this->api\_change\_password->call($auth0\_id, $new\_password); |
  | 83 | 87 |  |
  | 84 | 88 | // Password change was successful, nothing else to do. |
  | 85 |  | if (~~true === $result~~ ) { |
  |  | 89 | if (true === $result) { |
  | 86 | 90 | return true; |
  | 87 | 91 | } |
  | 88 | 92 |  |
  | 89 | 93 | // Password change was unsuccessful so don't change WP user account. |
  | 90 |  | unset(~~$\_POST['pass1']~~ ); |
  | 91 |  | unset(~~$\_POST['pass1-text']~~ ); |
  | 92 |  | unset(~~$\_POST['pass2']~~ ); |
  |  | 94 | unset($\_POST['pass1']); |
  |  | 95 | unset($\_POST['pass1-text']); |
  |  | 96 | unset($\_POST['pass2']); |
  | 93 | 97 |  |
  | 94 | 98 | // Add an error message to appear at the top of the page. |
  | 95 |  | $error\_msg = is\_string(~~$result ) ? $result : \_\_( 'Password could not be updated.', 'wp-auth0'~~ ); |
  | 96 |  | $errors->add(~~'auth0\_password', $error\_msg, [ 'form-field' => $field\_name ]~~ ); |
  |  | 99 | $error\_msg = is\_string($result) ? $result : esc\_html\_\_('Password could not be updated.', 'wp-auth0'); |
  |  | 100 | $errors->add('auth0\_password', $error\_msg, ['form-field' => $field\_name]); |
  | 97 | 101 | return false; |
  | 98 | 102 |  |
* ## [auth0/trunk/lib/profile/WP\_Auth0\_Profile\_Delete\_Data.php](/changeset/3114611/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php "Show the changeset 3114611 restricted to auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php")

  | [r2271973](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains class WP\_Auth0\_Profile\_Delete\_Data. |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=2271973#L12) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=3114611#L13) |  |
  | 12 | 13 | \* Provides UI and AJAX handlers to delete a user's Auth0 data. |
  | 13 | 14 | \*/ |
  | 14 |  | class WP\_Auth0\_Profile\_Delete\_Data { |
  |  | 15 | class WP\_Auth0\_Profile\_Delete\_Data |
  |  | 16 | { |
  | 15 | 17 |  |
  | 16 | 18 | /\*\* |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=2271973#L19) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=3114611#L21) |  |
  | 19 | 21 | \* IMPORTANT: Internal callback use only, do not call this function directly! |
  | 20 | 22 | \*/ |
  | 21 |  | public function show\_delete\_identity() { |
  |  | 23 | public function show\_delete\_identity() |
  |  | 24 | { |
  | 22 | 25 |  |
  | 23 |  | if (~~! isset( $GLOBALS['user\_id'] ) || ! current\_user\_can( 'edit\_users', $GLOBALS['user\_id'] )~~ ) { |
  |  | 26 | if (!isset($GLOBALS['user\_id']) || !current\_user\_can('edit\_users', $GLOBALS['user\_id'])) { |
  | 24 | 27 | return; |
  | 25 | 28 | } |
  | 26 | 29 |  |
  | 27 |  | $auth0\_user = get\_auth0userinfo(~~$GLOBALS['user\_id']~~ ); |
  | 28 |  | if (~~! $auth0\_user~~ ) { |
  |  | 30 | $auth0\_user = get\_auth0userinfo($GLOBALS['user\_id']); |
  |  | 31 | if (!$auth0\_user) { |
  | 29 | 32 | return; |
  | 30 | 33 | } |
  | 31 | 34 |  |
  | 32 |  | ?> |
  |  | 35 | ?> |
  | 33 | 36 | <table class="form-table"> |
  | 34 | 37 | <tr> |
  | 35 | 38 | <th> |
  | 36 |  | <label><?php ~~\_e( 'Delete Auth0 Data', 'wp-auth0'~~ ); ?></label> |
  |  | 39 | <label><?php esc\_html\_e('Delete Auth0 Data', 'wp-auth0'); ?></label> |
  | 37 | 40 | </th> |
  | 38 | 41 | <td> |
  | 39 |  | <input type="button" id="auth0\_delete\_data" class="button button-secondary" |
  | 40 |  | value="<?php \_e( 'Delete Auth0 Data', 'wp-auth0' ); ?>" /> |
  |  | 42 | <input type="button" id="auth0\_delete\_data" class="button button-secondary" value="<?php esc\_html\_e('Delete Auth0 Data', 'wp-auth0'); ?>" /> |
  | 41 | 43 | <br><br> |
  | 42 |  | <a href="https://manage.auth0.com/#/users/<?php echo rawurlencode(~~$auth0\_user->sub~~ ); ?>" target="\_blank"> |
  | 43 |  | <?php ~~\_e( 'View in Auth0', 'wp-auth0'~~ ); ?> |
  |  | 44 | <a href="https://manage.auth0.com/#/users/<?php echo rawurlencode($auth0\_user->sub); ?>" target="\_blank"> |
  |  | 45 | <?php esc\_html\_e('View in Auth0', 'wp-auth0'); ?> |
  | 44 | 46 | </a> |
  | 45 | 47 | </td> |
  | 46 | 48 | </tr> |
  | 47 | 49 | </table> |
  | 48 |  | <?php |
  |  | 50 | <?php |
  | 49 | 51 | } |
  | 50 | 52 |  |
  | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=2271973#L54) | […](/browser/auth0/trunk/lib/profile/WP_Auth0_Profile_Delete_Data.php?rev=3114611#L56) |  |
  | 54 | 56 | \* IMPORTANT: Internal callback use only, do not call this function directly! |
  | 55 | 57 | \*/ |
  | 56 |  | public function delete\_user\_data() { |
  | 57 |  | check\_ajax\_referer( 'delete\_auth0\_identity' ); |
  |  | 58 | public function delete\_user\_data() |
  |  | 59 | { |
  |  | 60 | check\_ajax\_referer('delete\_auth0\_identity'); |
  | 58 | 61 |  |
  | 59 |  | if (~~empty( $\_POST['user\_id'] )~~ ) { |
  | 60 |  | wp\_send\_json\_error(~~[ 'error' => \_\_( 'Empty user\_id', 'wp-auth0' ) ]~~ ); |
  |  | 62 | if (empty($\_POST['user\_id'])) { |
  |  | 63 | wp\_send\_json\_error(['error' => esc\_html\_\_('Empty user\_id', 'wp-auth0')]); |
  | 61 | 64 | } |
  | 62 | 65 |  |
  | 63 |  | $user\_id = absint(~~$\_POST['user\_id']~~ ); |
  |  | 66 | $user\_id = absint($\_POST['user\_id']); |
  | 64 | 67 |  |
  | 65 |  | if (~~! current\_user\_can( 'edit\_users' )~~ ) { |
  | 66 |  | wp\_send\_json\_error(~~[ 'error' => \_\_( 'Forbidden', 'wp-auth0' ) ]~~ ); |
  |  | 68 | if (!current\_user\_can('edit\_users')) { |
  |  | 69 | wp\_send\_json\_error(['error' => esc\_html\_\_('Forbidden', 'wp-auth0')]); |
  | 67 | 70 | } |
  | 68 | 71 |  |
  | 69 |  | wp\_auth0\_delete\_auth0\_object(~~$user\_id~~ ); |
  |  | 72 | wp\_auth0\_delete\_auth0\_object($user\_id); |
  | 70 | 73 | wp\_send\_json\_success(); |
  | 71 | 74 | } |
* ## [auth0/trunk/lib/scripts-js/db-get-user.js](/changeset/3114611/auth0/trunk/lib/scripts-js/db-get-user.js "Show the changeset 3114611 restricted to auth0/trunk/lib/scripts-js/db-get-user.js")

  | [r2100699](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=2100699#L11 "Show revision 2100699 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=3114611#L11 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | \* @param {function} callback - Function to call when the script has completed. |
  | 12 | 12 | \*/ |
  | 13 |  | function getByEmail (email, callback) { |
  | 14 |  |  |
  | 15 |  | var request = require('request'); |
  |  | 13 | function getByEmail(email, callback) { |
  |  | 14 | var request = require("request"); |
  | 16 | 15 |  |
  | 17 | 16 | request.post( |
  | 18 |  | configuration.endpointUrl + ~~'migration-ws-get-user'~~, |
  |  | 17 | configuration.endpointUrl + "migration-ws-get-user", |
  | 19 | 18 | { |
  | 20 | 19 | form: { |
  | 21 | 20 | username: email, |
  | 22 |  | access\_token: configuration.migrationToken |
  | 23 |  | } |
  |  | 21 | access\_token: configuration.migrationToken, |
  |  | 22 | }, |
  | 24 | 23 | }, |
  | 25 |  | function(error, response, body) { |
  | 26 |  |  |
  |  | 24 | function (error, response, body) { |
  | 27 | 25 | // Error encountered during HTTP request, exit. |
  | 28 | 26 | if (error) { |
  | […](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=2100699#L33) | […](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=3114611#L31) |  |
  | 33 | 31 |  |
  | 34 | 32 | // Error returned from WordPress or no data, exit. |
  | 35 |  | if (wpUser.error || !wpUser.data) { |
  |  | 33 | if (wpUser.error || !wpUser.data) { |
  | 36 | 34 | return callback(null); |
  | 37 | 35 | } |
  | […](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=2100699#L39) | […](/browser/auth0/trunk/lib/scripts-js/db-get-user.js?rev=3114611#L37) |  |
  | 39 | 37 | // Use WordPress profile data to populate Auth0 account. |
  | 40 | 38 | var profile = { |
  | 41 |  | user\_id: configuration.userNamespace + ~~'|'~~ + wpUser.data.ID, |
  |  | 39 | user\_id: configuration.userNamespace + "|" + wpUser.data.ID, |
  | 42 | 40 | username: wpUser.data.user\_login, |
  | 43 | 41 | email: wpUser.data.user\_email, |
  | 44 | 42 | name: wpUser.data.display\_name, |
  | 45 |  | email\_verified: true |
  |  | 43 | email\_verified: true, |
  | 46 | 44 | }; |
  | 47 | 45 |  |
  | 48 | 46 | callback(null, profile); |
  | 49 |  | }); |
  |  | 47 | } |
  |  | 48 | ); |
  | 50 | 49 | } |
* ## [auth0/trunk/lib/scripts-js/db-login.js](/changeset/3114611/auth0/trunk/lib/scripts-js/db-login.js "Show the changeset 3114611 restricted to auth0/trunk/lib/scripts-js/db-login.js")

  | [r2100699](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=2100699#L12 "Show revision 2100699 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=3114611#L12 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 12 | 12 | \* @param {function} callback - Function to call when the script has completed. |
  | 13 | 13 | \*/ |
  | 14 |  | function login (email, password, callback) { |
  | 15 |  |  |
  | 16 |  | var request = require('request'); |
  |  | 14 | function login(email, password, callback) { |
  |  | 15 | var request = require("request"); |
  | 17 | 16 |  |
  | 18 | 17 | request.post( |
  | 19 |  | configuration.endpointUrl + ~~'migration-ws-login'~~, |
  |  | 18 | configuration.endpointUrl + "migration-ws-login", |
  | 20 | 19 | { |
  | 21 | 20 | form: { |
  | 22 |  | username: email, |
  | 23 |  | password: password, |
  | 24 |  | access\_token: configuration.migrationToken |
  | 25 |  | } |
  |  | 21 | username: email, |
  |  | 22 | password: password, |
  |  | 23 | access\_token: configuration.migrationToken, |
  |  | 24 | }, |
  | 26 | 25 | }, |
  | 27 |  | function(error, response, body) { |
  | 28 |  |  |
  |  | 26 | function (error, response, body) { |
  | 29 | 27 | // Error encountered during HTTP request, exit. |
  | 30 | 28 | if (error) { |
  | […](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=2100699#L35) | […](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=3114611#L33) |  |
  | 35 | 33 |  |
  | 36 | 34 | // Error returned from WordPress or no data, exit. |
  | 37 |  | if (wpUser.error || !wpUser.data) { |
  |  | 35 | if (wpUser.error || !wpUser.data) { |
  | 38 | 36 | return callback(null); |
  | 39 | 37 | } |
  | […](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=2100699#L41) | […](/browser/auth0/trunk/lib/scripts-js/db-login.js?rev=3114611#L39) |  |
  | 41 | 39 | // Use WordPress profile data to populate Auth0 account. |
  | 42 | 40 | var profile = { |
  | 43 |  | user\_id: configuration.userNamespace + ~~'|'~~ + wpUser.data.ID, |
  |  | 41 | user\_id: configuration.userNamespace + "|" + wpUser.data.ID, |
  | 44 | 42 | username: wpUser.data.user\_login, |
  | 45 | 43 | email: wpUser.data.user\_email, |
  | 46 | 44 | name: wpUser.data.display\_name, |
  | 47 |  | email\_verified: true |
  |  | 45 | email\_verified: true, |
  | 48 | 46 | }; |
  | 49 | 47 |  |
  | 50 | 48 | callback(null, profile); |
  | 51 |  | }); |
  |  | 49 | } |
  |  | 50 | ); |
  | 52 | 51 | } |
* ## [auth0/trunk/lib/token-verifier/WP\_Auth0\_AsymmetricVerifier.php](/changeset/3114611/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php "Show the changeset 3114611 restricted to auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php")

  | [r2310480](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=2310480#L1 "Show revision 2310480 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Trait WP\_Auth0\_AsymmetricVerifier. |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=2310480#L17) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=3114611#L18) |  |
  | 17 | 18 | \* @codeCoverageIgnore - Classes are adapted from the PHP SDK and tested there. |
  | 18 | 19 | \*/ |
  | 19 |  | final class WP\_Auth0\_AsymmetricVerifier extends WP\_Auth0\_SignatureVerifier { |
  |  | 20 | final class WP\_Auth0\_AsymmetricVerifier extends WP\_Auth0\_SignatureVerifier |
  |  | 21 | { |
  | 20 | 22 |  |
  | 21 | 23 | /\*\* |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=2310480#L31) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=3114611#L33) |  |
  | 31 | 33 | \* @param WP\_Auth0\_JwksFetcher $jwks WP\_Auth0\_JwksFetcher to use. |
  | 32 | 34 | \*/ |
  | 33 |  | public function \_\_construct( WP\_Auth0\_JwksFetcher $jwks ) { |
  |  | 35 | public function \_\_construct(WP\_Auth0\_JwksFetcher $jwks) |
  |  | 36 | { |
  | 34 | 37 | $this->jwks = $jwks; |
  | 35 |  | parent::\_\_construct(~~'RS256'~~ ); |
  |  | 38 | parent::\_\_construct('RS256'); |
  | 36 | 39 | } |
  | 37 | 40 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=2310480#L45) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_AsymmetricVerifier.php?rev=3114611#L48) |  |
  | 45 | 48 | \* @throws WP\_Auth0\_InvalidIdTokenException If ID token kid was not found in the JWKS. |
  | 46 | 49 | \*/ |
  | 47 |  | protected function checkSignature( Token $token ) : bool { |
  | 48 |  | $token\_kid   = $token->getHeader( 'kid', false ); |
  | 49 |  | $signing\_key = $this->jwks->getKey( $token\_kid ); |
  | 50 |  | if ( ! $signing\_key ) { |
  | 51 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 50 | protected function checkSignature(Token $token): bool |
  |  | 51 | { |
  |  | 52 | $token\_kid   = $token->getHeader('kid', false); |
  |  | 53 | $signing\_key = $this->jwks->getKey($token\_kid); |
  |  | 54 | if (!$signing\_key) { |
  |  | 55 | throw new WP\_Auth0\_InvalidIdTokenException(esc\_html( |
  | 52 | 56 | 'Could not find a public key for Key ID (kid) "' . $token\_kid . '"' |
  | 53 |  | ); |
  |  | 57 | )); |
  | 54 | 58 | } |
  | 55 | 59 |  |
  | 56 |  | return $token->verify(~~new RsSigner(), new Key( $signing\_key )~~ ); |
  |  | 60 | return $token->verify(new RsSigner(), new Key($signing\_key)); |
  | 57 | 61 | } |
  | 58 | 62 | } |
* ## [auth0/trunk/lib/token-verifier/WP\_Auth0\_IdTokenVerifier.php](/changeset/3114611/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php "Show the changeset 3114611 restricted to auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php")

  | [r2599514](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L1 "Show revision 2599514 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Trait WP\_Auth0\_IdTokenVerifier. |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L13) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L14) |  |
  | 13 | 14 | \* @codeCoverageIgnore - Classes are adapted from the PHP SDK and tested there. |
  | 14 | 15 | \*/ |
  | 15 |  | final class WP\_Auth0\_IdTokenVerifier { |
  |  | 16 | final class WP\_Auth0\_IdTokenVerifier |
  |  | 17 | { |
  | 16 | 18 |  |
  | 17 | 19 | /\*\* |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L50) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L52) |  |
  | 50 | 52 | \* @param WP\_Auth0\_SignatureVerifier $verifier Token signature verifier. |
  | 51 | 53 | \*/ |
  | 52 |  | public function \_\_construct( string $issuer, string $audience, WP\_Auth0\_SignatureVerifier $verifier ) { |
  |  | 54 | public function \_\_construct(string $issuer, string $audience, WP\_Auth0\_SignatureVerifier $verifier) |
  |  | 55 | { |
  | 53 | 56 | $this->issuer   = $issuer; |
  | 54 | 57 | $this->audience = $audience; |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L63) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L66) |  |
  | 63 | 66 | \* @return void |
  | 64 | 67 | \*/ |
  | 65 |  | public function setLeeway( int $newLeeway ) { |
  |  | 68 | public function setLeeway(int $newLeeway) |
  |  | 69 | { |
  | 66 | 70 | $this->leeway = $newLeeway; |
  | 67 | 71 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L85) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L89) |  |
  | 85 | 89 | \*      - Any claim-based test fails |
  | 86 | 90 | \*/ |
  | 87 |  | public function verify( string $token, array $options = [] ) : array { |
  | 88 |  | if ( empty( $token ) ) { |
  | 89 |  | throw new WP\_Auth0\_InvalidIdTokenException( 'ID token is required but missing' ); |
  | 90 |  | } |
  | 91 |  |  |
  | 92 |  | $verifiedToken = $this->verifier->verifyAndDecode( $token ); |
  |  | 91 | public function verify(string $token, array $options = []): array |
  |  | 92 | { |
  |  | 93 | if (empty($token)) { |
  |  | 94 | throw new WP\_Auth0\_InvalidIdTokenException('ID token is required but missing'); |
  |  | 95 | } |
  |  | 96 |  |
  |  | 97 | $verifiedToken = $this->verifier->verifyAndDecode($token); |
  | 93 | 98 |  |
  | 94 | 99 | $claims = []; |
  | 95 |  | foreach (~~$verifiedToken->getClaims() as $claim => $value~~ ) { |
  | 96 |  | $claims[~~$claim~~ ] = $value->getValue(); |
  |  | 100 | foreach ($verifiedToken->getClaims() as $claim => $value) { |
  |  | 101 | $claims[$claim] = $value->getValue(); |
  | 97 | 102 | } |
  | 98 | 103 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L102) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L107) |  |
  | 102 | 107 |  |
  | 103 | 108 | $tokenIss = $claims['iss'] ?? false; |
  | 104 |  | if (~~! $tokenIss || ! is\_string( $tokenIss )~~ ) { |
  | 105 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Issuer (iss) claim must be a string present in the ID token'~~ ); |
  | 106 |  | } |
  | 107 |  |  |
  | 108 |  | if (~~$tokenIss !== $this->issuer~~ ) { |
  | 109 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 110 |  | sprintf( |
  |  | 109 | if (!$tokenIss || !is\_string($tokenIss)) { |
  |  | 110 | throw new WP\_Auth0\_InvalidIdTokenException('Issuer (iss) claim must be a string present in the ID token'); |
  |  | 111 | } |
  |  | 112 |  |
  |  | 113 | if ($tokenIss !== $this->issuer) { |
  |  | 114 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 115 | esc\_html(sprintf( |
  | 111 | 116 | 'Issuer (iss) claim mismatch in the ID token; expected "%s", found "%s"', |
  | 112 | 117 | $this->issuer, |
  | 113 | 118 | $tokenIss |
  | 114 |  | ) |
  |  | 119 | )) |
  | 115 | 120 | ); |
  | 116 | 121 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L121) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L126) |  |
  | 121 | 126 |  |
  | 122 | 127 | $tokenSub = $claims['sub'] ?? false; |
  | 123 |  | if (~~! $tokenSub || ! is\_string( $tokenSub )~~ ) { |
  | 124 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Subject (sub) claim must be a string present in the ID token'~~ ); |
  |  | 128 | if (!$tokenSub || !is\_string($tokenSub)) { |
  |  | 129 | throw new WP\_Auth0\_InvalidIdTokenException('Subject (sub) claim must be a string present in the ID token'); |
  | 125 | 130 | } |
  | 126 | 131 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L130) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L135) |  |
  | 130 | 135 |  |
  | 131 | 136 | $tokenAud = $claims['aud'] ?? false; |
  | 132 |  | if (~~! $tokenAud || ( ! is\_string( $tokenAud ) && ! is\_array( $tokenAud ) )~~ ) { |
  |  | 137 | if (!$tokenAud || (!is\_string($tokenAud) && !is\_array($tokenAud))) { |
  | 133 | 138 | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 134 | 139 | 'Audience (aud) claim must be a string or array of strings present in the ID token' |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L136) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L141) |  |
  | 136 | 141 | } |
  | 137 | 142 |  |
  | 138 |  | if (~~is\_array( $tokenAud ) && ! in\_array( $this->audience, $tokenAud )~~ ) { |
  | 139 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 140 |  | sprintf( |
  |  | 143 | if (is\_array($tokenAud) && !in\_array($this->audience, $tokenAud)) { |
  |  | 144 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 145 | esc\_html(sprintf( |
  | 141 | 146 | 'Audience (aud) claim mismatch in the ID token; expected "%s" was not one of "%s"', |
  | 142 | 147 | $this->audience, |
  | 143 |  | implode(~~', ', $tokenAud~~ ) |
  | 144 |  | ) |
  | 145 |  | ); |
  | 146 |  | } elseif (~~is\_string( $tokenAud ) && $tokenAud !== $this->audience~~ ) { |
  | 147 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 148 |  | sprintf( |
  |  | 148 | implode(', ', $tokenAud) |
  |  | 149 | )) |
  |  | 150 | ); |
  |  | 151 | } elseif (is\_string($tokenAud) && $tokenAud !== $this->audience) { |
  |  | 152 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 153 | esc\_html(sprintf( |
  | 149 | 154 | 'Audience (aud) claim mismatch in the ID token; expected "%s", found "%s"', |
  | 150 | 155 | $this->audience, |
  | 151 | 156 | $tokenAud |
  | 152 |  | ) |
  |  | 157 | )) |
  | 153 | 158 | ); |
  | 154 | 159 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L162) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L167) |  |
  | 162 | 167 |  |
  | 163 | 168 | $tokenExp = $claims['exp'] ?? false; |
  | 164 |  | if (~~! $tokenExp || ! is\_int( $tokenExp )~~ ) { |
  | 165 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Expiration Time (exp) claim must be a number present in the ID token'~~ ); |
  |  | 169 | if (!$tokenExp || !is\_int($tokenExp)) { |
  |  | 170 | throw new WP\_Auth0\_InvalidIdTokenException('Expiration Time (exp) claim must be a number present in the ID token'); |
  | 166 | 171 | } |
  | 167 | 172 |  |
  | 168 | 173 | $expireTime = $tokenExp + $leeway; |
  | 169 |  | if (~~$now > $expireTime~~ ) { |
  | 170 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 171 |  | sprintf( |
  |  | 174 | if ($now > $expireTime) { |
  |  | 175 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 176 | esc\_html(sprintf( |
  | 172 | 177 | 'Expiration Time (exp) claim error in the ID token; current time (%d) is after expiration time (%d)', |
  | 173 | 178 | $now, |
  | 174 | 179 | $expireTime |
  | 175 |  | ) |
  |  | 180 | )) |
  | 176 | 181 | ); |
  | 177 | 182 | } |
  | 178 | 183 |  |
  | 179 | 184 | $tokenIat = $claims['iat'] ?? false; |
  | 180 |  | if (~~! $tokenIat || ! is\_int( $tokenIat )~~ ) { |
  | 181 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Issued At (iat) claim must be a number present in the ID token'~~ ); |
  |  | 185 | if (!$tokenIat || !is\_int($tokenIat)) { |
  |  | 186 | throw new WP\_Auth0\_InvalidIdTokenException('Issued At (iat) claim must be a number present in the ID token'); |
  | 182 | 187 | } |
  | 183 | 188 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L186) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L191) |  |
  | 186 | 191 | \*/ |
  | 187 | 192 |  |
  | 188 |  | if (~~! empty( $options['nonce'] )~~ ) { |
  |  | 193 | if (!empty($options['nonce'])) { |
  | 189 | 194 | $tokenNonce = $claims['nonce'] ?? false; |
  | 190 |  | if (~~! $tokenNonce || ! is\_string( $tokenNonce )~~ ) { |
  | 191 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Nonce (nonce) claim must be a string present in the ID token'~~ ); |
  | 192 |  | } |
  | 193 |  |  |
  | 194 |  | if (~~$tokenNonce !== $options['nonce']~~ ) { |
  | 195 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 196 |  | sprintf( |
  |  | 195 | if (!$tokenNonce || !is\_string($tokenNonce)) { |
  |  | 196 | throw new WP\_Auth0\_InvalidIdTokenException('Nonce (nonce) claim must be a string present in the ID token'); |
  |  | 197 | } |
  |  | 198 |  |
  |  | 199 | if ($tokenNonce !== $options['nonce']) { |
  |  | 200 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 201 | esc\_html(sprintf( |
  | 197 | 202 | 'Nonce (nonce) claim mismatch in the ID token; expected "%s", found "%s"', |
  | 198 | 203 | $options['nonce'], |
  | 199 | 204 | $tokenNonce |
  | 200 |  | ) |
  |  | 205 | )) |
  | 201 | 206 | ); |
  | 202 | 207 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L207) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L212) |  |
  | 207 | 212 | \*/ |
  | 208 | 213 |  |
  | 209 |  | if (~~is\_array( $tokenAud ) && count( $tokenAud ) > 1~~ ) { |
  |  | 214 | if (is\_array($tokenAud) && count($tokenAud) > 1) { |
  | 210 | 215 | $tokenAzp = $claims['azp'] ?? false; |
  | 211 |  | if (~~! $tokenAzp || ! is\_string( $tokenAzp )~~ ) { |
  |  | 216 | if (!$tokenAzp || !is\_string($tokenAzp)) { |
  | 212 | 217 | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 213 | 218 | 'Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values' |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L215) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L220) |  |
  | 215 | 220 | } |
  | 216 | 221 |  |
  | 217 |  | if (~~$tokenAzp !== $this->audience~~ ) { |
  | 218 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 219 |  | sprintf( |
  |  | 222 | if ($tokenAzp !== $this->audience) { |
  |  | 223 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 224 | esc\_html(sprintf( |
  | 220 | 225 | 'Authorized Party (azp) claim mismatch in the ID token; expected "%s", found "%s"', |
  | 221 | 226 | $this->audience, |
  | 222 | 227 | $tokenAzp |
  | 223 |  | ) |
  |  | 228 | )) |
  | 224 | 229 | ); |
  | 225 | 230 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L232) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L237) |  |
  | 232 | 237 | $expectedOrganization = $options['org\_id'] ?? null; |
  | 233 | 238 |  |
  | 234 |  | if (~~null !== $expectedOrganization && '' !== $expectedOrganization~~ ) { |
  | 235 |  | if (~~! isset( $claims['org\_id'] ) || ! is\_string( $claims['org\_id'] )~~ ) { |
  | 236 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Organization Id (org\_id) claim must be a string present in the ID token'~~ ); |
  | 237 |  | } |
  | 238 |  |  |
  | 239 |  | if (~~$claims['org\_id'] !== $expectedOrganization~~ ) { |
  | 240 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 241 |  | sprintf( |
  |  | 239 | if (null !== $expectedOrganization && '' !== $expectedOrganization) { |
  |  | 240 | if (!isset($claims['org\_id']) || !is\_string($claims['org\_id'])) { |
  |  | 241 | throw new WP\_Auth0\_InvalidIdTokenException('Organization Id (org\_id) claim must be a string present in the ID token'); |
  |  | 242 | } |
  |  | 243 |  |
  |  | 244 | if ($claims['org\_id'] !== $expectedOrganization) { |
  |  | 245 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 246 | esc\_html(sprintf( |
  | 242 | 247 | 'Organization Id (org\_id) claim value mismatch in the ID token; expected "%s", found "%s"', |
  | 243 | 248 | $expectedOrganization, |
  | 244 | 249 | $claims['org\_id'] |
  | 245 |  | ) |
  |  | 250 | )) |
  | 246 | 251 | ); |
  | 247 | 252 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L252) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L257) |  |
  | 252 | 257 | \*/ |
  | 253 | 258 |  |
  | 254 |  | if (~~! empty( $options['max\_age'] )~~ ) { |
  |  | 259 | if (!empty($options['max\_age'])) { |
  | 255 | 260 | $tokenAuthTime = $claims['auth\_time'] ?? false; |
  | 256 |  | if (~~! $tokenAuthTime || ! is\_int( $tokenAuthTime )~~ ) { |
  |  | 261 | if (!$tokenAuthTime || !is\_int($tokenAuthTime)) { |
  | 257 | 262 | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 258 | 263 | 'Authentication Time (auth\_time) claim must be a number present in the ID token when Max Age (max\_age) is specified' |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=2599514#L262) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_IdTokenVerifier.php?rev=3114611#L267) |  |
  | 262 | 267 | $authValidUntil = $tokenAuthTime + $options['max\_age'] + $leeway; |
  | 263 | 268 |  |
  | 264 |  | if (~~$now > $authValidUntil~~ ) { |
  | 265 |  | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 266 |  | sprintf( |
  |  | 269 | if ($now > $authValidUntil) { |
  |  | 270 | throw new WP\_Auth0\_InvalidIdTokenException( |
  |  | 271 | esc\_html(sprintf( |
  | 267 | 272 | 'Authentication Time (auth\_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (%d) is after last auth at %d', |
  | 268 | 273 | $now, |
  | 269 | 274 | $authValidUntil |
  | 270 |  | ) |
  |  | 275 | )) |
  | 271 | 276 | ); |
  | 272 | 277 | } |
* ## [auth0/trunk/lib/token-verifier/WP\_Auth0\_JwksFetcher.php](/changeset/3114611/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php "Show the changeset 3114611 restricted to auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php")

  | [r2310480](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L6 "Show revision 2310480 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L6 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | \* @codeCoverageIgnore - Classes are adapted from the PHP SDK and tested there. |
  | 7 | 7 | \*/ |
  | 8 |  | class WP\_Auth0\_JwksFetcher { |
  |  | 8 | class WP\_Auth0\_JwksFetcher |
  |  | 9 | { |
  | 9 | 10 |  |
  | 10 | 11 | /\*\* |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L16) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L17) |  |
  | 16 | 17 | \* WP\_Auth0\_JwksFetcher constructor. |
  | 17 | 18 | \*/ |
  | 18 |  | public function \_\_construct() { |
  | 19 |  | $this->options = WP\_Auth0\_Options::Instance(); |
  |  | 19 | public function \_\_construct() |
  |  | 20 | { |
  |  | 21 | $this->options = WP\_Auth0\_Options::Instance(); |
  | 20 | 22 | } |
  | 21 | 23 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L27) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L29) |  |
  | 27 | 29 | \* @return string |
  | 28 | 30 | \*/ |
  | 29 |  | protected function convertCertToPem( string $cert ) : string { |
  |  | 31 | protected function convertCertToPem(string $cert): string |
  |  | 32 | { |
  | 30 | 33 | $output  = '-----BEGIN CERTIFICATE-----' . PHP\_EOL; |
  | 31 |  | $output .= chunk\_split(~~$cert, 64, PHP\_EOL~~ ); |
  |  | 34 | $output .= chunk\_split($cert, 64, PHP\_EOL); |
  | 32 | 35 | $output .= '-----END CERTIFICATE-----' . PHP\_EOL; |
  | 33 | 36 | return $output; |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L41) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L44) |  |
  | 41 | 44 | \* @return string |
  | 42 | 45 | \*/ |
  | 43 |  | public function getKey( string $kid ) { |
  |  | 46 | public function getKey(string $kid) |
  |  | 47 | { |
  | 44 | 48 | $keys = $this->getKeys(); |
  | 45 | 49 |  |
  | 46 |  | if (~~! empty( $keys ) && empty( $keys[ $kid ] )~~ ) { |
  | 47 |  | $keys = $this->getKeys(~~false~~ ); |
  |  | 50 | if (!empty($keys) && empty($keys[$kid])) { |
  |  | 51 | $keys = $this->getKeys(false); |
  | 48 | 52 | } |
  | 49 | 53 |  |
  | 50 |  | return $keys[~~$kid~~ ] ?? null; |
  |  | 54 | return $keys[$kid] ?? null; |
  | 51 | 55 | } |
  | 52 | 56 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L58) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L62) |  |
  | 58 | 62 | \* @return array |
  | 59 | 63 | \*/ |
  | 60 |  | public function getKeys( $use\_cache = true ) : array { |
  | 61 |  | $keys = $use\_cache ? get\_transient( WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME ) : []; |
  | 62 |  | if ( is\_array( $keys ) && ! empty( $keys ) ) { |
  |  | 64 | public function getKeys($use\_cache = true): array |
  |  | 65 | { |
  |  | 66 | $keys = $use\_cache ? get\_transient(WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME) : []; |
  |  | 67 | if (is\_array($keys) && !empty($keys)) { |
  | 63 | 68 | return $keys; |
  | 64 | 69 | } |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L66) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L71) |  |
  | 66 | 71 | $jwks = $this->requestJwks(); |
  | 67 | 72 |  |
  | 68 |  | if (~~empty( $jwks ) || empty( $jwks['keys'] )~~ ) { |
  |  | 73 | if (empty($jwks) || empty($jwks['keys'])) { |
  | 69 | 74 | return []; |
  | 70 | 75 | } |
  | 71 | 76 |  |
  | 72 | 77 | $keys = []; |
  | 73 |  | foreach (~~$jwks['keys'] as $key~~ ) { |
  | 74 |  | if (~~empty( $key['kid'] ) || empty( $key['x5c'] ) || empty( $key['x5c'][0] )~~ ) { |
  |  | 78 | foreach ($jwks['keys'] as $key) { |
  |  | 79 | if (empty($key['kid']) || empty($key['x5c']) || empty($key['x5c'][0])) { |
  | 75 | 80 | continue; |
  | 76 | 81 | } |
  | 77 | 82 |  |
  | 78 |  | $keys[~~$key['kid'] ] = $this->convertCertToPem( $key['x5c'][0]~~ ); |
  |  | 83 | $keys[$key['kid']] = $this->convertCertToPem($key['x5c'][0]); |
  | 79 | 84 | } |
  | 80 | 85 |  |
  | 81 |  | $cache\_expiration = $this->options->get(~~'cache\_expiration'~~ ); |
  | 82 |  | if (~~$keys && $cache\_expiration~~ ) { |
  | 83 |  | set\_transient(~~WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME, $keys, $cache\_expiration \* MINUTE\_IN\_SECONDS~~ ); |
  |  | 86 | $cache\_expiration = $this->options->get('cache\_expiration'); |
  |  | 87 | if ($keys && $cache\_expiration) { |
  |  | 88 | set\_transient(WPA0\_JWKS\_CACHE\_TRANSIENT\_NAME, $keys, $cache\_expiration \* MINUTE\_IN\_SECONDS); |
  | 84 | 89 | } |
  | 85 | 90 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=2310480#L92) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_JwksFetcher.php?rev=3114611#L97) |  |
  | 92 | 97 | \* @return array |
  | 93 | 98 | \*/ |
  | 94 |  | protected function requestJwks() : array { |
  | 95 |  | return ( new WP\_Auth0\_Api\_Get\_Jwks( $this->options, $this->options->get\_auth\_domain() ) )->call(); |
  |  | 99 | protected function requestJwks(): array |
  |  | 100 | { |
  |  | 101 | return (new WP\_Auth0\_Api\_Get\_Jwks($this->options, $this->options->get\_auth\_domain()))->call(); |
  | 96 | 102 | } |
  | 97 | 103 | } |
* ## [auth0/trunk/lib/token-verifier/WP\_Auth0\_SignatureVerifier.php](/changeset/3114611/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php "Show the changeset 3114611 restricted to auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php")

  | [r2310480](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=2310480#L1 "Show revision 2310480 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Trait WP\_Auth0\_SignatureVerifier. |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=2310480#L16) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611#L17) |  |
  | 16 | 17 | \* @codeCoverageIgnore - Classes are adapted from the PHP SDK and tested there. |
  | 17 | 18 | \*/ |
  | 18 |  | abstract class WP\_Auth0\_SignatureVerifier { |
  |  | 19 | abstract class WP\_Auth0\_SignatureVerifier |
  |  | 20 | { |
  | 19 | 21 |  |
  | 20 | 22 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=2310480#L40) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611#L42) |  |
  | 40 | 42 | \* @return boolean |
  | 41 | 43 | \*/ |
  | 42 |  | abstract protected function checkSignature(~~Token $parsedToken)~~ : bool; |
  |  | 44 | abstract protected function checkSignature(Token $parsedToken): bool; |
  | 43 | 45 |  |
  | 44 | 46 | /\*\* |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=2310480#L47) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611#L49) |  |
  | 47 | 49 | \* @param string $alg |
  | 48 | 50 | \*/ |
  | 49 |  | public function \_\_construct( string $alg ) { |
  |  | 51 | public function \_\_construct(string $alg) |
  |  | 52 | { |
  | 50 | 53 | $this->alg    = $alg; |
  | 51 | 54 | $this->parser = new Parser(); |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=2310480#L63) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SignatureVerifier.php?rev=3114611#L66) |  |
  | 63 | 66 | \* @throws WP\_Auth0\_InvalidIdTokenException If token algorithm signature cannot be validated. |
  | 64 | 67 | \*/ |
  | 65 |  | final public function verifyAndDecode( string $token ) : Token { |
  |  | 68 | final public function verifyAndDecode(string $token): Token |
  |  | 69 | { |
  | 66 | 70 | try { |
  | 67 |  | $parsedToken = $this->parser->parse(~~$token~~ ); |
  | 68 |  | } catch (~~InvalidArgumentException $e~~ ) { |
  | 69 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'ID token could not be decoded'~~ ); |
  |  | 71 | $parsedToken = $this->parser->parse($token); |
  |  | 72 | } catch (InvalidArgumentException $e) { |
  |  | 73 | throw new WP\_Auth0\_InvalidIdTokenException('ID token could not be decoded'); |
  | 70 | 74 | } |
  | 71 | 75 |  |
  | 72 |  | $tokenAlg = $parsedToken->getHeader(~~'alg', false~~ ); |
  | 73 |  | if (~~$tokenAlg !== $this->alg~~ ) { |
  |  | 76 | $tokenAlg = $parsedToken->getHeader('alg', false); |
  |  | 77 | if ($tokenAlg !== $this->alg) { |
  | 74 | 78 | throw new WP\_Auth0\_InvalidIdTokenException( |
  | 75 |  | sprintf( |
  |  | 79 | esc\_html(sprintf( |
  | 76 | 80 | 'Signature algorithm of "%s" is not supported. Expected the ID token to be signed with "%s".', |
  | 77 | 81 | $tokenAlg, |
  | 78 | 82 | $this->alg |
  | 79 |  | ) |
  |  | 83 | )) |
  | 80 | 84 | ); |
  | 81 | 85 | } |
  | 82 | 86 |  |
  | 83 |  | if (~~! $this->checkSignature( $parsedToken )~~ ) { |
  | 84 |  | throw new WP\_Auth0\_InvalidIdTokenException(~~'Invalid ID token signature'~~ ); |
  |  | 87 | if (!$this->checkSignature($parsedToken)) { |
  |  | 88 | throw new WP\_Auth0\_InvalidIdTokenException('Invalid ID token signature'); |
  | 85 | 89 | } |
  | 86 | 90 |  |
* ## [auth0/trunk/lib/token-verifier/WP\_Auth0\_SymmetricVerifier.php](/changeset/3114611/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php "Show the changeset 3114611 restricted to auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php")

  | [r2271973](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Contains Trait WP\_Auth0\_SymmetricVerifier. |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=2271973#L16) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611#L17) |  |
  | 16 | 17 | \* @codeCoverageIgnore - Classes are adapted from the PHP SDK and tested there. |
  | 17 | 18 | \*/ |
  | 18 |  | final class WP\_Auth0\_SymmetricVerifier extends WP\_Auth0\_SignatureVerifier { |
  |  | 19 | final class WP\_Auth0\_SymmetricVerifier extends WP\_Auth0\_SignatureVerifier |
  |  | 20 | { |
  | 19 | 21 |  |
  | 20 | 22 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=2271973#L31) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611#L33) |  |
  | 31 | 33 | \* @param string $clientSecret Client secret for the application. |
  | 32 | 34 | \*/ |
  | 33 |  | public function \_\_construct( string $clientSecret ) { |
  |  | 35 | public function \_\_construct(string $clientSecret) |
  |  | 36 | { |
  | 34 | 37 | $this->clientSecret = $clientSecret; |
  | 35 |  | parent::\_\_construct(~~'HS256'~~ ); |
  |  | 38 | parent::\_\_construct('HS256'); |
  | 36 | 39 | } |
  | 37 | 40 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=2271973#L43) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611#L46) |  |
  | 43 | 46 | \* @return boolean |
  | 44 | 47 | \*/ |
  | 45 |  | protected function checkSignature( Token $token ) : bool { |
  | 46 |  | return $token->verify( new HsSigner(), $this->clientSecret ); |
  |  | 48 | protected function checkSignature(Token $token): bool |
  |  | 49 | { |
  |  | 50 | return $token->verify(new HsSigner(), $this->clientSecret); |
  | 47 | 51 | } |
  | 48 | 52 |  |
  | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=2271973#L52) | […](/browser/auth0/trunk/lib/token-verifier/WP_Auth0_SymmetricVerifier.php?rev=3114611#L56) |  |
  | 52 | 56 | \* @return string |
  | 53 | 57 | \*/ |
  | 54 |  | protected function getAlgorithm() : string { |
  |  | 58 | protected function getAlgorithm(): string |
  |  | 59 | { |
  | 55 | 60 | return 'HS256'; |
  | 56 | 61 | } |
* ## [auth0/trunk/license.txt](/changeset/3114611/auth0/trunk/license.txt "Show the changeset 3114611 restricted to auth0/trunk/license.txt")

  | [r2856828](/browser/auth0/trunk/license.txt?rev=2856828#L1 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/license.txt?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | ﻿The MIT License (MIT) |
  | 2 | 2 |  |
  | 3 |  | Copyright (c) 202~~3~~ Auth0, Inc. <support@auth0.com> (https://auth0.com) |
  |  | 3 | Copyright (c) 2024 Auth0, Inc. <support@auth0.com> (https://auth0.com) |
  | 4 | 4 |  |
  | 5 | 5 | Permission is hereby granted, free of charge, to any person obtaining a copy |
* ## [auth0/trunk/readme.txt](/changeset/3114611/auth0/trunk/readme.txt "Show the changeset 3114611 restricted to auth0/trunk/readme.txt")

  | [r3020639](/browser/auth0/trunk/readme.txt?rev=3020639#L1 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/readme.txt?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Login by Auth0 === |
  | 2 | 2 | Tags: authentication, security, multi-factor, single sign-on, social, passwordless, mfa, 2fa, sso, oauth2, openid, saml |
  | 3 |  | Tested up to: 6.~~4.2~~ |
  | 4 |  | Requires at least: 6.~~4.2~~ |
  |  | 3 | Tested up to: 6.5.5 |
  |  | 4 | Requires at least: 6.5.5 |
  | 5 | 5 | Requires PHP: 7.4 |
  | 6 | 6 | License: MIT |
  | 7 | 7 | License URI: https://github.com/auth0/wp-auth0/blob/4.x/LICENSE |
  | 8 |  | Stable tag: 4.6.~~0~~ |
  | 9 |  | Contributors: auth0, ~~auth0josh,~~ evansims |
  |  | 8 | Stable tag: 4.6.1 |
  |  | 9 | Contributors: auth0, evansims |
  | 10 | 10 |  |
  | 11 | 11 | Login by Auth0 provides improved username/password login, Passwordless login, Social login and Single Sign On for all your sites. |
  | […](/browser/auth0/trunk/readme.txt?rev=3020639#L16) | […](/browser/auth0/trunk/readme.txt?rev=3114611#L16) |  |
  | 16 | 16 |  |
  | 17 | 17 | - \*\*Universal authentication\*\* |
  | 18 |  | - Over 30 social login providers |
  | 19 |  | - Enterprise connections (ADFS, Active Directory / LDAP, SAML, Office 365, Google Apps and more) |
  | 20 |  | - Connect your own database |
  | 21 |  | - Passwordless connections (using email or SMS) |
  |  | 18 | - Over 30 social login providers |
  |  | 19 | - Enterprise connections (ADFS, Active Directory / LDAP, SAML, Office 365, Google Apps and more) |
  |  | 20 | - Connect your own database |
  |  | 21 | - Passwordless connections (using email or SMS) |
  | 22 | 22 | - \*\*Ultra secure\*\* |
  | 23 |  | - Multifactor authentication |
  | 24 |  | - Password policies |
  | 25 |  | - Email validation |
  | 26 |  | - Mitigate brute force attacks |
  |  | 23 | - Multifactor authentication |
  |  | 24 | - Password policies |
  |  | 25 | - Email validation |
  |  | 26 | - Mitigate brute force attacks |
  |  | 27 |  |
  |  | 28 | == Recent Changes == |
  |  | 29 |  |
  |  | 30 | = 4.6.1 (2024-07-08) = |
  |  | 31 |  |
  |  | 32 | \*\*Changed\*\* |
  |  | 33 |  |
  |  | 34 | - Tested against WordPress 6.5.5 w/ PHP 8.3. |
  |  | 35 | - Improved translated string handling. |
  |  | 36 |  |
  |  | 37 | \*\*Fixed\*\* |
  |  | 38 |  |
  |  | 39 | - Resolved issue with `?wle` parameter handling. |
  | 27 | 40 |  |
  | 28 | 41 | == Installation == |
  | […](/browser/auth0/trunk/readme.txt?rev=3020639#L104) | […](/browser/auth0/trunk/readme.txt?rev=3114611#L117) |  |
  | 104 | 117 | All is not lost! |
  | 105 | 118 |  |
  | 106 |  | ~~\*~~ If you're setting up the plugin for the first time or having issues with users logging in, please review our [troubleshooting](https://auth0.com/docs/cms/wordpress/troubleshoot) and [configuration](https://auth0.com/docs/cms/wordpress/configuration) documentation. |
  | 107 |  | ~~\*~~ If you found a bug in the plugin code, please [submit an issue](https://github.com/auth0/wp-auth0/issues) or [create a pull request](https://github.com/auth0/wp-auth0/pulls) on GitHub. |
  | 108 |  | ~~\*~~ If you have questions about how to use Auth0 or the plugin, please [post on our community site](https://community.auth0.com/) or create a [support forum request here](https://wordpress.org/support/plugin/auth0). |
  | 109 |  | ~~\*~~ You can see additional documentation and answers on our [support site](https://support.auth0.com/). Customers on a paid Auth0 plan can [submit a trouble ticket](https://support.auth0.com/tickets) for a fast response. |
  |  | 119 | - If you're setting up the plugin for the first time or having issues with users logging in, please review our [troubleshooting](https://auth0.com/docs/cms/wordpress/troubleshoot) and [configuration](https://auth0.com/docs/cms/wordpress/configuration) documentation. |
  |  | 120 | - If you found a bug in the plugin code, please [submit an issue](https://github.com/auth0/wp-auth0/issues) or [create a pull request](https://github.com/auth0/wp-auth0/pulls) on GitHub. |
  |  | 121 | - If you have questions about how to use Auth0 or the plugin, please [post on our community site](https://community.auth0.com/) or create a [support forum request here](https://wordpress.org/support/plugin/auth0). |
  |  | 122 | - You can see additional documentation and answers on our [support site](https://support.auth0.com/). Customers on a paid Auth0 plan can [submit a trouble ticket](https://support.auth0.com/tickets) for a fast response. |
  | 110 | 123 |  |
  | 111 | 124 | == Changelog == |
* ## [auth0/trunk/templates/a0-error-log.php](/changeset/3114611/auth0/trunk/templates/a0-error-log.php "Show the changeset 3114611 restricted to auth0/trunk/templates/a0-error-log.php")

  | [r2271973](/browser/auth0/trunk/templates/a0-error-log.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/a0-error-log.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Displays the error log settings page. |
  | […](/browser/auth0/trunk/templates/a0-error-log.php?rev=2271973#L13) | […](/browser/auth0/trunk/templates/a0-error-log.php?rev=3114611#L14) |  |
  | 13 | 14 | <div class="a0-wrap settings wrap"> |
  | 14 | 15 |  |
  | 15 |  | ~~<h1><?php \_e( 'Error Log', 'wp-auth0'~~ ); ?></h1> |
  | 16 |  | ~~<?php if ( ! empty( $errors )~~ ) : ?> |
  |  | 16 | <h1><?php esc\_html\_e('Error Log', 'wp-auth0'); ?></h1> |
  |  | 17 | <?php if (!empty($errors)) : ?> |
  | 17 | 18 | <div class="a0-buttons"> |
  | 18 |  | <form action="<?php echo admin\_url( 'options.php' ); ?>" method="post" class="js-a0-confirm-submit" |
  | 19 |  | data-confirm-msg="<?php \_e( 'This will delete all error log entries. Proceed?', 'wp-auth0' ); ?>"> |
  | 20 |  | <?php wp\_nonce\_field( WP\_Auth0\_ErrorLog::CLEAR\_LOG\_NONCE ); ?> |
  |  | 19 | <form action="<?php echo esc\_url(admin\_url('options.php')); ?>" method="post" class="js-a0-confirm-submit" data-confirm-msg="<?php esc\_html\_e('This will delete all error log entries. Proceed?', 'wp-auth0'); ?>"> |
  |  | 20 | <?php wp\_nonce\_field(WP\_Auth0\_ErrorLog::CLEAR\_LOG\_NONCE); ?> |
  | 21 | 21 | <input type="hidden" name="action" value="wpauth0\_clear\_error\_log"> |
  | 22 | 22 | <input type="submit" name="submit" class="button button-primary" value="Clear Log"> |
  | 23 | 23 | </form> |
  | 24 | 24 | </div> |
  | 25 |  | <?php endif; ?> |
  |  | 25 | <?php endif; ?> |
  | 26 | 26 |  |
  | 27 | 27 | <table class="widefat top-margin"> |
  | 28 | 28 | <thead> |
  | 29 |  | <tr> |
  | 30 |  | ~~<th><?php \_e( 'Date', 'wp-auth0'~~ ); ?></th> |
  | 31 |  | ~~<th><?php \_e( 'Section', 'wp-auth0'~~ ); ?></th> |
  | 32 |  | ~~<th><?php \_e( 'Error code', 'wp-auth0'~~ ); ?></th> |
  | 33 |  | ~~<th><?php \_e( 'Message', 'wp-auth0'~~ ); ?></th> |
  | 34 |  | ~~<th><?php \_e( 'Count', 'wp-auth0'~~ ); ?></th> |
  | 35 |  | </tr> |
  |  | 29 | <tr> |
  |  | 30 | <th><?php esc\_html\_e('Date', 'wp-auth0'); ?></th> |
  |  | 31 | <th><?php esc\_html\_e('Section', 'wp-auth0'); ?></th> |
  |  | 32 | <th><?php esc\_html\_e('Error code', 'wp-auth0'); ?></th> |
  |  | 33 | <th><?php esc\_html\_e('Message', 'wp-auth0'); ?></th> |
  |  | 34 | <th><?php esc\_html\_e('Count', 'wp-auth0'); ?></th> |
  |  | 35 | </tr> |
  | 36 | 36 | </thead> |
  | 37 | 37 |  |
  | 38 | 38 | <tbody> |
  | 39 |  | ~~<?php if ( empty( $errors )~~ ) : ?> |
  | 40 |  | <tr> |
  | 41 |  | ~~<td class="message" colspan="5"><?php \_e( 'No errors', 'wp-auth0'~~ ); ?></td> |
  | 42 |  | </tr> |
  | 43 |  | <?php else : ?> |
  | 44 |  | <?php |
  | 45 |  | ~~foreach ( $errors as $item~~ ) : |
  |  | 39 | <?php if (empty($errors)) : ?> |
  |  | 40 | <tr> |
  |  | 41 | <td class="message" colspan="5"><?php esc\_html\_e('No errors', 'wp-auth0'); ?></td> |
  |  | 42 | </tr> |
  |  | 43 | <?php else : ?> |
  |  | 44 | <?php |
  |  | 45 | foreach ($errors as $item) : |
  | 46 | 46 | ?> |
  | 47 |  | <tr> |
  | 48 |  | ~~<td><?php echo date( 'm/d/Y H:i:s', $item['date']~~ ); ?></td> |
  | 49 |  | ~~<td><?php echo sanitize\_text\_field( $item['section']~~ ); ?></td> |
  | 50 |  | ~~<td><?php echo sanitize\_text\_field( $item['code']~~ ); ?></td> |
  | 51 |  | ~~<td><?php echo sanitize\_text\_field( $item['message']~~ ); ?></td> |
  | 52 |  | ~~<td><?php echo isset( $item['count'] ) ? intval( $item['count'] ) : 1~~; ?></td> |
  | 53 |  | </tr> |
  | 54 |  | <?php endforeach; ?> |
  | 55 |  | <?php endif; ?> |
  |  | 47 | <tr> |
  |  | 48 | <td><?php esc\_html(date('m/d/Y H:i:s', $item['date'])); ?></td> |
  |  | 49 | <td><?php esc\_html(sanitize\_text\_field($item['section'])); ?></td> |
  |  | 50 | <td><?php esc\_html(sanitize\_text\_field($item['code'])); ?></td> |
  |  | 51 | <td><?php esc\_html(sanitize\_text\_field($item['message'])); ?></td> |
  |  | 52 | <td><?php esc\_html(isset($item['count']) ? intval($item['count']) : 1); ?></td> |
  |  | 53 | </tr> |
  |  | 54 | <?php endforeach; ?> |
  |  | 55 | <?php endif; ?> |
  | 56 | 56 | </tbody> |
  | 57 | 57 | </table> |
* ## [auth0/trunk/templates/a0-widget-setup-form.php](/changeset/3114611/auth0/trunk/templates/a0-widget-setup-form.php "Show the changeset 3114611 restricted to auth0/trunk/templates/a0-widget-setup-form.php")

  | [r2271973](/browser/auth0/trunk/templates/a0-widget-setup-form.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/a0-widget-setup-form.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | $form\_title  = isset(~~$instance['form\_title']~~ ) ? $instance['form\_title'] : ''; |
  | 3 |  | $gravatar    = isset(~~$instance['gravatar']~~ ) ? $instance['gravatar'] : ''; |
  | 4 |  | $icon\_url    = isset(~~$instance['icon\_url']~~ ) ? $instance['icon\_url'] : ''; |
  | 5 |  | $dict        = isset(~~$instance['dict']~~ ) ? $instance['dict'] : ''; |
  | 6 |  | $extra\_conf  = isset(~~$instance['extra\_conf']~~ ) ? $instance['extra\_conf'] : ''; |
  | 7 |  | $redirect\_to = isset(~~$instance['redirect\_to']~~ ) ? $instance['redirect\_to'] : ''; |
  |  | 2 | $form\_title  = isset($instance['form\_title']) ? $instance['form\_title'] : ''; |
  |  | 3 | $gravatar    = isset($instance['gravatar']) ? $instance['gravatar'] : ''; |
  |  | 4 | $icon\_url    = isset($instance['icon\_url']) ? $instance['icon\_url'] : ''; |
  |  | 5 | $dict        = isset($instance['dict']) ? $instance['dict'] : ''; |
  |  | 6 | $extra\_conf  = isset($instance['extra\_conf']) ? $instance['extra\_conf'] : ''; |
  |  | 7 | $redirect\_to = isset($instance['redirect\_to']) ? $instance['redirect\_to'] : ''; |
  | 8 | 8 | ?> |
  | 9 | 9 |  |
  | 10 | 10 | <p> |
  | 11 |  | <strong><?php ~~\_e( 'Note', 'wp-auth0'~~ ); ?></strong> |
  | 12 |  | ~~<?php \_e( 'The login form will not display for logged-in users.', 'wp-auth0'~~ ); ?> |
  |  | 11 | <strong><?php esc\_html\_e('Note', 'wp-auth0'); ?></strong> |
  |  | 12 | <?php esc\_html\_e('The login form will not display for logged-in users.', 'wp-auth0'); ?> |
  | 13 | 13 | </p> |
  | 14 | 14 |  |
  | 15 | 15 | <?php |
  | 16 |  | if (~~$this->showAsModal()~~ ) : |
  | 17 |  | $modal\_trigger\_name = isset(~~$instance['modal\_trigger\_name']~~ ) ? $instance['modal\_trigger\_name'] : ''; |
  | 18 |  | ?> |
  |  | 16 | if ($this->showAsModal()) : |
  |  | 17 | $modal\_trigger\_name = isset($instance['modal\_trigger\_name']) ? $instance['modal\_trigger\_name'] : ''; |
  |  | 18 | ?> |
  | 19 | 19 | <p> |
  | 20 |  | <label for="<?php echo $this->get\_field\_id( 'modal\_trigger\_name' ); ?>"><?php \_e( 'Button text', 'wp-auth0' ); ?></label> |
  | 21 |  | <input class="widefat" id="<?php echo $this->get\_field\_id( 'modal\_trigger\_name' ); ?>" |
  | 22 |  | name="<?php echo $this->get\_field\_name( 'modal\_trigger\_name' ); ?>" |
  | 23 |  | type="text" value="<?php echo esc\_attr( $modal\_trigger\_name ); ?>" /> |
  |  | 20 | <label for="<?php echo esc\_attr($this->get\_field\_id('modal\_trigger\_name')); ?>"><?php esc\_html\_e('Button text', 'wp-auth0'); ?></label> |
  |  | 21 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('modal\_trigger\_name')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('modal\_trigger\_name')) ?>)" type="text" value="<?php echo esc\_attr($modal\_trigger\_name); ?>" /> |
  | 24 | 22 | </p> |
  | 25 | 23 | <?php endif; ?> |
  | 26 | 24 | <p> |
  | 27 |  | <label for="<?php echo $this->get\_field\_id( 'form\_title' ); ?>"><?php \_e( 'Form title:', 'wp-auth0' ); ?></label> |
  | 28 |  | <input class="widefat" id="<?php echo $this->get\_field\_id( 'form\_title' ); ?>" |
  | 29 |  | name="<?php echo $this->get\_field\_name( 'form\_title' ); ?>" |
  | 30 |  | type="text" value="<?php echo esc\_attr( $form\_title ); ?>" /> |
  |  | 25 | <label for="<?php echo esc\_attr($this->get\_field\_id('form\_title')); ?>"><?php esc\_html\_e('Form title:', 'wp-auth0'); ?></label> |
  |  | 26 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('form\_title')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('form\_title')); ?>" type="text" value="<?php echo esc\_attr($form\_title); ?>" /> |
  | 31 | 27 | </p> |
  | 32 | 28 | <p> |
  | 33 |  | <label for="<?php echo $this->get\_field\_id( 'redirect\_to' ); ?>"><?php \_e( 'Redirect after login:', 'wp-auth0' ); ?></label> |
  | 34 |  | <input class="widefat" id="<?php echo $this->get\_field\_id( 'redirect\_to' ); ?>" |
  | 35 |  | name="<?php echo $this->get\_field\_name( 'redirect\_to' ); ?>" |
  | 36 |  | type="text" value="<?php echo esc\_attr( $redirect\_to ); ?>" /> |
  |  | 29 | <label for="<?php echo esc\_attr($this->get\_field\_id('redirect\_to')); ?>"><?php esc\_html\_e('Redirect after login:', 'wp-auth0'); ?></label> |
  |  | 30 | <input class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('redirect\_to')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('redirect\_to')); ?>" type="text" value="<?php echo esc\_attr($redirect\_to); ?>" /> |
  | 37 | 31 | </p> |
  | 38 | 32 | <p> |
  | 39 |  | <label><?php ~~\_e( 'Enable Gravatar Integration', 'wp-auth0'~~ ); ?></label> |
  |  | 33 | <label><?php esc\_html\_e('Enable Gravatar Integration', 'wp-auth0'); ?></label> |
  | 40 | 34 | <br> |
  | 41 |  | <div class="radio-wrapper"> |
  | 42 |  | <input id="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_yes" |
  | 43 |  | name="<?php echo $this->get\_field\_name( 'gravatar' ); ?>" |
  | 44 |  | type="radio" value="1" <?php echo $gravatar == 1 ? 'checked="true"' : ''; ?> /> |
  | 45 |  | <label for="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_yes"><?php \_e( 'Yes', 'wp-auth0' ); ?></label> |
  | 46 |  | &nbsp; |
  | 47 |  | <input id="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_no" |
  | 48 |  | name="<?php echo $this->get\_field\_name( 'gravatar' ); ?>" |
  | 49 |  | type="radio" value="0" <?php echo $gravatar == 0 ? 'checked="true"' : ''; ?> /> |
  | 50 |  | <label for="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_no"><?php \_e( 'No', 'wp-auth0' ); ?></label> |
  | 51 |  | &nbsp; |
  | 52 |  | <input id="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_inherit" |
  | 53 |  | name="<?php echo $this->get\_field\_name( 'gravatar' ); ?>" |
  | 54 |  | type="radio" value="" <?php echo $gravatar === '' ? 'checked="true"' : ''; ?> /> |
  | 55 |  | <label for="<?php echo $this->get\_field\_id( 'gravatar' ); ?>\_inherit"><?php \_e( 'Default Setting', 'wp-auth0' ); ?></label> |
  | 56 |  | </div> |
  |  | 35 | <div class="radio-wrapper"> |
  |  | 36 | <input id="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_yes" name="<?php echo esc\_attr($this->get\_field\_name('gravatar')); ?>" type="radio" value="1" <?php echo $gravatar == 1 ? 'checked="true"' : ''; ?> /> |
  |  | 37 | <label for="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_yes"><?php esc\_html\_e('Yes', 'wp-auth0'); ?></label> |
  |  | 38 | &nbsp; |
  |  | 39 | <input id="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_no" name="<?php echo esc\_attr($this->get\_field\_name('gravatar')); ?>" type="radio" value="0" <?php echo $gravatar == 0 ? 'checked="true"' : ''; ?> /> |
  |  | 40 | <label for="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_no"><?php esc\_html\_e('No', 'wp-auth0'); ?></label> |
  |  | 41 | &nbsp; |
  |  | 42 | <input id="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_inherit" name="<?php echo esc\_attr($this->get\_field\_name('gravatar')); ?>" type="radio" value="" <?php echo $gravatar === '' ? 'checked="true"' : ''; ?> /> |
  |  | 43 | <label for="<?php echo esc\_attr($this->get\_field\_id('gravatar')); ?>\_inherit"><?php esc\_html\_e('Default Setting', 'wp-auth0'); ?></label> |
  |  | 44 | </div> |
  | 57 | 45 |  |
  | 58 | 46 | </p> |
  | 59 | 47 | <p> |
  | 60 |  | <label for="<?php echo $this->get\_field\_id( 'icon\_url' ); ?>"><?php \_e( 'Icon URL:', 'wp-auth0' ); ?></label> |
  | 61 |  | <input type="text" id="<?php echo $this->get\_field\_id( 'icon\_url' ); ?>" |
  | 62 |  | name="<?php echo $this->get\_field\_name( 'icon\_url' ); ?>" |
  | 63 |  | value="<?php echo esc\_attr( $icon\_url ); ?>"/> |
  | 64 |  | <a href="javascript:void(0);" id="wpa0\_choose\_icon" |
  | 65 |  | related="<?php echo $this->get\_field\_id( 'icon\_url' ); ?>" |
  | 66 |  | class="button button-secondary"><?php \_e( 'Choose Icon', 'wp-auth0' ); ?></a> |
  | 67 |  | <br><span class="description"><?php \_e( 'This image works best as a PNG with a transparent background less than 120px tall', 'wp-auth0' ); ?>.</span> |
  |  | 48 | <label for="<?php echo esc\_attr($this->get\_field\_id('icon\_url')); ?>"><?php esc\_html\_e('Icon URL:', 'wp-auth0'); ?></label> |
  |  | 49 | <input type="text" id="<?php echo esc\_attr($this->get\_field\_id('icon\_url')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('icon\_url')); ?>" value="<?php echo esc\_attr($icon\_url); ?>" /> |
  |  | 50 | <a href="javascript:void(0);" id="wpa0\_choose\_icon" related="<?php echo esc\_attr($this->get\_field\_id('icon\_url')); ?>" class="button button-secondary"><?php esc\_html('Choose Icon', 'wp-auth0'); ?></a> |
  |  | 51 | <br><span class="description"><?php esc\_html\_e('This image works best as a PNG with a transparent background less than 120px tall', 'wp-auth0'); ?>.</span> |
  | 68 | 52 | </p> |
  | 69 | 53 | <p> |
  | 70 |  | <label for="<?php echo $this->get\_field\_id( 'dict' ); ?>"><?php \_e( 'Translation:', 'wp-auth0' ); ?></label> |
  | 71 |  | <textarea class="widefat" id="<?php echo $this->get\_field\_id( 'dict' ); ?>" |
  | 72 |  | name="<?php echo $this->get\_field\_name( 'dict' ); ?>"><?php echo sanitize\_text\_field( $dict ); ?></textarea> |
  |  | 54 | <label for="<?php echo esc\_attr($this->get\_field\_id('dict')); ?>"><?php esc\_html\_e('Translation:', 'wp-auth0'); ?></label> |
  |  | 55 | <textarea class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('dict')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('dict')); ?>"><?php echo esc\_textarea(sanitize\_text\_field($dict)); ?></textarea> |
  | 73 | 56 | <br><span class="description"> |
  | 74 |  | ~~<?php \_e( 'The languageDictionary parameter for the Auth0 login form. ', 'wp-auth0'~~ ); ?> |
  |  | 57 | <?php esc\_html\_e('The languageDictionary parameter for the Auth0 login form. ', 'wp-auth0'); ?> |
  | 75 | 58 | </span> |
  | 76 | 59 | <br><span class="description"> |
  | 77 |  | <?php |
  | 78 |  | printf( |
  | 79 |  | '<a href="https://github.com/auth0/lock/blob/master/src/i18n/en.js" target="\_blank">%s</a>', |
  | 80 |  | ~~\_\_( 'List of all modifiable options', 'wp-auth0'~~ ) |
  | 81 |  | ); |
  | 82 |  | ?> |
  | 83 |  | </span> |
  |  | 60 | <?php |
  |  | 61 | wp\_kses(sprintf( |
  |  | 62 | '<a href="https://github.com/auth0/lock/blob/master/src/i18n/en.js" target="\_blank">%s</a>', |
  |  | 63 | esc\_html\_\_('List of all modifiable options', 'wp-auth0') |
  |  | 64 | ), ['a' => ['href' => [], 'target' => []]]); |
  |  | 65 | ?> |
  |  | 66 | </span> |
  | 84 | 67 | <br><span class="description"> |
  | 85 |  | <?php |
  | 86 |  | ~~\_e( 'NOTE: This field is deprecated and will be removed in the next major release. ', 'wp-auth0'~~ ); |
  | 87 |  | ~~\_e( 'Use a languageDictionary property the Extra Settings field below to change text.', 'wp-auth0'~~ ); |
  | 88 |  | ?> |
  |  | 68 | <?php |
  |  | 69 | esc\_html\_e('NOTE: This field is deprecated and will be removed in the next major release. ', 'wp-auth0'); |
  |  | 70 | esc\_html\_e('Use a languageDictionary property the Extra Settings field below to change text.', 'wp-auth0'); |
  |  | 71 | ?> |
  | 89 | 72 | </span> |
  | 90 | 73 | </p> |
  | 91 | 74 | <p> |
  | 92 |  | <label for="<?php echo $this->get\_field\_id( 'extra\_conf' ); ?>"><?php \_e( 'Extra Settings', 'wp-auth0' ); ?></label> |
  | 93 |  | <textarea class="widefat" id="<?php echo $this->get\_field\_id( 'extra\_conf' ); ?>" |
  | 94 |  | name="<?php echo $this->get\_field\_name( 'extra\_conf' ); ?>"><?php echo sanitize\_text\_field( $extra\_conf ); ?></textarea> |
  |  | 75 | <label for="<?php echo esc\_attr($this->get\_field\_id('extra\_conf')); ?>"><?php esc\_html\_e('Extra Settings', 'wp-auth0'); ?></label> |
  |  | 76 | <textarea class="widefat" id="<?php echo esc\_attr($this->get\_field\_id('extra\_conf')); ?>" name="<?php echo esc\_attr($this->get\_field\_name('extra\_conf')); ?>"><?php echo esc\_textarea(sanitize\_text\_field($extra\_conf)); ?></textarea> |
  | 95 | 77 | <br><span class="description"> |
  | 96 |  | ~~<?php \_e( 'Valid JSON for Lock options configuration; will override all options set elsewhere.', 'wp-auth0'~~ ); ?> |
  | 97 |  | <a target="\_blank" href="https://auth0.com/docs/libraries/lock/v11/configuration"><?php ~~\_e( 'See options and examples', 'wp-auth0'~~ ); ?></a> |
  | 98 |  | </span> |
  |  | 78 | <?php esc\_html\_e('Valid JSON for Lock options configuration; will override all options set elsewhere.', 'wp-auth0'); ?> |
  |  | 79 | <a target="\_blank" href="https://auth0.com/docs/libraries/lock/v11/configuration"><?php esc\_html\_e('See options and examples', 'wp-auth0'); ?></a> |
  |  | 80 | </span> |
  | 99 | 81 | </p> |
* ## [auth0/trunk/templates/auth0-login-form.php](/changeset/3114611/auth0/trunk/templates/auth0-login-form.php "Show the changeset 3114611 restricted to auth0/trunk/templates/auth0-login-form.php")

  | [r2271973](/browser/auth0/trunk/templates/auth0-login-form.php?rev=2271973#L1 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/auth0-login-form.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | $auth0\_options = WP\_Auth0\_Options::Instance(); |
  | 3 |  | $wle           = $auth0\_options->get(~~'wordpress\_login\_enabled'~~ ); |
  |  | 3 | $wle           = $auth0\_options->get('wordpress\_login\_enabled'); |
  | 4 | 4 | ?> |
  | 5 |  | <div id="form-signin-wrapper" class="auth0-login"> |
  | 6 |  | <div class="form-signin"> |
  | 7 |  | <div id="<?php echo esc\_attr( WPA0\_AUTH0\_LOGIN\_FORM\_ID ); ?>"></div> |
  | 8 |  | <?php if ( 'link' === $wle && function\_exists( 'login\_header' ) ) : ?> |
  | 9 |  | <div id="extra-options"> |
  | 10 |  | <a href="<?php echo wp\_login\_url(); ?>?wle"> |
  | 11 |  | <?php \_e( 'Login with WordPress username', 'wp-auth0' ); ?> |
  | 12 |  | </a> |
  | 13 |  | </div> |
  | 14 |  | <?php endif ?> |
  | 15 |  | </div> |
  |  | 5 | <div id="form-signin-wrapper" class="auth0-login"> |
  |  | 6 | <div class="form-signin"> |
  |  | 7 | <div id="<?php echo esc\_attr(WPA0\_AUTH0\_LOGIN\_FORM\_ID); ?>"></div> |
  |  | 8 | <?php if ('link' === $wle && function\_exists('login\_header')) : ?> |
  |  | 9 | <div id="extra-options"> |
  |  | 10 | <a href="<?php echo esc\_url(wp\_login\_url()); ?>?wle"> |
  |  | 11 | <?php esc\_html\_e('Login with WordPress username', 'wp-auth0'); ?> |
  |  | 12 | </a> |
  |  | 13 | </div> |
  |  | 14 | <?php endif ?> |
  | 16 | 15 | </div> |
  |  | 16 | </div> |
  | 17 | 17 |  |
  | 18 |  | <style type="text/css"> |
  | 19 |  | ~~<?php echo apply\_filters( 'auth0\_login\_css', ''~~ ); ?> |
  | 20 |  | </style> |
  |  | 18 | <style type="text/css"> |
  |  | 19 | <?php echo esc\_html(apply\_filters('auth0\_login\_css', '')); ?> |
  |  | 20 | </style> |
* ## [auth0/trunk/templates/import\_settings.php](/changeset/3114611/auth0/trunk/templates/import_settings.php "Show the changeset 3114611 restricted to auth0/trunk/templates/import_settings.php")

  | [r2271973](/browser/auth0/trunk/templates/import_settings.php?rev=2271973#L5 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/import_settings.php?rev=3114611#L5 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | <div class="a0-wrap settings wrap"> |
  | 6 | 6 |  |
  | 7 |  | <div class="container-fluid"> |
  |  | 7 | <div class="container-fluid"> |
  | 8 | 8 |  |
  | 9 |  | ~~<h1><?php \_e( 'Import and Export Settings', 'wp-auth0'~~ ); ?></h1> |
  |  | 9 | <h1><?php esc\_html\_e('Import and Export Settings', 'wp-auth0'); ?></h1> |
  | 10 | 10 |  |
  | 11 |  | <p class="a0-step-text top-margin"> |
  | 12 |  | <?php ~~\_e( 'You can import and export your Auth0 WordPress plugin settings here. ', 'wp-auth0'~~ ); ?> |
  | 13 |  | <?php ~~\_e( 'This allows you to either backup the data, or to move your settings to a new WordPress instance.', 'wp-auth0'~~ ); ?> |
  |  | 11 | <p class="a0-step-text top-margin"> |
  |  | 12 | <?php esc\_html\_e('You can import and export your Auth0 WordPress plugin settings here. ', 'wp-auth0'); ?> |
  |  | 13 | <?php esc\_html\_e('This allows you to either backup the data, or to move your settings to a new WordPress instance.', 'wp-auth0'); ?> |
  | 14 | 14 | </p> |
  | 15 |  | <?php if (~~! empty( $constant\_keys )~~ ) : ?> |
  |  | 15 | <?php if (!empty($constant\_keys)) : ?> |
  | 16 | 16 | <p class="a0-step-text top-margin no-bottom-margin"> |
  | 17 |  | <strong><?php ~~\_e( 'Please note:', 'wp-auth0'~~ ); ?></strong> |
  | 18 |  | <?php ~~\_e( 'Settings stored in constants cannot be exported or imported.', 'wp-auth0'~~ ); ?> |
  |  | 17 | <strong><?php esc\_html\_e('Please note:', 'wp-auth0'); ?></strong> |
  |  | 18 | <?php esc\_html\_e('Settings stored in constants cannot be exported or imported.', 'wp-auth0'); ?> |
  | 19 | 19 | </p> |
  | 20 | 20 | <?php endif; ?> |
  | 21 | 21 |  |
  | 22 |  | <p class="nav-tabs"> |
  | 23 |  | ~~<a id="tab-import" href="#import" class="js-a0-import-export-tabs"><?php \_e( 'Import Settings', 'wp-auth0'~~ ); ?></a> |
  | 24 |  | ~~<a id="tab-export" href="#export" class="js-a0-import-export-tabs"><?php \_e( 'Export Settings', 'wp-auth0'~~ ); ?></a> |
  | 25 |  | </p> |
  |  | 22 | <p class="nav-tabs"> |
  |  | 23 | <a id="tab-import" href="#import" class="js-a0-import-export-tabs"><?php esc\_html\_e('Import Settings', 'wp-auth0'); ?></a> |
  |  | 24 | <a id="tab-export" href="#export" class="js-a0-import-export-tabs"><?php esc\_html\_e('Export Settings', 'wp-auth0'); ?></a> |
  |  | 25 | </p> |
  | 26 | 26 |  |
  | 27 | 27 | <div class="tab-pane" id="panel-import" style="display: block"> |
  | 28 | 28 |  |
  | 29 |  | <form action="options.php" method="post" enctype="multipart/form-data"> |
  | 30 |  | <input type="hidden" name="action" value="wpauth0\_import\_settings" /> |
  | 31 |  | ~~<?php wp\_nonce\_field( WP\_Auth0\_Import\_Settings::IMPORT\_NONCE\_ACTION~~ ); ?> |
  | 32 |  | <p class="a0-step-text top-margin"> |
  | 33 |  | <?php |
  | 34 |  | ~~\_e( 'Paste the settings JSON in the field below. ', 'wp-auth0'~~ ); |
  | 35 |  | ~~\_e( 'Settings that are not in the imported JSON will use existing values. ', 'wp-auth0'~~ ); |
  | 36 |  | ~~\_e( 'Setting values will be validated so check the final values once import is complete. ', 'wp-auth0'~~ ); |
  | 37 |  | ?> |
  | 38 |  | <div class="a0-step-text top-margin"><textarea name="settings-json" class="large-text code" rows="6"></textarea></div> |
  |  | 29 | <form action="options.php" method="post" enctype="multipart/form-data"> |
  |  | 30 | <input type="hidden" name="action" value="wpauth0\_import\_settings" /> |
  |  | 31 | <?php wp\_nonce\_field(WP\_Auth0\_Import\_Settings::IMPORT\_NONCE\_ACTION); ?> |
  |  | 32 | <p class="a0-step-text top-margin"> |
  |  | 33 | <?php |
  |  | 34 | esc\_html\_e('Paste the settings JSON in the field below. ', 'wp-auth0'); |
  |  | 35 | esc\_html\_e('Settings that are not in the imported JSON will use existing values. ', 'wp-auth0'); |
  |  | 36 | esc\_html\_e('Setting values will be validated so check the final values once import is complete. ', 'wp-auth0'); |
  |  | 37 | ?> |
  |  | 38 | <div class="a0-step-text top-margin"><textarea name="settings-json" class="large-text code" rows="6"></textarea></div> |
  | 39 | 39 |  |
  | 40 |  | <div class="a0-buttons"> |
  | 41 |  | ~~<input type="submit" name="setup" class="abutton button-primary" value="<?php \_e( 'Import', 'wp-auth0'~~ ); ?>" /> |
  | 42 |  | </div> |
  |  | 40 | <div class="a0-buttons"> |
  |  | 41 | <input type="submit" name="setup" class="abutton button-primary" value="<?php esc\_html\_e('Import', 'wp-auth0'); ?>" /> |
  |  | 42 | </div> |
  | 43 | 43 |  |
  | 44 |  | </form> |
  |  | 44 | </form> |
  | 45 | 45 |  |
  | 46 | 46 | </div> |
  | 47 | 47 | <div class="tab-pane" id="panel-export" style="display: none"> |
  | 48 | 48 |  |
  | 49 |  | <form action="options.php" method="post"> |
  | 50 |  | <?php wp\_nonce\_field(~~WP\_Auth0\_Import\_Settings::EXPORT\_NONCE\_ACTION~~ ); ?> |
  |  | 49 | <form action="options.php" method="post"> |
  |  | 50 | <?php wp\_nonce\_field(WP\_Auth0\_Import\_Settings::EXPORT\_NONCE\_ACTION); ?> |
  | 51 | 51 | <input type="hidden" name="action" value="wpauth0\_export\_settings" /> |
  | 52 | 52 |  |
  | 53 |  | ~~<p class="a0-step-text top-margin"><?php \_e( 'Download the entire plugin configuration.', 'wp-auth0'~~ ); ?></p> |
  |  | 53 | <p class="a0-step-text top-margin"><?php esc\_html\_e('Download the entire plugin configuration.', 'wp-auth0'); ?></p> |
  | 54 | 54 |  |
  | 55 |  | <div class="a0-buttons"> |
  | 56 |  | ~~<input type="submit" name="setup" class="button button-primary" value="<?php \_e( 'Export', 'wp-auth0'~~ ); ?>" /> |
  | 57 |  | </div> |
  |  | 55 | <div class="a0-buttons"> |
  |  | 56 | <input type="submit" name="setup" class="button button-primary" value="<?php esc\_html\_e('Export', 'wp-auth0'); ?>" /> |
  |  | 57 | </div> |
  | 58 | 58 |  |
  | 59 |  | </form> |
  |  | 59 | </form> |
  | 60 | 60 |  |
  | 61 | 61 | </div> |
  | 62 | 62 |  |
  | 63 |  | </div> |
  |  | 63 | </div> |
  | 64 | 64 |  |
  | 65 | 65 | </div> |
* ## [auth0/trunk/templates/login-interim.php](/changeset/3114611/auth0/trunk/templates/login-interim.php "Show the changeset 3114611 restricted to auth0/trunk/templates/login-interim.php")

  | [r1924242](/browser/auth0/trunk/templates/login-interim.php?rev=1924242#L1 "Show revision 1924242 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/login-interim.php?rev=3114611#L1 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <!DOCTYPE html> |
  | 2 |  | <!--[if IE 8]> |
  |  | 2 | <!--[if IE 8]> |
  | 3 | 3 | <html xmlns="http://www.w3.org/1999/xhtml" class="ie8" <?php language\_attributes(); ?>> |
  | 4 | 4 | <![endif]--> |
  | 5 |  | <!--[if !(IE 8) ]><!--> |
  | 6 |  | <html xmlns="http://www.w3.org/1999/xhtml" <?php language\_attributes(); ?>> |
  | 7 |  | <!--<![endif]--> |
  | 8 |  | <body class="login interim-login-success"> |
  | 9 |  | <?php \_e( 'You are connected', 'wp-auth0' ); ?> |
  | 10 |  | </body> |
  |  | 5 | <!--[if !(IE 8) ]><!--> |
  |  | 6 | <html xmlns="http://www.w3.org/1999/xhtml" <?php language\_attributes(); ?>> |
  |  | 7 | <!--<![endif]--> |
  |  | 8 |  |
  |  | 9 | <body class="login interim-login-success"> |
  |  | 10 | <?php esc\_html\_e('You are connected', 'wp-auth0'); ?> |
  |  | 11 | </body> |
  |  | 12 |  |
  | 11 | 13 | </html> |
* ## [auth0/trunk/templates/settings.php](/changeset/3114611/auth0/trunk/templates/settings.php "Show the changeset 3114611 restricted to auth0/trunk/templates/settings.php")

  | [r2271973](/browser/auth0/trunk/templates/settings.php?rev=2271973#L3 "Show revision 2271973 of this file in browser") | [r3114611](/browser/auth0/trunk/templates/settings.php?rev=3114611#L3 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | <div class="container-fluid"> |
  | 4 | 4 |  |
  | 5 |  | ~~<h1><?php \_e( 'Login by Auth0 Settings', 'wp-auth0'~~ ); ?></h1> |
  |  | 5 | <h1><?php esc\_html\_e('Login by Auth0 Settings', 'wp-auth0'); ?></h1> |
  | 6 | 6 |  |
  | 7 |  | <?php settings\_errors(); ?> |
  |  | 7 | <?php settings\_errors(); ?> |
  | 8 | 8 |  |
  | 9 |  | <p class="nav nav-tabs" role="tablist"> |
  | 10 |  | <a id="tab-basic" href="#basic" class="js-a0-settings-tabs"> |
  | 11 |  | ~~<?php \_e( 'Basic', 'wp-auth0'~~ ); ?> |
  | 12 |  | </a> |
  | 13 |  | <a id="tab-features" href="#features" class="js-a0-settings-tabs"> |
  | 14 |  | ~~<?php \_e( 'Features', 'wp-auth0'~~ ); ?> |
  | 15 |  | </a> |
  | 16 |  | <a id="tab-appearance" href="#appearance" class="js-a0-settings-tabs"> |
  | 17 |  | ~~<?php \_e( 'Embedded', 'wp-auth0'~~ ); ?> |
  | 18 |  | </a> |
  | 19 |  | <a id="tab-advanced" href="#advanced" class="js-a0-settings-tabs"> |
  | 20 |  | ~~<?php \_e( 'Advanced', 'wp-auth0'~~ ); ?> |
  | 21 |  | </a> |
  | 22 |  | <a id="tab-help" href="#help" class="js-a0-settings-tabs"> |
  | 23 |  | ~~<?php \_e( 'Help', 'wp-auth0'~~ ); ?> |
  | 24 |  | </a> |
  | 25 |  | </p> |
  |  | 9 | <p class="nav nav-tabs" role="tablist"> |
  |  | 10 | <a id="tab-basic" href="#basic" class="js-a0-settings-tabs"> |
  |  | 11 | <?php esc\_html\_e('Basic', 'wp-auth0'); ?> |
  |  | 12 | </a> |
  |  | 13 | <a id="tab-features" href="#features" class="js-a0-settings-tabs"> |
  |  | 14 | <?php esc\_html\_e('Features', 'wp-auth0'); ?> |
  |  | 15 | </a> |
  |  | 16 | <a id="tab-appearance" href="#appearance" class="js-a0-settings-tabs"> |
  |  | 17 | <?php esc\_html\_e('Embedded', 'wp-auth0'); ?> |
  |  | 18 | </a> |
  |  | 19 | <a id="tab-advanced" href="#advanced" class="js-a0-settings-tabs"> |
  |  | 20 | <?php esc\_html\_e('Advanced', 'wp-auth0'); ?> |
  |  | 21 | </a> |
  |  | 22 | <a id="tab-help" href="#help" class="js-a0-settings-tabs"> |
  |  | 23 | <?php esc\_html\_e('Help', 'wp-auth0'); ?> |
  |  | 24 | </a> |
  |  | 25 | </p> |
  | 26 | 26 |  |
  | 27 | 27 | <form action="options.php" method="post" id="js-a0-settings-form" class="a0-settings-form"> |
  | 28 |  | <?php settings\_fields(~~WP\_Auth0\_Options::Instance()->get\_options\_name() . '\_basic'~~ ); ?> |
  |  | 28 | <?php settings\_fields(WP\_Auth0\_Options::Instance()->get\_options\_name() . '\_basic'); ?> |
  | 29 | 29 |  |
  | 30 | 30 | <div class="tab-content"> |
  | 31 |  | <?php foreach (~~WP\_Auth0\_Admin::OPT\_SECTIONS as $tab~~ ) : ?> |
  | 32 |  | <div class="tab-pane" id="panel-<?php echo ~~$tab~~; ?>"> |
  | 33 |  | <?php do\_settings\_sections(~~WP\_Auth0\_Options::Instance()->get\_options\_name() . '\_' . $tab~~ ); ?> |
  |  | 31 | <?php foreach (WP\_Auth0\_Admin::OPT\_SECTIONS as $tab) : ?> |
  |  | 32 | <div class="tab-pane" id="panel-<?php echo esc\_attr($tab); ?>"> |
  |  | 33 | <?php do\_settings\_sections(WP\_Auth0\_Options::Instance()->get\_options\_name() . '\_' . $tab); ?> |
  | 34 | 34 | </div> |
  | 35 | 35 | <?php endforeach; ?> |
  | […](/browser/auth0/trunk/templates/settings.php?rev=2271973#L39) | […](/browser/auth0/trunk/templates/settings.php?rev=3114611#L39) |  |
  | 39 | 39 | <p> |
  | 40 | 40 | <?php |
  | 41 |  | ~~\_e( 'Thank you for installing Login by Auth0! Auth0 is a powerful identity solution that secures billions of logins every month. In addition to the options here, there are many more features available in the', 'wp-auth0'~~ ); |
  |  | 41 | esc\_html\_e('Thank you for installing Login by Auth0! Auth0 is a powerful identity solution that secures billions of logins every month. In addition to the options here, there are many more features available in the', 'wp-auth0'); |
  | 42 | 42 | ?> |
  | 43 |  | <a href="https://manage.auth0.com" target="\_blank"><?php ~~\_e( 'Auth0 dashboard', 'wp-auth0'~~ ); ?></a> |
  | 44 |  | <?php ~~\_e( 'including:', 'wp-auth0'~~ ); ?> |
  |  | 43 | <a href="https://manage.auth0.com" target="\_blank"><?php esc\_html\_e('Auth0 dashboard', 'wp-auth0'); ?></a> |
  |  | 44 | <?php esc\_html\_e('including:', 'wp-auth0'); ?> |
  | 45 | 45 | </p> |
  | 46 | 46 |  |
  | […](/browser/auth0/trunk/templates/settings.php?rev=2271973#L48) | […](/browser/auth0/trunk/templates/settings.php?rev=3114611#L48) |  |
  | 48 | 48 | <li><a href="https://auth0.com/docs/identityproviders" target="\_blank"> |
  | 49 | 49 | <?php |
  | 50 |  | ~~\_e( 'Many social and enterprise login connections', 'wp-auth0'~~ ) |
  |  | 50 | esc\_html\_e('Many social and enterprise login connections', 'wp-auth0') |
  | 51 | 51 | ?> |
  | 52 | 52 | </a></li> |
  | 53 | 53 | <li><a href="https://auth0.com/docs/connections/passwordless" target="\_blank"> |
  | 54 | 54 | <?php |
  | 55 |  | ~~\_e( 'Passwordless login connections', 'wp-auth0'~~ ); |
  |  | 55 | esc\_html\_e('Passwordless login connections', 'wp-auth0'); |
  | 56 | 56 | ?> |
  | 57 | 57 | </a></li> |
  | 58 | 58 | <li><a href="https://auth0.com/docs/anomaly-detection" target="\_blank"> |
  | 59 | 59 | <?php |
  | 60 |  | ~~\_e( 'Anomaly detection', 'wp-auth0'~~ ); |
  |  | 60 | esc\_html\_e('Anomaly detection', 'wp-auth0'); |
  | 61 | 61 | ?> |
  | 62 | 62 | </a></li> |
  | 63 | 63 | <li><a href="https://auth0.com/docs/rules/current" target="\_blank"> |
  | 64 | 64 | <?php |
  | 65 |  | ~~\_e( 'Profile enrichment, integrations, and other custom management tasks using Rules', 'wp-auth0'~~ ); |
  |  | 65 | esc\_html\_e('Profile enrichment, integrations, and other custom management tasks using Rules', 'wp-auth0'); |
  | 66 | 66 | ?> |
  | 67 | 67 | </a></li> |
  | 68 | 68 | </ul> |
  | 69 | 69 |  |
  | 70 |  | <p><?php \_e( 'If you have issues or questions, we provide a variety of channels to assist:', 'wp-auth0' ); ?><p> |
  |  | 70 | <p><?php esc\_html\_e('If you have issues or questions, we provide a variety of channels to assist:', 'wp-auth0'); ?> |
  |  | 71 | <p> |
  | 71 | 72 |  |
  | 72 | 73 | <ul class="list"> |
  | 73 | 74 | <li><a href="https://auth0.com/docs/cms/wordpress/configuration" target="\_blank"> |
  | 74 | 75 | <?php |
  | 75 |  | ~~\_e( 'Configuration documentation', 'wp-auth0'~~ ) |
  |  | 76 | esc\_html\_e('Configuration documentation', 'wp-auth0') |
  | 76 | 77 | ?> |
  | 77 | 78 | </a> - |
  | 78 | 79 | <?php |
  | 79 |  | ~~\_e( 'If you are setting up the plugin for the first time or having issues after an upgrade, please review the settings to make sure your Application is setup correctly.', 'wp-auth0'~~ ) |
  |  | 80 | esc\_html\_e('If you are setting up the plugin for the first time or having issues after an upgrade, please review the settings to make sure your Application is setup correctly.', 'wp-auth0') |
  | 80 | 81 | ?> |
  | 81 | 82 | </li> |
  | 82 | 83 | <li><a href="https://community.auth0.com/tags/wordpress" target="\_blank"> |
  | 83 | 84 | <?php |
  | 84 |  | ~~\_e( 'Auth0 Community', 'wp-auth0'~~ ) |
  |  | 85 | esc\_html\_e('Auth0 Community', 'wp-auth0') |
  | 85 | 86 | ?> |
  | 86 | 87 | </a> - |
  | 87 | 88 | <?php |
  | 88 |  | ~~\_e( 'If you have questions about how to use Auth0 or the plugin, please create a post (tagged "WordPress") if you do not find what you are looking for.', 'wp-auth0'~~ ) |
  |  | 89 | esc\_html\_e('If you have questions about how to use Auth0 or the plugin, please create a post (tagged "WordPress") if you do not find what you are looking for.', 'wp-auth0') |
  | 89 | 90 | ?> |
  | 90 | 91 | </li> |
  | 91 |  | <li><a href="https://github.com/auth0/wp-auth0/issues" target="\_blank"><?php ~~\_e( 'GitHub Issues', 'wp-auth0'~~ ); ?></a> - |
  | 92 |  | <?php ~~\_e( 'If you find a bug in the plugin code, the best place to report that is on GitHub under the Issues tab.', 'wp-auth0'~~ ); ?> |
  |  | 92 | <li><a href="https://github.com/auth0/wp-auth0/issues" target="\_blank"><?php esc\_html\_e('GitHub Issues', 'wp-auth0'); ?></a> - |
  |  | 93 | <?php esc\_html\_e('If you find a bug in the plugin code, the best place to report that is on GitHub under the Issues tab.', 'wp-auth0'); ?> |
  | 93 | 94 | </li> |
  | 94 |  | <li><a href="https://support.auth0.com/" target="\_blank"><?php ~~\_e( 'Support', 'wp-auth0'~~ ); ?></a> - |
  | 95 |  | <?php ~~\_e( 'Customers on a paid Auth0 plan can submit trouble tickets for a quick response.', 'wp-auth0'~~ ); ?> |
  |  | 95 | <li><a href="https://support.auth0.com/" target="\_blank"><?php esc\_html\_e('Support', 'wp-auth0'); ?></a> - |
  |  | 96 | <?php esc\_html\_e('Customers on a paid Auth0 plan can submit trouble tickets for a quick response.', 'wp-auth0'); ?> |
  | 96 | 97 | </li> |
  | 97 | 98 | </ul> |
  | […](/browser/auth0/trunk/templates/settings.php?rev=2271973#L99) | […](/browser/auth0/trunk/templates/settings.php?rev=3114611#L100) |  |
  | 99 | 100 | </div> |
  | 100 | 101 |  |
  | 101 |  | <div class="a0-buttons"> |
  | 102 |  | ~~<input type="submit" name="submit" id="submit" class="button button-primary" value="<?php \_e( 'Save Changes', 'wp-auth0'~~ ); ?>" /> |
  | 103 |  | </div> |
  |  | 102 | <div class="a0-buttons"> |
  |  | 103 | <input type="submit" name="submit" id="submit" class="button button-primary" value="<?php esc\_html\_e('Save Changes', 'wp-auth0'); ?>" /> |
  |  | 104 | </div> |
  | 104 | 105 | </form> |
  | 105 | 106 | </div> |
* ## [auth0/trunk/vendor/autoload.php](/changeset/3114611/auth0/trunk/vendor/autoload.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/autoload.php")

  | [r3020639](/browser/auth0/trunk/vendor/autoload.php?rev=3020639#L23 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/autoload.php?rev=3114611#L23 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 23 | 23 | require\_once \_\_DIR\_\_ . '/composer/autoload\_real.php'; |
  | 24 | 24 |  |
  | 25 |  | return ComposerAutoloaderInit~~009510a0cb14a6de09e9782737046128~~::getLoader(); |
  |  | 25 | return ComposerAutoloaderInitc024eb8bfb084eaadf8e78574a7bdf49::getLoader(); |
* ## [auth0/trunk/vendor/composer/autoload\_classmap.php](/changeset/3114611/auth0/trunk/vendor/composer/autoload_classmap.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/autoload_classmap.php")

  | [r3020639](/browser/auth0/trunk/vendor/composer/autoload_classmap.php?rev=3020639#L8 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/autoload_classmap.php?rev=3114611#L8 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | return array( |
  | 9 | 9 | 'Composer\\InstalledVersions' => $vendorDir . '/composer/InstalledVersions.php', |
  |  | 10 | 'Composer\\Installers\\AglInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/AglInstaller.php', |
  |  | 11 | 'Composer\\Installers\\AkauntingInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/AkauntingInstaller.php', |
  |  | 12 | 'Composer\\Installers\\AnnotateCmsInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/AnnotateCmsInstaller.php', |
  |  | 13 | 'Composer\\Installers\\AsgardInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/AsgardInstaller.php', |
  |  | 14 | 'Composer\\Installers\\AttogramInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/AttogramInstaller.php', |
  |  | 15 | 'Composer\\Installers\\BaseInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/BaseInstaller.php', |
  |  | 16 | 'Composer\\Installers\\BitrixInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/BitrixInstaller.php', |
  |  | 17 | 'Composer\\Installers\\BonefishInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/BonefishInstaller.php', |
  |  | 18 | 'Composer\\Installers\\BotbleInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/BotbleInstaller.php', |
  |  | 19 | 'Composer\\Installers\\CakePHPInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/CakePHPInstaller.php', |
  |  | 20 | 'Composer\\Installers\\ChefInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ChefInstaller.php', |
  |  | 21 | 'Composer\\Installers\\CiviCrmInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/CiviCrmInstaller.php', |
  |  | 22 | 'Composer\\Installers\\ClanCatsFrameworkInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ClanCatsFrameworkInstaller.php', |
  |  | 23 | 'Composer\\Installers\\CockpitInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/CockpitInstaller.php', |
  |  | 24 | 'Composer\\Installers\\CodeIgniterInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/CodeIgniterInstaller.php', |
  |  | 25 | 'Composer\\Installers\\Concrete5Installer' => $vendorDir . '/composer/installers/src/Composer/Installers/Concrete5Installer.php', |
  |  | 26 | 'Composer\\Installers\\ConcreteCMSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ConcreteCMSInstaller.php', |
  |  | 27 | 'Composer\\Installers\\CroogoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/CroogoInstaller.php', |
  |  | 28 | 'Composer\\Installers\\DecibelInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/DecibelInstaller.php', |
  |  | 29 | 'Composer\\Installers\\DframeInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/DframeInstaller.php', |
  |  | 30 | 'Composer\\Installers\\DokuWikiInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/DokuWikiInstaller.php', |
  |  | 31 | 'Composer\\Installers\\DolibarrInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/DolibarrInstaller.php', |
  |  | 32 | 'Composer\\Installers\\DrupalInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/DrupalInstaller.php', |
  |  | 33 | 'Composer\\Installers\\ElggInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ElggInstaller.php', |
  |  | 34 | 'Composer\\Installers\\EliasisInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/EliasisInstaller.php', |
  |  | 35 | 'Composer\\Installers\\ExpressionEngineInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ExpressionEngineInstaller.php', |
  |  | 36 | 'Composer\\Installers\\EzPlatformInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/EzPlatformInstaller.php', |
  |  | 37 | 'Composer\\Installers\\ForkCMSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ForkCMSInstaller.php', |
  |  | 38 | 'Composer\\Installers\\FuelInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/FuelInstaller.php', |
  |  | 39 | 'Composer\\Installers\\FuelphpInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/FuelphpInstaller.php', |
  |  | 40 | 'Composer\\Installers\\GravInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/GravInstaller.php', |
  |  | 41 | 'Composer\\Installers\\HuradInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/HuradInstaller.php', |
  |  | 42 | 'Composer\\Installers\\ImageCMSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ImageCMSInstaller.php', |
  |  | 43 | 'Composer\\Installers\\Installer' => $vendorDir . '/composer/installers/src/Composer/Installers/Installer.php', |
  |  | 44 | 'Composer\\Installers\\ItopInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ItopInstaller.php', |
  |  | 45 | 'Composer\\Installers\\KanboardInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/KanboardInstaller.php', |
  |  | 46 | 'Composer\\Installers\\KnownInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/KnownInstaller.php', |
  |  | 47 | 'Composer\\Installers\\KodiCMSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/KodiCMSInstaller.php', |
  |  | 48 | 'Composer\\Installers\\KohanaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/KohanaInstaller.php', |
  |  | 49 | 'Composer\\Installers\\LanManagementSystemInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/LanManagementSystemInstaller.php', |
  |  | 50 | 'Composer\\Installers\\LaravelInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/LaravelInstaller.php', |
  |  | 51 | 'Composer\\Installers\\LavaLiteInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/LavaLiteInstaller.php', |
  |  | 52 | 'Composer\\Installers\\LithiumInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/LithiumInstaller.php', |
  |  | 53 | 'Composer\\Installers\\MODULEWorkInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MODULEWorkInstaller.php', |
  |  | 54 | 'Composer\\Installers\\MODXEvoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MODXEvoInstaller.php', |
  |  | 55 | 'Composer\\Installers\\MagentoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MagentoInstaller.php', |
  |  | 56 | 'Composer\\Installers\\MajimaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MajimaInstaller.php', |
  |  | 57 | 'Composer\\Installers\\MakoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MakoInstaller.php', |
  |  | 58 | 'Composer\\Installers\\MantisBTInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MantisBTInstaller.php', |
  |  | 59 | 'Composer\\Installers\\MatomoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MatomoInstaller.php', |
  |  | 60 | 'Composer\\Installers\\MauticInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MauticInstaller.php', |
  |  | 61 | 'Composer\\Installers\\MayaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MayaInstaller.php', |
  |  | 62 | 'Composer\\Installers\\MediaWikiInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MediaWikiInstaller.php', |
  |  | 63 | 'Composer\\Installers\\MiaoxingInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MiaoxingInstaller.php', |
  |  | 64 | 'Composer\\Installers\\MicroweberInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MicroweberInstaller.php', |
  |  | 65 | 'Composer\\Installers\\ModxInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ModxInstaller.php', |
  |  | 66 | 'Composer\\Installers\\MoodleInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/MoodleInstaller.php', |
  |  | 67 | 'Composer\\Installers\\OctoberInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/OctoberInstaller.php', |
  |  | 68 | 'Composer\\Installers\\OntoWikiInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/OntoWikiInstaller.php', |
  |  | 69 | 'Composer\\Installers\\OsclassInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/OsclassInstaller.php', |
  |  | 70 | 'Composer\\Installers\\OxidInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/OxidInstaller.php', |
  |  | 71 | 'Composer\\Installers\\PPIInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PPIInstaller.php', |
  |  | 72 | 'Composer\\Installers\\PantheonInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PantheonInstaller.php', |
  |  | 73 | 'Composer\\Installers\\PhiftyInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PhiftyInstaller.php', |
  |  | 74 | 'Composer\\Installers\\PhpBBInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PhpBBInstaller.php', |
  |  | 75 | 'Composer\\Installers\\PiwikInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PiwikInstaller.php', |
  |  | 76 | 'Composer\\Installers\\PlentymarketsInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PlentymarketsInstaller.php', |
  |  | 77 | 'Composer\\Installers\\Plugin' => $vendorDir . '/composer/installers/src/Composer/Installers/Plugin.php', |
  |  | 78 | 'Composer\\Installers\\PortoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PortoInstaller.php', |
  |  | 79 | 'Composer\\Installers\\PrestashopInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PrestashopInstaller.php', |
  |  | 80 | 'Composer\\Installers\\ProcessWireInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ProcessWireInstaller.php', |
  |  | 81 | 'Composer\\Installers\\PuppetInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PuppetInstaller.php', |
  |  | 82 | 'Composer\\Installers\\PxcmsInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/PxcmsInstaller.php', |
  |  | 83 | 'Composer\\Installers\\RadPHPInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/RadPHPInstaller.php', |
  |  | 84 | 'Composer\\Installers\\ReIndexInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ReIndexInstaller.php', |
  |  | 85 | 'Composer\\Installers\\Redaxo5Installer' => $vendorDir . '/composer/installers/src/Composer/Installers/Redaxo5Installer.php', |
  |  | 86 | 'Composer\\Installers\\RedaxoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/RedaxoInstaller.php', |
  |  | 87 | 'Composer\\Installers\\RoundcubeInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/RoundcubeInstaller.php', |
  |  | 88 | 'Composer\\Installers\\SMFInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/SMFInstaller.php', |
  |  | 89 | 'Composer\\Installers\\ShopwareInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ShopwareInstaller.php', |
  |  | 90 | 'Composer\\Installers\\SilverStripeInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/SilverStripeInstaller.php', |
  |  | 91 | 'Composer\\Installers\\SiteDirectInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/SiteDirectInstaller.php', |
  |  | 92 | 'Composer\\Installers\\StarbugInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/StarbugInstaller.php', |
  |  | 93 | 'Composer\\Installers\\SyDESInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/SyDESInstaller.php', |
  |  | 94 | 'Composer\\Installers\\SyliusInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/SyliusInstaller.php', |
  |  | 95 | 'Composer\\Installers\\TaoInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/TaoInstaller.php', |
  |  | 96 | 'Composer\\Installers\\TastyIgniterInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/TastyIgniterInstaller.php', |
  |  | 97 | 'Composer\\Installers\\TheliaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/TheliaInstaller.php', |
  |  | 98 | 'Composer\\Installers\\TuskInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/TuskInstaller.php', |
  |  | 99 | 'Composer\\Installers\\UserFrostingInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/UserFrostingInstaller.php', |
  |  | 100 | 'Composer\\Installers\\VanillaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/VanillaInstaller.php', |
  |  | 101 | 'Composer\\Installers\\VgmcpInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/VgmcpInstaller.php', |
  |  | 102 | 'Composer\\Installers\\WHMCSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/WHMCSInstaller.php', |
  |  | 103 | 'Composer\\Installers\\WinterInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/WinterInstaller.php', |
  |  | 104 | 'Composer\\Installers\\WolfCMSInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/WolfCMSInstaller.php', |
  |  | 105 | 'Composer\\Installers\\WordPressInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/WordPressInstaller.php', |
  |  | 106 | 'Composer\\Installers\\YawikInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/YawikInstaller.php', |
  |  | 107 | 'Composer\\Installers\\ZendInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ZendInstaller.php', |
  |  | 108 | 'Composer\\Installers\\ZikulaInstaller' => $vendorDir . '/composer/installers/src/Composer/Installers/ZikulaInstaller.php', |
  | 10 | 109 | 'Lcobucci\\JWT\\Builder' => $vendorDir . '/auth0/php-jwt/src/Builder.php', |
  | 11 | 110 | 'Lcobucci\\JWT\\Claim' => $vendorDir . '/auth0/php-jwt/src/Claim.php', |
* ## [auth0/trunk/vendor/composer/autoload\_psr4.php](/changeset/3114611/auth0/trunk/vendor/composer/autoload_psr4.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/autoload_psr4.php")

  | [r2856828](/browser/auth0/trunk/vendor/composer/autoload_psr4.php?rev=2856828#L8 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/autoload_psr4.php?rev=3114611#L8 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | return array( |
  | 9 | 9 | 'Lcobucci\\JWT\\' => array($vendorDir . '/auth0/php-jwt/src'), |
  |  | 10 | 'Composer\\Installers\\' => array($vendorDir . '/composer/installers/src/Composer/Installers'), |
  | 10 | 11 | ); |
* ## [auth0/trunk/vendor/composer/autoload\_real.php](/changeset/3114611/auth0/trunk/vendor/composer/autoload_real.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/autoload_real.php")

  | [r3020639](/browser/auth0/trunk/vendor/composer/autoload_real.php?rev=3020639#L3 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/autoload_real.php?rev=3114611#L3 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | // autoload\_real.php @generated by Composer |
  | 4 | 4 |  |
  | 5 |  | class ComposerAutoloaderInit~~009510a0cb14a6de09e9782737046128~~ |
  |  | 5 | class ComposerAutoloaderInitc024eb8bfb084eaadf8e78574a7bdf49 |
  | 6 | 6 | { |
  | 7 | 7 | private static $loader; |
  | […](/browser/auth0/trunk/vendor/composer/autoload_real.php?rev=3020639#L25) | […](/browser/auth0/trunk/vendor/composer/autoload_real.php?rev=3114611#L25) |  |
  | 25 | 25 | require \_\_DIR\_\_ . '/platform\_check.php'; |
  | 26 | 26 |  |
  | 27 |  | spl\_autoload\_register(array('ComposerAutoloaderInit~~009510a0cb14a6de09e9782737046128~~', 'loadClassLoader'), true, true); |
  |  | 27 | spl\_autoload\_register(array('ComposerAutoloaderInitc024eb8bfb084eaadf8e78574a7bdf49', 'loadClassLoader'), true, true); |
  | 28 | 28 | self::$loader = $loader = new \Composer\Autoload\ClassLoader(\dirname(\_\_DIR\_\_)); |
  | 29 |  | spl\_autoload\_unregister(array('ComposerAutoloaderInit~~009510a0cb14a6de09e9782737046128~~', 'loadClassLoader')); |
  |  | 29 | spl\_autoload\_unregister(array('ComposerAutoloaderInitc024eb8bfb084eaadf8e78574a7bdf49', 'loadClassLoader')); |
  | 30 | 30 |  |
  | 31 | 31 | require \_\_DIR\_\_ . '/autoload\_static.php'; |
  | 32 |  | call\_user\_func(\Composer\Autoload\ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~::getInitializer($loader)); |
  |  | 32 | call\_user\_func(\Composer\Autoload\ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49::getInitializer($loader)); |
  | 33 | 33 |  |
  | 34 | 34 | $loader->setClassMapAuthoritative(true); |
  | 35 | 35 | $loader->register(true); |
  | 36 | 36 |  |
  | 37 |  | $filesToLoad = \Composer\Autoload\ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~::$files; |
  |  | 37 | $filesToLoad = \Composer\Autoload\ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49::$files; |
  | 38 | 38 | $requireFile = \Closure::bind(static function ($fileIdentifier, $file) { |
  | 39 | 39 | if (empty($GLOBALS['\_\_composer\_autoload\_files'][$fileIdentifier])) { |
* ## [auth0/trunk/vendor/composer/autoload\_static.php](/changeset/3114611/auth0/trunk/vendor/composer/autoload_static.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/autoload_static.php")

  | [r3020639](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3020639#L5 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3114611#L5 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | namespace Composer\Autoload; |
  | 6 | 6 |  |
  | 7 |  | class ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~ |
  |  | 7 | class ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49 |
  | 8 | 8 | { |
  | 9 | 9 | public static $files = array ( |
  | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3020639#L16) | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3114611#L16) |  |
  | 16 | 16 | 'Lcobucci\\JWT\\' => 13, |
  | 17 | 17 | ), |
  |  | 18 | 'C' => |
  |  | 19 | array ( |
  |  | 20 | 'Composer\\Installers\\' => 20, |
  |  | 21 | ), |
  | 18 | 22 | ); |
  | 19 | 23 |  |
  | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3020639#L23) | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3114611#L27) |  |
  | 23 | 27 | 0 => \_\_DIR\_\_ . '/..' . '/auth0/php-jwt/src', |
  | 24 | 28 | ), |
  |  | 29 | 'Composer\\Installers\\' => |
  |  | 30 | array ( |
  |  | 31 | 0 => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers', |
  |  | 32 | ), |
  | 25 | 33 | ); |
  | 26 | 34 |  |
  | 27 | 35 | public static $classMap = array ( |
  | 28 | 36 | 'Composer\\InstalledVersions' => \_\_DIR\_\_ . '/..' . '/composer/InstalledVersions.php', |
  |  | 37 | 'Composer\\Installers\\AglInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/AglInstaller.php', |
  |  | 38 | 'Composer\\Installers\\AkauntingInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/AkauntingInstaller.php', |
  |  | 39 | 'Composer\\Installers\\AnnotateCmsInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/AnnotateCmsInstaller.php', |
  |  | 40 | 'Composer\\Installers\\AsgardInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/AsgardInstaller.php', |
  |  | 41 | 'Composer\\Installers\\AttogramInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/AttogramInstaller.php', |
  |  | 42 | 'Composer\\Installers\\BaseInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/BaseInstaller.php', |
  |  | 43 | 'Composer\\Installers\\BitrixInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/BitrixInstaller.php', |
  |  | 44 | 'Composer\\Installers\\BonefishInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/BonefishInstaller.php', |
  |  | 45 | 'Composer\\Installers\\BotbleInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/BotbleInstaller.php', |
  |  | 46 | 'Composer\\Installers\\CakePHPInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/CakePHPInstaller.php', |
  |  | 47 | 'Composer\\Installers\\ChefInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ChefInstaller.php', |
  |  | 48 | 'Composer\\Installers\\CiviCrmInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/CiviCrmInstaller.php', |
  |  | 49 | 'Composer\\Installers\\ClanCatsFrameworkInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ClanCatsFrameworkInstaller.php', |
  |  | 50 | 'Composer\\Installers\\CockpitInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/CockpitInstaller.php', |
  |  | 51 | 'Composer\\Installers\\CodeIgniterInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/CodeIgniterInstaller.php', |
  |  | 52 | 'Composer\\Installers\\Concrete5Installer' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/Concrete5Installer.php', |
  |  | 53 | 'Composer\\Installers\\ConcreteCMSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ConcreteCMSInstaller.php', |
  |  | 54 | 'Composer\\Installers\\CroogoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/CroogoInstaller.php', |
  |  | 55 | 'Composer\\Installers\\DecibelInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/DecibelInstaller.php', |
  |  | 56 | 'Composer\\Installers\\DframeInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/DframeInstaller.php', |
  |  | 57 | 'Composer\\Installers\\DokuWikiInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/DokuWikiInstaller.php', |
  |  | 58 | 'Composer\\Installers\\DolibarrInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/DolibarrInstaller.php', |
  |  | 59 | 'Composer\\Installers\\DrupalInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/DrupalInstaller.php', |
  |  | 60 | 'Composer\\Installers\\ElggInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ElggInstaller.php', |
  |  | 61 | 'Composer\\Installers\\EliasisInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/EliasisInstaller.php', |
  |  | 62 | 'Composer\\Installers\\ExpressionEngineInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ExpressionEngineInstaller.php', |
  |  | 63 | 'Composer\\Installers\\EzPlatformInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/EzPlatformInstaller.php', |
  |  | 64 | 'Composer\\Installers\\ForkCMSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ForkCMSInstaller.php', |
  |  | 65 | 'Composer\\Installers\\FuelInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/FuelInstaller.php', |
  |  | 66 | 'Composer\\Installers\\FuelphpInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/FuelphpInstaller.php', |
  |  | 67 | 'Composer\\Installers\\GravInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/GravInstaller.php', |
  |  | 68 | 'Composer\\Installers\\HuradInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/HuradInstaller.php', |
  |  | 69 | 'Composer\\Installers\\ImageCMSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ImageCMSInstaller.php', |
  |  | 70 | 'Composer\\Installers\\Installer' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/Installer.php', |
  |  | 71 | 'Composer\\Installers\\ItopInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ItopInstaller.php', |
  |  | 72 | 'Composer\\Installers\\KanboardInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/KanboardInstaller.php', |
  |  | 73 | 'Composer\\Installers\\KnownInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/KnownInstaller.php', |
  |  | 74 | 'Composer\\Installers\\KodiCMSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/KodiCMSInstaller.php', |
  |  | 75 | 'Composer\\Installers\\KohanaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/KohanaInstaller.php', |
  |  | 76 | 'Composer\\Installers\\LanManagementSystemInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/LanManagementSystemInstaller.php', |
  |  | 77 | 'Composer\\Installers\\LaravelInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/LaravelInstaller.php', |
  |  | 78 | 'Composer\\Installers\\LavaLiteInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/LavaLiteInstaller.php', |
  |  | 79 | 'Composer\\Installers\\LithiumInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/LithiumInstaller.php', |
  |  | 80 | 'Composer\\Installers\\MODULEWorkInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MODULEWorkInstaller.php', |
  |  | 81 | 'Composer\\Installers\\MODXEvoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MODXEvoInstaller.php', |
  |  | 82 | 'Composer\\Installers\\MagentoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MagentoInstaller.php', |
  |  | 83 | 'Composer\\Installers\\MajimaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MajimaInstaller.php', |
  |  | 84 | 'Composer\\Installers\\MakoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MakoInstaller.php', |
  |  | 85 | 'Composer\\Installers\\MantisBTInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MantisBTInstaller.php', |
  |  | 86 | 'Composer\\Installers\\MatomoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MatomoInstaller.php', |
  |  | 87 | 'Composer\\Installers\\MauticInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MauticInstaller.php', |
  |  | 88 | 'Composer\\Installers\\MayaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MayaInstaller.php', |
  |  | 89 | 'Composer\\Installers\\MediaWikiInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MediaWikiInstaller.php', |
  |  | 90 | 'Composer\\Installers\\MiaoxingInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MiaoxingInstaller.php', |
  |  | 91 | 'Composer\\Installers\\MicroweberInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MicroweberInstaller.php', |
  |  | 92 | 'Composer\\Installers\\ModxInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ModxInstaller.php', |
  |  | 93 | 'Composer\\Installers\\MoodleInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/MoodleInstaller.php', |
  |  | 94 | 'Composer\\Installers\\OctoberInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/OctoberInstaller.php', |
  |  | 95 | 'Composer\\Installers\\OntoWikiInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/OntoWikiInstaller.php', |
  |  | 96 | 'Composer\\Installers\\OsclassInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/OsclassInstaller.php', |
  |  | 97 | 'Composer\\Installers\\OxidInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/OxidInstaller.php', |
  |  | 98 | 'Composer\\Installers\\PPIInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PPIInstaller.php', |
  |  | 99 | 'Composer\\Installers\\PantheonInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PantheonInstaller.php', |
  |  | 100 | 'Composer\\Installers\\PhiftyInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PhiftyInstaller.php', |
  |  | 101 | 'Composer\\Installers\\PhpBBInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PhpBBInstaller.php', |
  |  | 102 | 'Composer\\Installers\\PiwikInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PiwikInstaller.php', |
  |  | 103 | 'Composer\\Installers\\PlentymarketsInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PlentymarketsInstaller.php', |
  |  | 104 | 'Composer\\Installers\\Plugin' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/Plugin.php', |
  |  | 105 | 'Composer\\Installers\\PortoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PortoInstaller.php', |
  |  | 106 | 'Composer\\Installers\\PrestashopInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PrestashopInstaller.php', |
  |  | 107 | 'Composer\\Installers\\ProcessWireInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ProcessWireInstaller.php', |
  |  | 108 | 'Composer\\Installers\\PuppetInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PuppetInstaller.php', |
  |  | 109 | 'Composer\\Installers\\PxcmsInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/PxcmsInstaller.php', |
  |  | 110 | 'Composer\\Installers\\RadPHPInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/RadPHPInstaller.php', |
  |  | 111 | 'Composer\\Installers\\ReIndexInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ReIndexInstaller.php', |
  |  | 112 | 'Composer\\Installers\\Redaxo5Installer' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/Redaxo5Installer.php', |
  |  | 113 | 'Composer\\Installers\\RedaxoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/RedaxoInstaller.php', |
  |  | 114 | 'Composer\\Installers\\RoundcubeInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/RoundcubeInstaller.php', |
  |  | 115 | 'Composer\\Installers\\SMFInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/SMFInstaller.php', |
  |  | 116 | 'Composer\\Installers\\ShopwareInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ShopwareInstaller.php', |
  |  | 117 | 'Composer\\Installers\\SilverStripeInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/SilverStripeInstaller.php', |
  |  | 118 | 'Composer\\Installers\\SiteDirectInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/SiteDirectInstaller.php', |
  |  | 119 | 'Composer\\Installers\\StarbugInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/StarbugInstaller.php', |
  |  | 120 | 'Composer\\Installers\\SyDESInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/SyDESInstaller.php', |
  |  | 121 | 'Composer\\Installers\\SyliusInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/SyliusInstaller.php', |
  |  | 122 | 'Composer\\Installers\\TaoInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/TaoInstaller.php', |
  |  | 123 | 'Composer\\Installers\\TastyIgniterInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/TastyIgniterInstaller.php', |
  |  | 124 | 'Composer\\Installers\\TheliaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/TheliaInstaller.php', |
  |  | 125 | 'Composer\\Installers\\TuskInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/TuskInstaller.php', |
  |  | 126 | 'Composer\\Installers\\UserFrostingInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/UserFrostingInstaller.php', |
  |  | 127 | 'Composer\\Installers\\VanillaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/VanillaInstaller.php', |
  |  | 128 | 'Composer\\Installers\\VgmcpInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/VgmcpInstaller.php', |
  |  | 129 | 'Composer\\Installers\\WHMCSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/WHMCSInstaller.php', |
  |  | 130 | 'Composer\\Installers\\WinterInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/WinterInstaller.php', |
  |  | 131 | 'Composer\\Installers\\WolfCMSInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/WolfCMSInstaller.php', |
  |  | 132 | 'Composer\\Installers\\WordPressInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/WordPressInstaller.php', |
  |  | 133 | 'Composer\\Installers\\YawikInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/YawikInstaller.php', |
  |  | 134 | 'Composer\\Installers\\ZendInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ZendInstaller.php', |
  |  | 135 | 'Composer\\Installers\\ZikulaInstaller' => \_\_DIR\_\_ . '/..' . '/composer/installers/src/Composer/Installers/ZikulaInstaller.php', |
  | 29 | 136 | 'Lcobucci\\JWT\\Builder' => \_\_DIR\_\_ . '/..' . '/auth0/php-jwt/src/Builder.php', |
  | 30 | 137 | 'Lcobucci\\JWT\\Claim' => \_\_DIR\_\_ . '/..' . '/auth0/php-jwt/src/Claim.php', |
  | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3020639#L113) | […](/browser/auth0/trunk/vendor/composer/autoload_static.php?rev=3114611#L220) |  |
  | 113 | 220 | { |
  | 114 | 221 | return \Closure::bind(function () use ($loader) { |
  | 115 |  | $loader->prefixLengthsPsr4 = ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~::$prefixLengthsPsr4; |
  | 116 |  | $loader->prefixDirsPsr4 = ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~::$prefixDirsPsr4; |
  | 117 |  | $loader->classMap = ComposerStaticInit~~009510a0cb14a6de09e9782737046128~~::$classMap; |
  |  | 222 | $loader->prefixLengthsPsr4 = ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49::$prefixLengthsPsr4; |
  |  | 223 | $loader->prefixDirsPsr4 = ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49::$prefixDirsPsr4; |
  |  | 224 | $loader->classMap = ComposerStaticInitc024eb8bfb084eaadf8e78574a7bdf49::$classMap; |
  | 118 | 225 |  |
  | 119 | 226 | }, null, ClassLoader::class); |
* ## [auth0/trunk/vendor/composer/installed.json](/changeset/3114611/auth0/trunk/vendor/composer/installed.json "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/installed.json")

  | [r2856828](/browser/auth0/trunk/vendor/composer/installed.json?rev=2856828#L59 "Show revision 2856828 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/installed.json?rev=3114611#L59 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 59 | 59 | "abandoned": "auth0/auth0-php", |
  | 60 | 60 | "install-path": "../auth0/php-jwt" |
  |  | 61 | }, |
  |  | 62 | { |
  |  | 63 | "name": "composer/installers", |
  |  | 64 | "version": "v2.3.0", |
  |  | 65 | "version\_normalized": "2.3.0.0", |
  |  | 66 | "source": { |
  |  | 67 | "type": "git", |
  |  | 68 | "url": "https://github.com/composer/installers.git", |
  |  | 69 | "reference": "12fb2dfe5e16183de69e784a7b84046c43d97e8e" |
  |  | 70 | }, |
  |  | 71 | "dist": { |
  |  | 72 | "type": "zip", |
  |  | 73 | "url": "https://api.github.com/repos/composer/installers/zipball/12fb2dfe5e16183de69e784a7b84046c43d97e8e", |
  |  | 74 | "reference": "12fb2dfe5e16183de69e784a7b84046c43d97e8e", |
  |  | 75 | "shasum": "" |
  |  | 76 | }, |
  |  | 77 | "require": { |
  |  | 78 | "composer-plugin-api": "^1.0 || ^2.0", |
  |  | 79 | "php": "^7.2 || ^8.0" |
  |  | 80 | }, |
  |  | 81 | "require-dev": { |
  |  | 82 | "composer/composer": "^1.10.27 || ^2.7", |
  |  | 83 | "composer/semver": "^1.7.2 || ^3.4.0", |
  |  | 84 | "phpstan/phpstan": "^1.11", |
  |  | 85 | "phpstan/phpstan-phpunit": "^1", |
  |  | 86 | "symfony/phpunit-bridge": "^7.1.1", |
  |  | 87 | "symfony/process": "^5 || ^6 || ^7" |
  |  | 88 | }, |
  |  | 89 | "time": "2024-06-24T20:46:46+00:00", |
  |  | 90 | "type": "composer-plugin", |
  |  | 91 | "extra": { |
  |  | 92 | "class": "Composer\\Installers\\Plugin", |
  |  | 93 | "branch-alias": { |
  |  | 94 | "dev-main": "2.x-dev" |
  |  | 95 | }, |
  |  | 96 | "plugin-modifies-install-path": true |
  |  | 97 | }, |
  |  | 98 | "installation-source": "dist", |
  |  | 99 | "autoload": { |
  |  | 100 | "psr-4": { |
  |  | 101 | "Composer\\Installers\\": "src/Composer/Installers" |
  |  | 102 | } |
  |  | 103 | }, |
  |  | 104 | "notification-url": "https://packagist.org/downloads/", |
  |  | 105 | "license": [ |
  |  | 106 | "MIT" |
  |  | 107 | ], |
  |  | 108 | "authors": [ |
  |  | 109 | { |
  |  | 110 | "name": "Kyle Robinson Young", |
  |  | 111 | "email": "kyle@dontkry.com", |
  |  | 112 | "homepage": "https://github.com/shama" |
  |  | 113 | } |
  |  | 114 | ], |
  |  | 115 | "description": "A multi-framework Composer library installer", |
  |  | 116 | "homepage": "https://composer.github.io/installers/", |
  |  | 117 | "keywords": [ |
  |  | 118 | "Dolibarr", |
  |  | 119 | "Eliasis", |
  |  | 120 | "Hurad", |
  |  | 121 | "ImageCMS", |
  |  | 122 | "Kanboard", |
  |  | 123 | "Lan Management System", |
  |  | 124 | "MODX Evo", |
  |  | 125 | "MantisBT", |
  |  | 126 | "Mautic", |
  |  | 127 | "Maya", |
  |  | 128 | "OXID", |
  |  | 129 | "Plentymarkets", |
  |  | 130 | "Porto", |
  |  | 131 | "RadPHP", |
  |  | 132 | "SMF", |
  |  | 133 | "Starbug", |
  |  | 134 | "Thelia", |
  |  | 135 | "Whmcs", |
  |  | 136 | "WolfCMS", |
  |  | 137 | "agl", |
  |  | 138 | "annotatecms", |
  |  | 139 | "attogram", |
  |  | 140 | "bitrix", |
  |  | 141 | "cakephp", |
  |  | 142 | "chef", |
  |  | 143 | "cockpit", |
  |  | 144 | "codeigniter", |
  |  | 145 | "concrete5", |
  |  | 146 | "concreteCMS", |
  |  | 147 | "croogo", |
  |  | 148 | "dokuwiki", |
  |  | 149 | "drupal", |
  |  | 150 | "eZ Platform", |
  |  | 151 | "elgg", |
  |  | 152 | "expressionengine", |
  |  | 153 | "fuelphp", |
  |  | 154 | "grav", |
  |  | 155 | "installer", |
  |  | 156 | "itop", |
  |  | 157 | "known", |
  |  | 158 | "kohana", |
  |  | 159 | "laravel", |
  |  | 160 | "lavalite", |
  |  | 161 | "lithium", |
  |  | 162 | "magento", |
  |  | 163 | "majima", |
  |  | 164 | "mako", |
  |  | 165 | "matomo", |
  |  | 166 | "mediawiki", |
  |  | 167 | "miaoxing", |
  |  | 168 | "modulework", |
  |  | 169 | "modx", |
  |  | 170 | "moodle", |
  |  | 171 | "osclass", |
  |  | 172 | "pantheon", |
  |  | 173 | "phpbb", |
  |  | 174 | "piwik", |
  |  | 175 | "ppi", |
  |  | 176 | "processwire", |
  |  | 177 | "puppet", |
  |  | 178 | "pxcms", |
  |  | 179 | "reindex", |
  |  | 180 | "roundcube", |
  |  | 181 | "shopware", |
  |  | 182 | "silverstripe", |
  |  | 183 | "sydes", |
  |  | 184 | "sylius", |
  |  | 185 | "tastyigniter", |
  |  | 186 | "wordpress", |
  |  | 187 | "yawik", |
  |  | 188 | "zend", |
  |  | 189 | "zikula" |
  |  | 190 | ], |
  |  | 191 | "support": { |
  |  | 192 | "issues": "https://github.com/composer/installers/issues", |
  |  | 193 | "source": "https://github.com/composer/installers/tree/v2.3.0" |
  |  | 194 | }, |
  |  | 195 | "funding": [ |
  |  | 196 | { |
  |  | 197 | "url": "https://packagist.com", |
  |  | 198 | "type": "custom" |
  |  | 199 | }, |
  |  | 200 | { |
  |  | 201 | "url": "https://github.com/composer", |
  |  | 202 | "type": "github" |
  |  | 203 | }, |
  |  | 204 | { |
  |  | 205 | "url": "https://tidelift.com/funding/github/packagist/composer/composer", |
  |  | 206 | "type": "tidelift" |
  |  | 207 | } |
  |  | 208 | ], |
  |  | 209 | "install-path": "./installers" |
  | 61 | 210 | } |
  | 62 | 211 | ], |
* ## [auth0/trunk/vendor/composer/installed.php](/changeset/3114611/auth0/trunk/vendor/composer/installed.php "Show the changeset 3114611 restricted to auth0/trunk/vendor/composer/installed.php")

  | [r3020639](/browser/auth0/trunk/vendor/composer/installed.php?rev=3020639#L4 "Show revision 3020639 of this file in browser") | [r3114611](/browser/auth0/trunk/vendor/composer/installed.php?rev=3114611#L4 "Show revision 3114611 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | 'pretty\_version' => '4.x-dev', |
  | 5 | 5 | 'version' => '4.9999999.9999999.9999999-dev', |
  | 6 |  | 'reference' => '~~257c59d0d5dc74c2f8e6afea0a52dd533373a713~~', |
  |  | 6 | 'reference' => '0e73efe983c7e654ae19a90bad8c8be98f13c59b', |
  | 7 | 7 | 'type' => 'wordpress-plugin', |
  | 8 | 8 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/auth0/trunk/vendor/composer/installed.php?rev=3020639#L23) | […](/browser/auth0/trunk/vendor/composer/installed.php?rev=3114611#L23) |  |
  | 23 | 23 | 'pretty\_version' => '4.x-dev', |
  | 24 | 24 | 'version' => '4.9999999.9999999.9999999-dev', |
  | 25 |  | 'reference' => '~~257c59d0d5dc74c2f8e6afea0a52dd533373a713~~', |
  |  | 25 | 'reference' => '0e73efe983c7e654ae19a90bad8c8be98f13c59b', |
  | 26 | 26 | 'type' => 'wordpress-plugin', |
  | 27 | 27 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/auth0/trunk/vendor/composer/installed.php?rev=3020639#L29) | […](/browser/auth0/trunk/vendor/composer/installed.php?rev=3114611#L29) |  |
  | 29 | 29 | 'dev\_requirement' => false, |
  | 30 | 30 | ), |
  |  | 31 | 'composer/installers' => array( |
  |  | 32 | 'pretty\_version' => 'v2.3.0', |
  |  | 33 | 'version' => '2.3.0.0', |
  |  | 34 | 'reference' => '12fb2dfe5e16183de69e784a7b84046c43d97e8e', |
  |  | 35 | 'type' => 'composer-plugin', |
  |  | 36 | 'install\_path' => \_\_DIR\_\_ . '/./installers', |
  |  | 37 | 'aliases' => array(), |
  |  | 38 | 'dev\_requirement' => false, |
  |  | 39 | ), |
  | 31 | 40 | ), |
  | 32 | 41 | ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3114611)
* [Zip Archive](?format=zip&new=3114611)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


