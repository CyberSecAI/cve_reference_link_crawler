

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=810ee43d9cd245d138a2733d87a24858a23f577d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=810ee43d9cd245d138a2733d87a24858a23f577d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=810ee43d9cd245d138a2733d87a24858a23f577d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=810ee43d9cd245d138a2733d87a24858a23f577d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Phillip Lougher <phillip@squashfs.org.uk> | 2024-08-12 00:28:21 +0100 |
| --- | --- | --- |
| committer | Christian Brauner <brauner@kernel.org> | 2024-08-13 13:56:46 +0200 |
| commit | [810ee43d9cd245d138a2733d87a24858a23f577d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=810ee43d9cd245d138a2733d87a24858a23f577d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=810ee43d9cd245d138a2733d87a24858a23f577d)) | |
| tree | [9ef49af7ca20385a8a25508fb4868fd7ef99dacc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=810ee43d9cd245d138a2733d87a24858a23f577d) | |
| parent | [e3786b29c54cdae3490b07180a54e2461f42144c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3786b29c54cdae3490b07180a54e2461f42144c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=810ee43d9cd245d138a2733d87a24858a23f577d&id2=e3786b29c54cdae3490b07180a54e2461f42144c)) | |
| download | [linux-810ee43d9cd245d138a2733d87a24858a23f577d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-810ee43d9cd245d138a2733d87a24858a23f577d.tar.gz) | |

Squashfs: sanity check symbolic link sizeSyzkiller reports a "KMSAN: uninit-value in pick\_link" bug.
This is caused by an uninitialised page, which is ultimately caused
by a corrupted symbolic link size read from disk.
The reason why the corrupted symlink size causes an uninitialised
page is due to the following sequence of events:
1. squashfs\_read\_inode() is called to read the symbolic
link from disk. This assigns the corrupted value
3875536935 to inode->i\_size.
2. Later squashfs\_symlink\_read\_folio() is called, which assigns
this corrupted value to the length variable, which being a
signed int, overflows producing a negative number.
3. The following loop that fills in the page contents checks that
the copied bytes is less than length, which being negative means
the loop is skipped, producing an uninitialised page.
This patch adds a sanity check which checks that the symbolic
link size is not larger than expected.
--
Signed-off-by: Phillip Lougher <phillip@squashfs.org.uk>
Link: [https://lore.kernel.org/r/20240811232821.13903-1-phillip@squashfs.org.uk](https://lore.kernel.org/r/20240811232821.13903-1-phillip%40squashfs.org.uk)
Reported-by: Lizhi Xu <lizhi.xu@windriver.com>
Reported-by: syzbot+24ac24ff58dc5b0d26b9@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/all/000000000000a90e8c061e86a76b@google.com/
V2: fix spelling mistake.
Signed-off-by: Christian Brauner <brauner@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=810ee43d9cd245d138a2733d87a24858a23f577d)

| -rw-r--r-- | [fs/squashfs/inode.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/squashfs/inode.c?id=810ee43d9cd245d138a2733d87a24858a23f577d) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 1 deletions

| diff --git a/fs/squashfs/inode.c b/fs/squashfs/inode.cindex 16bd693d0b3aa2..d5918eba27e371 100644--- a/[fs/squashfs/inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/squashfs/inode.c?id=e3786b29c54cdae3490b07180a54e2461f42144c)+++ b/[fs/squashfs/inode.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/squashfs/inode.c?id=810ee43d9cd245d138a2733d87a24858a23f577d)@@ -279,8 +279,13 @@ int squashfs\_read\_inode(struct inode \*inode, long long ino) if (err < 0) goto failed\_read; - set\_nlink(inode, le32\_to\_cpu(sqsh\_ino->nlink)); inode->i\_size = le32\_to\_cpu(sqsh\_ino->symlink\_size);+ if (inode->i\_size > PAGE\_SIZE) {+ ERROR("Corrupted symlink\n");+ return -EINVAL;+ }++ set\_nlink(inode, le32\_to\_cpu(sqsh\_ino->nlink)); inode->i\_op = &squashfs\_symlink\_inode\_ops; inode\_nohighmem(inode); inode->i\_data.a\_ops = &squashfs\_symlink\_aops; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:20:19 +0000

