=== Content from plugins.trac.wordpress.org_c7260035_20250111_071143.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3076105)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3076104 "Changeset 3076104")
* [Next Changeset](/changeset/3076106 "Changeset 3076106") →

---

# Changeset 3076105

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/23/2024 10:20:37 PM
([9 months](/timeline?from=2024-04-23T22%3A20%3A37Z&precision=second "See timeline at 04/23/2024 10:20:37 PM") ago)

Author:
wpovernight
Message:

Release version 3.8.1

Location:
[woocommerce-pdf-invoices-packing-slips](/browser/woocommerce-pdf-invoices-packing-slips?rev=3076105)
Files:

2 added
2 deleted
76 edited
1 copied

* [tags/3.8.1](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1?rev=3076105 "Show entry in browser")
  (copied)
  *(copied from [woocommerce-pdf-invoices-packing-slips/trunk](/browser/woocommerce-pdf-invoices-packing-slips/trunk?rev=3053443 "Show original file (revision 3076104)"))*
* [tags/3.8.1/assets/js/admin-script.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file1 "Show differences"))
* [tags/3.8.1/assets/js/admin-script.min.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/3.8.1/assets/js/confetti.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/3.8.1/assets/js/confetti.min.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/3.8.1/assets/js/debug-script.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [tags/3.8.1/assets/js/debug-script.min.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [tags/3.8.1/assets/js/media-upload.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file7 "Show differences"))
* [tags/3.8.1/assets/js/media-upload.min.js](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [tags/3.8.1/includes/class-wcpdf-main.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-main.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file9 "Show differences"))
* [tags/3.8.1/includes/class-wcpdf-settings.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file11 "Show differences"))
* [tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file12 "Show differences"))
* [tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file13 "Show differences"))
* [tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file14 "Show differences"))
* [tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file15 "Show differences"))
* [tags/3.8.1/includes/settings/class-wcpdf-settings-general.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-general.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [tags/3.8.1/includes/wcpdf-functions.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105 "Show entry in browser")
  (modified)
  ([10 diffs](#file18 "Show differences"))
* [tags/3.8.1/readme.txt](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file19 "Show differences"))
* [tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file20 "Show differences"))
* [tags/3.8.1/ubl/Transformers/AddressTransformer.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file21 "Show differences"))
* [tags/3.8.1/vendor/composer/installed.json](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file22 "Show differences"))
* [tags/3.8.1/vendor/composer/installed.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file23 "Show differences"))
* [tags/3.8.1/vendor/dompdf/dompdf/VERSION](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/VERSION?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file24 "Show differences"))
* [tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file25 "Show differences"))
* [tags/3.8.1/vendor/dompdf/dompdf/src/Options.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file26 "Show differences"))
* [tags/3.8.1/vendor/masterminds/html5/README.md](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/README.md?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file27 "Show differences"))
* [tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file28 "Show differences"))
* [tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file29 "Show differences"))
* [tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file30 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/README.md](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file31 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/SECURITY.md](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/SECURITY.md?rev=3019205 "Show what was removed (content at revision 3076104)")
  (deleted)
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105 "Show entry in browser")
  (modified)
  ([10 diffs](#file33 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105 "Show entry in browser")
  (modified)
  ([7 diffs](#file34 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105 "Show entry in browser")
  (modified)
  ([63 diffs](#file35 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file36 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file37 "Show differences"))
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Symbol.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Symbol.php?rev=3076105 "Show entry in browser")
  (added)
* [tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file39 "Show differences"))
* [tags/3.8.1/woocommerce-pdf-invoices-packingslips.php](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file40 "Show differences"))
* [trunk/assets/js/admin-script.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file41 "Show differences"))
* [trunk/assets/js/admin-script.min.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file42 "Show differences"))
* [trunk/assets/js/confetti.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file43 "Show differences"))
* [trunk/assets/js/confetti.min.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file44 "Show differences"))
* [trunk/assets/js/debug-script.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file45 "Show differences"))
* [trunk/assets/js/debug-script.min.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file46 "Show differences"))
* [trunk/assets/js/media-upload.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file47 "Show differences"))
* [trunk/assets/js/media-upload.min.js](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file48 "Show differences"))
* [trunk/includes/class-wcpdf-main.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [trunk/includes/class-wcpdf-settings.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file50 "Show differences"))
* [trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file51 "Show differences"))
* [trunk/includes/documents/abstract-wcpdf-order-document-methods.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file52 "Show differences"))
* [trunk/includes/documents/abstract-wcpdf-order-document.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file53 "Show differences"))
* [trunk/includes/settings/class-wcpdf-settings-callbacks.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file54 "Show differences"))
* [trunk/includes/settings/class-wcpdf-settings-debug.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [trunk/includes/settings/class-wcpdf-settings-general.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file56 "Show differences"))
* [trunk/includes/wcpdf-functions.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3076105 "Show entry in browser")
  (modified)
  ([4 diffs](#file57 "Show differences"))
* [trunk/languages/woocommerce-pdf-invoices-packing-slips.pot](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105 "Show entry in browser")
  (modified)
  ([10 diffs](#file58 "Show differences"))
* [trunk/readme.txt](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file59 "Show differences"))
* [trunk/ubl/Handlers/Ubl/AddressHandler.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file60 "Show differences"))
* [trunk/ubl/Transformers/AddressTransformer.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file61 "Show differences"))
* [trunk/vendor/composer/installed.json](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file62 "Show differences"))
* [trunk/vendor/composer/installed.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file63 "Show differences"))
* [trunk/vendor/dompdf/dompdf/VERSION](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file64 "Show differences"))
* [trunk/vendor/dompdf/dompdf/src/Adapter/GD.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file65 "Show differences"))
* [trunk/vendor/dompdf/dompdf/src/Options.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105 "Show entry in browser")
  (modified)
  ([11 diffs](#file66 "Show differences"))
* [trunk/vendor/masterminds/html5/README.md](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file67 "Show differences"))
* [trunk/vendor/masterminds/html5/src/HTML5/Elements.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file68 "Show differences"))
* [trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file69 "Show differences"))
* [trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file70 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/README.md](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=3076105 "Show entry in browser")
  (modified)
  ([2 diffs](#file71 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/SECURITY.md](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/SECURITY.md?rev=3019205 "Show what was removed (content at revision 3076104)")
  (deleted)
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105 "Show entry in browser")
  (modified)
  ([10 diffs](#file73 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105 "Show entry in browser")
  (modified)
  ([7 diffs](#file74 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105 "Show entry in browser")
  (modified)
  ([63 diffs](#file75 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file76 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=3076105 "Show entry in browser")
  (modified)
  ([1 diff](#file77 "Show differences"))
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Symbol.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Symbol.php?rev=3076105 "Show entry in browser")
  (added)
* [trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105 "Show entry in browser")
  (modified)
  ([5 diffs](#file79 "Show differences"))
* [trunk/woocommerce-pdf-invoices-packingslips.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3076105 "Show entry in browser")
  (modified)
  ([3 diffs](#file80 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L136 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js?rev=3076105#L136 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 136 | 136 | } |
  | 137 | 137 |  |
  | 138 |  | $( document ).ready( function() { |
  | 139 |  | resetDocumentType();      // force document type reset |
  | 140 |  | resetOrderId();           // force order ID reset |
  | 141 |  | loadPreviewData();        // load preview data |
  | 142 |  |  |
  | 143 |  | previousWindowWidth = $(window).width(); |
  | 144 |  | determinePreviewStates(); // determine preview states based on screen size |
  | 145 |  | } ); |
  |  | 138 | resetDocumentType();      // force document type reset |
  |  | 139 | resetOrderId();           // force order ID reset |
  |  | 140 | loadPreviewData();        // load preview data |
  |  | 141 |  |
  |  | 142 | previousWindowWidth = $( window ).width(); |
  |  | 143 | determinePreviewStates(); // determine preview states based on screen size |
  | 146 | 144 |  |
  | 147 | 145 | $( window ).on( 'resize', determinePreviewStates ); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L295) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js?rev=3076105#L293) |  |
  | 295 | 293 |  |
  | 296 | 294 | // Preview on page load |
  | 297 |  | ~~$( document ).ready( triggerPreview()~~ ); |
  |  | 295 | triggerPreview(); |
  | 298 | 296 |  |
  | 299 | 297 | // Custom trigger to signify settings have changed (will show save button and refresh preview) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L312) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js?rev=3076105#L310) |  |
  | 312 | 310 | event.preventDefault(); |
  | 313 | 311 | $( '.preview-document .order-search-label').text( '#' + $( this ).data( 'order\_id' ) ); |
  | 314 |  | $previewOrderIdInput.val( $( this ).data( 'order\_id' ) ).~~change(~~); |
  |  | 312 | $previewOrderIdInput.val( $( this ).data( 'order\_id' ) ).trigger( 'change' ); |
  | 315 | 313 | $( this ).closest( 'div' ).hide();                   // hide results div |
  | 316 | 314 | $( this ).closest( 'div' ).children( 'a' ).remove(); // remove all results |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L360) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.js?rev=3076105#L358) |  |
  | 360 | 358 |  |
  | 361 | 359 | // Submit settings form when clicking on secondary save button |
  | 362 |  | $( document ).on( 'click', '.preview-data-wrapper .save-settings p input', function( event ) { |
  | 363 |  | $(~~'#wpo-wcpdf-settings input#submit').click(~~); |
  |  | 360 | $( document.body ).on( 'click', '.preview-data-wrapper .save-settings p input', function( event ) { |
  |  | 361 | $( '#wpo-wcpdf-settings input#submit' ).trigger( 'click' ); |
  | 364 | 362 | } ); |
  | 365 | 363 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.min.js")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js?rev=2980576#L1 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/admin-script.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(function(a){function b(){~~n=x.val(),o=y.val(),p=z.val(),q=A.val(),r=B.serialize()}function c(){y.val(y.data("default")).trigger("change")}function d(){x.val("").trigger("change")}function e(){!1==v.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<u||a(this).width()==u)?"full"==v.attr("data-preview-state")?(v.find(".preview-document").show(),v.find(".sidebar").hide(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-states",2),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","")):(v.find(".preview-document").hide(),v.find(".sidebar").show(),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-states",2),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=u||a(this).width()==u)&&("full"==v.attr("data-preview-state")?(v.find(".preview-document").show(),v.find(".sidebar").hide(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-states",3),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","sidebar"),v.addClass("static")):"closed"==v.attr("data-preview-state")&&a(this).width()!==u?(v.find(".preview-document").hide(),v.find(".sidebar").show(),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-states",3),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state",""),v.removeClass("static")):(v.find(".preview-document, .sidebar").show(),v.find(".slide-left, .slide-right").show(),v.attr("data-preview-states",3),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state",""),v.removeClass("static")))),u=a(this).width()}function f(a){window.scrollTo(0,0);let b=a;setTimeout(function(){b.addClass("static")},300)}function g(b,c){h();let d=a(b.target);if(!j(d.attr("name"))){if(d.hasClass("remove-requirement")||"disable\_for"==d.attr("id"))return;if(-1!==jQuery.inArray(b.type,["keyup","paste"])){if(d.is("input[type=\"checkbox\"], select"))return;c="keyup"==b.type?1e3:0}i(c)}}function h(b){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function i(a){a="number"==typeof a?a:0,b(),clearTimeout(s),s=setTimeout(function(){k()},a)}function j(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.\*?)\]/)[1]:b;return-1!==a.inArray(d,wpo\_wcpdf\_admin.preview\_excluded\_settings)&&(c=!0),c}function k(){let b=wpo\_wcpdf\_admin.pdfjs\_worker,c="preview-canvas",d={action:"wpo\_wcpdf\_preview",security:q,order\_id:n,document\_type:o,output\_format:p,data:r};w.children(".notice").remove(),w.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),C=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,beforeSend:function(a,b){null!=C&&C.abort()},success:function(d,e,f){if(d.data.error)a("#"+c).remove(),w.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>");else if(d.data.preview\_data&&d.data.output\_format)switch(a("#"+c).remove(),d.data.output\_format){default:case"pdf":w.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),l(b,c,d.data.preview\_data);break;case"ubl":let a=d.data.preview\_data,e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");w.html("<div id=\"preview-ubl\">"+e+"</div>")}w.unblock()},error:function(b,d,e){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),w.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),w.unblock()}}})}function l(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){let c=1;a.getPage(1).then(function(a){let c=2,d=a.getViewport({scale:2}),e=document.getElementById(b),f=e.getContext("2d");e.height=d.height,e.width=d.width;let g={canvasContext:f,viewport:d},h=a.render(g);h.promise.then(function(){})})},function(a){console.error(a)})}function m(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f="wpo\_wcpdf\_preview\_order\_search",g={security:e,action:f,search:d,document\_type:o};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order\_id=\""+a+"\"><span class=\"order-number\">#"+b.order\_number+"</span> - "+b.billing\_first\_name+" "+b.billing\_last\_name;0<b.billing\_company.length&&(d=d+", "+b.billing\_company);let e="<br><span class=\"date\">"+b.date\_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(b){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(b){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(b){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let c=$input.val();if(0<c.length&&2147483647<c)return alert(wpo\_wcpdf\_admin.mysql\_int\_size\_limit),void $input.removeClass("ajax-waiting");let d={security:$input.data("nonce"),action:"wpo\_wcpdf\_set\_next\_number",store:$input.data("store"),number:c};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,success:function(a){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo\_wcpdf\_documents\_settings\_invoice[display\_number]']").on("change",function(b){"order\_number"==a(this).val()?(a(this).closest("td").find(".description").slideDown(),a(this).closest("tr").next("tr").hide()):(a(this).closest("td").find(".description").hide(),a(this).closest("tr").next("tr").show())}).trigger("change"),a(".wcpdf\_document\_settings\_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")}),a.each(wpo\_wcpdf\_admin.pointers,function(b,c){a(c.target).pointer({content:c.content,position:{edge:c.position.edge,align:c.position.align},pointerClass:c.pointer\_class,pointerWidth:c.pointer\_width,close:function(){jQuery.post(wpo\_wcpdf\_admin.ajaxurl,{pointer:b,action:"dismiss-wp-pointer"})}}),-1===a.inArray(b,wpo\_wcpdf\_admin.dismissed\_pointers.split(","))&&a(c.target).pointer("open")}),a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200});let n,o,p,q,r,s,t,u,v=a("#wpo-wcpdf-preview-wrapper"),w=a("#wpo-wcpdf-preview-wrapper .preview"),x=a("#wpo-wcpdf-preview-wrapper input[name=\"order\_id\"]"),y=a("#wpo-wcpdf-preview-wrapper input[name=\"document\_type\"]"),z=a("#wpo-wcpdf-preview-wrapper input[name=\"output\_format\"]"),A=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),B=a("#wpo-wcpdf-settings"),C=null;a(document).ready(function(){c(),d(),b(),u=a(window).width(),e()}),a(window).on("resize",e),a(".slide-left").on("click",function(){let a=v.attr("data-preview-states"),b=v.attr("data-preview-state");v.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(v.find(".preview-document").show(),v.find(".slide-right").show(),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state","closed")):(v.find(".slide-left").hide(),v.find(".sidebar").delay(300).hide(0),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","sidebar"),f(v)):(v.find(".preview-document").show(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","closed"),f(v))}),a(".slide-right").on("click",function(){let a=v.attr("data-preview-states"),b=v.attr("data-preview-state");v.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(v.find(".slide-left").delay(400).show(0),v.find(".sidebar").show(),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state","full")):(v.find(".preview-document").hide(300),v.find(".slide-right").hide(),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","sidebar")):(v.find(".preview-document").hide(300),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","full")),v.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),d(),i())}),a(document).ready(i()),a(document).on("wpo-wcpdf-settings-changed",function(a,b){h(),i(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo\_wcpdf\_refresh\_preview",function(a,b){i(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order\_id")),x.val(a(this).data("order\_id")).change(),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),i()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",g),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||g(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",g),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",g),a(document).on("click",".wpo\_remove\_image\_button, #wpo-wcpdf-settings .remove-requirement",g),a(document).on("click",".preview-data-wrapper .save-settings p input",function(b){a("#wpo-wcpdf-settings input#submit").click()}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),y.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),i()}}).trigger("change"),x.on("change",function(){i()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(c){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==c.type?1e3:0;b(),clearTimeout(t),t=setTimeout(function(){m~~(d)},e)})}); |
  |  | 1 | jQuery(function(a){function b(){m=w.val(),n=x.val(),o=y.val(),p=z.val(),q=A.serialize()}function c(){w.val("").trigger("change")}function d(){!1==u.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<t||a(this).width()==t)?"full"==u.attr("data-preview-state")?(u.find(".preview-document").show(),u.find(".sidebar").hide(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-states",2),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","")):(u.find(".preview-document").hide(),u.find(".sidebar").show(),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-states",2),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=t||a(this).width()==t)&&("full"==u.attr("data-preview-state")?(u.find(".preview-document").show(),u.find(".sidebar").hide(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-states",3),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","sidebar"),u.addClass("static")):"closed"==u.attr("data-preview-state")&&a(this).width()!==t?(u.find(".preview-document").hide(),u.find(".sidebar").show(),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-states",3),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state",""),u.removeClass("static")):(u.find(".preview-document, .sidebar").show(),u.find(".slide-left, .slide-right").show(),u.attr("data-preview-states",3),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state",""),u.removeClass("static")))),t=a(this).width()}function e(a){window.scrollTo(0,0);let b=a;setTimeout(function(){b.addClass("static")},300)}function f(b,c){g();let d=a(b.target);if(!i(d.attr("name"))){if(d.hasClass("remove-requirement")||"disable\_for"==d.attr("id"))return;if(-1!==jQuery.inArray(b.type,["keyup","paste"])){if(d.is("input[type=\"checkbox\"], select"))return;c="keyup"==b.type?1e3:0}h(c)}}function g(b){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function h(a){a="number"==typeof a?a:0,b(),clearTimeout(r),r=setTimeout(function(){j()},a)}function i(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.\*?)\]/)[1]:b;return-1!==a.inArray(d,wpo\_wcpdf\_admin.preview\_excluded\_settings)&&(c=!0),c}function j(){let b=wpo\_wcpdf\_admin.pdfjs\_worker,c="preview-canvas",d={action:"wpo\_wcpdf\_preview",security:p,order\_id:m,document\_type:n,output\_format:o,data:q};v.children(".notice").remove(),v.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),B=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,beforeSend:function(a,b){null!=B&&B.abort()},success:function(d,e,f){if(d.data.error)a("#"+c).remove(),v.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>");else if(d.data.preview\_data&&d.data.output\_format)switch(a("#"+c).remove(),d.data.output\_format){default:case"pdf":v.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),k(b,c,d.data.preview\_data);break;case"ubl":let a=d.data.preview\_data,e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");v.html("<div id=\"preview-ubl\">"+e+"</div>")}v.unblock()},error:function(b,d,e){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),v.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),v.unblock()}}})}function k(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){let c=1;a.getPage(1).then(function(a){let c=2,d=a.getViewport({scale:2}),e=document.getElementById(b),f=e.getContext("2d");e.height=d.height,e.width=d.width;let g={canvasContext:f,viewport:d},h=a.render(g);h.promise.then(function(){})})},function(a){console.error(a)})}function l(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f="wpo\_wcpdf\_preview\_order\_search",g={security:e,action:f,search:d,document\_type:n};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order\_id=\""+a+"\"><span class=\"order-number\">#"+b.order\_number+"</span> - "+b.billing\_first\_name+" "+b.billing\_last\_name;0<b.billing\_company.length&&(d=d+", "+b.billing\_company);let e="<br><span class=\"date\">"+b.date\_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(b){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(b){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(b){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let c=$input.val();if(0<c.length&&2147483647<c)return alert(wpo\_wcpdf\_admin.mysql\_int\_size\_limit),void $input.removeClass("ajax-waiting");let d={security:$input.data("nonce"),action:"wpo\_wcpdf\_set\_next\_number",store:$input.data("store"),number:c};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,success:function(a){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo\_wcpdf\_documents\_settings\_invoice[display\_number]']").on("change",function(b){"order\_number"==a(this).val()?(a(this).closest("td").find(".description").slideDown(),a(this).closest("tr").next("tr").hide()):(a(this).closest("td").find(".description").hide(),a(this).closest("tr").next("tr").show())}).trigger("change"),a(".wcpdf\_document\_settings\_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")}),a.each(wpo\_wcpdf\_admin.pointers,function(b,c){a(c.target).pointer({content:c.content,position:{edge:c.position.edge,align:c.position.align},pointerClass:c.pointer\_class,pointerWidth:c.pointer\_width,close:function(){jQuery.post(wpo\_wcpdf\_admin.ajaxurl,{pointer:b,action:"dismiss-wp-pointer"})}}),-1===a.inArray(b,wpo\_wcpdf\_admin.dismissed\_pointers.split(","))&&a(c.target).pointer("open")}),a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200});let m,n,o,p,q,r,s,t,u=a("#wpo-wcpdf-preview-wrapper"),v=a("#wpo-wcpdf-preview-wrapper .preview"),w=a("#wpo-wcpdf-preview-wrapper input[name=\"order\_id\"]"),x=a("#wpo-wcpdf-preview-wrapper input[name=\"document\_type\"]"),y=a("#wpo-wcpdf-preview-wrapper input[name=\"output\_format\"]"),z=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),A=a("#wpo-wcpdf-settings"),B=null;(function a(){x.val(x.data("default")).trigger("change")})(),c(),b(),t=a(window).width(),d(),a(window).on("resize",d),a(".slide-left").on("click",function(){let a=u.attr("data-preview-states"),b=u.attr("data-preview-state");u.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(u.find(".preview-document").show(),u.find(".slide-right").show(),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state","closed")):(u.find(".slide-left").hide(),u.find(".sidebar").delay(300).hide(0),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","sidebar"),e(u)):(u.find(".preview-document").show(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","closed"),e(u))}),a(".slide-right").on("click",function(){let a=u.attr("data-preview-states"),b=u.attr("data-preview-state");u.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(u.find(".slide-left").delay(400).show(0),u.find(".sidebar").show(),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state","full")):(u.find(".preview-document").hide(300),u.find(".slide-right").hide(),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","sidebar")):(u.find(".preview-document").hide(300),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","full")),u.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),c(),h())}),h(),a(document).on("wpo-wcpdf-settings-changed",function(a,b){g(),h(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo\_wcpdf\_refresh\_preview",function(a,b){h(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order\_id")),w.val(a(this).data("order\_id")).trigger("change"),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),h()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",f),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||f(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",f),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",f),a(document).on("click",".wpo\_remove\_image\_button, #wpo-wcpdf-settings .remove-requirement",f),a(document.body).on("click",".preview-data-wrapper .save-settings p input",function(b){a("#wpo-wcpdf-settings input#submit").trigger("click")}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),x.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),h()}}).trigger("change"),w.on("change",function(){h()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(c){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==c.type?1e3:0;b(),clearTimeout(s),s=setTimeout(function(){l(d)},e)})}); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.js")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js?rev=2790488#L340 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.js?rev=3076105#L340 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 340 | 340 | var confetti = new confetti.Context('confetti'); |
  | 341 | 341 | confetti.start(); |
  | 342 |  | $(~~window).resize(~~function() { |
  | 343 |  | confetti.~~resize(~~); |
  | 344 |  | }); |
  |  | 342 | $( window ).on( 'resize', function() { |
  |  | 343 | confetti.trigger( 'resize' ); |
  |  | 344 | } ); |
  | 345 | 345 | }); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.min.js")

  | [r2738458](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js?rev=2738458#L1 "Show revision 2738458 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/confetti.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(document).ready(function(a){var b=Math.PI,c=Math.sin,d=Math.cos,e=Math.round,f=Math.sqrt;function g(a,b){this.x=a,this.y=b,this.Length=function(){return f(this.SqrLength())},this.SqrLength=function(){return this.x\*this.x+this.y\*this.y},this.Equals=function(a,b){return a.x==b.x&&a.y==b.y},this.Add=function(a){this.x+=a.x,this.y+=a.y},this.Sub=function(a){this.x-=a.x,this.y-=a.y},this.Div=function(a){this.x/=a,this.y/=a},this.Mul=function(a){this.x\*=a,this.y\*=a},this.Normalize=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);this.x\*=b,this.y\*=b}},this.Normalized=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);return new g(this.x\*b,this.y\*b)}return new g(0,0)}}function h(a,b,c,d){this.position=new g(a,b),this.mass=c,this.drag=d,this.force=new g(0,0),this.velocity=new g(0,0),this.AddForce=function(a){this.force.Add(a)},this.Integrate=function(a){var b=this.CurrentForce(this.position);b.Div(this.mass);var c=new g(this.velocity.x,this.velocity.y);c.Mul(a),this.position.Add(c),b.Mul(a),this.velocity.Add(b),this.force=new g(0,0)},this.CurrentForce=function(){var a=new g(this.force.x,this.force.y),b=this.velocity.Length(),c=new g(this.velocity.x,this.velocity.y);return c.Mul(this.drag\*this.mass\*b),a.Sub(c),a}}function j(a,b){this.pos=new g(a,b),this.rotationSpeed=600\*Math.random()+800,this.angle=360\*(m\*Math.random()),this.rotation=360\*(m\*Math.random()),this.cosA=1,this.size=5,this.oscillationSpeed=1.5\*Math.random()+.5,this.xSpeed=40,this.ySpeed=60\*Math.random()+50,this.corners=[],this.time=Math.random();var f=e(Math.random()\*(n.length-1));this.frontColor=n[f][0],this.backColor=n[f][1];for(var h=0;4>h;h++){var k=d(this.angle+m\*(90\*h+45)),l=c(this.angle+m\*(90\*h+45));this.corners[h]=new g(k,l)}this.Update=function(a){this.time+=a,this.rotation+=this.rotationSpeed\*a,this.cosA=d(m\*this.rotation),this.pos.x+=d(this.time\*this.oscillationSpeed)\*this.xSpeed\*a,this.pos.y+=this.ySpeed\*a,this.pos.y>j.bounds.y&&(this.pos.x=Math.random()\*j.bounds.x,this.pos.y=0)},this.Draw=function(a){a.fillStyle=0<this.cosA?this.frontColor:this.backColor,a.beginPath(),a.moveTo(this.pos.x+this.corners[0].x\*this.size,this.pos.y+this.corners[0].y\*this.size\*this.cosA);for(var b=1;4>b;b++)a.lineTo(this.pos.x+this.corners[b].x\*this.size,this.pos.y+this.corners[b].y\*this.size\*this.cosA);a.closePath(),a.fill()}}function k(a,b,j,l,o,p,q,r){this.particleDist=l,this.particleCount=j,this.particleMass=q,this.particleDrag=r,this.particles=[];var s=e(Math.random()\*(n.length-1));this.frontColor=n[s][0],this.backColor=n[s][1],this.xOff=d(m\*p)\*o,this.yOff=c(m\*p)\*o,this.position=new g(a,b),this.prevPosition=new g(a,b),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+2,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;for(var t=0;t<this.particleCount;t++)this.particles[t]=new h(a,b-t\*this.particleDist,this.particleMass,this.particleDrag);this.Update=function(a){var b=0;this.time+=a\*this.oscillationSpeed,this.position.y+=this.ySpeed\*a,this.position.x+=d(this.time)\*this.oscillationDistance\*a,this.particles[0].position=this.position;var c=this.prevPosition.x-this.position.x,e=this.prevPosition.y-this.position.y,h=f(c\*c+e\*e);for(this.prevPosition=new g(this.position.x,this.position.y),b=1;b<this.particleCount;b++){var j=g.Sub(this.particles[b-1].position,this.particles[b].position);j.Normalize(),j.Mul(h/a\*this.velocityInherit),this.particles[b].AddForce(j)}for(b=1;b<this.particleCount;b++)this.particles[b].Integrate(a);for(b=1;b<this.particleCount;b++){var l=new g(this.particles[b].position.x,this.particles[b].position.y);l.Sub(this.particles[b-1].position),l.Normalize(),l.Mul(this.particleDist),l.Add(this.particles[b-1].position),this.particles[b].position=l}this.position.y>k.bounds.y+this.particleDist\*this.particleCount&&this.Reset()},this.Reset=function(){this.position.y=-Math.random()\*k.bounds.y,this.position.x=Math.random()\*k.bounds.x,this.prevPosition=new g(this.position.x,this.position.y),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+1.5,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;var a=e(Math.random()\*(n.length-1));this.frontColor=n[a][0],this.backColor=n[a][1],this.particles=[];for(var b=0;b<this.particleCount;b++)this.particles[b]=new h(this.position.x,this.position.y-b\*this.particleDist,this.particleMass,this.particleDrag)},this.Draw=function(a){for(var b=0;b<this.particleCount-1;b++){var c=new g(this.particles[b].position.x+this.xOff,this.particles[b].position.y+this.yOff),d=new g(this.particles[b+1].position.x+this.xOff,this.particles[b+1].position.y+this.yOff);0>this.Side(this.particles[b].position.x,this.particles[b].position.y,this.particles[b+1].position.x,this.particles[b+1].position.y,d.x,d.y)?(a.fillStyle=this.frontColor,a.strokeStyle=this.frontColor):(a.fillStyle=this.backColor,a.strokeStyle=this.backColor),0==b?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill()):b==this.particleCount-2?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill()):(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(d.x,d.y),a.lineTo(c.x,c.y),a.closePath(),a.stroke(),a.fill())}},this.Side=function(a,b,c,d,e,f){return(a-c)\*(f-d)-(b-d)\*(e-c)}}var l=1/30,m=b/180,n=[["#771787","#239bb9"]];g.Lerp=function(a,b,c){return new g((b.x-a.x)\*c+a.x,(b.y-a.y)\*c+a.y)},g.Distance=function(a,b){return f(g.SqrDistance(a,b))},g.SqrDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c\*c+d\*d+z\*z},g.Scale=function(a,b){return new g(a.x\*b.x,a.y\*b.y)},g.Min=function(a,b){var c=Math.min;return new g(c(a.x,b.x),c(a.y,b.y))},g.Max=function(a,b){var c=Math.max;return new g(c(a.x,b.x),c(a.y,b.y))},g.ClampMagnitude=function(a,b){var c=a.Normalized;return new g(c.x\*b,c.y\*b)},g.Sub=function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},j.bounds=new g(0,0),k.bounds=new g(0,0),o={},o.Context=function(a){var b=0,c=document.getElementById(a),d=document.createElement("canvas");d.width=c.offsetWidth,d.height=c.offsetHeight,c.appendChild(d);var e=d.getContext("2d"),f=7,h=[];for(k.bounds=new g(d.width,d.height),b=0;b<f;b++)h[b]=new k(Math.random()\*d.width,2\*(-Math.random()\*d.height),30,8,8,45,1,.05);var m=[];for(j.bounds=new g(d.width,d.height),b=0;b<25;b++)m[b]=new j(Math.random()\*d.width,Math.random()\*d.height);this.resize=function(){d.width=c.offsetWidth,d.height=c.offsetHeight,j.bounds=new g(d.width,d.height),k.bounds=new g(d.width,d.height)},this.start=function(){this.stop();this.interval=setInterval(function(){o.update()},1e3/30)},this.stop=function(){clearInterval(this.interval)},this.update=function(){var a=0;for(e.clearRect(0,0,d.width,d.height),a=0;a<25;a++)m[a].Update(l),m[a].Draw(e);for(a=0;a<f;a++)h[a].Update(l),h[a].Draw(e)}};var o=new o.Context("confetti");o.start(),a(window).~~resize(function(){o.resize(~~)})}); |
  |  | 1 | jQuery(document).ready(function(a){var b=Math.PI,c=Math.sin,d=Math.cos,e=Math.round,f=Math.sqrt;function g(a,b){this.x=a,this.y=b,this.Length=function(){return f(this.SqrLength())},this.SqrLength=function(){return this.x\*this.x+this.y\*this.y},this.Equals=function(a,b){return a.x==b.x&&a.y==b.y},this.Add=function(a){this.x+=a.x,this.y+=a.y},this.Sub=function(a){this.x-=a.x,this.y-=a.y},this.Div=function(a){this.x/=a,this.y/=a},this.Mul=function(a){this.x\*=a,this.y\*=a},this.Normalize=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);this.x\*=b,this.y\*=b}},this.Normalized=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);return new g(this.x\*b,this.y\*b)}return new g(0,0)}}function h(a,b,c,d){this.position=new g(a,b),this.mass=c,this.drag=d,this.force=new g(0,0),this.velocity=new g(0,0),this.AddForce=function(a){this.force.Add(a)},this.Integrate=function(a){var b=this.CurrentForce(this.position);b.Div(this.mass);var c=new g(this.velocity.x,this.velocity.y);c.Mul(a),this.position.Add(c),b.Mul(a),this.velocity.Add(b),this.force=new g(0,0)},this.CurrentForce=function(){var a=new g(this.force.x,this.force.y),b=this.velocity.Length(),c=new g(this.velocity.x,this.velocity.y);return c.Mul(this.drag\*this.mass\*b),a.Sub(c),a}}function j(a,b){this.pos=new g(a,b),this.rotationSpeed=600\*Math.random()+800,this.angle=360\*(m\*Math.random()),this.rotation=360\*(m\*Math.random()),this.cosA=1,this.size=5,this.oscillationSpeed=1.5\*Math.random()+.5,this.xSpeed=40,this.ySpeed=60\*Math.random()+50,this.corners=[],this.time=Math.random();var f=e(Math.random()\*(n.length-1));this.frontColor=n[f][0],this.backColor=n[f][1];for(var h=0;4>h;h++){var k=d(this.angle+m\*(90\*h+45)),l=c(this.angle+m\*(90\*h+45));this.corners[h]=new g(k,l)}this.Update=function(a){this.time+=a,this.rotation+=this.rotationSpeed\*a,this.cosA=d(m\*this.rotation),this.pos.x+=d(this.time\*this.oscillationSpeed)\*this.xSpeed\*a,this.pos.y+=this.ySpeed\*a,this.pos.y>j.bounds.y&&(this.pos.x=Math.random()\*j.bounds.x,this.pos.y=0)},this.Draw=function(a){a.fillStyle=0<this.cosA?this.frontColor:this.backColor,a.beginPath(),a.moveTo(this.pos.x+this.corners[0].x\*this.size,this.pos.y+this.corners[0].y\*this.size\*this.cosA);for(var b=1;4>b;b++)a.lineTo(this.pos.x+this.corners[b].x\*this.size,this.pos.y+this.corners[b].y\*this.size\*this.cosA);a.closePath(),a.fill()}}function k(a,b,j,l,o,p,q,r){this.particleDist=l,this.particleCount=j,this.particleMass=q,this.particleDrag=r,this.particles=[];var s=e(Math.random()\*(n.length-1));this.frontColor=n[s][0],this.backColor=n[s][1],this.xOff=d(m\*p)\*o,this.yOff=c(m\*p)\*o,this.position=new g(a,b),this.prevPosition=new g(a,b),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+2,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;for(var t=0;t<this.particleCount;t++)this.particles[t]=new h(a,b-t\*this.particleDist,this.particleMass,this.particleDrag);this.Update=function(a){var b=0;this.time+=a\*this.oscillationSpeed,this.position.y+=this.ySpeed\*a,this.position.x+=d(this.time)\*this.oscillationDistance\*a,this.particles[0].position=this.position;var c=this.prevPosition.x-this.position.x,e=this.prevPosition.y-this.position.y,h=f(c\*c+e\*e);for(this.prevPosition=new g(this.position.x,this.position.y),b=1;b<this.particleCount;b++){var j=g.Sub(this.particles[b-1].position,this.particles[b].position);j.Normalize(),j.Mul(h/a\*this.velocityInherit),this.particles[b].AddForce(j)}for(b=1;b<this.particleCount;b++)this.particles[b].Integrate(a);for(b=1;b<this.particleCount;b++){var l=new g(this.particles[b].position.x,this.particles[b].position.y);l.Sub(this.particles[b-1].position),l.Normalize(),l.Mul(this.particleDist),l.Add(this.particles[b-1].position),this.particles[b].position=l}this.position.y>k.bounds.y+this.particleDist\*this.particleCount&&this.Reset()},this.Reset=function(){this.position.y=-Math.random()\*k.bounds.y,this.position.x=Math.random()\*k.bounds.x,this.prevPosition=new g(this.position.x,this.position.y),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+1.5,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;var a=e(Math.random()\*(n.length-1));this.frontColor=n[a][0],this.backColor=n[a][1],this.particles=[];for(var b=0;b<this.particleCount;b++)this.particles[b]=new h(this.position.x,this.position.y-b\*this.particleDist,this.particleMass,this.particleDrag)},this.Draw=function(a){for(var b=0;b<this.particleCount-1;b++){var c=new g(this.particles[b].position.x+this.xOff,this.particles[b].position.y+this.yOff),d=new g(this.particles[b+1].position.x+this.xOff,this.particles[b+1].position.y+this.yOff);0>this.Side(this.particles[b].position.x,this.particles[b].position.y,this.particles[b+1].position.x,this.particles[b+1].position.y,d.x,d.y)?(a.fillStyle=this.frontColor,a.strokeStyle=this.frontColor):(a.fillStyle=this.backColor,a.strokeStyle=this.backColor),0==b?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill()):b==this.particleCount-2?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill()):(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(d.x,d.y),a.lineTo(c.x,c.y),a.closePath(),a.stroke(),a.fill())}},this.Side=function(a,b,c,d,e,f){return(a-c)\*(f-d)-(b-d)\*(e-c)}}var l=1/30,m=b/180,n=[["#771787","#239bb9"]];g.Lerp=function(a,b,c){return new g((b.x-a.x)\*c+a.x,(b.y-a.y)\*c+a.y)},g.Distance=function(a,b){return f(g.SqrDistance(a,b))},g.SqrDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c\*c+d\*d+z\*z},g.Scale=function(a,b){return new g(a.x\*b.x,a.y\*b.y)},g.Min=function(a,b){var c=Math.min;return new g(c(a.x,b.x),c(a.y,b.y))},g.Max=function(a,b){var c=Math.max;return new g(c(a.x,b.x),c(a.y,b.y))},g.ClampMagnitude=function(a,b){var c=a.Normalized;return new g(c.x\*b,c.y\*b)},g.Sub=function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},j.bounds=new g(0,0),k.bounds=new g(0,0),o={},o.Context=function(a){var b=0,c=document.getElementById(a),d=document.createElement("canvas");d.width=c.offsetWidth,d.height=c.offsetHeight,c.appendChild(d);var e=d.getContext("2d"),f=7,h=[];for(k.bounds=new g(d.width,d.height),b=0;b<f;b++)h[b]=new k(Math.random()\*d.width,2\*(-Math.random()\*d.height),30,8,8,45,1,.05);var m=[];for(j.bounds=new g(d.width,d.height),b=0;b<25;b++)m[b]=new j(Math.random()\*d.width,Math.random()\*d.height);this.resize=function(){d.width=c.offsetWidth,d.height=c.offsetHeight,j.bounds=new g(d.width,d.height),k.bounds=new g(d.width,d.height)},this.start=function(){this.stop();this.interval=setInterval(function(){o.update()},1e3/30)},this.stop=function(){clearInterval(this.interval)},this.update=function(){var a=0;for(e.clearRect(0,0,d.width,d.height),a=0;a<25;a++)m[a].Update(l),m[a].Draw(e);for(a=0;a<f;a++)h[a].Update(l),h[a].Draw(e)}};var o=new o.Context("confetti");o.start(),a(window).on("resize",function(){o.trigger("resize")})}); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.js")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js?rev=3053443#L111 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.js?rev=3076105#L111 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 111 | 111 |  |
  | 112 | 112 | // danger zone tools |
  | 113 |  | $( ~~'#debug-tools .number-tools-btn' ).click(~~ function( event ) { |
  |  | 113 | $( document.body ).on( 'click', '#debug-tools .number-tools-btn', function( event ) { |
  | 114 | 114 | event.preventDefault(); |
  | 115 | 115 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.min.js")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js?rev=3053443#L1 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/debug-script.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(function(a){function b(b,c,d){let e=d.find("fieldset > .notice");switch(e.hide(),e.removeClass("notice-error"),e.removeClass("notice-success"),b){case"export\_settings":if(c.success&&c.data.filename&&c.data.settings){d.find(".download\_file").remove();let b={type:d.find("select[name=\"type\"").val(),settings:c.data.settings};b="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(b)),d.append(a("<div class=\"download\_file\"><label>"+wpo\_wcpdf\_debug.download\_label+":</label> <a href=\"data:"+b+"\" download=\""+c.data.filename+"\">"+c.data.filename+"</a></div>"))}else!c.success&&c.data.message&&(e.addClass("notice-error"),e.find("p").text(c.data.message),e.show());break;default:c.success&&c.data.message?e.addClass("notice-success"):!c.success&&c.data.message&&e.addClass("notice-error"),e.find("p").text(c.data.message),e.show()}}function c(b,d,e,f,g,h,i){let j={action:"wpo\_wcpdf\_danger\_zone\_tools",delete\_or\_renumber:i,document\_type:b,date\_type:d,date\_from:e,date\_to:f,page\_count:g,document\_count:h,nonce:wpo\_wcpdf\_debug.nonce};a.ajax({type:"POST",url:wpo\_wcpdf\_debug.ajaxurl,data:j,dataType:"json",success:function(j){if(!1===j.data.finished)g=j.data.pageCount,h=j.data.documentCount,c(b,d,e,f,g,h,i);else{a(".renumber-spinner, .delete-spinner").css("visibility","hidden"),a("#renumber-documents-btn, #delete-documents-btn").removeAttr("disabled"),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!1);let b=j.data.message;alert(h+b)}},error:function(a,b,c){alert(a.status+":"+c)}})}if(a("#debug-tools .tool").on("click","input[type=\"submit\"]",function(c){c.preventDefault();let d=a(this).closest("form"),e=d.find("input[name=\"debug\_tool\"]").val(),f=new FormData(d[0]);f.append("action","wpo\_wcpdf\_debug\_tools"),f.append("nonce",wpo\_wcpdf\_debug.nonce),d.closest(".tool").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let g=!1;g="reset-settings"!==e||window.confirm(wpo\_wcpdf\_debug.confirm\_reset),g&&a.ajax({url:wpo\_wcpdf\_debug.ajaxurl,data:f,type:"POST",cache:!1,processData:!1,contentType:!1,success(a){b(e,a,d)},error(){}}),d.closest(".tool").unblock()}),a("[name='wpo\_wcpdf\_settings\_debug[document\_access\_denied\_redirect\_page]']").on("change",function(){let b=a(this).closest("table").find("#document\_custom\_redirect\_page"),c=b.closest("td").find(".description");"custom\_page"===a(this).val()?(b.show(),c.show()):(b.hide(),c.hide())}).trigger("change"),!0===wpo\_wcpdf\_debug.danger\_zone.enabled){let b="<div class=\"notice notice-warning inline\"><p>"+wpo\_wcpdf\_debug.danger\_zone.message+"</p></div>";a("input#enable\_danger\_zone\_tools").closest("td").find(".description").append(b)}a(document.body).on("click","#wpo-wcpdf-settings a.number-search-button",function(b){b.preventDefault();let c=a(this).closest("div").find(":input[name=\"number\_search\_input\"]").val();window.location.href=window.location.href+"&s="+c}),a("#renumber-date-from, #renumber-date-to, #delete-date-from, #delete-date-to").datepicker({dateFormat:"yy-mm-dd"}),a(~~"#debug-tools .number-tools-btn").click(~~function(b){b.preventDefault();let d="",e="",f="",g="";return"renumber-documents-btn"===this.id?(d=a("#renumber-document-type").val(),dateType=a("#renumber-date-type").val(),e=a("#renumber-date-from").val(),f=a("#renumber-date-to").val(),g="renumber"):"delete-documents-btn"===this.id&&(d=a("#delete-document-type").val(),dateType=a("#delete-date-type").val(),e=a("#delete-date-from").val(),f=a("#delete-date-to").val(),g="delete"),""===d||"undefined"===d?void alert(wpo\_wcpdf\_debug.select\_document\_type):void("renumber"===g?a(".renumber-spinner").css("visibility","visible"):"delete"===g&&a(".delete-spinner").css("visibility","visible"),a("#renumber-documents-btn, #delete-documents-btn").attr("disabled",!0),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!0),c(d,dateType,e,f,1,0,g))}),a("#debug-tools #delete-document-type").on("change",function(b){b.preventDefault(),"all"===a(this).val()?a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!0):a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change"),a("#debug-tools #delete-date-type").on("change",function(b){b.preventDefault();let c=a(this).closest("form").find("#delete-document-type");""===c.val()||"all"===c.val()?a(this).find("option[value=\"document\_date\"]").prop("disabled",!0):a(this).find("option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change")}); |
  |  | 1 | jQuery(function(a){function b(b,c,d){let e=d.find("fieldset > .notice");switch(e.hide(),e.removeClass("notice-error"),e.removeClass("notice-success"),b){case"export\_settings":if(c.success&&c.data.filename&&c.data.settings){d.find(".download\_file").remove();let b={type:d.find("select[name=\"type\"").val(),settings:c.data.settings};b="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(b)),d.append(a("<div class=\"download\_file\"><label>"+wpo\_wcpdf\_debug.download\_label+":</label> <a href=\"data:"+b+"\" download=\""+c.data.filename+"\">"+c.data.filename+"</a></div>"))}else!c.success&&c.data.message&&(e.addClass("notice-error"),e.find("p").text(c.data.message),e.show());break;default:c.success&&c.data.message?e.addClass("notice-success"):!c.success&&c.data.message&&e.addClass("notice-error"),e.find("p").text(c.data.message),e.show()}}function c(b,d,e,f,g,h,i){let j={action:"wpo\_wcpdf\_danger\_zone\_tools",delete\_or\_renumber:i,document\_type:b,date\_type:d,date\_from:e,date\_to:f,page\_count:g,document\_count:h,nonce:wpo\_wcpdf\_debug.nonce};a.ajax({type:"POST",url:wpo\_wcpdf\_debug.ajaxurl,data:j,dataType:"json",success:function(j){if(!1===j.data.finished)g=j.data.pageCount,h=j.data.documentCount,c(b,d,e,f,g,h,i);else{a(".renumber-spinner, .delete-spinner").css("visibility","hidden"),a("#renumber-documents-btn, #delete-documents-btn").removeAttr("disabled"),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!1);let b=j.data.message;alert(h+b)}},error:function(a,b,c){alert(a.status+":"+c)}})}if(a("#debug-tools .tool").on("click","input[type=\"submit\"]",function(c){c.preventDefault();let d=a(this).closest("form"),e=d.find("input[name=\"debug\_tool\"]").val(),f=new FormData(d[0]);f.append("action","wpo\_wcpdf\_debug\_tools"),f.append("nonce",wpo\_wcpdf\_debug.nonce),d.closest(".tool").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let g=!1;g="reset-settings"!==e||window.confirm(wpo\_wcpdf\_debug.confirm\_reset),g&&a.ajax({url:wpo\_wcpdf\_debug.ajaxurl,data:f,type:"POST",cache:!1,processData:!1,contentType:!1,success(a){b(e,a,d)},error(){}}),d.closest(".tool").unblock()}),a("[name='wpo\_wcpdf\_settings\_debug[document\_access\_denied\_redirect\_page]']").on("change",function(){let b=a(this).closest("table").find("#document\_custom\_redirect\_page"),c=b.closest("td").find(".description");"custom\_page"===a(this).val()?(b.show(),c.show()):(b.hide(),c.hide())}).trigger("change"),!0===wpo\_wcpdf\_debug.danger\_zone.enabled){let b="<div class=\"notice notice-warning inline\"><p>"+wpo\_wcpdf\_debug.danger\_zone.message+"</p></div>";a("input#enable\_danger\_zone\_tools").closest("td").find(".description").append(b)}a(document.body).on("click","#wpo-wcpdf-settings a.number-search-button",function(b){b.preventDefault();let c=a(this).closest("div").find(":input[name=\"number\_search\_input\"]").val();window.location.href=window.location.href+"&s="+c}),a("#renumber-date-from, #renumber-date-to, #delete-date-from, #delete-date-to").datepicker({dateFormat:"yy-mm-dd"}),a(document.body).on("click","#debug-tools .number-tools-btn",function(b){b.preventDefault();let d="",e="",f="",g="";return"renumber-documents-btn"===this.id?(d=a("#renumber-document-type").val(),dateType=a("#renumber-date-type").val(),e=a("#renumber-date-from").val(),f=a("#renumber-date-to").val(),g="renumber"):"delete-documents-btn"===this.id&&(d=a("#delete-document-type").val(),dateType=a("#delete-date-type").val(),e=a("#delete-date-from").val(),f=a("#delete-date-to").val(),g="delete"),""===d||"undefined"===d?void alert(wpo\_wcpdf\_debug.select\_document\_type):void("renumber"===g?a(".renumber-spinner").css("visibility","visible"):"delete"===g&&a(".delete-spinner").css("visibility","visible"),a("#renumber-documents-btn, #delete-documents-btn").attr("disabled",!0),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!0),c(d,dateType,e,f,1,0,g))}),a("#debug-tools #delete-document-type").on("change",function(b){b.preventDefault(),"all"===a(this).val()?a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!0):a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change"),a("#debug-tools #delete-date-type").on("change",function(b){b.preventDefault();let c=a(this).closest("form").find("#delete-document-type");""===c.val()||"all"===c.val()?a(this).find("option[value=\"document\_date\"]").prop("disabled",!0):a(this).find("option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change")}); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L6 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105#L6 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | // Uploading files |
  | 7 | 7 | var file\_frame; |
  |  | 8 | let $settings\_wrapper; |
  |  | 9 |  |
  |  | 10 | // This function returns the translatable media input field in case translation is present. |
  |  | 11 | // If the translation is not present, the function will return the media input field. |
  |  | 12 | let get\_media\_field = function( self, settings\_wrapper, element\_id ) { |
  |  | 13 | let $input = $( '#wpo-wcpdf-settings' ).find( element\_id ).filter( function() { |
  |  | 14 | let parent = self.parent( 'div' ); |
  |  | 15 | return parent.length && parent.attr( 'aria-hidden' ) === 'false'; |
  |  | 16 | } ); |
  |  | 17 |  |
  |  | 18 | return $input.length ? $input : settings\_wrapper.find( element\_id ); |
  |  | 19 | }; |
  |  | 20 |  |
  | 8 | 21 | $( '#wpo-wcpdf-settings, .wpo-wcpdf-setup' ).on( 'click', '.wpo\_upload\_image\_button', function( event ){ |
  | 9 | 22 | event.preventDefault(); |
  | 10 | 23 |  |
  | 11 | 24 | // get input wrapper |
  | 12 |  | ~~let $settings\_wrapper = $(this~~).parent(); |
  |  | 25 | $settings\_wrapper = $( this ).parent(); |
  | 13 | 26 |  |
  | 14 | 27 | // If the media frame already exists, reopen it. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L30) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105#L43) |  |
  | 30 | 43 | file\_frame.on( 'select', function() { |
  | 31 | 44 | // get target elements |
  | 32 |  | let $input   = ~~$settings\_wrapper.find(~~ 'input.media-upload-id' ); |
  | 33 |  | let $preview = ~~$settings\_wrapper.find(~~ 'img.media-upload-preview' ); |
  | 34 |  |  |
  |  | 45 | let $input   = get\_media\_field( $( this ), $settings\_wrapper, 'input.media-upload-id' ); |
  |  | 46 | let $preview = get\_media\_field( $( this ), $settings\_wrapper, 'img.media-upload-preview' ); |
  |  | 47 |  |
  | 35 | 48 | // We set multiple to false so only get one image from the uploader |
  | 36 | 49 | let attachment = file\_frame.state().get( 'selection' ).first().toJSON(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L41) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105#L54) |  |
  | 41 | 54 | $preview.attr( 'src', attachment.url ); |
  | 42 | 55 | } |
  | 43 |  | ~~$( '.attachment-resolution, .attachment-resolution-warning' ).remove();~~ |
  | 44 | 56 |  |
  | 45 |  | // dim until we have a response |
  | 46 |  | $settings\_wrapper.css( 'opacity', '0.25' ); |
  |  | 57 | get\_media\_field( $( this ), $settings\_wrapper, '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  |  | 58 |  |
  |  | 59 | // Block the media upload UI until we have a response. |
  |  | 60 | $settings\_wrapper.parent().block( { |
  |  | 61 | message: null, |
  |  | 62 | overlayCSS: { |
  |  | 63 | background: '#fff', |
  |  | 64 | opacity: 0.6 |
  |  | 65 | } |
  |  | 66 | } ); |
  | 47 | 67 |  |
  | 48 | 68 | let data = { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L62) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105#L82) |  |
  | 62 | 82 | } |
  | 63 | 83 | $settings\_wrapper.removeAttr( 'style' ); |
  |  | 84 | $settings\_wrapper.parent().unblock(); |
  | 64 | 85 |  |
  | 65 | 86 | // custom trigger |
  | 66 |  | $input = ~~$settings\_wrapper.find(~~ 'input.media-upload-id' ); |
  |  | 87 | $input = get\_media\_field( $( this ), $settings\_wrapper, 'input.media-upload-id' ); |
  | 67 | 88 | $( document.body ).trigger( 'wpo-wcpdf-media-upload-setting-updated', [ $input ] ); |
  | 68 | 89 | }, |
  | 69 | 90 | error: function (xhr, ajaxOptions, thrownError) { |
  | 70 |  | $settings\_wrapper.~~removeAttr( 'style' );~~ |
  |  | 91 | $settings\_wrapper.parent().unblock(); |
  | 71 | 92 | } |
  | 72 | 93 | }); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L88) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.js?rev=3076105#L109) |  |
  | 88 | 109 | $preview.remove(); |
  | 89 | 110 | $( this ).remove(); |
  | 90 |  | ~~$(~~ '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  | 91 |  | }); |
  |  | 111 | get\_media\_field( $( this ), $settings\_wrapper, '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  |  | 112 | }); |
  | 92 | 113 | }); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.min.js")

  | [r2690195](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js?rev=2690195#L1 "Show revision 2690195 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/assets/js/media-upload.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(document).ready(function(a){var b;~~a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_upload\_image\_button",function(c){c.preventDefault();let d=a(this).parent();return b?void b.open():void(b=wp.media.frames.file\_frame=wp.media({title:a(this).data("uploader\_title"),button:{text:a(this).data("uploader\_button\_text")},multiple:!1}),b.on("select",function(){let c=d.find("input.media-upload-id"),e=d.find("img.media-upload-preview"),f=b.state().get("selection").first().toJSON();c.val(f.id),e.length&&e.attr("src",f.url),a(".attachment-resolution, .attachment-resolution-warning").remove(),d.css("opacity","0.25");let g={security:c.data("ajax\_nonce"),action:"wpo\_wcpdf\_get\_media\_upload\_setting\_html",args:c.data("settings\_callback\_args"),attachment\_id:f.id};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(b){b&&"undefined"!=typeof b.success&&!0===b.success&&d.html(b.data),d.removeAttr("style"),c=d.find("input.media-upload-id"),a(document.body).trigger("wpo-wcpdf-media-upload-setting-updated",[c])},error:function(){d.removeAttr("style")}})}),b.open())}),a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_remove\_image\_button",function(){let b=a(this).parent(),c=b.find("input.media-upload-id"),d=b.find("img.media-upload-preview");c.val(""),d.remove(),a(this).remove(),a(~~".attachment-resolution, .attachment-resolution-warning").remove()})}); |
  |  | 1 | jQuery(document).ready(function(a){var b;let c,d=function(b,c,d){let e=a("#wpo-wcpdf-settings").find(d).filter(function(){let a=b.parent("div");return a.length&&"false"===a.attr("aria-hidden")});return e.length?e:c.find(d)};a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_upload\_image\_button",function(e){return e.preventDefault(),c=a(this).parent(),b?void b.open():void(b=wp.media.frames.file\_frame=wp.media({title:a(this).data("uploader\_title"),button:{text:a(this).data("uploader\_button\_text")},multiple:!1}),b.on("select",function(){let e=d(a(this),c,"input.media-upload-id"),f=d(a(this),c,"img.media-upload-preview"),g=b.state().get("selection").first().toJSON();e.val(g.id),f.length&&f.attr("src",g.url),d(a(this),c,".attachment-resolution, .attachment-resolution-warning").remove(),c.parent().block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let h={security:e.data("ajax\_nonce"),action:"wpo\_wcpdf\_get\_media\_upload\_setting\_html",args:e.data("settings\_callback\_args"),attachment\_id:g.id};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:h,success:function(b){b&&"undefined"!=typeof b.success&&!0===b.success&&c.html(b.data),c.removeAttr("style"),c.parent().unblock(),e=d(a(this),c,"input.media-upload-id"),a(document.body).trigger("wpo-wcpdf-media-upload-setting-updated",[e])},error:function(){c.parent().unblock()}})}),b.open())}),a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_remove\_image\_button",function(){let b=a(this).parent(),c=b.find("input.media-upload-id"),e=b.find("img.media-upload-preview");c.val(""),e.remove(),a(this).remove(),d(a(this),b,".attachment-resolution, .attachment-resolution-warning").remove()})}); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-main.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-main.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-main.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php?rev=3053443#L180 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-main.php?rev=3076105#L180 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 180 | 180 |  |
  | 181 | 181 | $attach\_to\_document\_types = $this->get\_documents\_for\_email( $email\_id, $order ); |
  | 182 |  | $lock                     = new Semaphore( $this->lock\_name, $this->lock\_time, $this->lock\_loggers, $this->lock\_context ); |
  |  | 182 | $lock                     = new Semaphore( $this->lock\_name . "\_order\_{$order\_id}\_email\_{$email\_id}", $this->lock\_time, $this->lock\_loggers, $this->lock\_context ); |
  | 183 | 183 |  |
  | 184 | 184 | if ( $lock->lock( $this->lock\_retries ) ) { |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php")

  | [r3028352](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3028352#L438 "Show revision 3028352 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php?rev=3076105#L438 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 438 | 438 | $order\_id                              = is\_callable( array( $order, 'get\_id' ) ) ? $order->get\_id() : 0; |
  | 439 | 439 | $data[$order\_id]['order\_number']       = is\_callable( array( $order, 'get\_order\_number' ) ) ? $order->get\_order\_number() : ''; |
  | 440 |  | $data[$order\_id]['billing\_first\_name'] = is\_callable( array( $order, 'get\_billing\_first\_name' ) ) ? ~~$order->get\_billing\_first\_name(~~) : ''; |
  | 441 |  | $data[$order\_id]['billing\_last\_name']  = is\_callable( array( $order, 'get\_billing\_last\_name' ) ) ? ~~$order->get\_billing\_last\_name(~~) : ''; |
  | 442 |  | $data[$order\_id]['billing\_company']    = is\_callable( array( $order, 'get\_billing\_company' ) ) ? ~~$order->get\_billing\_company(~~) : ''; |
  |  | 440 | $data[$order\_id]['billing\_first\_name'] = is\_callable( array( $order, 'get\_billing\_first\_name' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_first\_name(), 'first\_name' ) : ''; |
  |  | 441 | $data[$order\_id]['billing\_last\_name']  = is\_callable( array( $order, 'get\_billing\_last\_name' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_last\_name(), 'last\_name' ) : ''; |
  |  | 442 | $data[$order\_id]['billing\_company']    = is\_callable( array( $order, 'get\_billing\_company' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_company(), 'company' ) : ''; |
  | 443 | 443 | $data[$order\_id]['date\_created']       = is\_callable( array( $order, 'get\_date\_created' ) ) ? '<strong>' . esc\_attr\_\_( 'Date', 'woocommerce-pdf-invoices-packing-slips' ) . ':</strong> ' . $order->get\_date\_created()->format( 'Y/m/d' ) : ''; |
  | 444 | 444 | $data[$order\_id]['total']              = is\_callable( array( $order, 'get\_total' ) ) ? '<strong>' . esc\_attr\_\_( 'Total', 'woocommerce-pdf-invoices-packing-slips' ) . ':</strong> ' . wc\_price( $order->get\_total() ) : ''; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3028352#L970) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/class-wcpdf-settings.php?rev=3076105#L970) |  |
  | 970 | 970 | $args['current'] = absint( $\_POST['attachment\_id'] ); |
  | 971 | 971 |  |
  |  | 972 | if ( isset( $args['translatable'] ) ) { |
  |  | 973 | $args['translatable'] = wc\_string\_to\_bool( $args['translatable'] ); |
  |  | 974 | } |
  |  | 975 |  |
  | 972 | 976 | // get settings HTML |
  | 973 | 977 | ob\_start(); |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php")

  | [r2953838](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=2953838#L27 "Show revision 2953838 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105#L27 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | if ( version\_compare( \WC\_Subscriptions::$version, '2.0', '<' ) ) { |
  | 28 | 28 | add\_action( 'woocommerce\_subscriptions\_renewal\_order\_created', array( $this, 'woocommerce\_subscriptions\_renewal\_order\_created' ), 10, 4 ); |
  | 29 |  | } elseif ( version\_compare( \WC\_Subscriptions::$version, '~~2.5~~', '<' ) ) { |
  |  | 29 | } elseif ( version\_compare( \WC\_Subscriptions::$version, '4.7.0', '<' ) ) { |
  | 30 | 30 | add\_filter( 'wcs\_renewal\_order\_meta', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 31 | 31 | add\_filter( 'wcs\_resubscribe\_order\_meta', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 32 | 32 | } else { |
  | 33 |  | add\_filter( 'wc\_subscription\_renewal\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  |  | 33 | add\_filter( 'wc\_subscriptions\_renewal\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 34 | 34 | add\_filter( 'wc\_subscriptions\_resubscribe\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 35 | 35 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=2953838#L92) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105#L92) |  |
  | 92 | 92 | \* Removes documents meta from WooCommerce Subscriptions renewal order |
  | 93 | 93 | \*/ |
  | 94 |  | public function wcs\_renewal\_order\_meta ( $meta, $to\_order, $from\_order ) { |
  | 95 |  | if ( ! empty( $meta ) ) { |
  | 96 |  | $documents      = WPO\_WCPDF()->documents->get\_documents(); |
  | 97 |  | $documents\_meta = array(); |
  | 98 |  |  |
  | 99 |  | foreach ( $documents as $document ) { |
  | 100 |  | $document\_data\_keys = apply\_filters( 'wpo\_wcpdf\_delete\_document\_data\_keys', array( |
  | 101 |  | 'settings', |
  | 102 |  | 'date', |
  | 103 |  | 'date\_formatted', |
  | 104 |  | 'number', |
  | 105 |  | 'number\_data', |
  | 106 |  | 'notes', |
  | 107 |  | 'exists', |
  | 108 |  | ), $document ); |
  | 109 |  |  |
  | 110 |  | $document\_meta      = array\_map( function ( $data\_key ) use ( $document ) { |
  | 111 |  | return "\_wcpdf\_{$document->slug}\_{$data\_key}"; |
  | 112 |  | }, $document\_data\_keys ); |
  | 113 |  | $document\_meta[]    = "\_wcpdf\_formatted\_{$document->slug}\_number"; // legacy meta key |
  | 114 |  | $documents\_meta     = array\_merge( $documents\_meta, $document\_meta ); |
  | 115 |  | } |
  | 116 |  |  |
  | 117 |  | foreach ( $meta as $key => $value ) { |
  | 118 |  | if ( in\_array( $value['meta\_key'], $documents\_meta ) ) { |
  | 119 |  | unset( $meta[$key] ); |
  | 120 |  | } |
  | 121 |  | } |
  | 122 |  | } |
  |  | 94 | public function wcs\_renewal\_order\_meta( $meta, $to\_order, $from\_order ) { |
  |  | 95 | if ( empty( $meta ) ) { |
  |  | 96 | return $meta; |
  |  | 97 | } |
  |  | 98 |  |
  |  | 99 | $documents      = WPO\_WCPDF()->documents->get\_documents(); |
  |  | 100 | $documents\_meta = array(); |
  |  | 101 |  |
  |  | 102 | foreach ( $documents as $document ) { |
  |  | 103 | $document\_data\_keys = apply\_filters( 'wpo\_wcpdf\_delete\_document\_data\_keys', array( |
  |  | 104 | 'settings', |
  |  | 105 | 'date', |
  |  | 106 | 'date\_formatted', |
  |  | 107 | 'number', |
  |  | 108 | 'number\_data', |
  |  | 109 | 'notes', |
  |  | 110 | 'exists', |
  |  | 111 | ), $document ); |
  |  | 112 |  |
  |  | 113 | $document\_meta   = array\_map( function ( $data\_key ) use ( $document ) { |
  |  | 114 | return "\_wcpdf\_{$document->slug}\_{$data\_key}"; |
  |  | 115 | }, $document\_data\_keys ); |
  |  | 116 | $document\_meta[] = "\_wcpdf\_formatted\_{$document->slug}\_number"; // legacy meta key |
  |  | 117 | $documents\_meta  = array\_merge( $documents\_meta, $document\_meta ); |
  |  | 118 | } |
  |  | 119 |  |
  |  | 120 | foreach ( $meta as $key => $value ) { |
  |  | 121 | // The old deprecated hook (`wcs\_renewal\_order\_meta`) sends $meta with this data structure: array(... , array( "meta\_key":"\_wcpdf\_invoice\_number","meta\_value":"158" ), ...) |
  |  | 122 | // The new hook (`wc\_subscriptions\_renewal\_order\_data`) sends $meta with this data structure: array(... ,"\_wcpdf\_invoice\_number":"158", ...) |
  |  | 123 | $meta\_key = is\_array( $value ) ? ( $value['meta\_key'] ?? null ) : $key; |
  |  | 124 | if ( in\_array( $meta\_key, $documents\_meta, true ) ) { |
  |  | 125 | unset( $meta[ $key ] ); |
  |  | 126 | } |
  |  | 127 | } |
  |  | 128 |  |
  | 123 | 129 | return $meta; |
  | 124 | 130 | } |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L18 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L18 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 |  |
  | 19 | 19 | public function is\_refund( $order ) { |
  | 20 |  | return ~~$order->get\_type() == 'shop\_order\_refund'~~; |
  |  | 20 | return 'shop\_order\_refund' === $order->get\_type(); |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L83) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L83) |  |
  | 83 | 83 | if ( $this->is\_refund( $this->order ) ) { |
  | 84 | 84 | // temporarily switch order to make all filters / order calls work correctly |
  | 85 |  | $refund = $this->order; |
  |  | 85 | $refund      = $this->order; |
  | 86 | 86 | $this->order = $this->get\_refund\_parent( $this->order ); |
  | 87 |  | $address ~~= apply\_filters( 'wpo\_wcpdf\_billing\_address', $this->order->get\_formatted\_billing\_address(), $this~~ ); |
  |  | 87 | $address     = $this->order->get\_formatted\_billing\_address(); |
  | 88 | 88 | // switch back & unset |
  | 89 | 89 | $this->order = $refund; |
  | 90 |  | unset(~~$refund~~); |
  | 91 |  | } else~~if ( $address = $this->order->get\_formatted\_billing\_address() )~~ { |
  |  | 90 | unset( $refund ); |
  |  | 91 | } else { |
  | 92 | 92 | // regular shop\_order |
  | 93 |  | $address = apply\_filters( 'wpo\_wcpdf\_billing\_address', $address, $this ); |
  | 94 |  | } else { |
  | 95 |  | // no address |
  | 96 |  | $address = apply\_filters( 'wpo\_wcpdf\_billing\_address', \_\_('N/A', 'woocommerce-pdf-invoices-packing-slips' ), $this ); |
  | 97 |  | } |
  | 98 |  |  |
  | 99 |  | return $address; |
  |  | 93 | $address = $this->order->get\_formatted\_billing\_address(); |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | // no address |
  |  | 97 | if ( empty( $address ) ) { |
  |  | 98 | $address = \_\_( 'N/A', 'woocommerce-pdf-invoices-packing-slips' ); |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | return apply\_filters( 'wpo\_wcpdf\_billing\_address', wpo\_wcpdf\_sanitize\_html\_content( $address, 'address' ), $this ); |
  | 100 | 102 | } |
  | 101 | 103 | public function billing\_address() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L107) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L109) |  |
  | 107 | 109 | \*/ |
  | 108 | 110 | public function show\_billing\_address() { |
  | 109 |  | if~~( $this->get\_type() != 'packing-slip'~~ ) { |
  |  | 111 | if ( 'packing-slip' !== $this->get\_type() ) { |
  | 110 | 112 | return true; |
  | 111 | 113 | } else { |
  | 112 |  | return ! empty( $this->settings['display\_billing\_address'] ) && ( $this->ships\_to\_different\_address() || ~~$this->settings['display\_billing\_address'] == 'always'~~ ); |
  |  | 114 | return ! empty( $this->settings['display\_billing\_address'] ) && ( $this->ships\_to\_different\_address() || 'always' === $this->settings['display\_billing\_address'] ); |
  | 113 | 115 | } |
  | 114 | 116 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L128) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L130) |  |
  | 128 | 130 | } |
  | 129 | 131 |  |
  | 130 |  | return apply\_filters( 'wpo\_wcpdf\_billing\_email', ~~$billing\_email~~, $this ); |
  |  | 132 | return apply\_filters( 'wpo\_wcpdf\_billing\_email', sanitize\_email( $billing\_email ), $this ); |
  | 131 | 133 | } |
  | 132 | 134 | public function billing\_email() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L143) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L145) |  |
  | 143 | 145 | $phone  = is\_callable( array( $order, $getter ) ) ? call\_user\_func( array( $order, $getter ) ) : $phone; |
  | 144 | 146 | } |
  | 145 |  | return $phone; |
  |  | 147 |  |
  |  | 148 | return wpo\_wcpdf\_sanitize\_phone\_number( $phone ); |
  | 146 | 149 | } |
  | 147 | 150 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L177) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L180) |  |
  | 177 | 180 | if ( $this->is\_refund( $this->order ) ) { |
  | 178 | 181 | // temporarily switch order to make all filters / order calls work correctly |
  | 179 |  | $refund = $this->order; |
  |  | 182 | $refund      = $this->order; |
  | 180 | 183 | $this->order = $this->get\_refund\_parent( $this->order ); |
  | 181 |  | $address ~~= apply\_filters( 'wpo\_wcpdf\_shipping\_address', $this->order->get\_formatted\_shipping\_address(), $this~~ ); |
  |  | 184 | $address     = $this->order->get\_formatted\_shipping\_address(); |
  | 182 | 185 | // switch back & unset |
  | 183 | 186 | $this->order = $refund; |
  | 184 |  | unset(~~$refund~~); |
  | 185 |  | } else~~if ( $address = $this->order->get\_formatted\_shipping\_address() )~~ { |
  |  | 187 | unset( $refund ); |
  |  | 188 | } else { |
  | 186 | 189 | // regular shop\_order |
  | 187 |  | $address = apply\_filters( 'wpo\_wcpdf\_shipping\_address', $address, $this ); |
  | 188 |  | } else { |
  | 189 |  | // no address |
  |  | 190 | $address = $this->order->get\_formatted\_shipping\_address(); |
  |  | 191 |  |
  | 190 | 192 | // use fallback for packing slip |
  | 191 |  | if ( ~~apply\_filters( 'wpo\_wcpdf\_shipping\_address\_fallback', ( $this->get\_type() == 'packing-slip'~~ ), $this ) ) { |
  |  | 193 | if ( empty( $address ) && apply\_filters( 'wpo\_wcpdf\_shipping\_address\_fallback', ( 'packing-slip' === $this->get\_type() ), $this ) ) { |
  | 192 | 194 | $address = $this->get\_billing\_address(); |
  | 193 |  | } else{ |
  | 194 |  | $address = apply\_filters( 'wpo\_wcpdf\_shipping\_address', \_\_('N/A', 'woocommerce-pdf-invoices-packing-slips' ), $this ); |
  | 195 |  |  |
  | 196 |  | } |
  | 197 |  | } |
  | 198 |  |  |
  | 199 |  | return $address; |
  |  | 195 | } |
  |  | 196 | } |
  |  | 197 |  |
  |  | 198 | // no address |
  |  | 199 | if ( empty( $address ) ) { |
  |  | 200 | $address = \_\_( 'N/A', 'woocommerce-pdf-invoices-packing-slips' ); |
  |  | 201 | } |
  |  | 202 |  |
  |  | 203 | return apply\_filters( 'wpo\_wcpdf\_shipping\_address', wpo\_wcpdf\_sanitize\_html\_content( $address, 'address' ), $this ); |
  | 200 | 204 | } |
  | 201 | 205 | public function shipping\_address() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L207) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L211) |  |
  | 207 | 211 | \*/ |
  | 208 | 212 | public function show\_shipping\_address() { |
  | 209 |  | if~~( $this->get\_type() != 'packing-slip'~~ ) { |
  | 210 |  | return ! empty( $this->settings['display\_shipping\_address'] ) && ( $this->ships\_to\_different\_address() || ~~$this->settings['display\_shipping\_address'] == 'always'~~ ); |
  |  | 213 | if ( 'packing-slip' !== $this->get\_type() ) { |
  |  | 214 | return ! empty( $this->settings['display\_shipping\_address'] ) && ( $this->ships\_to\_different\_address() || 'always' === $this->settings['display\_shipping\_address'] ); |
  | 211 | 215 | } else { |
  | 212 | 216 | return true; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L227) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L231) |  |
  | 227 | 231 |  |
  | 228 | 232 | // WC3.0 fallback to properties |
  | 229 |  | $property = str\_replace(~~'-', '\_', sanitize\_title( ltrim($field\_name, '\_'~~) ) ); |
  |  | 233 | $property = str\_replace( '-', '\_', sanitize\_title( ltrim( $field\_name, '\_' ) ) ); |
  | 230 | 234 | if ( empty( $custom\_field ) && is\_callable( array( $this->order, "get\_{$property}" ) ) ) { |
  | 231 | 235 | $custom\_field = $this->order->{"get\_{$property}"}( 'view' ); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L249) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L253) |  |
  | 249 | 253 | public function custom\_field( $field\_name, $field\_label = '', $display\_empty = false ) { |
  | 250 | 254 | $custom\_field = $this->get\_custom\_field( $field\_name ); |
  | 251 |  | if (!empty($field\_label)){ |
  |  | 255 |  |
  |  | 256 | if ( ! empty( $field\_label ) ) { |
  | 252 | 257 | // add a a trailing space to the label |
  | 253 | 258 | $field\_label .= ' '; |
  | 254 | 259 | } |
  | 255 | 260 |  |
  | 256 |  | if (!empty($custom\_field) || $display\_empty) { |
  |  | 261 | if ( ! empty( $custom\_field ) || $display\_empty ) { |
  |  | 262 | $allow\_tags = array( |
  |  | 263 | 'p'    => array(), |
  |  | 264 | 'span' => array(), |
  |  | 265 | 'ul'   => array(), |
  |  | 266 | 'ol'   => array(), |
  |  | 267 | 'li'   => array(), |
  |  | 268 | ); |
  |  | 269 |  |
  | 257 | 270 | if ( is\_array( $custom\_field ) ) { |
  |  | 271 | $custom\_field = array\_map( function( $field ) use ( $allow\_tags ) { |
  |  | 272 | return wpo\_wcpdf\_sanitize\_html\_content( $field, 'custom\_field', $allow\_tags ); |
  |  | 273 | }, $custom\_field ); |
  | 258 | 274 | echo $field\_label . implode( '<br>', $custom\_field ); |
  | 259 | 275 | } else { |
  |  | 276 | $custom\_field = wpo\_wcpdf\_sanitize\_html\_content( $custom\_field, 'custom\_field', $allow\_tags ); |
  | 260 | 277 | echo $field\_label . nl2br( $custom\_field ); |
  | 261 | 278 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L402) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L419) |  |
  | 402 | 419 | ?> |
  | 403 | 420 | <div class="<?php echo esc\_attr( implode( ' ', $css\_class ) ); ?>"> |
  | 404 |  | <?php echo wp~~autop( wptexturize( wp\_kses\_post( $content ) )~~ ); ?> |
  |  | 421 | <?php echo wpo\_wcpdf\_sanitize\_html\_content( $content, 'notes' ); ?> |
  | 405 | 422 | </div> |
  | 406 | 423 | <?php |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L1085) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L1102) |  |
  | 1085 | 1102 | $shipping\_notes = ! empty( $shipping\_notes ) ? \_\_( $shipping\_notes, 'woocommerce-pdf-invoices-packing-slips' ) : false; |
  | 1086 | 1103 |  |
  | 1087 |  | return apply\_filters( 'wpo\_wcpdf\_shipping\_notes', ~~$shipping\_notes~~, $this ); |
  |  | 1104 | return apply\_filters( 'wpo\_wcpdf\_shipping\_notes', wpo\_wcpdf\_sanitize\_html\_content( $shipping\_notes, 'notes' ), $this ); |
  | 1088 | 1105 | } |
  | 1089 | 1106 | public function shipping\_notes() { |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L817 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L817 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 817 | 817 | /\*\* |
  | 818 | 818 | \* Return logo id |
  |  | 819 | \* |
  |  | 820 | \* @return int|bool |
  | 819 | 821 | \*/ |
  | 820 | 822 | public function get\_header\_logo\_id() { |
  | 821 |  | if ( !empty( $this->settings['header\_logo'] ) ) { |
  | 822 |  | return apply\_filters( 'wpo\_wcpdf\_header\_logo\_id', $this->settings['header\_logo'], $this ); |
  | 823 |  | } |
  |  | 823 | $header\_logo\_id = false; |
  |  | 824 |  |
  |  | 825 | if ( ! empty( $this->settings['header\_logo'] ) ) { |
  |  | 826 | $header\_logo\_id = absint( $this->get\_settings\_text( 'header\_logo', '', false ) ); |
  |  | 827 |  |
  |  | 828 | if ( 0 === $header\_logo\_id ) { |
  |  | 829 | $header\_logo\_id = false; |
  |  | 830 | } |
  |  | 831 | } |
  |  | 832 |  |
  |  | 833 | return apply\_filters( 'wpo\_wcpdf\_header\_logo\_id', $header\_logo\_id, $this ); |
  | 824 | 834 | } |
  | 825 | 835 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L837) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L847) |  |
  | 837 | 847 | \*/ |
  | 838 | 848 | public function header\_logo() { |
  | 839 |  | if ( $this->get\_header\_logo\_id() ) { |
  | 840 |  | $attachment\_id = $this->get\_header\_logo\_id(); |
  | 841 |  | $company       = $this->get\_shop\_name(); |
  | 842 |  |  |
  | 843 |  | if ( $attachment\_id ) { |
  | 844 |  | $attachment      = wp\_get\_attachment\_image\_src( $attachment\_id, 'full', false ); |
  | 845 |  | $attachment\_path = get\_attached\_file( $attachment\_id ); |
  | 846 |  |  |
  | 847 |  | if ( empty( $attachment ) || empty( $attachment\_path ) ) { |
  |  | 849 | $attachment\_id = $this->get\_header\_logo\_id(); |
  |  | 850 |  |
  |  | 851 | if ( $attachment\_id ) { |
  |  | 852 | $company         = $this->get\_shop\_name(); |
  |  | 853 | $attachment      = wp\_get\_attachment\_image\_src( $attachment\_id, 'full', false ); |
  |  | 854 | $attachment\_path = get\_attached\_file( $attachment\_id ); |
  |  | 855 |  |
  |  | 856 | if ( empty( $attachment ) || empty( $attachment\_path ) ) { |
  |  | 857 | return; |
  |  | 858 | } |
  |  | 859 |  |
  |  | 860 | $attachment\_src    = $attachment[0]; |
  |  | 861 | $attachment\_width  = $attachment[1]; |
  |  | 862 | $attachment\_height = $attachment[2]; |
  |  | 863 |  |
  |  | 864 | if ( apply\_filters( 'wpo\_wcpdf\_use\_path', true ) && file\_exists( $attachment\_path ) ) { |
  |  | 865 | $src = $attachment\_path; |
  |  | 866 | } else { |
  |  | 867 | $head = wp\_remote\_head( $attachment\_src, [ 'sslverify' => false ] ); |
  |  | 868 | if ( is\_wp\_error( $head ) ) { |
  |  | 869 | $errors = $head->get\_error\_messages(); |
  |  | 870 | foreach ( $errors as $error ) { |
  |  | 871 | wcpdf\_log\_error( $error, 'critical' ); |
  |  | 872 | } |
  |  | 873 | return; |
  |  | 874 | } elseif ( isset( $head['response']['code'] ) && $head['response']['code'] === 200 ) { |
  |  | 875 | $src = $attachment\_src; |
  |  | 876 | } else { |
  | 848 | 877 | return; |
  | 849 | 878 | } |
  | 850 |  |  |
  | 851 |  | $attachment\_src    = $attachment[0]; |
  | 852 |  | $attachment\_width  = $attachment[1]; |
  | 853 |  | $attachment\_height = $attachment[2]; |
  | 854 |  |  |
  | 855 |  | if ( apply\_filters( 'wpo\_wcpdf\_use\_path', true ) && file\_exists( $attachment\_path ) ) { |
  | 856 |  | $src = $attachment\_path; |
  | 857 |  | } else { |
  | 858 |  | $head = wp\_remote\_head( $attachment\_src, [ 'sslverify' => false ] ); |
  | 859 |  | if ( is\_wp\_error( $head ) ) { |
  | 860 |  | $errors = $head->get\_error\_messages(); |
  | 861 |  | foreach ( $errors as $error ) { |
  | 862 |  | wcpdf\_log\_error( $error, 'critical' ); |
  | 863 |  | } |
  | 864 |  | return; |
  | 865 |  | } elseif ( isset( $head['response']['code'] ) && $head['response']['code'] === 200 ) { |
  | 866 |  | $src = $attachment\_src; |
  | 867 |  | } else { |
  | 868 |  | return; |
  | 869 |  | } |
  | 870 |  | } |
  | 871 |  |  |
  | 872 |  | $img\_element = sprintf( '<img src="%1$s" alt="%2$s" />', esc\_attr( $src ), esc\_attr( $company ) ); |
  | 873 |  |  |
  | 874 |  | echo apply\_filters( 'wpo\_wcpdf\_header\_logo\_img\_element', $img\_element, $attachment, $this ); |
  | 875 |  | } |
  |  | 879 | } |
  |  | 880 |  |
  |  | 881 | $img\_element = sprintf( '<img src="%1$s" alt="%2$s" />', esc\_attr( $src ), esc\_attr( $company ) ); |
  |  | 882 |  |
  |  | 883 | echo apply\_filters( 'wpo\_wcpdf\_header\_logo\_img\_element', $img\_element, $attachment, $this ); |
  | 876 | 884 | } |
  | 877 | 885 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L885) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L893) |  |
  | 885 | 893 | } elseif( ! empty( $setting ) && is\_array( $setting ) ) { |
  | 886 | 894 | $text = reset( $setting ); |
  |  | 895 | } else { |
  |  | 896 | $text = $setting; |
  | 887 | 897 | } |
  | 888 | 898 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php")

  | [r2991987](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L429 "Show revision 2991987 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L429 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 429 | 429 | public function media\_upload( $args ) { |
  | 430 | 430 | extract( $this->normalize\_settings\_args( $args ) ); |
  |  | 431 |  |
  |  | 432 | $setting\_name = $this->append\_language( $setting\_name, $args ); |
  | 431 | 433 |  |
  | 432 | 434 | if( ! empty( $current ) && $attachment = wp\_get\_attachment\_image\_src( $current, 'full', false ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L447) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L449) |  |
  | 447 | 449 | } |
  | 448 | 450 |  |
  | 449 |  | /\* |
  |  | 451 | /\*\* |
  | 450 | 452 | \* .webp support can be disabled but still showing the image in settings. |
  | 451 | 453 | \* We should add a notice because this will display an error when redering the PDF using DOMPDF. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L653) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L655) |  |
  | 653 | 655 | } elseif (isset( $option[$args['id']]['default'] )) { |
  | 654 | 656 | $args['current'] = $option[$args['id']]['default']; |
  |  | 657 | } elseif ( isset( $option[$args['id']] ) ) { |
  |  | 658 | $args['current'] = $option[$args['id']]; |
  | 655 | 659 | } |
  | 656 | 660 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L715) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L719) |  |
  | 715 | 719 | return apply\_filters( 'wpo\_wcpdf\_validate\_input', $output, $input ); |
  | 716 | 720 | } |
  |  | 721 |  |
  |  | 722 | /\*\* |
  |  | 723 | \* Appends language at the end of the setting provided, in case the setting is translatable |
  |  | 724 | \* and it does not have a language set. |
  |  | 725 | \* |
  |  | 726 | \* @param string $setting Settings field that needs a language. |
  |  | 727 | \* @param array  $args Setting arguments. |
  |  | 728 | \* |
  |  | 729 | \* @return string |
  |  | 730 | \*/ |
  |  | 731 | public function append\_language( string $setting, array $args ): string { |
  |  | 732 | if ( |
  |  | 733 | isset( $args['translatable'] ) && |
  |  | 734 | true === $args['translatable'] && |
  |  | 735 | isset( $args['lang'] )         && |
  |  | 736 | 'default' !== $args['lang']    && |
  |  | 737 | ! ( substr( $setting, -strlen( "[{$args['lang']}]" ) ) === "[{$args['lang']}]" ) |
  |  | 738 | ) { |
  |  | 739 | return $setting .= "[{$args['lang']}]"; |
  |  | 740 | } else { |
  |  | 741 | return $setting; |
  |  | 742 | } |
  |  | 743 | } |
  | 717 | 744 | } |
  | 718 | 745 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php?rev=3053443#L545 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-debug.php?rev=3076105#L545 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 545 | 545 | $args[ $date\_arg ] = $from\_date . '...' . $to\_date; |
  | 546 | 546 |  |
  | 547 |  | if ( defined( 'WC\_VERSION' ) && version\_compare( WC\_VERSION, '6.8.0', '>=' ) ~~) {~~ |
  |  | 547 | if ( defined( 'WC\_VERSION' ) && version\_compare( WC\_VERSION, '6.8.0', '>=' ) && WPO\_WCPDF()->order\_util->custom\_orders\_table\_usage\_is\_enabled() ) { // Woo >= 6.8.0 + HPOS |
  | 548 | 548 | $args = wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( $args, $args ); |
  | 549 | 549 | } else { |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-general.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-general.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-general.php")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php?rev=3019205#L138 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/settings/class-wcpdf-settings-general.php?rev=3076105#L138 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | 'section'   => 'general\_settings', |
  | 139 | 139 | 'args'      => array( |
  | 140 |  | 'option\_name'=> $option\_name, |
  | 141 |  | 'id'=> 'header\_logo', |
  | 142 |  | 'uploader\_title'=> \_\_( 'Select or upload your invoice header/logo', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 143 |  | 'uploader\_button\_text'=> \_\_( 'Set image', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 144 |  | 'remove\_button\_text'=> \_\_( 'Remove image', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 145 |  | ~~//'description'                 => \_\_( '...', 'woocommerce-pdf-invoices-packing-slips' )~~, |
  |  | 140 | 'option\_name'          => $option\_name, |
  |  | 141 | 'id'                   => 'header\_logo', |
  |  | 142 | 'uploader\_title'       => \_\_( 'Select or upload your invoice header/logo', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 143 | 'uploader\_button\_text' => \_\_( 'Set image', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 144 | 'remove\_button\_text'   => \_\_( 'Remove image', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 145 | 'translatable'         => true, |
  | 146 | 146 | ) |
  | 147 | 147 | ), |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L25 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php?rev=3076105#L25 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 | } |
  | 26 | 26 |  |
  | 27 |  | function wcpdf\_get\_document( $document\_type, $order, $init = false ) { |
  | 28 |  | // $order can be one of the following: |
  | 29 |  | // - WC Order object |
  | 30 |  | // - array of order ids |
  | 31 |  | // - null if order not loaded or loaded later |
  |  | 27 | /\*\* |
  |  | 28 | \* Get the document object for an order |
  |  | 29 | \* |
  |  | 30 | \* @param string $document\_type |
  |  | 31 | \* @param mixed  $order |
  |  | 32 | \* Passing an order object will return the document object for that order. |
  |  | 33 | \* Passing an array of order ids will return a Bulk\_Document object. |
  |  | 34 | \* Passing a single order ID within an array retrieves the document object for that order and refreshes the order object to ensure the data is up-to-date. |
  |  | 35 | \* Passing null will return a document object without an order. |
  |  | 36 | \* |
  |  | 37 | \* @param bool   $init |
  |  | 38 | \* |
  |  | 39 | \* @return object|false |
  |  | 40 | \*/ |
  |  | 41 | function wcpdf\_get\_document( string $document\_type, $order, bool $init = false ) { |
  | 32 | 42 | if ( ! empty( $order ) ) { |
  | 33 | 43 | if ( ! is\_object( $order ) && ! is\_array( $order ) && is\_numeric( $order ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L80) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php?rev=3076105#L90) |  |
  | 80 | 90 | $document = WPO\_WCPDF()->documents->get\_document( $document\_type, $order ); |
  | 81 | 91 |  |
  | 82 |  | if ( ! $document->is\_allowed() ) { |
  |  | 92 | if ( ! $document || ! $document->is\_allowed() ) { |
  | 83 | 93 | return apply\_filters( 'wcpdf\_get\_document', false, $document\_type, $order, $init ); |
  | 84 | 94 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L491) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php?rev=3076105#L501) |  |
  | 491 | 501 |  |
  | 492 | 502 | /\*\* |
  |  | 503 | \* Sanitize HTML content, prevents XSS attacks. |
  |  | 504 | \* |
  |  | 505 | \* @param string $html |
  |  | 506 | \* @param string $context |
  |  | 507 | \* @param array  $allow\_tags |
  |  | 508 | \* |
  |  | 509 | \* @return string |
  |  | 510 | \*/ |
  |  | 511 | function wpo\_wcpdf\_sanitize\_html\_content( string $html, string $context = '', array $allow\_tags = array() ): string { |
  |  | 512 | if ( empty( $html ) ) { |
  |  | 513 | return $html; |
  |  | 514 | } |
  |  | 515 |  |
  |  | 516 | // default allowed tags |
  |  | 517 | $allow\_tags = array\_merge( apply\_filters( 'wpo\_wcpdf\_sanitize\_html\_default\_allow\_tags', array( |
  |  | 518 | // tag   => allowed attributes eg. array( 'href', 'title' ) in case of a <a> tag. |
  |  | 519 | 'br'     => array(), |
  |  | 520 | 'em'     => array(), |
  |  | 521 | 'strong' => array(), |
  |  | 522 | ), $context ), $allow\_tags ); |
  |  | 523 |  |
  |  | 524 | $safe\_tags = array( |
  |  | 525 | 'b'          => array(), |
  |  | 526 | 'blockquote' => array(), |
  |  | 527 | 'br'         => array(), |
  |  | 528 | 'em'         => array(), |
  |  | 529 | 'i'          => array(), |
  |  | 530 | 'li'         => array(), |
  |  | 531 | 'ol'         => array(), |
  |  | 532 | 'p'          => array(), |
  |  | 533 | 'strong'     => array(), |
  |  | 534 | 'u'          => array(), |
  |  | 535 | 'ul'         => array(), |
  |  | 536 | 'span'       => array( 'style' ), |
  |  | 537 | 'h1'         => array(), |
  |  | 538 | 'h2'         => array(), |
  |  | 539 | 'h3'         => array(), |
  |  | 540 | 'h4'         => array(), |
  |  | 541 | 'h5'         => array(), |
  |  | 542 | 'h6'         => array(), |
  |  | 543 | 'div'        => array( 'style' ), |
  |  | 544 | 'table'      => array( 'border', 'cellspacing', 'cellpadding' ), |
  |  | 545 | 'tr'         => array(), |
  |  | 546 | 'td'         => array( 'colspan', 'rowspan' ), |
  |  | 547 | 'th'         => array( 'colspan', 'rowspan', 'scope' ), |
  |  | 548 | 'thead'      => array(), |
  |  | 549 | 'tbody'      => array(), |
  |  | 550 | 'tfoot'      => array(), |
  |  | 551 | 'code'       => array(), |
  |  | 552 | 'pre'        => array(), |
  |  | 553 | 'dl'         => array(), |
  |  | 554 | 'dt'         => array(), |
  |  | 555 | 'dd'         => array(), |
  |  | 556 | 'hr'         => array(), |
  |  | 557 | 'sup'        => array(), |
  |  | 558 | 'sub'        => array(), |
  |  | 559 | 'figure'     => array(), |
  |  | 560 | 'figcaption' => array(), |
  |  | 561 | 'abbr'       => array( 'title' ), |
  |  | 562 | ); |
  |  | 563 |  |
  |  | 564 | $filtered\_tags = array(); |
  |  | 565 |  |
  |  | 566 | foreach ( $allow\_tags as $tag => $attributes ) { |
  |  | 567 | if ( array\_key\_exists( $tag, $safe\_tags ) ) { |
  |  | 568 | $safe\_attributes       = array\_intersect( $attributes, $safe\_tags[ $tag ] ); |
  |  | 569 | $filtered\_tags[ $tag ] = ! empty( $safe\_attributes ) ? $safe\_attributes : array(); |
  |  | 570 | } |
  |  | 571 | } |
  |  | 572 |  |
  |  | 573 | if ( empty( $filtered\_tags ) ) { |
  |  | 574 | return $html; |
  |  | 575 | } |
  |  | 576 |  |
  |  | 577 | $dom = new \DOMDocument(); |
  |  | 578 |  |
  |  | 579 | // clean up special chars |
  |  | 580 | if ( apply\_filters( 'wpo\_wcpdf\_convert\_encoding', function\_exists( 'htmlspecialchars\_decode' ) ) ) { |
  |  | 581 | $html = htmlspecialchars\_decode( wcpdf\_convert\_encoding( $html ), ENT\_QUOTES ); |
  |  | 582 | } |
  |  | 583 |  |
  |  | 584 | libxml\_use\_internal\_errors( true ); // suppress malformed HTML errors |
  |  | 585 | @$dom->loadHTML( $html, LIBXML\_HTML\_NOIMPLIED | LIBXML\_HTML\_NODEFDTD ); |
  |  | 586 | libxml\_clear\_errors(); |
  |  | 587 |  |
  |  | 588 | $xpath = new \DOMXPath( $dom ); |
  |  | 589 |  |
  |  | 590 | // iterate over all nodes. |
  |  | 591 | foreach ( $xpath->query( '//\*' ) as $node ) { |
  |  | 592 | // check if the node is allowed. |
  |  | 593 | if ( array\_key\_exists( $node->nodeName, $filtered\_tags ) ) { |
  |  | 594 | // if the node is allowed, check each attribute. |
  |  | 595 | foreach ( $node->attributes as $attr ) { |
  |  | 596 | if ( ! in\_array( $attr->nodeName, $filtered\_tags[ $node->nodeName ] ) ) { |
  |  | 597 | $node->removeAttribute( $attr->nodeName ); |
  |  | 598 | } |
  |  | 599 | } |
  |  | 600 | } else { |
  |  | 601 | // if the node is not allowed, remove it but try to preserve text. |
  |  | 602 | if ( $node->parentNode ) { |
  |  | 603 | $fragment = $dom->createDocumentFragment(); |
  |  | 604 |  |
  |  | 605 | while ( $node->childNodes->length > 0 ) { |
  |  | 606 | $fragment->appendChild( $node->childNodes->item( 0 ) ); |
  |  | 607 | } |
  |  | 608 |  |
  |  | 609 | if ( $fragment->hasChildNodes() ) { |
  |  | 610 | $node->parentNode->replaceChild( $fragment, $node ); |
  |  | 611 | } else { |
  |  | 612 | $node->parentNode->removeChild( $node ); |
  |  | 613 | } |
  |  | 614 | } |
  |  | 615 | } |
  |  | 616 | } |
  |  | 617 |  |
  |  | 618 | return $dom->saveHTML(); |
  |  | 619 | } |
  |  | 620 |  |
  |  | 621 | /\*\* |
  |  | 622 | \* Sanitize phone number |
  |  | 623 | \* |
  |  | 624 | \* @param string $text |
  |  | 625 | \* |
  |  | 626 | \* @return string |
  |  | 627 | \*/ |
  |  | 628 | function wpo\_wcpdf\_sanitize\_phone\_number( string $text ): string { |
  |  | 629 | return preg\_replace( '/[^0-9\+\-\(\)\s\.x]/', '', $text ); |
  |  | 630 | } |
  |  | 631 |  |
  |  | 632 | /\*\* |
  | 493 | 633 | \* Safe redirect or die. |
  | 494 | 634 | \* |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L514) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/includes/wcpdf-functions.php?rev=3076105#L654) |  |
  | 514 | 654 | \* |
  | 515 | 655 | \* @param array $wp\_query\_args |
  | 516 |  | \* @param ~~mixed~~ $query\_args |
  |  | 656 | \* @param array $query\_args |
  | 517 | 657 | \* |
  | 518 | 658 | \* @return array |
  | 519 | 659 | \*/ |
  | 520 |  | function wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( array $wp\_query\_args, ~~mixed~~ $query\_vars ): array { |
  |  | 660 | function wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( array $wp\_query\_args, array $query\_vars ): array { |
  | 521 | 661 | $documents = WPO\_WCPDF()->documents->get\_documents(); |
  | 522 | 662 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L3 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L3 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: PDF Invoices & Packing Slips for WooCommerce 3.8.~~0-beta-4~~\n" |
  |  | 5 | "Project-Id-Version: PDF Invoices & Packing Slips for WooCommerce 3.8.1-beta-2\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/woocommerce-pdf-invoices-packing-slips\n" |
  | 7 | 7 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L10) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2024-0~~3-18T11:57:02+01~~:00\n" |
  |  | 12 | "POT-Creation-Date: 2024-04-23T13:52:32+02:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 | 14 | "X-Generator: WP-CLI 2.7.1\n" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L54) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L54) |  |
  | 54 | 54 | #: includes/views/extensions.php:121 |
  | 55 | 55 | #: includes/views/promo.php:34 |
  | 56 |  | #: woocommerce-pdf-invoices-packingslips.php:3~~39~~ |
  | 57 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~8~~ |
  | 58 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~6~~ |
  | 59 |  | #: woocommerce-pdf-invoices-packingslips.php:52~~6~~ |
  |  | 56 | #: woocommerce-pdf-invoices-packingslips.php:340 |
  |  | 57 | #: woocommerce-pdf-invoices-packingslips.php:399 |
  |  | 58 | #: woocommerce-pdf-invoices-packingslips.php:437 |
  |  | 59 | #: woocommerce-pdf-invoices-packingslips.php:527 |
  | 60 | 60 | msgid "Hide this message" |
  | 61 | 61 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L98) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L98) |  |
  | 98 | 98 | #: includes/class-wcpdf-admin.php:323 |
  | 99 | 99 | #: includes/class-wcpdf-main.php:1275 |
  | 100 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:12~~22~~ |
  |  | 100 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1239 |
  | 101 | 101 | #: includes/documents/class-wcpdf-invoice.php:280 |
  | 102 | 102 | #: includes/views/setup-wizard/display-options.php:60 |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L485) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L485) |  |
  | 485 | 485 |  |
  | 486 | 486 | #: includes/class-wcpdf-settings.php:444 |
  | 487 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:10~~50~~ |
  |  | 487 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1067 |
  | 488 | 488 | #: ubl/Settings/TaxesSettings.php:170 |
  | 489 | 489 | msgid "Total" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L565) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L565) |  |
  | 565 | 565 | msgstr "" |
  | 566 | 566 |  |
  | 567 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~6~~ |
  | 568 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:~~194~~ |
  |  | 567 | #: includes/documents/abstract-wcpdf-order-document-methods.php:98 |
  |  | 568 | #: includes/documents/abstract-wcpdf-order-document-methods.php:200 |
  | 569 | 569 | msgid "N/A" |
  | 570 | 570 | msgstr "" |
  | 571 | 571 |  |
  | 572 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~24~~ |
  |  | 572 | #: includes/documents/abstract-wcpdf-order-document-methods.php:941 |
  | 573 | 573 | msgid "Subtotal" |
  | 574 | 574 | msgstr "" |
  | 575 | 575 |  |
  | 576 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~49~~ |
  |  | 576 | #: includes/documents/abstract-wcpdf-order-document-methods.php:966 |
  | 577 | 577 | msgid "Shipping" |
  | 578 | 578 | msgstr "" |
  | 579 | 579 |  |
  | 580 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~80~~ |
  |  | 580 | #: includes/documents/abstract-wcpdf-order-document-methods.php:997 |
  | 581 | 581 | msgid "Discount" |
  | 582 | 582 | msgstr "" |
  | 583 | 583 |  |
  | 584 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:10~~47~~ |
  |  | 584 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1064 |
  | 585 | 585 | msgid "Total ex. VAT" |
  | 586 | 586 | msgstr "" |
  | 587 | 587 |  |
  | 588 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:12~~23~~ |
  |  | 588 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1240 |
  | 589 | 589 | #: includes/documents/class-wcpdf-invoice.php:281 |
  | 590 | 590 | #: includes/views/setup-wizard/display-options.php:61 |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L612) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L612) |  |
  | 612 | 612 | msgstr "" |
  | 613 | 613 |  |
  | 614 |  | #: includes/documents/abstract-wcpdf-order-document.php:12~~6~~3 |
  |  | 614 | #: includes/documents/abstract-wcpdf-order-document.php:1273 |
  | 615 | 615 | msgid "Admin email" |
  | 616 | 616 | msgstr "" |
  | 617 | 617 |  |
  | 618 |  | #: includes/documents/abstract-wcpdf-order-document.php:12~~6~~6 |
  |  | 618 | #: includes/documents/abstract-wcpdf-order-document.php:1276 |
  | 619 | 619 | msgid "Manual email" |
  | 620 | 620 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L990) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L990) |  |
  | 990 | 990 | msgstr "" |
  | 991 | 991 |  |
  | 992 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:46~~5~~ |
  |  | 992 | #: includes/settings/class-wcpdf-settings-callbacks.php:467 |
  | 993 | 993 | msgid "Image resolution" |
  | 994 | 994 | msgstr "" |
  | 995 | 995 |  |
  | 996 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:47~~3~~ |
  |  | 996 | #: includes/settings/class-wcpdf-settings-callbacks.php:475 |
  | 997 | 997 | msgid "The image resolution exceeds the recommended maximum of 600dpi. This will unnecessarily increase the size of your PDF files and could negatively affect performance." |
  | 998 | 998 | msgstr "" |
  | 999 | 999 |  |
  | 1000 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:52~~1~~ |
  |  | 1000 | #: includes/settings/class-wcpdf-settings-callbacks.php:523 |
  | 1001 | 1001 | msgid "Save" |
  | 1002 | 1002 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L2273) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L2273) |  |
  | 2273 | 2273 | msgstr "" |
  | 2274 | 2274 |  |
  | 2275 |  | #: includes/wcpdf-functions.php:3~~4~~3 |
  |  | 2275 | #: includes/wcpdf-functions.php:353 |
  | 2276 | 2276 | msgid "Error creating PDF, please contact the site owner." |
  | 2277 | 2277 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L2661) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L2661) |  |
  | 2661 | 2661 |  |
  | 2662 | 2662 | #. translators: 1. open anchor tag, 2. close anchor tag, 3. Woo version |
  | 2663 |  | #: woocommerce-pdf-invoices-packingslips.php:19~~3~~ |
  |  | 2663 | #: woocommerce-pdf-invoices-packingslips.php:194 |
  | 2664 | 2664 | msgid "PDF Invoices & Packing Slips for WooCommerce requires %1$sWooCommerce%2$s version %3$s or higher to be installed & activated!" |
  | 2665 | 2665 | msgstr "" |
  | 2666 | 2666 |  |
  | 2667 | 2667 | #. translators: PHP version |
  | 2668 |  | #: woocommerce-pdf-invoices-packingslips.php:23~~8~~ |
  |  | 2668 | #: woocommerce-pdf-invoices-packingslips.php:239 |
  | 2669 | 2669 | msgid "PDF Invoices & Packing Slips for WooCommerce requires PHP %s or higher." |
  | 2670 | 2670 | msgstr "" |
  | 2671 | 2671 |  |
  | 2672 | 2672 | #. translators: <a> tags |
  | 2673 |  | #: woocommerce-pdf-invoices-packingslips.php:24~~4~~ |
  |  | 2673 | #: woocommerce-pdf-invoices-packingslips.php:245 |
  | 2674 | 2674 | msgid "We strongly recommend to %1$supdate your PHP version%2$s." |
  | 2675 | 2675 | msgstr "" |
  | 2676 | 2676 |  |
  | 2677 | 2677 | #. translators: directory path |
  | 2678 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~6~~ |
  |  | 2678 | #: woocommerce-pdf-invoices-packingslips.php:337 |
  | 2679 | 2679 | msgid "The PDF files in %s are not currently protected due to your site running on <strong>NGINX</strong>." |
  | 2680 | 2680 | msgstr "" |
  | 2681 | 2681 |  |
  | 2682 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~7~~ |
  |  | 2682 | #: woocommerce-pdf-invoices-packingslips.php:338 |
  | 2683 | 2683 | msgid "To protect them, you must click the button below." |
  | 2684 | 2684 | msgstr "" |
  | 2685 | 2685 |  |
  | 2686 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~8~~ |
  |  | 2686 | #: woocommerce-pdf-invoices-packingslips.php:339 |
  | 2687 | 2687 | msgid "Generate random temporary folder name" |
  | 2688 | 2688 | msgstr "" |
  | 2689 | 2689 |  |
  | 2690 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~5~~ |
  |  | 2690 | #: woocommerce-pdf-invoices-packingslips.php:396 |
  | 2691 | 2691 | msgid "When sending emails with MailPoet 3 and the active sending method is <strong>MailPoet Sending Service</strong> or <strong>Your web host / web server</strong>, MailPoet does not include the <strong>PDF Invoices & Packing Slips for WooCommerce</strong> attachments in the emails." |
  | 2692 | 2692 | msgstr "" |
  | 2693 | 2693 |  |
  | 2694 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~6~~ |
  |  | 2694 | #: woocommerce-pdf-invoices-packingslips.php:397 |
  | 2695 | 2695 | msgid "To fix this you should select <strong>The default WordPress sending method (default)</strong> on the <strong>Advanced tab</strong>." |
  | 2696 | 2696 | msgstr "" |
  | 2697 | 2697 |  |
  | 2698 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~7~~ |
  |  | 2698 | #: woocommerce-pdf-invoices-packingslips.php:398 |
  | 2699 | 2699 | msgid "Change MailPoet sending method to WordPress (default)" |
  | 2700 | 2700 | msgstr "" |
  | 2701 | 2701 |  |
  | 2702 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~4~~ |
  |  | 2702 | #: woocommerce-pdf-invoices-packingslips.php:435 |
  | 2703 | 2703 | msgid "PDF Invoices & Packing Slips for WooCommerce detected that your current site locale is right-to-left (RTL) which the current PDF engine does not support it. Please consider installing our mPDF extension that is compatible." |
  | 2704 | 2704 | msgstr "" |
  | 2705 | 2705 |  |
  | 2706 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~5~~ |
  |  | 2706 | #: woocommerce-pdf-invoices-packingslips.php:436 |
  | 2707 | 2707 | msgid "Download mPDF extension" |
  | 2708 | 2708 | msgstr "" |
  | 2709 | 2709 |  |
  | 2710 | 2710 | #. translators: legacy addon name |
  | 2711 |  | #: woocommerce-pdf-invoices-packingslips.php:52~~1~~ |
  |  | 2711 | #: woocommerce-pdf-invoices-packingslips.php:522 |
  | 2712 | 2712 | msgid "While updating the PDF Invoices & Packing Slips for WooCommerce plugin we've noticed our legacy %s add-on was active on your site. This functionality is now incorporated into the core plugin. We've deactivated the add-on for you, and you are free to uninstall it." |
  | 2713 | 2713 | msgstr "" |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L1 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === PDF Invoices & Packing Slips for WooCommerce === |
  | 2 |  | Contributors: pomegranate, alexmigf, yordansoares, kluver, dpeyou, dwpriv, ~~jhosagid~~ |
  |  | 2 | Contributors: pomegranate, alexmigf, yordansoares, kluver, dpeyou, dwpriv, mohamadntr |
  | 3 | 3 | Donate link: https://wpovernight.com/downloads/woocommerce-pdf-invoices-packing-slips-bundle/ |
  | 4 | 4 | Tags: woocommerce, pdf, ubl, invoices, packing slips |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L6) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt?rev=3076105#L6) |  |
  | 6 | 6 | Tested up to: 6.5 |
  | 7 | 7 | Requires PHP: 7.2 |
  | 8 |  | Stable tag: 3.8.~~0~~ |
  |  | 8 | Stable tag: 3.8.1 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L102) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/readme.txt?rev=3076105#L102) |  |
  | 102 | 102 |  |
  | 103 | 103 | == Changelog == |
  |  | 104 |  |
  |  | 105 | = 3.8.1 (2024-04-23) = |
  |  | 106 | \* New: updates DOMPDF to `v2.0.7` |
  |  | 107 | \* New: adds `woocommerce` as required plugin |
  |  | 108 | \* New: improvements to shop logo to be translatable in future Professional extension version |
  |  | 109 | \* Fix: document date parse function being called on non HPOS stores |
  |  | 110 | \* Fix: replaces deprecated jQuery functions |
  |  | 111 | \* Fix: bug with type hint in `wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query()` function |
  |  | 112 | \* Fix: bug calling `is\_allowed()` on `bool` under `wcpdf\_get\_document()` function |
  |  | 113 | \* Fix: not removing documents meta on Woo subcription renewal |
  |  | 114 | \* Fix: XSS vulnerability on Woo Checkout user input address data |
  |  | 115 | \* Fix: Semaphore attachments issue on concurrent refunds |
  |  | 116 | \* Translations: Updated translation template (POT) |
  |  | 117 | \* Tested up to WooCommerce 8.8 |
  | 104 | 118 |  |
  | 105 | 119 | = 3.8.0 (2024-03-18) = |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L168 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L168 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 168 | 168 |  |
  | 169 | 169 | foreach ( $vat\_meta\_keys as $meta\_key ) { |
  | 170 |  | if ( $vat\_number = $this->document->order->get\_meta( $meta\_key ) ) { |
  |  | 170 | $vat\_number = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_meta( $meta\_key ), 'vat\_number' ); |
  |  | 171 |  |
  |  | 172 | if ( $vat\_number ) { |
  | 171 | 173 | break; |
  | 172 | 174 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L174) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L176) |  |
  | 174 | 176 | } |
  | 175 | 177 |  |
  | 176 |  | $customerPartyName = $customerPartyContactName = ~~$this->document->order->get\_formatted\_billing\_full\_name(~~); |
  | 177 |  | $billing\_company   = ~~$this->document->order->get\_billing\_company(~~); |
  |  | 178 | $customerPartyName = $customerPartyContactName = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_formatted\_billing\_full\_name(), 'full\_name' ); |
  |  | 179 | $billing\_company   = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_company(), 'company' ); |
  | 178 | 180 |  |
  | 179 | 181 | if ( ! empty( $billing\_company ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L206) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L208) |  |
  | 206 | 208 | array( |
  | 207 | 209 | 'name'  => 'cbc:StreetName', |
  | 208 |  | 'value' => ~~$this->document->order->get\_billing\_address\_1(~~), |
  |  | 210 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_1(), 'address\_1' ), |
  | 209 | 211 | ), |
  | 210 | 212 | array( |
  | 211 | 213 | 'name'  => 'cbc:CityName', |
  | 212 |  | 'value' => ~~$this->document->order->get\_billing\_city(~~), |
  |  | 214 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_city(), 'city' ), |
  | 213 | 215 | ), |
  | 214 | 216 | array( |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L220) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L222) |  |
  | 220 | 222 | 'value' => array( |
  | 221 | 223 | 'name'  => 'cbc:Line', |
  | 222 |  | 'value' => ~~$this->document->order->get\_billing\_address\_1() .'<br/>'.$this->document->order->get\_billing\_address\_2(~~), |
  |  | 224 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_1(), 'address\_1' ) . '<br/>' . wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_2(), 'address\_2' ), |
  | 223 | 225 | ), |
  | 224 | 226 | ), |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L267) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L269) |  |
  | 267 | 269 | array( |
  | 268 | 270 | 'name'  => 'cbc:ElectronicMail', |
  | 269 |  | 'value' => ~~$this->document->order->get\_billing\_email(~~), |
  |  | 271 | 'value' => sanitize\_email( $this->document->order->get\_billing\_email() ), |
  | 270 | 272 | ), |
  | 271 | 273 | ), |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=2980576#L16 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php?rev=3076105#L16 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | public function transform( \WC\_Abstract\_Order $item, $billing\_or\_shipping ) { |
  | 17 | 17 | $model             = new Address(); |
  | 18 |  | $model->address\_1  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_address\_1'}(~~); |
  | 19 |  | $model->address\_2  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_address\_2'}(~~); |
  | 20 |  | $model->first\_name = ~~$item->{'get\_'.$billing\_or\_shipping.'\_first\_name'}(~~); |
  | 21 |  | $model->last\_name  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_last\_name'}(~~); |
  | 22 |  | $model->city       = ~~$item->{'get\_'.$billing\_or\_shipping.'\_city'}(~~); |
  |  | 18 | $model->address\_1  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_address\_1'}(), 'address\_1' ); |
  |  | 19 | $model->address\_2  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_address\_2'}(), 'address\_2' ); |
  |  | 20 | $model->first\_name = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_first\_name'}(), 'first\_name' ); |
  |  | 21 | $model->last\_name  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_last\_name'}(), 'last\_name' ); |
  |  | 22 | $model->city       = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_city'}(), 'city' ); |
  | 23 | 23 | $model->state      = $item->{'get\_'.$billing\_or\_shipping.'\_state'}(); |
  | 24 | 24 | $model->postcode   = $item->{'get\_'.$billing\_or\_shipping.'\_postcode'}(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=2980576#L26) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/ubl/Transformers/AddressTransformer.php?rev=3076105#L26) |  |
  | 26 | 26 |  |
  | 27 | 27 | if ( 'billing' === $billing\_or\_shipping ) { |
  | 28 |  | $model->email = ~~$item->get\_billing\_email(~~); |
  | 29 |  | $model->phone = ~~$item->get\_billing\_phone(~~); |
  |  | 28 | $model->email = sanitize\_email( $item->get\_billing\_email() ); |
  |  | 29 | $model->phone = wpo\_wcpdf\_sanitize\_phone\_number( $item->get\_billing\_phone() ); |
  | 30 | 30 | } |
  | 31 | 31 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L3 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L3 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | { |
  | 4 | 4 | "name": "dompdf/dompdf", |
  | 5 |  | "version": "v2.0.~~4~~", |
  | 6 |  | "version\_normalized": "2.0.~~4~~.0", |
  |  | 5 | "version": "v2.0.7", |
  |  | 6 | "version\_normalized": "2.0.7.0", |
  | 7 | 7 | "source": { |
  | 8 | 8 | "type": "git", |
  | 9 | 9 | "url": "https://github.com/dompdf/dompdf.git", |
  | 10 |  | "reference": "~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~" |
  | 11 |  | }, |
  | 12 |  | "dist": { |
  | 13 |  | "type": "zip", |
  | 14 |  | "url": "https://api.github.com/repos/dompdf/dompdf/zipball/~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~", |
  | 15 |  | "reference": "~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~", |
  |  | 10 | "reference": "ab0123052b42ad0867348f25df8c228f1ece8f14" |
  |  | 11 | }, |
  |  | 12 | "dist": { |
  |  | 13 | "type": "zip", |
  |  | 14 | "url": "https://api.github.com/repos/dompdf/dompdf/zipball/ab0123052b42ad0867348f25df8c228f1ece8f14", |
  |  | 15 | "reference": "ab0123052b42ad0867348f25df8c228f1ece8f14", |
  | 16 | 16 | "shasum": "" |
  | 17 | 17 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L21) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L21) |  |
  | 21 | 21 | "masterminds/html5": "^2.0", |
  | 22 | 22 | "phenx/php-font-lib": ">=0.5.4 <1.0.0", |
  | 23 |  | "phenx/php-svg-lib": ">=0.~~3.3~~ <1.0.0", |
  |  | 23 | "phenx/php-svg-lib": ">=0.5.2 <1.0.0", |
  | 24 | 24 | "php": "^7.1 || ^8.0" |
  | 25 | 25 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L37) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L37) |  |
  | 37 | 37 | "ext-zlib": "Needed for pdf stream compression" |
  | 38 | 38 | }, |
  | 39 |  | "time": "202~~3-12-12T20:19:39~~+00:00", |
  |  | 39 | "time": "2024-04-15T12:40:33+00:00", |
  | 40 | 40 | "type": "library", |
  | 41 | 41 | "installation-source": "dist", |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L62) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L62) |  |
  | 62 | 62 | "support": { |
  | 63 | 63 | "issues": "https://github.com/dompdf/dompdf/issues", |
  | 64 |  | "source": "https://github.com/dompdf/dompdf/tree/v2.0.~~4~~" |
  |  | 64 | "source": "https://github.com/dompdf/dompdf/tree/v2.0.7" |
  | 65 | 65 | }, |
  | 66 | 66 | "install-path": "../dompdf/dompdf" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L68) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L68) |  |
  | 68 | 68 | { |
  | 69 | 69 | "name": "masterminds/html5", |
  | 70 |  | "version": "2.~~8.1~~", |
  | 71 |  | "version\_normalized": "2.~~8.1~~.0", |
  |  | 70 | "version": "2.9.0", |
  |  | 71 | "version\_normalized": "2.9.0.0", |
  | 72 | 72 | "source": { |
  | 73 | 73 | "type": "git", |
  | 74 | 74 | "url": "https://github.com/Masterminds/html5-php.git", |
  | 75 |  | "reference": "f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~" |
  | 76 |  | }, |
  | 77 |  | "dist": { |
  | 78 |  | "type": "zip", |
  | 79 |  | "url": "https://api.github.com/repos/Masterminds/html5-php/zipball/f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~", |
  | 80 |  | "reference": "f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~", |
  |  | 75 | "reference": "f5ac2c0b0a2eefca70b2ce32a5809992227e75a6" |
  |  | 76 | }, |
  |  | 77 | "dist": { |
  |  | 78 | "type": "zip", |
  |  | 79 | "url": "https://api.github.com/repos/Masterminds/html5-php/zipball/f5ac2c0b0a2eefca70b2ce32a5809992227e75a6", |
  |  | 80 | "reference": "f5ac2c0b0a2eefca70b2ce32a5809992227e75a6", |
  | 81 | 81 | "shasum": "" |
  | 82 | 82 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L86) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L86) |  |
  | 86 | 86 | }, |
  | 87 | 87 | "require-dev": { |
  | 88 |  | "phpunit/phpunit": "^4.8.35 || ^5.7.21 || ^6 || ^7 || ^8" |
  | 89 |  | }, |
  | 90 |  | "time": "202~~3-05-10T11:58:31~~+00:00", |
  |  | 88 | "phpunit/phpunit": "^4.8.35 || ^5.7.21 || ^6 || ^7 || ^8 || ^9" |
  |  | 89 | }, |
  |  | 90 | "time": "2024-03-31T07:05:07+00:00", |
  | 91 | 91 | "type": "library", |
  | 92 | 92 | "extra": { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L132) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L132) |  |
  | 132 | 132 | "support": { |
  | 133 | 133 | "issues": "https://github.com/Masterminds/html5-php/issues", |
  | 134 |  | "source": "https://github.com/Masterminds/html5-php/tree/2.~~8.1~~" |
  |  | 134 | "source": "https://github.com/Masterminds/html5-php/tree/2.9.0" |
  | 135 | 135 | }, |
  | 136 | 136 | "install-path": "../masterminds/html5" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L185) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L185) |  |
  | 185 | 185 | { |
  | 186 | 186 | "name": "phenx/php-svg-lib", |
  | 187 |  | "version": "0.5.~~2~~", |
  | 188 |  | "version\_normalized": "0.5.~~2~~.0", |
  |  | 187 | "version": "0.5.4", |
  |  | 188 | "version\_normalized": "0.5.4.0", |
  | 189 | 189 | "source": { |
  | 190 | 190 | "type": "git", |
  | 191 | 191 | "url": "https://github.com/dompdf/php-svg-lib.git", |
  | 192 |  | "reference": "~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~" |
  | 193 |  | }, |
  | 194 |  | "dist": { |
  | 195 |  | "type": "zip", |
  | 196 |  | "url": "https://api.github.com/repos/dompdf/php-svg-lib/zipball/~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~", |
  | 197 |  | "reference": "~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~", |
  |  | 192 | "reference": "46b25da81613a9cf43c83b2a8c2c1bdab27df691" |
  |  | 193 | }, |
  |  | 194 | "dist": { |
  |  | 195 | "type": "zip", |
  |  | 196 | "url": "https://api.github.com/repos/dompdf/php-svg-lib/zipball/46b25da81613a9cf43c83b2a8c2c1bdab27df691", |
  |  | 197 | "reference": "46b25da81613a9cf43c83b2a8c2c1bdab27df691", |
  | 198 | 198 | "shasum": "" |
  | 199 | 199 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L206) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L206) |  |
  | 206 | 206 | "phpunit/phpunit": "^7.5 || ^8.5 || ^9.5" |
  | 207 | 207 | }, |
  | 208 |  | "time": "2024-0~~2-07T12:49:40~~+00:00", |
  |  | 208 | "time": "2024-04-08T12:52:34+00:00", |
  | 209 | 209 | "type": "library", |
  | 210 | 210 | "installation-source": "dist", |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L216) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L216) |  |
  | 216 | 216 | "notification-url": "https://packagist.org/downloads/", |
  | 217 | 217 | "license": [ |
  | 218 |  | "LGPL-3.0" |
  |  | 218 | "LGPL-3.0-or-later" |
  | 219 | 219 | ], |
  | 220 | 220 | "authors": [ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L228) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.json?rev=3076105#L228) |  |
  | 228 | 228 | "support": { |
  | 229 | 229 | "issues": "https://github.com/dompdf/php-svg-lib/issues", |
  | 230 |  | "source": "https://github.com/dompdf/php-svg-lib/tree/0.5.~~2~~" |
  |  | 230 | "source": "https://github.com/dompdf/php-svg-lib/tree/0.5.4" |
  | 231 | 231 | }, |
  | 232 | 232 | "install-path": "../phenx/php-svg-lib" |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L4 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105#L4 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | 'pretty\_version' => 'dev-main', |
  | 5 | 5 | 'version' => 'dev-main', |
  | 6 |  | 'reference' => '~~faa4cf55049ee76b934da9d692c074f2f0ea3fe2~~', |
  |  | 6 | 'reference' => 'bac99d938a07f16dbb50c11804f497182886b4a8', |
  | 7 | 7 | 'type' => 'library', |
  | 8 | 8 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L12) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105#L12) |  |
  | 12 | 12 | 'versions' => array( |
  | 13 | 13 | 'dompdf/dompdf' => array( |
  | 14 |  | 'pretty\_version' => 'v2.0.~~4~~', |
  | 15 |  | 'version' => '2.0.~~4~~.0', |
  | 16 |  | 'reference' => '~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~', |
  |  | 14 | 'pretty\_version' => 'v2.0.7', |
  |  | 15 | 'version' => '2.0.7.0', |
  |  | 16 | 'reference' => 'ab0123052b42ad0867348f25df8c228f1ece8f14', |
  | 17 | 17 | 'type' => 'library', |
  | 18 | 18 | 'install\_path' => \_\_DIR\_\_ . '/../dompdf/dompdf', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L21) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105#L21) |  |
  | 21 | 21 | ), |
  | 22 | 22 | 'masterminds/html5' => array( |
  | 23 |  | 'pretty\_version' => '2.~~8.1~~', |
  | 24 |  | 'version' => '2.~~8.1~~.0', |
  | 25 |  | 'reference' => 'f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~', |
  |  | 23 | 'pretty\_version' => '2.9.0', |
  |  | 24 | 'version' => '2.9.0.0', |
  |  | 25 | 'reference' => 'f5ac2c0b0a2eefca70b2ce32a5809992227e75a6', |
  | 26 | 26 | 'type' => 'library', |
  | 27 | 27 | 'install\_path' => \_\_DIR\_\_ . '/../masterminds/html5', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L39) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105#L39) |  |
  | 39 | 39 | ), |
  | 40 | 40 | 'phenx/php-svg-lib' => array( |
  | 41 |  | 'pretty\_version' => '0.5.~~2~~', |
  | 42 |  | 'version' => '0.5.~~2~~.0', |
  | 43 |  | 'reference' => '~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~', |
  |  | 41 | 'pretty\_version' => '0.5.4', |
  |  | 42 | 'version' => '0.5.4.0', |
  |  | 43 | 'reference' => '46b25da81613a9cf43c83b2a8c2c1bdab27df691', |
  | 44 | 44 | 'type' => 'library', |
  | 45 | 45 | 'install\_path' => \_\_DIR\_\_ . '/../phenx/php-svg-lib', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L95) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/composer/installed.php?rev=3076105#L95) |  |
  | 95 | 95 | 'pretty\_version' => 'dev-main', |
  | 96 | 96 | 'version' => 'dev-main', |
  | 97 |  | 'reference' => '~~faa4cf55049ee76b934da9d692c074f2f0ea3fe2~~', |
  |  | 97 | 'reference' => 'bac99d938a07f16dbb50c11804f497182886b4a8', |
  | 98 | 98 | 'type' => 'library', |
  | 99 | 99 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/VERSION](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/VERSION "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/VERSION")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION?rev=3019205#L1 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/VERSION?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | 2.0.~~4~~ |
  |  | 1 | 2.0.7 |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php")

  | [r2860919](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=2860919#L468 "Show revision 2860919 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105#L468 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 468 | 468 |  |
  | 469 | 469 | if ($c === IMG\_COLOR\_STYLED) { |
  | 470 |  | ~~imagepolygon($this->get\_image(),~~ [ |
  |  | 470 | $points = [ |
  | 471 | 471 | $x1, $y1, |
  | 472 | 472 | $x1 + $w, $y1, |
  | 473 | 473 | $x1 + $w, $y1 + $h, |
  | 474 | 474 | $x1, $y1 + $h |
  | 475 |  | ], $c); |
  |  | 475 | ]; |
  |  | 476 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 477 | imagepolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 478 | } else { |
  |  | 479 | imagepolygon($this->get\_image(), $points, $c); |
  |  | 480 | } |
  | 476 | 481 | } else { |
  | 477 | 482 | imagerectangle($this->get\_image(), $x1, $y1, $x1 + $w, $y1 + $h, $c); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=2860919#L571) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105#L576) |  |
  | 571 | 576 |  |
  | 572 | 577 | if ($fill) { |
  | 573 |  | imagefilledpolygon($this->get\_image(), $points, $c); |
  |  | 578 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 579 | imagefilledpolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 580 | } else { |
  |  | 581 | imagefilledpolygon($this->get\_image(), $points, $c); |
  |  | 582 | } |
  | 574 | 583 | } else { |
  | 575 |  | imagepolygon($this->get\_image(), $points, $c); |
  |  | 584 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 585 | imagepolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 586 | } else { |
  |  | 587 | imagepolygon($this->get\_image(), $points, $c); |
  |  | 588 | } |
  | 576 | 589 | } |
  | 577 | 590 | } |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php")

  | [r2860919](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L85 "Show revision 2860919 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L85 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 |  |
  | 86 | 86 | /\*\* |
  |  | 87 | \* Operational artifact (log files, temporary files) path validation |
  |  | 88 | \* |
  |  | 89 | \* @var callable |
  |  | 90 | \*/ |
  |  | 91 | private $artifactPathValidation = null; |
  |  | 92 |  |
  |  | 93 | /\*\* |
  | 87 | 94 | \* @var string |
  | 88 | 95 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L335) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L342) |  |
  | 335 | 342 |  |
  | 336 | 343 | $this->setAllowedProtocols(["file://", "http://", "https://"]); |
  |  | 344 |  |
  |  | 345 | $this->setArtifactPathValidation([$this, "validateArtifactPath"]); |
  | 337 | 346 |  |
  | 338 | 347 | if (null !== $attributes) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L362) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L371) |  |
  | 362 | 371 | } elseif ($key === 'allowedProtocols') { |
  | 363 | 372 | $this->setAllowedProtocols($value); |
  |  | 373 | } elseif ($key === 'artifactPathValidation') { |
  |  | 374 | $this->setArtifactPathValidation($value); |
  | 364 | 375 | } elseif ($key === 'logOutputFile' || $key === 'log\_output\_file') { |
  | 365 | 376 | $this->setLogOutputFile($value); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L429) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L440) |  |
  | 429 | 440 | } elseif ($key === 'allowedProtocols') { |
  | 430 | 441 | return $this->getAllowedProtocols(); |
  |  | 442 | } elseif ($key === 'artifactPathValidation') { |
  |  | 443 | return $this->getArtifactPathValidation(); |
  | 431 | 444 | } elseif ($key === 'logOutputFile' || $key === 'log\_output\_file') { |
  | 432 | 445 | return $this->getLogOutputFile(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L596) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L609) |  |
  | 596 | 609 | \* @return array |
  | 597 | 610 | \*/ |
  |  | 611 | public function getArtifactPathValidation() |
  |  | 612 | { |
  |  | 613 | return $this->artifactPathValidation; |
  |  | 614 | } |
  |  | 615 |  |
  |  | 616 | /\*\* |
  |  | 617 | \* @param callable $validator |
  |  | 618 | \* @return $this |
  |  | 619 | \*/ |
  |  | 620 | public function setArtifactPathValidation($validator) |
  |  | 621 | { |
  |  | 622 | $this->artifactPathValidation = $validator; |
  |  | 623 | return $this; |
  |  | 624 | } |
  |  | 625 |  |
  |  | 626 | /\*\* |
  |  | 627 | \* @return array |
  |  | 628 | \*/ |
  | 598 | 629 | public function getChroot() |
  | 599 | 630 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L849) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L880) |  |
  | 849 | 880 | public function setFontCache($fontCache) |
  | 850 | 881 | { |
  | 851 |  | $this->fontCache = $fontCache; |
  |  | 882 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($fontCache, "fontCache") === true) { |
  |  | 883 | $this->fontCache = $fontCache; |
  |  | 884 | } |
  | 852 | 885 | return $this; |
  | 853 | 886 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L867) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L900) |  |
  | 867 | 900 | public function setFontDir($fontDir) |
  | 868 | 901 | { |
  | 869 |  | $this->fontDir = $fontDir; |
  |  | 902 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($fontDir, "fontDir") === true) { |
  |  | 903 | $this->fontDir = $fontDir; |
  |  | 904 | } |
  | 870 | 905 | return $this; |
  | 871 | 906 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1036) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1071) |  |
  | 1036 | 1071 | public function setLogOutputFile($logOutputFile) |
  | 1037 | 1072 | { |
  | 1038 |  | $this->logOutputFile = $logOutputFile; |
  |  | 1073 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($logOutputFile, "logOutputFile") === true) { |
  |  | 1074 | $this->logOutputFile = $logOutputFile; |
  |  | 1075 | } |
  | 1039 | 1076 | return $this; |
  | 1040 | 1077 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1054) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1091) |  |
  | 1054 | 1091 | public function setTempDir($tempDir) |
  | 1055 | 1092 | { |
  | 1056 |  | $this->tempDir = $tempDir; |
  |  | 1093 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($tempDir, "tempDir") === true) { |
  |  | 1094 | $this->tempDir = $tempDir; |
  |  | 1095 | } |
  | 1057 | 1096 | return $this; |
  | 1058 | 1097 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1072) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1111) |  |
  | 1072 | 1111 | public function setRootDir($rootDir) |
  | 1073 | 1112 | { |
  | 1074 |  | $this->rootDir = $rootDir; |
  |  | 1113 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($rootDir, "rootDir") === true) { |
  |  | 1114 | $this->rootDir = $rootDir; |
  |  | 1115 | } |
  | 1075 | 1116 | return $this; |
  | 1076 | 1117 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1104) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1145) |  |
  | 1104 | 1145 | { |
  | 1105 | 1146 | return $this->httpContext; |
  |  | 1147 | } |
  |  | 1148 |  |
  |  | 1149 |  |
  |  | 1150 | public function validateArtifactPath(?string $path, string $option) |
  |  | 1151 | { |
  |  | 1152 | $parsed\_uri = parse\_url($path); |
  |  | 1153 | if ($parsed\_uri === false || (array\_key\_exists("scheme", $parsed\_uri) && strtolower($parsed\_uri["scheme"]) === "phar")) { |
  |  | 1154 | return false; |
  |  | 1155 | } |
  |  | 1156 | return true; |
  | 1106 | 1157 | } |
  | 1107 | 1158 |  |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/README.md](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/README.md "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/README.md")

  | [r2929370](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md?rev=2929370#L31 "Show revision 2929370 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/README.md?rev=3076105#L31 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | - Runs on \*\*PHP\*\* 5.3.0 or newer |
  | 32 | 32 |  |
  | 33 |  | [![~~Build Status](https://travis-ci.org/Masterminds/html5-php.png?branch=master)](https://travis-ci.org/Masterminds/html5-php~~) |
  |  | 33 | [![CI](https://github.com/Masterminds/html5-php/actions/workflows/ci.yaml/badge.svg)](https://github.com/Masterminds/html5-php/actions/workflows/ci.yaml) |
  | 34 | 34 | [![Latest Stable Version](https://poser.pugx.org/masterminds/html5/v/stable.png)](https://packagist.org/packages/masterminds/html5) |
  | 35 | 35 | [![Code Coverage](https://scrutinizer-ci.com/g/Masterminds/html5-php/badges/coverage.png?b=master)](https://scrutinizer-ci.com/g/Masterminds/html5-php/?branch=master) |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php")

  | [r2929370](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php?rev=2929370#L71 "Show revision 2929370 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Elements.php?rev=3076105#L71 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 71 | 71 | \*/ |
  | 72 | 72 | const BLOCK\_ONLY\_INLINE = 128; |
  |  | 73 |  |
  |  | 74 | /\*\* |
  |  | 75 | \* Elements with optional end tags that cause auto-closing of previous and parent tags, |
  |  | 76 | \* as example most of the table related tags, see https://www.w3.org/TR/html401/struct/tables.html |
  |  | 77 | \* Structure is as follows: |
  |  | 78 | \* TAG-NAME => [PARENT-TAG-NAME-TO-CLOSE1, PARENT-TAG-NAME-TO-CLOSE2, ...]. |
  |  | 79 | \* |
  |  | 80 | \* Order is important, after auto-closing one parent with might have to close also their parent. |
  |  | 81 | \* |
  |  | 82 | \* @var array<string, string[]> |
  |  | 83 | \*/ |
  |  | 84 | public static $optionalEndElementsParentsToClose = array( |
  |  | 85 | 'tr' => array('td', 'tr'), |
  |  | 86 | 'td' => array('td', 'th'), |
  |  | 87 | 'th' => array('td', 'th'), |
  |  | 88 | 'tfoot' => array('td', 'th', 'tr', 'tbody', 'thead'), |
  |  | 89 | 'tbody' => array('td', 'th', 'tr', 'thead'), |
  |  | 90 | ); |
  | 73 | 91 |  |
  | 74 | 92 | /\*\* |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=2790488#L360 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=3076105#L360 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 360 | 360 | } |
  | 361 | 361 |  |
  |  | 362 | // some elements as table related tags might have optional end tags that force us to auto close multiple tags |
  |  | 363 | // https://www.w3.org/TR/html401/struct/tables.html |
  |  | 364 | if ($this->current instanceof \DOMElement && isset(Elements::$optionalEndElementsParentsToClose[$lname])) { |
  |  | 365 | foreach (Elements::$optionalEndElementsParentsToClose[$lname] as $parentElName) { |
  |  | 366 | if ($this->current instanceof \DOMElement && $this->current->tagName === $parentElName) { |
  |  | 367 | $this->autoclose($parentElName); |
  |  | 368 | } |
  |  | 369 | } |
  |  | 370 | } |
  |  | 371 |  |
  | 362 | 372 | try { |
  | 363 | 373 | $prefix = ($pos = strpos($lname, ':')) ? substr($lname, 0, $pos) : ''; |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L184 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L184 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 184 | 184 | \* @return string The current character. |
  | 185 | 185 | \*/ |
  |  | 186 | #[\ReturnTypeWillChange] |
  | 186 | 187 | public function current() |
  | 187 | 188 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L193) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L194) |  |
  | 193 | 194 | \* This is part of the Iterator interface. |
  | 194 | 195 | \*/ |
  |  | 196 | #[\ReturnTypeWillChange] |
  | 195 | 197 | public function next() |
  | 196 | 198 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L201) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L203) |  |
  | 201 | 203 | \* Rewind to the start of the string. |
  | 202 | 204 | \*/ |
  |  | 205 | #[\ReturnTypeWillChange] |
  | 203 | 206 | public function rewind() |
  | 204 | 207 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L211) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L214) |  |
  | 211 | 214 | \* @return bool Whether the current pointer location is valid. |
  | 212 | 215 | \*/ |
  |  | 216 | #[\ReturnTypeWillChange] |
  | 213 | 217 | public function valid() |
  | 214 | 218 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L325) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L329) |  |
  | 325 | 329 | } |
  | 326 | 330 |  |
  |  | 331 | #[\ReturnTypeWillChange] |
  | 327 | 332 | public function key() |
  | 328 | 333 | { |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=2790488#L1 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | # SVG file parsing / rendering library |
  | 2 | 2 |  |
  | 3 |  | [![Build Status](https://github.com/phenx/php-svg-lib/workflows/test/badge.svg)](https://github.com/phenx/php-svg-lib/actions) |
  | 4 |  |  |
  |  | 3 | [![Build Status](https://github.com/dompdf/php-svg-lib/actions/workflows/test.yml/badge.svg)](https://github.com/dompdf/php-svg-lib/actions/workflows/test.yml) |
  | 5 | 4 |  |
  | 6 | 5 | [![Latest Stable Version](https://poser.pugx.org/phenx/php-svg-lib/v/stable)](https://packagist.org/packages/phenx/php-svg-lib) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=2790488#L11) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/README.md?rev=3076105#L10) |  |
  | 11 | 10 | The main purpose of this lib is to rasterize SVG to a surface which can be an image or a PDF for example, through a `\Svg\Surface` PHP interface. |
  | 12 | 11 |  |
  | 13 |  | This project was initialized by the need to render SVG documents inside PDF files for the [DomPdf](http~~://dompdf.github.io~~) project. |
  |  | 12 | This project was initialized by the need to render SVG documents inside PDF files for the [DomPdf](https://github.com/dompdf/dompdf) project. |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L24 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L24 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | use Svg\Tag\Rect; |
  | 25 | 25 | use Svg\Tag\Stop; |
  |  | 26 | use Svg\Tag\Symbol; |
  | 26 | 27 | use Svg\Tag\Text; |
  | 27 | 28 | use Svg\Tag\StyleTag; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L31) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L32) |  |
  | 31 | 32 | { |
  | 32 | 33 | protected $filename; |
  |  | 34 | protected $\_defs\_depth = 0; |
  | 33 | 35 | public $inDefs = false; |
  | 34 | 36 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L82) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L84) |  |
  | 82 | 84 |  |
  | 83 | 85 | /\*\* |
  |  | 86 | \* Increase the nesting level for defs-like elements |
  |  | 87 | \* |
  |  | 88 | \* @return int |
  |  | 89 | \*/ |
  |  | 90 | public function enterDefs () { |
  |  | 91 | $this->\_defs\_depth++; |
  |  | 92 | $this->inDefs = true; |
  |  | 93 | return $this->\_defs\_depth; |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | /\*\* |
  |  | 97 | \* Decrease the nesting level for defs-like elements |
  |  | 98 | \* |
  |  | 99 | \* @return int |
  |  | 100 | \*/ |
  |  | 101 | public function exitDefs () { |
  |  | 102 | $this->\_defs\_depth--; |
  |  | 103 | if ($this->\_defs\_depth < 0) { |
  |  | 104 | $this->\_defs\_depth = 0; |
  |  | 105 | } |
  |  | 106 | $this->inDefs = ($this->\_defs\_depth > 0 ? true : false); |
  |  | 107 | return $this->\_defs\_depth; |
  |  | 108 | } |
  |  | 109 |  |
  |  | 110 | /\*\* |
  | 84 | 111 | \* @return SurfaceInterface |
  | 85 | 112 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L134) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L161) |  |
  | 134 | 161 | } |
  | 135 | 162 | } |
  |  | 163 | xml\_parse($parser, "", true); |
  | 136 | 164 |  |
  | 137 | 165 | xml\_parser\_free($parser); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L214) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L242) |  |
  | 214 | 242 | public function render(SurfaceInterface $surface) |
  | 215 | 243 | { |
  |  | 244 | $this->\_defs\_depth = 0; |
  | 216 | 245 | $this->inDefs = false; |
  | 217 | 246 | $this->surface = $surface; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L257) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L286) |  |
  | 257 | 286 | switch (strtolower($name)) { |
  | 258 | 287 | case 'defs': |
  | 259 |  | $this->~~inDefs = true~~; |
  |  | 288 | $this->enterDefs(); |
  | 260 | 289 | return; |
  | 261 | 290 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L323) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L352) |  |
  | 323 | 352 |  |
  | 324 | 353 | case 'g': |
  |  | 354 | $tag = new Group($this, $name); |
  |  | 355 | break; |
  |  | 356 |  |
  | 325 | 357 | case 'symbol': |
  | 326 |  | $tag = new Group($this, $name); |
  | 327 |  | break; |
  | 328 |  |  |
  |  | 358 | $this->enterDefs(); |
  |  | 359 | $tag = new Symbol($this, $name); |
  |  | 360 | break; |
  |  | 361 |  |
  | 329 | 362 | case 'clippath': |
  | 330 | 363 | $tag = new ClipPath($this, $name); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L376) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L409) |  |
  | 376 | 409 | switch (strtolower($name)) { |
  | 377 | 410 | case 'defs': |
  | 378 |  | $this->~~inDefs = false~~; |
  |  | 411 | $this->exitDefs(); |
  | 379 | 412 | return; |
  | 380 | 413 |  |
  |  | 414 | case 'symbol': |
  |  | 415 | $this->exitDefs(); |
  |  | 416 | $tag = array\_pop($this->stack); |
  |  | 417 | break; |
  |  | 418 |  |
  | 381 | 419 | case 'svg': |
  | 382 | 420 | case 'path': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L394) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L432) |  |
  | 394 | 432 | case 'text': |
  | 395 | 433 | case 'g': |
  | 396 |  | ~~case 'symbol':~~ |
  | 397 | 434 | case 'clippath': |
  | 398 | 435 | case 'use': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L402) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L439) |  |
  | 402 | 439 | } |
  | 403 | 440 |  |
  | 404 |  | if (~~!$this->inDefs && $t~~ag) { |
  |  | 441 | if ((!$this->inDefs && $tag) || $tag instanceof StyleTag) { |
  | 405 | 442 | $tag->handleEnd(); |
  | 406 | 443 | } |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L170 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L170 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 170 | 170 | } |
  | 171 | 171 | } |
  | 172 |  | if (~~$value !== null && $value[3] !== 1~~ && array\_key\_exists("{$from}-opacity", $style\_map) === true) { |
  |  | 172 | if (is\_array($value) && $value[3] !== 1.0 && array\_key\_exists("{$from}-opacity", $style\_map) === true) { |
  | 173 | 173 | $styles["{$from}-opacity"] = $value[3]; |
  | 174 | 174 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L220) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L220) |  |
  | 220 | 220 | } |
  | 221 | 221 |  |
  |  | 222 | if ($color === "transparent") { |
  |  | 223 | return [0.0, 0.0, 0.0, 0.0]; |
  |  | 224 | } |
  |  | 225 |  |
  | 222 | 226 | // SVG color name |
  | 223 | 227 | if (isset(self::$colorNames[$color])) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L235) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L239) |  |
  | 235 | 239 | } |
  | 236 | 240 |  |
  | 237 |  | // ~~RGB~~ color |
  |  | 241 | // HSL color |
  | 238 | 242 | if (strpos($color, "hsl") !== false) { |
  | 239 | 243 | $quad = self::getQuad($color, true); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L312) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L316) |  |
  | 312 | 316 | } |
  | 313 | 317 |  |
  | 314 |  | return trim(substr($color, $i + 1, $j - $i - 1)); |
  |  | 318 | //FIXME: gradients not supported? |
  |  | 319 | return null; // trim(substr($color, $i + 1, $j - $i - 1)); |
  | 315 | 320 | } |
  | 316 | 321 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L329) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L334) |  |
  | 329 | 334 | $quad = preg\_split("/\\s\*[,\\/]\\s\*/", trim(substr($color, $i + 1, $j - $i - 1))); |
  | 330 | 335 | if (!isset($quad[3])) { |
  | 331 |  | $quad[3] = ~~1~~; |
  |  | 336 | $quad[3] = "1"; |
  | 332 | 337 | } |
  | 333 | 338 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L343) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L348) |  |
  | 343 | 348 | $quad[$c] = floatval($quad[$c]) / 100; |
  | 344 | 349 | } else { |
  | 345 |  | $quad[$c] = ~~$quad[$c]~~ / 255; |
  |  | 350 | $quad[$c] = floatval($quad[$c]) / 255; |
  | 346 | 351 | } |
  | 347 | 352 | } else { |
  | 348 | 353 | if ($quad[$c][strlen($quad[$c]) - 1] === "%") { |
  | 349 |  | $quad[$c] = round(floatval($quad[$c]) \* 2.55); |
  |  | 354 | $quad[$c] = floatval($quad[$c]) \* 2.55; |
  |  | 355 | } else { |
  |  | 356 | $quad[$c] = floatval($quad[$c]); |
  | 350 | 357 | } |
  | 351 | 358 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L357) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L364) |  |
  | 357 | 364 | static function parseHexColor($hex) |
  | 358 | 365 | { |
  | 359 |  | $c = array(0~~, 0, 0, 1~~); |
  |  | 366 | $c = array(0.0, 0.0, 0.0, 1.0); |
  | 360 | 367 |  |
  | 361 | 368 | // #FFFFFF |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1045 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1045 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1045 | 1045 | } |
  | 1046 | 1046 |  |
  | 1047 |  | return 'SUB' . str\_pad($base\_26, 3, 'A', STR\_PAD\_LEFT); |
  |  | 1047 | return 'SUB' . str\_pad($base\_26, 3, 'A', STR\_PAD\_LEFT); |
  | 1048 | 1048 | } |
  | 1049 | 1049 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1315) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1315) |  |
  | 1315 | 1315 | $res = "\n$id 0 obj\n"; |
  | 1316 | 1316 | $res .= "<</Length " . mb\_strlen($stream, '8bit') . " >>\n"; |
  | 1317 |  | $res .= "stream\n" . $stream . "\nendstream" . "\nendobj";~~;~~ |
  |  | 1317 | $res .= "stream\n" . $stream . "\nendstream" . "\nendobj"; |
  | 1318 | 1318 |  |
  | 1319 | 1319 | return $res; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1725) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1725) |  |
  | 1725 | 1725 | // dates must be outputted as-is, without Unicode transformations |
  | 1726 | 1726 | if ($k !== 'CreationDate' && $k !== 'ModDate') { |
  | 1727 |  | $v = $this->~~filterText($v, true, false~~); |
  |  | 1727 | $v = $this->utf8toUtf16BE($v); |
  | 1728 | 1728 | } |
  | 1729 | 1729 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1732) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1732) |  |
  | 1732 | 1732 | } |
  | 1733 | 1733 |  |
  | 1734 |  | $res .= $~~v~~; |
  |  | 1734 | $res .= $this->filterText($v, false, false); |
  | 1735 | 1735 | $res .= ")\n"; |
  | 1736 | 1736 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2357) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2357) |  |
  | 2357 | 2357 |  |
  | 2358 | 2358 | foreach ($o["info"] as $k => $v) { |
  | 2359 |  | switch($k) |
  | 2360 |  | { |
  |  | 2359 | switch ($k) { |
  | 2361 | 2360 | case 'Subtype': |
  | 2362 | 2361 | $res .= "/Subtype /$v\n"; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2411) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2410) |  |
  | 2411 | 2410 |  |
  | 2412 | 2411 | $res .= "/Length " . mb\_strlen($tmp, '8bit') . " >>\n"; |
  | 2413 |  | $res .= "stream\n" . $tmp . "\nendstream" . "\nendobj";~~;~~ |
  |  | 2412 | $res .= "stream\n" . $tmp . "\nendstream" . "\nendobj"; |
  | 2414 | 2413 |  |
  | 2415 | 2414 | return $res; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2449) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2448) |  |
  | 2449 | 2448 |  |
  | 2450 | 2449 | foreach ($o["info"] as $k => $v) { |
  | 2451 |  | switch($k) { |
  |  | 2450 | switch ($k) { |
  | 2452 | 2451 | case 'Fields': |
  | 2453 | 2452 | $res .= " /Fields ["; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2553) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2552) |  |
  | 2553 | 2552 | break; |
  | 2554 | 2553 | case 'T': |
  | 2555 |  | if($encrypted) { |
  |  | 2554 | if ($encrypted) { |
  | 2556 | 2555 | $v = $this->filterText($this->ARC4($v), false, false); |
  | 2557 | 2556 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2596) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2595) |  |
  | 2596 | 2595 | $len = strlen('/ByteRange [ \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* ]'); |
  | 2597 | 2596 | $rangeStartPos = $pos + $len + 1 + 10; // before '<' |
  | 2598 |  | $content = substr\_replace($content, str\_pad(sprintf('/ByteRange [ 0 %u %u %u ]', $rangeStartPos, $rangeStartPos + $sign\_maxlen + 2, $content\_len - 2 - $sign\_maxlen - $rangeStartPos), $len, ' ', STR\_PAD\_RIGHT), $pos, $len); |
  |  | 2597 | $content = substr\_replace($content, str\_pad(sprintf('/ByteRange [ 0 %u %u %u ]', $rangeStartPos, $rangeStartPos + $sign\_maxlen + 2, $content\_len - 2 - $sign\_maxlen - $rangeStartPos), $len, ' ', STR\_PAD\_RIGHT), $pos, $len); |
  | 2599 | 2598 |  |
  | 2600 | 2599 | $fuid = uniqid(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2660) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2659) |  |
  | 2660 | 2659 | $o = &$this->objects[$id]; |
  | 2661 | 2660 | foreach ($o['info'] as $k => $v) { |
  | 2662 |  | switch($k) { |
  |  | 2661 | switch ($k) { |
  | 2663 | 2662 | case 'Name': |
  | 2664 | 2663 | case 'Location': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2786) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2785) |  |
  | 2786 | 2785 | $res = "\n$id 0 obj << "; |
  | 2787 | 2786 |  |
  | 2788 |  | foreach($this->objects[$id]['info'] as $referenceObjName => $referenceObjId) { |
  |  | 2787 | foreach ($this->objects[$id]['info'] as $referenceObjName => $referenceObjId) { |
  | 2789 | 2788 | $res .= "/$referenceObjName $referenceObjId 0 R "; |
  | 2790 | 2789 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2852) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2851) |  |
  | 2852 | 2851 | case 'out': |
  | 2853 | 2852 | $info = &$this->objects[$id]['info']; |
  |  | 2853 | $filename = $this->utf8toUtf16BE($info['filename']); |
  |  | 2854 | $description = $this->utf8toUtf16BE($info['description']); |
  | 2854 | 2855 |  |
  | 2855 | 2856 | if ($this->encrypted) { |
  | 2856 | 2857 | $this->encryptInit($id); |
  | 2857 |  | $filename = $this->ARC4($~~info['filename']~~); |
  | 2858 |  | $description = $this->ARC4($~~info['description']~~); |
  | 2859 |  | }~~else {~~ |
  | 2860 |  | $filename = $info['filename']; |
  | 2861 |  | ~~$description = $info['description']~~; |
  | 2862 |  | ~~}~~ |
  |  | 2858 | $filename = $this->ARC4($filename); |
  |  | 2859 | $description = $this->ARC4($description); |
  |  | 2860 | } |
  |  | 2861 |  |
  |  | 2862 | $filename = $this->filterText($filename, false, false); |
  |  | 2863 | $description = $this->filterText($description, false, false); |
  | 2863 | 2864 |  |
  | 2864 | 2865 | $res = "\n$id 0 obj <</Type /Filespec /EF"; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3242) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3243) |  |
  | 3242 | 3243 | // assume that $font contains the path and file but not the extension |
  | 3243 | 3244 | $name = basename($font); |
  | 3244 |  | $dir = dirname($font)~~. '/'~~; |
  |  | 3245 | $dir = dirname($font); |
  | 3245 | 3246 |  |
  | 3246 | 3247 | $fontcache = $this->fontcache; |
  | 3247 | 3248 | if ($fontcache == '') { |
  | 3248 |  | $fontcache = ~~rtrim($dir, DIRECTORY\_SEPARATOR."/\\")~~; |
  |  | 3249 | $fontcache = $dir; |
  | 3249 | 3250 | } |
  | 3250 | 3251 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3263) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3264) |  |
  | 3263 | 3264 | } |
  | 3264 | 3265 |  |
  | 3265 |  | $cache\_name = "$metrics\_name.~~php~~"; |
  |  | 3266 | $cache\_name = "$metrics\_name.json"; |
  | 3266 | 3267 | $this->addMessage("metrics: $metrics\_name, cache: $cache\_name"); |
  | 3267 | 3268 |  |
  | 3268 | 3269 | if (file\_exists($fontcache . '/' . $cache\_name)) { |
  | 3269 |  | $this->addMessage("openFont: php file exists $fontcache/$cache\_name"); |
  | 3270 |  | $this->fonts[$font] = require($fontcache . '/' . $cache\_name); |
  | 3271 |  |  |
  | 3272 |  | if (!isset($this->fonts[$font]['\_version\_']) || $this->fonts[$font]['\_version\_'] != $this->fontcacheVersion) { |
  | 3273 |  | // if the font file is old, then clear it out and prepare for re-creation |
  | 3274 |  | $this->addMessage('openFont: clear out, make way for new version.'); |
  | 3275 |  | $this->fonts[$font] = null; |
  | 3276 |  | unset($this->fonts[$font]); |
  | 3277 |  | } |
  | 3278 |  | } else { |
  | 3279 |  | $old\_cache\_name = "php\_$metrics\_name"; |
  | 3280 |  | if (file\_exists($fontcache . '/' . $old\_cache\_name)) { |
  | 3281 |  | $this->addMessage( |
  | 3282 |  | "openFont: php file doesn't exist $fontcache/$cache\_name, creating it from the old format" |
  | 3283 |  | ); |
  | 3284 |  | $old\_cache = file\_get\_contents($fontcache . '/' . $old\_cache\_name); |
  | 3285 |  | file\_put\_contents($fontcache . '/' . $cache\_name, '<?php return ' . $old\_cache . ';'); |
  | 3286 |  |  |
  | 3287 |  | $this->openFont($font); |
  | 3288 |  | return; |
  | 3289 |  | } |
  | 3290 |  | } |
  | 3291 |  |  |
  | 3292 |  | if (!isset($this->fonts[$font]) && file\_exists($dir . $metrics\_name)) { |
  |  | 3270 | $this->addMessage("openFont: json metrics file exists $fontcache/$cache\_name"); |
  |  | 3271 | $cached\_font\_info = json\_decode(file\_get\_contents($fontcache . '/' . $cache\_name), true); |
  |  | 3272 | if (!isset($cached\_font\_info['\_version\_']) || $cached\_font\_info['\_version\_'] != $this->fontcacheVersion) { |
  |  | 3273 | $this->addMessage('openFont: font cache is out of date, regenerating'); |
  |  | 3274 | } else { |
  |  | 3275 | $this->fonts[$font] = $cached\_font\_info; |
  |  | 3276 | } |
  |  | 3277 | } |
  |  | 3278 |  |
  |  | 3279 | if (!isset($this->fonts[$font]) && file\_exists("$dir/$metrics\_name")) { |
  | 3293 | 3280 | // then rebuild the php\_<font>.afm file from the <font>.afm file |
  | 3294 |  | $this->addMessage("openFont: build php file from $dir$metrics\_name"); |
  |  | 3281 | $this->addMessage("openFont: build php file from $dir/$metrics\_name"); |
  | 3295 | 3282 | $data = []; |
  | 3296 | 3283 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3307) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3294) |  |
  | 3307 | 3294 | } |
  | 3308 | 3295 |  |
  | 3309 |  | $file = file(~~$dir . $metrics\_name~~); |
  |  | 3296 | $file = file("$dir/$metrics\_name"); |
  | 3310 | 3297 |  |
  | 3311 | 3298 | foreach ($file as $rowA) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3461) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3448) |  |
  | 3461 | 3448 | //If not existing, this will hit performance because of missing cached results. |
  | 3462 | 3449 | if (is\_dir($fontcache) && is\_writable($fontcache)) { |
  | 3463 |  | file\_put\_contents(~~$fontcache . '/' . $cache\_name, '<?php return ' . var\_export($data, true) . ';'~~); |
  |  | 3450 | file\_put\_contents("$fontcache/$cache\_name", json\_encode($data, JSON\_PRETTY\_PRINT)); |
  | 3464 | 3451 | } |
  | 3465 | 3452 | $data = null; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3469) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3456) |  |
  | 3469 | 3456 | $this->addMessage("openFont: no font file found for $font. Do you need to run load\_font.php?"); |
  | 3470 | 3457 | } |
  | 3471 |  |  |
  | 3472 |  | ~~//pre\_r($this->messages);~~ |
  | 3473 | 3458 | } |
  | 3474 | 3459 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3480) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3465) |  |
  | 3480 | 3465 | \* and 'differences' => an array of mappings between numbers 0->255 and character names. |
  | 3481 | 3466 | \* |
  | 3482 |  | \* @param $fontName |
  |  | 3467 | \* @param string $fontName |
  | 3483 | 3468 | \* @param string $encoding |
  | 3484 | 3469 | \* @param bool $set |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3628) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3613) |  |
  | 3628 | 3613 | \* sets the color for fill operations |
  | 3629 | 3614 | \* |
  | 3630 |  | \* @param $color |
  | 3631 |  | \* @param bool $force |
  |  | 3615 | \* @param array $color |
  |  | 3616 | \* @param bool  $force |
  | 3632 | 3617 | \*/ |
  | 3633 | 3618 | function setColor($color, $force = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3653) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3638) |  |
  | 3653 | 3638 | \* sets the color for fill operations |
  | 3654 | 3639 | \* |
  | 3655 |  | \* @param $fillRule |
  |  | 3640 | \* @param string $fillRule |
  | 3656 | 3641 | \*/ |
  | 3657 | 3642 | function setFillRule($fillRule) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3667) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3652) |  |
  | 3667 | 3652 | \* sets the color for stroke operations |
  | 3668 | 3653 | \* |
  | 3669 |  | \* @param $color |
  | 3670 |  | \* @param bool $force |
  |  | 3654 | \* @param array $color |
  |  | 3655 | \* @param bool  $force |
  | 3671 | 3656 | \*/ |
  | 3672 | 3657 | function setStrokeColor($color, $force = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3819) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3804) |  |
  | 3819 | 3804 | \* draw a line from one set of coordinates to another |
  | 3820 | 3805 | \* |
  | 3821 |  | \* @param $x1 |
  | 3822 |  | \* @param $y1 |
  | 3823 |  | \* @param $x2 |
  | 3824 |  | \* @param $y2 |
  | 3825 |  | \* @param bool $stroke |
  |  | 3806 | \* @param float $x1 |
  |  | 3807 | \* @param float $y1 |
  |  | 3808 | \* @param float $x2 |
  |  | 3809 | \* @param float $y2 |
  |  | 3810 | \* @param bool  $stroke |
  | 3826 | 3811 | \*/ |
  | 3827 | 3812 | function line($x1, $y1, $x2, $y2, $stroke = true) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3837) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3822) |  |
  | 3837 | 3822 | \* draw a bezier curve based on 4 control points |
  | 3838 | 3823 | \* |
  | 3839 |  | \* @param $x0 |
  | 3840 |  | \* @param $y0 |
  | 3841 |  | \* @param $x1 |
  | 3842 |  | \* @param $y1 |
  | 3843 |  | \* @param $x2 |
  | 3844 |  | \* @param $y2 |
  | 3845 |  | \* @param $x3 |
  | 3846 |  | \* @param $y3 |
  |  | 3824 | \* @param float $x0 |
  |  | 3825 | \* @param float $y0 |
  |  | 3826 | \* @param float $x1 |
  |  | 3827 | \* @param float $y1 |
  |  | 3828 | \* @param float $x2 |
  |  | 3829 | \* @param float $y2 |
  |  | 3830 | \* @param float $x3 |
  |  | 3831 | \* @param float $y3 |
  | 3847 | 3832 | \*/ |
  | 3848 | 3833 | function curve($x0, $y0, $x1, $y1, $x2, $y2, $x3, $y3) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3858) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3843) |  |
  | 3858 | 3843 | \* draw a part of an ellipse |
  | 3859 | 3844 | \* |
  | 3860 |  | \* @param $x0 |
  | 3861 |  | \* @param $y0 |
  | 3862 |  | \* @param $astart |
  | 3863 |  | \* @param $afinish |
  | 3864 |  | \* @param $r1 |
  | 3865 |  | \* @param ~~in~~t $r2 |
  | 3866 |  | \* @param ~~in~~t $angle |
  |  | 3845 | \* @param float $x0 |
  |  | 3846 | \* @param float $y0 |
  |  | 3847 | \* @param float $astart |
  |  | 3848 | \* @param float $afinish |
  |  | 3849 | \* @param float $r1 |
  |  | 3850 | \* @param float $r2 |
  |  | 3851 | \* @param float $angle |
  | 3867 | 3852 | \* @param int $nSeg |
  | 3868 | 3853 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3875) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3860) |  |
  | 3875 | 3860 | \* draw a filled ellipse |
  | 3876 | 3861 | \* |
  | 3877 |  | \* @param $x0 |
  | 3878 |  | \* @param $y0 |
  | 3879 |  | \* @param $r1 |
  | 3880 |  | \* @param ~~in~~t $r2 |
  | 3881 |  | \* @param ~~in~~t $angle |
  |  | 3862 | \* @param float $x0 |
  |  | 3863 | \* @param float $y0 |
  |  | 3864 | \* @param float $r1 |
  |  | 3865 | \* @param float $r2 |
  |  | 3866 | \* @param float $angle |
  | 3882 | 3867 | \* @param int $nSeg |
  | 3883 |  | \* @param ~~in~~t $astart |
  | 3884 |  | \* @param ~~in~~t $afinish |
  |  | 3868 | \* @param float $astart |
  |  | 3869 | \* @param float $afinish |
  | 3885 | 3870 | \*/ |
  | 3886 | 3871 | function filledEllipse($x0, $y0, $r1, $r2 = 0, $angle = 0, $nSeg = 8, $astart = 0, $afinish = 360) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3890) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3875) |  |
  | 3890 | 3875 |  |
  | 3891 | 3876 | /\*\* |
  | 3892 |  | \* @param $x |
  | 3893 |  | \* @param $y |
  |  | 3877 | \* @param float $x |
  |  | 3878 | \* @param float $y |
  | 3894 | 3879 | \*/ |
  | 3895 | 3880 | function lineTo($x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3899) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3884) |  |
  | 3899 | 3884 |  |
  | 3900 | 3885 | /\*\* |
  | 3901 |  | \* @param $x |
  | 3902 |  | \* @param $y |
  |  | 3886 | \* @param float $x |
  |  | 3887 | \* @param float $y |
  | 3903 | 3888 | \*/ |
  | 3904 | 3889 | function moveTo($x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3910) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3895) |  |
  | 3910 | 3895 | \* draw a bezier curve based on 4 control points |
  | 3911 | 3896 | \* |
  | 3912 |  | \* @param $x1 |
  | 3913 |  | \* @param $y1 |
  | 3914 |  | \* @param $x2 |
  | 3915 |  | \* @param $y2 |
  | 3916 |  | \* @param $x3 |
  | 3917 |  | \* @param $y3 |
  |  | 3897 | \* @param float $x1 |
  |  | 3898 | \* @param float $y1 |
  |  | 3899 | \* @param float $x2 |
  |  | 3900 | \* @param float $y2 |
  |  | 3901 | \* @param float $x3 |
  |  | 3902 | \* @param float $y3 |
  | 3918 | 3903 | \*/ |
  | 3919 | 3904 | function curveTo($x1, $y1, $x2, $y2, $x3, $y3) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3924) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3909) |  |
  | 3924 | 3909 | /\*\* |
  | 3925 | 3910 | \* draw a bezier curve based on 4 control points |
  |  | 3911 | \* |
  |  | 3912 | \* @param float $cpx |
  |  | 3913 | \* @param float $cpy |
  |  | 3914 | \* @param float $x |
  |  | 3915 | \* @param float $y |
  | 3926 | 3916 | \*/ |
  | 3927 | 3917 | function quadTo($cpx, $cpy, $x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3951) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3941) |  |
  | 3951 | 3941 | \* pretty crappy shape at 2, as we are approximating with bezier curves. |
  | 3952 | 3942 | \* |
  | 3953 |  | \* @param $x0 |
  | 3954 |  | \* @param $y0 |
  | 3955 |  | \* @param $r1 |
  | 3956 |  | \* @param ~~in~~t $r2 |
  | 3957 |  | \* @param ~~in~~t $angle |
  | 3958 |  | \* @param int $nSeg |
  | 3959 |  | \* @param ~~in~~t $astart |
  | 3960 |  | \* @param ~~in~~t $afinish |
  | 3961 |  | \* @param bool $close |
  | 3962 |  | \* @param bool $fill |
  | 3963 |  | \* @param bool $stroke |
  | 3964 |  | \* @param bool $incomplete |
  |  | 3943 | \* @param float $x0 |
  |  | 3944 | \* @param float $y0 |
  |  | 3945 | \* @param float $r1 |
  |  | 3946 | \* @param float $r2 |
  |  | 3947 | \* @param float $angle |
  |  | 3948 | \* @param int   $nSeg |
  |  | 3949 | \* @param float $astart |
  |  | 3950 | \* @param float $afinish |
  |  | 3951 | \* @param bool  $close |
  |  | 3952 | \* @param bool  $fill |
  |  | 3953 | \* @param bool  $stroke |
  |  | 3954 | \* @param bool  $incomplete |
  | 3965 | 3955 | \*/ |
  | 3966 | 3956 | function ellipse( |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4076) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4066) |  |
  | 4076 | 4066 | \* phase is a modifier on the dash pattern which is used to shift the point at which the pattern starts. |
  | 4077 | 4067 | \* |
  | 4078 |  | \* @param ~~int~~ $width |
  |  | 4068 | \* @param float  $width |
  | 4079 | 4069 | \* @param string $cap |
  | 4080 | 4070 | \* @param string $join |
  | 4081 |  | \* @param ~~string~~ $dash |
  | 4082 |  | \* @param int $phase |
  |  | 4071 | \* @param array  $dash |
  |  | 4072 | \* @param int    $phase |
  | 4083 | 4073 | \*/ |
  | 4084 | 4074 | function setLineStyle($width = 1, $cap = '', $join = '', $dash = '', $phase = 0) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4114) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4104) |  |
  | 4114 | 4104 | \* draw a polygon, the syntax for this is similar to the GD polygon command |
  | 4115 | 4105 | \* |
  | 4116 |  | \* @param $p |
  | 4117 |  | \* @param $np |
  | 4118 |  | \* @param bool $f |
  | 4119 |  | \*/ |
  | 4120 |  | function polygon($p, $np, $f = false) |
  |  | 4106 | \* @param float[] $p |
  |  | 4107 | \* @param bool    $fill |
  |  | 4108 | \*/ |
  |  | 4109 | public function polygon(array $p, bool $fill = false): void |
  | 4121 | 4110 | { |
  | 4122 | 4111 | $this->addContent(sprintf("\n%.3F %.3F m ", $p[0], $p[1])); |
  | 4123 | 4112 |  |
  | 4124 |  | for ($i = 2; $i < $np \* 2; $i = $i + 2) { |
  |  | 4113 | $n = count($p); |
  |  | 4114 | for ($i = 2; $i < $n; $i = $i + 2) { |
  | 4125 | 4115 | $this->addContent(sprintf("%.3F %.3F l ", $p[$i], $p[$i + 1])); |
  | 4126 | 4116 | } |
  | 4127 | 4117 |  |
  | 4128 |  | if ($f) { |
  |  | 4118 | if ($fill) { |
  | 4129 | 4119 | $this->addContent(' f'); |
  | 4130 | 4120 | } else { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4137) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4127) |  |
  | 4137 | 4127 | \* the coordinates of the upper-right corner |
  | 4138 | 4128 | \* |
  | 4139 |  | \* @param $x1 |
  | 4140 |  | \* @param $y1 |
  | 4141 |  | \* @param $width |
  | 4142 |  | \* @param $height |
  |  | 4129 | \* @param float $x1 |
  |  | 4130 | \* @param float $y1 |
  |  | 4131 | \* @param float $width |
  |  | 4132 | \* @param float $height |
  | 4143 | 4133 | \*/ |
  | 4144 | 4134 | function filledRectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4151) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4141) |  |
  | 4151 | 4141 | \* the coordinates of the upper-right corner |
  | 4152 | 4142 | \* |
  | 4153 |  | \* @param $x1 |
  | 4154 |  | \* @param $y1 |
  | 4155 |  | \* @param $width |
  | 4156 |  | \* @param $height |
  |  | 4143 | \* @param float $x1 |
  |  | 4144 | \* @param float $y1 |
  |  | 4145 | \* @param float $width |
  |  | 4146 | \* @param float $height |
  | 4157 | 4147 | \*/ |
  | 4158 | 4148 | function rectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4165) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4155) |  |
  | 4165 | 4155 | \* the coordinates of the upper-right corner |
  | 4166 | 4156 | \* |
  | 4167 |  | \* @param $x1 |
  | 4168 |  | \* @param $y1 |
  | 4169 |  | \* @param $width |
  | 4170 |  | \* @param $height |
  |  | 4157 | \* @param float $x1 |
  |  | 4158 | \* @param float $y1 |
  |  | 4159 | \* @param float $width |
  |  | 4160 | \* @param float $height |
  | 4171 | 4161 | \*/ |
  | 4172 | 4162 | function rect($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4280) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4270) |  |
  | 4280 | 4270 |  |
  | 4281 | 4271 | $currentFontNum = $this->currentFontNum; |
  | 4282 |  | $font = array\_filter($this->objects[$this->currentNode]['info']['fonts'], |
  | 4283 |  | function($item) use ($currentFontNum) { return $item['fontNum'] == $currentFontNum; }); |
  |  | 4272 | $font = array\_filter( |
  |  | 4273 | $this->objects[$this->currentNode]['info']['fonts'], |
  |  | 4274 | function ($item) use ($currentFontNum) { return $item['fontNum'] == $currentFontNum; } |
  |  | 4275 | ); |
  | 4284 | 4276 |  |
  | 4285 | 4277 | $this->o\_acroform($this->acroFormId, 'font', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4396) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4388) |  |
  | 4396 | 4388 | \* draw a clipping rectangle, all the elements added after this will be clipped |
  | 4397 | 4389 | \* |
  | 4398 |  | \* @param $x1 |
  | 4399 |  | \* @param $y1 |
  | 4400 |  | \* @param $width |
  | 4401 |  | \* @param $height |
  |  | 4390 | \* @param float $x1 |
  |  | 4391 | \* @param float $y1 |
  |  | 4392 | \* @param float $width |
  |  | 4393 | \* @param float $height |
  | 4402 | 4394 | \*/ |
  | 4403 | 4395 | function clippingRectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4410) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4402) |  |
  | 4410 | 4402 | \* draw a clipping rounded rectangle, all the elements added after this will be clipped |
  | 4411 | 4403 | \* |
  | 4412 |  | \* @param $x1 |
  | 4413 |  | \* @param $y1 |
  | 4414 |  | \* @param $w |
  | 4415 |  | \* @param $h |
  | 4416 |  | \* @param $rTL |
  | 4417 |  | \* @param $rTR |
  | 4418 |  | \* @param $rBR |
  | 4419 |  | \* @param $rBL |
  |  | 4404 | \* @param float $x1 |
  |  | 4405 | \* @param float $y1 |
  |  | 4406 | \* @param float $w |
  |  | 4407 | \* @param float $h |
  |  | 4408 | \* @param float $rTL |
  |  | 4409 | \* @param float $rTR |
  |  | 4410 | \* @param float $rBR |
  |  | 4411 | \* @param float $rBL |
  | 4420 | 4412 | \*/ |
  | 4421 | 4413 | function clippingRectangleRounded($x1, $y1, $w, $h, $rTL, $rTR, $rBR, $rBL) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4455) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4447) |  |
  | 4455 | 4447 | // Close & clip |
  | 4456 | 4448 | $this->addContent(" W n"); |
  |  | 4449 | } |
  |  | 4450 |  |
  |  | 4451 | /\*\* |
  |  | 4452 | \* draw a clipping polygon, the syntax for this is similar to the GD polygon command |
  |  | 4453 | \* |
  |  | 4454 | \* @param float[] $p |
  |  | 4455 | \*/ |
  |  | 4456 | public function clippingPolygon(array $p): void |
  |  | 4457 | { |
  |  | 4458 | $this->save(); |
  |  | 4459 |  |
  |  | 4460 | $this->addContent(sprintf("\n%.3F %.3F m ", $p[0], $p[1])); |
  |  | 4461 |  |
  |  | 4462 | $n = count($p); |
  |  | 4463 | for ($i = 2; $i < $n; $i = $i + 2) { |
  |  | 4464 | $this->addContent(sprintf("%.3F %.3F l ", $p[$i], $p[$i + 1])); |
  |  | 4465 | } |
  |  | 4466 |  |
  |  | 4467 | $this->addContent("W n"); |
  | 4457 | 4468 | } |
  | 4458 | 4469 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4673) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4684) |  |
  | 4673 | 4684 | \* return the height in units of the current font in the given size |
  | 4674 | 4685 | \* |
  | 4675 |  | \* @param $size |
  | 4676 |  | \* @return float|int |
  | 4677 |  | \*/ |
  | 4678 |  | function getFontHeight($size) |
  |  | 4686 | \* @param float $size |
  |  | 4687 | \* |
  |  | 4688 | \* @return float |
  |  | 4689 | \*/ |
  |  | 4690 | public function getFontHeight(float $size): float |
  | 4679 | 4691 | { |
  | 4680 | 4692 | if (!$this->numFonts) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4708) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4720) |  |
  | 4708 | 4720 |  |
  | 4709 | 4721 | /\*\* |
  | 4710 |  | \* @param $size |
  | 4711 |  | \* @return float|int |
  | 4712 |  | \*/ |
  | 4713 |  | function getFontXHeight($size) |
  |  | 4722 | \* @param float $size |
  |  | 4723 | \* |
  |  | 4724 | \* @return float |
  |  | 4725 | \*/ |
  |  | 4726 | public function getFontXHeight(float $size): float |
  | 4714 | 4727 | { |
  | 4715 | 4728 | if (!$this->numFonts) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4734) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4747) |  |
  | 4734 | 4747 | \* it is in the pdf user units |
  | 4735 | 4748 | \* |
  | 4736 |  | \* @param $size |
  | 4737 |  | \* @return float|int |
  | 4738 |  | \*/ |
  | 4739 |  | function getFontDescender($size) |
  |  | 4749 | \* @param float $size |
  |  | 4750 | \* |
  |  | 4751 | \* @return float |
  |  | 4752 | \*/ |
  |  | 4753 | public function getFontDescender(float $size): float |
  | 4740 | 4754 | { |
  | 4741 | 4755 | // note that this will most likely return a negative value |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4753) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4767) |  |
  | 4753 | 4767 | \* filter the text, this is applied to all text just before being inserted into the pdf document |
  | 4754 | 4768 | \* it escapes the various things that need to be escaped, and so on |
  | 4755 |  | ~~\*~~ |
  | 4756 |  | ~~\* @access private~~ |
  | 4757 | 4769 | \* |
  | 4758 | 4770 | \* @param $text |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4775) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4787) |  |
  | 4775 | 4787 | $text = mb\_convert\_encoding($text, self::$targetEncoding, 'UTF-8'); |
  | 4776 | 4788 | } |
  | 4777 |  | } elseif ($bom) { |
  |  | 4789 | } elseif ($bom) { |
  | 4778 | 4790 | $text = $this->utf8toUtf16BE($text, $bom); |
  | 4779 | 4791 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4790) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4802) |  |
  | 4790 | 4802 | \* RFC for UTF-8 at http://www.faqs.org/rfcs/rfc3629.html |
  | 4791 | 4803 | \* |
  | 4792 |  | ~~\* @access private~~ |
  | 4793 |  | ~~\* @author Orion Richardson~~ |
  | 4794 |  | ~~\* @since  January 5, 2008~~ |
  | 4795 |  | ~~\*~~ |
  | 4796 | 4804 | \* @param string $text UTF-8 string to process |
  | 4797 |  | ~~\*~~ |
  | 4798 | 4805 | \* @return array UTF-8 codepoints array for the string |
  | 4799 | 4806 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4865) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4872) |  |
  | 4865 | 4872 | \* RFC for UTF-8 at http://www.faqs.org/rfcs/rfc3629.html |
  | 4866 | 4873 | \* |
  | 4867 |  | ~~\* @access private~~ |
  | 4868 |  | ~~\* @author Orion Richardson~~ |
  | 4869 |  | ~~\* @since  January 5, 2008~~ |
  | 4870 |  | ~~\*~~ |
  | 4871 | 4874 | \* @param string  $text UTF-8 string to process |
  | 4872 | 4875 | \* @param boolean $bom  whether to add the byte order marker |
  | 4873 |  | ~~\*~~ |
  | 4874 | 4876 | \* @return string UTF-16 result string |
  | 4875 | 4877 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4946) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4948) |  |
  | 4946 | 4948 | \* register text for font subsetting |
  | 4947 | 4949 | \* |
  | 4948 |  | \* @param $font |
  | 4949 |  | \* @param $text |
  |  | 4950 | \* @param string $font |
  |  | 4951 | \* @param string $text |
  | 4950 | 4952 | \*/ |
  | 4951 | 4953 | function registerText($font, $text) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4956) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4958) |  |
  | 4956 | 4958 |  |
  | 4957 | 4959 | if (!isset($this->stringSubsets[$font])) { |
  | 4958 |  | $this->stringSubsets[$font] = []; |
  |  | 4960 | $base\_subset = "\u{fffd}\u{fffe}\u{ffff}"; |
  |  | 4961 | $this->stringSubsets[$font] = $this->utf8toCodePointsArray($base\_subset); |
  | 4959 | 4962 | } |
  | 4960 | 4963 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4967) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4970) |  |
  | 4967 | 4970 | \* add text to the document, at a specified location, size and angle on the page |
  | 4968 | 4971 | \* |
  | 4969 |  | \* @param $x |
  | 4970 |  | \* @param $y |
  | 4971 |  | \* @param $size |
  | 4972 |  | \* @param $text |
  | 4973 |  | \* @param ~~int~~ $angle |
  | 4974 |  | \* @param ~~int~~ $wordSpaceAdjust |
  | 4975 |  | \* @param ~~int~~ $charSpaceAdjust |
  | 4976 |  | \* @param bool $smallCaps |
  |  | 4972 | \* @param float  $x |
  |  | 4973 | \* @param float  $y |
  |  | 4974 | \* @param float  $size |
  |  | 4975 | \* @param string $text |
  |  | 4976 | \* @param float  $angle |
  |  | 4977 | \* @param float  $wordSpaceAdjust |
  |  | 4978 | \* @param float  $charSpaceAdjust |
  |  | 4979 | \* @param bool   $smallCaps |
  | 4977 | 4980 | \*/ |
  | 4978 | 4981 | function addText($x, $y, $size, $text, $angle = 0, $wordSpaceAdjust = 0, $charSpaceAdjust = 0, $smallCaps = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5087) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5090) |  |
  | 5087 | 5090 | \* this can be called externally, but is also used by the other class functions |
  | 5088 | 5091 | \* |
  | 5089 |  | \* @param float $size |
  |  | 5092 | \* @param float  $size |
  | 5090 | 5093 | \* @param string $text |
  | 5091 |  | \* @param float $word\_spacing |
  | 5092 |  | \* @param float $char\_spacing |
  |  | 5094 | \* @param float  $wordSpacing |
  |  | 5095 | \* @param float  $charSpacing |
  |  | 5096 | \* |
  | 5093 | 5097 | \* @return float |
  | 5094 | 5098 | \*/ |
  | 5095 |  | ~~function getTextWidth($size, $text, $word\_spacing = 0, $char\_spacing = 0)~~ |
  |  | 5099 | public function getTextWidth(float $size, string $text, float $wordSpacing = 0.0, float $charSpacing = 0.0): float |
  | 5096 | 5100 | { |
  | 5097 | 5101 | static $ord\_cache = []; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5107) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5111) |  |
  | 5107 | 5111 |  |
  | 5108 | 5112 | $text = str\_replace(["\r", "\n"], "", $text); |
  | 5109 |  |  |
  | 5110 |  | ~~// converts a number or a float to a string so it can get the width~~ |
  | 5111 |  | ~~$text = "$text";~~ |
  | 5112 | 5113 |  |
  | 5113 | 5114 | // hmm, this is where it all starts to get tricky - use the font information to |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5137) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5138) |  |
  | 5137 | 5138 | // add additional padding for space |
  | 5138 | 5139 | if (isset($current\_font['codeToName'][$char]) && $current\_font['codeToName'][$char] === 'space') {  // Space |
  | 5139 |  | $w += $word~~\_s~~pacing \* $space\_scale; |
  |  | 5140 | $w += $wordSpacing \* $space\_scale; |
  | 5140 | 5141 | } |
  | 5141 | 5142 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5143) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5144) |  |
  | 5143 | 5144 |  |
  | 5144 | 5145 | // add additional char spacing |
  | 5145 |  | if ($char~~\_s~~pacing != 0) { |
  | 5146 |  | $w += $char~~\_s~~pacing \* $space\_scale \* count($unicode); |
  |  | 5146 | if ($charSpacing != 0) { |
  |  | 5147 | $w += $charSpacing \* $space\_scale \* count($unicode); |
  | 5147 | 5148 | } |
  | 5148 | 5149 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5172) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5173) |  |
  | 5172 | 5173 | // add additional padding for space |
  | 5173 | 5174 | if (isset($current\_font['codeToName'][$char]) && $current\_font['codeToName'][$char] === 'space') {  // Space |
  | 5174 |  | $w += $word~~\_s~~pacing \* $space\_scale; |
  |  | 5175 | $w += $wordSpacing \* $space\_scale; |
  | 5175 | 5176 | } |
  | 5176 | 5177 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5178) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5179) |  |
  | 5178 | 5179 |  |
  | 5179 | 5180 | // add additional char spacing |
  | 5180 |  | if ($char~~\_s~~pacing != 0) { |
  | 5181 |  | $w += $char~~\_s~~pacing \* $space\_scale \* $len; |
  |  | 5181 | if ($charSpacing != 0) { |
  |  | 5182 | $w += $charSpacing \* $space\_scale \* $len; |
  | 5182 | 5183 | } |
  | 5183 | 5184 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5419) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5420) |  |
  | 5419 | 5420 |  |
  | 5420 | 5421 | /\*\* |
  | 5421 |  | \* ~~a~~dd content to the documents info object |
  | 5422 |  | \* |
  | 5423 |  | \* @param $label |
  | 5424 |  | \* @param ~~int~~ $value |
  | 5425 |  | \*/ |
  | 5426 |  | ~~function addInfo($label, $value = 0)~~ |
  |  | 5422 | \* Add content to the documents info object |
  |  | 5423 | \* |
  |  | 5424 | \* @param string|array $label |
  |  | 5425 | \* @param string       $value |
  |  | 5426 | \*/ |
  |  | 5427 | public function addInfo($label, string $value = ""): void |
  | 5427 | 5428 | { |
  | 5428 | 5429 | // this will only work if the label is one of the valid ones. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5432) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5433) |  |
  | 5432 | 5433 | if (is\_array($label)) { |
  | 5433 | 5434 | foreach ($label as $l => $v) { |
  | 5434 |  | $this->o\_info($this->infoObject, $l, $v); |
  |  | 5435 | $this->o\_info($this->infoObject, $l, (string) $v); |
  | 5435 | 5436 | } |
  | 5436 | 5437 | } else { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5569) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5570) |  |
  | 5569 | 5570 | { |
  | 5570 | 5571 | // generate images |
  | 5571 |  | $img = imagecreatefrompng($file); |
  |  | 5572 | $img = @imagecreatefrompng($file); |
  | 5572 | 5573 |  |
  | 5573 | 5574 | if ($img === false) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5618) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5619) |  |
  | 5618 | 5619 |  |
  | 5619 | 5620 | // Cast to 8bit+palette |
  | 5620 |  | $imgalpha\_ = imagecreatefrompng($tempfile\_alpha); |
  |  | 5621 | $imgalpha\_ = @imagecreatefrompng($tempfile\_alpha); |
  | 5621 | 5622 | imagecopy($imgalpha, $imgalpha\_, 0, 0, 0, 0, $wpx, $hpx); |
  | 5622 | 5623 | imagedestroy($imgalpha\_); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5631) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5632) |  |
  | 5631 | 5632 | $color\_channels->writeimage($tempfile\_plain); |
  | 5632 | 5633 |  |
  | 5633 |  | $imgplain = imagecreatefrompng($tempfile\_plain); |
  |  | 5634 | $imgplain = @imagecreatefrompng($tempfile\_plain); |
  | 5634 | 5635 | } |
  | 5635 | 5636 | // Use PECL imagick + ImageMagic to process transparent PNG images |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5654) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5655) |  |
  | 5654 | 5655 |  |
  | 5655 | 5656 | // Get opacity channel (negative of alpha channel) |
  | 5656 |  | if ($imagick->getImageAlphaChannel()~~!== 0~~) { |
  |  | 5657 | if ($imagick->getImageAlphaChannel()) { |
  | 5657 | 5658 | $alpha\_channel = $imagickClonable ? clone $imagick : $imagick->clone(); |
  | 5658 | 5659 | $alpha\_channel->separateImageChannel(\Imagick::CHANNEL\_ALPHA); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5664) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5665) |  |
  | 5664 | 5665 |  |
  | 5665 | 5666 | // Cast to 8bit+palette |
  | 5666 |  | $imgalpha\_ = imagecreatefrompng($tempfile\_alpha); |
  |  | 5667 | $imgalpha\_ = @imagecreatefrompng($tempfile\_alpha); |
  | 5667 | 5668 | imagecopy($imgalpha, $imgalpha\_, 0, 0, 0, 0, $wpx, $hpx); |
  | 5668 | 5669 | imagedestroy($imgalpha\_); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5680) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5681) |  |
  | 5680 | 5681 | $color\_channels->writeImage($tempfile\_plain); |
  | 5681 | 5682 |  |
  | 5682 |  | $imgplain = imagecreatefrompng($tempfile\_plain); |
  |  | 5683 | $imgplain = @imagecreatefrompng($tempfile\_plain); |
  | 5683 | 5684 | } else { |
  | 5684 | 5685 | // allocated colors cache |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L60 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L60 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 60 | 60 | $this->attributes = $attributes; |
  | 61 | 61 |  |
  | 62 |  | if (!$this->getDocument()->inDefs) { |
  |  | 62 | if (!$this->getDocument()->inDefs || $this instanceof StyleTag) { |
  | 63 | 63 | $this->before($attributes); |
  | 64 | 64 | $this->start($attributes); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L68) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L68) |  |
  | 68 | 68 | public function handleEnd() |
  | 69 | 69 | { |
  | 70 |  | if (!$this->getDocument()->inDefs) { |
  |  | 70 | if (!$this->getDocument()->inDefs || $this instanceof StyleTag) { |
  | 71 | 71 | $this->end(); |
  | 72 | 72 | $this->after(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L191) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L191) |  |
  | 191 | 191 |  |
  | 192 | 192 | /\*\* |
  |  | 193 | \* Apply a viewBox transform to the element |
  |  | 194 | \* |
  |  | 195 | \* @param array $attributes |
  |  | 196 | \*/ |
  |  | 197 | protected function applyViewbox($attributes) { |
  |  | 198 | if (!isset($attributes["viewbox"])) { |
  |  | 199 | return; |
  |  | 200 | } |
  |  | 201 |  |
  |  | 202 | $surface = $this->document->getSurface(); |
  |  | 203 | $viewBox = preg\_split('/[\s,]+/is', trim($attributes['viewbox'])); |
  |  | 204 | if (count($viewBox) != 4) { |
  |  | 205 | return; |
  |  | 206 | } |
  |  | 207 |  |
  |  | 208 | // Computing the equivalent transform of an SVG viewport |
  |  | 209 | // https://svgwg.org/svg2-draft/coords.html#ComputingAViewportsTransform |
  |  | 210 |  |
  |  | 211 | // 1. Let vb-x, vb-y, vb-width, vb-height be the min-x, min-y, width and height values of the viewBox attribute respectively. |
  |  | 212 | [$vbX, $vbY, $vbWidth, $vbHeight] = $viewBox; |
  |  | 213 |  |
  |  | 214 | if ($vbWidth < 0 || $vbHeight < 0) { |
  |  | 215 | return; |
  |  | 216 | } |
  |  | 217 |  |
  |  | 218 | // correct solution is to not render, for now scaling to 0 below |
  |  | 219 | //if ($vbWidth == 0 || $vbHeight == 0) { |
  |  | 220 | //} |
  |  | 221 |  |
  |  | 222 | // 2. Let e-x, e-y, e-width, e-height be the position and size of the element respectively. |
  |  | 223 | $eX = $attributes["x"] ?? 0; |
  |  | 224 | $eY = $attributes["y"] ?? 0; |
  |  | 225 | $eWidth = $attributes["width"] ?? $this->document->getWidth(); |
  |  | 226 | $eHeight = $attributes["height"] ?? $this->document->getHeight(); |
  |  | 227 |  |
  |  | 228 | // 3. Let align be the align value of preserveAspectRatio, or 'xMidYMid' if preserveAspectRatio is not defined. |
  |  | 229 | $preserveAspectRatio = explode(" ", $attributes["preserveAspectRatio"] ?? "xMidYMid meet"); |
  |  | 230 | $align = $preserveAspectRatio[0]; |
  |  | 231 |  |
  |  | 232 | // 4. Let meetOrSlice be the meetOrSlice value of preserveAspectRatio, or 'meet' if preserveAspectRatio is not defined or if meetOrSlice is missing from this value. |
  |  | 233 | $meetOrSlice = $meetOrSlice ?? "meet"; |
  |  | 234 |  |
  |  | 235 | // 5. Initialize scale-x to e-width/vb-width. |
  |  | 236 | $scaleX = $vbWidth == 0 ? 0 : ($eWidth / $vbWidth); |
  |  | 237 |  |
  |  | 238 | // 6. Initialize scale-y to e-height/vb-height. |
  |  | 239 | $scaleY = $vbHeight == 0 ? 0 : ($eHeight / $vbHeight); |
  |  | 240 |  |
  |  | 241 | // 7. If align is not 'none' and meetOrSlice is 'meet', set the larger of scale-x and scale-y to the smaller. |
  |  | 242 | if ($align !== "none" && $meetOrSlice === "meet") { |
  |  | 243 | $scaleX = min($scaleX, $scaleY); |
  |  | 244 | $scaleY = min($scaleX, $scaleY); |
  |  | 245 | } |
  |  | 246 |  |
  |  | 247 | // 8. Otherwise, if align is not 'none' and meetOrSlice is 'slice', set the smaller of scale-x and scale-y to the larger. |
  |  | 248 | elseif ($align !== "none" && $meetOrSlice === "slice") { |
  |  | 249 | $scaleX = max($scaleX, $scaleY); |
  |  | 250 | $scaleY = max($scaleX, $scaleY); |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // 9. Initialize translate-x to e-x - (vb-x \* scale-x). |
  |  | 254 | $translateX = $eX - ($vbX \* $scaleX); |
  |  | 255 |  |
  |  | 256 | // 10. Initialize translate-y to e-y - (vb-y \* scale-y) |
  |  | 257 | $translateY = $eY - ($vbY \* $scaleY); |
  |  | 258 |  |
  |  | 259 | // 11. If align contains 'xMid', add (e-width - vb-width \* scale-x) / 2 to translate-x. |
  |  | 260 | if (strpos($align, "xMid") !== false) { |
  |  | 261 | $translateX += ($eWidth - $vbWidth \* $scaleX) / 2; |
  |  | 262 | } |
  |  | 263 |  |
  |  | 264 | // 12. If align contains 'xMax', add (e-width - vb-width \* scale-x) to translate-x. |
  |  | 265 | if (strpos($align, "xMax") !== false) { |
  |  | 266 | $translateX += ($eWidth - $vbWidth \* $scaleX); |
  |  | 267 | } |
  |  | 268 |  |
  |  | 269 | // 13. If align contains 'yMid', add (e-height - vb-height \* scale-y) / 2 to translate-y. |
  |  | 270 | if (strpos($align, "yMid") !== false) { |
  |  | 271 | $translateX += ($eHeight - $vbHeight \* $scaleY) / 2; |
  |  | 272 | } |
  |  | 273 |  |
  |  | 274 | // 14. If align contains 'yMax', add (e-height - vb-height \* scale-y) to translate-y. |
  |  | 275 | if (strpos($align, "yMid") !== false) { |
  |  | 276 | $translateX += ($eHeight - $vbHeight \* $scaleY); |
  |  | 277 | } |
  |  | 278 |  |
  |  | 279 | $surface->translate($translateX, $translateY); |
  |  | 280 | $surface->scale($scaleX, $scaleY); |
  |  | 281 | } |
  |  | 282 |  |
  |  | 283 | /\*\* |
  | 193 | 284 | \* Convert the given size for the context of this current tag. |
  | 194 | 285 | \* Takes a pixel-based reference, which is usually specific to the context of the size, |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=2790488#L450 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=3076105#L450 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 450 | 450 | $toY = $ty - $fy; |
  | 451 | 451 |  |
  | 452 |  | if ($toX + $toY === 0) { |
  |  | 452 | if ((float)($toX + $toY) === 0.0) { |
  |  | 453 | return; |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | if ((float)abs($rx) == 0.0 || (float)abs($ry) === 0.0) { |
  |  | 457 | $surface->lineTo($tx, $ty); |
  | 453 | 458 | return; |
  | 454 | 459 | } |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L49 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L49 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 49 | 49 | $this->reference = $document->getDef($link); |
  | 50 | 50 |  |
  | 51 |  | ~~if ($this->reference) {~~ |
  | 52 |  | ~~$this->reference->before($attributes);~~ |
  | 53 |  | ~~}~~ |
  | 54 |  |  |
  | 55 | 51 | $surface = $document->getSurface(); |
  | 56 | 52 | $surface->save(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L64) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L60) |  |
  | 64 | 60 | } |
  | 65 | 61 | parent::after(); |
  | 66 |  |  |
  | 67 |  | ~~if ($this->reference) {~~ |
  | 68 |  | ~~$this->reference->after();~~ |
  | 69 |  | ~~}~~ |
  | 70 |  |  |
  | 71 | 62 | $this->getDocument()->getSurface()->restore(); |
  | 72 | 63 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L85) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L76) |  |
  | 85 | 76 | } |
  | 86 | 77 |  |
  |  | 78 | $originalAttributes = array\_merge($this->reference->attributes); |
  |  | 79 | $originalStyle = $this->reference->getStyle(); |
  | 87 | 80 | $mergedAttributes = $this->reference->attributes; |
  | 88 |  | $attributesToNotMerge = ['x', 'y', 'width', 'height', 'href', 'xlink:href', 'id']; |
  |  | 81 | $attributesToNotMerge = ['x', 'y', 'width', 'height', 'href', 'xlink:href', 'id', 'style']; |
  | 89 | 82 | foreach ($attributes as $attrKey => $attrVal) { |
  | 90 | 83 | if (!in\_array($attrKey, $attributesToNotMerge) && !isset($mergedAttributes[$attrKey])) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L92) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L85) |  |
  | 92 | 85 | } |
  | 93 | 86 | } |
  |  | 87 | $mergedAttributes['style'] = ($attributes['style'] ?? '') . ';' . ($mergedAttributes['style'] ?? ''); |
  | 94 | 88 |  |
  | 95 |  | $this->~~reference->handle(~~$mergedAttributes); |
  |  | 89 | $this->\_handle($this->reference, $mergedAttributes); |
  | 96 | 90 |  |
  | 97 |  | ~~foreach ($this->reference->children as $\_child) {~~ |
  | 98 |  | ~~$\_attributes = array\_merge($\_child->attributes, $mergedAttributes);~~ |
  | 99 |  | $~~\_child->handle($\_attributes~~); |
  |  | 91 | $this->reference->attributes = $originalAttributes; |
  |  | 92 | if ($originalStyle !== null) { |
  |  | 93 | $this->reference->setStyle($originalStyle); |
  | 100 | 94 | } |
  | 101 | 95 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L108) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L102) |  |
  | 108 | 102 | } |
  | 109 | 103 |  |
  | 110 |  | parent::handleEnd(); |
  | 111 |  |  |
  | 112 |  | if (!$this->reference) { |
  | 113 |  | return; |
  |  | 104 | if ($this->reference) { |
  |  | 105 | $this->\_handleEnd($this->reference); |
  | 114 | 106 | } |
  | 115 | 107 |  |
  | 116 |  | $this->reference->handleEnd(); |
  |  | 108 | parent::handleEnd(); |
  |  | 109 | } |
  | 117 | 110 |  |
  | 118 |  | foreach ($this->reference->children as $\_child) { |
  | 119 |  | $\_child->handleEnd(); |
  |  | 111 | private function \_handle($tag, $attributes) { |
  |  | 112 | $tag->handle($attributes); |
  |  | 113 | foreach ($tag->children as $child) { |
  |  | 114 | $originalAttributes = array\_merge($child->attributes); |
  |  | 115 | $originalStyle = $child->getStyle(); |
  |  | 116 | $mergedAttributes = $child->attributes; |
  |  | 117 | $mergedAttributes['style'] = ($attributes['style'] ?? '') . ';' . ($mergedAttributes['style'] ?? ''); |
  |  | 118 | $this->\_handle($child, $mergedAttributes); |
  |  | 119 | $child->attributes = $originalAttributes; |
  |  | 120 | if ($originalStyle !== null) { |
  |  | 121 | $child->setStyle($originalStyle); |
  |  | 122 | } |
  | 120 | 123 | } |
  | 121 | 124 | } |
  |  | 125 |  |
  |  | 126 | private function \_handleEnd($tag) { |
  |  | 127 | foreach ($tag->children as $child) { |
  |  | 128 | $this->\_handleEnd($child); |
  |  | 129 | } |
  |  | 130 | $tag->handleEnd(); |
  |  | 131 | } |
  | 122 | 132 | } |
* ## [woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L2 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L2 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | /\*\* |
  | 3 | 3 | \* Plugin Name:          PDF Invoices & Packing Slips for WooCommerce |
  |  | 4 | \* Requires Plugins:     woocommerce |
  | 4 | 5 | \* Plugin URI:           https://wpovernight.com/downloads/woocommerce-pdf-invoices-packing-slips-bundle/ |
  | 5 | 6 | \* Description:          Create, print & email PDF or UBL Invoices & PDF Packing Slips for WooCommerce orders. |
  | 6 |  | \* Version:              3.8.~~0~~ |
  |  | 7 | \* Version:              3.8.1 |
  | 7 | 8 | \* Author:               WP Overnight |
  | 8 | 9 | \* Author URI:           https://www.wpovernight.com |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L11) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L12) |  |
  | 11 | 12 | \* Text Domain:          woocommerce-pdf-invoices-packing-slips |
  | 12 | 13 | \* WC requires at least: 3.3 |
  | 13 |  | \* WC tested up to:      8.~~7~~ |
  |  | 14 | \* WC tested up to:      8.8 |
  | 14 | 15 | \*/ |
  | 15 | 16 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L22) | […](/browser/woocommerce-pdf-invoices-packing-slips/tags/3.8.1/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L23) |  |
  | 22 | 23 | class WPO\_WCPDF { |
  | 23 | 24 |  |
  | 24 |  | public $version              = '3.8.~~0~~'; |
  |  | 25 | public $version              = '3.8.1'; |
  | 25 | 26 | public $version\_php          = '7.2'; |
  | 26 | 27 | public $version\_woo          = '3.3'; |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L136 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=3076105#L136 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 136 | 136 | } |
  | 137 | 137 |  |
  | 138 |  | $( document ).ready( function() { |
  | 139 |  | resetDocumentType();      // force document type reset |
  | 140 |  | resetOrderId();           // force order ID reset |
  | 141 |  | loadPreviewData();        // load preview data |
  | 142 |  |  |
  | 143 |  | previousWindowWidth = $(window).width(); |
  | 144 |  | determinePreviewStates(); // determine preview states based on screen size |
  | 145 |  | } ); |
  |  | 138 | resetDocumentType();      // force document type reset |
  |  | 139 | resetOrderId();           // force order ID reset |
  |  | 140 | loadPreviewData();        // load preview data |
  |  | 141 |  |
  |  | 142 | previousWindowWidth = $( window ).width(); |
  |  | 143 | determinePreviewStates(); // determine preview states based on screen size |
  | 146 | 144 |  |
  | 147 | 145 | $( window ).on( 'resize', determinePreviewStates ); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L295) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=3076105#L293) |  |
  | 295 | 293 |  |
  | 296 | 294 | // Preview on page load |
  | 297 |  | ~~$( document ).ready( triggerPreview()~~ ); |
  |  | 295 | triggerPreview(); |
  | 298 | 296 |  |
  | 299 | 297 | // Custom trigger to signify settings have changed (will show save button and refresh preview) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L312) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=3076105#L310) |  |
  | 312 | 310 | event.preventDefault(); |
  | 313 | 311 | $( '.preview-document .order-search-label').text( '#' + $( this ).data( 'order\_id' ) ); |
  | 314 |  | $previewOrderIdInput.val( $( this ).data( 'order\_id' ) ).~~change(~~); |
  |  | 312 | $previewOrderIdInput.val( $( this ).data( 'order\_id' ) ).trigger( 'change' ); |
  | 315 | 313 | $( this ).closest( 'div' ).hide();                   // hide results div |
  | 316 | 314 | $( this ).closest( 'div' ).children( 'a' ).remove(); // remove all results |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=2980576#L360) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.js?rev=3076105#L358) |  |
  | 360 | 358 |  |
  | 361 | 359 | // Submit settings form when clicking on secondary save button |
  | 362 |  | $( document ).on( 'click', '.preview-data-wrapper .save-settings p input', function( event ) { |
  | 363 |  | $(~~'#wpo-wcpdf-settings input#submit').click(~~); |
  |  | 360 | $( document.body ).on( 'click', '.preview-data-wrapper .save-settings p input', function( event ) { |
  |  | 361 | $( '#wpo-wcpdf-settings input#submit' ).trigger( 'click' ); |
  | 364 | 362 | } ); |
  | 365 | 363 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js?rev=2980576#L1 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/admin-script.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(function(a){function b(){~~n=x.val(),o=y.val(),p=z.val(),q=A.val(),r=B.serialize()}function c(){y.val(y.data("default")).trigger("change")}function d(){x.val("").trigger("change")}function e(){!1==v.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<u||a(this).width()==u)?"full"==v.attr("data-preview-state")?(v.find(".preview-document").show(),v.find(".sidebar").hide(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-states",2),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","")):(v.find(".preview-document").hide(),v.find(".sidebar").show(),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-states",2),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=u||a(this).width()==u)&&("full"==v.attr("data-preview-state")?(v.find(".preview-document").show(),v.find(".sidebar").hide(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-states",3),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","sidebar"),v.addClass("static")):"closed"==v.attr("data-preview-state")&&a(this).width()!==u?(v.find(".preview-document").hide(),v.find(".sidebar").show(),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-states",3),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state",""),v.removeClass("static")):(v.find(".preview-document, .sidebar").show(),v.find(".slide-left, .slide-right").show(),v.attr("data-preview-states",3),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state",""),v.removeClass("static")))),u=a(this).width()}function f(a){window.scrollTo(0,0);let b=a;setTimeout(function(){b.addClass("static")},300)}function g(b,c){h();let d=a(b.target);if(!j(d.attr("name"))){if(d.hasClass("remove-requirement")||"disable\_for"==d.attr("id"))return;if(-1!==jQuery.inArray(b.type,["keyup","paste"])){if(d.is("input[type=\"checkbox\"], select"))return;c="keyup"==b.type?1e3:0}i(c)}}function h(b){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function i(a){a="number"==typeof a?a:0,b(),clearTimeout(s),s=setTimeout(function(){k()},a)}function j(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.\*?)\]/)[1]:b;return-1!==a.inArray(d,wpo\_wcpdf\_admin.preview\_excluded\_settings)&&(c=!0),c}function k(){let b=wpo\_wcpdf\_admin.pdfjs\_worker,c="preview-canvas",d={action:"wpo\_wcpdf\_preview",security:q,order\_id:n,document\_type:o,output\_format:p,data:r};w.children(".notice").remove(),w.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),C=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,beforeSend:function(a,b){null!=C&&C.abort()},success:function(d,e,f){if(d.data.error)a("#"+c).remove(),w.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>");else if(d.data.preview\_data&&d.data.output\_format)switch(a("#"+c).remove(),d.data.output\_format){default:case"pdf":w.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),l(b,c,d.data.preview\_data);break;case"ubl":let a=d.data.preview\_data,e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");w.html("<div id=\"preview-ubl\">"+e+"</div>")}w.unblock()},error:function(b,d,e){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),w.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),w.unblock()}}})}function l(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){let c=1;a.getPage(1).then(function(a){let c=2,d=a.getViewport({scale:2}),e=document.getElementById(b),f=e.getContext("2d");e.height=d.height,e.width=d.width;let g={canvasContext:f,viewport:d},h=a.render(g);h.promise.then(function(){})})},function(a){console.error(a)})}function m(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f="wpo\_wcpdf\_preview\_order\_search",g={security:e,action:f,search:d,document\_type:o};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order\_id=\""+a+"\"><span class=\"order-number\">#"+b.order\_number+"</span> - "+b.billing\_first\_name+" "+b.billing\_last\_name;0<b.billing\_company.length&&(d=d+", "+b.billing\_company);let e="<br><span class=\"date\">"+b.date\_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(b){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(b){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(b){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let c=$input.val();if(0<c.length&&2147483647<c)return alert(wpo\_wcpdf\_admin.mysql\_int\_size\_limit),void $input.removeClass("ajax-waiting");let d={security:$input.data("nonce"),action:"wpo\_wcpdf\_set\_next\_number",store:$input.data("store"),number:c};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,success:function(a){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo\_wcpdf\_documents\_settings\_invoice[display\_number]']").on("change",function(b){"order\_number"==a(this).val()?(a(this).closest("td").find(".description").slideDown(),a(this).closest("tr").next("tr").hide()):(a(this).closest("td").find(".description").hide(),a(this).closest("tr").next("tr").show())}).trigger("change"),a(".wcpdf\_document\_settings\_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")}),a.each(wpo\_wcpdf\_admin.pointers,function(b,c){a(c.target).pointer({content:c.content,position:{edge:c.position.edge,align:c.position.align},pointerClass:c.pointer\_class,pointerWidth:c.pointer\_width,close:function(){jQuery.post(wpo\_wcpdf\_admin.ajaxurl,{pointer:b,action:"dismiss-wp-pointer"})}}),-1===a.inArray(b,wpo\_wcpdf\_admin.dismissed\_pointers.split(","))&&a(c.target).pointer("open")}),a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200});let n,o,p,q,r,s,t,u,v=a("#wpo-wcpdf-preview-wrapper"),w=a("#wpo-wcpdf-preview-wrapper .preview"),x=a("#wpo-wcpdf-preview-wrapper input[name=\"order\_id\"]"),y=a("#wpo-wcpdf-preview-wrapper input[name=\"document\_type\"]"),z=a("#wpo-wcpdf-preview-wrapper input[name=\"output\_format\"]"),A=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),B=a("#wpo-wcpdf-settings"),C=null;a(document).ready(function(){c(),d(),b(),u=a(window).width(),e()}),a(window).on("resize",e),a(".slide-left").on("click",function(){let a=v.attr("data-preview-states"),b=v.attr("data-preview-state");v.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(v.find(".preview-document").show(),v.find(".slide-right").show(),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state","closed")):(v.find(".slide-left").hide(),v.find(".sidebar").delay(300).hide(0),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","sidebar"),f(v)):(v.find(".preview-document").show(),v.find(".slide-left").hide(),v.find(".slide-right").show(),v.attr("data-preview-state","full"),v.attr("data-from-preview-state","closed"),f(v))}),a(".slide-right").on("click",function(){let a=v.attr("data-preview-states"),b=v.attr("data-preview-state");v.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(v.find(".slide-left").delay(400).show(0),v.find(".sidebar").show(),v.attr("data-preview-state","sidebar"),v.attr("data-from-preview-state","full")):(v.find(".preview-document").hide(300),v.find(".slide-right").hide(),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","sidebar")):(v.find(".preview-document").hide(300),v.find(".slide-left").show(),v.find(".slide-right").hide(),v.attr("data-preview-state","closed"),v.attr("data-from-preview-state","full")),v.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),d(),i())}),a(document).ready(i()),a(document).on("wpo-wcpdf-settings-changed",function(a,b){h(),i(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo\_wcpdf\_refresh\_preview",function(a,b){i(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order\_id")),x.val(a(this).data("order\_id")).change(),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),i()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",g),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||g(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",g),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",g),a(document).on("click",".wpo\_remove\_image\_button, #wpo-wcpdf-settings .remove-requirement",g),a(document).on("click",".preview-data-wrapper .save-settings p input",function(b){a("#wpo-wcpdf-settings input#submit").click()}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),y.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),i()}}).trigger("change"),x.on("change",function(){i()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(c){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==c.type?1e3:0;b(),clearTimeout(t),t=setTimeout(function(){m~~(d)},e)})}); |
  |  | 1 | jQuery(function(a){function b(){m=w.val(),n=x.val(),o=y.val(),p=z.val(),q=A.serialize()}function c(){w.val("").trigger("change")}function d(){!1==u.attr("data-preview-states-lock")&&(1200>=a(this).width()&&(1200<t||a(this).width()==t)?"full"==u.attr("data-preview-state")?(u.find(".preview-document").show(),u.find(".sidebar").hide(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-states",2),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","")):(u.find(".preview-document").hide(),u.find(".sidebar").show(),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-states",2),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","")):1200<a(this).width()&&(1200>=t||a(this).width()==t)&&("full"==u.attr("data-preview-state")?(u.find(".preview-document").show(),u.find(".sidebar").hide(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-states",3),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","sidebar"),u.addClass("static")):"closed"==u.attr("data-preview-state")&&a(this).width()!==t?(u.find(".preview-document").hide(),u.find(".sidebar").show(),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-states",3),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state",""),u.removeClass("static")):(u.find(".preview-document, .sidebar").show(),u.find(".slide-left, .slide-right").show(),u.attr("data-preview-states",3),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state",""),u.removeClass("static")))),t=a(this).width()}function e(a){window.scrollTo(0,0);let b=a;setTimeout(function(){b.addClass("static")},300)}function f(b,c){g();let d=a(b.target);if(!i(d.attr("name"))){if(d.hasClass("remove-requirement")||"disable\_for"==d.attr("id"))return;if(-1!==jQuery.inArray(b.type,["keyup","paste"])){if(d.is("input[type=\"checkbox\"], select"))return;c="keyup"==b.type?1e3:0}h(c)}}function g(b){a(".preview-data-wrapper .save-settings p").css("margin-right","0")}function h(a){a="number"==typeof a?a:0,b(),clearTimeout(r),r=setTimeout(function(){j()},a)}function i(b){let c=!1;if(!b)return c;let d=b.includes("[")?b.match(/\[(.\*?)\]/)[1]:b;return-1!==a.inArray(d,wpo\_wcpdf\_admin.preview\_excluded\_settings)&&(c=!0),c}function j(){let b=wpo\_wcpdf\_admin.pdfjs\_worker,c="preview-canvas",d={action:"wpo\_wcpdf\_preview",security:p,order\_id:m,document\_type:n,output\_format:o,data:q};v.children(".notice").remove(),v.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),B=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,beforeSend:function(a,b){null!=B&&B.abort()},success:function(d,e,f){if(d.data.error)a("#"+c).remove(),v.append("<div class=\"notice notice-error inline\"><p>"+d.data.error+"</p></div>");else if(d.data.preview\_data&&d.data.output\_format)switch(a("#"+c).remove(),d.data.output\_format){default:case"pdf":v.append("<canvas id=\""+c+"\" style=\"width:100%;\"></canvas>"),k(b,c,d.data.preview\_data);break;case"ubl":let a=d.data.preview\_data,e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ /g,"&nbsp;").replace(/\n/g,"<br />");v.html("<div id=\"preview-ubl\">"+e+"</div>")}v.unblock()},error:function(b,d,e){if("abort"!=d){let d=b.status+": "+b.statusText;a("#"+c).remove(),v.append("<div class=\"notice notice-error inline\"><p>"+d+"</p></div>"),v.unblock()}}})}function k(a,b,c){c=window.atob(c);let d=window["pdfjs-dist/build/pdf"];d.GlobalWorkerOptions.workerSrc=a;let e=d.getDocument({data:c});e.promise.then(function(a){let c=1;a.getPage(1).then(function(a){let c=2,d=a.getViewport({scale:2}),e=document.getElementById(b),f=e.getContext("2d");e.height=d.height,e.width=d.width;let g={canvasContext:f,viewport:d},h=a.render(g);h.promise.then(function(){})})},function(a){console.error(a)})}function l(b){let c=b.closest(".preview-data").find("#preview-order-search-results"),d=b.val(),e=b.data("nonce"),f="wpo\_wcpdf\_preview\_order\_search",g={security:e,action:f,search:d,document\_type:n};c.parent().find("img.preview-order-search-clear").hide(),c.children(".error").remove(),c.children("a").remove(),c.hide(),a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(d){d.data&&(d.data.error?(c.append("<span class=\"error\">"+d.data.error+"</span>"),c.show()):a.each(d.data,function(a,b){let d="<a data-order\_id=\""+a+"\"><span class=\"order-number\">#"+b.order\_number+"</span> - "+b.billing\_first\_name+" "+b.billing\_last\_name;0<b.billing\_company.length&&(d=d+", "+b.billing\_company);let e="<br><span class=\"date\">"+b.date\_created+"</span><span class=\"total\">"+b.total+"</span></a>";c.append(d+e),c.show()})),b.removeClass("ajax-waiting"),b.closest("div").find("img.preview-order-search-clear").show()}})}a(".wcpdf-extensions .more").hide(),a(".wcpdf-extensions > li").on("click",function(b){a(this).toggleClass("expanded"),a(this).find(".more").slideToggle()}),a(".edit-next-number").on("click",function(b){a(this).hide(),a(this).siblings("input").prop("disabled",!1),a(this).siblings(".save-next-number.button").show()}),a(".save-next-number").on("click",function(b){$input=a(this).siblings("input"),$input.addClass("ajax-waiting");let c=$input.val();if(0<c.length&&2147483647<c)return alert(wpo\_wcpdf\_admin.mysql\_int\_size\_limit),void $input.removeClass("ajax-waiting");let d={security:$input.data("nonce"),action:"wpo\_wcpdf\_set\_next\_number",store:$input.data("store"),number:c};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:d,success:function(a){$input.removeClass("ajax-waiting"),$input.siblings(".edit-next-number").show(),$input.prop("disabled","disabled"),$input.siblings(".save-next-number.button").hide()}})}),a("[name='wpo\_wcpdf\_documents\_settings\_invoice[display\_number]']").on("change",function(b){"order\_number"==a(this).val()?(a(this).closest("td").find(".description").slideDown(),a(this).closest("tr").next("tr").hide()):(a(this).closest("td").find(".description").hide(),a(this).closest("tr").next("tr").show())}).trigger("change"),a(".wcpdf\_document\_settings\_sections > h2").on("click",function(){a(this).parent().find("ul").toggleClass("active")}),a.each(wpo\_wcpdf\_admin.pointers,function(b,c){a(c.target).pointer({content:c.content,position:{edge:c.position.edge,align:c.position.align},pointerClass:c.pointer\_class,pointerWidth:c.pointer\_width,close:function(){jQuery.post(wpo\_wcpdf\_admin.ajaxurl,{pointer:b,action:"dismiss-wp-pointer"})}}),-1===a.inArray(b,wpo\_wcpdf\_admin.dismissed\_pointers.split(","))&&a(c.target).pointer("open")}),a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200});let m,n,o,p,q,r,s,t,u=a("#wpo-wcpdf-preview-wrapper"),v=a("#wpo-wcpdf-preview-wrapper .preview"),w=a("#wpo-wcpdf-preview-wrapper input[name=\"order\_id\"]"),x=a("#wpo-wcpdf-preview-wrapper input[name=\"document\_type\"]"),y=a("#wpo-wcpdf-preview-wrapper input[name=\"output\_format\"]"),z=a("#wpo-wcpdf-preview-wrapper input[name=\"nonce\"]"),A=a("#wpo-wcpdf-settings"),B=null;(function a(){x.val(x.data("default")).trigger("change")})(),c(),b(),t=a(window).width(),d(),a(window).on("resize",d),a(".slide-left").on("click",function(){let a=u.attr("data-preview-states"),b=u.attr("data-preview-state");u.find(".preview-data-wrapper ul").removeClass("active"),3==a?"closed"==b?(u.find(".preview-document").show(),u.find(".slide-right").show(),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state","closed")):(u.find(".slide-left").hide(),u.find(".sidebar").delay(300).hide(0),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","sidebar"),e(u)):(u.find(".preview-document").show(),u.find(".slide-left").hide(),u.find(".slide-right").show(),u.attr("data-preview-state","full"),u.attr("data-from-preview-state","closed"),e(u))}),a(".slide-right").on("click",function(){let a=u.attr("data-preview-states"),b=u.attr("data-preview-state");u.find(".preview-data-wrapper ul").removeClass("active"),3==a?"full"==b?(u.find(".slide-left").delay(400).show(0),u.find(".sidebar").show(),u.attr("data-preview-state","sidebar"),u.attr("data-from-preview-state","full")):(u.find(".preview-document").hide(300),u.find(".slide-right").hide(),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","sidebar")):(u.find(".preview-document").hide(300),u.find(".slide-left").show(),u.find(".slide-right").hide(),u.attr("data-preview-state","closed"),u.attr("data-from-preview-state","full")),u.removeClass("static")}),a(".preview-document .preview-data p").on("click",function(){let b=a(this).closest(".preview-data");b.siblings(".preview-data").find("ul").removeClass("active"),b.find("ul").toggleClass("active")}),a(".preview-document .preview-data ul > li").on("click",function(){let b=a(this).closest(".preview-data");b.find("ul").toggleClass("active"),a(this).hasClass("order-search")?(b.find("p.last-order").hide(),b.find("input[name=\"preview-order-search\"]").addClass("active"),b.find("p.order-search").show().find(".order-search-label").text(a(this).text())):(b.find("p.last-order").show(),b.find("p.order-search").hide(),b.find("input[name=\"preview-order-search\"]").removeClass("active").val(""),b.find("#preview-order-search-results").hide(),b.find("img.preview-order-search-clear").hide(),c(),h())}),h(),a(document).on("wpo-wcpdf-settings-changed",function(a,b){g(),h(b)}),a(document).on("wpo-wcpdf-refresh-preview wpo\_wcpdf\_refresh\_preview",function(a,b){h(b)}),a(document).on("click","#preview-order-search-results a",function(b){b.preventDefault(),a(".preview-document .order-search-label").text("#"+a(this).data("order\_id")),w.val(a(this).data("order\_id")).trigger("change"),a(this).closest("div").hide(),a(this).closest("div").children("a").remove(),h()}),a(document).on("keyup paste","#wpo-wcpdf-settings input, #wpo-wcpdf-settings textarea",f),a(document).on("change","#wpo-wcpdf-settings input[type=\"checkbox\"], #wpo-wcpdf-settings input[type=\"radio\"], #wpo-wcpdf-settings select",function(a){a.isTrigger||f(a)}),a(document).on("select2:select select2:unselect","#wpo-wcpdf-settings select.wc-enhanced-select",f),a(document.body).on("wpo-wcpdf-media-upload-setting-updated",f),a(document).on("click",".wpo\_remove\_image\_button, #wpo-wcpdf-settings .remove-requirement",f),a(document.body).on("click",".preview-data-wrapper .save-settings p input",function(b){a("#wpo-wcpdf-settings input#submit").trigger("click")}),a(document).on("click","img.preview-order-search-clear",function(b){b.preventDefault(),a(this).closest("div").find("input#preview-order-search").val(""),a(this).closest(".preview-data").find("#preview-order-search-results").children("a").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").children(".error").remove(),a(this).closest(".preview-data").find("#preview-order-search-results").hide(),a(this).hide()}),a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list li").on("click",function(){let b=a(this).closest("ul").data("input-name"),c=a("#wpo-wcpdf-preview-wrapper :input[name="+b+"]");c.val(a(this).data("value")).trigger("change")}),x.on("change",function(){let b=a(this).val();if(b.length){let c=a(this).attr("name"),d=a("#wpo-wcpdf-preview-wrapper ul.preview-data-option-list[data-input-name="+c+"]"),e=d.find("li[data-value="+b+"]");d.parent().find(".current-label").text(e.text()),h()}}).trigger("change"),w.on("change",function(){h()}).trigger("change"),a("#preview-order-search").on("keyup paste",function(c){let d=a(this);d.addClass("ajax-waiting");let e="keyup"==c.type?1e3:0;b(),clearTimeout(s),s=setTimeout(function(){l(d)},e)})}); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js?rev=2790488#L340 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.js?rev=3076105#L340 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 340 | 340 | var confetti = new confetti.Context('confetti'); |
  | 341 | 341 | confetti.start(); |
  | 342 |  | $(~~window).resize(~~function() { |
  | 343 |  | confetti.~~resize(~~); |
  | 344 |  | }); |
  |  | 342 | $( window ).on( 'resize', function() { |
  |  | 343 | confetti.trigger( 'resize' ); |
  |  | 344 | } ); |
  | 345 | 345 | }); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js")

  | [r2738458](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js?rev=2738458#L1 "Show revision 2738458 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/confetti.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(document).ready(function(a){var b=Math.PI,c=Math.sin,d=Math.cos,e=Math.round,f=Math.sqrt;function g(a,b){this.x=a,this.y=b,this.Length=function(){return f(this.SqrLength())},this.SqrLength=function(){return this.x\*this.x+this.y\*this.y},this.Equals=function(a,b){return a.x==b.x&&a.y==b.y},this.Add=function(a){this.x+=a.x,this.y+=a.y},this.Sub=function(a){this.x-=a.x,this.y-=a.y},this.Div=function(a){this.x/=a,this.y/=a},this.Mul=function(a){this.x\*=a,this.y\*=a},this.Normalize=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);this.x\*=b,this.y\*=b}},this.Normalized=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);return new g(this.x\*b,this.y\*b)}return new g(0,0)}}function h(a,b,c,d){this.position=new g(a,b),this.mass=c,this.drag=d,this.force=new g(0,0),this.velocity=new g(0,0),this.AddForce=function(a){this.force.Add(a)},this.Integrate=function(a){var b=this.CurrentForce(this.position);b.Div(this.mass);var c=new g(this.velocity.x,this.velocity.y);c.Mul(a),this.position.Add(c),b.Mul(a),this.velocity.Add(b),this.force=new g(0,0)},this.CurrentForce=function(){var a=new g(this.force.x,this.force.y),b=this.velocity.Length(),c=new g(this.velocity.x,this.velocity.y);return c.Mul(this.drag\*this.mass\*b),a.Sub(c),a}}function j(a,b){this.pos=new g(a,b),this.rotationSpeed=600\*Math.random()+800,this.angle=360\*(m\*Math.random()),this.rotation=360\*(m\*Math.random()),this.cosA=1,this.size=5,this.oscillationSpeed=1.5\*Math.random()+.5,this.xSpeed=40,this.ySpeed=60\*Math.random()+50,this.corners=[],this.time=Math.random();var f=e(Math.random()\*(n.length-1));this.frontColor=n[f][0],this.backColor=n[f][1];for(var h=0;4>h;h++){var k=d(this.angle+m\*(90\*h+45)),l=c(this.angle+m\*(90\*h+45));this.corners[h]=new g(k,l)}this.Update=function(a){this.time+=a,this.rotation+=this.rotationSpeed\*a,this.cosA=d(m\*this.rotation),this.pos.x+=d(this.time\*this.oscillationSpeed)\*this.xSpeed\*a,this.pos.y+=this.ySpeed\*a,this.pos.y>j.bounds.y&&(this.pos.x=Math.random()\*j.bounds.x,this.pos.y=0)},this.Draw=function(a){a.fillStyle=0<this.cosA?this.frontColor:this.backColor,a.beginPath(),a.moveTo(this.pos.x+this.corners[0].x\*this.size,this.pos.y+this.corners[0].y\*this.size\*this.cosA);for(var b=1;4>b;b++)a.lineTo(this.pos.x+this.corners[b].x\*this.size,this.pos.y+this.corners[b].y\*this.size\*this.cosA);a.closePath(),a.fill()}}function k(a,b,j,l,o,p,q,r){this.particleDist=l,this.particleCount=j,this.particleMass=q,this.particleDrag=r,this.particles=[];var s=e(Math.random()\*(n.length-1));this.frontColor=n[s][0],this.backColor=n[s][1],this.xOff=d(m\*p)\*o,this.yOff=c(m\*p)\*o,this.position=new g(a,b),this.prevPosition=new g(a,b),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+2,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;for(var t=0;t<this.particleCount;t++)this.particles[t]=new h(a,b-t\*this.particleDist,this.particleMass,this.particleDrag);this.Update=function(a){var b=0;this.time+=a\*this.oscillationSpeed,this.position.y+=this.ySpeed\*a,this.position.x+=d(this.time)\*this.oscillationDistance\*a,this.particles[0].position=this.position;var c=this.prevPosition.x-this.position.x,e=this.prevPosition.y-this.position.y,h=f(c\*c+e\*e);for(this.prevPosition=new g(this.position.x,this.position.y),b=1;b<this.particleCount;b++){var j=g.Sub(this.particles[b-1].position,this.particles[b].position);j.Normalize(),j.Mul(h/a\*this.velocityInherit),this.particles[b].AddForce(j)}for(b=1;b<this.particleCount;b++)this.particles[b].Integrate(a);for(b=1;b<this.particleCount;b++){var l=new g(this.particles[b].position.x,this.particles[b].position.y);l.Sub(this.particles[b-1].position),l.Normalize(),l.Mul(this.particleDist),l.Add(this.particles[b-1].position),this.particles[b].position=l}this.position.y>k.bounds.y+this.particleDist\*this.particleCount&&this.Reset()},this.Reset=function(){this.position.y=-Math.random()\*k.bounds.y,this.position.x=Math.random()\*k.bounds.x,this.prevPosition=new g(this.position.x,this.position.y),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+1.5,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;var a=e(Math.random()\*(n.length-1));this.frontColor=n[a][0],this.backColor=n[a][1],this.particles=[];for(var b=0;b<this.particleCount;b++)this.particles[b]=new h(this.position.x,this.position.y-b\*this.particleDist,this.particleMass,this.particleDrag)},this.Draw=function(a){for(var b=0;b<this.particleCount-1;b++){var c=new g(this.particles[b].position.x+this.xOff,this.particles[b].position.y+this.yOff),d=new g(this.particles[b+1].position.x+this.xOff,this.particles[b+1].position.y+this.yOff);0>this.Side(this.particles[b].position.x,this.particles[b].position.y,this.particles[b+1].position.x,this.particles[b+1].position.y,d.x,d.y)?(a.fillStyle=this.frontColor,a.strokeStyle=this.frontColor):(a.fillStyle=this.backColor,a.strokeStyle=this.backColor),0==b?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill()):b==this.particleCount-2?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill()):(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(d.x,d.y),a.lineTo(c.x,c.y),a.closePath(),a.stroke(),a.fill())}},this.Side=function(a,b,c,d,e,f){return(a-c)\*(f-d)-(b-d)\*(e-c)}}var l=1/30,m=b/180,n=[["#771787","#239bb9"]];g.Lerp=function(a,b,c){return new g((b.x-a.x)\*c+a.x,(b.y-a.y)\*c+a.y)},g.Distance=function(a,b){return f(g.SqrDistance(a,b))},g.SqrDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c\*c+d\*d+z\*z},g.Scale=function(a,b){return new g(a.x\*b.x,a.y\*b.y)},g.Min=function(a,b){var c=Math.min;return new g(c(a.x,b.x),c(a.y,b.y))},g.Max=function(a,b){var c=Math.max;return new g(c(a.x,b.x),c(a.y,b.y))},g.ClampMagnitude=function(a,b){var c=a.Normalized;return new g(c.x\*b,c.y\*b)},g.Sub=function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},j.bounds=new g(0,0),k.bounds=new g(0,0),o={},o.Context=function(a){var b=0,c=document.getElementById(a),d=document.createElement("canvas");d.width=c.offsetWidth,d.height=c.offsetHeight,c.appendChild(d);var e=d.getContext("2d"),f=7,h=[];for(k.bounds=new g(d.width,d.height),b=0;b<f;b++)h[b]=new k(Math.random()\*d.width,2\*(-Math.random()\*d.height),30,8,8,45,1,.05);var m=[];for(j.bounds=new g(d.width,d.height),b=0;b<25;b++)m[b]=new j(Math.random()\*d.width,Math.random()\*d.height);this.resize=function(){d.width=c.offsetWidth,d.height=c.offsetHeight,j.bounds=new g(d.width,d.height),k.bounds=new g(d.width,d.height)},this.start=function(){this.stop();this.interval=setInterval(function(){o.update()},1e3/30)},this.stop=function(){clearInterval(this.interval)},this.update=function(){var a=0;for(e.clearRect(0,0,d.width,d.height),a=0;a<25;a++)m[a].Update(l),m[a].Draw(e);for(a=0;a<f;a++)h[a].Update(l),h[a].Draw(e)}};var o=new o.Context("confetti");o.start(),a(window).~~resize(function(){o.resize(~~)})}); |
  |  | 1 | jQuery(document).ready(function(a){var b=Math.PI,c=Math.sin,d=Math.cos,e=Math.round,f=Math.sqrt;function g(a,b){this.x=a,this.y=b,this.Length=function(){return f(this.SqrLength())},this.SqrLength=function(){return this.x\*this.x+this.y\*this.y},this.Equals=function(a,b){return a.x==b.x&&a.y==b.y},this.Add=function(a){this.x+=a.x,this.y+=a.y},this.Sub=function(a){this.x-=a.x,this.y-=a.y},this.Div=function(a){this.x/=a,this.y/=a},this.Mul=function(a){this.x\*=a,this.y\*=a},this.Normalize=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);this.x\*=b,this.y\*=b}},this.Normalized=function(){var a=this.SqrLength();if(0!=a){var b=1/f(a);return new g(this.x\*b,this.y\*b)}return new g(0,0)}}function h(a,b,c,d){this.position=new g(a,b),this.mass=c,this.drag=d,this.force=new g(0,0),this.velocity=new g(0,0),this.AddForce=function(a){this.force.Add(a)},this.Integrate=function(a){var b=this.CurrentForce(this.position);b.Div(this.mass);var c=new g(this.velocity.x,this.velocity.y);c.Mul(a),this.position.Add(c),b.Mul(a),this.velocity.Add(b),this.force=new g(0,0)},this.CurrentForce=function(){var a=new g(this.force.x,this.force.y),b=this.velocity.Length(),c=new g(this.velocity.x,this.velocity.y);return c.Mul(this.drag\*this.mass\*b),a.Sub(c),a}}function j(a,b){this.pos=new g(a,b),this.rotationSpeed=600\*Math.random()+800,this.angle=360\*(m\*Math.random()),this.rotation=360\*(m\*Math.random()),this.cosA=1,this.size=5,this.oscillationSpeed=1.5\*Math.random()+.5,this.xSpeed=40,this.ySpeed=60\*Math.random()+50,this.corners=[],this.time=Math.random();var f=e(Math.random()\*(n.length-1));this.frontColor=n[f][0],this.backColor=n[f][1];for(var h=0;4>h;h++){var k=d(this.angle+m\*(90\*h+45)),l=c(this.angle+m\*(90\*h+45));this.corners[h]=new g(k,l)}this.Update=function(a){this.time+=a,this.rotation+=this.rotationSpeed\*a,this.cosA=d(m\*this.rotation),this.pos.x+=d(this.time\*this.oscillationSpeed)\*this.xSpeed\*a,this.pos.y+=this.ySpeed\*a,this.pos.y>j.bounds.y&&(this.pos.x=Math.random()\*j.bounds.x,this.pos.y=0)},this.Draw=function(a){a.fillStyle=0<this.cosA?this.frontColor:this.backColor,a.beginPath(),a.moveTo(this.pos.x+this.corners[0].x\*this.size,this.pos.y+this.corners[0].y\*this.size\*this.cosA);for(var b=1;4>b;b++)a.lineTo(this.pos.x+this.corners[b].x\*this.size,this.pos.y+this.corners[b].y\*this.size\*this.cosA);a.closePath(),a.fill()}}function k(a,b,j,l,o,p,q,r){this.particleDist=l,this.particleCount=j,this.particleMass=q,this.particleDrag=r,this.particles=[];var s=e(Math.random()\*(n.length-1));this.frontColor=n[s][0],this.backColor=n[s][1],this.xOff=d(m\*p)\*o,this.yOff=c(m\*p)\*o,this.position=new g(a,b),this.prevPosition=new g(a,b),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+2,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;for(var t=0;t<this.particleCount;t++)this.particles[t]=new h(a,b-t\*this.particleDist,this.particleMass,this.particleDrag);this.Update=function(a){var b=0;this.time+=a\*this.oscillationSpeed,this.position.y+=this.ySpeed\*a,this.position.x+=d(this.time)\*this.oscillationDistance\*a,this.particles[0].position=this.position;var c=this.prevPosition.x-this.position.x,e=this.prevPosition.y-this.position.y,h=f(c\*c+e\*e);for(this.prevPosition=new g(this.position.x,this.position.y),b=1;b<this.particleCount;b++){var j=g.Sub(this.particles[b-1].position,this.particles[b].position);j.Normalize(),j.Mul(h/a\*this.velocityInherit),this.particles[b].AddForce(j)}for(b=1;b<this.particleCount;b++)this.particles[b].Integrate(a);for(b=1;b<this.particleCount;b++){var l=new g(this.particles[b].position.x,this.particles[b].position.y);l.Sub(this.particles[b-1].position),l.Normalize(),l.Mul(this.particleDist),l.Add(this.particles[b-1].position),this.particles[b].position=l}this.position.y>k.bounds.y+this.particleDist\*this.particleCount&&this.Reset()},this.Reset=function(){this.position.y=-Math.random()\*k.bounds.y,this.position.x=Math.random()\*k.bounds.x,this.prevPosition=new g(this.position.x,this.position.y),this.velocityInherit=2\*Math.random()+4,this.time=100\*Math.random(),this.oscillationSpeed=2\*Math.random()+1.5,this.oscillationDistance=40\*Math.random()+40,this.ySpeed=40\*Math.random()+80;var a=e(Math.random()\*(n.length-1));this.frontColor=n[a][0],this.backColor=n[a][1],this.particles=[];for(var b=0;b<this.particleCount;b++)this.particles[b]=new h(this.position.x,this.position.y-b\*this.particleDist,this.particleMass,this.particleDrag)},this.Draw=function(a){for(var b=0;b<this.particleCount-1;b++){var c=new g(this.particles[b].position.x+this.xOff,this.particles[b].position.y+this.yOff),d=new g(this.particles[b+1].position.x+this.xOff,this.particles[b+1].position.y+this.yOff);0>this.Side(this.particles[b].position.x,this.particles[b].position.y,this.particles[b+1].position.x,this.particles[b+1].position.y,d.x,d.y)?(a.fillStyle=this.frontColor,a.strokeStyle=this.frontColor):(a.fillStyle=this.backColor,a.strokeStyle=this.backColor),0==b?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b+1].position.x+d.x),.5\*(this.particles[b+1].position.y+d.y)),a.closePath(),a.stroke(),a.fill()):b==this.particleCount-2?(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill(),a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(c.x,c.y),a.lineTo(.5\*(this.particles[b].position.x+c.x),.5\*(this.particles[b].position.y+c.y)),a.closePath(),a.stroke(),a.fill()):(a.beginPath(),a.moveTo(this.particles[b].position.x,this.particles[b].position.y),a.lineTo(this.particles[b+1].position.x,this.particles[b+1].position.y),a.lineTo(d.x,d.y),a.lineTo(c.x,c.y),a.closePath(),a.stroke(),a.fill())}},this.Side=function(a,b,c,d,e,f){return(a-c)\*(f-d)-(b-d)\*(e-c)}}var l=1/30,m=b/180,n=[["#771787","#239bb9"]];g.Lerp=function(a,b,c){return new g((b.x-a.x)\*c+a.x,(b.y-a.y)\*c+a.y)},g.Distance=function(a,b){return f(g.SqrDistance(a,b))},g.SqrDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c\*c+d\*d+z\*z},g.Scale=function(a,b){return new g(a.x\*b.x,a.y\*b.y)},g.Min=function(a,b){var c=Math.min;return new g(c(a.x,b.x),c(a.y,b.y))},g.Max=function(a,b){var c=Math.max;return new g(c(a.x,b.x),c(a.y,b.y))},g.ClampMagnitude=function(a,b){var c=a.Normalized;return new g(c.x\*b,c.y\*b)},g.Sub=function(a,b){return new g(a.x-b.x,a.y-b.y,a.z-b.z)},j.bounds=new g(0,0),k.bounds=new g(0,0),o={},o.Context=function(a){var b=0,c=document.getElementById(a),d=document.createElement("canvas");d.width=c.offsetWidth,d.height=c.offsetHeight,c.appendChild(d);var e=d.getContext("2d"),f=7,h=[];for(k.bounds=new g(d.width,d.height),b=0;b<f;b++)h[b]=new k(Math.random()\*d.width,2\*(-Math.random()\*d.height),30,8,8,45,1,.05);var m=[];for(j.bounds=new g(d.width,d.height),b=0;b<25;b++)m[b]=new j(Math.random()\*d.width,Math.random()\*d.height);this.resize=function(){d.width=c.offsetWidth,d.height=c.offsetHeight,j.bounds=new g(d.width,d.height),k.bounds=new g(d.width,d.height)},this.start=function(){this.stop();this.interval=setInterval(function(){o.update()},1e3/30)},this.stop=function(){clearInterval(this.interval)},this.update=function(){var a=0;for(e.clearRect(0,0,d.width,d.height),a=0;a<25;a++)m[a].Update(l),m[a].Draw(e);for(a=0;a<f;a++)h[a].Update(l),h[a].Draw(e)}};var o=new o.Context("confetti");o.start(),a(window).on("resize",function(){o.trigger("resize")})}); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js?rev=3053443#L111 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.js?rev=3076105#L111 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 111 | 111 |  |
  | 112 | 112 | // danger zone tools |
  | 113 |  | $( ~~'#debug-tools .number-tools-btn' ).click(~~ function( event ) { |
  |  | 113 | $( document.body ).on( 'click', '#debug-tools .number-tools-btn', function( event ) { |
  | 114 | 114 | event.preventDefault(); |
  | 115 | 115 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js?rev=3053443#L1 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/debug-script.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(function(a){function b(b,c,d){let e=d.find("fieldset > .notice");switch(e.hide(),e.removeClass("notice-error"),e.removeClass("notice-success"),b){case"export\_settings":if(c.success&&c.data.filename&&c.data.settings){d.find(".download\_file").remove();let b={type:d.find("select[name=\"type\"").val(),settings:c.data.settings};b="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(b)),d.append(a("<div class=\"download\_file\"><label>"+wpo\_wcpdf\_debug.download\_label+":</label> <a href=\"data:"+b+"\" download=\""+c.data.filename+"\">"+c.data.filename+"</a></div>"))}else!c.success&&c.data.message&&(e.addClass("notice-error"),e.find("p").text(c.data.message),e.show());break;default:c.success&&c.data.message?e.addClass("notice-success"):!c.success&&c.data.message&&e.addClass("notice-error"),e.find("p").text(c.data.message),e.show()}}function c(b,d,e,f,g,h,i){let j={action:"wpo\_wcpdf\_danger\_zone\_tools",delete\_or\_renumber:i,document\_type:b,date\_type:d,date\_from:e,date\_to:f,page\_count:g,document\_count:h,nonce:wpo\_wcpdf\_debug.nonce};a.ajax({type:"POST",url:wpo\_wcpdf\_debug.ajaxurl,data:j,dataType:"json",success:function(j){if(!1===j.data.finished)g=j.data.pageCount,h=j.data.documentCount,c(b,d,e,f,g,h,i);else{a(".renumber-spinner, .delete-spinner").css("visibility","hidden"),a("#renumber-documents-btn, #delete-documents-btn").removeAttr("disabled"),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!1);let b=j.data.message;alert(h+b)}},error:function(a,b,c){alert(a.status+":"+c)}})}if(a("#debug-tools .tool").on("click","input[type=\"submit\"]",function(c){c.preventDefault();let d=a(this).closest("form"),e=d.find("input[name=\"debug\_tool\"]").val(),f=new FormData(d[0]);f.append("action","wpo\_wcpdf\_debug\_tools"),f.append("nonce",wpo\_wcpdf\_debug.nonce),d.closest(".tool").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let g=!1;g="reset-settings"!==e||window.confirm(wpo\_wcpdf\_debug.confirm\_reset),g&&a.ajax({url:wpo\_wcpdf\_debug.ajaxurl,data:f,type:"POST",cache:!1,processData:!1,contentType:!1,success(a){b(e,a,d)},error(){}}),d.closest(".tool").unblock()}),a("[name='wpo\_wcpdf\_settings\_debug[document\_access\_denied\_redirect\_page]']").on("change",function(){let b=a(this).closest("table").find("#document\_custom\_redirect\_page"),c=b.closest("td").find(".description");"custom\_page"===a(this).val()?(b.show(),c.show()):(b.hide(),c.hide())}).trigger("change"),!0===wpo\_wcpdf\_debug.danger\_zone.enabled){let b="<div class=\"notice notice-warning inline\"><p>"+wpo\_wcpdf\_debug.danger\_zone.message+"</p></div>";a("input#enable\_danger\_zone\_tools").closest("td").find(".description").append(b)}a(document.body).on("click","#wpo-wcpdf-settings a.number-search-button",function(b){b.preventDefault();let c=a(this).closest("div").find(":input[name=\"number\_search\_input\"]").val();window.location.href=window.location.href+"&s="+c}),a("#renumber-date-from, #renumber-date-to, #delete-date-from, #delete-date-to").datepicker({dateFormat:"yy-mm-dd"}),a(~~"#debug-tools .number-tools-btn").click(~~function(b){b.preventDefault();let d="",e="",f="",g="";return"renumber-documents-btn"===this.id?(d=a("#renumber-document-type").val(),dateType=a("#renumber-date-type").val(),e=a("#renumber-date-from").val(),f=a("#renumber-date-to").val(),g="renumber"):"delete-documents-btn"===this.id&&(d=a("#delete-document-type").val(),dateType=a("#delete-date-type").val(),e=a("#delete-date-from").val(),f=a("#delete-date-to").val(),g="delete"),""===d||"undefined"===d?void alert(wpo\_wcpdf\_debug.select\_document\_type):void("renumber"===g?a(".renumber-spinner").css("visibility","visible"):"delete"===g&&a(".delete-spinner").css("visibility","visible"),a("#renumber-documents-btn, #delete-documents-btn").attr("disabled",!0),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!0),c(d,dateType,e,f,1,0,g))}),a("#debug-tools #delete-document-type").on("change",function(b){b.preventDefault(),"all"===a(this).val()?a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!0):a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change"),a("#debug-tools #delete-date-type").on("change",function(b){b.preventDefault();let c=a(this).closest("form").find("#delete-document-type");""===c.val()||"all"===c.val()?a(this).find("option[value=\"document\_date\"]").prop("disabled",!0):a(this).find("option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change")}); |
  |  | 1 | jQuery(function(a){function b(b,c,d){let e=d.find("fieldset > .notice");switch(e.hide(),e.removeClass("notice-error"),e.removeClass("notice-success"),b){case"export\_settings":if(c.success&&c.data.filename&&c.data.settings){d.find(".download\_file").remove();let b={type:d.find("select[name=\"type\"").val(),settings:c.data.settings};b="data:text/plain;charset=utf-8,"+encodeURIComponent(JSON.stringify(b)),d.append(a("<div class=\"download\_file\"><label>"+wpo\_wcpdf\_debug.download\_label+":</label> <a href=\"data:"+b+"\" download=\""+c.data.filename+"\">"+c.data.filename+"</a></div>"))}else!c.success&&c.data.message&&(e.addClass("notice-error"),e.find("p").text(c.data.message),e.show());break;default:c.success&&c.data.message?e.addClass("notice-success"):!c.success&&c.data.message&&e.addClass("notice-error"),e.find("p").text(c.data.message),e.show()}}function c(b,d,e,f,g,h,i){let j={action:"wpo\_wcpdf\_danger\_zone\_tools",delete\_or\_renumber:i,document\_type:b,date\_type:d,date\_from:e,date\_to:f,page\_count:g,document\_count:h,nonce:wpo\_wcpdf\_debug.nonce};a.ajax({type:"POST",url:wpo\_wcpdf\_debug.ajaxurl,data:j,dataType:"json",success:function(j){if(!1===j.data.finished)g=j.data.pageCount,h=j.data.documentCount,c(b,d,e,f,g,h,i);else{a(".renumber-spinner, .delete-spinner").css("visibility","hidden"),a("#renumber-documents-btn, #delete-documents-btn").removeAttr("disabled"),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!1);let b=j.data.message;alert(h+b)}},error:function(a,b,c){alert(a.status+":"+c)}})}if(a("#debug-tools .tool").on("click","input[type=\"submit\"]",function(c){c.preventDefault();let d=a(this).closest("form"),e=d.find("input[name=\"debug\_tool\"]").val(),f=new FormData(d[0]);f.append("action","wpo\_wcpdf\_debug\_tools"),f.append("nonce",wpo\_wcpdf\_debug.nonce),d.closest(".tool").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let g=!1;g="reset-settings"!==e||window.confirm(wpo\_wcpdf\_debug.confirm\_reset),g&&a.ajax({url:wpo\_wcpdf\_debug.ajaxurl,data:f,type:"POST",cache:!1,processData:!1,contentType:!1,success(a){b(e,a,d)},error(){}}),d.closest(".tool").unblock()}),a("[name='wpo\_wcpdf\_settings\_debug[document\_access\_denied\_redirect\_page]']").on("change",function(){let b=a(this).closest("table").find("#document\_custom\_redirect\_page"),c=b.closest("td").find(".description");"custom\_page"===a(this).val()?(b.show(),c.show()):(b.hide(),c.hide())}).trigger("change"),!0===wpo\_wcpdf\_debug.danger\_zone.enabled){let b="<div class=\"notice notice-warning inline\"><p>"+wpo\_wcpdf\_debug.danger\_zone.message+"</p></div>";a("input#enable\_danger\_zone\_tools").closest("td").find(".description").append(b)}a(document.body).on("click","#wpo-wcpdf-settings a.number-search-button",function(b){b.preventDefault();let c=a(this).closest("div").find(":input[name=\"number\_search\_input\"]").val();window.location.href=window.location.href+"&s="+c}),a("#renumber-date-from, #renumber-date-to, #delete-date-from, #delete-date-to").datepicker({dateFormat:"yy-mm-dd"}),a(document.body).on("click","#debug-tools .number-tools-btn",function(b){b.preventDefault();let d="",e="",f="",g="";return"renumber-documents-btn"===this.id?(d=a("#renumber-document-type").val(),dateType=a("#renumber-date-type").val(),e=a("#renumber-date-from").val(),f=a("#renumber-date-to").val(),g="renumber"):"delete-documents-btn"===this.id&&(d=a("#delete-document-type").val(),dateType=a("#delete-date-type").val(),e=a("#delete-date-from").val(),f=a("#delete-date-to").val(),g="delete"),""===d||"undefined"===d?void alert(wpo\_wcpdf\_debug.select\_document\_type):void("renumber"===g?a(".renumber-spinner").css("visibility","visible"):"delete"===g&&a(".delete-spinner").css("visibility","visible"),a("#renumber-documents-btn, #delete-documents-btn").attr("disabled",!0),a("#renumber-document-type, #renumber-date-from, #renumber-date-to, #delete-document-type, #delete-date-from, #delete-date-to").prop("disabled",!0),c(d,dateType,e,f,1,0,g))}),a("#debug-tools #delete-document-type").on("change",function(b){b.preventDefault(),"all"===a(this).val()?a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!0):a(this).closest("form").find("#delete-date-type option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change"),a("#debug-tools #delete-date-type").on("change",function(b){b.preventDefault();let c=a(this).closest("form").find("#delete-document-type");""===c.val()||"all"===c.val()?a(this).find("option[value=\"document\_date\"]").prop("disabled",!0):a(this).find("option[value=\"document\_date\"]").prop("disabled",!1)}).trigger("change")}); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L6 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105#L6 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 | // Uploading files |
  | 7 | 7 | var file\_frame; |
  |  | 8 | let $settings\_wrapper; |
  |  | 9 |  |
  |  | 10 | // This function returns the translatable media input field in case translation is present. |
  |  | 11 | // If the translation is not present, the function will return the media input field. |
  |  | 12 | let get\_media\_field = function( self, settings\_wrapper, element\_id ) { |
  |  | 13 | let $input = $( '#wpo-wcpdf-settings' ).find( element\_id ).filter( function() { |
  |  | 14 | let parent = self.parent( 'div' ); |
  |  | 15 | return parent.length && parent.attr( 'aria-hidden' ) === 'false'; |
  |  | 16 | } ); |
  |  | 17 |  |
  |  | 18 | return $input.length ? $input : settings\_wrapper.find( element\_id ); |
  |  | 19 | }; |
  |  | 20 |  |
  | 8 | 21 | $( '#wpo-wcpdf-settings, .wpo-wcpdf-setup' ).on( 'click', '.wpo\_upload\_image\_button', function( event ){ |
  | 9 | 22 | event.preventDefault(); |
  | 10 | 23 |  |
  | 11 | 24 | // get input wrapper |
  | 12 |  | ~~let $settings\_wrapper = $(this~~).parent(); |
  |  | 25 | $settings\_wrapper = $( this ).parent(); |
  | 13 | 26 |  |
  | 14 | 27 | // If the media frame already exists, reopen it. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L30) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105#L43) |  |
  | 30 | 43 | file\_frame.on( 'select', function() { |
  | 31 | 44 | // get target elements |
  | 32 |  | let $input   = ~~$settings\_wrapper.find(~~ 'input.media-upload-id' ); |
  | 33 |  | let $preview = ~~$settings\_wrapper.find(~~ 'img.media-upload-preview' ); |
  | 34 |  |  |
  |  | 45 | let $input   = get\_media\_field( $( this ), $settings\_wrapper, 'input.media-upload-id' ); |
  |  | 46 | let $preview = get\_media\_field( $( this ), $settings\_wrapper, 'img.media-upload-preview' ); |
  |  | 47 |  |
  | 35 | 48 | // We set multiple to false so only get one image from the uploader |
  | 36 | 49 | let attachment = file\_frame.state().get( 'selection' ).first().toJSON(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L41) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105#L54) |  |
  | 41 | 54 | $preview.attr( 'src', attachment.url ); |
  | 42 | 55 | } |
  | 43 |  | ~~$( '.attachment-resolution, .attachment-resolution-warning' ).remove();~~ |
  | 44 | 56 |  |
  | 45 |  | // dim until we have a response |
  | 46 |  | $settings\_wrapper.css( 'opacity', '0.25' ); |
  |  | 57 | get\_media\_field( $( this ), $settings\_wrapper, '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  |  | 58 |  |
  |  | 59 | // Block the media upload UI until we have a response. |
  |  | 60 | $settings\_wrapper.parent().block( { |
  |  | 61 | message: null, |
  |  | 62 | overlayCSS: { |
  |  | 63 | background: '#fff', |
  |  | 64 | opacity: 0.6 |
  |  | 65 | } |
  |  | 66 | } ); |
  | 47 | 67 |  |
  | 48 | 68 | let data = { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L62) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105#L82) |  |
  | 62 | 82 | } |
  | 63 | 83 | $settings\_wrapper.removeAttr( 'style' ); |
  |  | 84 | $settings\_wrapper.parent().unblock(); |
  | 64 | 85 |  |
  | 65 | 86 | // custom trigger |
  | 66 |  | $input = ~~$settings\_wrapper.find(~~ 'input.media-upload-id' ); |
  |  | 87 | $input = get\_media\_field( $( this ), $settings\_wrapper, 'input.media-upload-id' ); |
  | 67 | 88 | $( document.body ).trigger( 'wpo-wcpdf-media-upload-setting-updated', [ $input ] ); |
  | 68 | 89 | }, |
  | 69 | 90 | error: function (xhr, ajaxOptions, thrownError) { |
  | 70 |  | $settings\_wrapper.~~removeAttr( 'style' );~~ |
  |  | 91 | $settings\_wrapper.parent().unblock(); |
  | 71 | 92 | } |
  | 72 | 93 | }); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=2790488#L88) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.js?rev=3076105#L109) |  |
  | 88 | 109 | $preview.remove(); |
  | 89 | 110 | $( this ).remove(); |
  | 90 |  | ~~$(~~ '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  | 91 |  | }); |
  |  | 111 | get\_media\_field( $( this ), $settings\_wrapper, '.attachment-resolution, .attachment-resolution-warning' ).remove(); |
  |  | 112 | }); |
  | 92 | 113 | }); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js")

  | [r2690195](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js?rev=2690195#L1 "Show revision 2690195 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/assets/js/media-upload.min.js?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(document).ready(function(a){var b;~~a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_upload\_image\_button",function(c){c.preventDefault();let d=a(this).parent();return b?void b.open():void(b=wp.media.frames.file\_frame=wp.media({title:a(this).data("uploader\_title"),button:{text:a(this).data("uploader\_button\_text")},multiple:!1}),b.on("select",function(){let c=d.find("input.media-upload-id"),e=d.find("img.media-upload-preview"),f=b.state().get("selection").first().toJSON();c.val(f.id),e.length&&e.attr("src",f.url),a(".attachment-resolution, .attachment-resolution-warning").remove(),d.css("opacity","0.25");let g={security:c.data("ajax\_nonce"),action:"wpo\_wcpdf\_get\_media\_upload\_setting\_html",args:c.data("settings\_callback\_args"),attachment\_id:f.id};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:g,success:function(b){b&&"undefined"!=typeof b.success&&!0===b.success&&d.html(b.data),d.removeAttr("style"),c=d.find("input.media-upload-id"),a(document.body).trigger("wpo-wcpdf-media-upload-setting-updated",[c])},error:function(){d.removeAttr("style")}})}),b.open())}),a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_remove\_image\_button",function(){let b=a(this).parent(),c=b.find("input.media-upload-id"),d=b.find("img.media-upload-preview");c.val(""),d.remove(),a(this).remove(),a(~~".attachment-resolution, .attachment-resolution-warning").remove()})}); |
  |  | 1 | jQuery(document).ready(function(a){var b;let c,d=function(b,c,d){let e=a("#wpo-wcpdf-settings").find(d).filter(function(){let a=b.parent("div");return a.length&&"false"===a.attr("aria-hidden")});return e.length?e:c.find(d)};a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_upload\_image\_button",function(e){return e.preventDefault(),c=a(this).parent(),b?void b.open():void(b=wp.media.frames.file\_frame=wp.media({title:a(this).data("uploader\_title"),button:{text:a(this).data("uploader\_button\_text")},multiple:!1}),b.on("select",function(){let e=d(a(this),c,"input.media-upload-id"),f=d(a(this),c,"img.media-upload-preview"),g=b.state().get("selection").first().toJSON();e.val(g.id),f.length&&f.attr("src",g.url),d(a(this),c,".attachment-resolution, .attachment-resolution-warning").remove(),c.parent().block({message:null,overlayCSS:{background:"#fff",opacity:.6}});let h={security:e.data("ajax\_nonce"),action:"wpo\_wcpdf\_get\_media\_upload\_setting\_html",args:e.data("settings\_callback\_args"),attachment\_id:g.id};xhr=a.ajax({type:"POST",url:wpo\_wcpdf\_admin.ajaxurl,data:h,success:function(b){b&&"undefined"!=typeof b.success&&!0===b.success&&c.html(b.data),c.removeAttr("style"),c.parent().unblock(),e=d(a(this),c,"input.media-upload-id"),a(document.body).trigger("wpo-wcpdf-media-upload-setting-updated",[e])},error:function(){c.parent().unblock()}})}),b.open())}),a("#wpo-wcpdf-settings, .wpo-wcpdf-setup").on("click",".wpo\_remove\_image\_button",function(){let b=a(this).parent(),c=b.find("input.media-upload-id"),e=b.find("img.media-upload-preview");c.val(""),e.remove(),a(this).remove(),d(a(this),b,".attachment-resolution, .attachment-resolution-warning").remove()})}); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php?rev=3053443#L180 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-main.php?rev=3076105#L180 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 180 | 180 |  |
  | 181 | 181 | $attach\_to\_document\_types = $this->get\_documents\_for\_email( $email\_id, $order ); |
  | 182 |  | $lock                     = new Semaphore( $this->lock\_name, $this->lock\_time, $this->lock\_loggers, $this->lock\_context ); |
  |  | 182 | $lock                     = new Semaphore( $this->lock\_name . "\_order\_{$order\_id}\_email\_{$email\_id}", $this->lock\_time, $this->lock\_loggers, $this->lock\_context ); |
  | 183 | 183 |  |
  | 184 | 184 | if ( $lock->lock( $this->lock\_retries ) ) { |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php")

  | [r3028352](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3028352#L438 "Show revision 3028352 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3076105#L438 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 438 | 438 | $order\_id                              = is\_callable( array( $order, 'get\_id' ) ) ? $order->get\_id() : 0; |
  | 439 | 439 | $data[$order\_id]['order\_number']       = is\_callable( array( $order, 'get\_order\_number' ) ) ? $order->get\_order\_number() : ''; |
  | 440 |  | $data[$order\_id]['billing\_first\_name'] = is\_callable( array( $order, 'get\_billing\_first\_name' ) ) ? ~~$order->get\_billing\_first\_name(~~) : ''; |
  | 441 |  | $data[$order\_id]['billing\_last\_name']  = is\_callable( array( $order, 'get\_billing\_last\_name' ) ) ? ~~$order->get\_billing\_last\_name(~~) : ''; |
  | 442 |  | $data[$order\_id]['billing\_company']    = is\_callable( array( $order, 'get\_billing\_company' ) ) ? ~~$order->get\_billing\_company(~~) : ''; |
  |  | 440 | $data[$order\_id]['billing\_first\_name'] = is\_callable( array( $order, 'get\_billing\_first\_name' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_first\_name(), 'first\_name' ) : ''; |
  |  | 441 | $data[$order\_id]['billing\_last\_name']  = is\_callable( array( $order, 'get\_billing\_last\_name' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_last\_name(), 'last\_name' ) : ''; |
  |  | 442 | $data[$order\_id]['billing\_company']    = is\_callable( array( $order, 'get\_billing\_company' ) ) ? wpo\_wcpdf\_sanitize\_html\_content( $order->get\_billing\_company(), 'company' ) : ''; |
  | 443 | 443 | $data[$order\_id]['date\_created']       = is\_callable( array( $order, 'get\_date\_created' ) ) ? '<strong>' . esc\_attr\_\_( 'Date', 'woocommerce-pdf-invoices-packing-slips' ) . ':</strong> ' . $order->get\_date\_created()->format( 'Y/m/d' ) : ''; |
  | 444 | 444 | $data[$order\_id]['total']              = is\_callable( array( $order, 'get\_total' ) ) ? '<strong>' . esc\_attr\_\_( 'Total', 'woocommerce-pdf-invoices-packing-slips' ) . ':</strong> ' . wc\_price( $order->get\_total() ) : ''; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3028352#L970) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/class-wcpdf-settings.php?rev=3076105#L970) |  |
  | 970 | 970 | $args['current'] = absint( $\_POST['attachment\_id'] ); |
  | 971 | 971 |  |
  |  | 972 | if ( isset( $args['translatable'] ) ) { |
  |  | 973 | $args['translatable'] = wc\_string\_to\_bool( $args['translatable'] ); |
  |  | 974 | } |
  |  | 975 |  |
  | 972 | 976 | // get settings HTML |
  | 973 | 977 | ob\_start(); |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php")

  | [r2953838](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=2953838#L27 "Show revision 2953838 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105#L27 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | if ( version\_compare( \WC\_Subscriptions::$version, '2.0', '<' ) ) { |
  | 28 | 28 | add\_action( 'woocommerce\_subscriptions\_renewal\_order\_created', array( $this, 'woocommerce\_subscriptions\_renewal\_order\_created' ), 10, 4 ); |
  | 29 |  | } elseif ( version\_compare( \WC\_Subscriptions::$version, '~~2.5~~', '<' ) ) { |
  |  | 29 | } elseif ( version\_compare( \WC\_Subscriptions::$version, '4.7.0', '<' ) ) { |
  | 30 | 30 | add\_filter( 'wcs\_renewal\_order\_meta', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 31 | 31 | add\_filter( 'wcs\_resubscribe\_order\_meta', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 32 | 32 | } else { |
  | 33 |  | add\_filter( 'wc\_subscription\_renewal\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  |  | 33 | add\_filter( 'wc\_subscriptions\_renewal\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 34 | 34 | add\_filter( 'wc\_subscriptions\_resubscribe\_order\_data', array( $this, 'wcs\_renewal\_order\_meta' ), 10, 3 ); |
  | 35 | 35 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=2953838#L92) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/compatibility/class-wcpdf-compatibility-third-party-plugins.php?rev=3076105#L92) |  |
  | 92 | 92 | \* Removes documents meta from WooCommerce Subscriptions renewal order |
  | 93 | 93 | \*/ |
  | 94 |  | public function wcs\_renewal\_order\_meta ( $meta, $to\_order, $from\_order ) { |
  | 95 |  | if ( ! empty( $meta ) ) { |
  | 96 |  | $documents      = WPO\_WCPDF()->documents->get\_documents(); |
  | 97 |  | $documents\_meta = array(); |
  | 98 |  |  |
  | 99 |  | foreach ( $documents as $document ) { |
  | 100 |  | $document\_data\_keys = apply\_filters( 'wpo\_wcpdf\_delete\_document\_data\_keys', array( |
  | 101 |  | 'settings', |
  | 102 |  | 'date', |
  | 103 |  | 'date\_formatted', |
  | 104 |  | 'number', |
  | 105 |  | 'number\_data', |
  | 106 |  | 'notes', |
  | 107 |  | 'exists', |
  | 108 |  | ), $document ); |
  | 109 |  |  |
  | 110 |  | $document\_meta      = array\_map( function ( $data\_key ) use ( $document ) { |
  | 111 |  | return "\_wcpdf\_{$document->slug}\_{$data\_key}"; |
  | 112 |  | }, $document\_data\_keys ); |
  | 113 |  | $document\_meta[]    = "\_wcpdf\_formatted\_{$document->slug}\_number"; // legacy meta key |
  | 114 |  | $documents\_meta     = array\_merge( $documents\_meta, $document\_meta ); |
  | 115 |  | } |
  | 116 |  |  |
  | 117 |  | foreach ( $meta as $key => $value ) { |
  | 118 |  | if ( in\_array( $value['meta\_key'], $documents\_meta ) ) { |
  | 119 |  | unset( $meta[$key] ); |
  | 120 |  | } |
  | 121 |  | } |
  | 122 |  | } |
  |  | 94 | public function wcs\_renewal\_order\_meta( $meta, $to\_order, $from\_order ) { |
  |  | 95 | if ( empty( $meta ) ) { |
  |  | 96 | return $meta; |
  |  | 97 | } |
  |  | 98 |  |
  |  | 99 | $documents      = WPO\_WCPDF()->documents->get\_documents(); |
  |  | 100 | $documents\_meta = array(); |
  |  | 101 |  |
  |  | 102 | foreach ( $documents as $document ) { |
  |  | 103 | $document\_data\_keys = apply\_filters( 'wpo\_wcpdf\_delete\_document\_data\_keys', array( |
  |  | 104 | 'settings', |
  |  | 105 | 'date', |
  |  | 106 | 'date\_formatted', |
  |  | 107 | 'number', |
  |  | 108 | 'number\_data', |
  |  | 109 | 'notes', |
  |  | 110 | 'exists', |
  |  | 111 | ), $document ); |
  |  | 112 |  |
  |  | 113 | $document\_meta   = array\_map( function ( $data\_key ) use ( $document ) { |
  |  | 114 | return "\_wcpdf\_{$document->slug}\_{$data\_key}"; |
  |  | 115 | }, $document\_data\_keys ); |
  |  | 116 | $document\_meta[] = "\_wcpdf\_formatted\_{$document->slug}\_number"; // legacy meta key |
  |  | 117 | $documents\_meta  = array\_merge( $documents\_meta, $document\_meta ); |
  |  | 118 | } |
  |  | 119 |  |
  |  | 120 | foreach ( $meta as $key => $value ) { |
  |  | 121 | // The old deprecated hook (`wcs\_renewal\_order\_meta`) sends $meta with this data structure: array(... , array( "meta\_key":"\_wcpdf\_invoice\_number","meta\_value":"158" ), ...) |
  |  | 122 | // The new hook (`wc\_subscriptions\_renewal\_order\_data`) sends $meta with this data structure: array(... ,"\_wcpdf\_invoice\_number":"158", ...) |
  |  | 123 | $meta\_key = is\_array( $value ) ? ( $value['meta\_key'] ?? null ) : $key; |
  |  | 124 | if ( in\_array( $meta\_key, $documents\_meta, true ) ) { |
  |  | 125 | unset( $meta[ $key ] ); |
  |  | 126 | } |
  |  | 127 | } |
  |  | 128 |  |
  | 123 | 129 | return $meta; |
  | 124 | 130 | } |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L18 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L18 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 18 | 18 |  |
  | 19 | 19 | public function is\_refund( $order ) { |
  | 20 |  | return ~~$order->get\_type() == 'shop\_order\_refund'~~; |
  |  | 20 | return 'shop\_order\_refund' === $order->get\_type(); |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L83) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L83) |  |
  | 83 | 83 | if ( $this->is\_refund( $this->order ) ) { |
  | 84 | 84 | // temporarily switch order to make all filters / order calls work correctly |
  | 85 |  | $refund = $this->order; |
  |  | 85 | $refund      = $this->order; |
  | 86 | 86 | $this->order = $this->get\_refund\_parent( $this->order ); |
  | 87 |  | $address ~~= apply\_filters( 'wpo\_wcpdf\_billing\_address', $this->order->get\_formatted\_billing\_address(), $this~~ ); |
  |  | 87 | $address     = $this->order->get\_formatted\_billing\_address(); |
  | 88 | 88 | // switch back & unset |
  | 89 | 89 | $this->order = $refund; |
  | 90 |  | unset(~~$refund~~); |
  | 91 |  | } else~~if ( $address = $this->order->get\_formatted\_billing\_address() )~~ { |
  |  | 90 | unset( $refund ); |
  |  | 91 | } else { |
  | 92 | 92 | // regular shop\_order |
  | 93 |  | $address = apply\_filters( 'wpo\_wcpdf\_billing\_address', $address, $this ); |
  | 94 |  | } else { |
  | 95 |  | // no address |
  | 96 |  | $address = apply\_filters( 'wpo\_wcpdf\_billing\_address', \_\_('N/A', 'woocommerce-pdf-invoices-packing-slips' ), $this ); |
  | 97 |  | } |
  | 98 |  |  |
  | 99 |  | return $address; |
  |  | 93 | $address = $this->order->get\_formatted\_billing\_address(); |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | // no address |
  |  | 97 | if ( empty( $address ) ) { |
  |  | 98 | $address = \_\_( 'N/A', 'woocommerce-pdf-invoices-packing-slips' ); |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | return apply\_filters( 'wpo\_wcpdf\_billing\_address', wpo\_wcpdf\_sanitize\_html\_content( $address, 'address' ), $this ); |
  | 100 | 102 | } |
  | 101 | 103 | public function billing\_address() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L107) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L109) |  |
  | 107 | 109 | \*/ |
  | 108 | 110 | public function show\_billing\_address() { |
  | 109 |  | if~~( $this->get\_type() != 'packing-slip'~~ ) { |
  |  | 111 | if ( 'packing-slip' !== $this->get\_type() ) { |
  | 110 | 112 | return true; |
  | 111 | 113 | } else { |
  | 112 |  | return ! empty( $this->settings['display\_billing\_address'] ) && ( $this->ships\_to\_different\_address() || ~~$this->settings['display\_billing\_address'] == 'always'~~ ); |
  |  | 114 | return ! empty( $this->settings['display\_billing\_address'] ) && ( $this->ships\_to\_different\_address() || 'always' === $this->settings['display\_billing\_address'] ); |
  | 113 | 115 | } |
  | 114 | 116 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L128) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L130) |  |
  | 128 | 130 | } |
  | 129 | 131 |  |
  | 130 |  | return apply\_filters( 'wpo\_wcpdf\_billing\_email', ~~$billing\_email~~, $this ); |
  |  | 132 | return apply\_filters( 'wpo\_wcpdf\_billing\_email', sanitize\_email( $billing\_email ), $this ); |
  | 131 | 133 | } |
  | 132 | 134 | public function billing\_email() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L143) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L145) |  |
  | 143 | 145 | $phone  = is\_callable( array( $order, $getter ) ) ? call\_user\_func( array( $order, $getter ) ) : $phone; |
  | 144 | 146 | } |
  | 145 |  | return $phone; |
  |  | 147 |  |
  |  | 148 | return wpo\_wcpdf\_sanitize\_phone\_number( $phone ); |
  | 146 | 149 | } |
  | 147 | 150 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L177) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L180) |  |
  | 177 | 180 | if ( $this->is\_refund( $this->order ) ) { |
  | 178 | 181 | // temporarily switch order to make all filters / order calls work correctly |
  | 179 |  | $refund = $this->order; |
  |  | 182 | $refund      = $this->order; |
  | 180 | 183 | $this->order = $this->get\_refund\_parent( $this->order ); |
  | 181 |  | $address ~~= apply\_filters( 'wpo\_wcpdf\_shipping\_address', $this->order->get\_formatted\_shipping\_address(), $this~~ ); |
  |  | 184 | $address     = $this->order->get\_formatted\_shipping\_address(); |
  | 182 | 185 | // switch back & unset |
  | 183 | 186 | $this->order = $refund; |
  | 184 |  | unset(~~$refund~~); |
  | 185 |  | } else~~if ( $address = $this->order->get\_formatted\_shipping\_address() )~~ { |
  |  | 187 | unset( $refund ); |
  |  | 188 | } else { |
  | 186 | 189 | // regular shop\_order |
  | 187 |  | $address = apply\_filters( 'wpo\_wcpdf\_shipping\_address', $address, $this ); |
  | 188 |  | } else { |
  | 189 |  | // no address |
  |  | 190 | $address = $this->order->get\_formatted\_shipping\_address(); |
  |  | 191 |  |
  | 190 | 192 | // use fallback for packing slip |
  | 191 |  | if ( ~~apply\_filters( 'wpo\_wcpdf\_shipping\_address\_fallback', ( $this->get\_type() == 'packing-slip'~~ ), $this ) ) { |
  |  | 193 | if ( empty( $address ) && apply\_filters( 'wpo\_wcpdf\_shipping\_address\_fallback', ( 'packing-slip' === $this->get\_type() ), $this ) ) { |
  | 192 | 194 | $address = $this->get\_billing\_address(); |
  | 193 |  | } else{ |
  | 194 |  | $address = apply\_filters( 'wpo\_wcpdf\_shipping\_address', \_\_('N/A', 'woocommerce-pdf-invoices-packing-slips' ), $this ); |
  | 195 |  |  |
  | 196 |  | } |
  | 197 |  | } |
  | 198 |  |  |
  | 199 |  | return $address; |
  |  | 195 | } |
  |  | 196 | } |
  |  | 197 |  |
  |  | 198 | // no address |
  |  | 199 | if ( empty( $address ) ) { |
  |  | 200 | $address = \_\_( 'N/A', 'woocommerce-pdf-invoices-packing-slips' ); |
  |  | 201 | } |
  |  | 202 |  |
  |  | 203 | return apply\_filters( 'wpo\_wcpdf\_shipping\_address', wpo\_wcpdf\_sanitize\_html\_content( $address, 'address' ), $this ); |
  | 200 | 204 | } |
  | 201 | 205 | public function shipping\_address() { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L207) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L211) |  |
  | 207 | 211 | \*/ |
  | 208 | 212 | public function show\_shipping\_address() { |
  | 209 |  | if~~( $this->get\_type() != 'packing-slip'~~ ) { |
  | 210 |  | return ! empty( $this->settings['display\_shipping\_address'] ) && ( $this->ships\_to\_different\_address() || ~~$this->settings['display\_shipping\_address'] == 'always'~~ ); |
  |  | 213 | if ( 'packing-slip' !== $this->get\_type() ) { |
  |  | 214 | return ! empty( $this->settings['display\_shipping\_address'] ) && ( $this->ships\_to\_different\_address() || 'always' === $this->settings['display\_shipping\_address'] ); |
  | 211 | 215 | } else { |
  | 212 | 216 | return true; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L227) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L231) |  |
  | 227 | 231 |  |
  | 228 | 232 | // WC3.0 fallback to properties |
  | 229 |  | $property = str\_replace(~~'-', '\_', sanitize\_title( ltrim($field\_name, '\_'~~) ) ); |
  |  | 233 | $property = str\_replace( '-', '\_', sanitize\_title( ltrim( $field\_name, '\_' ) ) ); |
  | 230 | 234 | if ( empty( $custom\_field ) && is\_callable( array( $this->order, "get\_{$property}" ) ) ) { |
  | 231 | 235 | $custom\_field = $this->order->{"get\_{$property}"}( 'view' ); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L249) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L253) |  |
  | 249 | 253 | public function custom\_field( $field\_name, $field\_label = '', $display\_empty = false ) { |
  | 250 | 254 | $custom\_field = $this->get\_custom\_field( $field\_name ); |
  | 251 |  | if (!empty($field\_label)){ |
  |  | 255 |  |
  |  | 256 | if ( ! empty( $field\_label ) ) { |
  | 252 | 257 | // add a a trailing space to the label |
  | 253 | 258 | $field\_label .= ' '; |
  | 254 | 259 | } |
  | 255 | 260 |  |
  | 256 |  | if (!empty($custom\_field) || $display\_empty) { |
  |  | 261 | if ( ! empty( $custom\_field ) || $display\_empty ) { |
  |  | 262 | $allow\_tags = array( |
  |  | 263 | 'p'    => array(), |
  |  | 264 | 'span' => array(), |
  |  | 265 | 'ul'   => array(), |
  |  | 266 | 'ol'   => array(), |
  |  | 267 | 'li'   => array(), |
  |  | 268 | ); |
  |  | 269 |  |
  | 257 | 270 | if ( is\_array( $custom\_field ) ) { |
  |  | 271 | $custom\_field = array\_map( function( $field ) use ( $allow\_tags ) { |
  |  | 272 | return wpo\_wcpdf\_sanitize\_html\_content( $field, 'custom\_field', $allow\_tags ); |
  |  | 273 | }, $custom\_field ); |
  | 258 | 274 | echo $field\_label . implode( '<br>', $custom\_field ); |
  | 259 | 275 | } else { |
  |  | 276 | $custom\_field = wpo\_wcpdf\_sanitize\_html\_content( $custom\_field, 'custom\_field', $allow\_tags ); |
  | 260 | 277 | echo $field\_label . nl2br( $custom\_field ); |
  | 261 | 278 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L402) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L419) |  |
  | 402 | 419 | ?> |
  | 403 | 420 | <div class="<?php echo esc\_attr( implode( ' ', $css\_class ) ); ?>"> |
  | 404 |  | <?php echo wp~~autop( wptexturize( wp\_kses\_post( $content ) )~~ ); ?> |
  |  | 421 | <?php echo wpo\_wcpdf\_sanitize\_html\_content( $content, 'notes' ); ?> |
  | 405 | 422 | </div> |
  | 406 | 423 | <?php |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3053443#L1085) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document-methods.php?rev=3076105#L1102) |  |
  | 1085 | 1102 | $shipping\_notes = ! empty( $shipping\_notes ) ? \_\_( $shipping\_notes, 'woocommerce-pdf-invoices-packing-slips' ) : false; |
  | 1086 | 1103 |  |
  | 1087 |  | return apply\_filters( 'wpo\_wcpdf\_shipping\_notes', ~~$shipping\_notes~~, $this ); |
  |  | 1104 | return apply\_filters( 'wpo\_wcpdf\_shipping\_notes', wpo\_wcpdf\_sanitize\_html\_content( $shipping\_notes, 'notes' ), $this ); |
  | 1088 | 1105 | } |
  | 1089 | 1106 | public function shipping\_notes() { |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L817 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L817 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 817 | 817 | /\*\* |
  | 818 | 818 | \* Return logo id |
  |  | 819 | \* |
  |  | 820 | \* @return int|bool |
  | 819 | 821 | \*/ |
  | 820 | 822 | public function get\_header\_logo\_id() { |
  | 821 |  | if ( !empty( $this->settings['header\_logo'] ) ) { |
  | 822 |  | return apply\_filters( 'wpo\_wcpdf\_header\_logo\_id', $this->settings['header\_logo'], $this ); |
  | 823 |  | } |
  |  | 823 | $header\_logo\_id = false; |
  |  | 824 |  |
  |  | 825 | if ( ! empty( $this->settings['header\_logo'] ) ) { |
  |  | 826 | $header\_logo\_id = absint( $this->get\_settings\_text( 'header\_logo', '', false ) ); |
  |  | 827 |  |
  |  | 828 | if ( 0 === $header\_logo\_id ) { |
  |  | 829 | $header\_logo\_id = false; |
  |  | 830 | } |
  |  | 831 | } |
  |  | 832 |  |
  |  | 833 | return apply\_filters( 'wpo\_wcpdf\_header\_logo\_id', $header\_logo\_id, $this ); |
  | 824 | 834 | } |
  | 825 | 835 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L837) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L847) |  |
  | 837 | 847 | \*/ |
  | 838 | 848 | public function header\_logo() { |
  | 839 |  | if ( $this->get\_header\_logo\_id() ) { |
  | 840 |  | $attachment\_id = $this->get\_header\_logo\_id(); |
  | 841 |  | $company       = $this->get\_shop\_name(); |
  | 842 |  |  |
  | 843 |  | if ( $attachment\_id ) { |
  | 844 |  | $attachment      = wp\_get\_attachment\_image\_src( $attachment\_id, 'full', false ); |
  | 845 |  | $attachment\_path = get\_attached\_file( $attachment\_id ); |
  | 846 |  |  |
  | 847 |  | if ( empty( $attachment ) || empty( $attachment\_path ) ) { |
  |  | 849 | $attachment\_id = $this->get\_header\_logo\_id(); |
  |  | 850 |  |
  |  | 851 | if ( $attachment\_id ) { |
  |  | 852 | $company         = $this->get\_shop\_name(); |
  |  | 853 | $attachment      = wp\_get\_attachment\_image\_src( $attachment\_id, 'full', false ); |
  |  | 854 | $attachment\_path = get\_attached\_file( $attachment\_id ); |
  |  | 855 |  |
  |  | 856 | if ( empty( $attachment ) || empty( $attachment\_path ) ) { |
  |  | 857 | return; |
  |  | 858 | } |
  |  | 859 |  |
  |  | 860 | $attachment\_src    = $attachment[0]; |
  |  | 861 | $attachment\_width  = $attachment[1]; |
  |  | 862 | $attachment\_height = $attachment[2]; |
  |  | 863 |  |
  |  | 864 | if ( apply\_filters( 'wpo\_wcpdf\_use\_path', true ) && file\_exists( $attachment\_path ) ) { |
  |  | 865 | $src = $attachment\_path; |
  |  | 866 | } else { |
  |  | 867 | $head = wp\_remote\_head( $attachment\_src, [ 'sslverify' => false ] ); |
  |  | 868 | if ( is\_wp\_error( $head ) ) { |
  |  | 869 | $errors = $head->get\_error\_messages(); |
  |  | 870 | foreach ( $errors as $error ) { |
  |  | 871 | wcpdf\_log\_error( $error, 'critical' ); |
  |  | 872 | } |
  |  | 873 | return; |
  |  | 874 | } elseif ( isset( $head['response']['code'] ) && $head['response']['code'] === 200 ) { |
  |  | 875 | $src = $attachment\_src; |
  |  | 876 | } else { |
  | 848 | 877 | return; |
  | 849 | 878 | } |
  | 850 |  |  |
  | 851 |  | $attachment\_src    = $attachment[0]; |
  | 852 |  | $attachment\_width  = $attachment[1]; |
  | 853 |  | $attachment\_height = $attachment[2]; |
  | 854 |  |  |
  | 855 |  | if ( apply\_filters( 'wpo\_wcpdf\_use\_path', true ) && file\_exists( $attachment\_path ) ) { |
  | 856 |  | $src = $attachment\_path; |
  | 857 |  | } else { |
  | 858 |  | $head = wp\_remote\_head( $attachment\_src, [ 'sslverify' => false ] ); |
  | 859 |  | if ( is\_wp\_error( $head ) ) { |
  | 860 |  | $errors = $head->get\_error\_messages(); |
  | 861 |  | foreach ( $errors as $error ) { |
  | 862 |  | wcpdf\_log\_error( $error, 'critical' ); |
  | 863 |  | } |
  | 864 |  | return; |
  | 865 |  | } elseif ( isset( $head['response']['code'] ) && $head['response']['code'] === 200 ) { |
  | 866 |  | $src = $attachment\_src; |
  | 867 |  | } else { |
  | 868 |  | return; |
  | 869 |  | } |
  | 870 |  | } |
  | 871 |  |  |
  | 872 |  | $img\_element = sprintf( '<img src="%1$s" alt="%2$s" />', esc\_attr( $src ), esc\_attr( $company ) ); |
  | 873 |  |  |
  | 874 |  | echo apply\_filters( 'wpo\_wcpdf\_header\_logo\_img\_element', $img\_element, $attachment, $this ); |
  | 875 |  | } |
  |  | 879 | } |
  |  | 880 |  |
  |  | 881 | $img\_element = sprintf( '<img src="%1$s" alt="%2$s" />', esc\_attr( $src ), esc\_attr( $company ) ); |
  |  | 882 |  |
  |  | 883 | echo apply\_filters( 'wpo\_wcpdf\_header\_logo\_img\_element', $img\_element, $attachment, $this ); |
  | 876 | 884 | } |
  | 877 | 885 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3053443#L885) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/documents/abstract-wcpdf-order-document.php?rev=3076105#L893) |  |
  | 885 | 893 | } elseif( ! empty( $setting ) && is\_array( $setting ) ) { |
  | 886 | 894 | $text = reset( $setting ); |
  |  | 895 | } else { |
  |  | 896 | $text = $setting; |
  | 887 | 897 | } |
  | 888 | 898 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php")

  | [r2991987](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L429 "Show revision 2991987 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L429 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 429 | 429 | public function media\_upload( $args ) { |
  | 430 | 430 | extract( $this->normalize\_settings\_args( $args ) ); |
  |  | 431 |  |
  |  | 432 | $setting\_name = $this->append\_language( $setting\_name, $args ); |
  | 431 | 433 |  |
  | 432 | 434 | if( ! empty( $current ) && $attachment = wp\_get\_attachment\_image\_src( $current, 'full', false ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L447) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L449) |  |
  | 447 | 449 | } |
  | 448 | 450 |  |
  | 449 |  | /\* |
  |  | 451 | /\*\* |
  | 450 | 452 | \* .webp support can be disabled but still showing the image in settings. |
  | 451 | 453 | \* We should add a notice because this will display an error when redering the PDF using DOMPDF. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L653) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L655) |  |
  | 653 | 655 | } elseif (isset( $option[$args['id']]['default'] )) { |
  | 654 | 656 | $args['current'] = $option[$args['id']]['default']; |
  |  | 657 | } elseif ( isset( $option[$args['id']] ) ) { |
  |  | 658 | $args['current'] = $option[$args['id']]; |
  | 655 | 659 | } |
  | 656 | 660 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=2991987#L715) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-callbacks.php?rev=3076105#L719) |  |
  | 715 | 719 | return apply\_filters( 'wpo\_wcpdf\_validate\_input', $output, $input ); |
  | 716 | 720 | } |
  |  | 721 |  |
  |  | 722 | /\*\* |
  |  | 723 | \* Appends language at the end of the setting provided, in case the setting is translatable |
  |  | 724 | \* and it does not have a language set. |
  |  | 725 | \* |
  |  | 726 | \* @param string $setting Settings field that needs a language. |
  |  | 727 | \* @param array  $args Setting arguments. |
  |  | 728 | \* |
  |  | 729 | \* @return string |
  |  | 730 | \*/ |
  |  | 731 | public function append\_language( string $setting, array $args ): string { |
  |  | 732 | if ( |
  |  | 733 | isset( $args['translatable'] ) && |
  |  | 734 | true === $args['translatable'] && |
  |  | 735 | isset( $args['lang'] )         && |
  |  | 736 | 'default' !== $args['lang']    && |
  |  | 737 | ! ( substr( $setting, -strlen( "[{$args['lang']}]" ) ) === "[{$args['lang']}]" ) |
  |  | 738 | ) { |
  |  | 739 | return $setting .= "[{$args['lang']}]"; |
  |  | 740 | } else { |
  |  | 741 | return $setting; |
  |  | 742 | } |
  |  | 743 | } |
  | 717 | 744 | } |
  | 718 | 745 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php?rev=3053443#L545 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-debug.php?rev=3076105#L545 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 545 | 545 | $args[ $date\_arg ] = $from\_date . '...' . $to\_date; |
  | 546 | 546 |  |
  | 547 |  | if ( defined( 'WC\_VERSION' ) && version\_compare( WC\_VERSION, '6.8.0', '>=' ) ~~) {~~ |
  |  | 547 | if ( defined( 'WC\_VERSION' ) && version\_compare( WC\_VERSION, '6.8.0', '>=' ) && WPO\_WCPDF()->order\_util->custom\_orders\_table\_usage\_is\_enabled() ) { // Woo >= 6.8.0 + HPOS |
  | 548 | 548 | $args = wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( $args, $args ); |
  | 549 | 549 | } else { |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php?rev=3019205#L138 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/settings/class-wcpdf-settings-general.php?rev=3076105#L138 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 138 | 138 | 'section'   => 'general\_settings', |
  | 139 | 139 | 'args'      => array( |
  | 140 |  | 'option\_name'=> $option\_name, |
  | 141 |  | 'id'=> 'header\_logo', |
  | 142 |  | 'uploader\_title'=> \_\_( 'Select or upload your invoice header/logo', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 143 |  | 'uploader\_button\_text'=> \_\_( 'Set image', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 144 |  | 'remove\_button\_text'=> \_\_( 'Remove image', 'woocommerce-pdf-invoices-packing-slips' ), |
  | 145 |  | ~~//'description'                 => \_\_( '...', 'woocommerce-pdf-invoices-packing-slips' )~~, |
  |  | 140 | 'option\_name'          => $option\_name, |
  |  | 141 | 'id'                   => 'header\_logo', |
  |  | 142 | 'uploader\_title'       => \_\_( 'Select or upload your invoice header/logo', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 143 | 'uploader\_button\_text' => \_\_( 'Set image', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 144 | 'remove\_button\_text'   => \_\_( 'Remove image', 'woocommerce-pdf-invoices-packing-slips' ), |
  |  | 145 | 'translatable'         => true, |
  | 146 | 146 | ) |
  | 147 | 147 | ), |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L25 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3076105#L25 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 25 | 25 | } |
  | 26 | 26 |  |
  | 27 |  | function wcpdf\_get\_document( $document\_type, $order, $init = false ) { |
  | 28 |  | // $order can be one of the following: |
  | 29 |  | // - WC Order object |
  | 30 |  | // - array of order ids |
  | 31 |  | // - null if order not loaded or loaded later |
  |  | 27 | /\*\* |
  |  | 28 | \* Get the document object for an order |
  |  | 29 | \* |
  |  | 30 | \* @param string $document\_type |
  |  | 31 | \* @param mixed  $order |
  |  | 32 | \* Passing an order object will return the document object for that order. |
  |  | 33 | \* Passing an array of order ids will return a Bulk\_Document object. |
  |  | 34 | \* Passing a single order ID within an array retrieves the document object for that order and refreshes the order object to ensure the data is up-to-date. |
  |  | 35 | \* Passing null will return a document object without an order. |
  |  | 36 | \* |
  |  | 37 | \* @param bool   $init |
  |  | 38 | \* |
  |  | 39 | \* @return object|false |
  |  | 40 | \*/ |
  |  | 41 | function wcpdf\_get\_document( string $document\_type, $order, bool $init = false ) { |
  | 32 | 42 | if ( ! empty( $order ) ) { |
  | 33 | 43 | if ( ! is\_object( $order ) && ! is\_array( $order ) && is\_numeric( $order ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L80) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3076105#L90) |  |
  | 80 | 90 | $document = WPO\_WCPDF()->documents->get\_document( $document\_type, $order ); |
  | 81 | 91 |  |
  | 82 |  | if ( ! $document->is\_allowed() ) { |
  |  | 92 | if ( ! $document || ! $document->is\_allowed() ) { |
  | 83 | 93 | return apply\_filters( 'wcpdf\_get\_document', false, $document\_type, $order, $init ); |
  | 84 | 94 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L491) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3076105#L501) |  |
  | 491 | 501 |  |
  | 492 | 502 | /\*\* |
  |  | 503 | \* Sanitize HTML content, prevents XSS attacks. |
  |  | 504 | \* |
  |  | 505 | \* @param string $html |
  |  | 506 | \* @param string $context |
  |  | 507 | \* @param array  $allow\_tags |
  |  | 508 | \* |
  |  | 509 | \* @return string |
  |  | 510 | \*/ |
  |  | 511 | function wpo\_wcpdf\_sanitize\_html\_content( string $html, string $context = '', array $allow\_tags = array() ): string { |
  |  | 512 | if ( empty( $html ) ) { |
  |  | 513 | return $html; |
  |  | 514 | } |
  |  | 515 |  |
  |  | 516 | // default allowed tags |
  |  | 517 | $allow\_tags = array\_merge( apply\_filters( 'wpo\_wcpdf\_sanitize\_html\_default\_allow\_tags', array( |
  |  | 518 | // tag   => allowed attributes eg. array( 'href', 'title' ) in case of a <a> tag. |
  |  | 519 | 'br'     => array(), |
  |  | 520 | 'em'     => array(), |
  |  | 521 | 'strong' => array(), |
  |  | 522 | ), $context ), $allow\_tags ); |
  |  | 523 |  |
  |  | 524 | $safe\_tags = array( |
  |  | 525 | 'b'          => array(), |
  |  | 526 | 'blockquote' => array(), |
  |  | 527 | 'br'         => array(), |
  |  | 528 | 'em'         => array(), |
  |  | 529 | 'i'          => array(), |
  |  | 530 | 'li'         => array(), |
  |  | 531 | 'ol'         => array(), |
  |  | 532 | 'p'          => array(), |
  |  | 533 | 'strong'     => array(), |
  |  | 534 | 'u'          => array(), |
  |  | 535 | 'ul'         => array(), |
  |  | 536 | 'span'       => array( 'style' ), |
  |  | 537 | 'h1'         => array(), |
  |  | 538 | 'h2'         => array(), |
  |  | 539 | 'h3'         => array(), |
  |  | 540 | 'h4'         => array(), |
  |  | 541 | 'h5'         => array(), |
  |  | 542 | 'h6'         => array(), |
  |  | 543 | 'div'        => array( 'style' ), |
  |  | 544 | 'table'      => array( 'border', 'cellspacing', 'cellpadding' ), |
  |  | 545 | 'tr'         => array(), |
  |  | 546 | 'td'         => array( 'colspan', 'rowspan' ), |
  |  | 547 | 'th'         => array( 'colspan', 'rowspan', 'scope' ), |
  |  | 548 | 'thead'      => array(), |
  |  | 549 | 'tbody'      => array(), |
  |  | 550 | 'tfoot'      => array(), |
  |  | 551 | 'code'       => array(), |
  |  | 552 | 'pre'        => array(), |
  |  | 553 | 'dl'         => array(), |
  |  | 554 | 'dt'         => array(), |
  |  | 555 | 'dd'         => array(), |
  |  | 556 | 'hr'         => array(), |
  |  | 557 | 'sup'        => array(), |
  |  | 558 | 'sub'        => array(), |
  |  | 559 | 'figure'     => array(), |
  |  | 560 | 'figcaption' => array(), |
  |  | 561 | 'abbr'       => array( 'title' ), |
  |  | 562 | ); |
  |  | 563 |  |
  |  | 564 | $filtered\_tags = array(); |
  |  | 565 |  |
  |  | 566 | foreach ( $allow\_tags as $tag => $attributes ) { |
  |  | 567 | if ( array\_key\_exists( $tag, $safe\_tags ) ) { |
  |  | 568 | $safe\_attributes       = array\_intersect( $attributes, $safe\_tags[ $tag ] ); |
  |  | 569 | $filtered\_tags[ $tag ] = ! empty( $safe\_attributes ) ? $safe\_attributes : array(); |
  |  | 570 | } |
  |  | 571 | } |
  |  | 572 |  |
  |  | 573 | if ( empty( $filtered\_tags ) ) { |
  |  | 574 | return $html; |
  |  | 575 | } |
  |  | 576 |  |
  |  | 577 | $dom = new \DOMDocument(); |
  |  | 578 |  |
  |  | 579 | // clean up special chars |
  |  | 580 | if ( apply\_filters( 'wpo\_wcpdf\_convert\_encoding', function\_exists( 'htmlspecialchars\_decode' ) ) ) { |
  |  | 581 | $html = htmlspecialchars\_decode( wcpdf\_convert\_encoding( $html ), ENT\_QUOTES ); |
  |  | 582 | } |
  |  | 583 |  |
  |  | 584 | libxml\_use\_internal\_errors( true ); // suppress malformed HTML errors |
  |  | 585 | @$dom->loadHTML( $html, LIBXML\_HTML\_NOIMPLIED | LIBXML\_HTML\_NODEFDTD ); |
  |  | 586 | libxml\_clear\_errors(); |
  |  | 587 |  |
  |  | 588 | $xpath = new \DOMXPath( $dom ); |
  |  | 589 |  |
  |  | 590 | // iterate over all nodes. |
  |  | 591 | foreach ( $xpath->query( '//\*' ) as $node ) { |
  |  | 592 | // check if the node is allowed. |
  |  | 593 | if ( array\_key\_exists( $node->nodeName, $filtered\_tags ) ) { |
  |  | 594 | // if the node is allowed, check each attribute. |
  |  | 595 | foreach ( $node->attributes as $attr ) { |
  |  | 596 | if ( ! in\_array( $attr->nodeName, $filtered\_tags[ $node->nodeName ] ) ) { |
  |  | 597 | $node->removeAttribute( $attr->nodeName ); |
  |  | 598 | } |
  |  | 599 | } |
  |  | 600 | } else { |
  |  | 601 | // if the node is not allowed, remove it but try to preserve text. |
  |  | 602 | if ( $node->parentNode ) { |
  |  | 603 | $fragment = $dom->createDocumentFragment(); |
  |  | 604 |  |
  |  | 605 | while ( $node->childNodes->length > 0 ) { |
  |  | 606 | $fragment->appendChild( $node->childNodes->item( 0 ) ); |
  |  | 607 | } |
  |  | 608 |  |
  |  | 609 | if ( $fragment->hasChildNodes() ) { |
  |  | 610 | $node->parentNode->replaceChild( $fragment, $node ); |
  |  | 611 | } else { |
  |  | 612 | $node->parentNode->removeChild( $node ); |
  |  | 613 | } |
  |  | 614 | } |
  |  | 615 | } |
  |  | 616 | } |
  |  | 617 |  |
  |  | 618 | return $dom->saveHTML(); |
  |  | 619 | } |
  |  | 620 |  |
  |  | 621 | /\*\* |
  |  | 622 | \* Sanitize phone number |
  |  | 623 | \* |
  |  | 624 | \* @param string $text |
  |  | 625 | \* |
  |  | 626 | \* @return string |
  |  | 627 | \*/ |
  |  | 628 | function wpo\_wcpdf\_sanitize\_phone\_number( string $text ): string { |
  |  | 629 | return preg\_replace( '/[^0-9\+\-\(\)\s\.x]/', '', $text ); |
  |  | 630 | } |
  |  | 631 |  |
  |  | 632 | /\*\* |
  | 493 | 633 | \* Safe redirect or die. |
  | 494 | 634 | \* |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3053443#L514) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/includes/wcpdf-functions.php?rev=3076105#L654) |  |
  | 514 | 654 | \* |
  | 515 | 655 | \* @param array $wp\_query\_args |
  | 516 |  | \* @param ~~mixed~~ $query\_args |
  |  | 656 | \* @param array $query\_args |
  | 517 | 657 | \* |
  | 518 | 658 | \* @return array |
  | 519 | 659 | \*/ |
  | 520 |  | function wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( array $wp\_query\_args, ~~mixed~~ $query\_vars ): array { |
  |  | 660 | function wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query( array $wp\_query\_args, array $query\_vars ): array { |
  | 521 | 661 | $documents = WPO\_WCPDF()->documents->get\_documents(); |
  | 522 | 662 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L3 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L3 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: PDF Invoices & Packing Slips for WooCommerce 3.8.~~0-beta-4~~\n" |
  |  | 5 | "Project-Id-Version: PDF Invoices & Packing Slips for WooCommerce 3.8.1-beta-2\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/woocommerce-pdf-invoices-packing-slips\n" |
  | 7 | 7 | "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L10) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L10) |  |
  | 10 | 10 | "Content-Type: text/plain; charset=UTF-8\n" |
  | 11 | 11 | "Content-Transfer-Encoding: 8bit\n" |
  | 12 |  | "POT-Creation-Date: 2024-0~~3-18T11:57:02+01~~:00\n" |
  |  | 12 | "POT-Creation-Date: 2024-04-23T13:52:32+02:00\n" |
  | 13 | 13 | "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n" |
  | 14 | 14 | "X-Generator: WP-CLI 2.7.1\n" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L54) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L54) |  |
  | 54 | 54 | #: includes/views/extensions.php:121 |
  | 55 | 55 | #: includes/views/promo.php:34 |
  | 56 |  | #: woocommerce-pdf-invoices-packingslips.php:3~~39~~ |
  | 57 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~8~~ |
  | 58 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~6~~ |
  | 59 |  | #: woocommerce-pdf-invoices-packingslips.php:52~~6~~ |
  |  | 56 | #: woocommerce-pdf-invoices-packingslips.php:340 |
  |  | 57 | #: woocommerce-pdf-invoices-packingslips.php:399 |
  |  | 58 | #: woocommerce-pdf-invoices-packingslips.php:437 |
  |  | 59 | #: woocommerce-pdf-invoices-packingslips.php:527 |
  | 60 | 60 | msgid "Hide this message" |
  | 61 | 61 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L98) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L98) |  |
  | 98 | 98 | #: includes/class-wcpdf-admin.php:323 |
  | 99 | 99 | #: includes/class-wcpdf-main.php:1275 |
  | 100 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:12~~22~~ |
  |  | 100 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1239 |
  | 101 | 101 | #: includes/documents/class-wcpdf-invoice.php:280 |
  | 102 | 102 | #: includes/views/setup-wizard/display-options.php:60 |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L485) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L485) |  |
  | 485 | 485 |  |
  | 486 | 486 | #: includes/class-wcpdf-settings.php:444 |
  | 487 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:10~~50~~ |
  |  | 487 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1067 |
  | 488 | 488 | #: ubl/Settings/TaxesSettings.php:170 |
  | 489 | 489 | msgid "Total" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L565) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L565) |  |
  | 565 | 565 | msgstr "" |
  | 566 | 566 |  |
  | 567 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~6~~ |
  | 568 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:~~194~~ |
  |  | 567 | #: includes/documents/abstract-wcpdf-order-document-methods.php:98 |
  |  | 568 | #: includes/documents/abstract-wcpdf-order-document-methods.php:200 |
  | 569 | 569 | msgid "N/A" |
  | 570 | 570 | msgstr "" |
  | 571 | 571 |  |
  | 572 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~24~~ |
  |  | 572 | #: includes/documents/abstract-wcpdf-order-document-methods.php:941 |
  | 573 | 573 | msgid "Subtotal" |
  | 574 | 574 | msgstr "" |
  | 575 | 575 |  |
  | 576 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~49~~ |
  |  | 576 | #: includes/documents/abstract-wcpdf-order-document-methods.php:966 |
  | 577 | 577 | msgid "Shipping" |
  | 578 | 578 | msgstr "" |
  | 579 | 579 |  |
  | 580 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:9~~80~~ |
  |  | 580 | #: includes/documents/abstract-wcpdf-order-document-methods.php:997 |
  | 581 | 581 | msgid "Discount" |
  | 582 | 582 | msgstr "" |
  | 583 | 583 |  |
  | 584 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:10~~47~~ |
  |  | 584 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1064 |
  | 585 | 585 | msgid "Total ex. VAT" |
  | 586 | 586 | msgstr "" |
  | 587 | 587 |  |
  | 588 |  | #: includes/documents/abstract-wcpdf-order-document-methods.php:12~~23~~ |
  |  | 588 | #: includes/documents/abstract-wcpdf-order-document-methods.php:1240 |
  | 589 | 589 | #: includes/documents/class-wcpdf-invoice.php:281 |
  | 590 | 590 | #: includes/views/setup-wizard/display-options.php:61 |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L612) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L612) |  |
  | 612 | 612 | msgstr "" |
  | 613 | 613 |  |
  | 614 |  | #: includes/documents/abstract-wcpdf-order-document.php:12~~6~~3 |
  |  | 614 | #: includes/documents/abstract-wcpdf-order-document.php:1273 |
  | 615 | 615 | msgid "Admin email" |
  | 616 | 616 | msgstr "" |
  | 617 | 617 |  |
  | 618 |  | #: includes/documents/abstract-wcpdf-order-document.php:12~~6~~6 |
  |  | 618 | #: includes/documents/abstract-wcpdf-order-document.php:1276 |
  | 619 | 619 | msgid "Manual email" |
  | 620 | 620 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L990) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L990) |  |
  | 990 | 990 | msgstr "" |
  | 991 | 991 |  |
  | 992 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:46~~5~~ |
  |  | 992 | #: includes/settings/class-wcpdf-settings-callbacks.php:467 |
  | 993 | 993 | msgid "Image resolution" |
  | 994 | 994 | msgstr "" |
  | 995 | 995 |  |
  | 996 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:47~~3~~ |
  |  | 996 | #: includes/settings/class-wcpdf-settings-callbacks.php:475 |
  | 997 | 997 | msgid "The image resolution exceeds the recommended maximum of 600dpi. This will unnecessarily increase the size of your PDF files and could negatively affect performance." |
  | 998 | 998 | msgstr "" |
  | 999 | 999 |  |
  | 1000 |  | #: includes/settings/class-wcpdf-settings-callbacks.php:52~~1~~ |
  |  | 1000 | #: includes/settings/class-wcpdf-settings-callbacks.php:523 |
  | 1001 | 1001 | msgid "Save" |
  | 1002 | 1002 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L2273) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L2273) |  |
  | 2273 | 2273 | msgstr "" |
  | 2274 | 2274 |  |
  | 2275 |  | #: includes/wcpdf-functions.php:3~~4~~3 |
  |  | 2275 | #: includes/wcpdf-functions.php:353 |
  | 2276 | 2276 | msgid "Error creating PDF, please contact the site owner." |
  | 2277 | 2277 | msgstr "" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3053443#L2661) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/languages/woocommerce-pdf-invoices-packing-slips.pot?rev=3076105#L2661) |  |
  | 2661 | 2661 |  |
  | 2662 | 2662 | #. translators: 1. open anchor tag, 2. close anchor tag, 3. Woo version |
  | 2663 |  | #: woocommerce-pdf-invoices-packingslips.php:19~~3~~ |
  |  | 2663 | #: woocommerce-pdf-invoices-packingslips.php:194 |
  | 2664 | 2664 | msgid "PDF Invoices & Packing Slips for WooCommerce requires %1$sWooCommerce%2$s version %3$s or higher to be installed & activated!" |
  | 2665 | 2665 | msgstr "" |
  | 2666 | 2666 |  |
  | 2667 | 2667 | #. translators: PHP version |
  | 2668 |  | #: woocommerce-pdf-invoices-packingslips.php:23~~8~~ |
  |  | 2668 | #: woocommerce-pdf-invoices-packingslips.php:239 |
  | 2669 | 2669 | msgid "PDF Invoices & Packing Slips for WooCommerce requires PHP %s or higher." |
  | 2670 | 2670 | msgstr "" |
  | 2671 | 2671 |  |
  | 2672 | 2672 | #. translators: <a> tags |
  | 2673 |  | #: woocommerce-pdf-invoices-packingslips.php:24~~4~~ |
  |  | 2673 | #: woocommerce-pdf-invoices-packingslips.php:245 |
  | 2674 | 2674 | msgid "We strongly recommend to %1$supdate your PHP version%2$s." |
  | 2675 | 2675 | msgstr "" |
  | 2676 | 2676 |  |
  | 2677 | 2677 | #. translators: directory path |
  | 2678 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~6~~ |
  |  | 2678 | #: woocommerce-pdf-invoices-packingslips.php:337 |
  | 2679 | 2679 | msgid "The PDF files in %s are not currently protected due to your site running on <strong>NGINX</strong>." |
  | 2680 | 2680 | msgstr "" |
  | 2681 | 2681 |  |
  | 2682 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~7~~ |
  |  | 2682 | #: woocommerce-pdf-invoices-packingslips.php:338 |
  | 2683 | 2683 | msgid "To protect them, you must click the button below." |
  | 2684 | 2684 | msgstr "" |
  | 2685 | 2685 |  |
  | 2686 |  | #: woocommerce-pdf-invoices-packingslips.php:33~~8~~ |
  |  | 2686 | #: woocommerce-pdf-invoices-packingslips.php:339 |
  | 2687 | 2687 | msgid "Generate random temporary folder name" |
  | 2688 | 2688 | msgstr "" |
  | 2689 | 2689 |  |
  | 2690 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~5~~ |
  |  | 2690 | #: woocommerce-pdf-invoices-packingslips.php:396 |
  | 2691 | 2691 | msgid "When sending emails with MailPoet 3 and the active sending method is <strong>MailPoet Sending Service</strong> or <strong>Your web host / web server</strong>, MailPoet does not include the <strong>PDF Invoices & Packing Slips for WooCommerce</strong> attachments in the emails." |
  | 2692 | 2692 | msgstr "" |
  | 2693 | 2693 |  |
  | 2694 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~6~~ |
  |  | 2694 | #: woocommerce-pdf-invoices-packingslips.php:397 |
  | 2695 | 2695 | msgid "To fix this you should select <strong>The default WordPress sending method (default)</strong> on the <strong>Advanced tab</strong>." |
  | 2696 | 2696 | msgstr "" |
  | 2697 | 2697 |  |
  | 2698 |  | #: woocommerce-pdf-invoices-packingslips.php:39~~7~~ |
  |  | 2698 | #: woocommerce-pdf-invoices-packingslips.php:398 |
  | 2699 | 2699 | msgid "Change MailPoet sending method to WordPress (default)" |
  | 2700 | 2700 | msgstr "" |
  | 2701 | 2701 |  |
  | 2702 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~4~~ |
  |  | 2702 | #: woocommerce-pdf-invoices-packingslips.php:435 |
  | 2703 | 2703 | msgid "PDF Invoices & Packing Slips for WooCommerce detected that your current site locale is right-to-left (RTL) which the current PDF engine does not support it. Please consider installing our mPDF extension that is compatible." |
  | 2704 | 2704 | msgstr "" |
  | 2705 | 2705 |  |
  | 2706 |  | #: woocommerce-pdf-invoices-packingslips.php:43~~5~~ |
  |  | 2706 | #: woocommerce-pdf-invoices-packingslips.php:436 |
  | 2707 | 2707 | msgid "Download mPDF extension" |
  | 2708 | 2708 | msgstr "" |
  | 2709 | 2709 |  |
  | 2710 | 2710 | #. translators: legacy addon name |
  | 2711 |  | #: woocommerce-pdf-invoices-packingslips.php:52~~1~~ |
  |  | 2711 | #: woocommerce-pdf-invoices-packingslips.php:522 |
  | 2712 | 2712 | msgid "While updating the PDF Invoices & Packing Slips for WooCommerce plugin we've noticed our legacy %s add-on was active on your site. This functionality is now incorporated into the core plugin. We've deactivated the add-on for you, and you are free to uninstall it." |
  | 2713 | 2713 | msgstr "" |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/readme.txt](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/readme.txt")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L1 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === PDF Invoices & Packing Slips for WooCommerce === |
  | 2 |  | Contributors: pomegranate, alexmigf, yordansoares, kluver, dpeyou, dwpriv, ~~jhosagid~~ |
  |  | 2 | Contributors: pomegranate, alexmigf, yordansoares, kluver, dpeyou, dwpriv, mohamadntr |
  | 3 | 3 | Donate link: https://wpovernight.com/downloads/woocommerce-pdf-invoices-packing-slips-bundle/ |
  | 4 | 4 | Tags: woocommerce, pdf, ubl, invoices, packing slips |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L6) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3076105#L6) |  |
  | 6 | 6 | Tested up to: 6.5 |
  | 7 | 7 | Requires PHP: 7.2 |
  | 8 |  | Stable tag: 3.8.~~0~~ |
  |  | 8 | Stable tag: 3.8.1 |
  | 9 | 9 | License: GPLv2 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3053443#L102) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/readme.txt?rev=3076105#L102) |  |
  | 102 | 102 |  |
  | 103 | 103 | == Changelog == |
  |  | 104 |  |
  |  | 105 | = 3.8.1 (2024-04-23) = |
  |  | 106 | \* New: updates DOMPDF to `v2.0.7` |
  |  | 107 | \* New: adds `woocommerce` as required plugin |
  |  | 108 | \* New: improvements to shop logo to be translatable in future Professional extension version |
  |  | 109 | \* Fix: document date parse function being called on non HPOS stores |
  |  | 110 | \* Fix: replaces deprecated jQuery functions |
  |  | 111 | \* Fix: bug with type hint in `wpo\_wcpdf\_parse\_document\_date\_for\_wp\_query()` function |
  |  | 112 | \* Fix: bug calling `is\_allowed()` on `bool` under `wcpdf\_get\_document()` function |
  |  | 113 | \* Fix: not removing documents meta on Woo subcription renewal |
  |  | 114 | \* Fix: XSS vulnerability on Woo Checkout user input address data |
  |  | 115 | \* Fix: Semaphore attachments issue on concurrent refunds |
  |  | 116 | \* Translations: Updated translation template (POT) |
  |  | 117 | \* Tested up to WooCommerce 8.8 |
  | 104 | 118 |  |
  | 105 | 119 | = 3.8.0 (2024-03-18) = |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L168 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L168 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 168 | 168 |  |
  | 169 | 169 | foreach ( $vat\_meta\_keys as $meta\_key ) { |
  | 170 |  | if ( $vat\_number = $this->document->order->get\_meta( $meta\_key ) ) { |
  |  | 170 | $vat\_number = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_meta( $meta\_key ), 'vat\_number' ); |
  |  | 171 |  |
  |  | 172 | if ( $vat\_number ) { |
  | 171 | 173 | break; |
  | 172 | 174 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L174) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L176) |  |
  | 174 | 176 | } |
  | 175 | 177 |  |
  | 176 |  | $customerPartyName = $customerPartyContactName = ~~$this->document->order->get\_formatted\_billing\_full\_name(~~); |
  | 177 |  | $billing\_company   = ~~$this->document->order->get\_billing\_company(~~); |
  |  | 178 | $customerPartyName = $customerPartyContactName = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_formatted\_billing\_full\_name(), 'full\_name' ); |
  |  | 179 | $billing\_company   = wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_company(), 'company' ); |
  | 178 | 180 |  |
  | 179 | 181 | if ( ! empty( $billing\_company ) ) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L206) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L208) |  |
  | 206 | 208 | array( |
  | 207 | 209 | 'name'  => 'cbc:StreetName', |
  | 208 |  | 'value' => ~~$this->document->order->get\_billing\_address\_1(~~), |
  |  | 210 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_1(), 'address\_1' ), |
  | 209 | 211 | ), |
  | 210 | 212 | array( |
  | 211 | 213 | 'name'  => 'cbc:CityName', |
  | 212 |  | 'value' => ~~$this->document->order->get\_billing\_city(~~), |
  |  | 214 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_city(), 'city' ), |
  | 213 | 215 | ), |
  | 214 | 216 | array( |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L220) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L222) |  |
  | 220 | 222 | 'value' => array( |
  | 221 | 223 | 'name'  => 'cbc:Line', |
  | 222 |  | 'value' => ~~$this->document->order->get\_billing\_address\_1() .'<br/>'.$this->document->order->get\_billing\_address\_2(~~), |
  |  | 224 | 'value' => wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_1(), 'address\_1' ) . '<br/>' . wpo\_wcpdf\_sanitize\_html\_content( $this->document->order->get\_billing\_address\_2(), 'address\_2' ), |
  | 223 | 225 | ), |
  | 224 | 226 | ), |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=2980576#L267) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Handlers/Ubl/AddressHandler.php?rev=3076105#L269) |  |
  | 267 | 269 | array( |
  | 268 | 270 | 'name'  => 'cbc:ElectronicMail', |
  | 269 |  | 'value' => ~~$this->document->order->get\_billing\_email(~~), |
  |  | 271 | 'value' => sanitize\_email( $this->document->order->get\_billing\_email() ), |
  | 270 | 272 | ), |
  | 271 | 273 | ), |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php")

  | [r2980576](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=2980576#L16 "Show revision 2980576 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=3076105#L16 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 | public function transform( \WC\_Abstract\_Order $item, $billing\_or\_shipping ) { |
  | 17 | 17 | $model             = new Address(); |
  | 18 |  | $model->address\_1  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_address\_1'}(~~); |
  | 19 |  | $model->address\_2  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_address\_2'}(~~); |
  | 20 |  | $model->first\_name = ~~$item->{'get\_'.$billing\_or\_shipping.'\_first\_name'}(~~); |
  | 21 |  | $model->last\_name  = ~~$item->{'get\_'.$billing\_or\_shipping.'\_last\_name'}(~~); |
  | 22 |  | $model->city       = ~~$item->{'get\_'.$billing\_or\_shipping.'\_city'}(~~); |
  |  | 18 | $model->address\_1  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_address\_1'}(), 'address\_1' ); |
  |  | 19 | $model->address\_2  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_address\_2'}(), 'address\_2' ); |
  |  | 20 | $model->first\_name = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_first\_name'}(), 'first\_name' ); |
  |  | 21 | $model->last\_name  = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_last\_name'}(), 'last\_name' ); |
  |  | 22 | $model->city       = wpo\_wcpdf\_sanitize\_html\_content( $item->{'get\_'.$billing\_or\_shipping.'\_city'}(), 'city' ); |
  | 23 | 23 | $model->state      = $item->{'get\_'.$billing\_or\_shipping.'\_state'}(); |
  | 24 | 24 | $model->postcode   = $item->{'get\_'.$billing\_or\_shipping.'\_postcode'}(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=2980576#L26) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=3076105#L26) |  |
  | 26 | 26 |  |
  | 27 | 27 | if ( 'billing' === $billing\_or\_shipping ) { |
  | 28 |  | $model->email = ~~$item->get\_billing\_email(~~); |
  | 29 |  | $model->phone = ~~$item->get\_billing\_phone(~~); |
  |  | 28 | $model->email = sanitize\_email( $item->get\_billing\_email() ); |
  |  | 29 | $model->phone = wpo\_wcpdf\_sanitize\_phone\_number( $item->get\_billing\_phone() ); |
  | 30 | 30 | } |
  | 31 | 31 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L3 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L3 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | { |
  | 4 | 4 | "name": "dompdf/dompdf", |
  | 5 |  | "version": "v2.0.~~4~~", |
  | 6 |  | "version\_normalized": "2.0.~~4~~.0", |
  |  | 5 | "version": "v2.0.7", |
  |  | 6 | "version\_normalized": "2.0.7.0", |
  | 7 | 7 | "source": { |
  | 8 | 8 | "type": "git", |
  | 9 | 9 | "url": "https://github.com/dompdf/dompdf.git", |
  | 10 |  | "reference": "~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~" |
  | 11 |  | }, |
  | 12 |  | "dist": { |
  | 13 |  | "type": "zip", |
  | 14 |  | "url": "https://api.github.com/repos/dompdf/dompdf/zipball/~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~", |
  | 15 |  | "reference": "~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~", |
  |  | 10 | "reference": "ab0123052b42ad0867348f25df8c228f1ece8f14" |
  |  | 11 | }, |
  |  | 12 | "dist": { |
  |  | 13 | "type": "zip", |
  |  | 14 | "url": "https://api.github.com/repos/dompdf/dompdf/zipball/ab0123052b42ad0867348f25df8c228f1ece8f14", |
  |  | 15 | "reference": "ab0123052b42ad0867348f25df8c228f1ece8f14", |
  | 16 | 16 | "shasum": "" |
  | 17 | 17 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L21) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L21) |  |
  | 21 | 21 | "masterminds/html5": "^2.0", |
  | 22 | 22 | "phenx/php-font-lib": ">=0.5.4 <1.0.0", |
  | 23 |  | "phenx/php-svg-lib": ">=0.~~3.3~~ <1.0.0", |
  |  | 23 | "phenx/php-svg-lib": ">=0.5.2 <1.0.0", |
  | 24 | 24 | "php": "^7.1 || ^8.0" |
  | 25 | 25 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L37) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L37) |  |
  | 37 | 37 | "ext-zlib": "Needed for pdf stream compression" |
  | 38 | 38 | }, |
  | 39 |  | "time": "202~~3-12-12T20:19:39~~+00:00", |
  |  | 39 | "time": "2024-04-15T12:40:33+00:00", |
  | 40 | 40 | "type": "library", |
  | 41 | 41 | "installation-source": "dist", |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L62) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L62) |  |
  | 62 | 62 | "support": { |
  | 63 | 63 | "issues": "https://github.com/dompdf/dompdf/issues", |
  | 64 |  | "source": "https://github.com/dompdf/dompdf/tree/v2.0.~~4~~" |
  |  | 64 | "source": "https://github.com/dompdf/dompdf/tree/v2.0.7" |
  | 65 | 65 | }, |
  | 66 | 66 | "install-path": "../dompdf/dompdf" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L68) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L68) |  |
  | 68 | 68 | { |
  | 69 | 69 | "name": "masterminds/html5", |
  | 70 |  | "version": "2.~~8.1~~", |
  | 71 |  | "version\_normalized": "2.~~8.1~~.0", |
  |  | 70 | "version": "2.9.0", |
  |  | 71 | "version\_normalized": "2.9.0.0", |
  | 72 | 72 | "source": { |
  | 73 | 73 | "type": "git", |
  | 74 | 74 | "url": "https://github.com/Masterminds/html5-php.git", |
  | 75 |  | "reference": "f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~" |
  | 76 |  | }, |
  | 77 |  | "dist": { |
  | 78 |  | "type": "zip", |
  | 79 |  | "url": "https://api.github.com/repos/Masterminds/html5-php/zipball/f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~", |
  | 80 |  | "reference": "f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~", |
  |  | 75 | "reference": "f5ac2c0b0a2eefca70b2ce32a5809992227e75a6" |
  |  | 76 | }, |
  |  | 77 | "dist": { |
  |  | 78 | "type": "zip", |
  |  | 79 | "url": "https://api.github.com/repos/Masterminds/html5-php/zipball/f5ac2c0b0a2eefca70b2ce32a5809992227e75a6", |
  |  | 80 | "reference": "f5ac2c0b0a2eefca70b2ce32a5809992227e75a6", |
  | 81 | 81 | "shasum": "" |
  | 82 | 82 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L86) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L86) |  |
  | 86 | 86 | }, |
  | 87 | 87 | "require-dev": { |
  | 88 |  | "phpunit/phpunit": "^4.8.35 || ^5.7.21 || ^6 || ^7 || ^8" |
  | 89 |  | }, |
  | 90 |  | "time": "202~~3-05-10T11:58:31~~+00:00", |
  |  | 88 | "phpunit/phpunit": "^4.8.35 || ^5.7.21 || ^6 || ^7 || ^8 || ^9" |
  |  | 89 | }, |
  |  | 90 | "time": "2024-03-31T07:05:07+00:00", |
  | 91 | 91 | "type": "library", |
  | 92 | 92 | "extra": { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L132) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L132) |  |
  | 132 | 132 | "support": { |
  | 133 | 133 | "issues": "https://github.com/Masterminds/html5-php/issues", |
  | 134 |  | "source": "https://github.com/Masterminds/html5-php/tree/2.~~8.1~~" |
  |  | 134 | "source": "https://github.com/Masterminds/html5-php/tree/2.9.0" |
  | 135 | 135 | }, |
  | 136 | 136 | "install-path": "../masterminds/html5" |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L185) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L185) |  |
  | 185 | 185 | { |
  | 186 | 186 | "name": "phenx/php-svg-lib", |
  | 187 |  | "version": "0.5.~~2~~", |
  | 188 |  | "version\_normalized": "0.5.~~2~~.0", |
  |  | 187 | "version": "0.5.4", |
  |  | 188 | "version\_normalized": "0.5.4.0", |
  | 189 | 189 | "source": { |
  | 190 | 190 | "type": "git", |
  | 191 | 191 | "url": "https://github.com/dompdf/php-svg-lib.git", |
  | 192 |  | "reference": "~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~" |
  | 193 |  | }, |
  | 194 |  | "dist": { |
  | 195 |  | "type": "zip", |
  | 196 |  | "url": "https://api.github.com/repos/dompdf/php-svg-lib/zipball/~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~", |
  | 197 |  | "reference": "~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~", |
  |  | 192 | "reference": "46b25da81613a9cf43c83b2a8c2c1bdab27df691" |
  |  | 193 | }, |
  |  | 194 | "dist": { |
  |  | 195 | "type": "zip", |
  |  | 196 | "url": "https://api.github.com/repos/dompdf/php-svg-lib/zipball/46b25da81613a9cf43c83b2a8c2c1bdab27df691", |
  |  | 197 | "reference": "46b25da81613a9cf43c83b2a8c2c1bdab27df691", |
  | 198 | 198 | "shasum": "" |
  | 199 | 199 | }, |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L206) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L206) |  |
  | 206 | 206 | "phpunit/phpunit": "^7.5 || ^8.5 || ^9.5" |
  | 207 | 207 | }, |
  | 208 |  | "time": "2024-0~~2-07T12:49:40~~+00:00", |
  |  | 208 | "time": "2024-04-08T12:52:34+00:00", |
  | 209 | 209 | "type": "library", |
  | 210 | 210 | "installation-source": "dist", |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L216) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L216) |  |
  | 216 | 216 | "notification-url": "https://packagist.org/downloads/", |
  | 217 | 217 | "license": [ |
  | 218 |  | "LGPL-3.0" |
  |  | 218 | "LGPL-3.0-or-later" |
  | 219 | 219 | ], |
  | 220 | 220 | "authors": [ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3053443#L228) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.json?rev=3076105#L228) |  |
  | 228 | 228 | "support": { |
  | 229 | 229 | "issues": "https://github.com/dompdf/php-svg-lib/issues", |
  | 230 |  | "source": "https://github.com/dompdf/php-svg-lib/tree/0.5.~~2~~" |
  |  | 230 | "source": "https://github.com/dompdf/php-svg-lib/tree/0.5.4" |
  | 231 | 231 | }, |
  | 232 | 232 | "install-path": "../phenx/php-svg-lib" |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L4 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105#L4 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | 'pretty\_version' => 'dev-main', |
  | 5 | 5 | 'version' => 'dev-main', |
  | 6 |  | 'reference' => '~~faa4cf55049ee76b934da9d692c074f2f0ea3fe2~~', |
  |  | 6 | 'reference' => 'bac99d938a07f16dbb50c11804f497182886b4a8', |
  | 7 | 7 | 'type' => 'library', |
  | 8 | 8 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L12) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105#L12) |  |
  | 12 | 12 | 'versions' => array( |
  | 13 | 13 | 'dompdf/dompdf' => array( |
  | 14 |  | 'pretty\_version' => 'v2.0.~~4~~', |
  | 15 |  | 'version' => '2.0.~~4~~.0', |
  | 16 |  | 'reference' => '~~093f2d9739cec57428e39ddadedfd4f3ae862c0f~~', |
  |  | 14 | 'pretty\_version' => 'v2.0.7', |
  |  | 15 | 'version' => '2.0.7.0', |
  |  | 16 | 'reference' => 'ab0123052b42ad0867348f25df8c228f1ece8f14', |
  | 17 | 17 | 'type' => 'library', |
  | 18 | 18 | 'install\_path' => \_\_DIR\_\_ . '/../dompdf/dompdf', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L21) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105#L21) |  |
  | 21 | 21 | ), |
  | 22 | 22 | 'masterminds/html5' => array( |
  | 23 |  | 'pretty\_version' => '2.~~8.1~~', |
  | 24 |  | 'version' => '2.~~8.1~~.0', |
  | 25 |  | 'reference' => 'f~~47dcf3c70c584de14f21143c55d9939631bc6cf~~', |
  |  | 23 | 'pretty\_version' => '2.9.0', |
  |  | 24 | 'version' => '2.9.0.0', |
  |  | 25 | 'reference' => 'f5ac2c0b0a2eefca70b2ce32a5809992227e75a6', |
  | 26 | 26 | 'type' => 'library', |
  | 27 | 27 | 'install\_path' => \_\_DIR\_\_ . '/../masterminds/html5', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L39) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105#L39) |  |
  | 39 | 39 | ), |
  | 40 | 40 | 'phenx/php-svg-lib' => array( |
  | 41 |  | 'pretty\_version' => '0.5.~~2~~', |
  | 42 |  | 'version' => '0.5.~~2~~.0', |
  | 43 |  | 'reference' => '~~732faa9fb4309221e2bd9b2fda5de44f947133aa~~', |
  |  | 41 | 'pretty\_version' => '0.5.4', |
  |  | 42 | 'version' => '0.5.4.0', |
  |  | 43 | 'reference' => '46b25da81613a9cf43c83b2a8c2c1bdab27df691', |
  | 44 | 44 | 'type' => 'library', |
  | 45 | 45 | 'install\_path' => \_\_DIR\_\_ . '/../phenx/php-svg-lib', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3053443#L95) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/composer/installed.php?rev=3076105#L95) |  |
  | 95 | 95 | 'pretty\_version' => 'dev-main', |
  | 96 | 96 | 'version' => 'dev-main', |
  | 97 |  | 'reference' => '~~faa4cf55049ee76b934da9d692c074f2f0ea3fe2~~', |
  |  | 97 | 'reference' => 'bac99d938a07f16dbb50c11804f497182886b4a8', |
  | 98 | 98 | 'type' => 'library', |
  | 99 | 99 | 'install\_path' => \_\_DIR\_\_ . '/../../', |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION?rev=3019205#L1 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/VERSION?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | 2.0.~~4~~ |
  |  | 1 | 2.0.7 |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php")

  | [r2860919](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=2860919#L468 "Show revision 2860919 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105#L468 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 468 | 468 |  |
  | 469 | 469 | if ($c === IMG\_COLOR\_STYLED) { |
  | 470 |  | ~~imagepolygon($this->get\_image(),~~ [ |
  |  | 470 | $points = [ |
  | 471 | 471 | $x1, $y1, |
  | 472 | 472 | $x1 + $w, $y1, |
  | 473 | 473 | $x1 + $w, $y1 + $h, |
  | 474 | 474 | $x1, $y1 + $h |
  | 475 |  | ], $c); |
  |  | 475 | ]; |
  |  | 476 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 477 | imagepolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 478 | } else { |
  |  | 479 | imagepolygon($this->get\_image(), $points, $c); |
  |  | 480 | } |
  | 476 | 481 | } else { |
  | 477 | 482 | imagerectangle($this->get\_image(), $x1, $y1, $x1 + $w, $y1 + $h, $c); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=2860919#L571) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Adapter/GD.php?rev=3076105#L576) |  |
  | 571 | 576 |  |
  | 572 | 577 | if ($fill) { |
  | 573 |  | imagefilledpolygon($this->get\_image(), $points, $c); |
  |  | 578 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 579 | imagefilledpolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 580 | } else { |
  |  | 581 | imagefilledpolygon($this->get\_image(), $points, $c); |
  |  | 582 | } |
  | 574 | 583 | } else { |
  | 575 |  | imagepolygon($this->get\_image(), $points, $c); |
  |  | 584 | if (version\_compare(PHP\_VERSION, "8.1.0", "<")) { |
  |  | 585 | imagepolygon($this->get\_image(), $points, count($points)/2, $c); |
  |  | 586 | } else { |
  |  | 587 | imagepolygon($this->get\_image(), $points, $c); |
  |  | 588 | } |
  | 576 | 589 | } |
  | 577 | 590 | } |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php")

  | [r2860919](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L85 "Show revision 2860919 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L85 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 |  |
  | 86 | 86 | /\*\* |
  |  | 87 | \* Operational artifact (log files, temporary files) path validation |
  |  | 88 | \* |
  |  | 89 | \* @var callable |
  |  | 90 | \*/ |
  |  | 91 | private $artifactPathValidation = null; |
  |  | 92 |  |
  |  | 93 | /\*\* |
  | 87 | 94 | \* @var string |
  | 88 | 95 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L335) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L342) |  |
  | 335 | 342 |  |
  | 336 | 343 | $this->setAllowedProtocols(["file://", "http://", "https://"]); |
  |  | 344 |  |
  |  | 345 | $this->setArtifactPathValidation([$this, "validateArtifactPath"]); |
  | 337 | 346 |  |
  | 338 | 347 | if (null !== $attributes) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L362) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L371) |  |
  | 362 | 371 | } elseif ($key === 'allowedProtocols') { |
  | 363 | 372 | $this->setAllowedProtocols($value); |
  |  | 373 | } elseif ($key === 'artifactPathValidation') { |
  |  | 374 | $this->setArtifactPathValidation($value); |
  | 364 | 375 | } elseif ($key === 'logOutputFile' || $key === 'log\_output\_file') { |
  | 365 | 376 | $this->setLogOutputFile($value); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L429) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L440) |  |
  | 429 | 440 | } elseif ($key === 'allowedProtocols') { |
  | 430 | 441 | return $this->getAllowedProtocols(); |
  |  | 442 | } elseif ($key === 'artifactPathValidation') { |
  |  | 443 | return $this->getArtifactPathValidation(); |
  | 431 | 444 | } elseif ($key === 'logOutputFile' || $key === 'log\_output\_file') { |
  | 432 | 445 | return $this->getLogOutputFile(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L596) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L609) |  |
  | 596 | 609 | \* @return array |
  | 597 | 610 | \*/ |
  |  | 611 | public function getArtifactPathValidation() |
  |  | 612 | { |
  |  | 613 | return $this->artifactPathValidation; |
  |  | 614 | } |
  |  | 615 |  |
  |  | 616 | /\*\* |
  |  | 617 | \* @param callable $validator |
  |  | 618 | \* @return $this |
  |  | 619 | \*/ |
  |  | 620 | public function setArtifactPathValidation($validator) |
  |  | 621 | { |
  |  | 622 | $this->artifactPathValidation = $validator; |
  |  | 623 | return $this; |
  |  | 624 | } |
  |  | 625 |  |
  |  | 626 | /\*\* |
  |  | 627 | \* @return array |
  |  | 628 | \*/ |
  | 598 | 629 | public function getChroot() |
  | 599 | 630 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L849) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L880) |  |
  | 849 | 880 | public function setFontCache($fontCache) |
  | 850 | 881 | { |
  | 851 |  | $this->fontCache = $fontCache; |
  |  | 882 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($fontCache, "fontCache") === true) { |
  |  | 883 | $this->fontCache = $fontCache; |
  |  | 884 | } |
  | 852 | 885 | return $this; |
  | 853 | 886 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L867) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L900) |  |
  | 867 | 900 | public function setFontDir($fontDir) |
  | 868 | 901 | { |
  | 869 |  | $this->fontDir = $fontDir; |
  |  | 902 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($fontDir, "fontDir") === true) { |
  |  | 903 | $this->fontDir = $fontDir; |
  |  | 904 | } |
  | 870 | 905 | return $this; |
  | 871 | 906 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1036) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1071) |  |
  | 1036 | 1071 | public function setLogOutputFile($logOutputFile) |
  | 1037 | 1072 | { |
  | 1038 |  | $this->logOutputFile = $logOutputFile; |
  |  | 1073 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($logOutputFile, "logOutputFile") === true) { |
  |  | 1074 | $this->logOutputFile = $logOutputFile; |
  |  | 1075 | } |
  | 1039 | 1076 | return $this; |
  | 1040 | 1077 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1054) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1091) |  |
  | 1054 | 1091 | public function setTempDir($tempDir) |
  | 1055 | 1092 | { |
  | 1056 |  | $this->tempDir = $tempDir; |
  |  | 1093 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($tempDir, "tempDir") === true) { |
  |  | 1094 | $this->tempDir = $tempDir; |
  |  | 1095 | } |
  | 1057 | 1096 | return $this; |
  | 1058 | 1097 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1072) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1111) |  |
  | 1072 | 1111 | public function setRootDir($rootDir) |
  | 1073 | 1112 | { |
  | 1074 |  | $this->rootDir = $rootDir; |
  |  | 1113 | if (!is\_callable($this->artifactPathValidation) || ($this->artifactPathValidation)($rootDir, "rootDir") === true) { |
  |  | 1114 | $this->rootDir = $rootDir; |
  |  | 1115 | } |
  | 1075 | 1116 | return $this; |
  | 1076 | 1117 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=2860919#L1104) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/dompdf/dompdf/src/Options.php?rev=3076105#L1145) |  |
  | 1104 | 1145 | { |
  | 1105 | 1146 | return $this->httpContext; |
  |  | 1147 | } |
  |  | 1148 |  |
  |  | 1149 |  |
  |  | 1150 | public function validateArtifactPath(?string $path, string $option) |
  |  | 1151 | { |
  |  | 1152 | $parsed\_uri = parse\_url($path); |
  |  | 1153 | if ($parsed\_uri === false || (array\_key\_exists("scheme", $parsed\_uri) && strtolower($parsed\_uri["scheme"]) === "phar")) { |
  |  | 1154 | return false; |
  |  | 1155 | } |
  |  | 1156 | return true; |
  | 1106 | 1157 | } |
  | 1107 | 1158 |  |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md")

  | [r2929370](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md?rev=2929370#L31 "Show revision 2929370 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/README.md?rev=3076105#L31 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 31 | 31 | - Runs on \*\*PHP\*\* 5.3.0 or newer |
  | 32 | 32 |  |
  | 33 |  | [![~~Build Status](https://travis-ci.org/Masterminds/html5-php.png?branch=master)](https://travis-ci.org/Masterminds/html5-php~~) |
  |  | 33 | [![CI](https://github.com/Masterminds/html5-php/actions/workflows/ci.yaml/badge.svg)](https://github.com/Masterminds/html5-php/actions/workflows/ci.yaml) |
  | 34 | 34 | [![Latest Stable Version](https://poser.pugx.org/masterminds/html5/v/stable.png)](https://packagist.org/packages/masterminds/html5) |
  | 35 | 35 | [![Code Coverage](https://scrutinizer-ci.com/g/Masterminds/html5-php/badges/coverage.png?b=master)](https://scrutinizer-ci.com/g/Masterminds/html5-php/?branch=master) |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php")

  | [r2929370](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php?rev=2929370#L71 "Show revision 2929370 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Elements.php?rev=3076105#L71 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 71 | 71 | \*/ |
  | 72 | 72 | const BLOCK\_ONLY\_INLINE = 128; |
  |  | 73 |  |
  |  | 74 | /\*\* |
  |  | 75 | \* Elements with optional end tags that cause auto-closing of previous and parent tags, |
  |  | 76 | \* as example most of the table related tags, see https://www.w3.org/TR/html401/struct/tables.html |
  |  | 77 | \* Structure is as follows: |
  |  | 78 | \* TAG-NAME => [PARENT-TAG-NAME-TO-CLOSE1, PARENT-TAG-NAME-TO-CLOSE2, ...]. |
  |  | 79 | \* |
  |  | 80 | \* Order is important, after auto-closing one parent with might have to close also their parent. |
  |  | 81 | \* |
  |  | 82 | \* @var array<string, string[]> |
  |  | 83 | \*/ |
  |  | 84 | public static $optionalEndElementsParentsToClose = array( |
  |  | 85 | 'tr' => array('td', 'tr'), |
  |  | 86 | 'td' => array('td', 'th'), |
  |  | 87 | 'th' => array('td', 'th'), |
  |  | 88 | 'tfoot' => array('td', 'th', 'tr', 'tbody', 'thead'), |
  |  | 89 | 'tbody' => array('td', 'th', 'tr', 'thead'), |
  |  | 90 | ); |
  | 73 | 91 |  |
  | 74 | 92 | /\*\* |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=2790488#L360 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/DOMTreeBuilder.php?rev=3076105#L360 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 360 | 360 | } |
  | 361 | 361 |  |
  |  | 362 | // some elements as table related tags might have optional end tags that force us to auto close multiple tags |
  |  | 363 | // https://www.w3.org/TR/html401/struct/tables.html |
  |  | 364 | if ($this->current instanceof \DOMElement && isset(Elements::$optionalEndElementsParentsToClose[$lname])) { |
  |  | 365 | foreach (Elements::$optionalEndElementsParentsToClose[$lname] as $parentElName) { |
  |  | 366 | if ($this->current instanceof \DOMElement && $this->current->tagName === $parentElName) { |
  |  | 367 | $this->autoclose($parentElName); |
  |  | 368 | } |
  |  | 369 | } |
  |  | 370 | } |
  |  | 371 |  |
  | 362 | 372 | try { |
  | 363 | 373 | $prefix = ($pos = strpos($lname, ':')) ? substr($lname, 0, $pos) : ''; |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L184 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L184 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 184 | 184 | \* @return string The current character. |
  | 185 | 185 | \*/ |
  |  | 186 | #[\ReturnTypeWillChange] |
  | 186 | 187 | public function current() |
  | 187 | 188 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L193) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L194) |  |
  | 193 | 194 | \* This is part of the Iterator interface. |
  | 194 | 195 | \*/ |
  |  | 196 | #[\ReturnTypeWillChange] |
  | 195 | 197 | public function next() |
  | 196 | 198 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L201) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L203) |  |
  | 201 | 203 | \* Rewind to the start of the string. |
  | 202 | 204 | \*/ |
  |  | 205 | #[\ReturnTypeWillChange] |
  | 203 | 206 | public function rewind() |
  | 204 | 207 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L211) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L214) |  |
  | 211 | 214 | \* @return bool Whether the current pointer location is valid. |
  | 212 | 215 | \*/ |
  |  | 216 | #[\ReturnTypeWillChange] |
  | 213 | 217 | public function valid() |
  | 214 | 218 | { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=2790488#L325) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/masterminds/html5/src/HTML5/Parser/StringInputStream.php?rev=3076105#L329) |  |
  | 325 | 329 | } |
  | 326 | 330 |  |
  |  | 331 | #[\ReturnTypeWillChange] |
  | 327 | 332 | public function key() |
  | 328 | 333 | { |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=2790488#L1 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=3076105#L1 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | # SVG file parsing / rendering library |
  | 2 | 2 |  |
  | 3 |  | [![Build Status](https://github.com/phenx/php-svg-lib/workflows/test/badge.svg)](https://github.com/phenx/php-svg-lib/actions) |
  | 4 |  |  |
  |  | 3 | [![Build Status](https://github.com/dompdf/php-svg-lib/actions/workflows/test.yml/badge.svg)](https://github.com/dompdf/php-svg-lib/actions/workflows/test.yml) |
  | 5 | 4 |  |
  | 6 | 5 | [![Latest Stable Version](https://poser.pugx.org/phenx/php-svg-lib/v/stable)](https://packagist.org/packages/phenx/php-svg-lib) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=2790488#L11) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/README.md?rev=3076105#L10) |  |
  | 11 | 10 | The main purpose of this lib is to rasterize SVG to a surface which can be an image or a PDF for example, through a `\Svg\Surface` PHP interface. |
  | 12 | 11 |  |
  | 13 |  | This project was initialized by the need to render SVG documents inside PDF files for the [DomPdf](http~~://dompdf.github.io~~) project. |
  |  | 12 | This project was initialized by the need to render SVG documents inside PDF files for the [DomPdf](https://github.com/dompdf/dompdf) project. |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L24 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L24 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 24 | 24 | use Svg\Tag\Rect; |
  | 25 | 25 | use Svg\Tag\Stop; |
  |  | 26 | use Svg\Tag\Symbol; |
  | 26 | 27 | use Svg\Tag\Text; |
  | 27 | 28 | use Svg\Tag\StyleTag; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L31) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L32) |  |
  | 31 | 32 | { |
  | 32 | 33 | protected $filename; |
  |  | 34 | protected $\_defs\_depth = 0; |
  | 33 | 35 | public $inDefs = false; |
  | 34 | 36 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L82) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L84) |  |
  | 82 | 84 |  |
  | 83 | 85 | /\*\* |
  |  | 86 | \* Increase the nesting level for defs-like elements |
  |  | 87 | \* |
  |  | 88 | \* @return int |
  |  | 89 | \*/ |
  |  | 90 | public function enterDefs () { |
  |  | 91 | $this->\_defs\_depth++; |
  |  | 92 | $this->inDefs = true; |
  |  | 93 | return $this->\_defs\_depth; |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | /\*\* |
  |  | 97 | \* Decrease the nesting level for defs-like elements |
  |  | 98 | \* |
  |  | 99 | \* @return int |
  |  | 100 | \*/ |
  |  | 101 | public function exitDefs () { |
  |  | 102 | $this->\_defs\_depth--; |
  |  | 103 | if ($this->\_defs\_depth < 0) { |
  |  | 104 | $this->\_defs\_depth = 0; |
  |  | 105 | } |
  |  | 106 | $this->inDefs = ($this->\_defs\_depth > 0 ? true : false); |
  |  | 107 | return $this->\_defs\_depth; |
  |  | 108 | } |
  |  | 109 |  |
  |  | 110 | /\*\* |
  | 84 | 111 | \* @return SurfaceInterface |
  | 85 | 112 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L134) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L161) |  |
  | 134 | 161 | } |
  | 135 | 162 | } |
  |  | 163 | xml\_parse($parser, "", true); |
  | 136 | 164 |  |
  | 137 | 165 | xml\_parser\_free($parser); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L214) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L242) |  |
  | 214 | 242 | public function render(SurfaceInterface $surface) |
  | 215 | 243 | { |
  |  | 244 | $this->\_defs\_depth = 0; |
  | 216 | 245 | $this->inDefs = false; |
  | 217 | 246 | $this->surface = $surface; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L257) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L286) |  |
  | 257 | 286 | switch (strtolower($name)) { |
  | 258 | 287 | case 'defs': |
  | 259 |  | $this->~~inDefs = true~~; |
  |  | 288 | $this->enterDefs(); |
  | 260 | 289 | return; |
  | 261 | 290 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L323) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L352) |  |
  | 323 | 352 |  |
  | 324 | 353 | case 'g': |
  |  | 354 | $tag = new Group($this, $name); |
  |  | 355 | break; |
  |  | 356 |  |
  | 325 | 357 | case 'symbol': |
  | 326 |  | $tag = new Group($this, $name); |
  | 327 |  | break; |
  | 328 |  |  |
  |  | 358 | $this->enterDefs(); |
  |  | 359 | $tag = new Symbol($this, $name); |
  |  | 360 | break; |
  |  | 361 |  |
  | 329 | 362 | case 'clippath': |
  | 330 | 363 | $tag = new ClipPath($this, $name); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L376) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L409) |  |
  | 376 | 409 | switch (strtolower($name)) { |
  | 377 | 410 | case 'defs': |
  | 378 |  | $this->~~inDefs = false~~; |
  |  | 411 | $this->exitDefs(); |
  | 379 | 412 | return; |
  | 380 | 413 |  |
  |  | 414 | case 'symbol': |
  |  | 415 | $this->exitDefs(); |
  |  | 416 | $tag = array\_pop($this->stack); |
  |  | 417 | break; |
  |  | 418 |  |
  | 381 | 419 | case 'svg': |
  | 382 | 420 | case 'path': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L394) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L432) |  |
  | 394 | 432 | case 'text': |
  | 395 | 433 | case 'g': |
  | 396 |  | ~~case 'symbol':~~ |
  | 397 | 434 | case 'clippath': |
  | 398 | 435 | case 'use': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3053443#L402) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Document.php?rev=3076105#L439) |  |
  | 402 | 439 | } |
  | 403 | 440 |  |
  | 404 |  | if (~~!$this->inDefs && $t~~ag) { |
  |  | 441 | if ((!$this->inDefs && $tag) || $tag instanceof StyleTag) { |
  | 405 | 442 | $tag->handleEnd(); |
  | 406 | 443 | } |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L170 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L170 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 170 | 170 | } |
  | 171 | 171 | } |
  | 172 |  | if (~~$value !== null && $value[3] !== 1~~ && array\_key\_exists("{$from}-opacity", $style\_map) === true) { |
  |  | 172 | if (is\_array($value) && $value[3] !== 1.0 && array\_key\_exists("{$from}-opacity", $style\_map) === true) { |
  | 173 | 173 | $styles["{$from}-opacity"] = $value[3]; |
  | 174 | 174 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L220) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L220) |  |
  | 220 | 220 | } |
  | 221 | 221 |  |
  |  | 222 | if ($color === "transparent") { |
  |  | 223 | return [0.0, 0.0, 0.0, 0.0]; |
  |  | 224 | } |
  |  | 225 |  |
  | 222 | 226 | // SVG color name |
  | 223 | 227 | if (isset(self::$colorNames[$color])) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L235) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L239) |  |
  | 235 | 239 | } |
  | 236 | 240 |  |
  | 237 |  | // ~~RGB~~ color |
  |  | 241 | // HSL color |
  | 238 | 242 | if (strpos($color, "hsl") !== false) { |
  | 239 | 243 | $quad = self::getQuad($color, true); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L312) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L316) |  |
  | 312 | 316 | } |
  | 313 | 317 |  |
  | 314 |  | return trim(substr($color, $i + 1, $j - $i - 1)); |
  |  | 318 | //FIXME: gradients not supported? |
  |  | 319 | return null; // trim(substr($color, $i + 1, $j - $i - 1)); |
  | 315 | 320 | } |
  | 316 | 321 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L329) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L334) |  |
  | 329 | 334 | $quad = preg\_split("/\\s\*[,\\/]\\s\*/", trim(substr($color, $i + 1, $j - $i - 1))); |
  | 330 | 335 | if (!isset($quad[3])) { |
  | 331 |  | $quad[3] = ~~1~~; |
  |  | 336 | $quad[3] = "1"; |
  | 332 | 337 | } |
  | 333 | 338 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L343) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L348) |  |
  | 343 | 348 | $quad[$c] = floatval($quad[$c]) / 100; |
  | 344 | 349 | } else { |
  | 345 |  | $quad[$c] = ~~$quad[$c]~~ / 255; |
  |  | 350 | $quad[$c] = floatval($quad[$c]) / 255; |
  | 346 | 351 | } |
  | 347 | 352 | } else { |
  | 348 | 353 | if ($quad[$c][strlen($quad[$c]) - 1] === "%") { |
  | 349 |  | $quad[$c] = round(floatval($quad[$c]) \* 2.55); |
  |  | 354 | $quad[$c] = floatval($quad[$c]) \* 2.55; |
  |  | 355 | } else { |
  |  | 356 | $quad[$c] = floatval($quad[$c]); |
  | 350 | 357 | } |
  | 351 | 358 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3053443#L357) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Style.php?rev=3076105#L364) |  |
  | 357 | 364 | static function parseHexColor($hex) |
  | 358 | 365 | { |
  | 359 |  | $c = array(0~~, 0, 0, 1~~); |
  |  | 366 | $c = array(0.0, 0.0, 0.0, 1.0); |
  | 360 | 367 |  |
  | 361 | 368 | // #FFFFFF |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1045 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1045 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 1045 | 1045 | } |
  | 1046 | 1046 |  |
  | 1047 |  | return 'SUB' . str\_pad($base\_26, 3, 'A', STR\_PAD\_LEFT); |
  |  | 1047 | return 'SUB' . str\_pad($base\_26, 3, 'A', STR\_PAD\_LEFT); |
  | 1048 | 1048 | } |
  | 1049 | 1049 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1315) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1315) |  |
  | 1315 | 1315 | $res = "\n$id 0 obj\n"; |
  | 1316 | 1316 | $res .= "<</Length " . mb\_strlen($stream, '8bit') . " >>\n"; |
  | 1317 |  | $res .= "stream\n" . $stream . "\nendstream" . "\nendobj";~~;~~ |
  |  | 1317 | $res .= "stream\n" . $stream . "\nendstream" . "\nendobj"; |
  | 1318 | 1318 |  |
  | 1319 | 1319 | return $res; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1725) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1725) |  |
  | 1725 | 1725 | // dates must be outputted as-is, without Unicode transformations |
  | 1726 | 1726 | if ($k !== 'CreationDate' && $k !== 'ModDate') { |
  | 1727 |  | $v = $this->~~filterText($v, true, false~~); |
  |  | 1727 | $v = $this->utf8toUtf16BE($v); |
  | 1728 | 1728 | } |
  | 1729 | 1729 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L1732) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L1732) |  |
  | 1732 | 1732 | } |
  | 1733 | 1733 |  |
  | 1734 |  | $res .= $~~v~~; |
  |  | 1734 | $res .= $this->filterText($v, false, false); |
  | 1735 | 1735 | $res .= ")\n"; |
  | 1736 | 1736 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2357) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2357) |  |
  | 2357 | 2357 |  |
  | 2358 | 2358 | foreach ($o["info"] as $k => $v) { |
  | 2359 |  | switch($k) |
  | 2360 |  | { |
  |  | 2359 | switch ($k) { |
  | 2361 | 2360 | case 'Subtype': |
  | 2362 | 2361 | $res .= "/Subtype /$v\n"; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2411) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2410) |  |
  | 2411 | 2410 |  |
  | 2412 | 2411 | $res .= "/Length " . mb\_strlen($tmp, '8bit') . " >>\n"; |
  | 2413 |  | $res .= "stream\n" . $tmp . "\nendstream" . "\nendobj";~~;~~ |
  |  | 2412 | $res .= "stream\n" . $tmp . "\nendstream" . "\nendobj"; |
  | 2414 | 2413 |  |
  | 2415 | 2414 | return $res; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2449) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2448) |  |
  | 2449 | 2448 |  |
  | 2450 | 2449 | foreach ($o["info"] as $k => $v) { |
  | 2451 |  | switch($k) { |
  |  | 2450 | switch ($k) { |
  | 2452 | 2451 | case 'Fields': |
  | 2453 | 2452 | $res .= " /Fields ["; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2553) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2552) |  |
  | 2553 | 2552 | break; |
  | 2554 | 2553 | case 'T': |
  | 2555 |  | if($encrypted) { |
  |  | 2554 | if ($encrypted) { |
  | 2556 | 2555 | $v = $this->filterText($this->ARC4($v), false, false); |
  | 2557 | 2556 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2596) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2595) |  |
  | 2596 | 2595 | $len = strlen('/ByteRange [ \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* \*\*\*\*\*\*\*\*\*\* ]'); |
  | 2597 | 2596 | $rangeStartPos = $pos + $len + 1 + 10; // before '<' |
  | 2598 |  | $content = substr\_replace($content, str\_pad(sprintf('/ByteRange [ 0 %u %u %u ]', $rangeStartPos, $rangeStartPos + $sign\_maxlen + 2, $content\_len - 2 - $sign\_maxlen - $rangeStartPos), $len, ' ', STR\_PAD\_RIGHT), $pos, $len); |
  |  | 2597 | $content = substr\_replace($content, str\_pad(sprintf('/ByteRange [ 0 %u %u %u ]', $rangeStartPos, $rangeStartPos + $sign\_maxlen + 2, $content\_len - 2 - $sign\_maxlen - $rangeStartPos), $len, ' ', STR\_PAD\_RIGHT), $pos, $len); |
  | 2599 | 2598 |  |
  | 2600 | 2599 | $fuid = uniqid(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2660) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2659) |  |
  | 2660 | 2659 | $o = &$this->objects[$id]; |
  | 2661 | 2660 | foreach ($o['info'] as $k => $v) { |
  | 2662 |  | switch($k) { |
  |  | 2661 | switch ($k) { |
  | 2663 | 2662 | case 'Name': |
  | 2664 | 2663 | case 'Location': |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2786) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2785) |  |
  | 2786 | 2785 | $res = "\n$id 0 obj << "; |
  | 2787 | 2786 |  |
  | 2788 |  | foreach($this->objects[$id]['info'] as $referenceObjName => $referenceObjId) { |
  |  | 2787 | foreach ($this->objects[$id]['info'] as $referenceObjName => $referenceObjId) { |
  | 2789 | 2788 | $res .= "/$referenceObjName $referenceObjId 0 R "; |
  | 2790 | 2789 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L2852) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L2851) |  |
  | 2852 | 2851 | case 'out': |
  | 2853 | 2852 | $info = &$this->objects[$id]['info']; |
  |  | 2853 | $filename = $this->utf8toUtf16BE($info['filename']); |
  |  | 2854 | $description = $this->utf8toUtf16BE($info['description']); |
  | 2854 | 2855 |  |
  | 2855 | 2856 | if ($this->encrypted) { |
  | 2856 | 2857 | $this->encryptInit($id); |
  | 2857 |  | $filename = $this->ARC4($~~info['filename']~~); |
  | 2858 |  | $description = $this->ARC4($~~info['description']~~); |
  | 2859 |  | }~~else {~~ |
  | 2860 |  | $filename = $info['filename']; |
  | 2861 |  | ~~$description = $info['description']~~; |
  | 2862 |  | ~~}~~ |
  |  | 2858 | $filename = $this->ARC4($filename); |
  |  | 2859 | $description = $this->ARC4($description); |
  |  | 2860 | } |
  |  | 2861 |  |
  |  | 2862 | $filename = $this->filterText($filename, false, false); |
  |  | 2863 | $description = $this->filterText($description, false, false); |
  | 2863 | 2864 |  |
  | 2864 | 2865 | $res = "\n$id 0 obj <</Type /Filespec /EF"; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3242) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3243) |  |
  | 3242 | 3243 | // assume that $font contains the path and file but not the extension |
  | 3243 | 3244 | $name = basename($font); |
  | 3244 |  | $dir = dirname($font)~~. '/'~~; |
  |  | 3245 | $dir = dirname($font); |
  | 3245 | 3246 |  |
  | 3246 | 3247 | $fontcache = $this->fontcache; |
  | 3247 | 3248 | if ($fontcache == '') { |
  | 3248 |  | $fontcache = ~~rtrim($dir, DIRECTORY\_SEPARATOR."/\\")~~; |
  |  | 3249 | $fontcache = $dir; |
  | 3249 | 3250 | } |
  | 3250 | 3251 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3263) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3264) |  |
  | 3263 | 3264 | } |
  | 3264 | 3265 |  |
  | 3265 |  | $cache\_name = "$metrics\_name.~~php~~"; |
  |  | 3266 | $cache\_name = "$metrics\_name.json"; |
  | 3266 | 3267 | $this->addMessage("metrics: $metrics\_name, cache: $cache\_name"); |
  | 3267 | 3268 |  |
  | 3268 | 3269 | if (file\_exists($fontcache . '/' . $cache\_name)) { |
  | 3269 |  | $this->addMessage("openFont: php file exists $fontcache/$cache\_name"); |
  | 3270 |  | $this->fonts[$font] = require($fontcache . '/' . $cache\_name); |
  | 3271 |  |  |
  | 3272 |  | if (!isset($this->fonts[$font]['\_version\_']) || $this->fonts[$font]['\_version\_'] != $this->fontcacheVersion) { |
  | 3273 |  | // if the font file is old, then clear it out and prepare for re-creation |
  | 3274 |  | $this->addMessage('openFont: clear out, make way for new version.'); |
  | 3275 |  | $this->fonts[$font] = null; |
  | 3276 |  | unset($this->fonts[$font]); |
  | 3277 |  | } |
  | 3278 |  | } else { |
  | 3279 |  | $old\_cache\_name = "php\_$metrics\_name"; |
  | 3280 |  | if (file\_exists($fontcache . '/' . $old\_cache\_name)) { |
  | 3281 |  | $this->addMessage( |
  | 3282 |  | "openFont: php file doesn't exist $fontcache/$cache\_name, creating it from the old format" |
  | 3283 |  | ); |
  | 3284 |  | $old\_cache = file\_get\_contents($fontcache . '/' . $old\_cache\_name); |
  | 3285 |  | file\_put\_contents($fontcache . '/' . $cache\_name, '<?php return ' . $old\_cache . ';'); |
  | 3286 |  |  |
  | 3287 |  | $this->openFont($font); |
  | 3288 |  | return; |
  | 3289 |  | } |
  | 3290 |  | } |
  | 3291 |  |  |
  | 3292 |  | if (!isset($this->fonts[$font]) && file\_exists($dir . $metrics\_name)) { |
  |  | 3270 | $this->addMessage("openFont: json metrics file exists $fontcache/$cache\_name"); |
  |  | 3271 | $cached\_font\_info = json\_decode(file\_get\_contents($fontcache . '/' . $cache\_name), true); |
  |  | 3272 | if (!isset($cached\_font\_info['\_version\_']) || $cached\_font\_info['\_version\_'] != $this->fontcacheVersion) { |
  |  | 3273 | $this->addMessage('openFont: font cache is out of date, regenerating'); |
  |  | 3274 | } else { |
  |  | 3275 | $this->fonts[$font] = $cached\_font\_info; |
  |  | 3276 | } |
  |  | 3277 | } |
  |  | 3278 |  |
  |  | 3279 | if (!isset($this->fonts[$font]) && file\_exists("$dir/$metrics\_name")) { |
  | 3293 | 3280 | // then rebuild the php\_<font>.afm file from the <font>.afm file |
  | 3294 |  | $this->addMessage("openFont: build php file from $dir$metrics\_name"); |
  |  | 3281 | $this->addMessage("openFont: build php file from $dir/$metrics\_name"); |
  | 3295 | 3282 | $data = []; |
  | 3296 | 3283 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3307) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3294) |  |
  | 3307 | 3294 | } |
  | 3308 | 3295 |  |
  | 3309 |  | $file = file(~~$dir . $metrics\_name~~); |
  |  | 3296 | $file = file("$dir/$metrics\_name"); |
  | 3310 | 3297 |  |
  | 3311 | 3298 | foreach ($file as $rowA) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3461) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3448) |  |
  | 3461 | 3448 | //If not existing, this will hit performance because of missing cached results. |
  | 3462 | 3449 | if (is\_dir($fontcache) && is\_writable($fontcache)) { |
  | 3463 |  | file\_put\_contents(~~$fontcache . '/' . $cache\_name, '<?php return ' . var\_export($data, true) . ';'~~); |
  |  | 3450 | file\_put\_contents("$fontcache/$cache\_name", json\_encode($data, JSON\_PRETTY\_PRINT)); |
  | 3464 | 3451 | } |
  | 3465 | 3452 | $data = null; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3469) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3456) |  |
  | 3469 | 3456 | $this->addMessage("openFont: no font file found for $font. Do you need to run load\_font.php?"); |
  | 3470 | 3457 | } |
  | 3471 |  |  |
  | 3472 |  | ~~//pre\_r($this->messages);~~ |
  | 3473 | 3458 | } |
  | 3474 | 3459 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3480) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3465) |  |
  | 3480 | 3465 | \* and 'differences' => an array of mappings between numbers 0->255 and character names. |
  | 3481 | 3466 | \* |
  | 3482 |  | \* @param $fontName |
  |  | 3467 | \* @param string $fontName |
  | 3483 | 3468 | \* @param string $encoding |
  | 3484 | 3469 | \* @param bool $set |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3628) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3613) |  |
  | 3628 | 3613 | \* sets the color for fill operations |
  | 3629 | 3614 | \* |
  | 3630 |  | \* @param $color |
  | 3631 |  | \* @param bool $force |
  |  | 3615 | \* @param array $color |
  |  | 3616 | \* @param bool  $force |
  | 3632 | 3617 | \*/ |
  | 3633 | 3618 | function setColor($color, $force = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3653) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3638) |  |
  | 3653 | 3638 | \* sets the color for fill operations |
  | 3654 | 3639 | \* |
  | 3655 |  | \* @param $fillRule |
  |  | 3640 | \* @param string $fillRule |
  | 3656 | 3641 | \*/ |
  | 3657 | 3642 | function setFillRule($fillRule) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3667) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3652) |  |
  | 3667 | 3652 | \* sets the color for stroke operations |
  | 3668 | 3653 | \* |
  | 3669 |  | \* @param $color |
  | 3670 |  | \* @param bool $force |
  |  | 3654 | \* @param array $color |
  |  | 3655 | \* @param bool  $force |
  | 3671 | 3656 | \*/ |
  | 3672 | 3657 | function setStrokeColor($color, $force = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3819) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3804) |  |
  | 3819 | 3804 | \* draw a line from one set of coordinates to another |
  | 3820 | 3805 | \* |
  | 3821 |  | \* @param $x1 |
  | 3822 |  | \* @param $y1 |
  | 3823 |  | \* @param $x2 |
  | 3824 |  | \* @param $y2 |
  | 3825 |  | \* @param bool $stroke |
  |  | 3806 | \* @param float $x1 |
  |  | 3807 | \* @param float $y1 |
  |  | 3808 | \* @param float $x2 |
  |  | 3809 | \* @param float $y2 |
  |  | 3810 | \* @param bool  $stroke |
  | 3826 | 3811 | \*/ |
  | 3827 | 3812 | function line($x1, $y1, $x2, $y2, $stroke = true) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3837) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3822) |  |
  | 3837 | 3822 | \* draw a bezier curve based on 4 control points |
  | 3838 | 3823 | \* |
  | 3839 |  | \* @param $x0 |
  | 3840 |  | \* @param $y0 |
  | 3841 |  | \* @param $x1 |
  | 3842 |  | \* @param $y1 |
  | 3843 |  | \* @param $x2 |
  | 3844 |  | \* @param $y2 |
  | 3845 |  | \* @param $x3 |
  | 3846 |  | \* @param $y3 |
  |  | 3824 | \* @param float $x0 |
  |  | 3825 | \* @param float $y0 |
  |  | 3826 | \* @param float $x1 |
  |  | 3827 | \* @param float $y1 |
  |  | 3828 | \* @param float $x2 |
  |  | 3829 | \* @param float $y2 |
  |  | 3830 | \* @param float $x3 |
  |  | 3831 | \* @param float $y3 |
  | 3847 | 3832 | \*/ |
  | 3848 | 3833 | function curve($x0, $y0, $x1, $y1, $x2, $y2, $x3, $y3) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3858) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3843) |  |
  | 3858 | 3843 | \* draw a part of an ellipse |
  | 3859 | 3844 | \* |
  | 3860 |  | \* @param $x0 |
  | 3861 |  | \* @param $y0 |
  | 3862 |  | \* @param $astart |
  | 3863 |  | \* @param $afinish |
  | 3864 |  | \* @param $r1 |
  | 3865 |  | \* @param ~~in~~t $r2 |
  | 3866 |  | \* @param ~~in~~t $angle |
  |  | 3845 | \* @param float $x0 |
  |  | 3846 | \* @param float $y0 |
  |  | 3847 | \* @param float $astart |
  |  | 3848 | \* @param float $afinish |
  |  | 3849 | \* @param float $r1 |
  |  | 3850 | \* @param float $r2 |
  |  | 3851 | \* @param float $angle |
  | 3867 | 3852 | \* @param int $nSeg |
  | 3868 | 3853 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3875) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3860) |  |
  | 3875 | 3860 | \* draw a filled ellipse |
  | 3876 | 3861 | \* |
  | 3877 |  | \* @param $x0 |
  | 3878 |  | \* @param $y0 |
  | 3879 |  | \* @param $r1 |
  | 3880 |  | \* @param ~~in~~t $r2 |
  | 3881 |  | \* @param ~~in~~t $angle |
  |  | 3862 | \* @param float $x0 |
  |  | 3863 | \* @param float $y0 |
  |  | 3864 | \* @param float $r1 |
  |  | 3865 | \* @param float $r2 |
  |  | 3866 | \* @param float $angle |
  | 3882 | 3867 | \* @param int $nSeg |
  | 3883 |  | \* @param ~~in~~t $astart |
  | 3884 |  | \* @param ~~in~~t $afinish |
  |  | 3868 | \* @param float $astart |
  |  | 3869 | \* @param float $afinish |
  | 3885 | 3870 | \*/ |
  | 3886 | 3871 | function filledEllipse($x0, $y0, $r1, $r2 = 0, $angle = 0, $nSeg = 8, $astart = 0, $afinish = 360) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3890) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3875) |  |
  | 3890 | 3875 |  |
  | 3891 | 3876 | /\*\* |
  | 3892 |  | \* @param $x |
  | 3893 |  | \* @param $y |
  |  | 3877 | \* @param float $x |
  |  | 3878 | \* @param float $y |
  | 3894 | 3879 | \*/ |
  | 3895 | 3880 | function lineTo($x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3899) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3884) |  |
  | 3899 | 3884 |  |
  | 3900 | 3885 | /\*\* |
  | 3901 |  | \* @param $x |
  | 3902 |  | \* @param $y |
  |  | 3886 | \* @param float $x |
  |  | 3887 | \* @param float $y |
  | 3903 | 3888 | \*/ |
  | 3904 | 3889 | function moveTo($x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3910) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3895) |  |
  | 3910 | 3895 | \* draw a bezier curve based on 4 control points |
  | 3911 | 3896 | \* |
  | 3912 |  | \* @param $x1 |
  | 3913 |  | \* @param $y1 |
  | 3914 |  | \* @param $x2 |
  | 3915 |  | \* @param $y2 |
  | 3916 |  | \* @param $x3 |
  | 3917 |  | \* @param $y3 |
  |  | 3897 | \* @param float $x1 |
  |  | 3898 | \* @param float $y1 |
  |  | 3899 | \* @param float $x2 |
  |  | 3900 | \* @param float $y2 |
  |  | 3901 | \* @param float $x3 |
  |  | 3902 | \* @param float $y3 |
  | 3918 | 3903 | \*/ |
  | 3919 | 3904 | function curveTo($x1, $y1, $x2, $y2, $x3, $y3) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3924) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3909) |  |
  | 3924 | 3909 | /\*\* |
  | 3925 | 3910 | \* draw a bezier curve based on 4 control points |
  |  | 3911 | \* |
  |  | 3912 | \* @param float $cpx |
  |  | 3913 | \* @param float $cpy |
  |  | 3914 | \* @param float $x |
  |  | 3915 | \* @param float $y |
  | 3926 | 3916 | \*/ |
  | 3927 | 3917 | function quadTo($cpx, $cpy, $x, $y) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L3951) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L3941) |  |
  | 3951 | 3941 | \* pretty crappy shape at 2, as we are approximating with bezier curves. |
  | 3952 | 3942 | \* |
  | 3953 |  | \* @param $x0 |
  | 3954 |  | \* @param $y0 |
  | 3955 |  | \* @param $r1 |
  | 3956 |  | \* @param ~~in~~t $r2 |
  | 3957 |  | \* @param ~~in~~t $angle |
  | 3958 |  | \* @param int $nSeg |
  | 3959 |  | \* @param ~~in~~t $astart |
  | 3960 |  | \* @param ~~in~~t $afinish |
  | 3961 |  | \* @param bool $close |
  | 3962 |  | \* @param bool $fill |
  | 3963 |  | \* @param bool $stroke |
  | 3964 |  | \* @param bool $incomplete |
  |  | 3943 | \* @param float $x0 |
  |  | 3944 | \* @param float $y0 |
  |  | 3945 | \* @param float $r1 |
  |  | 3946 | \* @param float $r2 |
  |  | 3947 | \* @param float $angle |
  |  | 3948 | \* @param int   $nSeg |
  |  | 3949 | \* @param float $astart |
  |  | 3950 | \* @param float $afinish |
  |  | 3951 | \* @param bool  $close |
  |  | 3952 | \* @param bool  $fill |
  |  | 3953 | \* @param bool  $stroke |
  |  | 3954 | \* @param bool  $incomplete |
  | 3965 | 3955 | \*/ |
  | 3966 | 3956 | function ellipse( |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4076) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4066) |  |
  | 4076 | 4066 | \* phase is a modifier on the dash pattern which is used to shift the point at which the pattern starts. |
  | 4077 | 4067 | \* |
  | 4078 |  | \* @param ~~int~~ $width |
  |  | 4068 | \* @param float  $width |
  | 4079 | 4069 | \* @param string $cap |
  | 4080 | 4070 | \* @param string $join |
  | 4081 |  | \* @param ~~string~~ $dash |
  | 4082 |  | \* @param int $phase |
  |  | 4071 | \* @param array  $dash |
  |  | 4072 | \* @param int    $phase |
  | 4083 | 4073 | \*/ |
  | 4084 | 4074 | function setLineStyle($width = 1, $cap = '', $join = '', $dash = '', $phase = 0) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4114) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4104) |  |
  | 4114 | 4104 | \* draw a polygon, the syntax for this is similar to the GD polygon command |
  | 4115 | 4105 | \* |
  | 4116 |  | \* @param $p |
  | 4117 |  | \* @param $np |
  | 4118 |  | \* @param bool $f |
  | 4119 |  | \*/ |
  | 4120 |  | function polygon($p, $np, $f = false) |
  |  | 4106 | \* @param float[] $p |
  |  | 4107 | \* @param bool    $fill |
  |  | 4108 | \*/ |
  |  | 4109 | public function polygon(array $p, bool $fill = false): void |
  | 4121 | 4110 | { |
  | 4122 | 4111 | $this->addContent(sprintf("\n%.3F %.3F m ", $p[0], $p[1])); |
  | 4123 | 4112 |  |
  | 4124 |  | for ($i = 2; $i < $np \* 2; $i = $i + 2) { |
  |  | 4113 | $n = count($p); |
  |  | 4114 | for ($i = 2; $i < $n; $i = $i + 2) { |
  | 4125 | 4115 | $this->addContent(sprintf("%.3F %.3F l ", $p[$i], $p[$i + 1])); |
  | 4126 | 4116 | } |
  | 4127 | 4117 |  |
  | 4128 |  | if ($f) { |
  |  | 4118 | if ($fill) { |
  | 4129 | 4119 | $this->addContent(' f'); |
  | 4130 | 4120 | } else { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4137) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4127) |  |
  | 4137 | 4127 | \* the coordinates of the upper-right corner |
  | 4138 | 4128 | \* |
  | 4139 |  | \* @param $x1 |
  | 4140 |  | \* @param $y1 |
  | 4141 |  | \* @param $width |
  | 4142 |  | \* @param $height |
  |  | 4129 | \* @param float $x1 |
  |  | 4130 | \* @param float $y1 |
  |  | 4131 | \* @param float $width |
  |  | 4132 | \* @param float $height |
  | 4143 | 4133 | \*/ |
  | 4144 | 4134 | function filledRectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4151) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4141) |  |
  | 4151 | 4141 | \* the coordinates of the upper-right corner |
  | 4152 | 4142 | \* |
  | 4153 |  | \* @param $x1 |
  | 4154 |  | \* @param $y1 |
  | 4155 |  | \* @param $width |
  | 4156 |  | \* @param $height |
  |  | 4143 | \* @param float $x1 |
  |  | 4144 | \* @param float $y1 |
  |  | 4145 | \* @param float $width |
  |  | 4146 | \* @param float $height |
  | 4157 | 4147 | \*/ |
  | 4158 | 4148 | function rectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4165) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4155) |  |
  | 4165 | 4155 | \* the coordinates of the upper-right corner |
  | 4166 | 4156 | \* |
  | 4167 |  | \* @param $x1 |
  | 4168 |  | \* @param $y1 |
  | 4169 |  | \* @param $width |
  | 4170 |  | \* @param $height |
  |  | 4157 | \* @param float $x1 |
  |  | 4158 | \* @param float $y1 |
  |  | 4159 | \* @param float $width |
  |  | 4160 | \* @param float $height |
  | 4171 | 4161 | \*/ |
  | 4172 | 4162 | function rect($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4280) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4270) |  |
  | 4280 | 4270 |  |
  | 4281 | 4271 | $currentFontNum = $this->currentFontNum; |
  | 4282 |  | $font = array\_filter($this->objects[$this->currentNode]['info']['fonts'], |
  | 4283 |  | function($item) use ($currentFontNum) { return $item['fontNum'] == $currentFontNum; }); |
  |  | 4272 | $font = array\_filter( |
  |  | 4273 | $this->objects[$this->currentNode]['info']['fonts'], |
  |  | 4274 | function ($item) use ($currentFontNum) { return $item['fontNum'] == $currentFontNum; } |
  |  | 4275 | ); |
  | 4284 | 4276 |  |
  | 4285 | 4277 | $this->o\_acroform($this->acroFormId, 'font', |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4396) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4388) |  |
  | 4396 | 4388 | \* draw a clipping rectangle, all the elements added after this will be clipped |
  | 4397 | 4389 | \* |
  | 4398 |  | \* @param $x1 |
  | 4399 |  | \* @param $y1 |
  | 4400 |  | \* @param $width |
  | 4401 |  | \* @param $height |
  |  | 4390 | \* @param float $x1 |
  |  | 4391 | \* @param float $y1 |
  |  | 4392 | \* @param float $width |
  |  | 4393 | \* @param float $height |
  | 4402 | 4394 | \*/ |
  | 4403 | 4395 | function clippingRectangle($x1, $y1, $width, $height) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4410) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4402) |  |
  | 4410 | 4402 | \* draw a clipping rounded rectangle, all the elements added after this will be clipped |
  | 4411 | 4403 | \* |
  | 4412 |  | \* @param $x1 |
  | 4413 |  | \* @param $y1 |
  | 4414 |  | \* @param $w |
  | 4415 |  | \* @param $h |
  | 4416 |  | \* @param $rTL |
  | 4417 |  | \* @param $rTR |
  | 4418 |  | \* @param $rBR |
  | 4419 |  | \* @param $rBL |
  |  | 4404 | \* @param float $x1 |
  |  | 4405 | \* @param float $y1 |
  |  | 4406 | \* @param float $w |
  |  | 4407 | \* @param float $h |
  |  | 4408 | \* @param float $rTL |
  |  | 4409 | \* @param float $rTR |
  |  | 4410 | \* @param float $rBR |
  |  | 4411 | \* @param float $rBL |
  | 4420 | 4412 | \*/ |
  | 4421 | 4413 | function clippingRectangleRounded($x1, $y1, $w, $h, $rTL, $rTR, $rBR, $rBL) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4455) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4447) |  |
  | 4455 | 4447 | // Close & clip |
  | 4456 | 4448 | $this->addContent(" W n"); |
  |  | 4449 | } |
  |  | 4450 |  |
  |  | 4451 | /\*\* |
  |  | 4452 | \* draw a clipping polygon, the syntax for this is similar to the GD polygon command |
  |  | 4453 | \* |
  |  | 4454 | \* @param float[] $p |
  |  | 4455 | \*/ |
  |  | 4456 | public function clippingPolygon(array $p): void |
  |  | 4457 | { |
  |  | 4458 | $this->save(); |
  |  | 4459 |  |
  |  | 4460 | $this->addContent(sprintf("\n%.3F %.3F m ", $p[0], $p[1])); |
  |  | 4461 |  |
  |  | 4462 | $n = count($p); |
  |  | 4463 | for ($i = 2; $i < $n; $i = $i + 2) { |
  |  | 4464 | $this->addContent(sprintf("%.3F %.3F l ", $p[$i], $p[$i + 1])); |
  |  | 4465 | } |
  |  | 4466 |  |
  |  | 4467 | $this->addContent("W n"); |
  | 4457 | 4468 | } |
  | 4458 | 4469 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4673) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4684) |  |
  | 4673 | 4684 | \* return the height in units of the current font in the given size |
  | 4674 | 4685 | \* |
  | 4675 |  | \* @param $size |
  | 4676 |  | \* @return float|int |
  | 4677 |  | \*/ |
  | 4678 |  | function getFontHeight($size) |
  |  | 4686 | \* @param float $size |
  |  | 4687 | \* |
  |  | 4688 | \* @return float |
  |  | 4689 | \*/ |
  |  | 4690 | public function getFontHeight(float $size): float |
  | 4679 | 4691 | { |
  | 4680 | 4692 | if (!$this->numFonts) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4708) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4720) |  |
  | 4708 | 4720 |  |
  | 4709 | 4721 | /\*\* |
  | 4710 |  | \* @param $size |
  | 4711 |  | \* @return float|int |
  | 4712 |  | \*/ |
  | 4713 |  | function getFontXHeight($size) |
  |  | 4722 | \* @param float $size |
  |  | 4723 | \* |
  |  | 4724 | \* @return float |
  |  | 4725 | \*/ |
  |  | 4726 | public function getFontXHeight(float $size): float |
  | 4714 | 4727 | { |
  | 4715 | 4728 | if (!$this->numFonts) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4734) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4747) |  |
  | 4734 | 4747 | \* it is in the pdf user units |
  | 4735 | 4748 | \* |
  | 4736 |  | \* @param $size |
  | 4737 |  | \* @return float|int |
  | 4738 |  | \*/ |
  | 4739 |  | function getFontDescender($size) |
  |  | 4749 | \* @param float $size |
  |  | 4750 | \* |
  |  | 4751 | \* @return float |
  |  | 4752 | \*/ |
  |  | 4753 | public function getFontDescender(float $size): float |
  | 4740 | 4754 | { |
  | 4741 | 4755 | // note that this will most likely return a negative value |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4753) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4767) |  |
  | 4753 | 4767 | \* filter the text, this is applied to all text just before being inserted into the pdf document |
  | 4754 | 4768 | \* it escapes the various things that need to be escaped, and so on |
  | 4755 |  | ~~\*~~ |
  | 4756 |  | ~~\* @access private~~ |
  | 4757 | 4769 | \* |
  | 4758 | 4770 | \* @param $text |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4775) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4787) |  |
  | 4775 | 4787 | $text = mb\_convert\_encoding($text, self::$targetEncoding, 'UTF-8'); |
  | 4776 | 4788 | } |
  | 4777 |  | } elseif ($bom) { |
  |  | 4789 | } elseif ($bom) { |
  | 4778 | 4790 | $text = $this->utf8toUtf16BE($text, $bom); |
  | 4779 | 4791 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4790) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4802) |  |
  | 4790 | 4802 | \* RFC for UTF-8 at http://www.faqs.org/rfcs/rfc3629.html |
  | 4791 | 4803 | \* |
  | 4792 |  | ~~\* @access private~~ |
  | 4793 |  | ~~\* @author Orion Richardson~~ |
  | 4794 |  | ~~\* @since  January 5, 2008~~ |
  | 4795 |  | ~~\*~~ |
  | 4796 | 4804 | \* @param string $text UTF-8 string to process |
  | 4797 |  | ~~\*~~ |
  | 4798 | 4805 | \* @return array UTF-8 codepoints array for the string |
  | 4799 | 4806 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4865) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4872) |  |
  | 4865 | 4872 | \* RFC for UTF-8 at http://www.faqs.org/rfcs/rfc3629.html |
  | 4866 | 4873 | \* |
  | 4867 |  | ~~\* @access private~~ |
  | 4868 |  | ~~\* @author Orion Richardson~~ |
  | 4869 |  | ~~\* @since  January 5, 2008~~ |
  | 4870 |  | ~~\*~~ |
  | 4871 | 4874 | \* @param string  $text UTF-8 string to process |
  | 4872 | 4875 | \* @param boolean $bom  whether to add the byte order marker |
  | 4873 |  | ~~\*~~ |
  | 4874 | 4876 | \* @return string UTF-16 result string |
  | 4875 | 4877 | \*/ |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4946) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4948) |  |
  | 4946 | 4948 | \* register text for font subsetting |
  | 4947 | 4949 | \* |
  | 4948 |  | \* @param $font |
  | 4949 |  | \* @param $text |
  |  | 4950 | \* @param string $font |
  |  | 4951 | \* @param string $text |
  | 4950 | 4952 | \*/ |
  | 4951 | 4953 | function registerText($font, $text) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4956) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4958) |  |
  | 4956 | 4958 |  |
  | 4957 | 4959 | if (!isset($this->stringSubsets[$font])) { |
  | 4958 |  | $this->stringSubsets[$font] = []; |
  |  | 4960 | $base\_subset = "\u{fffd}\u{fffe}\u{ffff}"; |
  |  | 4961 | $this->stringSubsets[$font] = $this->utf8toCodePointsArray($base\_subset); |
  | 4959 | 4962 | } |
  | 4960 | 4963 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L4967) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L4970) |  |
  | 4967 | 4970 | \* add text to the document, at a specified location, size and angle on the page |
  | 4968 | 4971 | \* |
  | 4969 |  | \* @param $x |
  | 4970 |  | \* @param $y |
  | 4971 |  | \* @param $size |
  | 4972 |  | \* @param $text |
  | 4973 |  | \* @param ~~int~~ $angle |
  | 4974 |  | \* @param ~~int~~ $wordSpaceAdjust |
  | 4975 |  | \* @param ~~int~~ $charSpaceAdjust |
  | 4976 |  | \* @param bool $smallCaps |
  |  | 4972 | \* @param float  $x |
  |  | 4973 | \* @param float  $y |
  |  | 4974 | \* @param float  $size |
  |  | 4975 | \* @param string $text |
  |  | 4976 | \* @param float  $angle |
  |  | 4977 | \* @param float  $wordSpaceAdjust |
  |  | 4978 | \* @param float  $charSpaceAdjust |
  |  | 4979 | \* @param bool   $smallCaps |
  | 4977 | 4980 | \*/ |
  | 4978 | 4981 | function addText($x, $y, $size, $text, $angle = 0, $wordSpaceAdjust = 0, $charSpaceAdjust = 0, $smallCaps = false) |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5087) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5090) |  |
  | 5087 | 5090 | \* this can be called externally, but is also used by the other class functions |
  | 5088 | 5091 | \* |
  | 5089 |  | \* @param float $size |
  |  | 5092 | \* @param float  $size |
  | 5090 | 5093 | \* @param string $text |
  | 5091 |  | \* @param float $word\_spacing |
  | 5092 |  | \* @param float $char\_spacing |
  |  | 5094 | \* @param float  $wordSpacing |
  |  | 5095 | \* @param float  $charSpacing |
  |  | 5096 | \* |
  | 5093 | 5097 | \* @return float |
  | 5094 | 5098 | \*/ |
  | 5095 |  | ~~function getTextWidth($size, $text, $word\_spacing = 0, $char\_spacing = 0)~~ |
  |  | 5099 | public function getTextWidth(float $size, string $text, float $wordSpacing = 0.0, float $charSpacing = 0.0): float |
  | 5096 | 5100 | { |
  | 5097 | 5101 | static $ord\_cache = []; |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5107) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5111) |  |
  | 5107 | 5111 |  |
  | 5108 | 5112 | $text = str\_replace(["\r", "\n"], "", $text); |
  | 5109 |  |  |
  | 5110 |  | ~~// converts a number or a float to a string so it can get the width~~ |
  | 5111 |  | ~~$text = "$text";~~ |
  | 5112 | 5113 |  |
  | 5113 | 5114 | // hmm, this is where it all starts to get tricky - use the font information to |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5137) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5138) |  |
  | 5137 | 5138 | // add additional padding for space |
  | 5138 | 5139 | if (isset($current\_font['codeToName'][$char]) && $current\_font['codeToName'][$char] === 'space') {  // Space |
  | 5139 |  | $w += $word~~\_s~~pacing \* $space\_scale; |
  |  | 5140 | $w += $wordSpacing \* $space\_scale; |
  | 5140 | 5141 | } |
  | 5141 | 5142 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5143) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5144) |  |
  | 5143 | 5144 |  |
  | 5144 | 5145 | // add additional char spacing |
  | 5145 |  | if ($char~~\_s~~pacing != 0) { |
  | 5146 |  | $w += $char~~\_s~~pacing \* $space\_scale \* count($unicode); |
  |  | 5146 | if ($charSpacing != 0) { |
  |  | 5147 | $w += $charSpacing \* $space\_scale \* count($unicode); |
  | 5147 | 5148 | } |
  | 5148 | 5149 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5172) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5173) |  |
  | 5172 | 5173 | // add additional padding for space |
  | 5173 | 5174 | if (isset($current\_font['codeToName'][$char]) && $current\_font['codeToName'][$char] === 'space') {  // Space |
  | 5174 |  | $w += $word~~\_s~~pacing \* $space\_scale; |
  |  | 5175 | $w += $wordSpacing \* $space\_scale; |
  | 5175 | 5176 | } |
  | 5176 | 5177 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5178) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5179) |  |
  | 5178 | 5179 |  |
  | 5179 | 5180 | // add additional char spacing |
  | 5180 |  | if ($char~~\_s~~pacing != 0) { |
  | 5181 |  | $w += $char~~\_s~~pacing \* $space\_scale \* $len; |
  |  | 5181 | if ($charSpacing != 0) { |
  |  | 5182 | $w += $charSpacing \* $space\_scale \* $len; |
  | 5182 | 5183 | } |
  | 5183 | 5184 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5419) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5420) |  |
  | 5419 | 5420 |  |
  | 5420 | 5421 | /\*\* |
  | 5421 |  | \* ~~a~~dd content to the documents info object |
  | 5422 |  | \* |
  | 5423 |  | \* @param $label |
  | 5424 |  | \* @param ~~int~~ $value |
  | 5425 |  | \*/ |
  | 5426 |  | ~~function addInfo($label, $value = 0)~~ |
  |  | 5422 | \* Add content to the documents info object |
  |  | 5423 | \* |
  |  | 5424 | \* @param string|array $label |
  |  | 5425 | \* @param string       $value |
  |  | 5426 | \*/ |
  |  | 5427 | public function addInfo($label, string $value = ""): void |
  | 5427 | 5428 | { |
  | 5428 | 5429 | // this will only work if the label is one of the valid ones. |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5432) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5433) |  |
  | 5432 | 5433 | if (is\_array($label)) { |
  | 5433 | 5434 | foreach ($label as $l => $v) { |
  | 5434 |  | $this->o\_info($this->infoObject, $l, $v); |
  |  | 5435 | $this->o\_info($this->infoObject, $l, (string) $v); |
  | 5435 | 5436 | } |
  | 5436 | 5437 | } else { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5569) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5570) |  |
  | 5569 | 5570 | { |
  | 5570 | 5571 | // generate images |
  | 5571 |  | $img = imagecreatefrompng($file); |
  |  | 5572 | $img = @imagecreatefrompng($file); |
  | 5572 | 5573 |  |
  | 5573 | 5574 | if ($img === false) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5618) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5619) |  |
  | 5618 | 5619 |  |
  | 5619 | 5620 | // Cast to 8bit+palette |
  | 5620 |  | $imgalpha\_ = imagecreatefrompng($tempfile\_alpha); |
  |  | 5621 | $imgalpha\_ = @imagecreatefrompng($tempfile\_alpha); |
  | 5621 | 5622 | imagecopy($imgalpha, $imgalpha\_, 0, 0, 0, 0, $wpx, $hpx); |
  | 5622 | 5623 | imagedestroy($imgalpha\_); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5631) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5632) |  |
  | 5631 | 5632 | $color\_channels->writeimage($tempfile\_plain); |
  | 5632 | 5633 |  |
  | 5633 |  | $imgplain = imagecreatefrompng($tempfile\_plain); |
  |  | 5634 | $imgplain = @imagecreatefrompng($tempfile\_plain); |
  | 5634 | 5635 | } |
  | 5635 | 5636 | // Use PECL imagick + ImageMagic to process transparent PNG images |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5654) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5655) |  |
  | 5654 | 5655 |  |
  | 5655 | 5656 | // Get opacity channel (negative of alpha channel) |
  | 5656 |  | if ($imagick->getImageAlphaChannel()~~!== 0~~) { |
  |  | 5657 | if ($imagick->getImageAlphaChannel()) { |
  | 5657 | 5658 | $alpha\_channel = $imagickClonable ? clone $imagick : $imagick->clone(); |
  | 5658 | 5659 | $alpha\_channel->separateImageChannel(\Imagick::CHANNEL\_ALPHA); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5664) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5665) |  |
  | 5664 | 5665 |  |
  | 5665 | 5666 | // Cast to 8bit+palette |
  | 5666 |  | $imgalpha\_ = imagecreatefrompng($tempfile\_alpha); |
  |  | 5667 | $imgalpha\_ = @imagecreatefrompng($tempfile\_alpha); |
  | 5667 | 5668 | imagecopy($imgalpha, $imgalpha\_, 0, 0, 0, 0, $wpx, $hpx); |
  | 5668 | 5669 | imagedestroy($imgalpha\_); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=2790488#L5680) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Surface/CPdf.php?rev=3076105#L5681) |  |
  | 5680 | 5681 | $color\_channels->writeImage($tempfile\_plain); |
  | 5681 | 5682 |  |
  | 5682 |  | $imgplain = imagecreatefrompng($tempfile\_plain); |
  |  | 5683 | $imgplain = @imagecreatefrompng($tempfile\_plain); |
  | 5683 | 5684 | } else { |
  | 5684 | 5685 | // allocated colors cache |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L60 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L60 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 60 | 60 | $this->attributes = $attributes; |
  | 61 | 61 |  |
  | 62 |  | if (!$this->getDocument()->inDefs) { |
  |  | 62 | if (!$this->getDocument()->inDefs || $this instanceof StyleTag) { |
  | 63 | 63 | $this->before($attributes); |
  | 64 | 64 | $this->start($attributes); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L68) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L68) |  |
  | 68 | 68 | public function handleEnd() |
  | 69 | 69 | { |
  | 70 |  | if (!$this->getDocument()->inDefs) { |
  |  | 70 | if (!$this->getDocument()->inDefs || $this instanceof StyleTag) { |
  | 71 | 71 | $this->end(); |
  | 72 | 72 | $this->after(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3053443#L191) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/AbstractTag.php?rev=3076105#L191) |  |
  | 191 | 191 |  |
  | 192 | 192 | /\*\* |
  |  | 193 | \* Apply a viewBox transform to the element |
  |  | 194 | \* |
  |  | 195 | \* @param array $attributes |
  |  | 196 | \*/ |
  |  | 197 | protected function applyViewbox($attributes) { |
  |  | 198 | if (!isset($attributes["viewbox"])) { |
  |  | 199 | return; |
  |  | 200 | } |
  |  | 201 |  |
  |  | 202 | $surface = $this->document->getSurface(); |
  |  | 203 | $viewBox = preg\_split('/[\s,]+/is', trim($attributes['viewbox'])); |
  |  | 204 | if (count($viewBox) != 4) { |
  |  | 205 | return; |
  |  | 206 | } |
  |  | 207 |  |
  |  | 208 | // Computing the equivalent transform of an SVG viewport |
  |  | 209 | // https://svgwg.org/svg2-draft/coords.html#ComputingAViewportsTransform |
  |  | 210 |  |
  |  | 211 | // 1. Let vb-x, vb-y, vb-width, vb-height be the min-x, min-y, width and height values of the viewBox attribute respectively. |
  |  | 212 | [$vbX, $vbY, $vbWidth, $vbHeight] = $viewBox; |
  |  | 213 |  |
  |  | 214 | if ($vbWidth < 0 || $vbHeight < 0) { |
  |  | 215 | return; |
  |  | 216 | } |
  |  | 217 |  |
  |  | 218 | // correct solution is to not render, for now scaling to 0 below |
  |  | 219 | //if ($vbWidth == 0 || $vbHeight == 0) { |
  |  | 220 | //} |
  |  | 221 |  |
  |  | 222 | // 2. Let e-x, e-y, e-width, e-height be the position and size of the element respectively. |
  |  | 223 | $eX = $attributes["x"] ?? 0; |
  |  | 224 | $eY = $attributes["y"] ?? 0; |
  |  | 225 | $eWidth = $attributes["width"] ?? $this->document->getWidth(); |
  |  | 226 | $eHeight = $attributes["height"] ?? $this->document->getHeight(); |
  |  | 227 |  |
  |  | 228 | // 3. Let align be the align value of preserveAspectRatio, or 'xMidYMid' if preserveAspectRatio is not defined. |
  |  | 229 | $preserveAspectRatio = explode(" ", $attributes["preserveAspectRatio"] ?? "xMidYMid meet"); |
  |  | 230 | $align = $preserveAspectRatio[0]; |
  |  | 231 |  |
  |  | 232 | // 4. Let meetOrSlice be the meetOrSlice value of preserveAspectRatio, or 'meet' if preserveAspectRatio is not defined or if meetOrSlice is missing from this value. |
  |  | 233 | $meetOrSlice = $meetOrSlice ?? "meet"; |
  |  | 234 |  |
  |  | 235 | // 5. Initialize scale-x to e-width/vb-width. |
  |  | 236 | $scaleX = $vbWidth == 0 ? 0 : ($eWidth / $vbWidth); |
  |  | 237 |  |
  |  | 238 | // 6. Initialize scale-y to e-height/vb-height. |
  |  | 239 | $scaleY = $vbHeight == 0 ? 0 : ($eHeight / $vbHeight); |
  |  | 240 |  |
  |  | 241 | // 7. If align is not 'none' and meetOrSlice is 'meet', set the larger of scale-x and scale-y to the smaller. |
  |  | 242 | if ($align !== "none" && $meetOrSlice === "meet") { |
  |  | 243 | $scaleX = min($scaleX, $scaleY); |
  |  | 244 | $scaleY = min($scaleX, $scaleY); |
  |  | 245 | } |
  |  | 246 |  |
  |  | 247 | // 8. Otherwise, if align is not 'none' and meetOrSlice is 'slice', set the smaller of scale-x and scale-y to the larger. |
  |  | 248 | elseif ($align !== "none" && $meetOrSlice === "slice") { |
  |  | 249 | $scaleX = max($scaleX, $scaleY); |
  |  | 250 | $scaleY = max($scaleX, $scaleY); |
  |  | 251 | } |
  |  | 252 |  |
  |  | 253 | // 9. Initialize translate-x to e-x - (vb-x \* scale-x). |
  |  | 254 | $translateX = $eX - ($vbX \* $scaleX); |
  |  | 255 |  |
  |  | 256 | // 10. Initialize translate-y to e-y - (vb-y \* scale-y) |
  |  | 257 | $translateY = $eY - ($vbY \* $scaleY); |
  |  | 258 |  |
  |  | 259 | // 11. If align contains 'xMid', add (e-width - vb-width \* scale-x) / 2 to translate-x. |
  |  | 260 | if (strpos($align, "xMid") !== false) { |
  |  | 261 | $translateX += ($eWidth - $vbWidth \* $scaleX) / 2; |
  |  | 262 | } |
  |  | 263 |  |
  |  | 264 | // 12. If align contains 'xMax', add (e-width - vb-width \* scale-x) to translate-x. |
  |  | 265 | if (strpos($align, "xMax") !== false) { |
  |  | 266 | $translateX += ($eWidth - $vbWidth \* $scaleX); |
  |  | 267 | } |
  |  | 268 |  |
  |  | 269 | // 13. If align contains 'yMid', add (e-height - vb-height \* scale-y) / 2 to translate-y. |
  |  | 270 | if (strpos($align, "yMid") !== false) { |
  |  | 271 | $translateX += ($eHeight - $vbHeight \* $scaleY) / 2; |
  |  | 272 | } |
  |  | 273 |  |
  |  | 274 | // 14. If align contains 'yMax', add (e-height - vb-height \* scale-y) to translate-y. |
  |  | 275 | if (strpos($align, "yMid") !== false) { |
  |  | 276 | $translateX += ($eHeight - $vbHeight \* $scaleY); |
  |  | 277 | } |
  |  | 278 |  |
  |  | 279 | $surface->translate($translateX, $translateY); |
  |  | 280 | $surface->scale($scaleX, $scaleY); |
  |  | 281 | } |
  |  | 282 |  |
  |  | 283 | /\*\* |
  | 193 | 284 | \* Convert the given size for the context of this current tag. |
  | 194 | 285 | \* Takes a pixel-based reference, which is usually specific to the context of the size, |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php")

  | [r2790488](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=2790488#L450 "Show revision 2790488 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/Path.php?rev=3076105#L450 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 450 | 450 | $toY = $ty - $fy; |
  | 451 | 451 |  |
  | 452 |  | if ($toX + $toY === 0) { |
  |  | 452 | if ((float)($toX + $toY) === 0.0) { |
  |  | 453 | return; |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | if ((float)abs($rx) == 0.0 || (float)abs($ry) === 0.0) { |
  |  | 457 | $surface->lineTo($tx, $ty); |
  | 453 | 458 | return; |
  | 454 | 459 | } |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php")

  | [r3019205](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L49 "Show revision 3019205 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L49 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 49 | 49 | $this->reference = $document->getDef($link); |
  | 50 | 50 |  |
  | 51 |  | ~~if ($this->reference) {~~ |
  | 52 |  | ~~$this->reference->before($attributes);~~ |
  | 53 |  | ~~}~~ |
  | 54 |  |  |
  | 55 | 51 | $surface = $document->getSurface(); |
  | 56 | 52 | $surface->save(); |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L64) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L60) |  |
  | 64 | 60 | } |
  | 65 | 61 | parent::after(); |
  | 66 |  |  |
  | 67 |  | ~~if ($this->reference) {~~ |
  | 68 |  | ~~$this->reference->after();~~ |
  | 69 |  | ~~}~~ |
  | 70 |  |  |
  | 71 | 62 | $this->getDocument()->getSurface()->restore(); |
  | 72 | 63 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L85) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L76) |  |
  | 85 | 76 | } |
  | 86 | 77 |  |
  |  | 78 | $originalAttributes = array\_merge($this->reference->attributes); |
  |  | 79 | $originalStyle = $this->reference->getStyle(); |
  | 87 | 80 | $mergedAttributes = $this->reference->attributes; |
  | 88 |  | $attributesToNotMerge = ['x', 'y', 'width', 'height', 'href', 'xlink:href', 'id']; |
  |  | 81 | $attributesToNotMerge = ['x', 'y', 'width', 'height', 'href', 'xlink:href', 'id', 'style']; |
  | 89 | 82 | foreach ($attributes as $attrKey => $attrVal) { |
  | 90 | 83 | if (!in\_array($attrKey, $attributesToNotMerge) && !isset($mergedAttributes[$attrKey])) { |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L92) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L85) |  |
  | 92 | 85 | } |
  | 93 | 86 | } |
  |  | 87 | $mergedAttributes['style'] = ($attributes['style'] ?? '') . ';' . ($mergedAttributes['style'] ?? ''); |
  | 94 | 88 |  |
  | 95 |  | $this->~~reference->handle(~~$mergedAttributes); |
  |  | 89 | $this->\_handle($this->reference, $mergedAttributes); |
  | 96 | 90 |  |
  | 97 |  | ~~foreach ($this->reference->children as $\_child) {~~ |
  | 98 |  | ~~$\_attributes = array\_merge($\_child->attributes, $mergedAttributes);~~ |
  | 99 |  | $~~\_child->handle($\_attributes~~); |
  |  | 91 | $this->reference->attributes = $originalAttributes; |
  |  | 92 | if ($originalStyle !== null) { |
  |  | 93 | $this->reference->setStyle($originalStyle); |
  | 100 | 94 | } |
  | 101 | 95 | } |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3019205#L108) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php?rev=3076105#L102) |  |
  | 108 | 102 | } |
  | 109 | 103 |  |
  | 110 |  | parent::handleEnd(); |
  | 111 |  |  |
  | 112 |  | if (!$this->reference) { |
  | 113 |  | return; |
  |  | 104 | if ($this->reference) { |
  |  | 105 | $this->\_handleEnd($this->reference); |
  | 114 | 106 | } |
  | 115 | 107 |  |
  | 116 |  | $this->reference->handleEnd(); |
  |  | 108 | parent::handleEnd(); |
  |  | 109 | } |
  | 117 | 110 |  |
  | 118 |  | foreach ($this->reference->children as $\_child) { |
  | 119 |  | $\_child->handleEnd(); |
  |  | 111 | private function \_handle($tag, $attributes) { |
  |  | 112 | $tag->handle($attributes); |
  |  | 113 | foreach ($tag->children as $child) { |
  |  | 114 | $originalAttributes = array\_merge($child->attributes); |
  |  | 115 | $originalStyle = $child->getStyle(); |
  |  | 116 | $mergedAttributes = $child->attributes; |
  |  | 117 | $mergedAttributes['style'] = ($attributes['style'] ?? '') . ';' . ($mergedAttributes['style'] ?? ''); |
  |  | 118 | $this->\_handle($child, $mergedAttributes); |
  |  | 119 | $child->attributes = $originalAttributes; |
  |  | 120 | if ($originalStyle !== null) { |
  |  | 121 | $child->setStyle($originalStyle); |
  |  | 122 | } |
  | 120 | 123 | } |
  | 121 | 124 | } |
  |  | 125 |  |
  |  | 126 | private function \_handleEnd($tag) { |
  |  | 127 | foreach ($tag->children as $child) { |
  |  | 128 | $this->\_handleEnd($child); |
  |  | 129 | } |
  |  | 130 | $tag->handleEnd(); |
  |  | 131 | } |
  | 122 | 132 | } |
* ## [woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php](/changeset/3076105/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php "Show the changeset 3076105 restricted to woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php")

  | [r3053443](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L2 "Show revision 3053443 of this file in browser") | [r3076105](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L2 "Show revision 3076105 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 | /\*\* |
  | 3 | 3 | \* Plugin Name:          PDF Invoices & Packing Slips for WooCommerce |
  |  | 4 | \* Requires Plugins:     woocommerce |
  | 4 | 5 | \* Plugin URI:           https://wpovernight.com/downloads/woocommerce-pdf-invoices-packing-slips-bundle/ |
  | 5 | 6 | \* Description:          Create, print & email PDF or UBL Invoices & PDF Packing Slips for WooCommerce orders. |
  | 6 |  | \* Version:              3.8.~~0~~ |
  |  | 7 | \* Version:              3.8.1 |
  | 7 | 8 | \* Author:               WP Overnight |
  | 8 | 9 | \* Author URI:           https://www.wpovernight.com |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L11) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L12) |  |
  | 11 | 12 | \* Text Domain:          woocommerce-pdf-invoices-packing-slips |
  | 12 | 13 | \* WC requires at least: 3.3 |
  | 13 |  | \* WC tested up to:      8.~~7~~ |
  |  | 14 | \* WC tested up to:      8.8 |
  | 14 | 15 | \*/ |
  | 15 | 16 |  |
  | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3053443#L22) | […](/browser/woocommerce-pdf-invoices-packing-slips/trunk/woocommerce-pdf-invoices-packingslips.php?rev=3076105#L23) |  |
  | 22 | 23 | class WPO\_WCPDF { |
  | 23 | 24 |  |
  | 24 |  | public $version              = '3.8.~~0~~'; |
  |  | 25 | public $version              = '3.8.1'; |
  | 25 | 26 | public $version\_php          = '7.2'; |
  | 26 | 27 | public $version\_woo          = '3.3'; |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3076105)
* [Zip Archive](?format=zip&new=3076105)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_dcf35496_20250111_071144.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# PDF Invoices & Packing Slips for WooCommerce <= 3.8.0 - Unauthenticated Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   PDF Invoices & Packing Slips for WooCommerce <= 3.8.0 - Unauthenticated Stored Cross-Site Scripting

7.2

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-3045](https://www.cve.org/CVERecord?id=CVE-2024-3045) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | April 24, 2024 |
| Last Updated | May 2, 2024 |
| Researcher | [Tim Coen](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/tim-coen) |

### Description

The PDF Invoices & Packing Slips for WooCommerce plugin for WordPress is vulnerable to Stored Cross-Site Scripting via several parameters in versions up to, and including, 3.8.0 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php#L16)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3076105/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-pdf-invoices-packing-slips%2Fpdf-invoices-packing-slips-for-woocommerce-380-unauthenticated-stored-cross-site-scripting&t=PDF%20Invoices%20%26%20Packing%20Slips%20for%20WooCommerce%20%3C%3D%203.8.0%20-%20Unauthenticated%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-pdf-invoices-packing-slips%2Fpdf-invoices-packing-slips-for-woocommerce-380-unauthenticated-stored-cross-site-scripting&text=PDF%20Invoices%20%26%20Packing%20Slips%20for%20WooCommerce%20%3C%3D%203.8.0%20-%20Unauthenticated%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoocommerce-pdf-invoices-packing-slips%2Fpdf-invoices-packing-slips-for-woocommerce-380-unauthenticated-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for PDF Invoices & Packing Slips for WooCommerce

#### [PDF Invoices & Packing Slips for WooCommerce](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-pdf-invoices-packing-slips)

| Software Type | Plugin |
| --- | --- |
| Software Slug | woocommerce-pdf-invoices-packing-slips [(view on wordpress.org)](https://wordpress.org/plugins/woocommerce-pdf-invoices-packing-slips) |
| Patched? | Yes |
| Remediation | Update to version 3.8.1, or a newer patched version |
| Affected Version | * <= 3.8.0 |
| Patched Version | * 3.8.1 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_61a6b058_20250111_071127.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwoocommerce-pdf-invoices-packing-slips%2Ftrunk%2Fubl%2FTransformers%2FAddressTransformer.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?rev=3098426 "Revision 3098426")
* Next Revision →
* [Blame](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php)

---

# [source:](/browser?order=name "Go to repository root") [woocommerce-pdf-invoices-packing-slips](/browser/woocommerce-pdf-invoices-packing-slips?order=name "View woocommerce-pdf-invoices-packing-slips")/[trunk](/browser/woocommerce-pdf-invoices-packing-slips/trunk?order=name "View trunk")/[ubl](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl?order=name "View ubl")/[Transformers](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers?order=name "View Transformers")/[AddressTransformer.php](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?order=name "View AddressTransformer.php")

View diff against:

View revision:

| [Last change](/changeset/3172998/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php "View differences") on this file was [3172998](/changeset/3172998/ "View changeset 3172998"), checked in by wpovernight, [3 months ago](/timeline?from=2024-10-21T14%3A21%3A16Z&precision=second "See timeline at 10/21/2024 02:21:16 PM") |
| --- |
| Release version 3.9.0 |
| **File size:** 1.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | namespace WPO\IPS\UBL\Transformers; |
| [4](#L4) |  |
| [5](#L5) | use WPO\IPS\UBL\Models\Address; |
| [6](#L6) |  |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; // Exit if accessed directly |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | class AddressTransformer { |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* @return Address |
| [15](#L15) | \*/ |
| [16](#L16) | public function transform( \WC\_Abstract\_Order $item, $billing\_or\_shipping ) { |
| [17](#L17) | $model             = new Address(); |
| [18](#L18) | $model->address\_1  = $item->{'get\_'.$billing\_or\_shipping.'\_address\_1'}(); |
| [19](#L19) | $model->address\_2  = $item->{'get\_'.$billing\_or\_shipping.'\_address\_2'}(); |
| [20](#L20) | $model->first\_name = $item->{'get\_'.$billing\_or\_shipping.'\_first\_name'}(); |
| [21](#L21) | $model->last\_name  = $item->{'get\_'.$billing\_or\_shipping.'\_last\_name'}(); |
| [22](#L22) | $model->city       = $item->{'get\_'.$billing\_or\_shipping.'\_city'}(); |
| [23](#L23) | $model->state      = $item->{'get\_'.$billing\_or\_shipping.'\_state'}(); |
| [24](#L24) | $model->postcode   = $item->{'get\_'.$billing\_or\_shipping.'\_postcode'}(); |
| [25](#L25) | $model->country    = $item->{'get\_'.$billing\_or\_shipping.'\_country'}(); |
| [26](#L26) |  |
| [27](#L27) | if ( 'billing' === $billing\_or\_shipping ) { |
| [28](#L28) | $model->email = sanitize\_email( $item->get\_billing\_email() ); |
| [29](#L29) | $model->phone = wpo\_wcpdf\_sanitize\_phone\_number( $item->get\_billing\_phone() ); |
| [30](#L30) | } |
| [31](#L31) |  |
| [32](#L32) | return $model; |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php?format=txt)
* [Original Format](/export/3220599/woocommerce-pdf-invoices-packing-slips/trunk/ubl/Transformers/AddressTransformer.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


