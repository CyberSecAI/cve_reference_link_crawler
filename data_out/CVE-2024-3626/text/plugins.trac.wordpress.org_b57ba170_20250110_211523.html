

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3072302%2540email-subscribers%252Ftrunk%26old%3D3069441%2540email-subscribers%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3069441/email-subscribers/trunk?old=3072302&old_path=%2Femail-subscribers%2Ftrunk)

---

# Changes in [email-subscribers/trunk](/browser/email-subscribers/trunk?rev=3072302 "Show entry in browser") [[3069441:3072302]](/log/email-subscribers/trunk?rev=3072302&stop_rev=3069441 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[email-subscribers/trunk](/browser/email-subscribers/trunk?rev=3072302)
Files:

37 edited

* [email-subscribers.php](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))
* [lite/admin/class-email-subscribers-admin.php](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [lite/admin/js/email-subscribers-admin.js](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [lite/includes/class-email-subscribers-uninstall.php](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [lite/includes/class-email-subscribers.php](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [lite/includes/class-es-common.php](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [lite/includes/class-es-install.php](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [lite/includes/class-es-plugin-usage-data-collector.php](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))
* [lite/includes/classes/class-es-actions.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file8 "Show differences"))
* [lite/includes/classes/class-es-admin-settings.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file9 "Show differences"))
* [lite/includes/classes/class-es-contacts-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [lite/includes/classes/class-es-cron.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [lite/includes/classes/class-es-forms-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [lite/includes/classes/class-es-import-subscribers.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([7 diffs](#file13 "Show differences"))
* [lite/includes/classes/class-es-post-notifications.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [lite/includes/classes/class-es-queue.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file15 "Show differences"))
* [lite/includes/classes/class-es-reports-data.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file16 "Show differences"))
* [lite/includes/classes/class-es-subscription-throttling.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [lite/includes/classes/class-es-templates-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [lite/includes/controllers/class-es-campaign-controller.php](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302 "Show entry in browser")
  (modified)
  ([14 diffs](#file19 "Show differences"))
* [lite/includes/db/class-es-db-actions.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([18 diffs](#file20 "Show differences"))
* [lite/includes/db/class-es-db-campaigns.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302 "Show entry in browser")
  (modified)
  ([9 diffs](#file21 "Show differences"))
* [lite/includes/db/class-es-db-contacts.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302 "Show entry in browser")
  (modified)
  ([13 diffs](#file22 "Show differences"))
* [lite/includes/db/class-es-db-forms.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file23 "Show differences"))
* [lite/includes/db/class-es-db-lists.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file24 "Show differences"))
* [lite/includes/db/class-es-db-mailing-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([36 diffs](#file25 "Show differences"))
* [lite/includes/db/class-es-db-notifications.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file26 "Show differences"))
* [lite/includes/db/class-es-db-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file27 "Show differences"))
* [lite/includes/db/class-es-db-sending-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([21 diffs](#file28 "Show differences"))
* [lite/includes/db/class-es-db.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file29 "Show differences"))
* [lite/includes/db/class-ig-es-db-unsubscribe-feedback.php](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file30 "Show differences"))
* [lite/includes/feedback/class-ig-feedback.php](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file31 "Show differences"))
* [lite/includes/upgrade/es-update-functions.php](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [lite/includes/workflows/class-es-workflow-action-preview.php](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file33 "Show differences"))
* [lite/includes/workflows/class-es-workflow.php](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [lite/includes/workflows/db/class-es-db-workflows.php](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [readme.txt](/browser/email-subscribers/trunk/readme.txt?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file36 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [email-subscribers/trunk/email-subscribers.php](/changeset/3072302/email-subscribers/trunk/email-subscribers.php?old=3069441&old_path=email-subscribers%2Ftrunk%2Femail-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/email-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L4 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L4 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://www.icegram.com/ |
  | 5 | 5 | \* Description: Add subscription forms on website, send HTML newsletters & automatically notify subscribers about new blog posts once it is published. |
  | 6 |  | \* Version: 5.7.1~~7~~ |
  |  | 6 | \* Version: 5.7.18 |
  | 7 | 7 | \* Author: Icegram |
  | 8 | 8 | \* Author URI: https://www.icegram.com/ |
  | 9 | 9 | \* Requires at least: 3.9 |
  | 10 |  | \* Tested up to: 6.~~4.1~~ |
  |  | 10 | \* Tested up to: 6.5.2 |
  | 11 | 11 | \* WC requires at least: 3.6.0 |
  | 12 | 12 | \* WC tested up to: 8.0.2 |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L188) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L188) |  |
  | 188 | 188 |  |
  | 189 | 189 | if ( ! defined( 'ES\_PLUGIN\_VERSION' ) ) { |
  | 190 |  | define( 'ES\_PLUGIN\_VERSION', '5.7.1~~7~~' ); |
  |  | 190 | define( 'ES\_PLUGIN\_VERSION', '5.7.18' ); |
  | 191 | 191 | } |
  | 192 | 192 |  |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L269) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L269) |  |
  | 269 | 269 |  |
  | 270 | 270 | // Get all active blogs in the network and activate plugin on each one |
  |  | 271 | // phpcs:disable |
  | 271 | 272 | $blog\_ids = $wpdb->get\_col( $wpdb->prepare( "SELECT blog\_id FROM $wpdb->blogs WHERE deleted = %d", 0 ) ); |
  |  | 273 | // phpcs:enable |
  | 272 | 274 | foreach ( $blog\_ids as $blog\_id ) { |
  | 273 | 275 | ig\_es\_activate\_on\_blog( $blog\_id ); |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L296) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L298) |  |
  | 296 | 298 |  |
  | 297 | 299 | // Get all active blogs in the network. |
  |  | 300 | // phpcs:disable |
  | 298 | 301 | $blog\_ids = $wpdb->get\_col( $wpdb->prepare( "SELECT blog\_id FROM $wpdb->blogs WHERE deleted = %d", 0 ) ); |
  |  | 302 | // phpcs:enable |
  | 299 | 303 | foreach ( $blog\_ids as $blog\_id ) { |
  | 300 | 304 | // Run deactivation code on each one |
* ## [email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php](/changeset/3072302/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fadmin%2Fclass-email-subscribers-admin.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3060251#L845 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3072302#L845 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 845 | 845 |  |
  | 846 | 846 | die( json\_encode( $response\_data ) ); |
  | 847 |  | ~~}~~ |
  | 848 |  |  |
  | 849 |  | ~~public function get\_template\_content() {~~ |
  | 850 |  | ~~global $ig\_es\_tracker;~~ |
  | 851 |  |  |
  | 852 |  | ~~$template\_id = (int) ig\_es\_get\_request\_data( 'template\_id', 0 );~~ |
  | 853 |  | ~~if ( 0 == $template\_id ) {~~ |
  | 854 |  | ~~return 0;~~ |
  | 855 |  | ~~}~~ |
  | 856 |  | ~~$post\_temp\_arr     = get\_post( $template\_id );~~ |
  | 857 |  | ~~$result['subject'] = ! empty( $post\_temp\_arr->post\_title ) ? $post\_temp\_arr->post\_title : '';~~ |
  | 858 |  | ~~$result['body']    = ! empty( $post\_temp\_arr->post\_content ) ? $post\_temp\_arr->post\_content : '';~~ |
  | 859 |  | ~~// get meta data of template~~ |
  | 860 |  | ~~// $active\_plugins = $ig\_es\_tracker::get\_active\_plugins();~~ |
  | 861 |  | ~~if ( ES()->is\_starter() ) {~~ |
  | 862 |  | ~~$result['inline\_css']      = get\_post\_meta( $template\_id, 'es\_custom\_css', true );~~ |
  | 863 |  | ~~$result['es\_utm\_campaign'] = get\_post\_meta( $template\_id, 'es\_utm\_campaign', true );~~ |
  | 864 |  | ~~}~~ |
  | 865 |  |  |
  | 866 |  | ~~die( json\_encode( $result ) );~~ |
  | 867 | 847 | } |
  | 868 | 848 |  |
* ## [email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js](/changeset/3072302/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?old=3026595&old_path=email-subscribers%2Ftrunk%2Flite%2Fadmin%2Fjs%2Femail-subscribers-admin.js "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js")

  | [r3069441](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3026595#L990 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3072302#L990 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 990 | 990 | jQuery(this).ig\_es\_select2().trigger('change'); |
  | 991 | 991 | }); |
  | 992 |  | ~~}~~ |
  | 993 |  | ~~});~~ |
  | 994 |  | ~~});~~ |
  | 995 |  |  |
  | 996 |  | ~~jQuery(document).on('change', '#broadcast\_form #base\_template\_id', function () {~~ |
  | 997 |  | ~~var template\_id = $(this).val();~~ |
  | 998 |  | ~~// Update total count in lists~~ |
  | 999 |  | ~~var params = {~~ |
  | 1000 |  | ~~action: 'get\_template\_content',~~ |
  | 1001 |  | ~~template\_id: template\_id,~~ |
  | 1002 |  | ~~};~~ |
  | 1003 |  | ~~$.ajax({~~ |
  | 1004 |  | ~~method: 'POST',~~ |
  | 1005 |  | ~~url: ajaxurl,~~ |
  | 1006 |  | ~~async: false,~~ |
  | 1007 |  | ~~data: params,~~ |
  | 1008 |  | ~~success: function (response) {~~ |
  | 1009 |  | ~~if (response !== '') {~~ |
  | 1010 |  | ~~response = JSON.parse(response);~~ |
  | 1011 |  | ~~if (response.hasOwnProperty('subject')) {~~ |
  | 1012 |  | ~~jQuery('.wp-editor-boradcast').val(response.body);~~ |
  | 1013 |  | ~~if ('undefined' !== typeof tinyMCE) {~~ |
  | 1014 |  |  |
  | 1015 |  | ~~var activeEditor = tinyMCE.get('edit-es-broadcast-body');~~ |
  | 1016 |  |  |
  | 1017 |  | ~~if (activeEditor !== null) { // Make sure we're not calling setContent on null~~ |
  | 1018 |  | ~~response.body = response.body.replace(/\n/g, "<br />");~~ |
  | 1019 |  | ~~activeEditor.setContent(response.body); // Update tinyMCE's content~~ |
  | 1020 |  |  |
  | 1021 |  | ~~}~~ |
  | 1022 |  | ~~}~~ |
  | 1023 |  |  |
  | 1024 |  | ~~if (response.inline\_css && jQuery('#inline\_css').length) {~~ |
  | 1025 |  | ~~jQuery('#inline\_css').val(response.inline\_css);~~ |
  | 1026 |  | ~~}~~ |
  | 1027 |  | ~~if (response.es\_utm\_campaign && jQuery('#es\_utm\_campaign').length) {~~ |
  | 1028 |  | ~~jQuery('#es\_utm\_campaign').val(response.es\_utm\_campaign);~~ |
  | 1029 |  | ~~}~~ |
  | 1030 |  |  |
  | 1031 |  | ~~if ( 1 === $('#edit-es-broadcast-body').length ) {~~ |
  | 1032 |  | ~~ig\_es\_sync\_wp\_editor\_content();~~ |
  | 1033 |  | ~~$('#edit-es-broadcast-body').trigger('change');~~ |
  | 1034 |  | ~~}~~ |
  | 1035 |  | ~~}~~ |
  | 1036 |  | ~~}~~ |
  | 1037 |  | ~~}~~ |
  | 1038 |  | ~~});~~ |
  | 1039 |  | ~~});~~ |
  | 1040 |  |  |
  | 1041 |  | ~~jQuery(document).on('change', '#campaign\_form #base\_template\_id, #campaign\_form #post\_digest\_template\_id', function () {~~ |
  | 1042 |  | ~~var template\_id = $(this).val();~~ |
  | 1043 |  | ~~// Update total count in lists~~ |
  | 1044 |  | ~~var params = {~~ |
  | 1045 |  | ~~action: 'get\_template\_content',~~ |
  | 1046 |  | ~~template\_id: template\_id,~~ |
  | 1047 |  | ~~};~~ |
  | 1048 |  | ~~$.ajax({~~ |
  | 1049 |  | ~~method: 'POST',~~ |
  | 1050 |  | ~~url: ajaxurl,~~ |
  | 1051 |  | ~~async: false,~~ |
  | 1052 |  | ~~data: params,~~ |
  | 1053 |  | ~~success: function (response) {~~ |
  | 1054 |  | ~~if (response !== '') {~~ |
  | 1055 |  | ~~response = JSON.parse(response);~~ |
  | 1056 |  | ~~if (response.hasOwnProperty('subject')) {~~ |
  | 1057 |  | ~~jQuery('#ig\_es\_campaign\_subject').val(response.subject);~~ |
  | 1058 |  | ~~jQuery('.wp-campaign-body-editor').val(response.body);~~ |
  | 1059 |  | ~~if ('undefined' !== typeof tinyMCE) {~~ |
  | 1060 |  |  |
  | 1061 |  | ~~var activeEditor = tinyMCE.get('edit-es-campaign-body');~~ |
  | 1062 |  |  |
  | 1063 |  | ~~if (activeEditor !== null) { // Make sure we're not calling setContent on null~~ |
  | 1064 |  | ~~response.body = response.body.replace(/\n/g, "<br />");~~ |
  | 1065 |  | ~~activeEditor.setContent(response.body); // Update tinyMCE's content~~ |
  | 1066 |  | ~~}~~ |
  | 1067 |  | ~~}~~ |
  | 1068 |  |  |
  | 1069 |  | ~~if (response.inline\_css && jQuery('#inline\_css').length) {~~ |
  | 1070 |  | ~~jQuery('#inline\_css').val(response.inline\_css);~~ |
  | 1071 |  | ~~}~~ |
  | 1072 |  | ~~if (response.es\_utm\_campaign && jQuery('#es\_utm\_campaign').length) {~~ |
  | 1073 |  | ~~jQuery('#es\_utm\_campaign').val(response.es\_utm\_campaign);~~ |
  | 1074 |  | ~~}~~ |
  | 1075 |  |  |
  | 1076 |  | ~~if ( 1 === $('#edit-es-campaign-body').length ) {~~ |
  | 1077 |  | ~~ig\_es\_sync\_wp\_editor\_content();~~ |
  | 1078 |  | ~~$('#edit-es-campaign-body').trigger('change');~~ |
  | 1079 |  | ~~}~~ |
  | 1080 |  | ~~}~~ |
  | 1081 |  | ~~}~~ |
  | 1082 | 992 | } |
  | 1083 | 993 | }); |
* ## [email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-email-subscribers-uninstall.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=2602749#L82 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302#L82 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 82 | 82 | update\_option( 'sidebars\_widgets', $sidebars\_widgets ); |
  | 83 | 83 | delete\_option( 'widget\_email-subscribers-form' ); |
  | 84 |  |  |
  |  | 84 | // phpcs:disable |
  | 85 | 85 | // Delete postmeta data |
  | 86 | 86 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}postmeta where post\_id IN ( SELECT ID from {$wpdb->prefix}posts where post\_type  = %s)", $post\_type ) ); |
  | […](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=2602749#L91) | […](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302#L91) |  |
  | 91 | 91 | // Delete all options from options table with prefix ig\_es |
  | 92 | 92 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}options WHERE option\_name LIKE %s", $option\_name ) ); |
  |  | 93 | // phpcs:enable |
  | 93 | 94 | } |
  | 94 | 95 |  |
* ## [email-subscribers/trunk/lite/includes/class-email-subscribers.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-email-subscribers.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-email-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-email-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3051406#L1061 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3072302#L1061 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1061 | 1061 | $this->loader->add\_filter( 'set-screen-option', $plugin\_admin, 'save\_screen\_options', 20, 3 ); |
  | 1062 | 1062 | $this->loader->add\_action( 'wp\_ajax\_count\_contacts\_by\_list', $plugin\_admin, 'count\_contacts\_by\_list' ); |
  | 1063 |  | ~~$this->loader->add\_action( 'wp\_ajax\_get\_template\_content', $plugin\_admin, 'get\_template\_content' );~~ |
  | 1064 | 1063 | $this->loader->add\_action( 'admin\_print\_scripts', $plugin\_admin, 'remove\_other\_admin\_notices' ); |
  | 1065 | 1064 |  |
* ## [email-subscribers/trunk/lite/includes/class-es-common.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-common.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-common.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-common.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L650 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L650 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 650 | 650 | \*/ |
  | 651 | 651 | public static function get\_templates( $type = '', $editor\_type = '' ) { |
  | 652 |  |  |
  |  | 652 | // phpcs:diable WordPressVIPMinimum.Performance.WPQueryParams.SuppressFilters\_suppress\_filters |
  | 653 | 653 | $es\_args = array( |
  | 654 | 654 | 'posts\_per\_page'   => - 1, |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L657) | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L657) |  |
  | 657 | 657 | 'order'            => 'DESC', |
  | 658 | 658 | 'post\_status'      => 'publish', |
  | 659 |  | 'suppress\_filters' => true, |
  |  | 659 | 'suppress\_filters' => true, |
  | 660 | 660 | ); |
  | 661 |  |  |
  |  | 661 | // phpcs:enable |
  | 662 | 662 | if ( ! empty( $type ) ) { |
  | 663 | 663 | $es\_args['meta\_query'][] = array( |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L2754) | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L2754) |  |
  | 2754 | 2754 |  |
  | 2755 | 2755 | global $wpdb; |
  | 2756 |  |  |
  |  | 2756 | // phpcs:disable |
  | 2757 | 2757 | $results = $wpdb->get\_results( "SELECT DISTINCT MONTHNAME(`start\_at`), YEAR(`start\_at`) FROM {$wpdb->prefix}ig\_mailing\_queue;", ARRAY\_A ); |
  | 2758 |  |  |
  |  | 2758 | // phpcs:enable |
  | 2759 | 2759 | $field\_options = array( |
  | 2760 | 2760 | 'default' => $default\_label |
* ## [email-subscribers/trunk/lite/includes/class-es-install.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-install.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-install.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-install.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3046188#L463 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302#L463 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 463 | 463 | $running\_migration\_queue\_like = '%' . $wpdb->esc\_like( '\_running\_migration\_for\_' ) . '%'; |
  | 464 | 464 | $db\_migration\_queue\_like      = '%' . $wpdb->esc\_like( 'ig\_es\_updater\_batch\_' ) . '%'; |
  | 465 |  |  |
  |  | 465 | // phpcs:disable |
  | 466 | 466 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}options WHERE option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s", $transient\_like, $updating\_like, $last\_sent\_queue\_like, $running\_migration\_queue\_like, $db\_migration\_queue\_like ) ); |
  | 467 |  |  |
  |  | 467 | // phpcs:enable |
  | 468 | 468 | } |
  | 469 | 469 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3046188#L1585) | […](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302#L1585) |  |
  | 1585 | 1585 | $templates = apply\_filters( 'ig\_es\_email\_templates', $templates ); |
  | 1586 | 1586 | $post\_type = 'es\_template'; |
  | 1587 |  |  |
  |  | 1587 | // phpcs:disable |
  | 1588 | 1588 | $imported\_templ = $wpdb->get\_col( $wpdb->prepare( "SELECT post\_name FROM {$wpdb->prefix}posts where post\_type  = %s", $post\_type ) ); |
  | 1589 |  |  |
  |  | 1589 | // phpcs:enable |
  | 1590 | 1590 | if ( is\_array( $templates ) && count( $templates ) > 0 ) { |
  | 1591 | 1591 |  |
* ## [email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?old=2940165&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-plugin-usage-data-collector.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=2940165#L135 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302#L135 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 135 | 135 |  |
  | 136 | 136 | $option\_name\_like = 'ig\_es\_%'; |
  |  | 137 | // phpcs:disable |
  | 137 | 138 | $results          = $wpdb->get\_results( $wpdb->prepare( "SELECT option\_name, option\_value FROM {$wpdb->prefix}options WHERE option\_name LIKE %s  AND option\_name != %s", $option\_name\_like, 'ig\_es\_managed\_blocked\_domains' ), ARRAY\_A ); |
  | 138 |  |  |
  |  | 139 | // phpcs:enable |
  | 139 | 140 | $options\_name\_value\_map = array(); |
  | 140 | 141 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=2940165#L168) | […](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302#L169) |  |
  | 168 | 169 | return 'no'; |
  | 169 | 170 | } |
  | 170 |  |  |
  |  | 171 | global $wpdb; |
  | 171 | 172 | // Ensure there is atleast one users for whom REST API keys are generated |
  | 172 |  | $rest\_api\_users\_ids = get\_users( array( |
  | 173 |  | 'meta\_key' => 'ig\_es\_rest\_api\_keys', |
  | 174 |  | 'fields'   => 'ID' |
  | 175 |  | ) ); |
  |  | 173 | $rest\_api\_users\_ids = $wpdb->get\_col( |
  |  | 174 | $wpdb->prepare( |
  |  | 175 | "SELECT user\_id FROM $wpdb->usermeta WHERE meta\_key = 'ig\_es\_rest\_api\_keys'" |
  |  | 176 | ) |
  |  | 177 | ); |
  | 176 | 178 |  |
  | 177 | 179 | if ( empty( $rest\_api\_users\_ids ) ) { |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-actions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?old=2843300&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-actions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-actions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=2843300#L303 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302#L303 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 303 | 303 |  |
  | 304 | 304 | global $wpdb; |
  | 305 |  |  |
  |  | 305 | // phpcs:disable |
  | 306 | 306 | $sql = $wpdb->get\_var( $wpdb->prepare( "SELECT count(\*) FROM {$wpdb->prefix}ig\_actions WHERE contact\_id = %d AND message\_id = %d AND campaign\_id = %d AND type = %d ", $contact\_id, $message\_id, $campaign\_id, IG\_MESSAGE\_SENT ) ); |
  |  | 307 | // phpcs:enable |
  | 307 | 308 | return $sql; |
  | 308 | 309 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=2843300#L327) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302#L328) |  |
  | 327 | 328 |  |
  | 328 | 329 | $current\_date = ig\_get\_current\_date\_time(); |
  |  | 330 | // phpcs:disable |
  | 329 | 331 | $sql          = $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_sending\_queue SET opened\_at = %s, opened = %d WHERE contact\_id = %d AND campaign\_id = %d AND mailing\_queue\_id = %d", $current\_date, 1, $conact\_id, $campaign\_id, $message\_id ) ); |
  | 330 |  |  |
  |  | 332 | // phpcs:enable |
  | 331 | 333 | return $sql; |
  | 332 | 334 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?old=2993694&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-admin-settings.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1221 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1221 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | public static function render\_rest\_api\_keys\_section() { |
  | 1222 | 1222 | ob\_start(); |
  | 1223 |  | $rest\_api\_keys = get\_option( 'ig\_es\_rest\_api\_keys', array() ); |
  | 1224 |  |  |
  | 1225 |  | $rest\_api\_users\_ids = get\_users( array( |
  | 1226 |  | 'meta\_key' => 'ig\_es\_rest\_api\_keys', |
  | 1227 |  | 'fields'   => 'ID' |
  | 1228 |  | ) ); |
  |  | 1223 | $rest\_api\_keys = get\_option('ig\_es\_rest\_api\_keys', array()); |
  |  | 1224 |  |
  |  | 1225 |  |
  |  | 1226 | $admin\_users = get\_users(array( |
  |  | 1227 | 'role'   => 'administrator', |
  |  | 1228 | 'fields' => array('ID', 'user\_email', 'user\_login'), |
  |  | 1229 | )); |
  | 1229 | 1230 | ?> |
  | 1230 | 1231 | <div id="ig-es-rest-api-section"> |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1232) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1233) |  |
  | 1232 | 1233 | <thead> |
  | 1233 | 1234 | <tr class="bg-blue-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider"> |
  | 1234 |  | <th class="px-5 py-4"><?php echo esc\_html\_\_(~~'Key', 'email-subscribers'~~ ); ?></th> |
  | 1235 |  | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_(~~'Username', 'email-subscribers'~~ ); ?></th> |
  | 1236 |  | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_(~~'Actions', 'email-subscribers'~~ ); ?></th> |
  |  | 1235 | <th class="px-5 py-4"><?php echo esc\_html\_\_('Key', 'email-subscribers'); ?></th> |
  |  | 1236 | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_('Username', 'email-subscribers'); ?></th> |
  |  | 1237 | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_('Actions', 'email-subscribers'); ?></th> |
  | 1237 | 1238 | </tr> |
  | 1238 | 1239 | </thead> |
  | 1239 | 1240 | <tbody class="bg-blue-50"> |
  | 1240 |  | <?php |
  | 1241 |  | if ( ! empty( $rest\_api\_users\_ids ) ) { |
  | 1242 |  | foreach ( $rest\_api\_users\_ids as $user\_id ) { |
  | 1243 |  | $user = get\_userdata( $user\_id ); |
  | 1244 |  | if ( ! $user ) { |
  | 1245 |  | continue; |
  | 1246 |  | } |
  | 1247 |  | $rest\_api\_keys = get\_user\_meta( $user\_id, 'ig\_es\_rest\_api\_keys', true ); |
  | 1248 |  | if ( ! empty( $rest\_api\_keys ) ) { |
  | 1249 |  | foreach ( $rest\_api\_keys as $index => $rest\_api\_key ) { |
  | 1250 |  | $key\_start = substr( $rest\_api\_key, 0, 4 ); |
  | 1251 |  | $key\_end   = substr( $rest\_api\_key, strlen( $rest\_api\_key ) - 4, 4 ); |
  | 1252 |  | ?> |
  | 1253 |  | <tr class="ig-es-rest-api-row border-b border-gray-200 text-xs leading-4 font-medium" data-user-id="<?php echo esc\_attr( $user\_id ); ?>" data-api-index="<?php echo esc\_attr( $index ); ?>"> |
  | 1254 |  | <td class="px-5 py-4 text-center"><?php echo esc\_html( $key\_start ); ?>\*\*\*\*\*\*\*\*\*\*\*<?php echo esc\_html( $key\_end ); ?></td> |
  | 1255 |  | <td class="px-2 py-4 text-center"><?php echo esc\_html( $user->data->user\_login ); ?></td> |
  |  | 1241 | <?php |
  |  | 1242 | if (!empty($admin\_users)) { |
  |  | 1243 | foreach ($admin\_users as $user) { |
  |  | 1244 | $rest\_api\_keys = get\_user\_meta($user->ID, 'ig\_es\_rest\_api\_keys', true); |
  |  | 1245 | if (!empty($rest\_api\_keys)) { |
  |  | 1246 | foreach ($rest\_api\_keys as $index => $rest\_api\_key) { |
  |  | 1247 | $key\_start = substr($rest\_api\_key, 0, 4); |
  |  | 1248 | $key\_end = substr($rest\_api\_key, -4); |
  |  | 1249 | ?> |
  |  | 1250 | <tr class="ig-es-rest-api-row border-b border-gray-200 text-xs leading-4 font-medium" |
  |  | 1251 | data-user-id="<?php echo esc\_attr($user->ID); ?>" |
  |  | 1252 | data-api-index="<?php echo esc\_attr($index); ?>"> |
  |  | 1253 | <td class="px-5 py-4 text-center"><?php echo esc\_html($key\_start); ?>\*\*\*\*\*\*\*\*\*\*\*<?php echo esc\_html($key\_end); ?></td> |
  |  | 1254 | <td class="px-2 py-4 text-center"><?php echo esc\_html($user->user\_login); ?></td> |
  | 1256 | 1255 | <td class="px-2 py-4 text-center"> |
  | 1257 |  | <a class="ig-es-delete-rest-api-key inline-block" href="#"> |
  | 1258 |  | <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"> |
  | 1259 |  | <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /> |
  | 1260 |  | </svg> |
  | 1261 |  | </a> |
  |  | 1256 | <a class="ig-es-delete-rest-api-key inline-block" href="#"> |
  |  | 1257 | <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" |
  |  | 1258 | stroke-width="1.5" stroke="currentColor" class="w-6 h-6"> |
  |  | 1259 | <path stroke-linecap="round" stroke-linejoin="round" |
  |  | 1260 | d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/> |
  |  | 1261 | </svg> |
  |  | 1262 | </a> |
  | 1262 | 1263 | </td> |
  | 1263 | 1264 | </tr> |
  | 1264 | 1265 | <?php |
  | 1265 |  | ~~}~~ |
  | 1266 | 1266 | } |
  | 1267 |  | ~~?>~~ |
  | 1268 |  | ~~<?php~~ |
  | 1269 | 1267 | } |
  | 1270 | 1268 | } |
  | 1271 |  | ?> |
  | 1272 |  | <tr id="ig-es-no-api-keys-message" class="border-b border-gray-200 text-xs leading-4 font-medium"> |
  | 1273 |  | <td colspan="3" class="px-5 py-4 text-center"> |
  | 1274 |  | <?php echo esc\_html\_\_( 'No API keys found.', 'email-subscribers' ); ?> |
  | 1275 |  | </td> |
  | 1276 |  | </tr> |
  |  | 1269 | } |
  |  | 1270 | ?> |
  |  | 1271 | <tr id="ig-es-no-api-keys-message" class="border-b border-gray-200 text-xs leading-4 font-medium"> |
  |  | 1272 | <td colspan="3" class="px-5 py-4 text-center"> |
  |  | 1273 | <?php echo esc\_html\_\_('No API keys found.', 'email-subscribers'); ?> |
  |  | 1274 | </td> |
  |  | 1275 | </tr> |
  | 1277 | 1276 | </tbody> |
  | 1278 | 1277 | </table> |
  | 1279 | 1278 | <div id="ig-es-create-new-rest-api-container" class="mt-2"> |
  | 1280 |  | ~~<?php~~ |
  | 1281 |  | ~~$admin\_users = get\_users(~~ |
  | 1282 |  | ~~array(~~ |
  | 1283 |  | ~~'role' => 'administrator'~~ |
  | 1284 |  | ~~)~~ |
  | 1285 |  | ~~);~~ |
  | 1286 |  | ~~?>~~ |
  | 1287 | 1279 | <select id="ig-es-rest-api-user-id"> |
  | 1288 |  | <option value=""><?php echo esc\_html\_\_(~~'Please select a user', 'email-subscribers'~~ ); ?></option> |
  |  | 1280 | <option value=""><?php echo esc\_html\_\_('Please select a user', 'email-subscribers'); ?></option> |
  | 1289 | 1281 | <?php |
  | 1290 |  | foreach (~~$admin\_users as $user~~ ) { |
  |  | 1282 | foreach ($admin\_users as $user) { |
  | 1291 | 1283 | ?> |
  | 1292 |  | <option value="<?php echo esc\_attr(~~$user->ID ); ?>"><?php echo esc\_html( $user->data->user\_email~~ ); ?></option> |
  |  | 1284 | <option value="<?php echo esc\_attr($user->ID); ?>"><?php echo esc\_html($user->user\_email); ?></option> |
  | 1293 | 1285 | <?php |
  | 1294 | 1286 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1297) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1289) |  |
  | 1297 | 1289 | <button type="button" id="ig-es-generate-rest-api-key" class="ig-es-title-button ml-2 align-middle ig-es-inline-loader"> |
  | 1298 | 1290 | <span> |
  | 1299 |  | <?php echo esc\_html\_\_(~~'Generate API key', 'email-subscribers'~~ ); ?> |
  |  | 1291 | <?php echo esc\_html\_\_('Generate API key', 'email-subscribers'); ?> |
  | 1300 | 1292 | </span> |
  | 1301 | 1293 | <svg class="es-btn-loader animate-spin h-4 w-4 text-indigo" |
  | 1302 |  | xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> |
  |  | 1294 | xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> |
  | 1303 | 1295 | <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" |
  | 1304 | 1296 | stroke-width="4"></circle> |
  | 1305 | 1297 | <path class="opacity-75" fill="currentColor" |
  | 1306 |  | d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> |
  |  | 1298 | d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> |
  | 1307 | 1299 | </svg> |
  | 1308 | 1300 | </button> |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-contacts-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3060251#L1537 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302#L1537 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1537 | 1537 | return $response; |
  | 1538 | 1538 | } |
  | 1539 |  |  |
  |  | 1539 | // phpcs:disable |
  | 1540 | 1540 | $edited = ES()->lists\_contacts\_db->add\_contacts\_to\_list( $subscriber\_ids, $list\_id ); |
  | 1541 |  |  |
  |  | 1541 | // phpcs:enable |
  | 1542 | 1542 | if ( $edited ) { |
  | 1543 | 1543 | $message = \_\_( 'Contact(s) added to list successfully!', 'email-subscribers' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3060251#L1569) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302#L1569) |  |
  | 1569 | 1569 |  |
  | 1570 | 1570 | global $wpdb; |
  | 1571 |  |  |
  |  | 1571 | // phpcs:disable |
  | 1572 | 1572 | $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_contacts SET form\_id = %d WHERE form\_id = %d", 0, $form\_id ) ); |
  |  | 1573 | // phpcs:enable |
  | 1573 | 1574 | } |
  | 1574 | 1575 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-cron.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-cron.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-cron.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3046188#L269 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3072302#L269 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 269 | 269 |  |
  | 270 | 270 | $lock = 'ig\_es\_cron\_lock\_' . $key . '%'; |
  | 271 |  |  |
  |  | 271 | // phpcs:disable |
  | 272 | 272 | $res = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(\*) FROM {$wpdb->prefix}options WHERE option\_name LIKE %s AND option\_value != ''", $lock ) ); |
  | 273 |  |  |
  |  | 273 | // phpcs:enable |
  | 274 | 274 | return ! ! $res; |
  | 275 | 275 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-forms-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3060251#L513 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3072302#L513 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 513 | 513 | // We don't want to change the created\_at date for update |
  | 514 | 514 | unset( $form\_data['created\_at'] ); |
  |  | 515 | // phpcs:disable |
  | 515 | 516 | $return = $wpdb->update( IG\_FORMS\_TABLE, $form\_data, array( 'id' => $id ) ); |
  | 516 | 517 | } else { |
  | 517 | 518 | $return = $wpdb->insert( IG\_FORMS\_TABLE, $form\_data ); |
  | 518 | 519 | } |
  |  | 520 | // phpcs:enable |
  | 519 | 521 |  |
  | 520 | 522 | return $return; |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?old=3063438&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-import-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L598 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L598 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 598 | 598 | } elseif ( 'wordpress\_users' === $importing\_from ) { |
  | 599 | 599 | $roles = ig\_es\_get\_request\_data( 'selected\_roles' ); |
  | 600 |  |  |
  |  | 600 | // phpcs:disable |
  | 601 | 601 | $users = $wpdb->get\_results( |
  | 602 | 602 | "SELECT u.user\_email, IF(meta\_role.meta\_value = 'a:0:{}',NULL,meta\_role.meta\_value) AS '\_role', meta\_firstname.meta\_value AS 'firstname', meta\_lastname.meta\_value AS 'lastname', u.display\_name, u.user\_nicename |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L607) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L607) |  |
  | 607 | 607 | WHERE meta\_role.user\_id IS NOT NULL" |
  | 608 | 608 | ); |
  | 609 |  |  |
  |  | 609 | // phpcs:enable |
  | 610 | 610 | if ( ! empty( $users ) ) { |
  | 611 | 611 | $raw\_data             = ''; |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L692) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L692) |  |
  | 692 | 692 | $response['data']       = get\_option( 'ig\_es\_bulk\_import' ); |
  | 693 | 693 | // get first and last entry |
  |  | 694 | // phpcs:disable |
  | 694 | 695 | $entries = $wpdb->get\_row( |
  | 695 | 696 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L700) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L701) |  |
  | 700 | 701 | ) |
  | 701 | 702 | ); |
  |  | 703 | // phpcs:enable |
  | 702 | 704 |  |
  | 703 | 705 | $first = unserialize( base64\_decode( $entries->first ) ); |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L877) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L879) |  |
  | 877 | 879 | $batch\_id            = (int) sanitize\_text\_field( $\_POST['id'] ); |
  | 878 | 880 | $bulkdata['current'] = $batch\_id; |
  | 879 |  |  |
  |  | 881 | // phpcs:disable |
  | 880 | 882 | $raw\_list\_data       = $wpdb->get\_col( |
  | 881 | 883 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L887) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L889) |  |
  | 887 | 889 | ) |
  | 888 | 890 | ); |
  |  | 891 | // phpcs:enable |
  | 889 | 892 | if ( $raw\_list\_data ) { |
  | 890 | 893 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L1503) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L1506) |  |
  | 1503 | 1506 | $part = $parts[ $i ]; |
  | 1504 | 1507 | $new\_value = base64\_encode( serialize( $part ) ); |
  | 1505 |  |  |
  |  | 1508 | // phpcs:disable |
  | 1506 | 1509 | $wpdb->query( $wpdb->prepare( "INSERT INTO {$wpdb->prefix}ig\_temp\_import (data, identifier) VALUES (%s, %s)", $new\_value, $identifier ) ); |
  |  | 1510 | // phpcs:enable |
  | 1507 | 1511 | } |
  | 1508 | 1512 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-post-notifications.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=2989575#L139 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=3072302#L139 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 139 | 139 | 'status'           => 'active', |
  | 140 | 140 | ); |
  |  | 141 | // phpcs:disable |
  | 141 | 142 | $wpdb->update( IG\_CAMPAIGNS\_TABLE, $data, array( 'id' => $id ) ); |
  | 142 |  |  |
  |  | 143 | // phpcs:enable |
  | 143 | 144 | } |
  | 144 | 145 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=2989575#L591 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302#L591 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 591 | 591 | // ES()->logger->info( 'Process Queue:' ); |
  | 592 | 592 | // ES()->logger->info( 'SQL: ' . $sql ); |
  | 593 |  |  |
  |  | 593 | // phpcs:disable |
  | 594 | 594 | $notifications = $wpdb->get\_results( |
  | 595 | 595 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=2989575#L604) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302#L604) |  |
  | 604 | 604 | ARRAY\_A |
  | 605 | 605 | ); |
  |  | 606 | // phpcs:enable |
  | 606 | 607 |  |
  | 607 | 608 | $batch\_start\_time = time(); |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-reports-data.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L369 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L369 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 369 | 369 | continue; |
  | 370 | 370 | } |
  | 371 |  |  |
  |  | 371 | // phpcs:disable |
  | 372 | 372 | $results = $wpdb->get\_results( $wpdb->prepare( "SELECT type, count(DISTINCT (contact\_id) ) as total FROM {$wpdb->prefix}ig\_actions WHERE message\_id = %d AND campaign\_id = %d GROUP BY type", $message\_id, $campaign\_id ), ARRAY\_A ); |
  | 373 |  |  |
  |  | 373 | // phpcs:enable |
  | 374 | 374 | $stats     = array(); |
  | 375 | 375 | $type      = ''; |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L464) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L464) |  |
  | 464 | 464 | public static function get\_top\_performing\_campaigns( $start\_time, $campaign\_count = 3 ) { |
  | 465 | 465 | global $wpdb; |
  | 466 |  |  |
  |  | 466 | // phpcs:disable |
  | 467 | 467 | $top\_campaigns = $wpdb->get\_results( |
  | 468 | 468 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L473) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L473) |  |
  | 473 | 473 | ARRAY\_A |
  | 474 | 474 | ); |
  |  | 475 | // phpcs:enable |
  | 475 | 476 |  |
  | 476 | 477 | return $top\_campaigns; |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?old=2369871&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-subscription-throttling.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L26 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L26 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 26 | 26 | return MINUTE\_IN\_SECONDS \* 10; |
  | 27 | 27 | } |
  | 28 |  |  |
  |  | 28 | // phpcs:disable |
  | 29 | 29 | $subscribers = $wpdb->get\_var( |
  | 30 | 30 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L34) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L34) |  |
  | 34 | 34 | ) |
  | 35 | 35 | ); |
  |  | 36 | // phpcs:enable |
  | 36 | 37 |  |
  | 37 | 38 | if ( $subscribers > 0 ) { |
  | 38 | 39 | $timeout = MINUTE\_IN\_SECONDS \* pow( 2, $subscribers - 1 ); |
  | 39 |  |  |
  |  | 40 | // phpcs:disable |
  | 40 | 41 | $subscribers = $wpdb->get\_var( |
  | 41 | 42 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L45) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L46) |  |
  | 45 | 46 | ) |
  | 46 | 47 | ); |
  | 47 |  |  |
  |  | 48 | // phpcs:enable |
  | 48 | 49 | if ( $subscribers > 0 ) { |
  | 49 | 50 | return $timeout; |
  | 50 | 51 | } |
  | 51 | 52 | } |
  | 52 |  |  |
  |  | 53 | // phpcs:disable |
  | 53 | 54 | // Add IP Address. |
  | 54 | 55 | $wpdb->query( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L66) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L67) |  |
  | 66 | 67 | ) |
  | 67 | 68 | ); |
  |  | 69 | // phpcs:enable |
  | 68 | 70 | } |
  | 69 | 71 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?old=2758988&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-templates-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=2758988#L22 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302#L22 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | add\_action( 'admin\_init', array( &$this, 'duplicate\_template' ), 10, 1 ); |
  | 23 | 23 | add\_action( 'admin\_footer', array( $this, 'es\_template\_preview\_callback' ), 10 ); |
  | 24 |  |  |
  | 25 |  | ~~add\_action( 'parse\_query', array( $this, 'exclude\_dnd\_templates' ) );~~ |
  | 26 | 24 | } |
  | 27 | 25 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=2758988#L273) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302#L271) |  |
  | 273 | 271 | } |
  | 274 | 272 |  |
  | 275 |  | ~~/\*\*~~ |
  | 276 |  | ~~\* Exclude DND Templates from template list~~ |
  | 277 |  | ~~\*~~ |
  | 278 |  | ~~\* @since 4.5.3~~ |
  | 279 |  | ~~\*/~~ |
  | 280 |  | ~~public static function exclude\_dnd\_templates( $wp\_query ) {~~ |
  | 281 |  |  |
  | 282 |  | ~~global $pagenow;~~ |
  | 283 |  |  |
  | 284 |  | ~~if ( 'edit.php' !== $pagenow || empty( $wp\_query->query\_vars['post\_type'] ) ||'es\_template' !== $wp\_query->query\_vars['post\_type'] ) {~~ |
  | 285 |  | ~~return;~~ |
  | 286 |  | ~~}~~ |
  | 287 |  |  |
  | 288 |  | ~~$wp\_query->query\_vars['meta\_query'] = array(~~ |
  | 289 |  | ~~'relation' => 'OR',~~ |
  | 290 |  | ~~array(~~ |
  | 291 |  | ~~'key'     => 'es\_editor\_type',~~ |
  | 292 |  | ~~'value'   => IG\_ES\_CLASSIC\_EDITOR,~~ |
  | 293 |  | ~~'compare' => '=',~~ |
  | 294 |  | ~~),~~ |
  | 295 |  | ~~array(~~ |
  | 296 |  | ~~'key'     => 'es\_editor\_type',~~ |
  | 297 |  | ~~'compare' => 'NOT EXISTS', // if key doesn't exists, then template is created using Classic editor~~ |
  | 298 |  | ~~),~~ |
  | 299 |  | ~~);~~ |
  | 300 |  | ~~}~~ |
  | 301 |  |  |
  | 302 | 273 | public static function get\_instance() { |
  | 303 | 274 | if ( ! isset( self::$instance ) ) { |
* ## [email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php](/changeset/3072302/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?old=3069441&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fcontrollers%2Fclass-es-campaign-controller.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L890 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L890 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 890 | 890 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_data['id']; |
  | 891 | 891 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 892 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 892 | 893 | $post\_args =  array( |
  | 893 | 894 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L896) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L897) |  |
  | 896 | 897 | 'order'          => 'DESC', |
  | 897 | 898 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 898 |  | 'meta\_query'     => array( |
  |  | 899 | 'meta\_query'     => array( |
  | 899 | 900 | array( |
  | 900 | 901 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L912) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L913) |  |
  | 912 | 913 | 'orderby'        => 'date', |
  | 913 | 914 | 'order'          => 'DESC', |
  | 914 |  | 'meta\_query'     => array( |
  |  | 915 | 'meta\_query'     => array( |
  | 915 | 916 | array( |
  | 916 | 917 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L919) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L920) |  |
  | 919 | 920 | ), |
  | 920 | 921 | ); |
  | 921 |  |  |
  |  | 922 | // phpcs:enable |
  | 922 | 923 | $recent\_posts = get\_posts( $custom\_post\_args ); |
  | 923 | 924 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1016) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1017) |  |
  | 1016 | 1017 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_id; |
  | 1017 | 1018 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 1019 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1018 | 1020 | $post\_args =  array( |
  | 1019 | 1021 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1022) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1024) |  |
  | 1022 | 1024 | 'order'          => 'DESC', |
  | 1023 | 1025 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 1024 |  | 'meta\_query'     => array( |
  |  | 1026 | 'meta\_query'     => array( |
  | 1025 | 1027 | array( |
  | 1026 | 1028 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1036) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1038) |  |
  | 1036 | 1038 | ); |
  | 1037 | 1039 | } |
  |  | 1040 | // phpcs:enable |
  | 1038 | 1041 | $post\_ids = get\_posts( $post\_args ); |
  | 1039 | 1042 | } |
  | 1040 | 1043 | $custom\_post\_ids = array(); |
  | 1041 | 1044 | if ( ! empty( $custom\_post\_type ) ) { |
  |  | 1045 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1042 | 1046 | $custom\_post\_args = array( |
  | 1043 | 1047 | 'post\_type'      => $custom\_post\_type, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1045) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1049) |  |
  | 1045 | 1049 | 'orderby'        => 'date', |
  | 1046 | 1050 | 'order'          => 'DESC', |
  | 1047 |  | 'meta\_query'     => array( |
  |  | 1051 | 'meta\_query'     => array( |
  | 1048 | 1052 | array( |
  | 1049 | 1053 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1058) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1062) |  |
  | 1058 | 1062 | ); |
  | 1059 | 1063 | } |
  |  | 1064 | // phpcs:enable |
  | 1060 | 1065 | $custom\_post\_ids = get\_posts( $custom\_post\_args ); |
  | 1061 | 1066 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1141) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1146) |  |
  | 1141 | 1146 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_id; |
  | 1142 | 1147 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 1148 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1143 | 1149 | $post\_args =  array( |
  | 1144 | 1150 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1147) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1153) |  |
  | 1147 | 1153 | 'order'          => 'DESC', |
  | 1148 | 1154 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 1149 |  | 'meta\_query'     => array( |
  |  | 1155 | 'meta\_query'     => array( |
  | 1150 | 1156 | array( |
  | 1151 | 1157 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1161) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1167) |  |
  | 1161 | 1167 | ); |
  | 1162 | 1168 | } |
  |  | 1169 | // phpcs:enable |
  | 1163 | 1170 | $post\_ids = get\_posts( $post\_args ); |
  | 1164 | 1171 | } |
  | 1165 | 1172 | $custom\_post\_ids = array(); |
  | 1166 | 1173 | if ( ! empty( $custom\_post\_type ) ) { |
  |  | 1174 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1167 | 1175 | $custom\_post\_args = array( |
  | 1168 | 1176 | 'post\_type'      => $custom\_post\_type, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1170) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1178) |  |
  | 1170 | 1178 | 'orderby'        => 'date', |
  | 1171 | 1179 | 'order'          => 'DESC', |
  | 1172 |  | 'meta\_query'     => array( |
  |  | 1180 | 'meta\_query'     => array( |
  | 1173 | 1181 | array( |
  | 1174 | 1182 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1177) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1185) |  |
  | 1177 | 1185 | ), |
  | 1178 | 1186 | ); |
  |  | 1187 | // phpcs:enable |
  | 1179 | 1188 | $custom\_post\_ids  = get\_posts( $custom\_post\_args ); |
  | 1180 | 1189 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-actions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-actions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-actions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L417 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L417 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 417 | 417 | $days                   = esc\_sql( $days ); |
  | 418 | 418 | $args[]                 = $days; |
  |  | 419 | // phpcs:disable |
  | 419 | 420 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 420 | 421 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L423) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L424) |  |
  | 423 | 424 | ) |
  | 424 | 425 | ); |
  | 425 |  | } else { |
  |  | 426 | // phpcs:enable |
  |  | 427 | } else { |
  |  | 428 | // phpcs:disable |
  | 426 | 429 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 427 | 430 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L430) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L433) |  |
  | 430 | 433 | ) |
  | 431 | 434 | ); |
  |  | 435 | // phpcs:enable |
  | 432 | 436 | } |
  | 433 | 437 | } else { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L435) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L439) |  |
  | 435 | 439 | $days                   = esc\_sql( $days ); |
  | 436 | 440 | $args[]                 = $days; |
  |  | 441 | // phpcs:disable |
  | 437 | 442 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 438 | 443 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L441) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L446) |  |
  | 441 | 446 | ) |
  | 442 | 447 | ); |
  | 443 |  | } else { |
  |  | 448 | // phpcs:enable |
  |  | 449 | } else { |
  |  | 450 | // phpcs:disable |
  | 444 | 451 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 445 | 452 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L448) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L455) |  |
  | 448 | 455 | ) |
  | 449 | 456 | ); |
  |  | 457 | // phpcs:enable |
  | 450 | 458 | } |
  | 451 | 459 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L469) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L477) |  |
  | 469 | 477 |  |
  | 470 | 478 | $total\_emails\_unsubscribed = 0; |
  |  | 479 | // phpcs:disable |
  | 471 | 480 | if ( $distinct ) { |
  | 472 | 481 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L506) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L515) |  |
  | 506 | 515 | } |
  | 507 | 516 | } |
  | 508 |  |  |
  |  | 517 | // phpcs:enable |
  | 509 | 518 | return $total\_emails\_unsubscribed; |
  | 510 | 519 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L529) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L538) |  |
  | 529 | 538 |  |
  | 530 | 539 | $total\_emails\_opened = 0; |
  |  | 540 | // phpcs:disable |
  | 531 | 541 | if ( $distinct ) { |
  | 532 | 542 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L566) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L576) |  |
  | 566 | 576 | } |
  | 567 | 577 | } |
  | 568 |  |  |
  |  | 578 | // phpcs:enable |
  | 569 | 579 | return $total\_emails\_opened; |
  | 570 | 580 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L587) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L597) |  |
  | 587 | 597 |  |
  | 588 | 598 | $total\_emails\_sent = 0; |
  |  | 599 | // phpcs:disable |
  | 589 | 600 | if ( $distinct ) { |
  | 590 | 601 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L624) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L635) |  |
  | 624 | 635 | } |
  | 625 | 636 | } |
  | 626 |  |  |
  |  | 637 | // phpcs:enable |
  | 627 | 638 | return $total\_emails\_sent; |
  | 628 | 639 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L645) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L656) |  |
  | 645 | 656 |  |
  | 646 | 657 | $count = 0; |
  |  | 658 | // phpcs:disable |
  | 647 | 659 | if ( $distinct ) { |
  | 648 | 660 | $query = $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L656) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L668) |  |
  | 656 | 668 | ); |
  | 657 | 669 | } |
  | 658 |  |  |
  |  | 670 | // phpcs:enable |
  | 659 | 671 | $cache\_key       = ES\_Cache::generate\_key( $query ); |
  | 660 | 672 | $exists\_in\_cache = ES\_Cache::is\_exists( $cache\_key, 'query' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L689) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L701) |  |
  | 689 | 701 |  |
  | 690 | 702 | $contact\_ids\_str = implode( ',', $contact\_ids ); |
  | 691 |  |  |
  |  | 703 | // phpcs:disable |
  | 692 | 704 | $result = $wpbd->get\_results( $wpbd->prepare( "SELECT contact\_id, MAX(created\_at) as last\_opened\_at FROM {$wpbd->prefix}ig\_actions WHERE contact\_id IN ({$contact\_ids\_str}) AND type = %d  GROUP BY contact\_id", IG\_MESSAGE\_OPEN ), ARRAY\_A ); |
  | 693 |  |  |
  |  | 705 | // phpcs:enable |
  | 694 | 706 | if ( $filter ) { |
  | 695 | 707 | $last\_opened\_at = array\_column( $result, 'last\_opened\_at', 'contact\_id' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L710) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L722) |  |
  | 710 | 722 | $mailing\_queue\_ids = esc\_sql( $mailing\_queue\_ids ); |
  | 711 | 723 | $mailing\_queue\_ids = implode( ',', array\_map( 'absint', $mailing\_queue\_ids ) ); |
  | 712 |  |  |
  |  | 724 | // phpcs:disable |
  | 713 | 725 | $wpbd->query( |
  | 714 | 726 | "DELETE FROM {$wpbd->prefix}ig\_actions WHERE message\_id IN ($mailing\_queue\_ids)" |
  | 715 | 727 | ); |
  |  | 728 | // phpcs:enable |
  | 716 | 729 | } |
  | 717 | 730 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L721) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L734) |  |
  | 721 | 734 | $result = array(); |
  | 722 | 735 | if (!empty($campaign\_id) && !empty($link\_id) && is\_numeric($campaign\_id) && is\_numeric($link\_id)) { |
  |  | 736 | // phpcs:disable |
  | 723 | 737 | $result = $wpdb->get\_results($wpdb->prepare( |
  | 724 | 738 | "SELECT c.email,c.first\_name,c.last\_name |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L729) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L743) |  |
  | 729 | 743 | $link\_id |
  | 730 | 744 | ), ARRAY\_A); |
  |  | 745 | // phpcs:enable |
  | 731 | 746 | } |
  | 732 | 747 | return $result; |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-campaigns.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L285 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L285 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 285 | 285 | $from\_name  = ES\_Common::get\_ig\_option( 'from\_name' ); |
  | 286 | 286 | $from\_email = ES\_Common::get\_ig\_option( 'from\_email' ); |
  | 287 |  |  |
  |  | 287 | // phpcs:disable |
  | 288 | 288 | $total = $wpdb->get\_var( $wpdb->prepare( "SELECT count(\*) as total FROM {$wpdb->prefix}es\_sentdetails WHERE es\_sent\_source = %s", 'Newsletter' ) ); |
  | 289 |  |  |
  |  | 289 | // phpcs:enable |
  | 290 | 290 | if ( $total > 0 ) { |
  | 291 | 291 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L301) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L301) |  |
  | 301 | 301 | for ( $i = 0; $i <= $total\_batches; $i ++ ) { |
  | 302 | 302 | $batch\_start = $i \* $batch\_size; |
  | 303 |  |  |
  |  | 303 | // phpcs:disable |
  | 304 | 304 | $newsletters = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}es\_sentdetails WHERE es\_sent\_source = %s LIMIT %d, %d", 'Newsletter', $batch\_start, $batch\_size ), ARRAY\_A ); |
  | 305 |  |  |
  |  | 305 | // phpcs:enable |
  | 306 | 306 | if ( count( $newsletters ) > 0 ) { |
  | 307 | 307 | $campaign\_data = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L345) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L345) |  |
  | 345 | 345 | public function update\_campaign\_id\_in\_mailing\_queue() { |
  | 346 | 346 | global $wpdb; |
  | 347 |  |  |
  |  | 347 | // phpcs:disable |
  | 348 | 348 | $campaigns = $wpdb->get\_results( $wpdb->prepare( "SELECT id, name FROM {$wpdb->prefix}ig\_campaigns WHERE %d", 1 ), ARRAY\_A ); |
  | 349 |  |  |
  |  | 349 | // phpcs:enable |
  | 350 | 350 | $data\_to\_update = array(); |
  | 351 | 351 | if ( count( $campaigns ) > 0 ) { |
  |  | 352 | // phpcs:disable |
  | 352 | 353 | $mailing\_queue\_results = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}ig\_mailing\_queue WHERE %d", 1 ), ARRAY\_A ); |
  |  | 354 | // phpcs:enable |
  | 353 | 355 | if ( count( $mailing\_queue\_results ) > 0 ) { |
  | 354 | 356 | foreach ( $mailing\_queue\_results as $result ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L367) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L369) |  |
  | 367 | 369 | if ( ! empty( $data\_to\_update ) ) { |
  | 368 | 370 | foreach ( $data\_to\_update as $mailing\_queue\_id => $campaign\_id ) { |
  |  | 371 | // phpcs:disable |
  | 369 | 372 | $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_mailing\_queue SET campaign\_id = %d WHERE id = %d", array( $campaign\_id, $mailing\_queue\_id ) ) ); |
  |  | 373 | // phpcs:enable |
  | 370 | 374 | } |
  | 371 | 375 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L517) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L521) |  |
  | 517 | 521 | return array(); |
  | 518 | 522 | } |
  | 519 |  |  |
  |  | 523 | // phpcs:disable |
  | 520 | 524 | $where = $wpdb->prepare( "parent\_id = %d AND status = %d AND ( deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00' )", $id, self::STATUS\_ACTIVE ); |
  | 521 |  |  |
  |  | 525 | // phpcs:enable |
  | 522 | 526 | $campaigns = $this->get\_by\_conditions( $where ); |
  | 523 | 527 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L539) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L543) |  |
  | 539 | 543 | $posts\_type\_count       = count( $post\_types['postsType'] ); |
  | 540 | 544 | $post\_type\_placeholders = array\_fill( 0, $posts\_type\_count, '%s' ); |
  |  | 545 | // phpcs:disable |
  | 541 | 546 | $query                  = $wpbd->prepare( |
  | 542 | 547 | "SELECT ID, post\_title, post\_content FROM {$wpbd->posts} WHERE post\_type IN (" . implode( ',', $post\_type\_placeholders ) . ')', |
  | 543 | 548 | $post\_types['postsType'] |
  | 544 | 549 | ); |
  |  | 550 | // phpcs:enable |
  | 545 | 551 | $posts                  = $wpbd->get\_results( $query, ARRAY\_A ); |
  | 546 | 552 | return $posts; |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L558) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L564) |  |
  | 558 | 564 | public function get\_active\_campaigns( $type = '' ) { |
  | 559 | 565 | global $wpdb; |
  | 560 |  |  |
  |  | 566 | // phpcs:disable |
  | 561 | 567 | if ( empty( $type ) ) { |
  | 562 | 568 | $where = $wpdb->prepare( "status = %d AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", self::STATUS\_ACTIVE ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L564) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L570) |  |
  | 564 | 570 | $where = $wpdb->prepare( "status = %d AND type = %s AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", self::STATUS\_ACTIVE, $type ); |
  | 565 | 571 | } |
  | 566 |  |  |
  |  | 572 | // phpcs:enable |
  | 567 | 573 | return $this->get\_by\_conditions( $where ); |
  | 568 | 574 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L672) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L678) |  |
  | 672 | 678 | if ( $post\_id > 0 ) { |
  | 673 | 679 | $post\_type = get\_post\_type( $post\_id ); |
  | 674 |  |  |
  |  | 680 | // phpcs:disable |
  | 675 | 681 | $where = $wpdb->prepare( "status = %d AND type = %s AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", 1, 'post\_notification' ); |
  | 676 |  |  |
  |  | 682 | // phpcs:enable |
  | 677 | 683 | $new\_flow\_campaign\_ids = get\_option( 'ig\_es\_new\_category\_format\_campaign\_ids', array() ); |
  | 678 | 684 | // Run old logic for campaign |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-contacts.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L437 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L437 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 437 | 437 |  |
  | 438 | 438 | if ( ! empty( $list\_id ) ) { |
  |  | 439 | // phpcs:disable |
  | 439 | 440 | $subscribers = $wpdb->get\_var( |
  | 440 | 441 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L444) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L445) |  |
  | 444 | 445 | ) |
  | 445 | 446 | ); |
  |  | 447 | // phpcs:enable |
  | 446 | 448 | } else { |
  |  | 449 | // phpcs:disable |
  | 447 | 450 | $subscribers = $wpdb->get\_var( |
  | 448 | 451 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L451) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L454) |  |
  | 451 | 454 | ) |
  | 452 | 455 | ); |
  |  | 456 | // phpcs:enable |
  | 453 | 457 | } |
  | 454 | 458 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L462) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L466) |  |
  | 462 | 466 | public function get\_all\_contact\_ids() { |
  | 463 | 467 | global $wpbd; |
  | 464 |  |  |
  |  | 468 | // phpcs:disable |
  | 465 | 469 | $query = "SELECT id FROM $this->table\_name"; |
  |  | 470 | // phpcs:enable |
  | 466 | 471 | return $wpbd->get\_results( $query ); |
  | 467 | 472 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L585) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L590) |  |
  | 585 | 590 | public function get\_email\_details\_map() { |
  | 586 | 591 | global $wpdb; |
  | 587 |  |  |
  |  | 592 | // phpcs:disable |
  | 588 | 593 | $contacts = $wpdb->get\_results( |
  | 589 | 594 | "SELECT id, email, hash FROM {$wpdb->prefix}ig\_contacts", |
  | 590 | 595 | ARRAY\_A |
  | 591 | 596 | ); |
  |  | 597 | // phpcs:enable |
  | 592 | 598 | $details  = array(); |
  | 593 | 599 | if ( count( $contacts ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L726) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L732) |  |
  | 726 | 732 |  |
  | 727 | 733 | // Get Total count of subscribers |
  |  | 734 | // phpcs:disable |
  | 728 | 735 | $total = $wpdb->get\_var( "SELECT count(\*) as total FROM {$wpdb->prefix}es\_emaillist" ); |
  | 729 |  |  |
  |  | 736 | // phpcs:enable |
  | 730 | 737 | // If we have subscribers? |
  | 731 | 738 | if ( $total > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L745) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L752) |  |
  | 745 | 752 | for ( $i = 0; $i < $total\_batches; $i ++ ) { |
  | 746 | 753 | $batch\_start = $i \* $batch\_size; |
  |  | 754 | // phpcs:disable |
  | 747 | 755 | $results     = $wpdb->get\_results( |
  | 748 | 756 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L753) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L761) |  |
  | 753 | 761 | ARRAY\_A |
  | 754 | 762 | ); |
  |  | 763 | // phpcs:enable |
  | 755 | 764 | if ( count( $results ) > 0 ) { |
  | 756 | 765 | $contacts = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1027) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1036) |  |
  | 1027 | 1036 |  |
  | 1028 | 1037 | if ( ! empty( $form\_id ) ) { |
  |  | 1038 | // phpcs:disable |
  | 1029 | 1039 | $total\_subscribers = $wpdb->get\_var( |
  | 1030 | 1040 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1034) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1044) |  |
  | 1034 | 1044 | ) |
  | 1035 | 1045 | ); |
  |  | 1046 | // phpcs:enable |
  | 1036 | 1047 | } |
  | 1037 | 1048 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1049) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1060) |  |
  | 1049 | 1060 |  |
  | 1050 | 1061 | // Get Total count of subscribers |
  |  | 1062 | // phpcs:disable |
  | 1051 | 1063 | $total = $wpdb->get\_var( "SELECT count(\*) as total FROM {$wpdb->prefix}ig\_contacts" ); |
  | 1052 |  |  |
  |  | 1064 | // phpcs:enable |
  | 1053 | 1065 | // If we have subscribers? |
  | 1054 | 1066 | if ( $total > 0 ) { |
  | 1055 |  |  |
  |  | 1067 | // phpcs:disable |
  | 1056 | 1068 | $wpdb->query( |
  | 1057 | 1069 | "UPDATE {$wpdb->prefix}ig\_contacts AS contact\_data |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1063) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1075) |  |
  | 1063 | 1075 | AND list\_data.subscribed\_ip <> ''" |
  | 1064 | 1076 | ); |
  |  | 1077 | // phpcs:enable |
  | 1065 | 1078 | } |
  | 1066 | 1079 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1168) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1181) |  |
  | 1168 | 1181 | public function get\_last\_contact\_id() { |
  | 1169 | 1182 | global $wpdb; |
  |  | 1183 | // phpcs:disable |
  | 1170 | 1184 | $last\_contact\_id = $wpdb->get\_var( "SELECT id FROM {$wpdb->prefix}ig\_contacts ORDER BY id DESC LIMIT 0, 1" ); |
  |  | 1185 | // phpcs:enable |
  | 1171 | 1186 | return $last\_contact\_id; |
  | 1172 | 1187 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-forms.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-forms.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-forms.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3051406#L103 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302#L103 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 103 | 103 |  |
  | 104 | 104 | global $wpdb; |
  | 105 |  |  |
  |  | 105 | // phpcs:disable |
  | 106 | 106 | $results = $wpdb->get\_results( "SELECT id, name FROM {$wpdb->prefix}ig\_forms", ARRAY\_A ); |
  | 107 |  |  |
  |  | 107 | // phpcs:enable |
  | 108 | 108 | $id\_name\_map = array(); |
  | 109 | 109 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3051406#L206) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302#L206) |  |
  | 206 | 206 | public function migrate\_advanced\_forms() { |
  | 207 | 207 | global $wpdb; |
  | 208 |  |  |
  |  | 208 | // phpcs:disable |
  | 209 | 209 | $is\_table\_exists = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $wpdb->prefix . 'es\_advanced\_form' ) ) === $wpdb->prefix . 'es\_advanced\_form'; |
  | 210 |  |  |
  |  | 210 | // phpcs:enable |
  | 211 | 211 | $lists\_name\_id\_map = ES()->lists\_db->get\_list\_id\_name\_map( '', true ); |
  | 212 | 212 |  |
  | 213 | 213 | if ( $is\_table\_exists ) { |
  |  | 214 | // phpcs:disable |
  | 214 | 215 | $forms = $wpdb->get\_results( |
  | 215 | 216 | "SELECT \* FROM {$wpdb->prefix}es\_advanced\_form", |
  | 216 | 217 | ARRAY\_A |
  | 217 | 218 | ); |
  | 218 |  |  |
  |  | 219 | // phpcs:enable |
  | 219 | 220 | if ( count( $forms ) > 0 ) { |
  | 220 | 221 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-lists.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?old=2644473&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-lists.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-lists.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=2644473#L236 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302#L236 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 236 | 236 | public function get\_all\_lists\_name\_by\_contact( $id ) { |
  | 237 | 237 | global $wpdb; |
  | 238 |  |  |
  |  | 238 | // phpcs:disable |
  | 239 | 239 | $res = $wpdb->get\_col( |
  | 240 | 240 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=2644473#L243) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302#L243) |  |
  | 243 | 243 | ) |
  | 244 | 244 | ); |
  |  | 245 | // phpcs:enable |
  | 245 | 246 |  |
  | 246 | 247 | return $res; |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?old=2937457&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-mailing-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L54 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L54 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 54 | 54 | public static function get\_notification\_hash\_to\_be\_sent() { |
  | 55 | 55 | global $wpdb; |
  | 56 |  |  |
  |  | 56 | // phpcs:disable |
  | 57 | 57 | $hash = $wpdb->get\_var( |
  | 58 | 58 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L61) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L61) |  |
  | 61 | 61 | ) |
  | 62 | 62 | ); |
  | 63 |  |  |
  |  | 63 | // phpcs:enable |
  | 64 | 64 | // TODO :: update start date |
  | 65 | 65 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L77) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L77) |  |
  | 77 | 77 | $results = array(); |
  | 78 | 78 | if ( ! empty( $campaign\_hash ) ) { |
  |  | 79 | // phpcs:disable |
  | 79 | 80 | $results = $wpdb->get\_results( |
  | 80 | 81 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L84) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L85) |  |
  | 84 | 85 | ARRAY\_A |
  | 85 | 86 | ); |
  |  | 87 | // phpcs:enable |
  | 86 | 88 | } else { |
  | 87 | 89 | $current\_time = ig\_get\_current\_date\_time(); |
  | 88 |  |  |
  |  | 90 | // phpcs:disable |
  | 89 | 91 | $results      = $wpdb->get\_results( |
  | 90 | 92 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L99) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L101) |  |
  | 99 | 101 | ARRAY\_A |
  | 100 | 102 | ); |
  |  | 103 | // phpcs:enable |
  | 101 | 104 | } |
  | 102 | 105 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L142) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L145) |  |
  | 142 | 145 | $notification['subject'] = ! empty( $content['subject'] ) ? $content['subject'] : $notification['subject']; |
  | 143 | 146 | $notification['body']    = ! empty( $content['body'] ) ? $content['body'] : $notification['body']; |
  | 144 |  |  |
  |  | 147 | // phpcs:disable |
  | 145 | 148 | $wpdb->query( |
  | 146 | 149 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L153) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L156) |  |
  | 153 | 156 | ) |
  | 154 | 157 | ); |
  |  | 158 | // phpcs:enable |
  | 155 | 159 | } |
  | 156 | 160 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L166) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L170) |  |
  | 166 | 170 |  |
  | 167 | 171 | // If status is sent then add finish\_at time as well. |
  |  | 172 | // phpcs:disable |
  | 168 | 173 | if ( 'Sent' === $status ) { |
  | 169 | 174 | $current\_date\_time = ig\_get\_current\_date\_time(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L195) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L200) |  |
  | 195 | 200 | ); |
  | 196 | 201 | } |
  | 197 |  |  |
  |  | 202 | // phpcs:enable |
  | 198 | 203 | return $return\_id; |
  | 199 | 204 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L202) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L207) |  |
  | 202 | 207 | public static function get\_sent\_email\_count( $notification\_hash ) { |
  | 203 | 208 | global $wpdb; |
  |  | 209 | // phpcs:disable |
  | 204 | 210 | $email\_count = $wpdb->get\_col( |
  | 205 | 211 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L208) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L214) |  |
  | 208 | 214 | ) |
  | 209 | 215 | ); |
  |  | 216 | // phpcs:enable |
  | 210 | 217 | $email\_count = array\_shift( $email\_count ); |
  | 211 | 218 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L217) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L224) |  |
  | 217 | 224 |  |
  | 218 | 225 | $notification = array(); |
  |  | 226 | // phpcs:disable |
  | 219 | 227 | $query        = $wpbd->prepare( |
  | 220 | 228 | "SELECT \* FROM {$wpbd->prefix}ig\_mailing\_queue WHERE hash = %s", |
  | 221 | 229 | $notification\_hash |
  | 222 | 230 | ); |
  | 223 |  |  |
  |  | 231 | // phpcs:enable |
  | 224 | 232 | $cache\_key       = ES\_Cache::generate\_key( $query ); |
  | 225 | 233 | $exists\_in\_cache = ES\_Cache::is\_exists( $cache\_key, 'query' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L271) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L279) |  |
  | 271 | 279 | if ( ! empty( $per\_page ) && ! empty( $page\_number ) ) { |
  | 272 | 280 | $start\_limit = ( $page\_number - 1 ) \* $per\_page; |
  |  | 281 | // phpcs:disable |
  | 273 | 282 | $result      = $wpdb->get\_results( |
  | 274 | 283 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L287) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L296) |  |
  | 287 | 296 | ); |
  | 288 | 297 | } |
  | 289 |  |  |
  |  | 298 | // phpcs:enable |
  | 290 | 299 | return $result; |
  | 291 | 300 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L293) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L302) |  |
  | 293 | 302 | public static function get\_notifications\_count() { |
  | 294 | 303 | global $wpdb; |
  | 295 |  |  |
  |  | 304 | // phpcs:disable |
  | 296 | 305 | $result = $wpdb->get\_col( |
  | 297 | 306 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L300) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L309) |  |
  | 300 | 309 | ) |
  | 301 | 310 | ); |
  | 302 |  |  |
  |  | 311 | // phpcs:enable |
  | 303 | 312 | return $result[0]; |
  | 304 | 313 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L315) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L324) |  |
  | 315 | 324 |  |
  | 316 | 325 | // Delete notification. |
  |  | 326 | // phpcs:disable |
  | 317 | 327 | $wpbd->query( |
  | 318 | 328 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L321) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L331) |  |
  | 321 | 331 | ) |
  | 322 | 332 | ); |
  |  | 333 | // phpcs:enable |
  | 323 | 334 | } |
  | 324 | 335 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L336) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L347) |  |
  | 336 | 347 |  |
  | 337 | 348 | // Update related broadcast campaign status to draft. |
  |  | 349 | // phpcs:disable |
  | 338 | 350 | $wpbd->query( |
  | 339 | 351 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L345) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L357) |  |
  | 345 | 357 | ) |
  | 346 | 358 | ); |
  |  | 359 |  |
  | 347 | 360 |  |
  | 348 | 361 | // Delete notification. |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L353) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L366) |  |
  | 353 | 366 | ) |
  | 354 | 367 | ); |
  |  | 368 | // phpcs:enable |
  | 355 | 369 | } |
  | 356 | 370 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L364) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L378) |  |
  | 364 | 378 | $data           = $prepared\_data['data']; |
  | 365 | 379 | $column\_formats = $prepared\_data['column\_formats']; |
  | 366 |  |  |
  |  | 380 | // phpcs:disable |
  | 367 | 381 | $inserted = $wpdb->insert( IG\_MAILING\_QUEUE\_TABLE, $data, $column\_formats ); |
  | 368 |  |  |
  |  | 382 | // phpcs:enable |
  | 369 | 383 | $last\_report\_id = 0; |
  | 370 | 384 | if ( $inserted ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L384) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L398) |  |
  | 384 | 398 | $data           = $prepared\_data['data']; |
  | 385 | 399 | $column\_formats = $prepared\_data['column\_formats']; |
  | 386 |  |  |
  |  | 400 | // phpcs:disable |
  | 387 | 401 | $wpdb->update( IG\_MAILING\_QUEUE\_TABLE, $data, array( 'id' => $notification\_id ), $column\_formats ); |
  | 388 |  |  |
  |  | 402 | // phpcs:enable |
  | 389 | 403 | } |
  | 390 | 404 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L392) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L406) |  |
  | 392 | 406 | global $wpdb; |
  | 393 | 407 |  |
  |  | 408 | // phpcs:disable |
  | 394 | 409 | $query   = 'SELECT id, start\_at, hash FROM ' . IG\_MAILING\_QUEUE\_TABLE; |
  | 395 | 410 | $results = $wpdb->get\_results( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L400) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L415) |  |
  | 400 | 415 | ARRAY\_A |
  | 401 | 416 | ); |
  |  | 417 | // phpcs:enable |
  | 402 | 418 | $details = array(); |
  | 403 | 419 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L415) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L431) |  |
  | 415 | 431 |  |
  | 416 | 432 | $report  = array(); |
  |  | 433 | // phpcs:disable |
  | 417 | 434 | $results = $wpdb->get\_results( |
  | 418 | 435 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L422) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L439) |  |
  | 422 | 439 | ARRAY\_A |
  | 423 | 440 | ); |
  | 424 |  |  |
  |  | 441 | // phpcs:enable |
  | 425 | 442 | if ( count( $results ) > 0 ) { |
  | 426 | 443 | $report = array\_shift( $results ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L445) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L462) |  |
  | 445 | 462 | $count = 5; |
  | 446 | 463 | } |
  | 447 |  |  |
  |  | 464 | // phpcs:disable |
  | 448 | 465 | return $wpdb->get\_results( |
  | 449 | 466 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L453) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L470) |  |
  | 453 | 470 | ARRAY\_A |
  | 454 | 471 | ); |
  |  | 472 | // phpcs:enable |
  | 455 | 473 | } |
  | 456 | 474 |  |
  | 457 | 475 | public static function do\_insert( $place\_holders, $values ) { |
  | 458 | 476 | global $wpdb, $wpbd; |
  | 459 |  |  |
  |  | 477 | // phpcs:disable |
  | 460 | 478 | $query  = "INSERT INTO {$wpdb->prefix}ig\_mailing\_queue (`hash`, `campaign\_id`, `subject`, `body`, `count`, `status`, `start\_at`, `finish\_at`, `created\_at`, `updated\_at`) VALUES "; |
  |  | 479 | // phpcs:enable |
  | 461 | 480 | $query .= implode( ', ', $place\_holders ); |
  | 462 | 481 | $sql    = $wpbd->prepare( $query, $values ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L475) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L494) |  |
  | 475 | 494 | public static function migrate\_notifications() { |
  | 476 | 495 | global $wpdb; |
  | 477 |  |  |
  |  | 496 | // phpcs:disable |
  | 478 | 497 | $total = $wpdb->get\_var( |
  | 479 | 498 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L482) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L501) |  |
  | 482 | 501 | ) |
  | 483 | 502 | ); |
  | 484 |  |  |
  |  | 503 | // phpcs:enable |
  | 485 | 504 | if ( $total > 0 ) { |
  | 486 | 505 | $columns = self::get\_columns(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L493) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L512) |  |
  | 493 | 512 | for ( $i = 0; $i < $total\_bataches; $i ++ ) { |
  | 494 | 513 | $batch\_start = $i \* $batch\_size; |
  | 495 |  |  |
  |  | 514 | // phpcs:disable |
  | 496 | 515 | $results = $wpdb->get\_results( |
  | 497 | 516 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L502) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L521) |  |
  | 502 | 521 | ARRAY\_A |
  | 503 | 522 | ); |
  | 504 |  |  |
  |  | 523 | // phpcs:enable |
  | 505 | 524 | $values        = array(); |
  | 506 | 525 | $place\_holders = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L571) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L590) |  |
  | 571 | 590 | $data\_keys      = array\_keys( $data ); |
  | 572 | 591 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 573 |  |  |
  |  | 592 | // phpcs:disable |
  | 574 | 593 | if ( false === $wpdb->update( self::$table\_name, $data, array( $where => $mailing\_queue\_id ), $column\_formats ) ) { |
  | 575 | 594 | return false; |
  | 576 | 595 | } |
  | 577 |  |  |
  |  | 596 | // phpcs:enable |
  | 578 | 597 | return true; |
  | 579 | 598 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L594) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L613) |  |
  | 594 | 613 | return; |
  | 595 | 614 | } |
  | 596 |  |  |
  |  | 615 | // phpcs:disable |
  | 597 | 616 | $wpdb->query( |
  | 598 | 617 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L602) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L621) |  |
  | 602 | 621 | ) |
  | 603 | 622 | ); |
  |  | 623 | // phpcs:enable |
  | 604 | 624 | } |
  | 605 | 625 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-notifications.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L27 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L27 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | public static function migrate\_post\_notification\_es\_template\_type() { |
  | 28 | 28 | global $wpdb; |
  | 29 |  |  |
  |  | 29 | // phpcs:disable |
  | 30 | 30 | $update = $wpdb->query( |
  | 31 | 31 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L34) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L34) |  |
  | 34 | 34 | ) |
  | 35 | 35 | ); |
  | 36 |  |  |
  |  | 36 | // phpcs:enable |
  | 37 | 37 | return $update; |
  | 38 | 38 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L47) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L47) |  |
  | 47 | 47 | public static function migrate\_newsletter\_es\_template\_type() { |
  | 48 | 48 | global $wpdb; |
  | 49 |  |  |
  |  | 49 | // phpcs:disable |
  | 50 | 50 | $update = $wpdb->query( |
  | 51 | 51 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L54) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L54) |  |
  | 54 | 54 | ) |
  | 55 | 55 | ); |
  | 56 |  |  |
  |  | 56 | // phpcs:enable |
  | 57 | 57 | return $update; |
  | 58 | 58 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=2602749#L62 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302#L62 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | public function delete\_from\_queue( $campaign\_id, $contact\_id ) { |
  | 63 | 63 | global $wpdb; |
  | 64 |  |  |
  |  | 64 | // phpcs:disable |
  | 65 | 65 | return $wpdb->query( |
  | 66 | 66 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=2602749#L70) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302#L70) |  |
  | 70 | 70 | ) |
  | 71 | 71 | ); |
  |  | 72 | // phpcs:enable |
  | 72 | 73 | } |
  | 73 | 74 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?old=2995564&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-sending-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L85 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L85 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 | public static function get\_queued\_emails( $contact\_id ) { |
  | 86 | 86 | global $wpdb; |
  | 87 |  |  |
  |  | 87 | // phpcs:disable |
  | 88 | 88 | $queued\_emails = $wpdb->get\_results( |
  | 89 | 89 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L94) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L94) |  |
  | 94 | 94 | ARRAY\_A |
  | 95 | 95 | ); |
  | 96 |  |  |
  |  | 96 | // phpcs:enable |
  | 97 | 97 | return $queued\_emails; |
  | 98 | 98 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L179) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L179) |  |
  | 179 | 179 |  |
  | 180 | 180 | global $wpdb; |
  | 181 |  |  |
  |  | 181 | // phpcs:disable |
  | 182 | 182 | $result = $wpdb->get\_var( |
  | 183 | 183 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L196) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L196) |  |
  | 196 | 196 | ) |
  | 197 | 197 | ); |
  | 198 |  |  |
  |  | 198 | // phpcs:enable |
  | 199 | 199 | return $result; |
  | 200 | 200 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L208) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L208) |  |
  | 208 | 208 | if ( '' != $notification\_hash ) { |
  | 209 | 209 | $sent\_status = IG\_ES\_SENDING\_QUEUE\_STATUS\_SENT; |
  |  | 210 | // phpcs:disable |
  | 210 | 211 | $result = $wpdb->get\_var( |
  | 211 | 212 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L214) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L215) |  |
  | 214 | 215 | ) |
  | 215 | 216 | ); |
  |  | 217 | // phpcs:enable |
  | 216 | 218 | } |
  | 217 | 219 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L225) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L227) |  |
  | 225 | 227 | $emails = array(); |
  | 226 | 228 | if ( '' != $notification\_hash ) { |
  |  | 229 | // phpcs:disable |
  | 227 | 230 | $emails = $wpdb->get\_results( |
  | 228 | 231 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L232) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L235) |  |
  | 232 | 235 | ARRAY\_A |
  | 233 | 236 | ); |
  | 234 |  |  |
  |  | 237 | // phpcs:enable |
  | 235 | 238 | // We are not migrating reports data because it caused lots of migration issues |
  | 236 | 239 | // in the past. So, we are fetching reports data from older table if we don't get |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L238) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L241) |  |
  | 238 | 241 | // This is generally fetch the data for older campaigns |
  | 239 | 242 | if ( count( $emails ) == 0 ) { |
  |  | 243 | // phpcs:disable |
  | 240 | 244 | $result = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s ', $wpdb->prefix . 'es\_deliverreport' ) ); |
  |  | 245 | // phpcs:enable |
  | 241 | 246 | if ( $result === $wpdb->prefix . 'es\_deliverreport' ) { |
  |  | 247 | // phpcs:disable |
  | 242 | 248 | $emails = $wpdb->get\_results( |
  | 243 | 249 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L247) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L253) |  |
  | 247 | 253 | ARRAY\_A |
  | 248 | 254 | ); |
  |  | 255 | // phpcs:enable |
  | 249 | 256 | } |
  | 250 | 257 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L536) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L543) |  |
  | 536 | 543 |  |
  | 537 | 544 | $current\_date = ig\_get\_current\_date\_time(); |
  | 538 |  |  |
  |  | 545 | // phpcs:disable |
  | 539 | 546 | return $wpdb->query( |
  | 540 | 547 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L547) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L554) |  |
  | 547 | 554 | ) |
  | 548 | 555 | ); |
  |  | 556 | // phpcs:enable |
  | 549 | 557 | } |
  | 550 | 558 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L756) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L764) |  |
  | 756 | 764 |  |
  | 757 | 765 | if ( '' !== $hash ) { |
  |  | 766 | // phpcs:disable |
  | 758 | 767 | $result = $wpdb->get\_var( |
  | 759 | 768 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L762) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L771) |  |
  | 762 | 771 | ) |
  | 763 | 772 | ); |
  |  | 773 | // phpcs:enable |
  | 764 | 774 |  |
  | 765 | 775 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L774) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L784) |  |
  | 774 | 784 |  |
  | 775 | 785 | $result = 0; |
  | 776 |  |  |
  |  | 786 | // phpcs:disable |
  | 777 | 787 | if ( '' != $hash ) { |
  |  | 788 |  |
  | 778 | 789 | $result = $wpdb->get\_var( |
  | 779 | 790 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L782) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L793) |  |
  | 782 | 793 | ) |
  | 783 | 794 | ); |
  |  | 795 |  |
  | 784 | 796 | if ( 0 == $result ) { |
  | 785 | 797 | $es\_deliver\_report\_table = EMAIL\_SUBSCRIBERS\_STATS\_TABLE; |
  |  | 798 |  |
  | 786 | 799 | $table\_name              = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $wpdb->prefix . 'es\_deliverreport' ) ); |
  |  | 800 |  |
  | 787 | 801 | if ( $table\_name === $es\_deliver\_report\_table ) { |
  |  | 802 |  |
  | 788 | 803 | $result = $wpdb->get\_var( |
  | 789 | 804 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L792) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L807) |  |
  | 792 | 807 | ) |
  | 793 | 808 | ); |
  |  | 809 |  |
  | 794 | 810 | } |
  | 795 | 811 | } |
  | 796 | 812 | } |
  | 797 |  |  |
  |  | 813 | // phpcs:enable |
  | 798 | 814 | return $result; |
  | 799 | 815 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L851) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L867) |  |
  | 851 | 867 |  |
  | 852 | 868 | $emails\_str = "'" . implode( "','", $emails ) . "'"; |
  | 853 |  |  |
  |  | 869 | // phpcs:disable |
  | 854 | 870 | $results = $wpbd->get\_results( |
  | 855 | 871 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L860) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L876) |  |
  | 860 | 876 | ARRAY\_A |
  | 861 | 877 | ); |
  | 862 |  |  |
  |  | 878 | // phpcs:enable |
  | 863 | 879 | $emails\_id\_map = array(); |
  | 864 | 880 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L884) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L900) |  |
  | 884 | 900 | $emails = array(); |
  | 885 | 901 | if ( ! empty( $message\_id ) && ! empty( $campaign\_id ) ) { |
  |  | 902 | // phpcs:disable |
  | 886 | 903 | $emails = $wpdb->get\_results( |
  | 887 | 904 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L891) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L908) |  |
  | 891 | 908 | ARRAY\_A |
  | 892 | 909 | ); |
  |  | 910 | // phpcs:enable |
  | 893 | 911 | } |
  | 894 | 912 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L440 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L440 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 440 | 440 | $data\_keys      = array\_keys( $data ); |
  | 441 | 441 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 442 |  |  |
  |  | 442 | // phpcs:disable |
  | 443 | 443 | $wpdb->insert( $this->table\_name, $data, $column\_formats ); |
  |  | 444 | // phpcs:enable |
  | 444 | 445 | $wpdb\_insert\_id = $wpdb->insert\_id; |
  | 445 | 446 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L487) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L488) |  |
  | 487 | 488 | $data\_keys      = array\_keys( $data ); |
  | 488 | 489 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 489 |  |  |
  |  | 490 | // phpcs:disable |
  | 490 | 491 | if ( false === $wpdb->update( $this->table\_name, $data, array( $where => $row\_id ), $column\_formats ) ) { |
  | 491 | 492 | return false; |
  | 492 | 493 | } |
  | 493 |  |  |
  |  | 494 | // phpcs:enable |
  | 494 | 495 | return true; |
  | 495 | 496 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L587) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L588) |  |
  | 587 | 588 | global $wpdb; |
  | 588 | 589 | $table = sanitize\_text\_field( $table ); |
  | 589 |  |  |
  |  | 590 | // phpcs:disable |
  | 590 | 591 | return $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $table ) ) === $table; |
  |  | 592 | // phpcs:enable |
  | 591 | 593 | } |
  | 592 | 594 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?old=2771938&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-ig-es-db-unsubscribe-feedback.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L140 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L140 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 140 | 140 | return $existing\_feedback\_id; |
  | 141 | 141 | } |
  | 142 |  |  |
  |  | 142 | // phpcs:disable |
  | 143 | 143 | $existing\_feedback\_id = $wpdb->get\_var( |
  | 144 | 144 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L148) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L148) |  |
  | 148 | 148 | ) |
  | 149 | 149 | ); |
  | 150 |  |  |
  |  | 150 | // phpcs:enable |
  | 151 | 151 | return $existing\_feedback\_id; |
  | 152 | 152 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L162) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L162) |  |
  | 162 | 162 | public static function get\_feedback\_counts( $number\_of\_days ) { |
  | 163 | 163 | global $wpdb; |
  |  | 164 | // phpcs:disable |
  | 164 | 165 | $feedback\_counts = $wpdb->get\_results( |
  | 165 | 166 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L169) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L170) |  |
  | 169 | 170 | ARRAY\_A |
  | 170 | 171 | ); |
  | 171 |  |  |
  |  | 172 | // phpcs:enable |
  | 172 | 173 | return $feedback\_counts; |
  | 173 | 174 | } |
* ## [email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php](/changeset/3072302/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?old=2840380&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Ffeedback%2Fclass-ig-feedback.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=2840380#L363 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=3072302#L363 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 363 | 363 |  |
  | 364 | 364 | if ( $can\_load ) { |
  |  | 365 | // phpcs:disable WordPress.WP.EnqueuedResourceParameters.NotInFooter |
  | 365 | 366 | wp\_enqueue\_script( 'sweetalert', plugin\_dir\_url( \_\_FILE\_\_ ) . 'assets/js/sweetalert2.min.js', array( 'jquery' ) ); |
  |  | 367 | // phpcs:enable |
  | 366 | 368 | } |
  | 367 | 369 | } |
* ## [email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fupgrade%2Fes-update-functions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3046188#L3 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302#L3 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Functions for updating data, used by the background updater. |
  | 4 | 4 | \*/ |
  | 5 |  |  |
  |  | 5 | // phpcs:disable |
  | 6 | 6 | defined( 'ABSPATH' ) || exit; |
  | 7 | 7 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3046188#L2254) | […](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302#L2254) |  |
  | 2254 | 2254 | ES\_Install::update\_db\_version( '5.7.13' ); |
  | 2255 | 2255 | } |
  | 2256 |  |  |
  |  | 2256 | // phpcs:enable |
  | 2257 | 2257 | /\* --------------------- ES 5.7.13(End)--------------------------- \*/ |
* ## [email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?old=2694654&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fclass-es-workflow-action-preview.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L86 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L86 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 86 | 86 | $order       = self::get\_preview\_order(); |
  | 87 | 87 | $order\_items = $order->get\_items(); |
  | 88 |  |  |
  |  | 88 | // phpcs:disable |
  | 89 | 89 | if ( empty( $order\_items ) ) { |
  | 90 | 90 | throw new Exception( \_\_( 'A valid "Order items" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 91 | 91 | } |
  | 92 |  |  |
  |  | 92 | // phpcs:enable |
  | 93 | 93 | $data\_layer['wc\_order']   = $order; |
  | 94 | 94 | $data\_layer['order\_item'] = current( $order\_items ); |
  | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L191) | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L191) |  |
  | 191 | 191 |  |
  | 192 | 192 | $products = $product\_query->posts; |
  |  | 193 | // phpcs:disable |
  | 193 | 194 | if ( empty( $products ) ) { |
  | 194 | 195 | throw new Exception( \_\_( 'A valid "Product" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 195 | 196 | } |
  |  | 197 | // phpcs:enable |
  | 196 | 198 | } |
  | 197 | 199 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L217) | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L219) |  |
  | 217 | 219 | ] |
  | 218 | 220 | ); |
  | 219 |  |  |
  |  | 221 | // phpcs:disable |
  | 220 | 222 | if ( ! $orders ) { |
  | 221 | 223 | throw new Exception( \_\_( 'A valid "Order" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 222 | 224 | } |
  | 223 |  |  |
  |  | 225 | // phpcs:enable |
  | 224 | 226 | $order = wc\_get\_order( $orders[0] ); |
  | 225 | 227 |  |
* ## [email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fclass-es-workflow.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3051406#L1134 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3072302#L1134 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1134 | 1134 | public function get\_action\_from\_action\_fields( $field\_data ) { |
  | 1135 | 1135 | if ( ! is\_array( $field\_data ) || ! isset( $field\_data['action\_name'] ) ) { |
  |  | 1136 | // phpcs:disable |
  | 1136 | 1137 | throw new Exception( \_\_( 'Missing action\_name key in array.', 'email-subscribers' ) ); |
  |  | 1138 | // phpcs:enable |
  | 1137 | 1139 | } |
  | 1138 | 1140 |  |
  | 1139 | 1141 | $action\_name = ES\_Clean::string( $field\_data['action\_name'] ); |
  | 1140 | 1142 | $action      = ES\_Workflow\_Actions::get( $action\_name ); |
  |  | 1143 | // phpcs:disable |
  | 1141 | 1144 | if ( ! $action ) { |
  | 1142 | 1145 | throw new Exception( \_\_( 'Could not retrieve the action.', 'email-subscribers' ) ); |
  | 1143 | 1146 | } |
  | 1144 |  |  |
  |  | 1147 | // phpcs:enable |
  | 1145 | 1148 | return $action; |
  | 1146 | 1149 | } |
* ## [email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?old=2847177&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fdb%2Fclass-es-db-workflows.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=2847177#L970 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=3072302#L970 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 970 | 970 |  |
  | 971 | 971 | global $wpdb; |
  | 972 |  |  |
  |  | 972 | // phpcs:disable |
  | 973 | 973 | $result = $wpdb->get\_results( "SELECT trigger\_name, count(trigger\_name) AS trigger\_count FROM {$wpdb->prefix}ig\_workflows WHERE status = 1 GROUP BY trigger\_name", ARRAY\_A ); |
  | 974 |  |  |
  |  | 974 | // phpcs:enable |
  | 975 | 975 | return $result; |
  | 976 | 976 | } |
* ## [email-subscribers/trunk/readme.txt](/changeset/3072302/email-subscribers/trunk/readme.txt?old=3069441&old_path=email-subscribers%2Ftrunk%2Freadme.txt "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/readme.txt")

  | [r3069441](/browser/email-subscribers/trunk/readme.txt?rev=3069441#L5 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/readme.txt?rev=3072302#L5 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tags: email marketing, email subscribers, newsletters, autoresponders, email automation |
  | 6 | 6 | Requires at least: 3.9 |
  | 7 |  | Tested up to: 6.~~4~~.2 |
  |  | 7 | Tested up to: 6.5.2 |
  | 8 | 8 | Requires PHP: 5.6 |
  | 9 |  | Stable tag: 5.7.1~~7~~ |
  |  | 9 | Stable tag: 5.7.18 |
  | 10 | 10 | License: GPLv3 |
  | 11 | 11 |  |
  | […](/browser/email-subscribers/trunk/readme.txt?rev=3069441#L439) | […](/browser/email-subscribers/trunk/readme.txt?rev=3072302#L439) |  |
  | 439 | 439 | == Upgrade Notice == |
  | 440 | 440 |  |
  | 441 |  | = 5.7.17 = |
  | 442 |  |  |
  | 443 |  | \* Fix: Unable to select campaign recipient rules in a few cases |
  | 444 |  | \* Fix: Inline CSS not working in campaign preview [PRO] |
  | 445 |  | \* Fix: Keywords were not reflected in the post-notification test email [MAX] |
  | 446 |  | \* Fix: Broadcasts were not getting sent after re-editing |
  |  | 441 | = 5.7.18 = |
  |  | 442 |  |
  |  | 443 | \* Improvements: Performance & security improvements suggested by the Plugin Check (PCP) tool |
  |  | 444 | \* Update: Tested up to WordPress 6.5.2 |
  |  | 445 | \* Fix: Unauthorized access vulnerability [Thanks to Wordfence team] |
  | 447 | 446 |  |
  | 448 | 447 | == Changelog == |
  |  | 448 |  |
  |  | 449 | \*\*5.7.18 (17.04.2024)\*\* |
  |  | 450 |  |
  |  | 451 | \* Improvements: Performance & security improvements suggested by the Plugin Check (PCP) tool |
  |  | 452 | \* Update: Tested up to WordPress 6.5.2 |
  |  | 453 | \* Fix: Unauthorized access vulnerability [Thanks to Wordfence team] |
  | 449 | 454 |  |
  | 450 | 455 | \*\*5.7.17 (12.04.2024)\*\* |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3072302&old=3069441&new_path=%2Femail-subscribers%2Ftrunk&old_path=%2Femail-subscribers%2Ftrunk)
* [Zip Archive](?format=zip&new=3072302&old=3069441&new_path=%2Femail-subscribers%2Ftrunk&old_path=%2Femail-subscribers%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

