=== Content from plugins.trac.wordpress.org_0d8a41e2_20250110_211513.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Femail-subscribers%2Ftrunk%2Flite%2Fadmin%2Fclass-email-subscribers-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3183722 "Revision 3183722")
* Next Revision →
* [Blame](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [email-subscribers](/browser/email-subscribers?order=name "View email-subscribers")/[trunk](/browser/email-subscribers/trunk?order=name "View trunk")/[lite](/browser/email-subscribers/trunk/lite?order=name "View lite")/[admin](/browser/email-subscribers/trunk/lite/admin?order=name "View admin")/[class-email-subscribers-admin.php](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?order=name "View class-email-subscribers-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3210294/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php "View differences") on this file was [3210294](/changeset/3210294/ "View changeset 3210294"), checked in by Icegram, [3 weeks ago](/timeline?from=2024-12-19T08%3A40%3A54Z&precision=second "See timeline at 12/19/2024 08:40:54 AM") |
| --- |
| Preparing for 5.7.45 release |
| **File size:** 65.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) | // Exit if accessed directly |
| [5](#L5) | if ( ! defined( 'ABSPATH' ) ) { |
| [6](#L6) | exit; |
| [7](#L7) | } |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* The admin-specific functionality of the plugin. |
| [11](#L11) | \* |
| [12](#L12) | \* @link       http://example.com |
| [13](#L13) | \* @since      4.0 |
| [14](#L14) | \* |
| [15](#L15) | \* @package    Email\_Subscribers |
| [16](#L16) | \* @subpackage Email\_Subscribers/admin |
| [17](#L17) | \*/ |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* The admin-specific functionality of the plugin. |
| [21](#L21) | \* |
| [22](#L22) | \* Defines the plugin name, version, and two examples hooks for how to |
| [23](#L23) | \* enqueue the admin-specific stylesheet and JavaScript. |
| [24](#L24) | \* |
| [25](#L25) | \* @package    Email\_Subscribers |
| [26](#L26) | \* @subpackage Email\_Subscribers/admin |
| [27](#L27) | \*/ |
| [28](#L28) | class Email\_Subscribers\_Admin { |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \* The ID of this plugin. |
| [32](#L32) | \* |
| [33](#L33) | \* @since    4.0 |
| [34](#L34) | \* @var      string $email\_subscribers The ID of this plugin. |
| [35](#L35) | \*/ |
| [36](#L36) | private $email\_subscribers; |
| [37](#L37) |  |
| [38](#L38) | /\*\* |
| [39](#L39) | \* The version of this plugin. |
| [40](#L40) | \* |
| [41](#L41) | \* @since    4.0 |
| [42](#L42) | \* @var      string $version The current version of this plugin. |
| [43](#L43) | \*/ |
| [44](#L44) | private $version; |
| [45](#L45) |  |
| [46](#L46) | /\*\* |
| [47](#L47) | \* Initialize the class and set its properties. |
| [48](#L48) | \* |
| [49](#L49) | \* @param string $email\_subscribers The name of this plugin. |
| [50](#L50) | \* @param string $version The version of this plugin. |
| [51](#L51) | \* |
| [52](#L52) | \* @since    4.0 |
| [53](#L53) | \*/ |
| [54](#L54) | public function \_\_construct( $email\_subscribers, $version ) { |
| [55](#L55) |  |
| [56](#L56) | $this->email\_subscribers = $email\_subscribers; |
| [57](#L57) | $this->version           = $version; |
| [58](#L58) |  |
| [59](#L59) | // Reorder ES Submenu |
| [60](#L60) |  |
| [61](#L61) | // Commenting out since we are now registering the submenus in the order required. Therefore no need to change the submenu order later on. |
| [62](#L62) | // add\_filter( 'custom\_menu\_order', array( $this, 'submenu\_order' ) ); |
| [63](#L63) |  |
| [64](#L64) | add\_action( 'admin\_menu', array( $this, 'email\_subscribers\_admin\_menu' ) ); |
| [65](#L65) | add\_action( 'wp\_ajax\_es\_klawoo\_subscribe', array( $this, 'klawoo\_subscribe' ) ); |
| [66](#L66) | add\_action( 'admin\_footer', array( $this, 'remove\_submenu' ) ); |
| [67](#L67) |  |
| [68](#L68) | add\_action( 'admin\_init', array( $this, 'ob\_start' ) ); |
| [69](#L69) |  |
| [70](#L70) | add\_action( 'init', array( $this, 'save\_screen\_option' ) ); |
| [71](#L71) |  |
| [72](#L72) | add\_action( 'wp\_ajax\_es\_send\_auth\_test\_email', array( &$this, 'send\_authentication\_header\_test\_email' ) ); |
| [73](#L73) | add\_action( 'wp\_ajax\_es\_get\_auth\_headers', array( &$this, 'get\_email\_authentication\_headers') ); |
| [74](#L74) | // Add send cron data action. |
| [75](#L75) | add\_action( 'admin\_head', array( $this, 'send\_cron\_data' ) ); |
| [76](#L76) | add\_action( 'ig\_es\_after\_settings\_save', array( $this, 'send\_cron\_data' ) ); |
| [77](#L77) |  |
| [78](#L78) | // Process and add premium service data(Inline CSS, UTM Tracking etc) to template body. |
| [79](#L79) | add\_filter( 'es\_after\_process\_template\_body', array( $this, 'add\_premium\_services\_data' ) ); |
| [80](#L80) |  |
| [81](#L81) | // Filter to add premium service request data. |
| [82](#L82) | add\_filter( 'ig\_es\_util\_data', array( $this, 'add\_util\_data' ) ); |
| [83](#L83) |  |
| [84](#L84) | // Filter to check if utm tracking is enabled. |
| [85](#L85) | add\_filter( 'ig\_es\_track\_utm', array( $this, 'is\_utm\_tracking\_enabled' ), 10, 2 ); |
| [86](#L86) |  |
| [87](#L87) | // Disable Icegram server cron when plugin is deactivated. |
| [88](#L88) | add\_action( 'ig\_es\_plugin\_deactivate', array( $this, 'disable\_server\_cron' ) ); |
| [89](#L89) |  |
| [90](#L90) | // add\_action( 'admin\_init', array( $this, 'ig\_es\_send\_additional\_data\_for\_tracking' ) ); |
| [91](#L91) |  |
| [92](#L92) | // Filter to hook custom validation for specific service request. |
| [93](#L93) | add\_filter( 'ig\_es\_service\_request\_custom\_validation', array( $this, 'maybe\_override\_service\_validation' ), 10, 2 ); |
| [94](#L94) |  |
| [95](#L95) | // Ajax handler for email preview |
| [96](#L96) | add\_action( 'wp\_ajax\_ig\_es\_preview\_email\_report', array( $this, 'preview\_email\_in\_report' ) ); |
| [97](#L97) | add\_action( 'wp\_ajax\_ajax\_fetch\_report\_list', array( $this, 'ajax\_fetch\_report\_list\_callback' ) ); |
| [98](#L98) |  |
| [99](#L99) | if ( class\_exists( 'IG\_ES\_Premium\_Services\_UI' ) ) { |
| [100](#L100) | IG\_ES\_Premium\_Services\_UI::instance(); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | add\_action( 'wp\_dashboard\_setup', array( $this, 'es\_add\_widgets' ) ); |
| [104](#L104) |  |
| [105](#L105) | add\_action( 'ig\_es\_campaign\_deleted', array( $this, 'delete\_child\_campaigns' ) ); |
| [106](#L106) |  |
| [107](#L107) | add\_action( 'ig\_es\_campaign\_failed', array( $this, 'save\_campaign\_error\_details' ) ); |
| [108](#L108) | add\_action( 'ig\_es\_campaign\_sent', array( $this, 'remove\_campaign\_failed\_flag' ) ); |
| [109](#L109) | add\_action( 'admin\_notices', array( $this, 'show\_email\_sending\_failed\_notice' ) ); |
| [110](#L110) | add\_action( 'admin\_notices', array( $this, 'show\_post\_duplicator\_promotion\_notice' ) ); |
| [111](#L111) | add\_action( 'wp\_ajax\_ig\_es\_dismiss\_post\_duplicator\_promotion\_notice', array( $this, 'dismiss\_post\_duplicator\_promotion\_notice' ) ); |
| [112](#L112) |  |
| [113](#L113) | add\_action( 'admin\_init', array( $this, 'maybe\_apply\_bulk\_actions\_on\_all\_contacts' ) ); |
| [114](#L114) |  |
| [115](#L115) | add\_action( 'wp\_ajax\_ig\_es\_get\_subscribers\_stats', array( 'ES\_Dashboard', 'get\_subscribers\_stats' ) ); |
| [116](#L116) | add\_action( 'wp\_ajax\_ig\_es\_add\_list', array( $this, 'add\_list\_callback' ) ); |
| [117](#L117) | } |
| [118](#L118) |  |
| [119](#L119) | /\*\* |
| [120](#L120) | \* Register the stylesheets for the admin area. |
| [121](#L121) | \* |
| [122](#L122) | \* @since    4.0 |
| [123](#L123) | \*/ |
| [124](#L124) | public function enqueue\_styles() { |
| [125](#L125) |  |
| [126](#L126) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [127](#L127) | return; |
| [128](#L128) | } |
| [129](#L129) |  |
| [130](#L130) | /\*\* |
| [131](#L131) | \* This function is provided for demonstration purposes only. |
| [132](#L132) | \* |
| [133](#L133) | \* An instance of this class should be passed to the run() function |
| [134](#L134) | \* defined in Email\_Subscribers\_Loader as all of the hooks are defined |
| [135](#L135) | \* in that particular class. |
| [136](#L136) | \* |
| [137](#L137) | \* The Email\_Subscribers\_Loader will then create the relationship |
| [138](#L138) | \* between the defined hooks and the functions defined in this |
| [139](#L139) | \* class. |
| [140](#L140) | \*/ |
| [141](#L141) |  |
| [142](#L142) | wp\_enqueue\_style( $this->email\_subscribers, plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/email-subscribers-admin.css', array(), $this->version, 'all' ); |
| [143](#L143) |  |
| [144](#L144) | wp\_register\_style( $this->email\_subscribers . '-timepicker', plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/jquery.timepicker.css', array(), $this->version, 'all' ); |
| [145](#L145) | wp\_enqueue\_style( $this->email\_subscribers . '-timepicker' ); |
| [146](#L146) |  |
| [147](#L147) | // Select2 CSS |
| [148](#L148) | if ( ! wp\_style\_is( 'select2', 'registered' ) ) { |
| [149](#L149) | wp\_register\_style( 'select2', ES\_PLUGIN\_URL . 'lite/admin/css/select2.min.css', array(), '4.0.13' ); |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) | if ( ! wp\_style\_is( 'select2' ) ) { |
| [153](#L153) | wp\_enqueue\_style( 'select2' ); |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | $current\_page          = ig\_es\_get\_request\_data( 'page' ); |
| [157](#L157) | $current\_action            = ig\_es\_get\_request\_data( 'action' ); |
| [158](#L158) |  |
| [159](#L159) | //This below condition will helping to apply main.css file on forms add & update DND editor page. |
| [160](#L160) | $es\_forms = ( $current\_page == 'es\_forms' && ( isset($current\_action) && ( $current\_action == 'new' || $current\_action == 'edit' ) ) ) ? '' : 'es\_forms'; |
| [161](#L161) |  |
| [162](#L162) | //This below condition will helping to apply main.css file on dashboard onboarding process. |
| [163](#L163) | $es\_dashboard = ( IG\_ES\_Onboarding::is\_onboarding\_completed() ) ? 'es\_dashboard' : ''; |
| [164](#L164) |  |
| [165](#L165) | $enqueue\_tailwind          = in\_array( $current\_page, array( 'es\_gallery', 'es\_campaigns', 'es\_subscribers', 'es\_lists', $es\_forms, 'es\_custom\_fields', 'es\_settings', $es\_dashboard, 'es\_reports' ), true ); |
| [166](#L166) |  |
| [167](#L167) | if ( ! $enqueue\_tailwind ) { |
| [168](#L168) | wp\_enqueue\_style( 'ig-es-style', plugin\_dir\_url( \_\_FILE\_\_ ) . 'dist/main.css', array(), $this->version, 'all' ); |
| [169](#L169) | } |
| [170](#L170) |  |
| [171](#L171) | if ( $enqueue\_tailwind ) { |
| [172](#L172) | wp\_enqueue\_style( 'ig-es-tw-style', plugin\_dir\_url( \_\_FILE\_\_ ) . 'dist/tailwind.css', array(), $this->version, 'all' ); |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | $enqueue\_flag\_icon\_css = in\_array( $current\_page, array( 'es\_dashboard', 'es\_subscribers', 'es\_reports' ), true ); |
| [176](#L176) | if ( $enqueue\_flag\_icon\_css ) { |
| [177](#L177) | wp\_enqueue\_style( 'flag-icon-css', 'https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css', array(), $this->version, 'all' ); |
| [178](#L178) | } |
| [179](#L179) | } |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* Register the JavaScript for the admin area. |
| [183](#L183) | \* |
| [184](#L184) | \* @since    4.0 |
| [185](#L185) | \*/ |
| [186](#L186) | public function enqueue\_scripts() { |
| [187](#L187) |  |
| [188](#L188) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [189](#L189) | return; |
| [190](#L190) | } |
| [191](#L191) |  |
| [192](#L192) | $page = ig\_es\_get\_request\_data( 'page' ); |
| [193](#L193) |  |
| [194](#L194) | wp\_enqueue\_script( $this->email\_subscribers, plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/email-subscribers-admin.js', array( 'jquery', 'jquery-ui-core', 'jquery-ui-tabs' ), $this->version, false ); |
| [195](#L195) |  |
| [196](#L196) | $ig\_es\_js\_data = array( |
| [197](#L197) | 'security'   => wp\_create\_nonce( 'ig-es-admin-ajax-nonce' ), |
| [198](#L198) | 'i18n\_data'  => array( |
| [199](#L199) | // Broadcast messages. |
| [200](#L200) | 'ajax\_error\_message'              => \_\_( 'An error has occured. Please try again later.', 'email-subscribers' ), |
| [201](#L201) | 'broadcast\_saved\_message'         => \_\_( 'Broadcast saved successfully.', 'email-subscribers' ), |
| [202](#L202) | 'broadcast\_error\_message'         => \_\_( 'An error has occured while saving the broadcast. Please try again later.', 'email-subscribers' ), |
| [203](#L203) | 'broadcast\_subject\_empty\_message' => \_\_( 'Please add a broadcast subject before saving.', 'email-subscribers' ), |
| [204](#L204) | 'campaign\_saved\_message'          => \_\_( 'Campaign saved successfully.', 'email-subscribers' ), |
| [205](#L205) | 'campaign\_activated\_message'      => \_\_( 'Campaign activated successfully.', 'email-subscribers' ), |
| [206](#L206) | 'campaign\_scheduled\_message'      => \_\_( 'Campaign scheduled successfully.', 'email-subscribers' ), |
| [207](#L207) | 'campaign\_error\_message'          => \_\_( 'An error has occured while saving the campaign. Please try again later.', 'email-subscribers' ), |
| [208](#L208) | 'campaign\_preivew\_error\_message'  => \_\_( 'An error has occured while previewing the campaign. Please try again later.', 'email-subscribers' ), |
| [209](#L209) | 'campaign\_subject\_empty\_message'  => \_\_( 'Please add a campaign subject before saving.', 'email-subscribers' ), |
| [210](#L210) | 'empty\_template\_message'          => \_\_( 'Please add email body.', 'email-subscribers' ), |
| [211](#L211) | 'remove\_conditions\_message'       => \_\_( 'Do you really like to remove all conditions?', 'email-subscribers' ), |
| [212](#L212) | 'add\_conditions\_message'          => \_\_( 'Please add some recipients before proceeding.', 'email-subscribers' ), |
| [213](#L213) |  |
| [214](#L214) | // Workflows messages. |
| [215](#L215) | 'no\_trigger\_message'              => \_\_( 'Please select a trigger before saving the workflow.', 'email-subscribers' ), |
| [216](#L216) | 'no\_actions\_message'              => \_\_( 'Please add some actions before saving the workflow.', 'email-subscribers' ), |
| [217](#L217) | 'no\_action\_selected\_message'      => \_\_( 'Please select an action that this workflow should perform before saving the workflow.', 'email-subscribers' ), |
| [218](#L218) | 'trigger\_change\_message'          => \_\_( 'Changing the trigger will remove existing actions. Do you want to proceed anyway?.', 'email-subscribers' ), |
| [219](#L219) | 'placeholder\_copied\_message'      => \_\_( 'Copied!', 'email-subscribers' ), |
| [220](#L220) | 'keyword\_field\_is\_required'       => \_\_( '{{field\_name}} field is required!', 'email-subscribers' ), |
| [221](#L221) | 'required\_field\_is\_empty'         => \_\_( 'Required field is empty!', 'email-subscribers' ), |
| [222](#L222) | 'delete\_confirmation\_message'     => \_\_( 'Are you sure?', 'email-subscribers' ), |
| [223](#L223) |  |
| [224](#L224) | // Import subscribers messages. |
| [225](#L225) | 'select\_status'                   => esc\_html\_\_( 'Please select the status for the importing contacts!', 'email-subscribers' ), |
| [226](#L226) | 'select\_list'                     => esc\_html\_\_( 'Please select a list for importing contacts!', 'email-subscribers' ), |
| [227](#L227) | 'select\_email\_column'             => esc\_html\_\_( 'Please select the email address column!', 'email-subscribers' ), |
| [228](#L228) | 'prepare\_data'                    => esc\_html\_\_( 'Preparing Data', 'email-subscribers' ), |
| [229](#L229) | /\* translators: %s: Upload progress \*/ |
| [230](#L230) | 'uploading'                       => esc\_html\_\_( 'Uploading...%s', 'email-subscribers' ), |
| [231](#L231) | /\* translators: %s: Import progress \*/ |
| [232](#L232) | 'import\_contacts'                 => esc\_html\_\_( 'Importing contacts...%s', 'email-subscribers' ), |
| [233](#L233) | /\* translators: %s: Import failed svg icon  \*/ |
| [234](#L234) | 'import\_failed'                   => esc\_html\_\_( 'Import failed! %s', 'email-subscribers' ), |
| [235](#L235) | 'no\_windowclose'                  => esc\_html\_\_( 'Please do not close this window until it completes...', 'email-subscribers' ), |
| [236](#L236) | 'prepare\_import'                  => esc\_html\_\_( 'Preparing Import...', 'email-subscribers' ), |
| [237](#L237) | /\* translators: 1. Imported contacts count 2. Total contacts count 3. Failed to import count 4. Memory usage \*/ |
| [238](#L238) | 'current\_stats'                   => esc\_html\_\_( 'Currently %1$s of %2$s imported/updated with %3$s errors. %4$s %5$s memory usage', 'email-subscribers' ), |
| [239](#L239) | /\* translators: 1 Duplicate found email message \*/ |
| [240](#L240) | 'duplicate\_emails\_found\_message'  => \_\_( '%1$s duplicate emails found.', 'email-subscribers' ), |
| [241](#L241) | /\* translators: %s: Time left in minutes \*/ |
| [242](#L242) | 'estimate\_time'                   => esc\_html\_\_( 'Estimate time left: %s minutes', 'email-subscribers' ), |
| [243](#L243) | /\* translators: %s: Next attempt delaly time \*/ |
| [244](#L244) | 'continues\_in'                    => esc\_html\_\_( 'Continues in %s seconds', 'email-subscribers' ), |
| [245](#L245) | 'error\_importing'                 => esc\_html\_\_( 'There was a problem during importing contacts. Please check the error logs for more information!', 'email-subscribers' ), |
| [246](#L246) | 'confirm\_import'                  => esc\_html\_\_( 'Do you really like to import these contacts?', 'email-subscribers' ), |
| [247](#L247) | /\* translators: %s: Process complete svg icon  \*/ |
| [248](#L248) | 'import\_complete'                 => esc\_html\_\_( 'Import complete! %s', 'email-subscribers' ), |
| [249](#L249) | 'onbeforeunloadimport'            => esc\_html\_\_( 'You are currently importing subscribers! If you leave the page all pending subscribers don\'t get imported!', 'email-subscribers' ), |
| [250](#L250) | 'api\_verification\_success'        => esc\_html\_\_( 'API is valid. Fetching lists...', 'email-subscribers' ), |
| [251](#L251) | 'mailchimp\_notice\_nowindow\_close' => esc\_html\_\_( 'Fetching contacts from MailChimp...Please do not close this window', 'email-subscribers' ), |
| [252](#L252) |  |
| [253](#L253) | // verify Email authentication header messages |
| [254](#L254) | 'error\_send\_test\_email'           => esc\_html\_\_('SMTP Error : Unable to send test email', 'email-subscribers'), |
| [255](#L255) | 'error\_server\_busy'                               => esc\_html\_\_('Server Busy : Please try again later', 'email-subscribers'), |
| [256](#L256) | 'success\_verify\_email\_headers'    => esc\_html\_\_('Headers verified successfully', 'email-subscribers'), |
| [257](#L257) |  |
| [258](#L258) | 'confirm\_select\_all'                      => esc\_html\_\_('Want to select contacts on all pages?', 'email-subscribers'), |
| [259](#L259) |  |
| [260](#L260) | 'ess\_fallback\_text'               => esc\_html\_\_('Automatically fallback to selected Sender after crossing Icegram Email Sending Service daily limits.', 'email-subscribers'), |
| [261](#L261) |  |
| [262](#L262) | 'add\_attachment\_text'             => \_\_( 'Add Attachment', 'email-subscribers' ), |
| [263](#L263) | 'sending\_error\_text'              => \_\_( 'Sending error', 'email-subscribers' ), |
| [264](#L264) | ), |
| [265](#L265) | 'is\_pro'     => ES()->is\_pro() ? true : false, |
| [266](#L266) | 'is\_premium' => ES()->is\_premium(), |
| [267](#L267) | ); |
| [268](#L268) |  |
| [269](#L269) | if ( 'es\_settings' === $page ) { |
| [270](#L270) | $ig\_es\_js\_data['popular\_domains']                           = ES\_Common::get\_popular\_domains(); |
| [271](#L271) | $ig\_es\_js\_data['i18n\_data']['delete\_rest\_api\_confirmation'] = \_\_( 'Are you sure you want to delete this key? This action cannot be undone.', 'email-subscribers' ); |
| [272](#L272) | $ig\_es\_js\_data['i18n\_data']['select\_user']                  = \_\_( 'Please select a user.', 'email-subscribers' ); |
| [273](#L273) | } |
| [274](#L274) |  |
| [275](#L275) | if ( 'es\_forms' === $page && ES\_Drag\_And\_Drop\_Editor::is\_dnd\_editor\_page() ) { |
| [276](#L276) | $ig\_es\_js\_data['frontend\_css'] = ES\_Form\_Admin::get\_frontend\_css(); |
| [277](#L277) | $ig\_es\_js\_data['form\_styles']  = ES\_Form\_Admin::get\_form\_styles(); |
| [278](#L278) | $ig\_es\_js\_data['common\_css']   = ES\_Form\_Admin::get\_common\_css(); |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | if ( 'es\_newsletters' === $page || 'es\_notifications' === $page ) { |
| [282](#L282) | $ig\_es\_js\_data['campaign\_statuses'] = array( |
| [283](#L283) | 'inactive'  => IG\_ES\_CAMPAIGN\_STATUS\_IN\_ACTIVE, |
| [284](#L284) | 'active'    => IG\_ES\_CAMPAIGN\_STATUS\_ACTIVE, |
| [285](#L285) | 'scheduled' => IG\_ES\_CAMPAIGN\_STATUS\_SCHEDULED, |
| [286](#L286) | 'queued'    => IG\_ES\_CAMPAIGN\_STATUS\_QUEUED, |
| [287](#L287) | 'paused'    => IG\_ES\_CAMPAIGN\_STATUS\_PAUSED, |
| [288](#L288) | 'finished'  => IG\_ES\_CAMPAIGN\_STATUS\_FINISHED, |
| [289](#L289) | ); |
| [290](#L290) | $ig\_es\_js\_data['campaigns\_page\_url'] = admin\_url( 'admin.php?page=es\_campaigns' ); |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | wp\_localize\_script( $this->email\_subscribers, 'ig\_es\_js\_data', $ig\_es\_js\_data ); |
| [294](#L294) |  |
| [295](#L295) | if ( ! wp\_script\_is( 'clipboard', 'registered' ) ) { |
| [296](#L296) | wp\_register\_script( 'clipboard', plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/clipboard.js', array( 'jquery' ), '2.0.6', false ); |
| [297](#L297) | } |
| [298](#L298) |  |
| [299](#L299) | wp\_enqueue\_script( 'clipboard' ); |
| [300](#L300) |  |
| [301](#L301) | if ( 'es\_workflows' === $page ) { |
| [302](#L302) |  |
| [303](#L303) |  |
| [304](#L304) | if ( ! function\_exists( 'ig\_es\_wp\_js\_editor\_admin\_scripts' ) ) { |
| [305](#L305) | /\*\* |
| [306](#L306) | \* Include WP JS Editor library's main file. This file contains required functions to enqueue required js file which being used to create WordPress editor dynamcially. |
| [307](#L307) | \*/ |
| [308](#L308) | require\_once ES\_PLUGIN\_DIR . 'lite/includes/libraries/wp-js-editor/wp-js-editor.php'; |
| [309](#L309) | } |
| [310](#L310) |  |
| [311](#L311) | // Load required html/js for dynamic WordPress editor. |
| [312](#L312) | ig\_es\_wp\_js\_editor\_admin\_scripts(); |
| [313](#L313) |  |
| [314](#L314) | // Localize additional required data for workflow functionality |
| [315](#L315) | $workflows\_data = ES\_Workflow\_Admin\_Edit::get\_workflow\_data(); |
| [316](#L316) | wp\_localize\_script( $this->email\_subscribers, 'ig\_es\_workflows\_data', $workflows\_data ); |
| [317](#L317) | } elseif ( 'es\_subscribers' === $page ) { |
| [318](#L318) |  |
| [319](#L319) | $action = ig\_es\_get\_request\_data( 'action' ); |
| [320](#L320) | if ( 'import' === $action ) { |
| [321](#L321) | // Library to handle CSV file upload. |
| [322](#L322) | wp\_enqueue\_script( 'plupload-all' ); |
| [323](#L323) | } |
| [324](#L324) | } |
| [325](#L325) |  |
| [326](#L326) | if ( 'es\_campaigns' === $page ) { |
| [327](#L327) | wp\_register\_script( 'mithril', plugins\_url( '/js/mithril.min.js', \_\_FILE\_\_ ), array(), '2.0.4', true ); |
| [328](#L328) | wp\_enqueue\_script( 'mithril' ); |
| [329](#L329) |  |
| [330](#L330) | wp\_register\_script( 'ig-es-main-js', plugins\_url( '/dist/index.js', \_\_FILE\_\_ ), array( 'mithril' ), '2.0.4', true ); |
| [331](#L331) | // wp\_register\_script( 'ig-es-main-js', plugins\_url( '/dist/main.js', \_\_FILE\_\_ ), array( 'mithril' ), '2.0.4', true ); |
| [332](#L332) | wp\_enqueue\_script( 'ig-es-main-js' ); |
| [333](#L333) |  |
| [334](#L334) | if ( ! function\_exists( 'ig\_es\_wp\_js\_editor\_admin\_scripts' ) ) { |
| [335](#L335) | /\*\* |
| [336](#L336) | \* Include WP JS Editor library's main file. This file contains required functions to enqueue required js file which being used to create WordPress editor dynamcially. |
| [337](#L337) | \*/ |
| [338](#L338) | require\_once ES\_PLUGIN\_DIR . 'lite/includes/libraries/wp-js-editor/wp-js-editor.php'; |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | add\_filter( 'tiny\_mce\_before\_init', array( 'ES\_Common', 'override\_tinymce\_formatting\_options' ), 10, 2 ); |
| [342](#L342) | add\_filter( 'mce\_external\_plugins', array( 'ES\_Common', 'add\_mce\_external\_plugins' ) ); |
| [343](#L343) |  |
| [344](#L344) | // Load required html/js for dynamic WordPress editor. |
| [345](#L345) | ig\_es\_wp\_js\_editor\_admin\_scripts(); |
| [346](#L346) | } elseif ( 'es\_sequence' === $page ) { |
| [347](#L347) | add\_filter( 'tiny\_mce\_before\_init', array( 'ES\_Common', 'override\_tinymce\_formatting\_options' ), 10, 2 ); |
| [348](#L348) | add\_filter( 'mce\_external\_plugins', array( 'ES\_Common', 'add\_mce\_external\_plugins' ) ); |
| [349](#L349) | } |
| [350](#L350) |  |
| [351](#L351) |  |
| [352](#L352) |  |
| [353](#L353) | // timepicker |
| [354](#L354) | wp\_register\_script( $this->email\_subscribers . '-timepicker', plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/jquery.timepicker.js', array( 'jquery' ), ES\_PLUGIN\_VERSION, true ); |
| [355](#L355) | wp\_enqueue\_script( $this->email\_subscribers . '-timepicker' ); |
| [356](#L356) |  |
| [357](#L357) | // Select2 JS |
| [358](#L358) | if ( ! wp\_script\_is( 'select2', 'registered' ) ) { |
| [359](#L359) | wp\_register\_script( 'select2', ES\_PLUGIN\_URL . 'lite/admin/js/select2.min.js', array( 'jquery' ), '4.0.13', true ); |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) | if ( ! wp\_script\_is( 'select2' ) ) { |
| [363](#L363) | wp\_enqueue\_script( 'select2' ); |
| [364](#L364) | } |
| [365](#L365) |  |
| [366](#L366) | if ( ! empty( $page ) && 'es\_dashboard' === $page || 'es\_reports' === $page || 'es\_subscribers' === $page ) { |
| [367](#L367) | wp\_enqueue\_script( 'frappe-js', plugin\_dir\_url( \_\_FILE\_\_ ) . 'js/frappe-charts.min.iife.js', array( 'jquery' ), '1.5.2', false ); |
| [368](#L368) | } |
| [369](#L369) |  |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | public function remove\_submenu() { |
| [373](#L373) | // remove submenues |
| [374](#L374) | ?> |
| [375](#L375) | <script type="text/javascript"> |
| [376](#L376) | jQuery(document).ready(function () { |
| [377](#L377) | var removeSubmenu = ['ig-es-broadcast', 'ig-es-lists', 'ig-es-post-notifications', 'ig-es-sequence', 'ig-es-custom-fields','ig-es-drag-and-drop', 'ig-es-gallery-submenu']; |
| [378](#L378) | jQuery.each(removeSubmenu, function (key, id) { |
| [379](#L379) | jQuery("#" + id).parent('a').parent('li').hide(); |
| [380](#L380) | }); |
| [381](#L381) | }) |
| [382](#L382) | </script> |
| [383](#L383) | <?php |
| [384](#L384) | } |
| [385](#L385) |  |
| [386](#L386) | public function email\_subscribers\_admin\_menu() { |
| [387](#L387) |  |
| [388](#L388) | $accessible\_sub\_menus = ES\_Common::ig\_es\_get\_accessible\_sub\_menus(); |
| [389](#L389) |  |
| [390](#L390) | if ( count( $accessible\_sub\_menus ) > 0 ) { |
| [391](#L391) |  |
| [392](#L392) | $menu\_title = ES()->get\_admin\_menu\_title(); |
| [393](#L393) |  |
| [394](#L394) | // This adds the main menu page. |
| [395](#L395) | add\_menu\_page( $menu\_title, $menu\_title, 'edit\_posts', 'es\_dashboard', array( $this, 'es\_dashboard\_callback' ), 'dashicons-email', 30 ); |
| [396](#L396) |  |
| [397](#L397) | if ( 'woo' === IG\_ES\_PLUGIN\_PLAN ) { |
| [398](#L398) | // Add Icegram submenu under WooCommerce marketing admin menu. |
| [399](#L399) | add\_submenu\_page( 'woocommerce-marketing', $menu\_title, $menu\_title, 'manage\_woocommerce', 'es\_dashboard', array( $this, 'es\_dashboard\_callback' ) ); |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | // Submenu. |
| [403](#L403) | add\_submenu\_page( 'es\_dashboard', \_\_( 'Dashboard', 'email-subscribers' ), \_\_( 'Dashboard', 'email-subscribers' ), 'edit\_posts', 'es\_dashboard', array( $this, 'es\_dashboard\_callback' ) ); |
| [404](#L404) | } |
| [405](#L405) |  |
| [406](#L406) | if ( in\_array( 'audience', $accessible\_sub\_menus ) ) { |
| [407](#L407) | // Add Contacts Submenu |
| [408](#L408) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Audience', 'email-subscribers' ), \_\_( 'Audience', 'email-subscribers' ), 'edit\_posts', 'es\_subscribers', array( $this, 'render\_contacts' ) ); |
| [409](#L409) | add\_action( "load-$hook", array( 'ES\_Contacts\_Table', 'screen\_options' ) ); |
| [410](#L410) |  |
| [411](#L411) | // Add Lists Submenu |
| [412](#L412) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Lists', 'email-subscribers' ), '<span id="ig-es-lists">' . \_\_( 'Lists', 'email-subscribers' ) . '</span>', 'edit\_posts', 'es\_lists', array( $this, 'render\_lists' ) ); |
| [413](#L413) | add\_action( "load-$hook", array( 'ES\_Lists\_Table', 'screen\_options' ) ); |
| [414](#L414) | } |
| [415](#L415) |  |
| [416](#L416) | if ( in\_array( 'forms', $accessible\_sub\_menus ) ) { |
| [417](#L417) | // Add Forms Submenu |
| [418](#L418) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Forms', 'email-subscribers' ), \_\_( 'Forms', 'email-subscribers' ), 'edit\_posts', 'es\_forms', array( $this, 'render\_forms' ) ); |
| [419](#L419) | add\_action( "load-$hook", array( 'ES\_Forms\_Table', 'screen\_options' ) ); |
| [420](#L420) | } |
| [421](#L421) |  |
| [422](#L422) | if ( in\_array( 'campaigns', $accessible\_sub\_menus ) ) { |
| [423](#L423) | // Add Campaigns Submenu |
| [424](#L424) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Campaigns', 'email-subscribers' ), \_\_( 'Campaigns', 'email-subscribers' ), 'edit\_posts', 'es\_campaigns', array( $this, 'render\_campaigns' ) ); |
| [425](#L425) | add\_action( "load-$hook", array( 'ES\_Campaigns\_Table', 'screen\_options' ) ); |
| [426](#L426) |  |
| [427](#L427) | // Start-IG-Code. |
| [428](#L428) | add\_submenu\_page( 'es\_dashboard', \_\_( 'Post Notifications', 'email-subscribers' ), '<span id="ig-es-post-notifications">' . \_\_( 'Post Notifications', 'email-subscribers' ) . '</span>', 'edit\_posts', 'es\_notifications', array( $this, 'load\_campaign\_admin\_page' ) ); |
| [429](#L429) | // End-IG-Code. |
| [430](#L430) | add\_submenu\_page( 'es\_dashboard', \_\_( 'Broadcast', 'email-subscribers' ), '<span id="ig-es-broadcast">' . \_\_( 'Broadcast', 'email-subscribers' ) . '</span>', 'edit\_posts', 'es\_newsletters', array( $this, 'load\_campaign\_admin\_page' ) ); |
| [431](#L431) |  |
| [432](#L432) | // add\_submenu\_page( null, \_\_( 'Template', 'email-subscribers' ), '<span id="ig-es-gallery-submenu">' . \_\_( 'Templates', 'email-subscribers' ) . '</span>', 'edit\_posts', 'es\_template', array( $this, 'load\_template' ) ); |
| [433](#L433) | } |
| [434](#L434) |  |
| [435](#L435) | if ( in\_array( 'workflows', $accessible\_sub\_menus ) ) { |
| [436](#L436) |  |
| [437](#L437) | // Add Workflows Submenu |
| [438](#L438) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Workflows', 'email-subscribers' ), \_\_( 'Workflows', 'email-subscribers' ), 'edit\_posts', 'es\_workflows', array( $this, 'render\_workflows' ) ); |
| [439](#L439) |  |
| [440](#L440) | // add\_action( "load-$hook", array( 'ES\_Workflows\_Table', 'screen\_options' ) ); |
| [441](#L441) | add\_action( "load-$hook", array( 'ES\_Workflow\_Admin\_Edit', 'register\_meta\_boxes' ) ); |
| [442](#L442) | add\_action( "admin\_footer-$hook", array( 'ES\_Workflow\_Admin\_Edit', 'print\_script\_in\_footer' ) ); |
| [443](#L443) | add\_action( 'admin\_init', array( 'ES\_Workflow\_Admin\_Edit', 'maybe\_save' ) ); |
| [444](#L444) | } |
| [445](#L445) |  |
| [446](#L446) | if ( in\_array( 'reports', $accessible\_sub\_menus ) ) { |
| [447](#L447) | add\_submenu\_page( 'es\_dashboard', \_\_( 'Reports', 'email-subscribers' ), \_\_( 'Reports', 'email-subscribers' ), 'edit\_posts', 'es\_reports', array( $this, 'load\_reports' ) ); |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) | if ( in\_array( 'logs', $accessible\_sub\_menus ) ) { |
| [451](#L451) | add\_submenu\_page( 'es\_dashboard', \_\_( 'Logs', 'email-subscribers' ), \_\_( 'Logs', 'email-subscribers' ), 'edit\_posts', 'es\_logs', array( $this, 'load\_logs' ) ); |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | if ( in\_array( 'settings', $accessible\_sub\_menus ) ) { |
| [455](#L455) | $hook = add\_submenu\_page( 'es\_dashboard', \_\_( 'Settings', 'email-subscribers' ), \_\_( 'Settings', 'email-subscribers' ), 'manage\_options', 'es\_settings', array( $this, 'load\_settings' ) ); |
| [456](#L456) | add\_action( "load-$hook", array( 'ES\_Admin\_Settings', 'screen\_options' ) ); |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) | /\*\* |
| [460](#L460) | \* Add Other Submenu Pages |
| [461](#L461) | \* |
| [462](#L462) | \* @since 4.3.0 |
| [463](#L463) | \*/ |
| [464](#L464) | do\_action( 'ig\_es\_add\_submenu\_page', $accessible\_sub\_menus ); |
| [465](#L465) |  |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | public function plugins\_loaded() { |
| [469](#L469) | ES\_Templates\_Table::get\_instance(); |
| [470](#L470) | new Export\_Subscribers(); |
| [471](#L471) | new ES\_Handle\_Post\_Notification(); |
| [472](#L472) | ES\_Handle\_Sync\_Wp\_User::get\_instance(); |
| [473](#L473) | new ES\_Import\_Subscribers(); |
| [474](#L474) | // Start-IG-Code. |
| [475](#L475) | ES\_Info::get\_instance(); |
| [476](#L476) | // End-IG-Code. |
| [477](#L477) | ES\_Newsletters::get\_instance(); |
| [478](#L478) | ES\_Tools::get\_instance(); |
| [479](#L479) | new ES\_Tracking(); |
| [480](#L480) | } |
| [481](#L481) |  |
| [482](#L482) | /\*\* |
| [483](#L483) | \* Function for Klawoo's Subscribe form on Help & Info page |
| [484](#L484) | \* |
| [485](#L485) | \* @param boolean $return Flag to check return response instead of exiting in the function itself. |
| [486](#L486) | \*/ |
| [487](#L487) | public static function klawoo\_subscribe( $return = false ) { |
| [488](#L488) |  |
| [489](#L489) | // We don't need to do nonce validation in case if the function is being called from other function. |
| [490](#L490) | if ( ! $return ) { |
| [491](#L491) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [492](#L492) | } |
| [493](#L493) |  |
| [494](#L494) | $response = array( |
| [495](#L495) | 'status' => 'error', |
| [496](#L496) | ); |
| [497](#L497) |  |
| [498](#L498) | $url = 'http://app.klawoo.com/subscribe'; |
| [499](#L499) |  |
| [500](#L500) | $form\_source = ig\_es\_get\_request\_data( 'from\_source' ); |
| [501](#L501) | if ( ! empty( $form\_source ) ) { |
| [502](#L502) | update\_option( 'ig\_es\_onboarding\_status', $form\_source ); |
| [503](#L503) | } |
| [504](#L504) |  |
| [505](#L505) | if ( ! empty( $\_POST ) ) { |
| [506](#L506) | $params = ig\_es\_get\_data( $\_POST, '', array(), true ); |
| [507](#L507) | } else { |
| [508](#L508) | if ( ! $return ) { |
| [509](#L509) | exit(); |
| [510](#L510) | } else { |
| [511](#L511) | return $response; |
| [512](#L512) | } |
| [513](#L513) | } |
| [514](#L514) | $method = 'POST'; |
| [515](#L515) | $qs     = http\_build\_query( $params ); |
| [516](#L516) |  |
| [517](#L517) | $options = array( |
| [518](#L518) | 'timeout' => 15, |
| [519](#L519) | 'method'  => $method, |
| [520](#L520) | ); |
| [521](#L521) |  |
| [522](#L522) | if ( 'POST' == $method ) { |
| [523](#L523) | $options['body'] = $qs; |
| [524](#L524) | } else { |
| [525](#L525) | if ( strpos( $url, '?' ) !== false ) { |
| [526](#L526) | $url .= '&' . $qs; |
| [527](#L527) | } else { |
| [528](#L528) | $url .= '?' . $qs; |
| [529](#L529) | } |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | $request\_response = wp\_remote\_request( $url, $options ); |
| [533](#L533) | if ( 200 == wp\_remote\_retrieve\_response\_code( $request\_response ) ) { |
| [534](#L534) | $data = $request\_response['body']; |
| [535](#L535) | if ( 'error' != $data ) { |
| [536](#L536) |  |
| [537](#L537) | $message\_start = substr( $data, strpos( $data, '<body>' ) + 6 ); |
| [538](#L538) | $remove        = substr( $message\_start, strpos( $message\_start, '</body>' ) ); |
| [539](#L539) | $message       = trim( str\_replace( $remove, '', $message\_start ) ); |
| [540](#L540) | if ( ! $return ) { |
| [541](#L541) | echo wp\_kses\_post( $message ); |
| [542](#L542) | exit(); |
| [543](#L543) | } else { |
| [544](#L544) | $response['status']  = 'success'; |
| [545](#L545) | $response['message'] = $message; |
| [546](#L546) | return $response; |
| [547](#L547) | } |
| [548](#L548) | } |
| [549](#L549) | } |
| [550](#L550) | if ( ! $return ) { |
| [551](#L551) | exit(); |
| [552](#L552) | } else { |
| [553](#L553) | return $response; |
| [554](#L554) | } |
| [555](#L555) | } |
| [556](#L556) |  |
| [557](#L557) | /\*\* |
| [558](#L558) | \* Render Workflows Screen |
| [559](#L559) | \* |
| [560](#L560) | \* @since 4.2.1 |
| [561](#L561) | \*/ |
| [562](#L562) | public function render\_workflows() { |
| [563](#L563) | $workflows = new ES\_Workflows\_Table(); |
| [564](#L564) | $workflows->render(); |
| [565](#L565) | } |
| [566](#L566) |  |
| [567](#L567) | /\*\* |
| [568](#L568) | \* Render Campaigns Screen |
| [569](#L569) | \* |
| [570](#L570) | \* @since 4.2.1 |
| [571](#L571) | \*/ |
| [572](#L572) | public function render\_campaigns() { |
| [573](#L573) | $campaigns = ES\_Campaigns\_Table::get\_instance(); |
| [574](#L574) | $campaigns->render(); |
| [575](#L575) | } |
| [576](#L576) |  |
| [577](#L577) | /\*\* |
| [578](#L578) | \* Render Contacts Screen |
| [579](#L579) | \* |
| [580](#L580) | \* @since 4.2.1 |
| [581](#L581) | \*/ |
| [582](#L582) | public function render\_contacts() { |
| [583](#L583) | $contacts = new ES\_Contacts\_Table(); |
| [584](#L584) | $contacts->render(); |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | /\*\* |
| [588](#L588) | \* Render Forms Screen |
| [589](#L589) | \* |
| [590](#L590) | \* @since 4.2.1 |
| [591](#L591) | \*/ |
| [592](#L592) | public function render\_forms() { |
| [593](#L593) | $forms = new ES\_Forms\_Table(); |
| [594](#L594) | $forms->render(); |
| [595](#L595) | } |
| [596](#L596) |  |
| [597](#L597) | /\*\* |
| [598](#L598) | \* Render Lists Screen |
| [599](#L599) | \* |
| [600](#L600) | \* @since 4.2.1 |
| [601](#L601) | \*/ |
| [602](#L602) | public function render\_lists() { |
| [603](#L603) | $lists = new ES\_Lists\_Table(); |
| [604](#L604) | $lists->render(); |
| [605](#L605) | } |
| [606](#L606) |  |
| [607](#L607) | /\*\* |
| [608](#L608) | \* Render Post Notifications |
| [609](#L609) | \* |
| [610](#L610) | \* @since 4.2.1 |
| [611](#L611) | \*/ |
| [612](#L612) | public function load\_campaign\_admin\_page() { |
| [613](#L613) | $campaign\_admin = ES\_Campaign\_Admin::get\_instance(); |
| [614](#L614) | $campaign\_admin->setup(); |
| [615](#L615) | $campaign\_admin->render(); |
| [616](#L616) | } |
| [617](#L617) |  |
| [618](#L618) | /\*\* |
| [619](#L619) | \* Load single template |
| [620](#L620) | \* |
| [621](#L621) | \* @return void |
| [622](#L622) | \*/ |
| [623](#L623) | public function load\_template() { |
| [624](#L624) | $template\_admin = ES\_Template\_Admin::get\_instance(); |
| [625](#L625) | $template\_admin->setup(); |
| [626](#L626) | $template\_admin->render(); |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | /\*\* |
| [630](#L630) | \* Render Newsletters |
| [631](#L631) | \* |
| [632](#L632) | \* @since 4.2.1 |
| [633](#L633) | \*/ |
| [634](#L634) | public function load\_newsletters() { |
| [635](#L635) | $newsletters = ES\_Newsletters::get\_instance(); |
| [636](#L636) | $newsletters->es\_newsletters\_settings\_callback(); |
| [637](#L637) | } |
| [638](#L638) |  |
| [639](#L639) | /\*\* |
| [640](#L640) | \* Render Reports |
| [641](#L641) | \* |
| [642](#L642) | \* @since 4.2.1 |
| [643](#L643) | \*/ |
| [644](#L644) | public function load\_reports() { |
| [645](#L645) | $reports = ES\_Reports\_Table::get\_instance(); |
| [646](#L646) | $reports->es\_reports\_callback(); |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) | /\*\* |
| [650](#L650) | \* Render Logs |
| [651](#L651) | \* |
| [652](#L652) | \* @since 5.6.6 |
| [653](#L653) | \*/ |
| [654](#L654) | public function load\_logs() { |
| [655](#L655) | ES\_Logs::show\_es\_logs(); |
| [656](#L656) | } |
| [657](#L657) |  |
| [658](#L658) | /\*\* |
| [659](#L659) | \* Render drag and drop |
| [660](#L660) | \* |
| [661](#L661) | \* @since 5.0.3 |
| [662](#L662) | \*/ |
| [663](#L663) | public function load\_drag\_and\_drop() { |
| [664](#L664) | $danddeditor = ES\_Drag\_And\_Drop\_Editor::get\_instance(); |
| [665](#L665) | $danddeditor->es\_draganddrop\_callback(); |
| [666](#L666) | } |
| [667](#L667) |  |
| [668](#L668) | /\*\* |
| [669](#L669) | \* Render Settings |
| [670](#L670) | \* |
| [671](#L671) | \* @since 4.2.1 |
| [672](#L672) | \*/ |
| [673](#L673) | public function load\_settings() { |
| [674](#L674) | $settings = ES\_Admin\_Settings::get\_instance(); |
| [675](#L675) | $settings->es\_settings\_callback(); |
| [676](#L676) | } |
| [677](#L677) |  |
| [678](#L678) | /\*\* |
| [679](#L679) | \* Render Preview |
| [680](#L680) | \* |
| [681](#L681) | \* @since 4.2.1 |
| [682](#L682) | \*/ |
| [683](#L683) | public function load\_preview() { |
| [684](#L684) | $preview = ES\_Templates\_Table::get\_instance(); |
| [685](#L685) | $preview->es\_template\_preview\_callback(); |
| [686](#L686) | } |
| [687](#L687) |  |
| [688](#L688) | /\*\* |
| [689](#L689) | \* Redirect to icegram if required |
| [690](#L690) | \* |
| [691](#L691) | \* @since 4.4.1 |
| [692](#L692) | \*/ |
| [693](#L693) | public function go\_to\_icegram() { |
| [694](#L694) | ES\_IG\_Redirect::go\_to\_icegram(); |
| [695](#L695) | } |
| [696](#L696) |  |
| [697](#L697) |  |
| [698](#L698) | public function submenu\_order( $menu\_order ) { |
| [699](#L699) | global $submenu; |
| [700](#L700) |  |
| [701](#L701) | $es\_menus = isset( $submenu['es\_dashboard'] ) ? $submenu['es\_dashboard'] : array(); |
| [702](#L702) |  |
| [703](#L703) | if ( ! empty( $es\_menus ) ) { |
| [704](#L704) |  |
| [705](#L705) | $es\_menu\_order = array( |
| [706](#L706) | 'es\_dashboard', |
| [707](#L707) | 'es\_subscribers', |
| [708](#L708) | 'es\_lists', |
| [709](#L709) | 'es\_forms', |
| [710](#L710) | 'es\_campaigns', |
| [711](#L711) | 'es\_workflows', |
| [712](#L712) | 'edit.php?post\_type=es\_template', |
| [713](#L713) | 'es\_notifications', |
| [714](#L714) | 'es\_newsletters', |
| [715](#L715) | 'es\_sequence', |
| [716](#L716) | 'es\_integrations', |
| [717](#L717) | 'es\_reports', |
| [718](#L718) | 'es\_tools', |
| [719](#L719) | 'es\_settings', |
| [720](#L720) | 'es\_general\_information', |
| [721](#L721) | 'es\_pricing', |
| [722](#L722) | ); |
| [723](#L723) |  |
| [724](#L724) | $order = array\_flip( $es\_menu\_order ); |
| [725](#L725) |  |
| [726](#L726) | $reorder\_es\_menu = array(); |
| [727](#L727) | foreach ( $es\_menus as $menu ) { |
| [728](#L728) | $reorder\_es\_menu[ $order[ $menu[2] ] ] = $menu; |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | ksort( $reorder\_es\_menu ); |
| [732](#L732) |  |
| [733](#L733) | // $submenu['es\_dashboard'] = $reorder\_es\_menu; |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | // Return the new submenu order |
| [737](#L737) | return $menu\_order; |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | public function es\_dashboard\_callback() { |
| [741](#L741) | $ig\_es\_db\_update\_history  = ES\_Common::get\_ig\_option( 'db\_update\_history', array() ); |
| [742](#L742) | $ig\_es\_4015\_db\_updated\_at = ( is\_array( $ig\_es\_db\_update\_history ) && isset( $ig\_es\_db\_update\_history['4.0.15'] ) ) ? $ig\_es\_db\_update\_history['4.0.15'] : false; |
| [743](#L743) |  |
| [744](#L744) | $is\_sa\_option\_exists = get\_option( 'current\_sa\_email\_subscribers\_db\_version', false ); |
| [745](#L745) | $onboarding\_status   = get\_option( 'ig\_es\_onboarding\_complete', 'no' ); |
| [746](#L746) | if ( ! $is\_sa\_option\_exists && ! $ig\_es\_4015\_db\_updated\_at && 'yes' !== $onboarding\_status ) { |
| [747](#L747) | $this->show\_onboarding(); |
| [748](#L748) | } else { |
| [749](#L749) | $this->show\_dashboard(); |
| [750](#L750) | } |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | /\*\* |
| [754](#L754) | \* Show onboarding page |
| [755](#L755) | \* |
| [756](#L756) | \* @since 5.5.4 |
| [757](#L757) | \*/ |
| [758](#L758) | public function show\_onboarding() { |
| [759](#L759) | include plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/partials/onboarding.php'; |
| [760](#L760) | } |
| [761](#L761) |  |
| [762](#L762) | /\*\* |
| [763](#L763) | \* Show dashboard page |
| [764](#L764) | \* |
| [765](#L765) | \* @since 5.5.4 |
| [766](#L766) | \*/ |
| [767](#L767) | public function show\_dashboard() { |
| [768](#L768) | $es\_dashboard = new ES\_Dashboard(); |
| [769](#L769) | $es\_dashboard->show(); |
| [770](#L770) | } |
| [771](#L771) |  |
| [772](#L772) | public function count\_contacts\_by\_list() { |
| [773](#L773) |  |
| [774](#L774) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [775](#L775) |  |
| [776](#L776) | $can\_access\_audience = ES\_Common::ig\_es\_can\_access( 'audience' ); |
| [777](#L777) | $can\_access\_campaign = ES\_Common::ig\_es\_can\_access( 'campaigns' ); |
| [778](#L778) | if ( ! ( $can\_access\_audience || $can\_access\_campaign ) ) { |
| [779](#L779) | return 0; |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | $list\_id    = ig\_es\_get\_request\_data( 'list\_id', 0 ); |
| [783](#L783) | $status     = ig\_es\_get\_request\_data( 'status', 'all' ); |
| [784](#L784) | $conditions = ig\_es\_get\_request\_data( 'conditions', array() ); |
| [785](#L785) | $get\_count  = ig\_es\_get\_request\_data( 'get\_count', 'no' ); |
| [786](#L786) |  |
| [787](#L787) | $list\_id = absint( $list\_id ); |
| [788](#L788) | if ( 0 == $list\_id && empty( $conditions ) ) { |
| [789](#L789) | return 0; |
| [790](#L790) | } |
| [791](#L791) |  |
| [792](#L792) | $expected\_statuses = array( 'subscribed', 'unsubscribed', 'unconfirmed', 'confirmed', 'all' ); |
| [793](#L793) |  |
| [794](#L794) | if ( ! in\_array( $status, $expected\_statuses, true ) ) { |
| [795](#L795) | return 0; |
| [796](#L796) | } |
| [797](#L797) |  |
| [798](#L798) | $response\_data = array(); |
| [799](#L799) |  |
| [800](#L800) | if ( ! empty( $conditions ) ) { |
| [801](#L801) | $conditions = IG\_ES\_Campaign\_Rules::remove\_empty\_conditions( $conditions ); |
| [802](#L802) | if ( 'yes' === $get\_count ) { |
| [803](#L803) | if ( ! empty( $conditions ) ) { |
| [804](#L804) | $args                   = array( |
| [805](#L805) | 'lists'             => $list\_id, |
| [806](#L806) | 'conditions'        => $conditions, |
| [807](#L807) | 'status'            => $status, |
| [808](#L808) | 'subscriber\_status' => array( 'verified' ), |
| [809](#L809) | 'return\_count'      => true, |
| [810](#L810) | ); |
| [811](#L811) | $query                  = new IG\_ES\_Subscribers\_Query(); |
| [812](#L812) | $response\_data['total'] = $query->run( $args ); |
| [813](#L813) | } else { |
| [814](#L814) | $response\_data['total'] = 0; |
| [815](#L815) | } |
| [816](#L816) | } |
| [817](#L817) | ob\_start(); |
| [818](#L818) | do\_action( 'ig\_es\_campaign\_show\_conditions', $conditions ); |
| [819](#L819) | $response\_data['conditions\_html'] = ob\_get\_clean(); |
| [820](#L820) | } else { |
| [821](#L821) | $response\_data['total'] = ES()->lists\_contacts\_db->get\_total\_count\_by\_list( $list\_id, $status ); |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | if ( ! empty( $response\_data['total'] ) ) { |
| [825](#L825) | $response\_data['total'] = number\_format( $response\_data['total'] ); |
| [826](#L826) | } |
| [827](#L827) |  |
| [828](#L828) | die( json\_encode( $response\_data ) ); |
| [829](#L829) | } |
| [830](#L830) |  |
| [831](#L831) | /\*\* |
| [832](#L832) | \* Get Icegram Express' screen options |
| [833](#L833) | \* |
| [834](#L834) | \* @return array |
| [835](#L835) | \* |
| [836](#L836) | \* @since 4.5.4 |
| [837](#L837) | \*/ |
| [838](#L838) | public function get\_admin\_screen\_options() { |
| [839](#L839) |  |
| [840](#L840) | $admin\_screen\_options = array( |
| [841](#L841) | 'es\_campaigns\_per\_page', |
| [842](#L842) | 'es\_contacts\_per\_page', |
| [843](#L843) | 'es\_lists\_per\_page', |
| [844](#L844) | 'es\_forms\_per\_page', |
| [845](#L845) | 'es\_workflows\_per\_page', |
| [846](#L846) | ); |
| [847](#L847) |  |
| [848](#L848) | return apply\_filters( 'ig\_es\_admin\_screen\_options', $admin\_screen\_options ); |
| [849](#L849) | } |
| [850](#L850) |  |
| [851](#L851) | /\*\* |
| [852](#L852) | \* Hooked to 'set-screen-options' filter |
| [853](#L853) | \* |
| [854](#L854) | \* @param $status |
| [855](#L855) | \* @param $option |
| [856](#L856) | \* @param $value |
| [857](#L857) | \* |
| [858](#L858) | \* @return mixed |
| [859](#L859) | \* |
| [860](#L860) | \* @since 4.2.1 |
| [861](#L861) | \*/ |
| [862](#L862) | public function save\_screen\_options( $status, $option, $value ) { |
| [863](#L863) |  |
| [864](#L864) | $admin\_screen\_options = $this->get\_admin\_screen\_options(); |
| [865](#L865) |  |
| [866](#L866) | if ( in\_array( $option, $admin\_screen\_options ) ) { |
| [867](#L867) |  |
| [868](#L868) | return $value; |
| [869](#L869) | } |
| [870](#L870) |  |
| [871](#L871) | return $status; |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | /\*\* |
| [875](#L875) | \* Hook 'save\_screen\_options' function to "set\_screen\_option\_{$option}" filter to allow saving of ES custom screen options in WP 5.4.2 |
| [876](#L876) | \* |
| [877](#L877) | \* @since 4.5.4 |
| [878](#L878) | \*/ |
| [879](#L879) | public function save\_screen\_option() { |
| [880](#L880) |  |
| [881](#L881) | $admin\_screen\_options = $this->get\_admin\_screen\_options(); |
| [882](#L882) |  |
| [883](#L883) | if ( ! empty( $admin\_screen\_options ) && is\_array( $admin\_screen\_options ) ) { |
| [884](#L884) | foreach ( $admin\_screen\_options as $option ) { |
| [885](#L885) | add\_filter( "set\_screen\_option\_{$option}", array( $this, 'save\_screen\_options' ), 10, 3 ); |
| [886](#L886) | } |
| [887](#L887) | } |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) | /\*\* |
| [891](#L891) | \* Remove all admin notices |
| [892](#L892) | \* |
| [893](#L893) | \* @since 4.4.0 |
| [894](#L894) | \*/ |
| [895](#L895) | public function remove\_other\_admin\_notices() { |
| [896](#L896) | global $wp\_filter; |
| [897](#L897) |  |
| [898](#L898) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [899](#L899) | return; |
| [900](#L900) | } |
| [901](#L901) |  |
| [902](#L902) | $get\_page = ig\_es\_get\_request\_data( 'page' ); |
| [903](#L903) |  |
| [904](#L904) | if ( ! empty( $get\_page ) && 'es\_dashboard' == $get\_page ) { |
| [905](#L905) |  |
| [906](#L906) | // Allow only Icegram Connection popup on Dashboard |
| [907](#L907) | $es\_display\_notices = array( |
| [908](#L908) | 'connect\_icegram\_notification', |
| [909](#L909) | ); |
| [910](#L910) |  |
| [911](#L911) | } else { |
| [912](#L912) |  |
| [913](#L913) | $es\_display\_notices = array( |
| [914](#L914) | 'connect\_icegram\_notification', |
| [915](#L915) | 'show\_review\_notice', |
| [916](#L916) | 'custom\_admin\_notice', |
| [917](#L917) | 'output\_custom\_notices', |
| [918](#L918) | 'ig\_es\_fail\_php\_version\_notice', |
| [919](#L919) | 'show\_reconnect\_notification', |
| [920](#L920) | 'show\_tracker\_notice', |
| [921](#L921) | 'show\_new\_keyword\_notice', |
| [922](#L922) | 'show\_membership\_integration\_notice', |
| [923](#L923) | 'show\_email\_sending\_failed\_notice', |
| [924](#L924) | 'show\_ess\_fallback\_removal\_notice', |
| [925](#L925) | 'show\_post\_duplicator\_promotion\_notice', |
| [926](#L926) | 'show\_ess\_promotion\_notice', |
| [927](#L927) | 'ig\_es\_show\_feature\_survey', |
| [928](#L928) | 'ig\_es\_show\_trial\_optin\_reminder\_notice', |
| [929](#L929) | 'show\_list\_cleanup\_notice', |
| [930](#L930) | ); |
| [931](#L931) | } |
| [932](#L932) |  |
| [933](#L933) | // User admin notices |
| [934](#L934) | if ( ! empty( $wp\_filter['user\_admin\_notices']->callbacks ) && is\_array( $wp\_filter['user\_admin\_notices']->callbacks ) ) { |
| [935](#L935) | foreach ( $wp\_filter['user\_admin\_notices']->callbacks as $priority => $callbacks ) { |
| [936](#L936) | foreach ( $callbacks as $name => $details ) { |
| [937](#L937) |  |
| [938](#L938) | if ( is\_object( $details['function'] ) && $details['function'] instanceof \Closure ) { |
| [939](#L939) | unset( $wp\_filter['user\_admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [940](#L940) | continue; |
| [941](#L941) | } |
| [942](#L942) |  |
| [943](#L943) | if ( ! empty( $details['function'][0] ) && is\_object( $details['function'][0] ) && count( $details['function'] ) == 2 ) { |
| [944](#L944) | $notice\_callback\_name = $details['function'][1]; |
| [945](#L945) | if ( ! in\_array( $notice\_callback\_name, $es\_display\_notices ) ) { |
| [946](#L946) | unset( $wp\_filter['user\_admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [947](#L947) | } |
| [948](#L948) | } |
| [949](#L949) | } |
| [950](#L950) | } |
| [951](#L951) | } |
| [952](#L952) |  |
| [953](#L953) | // Admin notices |
| [954](#L954) | if ( ! empty( $wp\_filter['admin\_notices']->callbacks ) && is\_array( $wp\_filter['admin\_notices']->callbacks ) ) { |
| [955](#L955) | foreach ( $wp\_filter['admin\_notices']->callbacks as $priority => $callbacks ) { |
| [956](#L956) | foreach ( $callbacks as $name => $details ) { |
| [957](#L957) |  |
| [958](#L958) | if ( is\_object( $details['function'] ) && $details['function'] instanceof \Closure ) { |
| [959](#L959) | unset( $wp\_filter['admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [960](#L960) | continue; |
| [961](#L961) | } |
| [962](#L962) |  |
| [963](#L963) | if ( ! empty( $details['function'][0] ) && is\_object( $details['function'][0] ) && count( $details['function'] ) == 2 ) { |
| [964](#L964) | $notice\_callback\_name = $details['function'][1]; |
| [965](#L965) | if ( ! in\_array( $notice\_callback\_name, $es\_display\_notices ) ) { |
| [966](#L966) | unset( $wp\_filter['admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [967](#L967) | } |
| [968](#L968) | } |
| [969](#L969) | } |
| [970](#L970) | } |
| [971](#L971) | } |
| [972](#L972) |  |
| [973](#L973) | // All admin notices |
| [974](#L974) | if ( ! empty( $wp\_filter['all\_admin\_notices']->callbacks ) && is\_array( $wp\_filter['all\_admin\_notices']->callbacks ) ) { |
| [975](#L975) | foreach ( $wp\_filter['all\_admin\_notices']->callbacks as $priority => $callbacks ) { |
| [976](#L976) | foreach ( $callbacks as $name => $details ) { |
| [977](#L977) |  |
| [978](#L978) | if ( is\_object( $details['function'] ) && $details['function'] instanceof \Closure ) { |
| [979](#L979) | unset( $wp\_filter['all\_admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [980](#L980) | continue; |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | if ( ! empty( $details['function'][0] ) && is\_object( $details['function'][0] ) && count( $details['function'] ) == 2 ) { |
| [984](#L984) | $notice\_callback\_name = $details['function'][1]; |
| [985](#L985) | if ( ! in\_array( $notice\_callback\_name, $es\_display\_notices ) ) { |
| [986](#L986) | unset( $wp\_filter['all\_admin\_notices']->callbacks[ $priority ][ $name ] ); |
| [987](#L987) | } |
| [988](#L988) | } |
| [989](#L989) | } |
| [990](#L990) | } |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | } |
| [994](#L994) |  |
| [995](#L995) | /\*\* |
| [996](#L996) | \* Update admin footer text |
| [997](#L997) | \* |
| [998](#L998) | \* @param $footer\_text |
| [999](#L999) | \* |
| [1000](#L1000) | \* @return string |
| [1001](#L1001) | \* |
| [1002](#L1002) | \* @since 4.4.6 |
| [1003](#L1003) | \*/ |
| [1004](#L1004) | public function update\_admin\_footer\_text( $footer\_text ) { |
| [1005](#L1005) |  |
| [1006](#L1006) | // Update Footer admin only on ES pages |
| [1007](#L1007) | if ( ES()->is\_es\_admin\_screen() ) { |
| [1008](#L1008) |  |
| [1009](#L1009) | $wordpress\_url = 'https://www.wordpress.org'; |
| [1010](#L1010) | $icegram\_url   = 'https://www.icegram.com'; |
| [1011](#L1011) |  |
| [1012](#L1012) | /\* translators: 1. WordPress URL 2. Icegram Express version 3. Icegram site URL \*/ |
| [1013](#L1013) | $footer\_text = sprintf( \_\_( '<span id="footer-thankyou">Thank you for creating with <a href="%1$s" target="\_blank">WordPress</a> | Icegram Express <b>%2$s</b>. Developed by team <a href="%3$s" target="\_blank">Icegram</a></span>', 'email-subscribers' ), esc\_url( $wordpress\_url ), ES\_PLUGIN\_VERSION, esc\_url( $icegram\_url ) ); |
| [1014](#L1014) | } |
| [1015](#L1015) |  |
| [1016](#L1016) | return $footer\_text; |
| [1017](#L1017) | } |
| [1018](#L1018) |  |
| [1019](#L1019) | /\*\* |
| [1020](#L1020) | \* Method to start output buffering to allows admin screens to make redirects later on. |
| [1021](#L1021) | \* |
| [1022](#L1022) | \* @since 4.5.2 |
| [1023](#L1023) | \*/ |
| [1024](#L1024) | public function ob\_start() { |
| [1025](#L1025) | ob\_start(); |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | /\*\* |
| [1029](#L1029) | \* Method to get email header. |
| [1030](#L1030) | \* |
| [1031](#L1031) | \* @param array $sender\_data . |
| [1032](#L1032) | \* |
| [1033](#L1033) | \* @return array $headers |
| [1034](#L1034) | \* |
| [1035](#L1035) | \* @since 4.6.1 |
| [1036](#L1036) | \*/ |
| [1037](#L1037) | public function get\_email\_headers( $sender\_data = array() ) { |
| [1038](#L1038) | $get\_email\_type = get\_option( 'ig\_es\_email\_type', true ); |
| [1039](#L1039) | $site\_title     = get\_bloginfo(); |
| [1040](#L1040) | $admin\_email    = get\_option( 'admin\_email' ); |
| [1041](#L1041) |  |
| [1042](#L1042) | $from\_name  = ''; |
| [1043](#L1043) | $from\_email = ''; |
| [1044](#L1044) | if ( ! empty( $sender\_data ) ) { |
| [1045](#L1045) | $from\_name  = $sender\_data['from\_name']; |
| [1046](#L1046) | $from\_email = $sender\_data['from\_email']; |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | // adding missing from name |
| [1050](#L1050) | if ( empty( $from\_name ) ) { |
| [1051](#L1051) | $from\_name = get\_option( 'ig\_es\_from\_name', true ); |
| [1052](#L1052) | } |
| [1053](#L1053) |  |
| [1054](#L1054) | // adding missing from email |
| [1055](#L1055) | if ( empty( $from\_email ) ) { |
| [1056](#L1056) | $from\_email = get\_option( 'ig\_es\_from\_email', true ); |
| [1057](#L1057) | } |
| [1058](#L1058) |  |
| [1059](#L1059) | $sender\_email = ! empty( $from\_email ) ? $from\_email : $admin\_email; |
| [1060](#L1060) | $sender\_name  = ! empty( $from\_name ) ? $from\_name : $site\_title; |
| [1061](#L1061) |  |
| [1062](#L1062) | $headers = array( |
| [1063](#L1063) | "From: \"$sender\_name\" <$sender\_email>", |
| [1064](#L1064) | 'Return-Path: <' . $sender\_email . '>', |
| [1065](#L1065) | 'Reply-To: "' . $sender\_name . '" <' . $sender\_email . '>', |
| [1066](#L1066) | ); |
| [1067](#L1067) |  |
| [1068](#L1068) | if ( in\_array( $get\_email\_type, array( 'php\_html\_mail', 'php\_plaintext\_mail' ) ) ) { |
| [1069](#L1069) | $headers[] = 'MIME-Version: 1.0'; |
| [1070](#L1070) | $headers[] = 'X-Mailer: PHP' . phpversion(); |
| [1071](#L1071) | } |
| [1072](#L1072) |  |
| [1073](#L1073) | if ( in\_array( $get\_email\_type, array( 'wp\_html\_mail', 'php\_html\_mail' ) ) ) { |
| [1074](#L1074) | $headers[] = 'Content-Type: text/html; charset="' . get\_bloginfo( 'charset' ) . '"'; |
| [1075](#L1075) | } else { |
| [1076](#L1076) | $headers[] = 'Content-Type: text/plain; charset="' . get\_bloginfo( 'charset' ) . '"'; |
| [1077](#L1077) | } |
| [1078](#L1078) | $headers = implode( "\n", $headers ); |
| [1079](#L1079) |  |
| [1080](#L1080) | return $headers; |
| [1081](#L1081) | } |
| [1082](#L1082) |  |
| [1083](#L1083) | /\*\* |
| [1084](#L1084) | \* Method to send cron data to our server if not already sent. |
| [1085](#L1085) | \* |
| [1086](#L1086) | \* @since 4.6.1 |
| [1087](#L1087) | \*/ |
| [1088](#L1088) | public function send\_cron\_data( $options = array() ) { |
| [1089](#L1089) |  |
| [1090](#L1090) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [1091](#L1091) | return; |
| [1092](#L1092) | } |
| [1093](#L1093) |  |
| [1094](#L1094) | $handle\_cron\_data\_service = new ES\_Service\_Handle\_Cron\_Data(); |
| [1095](#L1095) |  |
| [1096](#L1096) | // Send cron data to server |
| [1097](#L1097) | $handle\_cron\_data\_service->handle\_es\_cron\_data( $options ); |
| [1098](#L1098) | } |
| [1099](#L1099) |  |
| [1100](#L1100) | /\*\* |
| [1101](#L1101) | \* Method to add ES service data(Inline CSS, UTM tracking to links etc) to email content |
| [1102](#L1102) | \* |
| [1103](#L1103) | \* @param array $data |
| [1104](#L1104) | \* |
| [1105](#L1105) | \* @return array $data |
| [1106](#L1106) | \* |
| [1107](#L1107) | \* @since 4.6.2 |
| [1108](#L1108) | \*/ |
| [1109](#L1109) | public function add\_premium\_services\_data( $data = array() ) { |
| [1110](#L1110) |  |
| [1111](#L1111) | $process\_email\_content\_service = new ES\_Service\_Process\_Email\_Content(); |
| [1112](#L1112) |  |
| [1113](#L1113) | $data = $process\_email\_content\_service->process\_email\_content( $data ); |
| [1114](#L1114) |  |
| [1115](#L1115) | return $data; |
| [1116](#L1116) | } |
| [1117](#L1117) |  |
| [1118](#L1118) | /\*\* |
| [1119](#L1119) | \* Method to add ES service data(Inline CSS, UTM tracking to links etc) to email content |
| [1120](#L1120) | \* |
| [1121](#L1121) | \* @param array $data |
| [1122](#L1122) | \* |
| [1123](#L1123) | \* @return array $data |
| [1124](#L1124) | \* |
| [1125](#L1125) | \* @since 4.6.2 |
| [1126](#L1126) | \*/ |
| [1127](#L1127) | public function add\_util\_data( $data = array() ) { |
| [1128](#L1128) |  |
| [1129](#L1129) | // Add CSS inliner task data to request if valid request. |
| [1130](#L1130) | if ( ES()->validate\_service\_request( array( 'css\_inliner' ) ) ) { |
| [1131](#L1131) |  |
| [1132](#L1132) | $meta         = ! empty( $data['campaign\_id'] ) ? ES()->campaigns\_db->get\_campaign\_meta\_by\_id( $data['campaign\_id'] ) : ''; |
| [1133](#L1133) | $data['html'] = $data['content']; |
| [1134](#L1134) | $data['css']  = ''; |
| [1135](#L1135) | if ( ! empty( $meta['es\_custom\_css'] ) ) { |
| [1136](#L1136) | $data['css'] = $meta['es\_custom\_css']; |
| [1137](#L1137) | } elseif ( ! empty( $data['tmpl\_id'] ) ) { |
| [1138](#L1138) | $data['css'] = get\_post\_meta( $data['tmpl\_id'], 'es\_custom\_css', true ); |
| [1139](#L1139) | } |
| [1140](#L1140) | $data['tasks'][] = 'css-inliner'; |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) | // Add utm tracking task data to request if valid request. |
| [1144](#L1144) | if ( ES()->validate\_service\_request( array( 'utm\_tracking' ) ) ) { |
| [1145](#L1145) |  |
| [1146](#L1146) | if ( ! empty( $data['campaign\_id'] ) ) { |
| [1147](#L1147) | $campaign\_id   = $data['campaign\_id']; |
| [1148](#L1148) | $can\_track\_utm = ES()->mailer->can\_track\_utm( $data ); |
| [1149](#L1149) | if ( $can\_track\_utm ) { |
| [1150](#L1150) | $meta                             = ES()->campaigns\_db->get\_campaign\_meta\_by\_id( $campaign\_id ); |
| [1151](#L1151) | $data['html']                     = $data['content']; |
| [1152](#L1152) | $data['utm\_params']['utm\_source'] = 'es'; |
| [1153](#L1153) | $data['utm\_params']['utm\_medium'] = 'email'; |
| [1154](#L1154) | $data['tasks'][]                  = 'utm-tracking'; |
| [1155](#L1155) | // For broadcast campaign, utm campaign name is saved in campaign meta for other campaigns, it is saved in related template. |
| [1156](#L1156) | if ( ! empty( $meta['es\_utm\_campaign'] ) ) { |
| [1157](#L1157) | $data['utm\_params']['utm\_campaign'] = $meta['es\_utm\_campaign']; |
| [1158](#L1158) | } elseif ( ! empty( $data['tmpl\_id'] ) ) { |
| [1159](#L1159) | $data['utm\_params']['utm\_campaign'] = get\_post\_meta( $data['tmpl\_id'], 'es\_utm\_campaign', true ); |
| [1160](#L1160) | } |
| [1161](#L1161) | } |
| [1162](#L1162) | } |
| [1163](#L1163) | } |
| [1164](#L1164) |  |
| [1165](#L1165) | return $data; |
| [1166](#L1166) | } |
| [1167](#L1167) |  |
| [1168](#L1168) | /\*\* |
| [1169](#L1169) | \* Method to check if utm tracking is enabled. |
| [1170](#L1170) | \* |
| [1171](#L1171) | \* @param array $data |
| [1172](#L1172) | \* |
| [1173](#L1173) | \* @return array $data |
| [1174](#L1174) | \* |
| [1175](#L1175) | \* @since 4.6.2 |
| [1176](#L1176) | \*/ |
| [1177](#L1177) | public function is\_utm\_tracking\_enabled( $tracking\_enabled = false, $data = array() ) { |
| [1178](#L1178) | $ig\_es\_track\_utm = get\_option( 'ig\_es\_track\_utm', 'no' ); |
| [1179](#L1179) |  |
| [1180](#L1180) | if ( ! empty( $data ) ) { |
| [1181](#L1181) | $campaign\_id = ! empty( $data['campaign\_id'] ) ? $data['campaign\_id'] : 0; |
| [1182](#L1182) | if ( ! empty( $campaign\_id ) ) { |
| [1183](#L1183) | /\*\* |
| [1184](#L1184) | \* For newsletter campaign, utm tracking can be enabled/disabled at campaign level therefore check if it is enabled at campaign level or not |
| [1185](#L1185) | \* For other type of campaigns, global utm tracking option is used. |
| [1186](#L1186) | \*/ |
| [1187](#L1187) | $campaign = ES()->campaigns\_db->get( $campaign\_id ); |
| [1188](#L1188) | if ( ! empty( $campaign ) ) { |
| [1189](#L1189) | $campaign\_type            = $campaign['type']; |
| [1190](#L1190) | $supported\_campaign\_types = array( |
| [1191](#L1191) | IG\_CAMPAIGN\_TYPE\_POST\_NOTIFICATION, |
| [1192](#L1192) | IG\_CAMPAIGN\_TYPE\_POST\_DIGEST, |
| [1193](#L1193) | IG\_CAMPAIGN\_TYPE\_NEWSLETTER |
| [1194](#L1194) | ); |
| [1195](#L1195) | if ( in\_array( $campaign\_type, $supported\_campaign\_types, true ) ) { |
| [1196](#L1196) | $campaign\_meta = ! empty( $campaign['meta'] ) ? maybe\_unserialize( $campaign['meta'] ) : array(); |
| [1197](#L1197) | $ig\_es\_track\_utm = ! empty( $campaign\_meta['enable\_utm\_tracking'] ) ? $campaign\_meta['enable\_utm\_tracking'] : $ig\_es\_track\_utm; |
| [1198](#L1198) | } |
| [1199](#L1199) | } |
| [1200](#L1200) | } |
| [1201](#L1201) | } |
| [1202](#L1202) |  |
| [1203](#L1203) | if ( 'yes' === $ig\_es\_track\_utm ) { |
| [1204](#L1204) | $tracking\_enabled = true; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | return $tracking\_enabled; |
| [1208](#L1208) | } |
| [1209](#L1209) |  |
| [1210](#L1210) | /\*\* |
| [1211](#L1211) | \* Method to disable Icegram server cron. |
| [1212](#L1212) | \* |
| [1213](#L1213) | \* @since 4.6.1 |
| [1214](#L1214) | \*/ |
| [1215](#L1215) | public function disable\_server\_cron() { |
| [1216](#L1216) |  |
| [1217](#L1217) | $handle\_cron\_data\_service = new ES\_Service\_Handle\_Cron\_Data(); |
| [1218](#L1218) | $handle\_cron\_data\_service->delete\_cron\_data(); |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | /\*\* |
| [1222](#L1222) | \* Method to override service validation for some specific request |
| [1223](#L1223) | \* |
| [1224](#L1224) | \* @param bool  $is\_request\_valid Is request valid. |
| [1225](#L1225) | \* @param array $request\_data Request data. |
| [1226](#L1226) | \* |
| [1227](#L1227) | \* @return bool $is\_request\_valid Is request valid. |
| [1228](#L1228) | \* |
| [1229](#L1229) | \* @since 4.6.2 |
| [1230](#L1230) | \*/ |
| [1231](#L1231) | public function maybe\_override\_service\_validation( $is\_request\_valid, $request\_data = array() ) { |
| [1232](#L1232) |  |
| [1233](#L1233) | if ( empty( $request\_data ) ) { |
| [1234](#L1234) | return $is\_request\_valid; |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | $request\_body = ! empty( $request\_data['body'] ) ? $request\_data['body'] : array(); |
| [1238](#L1238) |  |
| [1239](#L1239) | // Check if there are any request related tasks present. |
| [1240](#L1240) | if ( empty( $request\_body ) || empty( $request\_body['tasks'] ) ) { |
| [1241](#L1241) | return $is\_request\_valid; |
| [1242](#L1242) | } |
| [1243](#L1243) |  |
| [1244](#L1244) | $request\_tasks = $request\_body['tasks']; |
| [1245](#L1245) |  |
| [1246](#L1246) | // Check if request request is for storing es cron data. |
| [1247](#L1247) | if ( in\_array( 'store-cron', $request\_tasks, true ) ) { |
| [1248](#L1248) | // If request is for disable es cron. |
| [1249](#L1249) | $is\_disable\_cron\_request = empty( $request\_body['es\_enable\_background'] ) ? true : false; |
| [1250](#L1250) | if ( $is\_disable\_cron\_request ) { |
| [1251](#L1251) | $is\_request\_valid = true; |
| [1252](#L1252) | } |
| [1253](#L1253) | } |
| [1254](#L1254) |  |
| [1255](#L1255) | return $is\_request\_valid; |
| [1256](#L1256) | } |
| [1257](#L1257) |  |
| [1258](#L1258) | /\*\* |
| [1259](#L1259) | \* Send additional data to Icegram Server for tracking purpose |
| [1260](#L1260) | \* |
| [1261](#L1261) | \* @param |
| [1262](#L1262) | \* |
| [1263](#L1263) | \* @since 4.6.6 |
| [1264](#L1264) | \*/ |
| [1265](#L1265) | /\* |
| [1266](#L1266) | public function ig\_es\_send\_additional\_data\_for\_tracking() { |
| [1267](#L1267) |  |
| [1268](#L1268) | // Send data only if user had opted for trial or user is on a premium plan. |
| [1269](#L1269) | $is\_plan\_valid      = ES()->trial->is\_trial() || ES()->is\_premium(); |
| [1270](#L1270) |  |
| [1271](#L1271) | // Check if the data is already sent once |
| [1272](#L1272) | $can\_send\_data      = get\_option( 'ig\_es\_send\_additional\_data\_for\_tracking', 'yes' ); |
| [1273](#L1273) |  |
| [1274](#L1274) | if ( $is\_plan\_valid && 'yes' === $can\_send\_data ) { |
| [1275](#L1275) |  |
| [1276](#L1276) | update\_option( 'ig\_es\_send\_additional\_data\_for\_tracking', 'no' ); |
| [1277](#L1277) |  |
| [1278](#L1278) | $url    = 'https://api.icegram.com/'; |
| [1279](#L1279) | $data   = array( |
| [1280](#L1280) |  |
| [1281](#L1281) | ); |
| [1282](#L1282) |  |
| [1283](#L1283) | $options         = array( |
| [1284](#L1284) | 'timeout' => 50, |
| [1285](#L1285) | 'method'  => 'POST', |
| [1286](#L1286) | 'body'    => $data |
| [1287](#L1287) | ); |
| [1288](#L1288) |  |
| [1289](#L1289) | $response = wp\_remote\_post( $url, $options ); |
| [1290](#L1290) | } |
| [1291](#L1291) |  |
| [1292](#L1292) | }\*/ |
| [1293](#L1293) |  |
| [1294](#L1294) | /\*\* |
| [1295](#L1295) | \* Method to preview email through AJAX |
| [1296](#L1296) | \* |
| [1297](#L1297) | \* @since 4.6.11 |
| [1298](#L1298) | \*/ |
| [1299](#L1299) | public function preview\_email\_in\_report() { |
| [1300](#L1300) |  |
| [1301](#L1301) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [1302](#L1302) |  |
| [1303](#L1303) | $can\_access\_reports = ES\_Common::ig\_es\_can\_access( 'reports' ); |
| [1304](#L1304) | if ( ! $can\_access\_reports ) { |
| [1305](#L1305) | return 0; |
| [1306](#L1306) | } |
| [1307](#L1307) |  |
| [1308](#L1308) | $report\_id     = ig\_es\_get\_request\_data( 'campaign\_id' ); |
| [1309](#L1309) | $campaign\_type = ig\_es\_get\_request\_data( 'campaign\_type' ); |
| [1310](#L1310) | $response      = array(); |
| [1311](#L1311) | $email\_body    = ''; |
| [1312](#L1312) |  |
| [1313](#L1313) | if ( ! empty( $report\_id ) ) { |
| [1314](#L1314) |  |
| [1315](#L1315) | if ( ! empty( $campaign\_type ) && in\_array( $campaign\_type, array( 'sequence\_message', 'workflow\_email' ), true ) ) { |
| [1316](#L1316) | $email\_body = ES()->campaigns\_db->get\_campaign\_by\_id( $report\_id ); |
| [1317](#L1317) | } else { |
| [1318](#L1318) | $email\_body = ES\_DB\_Mailing\_Queue::get\_mailing\_queue\_by\_id( $report\_id ); |
| [1319](#L1319) | } |
| [1320](#L1320) | $es\_email\_type             = get\_option( 'ig\_es\_email\_type' );    // Not the ideal way. Email type can differ while previewing sent email. |
| [1321](#L1321) | $response['template\_html'] = ES\_Common::es\_process\_template\_body( $email\_body['body'] ); |
| [1322](#L1322) | /\* |
| [1323](#L1323) | if ( 'WP HTML MAIL' == $es\_email\_type || 'PHP HTML MAIL' == $es\_email\_type ) { |
| [1324](#L1324) | $response['template\_html'] = ES\_Common::es\_process\_template\_body( $email\_body['body'] ); |
| [1325](#L1325) | } else { |
| [1326](#L1326) | $response['template\_html'] = str\_replace( '<br />', "\r\n", $email\_body['body'] ); |
| [1327](#L1327) | $response['template\_html'] = str\_replace( '<br>', "\r\n", $email\_body['body'] ); |
| [1328](#L1328) | } |
| [1329](#L1329) | \*/ |
| [1330](#L1330) | } |
| [1331](#L1331) |  |
| [1332](#L1332) | if ( ! empty( $response ) ) { |
| [1333](#L1333) | wp\_send\_json\_success( $response ); |
| [1334](#L1334) | } else { |
| [1335](#L1335) | wp\_send\_json\_error(); |
| [1336](#L1336) | } |
| [1337](#L1337) | ?> |
| [1338](#L1338) |  |
| [1339](#L1339) | <?php |
| [1340](#L1340) | } |
| [1341](#L1341) |  |
| [1342](#L1342) | public function maybe\_apply\_bulk\_actions\_on\_all\_contacts() { |
| [1343](#L1343) |  |
| [1344](#L1344) | $can\_access\_audience  = ES\_Common::ig\_es\_can\_access( 'audience' ); |
| [1345](#L1345) | if ( ! ( $can\_access\_audience ) ) { |
| [1346](#L1346) | return 0; |
| [1347](#L1347) | } |
| [1348](#L1348) |  |
| [1349](#L1349) | $page = ig\_es\_get\_request\_data( 'page' ); |
| [1350](#L1350) | if ( 'es\_subscribers' !== $page ) { |
| [1351](#L1351) | return; |
| [1352](#L1352) | } |
| [1353](#L1353) |  |
| [1354](#L1354) | $is\_ajax = ig\_es\_get\_request\_data( 'is\_ajax' ); |
| [1355](#L1355) | if ( ! $is\_ajax ) { |
| [1356](#L1356) | return; |
| [1357](#L1357) | } |
| [1358](#L1358) |  |
| [1359](#L1359) | $completed = false; |
| [1360](#L1360) | $errortype = false; |
| [1361](#L1361) |  |
| [1362](#L1362) | $contacts\_table = new ES\_Contacts\_Table(); |
| [1363](#L1363) |  |
| [1364](#L1364) | $current\_action = $contacts\_table->current\_action(); |
| [1365](#L1365) | if ( empty( $current\_action ) ) { |
| [1366](#L1366) | return; |
| [1367](#L1367) | } |
| [1368](#L1368) |  |
| [1369](#L1369) | check\_admin\_referer( 'bulk-' . $contacts\_table->\_args['plural'] ); |
| [1370](#L1370) |  |
| [1371](#L1371) | $current\_page = $contacts\_table->get\_pagenum(); |
| [1372](#L1372) | $per\_page     = $contacts\_table->get\_items\_per\_page( $contacts\_table::$option\_per\_page, 200 ); |
| [1373](#L1373) | $total\_pages  = ig\_es\_get\_request\_data( 'total\_pages', 0 ); |
| [1374](#L1374) |  |
| [1375](#L1375) | if ( empty( $total\_pages ) ) { |
| [1376](#L1376) | $total\_contacts = $contacts\_table->get\_subscribers( $per\_page, $current\_page, true ); |
| [1377](#L1377) | $total\_pages    = ceil( $total\_contacts / $per\_page ); |
| [1378](#L1378) | } |
| [1379](#L1379) |  |
| [1380](#L1380) |  |
| [1381](#L1381) | $start\_page = ig\_es\_get\_request\_data( 'start\_page', 0 ); |
| [1382](#L1382) |  |
| [1383](#L1383) | if ( empty( $start\_page ) ) { |
| [1384](#L1384) | $start\_page = $current\_page; |
| [1385](#L1385) | } |
| [1386](#L1386) |  |
| [1387](#L1387) | // For pages greater then the start page, get subscriber ids from db. |
| [1388](#L1388) | $use\_db\_ids = (int) $current\_page > (int) $start\_page; |
| [1389](#L1389) | if ( $use\_db\_ids ) { |
| [1390](#L1390) |  |
| [1391](#L1391) | if ( 'bulk\_delete' === $current\_action ) { |
| [1392](#L1392) | $page\_to\_process = $start\_page;// When deleting contacts keep page to process same as start page since using current page results in incorrect calculation. |
| [1393](#L1393) | } else { |
| [1394](#L1394) | $page\_to\_process = $current\_page; |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | $contacts = $contacts\_table->get\_subscribers( $per\_page, $page\_to\_process ); |
| [1398](#L1398) |  |
| [1399](#L1399) | if ( ! empty( $contacts ) ) { |
| [1400](#L1400) | $subscribers = array\_column( $contacts, 'id' ); |
| [1401](#L1401) | if ( ! empty( $subscribers ) ) { |
| [1402](#L1402) | $exclude\_subscribers = ig\_es\_get\_request\_data( 'exclude\_subscribers', array() ); |
| [1403](#L1403) | if ( ! empty( $exclude\_subscribers ) ) { |
| [1404](#L1404) | $exclude\_subscribers = explode( ',', $exclude\_subscribers ); |
| [1405](#L1405) | $subscribers         = array\_diff( $subscribers, $exclude\_subscribers ); |
| [1406](#L1406) | } |
| [1407](#L1407) | $\_REQUEST['subscribers'] = $subscribers; |
| [1408](#L1408) | } |
| [1409](#L1409) | } |
| [1410](#L1410) | } |
| [1411](#L1411) |  |
| [1412](#L1412) |  |
| [1413](#L1413) | $return\_response = true; |
| [1414](#L1414) | $action\_response = $contacts\_table->process\_bulk\_action( $return\_response ); |
| [1415](#L1415) | $completed       = (int) $current\_page === (int) $total\_pages; |
| [1416](#L1416) | $response        = array( |
| [1417](#L1417) | 'paged'       => $current\_page + 1, |
| [1418](#L1418) | 'start\_page'  => $start\_page, |
| [1419](#L1419) | 'total\_pages' => $total\_pages, |
| [1420](#L1420) | 'completed'   => $completed, |
| [1421](#L1421) | 'errortype'       => $action\_response['errortype'] ? $action\_response['errortype'] : $errortype , |
| [1422](#L1422) | 'message'     => $action\_response['message'], |
| [1423](#L1423) | 'bulk\_action' => $current\_action, |
| [1424](#L1424) | ); |
| [1425](#L1425) |  |
| [1426](#L1426) | if ( 'success' === $action\_response['status'] ) { |
| [1427](#L1427) | wp\_send\_json\_success( $response ); |
| [1428](#L1428) | } else { |
| [1429](#L1429) | wp\_send\_json\_error( $response ); |
| [1430](#L1430) | } |
| [1431](#L1431) | } |
| [1432](#L1432) |  |
| [1433](#L1433) |  |
| [1434](#L1434) |  |
| [1435](#L1435) |  |
| [1436](#L1436) | /\*\* |
| [1437](#L1437) | \* Method to display Activity table in Reports through Ajax |
| [1438](#L1438) | \* |
| [1439](#L1439) | \* @since 4.6.12 |
| [1440](#L1440) | \*/ |
| [1441](#L1441) | public function ajax\_fetch\_report\_list\_callback() { |
| [1442](#L1442) |  |
| [1443](#L1443) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [1444](#L1444) |  |
| [1445](#L1445) | $can\_access\_reports = ES\_Common::ig\_es\_can\_access( 'reports' ); |
| [1446](#L1446) | if ( ! $can\_access\_reports ) { |
| [1447](#L1447) | return 0; |
| [1448](#L1448) | } |
| [1449](#L1449) |  |
| [1450](#L1450) | $wp\_list\_table = new ES\_Campaign\_Report(); |
| [1451](#L1451) | $wp\_list\_table->ajax\_response(); |
| [1452](#L1452) | } |
| [1453](#L1453) |  |
| [1454](#L1454) | /\*\* |
| [1455](#L1455) | \* Init Widget on WP Dashboard |
| [1456](#L1456) | \* |
| [1457](#L1457) | \* @since 4.7.8 |
| [1458](#L1458) | \*/ |
| [1459](#L1459) | public function es\_add\_widgets() { |
| [1460](#L1460) |  |
| [1461](#L1461) | if ( ! ES()->is\_current\_user\_administrator() ) { |
| [1462](#L1462) | return; |
| [1463](#L1463) | } |
| [1464](#L1464) |  |
| [1465](#L1465) | $screen    = get\_current\_screen(); |
| [1466](#L1466) | $screen\_id = $screen ? $screen->id : ''; |
| [1467](#L1467) |  |
| [1468](#L1468) | wp\_add\_dashboard\_widget( 'es\_dashboard\_stats\_widget', \_\_( 'Icegram Express', 'email-subscribers' ), array( $this, 'dashboard\_stats\_widget' ) ); |
| [1469](#L1469) |  |
| [1470](#L1470) | if ( in\_array( $screen\_id, array( 'dashboard' ) ) ) { |
| [1471](#L1471) | wp\_enqueue\_style( 'ig\_es\_dashboard\_style', plugin\_dir\_url( \_\_FILE\_\_ ) . 'css/es-wp-dashboard.css', array(), $this->version, 'all' ); |
| [1472](#L1472) | } |
| [1473](#L1473) |  |
| [1474](#L1474) | } |
| [1475](#L1475) |  |
| [1476](#L1476) | /\*\* |
| [1477](#L1477) | \* Widget content to show on WP Dashboard |
| [1478](#L1478) | \* |
| [1479](#L1479) | \* @since 4.7.8 |
| [1480](#L1480) | \*/ |
| [1481](#L1481) | public function dashboard\_stats\_widget() { |
| [1482](#L1482) |  |
| [1483](#L1483) | $args = array( |
| [1484](#L1484) | 'days' => 30 |
| [1485](#L1485) | ); |
| [1486](#L1486) |  |
| [1487](#L1487) | $page               = 'wp\_dashboard'; |
| [1488](#L1488) | $override\_cache     = false; |
| [1489](#L1489) | $reports\_data       = ES\_Reports\_Data::get\_dashboard\_reports\_data( $page, $override\_cache, $args ); |
| [1490](#L1490) | $total\_subscribed   = isset( $reports\_data['total\_subscribed'] ) ? $reports\_data['total\_subscribed'] : 0; |
| [1491](#L1491) | $total\_message\_sent = isset( $reports\_data['total\_message\_sent'] ) ? $reports\_data['total\_message\_sent'] : 0; |
| [1492](#L1492) | $total\_unsubscribed = isset( $reports\_data['total\_unsubscribed'] ) ? $reports\_data['total\_unsubscribed'] : 0; |
| [1493](#L1493) | $avg\_open\_rate      = isset( $reports\_data['avg\_open\_rate'] ) ? $reports\_data['avg\_open\_rate'] : 0; |
| [1494](#L1494) |  |
| [1495](#L1495) | $campaign\_report = isset( $reports\_data['campaigns'][0] ) ? $reports\_data['campaigns'][0] : ''; |
| [1496](#L1496) | $reports\_url     = isset( $campaign\_report['hash'] ) ? add\_query\_arg( 'list', $campaign\_report['hash'], add\_query\_arg( 'action', 'view', admin\_url( 'admin.php?page=es\_reports' ) ) ) : ''; |
| [1497](#L1497) |  |
| [1498](#L1498) | $topics = ES\_Common::get\_useful\_articles( false ); |
| [1499](#L1499) |  |
| [1500](#L1500) | $topics\_indexes = array\_rand( $topics, 3 ); |
| [1501](#L1501) | ?> |
| [1502](#L1502) | <style type="text/css"> |
| [1503](#L1503) | #es\_dashboard\_stats\_widget .inside { |
| [1504](#L1504) | padding: 0; |
| [1505](#L1505) | margin: 0; |
| [1506](#L1506) | } |
| [1507](#L1507) | .ig-es p{ |
| [1508](#L1508) | margin: 1em 0; |
| [1509](#L1509) | } |
| [1510](#L1510) | </style> |
| [1511](#L1511) | <div class="ig-es"> |
| [1512](#L1512) | <div class="pb-2 border-b border-gray-200"> |
| [1513](#L1513) | <div class="px-4"> |
| [1514](#L1514) | <p class="text-base font-medium leading-6 text-gray-600"> |
| [1515](#L1515) | <span class="rounded-md bg-gray-200 px-2 py-0.5"> |
| [1516](#L1516) | <?php echo esc\_html\_\_( 'Last 30 days', 'email-subscribers' ); ?> |
| [1517](#L1517) | </span> |
| [1518](#L1518) | </p> |
| [1519](#L1519) | <div class="flex"> |
| [1520](#L1520) | <div class="w-1/4 px-4 border-r border-gray-100"> |
| [1521](#L1521) | <span class="text-2xl font-bold leading-none text-indigo-600"> |
| [1522](#L1522) | <?php echo esc\_html( $total\_subscribed ); ?> |
| [1523](#L1523) | </span> |
| [1524](#L1524) | <p class="font-medium text-gray-500"> |
| [1525](#L1525) | <?php echo esc\_html\_\_( 'Subscribed', 'email-subscribers' ); ?> |
| [1526](#L1526) | </p> |
| [1527](#L1527) | </div> |
| [1528](#L1528) | <div class="w-1/4 px-4 border-r border-gray-100"> |
| [1529](#L1529) | <span class="text-2xl font-bold leading-none text-indigo-600"> |
| [1530](#L1530) | <?php echo esc\_html( $total\_unsubscribed ); ?> |
| [1531](#L1531) | </span> |
| [1532](#L1532) | <p class="font-medium text-gray-500"> |
| [1533](#L1533) | <?php echo esc\_html\_\_( 'Unsubscribed', 'email-subscribers' ); ?> |
| [1534](#L1534) | </p> |
| [1535](#L1535) | </div> |
| [1536](#L1536) | <div class="w-1/4 px-4 border-r border-gray-100"> |
| [1537](#L1537) | <span class="text-2xl font-bold leading-none text-indigo-600"> |
| [1538](#L1538) | <?php echo esc\_html( $avg\_open\_rate ); ?> % |
| [1539](#L1539) | </span> |
| [1540](#L1540) | <p class="font-medium text-gray-500"> |
| [1541](#L1541) | <?php echo esc\_html\_\_( 'Avg Open Rate', 'email-subscribers' ); ?> |
| [1542](#L1542) | </p> |
| [1543](#L1543) | </div> |
| [1544](#L1544) | <div class="w-1/4 px-4"> |
| [1545](#L1545) | <span class="text-2xl font-bold leading-none text-indigo-600"> |
| [1546](#L1546) | <?php echo esc\_html( $total\_message\_sent ); ?> |
| [1547](#L1547) | </span> |
| [1548](#L1548) | <p class="font-medium text-gray-500"> |
| [1549](#L1549) | <?php echo esc\_html\_\_( 'Messages Sent', 'email-subscribers' ); ?> |
| [1550](#L1550) | </p> |
| [1551](#L1551) | </div> |
| [1552](#L1552) | </div> |
| [1553](#L1553) | </div> |
| [1554](#L1554) | </div> |
| [1555](#L1555) |  |
| [1556](#L1556) | <div class="overflow-hidden"> |
| [1557](#L1557) | <p class="px-4 text-base font-medium leading-6 text-gray-600"> |
| [1558](#L1558) | <span class="rounded-md bg-gray-200 px-2 py-0.5"> |
| [1559](#L1559) | <?php |
| [1560](#L1560) | echo esc\_html\_\_( 'Last Campaign', 'email-subscribers' ); |
| [1561](#L1561) | ?> |
| [1562](#L1562) | </span> |
| [1563](#L1563) | </p> |
| [1564](#L1564) | <?php |
| [1565](#L1565) | if ( ! empty( $campaign\_report ) ) { |
| [1566](#L1566) | ?> |
| [1567](#L1567) | <a href="<?php echo esc\_url( $reports\_url ); ?>" class="block px-2 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition duration-150 ease-in-out" target="\_blank"> |
| [1568](#L1568) | <div class="flex px-4 pb-2"> |
| [1569](#L1569) | <div class="w-3/5 min-w-0 pt-2 flex-1"> |
| [1570](#L1570) | <div class="flex flex-1 items-center"> |
| [1571](#L1571) | <div class="leading-5 w-2/4 flex items-start text-gray-500 font-medium text-base"> |
| [1572](#L1572) | <svg class="flex-shrink-0 mr-1.5 h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20"> |
| [1573](#L1573) | <path fill-rule="evenodd" d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884zM18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" clip-rule="evenodd"/> |
| [1574](#L1574) | </svg> |
| [1575](#L1575) | <?php |
| [1576](#L1576) | echo esc\_html( $campaign\_report['type'] ); |
| [1577](#L1577) |  |
| [1578](#L1578) | $allowed\_html\_tags = ig\_es\_allowed\_html\_tags\_in\_esc(); |
| [1579](#L1579) | $status            = ES\_Common::get\_campaign\_status\_icon( $campaign\_report['status'] ); |
| [1580](#L1580) | echo wp\_kses( $status, $allowed\_html\_tags ); |
| [1581](#L1581) | ?> |
| [1582](#L1582) |  |
| [1583](#L1583) | </div> |
| [1584](#L1584) | </div> |
| [1585](#L1585) | <div class="text-sm mt-2 pr-4"> |
| [1586](#L1586) | <?php echo esc\_html( $campaign\_report['title'] ); ?> |
| [1587](#L1587) | </div> |
| [1588](#L1588) | </div> |
| [1589](#L1589) | <div class="sm:grid sm:grid-cols-2 flex-1"> |
| [1590](#L1590) |  |
| [1591](#L1591) | <div class="px-3 pb-3 pt-4"> |
| [1592](#L1592) | <span class="leading-none font-medium text-base text-indigo-500"> |
| [1593](#L1593) | <?php echo esc\_html( $campaign\_report['total\_sent'] ); ?> |
| [1594](#L1594) | </span> |
| [1595](#L1595) | <p class="mt-1 leading-6 text-gray-400"> |
| [1596](#L1596) | <?php echo esc\_html\_\_( 'Sent to', 'email-subscribers' ); ?> |
| [1597](#L1597) | </p> |
| [1598](#L1598) | </div> |
| [1599](#L1599) | <div class="px-3 pb-3 pt-4"> |
| [1600](#L1600) | <span class="leading-none font-medium text-base text-indigo-500"> |
| [1601](#L1601) | <?php echo esc\_html( $campaign\_report['total\_opens'] ); ?> ( |
| [1602](#L1602) | <?php |
| [1603](#L1603) | echo esc\_html( $campaign\_report['campaign\_opens\_rate'] ); |
| [1604](#L1604) | ?> |
| [1605](#L1605) | %) |
| [1606](#L1606) | </span> |
| [1607](#L1607) | <p class="mt-1 leading-6 text-gray-400"> |
| [1608](#L1608) | <?php echo esc\_html\_\_( 'Opens', 'email-subscribers' ); ?> |
| [1609](#L1609) | </p> |
| [1610](#L1610) | </div> |
| [1611](#L1611) |  |
| [1612](#L1612) | </div> |
| [1613](#L1613) | <div> |
| [1614](#L1614) | <svg class="h-5 w-5 text-gray-400 mt-5" fill="currentColor" viewBox="0 0 20 20"> |
| [1615](#L1615) | <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/> |
| [1616](#L1616) | </svg> |
| [1617](#L1617) | </div> |
| [1618](#L1618) | </div> |
| [1619](#L1619) | </a> |
| [1620](#L1620) | <?php |
| [1621](#L1621) | } else { |
| [1622](#L1622) | echo '<p class="pl-4 font-medium text-gray-500">' . esc\_html\_\_( 'No campaigns sent yet', 'email-subscribers' ) . '<p>'; |
| [1623](#L1623) | } |
| [1624](#L1624) | ?> |
| [1625](#L1625) | </div> |
| [1626](#L1626) | <div class="border-t border-gray-200"> |
| [1627](#L1627) | <p class="px-4 text-base font-medium leading-6 text-gray-600"> |
| [1628](#L1628) | <span class="rounded-md bg-gray-200 px-2 py-0.5"> |
| [1629](#L1629) | <?php |
| [1630](#L1630) | echo esc\_html\_\_( 'Latest Blog Posts from Icegram', 'email-subscribers' ); |
| [1631](#L1631) | ?> |
| [1632](#L1632) | </span> |
| [1633](#L1633) | </p> |
| [1634](#L1634) | <div class="overflow-hidden pb-2"> |
| [1635](#L1635) | <ul class="pl-8 pr-3"> |
| [1636](#L1636) | <?php foreach ( $topics\_indexes as $index ) { ?> |
| [1637](#L1637) | <li class="mb-0 hover:underline text-gray-500" style="list-style-type: square !important"> |
| [1638](#L1638) | <a href="<?php echo esc\_url( $topics[ $index ]['link'] ); ?>" class="hover:underline font-medium block pr-3 transition duration-150 ease-in-out focus:outline-none focus:bg-gray-50" target="\_blank"> |
| [1639](#L1639) | <div class="flex items-center px-2 py-1 md:justify-between"> |
| [1640](#L1640) | <div class="text-sm leading-5 text-gray-700"> |
| [1641](#L1641) | <?php |
| [1642](#L1642) | echo wp\_kses\_post( $topics[ $index ]['title'] ); |
| [1643](#L1643) | if ( ! empty( $topics[ $index ]['label'] ) ) { |
| [1644](#L1644) | ?> |
| [1645](#L1645) | <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo esc\_attr( $topics[ $index ]['label\_class'] ); ?>"><?php echo esc\_html( $topics[ $index ]['label'] ); ?></span> |
| [1646](#L1646) | <?php } ?> |
| [1647](#L1647) | </div> |
| [1648](#L1648) | </div> |
| [1649](#L1649) | </a> |
| [1650](#L1650) | </li> |
| [1651](#L1651) | <?php } ?> |
| [1652](#L1652) | </ul> |
| [1653](#L1653) | </div> |
| [1654](#L1654) | </div> |
| [1655](#L1655) | <?php |
| [1656](#L1656) | $release\_notes\_from\_icegram = get\_transient( 'ig\_es\_release\_notes\_from\_icegram' ); |
| [1657](#L1657) |  |
| [1658](#L1658) | if ( ! $release\_notes\_from\_icegram ) { |
| [1659](#L1659) | $api\_url = 'https://www.icegram.com/gallery/wp-json/wp/v2/release\_notes'; |
| [1660](#L1660) | $api\_response = wp\_remote\_get( $api\_url ); |
| [1661](#L1661) |  |
| [1662](#L1662) | if ( ! is\_wp\_error( $api\_response ) && is\_array( $api\_response ) ) { |
| [1663](#L1663) | $api\_data = json\_decode( wp\_remote\_retrieve\_body( $api\_response ), true ); |
| [1664](#L1664) |  |
| [1665](#L1665) | if ( ! empty( $api\_data[0]['content']['rendered'] ) ) { |
| [1666](#L1666) |  |
| [1667](#L1667) | $release\_notes\_from\_icegram = $api\_data[0]['content']['rendered']; |
| [1668](#L1668) | set\_transient( 'ig\_es\_release\_notes\_from\_icegram', $release\_notes\_from\_icegram, 7 \* DAY\_IN\_SECONDS ); |
| [1669](#L1669) |  |
| [1670](#L1670) | } |
| [1671](#L1671) | } |
| [1672](#L1672) | } |
| [1673](#L1673) |  |
| [1674](#L1674) | if ( $release\_notes\_from\_icegram ) { |
| [1675](#L1675) | $allowedtags = ig\_es\_allowed\_html\_tags\_in\_esc(); |
| [1676](#L1676) | ?> |
| [1677](#L1677) | <div class="border-t border-gray-200"> |
| [1678](#L1678) | <p class="px-4 text-base font-medium leading-6 text-gray-600"> |
| [1679](#L1679) | <span class="rounded-md bg-gray-200 px-2 py-0.5"> |
| [1680](#L1680) | <?php echo esc\_html\_\_( 'Latest Updates from Icegram', 'email-subscribers' ); ?> |
| [1681](#L1681) | </span> |
| [1682](#L1682) | </p> |
| [1683](#L1683) | <div class="overflow-hidden pb-2"> |
| [1684](#L1684) | <?php echo wp\_kses( $release\_notes\_from\_icegram, $allowedtags ); ?> |
| [1685](#L1685) | </div> |
| [1686](#L1686) | </div> |
| [1687](#L1687) | <?php |
| [1688](#L1688) | } |
| [1689](#L1689) | ?> |
| [1690](#L1690) |  |
| [1691](#L1691) | </div> |
| [1692](#L1692) | <?php |
| [1693](#L1693) | } |
| [1694](#L1694) |  |
| [1695](#L1695) | /\*\* |
| [1696](#L1696) | \* Delete all child campaigns based on $parent\_campaign\_id |
| [1697](#L1697) | \* |
| [1698](#L1698) | \* @param int $parent\_campaign\_id |
| [1699](#L1699) | \* |
| [1700](#L1700) | \* @since 4.3.4 |
| [1701](#L1701) | \*/ |
| [1702](#L1702) | public function delete\_child\_campaigns( $parent\_campaign\_id = 0 ) { |
| [1703](#L1703) |  |
| [1704](#L1704) | if ( 0 !== $parent\_campaign\_id ) { |
| [1705](#L1705) |  |
| [1706](#L1706) | $child\_campaign\_ids = ES()->campaigns\_db->get\_campaigns\_by\_parent\_id( $parent\_campaign\_id ); |
| [1707](#L1707) |  |
| [1708](#L1708) | // Delete All Child Campaigns |
| [1709](#L1709) | ES()->campaigns\_db->delete\_campaigns( $child\_campaign\_ids ); |
| [1710](#L1710) | } |
| [1711](#L1711) | } |
| [1712](#L1712) |  |
| [1713](#L1713) | public function save\_campaign\_error\_details( $error\_details ) { |
| [1714](#L1714) | update\_option( 'ig\_es\_campaign\_error', $error\_details, false ); |
| [1715](#L1715) | } |
| [1716](#L1716) |  |
| [1717](#L1717) | public function remove\_campaign\_failed\_flag() { |
| [1718](#L1718) | delete\_option( 'ig\_es\_campaign\_error' ); |
| [1719](#L1719) | } |
| [1720](#L1720) |  |
| [1721](#L1721) | public function show\_email\_sending\_failed\_notice() { |
| [1722](#L1722) |  |
| [1723](#L1723) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [1724](#L1724) | return; |
| [1725](#L1725) | } |
| [1726](#L1726) |  |
| [1727](#L1727) | $current\_page = ig\_es\_get\_request\_data( 'page' ); |
| [1728](#L1728) |  |
| [1729](#L1729) | if ( 'es\_dashboard' === $current\_page ) { |
| [1730](#L1730) | return; |
| [1731](#L1731) | } |
| [1732](#L1732) |  |
| [1733](#L1733) | $campaign\_error = get\_option( 'ig\_es\_campaign\_error', 0 ); |
| [1734](#L1734) | if ( $campaign\_error ) { |
| [1735](#L1735) | $logs\_url             = admin\_url( 'admin.php?page=es\_logs' ); |
| [1736](#L1736) | $notification\_guid    = $campaign\_error['notification\_guid']; |
| [1737](#L1737) | $notification         = ES\_DB\_Mailing\_Queue::get\_notification\_by\_hash( $notification\_guid ); |
| [1738](#L1738) | $notification\_subject = $notification['subject']; |
| [1739](#L1739) | $error\_message        = is\_array( $campaign\_error['error\_message'] ) ? implode( '', $campaign\_error['error\_message'] ) : $campaign\_error['error\_message']; |
| [1740](#L1740) | ?> |
| [1741](#L1741) | <div class="notice notice-error is-dismissible"> |
| [1742](#L1742) | <p> |
| [1743](#L1743) | <?php |
| [1744](#L1744) | /\* translators: 1: Notificatin subject 2. Error message \*/ |
| [1745](#L1745) | echo sprintf( esc\_html\_\_( 'Campaign %1$s has an error while sending emails: %2$s', 'email-subscribers' ), |
| [1746](#L1746) | '<strong>' . esc\_html( $notification\_subject ) . '</strong>', |
| [1747](#L1747) | '<strong>' . esc\_html( $error\_message ) . '</strong>' |
| [1748](#L1748) | ); |
| [1749](#L1749) | ?> |
| [1750](#L1750) | </p> |
| [1751](#L1751) | <p> |
| [1752](#L1752) | <?php |
| [1753](#L1753) | /\* translators: 1: Anchor tag 2. Closing anchor tag \*/ |
| [1754](#L1754) | echo sprintf( esc\_html\_\_( 'Automatic sending has been paused for this campaign. For more details, view sending logs from %1$shere%2$s.', 'email-subscribers' ), |
| [1755](#L1755) | '<a href="' . esc\_url( $logs\_url ) . '" target="\_blank">', |
| [1756](#L1756) | '</a>' |
| [1757](#L1757) | ); |
| [1758](#L1758) | ?> |
| [1759](#L1759) | </p> |
| [1760](#L1760) | <?php |
| [1761](#L1761) | $can\_promote\_ess = ES\_Service\_Email\_Sending::can\_promote\_ess(); |
| [1762](#L1762) | if ( $can\_promote\_ess ) { |
| [1763](#L1763) | $promotion\_message\_html = ES\_Service\_Email\_Sending::get\_ess\_promotion\_message\_html(); |
| [1764](#L1764) | $allowed\_tags           = ig\_es\_allowed\_html\_tags\_in\_esc(); |
| [1765](#L1765) | echo wp\_kses( $promotion\_message\_html, $allowed\_tags ); |
| [1766](#L1766) | } |
| [1767](#L1767) | ?> |
| [1768](#L1768) | </p> |
| [1769](#L1769) | </div> |
| [1770](#L1770) | <?php |
| [1771](#L1771) | delete\_option( 'ig\_es\_campaign\_error' ); |
| [1772](#L1772) | } |
| [1773](#L1773) | } |
| [1774](#L1774) |  |
| [1775](#L1775) | public function show\_post\_duplicator\_promotion\_notice() { |
| [1776](#L1776) |  |
| [1777](#L1777) | if ( ! ES()->is\_es\_admin\_screen() ) { |
| [1778](#L1778) | return; |
| [1779](#L1779) | } |
| [1780](#L1780) |  |
| [1781](#L1781) | $can\_access\_settings = ES\_Common::ig\_es\_can\_access( 'settings' ); |
| [1782](#L1782) | if ( ! $can\_access\_settings ) { |
| [1783](#L1783) | return 0; |
| [1784](#L1784) | } |
| [1785](#L1785) |  |
| [1786](#L1786) | $current\_page = ig\_es\_get\_request\_data( 'page' ); |
| [1787](#L1787) |  |
| [1788](#L1788) | if ( 'es\_dashboard' === $current\_page ) { |
| [1789](#L1789) | return; |
| [1790](#L1790) | } |
| [1791](#L1791) |  |
| [1792](#L1792) | $fallback\_notice\_dismissed = 'yes' === get\_option( 'ig\_es\_post\_duplicator\_promotion\_notice\_dismissed', 'no' ); |
| [1793](#L1793) | if ( ! $fallback\_notice\_dismissed ) { |
| [1794](#L1794) | $optin\_url = 'https://wordpress.org/plugins/duplicate-post-page-copy-clone-wp/'; |
| [1795](#L1795) | ?> |
| [1796](#L1796) | <div id="ig\_es\_post\_duplicator\_promotion\_notice" class="notice notice-success is-dismissible"> |
| [1797](#L1797) | <div id="" class="text-gray-700 not-italic"> |
| [1798](#L1798) | <p class="mb-2"> |
| [1799](#L1799) | &#x1F389; |
| [1800](#L1800) | <?php echo sprintf( esc\_html\_\_( 'We’re thrilled to introduce our latest plugin to ease your daily task - %1$sDuplicate Pages and Posts%2$s. Give it a try and let us know your feedback.', 'email-subscribers' ), '<a href="' . esc\_url( $optin\_url ) . '" target="\_blank" class="text-indigo-600">', '</a>' ); ?> |
| [1801](#L1801) | </p> |
| [1802](#L1802) | <p> |
| [1803](#L1803) | <a href="<?php echo esc\_url( admin\_url( 'plugin-install.php?s=icegram&tab=search&type=author' ) ); ?>" target="\_blank" id="ig-es-post-duplicator-promo-button"> |
| [1804](#L1804) | <button class="primary">        <?php echo esc\_html\_\_('Try now', 'email-subscribers'); ?> |
| [1805](#L1805) | </button> |
| [1806](#L1806) | </a> |
| [1807](#L1807) | </p> |
| [1808](#L1808) | </div> |
| [1809](#L1809) | </div> |
| [1810](#L1810) | <script> |
| [1811](#L1811) | jQuery(document).ready(function($) { |
| [1812](#L1812) | $('#ig\_es\_post\_duplicator\_promotion\_notice').on('click', '.notice-dismiss, #ig-es-post-duplicator-promo-button', function() { |
| [1813](#L1813) | $.ajax({ |
| [1814](#L1814) | method: 'POST', |
| [1815](#L1815) | url: ajaxurl, |
| [1816](#L1816) | dataType: 'json', |
| [1817](#L1817) | data: { |
| [1818](#L1818) | action: 'ig\_es\_dismiss\_post\_duplicator\_promotion\_notice', |
| [1819](#L1819) | security: ig\_es\_js\_data.security |
| [1820](#L1820) | } |
| [1821](#L1821) | }).done(function(response){ |
| [1822](#L1822) | console.log( 'response: ', response ); |
| [1823](#L1823) | }); |
| [1824](#L1824) | }); |
| [1825](#L1825) | }); |
| [1826](#L1826) |  |
| [1827](#L1827) | </script> |
| [1828](#L1828) | <?php |
| [1829](#L1829) | } |
| [1830](#L1830) | } |
| [1831](#L1831) |  |
| [1832](#L1832) | public function dismiss\_post\_duplicator\_promotion\_notice() { |
| [1833](#L1833) | $response = array( |
| [1834](#L1834) | 'status' => 'success', |
| [1835](#L1835) | ); |
| [1836](#L1836) |  |
| [1837](#L1837) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [1838](#L1838) |  |
| [1839](#L1839) | $can\_access\_settings = ES\_Common::ig\_es\_can\_access( 'settings' ); |
| [1840](#L1840) | if ( ! $can\_access\_settings ) { |
| [1841](#L1841) | return 0; |
| [1842](#L1842) | } |
| [1843](#L1843) |  |
| [1844](#L1844) | update\_option( 'ig\_es\_post\_duplicator\_promotion\_notice\_dismissed', 'yes', false ); |
| [1845](#L1845) |  |
| [1846](#L1846) | wp\_send\_json( $response ); |
| [1847](#L1847) | } |
| [1848](#L1848) |  |
| [1849](#L1849) | /\*\* |
| [1850](#L1850) | \* Method to send email for authentication headers test |
| [1851](#L1851) | \* |
| [1852](#L1852) | \* @since 5.x |
| [1853](#L1853) | \*/ |
| [1854](#L1854) |  |
| [1855](#L1855) | public function send\_authentication\_header\_test\_email() { |
| [1856](#L1856) |  |
| [1857](#L1857) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [1858](#L1858) |  |
| [1859](#L1859) | $can\_access\_settings = ES\_Common::ig\_es\_can\_access( 'settings' ); |
| [1860](#L1860) | if ( ! ( $can\_access\_settings ) ) { |
| [1861](#L1861) | return 0; |
| [1862](#L1862) | } |
| [1863](#L1863) |  |
| [1864](#L1864) | $response = array( |
| [1865](#L1865) | 'status'        => 'error', |
| [1866](#L1866) | 'error\_message' => \_\_( 'Something went wrong', 'email-subscribers' ), |
| [1867](#L1867) | ); |
| [1868](#L1868) |  |
| [1869](#L1869) | $mailbox = ES\_Common::get\_email\_verify\_test\_email(); |
| [1870](#L1870) |  |
| [1871](#L1871) | if ( ! empty( $\_REQUEST['action'] ) && 'es\_send\_auth\_test\_email' == $\_REQUEST['action'] ) { |
| [1872](#L1872) |  |
| [1873](#L1873) | $test\_email = new ES\_Send\_Test\_Email(); |
| [1874](#L1874) | $params     = array('email' => $mailbox ); |
| [1875](#L1875) | $response   = $test\_email->send\_test\_email($params); |
| [1876](#L1876) |  |
| [1877](#L1877) | wp\_send\_json($response); |
| [1878](#L1878) | } |
| [1879](#L1879) | wp\_send\_json($response); |
| [1880](#L1880) |  |
| [1881](#L1881) | } |
| [1882](#L1882) |  |
| [1883](#L1883) | public function get\_email\_authentication\_headers() { |
| [1884](#L1884) |  |
| [1885](#L1885) | check\_ajax\_referer( 'ig-es-admin-ajax-nonce', 'security' ); |
| [1886](#L1886) |  |
| [1887](#L1887) | $can\_access\_settings = ES\_Common::ig\_es\_can\_access( 'settings' ); |
| [1888](#L1888) | if ( ! ( $can\_access\_settings ) ) { |
| [1889](#L1889) | return 0; |
| [1890](#L1890) | } |
| [1891](#L1891) |  |
| [1892](#L1892) | $response = array( |
| [1893](#L1893) | 'status'        => 'error', |
| [1894](#L1894) | 'error\_message' => \_\_( 'Something went wrong', 'email-subscribers' ), |
| [1895](#L1895) | ); |
| [1896](#L1896) |  |
| [1897](#L1897) | $header\_check = new ES\_Service\_Auth\_Header\_Check(); |
| [1898](#L1898) | $response     = $header\_check->get\_email\_authentication\_headers(); |
| [1899](#L1899) |  |
| [1900](#L1900) | if ( 'error' !== $response['status'] && ! empty( $response['data']) ) { |
| [1901](#L1901) |  |
| [1902](#L1902) | $email\_auth\_headers = json\_decode( $response['data'], true ); |
| [1903](#L1903) | update\_option('ig\_es\_email\_auth\_headers', $email\_auth\_headers); |
| [1904](#L1904) |  |
| [1905](#L1905) | wp\_send\_json( $response ); |
| [1906](#L1906) | } |
| [1907](#L1907) | wp\_send\_json( $response ); |
| [1908](#L1908) | } |
| [1909](#L1909) |  |
| [1910](#L1910) | public function add\_list\_callback() { |
| [1911](#L1911) | check\_ajax\_referer('ig-es-admin-ajax-nonce', 'security'); |
| [1912](#L1912) |  |
| [1913](#L1913) | if ( !ES\_Common::ig\_es\_can\_access( 'audience' ) ) { |
| [1914](#L1914) | return 0; |
| [1915](#L1915) | } |
| [1916](#L1916) |  |
| [1917](#L1917) | $this->db = new ES\_Lists\_Table(); |
| [1918](#L1918) |  |
| [1919](#L1919) | $action     = ig\_es\_get\_request\_data('action'); |
| [1920](#L1920) | $list\_name  = ig\_es\_get\_request\_data('es\_list\_name'); |
| [1921](#L1921) | $list\_desc  = ig\_es\_get\_request\_data('es\_list\_desc'); |
| [1922](#L1922) |  |
| [1923](#L1923) | $validate\_data = array( |
| [1924](#L1924) | 'nonce'     => wp\_create\_nonce( 'es\_list' ), |
| [1925](#L1925) | 'list\_name' => sanitize\_text\_field($list\_name), |
| [1926](#L1926) | 'list\_desc' => sanitize\_textarea\_field($list\_desc), |
| [1927](#L1927) | ); |
| [1928](#L1928) |  |
| [1929](#L1929) | $response = $this->db->validate\_data($validate\_data); |
| [1930](#L1930) | if ('error' === $response['status']) { |
| [1931](#L1931) | wp\_send\_json\_error($response['message']); |
| [1932](#L1932) | return; |
| [1933](#L1933) | } |
| [1934](#L1934) |  |
| [1935](#L1935) | $data = array( |
| [1936](#L1936) | 'list\_name' => $list\_name, |
| [1937](#L1937) | 'list\_desc' => $list\_desc, |
| [1938](#L1938) | ); |
| [1939](#L1939) |  |
| [1940](#L1940) | $save = $this->db->save\_list(null, $data); |
| [1941](#L1941) | if ($save) { |
| [1942](#L1942) | wp\_send\_json\_success(array( |
| [1943](#L1943) | 'message' => \_\_('List added successfully.', 'email-subscribers'), |
| [1944](#L1944) | 'list\_id' => $save, |
| [1945](#L1945) | )); |
| [1946](#L1946) | } else { |
| [1947](#L1947) | wp\_send\_json\_error( \_\_('Failed to add list.', 'email-subscribers') ); |
| [1948](#L1948) | } |
| [1949](#L1949) | } |
| [1950](#L1950) |  |
| [1951](#L1951) |  |
| [1952](#L1952) |  |
| [1953](#L1953) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?format=txt)
* [Original Format](/export/3220459/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_b57ba170_20250110_211523.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3072302%2540email-subscribers%252Ftrunk%26old%3D3069441%2540email-subscribers%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3069441/email-subscribers/trunk?old=3072302&old_path=%2Femail-subscribers%2Ftrunk)

---

# Changes in [email-subscribers/trunk](/browser/email-subscribers/trunk?rev=3072302 "Show entry in browser") [[3069441:3072302]](/log/email-subscribers/trunk?rev=3072302&stop_rev=3069441 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[email-subscribers/trunk](/browser/email-subscribers/trunk?rev=3072302)
Files:

37 edited

* [email-subscribers.php](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))
* [lite/admin/class-email-subscribers-admin.php](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [lite/admin/js/email-subscribers-admin.js](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [lite/includes/class-email-subscribers-uninstall.php](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [lite/includes/class-email-subscribers.php](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [lite/includes/class-es-common.php](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file5 "Show differences"))
* [lite/includes/class-es-install.php](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file6 "Show differences"))
* [lite/includes/class-es-plugin-usage-data-collector.php](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file7 "Show differences"))
* [lite/includes/classes/class-es-actions.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file8 "Show differences"))
* [lite/includes/classes/class-es-admin-settings.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file9 "Show differences"))
* [lite/includes/classes/class-es-contacts-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))
* [lite/includes/classes/class-es-cron.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file11 "Show differences"))
* [lite/includes/classes/class-es-forms-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file12 "Show differences"))
* [lite/includes/classes/class-es-import-subscribers.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302 "Show entry in browser")
  (modified)
  ([7 diffs](#file13 "Show differences"))
* [lite/includes/classes/class-es-post-notifications.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [lite/includes/classes/class-es-queue.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file15 "Show differences"))
* [lite/includes/classes/class-es-reports-data.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file16 "Show differences"))
* [lite/includes/classes/class-es-subscription-throttling.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file17 "Show differences"))
* [lite/includes/classes/class-es-templates-table.php](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file18 "Show differences"))
* [lite/includes/controllers/class-es-campaign-controller.php](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302 "Show entry in browser")
  (modified)
  ([14 diffs](#file19 "Show differences"))
* [lite/includes/db/class-es-db-actions.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([18 diffs](#file20 "Show differences"))
* [lite/includes/db/class-es-db-campaigns.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302 "Show entry in browser")
  (modified)
  ([9 diffs](#file21 "Show differences"))
* [lite/includes/db/class-es-db-contacts.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302 "Show entry in browser")
  (modified)
  ([13 diffs](#file22 "Show differences"))
* [lite/includes/db/class-es-db-forms.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file23 "Show differences"))
* [lite/includes/db/class-es-db-lists.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file24 "Show differences"))
* [lite/includes/db/class-es-db-mailing-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([36 diffs](#file25 "Show differences"))
* [lite/includes/db/class-es-db-notifications.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file26 "Show differences"))
* [lite/includes/db/class-es-db-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file27 "Show differences"))
* [lite/includes/db/class-es-db-sending-queue.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302 "Show entry in browser")
  (modified)
  ([21 diffs](#file28 "Show differences"))
* [lite/includes/db/class-es-db.php](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file29 "Show differences"))
* [lite/includes/db/class-ig-es-db-unsubscribe-feedback.php](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302 "Show entry in browser")
  (modified)
  ([4 diffs](#file30 "Show differences"))
* [lite/includes/feedback/class-ig-feedback.php](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file31 "Show differences"))
* [lite/includes/upgrade/es-update-functions.php](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file32 "Show differences"))
* [lite/includes/workflows/class-es-workflow-action-preview.php](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302 "Show entry in browser")
  (modified)
  ([3 diffs](#file33 "Show differences"))
* [lite/includes/workflows/class-es-workflow.php](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file34 "Show differences"))
* [lite/includes/workflows/db/class-es-db-workflows.php](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=3072302 "Show entry in browser")
  (modified)
  ([1 diff](#file35 "Show differences"))
* [readme.txt](/browser/email-subscribers/trunk/readme.txt?rev=3072302 "Show entry in browser")
  (modified)
  ([2 diffs](#file36 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [email-subscribers/trunk/email-subscribers.php](/changeset/3072302/email-subscribers/trunk/email-subscribers.php?old=3069441&old_path=email-subscribers%2Ftrunk%2Femail-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/email-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L4 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L4 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* Plugin URI: https://www.icegram.com/ |
  | 5 | 5 | \* Description: Add subscription forms on website, send HTML newsletters & automatically notify subscribers about new blog posts once it is published. |
  | 6 |  | \* Version: 5.7.1~~7~~ |
  |  | 6 | \* Version: 5.7.18 |
  | 7 | 7 | \* Author: Icegram |
  | 8 | 8 | \* Author URI: https://www.icegram.com/ |
  | 9 | 9 | \* Requires at least: 3.9 |
  | 10 |  | \* Tested up to: 6.~~4.1~~ |
  |  | 10 | \* Tested up to: 6.5.2 |
  | 11 | 11 | \* WC requires at least: 3.6.0 |
  | 12 | 12 | \* WC tested up to: 8.0.2 |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L188) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L188) |  |
  | 188 | 188 |  |
  | 189 | 189 | if ( ! defined( 'ES\_PLUGIN\_VERSION' ) ) { |
  | 190 |  | define( 'ES\_PLUGIN\_VERSION', '5.7.1~~7~~' ); |
  |  | 190 | define( 'ES\_PLUGIN\_VERSION', '5.7.18' ); |
  | 191 | 191 | } |
  | 192 | 192 |  |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L269) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L269) |  |
  | 269 | 269 |  |
  | 270 | 270 | // Get all active blogs in the network and activate plugin on each one |
  |  | 271 | // phpcs:disable |
  | 271 | 272 | $blog\_ids = $wpdb->get\_col( $wpdb->prepare( "SELECT blog\_id FROM $wpdb->blogs WHERE deleted = %d", 0 ) ); |
  |  | 273 | // phpcs:enable |
  | 272 | 274 | foreach ( $blog\_ids as $blog\_id ) { |
  | 273 | 275 | ig\_es\_activate\_on\_blog( $blog\_id ); |
  | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3069441#L296) | […](/browser/email-subscribers/trunk/email-subscribers.php?rev=3072302#L298) |  |
  | 296 | 298 |  |
  | 297 | 299 | // Get all active blogs in the network. |
  |  | 300 | // phpcs:disable |
  | 298 | 301 | $blog\_ids = $wpdb->get\_col( $wpdb->prepare( "SELECT blog\_id FROM $wpdb->blogs WHERE deleted = %d", 0 ) ); |
  |  | 302 | // phpcs:enable |
  | 299 | 303 | foreach ( $blog\_ids as $blog\_id ) { |
  | 300 | 304 | // Run deactivation code on each one |
* ## [email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php](/changeset/3072302/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fadmin%2Fclass-email-subscribers-admin.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3060251#L845 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php?rev=3072302#L845 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 845 | 845 |  |
  | 846 | 846 | die( json\_encode( $response\_data ) ); |
  | 847 |  | ~~}~~ |
  | 848 |  |  |
  | 849 |  | ~~public function get\_template\_content() {~~ |
  | 850 |  | ~~global $ig\_es\_tracker;~~ |
  | 851 |  |  |
  | 852 |  | ~~$template\_id = (int) ig\_es\_get\_request\_data( 'template\_id', 0 );~~ |
  | 853 |  | ~~if ( 0 == $template\_id ) {~~ |
  | 854 |  | ~~return 0;~~ |
  | 855 |  | ~~}~~ |
  | 856 |  | ~~$post\_temp\_arr     = get\_post( $template\_id );~~ |
  | 857 |  | ~~$result['subject'] = ! empty( $post\_temp\_arr->post\_title ) ? $post\_temp\_arr->post\_title : '';~~ |
  | 858 |  | ~~$result['body']    = ! empty( $post\_temp\_arr->post\_content ) ? $post\_temp\_arr->post\_content : '';~~ |
  | 859 |  | ~~// get meta data of template~~ |
  | 860 |  | ~~// $active\_plugins = $ig\_es\_tracker::get\_active\_plugins();~~ |
  | 861 |  | ~~if ( ES()->is\_starter() ) {~~ |
  | 862 |  | ~~$result['inline\_css']      = get\_post\_meta( $template\_id, 'es\_custom\_css', true );~~ |
  | 863 |  | ~~$result['es\_utm\_campaign'] = get\_post\_meta( $template\_id, 'es\_utm\_campaign', true );~~ |
  | 864 |  | ~~}~~ |
  | 865 |  |  |
  | 866 |  | ~~die( json\_encode( $result ) );~~ |
  | 867 | 847 | } |
  | 868 | 848 |  |
* ## [email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js](/changeset/3072302/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?old=3026595&old_path=email-subscribers%2Ftrunk%2Flite%2Fadmin%2Fjs%2Femail-subscribers-admin.js "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js")

  | [r3069441](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3026595#L990 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/admin/js/email-subscribers-admin.js?rev=3072302#L990 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 990 | 990 | jQuery(this).ig\_es\_select2().trigger('change'); |
  | 991 | 991 | }); |
  | 992 |  | ~~}~~ |
  | 993 |  | ~~});~~ |
  | 994 |  | ~~});~~ |
  | 995 |  |  |
  | 996 |  | ~~jQuery(document).on('change', '#broadcast\_form #base\_template\_id', function () {~~ |
  | 997 |  | ~~var template\_id = $(this).val();~~ |
  | 998 |  | ~~// Update total count in lists~~ |
  | 999 |  | ~~var params = {~~ |
  | 1000 |  | ~~action: 'get\_template\_content',~~ |
  | 1001 |  | ~~template\_id: template\_id,~~ |
  | 1002 |  | ~~};~~ |
  | 1003 |  | ~~$.ajax({~~ |
  | 1004 |  | ~~method: 'POST',~~ |
  | 1005 |  | ~~url: ajaxurl,~~ |
  | 1006 |  | ~~async: false,~~ |
  | 1007 |  | ~~data: params,~~ |
  | 1008 |  | ~~success: function (response) {~~ |
  | 1009 |  | ~~if (response !== '') {~~ |
  | 1010 |  | ~~response = JSON.parse(response);~~ |
  | 1011 |  | ~~if (response.hasOwnProperty('subject')) {~~ |
  | 1012 |  | ~~jQuery('.wp-editor-boradcast').val(response.body);~~ |
  | 1013 |  | ~~if ('undefined' !== typeof tinyMCE) {~~ |
  | 1014 |  |  |
  | 1015 |  | ~~var activeEditor = tinyMCE.get('edit-es-broadcast-body');~~ |
  | 1016 |  |  |
  | 1017 |  | ~~if (activeEditor !== null) { // Make sure we're not calling setContent on null~~ |
  | 1018 |  | ~~response.body = response.body.replace(/\n/g, "<br />");~~ |
  | 1019 |  | ~~activeEditor.setContent(response.body); // Update tinyMCE's content~~ |
  | 1020 |  |  |
  | 1021 |  | ~~}~~ |
  | 1022 |  | ~~}~~ |
  | 1023 |  |  |
  | 1024 |  | ~~if (response.inline\_css && jQuery('#inline\_css').length) {~~ |
  | 1025 |  | ~~jQuery('#inline\_css').val(response.inline\_css);~~ |
  | 1026 |  | ~~}~~ |
  | 1027 |  | ~~if (response.es\_utm\_campaign && jQuery('#es\_utm\_campaign').length) {~~ |
  | 1028 |  | ~~jQuery('#es\_utm\_campaign').val(response.es\_utm\_campaign);~~ |
  | 1029 |  | ~~}~~ |
  | 1030 |  |  |
  | 1031 |  | ~~if ( 1 === $('#edit-es-broadcast-body').length ) {~~ |
  | 1032 |  | ~~ig\_es\_sync\_wp\_editor\_content();~~ |
  | 1033 |  | ~~$('#edit-es-broadcast-body').trigger('change');~~ |
  | 1034 |  | ~~}~~ |
  | 1035 |  | ~~}~~ |
  | 1036 |  | ~~}~~ |
  | 1037 |  | ~~}~~ |
  | 1038 |  | ~~});~~ |
  | 1039 |  | ~~});~~ |
  | 1040 |  |  |
  | 1041 |  | ~~jQuery(document).on('change', '#campaign\_form #base\_template\_id, #campaign\_form #post\_digest\_template\_id', function () {~~ |
  | 1042 |  | ~~var template\_id = $(this).val();~~ |
  | 1043 |  | ~~// Update total count in lists~~ |
  | 1044 |  | ~~var params = {~~ |
  | 1045 |  | ~~action: 'get\_template\_content',~~ |
  | 1046 |  | ~~template\_id: template\_id,~~ |
  | 1047 |  | ~~};~~ |
  | 1048 |  | ~~$.ajax({~~ |
  | 1049 |  | ~~method: 'POST',~~ |
  | 1050 |  | ~~url: ajaxurl,~~ |
  | 1051 |  | ~~async: false,~~ |
  | 1052 |  | ~~data: params,~~ |
  | 1053 |  | ~~success: function (response) {~~ |
  | 1054 |  | ~~if (response !== '') {~~ |
  | 1055 |  | ~~response = JSON.parse(response);~~ |
  | 1056 |  | ~~if (response.hasOwnProperty('subject')) {~~ |
  | 1057 |  | ~~jQuery('#ig\_es\_campaign\_subject').val(response.subject);~~ |
  | 1058 |  | ~~jQuery('.wp-campaign-body-editor').val(response.body);~~ |
  | 1059 |  | ~~if ('undefined' !== typeof tinyMCE) {~~ |
  | 1060 |  |  |
  | 1061 |  | ~~var activeEditor = tinyMCE.get('edit-es-campaign-body');~~ |
  | 1062 |  |  |
  | 1063 |  | ~~if (activeEditor !== null) { // Make sure we're not calling setContent on null~~ |
  | 1064 |  | ~~response.body = response.body.replace(/\n/g, "<br />");~~ |
  | 1065 |  | ~~activeEditor.setContent(response.body); // Update tinyMCE's content~~ |
  | 1066 |  | ~~}~~ |
  | 1067 |  | ~~}~~ |
  | 1068 |  |  |
  | 1069 |  | ~~if (response.inline\_css && jQuery('#inline\_css').length) {~~ |
  | 1070 |  | ~~jQuery('#inline\_css').val(response.inline\_css);~~ |
  | 1071 |  | ~~}~~ |
  | 1072 |  | ~~if (response.es\_utm\_campaign && jQuery('#es\_utm\_campaign').length) {~~ |
  | 1073 |  | ~~jQuery('#es\_utm\_campaign').val(response.es\_utm\_campaign);~~ |
  | 1074 |  | ~~}~~ |
  | 1075 |  |  |
  | 1076 |  | ~~if ( 1 === $('#edit-es-campaign-body').length ) {~~ |
  | 1077 |  | ~~ig\_es\_sync\_wp\_editor\_content();~~ |
  | 1078 |  | ~~$('#edit-es-campaign-body').trigger('change');~~ |
  | 1079 |  | ~~}~~ |
  | 1080 |  | ~~}~~ |
  | 1081 |  | ~~}~~ |
  | 1082 | 992 | } |
  | 1083 | 993 | }); |
* ## [email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-email-subscribers-uninstall.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=2602749#L82 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302#L82 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 82 | 82 | update\_option( 'sidebars\_widgets', $sidebars\_widgets ); |
  | 83 | 83 | delete\_option( 'widget\_email-subscribers-form' ); |
  | 84 |  |  |
  |  | 84 | // phpcs:disable |
  | 85 | 85 | // Delete postmeta data |
  | 86 | 86 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}postmeta where post\_id IN ( SELECT ID from {$wpdb->prefix}posts where post\_type  = %s)", $post\_type ) ); |
  | […](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=2602749#L91) | […](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers-uninstall.php?rev=3072302#L91) |  |
  | 91 | 91 | // Delete all options from options table with prefix ig\_es |
  | 92 | 92 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}options WHERE option\_name LIKE %s", $option\_name ) ); |
  |  | 93 | // phpcs:enable |
  | 93 | 94 | } |
  | 94 | 95 |  |
* ## [email-subscribers/trunk/lite/includes/class-email-subscribers.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-email-subscribers.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-email-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-email-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3051406#L1061 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3072302#L1061 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1061 | 1061 | $this->loader->add\_filter( 'set-screen-option', $plugin\_admin, 'save\_screen\_options', 20, 3 ); |
  | 1062 | 1062 | $this->loader->add\_action( 'wp\_ajax\_count\_contacts\_by\_list', $plugin\_admin, 'count\_contacts\_by\_list' ); |
  | 1063 |  | ~~$this->loader->add\_action( 'wp\_ajax\_get\_template\_content', $plugin\_admin, 'get\_template\_content' );~~ |
  | 1064 | 1063 | $this->loader->add\_action( 'admin\_print\_scripts', $plugin\_admin, 'remove\_other\_admin\_notices' ); |
  | 1065 | 1064 |  |
* ## [email-subscribers/trunk/lite/includes/class-es-common.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-common.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-common.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-common.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L650 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L650 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 650 | 650 | \*/ |
  | 651 | 651 | public static function get\_templates( $type = '', $editor\_type = '' ) { |
  | 652 |  |  |
  |  | 652 | // phpcs:diable WordPressVIPMinimum.Performance.WPQueryParams.SuppressFilters\_suppress\_filters |
  | 653 | 653 | $es\_args = array( |
  | 654 | 654 | 'posts\_per\_page'   => - 1, |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L657) | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L657) |  |
  | 657 | 657 | 'order'            => 'DESC', |
  | 658 | 658 | 'post\_status'      => 'publish', |
  | 659 |  | 'suppress\_filters' => true, |
  |  | 659 | 'suppress\_filters' => true, |
  | 660 | 660 | ); |
  | 661 |  |  |
  |  | 661 | // phpcs:enable |
  | 662 | 662 | if ( ! empty( $type ) ) { |
  | 663 | 663 | $es\_args['meta\_query'][] = array( |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3060251#L2754) | […](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3072302#L2754) |  |
  | 2754 | 2754 |  |
  | 2755 | 2755 | global $wpdb; |
  | 2756 |  |  |
  |  | 2756 | // phpcs:disable |
  | 2757 | 2757 | $results = $wpdb->get\_results( "SELECT DISTINCT MONTHNAME(`start\_at`), YEAR(`start\_at`) FROM {$wpdb->prefix}ig\_mailing\_queue;", ARRAY\_A ); |
  | 2758 |  |  |
  |  | 2758 | // phpcs:enable |
  | 2759 | 2759 | $field\_options = array( |
  | 2760 | 2760 | 'default' => $default\_label |
* ## [email-subscribers/trunk/lite/includes/class-es-install.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-install.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-install.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-install.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3046188#L463 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302#L463 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 463 | 463 | $running\_migration\_queue\_like = '%' . $wpdb->esc\_like( '\_running\_migration\_for\_' ) . '%'; |
  | 464 | 464 | $db\_migration\_queue\_like      = '%' . $wpdb->esc\_like( 'ig\_es\_updater\_batch\_' ) . '%'; |
  | 465 |  |  |
  |  | 465 | // phpcs:disable |
  | 466 | 466 | $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->prefix}options WHERE option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s OR option\_name LIKE %s", $transient\_like, $updating\_like, $last\_sent\_queue\_like, $running\_migration\_queue\_like, $db\_migration\_queue\_like ) ); |
  | 467 |  |  |
  |  | 467 | // phpcs:enable |
  | 468 | 468 | } |
  | 469 | 469 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3046188#L1585) | […](/browser/email-subscribers/trunk/lite/includes/class-es-install.php?rev=3072302#L1585) |  |
  | 1585 | 1585 | $templates = apply\_filters( 'ig\_es\_email\_templates', $templates ); |
  | 1586 | 1586 | $post\_type = 'es\_template'; |
  | 1587 |  |  |
  |  | 1587 | // phpcs:disable |
  | 1588 | 1588 | $imported\_templ = $wpdb->get\_col( $wpdb->prepare( "SELECT post\_name FROM {$wpdb->prefix}posts where post\_type  = %s", $post\_type ) ); |
  | 1589 |  |  |
  |  | 1589 | // phpcs:enable |
  | 1590 | 1590 | if ( is\_array( $templates ) && count( $templates ) > 0 ) { |
  | 1591 | 1591 |  |
* ## [email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php](/changeset/3072302/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?old=2940165&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-es-plugin-usage-data-collector.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=2940165#L135 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302#L135 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 135 | 135 |  |
  | 136 | 136 | $option\_name\_like = 'ig\_es\_%'; |
  |  | 137 | // phpcs:disable |
  | 137 | 138 | $results          = $wpdb->get\_results( $wpdb->prepare( "SELECT option\_name, option\_value FROM {$wpdb->prefix}options WHERE option\_name LIKE %s  AND option\_name != %s", $option\_name\_like, 'ig\_es\_managed\_blocked\_domains' ), ARRAY\_A ); |
  | 138 |  |  |
  |  | 139 | // phpcs:enable |
  | 139 | 140 | $options\_name\_value\_map = array(); |
  | 140 | 141 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=2940165#L168) | […](/browser/email-subscribers/trunk/lite/includes/class-es-plugin-usage-data-collector.php?rev=3072302#L169) |  |
  | 168 | 169 | return 'no'; |
  | 169 | 170 | } |
  | 170 |  |  |
  |  | 171 | global $wpdb; |
  | 171 | 172 | // Ensure there is atleast one users for whom REST API keys are generated |
  | 172 |  | $rest\_api\_users\_ids = get\_users( array( |
  | 173 |  | 'meta\_key' => 'ig\_es\_rest\_api\_keys', |
  | 174 |  | 'fields'   => 'ID' |
  | 175 |  | ) ); |
  |  | 173 | $rest\_api\_users\_ids = $wpdb->get\_col( |
  |  | 174 | $wpdb->prepare( |
  |  | 175 | "SELECT user\_id FROM $wpdb->usermeta WHERE meta\_key = 'ig\_es\_rest\_api\_keys'" |
  |  | 176 | ) |
  |  | 177 | ); |
  | 176 | 178 |  |
  | 177 | 179 | if ( empty( $rest\_api\_users\_ids ) ) { |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-actions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?old=2843300&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-actions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-actions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=2843300#L303 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302#L303 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 303 | 303 |  |
  | 304 | 304 | global $wpdb; |
  | 305 |  |  |
  |  | 305 | // phpcs:disable |
  | 306 | 306 | $sql = $wpdb->get\_var( $wpdb->prepare( "SELECT count(\*) FROM {$wpdb->prefix}ig\_actions WHERE contact\_id = %d AND message\_id = %d AND campaign\_id = %d AND type = %d ", $contact\_id, $message\_id, $campaign\_id, IG\_MESSAGE\_SENT ) ); |
  |  | 307 | // phpcs:enable |
  | 307 | 308 | return $sql; |
  | 308 | 309 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=2843300#L327) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-actions.php?rev=3072302#L328) |  |
  | 327 | 328 |  |
  | 328 | 329 | $current\_date = ig\_get\_current\_date\_time(); |
  |  | 330 | // phpcs:disable |
  | 329 | 331 | $sql          = $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_sending\_queue SET opened\_at = %s, opened = %d WHERE contact\_id = %d AND campaign\_id = %d AND mailing\_queue\_id = %d", $current\_date, 1, $conact\_id, $campaign\_id, $message\_id ) ); |
  | 330 |  |  |
  |  | 332 | // phpcs:enable |
  | 331 | 333 | return $sql; |
  | 332 | 334 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?old=2993694&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-admin-settings.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1221 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1221 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1221 | 1221 | public static function render\_rest\_api\_keys\_section() { |
  | 1222 | 1222 | ob\_start(); |
  | 1223 |  | $rest\_api\_keys = get\_option( 'ig\_es\_rest\_api\_keys', array() ); |
  | 1224 |  |  |
  | 1225 |  | $rest\_api\_users\_ids = get\_users( array( |
  | 1226 |  | 'meta\_key' => 'ig\_es\_rest\_api\_keys', |
  | 1227 |  | 'fields'   => 'ID' |
  | 1228 |  | ) ); |
  |  | 1223 | $rest\_api\_keys = get\_option('ig\_es\_rest\_api\_keys', array()); |
  |  | 1224 |  |
  |  | 1225 |  |
  |  | 1226 | $admin\_users = get\_users(array( |
  |  | 1227 | 'role'   => 'administrator', |
  |  | 1228 | 'fields' => array('ID', 'user\_email', 'user\_login'), |
  |  | 1229 | )); |
  | 1229 | 1230 | ?> |
  | 1230 | 1231 | <div id="ig-es-rest-api-section"> |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1232) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1233) |  |
  | 1232 | 1233 | <thead> |
  | 1233 | 1234 | <tr class="bg-blue-50 text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider"> |
  | 1234 |  | <th class="px-5 py-4"><?php echo esc\_html\_\_(~~'Key', 'email-subscribers'~~ ); ?></th> |
  | 1235 |  | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_(~~'Username', 'email-subscribers'~~ ); ?></th> |
  | 1236 |  | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_(~~'Actions', 'email-subscribers'~~ ); ?></th> |
  |  | 1235 | <th class="px-5 py-4"><?php echo esc\_html\_\_('Key', 'email-subscribers'); ?></th> |
  |  | 1236 | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_('Username', 'email-subscribers'); ?></th> |
  |  | 1237 | <th class="px-2 py-4 text-center"><?php echo esc\_html\_\_('Actions', 'email-subscribers'); ?></th> |
  | 1237 | 1238 | </tr> |
  | 1238 | 1239 | </thead> |
  | 1239 | 1240 | <tbody class="bg-blue-50"> |
  | 1240 |  | <?php |
  | 1241 |  | if ( ! empty( $rest\_api\_users\_ids ) ) { |
  | 1242 |  | foreach ( $rest\_api\_users\_ids as $user\_id ) { |
  | 1243 |  | $user = get\_userdata( $user\_id ); |
  | 1244 |  | if ( ! $user ) { |
  | 1245 |  | continue; |
  | 1246 |  | } |
  | 1247 |  | $rest\_api\_keys = get\_user\_meta( $user\_id, 'ig\_es\_rest\_api\_keys', true ); |
  | 1248 |  | if ( ! empty( $rest\_api\_keys ) ) { |
  | 1249 |  | foreach ( $rest\_api\_keys as $index => $rest\_api\_key ) { |
  | 1250 |  | $key\_start = substr( $rest\_api\_key, 0, 4 ); |
  | 1251 |  | $key\_end   = substr( $rest\_api\_key, strlen( $rest\_api\_key ) - 4, 4 ); |
  | 1252 |  | ?> |
  | 1253 |  | <tr class="ig-es-rest-api-row border-b border-gray-200 text-xs leading-4 font-medium" data-user-id="<?php echo esc\_attr( $user\_id ); ?>" data-api-index="<?php echo esc\_attr( $index ); ?>"> |
  | 1254 |  | <td class="px-5 py-4 text-center"><?php echo esc\_html( $key\_start ); ?>\*\*\*\*\*\*\*\*\*\*\*<?php echo esc\_html( $key\_end ); ?></td> |
  | 1255 |  | <td class="px-2 py-4 text-center"><?php echo esc\_html( $user->data->user\_login ); ?></td> |
  |  | 1241 | <?php |
  |  | 1242 | if (!empty($admin\_users)) { |
  |  | 1243 | foreach ($admin\_users as $user) { |
  |  | 1244 | $rest\_api\_keys = get\_user\_meta($user->ID, 'ig\_es\_rest\_api\_keys', true); |
  |  | 1245 | if (!empty($rest\_api\_keys)) { |
  |  | 1246 | foreach ($rest\_api\_keys as $index => $rest\_api\_key) { |
  |  | 1247 | $key\_start = substr($rest\_api\_key, 0, 4); |
  |  | 1248 | $key\_end = substr($rest\_api\_key, -4); |
  |  | 1249 | ?> |
  |  | 1250 | <tr class="ig-es-rest-api-row border-b border-gray-200 text-xs leading-4 font-medium" |
  |  | 1251 | data-user-id="<?php echo esc\_attr($user->ID); ?>" |
  |  | 1252 | data-api-index="<?php echo esc\_attr($index); ?>"> |
  |  | 1253 | <td class="px-5 py-4 text-center"><?php echo esc\_html($key\_start); ?>\*\*\*\*\*\*\*\*\*\*\*<?php echo esc\_html($key\_end); ?></td> |
  |  | 1254 | <td class="px-2 py-4 text-center"><?php echo esc\_html($user->user\_login); ?></td> |
  | 1256 | 1255 | <td class="px-2 py-4 text-center"> |
  | 1257 |  | <a class="ig-es-delete-rest-api-key inline-block" href="#"> |
  | 1258 |  | <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"> |
  | 1259 |  | <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /> |
  | 1260 |  | </svg> |
  | 1261 |  | </a> |
  |  | 1256 | <a class="ig-es-delete-rest-api-key inline-block" href="#"> |
  |  | 1257 | <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" |
  |  | 1258 | stroke-width="1.5" stroke="currentColor" class="w-6 h-6"> |
  |  | 1259 | <path stroke-linecap="round" stroke-linejoin="round" |
  |  | 1260 | d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"/> |
  |  | 1261 | </svg> |
  |  | 1262 | </a> |
  | 1262 | 1263 | </td> |
  | 1263 | 1264 | </tr> |
  | 1264 | 1265 | <?php |
  | 1265 |  | ~~}~~ |
  | 1266 | 1266 | } |
  | 1267 |  | ~~?>~~ |
  | 1268 |  | ~~<?php~~ |
  | 1269 | 1267 | } |
  | 1270 | 1268 | } |
  | 1271 |  | ?> |
  | 1272 |  | <tr id="ig-es-no-api-keys-message" class="border-b border-gray-200 text-xs leading-4 font-medium"> |
  | 1273 |  | <td colspan="3" class="px-5 py-4 text-center"> |
  | 1274 |  | <?php echo esc\_html\_\_( 'No API keys found.', 'email-subscribers' ); ?> |
  | 1275 |  | </td> |
  | 1276 |  | </tr> |
  |  | 1269 | } |
  |  | 1270 | ?> |
  |  | 1271 | <tr id="ig-es-no-api-keys-message" class="border-b border-gray-200 text-xs leading-4 font-medium"> |
  |  | 1272 | <td colspan="3" class="px-5 py-4 text-center"> |
  |  | 1273 | <?php echo esc\_html\_\_('No API keys found.', 'email-subscribers'); ?> |
  |  | 1274 | </td> |
  |  | 1275 | </tr> |
  | 1277 | 1276 | </tbody> |
  | 1278 | 1277 | </table> |
  | 1279 | 1278 | <div id="ig-es-create-new-rest-api-container" class="mt-2"> |
  | 1280 |  | ~~<?php~~ |
  | 1281 |  | ~~$admin\_users = get\_users(~~ |
  | 1282 |  | ~~array(~~ |
  | 1283 |  | ~~'role' => 'administrator'~~ |
  | 1284 |  | ~~)~~ |
  | 1285 |  | ~~);~~ |
  | 1286 |  | ~~?>~~ |
  | 1287 | 1279 | <select id="ig-es-rest-api-user-id"> |
  | 1288 |  | <option value=""><?php echo esc\_html\_\_(~~'Please select a user', 'email-subscribers'~~ ); ?></option> |
  |  | 1280 | <option value=""><?php echo esc\_html\_\_('Please select a user', 'email-subscribers'); ?></option> |
  | 1289 | 1281 | <?php |
  | 1290 |  | foreach (~~$admin\_users as $user~~ ) { |
  |  | 1282 | foreach ($admin\_users as $user) { |
  | 1291 | 1283 | ?> |
  | 1292 |  | <option value="<?php echo esc\_attr(~~$user->ID ); ?>"><?php echo esc\_html( $user->data->user\_email~~ ); ?></option> |
  |  | 1284 | <option value="<?php echo esc\_attr($user->ID); ?>"><?php echo esc\_html($user->user\_email); ?></option> |
  | 1293 | 1285 | <?php |
  | 1294 | 1286 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=2993694#L1297) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-admin-settings.php?rev=3072302#L1289) |  |
  | 1297 | 1289 | <button type="button" id="ig-es-generate-rest-api-key" class="ig-es-title-button ml-2 align-middle ig-es-inline-loader"> |
  | 1298 | 1290 | <span> |
  | 1299 |  | <?php echo esc\_html\_\_(~~'Generate API key', 'email-subscribers'~~ ); ?> |
  |  | 1291 | <?php echo esc\_html\_\_('Generate API key', 'email-subscribers'); ?> |
  | 1300 | 1292 | </span> |
  | 1301 | 1293 | <svg class="es-btn-loader animate-spin h-4 w-4 text-indigo" |
  | 1302 |  | xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> |
  |  | 1294 | xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> |
  | 1303 | 1295 | <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" |
  | 1304 | 1296 | stroke-width="4"></circle> |
  | 1305 | 1297 | <path class="opacity-75" fill="currentColor" |
  | 1306 |  | d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> |
  |  | 1298 | d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path> |
  | 1307 | 1299 | </svg> |
  | 1308 | 1300 | </button> |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-contacts-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3060251#L1537 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302#L1537 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1537 | 1537 | return $response; |
  | 1538 | 1538 | } |
  | 1539 |  |  |
  |  | 1539 | // phpcs:disable |
  | 1540 | 1540 | $edited = ES()->lists\_contacts\_db->add\_contacts\_to\_list( $subscriber\_ids, $list\_id ); |
  | 1541 |  |  |
  |  | 1541 | // phpcs:enable |
  | 1542 | 1542 | if ( $edited ) { |
  | 1543 | 1543 | $message = \_\_( 'Contact(s) added to list successfully!', 'email-subscribers' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3060251#L1569) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-contacts-table.php?rev=3072302#L1569) |  |
  | 1569 | 1569 |  |
  | 1570 | 1570 | global $wpdb; |
  | 1571 |  |  |
  |  | 1571 | // phpcs:disable |
  | 1572 | 1572 | $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_contacts SET form\_id = %d WHERE form\_id = %d", 0, $form\_id ) ); |
  |  | 1573 | // phpcs:enable |
  | 1573 | 1574 | } |
  | 1574 | 1575 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-cron.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-cron.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-cron.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3046188#L269 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-cron.php?rev=3072302#L269 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 269 | 269 |  |
  | 270 | 270 | $lock = 'ig\_es\_cron\_lock\_' . $key . '%'; |
  | 271 |  |  |
  |  | 271 | // phpcs:disable |
  | 272 | 272 | $res = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(\*) FROM {$wpdb->prefix}options WHERE option\_name LIKE %s AND option\_value != ''", $lock ) ); |
  | 273 |  |  |
  |  | 273 | // phpcs:enable |
  | 274 | 274 | return ! ! $res; |
  | 275 | 275 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?old=3060251&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-forms-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3060251#L513 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-forms-table.php?rev=3072302#L513 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 513 | 513 | // We don't want to change the created\_at date for update |
  | 514 | 514 | unset( $form\_data['created\_at'] ); |
  |  | 515 | // phpcs:disable |
  | 515 | 516 | $return = $wpdb->update( IG\_FORMS\_TABLE, $form\_data, array( 'id' => $id ) ); |
  | 516 | 517 | } else { |
  | 517 | 518 | $return = $wpdb->insert( IG\_FORMS\_TABLE, $form\_data ); |
  | 518 | 519 | } |
  |  | 520 | // phpcs:enable |
  | 519 | 521 |  |
  | 520 | 522 | return $return; |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?old=3063438&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-import-subscribers.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L598 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L598 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 598 | 598 | } elseif ( 'wordpress\_users' === $importing\_from ) { |
  | 599 | 599 | $roles = ig\_es\_get\_request\_data( 'selected\_roles' ); |
  | 600 |  |  |
  |  | 600 | // phpcs:disable |
  | 601 | 601 | $users = $wpdb->get\_results( |
  | 602 | 602 | "SELECT u.user\_email, IF(meta\_role.meta\_value = 'a:0:{}',NULL,meta\_role.meta\_value) AS '\_role', meta\_firstname.meta\_value AS 'firstname', meta\_lastname.meta\_value AS 'lastname', u.display\_name, u.user\_nicename |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L607) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L607) |  |
  | 607 | 607 | WHERE meta\_role.user\_id IS NOT NULL" |
  | 608 | 608 | ); |
  | 609 |  |  |
  |  | 609 | // phpcs:enable |
  | 610 | 610 | if ( ! empty( $users ) ) { |
  | 611 | 611 | $raw\_data             = ''; |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L692) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L692) |  |
  | 692 | 692 | $response['data']       = get\_option( 'ig\_es\_bulk\_import' ); |
  | 693 | 693 | // get first and last entry |
  |  | 694 | // phpcs:disable |
  | 694 | 695 | $entries = $wpdb->get\_row( |
  | 695 | 696 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L700) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L701) |  |
  | 700 | 701 | ) |
  | 701 | 702 | ); |
  |  | 703 | // phpcs:enable |
  | 702 | 704 |  |
  | 703 | 705 | $first = unserialize( base64\_decode( $entries->first ) ); |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L877) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L879) |  |
  | 877 | 879 | $batch\_id            = (int) sanitize\_text\_field( $\_POST['id'] ); |
  | 878 | 880 | $bulkdata['current'] = $batch\_id; |
  | 879 |  |  |
  |  | 881 | // phpcs:disable |
  | 880 | 882 | $raw\_list\_data       = $wpdb->get\_col( |
  | 881 | 883 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L887) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L889) |  |
  | 887 | 889 | ) |
  | 888 | 890 | ); |
  |  | 891 | // phpcs:enable |
  | 889 | 892 | if ( $raw\_list\_data ) { |
  | 890 | 893 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3063438#L1503) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-import-subscribers.php?rev=3072302#L1506) |  |
  | 1503 | 1506 | $part = $parts[ $i ]; |
  | 1504 | 1507 | $new\_value = base64\_encode( serialize( $part ) ); |
  | 1505 |  |  |
  |  | 1508 | // phpcs:disable |
  | 1506 | 1509 | $wpdb->query( $wpdb->prepare( "INSERT INTO {$wpdb->prefix}ig\_temp\_import (data, identifier) VALUES (%s, %s)", $new\_value, $identifier ) ); |
  |  | 1510 | // phpcs:enable |
  | 1507 | 1511 | } |
  | 1508 | 1512 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-post-notifications.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=2989575#L139 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-post-notifications.php?rev=3072302#L139 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 139 | 139 | 'status'           => 'active', |
  | 140 | 140 | ); |
  |  | 141 | // phpcs:disable |
  | 141 | 142 | $wpdb->update( IG\_CAMPAIGNS\_TABLE, $data, array( 'id' => $id ) ); |
  | 142 |  |  |
  |  | 143 | // phpcs:enable |
  | 143 | 144 | } |
  | 144 | 145 |  |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=2989575#L591 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302#L591 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 591 | 591 | // ES()->logger->info( 'Process Queue:' ); |
  | 592 | 592 | // ES()->logger->info( 'SQL: ' . $sql ); |
  | 593 |  |  |
  |  | 593 | // phpcs:disable |
  | 594 | 594 | $notifications = $wpdb->get\_results( |
  | 595 | 595 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=2989575#L604) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-queue.php?rev=3072302#L604) |  |
  | 604 | 604 | ARRAY\_A |
  | 605 | 605 | ); |
  |  | 606 | // phpcs:enable |
  | 606 | 607 |  |
  | 607 | 608 | $batch\_start\_time = time(); |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-reports-data.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L369 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L369 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 369 | 369 | continue; |
  | 370 | 370 | } |
  | 371 |  |  |
  |  | 371 | // phpcs:disable |
  | 372 | 372 | $results = $wpdb->get\_results( $wpdb->prepare( "SELECT type, count(DISTINCT (contact\_id) ) as total FROM {$wpdb->prefix}ig\_actions WHERE message\_id = %d AND campaign\_id = %d GROUP BY type", $message\_id, $campaign\_id ), ARRAY\_A ); |
  | 373 |  |  |
  |  | 373 | // phpcs:enable |
  | 374 | 374 | $stats     = array(); |
  | 375 | 375 | $type      = ''; |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L464) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L464) |  |
  | 464 | 464 | public static function get\_top\_performing\_campaigns( $start\_time, $campaign\_count = 3 ) { |
  | 465 | 465 | global $wpdb; |
  | 466 |  |  |
  |  | 466 | // phpcs:disable |
  | 467 | 467 | $top\_campaigns = $wpdb->get\_results( |
  | 468 | 468 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3051406#L473) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-reports-data.php?rev=3072302#L473) |  |
  | 473 | 473 | ARRAY\_A |
  | 474 | 474 | ); |
  |  | 475 | // phpcs:enable |
  | 475 | 476 |  |
  | 476 | 477 | return $top\_campaigns; |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?old=2369871&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-subscription-throttling.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L26 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L26 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 26 | 26 | return MINUTE\_IN\_SECONDS \* 10; |
  | 27 | 27 | } |
  | 28 |  |  |
  |  | 28 | // phpcs:disable |
  | 29 | 29 | $subscribers = $wpdb->get\_var( |
  | 30 | 30 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L34) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L34) |  |
  | 34 | 34 | ) |
  | 35 | 35 | ); |
  |  | 36 | // phpcs:enable |
  | 36 | 37 |  |
  | 37 | 38 | if ( $subscribers > 0 ) { |
  | 38 | 39 | $timeout = MINUTE\_IN\_SECONDS \* pow( 2, $subscribers - 1 ); |
  | 39 |  |  |
  |  | 40 | // phpcs:disable |
  | 40 | 41 | $subscribers = $wpdb->get\_var( |
  | 41 | 42 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L45) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L46) |  |
  | 45 | 46 | ) |
  | 46 | 47 | ); |
  | 47 |  |  |
  |  | 48 | // phpcs:enable |
  | 48 | 49 | if ( $subscribers > 0 ) { |
  | 49 | 50 | return $timeout; |
  | 50 | 51 | } |
  | 51 | 52 | } |
  | 52 |  |  |
  |  | 53 | // phpcs:disable |
  | 53 | 54 | // Add IP Address. |
  | 54 | 55 | $wpdb->query( |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=2369871#L66) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-subscription-throttling.php?rev=3072302#L67) |  |
  | 66 | 67 | ) |
  | 67 | 68 | ); |
  |  | 69 | // phpcs:enable |
  | 68 | 70 | } |
  | 69 | 71 | } |
* ## [email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php](/changeset/3072302/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?old=2758988&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclasses%2Fclass-es-templates-table.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=2758988#L22 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302#L22 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 22 | 22 | add\_action( 'admin\_init', array( &$this, 'duplicate\_template' ), 10, 1 ); |
  | 23 | 23 | add\_action( 'admin\_footer', array( $this, 'es\_template\_preview\_callback' ), 10 ); |
  | 24 |  |  |
  | 25 |  | ~~add\_action( 'parse\_query', array( $this, 'exclude\_dnd\_templates' ) );~~ |
  | 26 | 24 | } |
  | 27 | 25 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=2758988#L273) | […](/browser/email-subscribers/trunk/lite/includes/classes/class-es-templates-table.php?rev=3072302#L271) |  |
  | 273 | 271 | } |
  | 274 | 272 |  |
  | 275 |  | ~~/\*\*~~ |
  | 276 |  | ~~\* Exclude DND Templates from template list~~ |
  | 277 |  | ~~\*~~ |
  | 278 |  | ~~\* @since 4.5.3~~ |
  | 279 |  | ~~\*/~~ |
  | 280 |  | ~~public static function exclude\_dnd\_templates( $wp\_query ) {~~ |
  | 281 |  |  |
  | 282 |  | ~~global $pagenow;~~ |
  | 283 |  |  |
  | 284 |  | ~~if ( 'edit.php' !== $pagenow || empty( $wp\_query->query\_vars['post\_type'] ) ||'es\_template' !== $wp\_query->query\_vars['post\_type'] ) {~~ |
  | 285 |  | ~~return;~~ |
  | 286 |  | ~~}~~ |
  | 287 |  |  |
  | 288 |  | ~~$wp\_query->query\_vars['meta\_query'] = array(~~ |
  | 289 |  | ~~'relation' => 'OR',~~ |
  | 290 |  | ~~array(~~ |
  | 291 |  | ~~'key'     => 'es\_editor\_type',~~ |
  | 292 |  | ~~'value'   => IG\_ES\_CLASSIC\_EDITOR,~~ |
  | 293 |  | ~~'compare' => '=',~~ |
  | 294 |  | ~~),~~ |
  | 295 |  | ~~array(~~ |
  | 296 |  | ~~'key'     => 'es\_editor\_type',~~ |
  | 297 |  | ~~'compare' => 'NOT EXISTS', // if key doesn't exists, then template is created using Classic editor~~ |
  | 298 |  | ~~),~~ |
  | 299 |  | ~~);~~ |
  | 300 |  | ~~}~~ |
  | 301 |  |  |
  | 302 | 273 | public static function get\_instance() { |
  | 303 | 274 | if ( ! isset( self::$instance ) ) { |
* ## [email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php](/changeset/3072302/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?old=3069441&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fcontrollers%2Fclass-es-campaign-controller.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L890 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L890 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 890 | 890 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_data['id']; |
  | 891 | 891 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 892 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 892 | 893 | $post\_args =  array( |
  | 893 | 894 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L896) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L897) |  |
  | 896 | 897 | 'order'          => 'DESC', |
  | 897 | 898 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 898 |  | 'meta\_query'     => array( |
  |  | 899 | 'meta\_query'     => array( |
  | 899 | 900 | array( |
  | 900 | 901 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L912) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L913) |  |
  | 912 | 913 | 'orderby'        => 'date', |
  | 913 | 914 | 'order'          => 'DESC', |
  | 914 |  | 'meta\_query'     => array( |
  |  | 915 | 'meta\_query'     => array( |
  | 915 | 916 | array( |
  | 916 | 917 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L919) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L920) |  |
  | 919 | 920 | ), |
  | 920 | 921 | ); |
  | 921 |  |  |
  |  | 922 | // phpcs:enable |
  | 922 | 923 | $recent\_posts = get\_posts( $custom\_post\_args ); |
  | 923 | 924 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1016) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1017) |  |
  | 1016 | 1017 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_id; |
  | 1017 | 1018 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 1019 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1018 | 1020 | $post\_args =  array( |
  | 1019 | 1021 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1022) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1024) |  |
  | 1022 | 1024 | 'order'          => 'DESC', |
  | 1023 | 1025 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 1024 |  | 'meta\_query'     => array( |
  |  | 1026 | 'meta\_query'     => array( |
  | 1025 | 1027 | array( |
  | 1026 | 1028 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1036) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1038) |  |
  | 1036 | 1038 | ); |
  | 1037 | 1039 | } |
  |  | 1040 | // phpcs:enable |
  | 1038 | 1041 | $post\_ids = get\_posts( $post\_args ); |
  | 1039 | 1042 | } |
  | 1040 | 1043 | $custom\_post\_ids = array(); |
  | 1041 | 1044 | if ( ! empty( $custom\_post\_type ) ) { |
  |  | 1045 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1042 | 1046 | $custom\_post\_args = array( |
  | 1043 | 1047 | 'post\_type'      => $custom\_post\_type, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1045) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1049) |  |
  | 1045 | 1049 | 'orderby'        => 'date', |
  | 1046 | 1050 | 'order'          => 'DESC', |
  | 1047 |  | 'meta\_query'     => array( |
  |  | 1051 | 'meta\_query'     => array( |
  | 1048 | 1052 | array( |
  | 1049 | 1053 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1058) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1062) |  |
  | 1058 | 1062 | ); |
  | 1059 | 1063 | } |
  |  | 1064 | // phpcs:enable |
  | 1060 | 1065 | $custom\_post\_ids = get\_posts( $custom\_post\_args ); |
  | 1061 | 1066 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1141) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1146) |  |
  | 1141 | 1146 | $meta\_key = 'ig\_es\_post\_notified\_' . $campaign\_id; |
  | 1142 | 1147 | if ( ( ! empty( $categories ) || $include\_all\_post ) && ! $include\_no\_post ) { |
  |  | 1148 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1143 | 1149 | $post\_args =  array( |
  | 1144 | 1150 | 'post\_type'      => 'post', |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1147) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1153) |  |
  | 1147 | 1153 | 'order'          => 'DESC', |
  | 1148 | 1154 | 'cat'            => ( ! $include\_all\_post ) ? implode( ',', $categories ) : '', |
  | 1149 |  | 'meta\_query'     => array( |
  |  | 1155 | 'meta\_query'     => array( |
  | 1150 | 1156 | array( |
  | 1151 | 1157 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1161) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1167) |  |
  | 1161 | 1167 | ); |
  | 1162 | 1168 | } |
  |  | 1169 | // phpcs:enable |
  | 1163 | 1170 | $post\_ids = get\_posts( $post\_args ); |
  | 1164 | 1171 | } |
  | 1165 | 1172 | $custom\_post\_ids = array(); |
  | 1166 | 1173 | if ( ! empty( $custom\_post\_type ) ) { |
  |  | 1174 | //phpcs:disable WordPress.DB.SlowDBQuery.slow\_db\_query\_meta\_query |
  | 1167 | 1175 | $custom\_post\_args = array( |
  | 1168 | 1176 | 'post\_type'      => $custom\_post\_type, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1170) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1178) |  |
  | 1170 | 1178 | 'orderby'        => 'date', |
  | 1171 | 1179 | 'order'          => 'DESC', |
  | 1172 |  | 'meta\_query'     => array( |
  |  | 1180 | 'meta\_query'     => array( |
  | 1173 | 1181 | array( |
  | 1174 | 1182 | 'key'     => $meta\_key, |
  | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3069441#L1177) | […](/browser/email-subscribers/trunk/lite/includes/controllers/class-es-campaign-controller.php?rev=3072302#L1185) |  |
  | 1177 | 1185 | ), |
  | 1178 | 1186 | ); |
  |  | 1187 | // phpcs:enable |
  | 1179 | 1188 | $custom\_post\_ids  = get\_posts( $custom\_post\_args ); |
  | 1180 | 1189 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-actions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-actions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-actions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L417 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L417 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 417 | 417 | $days                   = esc\_sql( $days ); |
  | 418 | 418 | $args[]                 = $days; |
  |  | 419 | // phpcs:disable |
  | 419 | 420 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 420 | 421 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L423) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L424) |  |
  | 423 | 424 | ) |
  | 424 | 425 | ); |
  | 425 |  | } else { |
  |  | 426 | // phpcs:enable |
  |  | 427 | } else { |
  |  | 428 | // phpcs:disable |
  | 426 | 429 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 427 | 430 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L430) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L433) |  |
  | 430 | 433 | ) |
  | 431 | 434 | ); |
  |  | 435 | // phpcs:enable |
  | 432 | 436 | } |
  | 433 | 437 | } else { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L435) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L439) |  |
  | 435 | 439 | $days                   = esc\_sql( $days ); |
  | 436 | 440 | $args[]                 = $days; |
  |  | 441 | // phpcs:disable |
  | 437 | 442 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 438 | 443 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L441) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L446) |  |
  | 441 | 446 | ) |
  | 442 | 447 | ); |
  | 443 |  | } else { |
  |  | 448 | // phpcs:enable |
  |  | 449 | } else { |
  |  | 450 | // phpcs:disable |
  | 444 | 451 | $total\_contacts\_clicked = $wpdb->get\_var( |
  | 445 | 452 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L448) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L455) |  |
  | 448 | 455 | ) |
  | 449 | 456 | ); |
  |  | 457 | // phpcs:enable |
  | 450 | 458 | } |
  | 451 | 459 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L469) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L477) |  |
  | 469 | 477 |  |
  | 470 | 478 | $total\_emails\_unsubscribed = 0; |
  |  | 479 | // phpcs:disable |
  | 471 | 480 | if ( $distinct ) { |
  | 472 | 481 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L506) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L515) |  |
  | 506 | 515 | } |
  | 507 | 516 | } |
  | 508 |  |  |
  |  | 517 | // phpcs:enable |
  | 509 | 518 | return $total\_emails\_unsubscribed; |
  | 510 | 519 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L529) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L538) |  |
  | 529 | 538 |  |
  | 530 | 539 | $total\_emails\_opened = 0; |
  |  | 540 | // phpcs:disable |
  | 531 | 541 | if ( $distinct ) { |
  | 532 | 542 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L566) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L576) |  |
  | 566 | 576 | } |
  | 567 | 577 | } |
  | 568 |  |  |
  |  | 578 | // phpcs:enable |
  | 569 | 579 | return $total\_emails\_opened; |
  | 570 | 580 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L587) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L597) |  |
  | 587 | 597 |  |
  | 588 | 598 | $total\_emails\_sent = 0; |
  |  | 599 | // phpcs:disable |
  | 589 | 600 | if ( $distinct ) { |
  | 590 | 601 | if ( 0 != $days ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L624) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L635) |  |
  | 624 | 635 | } |
  | 625 | 636 | } |
  | 626 |  |  |
  |  | 637 | // phpcs:enable |
  | 627 | 638 | return $total\_emails\_sent; |
  | 628 | 639 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L645) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L656) |  |
  | 645 | 656 |  |
  | 646 | 657 | $count = 0; |
  |  | 658 | // phpcs:disable |
  | 647 | 659 | if ( $distinct ) { |
  | 648 | 660 | $query = $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L656) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L668) |  |
  | 656 | 668 | ); |
  | 657 | 669 | } |
  | 658 |  |  |
  |  | 670 | // phpcs:enable |
  | 659 | 671 | $cache\_key       = ES\_Cache::generate\_key( $query ); |
  | 660 | 672 | $exists\_in\_cache = ES\_Cache::is\_exists( $cache\_key, 'query' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L689) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L701) |  |
  | 689 | 701 |  |
  | 690 | 702 | $contact\_ids\_str = implode( ',', $contact\_ids ); |
  | 691 |  |  |
  |  | 703 | // phpcs:disable |
  | 692 | 704 | $result = $wpbd->get\_results( $wpbd->prepare( "SELECT contact\_id, MAX(created\_at) as last\_opened\_at FROM {$wpbd->prefix}ig\_actions WHERE contact\_id IN ({$contact\_ids\_str}) AND type = %d  GROUP BY contact\_id", IG\_MESSAGE\_OPEN ), ARRAY\_A ); |
  | 693 |  |  |
  |  | 705 | // phpcs:enable |
  | 694 | 706 | if ( $filter ) { |
  | 695 | 707 | $last\_opened\_at = array\_column( $result, 'last\_opened\_at', 'contact\_id' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L710) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L722) |  |
  | 710 | 722 | $mailing\_queue\_ids = esc\_sql( $mailing\_queue\_ids ); |
  | 711 | 723 | $mailing\_queue\_ids = implode( ',', array\_map( 'absint', $mailing\_queue\_ids ) ); |
  | 712 |  |  |
  |  | 724 | // phpcs:disable |
  | 713 | 725 | $wpbd->query( |
  | 714 | 726 | "DELETE FROM {$wpbd->prefix}ig\_actions WHERE message\_id IN ($mailing\_queue\_ids)" |
  | 715 | 727 | ); |
  |  | 728 | // phpcs:enable |
  | 716 | 729 | } |
  | 717 | 730 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L721) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L734) |  |
  | 721 | 734 | $result = array(); |
  | 722 | 735 | if (!empty($campaign\_id) && !empty($link\_id) && is\_numeric($campaign\_id) && is\_numeric($link\_id)) { |
  |  | 736 | // phpcs:disable |
  | 723 | 737 | $result = $wpdb->get\_results($wpdb->prepare( |
  | 724 | 738 | "SELECT c.email,c.first\_name,c.last\_name |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3051406#L729) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-actions.php?rev=3072302#L743) |  |
  | 729 | 743 | $link\_id |
  | 730 | 744 | ), ARRAY\_A); |
  |  | 745 | // phpcs:enable |
  | 731 | 746 | } |
  | 732 | 747 | return $result; |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-campaigns.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L285 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L285 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 285 | 285 | $from\_name  = ES\_Common::get\_ig\_option( 'from\_name' ); |
  | 286 | 286 | $from\_email = ES\_Common::get\_ig\_option( 'from\_email' ); |
  | 287 |  |  |
  |  | 287 | // phpcs:disable |
  | 288 | 288 | $total = $wpdb->get\_var( $wpdb->prepare( "SELECT count(\*) as total FROM {$wpdb->prefix}es\_sentdetails WHERE es\_sent\_source = %s", 'Newsletter' ) ); |
  | 289 |  |  |
  |  | 289 | // phpcs:enable |
  | 290 | 290 | if ( $total > 0 ) { |
  | 291 | 291 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L301) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L301) |  |
  | 301 | 301 | for ( $i = 0; $i <= $total\_batches; $i ++ ) { |
  | 302 | 302 | $batch\_start = $i \* $batch\_size; |
  | 303 |  |  |
  |  | 303 | // phpcs:disable |
  | 304 | 304 | $newsletters = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}es\_sentdetails WHERE es\_sent\_source = %s LIMIT %d, %d", 'Newsletter', $batch\_start, $batch\_size ), ARRAY\_A ); |
  | 305 |  |  |
  |  | 305 | // phpcs:enable |
  | 306 | 306 | if ( count( $newsletters ) > 0 ) { |
  | 307 | 307 | $campaign\_data = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L345) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L345) |  |
  | 345 | 345 | public function update\_campaign\_id\_in\_mailing\_queue() { |
  | 346 | 346 | global $wpdb; |
  | 347 |  |  |
  |  | 347 | // phpcs:disable |
  | 348 | 348 | $campaigns = $wpdb->get\_results( $wpdb->prepare( "SELECT id, name FROM {$wpdb->prefix}ig\_campaigns WHERE %d", 1 ), ARRAY\_A ); |
  | 349 |  |  |
  |  | 349 | // phpcs:enable |
  | 350 | 350 | $data\_to\_update = array(); |
  | 351 | 351 | if ( count( $campaigns ) > 0 ) { |
  |  | 352 | // phpcs:disable |
  | 352 | 353 | $mailing\_queue\_results = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}ig\_mailing\_queue WHERE %d", 1 ), ARRAY\_A ); |
  |  | 354 | // phpcs:enable |
  | 353 | 355 | if ( count( $mailing\_queue\_results ) > 0 ) { |
  | 354 | 356 | foreach ( $mailing\_queue\_results as $result ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L367) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L369) |  |
  | 367 | 369 | if ( ! empty( $data\_to\_update ) ) { |
  | 368 | 370 | foreach ( $data\_to\_update as $mailing\_queue\_id => $campaign\_id ) { |
  |  | 371 | // phpcs:disable |
  | 369 | 372 | $wpdb->query( $wpdb->prepare( "UPDATE {$wpdb->prefix}ig\_mailing\_queue SET campaign\_id = %d WHERE id = %d", array( $campaign\_id, $mailing\_queue\_id ) ) ); |
  |  | 373 | // phpcs:enable |
  | 370 | 374 | } |
  | 371 | 375 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L517) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L521) |  |
  | 517 | 521 | return array(); |
  | 518 | 522 | } |
  | 519 |  |  |
  |  | 523 | // phpcs:disable |
  | 520 | 524 | $where = $wpdb->prepare( "parent\_id = %d AND status = %d AND ( deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00' )", $id, self::STATUS\_ACTIVE ); |
  | 521 |  |  |
  |  | 525 | // phpcs:enable |
  | 522 | 526 | $campaigns = $this->get\_by\_conditions( $where ); |
  | 523 | 527 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L539) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L543) |  |
  | 539 | 543 | $posts\_type\_count       = count( $post\_types['postsType'] ); |
  | 540 | 544 | $post\_type\_placeholders = array\_fill( 0, $posts\_type\_count, '%s' ); |
  |  | 545 | // phpcs:disable |
  | 541 | 546 | $query                  = $wpbd->prepare( |
  | 542 | 547 | "SELECT ID, post\_title, post\_content FROM {$wpbd->posts} WHERE post\_type IN (" . implode( ',', $post\_type\_placeholders ) . ')', |
  | 543 | 548 | $post\_types['postsType'] |
  | 544 | 549 | ); |
  |  | 550 | // phpcs:enable |
  | 545 | 551 | $posts                  = $wpbd->get\_results( $query, ARRAY\_A ); |
  | 546 | 552 | return $posts; |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L558) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L564) |  |
  | 558 | 564 | public function get\_active\_campaigns( $type = '' ) { |
  | 559 | 565 | global $wpdb; |
  | 560 |  |  |
  |  | 566 | // phpcs:disable |
  | 561 | 567 | if ( empty( $type ) ) { |
  | 562 | 568 | $where = $wpdb->prepare( "status = %d AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", self::STATUS\_ACTIVE ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L564) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L570) |  |
  | 564 | 570 | $where = $wpdb->prepare( "status = %d AND type = %s AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", self::STATUS\_ACTIVE, $type ); |
  | 565 | 571 | } |
  | 566 |  |  |
  |  | 572 | // phpcs:enable |
  | 567 | 573 | return $this->get\_by\_conditions( $where ); |
  | 568 | 574 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3051406#L672) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-campaigns.php?rev=3072302#L678) |  |
  | 672 | 678 | if ( $post\_id > 0 ) { |
  | 673 | 679 | $post\_type = get\_post\_type( $post\_id ); |
  | 674 |  |  |
  |  | 680 | // phpcs:disable |
  | 675 | 681 | $where = $wpdb->prepare( "status = %d AND type = %s AND (deleted\_at IS NULL OR deleted\_at = '0000-00-00 00:00:00')", 1, 'post\_notification' ); |
  | 676 |  |  |
  |  | 682 | // phpcs:enable |
  | 677 | 683 | $new\_flow\_campaign\_ids = get\_option( 'ig\_es\_new\_category\_format\_campaign\_ids', array() ); |
  | 678 | 684 | // Run old logic for campaign |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-contacts.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L437 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L437 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 437 | 437 |  |
  | 438 | 438 | if ( ! empty( $list\_id ) ) { |
  |  | 439 | // phpcs:disable |
  | 439 | 440 | $subscribers = $wpdb->get\_var( |
  | 440 | 441 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L444) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L445) |  |
  | 444 | 445 | ) |
  | 445 | 446 | ); |
  |  | 447 | // phpcs:enable |
  | 446 | 448 | } else { |
  |  | 449 | // phpcs:disable |
  | 447 | 450 | $subscribers = $wpdb->get\_var( |
  | 448 | 451 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L451) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L454) |  |
  | 451 | 454 | ) |
  | 452 | 455 | ); |
  |  | 456 | // phpcs:enable |
  | 453 | 457 | } |
  | 454 | 458 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L462) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L466) |  |
  | 462 | 466 | public function get\_all\_contact\_ids() { |
  | 463 | 467 | global $wpbd; |
  | 464 |  |  |
  |  | 468 | // phpcs:disable |
  | 465 | 469 | $query = "SELECT id FROM $this->table\_name"; |
  |  | 470 | // phpcs:enable |
  | 466 | 471 | return $wpbd->get\_results( $query ); |
  | 467 | 472 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L585) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L590) |  |
  | 585 | 590 | public function get\_email\_details\_map() { |
  | 586 | 591 | global $wpdb; |
  | 587 |  |  |
  |  | 592 | // phpcs:disable |
  | 588 | 593 | $contacts = $wpdb->get\_results( |
  | 589 | 594 | "SELECT id, email, hash FROM {$wpdb->prefix}ig\_contacts", |
  | 590 | 595 | ARRAY\_A |
  | 591 | 596 | ); |
  |  | 597 | // phpcs:enable |
  | 592 | 598 | $details  = array(); |
  | 593 | 599 | if ( count( $contacts ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L726) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L732) |  |
  | 726 | 732 |  |
  | 727 | 733 | // Get Total count of subscribers |
  |  | 734 | // phpcs:disable |
  | 728 | 735 | $total = $wpdb->get\_var( "SELECT count(\*) as total FROM {$wpdb->prefix}es\_emaillist" ); |
  | 729 |  |  |
  |  | 736 | // phpcs:enable |
  | 730 | 737 | // If we have subscribers? |
  | 731 | 738 | if ( $total > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L745) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L752) |  |
  | 745 | 752 | for ( $i = 0; $i < $total\_batches; $i ++ ) { |
  | 746 | 753 | $batch\_start = $i \* $batch\_size; |
  |  | 754 | // phpcs:disable |
  | 747 | 755 | $results     = $wpdb->get\_results( |
  | 748 | 756 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L753) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L761) |  |
  | 753 | 761 | ARRAY\_A |
  | 754 | 762 | ); |
  |  | 763 | // phpcs:enable |
  | 755 | 764 | if ( count( $results ) > 0 ) { |
  | 756 | 765 | $contacts = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1027) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1036) |  |
  | 1027 | 1036 |  |
  | 1028 | 1037 | if ( ! empty( $form\_id ) ) { |
  |  | 1038 | // phpcs:disable |
  | 1029 | 1039 | $total\_subscribers = $wpdb->get\_var( |
  | 1030 | 1040 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1034) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1044) |  |
  | 1034 | 1044 | ) |
  | 1035 | 1045 | ); |
  |  | 1046 | // phpcs:enable |
  | 1036 | 1047 | } |
  | 1037 | 1048 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1049) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1060) |  |
  | 1049 | 1060 |  |
  | 1050 | 1061 | // Get Total count of subscribers |
  |  | 1062 | // phpcs:disable |
  | 1051 | 1063 | $total = $wpdb->get\_var( "SELECT count(\*) as total FROM {$wpdb->prefix}ig\_contacts" ); |
  | 1052 |  |  |
  |  | 1064 | // phpcs:enable |
  | 1053 | 1065 | // If we have subscribers? |
  | 1054 | 1066 | if ( $total > 0 ) { |
  | 1055 |  |  |
  |  | 1067 | // phpcs:disable |
  | 1056 | 1068 | $wpdb->query( |
  | 1057 | 1069 | "UPDATE {$wpdb->prefix}ig\_contacts AS contact\_data |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1063) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1075) |  |
  | 1063 | 1075 | AND list\_data.subscribed\_ip <> ''" |
  | 1064 | 1076 | ); |
  |  | 1077 | // phpcs:enable |
  | 1065 | 1078 | } |
  | 1066 | 1079 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3051406#L1168) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-contacts.php?rev=3072302#L1181) |  |
  | 1168 | 1181 | public function get\_last\_contact\_id() { |
  | 1169 | 1182 | global $wpdb; |
  |  | 1183 | // phpcs:disable |
  | 1170 | 1184 | $last\_contact\_id = $wpdb->get\_var( "SELECT id FROM {$wpdb->prefix}ig\_contacts ORDER BY id DESC LIMIT 0, 1" ); |
  |  | 1185 | // phpcs:enable |
  | 1171 | 1186 | return $last\_contact\_id; |
  | 1172 | 1187 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-forms.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-forms.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-forms.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3051406#L103 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302#L103 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 103 | 103 |  |
  | 104 | 104 | global $wpdb; |
  | 105 |  |  |
  |  | 105 | // phpcs:disable |
  | 106 | 106 | $results = $wpdb->get\_results( "SELECT id, name FROM {$wpdb->prefix}ig\_forms", ARRAY\_A ); |
  | 107 |  |  |
  |  | 107 | // phpcs:enable |
  | 108 | 108 | $id\_name\_map = array(); |
  | 109 | 109 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3051406#L206) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-forms.php?rev=3072302#L206) |  |
  | 206 | 206 | public function migrate\_advanced\_forms() { |
  | 207 | 207 | global $wpdb; |
  | 208 |  |  |
  |  | 208 | // phpcs:disable |
  | 209 | 209 | $is\_table\_exists = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $wpdb->prefix . 'es\_advanced\_form' ) ) === $wpdb->prefix . 'es\_advanced\_form'; |
  | 210 |  |  |
  |  | 210 | // phpcs:enable |
  | 211 | 211 | $lists\_name\_id\_map = ES()->lists\_db->get\_list\_id\_name\_map( '', true ); |
  | 212 | 212 |  |
  | 213 | 213 | if ( $is\_table\_exists ) { |
  |  | 214 | // phpcs:disable |
  | 214 | 215 | $forms = $wpdb->get\_results( |
  | 215 | 216 | "SELECT \* FROM {$wpdb->prefix}es\_advanced\_form", |
  | 216 | 217 | ARRAY\_A |
  | 217 | 218 | ); |
  | 218 |  |  |
  |  | 219 | // phpcs:enable |
  | 219 | 220 | if ( count( $forms ) > 0 ) { |
  | 220 | 221 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-lists.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?old=2644473&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-lists.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-lists.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=2644473#L236 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302#L236 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 236 | 236 | public function get\_all\_lists\_name\_by\_contact( $id ) { |
  | 237 | 237 | global $wpdb; |
  | 238 |  |  |
  |  | 238 | // phpcs:disable |
  | 239 | 239 | $res = $wpdb->get\_col( |
  | 240 | 240 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=2644473#L243) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-lists.php?rev=3072302#L243) |  |
  | 243 | 243 | ) |
  | 244 | 244 | ); |
  |  | 245 | // phpcs:enable |
  | 245 | 246 |  |
  | 246 | 247 | return $res; |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?old=2937457&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-mailing-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L54 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L54 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 54 | 54 | public static function get\_notification\_hash\_to\_be\_sent() { |
  | 55 | 55 | global $wpdb; |
  | 56 |  |  |
  |  | 56 | // phpcs:disable |
  | 57 | 57 | $hash = $wpdb->get\_var( |
  | 58 | 58 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L61) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L61) |  |
  | 61 | 61 | ) |
  | 62 | 62 | ); |
  | 63 |  |  |
  |  | 63 | // phpcs:enable |
  | 64 | 64 | // TODO :: update start date |
  | 65 | 65 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L77) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L77) |  |
  | 77 | 77 | $results = array(); |
  | 78 | 78 | if ( ! empty( $campaign\_hash ) ) { |
  |  | 79 | // phpcs:disable |
  | 79 | 80 | $results = $wpdb->get\_results( |
  | 80 | 81 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L84) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L85) |  |
  | 84 | 85 | ARRAY\_A |
  | 85 | 86 | ); |
  |  | 87 | // phpcs:enable |
  | 86 | 88 | } else { |
  | 87 | 89 | $current\_time = ig\_get\_current\_date\_time(); |
  | 88 |  |  |
  |  | 90 | // phpcs:disable |
  | 89 | 91 | $results      = $wpdb->get\_results( |
  | 90 | 92 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L99) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L101) |  |
  | 99 | 101 | ARRAY\_A |
  | 100 | 102 | ); |
  |  | 103 | // phpcs:enable |
  | 101 | 104 | } |
  | 102 | 105 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L142) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L145) |  |
  | 142 | 145 | $notification['subject'] = ! empty( $content['subject'] ) ? $content['subject'] : $notification['subject']; |
  | 143 | 146 | $notification['body']    = ! empty( $content['body'] ) ? $content['body'] : $notification['body']; |
  | 144 |  |  |
  |  | 147 | // phpcs:disable |
  | 145 | 148 | $wpdb->query( |
  | 146 | 149 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L153) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L156) |  |
  | 153 | 156 | ) |
  | 154 | 157 | ); |
  |  | 158 | // phpcs:enable |
  | 155 | 159 | } |
  | 156 | 160 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L166) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L170) |  |
  | 166 | 170 |  |
  | 167 | 171 | // If status is sent then add finish\_at time as well. |
  |  | 172 | // phpcs:disable |
  | 168 | 173 | if ( 'Sent' === $status ) { |
  | 169 | 174 | $current\_date\_time = ig\_get\_current\_date\_time(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L195) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L200) |  |
  | 195 | 200 | ); |
  | 196 | 201 | } |
  | 197 |  |  |
  |  | 202 | // phpcs:enable |
  | 198 | 203 | return $return\_id; |
  | 199 | 204 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L202) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L207) |  |
  | 202 | 207 | public static function get\_sent\_email\_count( $notification\_hash ) { |
  | 203 | 208 | global $wpdb; |
  |  | 209 | // phpcs:disable |
  | 204 | 210 | $email\_count = $wpdb->get\_col( |
  | 205 | 211 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L208) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L214) |  |
  | 208 | 214 | ) |
  | 209 | 215 | ); |
  |  | 216 | // phpcs:enable |
  | 210 | 217 | $email\_count = array\_shift( $email\_count ); |
  | 211 | 218 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L217) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L224) |  |
  | 217 | 224 |  |
  | 218 | 225 | $notification = array(); |
  |  | 226 | // phpcs:disable |
  | 219 | 227 | $query        = $wpbd->prepare( |
  | 220 | 228 | "SELECT \* FROM {$wpbd->prefix}ig\_mailing\_queue WHERE hash = %s", |
  | 221 | 229 | $notification\_hash |
  | 222 | 230 | ); |
  | 223 |  |  |
  |  | 231 | // phpcs:enable |
  | 224 | 232 | $cache\_key       = ES\_Cache::generate\_key( $query ); |
  | 225 | 233 | $exists\_in\_cache = ES\_Cache::is\_exists( $cache\_key, 'query' ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L271) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L279) |  |
  | 271 | 279 | if ( ! empty( $per\_page ) && ! empty( $page\_number ) ) { |
  | 272 | 280 | $start\_limit = ( $page\_number - 1 ) \* $per\_page; |
  |  | 281 | // phpcs:disable |
  | 273 | 282 | $result      = $wpdb->get\_results( |
  | 274 | 283 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L287) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L296) |  |
  | 287 | 296 | ); |
  | 288 | 297 | } |
  | 289 |  |  |
  |  | 298 | // phpcs:enable |
  | 290 | 299 | return $result; |
  | 291 | 300 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L293) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L302) |  |
  | 293 | 302 | public static function get\_notifications\_count() { |
  | 294 | 303 | global $wpdb; |
  | 295 |  |  |
  |  | 304 | // phpcs:disable |
  | 296 | 305 | $result = $wpdb->get\_col( |
  | 297 | 306 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L300) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L309) |  |
  | 300 | 309 | ) |
  | 301 | 310 | ); |
  | 302 |  |  |
  |  | 311 | // phpcs:enable |
  | 303 | 312 | return $result[0]; |
  | 304 | 313 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L315) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L324) |  |
  | 315 | 324 |  |
  | 316 | 325 | // Delete notification. |
  |  | 326 | // phpcs:disable |
  | 317 | 327 | $wpbd->query( |
  | 318 | 328 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L321) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L331) |  |
  | 321 | 331 | ) |
  | 322 | 332 | ); |
  |  | 333 | // phpcs:enable |
  | 323 | 334 | } |
  | 324 | 335 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L336) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L347) |  |
  | 336 | 347 |  |
  | 337 | 348 | // Update related broadcast campaign status to draft. |
  |  | 349 | // phpcs:disable |
  | 338 | 350 | $wpbd->query( |
  | 339 | 351 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L345) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L357) |  |
  | 345 | 357 | ) |
  | 346 | 358 | ); |
  |  | 359 |  |
  | 347 | 360 |  |
  | 348 | 361 | // Delete notification. |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L353) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L366) |  |
  | 353 | 366 | ) |
  | 354 | 367 | ); |
  |  | 368 | // phpcs:enable |
  | 355 | 369 | } |
  | 356 | 370 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L364) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L378) |  |
  | 364 | 378 | $data           = $prepared\_data['data']; |
  | 365 | 379 | $column\_formats = $prepared\_data['column\_formats']; |
  | 366 |  |  |
  |  | 380 | // phpcs:disable |
  | 367 | 381 | $inserted = $wpdb->insert( IG\_MAILING\_QUEUE\_TABLE, $data, $column\_formats ); |
  | 368 |  |  |
  |  | 382 | // phpcs:enable |
  | 369 | 383 | $last\_report\_id = 0; |
  | 370 | 384 | if ( $inserted ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L384) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L398) |  |
  | 384 | 398 | $data           = $prepared\_data['data']; |
  | 385 | 399 | $column\_formats = $prepared\_data['column\_formats']; |
  | 386 |  |  |
  |  | 400 | // phpcs:disable |
  | 387 | 401 | $wpdb->update( IG\_MAILING\_QUEUE\_TABLE, $data, array( 'id' => $notification\_id ), $column\_formats ); |
  | 388 |  |  |
  |  | 402 | // phpcs:enable |
  | 389 | 403 | } |
  | 390 | 404 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L392) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L406) |  |
  | 392 | 406 | global $wpdb; |
  | 393 | 407 |  |
  |  | 408 | // phpcs:disable |
  | 394 | 409 | $query   = 'SELECT id, start\_at, hash FROM ' . IG\_MAILING\_QUEUE\_TABLE; |
  | 395 | 410 | $results = $wpdb->get\_results( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L400) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L415) |  |
  | 400 | 415 | ARRAY\_A |
  | 401 | 416 | ); |
  |  | 417 | // phpcs:enable |
  | 402 | 418 | $details = array(); |
  | 403 | 419 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L415) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L431) |  |
  | 415 | 431 |  |
  | 416 | 432 | $report  = array(); |
  |  | 433 | // phpcs:disable |
  | 417 | 434 | $results = $wpdb->get\_results( |
  | 418 | 435 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L422) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L439) |  |
  | 422 | 439 | ARRAY\_A |
  | 423 | 440 | ); |
  | 424 |  |  |
  |  | 441 | // phpcs:enable |
  | 425 | 442 | if ( count( $results ) > 0 ) { |
  | 426 | 443 | $report = array\_shift( $results ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L445) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L462) |  |
  | 445 | 462 | $count = 5; |
  | 446 | 463 | } |
  | 447 |  |  |
  |  | 464 | // phpcs:disable |
  | 448 | 465 | return $wpdb->get\_results( |
  | 449 | 466 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L453) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L470) |  |
  | 453 | 470 | ARRAY\_A |
  | 454 | 471 | ); |
  |  | 472 | // phpcs:enable |
  | 455 | 473 | } |
  | 456 | 474 |  |
  | 457 | 475 | public static function do\_insert( $place\_holders, $values ) { |
  | 458 | 476 | global $wpdb, $wpbd; |
  | 459 |  |  |
  |  | 477 | // phpcs:disable |
  | 460 | 478 | $query  = "INSERT INTO {$wpdb->prefix}ig\_mailing\_queue (`hash`, `campaign\_id`, `subject`, `body`, `count`, `status`, `start\_at`, `finish\_at`, `created\_at`, `updated\_at`) VALUES "; |
  |  | 479 | // phpcs:enable |
  | 461 | 480 | $query .= implode( ', ', $place\_holders ); |
  | 462 | 481 | $sql    = $wpbd->prepare( $query, $values ); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L475) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L494) |  |
  | 475 | 494 | public static function migrate\_notifications() { |
  | 476 | 495 | global $wpdb; |
  | 477 |  |  |
  |  | 496 | // phpcs:disable |
  | 478 | 497 | $total = $wpdb->get\_var( |
  | 479 | 498 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L482) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L501) |  |
  | 482 | 501 | ) |
  | 483 | 502 | ); |
  | 484 |  |  |
  |  | 503 | // phpcs:enable |
  | 485 | 504 | if ( $total > 0 ) { |
  | 486 | 505 | $columns = self::get\_columns(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L493) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L512) |  |
  | 493 | 512 | for ( $i = 0; $i < $total\_bataches; $i ++ ) { |
  | 494 | 513 | $batch\_start = $i \* $batch\_size; |
  | 495 |  |  |
  |  | 514 | // phpcs:disable |
  | 496 | 515 | $results = $wpdb->get\_results( |
  | 497 | 516 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L502) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L521) |  |
  | 502 | 521 | ARRAY\_A |
  | 503 | 522 | ); |
  | 504 |  |  |
  |  | 523 | // phpcs:enable |
  | 505 | 524 | $values        = array(); |
  | 506 | 525 | $place\_holders = array(); |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L571) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L590) |  |
  | 571 | 590 | $data\_keys      = array\_keys( $data ); |
  | 572 | 591 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 573 |  |  |
  |  | 592 | // phpcs:disable |
  | 574 | 593 | if ( false === $wpdb->update( self::$table\_name, $data, array( $where => $mailing\_queue\_id ), $column\_formats ) ) { |
  | 575 | 594 | return false; |
  | 576 | 595 | } |
  | 577 |  |  |
  |  | 596 | // phpcs:enable |
  | 578 | 597 | return true; |
  | 579 | 598 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L594) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L613) |  |
  | 594 | 613 | return; |
  | 595 | 614 | } |
  | 596 |  |  |
  |  | 615 | // phpcs:disable |
  | 597 | 616 | $wpdb->query( |
  | 598 | 617 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=2937457#L602) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-mailing-queue.php?rev=3072302#L621) |  |
  | 602 | 621 | ) |
  | 603 | 622 | ); |
  |  | 623 | // phpcs:enable |
  | 604 | 624 | } |
  | 605 | 625 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-notifications.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L27 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L27 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | public static function migrate\_post\_notification\_es\_template\_type() { |
  | 28 | 28 | global $wpdb; |
  | 29 |  |  |
  |  | 29 | // phpcs:disable |
  | 30 | 30 | $update = $wpdb->query( |
  | 31 | 31 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L34) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L34) |  |
  | 34 | 34 | ) |
  | 35 | 35 | ); |
  | 36 |  |  |
  |  | 36 | // phpcs:enable |
  | 37 | 37 | return $update; |
  | 38 | 38 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L47) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L47) |  |
  | 47 | 47 | public static function migrate\_newsletter\_es\_template\_type() { |
  | 48 | 48 | global $wpdb; |
  | 49 |  |  |
  |  | 49 | // phpcs:disable |
  | 50 | 50 | $update = $wpdb->query( |
  | 51 | 51 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=2602749#L54) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-notifications.php?rev=3072302#L54) |  |
  | 54 | 54 | ) |
  | 55 | 55 | ); |
  | 56 |  |  |
  |  | 56 | // phpcs:enable |
  | 57 | 57 | return $update; |
  | 58 | 58 | } |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?old=2602749&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=2602749#L62 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302#L62 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 62 | 62 | public function delete\_from\_queue( $campaign\_id, $contact\_id ) { |
  | 63 | 63 | global $wpdb; |
  | 64 |  |  |
  |  | 64 | // phpcs:disable |
  | 65 | 65 | return $wpdb->query( |
  | 66 | 66 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=2602749#L70) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-queue.php?rev=3072302#L70) |  |
  | 70 | 70 | ) |
  | 71 | 71 | ); |
  |  | 72 | // phpcs:enable |
  | 72 | 73 | } |
  | 73 | 74 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?old=2995564&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db-sending-queue.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L85 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L85 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 | public static function get\_queued\_emails( $contact\_id ) { |
  | 86 | 86 | global $wpdb; |
  | 87 |  |  |
  |  | 87 | // phpcs:disable |
  | 88 | 88 | $queued\_emails = $wpdb->get\_results( |
  | 89 | 89 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L94) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L94) |  |
  | 94 | 94 | ARRAY\_A |
  | 95 | 95 | ); |
  | 96 |  |  |
  |  | 96 | // phpcs:enable |
  | 97 | 97 | return $queued\_emails; |
  | 98 | 98 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L179) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L179) |  |
  | 179 | 179 |  |
  | 180 | 180 | global $wpdb; |
  | 181 |  |  |
  |  | 181 | // phpcs:disable |
  | 182 | 182 | $result = $wpdb->get\_var( |
  | 183 | 183 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L196) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L196) |  |
  | 196 | 196 | ) |
  | 197 | 197 | ); |
  | 198 |  |  |
  |  | 198 | // phpcs:enable |
  | 199 | 199 | return $result; |
  | 200 | 200 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L208) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L208) |  |
  | 208 | 208 | if ( '' != $notification\_hash ) { |
  | 209 | 209 | $sent\_status = IG\_ES\_SENDING\_QUEUE\_STATUS\_SENT; |
  |  | 210 | // phpcs:disable |
  | 210 | 211 | $result = $wpdb->get\_var( |
  | 211 | 212 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L214) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L215) |  |
  | 214 | 215 | ) |
  | 215 | 216 | ); |
  |  | 217 | // phpcs:enable |
  | 216 | 218 | } |
  | 217 | 219 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L225) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L227) |  |
  | 225 | 227 | $emails = array(); |
  | 226 | 228 | if ( '' != $notification\_hash ) { |
  |  | 229 | // phpcs:disable |
  | 227 | 230 | $emails = $wpdb->get\_results( |
  | 228 | 231 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L232) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L235) |  |
  | 232 | 235 | ARRAY\_A |
  | 233 | 236 | ); |
  | 234 |  |  |
  |  | 237 | // phpcs:enable |
  | 235 | 238 | // We are not migrating reports data because it caused lots of migration issues |
  | 236 | 239 | // in the past. So, we are fetching reports data from older table if we don't get |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L238) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L241) |  |
  | 238 | 241 | // This is generally fetch the data for older campaigns |
  | 239 | 242 | if ( count( $emails ) == 0 ) { |
  |  | 243 | // phpcs:disable |
  | 240 | 244 | $result = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s ', $wpdb->prefix . 'es\_deliverreport' ) ); |
  |  | 245 | // phpcs:enable |
  | 241 | 246 | if ( $result === $wpdb->prefix . 'es\_deliverreport' ) { |
  |  | 247 | // phpcs:disable |
  | 242 | 248 | $emails = $wpdb->get\_results( |
  | 243 | 249 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L247) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L253) |  |
  | 247 | 253 | ARRAY\_A |
  | 248 | 254 | ); |
  |  | 255 | // phpcs:enable |
  | 249 | 256 | } |
  | 250 | 257 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L536) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L543) |  |
  | 536 | 543 |  |
  | 537 | 544 | $current\_date = ig\_get\_current\_date\_time(); |
  | 538 |  |  |
  |  | 545 | // phpcs:disable |
  | 539 | 546 | return $wpdb->query( |
  | 540 | 547 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L547) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L554) |  |
  | 547 | 554 | ) |
  | 548 | 555 | ); |
  |  | 556 | // phpcs:enable |
  | 549 | 557 | } |
  | 550 | 558 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L756) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L764) |  |
  | 756 | 764 |  |
  | 757 | 765 | if ( '' !== $hash ) { |
  |  | 766 | // phpcs:disable |
  | 758 | 767 | $result = $wpdb->get\_var( |
  | 759 | 768 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L762) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L771) |  |
  | 762 | 771 | ) |
  | 763 | 772 | ); |
  |  | 773 | // phpcs:enable |
  | 764 | 774 |  |
  | 765 | 775 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L774) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L784) |  |
  | 774 | 784 |  |
  | 775 | 785 | $result = 0; |
  | 776 |  |  |
  |  | 786 | // phpcs:disable |
  | 777 | 787 | if ( '' != $hash ) { |
  |  | 788 |  |
  | 778 | 789 | $result = $wpdb->get\_var( |
  | 779 | 790 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L782) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L793) |  |
  | 782 | 793 | ) |
  | 783 | 794 | ); |
  |  | 795 |  |
  | 784 | 796 | if ( 0 == $result ) { |
  | 785 | 797 | $es\_deliver\_report\_table = EMAIL\_SUBSCRIBERS\_STATS\_TABLE; |
  |  | 798 |  |
  | 786 | 799 | $table\_name              = $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $wpdb->prefix . 'es\_deliverreport' ) ); |
  |  | 800 |  |
  | 787 | 801 | if ( $table\_name === $es\_deliver\_report\_table ) { |
  |  | 802 |  |
  | 788 | 803 | $result = $wpdb->get\_var( |
  | 789 | 804 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L792) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L807) |  |
  | 792 | 807 | ) |
  | 793 | 808 | ); |
  |  | 809 |  |
  | 794 | 810 | } |
  | 795 | 811 | } |
  | 796 | 812 | } |
  | 797 |  |  |
  |  | 813 | // phpcs:enable |
  | 798 | 814 | return $result; |
  | 799 | 815 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L851) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L867) |  |
  | 851 | 867 |  |
  | 852 | 868 | $emails\_str = "'" . implode( "','", $emails ) . "'"; |
  | 853 |  |  |
  |  | 869 | // phpcs:disable |
  | 854 | 870 | $results = $wpbd->get\_results( |
  | 855 | 871 | $wpbd->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L860) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L876) |  |
  | 860 | 876 | ARRAY\_A |
  | 861 | 877 | ); |
  | 862 |  |  |
  |  | 878 | // phpcs:enable |
  | 863 | 879 | $emails\_id\_map = array(); |
  | 864 | 880 | if ( count( $results ) > 0 ) { |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L884) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L900) |  |
  | 884 | 900 | $emails = array(); |
  | 885 | 901 | if ( ! empty( $message\_id ) && ! empty( $campaign\_id ) ) { |
  |  | 902 | // phpcs:disable |
  | 886 | 903 | $emails = $wpdb->get\_results( |
  | 887 | 904 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=2995564#L891) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db-sending-queue.php?rev=3072302#L908) |  |
  | 891 | 908 | ARRAY\_A |
  | 892 | 909 | ); |
  |  | 910 | // phpcs:enable |
  | 893 | 911 | } |
  | 894 | 912 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-es-db.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-es-db.php?old=2989575&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-es-db.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-es-db.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L440 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L440 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 440 | 440 | $data\_keys      = array\_keys( $data ); |
  | 441 | 441 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 442 |  |  |
  |  | 442 | // phpcs:disable |
  | 443 | 443 | $wpdb->insert( $this->table\_name, $data, $column\_formats ); |
  |  | 444 | // phpcs:enable |
  | 444 | 445 | $wpdb\_insert\_id = $wpdb->insert\_id; |
  | 445 | 446 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L487) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L488) |  |
  | 487 | 488 | $data\_keys      = array\_keys( $data ); |
  | 488 | 489 | $column\_formats = array\_merge( array\_flip( $data\_keys ), $column\_formats ); |
  | 489 |  |  |
  |  | 490 | // phpcs:disable |
  | 490 | 491 | if ( false === $wpdb->update( $this->table\_name, $data, array( $where => $row\_id ), $column\_formats ) ) { |
  | 491 | 492 | return false; |
  | 492 | 493 | } |
  | 493 |  |  |
  |  | 494 | // phpcs:enable |
  | 494 | 495 | return true; |
  | 495 | 496 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=2989575#L587) | […](/browser/email-subscribers/trunk/lite/includes/db/class-es-db.php?rev=3072302#L588) |  |
  | 587 | 588 | global $wpdb; |
  | 588 | 589 | $table = sanitize\_text\_field( $table ); |
  | 589 |  |  |
  |  | 590 | // phpcs:disable |
  | 590 | 591 | return $wpdb->get\_var( $wpdb->prepare( 'SHOW TABLES LIKE %s', $table ) ) === $table; |
  |  | 592 | // phpcs:enable |
  | 591 | 593 | } |
  | 592 | 594 |  |
* ## [email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php](/changeset/3072302/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?old=2771938&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fdb%2Fclass-ig-es-db-unsubscribe-feedback.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L140 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L140 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 140 | 140 | return $existing\_feedback\_id; |
  | 141 | 141 | } |
  | 142 |  |  |
  |  | 142 | // phpcs:disable |
  | 143 | 143 | $existing\_feedback\_id = $wpdb->get\_var( |
  | 144 | 144 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L148) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L148) |  |
  | 148 | 148 | ) |
  | 149 | 149 | ); |
  | 150 |  |  |
  |  | 150 | // phpcs:enable |
  | 151 | 151 | return $existing\_feedback\_id; |
  | 152 | 152 | } |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L162) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L162) |  |
  | 162 | 162 | public static function get\_feedback\_counts( $number\_of\_days ) { |
  | 163 | 163 | global $wpdb; |
  |  | 164 | // phpcs:disable |
  | 164 | 165 | $feedback\_counts = $wpdb->get\_results( |
  | 165 | 166 | $wpdb->prepare( |
  | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=2771938#L169) | […](/browser/email-subscribers/trunk/lite/includes/db/class-ig-es-db-unsubscribe-feedback.php?rev=3072302#L170) |  |
  | 169 | 170 | ARRAY\_A |
  | 170 | 171 | ); |
  | 171 |  |  |
  |  | 172 | // phpcs:enable |
  | 172 | 173 | return $feedback\_counts; |
  | 173 | 174 | } |
* ## [email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php](/changeset/3072302/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?old=2840380&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Ffeedback%2Fclass-ig-feedback.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=2840380#L363 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/feedback/class-ig-feedback.php?rev=3072302#L363 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 363 | 363 |  |
  | 364 | 364 | if ( $can\_load ) { |
  |  | 365 | // phpcs:disable WordPress.WP.EnqueuedResourceParameters.NotInFooter |
  | 365 | 366 | wp\_enqueue\_script( 'sweetalert', plugin\_dir\_url( \_\_FILE\_\_ ) . 'assets/js/sweetalert2.min.js', array( 'jquery' ) ); |
  |  | 367 | // phpcs:enable |
  | 366 | 368 | } |
  | 367 | 369 | } |
* ## [email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php](/changeset/3072302/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?old=3046188&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fupgrade%2Fes-update-functions.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3046188#L3 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302#L3 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Functions for updating data, used by the background updater. |
  | 4 | 4 | \*/ |
  | 5 |  |  |
  |  | 5 | // phpcs:disable |
  | 6 | 6 | defined( 'ABSPATH' ) || exit; |
  | 7 | 7 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3046188#L2254) | […](/browser/email-subscribers/trunk/lite/includes/upgrade/es-update-functions.php?rev=3072302#L2254) |  |
  | 2254 | 2254 | ES\_Install::update\_db\_version( '5.7.13' ); |
  | 2255 | 2255 | } |
  | 2256 |  |  |
  |  | 2256 | // phpcs:enable |
  | 2257 | 2257 | /\* --------------------- ES 5.7.13(End)--------------------------- \*/ |
* ## [email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?old=2694654&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fclass-es-workflow-action-preview.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L86 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L86 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 86 | 86 | $order       = self::get\_preview\_order(); |
  | 87 | 87 | $order\_items = $order->get\_items(); |
  | 88 |  |  |
  |  | 88 | // phpcs:disable |
  | 89 | 89 | if ( empty( $order\_items ) ) { |
  | 90 | 90 | throw new Exception( \_\_( 'A valid "Order items" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 91 | 91 | } |
  | 92 |  |  |
  |  | 92 | // phpcs:enable |
  | 93 | 93 | $data\_layer['wc\_order']   = $order; |
  | 94 | 94 | $data\_layer['order\_item'] = current( $order\_items ); |
  | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L191) | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L191) |  |
  | 191 | 191 |  |
  | 192 | 192 | $products = $product\_query->posts; |
  |  | 193 | // phpcs:disable |
  | 193 | 194 | if ( empty( $products ) ) { |
  | 194 | 195 | throw new Exception( \_\_( 'A valid "Product" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 195 | 196 | } |
  |  | 197 | // phpcs:enable |
  | 196 | 198 | } |
  | 197 | 199 |  |
  | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=2694654#L217) | […](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow-action-preview.php?rev=3072302#L219) |  |
  | 217 | 219 | ] |
  | 218 | 220 | ); |
  | 219 |  |  |
  |  | 221 | // phpcs:disable |
  | 220 | 222 | if ( ! $orders ) { |
  | 221 | 223 | throw new Exception( \_\_( 'A valid "Order" must exist to generate the preview.', 'email-subscribers' ) ); |
  | 222 | 224 | } |
  | 223 |  |  |
  |  | 225 | // phpcs:enable |
  | 224 | 226 | $order = wc\_get\_order( $orders[0] ); |
  | 225 | 227 |  |
* ## [email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?old=3051406&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fclass-es-workflow.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3051406#L1134 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/class-es-workflow.php?rev=3072302#L1134 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 1134 | 1134 | public function get\_action\_from\_action\_fields( $field\_data ) { |
  | 1135 | 1135 | if ( ! is\_array( $field\_data ) || ! isset( $field\_data['action\_name'] ) ) { |
  |  | 1136 | // phpcs:disable |
  | 1136 | 1137 | throw new Exception( \_\_( 'Missing action\_name key in array.', 'email-subscribers' ) ); |
  |  | 1138 | // phpcs:enable |
  | 1137 | 1139 | } |
  | 1138 | 1140 |  |
  | 1139 | 1141 | $action\_name = ES\_Clean::string( $field\_data['action\_name'] ); |
  | 1140 | 1142 | $action      = ES\_Workflow\_Actions::get( $action\_name ); |
  |  | 1143 | // phpcs:disable |
  | 1141 | 1144 | if ( ! $action ) { |
  | 1142 | 1145 | throw new Exception( \_\_( 'Could not retrieve the action.', 'email-subscribers' ) ); |
  | 1143 | 1146 | } |
  | 1144 |  |  |
  |  | 1147 | // phpcs:enable |
  | 1145 | 1148 | return $action; |
  | 1146 | 1149 | } |
* ## [email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php](/changeset/3072302/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?old=2847177&old_path=email-subscribers%2Ftrunk%2Flite%2Fincludes%2Fworkflows%2Fdb%2Fclass-es-db-workflows.php "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php")

  | [r3069441](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=2847177#L970 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/lite/includes/workflows/db/class-es-db-workflows.php?rev=3072302#L970 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 970 | 970 |  |
  | 971 | 971 | global $wpdb; |
  | 972 |  |  |
  |  | 972 | // phpcs:disable |
  | 973 | 973 | $result = $wpdb->get\_results( "SELECT trigger\_name, count(trigger\_name) AS trigger\_count FROM {$wpdb->prefix}ig\_workflows WHERE status = 1 GROUP BY trigger\_name", ARRAY\_A ); |
  | 974 |  |  |
  |  | 974 | // phpcs:enable |
  | 975 | 975 | return $result; |
  | 976 | 976 | } |
* ## [email-subscribers/trunk/readme.txt](/changeset/3072302/email-subscribers/trunk/readme.txt?old=3069441&old_path=email-subscribers%2Ftrunk%2Freadme.txt "Show the [3069441:3072302] differences restricted to email-subscribers/trunk/readme.txt")

  | [r3069441](/browser/email-subscribers/trunk/readme.txt?rev=3069441#L5 "Show revision 3069441 of this file in browser") | [r3072302](/browser/email-subscribers/trunk/readme.txt?rev=3072302#L5 "Show revision 3072302 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Tags: email marketing, email subscribers, newsletters, autoresponders, email automation |
  | 6 | 6 | Requires at least: 3.9 |
  | 7 |  | Tested up to: 6.~~4~~.2 |
  |  | 7 | Tested up to: 6.5.2 |
  | 8 | 8 | Requires PHP: 5.6 |
  | 9 |  | Stable tag: 5.7.1~~7~~ |
  |  | 9 | Stable tag: 5.7.18 |
  | 10 | 10 | License: GPLv3 |
  | 11 | 11 |  |
  | […](/browser/email-subscribers/trunk/readme.txt?rev=3069441#L439) | […](/browser/email-subscribers/trunk/readme.txt?rev=3072302#L439) |  |
  | 439 | 439 | == Upgrade Notice == |
  | 440 | 440 |  |
  | 441 |  | = 5.7.17 = |
  | 442 |  |  |
  | 443 |  | \* Fix: Unable to select campaign recipient rules in a few cases |
  | 444 |  | \* Fix: Inline CSS not working in campaign preview [PRO] |
  | 445 |  | \* Fix: Keywords were not reflected in the post-notification test email [MAX] |
  | 446 |  | \* Fix: Broadcasts were not getting sent after re-editing |
  |  | 441 | = 5.7.18 = |
  |  | 442 |  |
  |  | 443 | \* Improvements: Performance & security improvements suggested by the Plugin Check (PCP) tool |
  |  | 444 | \* Update: Tested up to WordPress 6.5.2 |
  |  | 445 | \* Fix: Unauthorized access vulnerability [Thanks to Wordfence team] |
  | 447 | 446 |  |
  | 448 | 447 | == Changelog == |
  |  | 448 |  |
  |  | 449 | \*\*5.7.18 (17.04.2024)\*\* |
  |  | 450 |  |
  |  | 451 | \* Improvements: Performance & security improvements suggested by the Plugin Check (PCP) tool |
  |  | 452 | \* Update: Tested up to WordPress 6.5.2 |
  |  | 453 | \* Fix: Unauthorized access vulnerability [Thanks to Wordfence team] |
  | 449 | 454 |  |
  | 450 | 455 | \*\*5.7.17 (12.04.2024)\*\* |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3072302&old=3069441&new_path=%2Femail-subscribers%2Ftrunk&old_path=%2Femail-subscribers%2Ftrunk)
* [Zip Archive](?format=zip&new=3072302&old=3069441&new_path=%2Femail-subscribers%2Ftrunk&old_path=%2Femail-subscribers%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_3be1c208_20250110_211518.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Femail-subscribers%2Ftrunk%2Flite%2Fincludes%2Fclass-email-subscribers.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?rev=3154370 "Revision 3154370")
* Next Revision →
* [Blame](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/email-subscribers/trunk/lite/includes/class-email-subscribers.php)

---

# [source:](/browser?order=name "Go to repository root") [email-subscribers](/browser/email-subscribers?order=name "View email-subscribers")/[trunk](/browser/email-subscribers/trunk?order=name "View trunk")/[lite](/browser/email-subscribers/trunk/lite?order=name "View lite")/[includes](/browser/email-subscribers/trunk/lite/includes?order=name "View includes")/[class-email-subscribers.php](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?order=name "View class-email-subscribers.php")

View diff against:

View revision:

| [Last change](/changeset/3187269/email-subscribers/trunk/lite/includes/class-email-subscribers.php "View differences") on this file was [3187269](/changeset/3187269/ "View changeset 3187269"), checked in by Icegram, [2 months ago](/timeline?from=2024-11-13T09%3A25%3A26Z&precision=second "See timeline at 11/13/2024 09:25:26 AM") |
| --- |
| Preparing for 5.7.43 release |
| **File size:** 59.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | // Exit if accessed directly |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | if ( ! class\_exists( 'Email\_Subscribers' ) ) { |
| [8](#L8) |  |
| [9](#L9) | /\*\* |
| [10](#L10) | \* The file that defines the core plugin class |
| [11](#L11) | \* |
| [12](#L12) | \* A class definition that includes attributes and functions used across both the |
| [13](#L13) | \* public-facing side of the site and the admin area. |
| [14](#L14) | \* |
| [15](#L15) | \* @link       http://example.com |
| [16](#L16) | \* @since      4.0 |
| [17](#L17) | \* |
| [18](#L18) | \* @package    Email\_Subscribers |
| [19](#L19) | \* @subpackage Email\_Subscribers/includes |
| [20](#L20) | \*/ |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* The core plugin class. |
| [24](#L24) | \* |
| [25](#L25) | \* This is used to define internationalization, admin-specific hooks, and |
| [26](#L26) | \* public-facing site hooks. |
| [27](#L27) | \* |
| [28](#L28) | \* Also maintains the unique identifier of this plugin as well as the current |
| [29](#L29) | \* version of the plugin. |
| [30](#L30) | \* |
| [31](#L31) | \* @since      4.0 |
| [32](#L32) | \* @package    Email\_Subscribers |
| [33](#L33) | \* @subpackage Email\_Subscribers/includes |
| [34](#L34) | \*/ |
| [35](#L35) | class Email\_Subscribers { |
| [36](#L36) | /\*\* |
| [37](#L37) | \* ES instance |
| [38](#L38) | \* |
| [39](#L39) | \* @since 4.2.1 |
| [40](#L40) | \* |
| [41](#L41) | \* @var Email\_Subscribers The one true Email\_Subscribers |
| [42](#L42) | \*/ |
| [43](#L43) | private static $instance; |
| [44](#L44) |  |
| [45](#L45) | /\*\* |
| [46](#L46) | \* ES\_Queue object |
| [47](#L47) | \* |
| [48](#L48) | \* @since 4.2.1 |
| [49](#L49) | \* @var object|ES\_Queue |
| [50](#L50) | \*/ |
| [51](#L51) | public $queue; |
| [52](#L52) |  |
| [53](#L53) | /\*\* |
| [54](#L54) | \* ES\_DB\_Queue object |
| [55](#L55) | \* |
| [56](#L56) | \* @since 4.2.1 |
| [57](#L57) | \* @var object|ES\_DB\_Queue |
| [58](#L58) | \*/ |
| [59](#L59) | public $queue\_db; |
| [60](#L60) | /\*\* |
| [61](#L61) | \* ES\_Actions object |
| [62](#L62) | \* |
| [63](#L63) | \* @since 4.2.1 |
| [64](#L64) | \* @var object|ES\_Actions |
| [65](#L65) | \*/ |
| [66](#L66) | public $actions; |
| [67](#L67) |  |
| [68](#L68) | /\*\* |
| [69](#L69) | \* ES\_Cron object |
| [70](#L70) | \* |
| [71](#L71) | \* @since 4.3.1 |
| [72](#L72) | \* @var object|ES\_Cron |
| [73](#L73) | \*/ |
| [74](#L74) | public $cron; |
| [75](#L75) |  |
| [76](#L76) | /\*\* |
| [77](#L77) | \* ES\_Compatibility object |
| [78](#L78) | \* |
| [79](#L79) | \* @since 4.3.9 |
| [80](#L80) | \* @var object|ES\_Compatibility |
| [81](#L81) | \*/ |
| [82](#L82) | public $compatibiloty; |
| [83](#L83) |  |
| [84](#L84) | /\*\* |
| [85](#L85) | \* ES\_DB\_Actions object |
| [86](#L86) | \* |
| [87](#L87) | \* @since 4.2.1 |
| [88](#L88) | \* @var object|ES\_DB\_Actions |
| [89](#L89) | \*/ |
| [90](#L90) | public $actions\_db; |
| [91](#L91) |  |
| [92](#L92) | /\*\* |
| [93](#L93) | \* Feedback object |
| [94](#L94) | \* |
| [95](#L95) | \* @since 4.2.1 |
| [96](#L96) | \* |
| [97](#L97) | \* @var $feedback |
| [98](#L98) | \*/ |
| [99](#L99) | public $feedback; |
| [100](#L100) |  |
| [101](#L101) | /\*\* |
| [102](#L102) | \* Tracker Object |
| [103](#L103) | \* |
| [104](#L104) | \* @since 4.2.1 |
| [105](#L105) | \* |
| [106](#L106) | \* @var $tracker |
| [107](#L107) | \*/ |
| [108](#L108) | public $tracker; |
| [109](#L109) |  |
| [110](#L110) | /\*\* |
| [111](#L111) | \* Campaigns Object |
| [112](#L112) | \* |
| [113](#L113) | \* @since 4.2.1 |
| [114](#L114) | \* |
| [115](#L115) | \* @var object|ES\_Campaigns\_Table |
| [116](#L116) | \*/ |
| [117](#L117) | public $campaigns; |
| [118](#L118) |  |
| [119](#L119) | /\*\* |
| [120](#L120) | \* ES\_DB\_Campaigns object |
| [121](#L121) | \* |
| [122](#L122) | \* @since 4.2.1 |
| [123](#L123) | \* |
| [124](#L124) | \* @var object|ES\_DB\_Campaigns |
| [125](#L125) | \*/ |
| [126](#L126) | public $campaigns\_db; |
| [127](#L127) |  |
| [128](#L128) | /\*\* |
| [129](#L129) | \* Lists Object |
| [130](#L130) | \* |
| [131](#L131) | \* @since 4.2.1 |
| [132](#L132) | \* @var object|ES\_Lists\_Table |
| [133](#L133) | \*/ |
| [134](#L134) | public $lists; |
| [135](#L135) |  |
| [136](#L136) | /\*\* |
| [137](#L137) | \* Lists DB Object |
| [138](#L138) | \* |
| [139](#L139) | \* @since 4.2.1 |
| [140](#L140) | \* |
| [141](#L141) | \* @var object|ES\_DB\_Lists |
| [142](#L142) | \*/ |
| [143](#L143) | public $lists\_db; |
| [144](#L144) |  |
| [145](#L145) | /\*\* |
| [146](#L146) | \* Forms Object |
| [147](#L147) | \* |
| [148](#L148) | \* @since 4.2.1 |
| [149](#L149) | \* @var object|ES\_Forms\_Table |
| [150](#L150) | \*/ |
| [151](#L151) | public $forms; |
| [152](#L152) |  |
| [153](#L153) | /\*\* |
| [154](#L154) | \* Forms DB Object |
| [155](#L155) | \* |
| [156](#L156) | \* @since 4.2.1 |
| [157](#L157) | \* |
| [158](#L158) | \* @var object|ES\_DB\_Forms |
| [159](#L159) | \*/ |
| [160](#L160) | public $forms\_db; |
| [161](#L161) |  |
| [162](#L162) | /\*\* |
| [163](#L163) | \* Contacts Object |
| [164](#L164) | \* |
| [165](#L165) | \* @since 4.2.1 |
| [166](#L166) | \* |
| [167](#L167) | \* @var object|ES\_Contacts\_Table |
| [168](#L168) | \*/ |
| [169](#L169) | public $contacts; |
| [170](#L170) |  |
| [171](#L171) | /\*\* |
| [172](#L172) | \* Contacts DB Object |
| [173](#L173) | \* |
| [174](#L174) | \* @since 4.2.1 |
| [175](#L175) | \* |
| [176](#L176) | \* @var object|ES\_DB\_Contacts |
| [177](#L177) | \*/ |
| [178](#L178) | public $contacts\_db; |
| [179](#L179) |  |
| [180](#L180) | /\*\* |
| [181](#L181) | \* ES\_DB\_Blocked\_Emails object |
| [182](#L182) | \* |
| [183](#L183) | \* @since 4.2.2 |
| [184](#L184) | \* |
| [185](#L185) | \* @var object|ES\_DB\_Blocked\_Emails |
| [186](#L186) | \*/ |
| [187](#L187) | public $blocked\_emails\_db; |
| [188](#L188) |  |
| [189](#L189) | /\*\* |
| [190](#L190) | \* ES\_DB\_Links object |
| [191](#L191) | \* |
| [192](#L192) | \* @since 4.2.4 |
| [193](#L193) | \* |
| [194](#L194) | \* @var object|ES\_DB\_Links |
| [195](#L195) | \*/ |
| [196](#L196) | public $links\_db; |
| [197](#L197) |  |
| [198](#L198) | /\*\* |
| [199](#L199) | \* ES\_DB\_Lists\_Contacts object |
| [200](#L200) | \* |
| [201](#L201) | \* @since 4.3.5 |
| [202](#L202) | \* |
| [203](#L203) | \* @var object|ES\_DB\_Lists\_Contacts |
| [204](#L204) | \*/ |
| [205](#L205) | public $lists\_contacts\_db; |
| [206](#L206) |  |
| [207](#L207) | /\*\* |
| [208](#L208) | \* ES\_DB\_Lists\_Contacts object |
| [209](#L209) | \* |
| [210](#L210) | \* @since 4.3.5 |
| [211](#L211) | \* |
| [212](#L212) | \* @var object|ES\_DB\_Lists\_Contacts |
| [213](#L213) | \*/ |
| [214](#L214) | public $custom\_fields\_db; |
| [215](#L215) |  |
| [216](#L216) | /\*\* |
| [217](#L217) | \* ES\_Integrations object |
| [218](#L218) | \* |
| [219](#L219) | \* @since 4.2.1 |
| [220](#L220) | \* |
| [221](#L221) | \* @var object|ES\_Integrations |
| [222](#L222) | \*/ |
| [223](#L223) | public $integrations; |
| [224](#L224) |  |
| [225](#L225) | /\*\* |
| [226](#L226) | \* IG\_Logger object |
| [227](#L227) | \* |
| [228](#L228) | \* @since 4.2.1 |
| [229](#L229) | \* |
| [230](#L230) | \* @var object|IG\_Logger |
| [231](#L231) | \*/ |
| [232](#L232) | public $logger; |
| [233](#L233) |  |
| [234](#L234) | /\*\* |
| [235](#L235) | \* ES\_Mailer object |
| [236](#L236) | \* |
| [237](#L237) | \* @since 4.3.1 |
| [238](#L238) | \* |
| [239](#L239) | \* @var object|ES\_Mailer |
| [240](#L240) | \*/ |
| [241](#L241) | public $mailer; |
| [242](#L242) |  |
| [243](#L243) | /\*\* |
| [244](#L244) | \* IG\_ES\_Trail object |
| [245](#L245) | \* |
| [246](#L246) | \* @var object|IG\_ES\_Trial |
| [247](#L247) | \* |
| [248](#L248) | \* @since 4.6.6 |
| [249](#L249) | \*/ |
| [250](#L250) | public $trial; |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* IG\_ES\_DB\_WC\_Cart object |
| [254](#L254) | \* |
| [255](#L255) | \* @var object|IG\_ES\_DB\_WC\_Cart |
| [256](#L256) | \* |
| [257](#L257) | \* @since 4.6.6 |
| [258](#L258) | \*/ |
| [259](#L259) | public $carts\_db; |
| [260](#L260) |  |
| [261](#L261) | /\*\* |
| [262](#L262) | \* The loader that's responsible for maintaining and registering all hooks that power |
| [263](#L263) | \* the plugin. |
| [264](#L264) | \* |
| [265](#L265) | \* @since    4.0 |
| [266](#L266) | \* |
| [267](#L267) | \* @var      Email\_Subscribers\_Loader $loader Maintains and registers all hooks for the plugin. |
| [268](#L268) | \*/ |
| [269](#L269) | protected $loader; |
| [270](#L270) |  |
| [271](#L271) | /\*\* |
| [272](#L272) | \* The unique identifier of this plugin. |
| [273](#L273) | \* |
| [274](#L274) | \* @since    4.0 |
| [275](#L275) | \* |
| [276](#L276) | \* @var      string $email\_subscribers The string used to uniquely identify this plugin. |
| [277](#L277) | \*/ |
| [278](#L278) | protected $email\_subscribers; |
| [279](#L279) |  |
| [280](#L280) | /\*\* |
| [281](#L281) | \* The current version of the plugin. |
| [282](#L282) | \* |
| [283](#L283) | \* @since    4.0 |
| [284](#L284) | \* |
| [285](#L285) | \* @var      string $version The current version of the plugin. |
| [286](#L286) | \*/ |
| [287](#L287) | protected $version; |
| [288](#L288) |  |
| [289](#L289) | /\*\* |
| [290](#L290) | \* ES\_DB\_Workflows object |
| [291](#L291) | \* |
| [292](#L292) | \* @since 4.4.0 |
| [293](#L293) | \* |
| [294](#L294) | \* @var object|ES\_DB\_Workflows |
| [295](#L295) | \*/ |
| [296](#L296) | public $workflows\_db; |
| [297](#L297) |  |
| [298](#L298) | /\*\* |
| [299](#L299) | \* Define the core functionality of the plugin. |
| [300](#L300) | \* |
| [301](#L301) | \* Set the plugin name and the plugin version that can be used throughout the plugin. |
| [302](#L302) | \* Load the dependencies, define the locale, and set the hooks for the admin area and |
| [303](#L303) | \* the public-facing side of the site. |
| [304](#L304) | \* |
| [305](#L305) | \* @since    4.0 |
| [306](#L306) | \*/ |
| [307](#L307) | public function \_\_construct() { |
| [308](#L308) | $this->version = ES\_PLUGIN\_VERSION; |
| [309](#L309) | } |
| [310](#L310) |  |
| [311](#L311) | /\*\* |
| [312](#L312) | \* Add Admin Notices |
| [313](#L313) | \* |
| [314](#L314) | \* @since 4.0.0 |
| [315](#L315) | \*/ |
| [316](#L316) | public function add\_admin\_notice() { |
| [317](#L317) |  |
| [318](#L318) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [319](#L319) | return; |
| [320](#L320) | } |
| [321](#L321) |  |
| [322](#L322) | // Halloween offer |
| [323](#L323) | $show\_offer   = false; |
| [324](#L324) | $current\_page = ig\_es\_get\_request\_data( 'page' ); |
| [325](#L325) |  |
| [326](#L326) | if ( $this->can\_upsell\_features( array( 'lite', 'trial', 'starter', 'pro' ) ) && IG\_ES\_Onboarding::is\_onboarding\_completed() ) { |
| [327](#L327) | if ( 'es\_reports' === $current\_page ) { |
| [328](#L328) | $report\_insight = ig\_es\_get\_request\_data( 'insight' ); |
| [329](#L329) | if ( ! $report\_insight ) { |
| [330](#L330) | $show\_offer = true; |
| [331](#L331) | } |
| [332](#L332) | } else { |
| [333](#L333) | $show\_offer = true; |
| [334](#L334) | } |
| [335](#L335) | } |
| [336](#L336) |  |
| [337](#L337) | if ( $show\_offer ) { |
| [338](#L338) | $args['url']     = 'https://www.icegram.com/'; |
| [339](#L339) | $args['include'] = ES\_PLUGIN\_DIR . 'lite/includes/notices/views/ig-es-bfcm-offer.php'; |
| [340](#L340) | ES\_Admin\_Notices::add\_custom\_notice( 'bfcm\_offer\_2024', $args ); |
| [341](#L341) | } else { |
| [342](#L342) | ES\_Admin\_Notices::remove\_notice( 'bfcm\_offer\_2024' ); |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) | $screen\_id = $this->get\_current\_screen\_id(); |
| [346](#L346) | // Don't show admin notices on Dashboard if onboarding is not yet completed. |
| [347](#L347) | $is\_onboarding\_complete = get\_option( 'ig\_es\_onboarding\_complete', false ); |
| [348](#L348) |  |
| [349](#L349) | // We don't have ig\_es\_onboarding\_complete option if somebody is migrating from older version |
| [350](#L350) | if ( ( 'toplevel\_page\_es\_dashboard' === $screen\_id ) && ( ! $is\_onboarding\_complete || 'no' == $is\_onboarding\_complete ) ) { |
| [351](#L351) | return; |
| [352](#L352) | } |
| [353](#L353) |  |
| [354](#L354) | // cron notice |
| [355](#L355) | $notice\_option = get\_option( 'ig\_es\_wp\_cron\_notice' ); |
| [356](#L356) |  |
| [357](#L357) | $show\_notice = true; |
| [358](#L358) | $show\_notice = apply\_filters( 'ig\_es\_show\_wp\_cron\_notice', $show\_notice ); |
| [359](#L359) |  |
| [360](#L360) | // If DISABLE\_WP\_CRON constant is defined and set to true, then we can say that wp cron is disabled. |
| [361](#L361) | $wp\_cron\_disabled = ( defined( 'DISABLE\_WP\_CRON' ) && DISABLE\_WP\_CRON ) ? true : false; |
| [362](#L362) |  |
| [363](#L363) | // Add notice only if wp cron is disabled and user have not acknowledged the notice by clicking on the acknowledgement button in the notice. |
| [364](#L364) | if ( $wp\_cron\_disabled && 'yes' != $notice\_option && $show\_notice ) { |
| [365](#L365) | $es\_cron\_url = 'https://www.icegram.com/documentation/how-to-enable-the-wordpress-cron/?utm\_medium=enable\_wordpress\_cron&utm\_source=in\_app&utm\_campaign=view\_admin\_notice'; |
| [366](#L366) | $cpanel\_url  = 'https://www.icegram.com/documentation/es-how-to-schedule-cron-emails-in-cpanel/?utm\_source=schedule\_cron\_in\_cpanel&utm\_medium=in\_app&utm\_campaign=view\_admin\_notice'; |
| [367](#L367) | $es\_pro\_url  = 'https://www.icegram.com/documentation/es-how-to-schedule-cron-emails-in-cpanel/?utm\_source=schedule\_cron\_in\_cpanel&utm\_medium=in\_app&utm\_campaign=view\_admin\_notice'; |
| [368](#L368) | /\* translators: %s: Cron URL \*/ |
| [369](#L369) | $disable\_wp\_cron\_notice = sprintf( \_\_( 'WordPress Cron is disabled on your site. Email notifications from Icegram Express plugin will not be sent automatically. <a href="%s" target="\_blank" >Here\'s how you can enable it.</a>', 'email-subscribers' ), $es\_cron\_url ); |
| [370](#L370) | /\* translators: %s: Link to Cpanel URL \*/ |
| [371](#L371) | $disable\_wp\_cron\_notice .= '<br/>' . sprintf( \_\_( 'Or schedule Cron in <a href="%s" target="\_blank">cPanel</a>', 'email-subscribers' ), $cpanel\_url ); |
| [372](#L372) |  |
| [373](#L373) | $notice\_dismiss\_url = wp\_nonce\_url( |
| [374](#L374) | add\_query\_arg( |
| [375](#L375) | array( |
| [376](#L376) | 'es\_dismiss\_admin\_notice' => 1, |
| [377](#L377) | 'option\_name'             => 'wp\_cron\_notice', |
| [378](#L378) | ) |
| [379](#L379) | ), |
| [380](#L380) | 'es\_dismiss\_admin\_notice' |
| [381](#L381) | ); |
| [382](#L382) |  |
| [383](#L383) | /\* translators: %s: ES Pro URL \*/ |
| [384](#L384) | $disable\_wp\_cron\_notice .= '<br/>' . sprintf( \_\_( 'Or use <strong><a href="%s" target="\_blank">Icegram Express Pro</a></strong> for automatic Cron support', 'email-subscribers' ), $es\_pro\_url ); |
| [385](#L385) | $html                    = '<div class="notice notice-warning" style="background-color: #FFF;"><p style="letter-spacing: 0.6px;">' . $disable\_wp\_cron\_notice . '<a style="float:right" class="es-admin-btn es-admin-btn-secondary " href="' . esc\_url( $notice\_dismiss\_url ) . '">' . \_\_( |
| [386](#L386) | 'OK, I Got it!', |
| [387](#L387) | 'email-subscribers' |
| [388](#L388) | ) . '</a></p></div>'; |
| [389](#L389) | $args['html']            = $html; |
| [390](#L390) | ES\_Admin\_Notices::add\_custom\_notice( 'show\_wp\_cron', $args ); |
| [391](#L391) | } else { |
| [392](#L392) | // Remove the notice if user hasn't disabled the WP CRON or renabled the WP CRON. |
| [393](#L393) | ES\_Admin\_Notices::remove\_notice( 'show\_wp\_cron' ); |
| [394](#L394) | } |
| [395](#L395) |  |
| [396](#L396) | } |
| [397](#L397) |  |
| [398](#L398) | /\*\* |
| [399](#L399) | \* Define Contstants |
| [400](#L400) | \* |
| [401](#L401) | \* @since 4.0.0 |
| [402](#L402) | \*/ |
| [403](#L403) | public function define\_constants() { |
| [404](#L404) |  |
| [405](#L405) | global $wpdb; |
| [406](#L406) |  |
| [407](#L407) | $upload\_dir = wp\_upload\_dir( null, false ); |
| [408](#L408) |  |
| [409](#L409) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_SLUG' ) ) { |
| [410](#L410) | define( 'EMAIL\_SUBSCRIBERS\_SLUG', 'email-subscribers' ); |
| [411](#L411) | } |
| [412](#L412) |  |
| [413](#L413) | if ( ! defined( 'IG\_LOG\_DIR' ) ) { |
| [414](#L414) | define( 'IG\_LOG\_DIR', $upload\_dir['basedir'] . '/ig-logs/' ); |
| [415](#L415) | } |
| [416](#L416) |  |
| [417](#L417) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_INCLUDES\_DIR' ) ) { |
| [418](#L418) | define( 'EMAIL\_SUBSCRIBERS\_INCLUDES\_DIR', \_\_DIR\_\_ . '/includes' ); |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_DIR' ) ) { |
| [422](#L422) | define( 'EMAIL\_SUBSCRIBERS\_DIR', WP\_PLUGIN\_DIR . '/email-subscribers' ); |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | if ( ! defined( 'ES\_EMAILLIST\_TABLE' ) ) { |
| [426](#L426) | define( 'ES\_EMAILLIST\_TABLE', $wpdb->prefix . 'es\_emaillist' ); |
| [427](#L427) | } |
| [428](#L428) |  |
| [429](#L429) | if ( ! defined( 'EMAIL\_LIST\_TABLE' ) ) { |
| [430](#L430) | define( 'EMAIL\_LIST\_TABLE', $wpdb->prefix . 'es\_lists' ); |
| [431](#L431) | } |
| [432](#L432) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_NOTIFICATION\_TABLE' ) ) { |
| [433](#L433) | define( 'EMAIL\_SUBSCRIBERS\_NOTIFICATION\_TABLE', $wpdb->prefix . 'es\_notification' ); |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_STATS\_TABLE' ) ) { |
| [437](#L437) | define( 'EMAIL\_SUBSCRIBERS\_STATS\_TABLE', $wpdb->prefix . 'es\_deliverreport' ); |
| [438](#L438) | } |
| [439](#L439) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_SENT\_TABLE' ) ) { |
| [440](#L440) | define( 'EMAIL\_SUBSCRIBERS\_SENT\_TABLE', $wpdb->prefix . 'es\_sentdetails' ); |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | if ( ! defined( 'EMAIL\_TEMPLATES\_TABLE' ) ) { |
| [444](#L444) | define( 'EMAIL\_TEMPLATES\_TABLE', $wpdb->prefix . 'es\_templates' ); |
| [445](#L445) | } |
| [446](#L446) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_ADVANCED\_FORM' ) ) { |
| [447](#L447) | define( 'EMAIL\_SUBSCRIBERS\_ADVANCED\_FORM', $wpdb->prefix . 'es\_advanced\_form' ); |
| [448](#L448) | } |
| [449](#L449) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_LIST\_MAX' ) ) { |
| [450](#L450) | define( 'EMAIL\_SUBSCRIBERS\_LIST\_MAX', 40 ); |
| [451](#L451) | } |
| [452](#L452) | if ( ! defined( 'EMAIL\_SUBSCRIBERS\_CRON\_INTERVAL' ) ) { |
| [453](#L453) | define( 'EMAIL\_SUBSCRIBERS\_CRON\_INTERVAL', 300 ); |
| [454](#L454) | } |
| [455](#L455) | if ( ! defined( 'IG\_CAMPAIGNS\_TABLE' ) ) { |
| [456](#L456) | define( 'IG\_CAMPAIGNS\_TABLE', $wpdb->prefix . 'ig\_campaigns' ); |
| [457](#L457) | } |
| [458](#L458) | if ( ! defined( 'IG\_WORKFLOWS\_TABLE' ) ) { |
| [459](#L459) | define( 'IG\_WORKFLOWS\_TABLE', $wpdb->prefix . 'ig\_workflows' ); |
| [460](#L460) | } |
| [461](#L461) | if ( ! defined( 'IG\_CONTACTS\_TABLE' ) ) { |
| [462](#L462) | define( 'IG\_CONTACTS\_TABLE', $wpdb->prefix . 'ig\_contacts' ); |
| [463](#L463) | } |
| [464](#L464) | if ( ! defined( 'IG\_CONTACTS\_IPS\_TABLE' ) ) { |
| [465](#L465) | define( 'IG\_CONTACTS\_IPS\_TABLE', $wpdb->prefix . 'ig\_contacts\_ips' ); |
| [466](#L466) | } |
| [467](#L467) | if ( ! defined( 'IG\_FORMS\_TABLE' ) ) { |
| [468](#L468) | define( 'IG\_FORMS\_TABLE', $wpdb->prefix . 'ig\_forms' ); |
| [469](#L469) | } |
| [470](#L470) | if ( ! defined( 'IG\_LISTS\_TABLE' ) ) { |
| [471](#L471) | define( 'IG\_LISTS\_TABLE', $wpdb->prefix . 'ig\_lists' ); |
| [472](#L472) | } |
| [473](#L473) | if ( ! defined( 'IG\_LISTS\_CONTACTS\_TABLE' ) ) { |
| [474](#L474) | define( 'IG\_LISTS\_CONTACTS\_TABLE', $wpdb->prefix . 'ig\_lists\_contacts' ); |
| [475](#L475) | } |
| [476](#L476) | if ( ! defined( 'IG\_MAILING\_QUEUE\_TABLE' ) ) { |
| [477](#L477) | define( 'IG\_MAILING\_QUEUE\_TABLE', $wpdb->prefix . 'ig\_mailing\_queue' ); |
| [478](#L478) | } |
| [479](#L479) | if ( ! defined( 'IG\_SENDING\_QUEUE\_TABLE' ) ) { |
| [480](#L480) | define( 'IG\_SENDING\_QUEUE\_TABLE', $wpdb->prefix . 'ig\_sending\_queue' ); |
| [481](#L481) | } |
| [482](#L482) | if ( ! defined( 'IG\_BLOCKED\_EMAILS\_TABLE' ) ) { |
| [483](#L483) | define( 'IG\_BLOCKED\_EMAILS\_TABLE', $wpdb->prefix . 'ig\_blocked\_emails' ); |
| [484](#L484) | } |
| [485](#L485) | if ( ! defined( 'IG\_ACTIONS\_TABLE' ) ) { |
| [486](#L486) | define( 'IG\_ACTIONS\_TABLE', $wpdb->prefix . 'ig\_actions' ); |
| [487](#L487) | } |
| [488](#L488) | if ( ! defined( 'IG\_LINKS\_TABLE' ) ) { |
| [489](#L489) | define( 'IG\_LINKS\_TABLE', $wpdb->prefix . 'ig\_links' ); |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | if ( ! defined( 'IG\_CONTACT\_META\_TABLE' ) ) { |
| [493](#L493) | define( 'IG\_CONTACT\_META\_TABLE', $wpdb->prefix . 'ig\_contactmeta' ); |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | if ( ! defined( 'IG\_QUEUE\_TABLE' ) ) { |
| [497](#L497) | define( 'IG\_QUEUE\_TABLE', $wpdb->prefix . 'ig\_queue' ); |
| [498](#L498) | } |
| [499](#L499) |  |
| [500](#L500) | if ( ! defined( 'IG\_CUSTOM\_FIELDS\_TABLE' ) ) { |
| [501](#L501) | define( 'IG\_CUSTOM\_FIELDS\_TABLE', $wpdb->prefix . 'ig\_custom\_fields' ); |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) | if ( ! defined( 'IG\_EMAIL\_STATUS\_IN\_QUEUE' ) ) { |
| [505](#L505) | define( 'IG\_EMAIL\_STATUS\_IN\_QUEUE', 'in\_queue' ); |
| [506](#L506) | } |
| [507](#L507) | if ( ! defined( 'IG\_EMAIL\_STATUS\_SENDING' ) ) { |
| [508](#L508) | define( 'IG\_EMAIL\_STATUS\_SENDING', 'sending' ); |
| [509](#L509) | } |
| [510](#L510) | if ( ! defined( 'IG\_EMAIL\_STATUS\_SENT' ) ) { |
| [511](#L511) | define( 'IG\_EMAIL\_STATUS\_SENT', 'sent' ); |
| [512](#L512) | } |
| [513](#L513) | if ( ! defined( 'IG\_SINGLE\_OPTIN' ) ) { |
| [514](#L514) | define( 'IG\_SINGLE\_OPTIN', 1 ); |
| [515](#L515) | } |
| [516](#L516) | if ( ! defined( 'IG\_DOUBLE\_OPTIN' ) ) { |
| [517](#L517) | define( 'IG\_DOUBLE\_OPTIN', 2 ); |
| [518](#L518) | } |
| [519](#L519) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_POST\_NOTIFICATION' ) ) { |
| [520](#L520) | define( 'IG\_CAMPAIGN\_TYPE\_POST\_NOTIFICATION', 'post\_notification' ); |
| [521](#L521) | } |
| [522](#L522) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_NEWSLETTER' ) ) { |
| [523](#L523) | define( 'IG\_CAMPAIGN\_TYPE\_NEWSLETTER', 'newsletter' ); |
| [524](#L524) | } |
| [525](#L525) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_POST\_DIGEST' ) ) { |
| [526](#L526) | define( 'IG\_CAMPAIGN\_TYPE\_POST\_DIGEST', 'post\_digest' ); |
| [527](#L527) | } |
| [528](#L528) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_SEQUENCE' ) ) { |
| [529](#L529) | define( 'IG\_CAMPAIGN\_TYPE\_SEQUENCE', 'sequence' ); |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_SEQUENCE\_MESSAGE' ) ) { |
| [533](#L533) | define( 'IG\_CAMPAIGN\_TYPE\_SEQUENCE\_MESSAGE', 'sequence\_message' ); |
| [534](#L534) | } |
| [535](#L535) |  |
| [536](#L536) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_WORKFLOW' ) ) { |
| [537](#L537) | define( 'IG\_CAMPAIGN\_TYPE\_WORKFLOW', 'workflow' ); |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | if ( ! defined( 'IG\_CAMPAIGN\_TYPE\_WORKFLOW\_EMAIL' ) ) { |
| [541](#L541) | define( 'IG\_CAMPAIGN\_TYPE\_WORKFLOW\_EMAIL', 'workflow\_email' ); |
| [542](#L542) | } |
| [543](#L543) |  |
| [544](#L544) | if ( ! defined( 'IG\_DEFAULT\_BATCH\_SIZE' ) ) { |
| [545](#L545) | define( 'IG\_DEFAULT\_BATCH\_SIZE', 100 ); |
| [546](#L546) | } |
| [547](#L547) | if ( ! defined( 'IG\_MAX\_MEMORY\_LIMIT' ) ) { |
| [548](#L548) | define( 'IG\_MAX\_MEMORY\_LIMIT', '-1' ); |
| [549](#L549) | } |
| [550](#L550) | if ( ! defined( 'IG\_SET\_TIME\_LIMIT' ) ) { |
| [551](#L551) | define( 'IG\_SET\_TIME\_LIMIT', 0 ); |
| [552](#L552) | } |
| [553](#L553) | if ( ! defined( 'IG\_DEFAULT\_LIST' ) ) { |
| [554](#L554) | define( 'IG\_DEFAULT\_LIST', 'Test' ); |
| [555](#L555) | } |
| [556](#L556) | if ( ! defined( 'IG\_MAIN\_LIST' ) ) { |
| [557](#L557) | define( 'IG\_MAIN\_LIST', 'Main' ); |
| [558](#L558) | } |
| [559](#L559) | if ( ! defined( 'IG\_CONTACT\_SUBSCRIBE' ) ) { |
| [560](#L560) | define( 'IG\_CONTACT\_SUBSCRIBE', 1 ); |
| [561](#L561) | } |
| [562](#L562) | if ( ! defined( 'IG\_MESSAGE\_SENT' ) ) { |
| [563](#L563) | define( 'IG\_MESSAGE\_SENT', 2 ); |
| [564](#L564) | } |
| [565](#L565) | if ( ! defined( 'IG\_MESSAGE\_OPEN' ) ) { |
| [566](#L566) | define( 'IG\_MESSAGE\_OPEN', 3 ); |
| [567](#L567) | } |
| [568](#L568) | if ( ! defined( 'IG\_LINK\_CLICK' ) ) { |
| [569](#L569) | define( 'IG\_LINK\_CLICK', 4 ); |
| [570](#L570) | } |
| [571](#L571) | if ( ! defined( 'IG\_CONTACT\_UNSUBSCRIBE' ) ) { |
| [572](#L572) | define( 'IG\_CONTACT\_UNSUBSCRIBE', 5 ); |
| [573](#L573) | } |
| [574](#L574) | if ( ! defined( 'IG\_MESSAGE\_SOFT\_BOUNCE' ) ) { |
| [575](#L575) | define( 'IG\_MESSAGE\_SOFT\_BOUNCE', 6 ); |
| [576](#L576) | } |
| [577](#L577) | if ( ! defined( 'IG\_MESSAGE\_HARD\_BOUNCE' ) ) { |
| [578](#L578) | define( 'IG\_MESSAGE\_HARD\_BOUNCE', 7 ); |
| [579](#L579) | } |
| [580](#L580) | if ( ! defined( 'IG\_MESSAGE\_ERROR' ) ) { |
| [581](#L581) | define( 'IG\_MESSAGE\_ERROR', 8 ); |
| [582](#L582) | } |
| [583](#L583) | if ( ! defined( 'IG\_ES\_CRON\_INTERVAL' ) ) { |
| [584](#L584) | define( 'IG\_ES\_CRON\_INTERVAL', 15 \* MINUTE\_IN\_SECONDS ); |
| [585](#L585) | } |
| [586](#L586) | if ( ! defined( 'IG\_ES\_MAX\_EMAIL\_SEND\_AT\_ONCE' ) ) { |
| [587](#L587) | define( 'IG\_ES\_MAX\_EMAIL\_SEND\_AT\_ONCE', 30 ); |
| [588](#L588) | } |
| [589](#L589) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_IN\_ACTIVE' ) ) { |
| [590](#L590) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_IN\_ACTIVE', 0 ); |
| [591](#L591) | } |
| [592](#L592) |  |
| [593](#L593) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_ACTIVE' ) ) { |
| [594](#L594) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_ACTIVE', 1 ); |
| [595](#L595) | } |
| [596](#L596) |  |
| [597](#L597) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_SCHEDULED' ) ) { |
| [598](#L598) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_SCHEDULED', 2 ); |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_QUEUED' ) ) { |
| [602](#L602) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_QUEUED', 3 ); |
| [603](#L603) | } |
| [604](#L604) |  |
| [605](#L605) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_PAUSED' ) ) { |
| [606](#L606) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_PAUSED', 4 ); |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | if ( ! defined( 'IG\_ES\_CAMPAIGN\_STATUS\_FINISHED' ) ) { |
| [610](#L610) | define( 'IG\_ES\_CAMPAIGN\_STATUS\_FINISHED', 5 ); |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | if ( ! defined( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_QUEUED' ) ) { |
| [614](#L614) | define( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_QUEUED', 'In Queue' ); |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | if ( ! defined( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_SENDING' ) ) { |
| [618](#L618) | define( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_SENDING', 'Sending' ); |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | if ( ! defined( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_PAUSED' ) ) { |
| [622](#L622) | define( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_PAUSED', 'Paused' ); |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | if ( ! defined( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_SENT' ) ) { |
| [626](#L626) | define( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_SENT', 'Sent' ); |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | if ( ! defined( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_FAILED' ) ) { |
| [630](#L630) | define( 'IG\_ES\_MAILING\_QUEUE\_STATUS\_FAILED', 'Failed' ); |
| [631](#L631) | } |
| [632](#L632) |  |
| [633](#L633) | if ( ! defined( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_QUEUED' ) ) { |
| [634](#L634) | define( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_QUEUED', 'In Queue' ); |
| [635](#L635) | } |
| [636](#L636) |  |
| [637](#L637) | if ( ! defined( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_SENDING' ) ) { |
| [638](#L638) | define( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_SENDING', 'Sending' ); |
| [639](#L639) | } |
| [640](#L640) |  |
| [641](#L641) | if ( ! defined( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_SENT' ) ) { |
| [642](#L642) | define( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_SENT', 'Sent' ); |
| [643](#L643) | } |
| [644](#L644) |  |
| [645](#L645) | if ( ! defined( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_FAILED' ) ) { |
| [646](#L646) | define( 'IG\_ES\_SENDING\_QUEUE\_STATUS\_FAILED', 'Failed' ); |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) | if ( ! defined( 'IG\_ES\_WORKFLOW\_STATUS\_IN\_ACTIVE' ) ) { |
| [650](#L650) | define( 'IG\_ES\_WORKFLOW\_STATUS\_IN\_ACTIVE', 0 ); |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | if ( ! defined( 'IG\_ES\_WORKFLOW\_STATUS\_ACTIVE' ) ) { |
| [654](#L654) | define( 'IG\_ES\_WORKFLOW\_STATUS\_ACTIVE', 1 ); |
| [655](#L655) | } |
| [656](#L656) |  |
| [657](#L657) | if ( ! defined( 'IG\_ES\_WORKFLOW\_TYPE\_USER' ) ) { |
| [658](#L658) | define( 'IG\_ES\_WORKFLOW\_TYPE\_USER', 0 ); |
| [659](#L659) | } |
| [660](#L660) |  |
| [661](#L661) | if ( ! defined( 'IG\_ES\_WORKFLOW\_TYPE\_SYSTEM' ) ) { |
| [662](#L662) | define( 'IG\_ES\_WORKFLOW\_TYPE\_SYSTEM', 1 ); |
| [663](#L663) | } |
| [664](#L664) |  |
| [665](#L665) | if ( ! defined( 'IG\_ES\_TRIAL\_PERIOD\_IN\_DAYS' ) ) { |
| [666](#L666) | define( 'IG\_ES\_TRIAL\_PERIOD\_IN\_DAYS', 14 ); |
| [667](#L667) | } |
| [668](#L668) |  |
| [669](#L669) | if ( ! defined( 'IG\_ES\_PRODUCT\_ID' ) ) { |
| [670](#L670) | define( 'IG\_ES\_PRODUCT\_ID', 1002 ); |
| [671](#L671) | } |
| [672](#L672) |  |
| [673](#L673) | if ( ! defined( 'IG\_ES\_SUBSCRIBE\_SCORE' ) ) { |
| [674](#L674) | define( 'IG\_ES\_SUBSCRIBE\_SCORE', 4 ); |
| [675](#L675) | } |
| [676](#L676) |  |
| [677](#L677) | if ( ! defined( 'IG\_ES\_UNSUBSCRIBE\_SCORE' ) ) { |
| [678](#L678) | define( 'IG\_ES\_UNSUBSCRIBE\_SCORE', 0 ); |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | if ( ! defined( 'IG\_ES\_OPEN\_SCORE' ) ) { |
| [682](#L682) | define( 'IG\_ES\_OPEN\_SCORE', 4 ); |
| [683](#L683) | } |
| [684](#L684) |  |
| [685](#L685) | if ( ! defined( 'IG\_ES\_CLICK\_SCORE' ) ) { |
| [686](#L686) | define( 'IG\_ES\_CLICK\_SCORE', 1 ); |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | if ( ! defined( 'IG\_ES\_CLASSIC\_EDITOR' ) ) { |
| [690](#L690) | define( 'IG\_ES\_CLASSIC\_EDITOR', 'classic' ); |
| [691](#L691) | } |
| [692](#L692) |  |
| [693](#L693) | if ( ! defined( 'IG\_ES\_DRAG\_AND\_DROP\_EDITOR' ) ) { |
| [694](#L694) | define( 'IG\_ES\_DRAG\_AND\_DROP\_EDITOR', 'drag-and-drop' ); |
| [695](#L695) | } |
| [696](#L696) | } |
| [697](#L697) |  |
| [698](#L698) | /\*\* |
| [699](#L699) | \* Define Constant |
| [700](#L700) | \* |
| [701](#L701) | \* @param $constant |
| [702](#L702) | \* @param $value |
| [703](#L703) | \* |
| [704](#L704) | \* @since 4.2.0 |
| [705](#L705) | \*/ |
| [706](#L706) | public function define( $constant, $value ) { |
| [707](#L707) | if ( ! defined( $constant ) ) { |
| [708](#L708) | define( $constant, $value ); |
| [709](#L709) | } |
| [710](#L710) | } |
| [711](#L711) |  |
| [712](#L712) |  |
| [713](#L713) | /\*\* |
| [714](#L714) | \* Load the required dependencies for this plugin. |
| [715](#L715) | \* |
| [716](#L716) | \* Include the following files that make up the plugin: |
| [717](#L717) | \* |
| [718](#L718) | \* - Email\_Subscribers\_Loader. Orchestrates the hooks of the plugin. |
| [719](#L719) | \* - Email\_Subscribers\_Admin. Defines all hooks for the admin area. |
| [720](#L720) | \* - Email\_Subscribers\_Public. Defines all hooks for the public side of the site. |
| [721](#L721) | \* |
| [722](#L722) | \* Create an instance of the loader which will be used to register the hooks |
| [723](#L723) | \* with WordPress. |
| [724](#L724) | \* |
| [725](#L725) | \* @since    4.0 |
| [726](#L726) | \*/ |
| [727](#L727) | private function load\_dependencies() { |
| [728](#L728) |  |
| [729](#L729) | $files\_to\_load = array( |
| [730](#L730) | 'lite/includes/class-email-subscribers-loader.php', |
| [731](#L731) | 'lite/includes/class-email-subscribers-i18n.php', |
| [732](#L732) |  |
| [733](#L733) | 'lite/includes/classes/class-es-list-table.php', |
| [734](#L734) |  |
| [735](#L735) | // Logs |
| [736](#L736) | 'lite/includes/logs/class-ig-logger-interface.php', |
| [737](#L737) | 'lite/includes/logs/class-ig-log-handler-interface.php', |
| [738](#L738) | 'lite/includes/logs/class-ig-log-handler.php', |
| [739](#L739) | 'lite/includes/logs/log-handlers/class-ig-log-handler-file.php', |
| [740](#L740) | 'lite/includes/logs/class-ig-log-levels.php', |
| [741](#L741) | 'lite/includes/class-ig-logger.php', |
| [742](#L742) |  |
| [743](#L743) | // Admin Notices |
| [744](#L744) | 'lite/includes/notices/class-es-admin-notices.php', |
| [745](#L745) |  |
| [746](#L746) | // Database class files |
| [747](#L747) | 'lite/includes/db/class-es-db.php', |
| [748](#L748) | 'lite/includes/db/class-es-db-queue.php', |
| [749](#L749) | 'lite/includes/db/class-es-db-mailing-queue.php', |
| [750](#L750) | 'lite/includes/db/class-es-db-lists.php', |
| [751](#L751) | 'lite/includes/db/class-es-db-links.php', |
| [752](#L752) | 'lite/includes/db/class-es-db-contacts.php', |
| [753](#L753) | 'lite/includes/db/class-es-db-lists-contacts.php', |
| [754](#L754) | 'lite/includes/db/class-es-db-sending-queue.php', |
| [755](#L755) | 'lite/includes/db/class-es-db-notifications.php', |
| [756](#L756) | 'lite/includes/db/class-es-db-campaigns.php', |
| [757](#L757) | 'lite/includes/db/class-es-db-forms.php', |
| [758](#L758) | 'lite/includes/db/class-es-db-blocked-emails.php', |
| [759](#L759) | 'lite/includes/db/class-es-db-actions.php', |
| [760](#L760) | 'lite/includes/db/class-ig-es-db-unsubscribe-feedback.php', |
| [761](#L761) | 'lite/includes/db/class-ig-es-db-wc-cart.php', |
| [762](#L762) | 'lite/includes/db/class-ig-es-db-wc-guest.php', |
| [763](#L763) | 'lite/includes/db/class-es-db-custom-fields.php', |
| [764](#L764) |  |
| [765](#L765) | // Mailers |
| [766](#L766) | 'lite/includes/mailers/class-es-base-mailer.php', |
| [767](#L767) | 'lite/includes/mailers/class-es-pepipost-mailer.php', |
| [768](#L768) | 'lite/includes/mailers/class-es-phpmail-mailer.php', |
| [769](#L769) | 'lite/includes/mailers/class-es-wpmail-mailer.php', |
| [770](#L770) | 'lite/includes/mailers/class-es-icegram-mailer.php', |
| [771](#L771) |  |
| [772](#L772) | // Common Class |
| [773](#L773) | 'lite/includes/class-es-common.php', |
| [774](#L774) |  |
| [775](#L775) | // Services |
| [776](#L776) | 'lite/includes/services/class-es-services.php', |
| [777](#L777) | 'lite/includes/services/class-es-email-delivery-check.php', |
| [778](#L778) | 'lite/includes/services/class-es-send-test-email.php', |
| [779](#L779) | 'lite/includes/services/class-es-service-spam-score-check.php', |
| [780](#L780) | 'lite/includes/services/class-es-service-handle-cron-data.php', |
| [781](#L781) | 'lite/includes/services/class-es-service-process-email-content.php', |
| [782](#L782) | 'lite/includes/services/class-es-email-auth-header-verify.php', |
| [783](#L783) | 'lite/includes/services/class-es-service-email-sending.php', |
| [784](#L784) | 'lite/includes/services/class-es-service-list-cleanup.php', |
| [785](#L785) |  |
| [786](#L786) | // Classes |
| [787](#L787) | 'lite/includes/classes/class-es-list-table.php', |
| [788](#L788) | 'lite/includes/classes/class-es-cache.php', |
| [789](#L789) | 'lite/includes/classes/class-es-mailer.php', |
| [790](#L790) | 'lite/includes/classes/class-es-message.php', |
| [791](#L791) | 'lite/includes/classes/class-es-lists-table.php', |
| [792](#L792) | 'lite/includes/classes/class-es-contacts-table.php', |
| [793](#L793) | 'lite/includes/classes/class-es-post-notifications.php', |
| [794](#L794) | 'lite/includes/classes/class-es-campaign.php', |
| [795](#L795) | 'lite/includes/classes/class-es-templates-table.php', |
| [796](#L796) | 'lite/includes/classes/class-es-campaigns-table.php', |
| [797](#L797) | 'lite/includes/classes/class-es-drag-and-drop-editor.php', |
| [798](#L798) | 'lite/includes/classes/class-es-reports-table.php', |
| [799](#L799) | 'lite/includes/classes/class-es-reports-data.php', |
| [800](#L800) | 'lite/includes/classes/class-es-forms-table.php', |
| [801](#L801) | 'lite/includes/classes/class-es-queue.php', |
| [802](#L802) | 'lite/includes/classes/class-es-cron.php', |
| [803](#L803) | 'lite/includes/classes/class-es-newsletters.php', |
| [804](#L804) | 'lite/includes/classes/class-es-tools.php', |
| [805](#L805) | 'lite/includes/classes/class-es-admin-settings.php', |
| [806](#L806) | 'lite/includes/classes/class-es-widget.php', |
| [807](#L807) | 'lite/includes/classes/class-es-old-widget.php', |
| [808](#L808) | 'lite/includes/classes/class-es-form-widget.php', |
| [809](#L809) | 'lite/includes/classes/class-es-export-subscribers.php', |
| [810](#L810) | 'lite/includes/classes/class-es-import-subscribers.php', |
| [811](#L811) | 'lite/includes/classes/class-es-campaign-report.php', |
| [812](#L812) | // Start-IG-Code. |
| [813](#L813) | 'lite/includes/classes/class-es-info.php', |
| [814](#L814) | // End-IG-Code. |
| [815](#L815) | 'lite/includes/classes/class-es-handle-post-notification.php', |
| [816](#L816) | 'lite/includes/classes/class-es-handle-subscription.php', |
| [817](#L817) | 'lite/includes/classes/class-es-handle-sync-wp-user.php', |
| [818](#L818) | 'lite/includes/classes/class-es-subscription-throttling.php', |
| [819](#L819) | 'lite/includes/classes/class-es-actions.php', |
| [820](#L820) | 'lite/includes/classes/class-es-tracking.php', |
| [821](#L821) | 'lite/includes/classes/class-es-compatibility.php', |
| [822](#L822) | 'lite/includes/classes/class-es-ig-redirect.php', |
| [823](#L823) | 'lite/includes/classes/class-es-geolocation.php', |
| [824](#L824) | 'lite/includes/classes/class-es-browser.php', |
| [825](#L825) | 'lite/includes/classes/class-ig-es-trial.php', |
| [826](#L826) | 'lite/includes/classes/class-es-mailchimp-api.php', |
| [827](#L827) |  |
| [828](#L828) | // pricing |
| [829](#L829) | 'lite/includes/classes/class-email-subscribers-pricing.php', |
| [830](#L830) |  |
| [831](#L831) | // logs |
| [832](#L832) | 'lite/includes/classes/class-email-subscribers-logs.php', |
| [833](#L833) |  |
| [834](#L834) | // Core Functions |
| [835](#L835) | 'lite/includes/es-core-functions.php', |
| [836](#L836) |  |
| [837](#L837) | // Install/ Update |
| [838](#L838) | 'lite/includes/upgrade/es-update-functions.php', |
| [839](#L839) | 'lite/includes/class-es-install.php', |
| [840](#L840) |  |
| [841](#L841) | // Onboarding process handler class. |
| [842](#L842) | 'lite/admin/class-ig-es-onboarding.php', |
| [843](#L843) |  |
| [844](#L844) | // Public Classes |
| [845](#L845) | 'lite/public/class-email-subscribers-public.php', |
| [846](#L846) | 'lite/admin/partials/admin-header.php', |
| [847](#L847) | 'lite/public/partials/class-es-shortcode.php', |
| [848](#L848) |  |
| [849](#L849) | // Start-IG-Code. |
| [850](#L850) | // Backward Compatibility. |
| [851](#L851) | 'lite/includes/es-backward.php', |
| [852](#L852) | // End-IG-Code. |
| [853](#L853) | 'lite/admin/class-email-subscribers-admin.php', |
| [854](#L854) |  |
| [855](#L855) | // Start-IG-Code. |
| [856](#L856) | // Pro Feature |
| [857](#L857) | 'lite/includes/pro-features.php', |
| [858](#L858) | // End-IG-Code. |
| [859](#L859) |  |
| [860](#L860) | // Feedback Class |
| [861](#L861) | 'lite/includes/feedback/class-ig-tracker.php', |
| [862](#L862) | // Start-IG-Code. |
| [863](#L863) | 'lite/includes/feedback/class-ig-feedback.php', |
| [864](#L864) | 'lite/includes/feedback/class-ig-plugin-usage-tracker.php', |
| [865](#L865) | 'lite/includes/class-es-plugin-usage-data-collector.php', |
| [866](#L866) | 'lite/includes/feedback.php', |
| [867](#L867) | // End-IG-Code. |
| [868](#L868) |  |
| [869](#L869) | // WC session tracking |
| [870](#L870) | 'lite/includes/classes/class-ig-es-wc-session-tracker.php', |
| [871](#L871) | 'lite/includes/classes/ig-es-wc-cookies.php', |
| [872](#L872) |  |
| [873](#L873) | // Workflows |
| [874](#L874) | 'lite/includes/workflows/db/class-es-db-workflows.php', |
| [875](#L875) | 'lite/includes/workflows/db/class-es-db-workflows-queue.php', |
| [876](#L876) | 'lite/includes/workflows/class-es-workflows-table.php', |
| [877](#L877) | 'lite/includes/workflows/class-es-workflow-gallery.php', |
| [878](#L878) |  |
| [879](#L879) | // Workflow Abstracts |
| [880](#L880) | 'lite/includes/workflows/abstracts/class-es-workflow-registry.php', |
| [881](#L881) | 'lite/includes/workflows/abstracts/class-es-workflow-trigger.php', |
| [882](#L882) | 'lite/includes/workflows/abstracts/class-es-workflow-rule.php', |
| [883](#L883) | 'lite/includes/workflows/abstracts/class-es-workflow-action.php', |
| [884](#L884) | 'lite/includes/workflows/abstracts/class-es-workflow-data-type.php', |
| [885](#L885) | 'lite/includes/workflows/abstracts/class-ig-es-workflow-variable.php', |
| [886](#L886) |  |
| [887](#L887) | // Workflow Utility |
| [888](#L888) | 'lite/includes/workflows/class-es-clean.php', |
| [889](#L889) | 'lite/includes/workflows/class-es-format.php', |
| [890](#L890) | 'lite/includes/workflows/class-es-workflow-time-helper.php', |
| [891](#L891) | 'lite/includes/workflows/class-es-workflow-datetime.php', |
| [892](#L892) | 'lite/includes/workflows/class-ig-es-variables-processor.php', |
| [893](#L893) | 'lite/includes/workflows/class-ig-es-workflow-variable-parser.php', |
| [894](#L894) | 'lite/includes/workflows/class-ig-es-variables.php', |
| [895](#L895) | 'lite/includes/workflows/class-ig-es-replace-helper.php', |
| [896](#L896) | 'lite/includes/workflows/workflow-helper-functions.php', |
| [897](#L897) |  |
| [898](#L898) | // Workflow |
| [899](#L899) | 'lite/includes/workflows/class-es-workflow.php', |
| [900](#L900) | 'lite/includes/workflows/class-es-workflow-factory.php', |
| [901](#L901) |  |
| [902](#L902) | // Data Types |
| [903](#L903) | 'lite/includes/workflows/data-types/abstracts/class-es-data-type-form-data.php', |
| [904](#L904) | 'lite/includes/workflows/data-types/class-es-data-type-user.php', |
| [905](#L905) | 'lite/includes/workflows/data-types/class-es-data-type-subscriber.php', |
| [906](#L906) | 'lite/includes/workflows/data-types/class-es-data-type-campaign.php', |
| [907](#L907) | 'lite/includes/workflows/class-es-workflow-data-types.php', |
| [908](#L908) |  |
| [909](#L909) | 'lite/includes/workflows/variables/class-es-workflow-data-types.php', |
| [910](#L910) |  |
| [911](#L911) | // Data Layer |
| [912](#L912) | 'lite/includes/workflows/class-es-workflow-data-layer.php', |
| [913](#L913) |  |
| [914](#L914) | // Workflow Fields |
| [915](#L915) | 'lite/includes/workflows/fields/class-es-field.php', |
| [916](#L916) | 'lite/includes/workflows/fields/class-es-text.php', |
| [917](#L917) | 'lite/includes/workflows/fields/class-es-date.php', |
| [918](#L918) | 'lite/includes/workflows/fields/class-es-number.php', |
| [919](#L919) | 'lite/includes/workflows/fields/class-es-time.php', |
| [920](#L920) | 'lite/includes/workflows/fields/class-es-select.php', |
| [921](#L921) | 'lite/includes/workflows/fields/class-es-checkbox.php', |
| [922](#L922) | 'lite/includes/workflows/fields/class-es-wp-editor.php', |
| [923](#L923) | 'lite/includes/workflows/fields/class-es-hidden-field.php', |
| [924](#L924) |  |
| [925](#L925) | // Workflow Admin |
| [926](#L926) | 'lite/includes/workflows/admin/class-es-workflow-admin.php', |
| [927](#L927) | 'lite/includes/workflows/admin/class-es-workflow-admin-edit.php', |
| [928](#L928) | 'lite/includes/workflows/admin/class-es-workflow-admin-ajax.php', |
| [929](#L929) |  |
| [930](#L930) | // Workflow Triggers. |
| [931](#L931) | 'lite/includes/workflows/triggers/abstracts/class-es-trigger-form-submitted.php', |
| [932](#L932) | 'lite/includes/workflows/triggers/class-es-trigger-user-registered.php', |
| [933](#L933) | 'lite/includes/workflows/triggers/class-es-trigger-user-deleted.php', |
| [934](#L934) | 'lite/includes/workflows/triggers/class-es-trigger-user-updated.php', |
| [935](#L935) | 'lite/includes/workflows/triggers/class-es-trigger-user-subscribed.php', |
| [936](#L936) | 'lite/includes/workflows/triggers/class-es-trigger-user-unconfirmed.php', |
| [937](#L937) | 'lite/includes/workflows/triggers/class-es-trigger-user-unsubscribed.php', |
| [938](#L938) | 'lite/includes/workflows/triggers/class-es-trigger-campaign-sent.php', |
| [939](#L939) | 'lite/includes/workflows/triggers/class-es-trigger-campaign-failed.php', |
| [940](#L940) | 'lite/includes/workflows/class-es-workflow-triggers.php', |
| [941](#L941) |  |
| [942](#L942) | // rest api |
| [943](#L943) | 'lite/includes/rest-api/class-es-rest-api-handler.php', |
| [944](#L944) |  |
| [945](#L945) | // Icegram site's weekly email summary automation |
| [946](#L946) | 'lite/admin/class-es-newsletter-summary-automation.php', |
| [947](#L947) |  |
| [948](#L948) | // Abstracts workflow actions |
| [949](#L949) | 'lite/includes/workflows/actions/abstracts/class-ig-es-action-send-email-abstract.php', |
| [950](#L950) |  |
| [951](#L951) | // Workflow Actions. |
| [952](#L952) | 'lite/includes/workflows/actions/class-es-action-add-to-list.php', |
| [953](#L953) | 'lite/includes/workflows/actions/class-es-action-move-contact.php', |
| [954](#L954) | 'lite/includes/workflows/actions/class-es-action-remove-contact.php', |
| [955](#L955) | 'lite/includes/workflows/actions/class-es-action-delete-contact.php', |
| [956](#L956) | 'lite/includes/workflows/actions/class-es-action-update-contact.php', |
| [957](#L957) | 'lite/includes/workflows/actions/class-es-action-send-email.php', |
| [958](#L958) | 'lite/includes/workflows/class-es-workflow-actions.php', |
| [959](#L959) | 'lite/includes/workflows/class-es-workflow-action-preview.php', |
| [960](#L960) |  |
| [961](#L961) | // Abstracts workflow rules |
| [962](#L962) | 'lite/includes/workflows/rules/abstracts/class-es-rule-select-abstract.php', |
| [963](#L963) | 'lite/includes/workflows/rules/abstracts/class-es-rule-searchable-select-abstract.php', |
| [964](#L964) | 'lite/includes/workflows/rules/abstracts/class-es-rule-preloaded-select-abstract.php', |
| [965](#L965) | 'lite/includes/workflows/rules/abstracts/class-es-rule-product-select-abstract.php', |
| [966](#L966) | 'lite/includes/workflows/rules/abstracts/class-es-rule-number-abstract.php', |
| [967](#L967) |  |
| [968](#L968) | // Workflow Rules |
| [969](#L969) | 'lite/includes/workflows/class-es-workflow-rules.php', |
| [970](#L970) |  |
| [971](#L971) | // Workflow Query |
| [972](#L972) | 'lite/includes/workflows/class-es-workflow-query.php', |
| [973](#L973) |  |
| [974](#L974) | // Workflow Queue |
| [975](#L975) | 'lite/includes/workflows/queue/class-es-workflow-queue.php', |
| [976](#L976) | 'lite/includes/workflows/queue/class-es-workflow-queue-factory.php', |
| [977](#L977) | 'lite/includes/workflows/queue/class-es-workflow-queue-handler.php', |
| [978](#L978) |  |
| [979](#L979) | // Workflow Loader |
| [980](#L980) | 'lite/includes/workflows/class-es-workflow-loader.php', |
| [981](#L981) |  |
| [982](#L982) | // Premium services ui components. |
| [983](#L983) | 'lite/includes/premium-services-ui/class-ig-es-premium-services-ui.php', |
| [984](#L984) |  |
| [985](#L985) | // Background Process Helper |
| [986](#L986) | 'lite/includes/classes/class-ig-es-background-process-helper.php', |
| [987](#L987) |  |
| [988](#L988) | // Subscribers Query |
| [989](#L989) | 'lite/includes/classes/class-ig-es-subscriber-query.php', |
| [990](#L990) |  |
| [991](#L991) | // Recipient rules |
| [992](#L992) | 'lite/includes/recipient-rules/rules/abstracts/class-es-recipient-rule.php', |
| [993](#L993) | 'lite/includes/recipient-rules/rules/abstracts/class-es-recipient-rule-boolean.php', |
| [994](#L994) | 'lite/includes/recipient-rules/rules/class-es-recipient-rule-list.php', |
| [995](#L995) | 'lite/includes/recipient-rules/class-es-recipient-rules.php', |
| [996](#L996) |  |
| [997](#L997) | // Compatibilities |
| [998](#L998) | 'lite/includes/compatibilities/elementor/class-ig-es-compatibility.php', |
| [999](#L999) |  |
| [1000](#L1000) | 'lite/admin/class-es-dashboard.php', |
| [1001](#L1001) | 'lite/admin/class-ig-es-campaign-rules.php', |
| [1002](#L1002) | 'lite/admin/class-es-admin.php', |
| [1003](#L1003) | 'lite/admin/class-es-campaign-admin.php', |
| [1004](#L1004) | 'lite/admin/class-es-template-admin.php', |
| [1005](#L1005) | 'lite/admin/class-es-gallery.php', |
| [1006](#L1006) |  |
| [1007](#L1007) | 'lite/admin/class-es-form-admin.php', |
| [1008](#L1008) | 'lite/admin/class-es-gb-subscription-form-block.php', |
| [1009](#L1009) |  |
| [1010](#L1010) | 'lite/admin/class-es-rest-api-admin.php', |
| [1011](#L1011) | 'lite/includes/classes/class-es-router.php', |
| [1012](#L1012) | 'lite/includes/controllers/class-es-campaign-controller.php', |
| [1013](#L1013) | 'lite/includes/controllers/class-es-campaigns-controller.php', |
| [1014](#L1014) | 'lite/includes/controllers/class-es-gallery-controller.php', |
| [1015](#L1015) | 'lite/includes/controllers/class-es-template-controller.php', |
| [1016](#L1016) |  |
| [1017](#L1017) | 'starter/starter-class-email-subscribers.php', |
| [1018](#L1018) | 'pro/pro-class-email-subscribers.php', |
| [1019](#L1019) |  |
| [1020](#L1020) | ); |
| [1021](#L1021) |  |
| [1022](#L1022) | foreach ( $files\_to\_load as $file ) { |
| [1023](#L1023) | if ( is\_file( ES\_PLUGIN\_DIR . $file ) ) { |
| [1024](#L1024) | require\_once ES\_PLUGIN\_DIR . $file; |
| [1025](#L1025) | } |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | add\_shortcode( 'email-subscribers', array( 'ES\_Shortcode', 'render\_es\_subscription\_shortcode' ) ); |
| [1029](#L1029) | add\_shortcode( 'email-subscribers-advanced-form', array( 'ES\_Shortcode', 'render\_es\_advanced\_form' ) ); |
| [1030](#L1030) | add\_shortcode( 'email-subscribers-form', array( 'ES\_Shortcode', 'render\_es\_form' ) ); |
| [1031](#L1031) |  |
| [1032](#L1032) | $this->loader = new Email\_Subscribers\_Loader(); |
| [1033](#L1033) |  |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | /\*\* |
| [1037](#L1037) | \* Set Localization. |
| [1038](#L1038) | \* |
| [1039](#L1039) | \* @since   1.0.0 |
| [1040](#L1040) | \*/ |
| [1041](#L1041) | private function set\_locale() { |
| [1042](#L1042) |  |
| [1043](#L1043) | $plugin\_i18n = new Email\_Subscribers\_I18n(); |
| [1044](#L1044) |  |
| [1045](#L1045) | $this->loader->add\_action( 'plugins\_loaded', $plugin\_i18n, 'load\_plugin\_textdomain' ); |
| [1046](#L1046) | } |
| [1047](#L1047) |  |
| [1048](#L1048) | /\*\* |
| [1049](#L1049) | \* Register all of the hooks related to the admin area functionality |
| [1050](#L1050) | \* of the plugin. |
| [1051](#L1051) | \* |
| [1052](#L1052) | \* @since    4.0 |
| [1053](#L1053) | \*/ |
| [1054](#L1054) | private function define\_admin\_hooks() { |
| [1055](#L1055) |  |
| [1056](#L1056) | $plugin\_admin = new Email\_Subscribers\_Admin( $this->get\_email\_subscribers(), $this->get\_version() ); |
| [1057](#L1057) |  |
| [1058](#L1058) | $this->loader->add\_action( 'admin\_enqueue\_scripts', $plugin\_admin, 'enqueue\_styles' ); |
| [1059](#L1059) | $this->loader->add\_action( 'admin\_enqueue\_scripts', $plugin\_admin, 'enqueue\_scripts' ); |
| [1060](#L1060) | $this->loader->add\_action( 'plugins\_loaded', $plugin\_admin, 'plugins\_loaded' ); |
| [1061](#L1061) |  |
| [1062](#L1062) | $this->loader->add\_filter( 'set-screen-option', $plugin\_admin, 'save\_screen\_options', 20, 3 ); |
| [1063](#L1063) | $this->loader->add\_action( 'wp\_ajax\_count\_contacts\_by\_list', $plugin\_admin, 'count\_contacts\_by\_list' ); |
| [1064](#L1064) | $this->loader->add\_action( 'admin\_print\_scripts', $plugin\_admin, 'remove\_other\_admin\_notices' ); |
| [1065](#L1065) |  |
| [1066](#L1066) | // Start-IG-Code. |
| [1067](#L1067) | $this->loader->add\_filter( 'admin\_footer\_text', $plugin\_admin, 'update\_admin\_footer\_text' ); |
| [1068](#L1068) | // End-IG-Code. |
| [1069](#L1069) | } |
| [1070](#L1070) |  |
| [1071](#L1071) | /\*\* |
| [1072](#L1072) | \* Register all of the hooks related to the public-facing functionality |
| [1073](#L1073) | \* of the plugin. |
| [1074](#L1074) | \* |
| [1075](#L1075) | \* @since    4.0 |
| [1076](#L1076) | \*/ |
| [1077](#L1077) | private function define\_public\_hooks() { |
| [1078](#L1078) |  |
| [1079](#L1079) | $plugin\_public = new Email\_Subscribers\_Public( $this->get\_email\_subscribers(), $this->get\_version() ); |
| [1080](#L1080) |  |
| [1081](#L1081) | $this->loader->add\_action( 'wp\_enqueue\_scripts', $plugin\_public, 'enqueue\_styles' ); |
| [1082](#L1082) | $this->loader->add\_action( 'wp\_enqueue\_scripts', $plugin\_public, 'enqueue\_scripts' ); |
| [1083](#L1083) | $this->loader->add\_action( 'init', $plugin\_public, 'es\_email\_subscribe\_init' ); |
| [1084](#L1084) | $this->loader->add\_action( 'ig\_es\_add\_contact', $plugin\_public, 'add\_contact', 10, 2 ); |
| [1085](#L1085) | $this->loader->add\_action( 'ig\_es\_confirm\_unsubscription', $plugin\_public, 'confirm\_unsubscription', 10, 2 ); |
| [1086](#L1086) |  |
| [1087](#L1087) | $this->loader->add\_filter( 'es\_template\_type', $plugin\_public, 'add\_template\_type', 9 ); |
| [1088](#L1088) | } |
| [1089](#L1089) |  |
| [1090](#L1090) | /\*\* |
| [1091](#L1091) | \* Run the loader to execute all of the hooks with WordPress. |
| [1092](#L1092) | \* |
| [1093](#L1093) | \* @since    4.0 |
| [1094](#L1094) | \*/ |
| [1095](#L1095) | public function run() { |
| [1096](#L1096) | $this->loader->run(); |
| [1097](#L1097) | } |
| [1098](#L1098) |  |
| [1099](#L1099) | /\*\* |
| [1100](#L1100) | \* The name of the plugin used to uniquely identify it within the context of |
| [1101](#L1101) | \* WordPress and to define internationalization functionality. |
| [1102](#L1102) | \* |
| [1103](#L1103) | \* @return    string    The name of the plugin. |
| [1104](#L1104) | \* @since     4.0 |
| [1105](#L1105) | \*/ |
| [1106](#L1106) | public function get\_email\_subscribers() { |
| [1107](#L1107) | return $this->email\_subscribers; |
| [1108](#L1108) | } |
| [1109](#L1109) |  |
| [1110](#L1110) | /\*\* |
| [1111](#L1111) | \* The reference to the class that orchestrates the hooks with the plugin. |
| [1112](#L1112) | \* |
| [1113](#L1113) | \* @return    Email\_Subscribers\_Loader    Orchestrates the hooks of the plugin. |
| [1114](#L1114) | \* @since     4.0 |
| [1115](#L1115) | \*/ |
| [1116](#L1116) | public function get\_loader() { |
| [1117](#L1117) | return $this->loader; |
| [1118](#L1118) | } |
| [1119](#L1119) |  |
| [1120](#L1120) | /\*\* |
| [1121](#L1121) | \* Retrieve the version number of the plugin. |
| [1122](#L1122) | \* |
| [1123](#L1123) | \* @return    string    The version number of the plugin. |
| [1124](#L1124) | \* @since     4.0 |
| [1125](#L1125) | \*/ |
| [1126](#L1126) | public function get\_version() { |
| [1127](#L1127) | return $this->version; |
| [1128](#L1128) | } |
| [1129](#L1129) |  |
| [1130](#L1130) | /\*\* |
| [1131](#L1131) | \* Method to validate a premium service request |
| [1132](#L1132) | \* |
| [1133](#L1133) | \* @param array $service Request |
| [1134](#L1134) | \* |
| [1135](#L1135) | \* @return bool |
| [1136](#L1136) | \* |
| [1137](#L1137) | \* @since 4.6.1 |
| [1138](#L1138) | \*/ |
| [1139](#L1139) | public function validate\_service\_request( $services = array() ) { |
| [1140](#L1140) | $is\_request\_valid = false; |
| [1141](#L1141) |  |
| [1142](#L1142) | // Check if trial is still valid. |
| [1143](#L1143) | if ( ES()->trial->is\_trial\_valid() ) { |
| [1144](#L1144) | $is\_request\_valid = true; |
| [1145](#L1145) | } elseif ( $this->is\_premium() ) { |
| [1146](#L1146) | $es\_services = $this->get\_es\_services(); |
| [1147](#L1147) | if ( ! empty( $es\_services ) ) { |
| [1148](#L1148) | // Check if there is not any invalid service in $services array which is not present in the $es\_services. |
| [1149](#L1149) | $invalid\_services = array\_diff( $services, $es\_services ); |
| [1150](#L1150) | if ( empty( $invalid\_services ) ) { |
| [1151](#L1151) | $is\_request\_valid = true; |
| [1152](#L1152) | } |
| [1153](#L1153) | } |
| [1154](#L1154) | } |
| [1155](#L1155) |  |
| [1156](#L1156) | return $is\_request\_valid; |
| [1157](#L1157) | } |
| [1158](#L1158) |  |
| [1159](#L1159) | /\*\* |
| [1160](#L1160) | \* Get registered services |
| [1161](#L1161) | \* |
| [1162](#L1162) | \* @since 5.6.1 |
| [1163](#L1163) | \* |
| [1164](#L1164) | \* @return array $es\_services |
| [1165](#L1165) | \*/ |
| [1166](#L1166) | public function get\_es\_services() { |
| [1167](#L1167) | $es\_services = apply\_filters( 'ig\_es\_services', array() ); |
| [1168](#L1168) | return $es\_services; |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) | /\*\* |
| [1172](#L1172) | \* Is ES PRO? |
| [1173](#L1173) | \* |
| [1174](#L1174) | \* @return bool |
| [1175](#L1175) | \* |
| [1176](#L1176) | \* @since 4.3.0 |
| [1177](#L1177) | \*/ |
| [1178](#L1178) | public function is\_pro() { |
| [1179](#L1179) | return file\_exists( ES\_PLUGIN\_DIR . 'pro/pro-class-email-subscribers.php' ); |
| [1180](#L1180) | } |
| [1181](#L1181) |  |
| [1182](#L1182) | /\*\* |
| [1183](#L1183) | \* Is ES Starter? |
| [1184](#L1184) | \* |
| [1185](#L1185) | \* @return bool |
| [1186](#L1186) | \* |
| [1187](#L1187) | \* @since 4.3.0 |
| [1188](#L1188) | \*/ |
| [1189](#L1189) | public function is\_starter() { |
| [1190](#L1190) | return file\_exists( ES\_PLUGIN\_DIR . 'starter/starter-class-email-subscribers.php' ); |
| [1191](#L1191) | } |
| [1192](#L1192) |  |
| [1193](#L1193) | /\*\* |
| [1194](#L1194) | \* Is ES Premium? |
| [1195](#L1195) | \* |
| [1196](#L1196) | \* @return bool |
| [1197](#L1197) | \* |
| [1198](#L1198) | \* @since 4.4.4 |
| [1199](#L1199) | \*/ |
| [1200](#L1200) | public function is\_premium() { |
| [1201](#L1201) | return ES()->is\_starter() || ES()->is\_pro(); |
| [1202](#L1202) | } |
| [1203](#L1203) |  |
| [1204](#L1204) | /\*\* |
| [1205](#L1205) | \* Check whether ES premium activated |
| [1206](#L1206) | \* |
| [1207](#L1207) | \* @return mixed |
| [1208](#L1208) | \* |
| [1209](#L1209) | \* @since 4.4.8 |
| [1210](#L1210) | \*/ |
| [1211](#L1211) | public function is\_premium\_activated() { |
| [1212](#L1212) | global $ig\_es\_tracker; |
| [1213](#L1213) |  |
| [1214](#L1214) | $plugin = 'email-subscribers-premium/email-subscribers-premium.php'; |
| [1215](#L1215) |  |
| [1216](#L1216) | return $ig\_es\_tracker::is\_plugin\_activated( $plugin ); |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) | /\*\* |
| [1220](#L1220) | \* Check whether ES Premium Installed |
| [1221](#L1221) | \* |
| [1222](#L1222) | \* @return mixed |
| [1223](#L1223) | \* |
| [1224](#L1224) | \* @since 4.4.8 |
| [1225](#L1225) | \*/ |
| [1226](#L1226) | public function is\_premium\_installed() { |
| [1227](#L1227) | global $ig\_es\_tracker; |
| [1228](#L1228) |  |
| [1229](#L1229) | $plugin = 'email-subscribers-premium/email-subscribers-premium.php'; |
| [1230](#L1230) |  |
| [1231](#L1231) | return $ig\_es\_tracker::is\_plugin\_installed( $plugin ); |
| [1232](#L1232) | } |
| [1233](#L1233) |  |
| [1234](#L1234) | /\*\* |
| [1235](#L1235) | \* Check whether ES Pro features can be upselled or not |
| [1236](#L1236) | \* |
| [1237](#L1237) | \* @return bool |
| [1238](#L1238) | \* |
| [1239](#L1239) | \* @since 4.6.1 |
| [1240](#L1240) | \*/ |
| [1241](#L1241) | public function can\_upsell\_features( $show\_for\_plans = array() ) { |
| [1242](#L1242) | $es\_current\_plan = $this->get\_plan(); |
| [1243](#L1243) | if ( in\_array( $es\_current\_plan, $show\_for\_plans ) ) { |
| [1244](#L1244) | return true; |
| [1245](#L1245) | } |
| [1246](#L1246) | return false; |
| [1247](#L1247) | } |
| [1248](#L1248) |  |
| [1249](#L1249) | /\*\* |
| [1250](#L1250) | \* Get all ES admin screens |
| [1251](#L1251) | \* |
| [1252](#L1252) | \* @return array|mixed|void |
| [1253](#L1253) | \* |
| [1254](#L1254) | \* @since 4.3.8 |
| [1255](#L1255) | \*/ |
| [1256](#L1256) | public function get\_es\_admin\_screens() { |
| [1257](#L1257) |  |
| [1258](#L1258) | // TODO: Can be updated with a version check when https://core.trac.wordpress.org/ticket/18857 is fixed |
| [1259](#L1259) | $prefix = $this->get\_admin\_page\_prefix(); |
| [1260](#L1260) |  |
| [1261](#L1261) | $screens = array( |
| [1262](#L1262) | 'es\_template', |
| [1263](#L1263) | 'edit-es\_template', |
| [1264](#L1264) | 'admin\_page\_es\_template', |
| [1265](#L1265) | 'toplevel\_page\_es\_dashboard', |
| [1266](#L1266) | 'admin\_page\_go\_to\_icegram', |
| [1267](#L1267) | "{$prefix}\_page\_es\_subscribers", |
| [1268](#L1268) | "{$prefix}\_page\_es\_lists", |
| [1269](#L1269) | "{$prefix}\_page\_es\_forms", |
| [1270](#L1270) | "{$prefix}\_page\_es\_campaigns", |
| [1271](#L1271) | "{$prefix}\_page\_es\_workflows", |
| [1272](#L1272) | "{$prefix}\_page\_es\_newsletters", |
| [1273](#L1273) | "{$prefix}\_page\_es\_notifications", |
| [1274](#L1274) | "{$prefix}\_page\_es\_reports", |
| [1275](#L1275) | "{$prefix}\_page\_es\_logs", |
| [1276](#L1276) | "{$prefix}\_page\_es\_settings", |
| [1277](#L1277) | "{$prefix}\_page\_es\_tools", |
| [1278](#L1278) | "{$prefix}\_page\_es\_general\_information", |
| [1279](#L1279) | "{$prefix}\_page\_es\_pricing", |
| [1280](#L1280) | "{$prefix}\_page\_es\_sequence", |
| [1281](#L1281) | "{$prefix}\_page\_es\_custom\_fields", |
| [1282](#L1282) | "{$prefix}\_page\_es\_templates", |
| [1283](#L1283) | "{$prefix}\_page\_es\_gallery", |
| [1284](#L1284) | ); |
| [1285](#L1285) |  |
| [1286](#L1286) | $screens = apply\_filters( 'ig\_es\_admin\_screens', $screens ); |
| [1287](#L1287) |  |
| [1288](#L1288) | return $screens; |
| [1289](#L1289) | } |
| [1290](#L1290) |  |
| [1291](#L1291) | /\*\* |
| [1292](#L1292) | \* Is es admin screen? |
| [1293](#L1293) | \* |
| [1294](#L1294) | \* @param string $screen\_id Admin screen id |
| [1295](#L1295) | \* |
| [1296](#L1296) | \* @return bool |
| [1297](#L1297) | \* |
| [1298](#L1298) | \* @since 4.3.8 |
| [1299](#L1299) | \*/ |
| [1300](#L1300) | public function is\_es\_admin\_screen( $screen\_id = '' ) { |
| [1301](#L1301) |  |
| [1302](#L1302) | $current\_screen\_id = $this->get\_current\_screen\_id(); |
| [1303](#L1303) | // Check for specific admin screen id if passed. |
| [1304](#L1304) | if ( ! empty( $screen\_id ) ) { |
| [1305](#L1305) | if ( $current\_screen\_id === $screen\_id ) { |
| [1306](#L1306) | return true; |
| [1307](#L1307) | } else { |
| [1308](#L1308) | return false; |
| [1309](#L1309) | } |
| [1310](#L1310) | } |
| [1311](#L1311) |  |
| [1312](#L1312) | $es\_admin\_screens = $this->get\_es\_admin\_screens(); |
| [1313](#L1313) | if ( in\_array( $current\_screen\_id, $es\_admin\_screens ) ) { |
| [1314](#L1314) | return true; |
| [1315](#L1315) | } |
| [1316](#L1316) |  |
| [1317](#L1317) | return false; |
| [1318](#L1318) | } |
| [1319](#L1319) |  |
| [1320](#L1320) | /\*\* |
| [1321](#L1321) | \* Get Current Screen Id |
| [1322](#L1322) | \* |
| [1323](#L1323) | \* @return string |
| [1324](#L1324) | \* |
| [1325](#L1325) | \* @since 4.3.8 |
| [1326](#L1326) | \*/ |
| [1327](#L1327) | public function get\_current\_screen\_id() { |
| [1328](#L1328) |  |
| [1329](#L1329) | $current\_screen = function\_exists( 'get\_current\_screen' ) ? get\_current\_screen() : false; |
| [1330](#L1330) |  |
| [1331](#L1331) | if ( ! $current\_screen instanceof WP\_Screen ) { |
| [1332](#L1332) | return ''; |
| [1333](#L1333) | } |
| [1334](#L1334) |  |
| [1335](#L1335) | $current\_screen = get\_current\_screen(); |
| [1336](#L1336) |  |
| [1337](#L1337) | return ( $current\_screen ? $current\_screen->id : '' ); |
| [1338](#L1338) | } |
| [1339](#L1339) |  |
| [1340](#L1340) | /\*\* |
| [1341](#L1341) | \* Check if the current user is admin |
| [1342](#L1342) | \* |
| [1343](#L1343) | \* @return bool |
| [1344](#L1344) | \* |
| [1345](#L1345) | \* @since 4.4.2 |
| [1346](#L1346) | \*/ |
| [1347](#L1347) | public function is\_current\_user\_administrator() { |
| [1348](#L1348) | return current\_user\_can( 'administrator' ); |
| [1349](#L1349) | } |
| [1350](#L1350) |  |
| [1351](#L1351) | /\*\* |
| [1352](#L1352) | \* Register Widget Class |
| [1353](#L1353) | \* |
| [1354](#L1354) | \* @since 4.0.0 |
| [1355](#L1355) | \*/ |
| [1356](#L1356) | public function register\_es\_widget() { |
| [1357](#L1357) | register\_widget( 'ES\_Form\_Widget' ); |
| [1358](#L1358) | } |
| [1359](#L1359) |  |
| [1360](#L1360) | /\*\* |
| [1361](#L1361) | \* Log Fatal Errors on Shutdown |
| [1362](#L1362) | \* |
| [1363](#L1363) | \* @since 4.3.1 |
| [1364](#L1364) | \*/ |
| [1365](#L1365) | public function log\_errors() { |
| [1366](#L1366) | $error = error\_get\_last(); |
| [1367](#L1367) | if ( in\_array( $error['type'], array( E\_ERROR, E\_PARSE, E\_COMPILE\_ERROR, E\_USER\_ERROR, E\_RECOVERABLE\_ERROR ), true ) ) { |
| [1368](#L1368) | $logger = get\_ig\_logger(); |
| [1369](#L1369) | $logger->critical( |
| [1370](#L1370) | /\* translators: 1: Error message 2: File name  3: Line number \*/ |
| [1371](#L1371) | sprintf( esc\_html\_\_( '%1$s in %2$s on line %3$s', 'email-subscribers' ), $error['message'], $error['file'], $error['line'] ) . PHP\_EOL, |
| [1372](#L1372) | array( |
| [1373](#L1373) | 'source' => 'fatal-errors', |
| [1374](#L1374) | ) |
| [1375](#L1375) | ); |
| [1376](#L1376) |  |
| [1377](#L1377) | do\_action( 'ig\_es\_shutdown\_error', $error ); |
| [1378](#L1378) | } |
| [1379](#L1379) | } |
| [1380](#L1380) |  |
| [1381](#L1381) | /\*\* |
| [1382](#L1382) | \* Return a true instance of a class |
| [1383](#L1383) | \* |
| [1384](#L1384) | \* @return Email\_Subscribers |
| [1385](#L1385) | \* |
| [1386](#L1386) | \* @since 4.2.1 |
| [1387](#L1387) | \*/ |
| [1388](#L1388) | public static function instance() { |
| [1389](#L1389) | if ( ! isset( self::$instance ) && ! ( self::$instance instanceof Email\_Subscribers ) ) { |
| [1390](#L1390) | global $wpdb, $ig\_es\_feedback, $ig\_es\_tracker, $wpbd; |
| [1391](#L1391) |  |
| [1392](#L1392) | $wpbd = $wpdb; |
| [1393](#L1393) |  |
| [1394](#L1394) | self::$instance = new Email\_Subscribers(); |
| [1395](#L1395) |  |
| [1396](#L1396) | require\_once plugin\_dir\_path( \_\_FILE\_\_ ) . 'class-email-subscribers-activator.php'; |
| [1397](#L1397) | require\_once plugin\_dir\_path( \_\_FILE\_\_ ) . 'class-email-subscribers-deactivator.php'; |
| [1398](#L1398) |  |
| [1399](#L1399) | // Start-IG-Code. |
| [1400](#L1400) | require\_once plugin\_dir\_path( \_\_FILE\_\_ ) . 'libraries/action-scheduler/action-scheduler.php'; |
| [1401](#L1401) | // End-IG-Code. |
| [1402](#L1402) |  |
| [1403](#L1403) | self::$instance->email\_subscribers = 'email-subscribers'; |
| [1404](#L1404) |  |
| [1405](#L1405) | self::$instance->define\_constants(); |
| [1406](#L1406) | self::$instance->load\_dependencies(); |
| [1407](#L1407) | self::$instance->set\_locale(); |
| [1408](#L1408) | self::$instance->define\_admin\_hooks(); |
| [1409](#L1409) | self::$instance->define\_public\_hooks(); |
| [1410](#L1410) |  |
| [1411](#L1411) | self::$instance->logger = get\_ig\_logger(); |
| [1412](#L1412) |  |
| [1413](#L1413) | self::$instance->mailer = new ES\_Mailer(); |
| [1414](#L1414) |  |
| [1415](#L1415) | add\_action( 'widgets\_init', array( self::$instance, 'register\_es\_widget' ) ); |
| [1416](#L1416) |  |
| [1417](#L1417) | self::$instance->queue\_db          = new ES\_DB\_Queue(); |
| [1418](#L1418) | self::$instance->actions\_db        = new ES\_DB\_Actions(); |
| [1419](#L1419) | self::$instance->campaigns\_db      = new ES\_DB\_Campaigns(); |
| [1420](#L1420) | self::$instance->lists\_db          = new ES\_DB\_Lists(); |
| [1421](#L1421) | self::$instance->forms\_db          = new ES\_DB\_Forms(); |
| [1422](#L1422) | self::$instance->contacts\_db       = new ES\_DB\_Contacts(); |
| [1423](#L1423) | self::$instance->lists\_contacts\_db = new ES\_DB\_Lists\_Contacts(); |
| [1424](#L1424) | self::$instance->blocked\_emails\_db = new ES\_DB\_Blocked\_Emails(); |
| [1425](#L1425) | self::$instance->links\_db          = new ES\_DB\_Links(); |
| [1426](#L1426) | self::$instance->queue             = new ES\_Queue(); |
| [1427](#L1427) | self::$instance->actions           = new ES\_Actions(); |
| [1428](#L1428) | self::$instance->cron              = new ES\_Cron(); |
| [1429](#L1429) | self::$instance->compatibiloty     = new ES\_Compatibility(); |
| [1430](#L1430) | self::$instance->workflows\_db      = new ES\_DB\_Workflows(); |
| [1431](#L1431) | self::$instance->carts\_db          = new IG\_ES\_DB\_WC\_Cart(); |
| [1432](#L1432) | self::$instance->trial             = new IG\_ES\_Trial(); |
| [1433](#L1433) | self::$instance->custom\_fields\_db  = new ES\_DB\_Custom\_Fields(); |
| [1434](#L1434) |  |
| [1435](#L1435) | // Start-IG-Code. |
| [1436](#L1436) | $name         = 'Icegram Express'; |
| [1437](#L1437) | $plugin       = 'email-subscribers'; |
| [1438](#L1438) | $plugin\_abbr  = 'ig\_es'; |
| [1439](#L1439) | $plugin\_plan  = self::$instance->get\_plan(); |
| [1440](#L1440) | $product\_id   = IG\_ES\_PRODUCT\_ID; // ES product id. |
| [1441](#L1441) | $event\_prefix = 'esfree.'; |
| [1442](#L1442) | $text\_domain  = 'email-subscribers'; |
| [1443](#L1443) |  |
| [1444](#L1444) | if ( is\_admin() ) { |
| [1445](#L1445) | $ig\_es\_feedback\_class = 'IG\_Feedback\_V\_' . str\_replace( '.', '\_', IG\_ES\_FEEDBACK\_TRACKER\_VERSION ); |
| [1446](#L1446) |  |
| [1447](#L1447) | if ( self::$instance->is\_pro() ) { |
| [1448](#L1448) | $name         = 'Icegram Express MAX'; |
| [1449](#L1449) | $plugin       = 'email-subscribers-newsletters-pro'; |
| [1450](#L1450) | $event\_prefix = 'espro.'; |
| [1451](#L1451) | } elseif ( self::$instance->is\_starter() ) { |
| [1452](#L1452) | $name         = 'Icegram Express PRO'; |
| [1453](#L1453) | $plugin       = 'email-subscribers-newsletters-starter'; |
| [1454](#L1454) | $event\_prefix = 'esstarter.'; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) | $ig\_es\_feedback = new $ig\_es\_feedback\_class( $name, $plugin, $plugin\_abbr, $event\_prefix, false ); |
| [1458](#L1458) |  |
| [1459](#L1459) | $ig\_es\_feedback->render\_deactivate\_feedback(); |
| [1460](#L1460) | } |
| [1461](#L1461) |  |
| [1462](#L1462) | $plugin\_file\_path   = ES\_PLUGIN\_DIR . 'email-subscribers.php'; |
| [1463](#L1463) | $allowed\_by\_default = ES()->is\_premium() || ES()->trial->is\_trial(); |
| [1464](#L1464) |  |
| [1465](#L1465) | if ( strpos( ES\_PLUGIN\_DIR, 'email-subscribers-premium' ) ) { |
| [1466](#L1466) | $plugin\_file\_path = ES\_PLUGIN\_DIR . 'email-subscribers-premium.php'; |
| [1467](#L1467) | } |
| [1468](#L1468) |  |
| [1469](#L1469) | $plugin\_usage\_tracker\_class = 'IG\_Plugin\_Usage\_Tracker\_V\_' . str\_replace( '.', '\_', IG\_ES\_PLUGIN\_USAGE\_TRACKER\_VERSION ); |
| [1470](#L1470) |  |
| [1471](#L1471) | $enable\_on\_dev = false; |
| [1472](#L1472) |  |
| [1473](#L1473) | if ( class\_exists( $plugin\_usage\_tracker\_class ) ) { |
| [1474](#L1474) | new $plugin\_usage\_tracker\_class( $name, $text\_domain, $plugin\_abbr, $product\_id, $plugin\_plan, $plugin\_file\_path, $ig\_es\_tracker, $allowed\_by\_default, $enable\_on\_dev ); |
| [1475](#L1475) | } |
| [1476](#L1476) | // End-IG-Code. |
| [1477](#L1477) |  |
| [1478](#L1478) | add\_action( 'admin\_init', array( self::$instance, 'add\_admin\_notice' ) ); |
| [1479](#L1479) | add\_filter( 'ig\_es\_service\_request\_data', array( self::$instance, 'add\_service\_authentication\_data' ) ); |
| [1480](#L1480) | add\_filter( 'ig\_es\_plan', array( self::$instance, 'add\_trial\_plan' ) ); |
| [1481](#L1481) |  |
| [1482](#L1482) | if ( ! post\_type\_exists( 'es\_template' ) ) { |
| [1483](#L1483) | add\_action( 'init', array( 'Email\_Subscribers\_Activator', 'register\_email\_templates' ) ); |
| [1484](#L1484) | } |
| [1485](#L1485) | } |
| [1486](#L1486) |  |
| [1487](#L1487) | return self::$instance; |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | /\*\* |
| [1491](#L1491) | \* Method to get plugin plan |
| [1492](#L1492) | \* |
| [1493](#L1493) | \* @return string $plan |
| [1494](#L1494) | \* |
| [1495](#L1495) | \* @since 4.6.1 |
| [1496](#L1496) | \*/ |
| [1497](#L1497) | public function get\_plan() { |
| [1498](#L1498) |  |
| [1499](#L1499) | $plan = apply\_filters( 'ig\_es\_plan', 'lite' ); |
| [1500](#L1500) |  |
| [1501](#L1501) | return $plan; |
| [1502](#L1502) | } |
| [1503](#L1503) |  |
| [1504](#L1504) | /\*\* |
| [1505](#L1505) | \* Method to add trial plan |
| [1506](#L1506) | \* |
| [1507](#L1507) | \* @param string $plan |
| [1508](#L1508) | \* |
| [1509](#L1509) | \* @return string $plan |
| [1510](#L1510) | \* |
| [1511](#L1511) | \* @since 4.6.1 |
| [1512](#L1512) | \*/ |
| [1513](#L1513) | public function add\_trial\_plan( $plan = '' ) { |
| [1514](#L1514) |  |
| [1515](#L1515) | if ( ES()->trial->is\_trial\_valid() ) { |
| [1516](#L1516) | $plan = 'trial'; |
| [1517](#L1517) | } |
| [1518](#L1518) |  |
| [1519](#L1519) | return $plan; |
| [1520](#L1520) | } |
| [1521](#L1521) |  |
| [1522](#L1522) | /\*\* |
| [1523](#L1523) | \* Method to add ES service authentication data. |
| [1524](#L1524) | \* |
| [1525](#L1525) | \* @param array $request\_data Service request data. |
| [1526](#L1526) | \* |
| [1527](#L1527) | \* @return array $request\_data |
| [1528](#L1528) | \* |
| [1529](#L1529) | \* @since 4.6.1 |
| [1530](#L1530) | \*/ |
| [1531](#L1531) | public function add\_service\_authentication\_data( $request\_data = array() ) { |
| [1532](#L1532) |  |
| [1533](#L1533) | $es\_plan = $this->get\_plan(); |
| [1534](#L1534) |  |
| [1535](#L1535) | if ( ! empty( $es\_plan ) ) { |
| [1536](#L1536) | $request\_data['plan'] = $es\_plan; |
| [1537](#L1537) | } |
| [1538](#L1538) |  |
| [1539](#L1539) | if ( ES()->trial->is\_trial() ) { |
| [1540](#L1540) |  |
| [1541](#L1541) | $trial\_started\_at = get\_option( 'ig\_es\_trial\_started\_at' ); |
| [1542](#L1542) | $site\_url         = site\_url(); |
| [1543](#L1543) |  |
| [1544](#L1544) | $request\_data['trial\_started\_at'] = $trial\_started\_at; |
| [1545](#L1545) | $request\_data['site\_url']         = $site\_url; |
| [1546](#L1546) | } |
| [1547](#L1547) |  |
| [1548](#L1548) | return $request\_data; |
| [1549](#L1549) | } |
| [1550](#L1550) |  |
| [1551](#L1551) | /\*\* |
| [1552](#L1552) | \* Method to get admin menu title. |
| [1553](#L1553) | \* |
| [1554](#L1554) | \* @return string $menu\_title Admin menu title |
| [1555](#L1555) | \* |
| [1556](#L1556) | \* @since 4.6.3 |
| [1557](#L1557) | \*/ |
| [1558](#L1558) | public function get\_admin\_menu\_title() { |
| [1559](#L1559) |  |
| [1560](#L1560) | global $ig\_es\_tracker; |
| [1561](#L1561) |  |
| [1562](#L1562) | $menu\_title = \_\_( 'Icegram Express', 'email-subscribers' ); |
| [1563](#L1563) |  |
| [1564](#L1564) | if ( 'woo' === IG\_ES\_PLUGIN\_PLAN ) { |
| [1565](#L1565) | $menu\_title = \_\_( 'Icegram', 'email-subscribers' ); |
| [1566](#L1566) |  |
| [1567](#L1567) | $icegram\_lite\_plugin\_slug    = 'icegram/icegram.php'; |
| [1568](#L1568) | $icegram\_premium\_plugin\_slug = 'icegram-engage/icegram-engage.php'; |
| [1569](#L1569) |  |
| [1570](#L1570) | $icegram\_lite\_installed    = $ig\_es\_tracker::is\_plugin\_installed( $icegram\_lite\_plugin\_slug ); |
| [1571](#L1571) | $icegram\_premium\_installed = $ig\_es\_tracker::is\_plugin\_installed( $icegram\_premium\_plugin\_slug ); |
| [1572](#L1572) |  |
| [1573](#L1573) | // Change Woo Plugin's menu name if Icegram or Icegram premium plugin is installed on the site. |
| [1574](#L1574) | if ( $icegram\_lite\_installed || $icegram\_premium\_installed ) { |
| [1575](#L1575) | $menu\_title = \_\_( 'Icegram WC', 'email-subscribers' ); |
| [1576](#L1576) | } |
| [1577](#L1577) | } |
| [1578](#L1578) |  |
| [1579](#L1579) | return $menu\_title; |
| [1580](#L1580) | } |
| [1581](#L1581) |  |
| [1582](#L1582) | /\*\* |
| [1583](#L1583) | \* Method to get admin menu page prefix. |
| [1584](#L1584) | \* |
| [1585](#L1585) | \* @return string $page\_prefix Admin menu page prefix. |
| [1586](#L1586) | \* |
| [1587](#L1587) | \* @since 4.6.3 |
| [1588](#L1588) | \*/ |
| [1589](#L1589) | public function get\_admin\_page\_prefix() { |
| [1590](#L1590) |  |
| [1591](#L1591) | $menu\_title  = $this->get\_admin\_menu\_title(); |
| [1592](#L1592) | $page\_prefix = sanitize\_title( $menu\_title ); |
| [1593](#L1593) |  |
| [1594](#L1594) | return $page\_prefix; |
| [1595](#L1595) | } |
| [1596](#L1596) |  |
| [1597](#L1597) | /\*\* |
| [1598](#L1598) | \* Check whether constant definition is enabled or not. |
| [1599](#L1599) | \* |
| [1600](#L1600) | \* @return bool |
| [1601](#L1601) | \* |
| [1602](#L1602) | \* @since 4.7.0 |
| [1603](#L1603) | \*/ |
| [1604](#L1604) | public function is\_const\_enabled() { |
| [1605](#L1605) |  |
| [1606](#L1606) | $const\_enabled = defined( 'IG\_ES\_CONSTANT\_ENABLED' ) && IG\_ES\_CONSTANT\_ENABLED === true; |
| [1607](#L1607) |  |
| [1608](#L1608) | return $const\_enabled; |
| [1609](#L1609) | } |
| [1610](#L1610) |  |
| [1611](#L1611) | /\*\* |
| [1612](#L1612) | \* Check if mailer setting is defined through constant |
| [1613](#L1613) | \* |
| [1614](#L1614) | \* @param string $group |
| [1615](#L1615) | \* @param string $key |
| [1616](#L1616) | \* |
| [1617](#L1617) | \* @return bool |
| [1618](#L1618) | \* |
| [1619](#L1619) | \* @since 4.7.0 |
| [1620](#L1620) | \*/ |
| [1621](#L1621) | public function is\_const\_defined( $group, $key ) { |
| [1622](#L1622) |  |
| [1623](#L1623) | if ( ! $this->is\_const\_enabled() ) { |
| [1624](#L1624) | return false; |
| [1625](#L1625) | } |
| [1626](#L1626) |  |
| [1627](#L1627) | $return = false; |
| [1628](#L1628) |  |
| [1629](#L1629) | switch ( $group ) { |
| [1630](#L1630) | case 'pepipost': |
| [1631](#L1631) | switch ( $key ) { |
| [1632](#L1632) | case 'api\_key': |
| [1633](#L1633) | $return = defined( 'IG\_ES\_PEPIPOST\_API\_KEY' ) && IG\_ES\_PEPIPOST\_API\_KEY; |
| [1634](#L1634) | break; |
| [1635](#L1635) | } |
| [1636](#L1636) |  |
| [1637](#L1637) | break; |
| [1638](#L1638) | case 'smtp': |
| [1639](#L1639) | switch ( $key ) { |
| [1640](#L1640) | case 'host': |
| [1641](#L1641) | $return = defined( 'IG\_ES\_SMTP\_HOST' ) && IG\_ES\_SMTP\_HOST; |
| [1642](#L1642) | break; |
| [1643](#L1643) | case 'encryption': |
| [1644](#L1644) | $return = defined( 'IG\_ES\_SMTP\_ENCRYPTION' ) && IG\_ES\_SMTP\_ENCRYPTION; |
| [1645](#L1645) | break; |
| [1646](#L1646) | case 'port': |
| [1647](#L1647) | $return = defined( 'IG\_ES\_SMTP\_PORT' ) && IG\_ES\_SMTP\_PORT; |
| [1648](#L1648) | break; |
| [1649](#L1649) | case 'authentication': |
| [1650](#L1650) | $return = defined( 'IG\_ES\_SMTP\_AUTHENTICATION' ) && IG\_ES\_SMTP\_AUTHENTICATION; |
| [1651](#L1651) | break; |
| [1652](#L1652) | case 'username': |
| [1653](#L1653) | $return = defined( 'IG\_ES\_SMTP\_USERNAME' ) && IG\_ES\_SMTP\_USERNAME; |
| [1654](#L1654) | break; |
| [1655](#L1655) | case 'password': |
| [1656](#L1656) | $return = defined( 'IG\_ES\_SMTP\_PASSWORD' ) && IG\_ES\_SMTP\_PASSWORD; |
| [1657](#L1657) | break; |
| [1658](#L1658) | } |
| [1659](#L1659) |  |
| [1660](#L1660) | break; |
| [1661](#L1661) |  |
| [1662](#L1662) | case 'gmail': |
| [1663](#L1663) | switch ( $key ) { |
| [1664](#L1664) | case 'client\_id': |
| [1665](#L1665) | $return = defined( 'IG\_ES\_GMAIL\_CLIENT\_ID' ) && IG\_ES\_GMAIL\_CLIENT\_ID; |
| [1666](#L1666) | break; |
| [1667](#L1667) | case 'client\_secret': |
| [1668](#L1668) | $return = defined( 'IG\_ES\_GMAIL\_CLIENT\_SECRET' ) && IG\_ES\_GMAIL\_CLIENT\_SECRET; |
| [1669](#L1669) | break; |
| [1670](#L1670) | } |
| [1671](#L1671) |  |
| [1672](#L1672) | break; |
| [1673](#L1673) |  |
| [1674](#L1674) | case 'Amazon\_SES': |
| [1675](#L1675) | switch ( $key ) { |
| [1676](#L1676) | case 'access\_key\_id': |
| [1677](#L1677) | $return = defined( 'IG\_ES\_AMAZONSES\_ACCESS\_KEY\_ID' ) && IG\_ES\_AMAZONSES\_ACCESS\_KEY\_ID; |
| [1678](#L1678) | break; |
| [1679](#L1679) | case 'secret\_access\_key': |
| [1680](#L1680) | $return = defined( 'IG\_ES\_AMAZONSES\_SECRET\_ACCESS\_KEY' ) && IG\_ES\_AMAZONSES\_SECRET\_ACCESS\_KEY; |
| [1681](#L1681) | break; |
| [1682](#L1682) | case 'region': |
| [1683](#L1683) | $return = defined( 'IG\_ES\_AMAZONSES\_REGION' ) && IG\_ES\_AMAZONSES\_REGION; |
| [1684](#L1684) | break; |
| [1685](#L1685) | } |
| [1686](#L1686) |  |
| [1687](#L1687) | break; |
| [1688](#L1688) |  |
| [1689](#L1689) | case 'mailgun': |
| [1690](#L1690) | switch ( $key ) { |
| [1691](#L1691) | case 'private\_api\_key': |
| [1692](#L1692) | $return = defined( 'IG\_ES\_MAILGUN\_PRIVATE\_API\_KEY' ) && IG\_ES\_MAILGUN\_PRIVATE\_API\_KEY; |
| [1693](#L1693) | break; |
| [1694](#L1694) | case 'domain\_name': |
| [1695](#L1695) | $return = defined( 'IG\_ES\_MAILGUN\_DOMAIN\_NAME' ) && IG\_ES\_MAILGUN\_DOMAIN\_NAME; |
| [1696](#L1696) | break; |
| [1697](#L1697) | case 'region': |
| [1698](#L1698) | $return = defined( 'IG\_ES\_MAILGUN\_REGION' ) && IG\_ES\_MAILGUN\_REGION; |
| [1699](#L1699) | break; |
| [1700](#L1700) | } |
| [1701](#L1701) |  |
| [1702](#L1702) | break; |
| [1703](#L1703) |  |
| [1704](#L1704) | case 'sparkpost': |
| [1705](#L1705) | switch ( $key ) { |
| [1706](#L1706) | case 'api\_key': |
| [1707](#L1707) | $return = defined( 'IG\_ES\_SPARKPOST\_API\_KEY' ) && IG\_ES\_SPARKPOST\_API\_KEY; |
| [1708](#L1708) | break; |
| [1709](#L1709) | case 'region': |
| [1710](#L1710) | $return = defined( 'IG\_ES\_SPARKPOST\_REGION' ) && IG\_ES\_SPARKPOST\_REGION; |
| [1711](#L1711) | break; |
| [1712](#L1712) | } |
| [1713](#L1713) |  |
| [1714](#L1714) | break; |
| [1715](#L1715) |  |
| [1716](#L1716) | case 'sendgrid': |
| [1717](#L1717) | switch ( $key ) { |
| [1718](#L1718) | case 'api\_key': |
| [1719](#L1719) | $return = defined( 'IG\_ES\_SENDGRID\_API\_KEY' ) && IG\_ES\_SENDGRID\_API\_KEY; |
| [1720](#L1720) | break; |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | break; |
| [1724](#L1724) |  |
| [1725](#L1725) | case 'postmark': |
| [1726](#L1726) | switch ( $key ) { |
| [1727](#L1727) | case 'api\_token': |
| [1728](#L1728) | $return = defined( 'IG\_ES\_POSTMARK\_API\_TOKEN' ) && IG\_ES\_POSTMARK\_API\_TOKEN; |
| [1729](#L1729) | break; |
| [1730](#L1730) | } |
| [1731](#L1731) |  |
| [1732](#L1732) | break; |
| [1733](#L1733) |  |
| [1734](#L1734) | case 'mailersend': |
| [1735](#L1735) | switch ( $key ) { |
| [1736](#L1736) | case 'api\_token': |
| [1737](#L1737) | $return = defined( 'IG\_ES\_MAILERSEND\_API\_TOKEN' ) && IG\_ES\_MAILERSEND\_API\_TOKEN; |
| [1738](#L1738) | break; |
| [1739](#L1739) | } |
| [1740](#L1740) |  |
| [1741](#L1741) | break; |
| [1742](#L1742) |  |
| [1743](#L1743) | case 'sendinblue': |
| [1744](#L1744) | switch ( $key ) { |
| [1745](#L1745) | case 'api\_token': |
| [1746](#L1746) | $return = defined( 'IG\_ES\_SENDINBLUE\_API\_TOKEN' ) && IG\_ES\_SENDINBLUE\_API\_TOKEN; |
| [1747](#L1747) | break; |
| [1748](#L1748) | } |
| [1749](#L1749) |  |
| [1750](#L1750) | break; |
| [1751](#L1751) |  |
| [1752](#L1752) | case 'mailjet': |
| [1753](#L1753) | switch ( $key ) { |
| [1754](#L1754) | case 'public\_key': |
| [1755](#L1755) | $return = defined( 'IG\_ES\_MAILJET\_PUBLIC\_KEY' ) && IG\_ES\_MAILJET\_PUBLIC\_KEY; |
| [1756](#L1756) | break; |
| [1757](#L1757) | case 'private\_key': |
| [1758](#L1758) | $return = defined( 'IG\_ES\_MAILJET\_PRIVATE\_KEY' ) && IG\_ES\_MAILJET\_PRIVATE\_KEY; |
| [1759](#L1759) | break; |
| [1760](#L1760) | } |
| [1761](#L1761) |  |
| [1762](#L1762) | break; |
| [1763](#L1763) |  |
| [1764](#L1764) | } |
| [1765](#L1765) |  |
| [1766](#L1766) | return $return; |
| [1767](#L1767) | } |
| [1768](#L1768) |  |
| [1769](#L1769) | /\*\* |
| [1770](#L1770) | \* Process the options values through the constants check. |
| [1771](#L1771) | \* If we have defined associated constant - use it instead of a DB value. |
| [1772](#L1772) | \* |
| [1773](#L1773) | \* @param string $group |
| [1774](#L1774) | \* @param string $key |
| [1775](#L1775) | \* @param mixed  $value |
| [1776](#L1776) | \* |
| [1777](#L1777) | \* @since 4.7.0 |
| [1778](#L1778) | \* |
| [1779](#L1779) | \* @return mixed |
| [1780](#L1780) | \*/ |
| [1781](#L1781) | public function get\_const\_value( $group, $key, $value = '' ) { |
| [1782](#L1782) |  |
| [1783](#L1783) | if ( ! $this->is\_const\_enabled() ) { |
| [1784](#L1784) | return $value; |
| [1785](#L1785) | } |
| [1786](#L1786) |  |
| [1787](#L1787) | $return = null; |
| [1788](#L1788) |  |
| [1789](#L1789) | switch ( $group ) { |
| [1790](#L1790) |  |
| [1791](#L1791) | case 'smtp': |
| [1792](#L1792) | switch ( $key ) { |
| [1793](#L1793) | case 'host': |
| [1794](#L1794) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SMTP\_HOST : $value; |
| [1795](#L1795) | break; |
| [1796](#L1796) | case 'encryption': |
| [1797](#L1797) | $return = $this->is\_const\_defined( $group, $key ) ? ( IG\_ES\_SMTP\_ENCRYPTION === '' ? 'none' : IG\_ES\_SMTP\_ENCRYPTION ) : $value; |
| [1798](#L1798) | break; |
| [1799](#L1799) | case 'port': |
| [1800](#L1800) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SMTP\_PORT : $value; |
| [1801](#L1801) | break; |
| [1802](#L1802) | case 'authentication': |
| [1803](#L1803) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SMTP\_AUTHENTICATION : $value; |
| [1804](#L1804) | break; |
| [1805](#L1805) | case 'username': |
| [1806](#L1806) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SMTP\_USERNAME : $value; |
| [1807](#L1807) | break; |
| [1808](#L1808) | case 'password': |
| [1809](#L1809) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SMTP\_PASSWORD : $value; |
| [1810](#L1810) | break; |
| [1811](#L1811) | } |
| [1812](#L1812) |  |
| [1813](#L1813) | break; |
| [1814](#L1814) |  |
| [1815](#L1815) | case 'Amazon\_SES': |
| [1816](#L1816) | switch ( $key ) { |
| [1817](#L1817) | case 'access\_key\_id': |
| [1818](#L1818) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_AMAZONSES\_ACCESS\_KEY\_ID : $value; |
| [1819](#L1819) | break; |
| [1820](#L1820) | case 'secret\_access\_key': |
| [1821](#L1821) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_AMAZONSES\_SECRET\_ACCESS\_KEY : $value; |
| [1822](#L1822) | break; |
| [1823](#L1823) | case 'region': |
| [1824](#L1824) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_AMAZONSES\_REGION : $value; |
| [1825](#L1825) | break; |
| [1826](#L1826) | } |
| [1827](#L1827) |  |
| [1828](#L1828) | break; |
| [1829](#L1829) |  |
| [1830](#L1830) | case 'mailgun': |
| [1831](#L1831) | switch ( $key ) { |
| [1832](#L1832) | case 'private\_api\_key': |
| [1833](#L1833) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILGUN\_PRIVATE\_API\_KEY : $value; |
| [1834](#L1834) | break; |
| [1835](#L1835) | case 'domain\_name': |
| [1836](#L1836) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILGUN\_DOMAIN\_NAME : $value; |
| [1837](#L1837) | break; |
| [1838](#L1838) | case 'region': |
| [1839](#L1839) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILGUN\_REGION : $value; |
| [1840](#L1840) | break; |
| [1841](#L1841) | } |
| [1842](#L1842) |  |
| [1843](#L1843) | break; |
| [1844](#L1844) |  |
| [1845](#L1845) | case 'sendgrid': |
| [1846](#L1846) | switch ( $key ) { |
| [1847](#L1847) | case 'api\_key': |
| [1848](#L1848) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SENDGRID\_API\_KEY : $value; |
| [1849](#L1849) | break; |
| [1850](#L1850) | } |
| [1851](#L1851) |  |
| [1852](#L1852) | break; |
| [1853](#L1853) |  |
| [1854](#L1854) | case 'sparkpost': |
| [1855](#L1855) | switch ( $key ) { |
| [1856](#L1856) | case 'api\_key': |
| [1857](#L1857) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SPARKPOST\_API\_KEY : $value; |
| [1858](#L1858) | break; |
| [1859](#L1859) | case 'region': |
| [1860](#L1860) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SPARKPOST\_REGION : $value; |
| [1861](#L1861) | break; |
| [1862](#L1862) | } |
| [1863](#L1863) |  |
| [1864](#L1864) | break; |
| [1865](#L1865) |  |
| [1866](#L1866) | case 'pepipost': |
| [1867](#L1867) | switch ( $key ) { |
| [1868](#L1868) | case 'api\_key': |
| [1869](#L1869) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_PEPIPOST\_API\_KEY : $value; |
| [1870](#L1870) | break; |
| [1871](#L1871) | } |
| [1872](#L1872) |  |
| [1873](#L1873) | break; |
| [1874](#L1874) |  |
| [1875](#L1875) | case 'postmark': |
| [1876](#L1876) | switch ( $key ) { |
| [1877](#L1877) | case 'api\_token': |
| [1878](#L1878) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_POSTMARK\_API\_TOKEN : $value; |
| [1879](#L1879) | break; |
| [1880](#L1880) | } |
| [1881](#L1881) |  |
| [1882](#L1882) | break; |
| [1883](#L1883) |  |
| [1884](#L1884) | case 'mailersend': |
| [1885](#L1885) | switch ( $key ) { |
| [1886](#L1886) | case 'api\_token': |
| [1887](#L1887) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILERSEND\_API\_TOKEN : $value; |
| [1888](#L1888) | break; |
| [1889](#L1889) | } |
| [1890](#L1890) |  |
| [1891](#L1891) | break; |
| [1892](#L1892) |  |
| [1893](#L1893) | case 'sendinblue': |
| [1894](#L1894) | switch ( $key ) { |
| [1895](#L1895) | case 'api\_token': |
| [1896](#L1896) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_SENDINBLUE\_API\_TOKEN : $value; |
| [1897](#L1897) | break; |
| [1898](#L1898) | } |
| [1899](#L1899) |  |
| [1900](#L1900) | break; |
| [1901](#L1901) |  |
| [1902](#L1902) | case 'gmail': |
| [1903](#L1903) | switch ( $key ) { |
| [1904](#L1904) | case 'client\_id': |
| [1905](#L1905) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_GMAIL\_CLIENT\_ID : $value; |
| [1906](#L1906) | break; |
| [1907](#L1907) | case 'client\_secret': |
| [1908](#L1908) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_GMAIL\_CLIENT\_SECRET : $value; |
| [1909](#L1909) | break; |
| [1910](#L1910) | } |
| [1911](#L1911) |  |
| [1912](#L1912) | break; |
| [1913](#L1913) |  |
| [1914](#L1914) | case 'mailjet': |
| [1915](#L1915) | switch ( $key ) { |
| [1916](#L1916) | case 'public\_key': |
| [1917](#L1917) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILJET\_PUBLIC\_KEY : $value; |
| [1918](#L1918) | break; |
| [1919](#L1919) | case 'private\_key': |
| [1920](#L1920) | $return = $this->is\_const\_defined( $group, $key ) ? IG\_ES\_MAILJET\_PRIVATE\_KEY : $value; |
| [1921](#L1921) | break; |
| [1922](#L1922) | } |
| [1923](#L1923) |  |
| [1924](#L1924) | break; |
| [1925](#L1925) |  |
| [1926](#L1926) | default: |
| [1927](#L1927) | // Always return the default value if nothing from above matches the request. |
| [1928](#L1928) | $return = $value; |
| [1929](#L1929) | } |
| [1930](#L1930) |  |
| [1931](#L1931) | return $return; |
| [1932](#L1932) | } |
| [1933](#L1933) |  |
| [1934](#L1934) | /\*\* |
| [1935](#L1935) | \* Get related constant name for given key/group pair |
| [1936](#L1936) | \* |
| [1937](#L1937) | \* @param string $group |
| [1938](#L1938) | \* @param string $key |
| [1939](#L1939) | \* |
| [1940](#L1940) | \* @since 4.7.0 |
| [1941](#L1941) | \* |
| [1942](#L1942) | \* @return mixed |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public function get\_const\_name( $group, $key ) { |
| [1945](#L1945) |  |
| [1946](#L1946) | $return = ''; |
| [1947](#L1947) |  |
| [1948](#L1948) | if ( $this->is\_const\_enabled() ) { |
| [1949](#L1949) | switch ( $group ) { |
| [1950](#L1950) |  |
| [1951](#L1951) | case 'smtp': |
| [1952](#L1952) | switch ( $key ) { |
| [1953](#L1953) | case 'host': |
| [1954](#L1954) | $return = 'IG\_ES\_SMTP\_HOST'; |
| [1955](#L1955) | break; |
| [1956](#L1956) | case 'port': |
| [1957](#L1957) | $return = 'IG\_ES\_SMTP\_PORT'; |
| [1958](#L1958) | break; |
| [1959](#L1959) | case 'encryption': |
| [1960](#L1960) | $return = 'IG\_ES\_SMTP\_ENCRYPTION'; |
| [1961](#L1961) | break; |
| [1962](#L1962) | case 'authentication': |
| [1963](#L1963) | $return = 'IG\_ES\_SMTP\_AUTHENTICATION'; |
| [1964](#L1964) | break; |
| [1965](#L1965) | case 'username': |
| [1966](#L1966) | $return = 'IG\_ES\_SMTP\_USERNAME'; |
| [1967](#L1967) | break; |
| [1968](#L1968) | case 'password': |
| [1969](#L1969) | $return = 'IG\_ES\_SMTP\_PASSWORD'; |
| [1970](#L1970) | break; |
| [1971](#L1971) | } |
| [1972](#L1972) |  |
| [1973](#L1973) | break; |
| [1974](#L1974) |  |
| [1975](#L1975) | case 'Amazon\_SES': |
| [1976](#L1976) | switch ( $key ) { |
| [1977](#L1977) | case 'access\_key\_id': |
| [1978](#L1978) | $return = 'IG\_ES\_AMAZONSES\_ACCESS\_KEY\_ID'; |
| [1979](#L1979) | break; |
| [1980](#L1980) | case 'secret\_access\_key': |
| [1981](#L1981) | $return = 'IG\_ES\_AMAZONSES\_SECRET\_ACCESS\_KEY'; |
| [1982](#L1982) | break; |
| [1983](#L1983) | case 'region': |
| [1984](#L1984) | $return = 'IG\_ES\_AMAZONSES\_REGION'; |
| [1985](#L1985) | break; |
| [1986](#L1986) | } |
| [1987](#L1987) |  |
| [1988](#L1988) | break; |
| [1989](#L1989) |  |
| [1990](#L1990) | case 'mailgun': |
| [1991](#L1991) | switch ( $key ) { |
| [1992](#L1992) | case 'private\_api\_key': |
| [1993](#L1993) | $return = 'IG\_ES\_MAILGUN\_PRIVATE\_API\_KEY'; |
| [1994](#L1994) | break; |
| [1995](#L1995) | case 'domain\_name': |
| [1996](#L1996) | $return = 'IG\_ES\_MAILGUN\_DOMAIN\_NAME'; |
| [1997](#L1997) | break; |
| [1998](#L1998) | case 'region': |
| [1999](#L1999) | $return = 'IG\_ES\_MAILGUN\_REGION'; |
| [2000](#L2000) | break; |
| [2001](#L2001) | } |
| [2002](#L2002) |  |
| [2003](#L2003) | break; |
| [2004](#L2004) |  |
| [2005](#L2005) | case 'sendgrid': |
| [2006](#L2006) | switch ( $key ) { |
| [2007](#L2007) | case 'api\_key': |
| [2008](#L2008) | $return = 'IG\_ES\_SENDGRID\_API\_KEY'; |
| [2009](#L2009) | break; |
| [2010](#L2010) | } |
| [2011](#L2011) |  |
| [2012](#L2012) | break; |
| [2013](#L2013) |  |
| [2014](#L2014) | case 'sparkpost': |
| [2015](#L2015) | switch ( $key ) { |
| [2016](#L2016) | case 'api\_key': |
| [2017](#L2017) | $return = 'IG\_ES\_SPARKPOST\_API\_KEY'; |
| [2018](#L2018) | break; |
| [2019](#L2019) | case 'region': |
| [2020](#L2020) | $return = 'IG\_ES\_SPARKPOST\_REGION'; |
| [2021](#L2021) | break; |
| [2022](#L2022) | } |
| [2023](#L2023) |  |
| [2024](#L2024) | break; |
| [2025](#L2025) |  |
| [2026](#L2026) | case 'pepipost': |
| [2027](#L2027) | switch ( $key ) { |
| [2028](#L2028) | case 'api\_key': |
| [2029](#L2029) | $return = 'IG\_ES\_PEPIPOST\_API\_KEY'; |
| [2030](#L2030) | break; |
| [2031](#L2031) | } |
| [2032](#L2032) |  |
| [2033](#L2033) | break; |
| [2034](#L2034) |  |
| [2035](#L2035) | case 'postmark': |
| [2036](#L2036) | switch ( $key ) { |
| [2037](#L2037) | case 'api\_token': |
| [2038](#L2038) | $return = 'IG\_ES\_POSTMARK\_API\_TOKEN'; |
| [2039](#L2039) | break; |
| [2040](#L2040) | } |
| [2041](#L2041) |  |
| [2042](#L2042) | break; |
| [2043](#L2043) |  |
| [2044](#L2044) | case 'mailersend': |
| [2045](#L2045) | switch ( $key ) { |
| [2046](#L2046) | case 'api\_token': |
| [2047](#L2047) | $return = 'IG\_ES\_MAILERSEND\_API\_TOKEN'; |
| [2048](#L2048) | break; |
| [2049](#L2049) | } |
| [2050](#L2050) |  |
| [2051](#L2051) | break; |
| [2052](#L2052) |  |
| [2053](#L2053) | default: |
| [2054](#L2054) | $return = ''; |
| [2055](#L2055) | } |
| [2056](#L2056) | } |
| [2057](#L2057) |  |
| [2058](#L2058) | return $return; |
| [2059](#L2059) | } |
| [2060](#L2060) |  |
| [2061](#L2061) | /\*\* |
| [2062](#L2062) | \* Display a message of a constant that was set. |
| [2063](#L2063) | \* |
| [2064](#L2064) | \* @param string $group Group name. |
| [2065](#L2065) | \* @param string $key Key name. |
| [2066](#L2066) | \* |
| [2067](#L2067) | \* @return $message |
| [2068](#L2068) | \* |
| [2069](#L2069) | \* @since 4.7.0 |
| [2070](#L2070) | \*/ |
| [2071](#L2071) | public function get\_const\_set\_message( $group, $key ) { |
| [2072](#L2072) | $constant = ES()->get\_const\_name( $group, $key ); |
| [2073](#L2073) | ob\_start(); |
| [2074](#L2074) | ?> |
| [2075](#L2075) | <?php |
| [2076](#L2076) | printf( /\* translators: %1$s - constant that was used \*/ |
| [2077](#L2077) | esc\_html\_\_( 'Value was set using constant %1$s', 'email-subscribers' ), |
| [2078](#L2078) | '<code>' . esc\_attr( $constant ) . '</code>' |
| [2079](#L2079) | ); |
| [2080](#L2080) | ?> |
| [2081](#L2081) | <br/> |
| [2082](#L2082) | <?php |
| [2083](#L2083) | $message = ob\_get\_clean(); |
| [2084](#L2084) | return $message; |
| [2085](#L2085) | } |
| [2086](#L2086) |  |
| [2087](#L2087) | /\*\* |
| [2088](#L2088) | \* Check if offer period |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @return boolean |
| [2091](#L2091) | \* |
| [2092](#L2092) | \* @since 4.8.6 |
| [2093](#L2093) | \*/ |
| [2094](#L2094) | public function is\_offer\_period( $offer\_name = 'bfcm' ) { |
| [2095](#L2095) |  |
| [2096](#L2096) | $is\_offer\_period  = false; |
| [2097](#L2097) | $current\_utc\_time = time(); |
| [2098](#L2098) | $current\_ist\_time = $current\_utc\_time + ( 5.5 \* HOUR\_IN\_SECONDS ); // Add IST offset to get IST time |
| [2099](#L2099) | $offer\_start\_time = 0; |
| [2100](#L2100) | $offer\_end\_time   = 0; |
| [2101](#L2101) | if ( 'bfcm' === $offer\_name ) { |
| [2102](#L2102) | $offer\_start\_time = strtotime( '2024-11-26 12:30:00' ); // Offer start time in IST |
| [2103](#L2103) | $offer\_end\_time   = strtotime( '2024-12-05 12:30:00' ); // Offer end time in IST |
| [2104](#L2104) | } |
| [2105](#L2105) |  |
| [2106](#L2106) | $is\_offer\_period = $current\_ist\_time >= $offer\_start\_time && $current\_ist\_time <= $offer\_end\_time; |
| [2107](#L2107) |  |
| [2108](#L2108) | return $is\_offer\_period; |
| [2109](#L2109) | } |
| [2110](#L2110) |  |
| [2111](#L2111) | /\*\* |
| [2112](#L2112) | \* Method to get ES trial list hash |
| [2113](#L2113) | \* |
| [2114](#L2114) | \* @return string $es\_optin\_list\_hash Get hash for Trial list |
| [2115](#L2115) | \* |
| [2116](#L2116) | \* @since 5.3.12 |
| [2117](#L2117) | \*/ |
| [2118](#L2118) | public function get\_es\_optin\_list\_hash() { |
| [2119](#L2119) | $es\_optin\_list\_hash = 'bc4f8995201a'; |
| [2120](#L2120) | return $es\_optin\_list\_hash; |
| [2121](#L2121) | } |
| [2122](#L2122) |  |
| [2123](#L2123) | public function get\_action\_types() { |
| [2124](#L2124) | $action\_types = apply\_filters( 'ig\_es\_action\_types', array( |
| [2125](#L2125) | IG\_MESSAGE\_SENT, |
| [2126](#L2126) | IG\_MESSAGE\_OPEN, |
| [2127](#L2127) | IG\_CONTACT\_UNSUBSCRIBE, |
| [2128](#L2128) | IG\_LINK\_CLICK, |
| [2129](#L2129) | IG\_MESSAGE\_HARD\_BOUNCE |
| [2130](#L2130) | ) ); |
| [2131](#L2131) | return $action\_types; |
| [2132](#L2132) | } |
| [2133](#L2133) | } |
| [2134](#L2134) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php?format=txt)
* [Original Format](/export/3220459/email-subscribers/trunk/lite/includes/class-email-subscribers.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_c403d7ff_20250110_211524.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Email Subscribers by Icegram Express – Email Marketing, Newsletters, Automation for WordPress & WooCommerce <= 5.7.17 - Missing Authorization

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Email Subscribers by Icegram Express – Email Marketing, Newsletters, Automation for WordPress & WooCommerce <= 5.7.17 - Missing Authorization

4.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2024-3626](https://www.cve.org/CVERecord?id=CVE-2024-3626) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | May 22, 2024 |
| Last Updated | May 23, 2024 |
| Researcher | [Thura Moe Myint (mgthuramoemyint)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/thura-moe-myint) |

### Description

The Email Subscribers by Icegram Express – Email Marketing, Newsletters, Automation for WordPress & WooCommerce plugin for WordPress is vulnerable to unauthorized access of data due to a missing capability check on the get\_template\_content function in all versions up to, and including, 5.7.17. This makes it possible for authenticated attackers, with subscriber access and above, to obtain the contents of private and password-protected posts.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/email-subscribers/trunk/lite/includes/class-email-subscribers.php#L1063)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/email-subscribers/trunk/lite/admin/class-email-subscribers-admin.php#L849)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=3072302%40email-subscribers%2Ftrunk&old=3069441%40email-subscribers%2Ftrunk&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Femail-subscribers%2Femail-subscribers-by-icegram-express-email-marketing-newsletters-automation-for-wordpress-woocommerce-5717-missing-authorization&t=Email%20Subscribers%20by%20Icegram%20Express%20%E2%80%93%20Email%20Marketing%2C%20Newsletters%2C%20Automation%20for%20WordPress%20%26%20WooCommerce%20%3C%3D%205.7.17%20-%20Missing%20Authorization "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Femail-subscribers%2Femail-subscribers-by-icegram-express-email-marketing-newsletters-automation-for-wordpress-woocommerce-5717-missing-authorization&text=Email%20Subscribers%20by%20Icegram%20Express%20%E2%80%93%20Email%20Marketing%2C%20Newsletters%2C%20Automation%20for%20WordPress%20%26%20WooCommerce%20%3C%3D%205.7.17%20-%20Missing%20Authorization "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Femail-subscribers%2Femail-subscribers-by-icegram-express-email-marketing-newsletters-automation-for-wordpress-woocommerce-5717-missing-authorization "LinkedIn")
Email

## Vulnerability Details for Email Subscribers by Icegram Express – Affordable, Powerful Email Marketing for WordPress & WooCommerce

#### [Email Subscribers by Icegram Express – Affordable, Powerful Email Marketing for WordPress & WooCommerce](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/email-subscribers)

| Software Type | Plugin |
| --- | --- |
| Software Slug | email-subscribers [(view on wordpress.org)](https://wordpress.org/plugins/email-subscribers) |
| Patched? | Yes |
| Remediation | Update to version 5.7.18, or a newer patched version |
| Affected Version | * <= 5.7.17 |
| Patched Version | * 5.7.18 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


