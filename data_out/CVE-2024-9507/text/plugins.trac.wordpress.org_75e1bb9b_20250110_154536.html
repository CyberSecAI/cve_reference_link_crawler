

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3165686%2Fbit-form%2Ftrunk%2Fincludes%2FAdmin%2FAdminAjax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3159448/bit-form/trunk/includes/Admin/AdminAjax.php "Changeset 3159448 for bit-form/trunk/includes/Admin/AdminAjax.php")
* [Next Change](/changeset/3200955/bit-form/trunk/includes/Admin/AdminAjax.php "Changeset 3200955 for bit-form/trunk/includes/Admin/AdminAjax.php") →

---

# Changeset [3165686](/changeset/3165686 "Show full changeset") for [bit-form/trunk/includes/Admin/AdminAjax.php](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3165686 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/09/2024 11:25:35 AM
([3 months](/timeline?from=2024-10-09T11%3A25%3A35Z&precision=second "See timeline at 10/09/2024 11:25:35 AM") ago)

Author:
bitpressadmin
Message:

releasing v-2.15.3

File:

1 edited

* [bit-form/trunk/includes/Admin/AdminAjax.php](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3165686 "Show entry in browser")
  (modified)
  ([3 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [bit-form/trunk/includes/Admin/AdminAjax.php](/changeset/3165686/bit-form/trunk/includes/Admin/AdminAjax.php "Show the changeset 3165686 restricted to bit-form/trunk/includes/Admin/AdminAjax.php")

  | [r3159448](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3159448#L15 "Show revision 3159448 of this file in browser") | [r3165686](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3165686#L15 "Show revision 3165686 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | use BitCode\BitForm\Core\Util\MailConfig; |
  | 16 | 16 | use BitCode\BitForm\Core\Util\MetaBoxService; |
  |  | 17 | use WP\_Error; |
  | 17 | 18 |  |
  | 18 | 19 | class AdminAjax |
  | […](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3159448#L1196) | […](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3165686#L1197) |  |
  | 1196 | 1197 | } |
  | 1197 | 1198 |  |
  |  | 1199 | private function checkExtensionWithURL($urlStr) |
  |  | 1200 | { |
  |  | 1201 | $pattern = '/^https?:\/\/.\*(\.(svg|png|jpg|jpeg|gif))?$/i'; |
  |  | 1202 |  |
  |  | 1203 | return preg\_match($pattern, $urlStr); |
  |  | 1204 | } |
  |  | 1205 |  |
  | 1198 | 1206 | public function iconUpload() |
  | 1199 | 1207 | { |
  | […](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3159448#L1201) | […](/browser/bit-form/trunk/includes/Admin/AdminAjax.php?rev=3165686#L1209) |  |
  | 1201 | 1209 | $inputJSON = file\_get\_contents('php://input'); |
  | 1202 | 1210 | $input = json\_decode($inputJSON); |
  |  | 1211 |  |
  |  | 1212 | $sanitize\_url = sanitize\_url($input->src); |
  |  | 1213 |  |
  |  | 1214 | if (!$this->checkExtensionWithURL($sanitize\_url)) { |
  |  | 1215 | return new WP\_Error( |
  |  | 1216 | 'type\_error', |
  |  | 1217 | \_\_('Invalid file type', 'bit-form') |
  |  | 1218 | ); |
  |  | 1219 | } |
  |  | 1220 |  |
  | 1203 | 1221 | $uploadDirInfo = wp\_upload\_dir(); |
  | 1204 | 1222 | $wpUploadbaseDir = $uploadDirInfo['basedir']; |
  | 1205 | 1223 | $icnDir = $wpUploadbaseDir . DIRECTORY\_SEPARATOR . 'bitforms' . DIRECTORY\_SEPARATOR . 'icons'; |
  |  | 1224 |  |
  | 1206 | 1225 | if (!is\_dir($icnDir)) { |
  | 1207 | 1226 | mkdir($icnDir); |
  | 1208 | 1227 | } |
  | 1209 | 1228 |  |
  | 1210 |  | $imageUrlData = file\_get\_contents($~~input->src~~); |
  | 1211 |  |  |
  | 1212 |  | $filename = sanitize\_file\_name($input->id . '-' . basename($~~input->src~~)); |
  |  | 1229 | $imageUrlData = file\_get\_contents($sanitize\_url); |
  |  | 1230 |  |
  |  | 1231 | $filename = sanitize\_file\_name($input->id . '-' . basename($sanitize\_url)); |
  | 1213 | 1232 |  |
  | 1214 | 1233 | $validation = wp\_check\_filetype($filename); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3165686)
* [Zip Archive](?format=zip&new=3165686)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

