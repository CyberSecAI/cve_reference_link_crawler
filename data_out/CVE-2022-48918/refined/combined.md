=== Content from git.kernel.org_ad299451_20250111_152432.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Randy Dunlap <rdunlap@infradead.org> | 2022-02-22 19:06:30 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-03-08 19:12:43 +0100 |
| commit | [7de1ed755e1ace30d97a724bad32452ed86b653b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7de1ed755e1ace30d97a724bad32452ed86b653b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)) | |
| tree | [2d33377276ade1f448da5861ac8f87114c59681c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7de1ed755e1ace30d97a724bad32452ed86b653b) | |
| parent | [728fb555882baf12399764c6a19b33c6a286410f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=728fb555882baf12399764c6a19b33c6a286410f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7de1ed755e1ace30d97a724bad32452ed86b653b&id2=728fb555882baf12399764c6a19b33c6a286410f)) | |
| download | [linux-7de1ed755e1ace30d97a724bad32452ed86b653b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7de1ed755e1ace30d97a724bad32452ed86b653b.tar.gz) | |

iwlwifi: mvm: check debugfs\_dir ptr before usecommit 5a6248c0a22352f09ea041665d3bd3e18f6f872c upstream.
When "debugfs=off" is used on the kernel command line, iwiwifi's
mvm module uses an invalid/unchecked debugfs\_dir pointer and causes
a BUG:
BUG: kernel NULL pointer dereference, address: 000000000000004f
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP
CPU: 1 PID: 503 Comm: modprobe Tainted: G W 5.17.0-rc5 #7
Hardware name: Dell Inc. Inspiron 15 5510/076F7Y, BIOS 2.4.1 11/05/2021
RIP: 0010:iwl\_mvm\_dbgfs\_register+0x692/0x700 [iwlmvm]
Code: 69 a0 be 80 01 00 00 48 c7 c7 50 73 6a a0 e8 95 cf ee e0 48 8b 83 b0 1e 00 00 48 c7 c2 54 73 6a a0 be 64 00 00 00 48 8d 7d 8c <48> 8b 48 50 e8 15 22 07 e1 48 8b 43 28 48 8d 55 8c 48 c7 c7 5f 73
RSP: 0018:ffffc90000a0ba68 EFLAGS: 00010246
RAX: ffffffffffffffff RBX: ffff88817d6e3328 RCX: ffff88817d6e3328
RDX: ffffffffa06a7354 RSI: 0000000000000064 RDI: ffffc90000a0ba6c
RBP: ffffc90000a0bae0 R08: ffffffff824e4880 R09: ffffffffa069d620
R10: ffffc90000a0ba00 R11: ffffffffffffffff R12: 0000000000000000
R13: ffffc90000a0bb28 R14: ffff88817d6e3328 R15: ffff88817d6e3320
FS: 00007f64dd92d740(0000) GS:ffff88847f640000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 000000000000004f CR3: 000000016fc79001 CR4: 0000000000770ee0
PKRU: 55555554
Call Trace:
<TASK>
? iwl\_mvm\_mac\_setup\_register+0xbdc/0xda0 [iwlmvm]
iwl\_mvm\_start\_post\_nvm+0x71/0x100 [iwlmvm]
iwl\_op\_mode\_mvm\_start+0xab8/0xb30 [iwlmvm]
\_iwl\_op\_mode\_start+0x6f/0xd0 [iwlwifi]
iwl\_opmode\_register+0x6a/0xe0 [iwlwifi]
? 0xffffffffa0231000
iwl\_mvm\_init+0x35/0x1000 [iwlmvm]
? 0xffffffffa0231000
do\_one\_initcall+0x5a/0x1b0
? kmem\_cache\_alloc+0x1e5/0x2f0
? do\_init\_module+0x1e/0x220
do\_init\_module+0x48/0x220
load\_module+0x2602/0x2bc0
? \_\_kernel\_read+0x145/0x2e0
? kernel\_read\_file+0x229/0x290
\_\_do\_sys\_finit\_module+0xc5/0x130
? \_\_do\_sys\_finit\_module+0xc5/0x130
\_\_x64\_sys\_finit\_module+0x13/0x20
do\_syscall\_64+0x38/0x90
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f64dda564dd
Code: 5b 41 5c c3 66 0f 1f 84 00 00 00 00 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 1b 29 0f 00 f7 d8 64 89 01 48
RSP: 002b:00007ffdba393f88 EFLAGS: 00000246 ORIG\_RAX: 0000000000000139
RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f64dda564dd
RDX: 0000000000000000 RSI: 00005575399e2ab2 RDI: 0000000000000001
RBP: 000055753a91c5e0 R08: 0000000000000000 R09: 0000000000000002
R10: 0000000000000001 R11: 0000000000000246 R12: 00005575399e2ab2
R13: 000055753a91ceb0 R14: 0000000000000000 R15: 000055753a923018
</TASK>
Modules linked in: btintel(+) btmtk bluetooth vfat snd\_hda\_codec\_hdmi fat snd\_hda\_codec\_realtek snd\_hda\_codec\_generic iwlmvm(+) snd\_sof\_pci\_intel\_tgl mac80211 snd\_sof\_intel\_hda\_common soundwire\_intel soundwire\_generic\_allocation soundwire\_cadence soundwire\_bus snd\_sof\_intel\_hda snd\_sof\_pci snd\_sof snd\_sof\_xtensa\_dsp snd\_soc\_hdac\_hda snd\_hda\_ext\_core snd\_soc\_acpi\_intel\_match snd\_soc\_acpi snd\_soc\_core btrfs snd\_compress snd\_hda\_intel snd\_intel\_dspcfg snd\_intel\_sdw\_acpi snd\_hda\_codec raid6\_pq iwlwifi snd\_hda\_core snd\_pcm snd\_timer snd soundcore cfg80211 intel\_ish\_ipc(+) thunderbolt rfkill intel\_ishtp ucsi\_acpi wmi i2c\_hid\_acpi i2c\_hid evdev
CR2: 000000000000004f
---[ end trace 0000000000000000 ]---
Check the debugfs\_dir pointer for an error before using it.
Fixes: 8c082a99edb9 ("iwlwifi: mvm: simplify iwl\_mvm\_dbgfs\_register")
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Luca Coelho <luciano.coelho@intel.com>
Cc: linux-wireless@vger.kernel.org
Cc: Kalle Valo <kvalo@kernel.org>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Cc: stable <stable@vger.kernel.org>
Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Link: [https://lore.kernel.org/r/20220223030630.23241-1-rdunlap@infradead.org](https://lore.kernel.org/r/20220223030630.23241-1-rdunlap%40infradead.org)
[change to make both conditional]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7de1ed755e1ace30d97a724bad32452ed86b653b)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=7de1ed755e1ace30d97a724bad32452ed86b653b) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 3 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c b/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.cindex 5dc39fbb74d67c..d398a06b265673 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=728fb555882baf12399764c6a19b33c6a286410f)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=7de1ed755e1ace30d97a724bad32452ed86b653b)@@ -5,6 +5,7 @@ \* Copyright (C) 2016-2017 Intel Deutschland GmbH \*/ #include <linux/vmalloc.h>+#include <linux/err.h> #include <linux/ieee80211.h> #include <linux/netdevice.h> @@ -2044,7 +2045,6 @@ void iwl\_mvm\_sta\_add\_debugfs(struct ieee80211\_hw \*hw, void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) { struct dentry \*bcast\_dir \_\_maybe\_unused;- char buf[100];  spin\_lock\_init(&mvm->drv\_stats\_lock); @@ -2140,6 +2140,11 @@ void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) \* Create a symlink with mac80211. It will be removed when mac80211 \* exists (before the opmode exists which removes the target.) \*/- snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);- debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir, buf);+ if (!IS\_ERR(mvm->debugfs\_dir)) {+ char buf[100];++ snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);+ debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir,+ buf);+ } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:23:10 +0000



=== Content from git.kernel.org_1c2b8c5c_20250111_152431.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Randy Dunlap <rdunlap@infradead.org> | 2022-02-22 19:06:30 -0800 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2022-03-01 11:10:00 +0100 |
| commit | [5a6248c0a22352f09ea041665d3bd3e18f6f872c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)) | |
| tree | [7ea874aff8dda61f404fd78a5edfd91bd7e1f0db](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c) | |
| parent | [1db5fcbba2631277b78d7f8aff99c9607d29f6d8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1db5fcbba2631277b78d7f8aff99c9607d29f6d8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c&id2=1db5fcbba2631277b78d7f8aff99c9607d29f6d8)) | |
| download | [linux-5a6248c0a22352f09ea041665d3bd3e18f6f872c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5a6248c0a22352f09ea041665d3bd3e18f6f872c.tar.gz) | |

iwlwifi: mvm: check debugfs\_dir ptr before useWhen "debugfs=off" is used on the kernel command line, iwiwifi's
mvm module uses an invalid/unchecked debugfs\_dir pointer and causes
a BUG:
BUG: kernel NULL pointer dereference, address: 000000000000004f
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP
CPU: 1 PID: 503 Comm: modprobe Tainted: G W 5.17.0-rc5 #7
Hardware name: Dell Inc. Inspiron 15 5510/076F7Y, BIOS 2.4.1 11/05/2021
RIP: 0010:iwl\_mvm\_dbgfs\_register+0x692/0x700 [iwlmvm]
Code: 69 a0 be 80 01 00 00 48 c7 c7 50 73 6a a0 e8 95 cf ee e0 48 8b 83 b0 1e 00 00 48 c7 c2 54 73 6a a0 be 64 00 00 00 48 8d 7d 8c <48> 8b 48 50 e8 15 22 07 e1 48 8b 43 28 48 8d 55 8c 48 c7 c7 5f 73
RSP: 0018:ffffc90000a0ba68 EFLAGS: 00010246
RAX: ffffffffffffffff RBX: ffff88817d6e3328 RCX: ffff88817d6e3328
RDX: ffffffffa06a7354 RSI: 0000000000000064 RDI: ffffc90000a0ba6c
RBP: ffffc90000a0bae0 R08: ffffffff824e4880 R09: ffffffffa069d620
R10: ffffc90000a0ba00 R11: ffffffffffffffff R12: 0000000000000000
R13: ffffc90000a0bb28 R14: ffff88817d6e3328 R15: ffff88817d6e3320
FS: 00007f64dd92d740(0000) GS:ffff88847f640000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 000000000000004f CR3: 000000016fc79001 CR4: 0000000000770ee0
PKRU: 55555554
Call Trace:
<TASK>
? iwl\_mvm\_mac\_setup\_register+0xbdc/0xda0 [iwlmvm]
iwl\_mvm\_start\_post\_nvm+0x71/0x100 [iwlmvm]
iwl\_op\_mode\_mvm\_start+0xab8/0xb30 [iwlmvm]
\_iwl\_op\_mode\_start+0x6f/0xd0 [iwlwifi]
iwl\_opmode\_register+0x6a/0xe0 [iwlwifi]
? 0xffffffffa0231000
iwl\_mvm\_init+0x35/0x1000 [iwlmvm]
? 0xffffffffa0231000
do\_one\_initcall+0x5a/0x1b0
? kmem\_cache\_alloc+0x1e5/0x2f0
? do\_init\_module+0x1e/0x220
do\_init\_module+0x48/0x220
load\_module+0x2602/0x2bc0
? \_\_kernel\_read+0x145/0x2e0
? kernel\_read\_file+0x229/0x290
\_\_do\_sys\_finit\_module+0xc5/0x130
? \_\_do\_sys\_finit\_module+0xc5/0x130
\_\_x64\_sys\_finit\_module+0x13/0x20
do\_syscall\_64+0x38/0x90
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f64dda564dd
Code: 5b 41 5c c3 66 0f 1f 84 00 00 00 00 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 1b 29 0f 00 f7 d8 64 89 01 48
RSP: 002b:00007ffdba393f88 EFLAGS: 00000246 ORIG\_RAX: 0000000000000139
RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f64dda564dd
RDX: 0000000000000000 RSI: 00005575399e2ab2 RDI: 0000000000000001
RBP: 000055753a91c5e0 R08: 0000000000000000 R09: 0000000000000002
R10: 0000000000000001 R11: 0000000000000246 R12: 00005575399e2ab2
R13: 000055753a91ceb0 R14: 0000000000000000 R15: 000055753a923018
</TASK>
Modules linked in: btintel(+) btmtk bluetooth vfat snd\_hda\_codec\_hdmi fat snd\_hda\_codec\_realtek snd\_hda\_codec\_generic iwlmvm(+) snd\_sof\_pci\_intel\_tgl mac80211 snd\_sof\_intel\_hda\_common soundwire\_intel soundwire\_generic\_allocation soundwire\_cadence soundwire\_bus snd\_sof\_intel\_hda snd\_sof\_pci snd\_sof snd\_sof\_xtensa\_dsp snd\_soc\_hdac\_hda snd\_hda\_ext\_core snd\_soc\_acpi\_intel\_match snd\_soc\_acpi snd\_soc\_core btrfs snd\_compress snd\_hda\_intel snd\_intel\_dspcfg snd\_intel\_sdw\_acpi snd\_hda\_codec raid6\_pq iwlwifi snd\_hda\_core snd\_pcm snd\_timer snd soundcore cfg80211 intel\_ish\_ipc(+) thunderbolt rfkill intel\_ishtp ucsi\_acpi wmi i2c\_hid\_acpi i2c\_hid evdev
CR2: 000000000000004f
---[ end trace 0000000000000000 ]---
Check the debugfs\_dir pointer for an error before using it.
Fixes: 8c082a99edb9 ("iwlwifi: mvm: simplify iwl\_mvm\_dbgfs\_register")
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Luca Coelho <luciano.coelho@intel.com>
Cc: linux-wireless@vger.kernel.org
Cc: Kalle Valo <kvalo@kernel.org>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Cc: stable <stable@vger.kernel.org>
Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Link: [https://lore.kernel.org/r/20220223030630.23241-1-rdunlap@infradead.org](https://lore.kernel.org/r/20220223030630.23241-1-rdunlap%40infradead.org)
[change to make both conditional]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 3 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c b/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.cindex 63432c24eb592a..445c94adb0768b 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=1db5fcbba2631277b78d7f8aff99c9607d29f6d8)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=5a6248c0a22352f09ea041665d3bd3e18f6f872c)@@ -5,6 +5,7 @@ \* Copyright (C) 2016-2017 Intel Deutschland GmbH \*/ #include <linux/vmalloc.h>+#include <linux/err.h> #include <linux/ieee80211.h> #include <linux/netdevice.h> @@ -1857,7 +1858,6 @@ void iwl\_mvm\_sta\_add\_debugfs(struct ieee80211\_hw \*hw, void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) { struct dentry \*bcast\_dir \_\_maybe\_unused;- char buf[100];  spin\_lock\_init(&mvm->drv\_stats\_lock); @@ -1939,6 +1939,11 @@ void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) \* Create a symlink with mac80211. It will be removed when mac80211 \* exists (before the opmode exists which removes the target.) \*/- snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);- debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir, buf);+ if (!IS\_ERR(mvm->debugfs\_dir)) {+ char buf[100];++ snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);+ debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir,+ buf);+ } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:23:09 +0000



=== Content from git.kernel.org_b734aa31_20250111_152433.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Randy Dunlap <rdunlap@infradead.org> | 2022-02-22 19:06:30 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-03-08 19:14:06 +0100 |
| commit | [fe51975ff13831e794e1bcd0039b305dcad3d7ba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)) | |
| tree | [4e5b4b1895083b3617a949e454085973c2f1a5b5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba) | |
| parent | [97ae45ef88e9f6bd4d451ddd594d2606f3bc9a07](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=97ae45ef88e9f6bd4d451ddd594d2606f3bc9a07) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba&id2=97ae45ef88e9f6bd4d451ddd594d2606f3bc9a07)) | |
| download | [linux-fe51975ff13831e794e1bcd0039b305dcad3d7ba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fe51975ff13831e794e1bcd0039b305dcad3d7ba.tar.gz) | |

iwlwifi: mvm: check debugfs\_dir ptr before usecommit 5a6248c0a22352f09ea041665d3bd3e18f6f872c upstream.
When "debugfs=off" is used on the kernel command line, iwiwifi's
mvm module uses an invalid/unchecked debugfs\_dir pointer and causes
a BUG:
BUG: kernel NULL pointer dereference, address: 000000000000004f
#PF: supervisor read access in kernel mode
#PF: error\_code(0x0000) - not-present page
PGD 0 P4D 0
Oops: 0000 [#1] PREEMPT SMP
CPU: 1 PID: 503 Comm: modprobe Tainted: G W 5.17.0-rc5 #7
Hardware name: Dell Inc. Inspiron 15 5510/076F7Y, BIOS 2.4.1 11/05/2021
RIP: 0010:iwl\_mvm\_dbgfs\_register+0x692/0x700 [iwlmvm]
Code: 69 a0 be 80 01 00 00 48 c7 c7 50 73 6a a0 e8 95 cf ee e0 48 8b 83 b0 1e 00 00 48 c7 c2 54 73 6a a0 be 64 00 00 00 48 8d 7d 8c <48> 8b 48 50 e8 15 22 07 e1 48 8b 43 28 48 8d 55 8c 48 c7 c7 5f 73
RSP: 0018:ffffc90000a0ba68 EFLAGS: 00010246
RAX: ffffffffffffffff RBX: ffff88817d6e3328 RCX: ffff88817d6e3328
RDX: ffffffffa06a7354 RSI: 0000000000000064 RDI: ffffc90000a0ba6c
RBP: ffffc90000a0bae0 R08: ffffffff824e4880 R09: ffffffffa069d620
R10: ffffc90000a0ba00 R11: ffffffffffffffff R12: 0000000000000000
R13: ffffc90000a0bb28 R14: ffff88817d6e3328 R15: ffff88817d6e3320
FS: 00007f64dd92d740(0000) GS:ffff88847f640000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 000000000000004f CR3: 000000016fc79001 CR4: 0000000000770ee0
PKRU: 55555554
Call Trace:
<TASK>
? iwl\_mvm\_mac\_setup\_register+0xbdc/0xda0 [iwlmvm]
iwl\_mvm\_start\_post\_nvm+0x71/0x100 [iwlmvm]
iwl\_op\_mode\_mvm\_start+0xab8/0xb30 [iwlmvm]
\_iwl\_op\_mode\_start+0x6f/0xd0 [iwlwifi]
iwl\_opmode\_register+0x6a/0xe0 [iwlwifi]
? 0xffffffffa0231000
iwl\_mvm\_init+0x35/0x1000 [iwlmvm]
? 0xffffffffa0231000
do\_one\_initcall+0x5a/0x1b0
? kmem\_cache\_alloc+0x1e5/0x2f0
? do\_init\_module+0x1e/0x220
do\_init\_module+0x48/0x220
load\_module+0x2602/0x2bc0
? \_\_kernel\_read+0x145/0x2e0
? kernel\_read\_file+0x229/0x290
\_\_do\_sys\_finit\_module+0xc5/0x130
? \_\_do\_sys\_finit\_module+0xc5/0x130
\_\_x64\_sys\_finit\_module+0x13/0x20
do\_syscall\_64+0x38/0x90
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
RIP: 0033:0x7f64dda564dd
Code: 5b 41 5c c3 66 0f 1f 84 00 00 00 00 00 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 1b 29 0f 00 f7 d8 64 89 01 48
RSP: 002b:00007ffdba393f88 EFLAGS: 00000246 ORIG\_RAX: 0000000000000139
RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007f64dda564dd
RDX: 0000000000000000 RSI: 00005575399e2ab2 RDI: 0000000000000001
RBP: 000055753a91c5e0 R08: 0000000000000000 R09: 0000000000000002
R10: 0000000000000001 R11: 0000000000000246 R12: 00005575399e2ab2
R13: 000055753a91ceb0 R14: 0000000000000000 R15: 000055753a923018
</TASK>
Modules linked in: btintel(+) btmtk bluetooth vfat snd\_hda\_codec\_hdmi fat snd\_hda\_codec\_realtek snd\_hda\_codec\_generic iwlmvm(+) snd\_sof\_pci\_intel\_tgl mac80211 snd\_sof\_intel\_hda\_common soundwire\_intel soundwire\_generic\_allocation soundwire\_cadence soundwire\_bus snd\_sof\_intel\_hda snd\_sof\_pci snd\_sof snd\_sof\_xtensa\_dsp snd\_soc\_hdac\_hda snd\_hda\_ext\_core snd\_soc\_acpi\_intel\_match snd\_soc\_acpi snd\_soc\_core btrfs snd\_compress snd\_hda\_intel snd\_intel\_dspcfg snd\_intel\_sdw\_acpi snd\_hda\_codec raid6\_pq iwlwifi snd\_hda\_core snd\_pcm snd\_timer snd soundcore cfg80211 intel\_ish\_ipc(+) thunderbolt rfkill intel\_ishtp ucsi\_acpi wmi i2c\_hid\_acpi i2c\_hid evdev
CR2: 000000000000004f
---[ end trace 0000000000000000 ]---
Check the debugfs\_dir pointer for an error before using it.
Fixes: 8c082a99edb9 ("iwlwifi: mvm: simplify iwl\_mvm\_dbgfs\_register")
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Cc: Luca Coelho <luciano.coelho@intel.com>
Cc: linux-wireless@vger.kernel.org
Cc: Kalle Valo <kvalo@kernel.org>
Cc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Cc: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Cc: stable <stable@vger.kernel.org>
Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Link: [https://lore.kernel.org/r/20220223030630.23241-1-rdunlap@infradead.org](https://lore.kernel.org/r/20220223030630.23241-1-rdunlap%40infradead.org)
[change to make both conditional]
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)

| -rw-r--r-- | [drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 3 deletions

| diff --git a/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c b/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.cindex 64100e73b5bc64..a0d6194f8a52ab 100644--- a/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=97ae45ef88e9f6bd4d451ddd594d2606f3bc9a07)+++ b/[drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/intel/iwlwifi/mvm/debugfs.c?id=fe51975ff13831e794e1bcd0039b305dcad3d7ba)@@ -5,6 +5,7 @@ \* Copyright (C) 2016-2017 Intel Deutschland GmbH \*/ #include <linux/vmalloc.h>+#include <linux/err.h> #include <linux/ieee80211.h> #include <linux/netdevice.h> @@ -1849,7 +1850,6 @@ void iwl\_mvm\_sta\_add\_debugfs(struct ieee80211\_hw \*hw, void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) { struct dentry \*bcast\_dir \_\_maybe\_unused;- char buf[100];  spin\_lock\_init(&mvm->drv\_stats\_lock); @@ -1930,6 +1930,11 @@ void iwl\_mvm\_dbgfs\_register(struct iwl\_mvm \*mvm) \* Create a symlink with mac80211. It will be removed when mac80211 \* exists (before the opmode exists which removes the target.) \*/- snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);- debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir, buf);+ if (!IS\_ERR(mvm->debugfs\_dir)) {+ char buf[100];++ snprintf(buf, 100, "../../%pd2", mvm->debugfs\_dir->d\_parent);+ debugfs\_create\_symlink("iwlwifi", mvm->hw->wiphy->debugfsdir,+ buf);+ } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:23:11 +0000


