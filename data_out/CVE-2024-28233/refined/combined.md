=== Content from github.com_8e647ea9_20250111_100403.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyterhub%2Fsecurity%2Fadvisories%2FGHSA-7r3h-4ph8-w38g)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyterhub%2Fsecurity%2Fadvisories%2FGHSA-7r3h-4ph8-w38g)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=jupyterhub%2Fjupyterhub)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[jupyterhub](/jupyterhub/jupyterhub)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Fjupyterhub) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2Fjupyterhub%2Fjupyterhub)
* [Star
   7.9k](/login?return_to=%2Fjupyterhub%2Fjupyterhub)

* [Code](/jupyterhub/jupyterhub)
* [Issues
  170](/jupyterhub/jupyterhub/issues)
* [Pull requests
  15](/jupyterhub/jupyterhub/pulls)
* [Actions](/jupyterhub/jupyterhub/actions)
* [Projects
  0](/jupyterhub/jupyterhub/projects)
* [Security](/jupyterhub/jupyterhub/security)
* [Insights](/jupyterhub/jupyterhub/pulse)

Additional navigation options

* [Code](/jupyterhub/jupyterhub)
* [Issues](/jupyterhub/jupyterhub/issues)
* [Pull requests](/jupyterhub/jupyterhub/pulls)
* [Actions](/jupyterhub/jupyterhub/actions)
* [Projects](/jupyterhub/jupyterhub/projects)
* [Security](/jupyterhub/jupyterhub/security)
* [Insights](/jupyterhub/jupyterhub/pulse)

# XSS in JupyterHub via Self-XSS leveraged by Cookie Tossing

High

[minrk](/minrk)
published
GHSA-7r3h-4ph8-w38g
Mar 27, 2024

## Package

pip

jupyterhub
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 4.1

## Patched versions

4.1.0

## Description

### Impact

Affected configurations:

* Single-origin JupyterHub deployments
* JupyterHub deployments with user-controlled applications running on subdomains or peer subdomains of either the Hub or a single-user server.

By tricking a user into visiting a malicious subdomain, the attacker can achieve an XSS directly affecting the former's session. More precisely, in the context of JupyterHub, this XSS could achieve the following:

* Full access to JupyterHub API and user's single-user server, e.g.
  + Create and exfiltrate an API Token
  + Exfiltrate all files hosted on the user's single-user server: notebooks, images, etc.
  + Install malicious extensions. They can be used as a backdoor to silently regain access to victim's session anytime.

### Patches

To prevent cookie-tossing:

* Upgrade to JupyterHub 4.1 (both hub and user environment)
* enable per-user domains via `c.JupyterHub.subdomain_host = "https://mydomain.example.org"`
* set `c.JupyterHub.cookie_host_prefix_enabled = True` to enable domain-locked cookies

or, if available (applies to earlier JupyterHub versions):

* deploy jupyterhub on its own domain, not shared with any other services
* enable per-user domains via `c.JupyterHub.subdomain_host = "https://mydomain.example.org"`

### Severity

High

### CVE ID

CVE-2024-28233

### Weaknesses

[CWE-352](/advisories?query=cwe%3A352) [CWE-565](/advisories?query=cwe%3A565)

### Credits

* [![@Th0h0](https://avatars.githubusercontent.com/u/52637916?s=40&v=4)](/Th0h0)
  [Th0h0](/Th0h0)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e1cb44c9_20250111_100403.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyterhub%2Fcommit%2Fe2798a088f5ad45340fe79cdf1386198e664f77f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyterhub%2Fcommit%2Fe2798a088f5ad45340fe79cdf1386198e664f77f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=jupyterhub%2Fjupyterhub)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[jupyterhub](/jupyterhub)
/
**[jupyterhub](/jupyterhub/jupyterhub)**
Public

* [Notifications](/login?return_to=%2Fjupyterhub%2Fjupyterhub) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2Fjupyterhub%2Fjupyterhub)
* [Star
   7.9k](/login?return_to=%2Fjupyterhub%2Fjupyterhub)

* [Code](/jupyterhub/jupyterhub)
* [Issues
  170](/jupyterhub/jupyterhub/issues)
* [Pull requests
  15](/jupyterhub/jupyterhub/pulls)
* [Actions](/jupyterhub/jupyterhub/actions)
* [Projects
  0](/jupyterhub/jupyterhub/projects)
* [Security](/jupyterhub/jupyterhub/security)
* [Insights](/jupyterhub/jupyterhub/pulse)

Additional navigation options

* [Code](/jupyterhub/jupyterhub)
* [Issues](/jupyterhub/jupyterhub/issues)
* [Pull requests](/jupyterhub/jupyterhub/pulls)
* [Actions](/jupyterhub/jupyterhub/actions)
* [Projects](/jupyterhub/jupyterhub/projects)
* [Security](/jupyterhub/jupyterhub/security)
* [Insights](/jupyterhub/jupyterhub/pulse)

## Commit

[Permalink](/jupyterhub/jupyterhub/commit/e2798a088f5ad45340fe79cdf1386198e664f77f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-7r3h-4ph8-w38g](https://github.com/advisories/GHSA-7r3h-4ph8-w38g "GHSA-7r3h-4ph8-w38g")

[Browse files](/jupyterhub/jupyterhub/tree/e2798a088f5ad45340fe79cdf1386198e664f77f)
Browse the repository at this point in the history

```
4.1.0
```

* Loading branch information

[![@minrk](https://avatars.githubusercontent.com/u/151929?s=40&v=4)](/minrk)

[minrk](/jupyterhub/jupyterhub/commits?author=minrk "View all commits by minrk")
authored
Mar 20, 2024

2 parents
[aeeabbe](/jupyterhub/jupyterhub/commit/aeeabbee07b3acc20dbc71604938084150df317a)
+
[3fa60e6](/jupyterhub/jupyterhub/commit/3fa60e6849668ec1be35082d7f6e81f3db96222d)

commit e2798a0

 Show file tree

 Hide file tree

Showing
**20 changed files**
with
**1,131 additions**
and
**135 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .github/workflows

  + .github/workflows/test.yml
    [test.yml](#diff-faff1af3d8ff408964a57b2e475f69a6b7c7b71c9978cccc8f471798caac2c88)
* docs/source

  + explanation

    - docs/source/explanation/websecurity.md
      [websecurity.md](#diff-ee9597d83fc569f19037a57616a6e47b0f1bfeb85cb752bc4005bb00364d4784)
  + reference

    - docs/source/reference/changelog.md
      [changelog.md](#diff-03df69a58f33a319da005e5a54ae57fd037e583e8f266837f4806b9452788033)
* jupyterhub

  + jupyterhub/\_xsrf\_utils.py
    [\_xsrf\_utils.py](#diff-dab0132178c502b710491c0eec47c5b11bc629dee87b8b92eb09ac7d3ddc20c7)
  + apihandlers

    - jupyterhub/apihandlers/base.py
      [base.py](#diff-ab9b2de77093dfc14c995e15cd030ece02ac0e311c83bc2c4d9381d12964245a)
  + jupyterhub/app.py
    [app.py](#diff-24343a4facb880f2c9c882604e6b13654dccabee03f69097793fb2a79ce45ef2)
  + handlers

    - jupyterhub/handlers/base.py
      [base.py](#diff-7f097baf93f8cfafbafcfb5b4c4466d11e558d1cf89535bd32d946814317e8d5)
  + services

    - jupyterhub/services/auth.py
      [auth.py](#diff-514e695392b67987ea4b144e522365c14062bb806eaa0bfe8f1d24175cabe072)
  + singleuser

    - jupyterhub/singleuser/extension.py
      [extension.py](#diff-e7f767b0a81fe6feebc17a719f6f2806c7096064b5b0d849077772d898430c82)
    - jupyterhub/singleuser/mixins.py
      [mixins.py](#diff-8337e3cdc557272aa014bfcbab481b0ad69c082aa0d714f27a188024c1f2cc57)
  + jupyterhub/spawner.py
    [spawner.py](#diff-cfa168c3c78c01c2bbdbd43bfbc61d7e2bf150b3f4932cea573283a2a9e1a684)
  + tests

    - browser

      * jupyterhub/tests/browser/test\_browser.py
        [test\_browser.py](#diff-678f06cea954ec81c8ae4d79dcccfb3c7c83c741d5fbb4cc9c8ac9d950b61a77)
    - jupyterhub/tests/mocking.py
      [mocking.py](#diff-dd0126c5e065a9a6fc20593035e03dfaed00b17650430424b508ef7bcb20f096)
    - jupyterhub/tests/test\_api.py
      [test\_api.py](#diff-3cd55e1aa706f11b3120bd73a5c7dae2c3d398d19c33ec883cd0c0ded1c343d8)
    - jupyterhub/tests/test\_pages.py
      [test\_pages.py](#diff-d39f411abda875a7b1d380827959d0415bb876d6a3336f7c5bccefde70a24396)
    - jupyterhub/tests/test\_services\_auth.py
      [test\_services\_auth.py](#diff-079b6368e96322f8d362e623950776c18924b48815c28a7dfeec326e12a23795)
    - jupyterhub/tests/test\_singleuser.py
      [test\_singleuser.py](#diff-acf3142ed850fa20b6fbc978146b3e280307d61f2855d8f32f30fda1bf68acb7)
    - jupyterhub/tests/utils.py
      [utils.py](#diff-dd9e49bff19a4440f62204c4dfe6e2d602e7882927ef048e0f07582e3c055133)
  + jupyterhub/user.py
    [user.py](#diff-3f4d95fa8413fa09878042ce505d18f91cfc2d043fbd66d0fe8fb818b15ba7ca)
  + jupyterhub/utils.py
    [utils.py](#diff-6cafcd890c3e465498df02af8660a1ebf5513c9804c761d5a369ad908ad67149)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[.github/workflows/test.yml](#diff-faff1af3d8ff408964a57b2e475f69a6b7c7b71c9978cccc8f471798caac2c88 ".github/workflows/test.yml")

Show comments

[View file](/jupyterhub/jupyterhub/blob/e2798a088f5ad45340fe79cdf1386198e664f77f/.github/workflows/test.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -100,6 +100,9 @@ jobs: |
|  |  | subset: singleuser |
|  |  | - python: "3.11" |
|  |  | browser: browser |
|  |  | - python: "3.11" |
|  |  | subdomain: subdomain |
|  |  | browser: browser |
|  |  | - python: "3.11" |
|  |  | main\_dependencies: main\_dependencies |
|  |  |  |
| Expand Down | |  |

178 changes: 157 additions & 21 deletions

178
[docs/source/explanation/websecurity.md](#diff-ee9597d83fc569f19037a57616a6e47b0f1bfeb85cb752bc4005bb00364d4784 "docs/source/explanation/websecurity.md")

Show comments

[View file](/jupyterhub/jupyterhub/blob/e2798a088f5ad45340fe79cdf1386198e664f77f/docs/source/explanation/websecurity.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -16,7 +16,8 @@ works. |
|  |  |  |
|  |  | JupyterHub is designed to be a \_simple multi-user server for modestly sized |
|  |  | groups\_ of \*\*semi-trusted\*\* users. While the design reflects serving |
|  |  | semi-trusted users, JupyterHub can also be suitable for serving \*\*untrusted\*\* users. |
|  |  | semi-trusted users, JupyterHub can also be suitable for serving \*\*untrusted\*\* users, |
|  |  | but \*\*is not suitable for untrusted users\*\* in its default configuration. |
|  |  |  |
|  |  | As a result, using JupyterHub with \*\*untrusted\*\* users means more work by the |
|  |  | administrator, since much care is required to secure a Hub, with extra caution on |
| Expand Down  Expand Up | | @@ -52,33 +53,67 @@ ensure that: |
|  |  | their single-user server; |
|  |  | - the modification of the configuration of the notebook server |
|  |  | (the `~/.jupyter` or `JUPYTER\_CONFIG\_DIR` directory). |
|  |  | - unrestricted selection of the base environment (e.g. the image used in container-based Spawners) |
|  |  |  |
|  |  | If any additional services are run on the same domain as the Hub, the services |
|  |  | \*\*must never\*\* display user-authored HTML that is neither \_sanitized\_ nor \_sandboxed\_ |
|  |  | (e.g. IFramed) to any user that lacks authentication as the author of a file. |
|  |  | to any user that lacks authentication as the author of a file. |
|  |  |  |
|  |  | ### Sharing access to servers |
|  |  |  |
|  |  | Because sharing access to servers (via `access:servers` scopes or the sharing feature in JupyterHub 5) by definition means users can serve each other files, enabling sharing is not suitable for untrusted users without also enabling per-user domains. |
|  |  |  |
|  |  | JupyterHub does not enable any sharing by default. |
|  |  |  |
|  |  | ## Mitigate security issues |
|  |  |  |
|  |  | The several approaches to mitigating security issues with configuration |
|  |  | options provided by JupyterHub include: |
|  |  |  |
|  |  | ### Enable subdomains |
|  |  | ### Enable user subdomains |
|  |  |  |
|  |  | JupyterHub provides the ability to run single-user servers on their own |
|  |  | subdomains. This means the cross-origin protections between servers has the |
|  |  | desired effect, and user servers and the Hub are protected from each other. A |
|  |  | user's single-user server will be at `username.jupyter.mydomain.com`. This also |
|  |  | requires all user subdomains to point to the same address, which is most easily |
|  |  | accomplished with wildcard DNS. Since this spreads the service across multiple |
|  |  | domains, you will need wildcard SSL as well. Unfortunately, for many |
|  |  | institutional domains, wildcard DNS and SSL are not available. \*\*If you do plan |
|  |  | to serve untrusted users, enabling subdomains is highly encouraged\*\*, as it |
|  |  | resolves the cross-site issues. |
|  |  | domains. This means the cross-origin protections between servers has the |
|  |  | desired effect, and user servers and the Hub are protected from each other. |
|  |  |  |
|  |  | \*\*Subdomains are the only way to reliably isolate user servers from each other.\*\* |
|  |  |  |
|  |  | To enable subdomains, set: |
|  |  |  |
|  |  | ```python |
|  |  | c.JupyterHub.subdomain\_host = "https://jupyter.example.org" |
|  |  | ``` |
|  |  |  |
|  |  | When subdomains are enabled, each user's single-user server will be at e.g. `https://username.jupyter.example.org`. |
|  |  | This also requires all user subdomains to point to the same address, |
|  |  | which is most easily accomplished with wildcard DNS, where a single A record points to your server and a wildcard CNAME record points to your A record: |
|  |  |  |
|  |  | ``` |
|  |  | A jupyter.example.org 192.168.1.123 |
|  |  | CNAME \*.jupyter.example.org jupyter.example.org |
|  |  | ``` |
|  |  |  |
|  |  | Since this spreads the service across multiple domains, you will likely need wildcard SSL as well, |
|  |  | matching `\*.jupyter.example.org`. |
|  |  |  |
|  |  | Unfortunately, for many institutional domains, wildcard DNS and SSL may not be available. |
|  |  |  |
|  |  | We also \*\*strongly encourage\*\* serving JupyterHub and user content on a domain that is \_not\_ a subdomain of any sensitive content. |
|  |  | For reasoning, see [GitHub's discussion of moving user content to github.io from \\*.github.com](https://github.blog/2013-04-09-yummy-cookies-across-domains/). |
|  |  |  |
|  |  | \*\*If you do plan to serve untrusted users, enabling subdomains is highly encouraged\*\*, |
|  |  | as it resolves many security issues, which are difficult to unavoidable when JupyterHub is on a single-domain. |
|  |  |  |
|  |  | :::{important} |
|  |  | JupyterHub makes no guarantees about protecting users from each other unless subdomains are enabled. |
|  |  |  |
|  |  | If you want to protect users from each other, you \*\*\_must\_\*\* enable per-user domains. |
|  |  | ::: |
|  |  |  |
|  |  | ### Disable user config |
|  |  |  |
|  |  | If subdomains are unavailable or undesirable, JupyterHub provides a |
|  |  | configuration option `Spawner.disable\_user\_config`, which can be set to prevent |
|  |  | configuration option `Spawner.disable\_user\_config = True`, which can be set to prevent |
|  |  | the user-owned configuration files from being loaded. After implementing this |
|  |  | option, `PATH`s and package installation are the other things that the |
|  |  | admin must enforce. |
| Expand All | | @@ -88,21 +123,24 @@ admin must enforce. |
|  |  | For most Spawners, `PATH` is not something users can influence, but it's important that |
|  |  | the Spawner should \_not\_ evaluate shell configuration files prior to launching the server. |
|  |  |  |
|  |  | ### Isolate packages using virtualenv |
|  |  | ### Isolate packages in a read-only environment |
|  |  |  |
|  |  | Package isolation is most easily handled by running the single-user server in |
|  |  | a virtualenv with disabled system-site-packages. The user should not have |
|  |  | permission to install packages into this environment. |
|  |  | The user must not have permission to install packages into the environment where the singleuser-server runs. |
|  |  | On a shared system, package isolation is most easily handled by running the single-user server in |
|  |  | a root-owned virtualenv with disabled system-site-packages. |
|  |  | The user must not have permission to install packages into this environment. |
|  |  | The same principle extends to the images used by container-based deployments. |
|  |  | If users can select the images in which their servers run, they can disable all security for their own servers. |
|  |  |  |
|  |  | It is important to note that the control over the environment only affects the |
|  |  | single-user server, and not the environment(s) in which the user's kernel(s) |
|  |  | It is important to note that the control over the environment is only required for the |
|  |  | single-user server, and not the environment(s) in which the users' kernel(s) |
|  |  | may run. Installing additional packages in the kernel environment does not |
|  |  | pose additional risk to the web application's security. |
|  |  |  |
|  |  | ### Encrypt internal connections with SSL/TLS |
|  |  |  |
|  |  | By default, all communications on the server, between the proxy, hub, and single |
|  |  | -user notebooks are performed unencrypted. Setting the `internal\_ssl` flag in |
|  |  | By default, all communications within JupyterHub—between the proxy, hub, and single |
|  |  | -user notebooks—are performed unencrypted. Setting the `internal\_ssl` flag in |
|  |  | `jupyterhub\_config.py` secures the aforementioned routes. Turning this |
|  |  | feature on does require that the enabled `Spawner` can use the certificates |
|  |  | generated by the `Hub` (the default `LocalProcessSpawner` can, for instance). |
| Expand All | | @@ -116,6 +154,104 @@ Unix permissions to the communication sockets thereby restricting |
|  |  | communication to the socket owner. The `internal\_ssl` option will eventually |
|  |  | extend to securing the `tcp` sockets as well. |
|  |  |  |
|  |  | ### Mitigating same-origin deployments |
|  |  |  |
|  |  | While per-user domains are \*\*required\*\* for robust protection of users from each other, |
|  |  | you can mitigate many (but not all) cross-user issues. |
|  |  | First, it is critical that users cannot modify their server environments, as described above. |
|  |  | Second, it is important that users do not have `access:servers` permission to any server other than their own. |
|  |  |  |
|  |  | If users can access each others' servers, additional security measures must be enabled, some of which come with distinct user-experience costs. |
|  |  |  |
|  |  | Without the [Same-Origin Policy] (SOP) protecting user servers from each other, |
|  |  | each user server is considered a trusted origin for requests to each other user server (and the Hub itself). |
|  |  | Servers \_cannot\_ meaningfully distinguish requests originating from other user servers, |
|  |  | because SOP implies a great deal of trust, losing many restrictions applied to cross-origin requests. |
|  |  |  |
|  |  | That means pages served from each user server can: |
|  |  |  |
|  |  | 1. arbitrarily modify the path in the Referer |
|  |  | 2. make fully authorized requests with cookies |
|  |  | 3. access full page contents served from the hub or other servers via popups |
|  |  |  |
|  |  | JupyterHub uses distinct xsrf tokens stored in cookies on each server path to attempt to limit requests across. |
|  |  | This has limitations because not all requests are protected by these XSRF tokens, |
|  |  | and unless additional measures are taken, the XSRF tokens from other user prefixes may be retrieved. |
|  |  |  |
|  |  | [Same-Origin Policy]: https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin\_policy |
|  |  |  |
|  |  | For example: |
|  |  |  |
|  |  | - `Content-Security-Policy` header must prohibit popups and iframes from the same origin. |
|  |  | The following Content-Security-Policy rules are \_insecure\_ and readily enable users to access each others' servers: |
|  |  |  |
|  |  | - `frame-ancestors: 'self'` |
|  |  | - `frame-ancestors: '\*'` |
|  |  | - `sandbox allow-popups` |
|  |  |  |
|  |  | - Ideally, pages should use the strictest `Content-Security-Policy: sandbox` available, |
|  |  | but this is not feasible in general for JupyterLab pages, which need at least `sandbox allow-same-origin allow-scripts` to work. |
|  |  |  |
|  |  | The default Content-Security-Policy for single-user servers is |
|  |  |  |
|  |  | ``` |
|  |  | frame-ancestors: 'none' |
|  |  | ``` |
|  |  |  |
|  |  | which prohibits iframe embedding, but not pop-ups. |
|  |  |  |
|  |  | A more secure Content-Security-Policy that has some costs to user experience is: |
|  |  |  |
|  |  | ``` |
|  |  | frame-ancestors: 'none'; sandbox allow-same-origin allow-scripts |
|  |  | ``` |
|  |  |  |
|  |  | `allow-popups` is not disabled by default because disabling it breaks legitimate functionality, like "Open this in a new tab", and the "JupyterHub Control Panel" menu item. |
|  |  | To reiterate, the right way to avoid these issues is to enable per-user domains, where none of these concerns come up. |
|  |  |  |
|  |  | Note: even this level of protection requires administrators maintaining full control over the user server environment. |
|  |  | If users can modify their server environment, these methods are ineffective, as users can readily disable them. |
|  |  |  |
|  |  | ### Cookie tossing |
|  |  |  |
|  |  | Cookie tossing is a technique where another server on a subdomain or peer subdomain can set a cookie |
|  |  | which will be read on another domain. |
|  |  | This is not relevant unless there are other user-controlled servers on a peer domain. |
|  |  |  |
|  |  | "Domain-locked" cookies avoid this issue, but have their own restrictions: |
|  |  |  |
|  |  | - JupyterHub must be served over HTTPS |
|  |  | - All secure cookies must be set on `/`, not on sub-paths, which means they are shared by all JupyterHub components in a single-domain deployment. |
|  |  |  |
|  |  | As a result, this option is only recommended when per-user subdomains are enabled, |
|  |  | to prevent sending all jupyterhub cookies to all user servers. |
|  |  |  |
|  |  | To enable domain-locked cookies, set: |
|  |  |  |
|  |  | ```python |
|  |  | c.JupyterHub.cookie\_host\_prefix\_enabled = True |
|  |  | ``` |
|  |  |  |
|  |  | ```{versionadded} 4.1 |
|  |  |  |
|  |  | ``` |
|  |  |  |
|  |  | ### Forced-login |
|  |  |  |
|  |  | Jupyter servers can share links with `?token=...`. |
|  |  | JupyterHub prior to 5.0 will accept this request and persist the token for future requests. |
|  |  | This is useful for enabling admins to create 'fully authenticated' links bypassing login. |
|  |  | However, it also means users can share their own links that will log other users into their own servers, |
|  |  | enabling them to serve each other notebooks and other arbitrary HTML, depending on server configuration. |
|  |  |  |
|  |  | ```{versionadded} 4.1 |
|  |  | Setting environment variable `JUPYTERHUB\_ALLOW\_TOKEN\_IN\_URL=0` in the single-user environment can opt out of accepting token auth in URL parameters. |
|  |  | ``` |
|  |  |  |
|  |  | ```{versionadded} 5.0 |
|  |  | Accepting tokens in URLs is disabled by default, and `JUPYTERHUB\_ALLOW\_TOKEN\_IN\_URL=1` environment variable must be set to \_allow\_ token auth in URL parameters. |
|  |  | ``` |
|  |  |  |
|  |  | ## Security audits |
|  |  |  |
|  |  | We recommend that you do periodic reviews of your deployment's security. It's |
| Expand Down | |  |

51 changes: 51 additions & 0 deletions

51
[docs/source/reference/changelog.md](#diff-03df69a58f33a319da005e5a54ae57fd037e583e8f266837f4806b9452788033 "docs/source/reference/changelog.md")

Show comments

[View file](/jupyterhub/jupyterhub/blob/e2798a088f5ad45340fe79cdf1386198e664f77f/docs/source/reference/changelog.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -8,6 +8,57 @@ command line for details. |
|  |  |  |
|  |  | ## [Unreleased] |
|  |  |  |
|  |  | ## 4.1 |
|  |  |  |
|  |  | ### 4.1.0 - 2024-03 |
|  |  |  |
|  |  | JupyterHub 4.1 is a security release, fixing [CVE-2024-28233]. |
|  |  | All JupyterHub deployments are encouraged to upgrade, |
|  |  | especially those with other user content on peer domains to JupyterHub. |
|  |  |  |
|  |  | As always, JupyterHub deployments are especially encouraged to enable per-user domains if protecting users from each other is a concern. |
|  |  |  |
|  |  | For more information on securely deploying JupyterHub, see the [web security documentation](web-security). |
|  |  |  |
|  |  | [CVE-2024-28233]: https://github.com/jupyterhub/jupyterhub/security/advisories/GHSA-7r3h-4ph8-w38g |
|  |  |  |
|  |  | ([full changelog](https://github.com/jupyterhub/jupyterhub/compare/4.0.2...4.1.0)) |
|  |  |  |
|  |  | #### Enhancements made |
|  |  |  |
|  |  | - Backport PR #4628 on branch 4.x (Include LDAP groups in local spawner gids) [#4735](https://github.com/jupyterhub/jupyterhub/pull/4735) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4561 on branch 4.x (Improve debugging when waiting for servers) [#4714](https://github.com/jupyterhub/jupyterhub/pull/4714) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4563 on branch 4.x (only set 'domain' field on session-id cookie) [#4707](https://github.com/jupyterhub/jupyterhub/pull/4707) ([@minrk](https://github.com/minrk)) |
|  |  |  |
|  |  | #### Bugs fixed |
|  |  |  |
|  |  | - Backport PR #4733 on branch 4.x (Catch ValueError while waiting for server to be reachable) [#4734](https://github.com/jupyterhub/jupyterhub/pull/4734) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4679 on branch 4.x (Unescape jinja username) [#4705](https://github.com/jupyterhub/jupyterhub/pull/4705) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4630: avoid setting unused oauth state cookies on API requests [#4697](https://github.com/jupyterhub/jupyterhub/pull/4697) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4632: simplify, avoid errors in parsing accept headers [#4696](https://github.com/jupyterhub/jupyterhub/pull/4696) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4677 on branch 4.x (Improve validation, docs for token.expires\_in) [#4692](https://github.com/jupyterhub/jupyterhub/pull/4692) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4570 on branch 4.x (fix mutation of frozenset in scope intersection) [#4691](https://github.com/jupyterhub/jupyterhub/pull/4691) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4562 on branch 4.x (Use `user.stop` to cleanup spawners that stopped while Hub was down) [#4690](https://github.com/jupyterhub/jupyterhub/pull/4690) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4542 on branch 4.x (Fix include\_stopped\_servers in paginated next\_url) [#4689](https://github.com/jupyterhub/jupyterhub/pull/4689) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4651 on branch 4.x (avoid attempting to patch removed IPythonHandler with notebook v7) [#4688](https://github.com/jupyterhub/jupyterhub/pull/4688) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4560 on branch 4.x (singleuser extension: persist token from ?token=... url in cookie) [#4687](https://github.com/jupyterhub/jupyterhub/pull/4687) ([@minrk](https://github.com/minrk)) |
|  |  |  |
|  |  | #### Maintenance and upkeep improvements |
|  |  |  |
|  |  | - Backport quay.io publishing [#4698](https://github.com/jupyterhub/jupyterhub/pull/4698) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4617: try to improve reliability of test\_external\_proxy [#4695](https://github.com/jupyterhub/jupyterhub/pull/4695) ([@minrk](https://github.com/minrk)) |
|  |  | - Backport PR #4618 on branch 4.x (browser test: wait for token request to finish before reloading) [#4694](https://github.com/jupyterhub/jupyterhub/pull/4694) ([@minrk](https://github.com/minrk)) |
|  |  | - preparing 4.x branch [#4685](https://github.com/jupyterhub/jupyterhub/pull/4685) ([@minrk](https://github.com/minrk), [@consideRatio](https://github.com/consideRatio)) |
|  |  |  |
|  |  | #### Contributors to this release |
|  |  |  |
|  |  | The following people contributed discussions, new ideas, code and documentation contributions, and review. |
|  |  | See [our definition of contributors](https://github-activity.readthedocs.io/en/latest/#how-does-this-tool-define-contributions-in-the-reports). |
|  |  |  |
|  |  | ([GitHub contributors page for this release](https://github.com/jupyterhub/jupyterhub/graphs/contributors?from=2023-08-10&to=2024-03-19&type=c)) |
|  |  |  |
|  |  | @Achele ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3AAchele+updated%3A2023-08-10..2024-03-19&type=Issues)) | @akashthedeveloper ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Aakashthedeveloper+updated%3A2023-08-10..2024-03-19&type=Issues)) | @balajialg ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Abalajialg+updated%3A2023-08-10..2024-03-19&type=Issues)) | @BhavyaT-135 ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3ABhavyaT-135+updated%3A2023-08-10..2024-03-19&type=Issues)) | @blink1073 ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Ablink1073+updated%3A2023-08-10..2024-03-19&type=Issues)) | @consideRatio ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3AconsideRatio+updated%3A2023-08-10..2024-03-19&type=Issues)) | @fcollonval ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Afcollonval+updated%3A2023-08-10..2024-03-19&type=Issues)) | @I-Am-D-B ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3AI-Am-D-B+updated%3A2023-08-10..2024-03-19&type=Issues)) | @jakirkham ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Ajakirkham+updated%3A2023-08-10..2024-03-19&type=Issues)) | @ktaletsk ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Aktaletsk+updated%3A2023-08-10..2024-03-19&type=Issues)) | @kzgrzendek ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Akzgrzendek+updated%3A2023-08-10..2024-03-19&type=Issues)) | @lumberbot-app ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Alumberbot-app+updated%3A2023-08-10..2024-03-19&type=Issues)) | @manics ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Amanics+updated%3A2023-08-10..2024-03-19&type=Issues)) | @mbiette ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Ambiette+updated%3A2023-08-10..2024-03-19&type=Issues)) | @minrk ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Aminrk+updated%3A2023-08-10..2024-03-19&type=Issues)) | @rcthomas ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Arcthomas+updated%3A2023-08-10..2024-03-19&type=Issues)) | @ryanlovett ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Aryanlovett+updated%3A2023-08-10..2024-03-19&type=Issues)) | @sgaist ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Asgaist+updated%3A2023-08-10..2024-03-19&type=Issues)) | @shubham0473 ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Ashubham0473+updated%3A2023-08-10..2024-03-19&type=Issues)) | @Temidayo32 ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3ATemidayo32+updated%3A2023-08-10..2024-03-19&type=Issues)) | @willingc ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Awillingc+updated%3A2023-08-10..2024-03-19&type=Issues)) | @yuvipanda ([activity](https://github.com/search?q=repo%3Ajupyterhub%2Fjupyterhub+involves%3Ayuvipanda+updated%3A2023-08-10..2024-03-19&type=Issues)) |
|  |  |  |
|  |  | ## 4.0 |
|  |  |  |
|  |  | ### 4.0.2 - 2023-08-10 |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e2798a0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjupyterhub%2Fjupyterhub%2Fcommit%2Fe2798a088f5ad45340fe79cdf1386198e664f77f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


