=== Content from git.kernel.org_fa0c48ac_20250111_144251.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b775f37d943966f6f77dca402f5a9dedce502c25)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b775f37d943966f6f77dca402f5a9dedce502c25)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b775f37d943966f6f77dca402f5a9dedce502c25)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b775f37d943966f6f77dca402f5a9dedce502c25)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Wang Hai <wanghai38@huawei.com> | 2022-11-16 01:24:07 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-08 11:23:55 +0100 |
| commit | [b775f37d943966f6f77dca402f5a9dedce502c25](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b775f37d943966f6f77dca402f5a9dedce502c25) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b775f37d943966f6f77dca402f5a9dedce502c25)) | |
| tree | [0abbc67764b34650b8ec01ca46842070e8bb5972](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b775f37d943966f6f77dca402f5a9dedce502c25) | |
| parent | [086f656e447b082c055cab9b059a71cd409e5c60](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=086f656e447b082c055cab9b059a71cd409e5c60) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b775f37d943966f6f77dca402f5a9dedce502c25&id2=086f656e447b082c055cab9b059a71cd409e5c60)) | |
| download | [linux-b775f37d943966f6f77dca402f5a9dedce502c25.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b775f37d943966f6f77dca402f5a9dedce502c25.tar.gz) | |

e100: Fix possible use after free in e100\_xmit\_prepare[ Upstream commit 45605c75c52c7ae7bfe902214343aabcfe5ba0ff ]
In e100\_xmit\_prepare(), if we can't map the skb, then return -ENOMEM, so
e100\_xmit\_frame() will return NETDEV\_TX\_BUSY and the upper layer will
resend the skb. But the skb is already freed, which will cause UAF bug
when the upper layer resends the skb.
Remove the harmful free.
Fixes: 5e5d49422dfb ("e100: Release skb when DMA mapping is failed in e100\_xmit\_prepare")
Signed-off-by: Wang Hai <wanghai38@huawei.com>
Reviewed-by: Alexander Duyck <alexanderduyck@fb.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b775f37d943966f6f77dca402f5a9dedce502c25)

| -rw-r--r-- | [drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/e100.c?id=b775f37d943966f6f77dca402f5a9dedce502c25) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/net/ethernet/intel/e100.c b/drivers/net/ethernet/intel/e100.cindex 7ccf890ee73592..001850d578e8f9 100644--- a/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=086f656e447b082c055cab9b059a71cd409e5c60)+++ b/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=b775f37d943966f6f77dca402f5a9dedce502c25)@@ -1742,11 +1742,8 @@ static int e100\_xmit\_prepare(struct nic \*nic, struct cb \*cb, dma\_addr = dma\_map\_single(&nic->pdev->dev, skb->data, skb->len, DMA\_TO\_DEVICE); /\* If we can't map the skb, have the upper layer try later \*/- if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) {- dev\_kfree\_skb\_any(skb);- skb = NULL;+ if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) return -ENOMEM;- }  /\* \* Use the last 4 bytes of the SKB payload packet as the CRC, used for |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:41:28 +0000



=== Content from git.kernel.org_b0dabb2c_20250111_144249.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Wang Hai <wanghai38@huawei.com> | 2022-11-16 01:24:07 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-08 11:28:39 +0100 |
| commit | [9fc27d22cdb9b1fcd754599d216a8992fed280cd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)) | |
| tree | [18a857f684d827bace63520ebb45d254f2868f6b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd) | |
| parent | [0d9f5bd54b913018031c5b964fc1f9a31f5f6cb5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d9f5bd54b913018031c5b964fc1f9a31f5f6cb5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd&id2=0d9f5bd54b913018031c5b964fc1f9a31f5f6cb5)) | |
| download | [linux-9fc27d22cdb9b1fcd754599d216a8992fed280cd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9fc27d22cdb9b1fcd754599d216a8992fed280cd.tar.gz) | |

e100: Fix possible use after free in e100\_xmit\_prepare[ Upstream commit 45605c75c52c7ae7bfe902214343aabcfe5ba0ff ]
In e100\_xmit\_prepare(), if we can't map the skb, then return -ENOMEM, so
e100\_xmit\_frame() will return NETDEV\_TX\_BUSY and the upper layer will
resend the skb. But the skb is already freed, which will cause UAF bug
when the upper layer resends the skb.
Remove the harmful free.
Fixes: 5e5d49422dfb ("e100: Release skb when DMA mapping is failed in e100\_xmit\_prepare")
Signed-off-by: Wang Hai <wanghai38@huawei.com>
Reviewed-by: Alexander Duyck <alexanderduyck@fb.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)

| -rw-r--r-- | [drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/e100.c?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/net/ethernet/intel/e100.c b/drivers/net/ethernet/intel/e100.cindex 36d52246bdc668..8cd371437c99fe 100644--- a/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=0d9f5bd54b913018031c5b964fc1f9a31f5f6cb5)+++ b/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=9fc27d22cdb9b1fcd754599d216a8992fed280cd)@@ -1742,11 +1742,8 @@ static int e100\_xmit\_prepare(struct nic \*nic, struct cb \*cb, dma\_addr = dma\_map\_single(&nic->pdev->dev, skb->data, skb->len, DMA\_TO\_DEVICE); /\* If we can't map the skb, have the upper layer try later \*/- if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) {- dev\_kfree\_skb\_any(skb);- skb = NULL;+ if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) return -ENOMEM;- }  /\* \* Use the last 4 bytes of the SKB payload packet as the CRC, used for |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:41:27 +0000



=== Content from git.kernel.org_03cb7197_20250111_144249.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Wang Hai <wanghai38@huawei.com> | 2022-11-16 01:24:07 +0800 |
| --- | --- | --- |
| committer | Tony Nguyen <anthony.l.nguyen@intel.com> | 2022-11-23 08:38:22 -0800 |
| commit | [45605c75c52c7ae7bfe902214343aabcfe5ba0ff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)) | |
| tree | [ed0db8f957502ac4256ffd5b119d5788c79f4d90](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff) | |
| parent | [227d8d2f7f2278b8468c5531b0cd0f2a905b4486](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=227d8d2f7f2278b8468c5531b0cd0f2a905b4486) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff&id2=227d8d2f7f2278b8468c5531b0cd0f2a905b4486)) | |
| download | [linux-45605c75c52c7ae7bfe902214343aabcfe5ba0ff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-45605c75c52c7ae7bfe902214343aabcfe5ba0ff.tar.gz) | |

e100: Fix possible use after free in e100\_xmit\_prepareIn e100\_xmit\_prepare(), if we can't map the skb, then return -ENOMEM, so
e100\_xmit\_frame() will return NETDEV\_TX\_BUSY and the upper layer will
resend the skb. But the skb is already freed, which will cause UAF bug
when the upper layer resends the skb.
Remove the harmful free.
Fixes: 5e5d49422dfb ("e100: Release skb when DMA mapping is failed in e100\_xmit\_prepare")
Signed-off-by: Wang Hai <wanghai38@huawei.com>
Reviewed-by: Alexander Duyck <alexanderduyck@fb.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)

| -rw-r--r-- | [drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/e100.c?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/net/ethernet/intel/e100.c b/drivers/net/ethernet/intel/e100.cindex 560d1d44223266..d3fdc290937fe8 100644--- a/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=227d8d2f7f2278b8468c5531b0cd0f2a905b4486)+++ b/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=45605c75c52c7ae7bfe902214343aabcfe5ba0ff)@@ -1741,11 +1741,8 @@ static int e100\_xmit\_prepare(struct nic \*nic, struct cb \*cb, dma\_addr = dma\_map\_single(&nic->pdev->dev, skb->data, skb->len, DMA\_TO\_DEVICE); /\* If we can't map the skb, have the upper layer try later \*/- if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) {- dev\_kfree\_skb\_any(skb);- skb = NULL;+ if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) return -ENOMEM;- }  /\* \* Use the last 4 bytes of the SKB payload packet as the CRC, used for |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:41:26 +0000



=== Content from git.kernel.org_fb967f68_20250111_144250.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b46f6144ab89d3d757ead940759c505091626a7d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b46f6144ab89d3d757ead940759c505091626a7d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b46f6144ab89d3d757ead940759c505091626a7d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b46f6144ab89d3d757ead940759c505091626a7d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Wang Hai <wanghai38@huawei.com> | 2022-11-16 01:24:07 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-08 11:30:15 +0100 |
| commit | [b46f6144ab89d3d757ead940759c505091626a7d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b46f6144ab89d3d757ead940759c505091626a7d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b46f6144ab89d3d757ead940759c505091626a7d)) | |
| tree | [304a087c4ab7d44083e652d83a14ee2f7ae1168b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b46f6144ab89d3d757ead940759c505091626a7d) | |
| parent | [bd477b891a4fa084561234eed4afacb3001dd359](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd477b891a4fa084561234eed4afacb3001dd359) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b46f6144ab89d3d757ead940759c505091626a7d&id2=bd477b891a4fa084561234eed4afacb3001dd359)) | |
| download | [linux-b46f6144ab89d3d757ead940759c505091626a7d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b46f6144ab89d3d757ead940759c505091626a7d.tar.gz) | |

e100: Fix possible use after free in e100\_xmit\_prepare[ Upstream commit 45605c75c52c7ae7bfe902214343aabcfe5ba0ff ]
In e100\_xmit\_prepare(), if we can't map the skb, then return -ENOMEM, so
e100\_xmit\_frame() will return NETDEV\_TX\_BUSY and the upper layer will
resend the skb. But the skb is already freed, which will cause UAF bug
when the upper layer resends the skb.
Remove the harmful free.
Fixes: 5e5d49422dfb ("e100: Release skb when DMA mapping is failed in e100\_xmit\_prepare")
Signed-off-by: Wang Hai <wanghai38@huawei.com>
Reviewed-by: Alexander Duyck <alexanderduyck@fb.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b46f6144ab89d3d757ead940759c505091626a7d)

| -rw-r--r-- | [drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/e100.c?id=b46f6144ab89d3d757ead940759c505091626a7d) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 4 deletions

| diff --git a/drivers/net/ethernet/intel/e100.c b/drivers/net/ethernet/intel/e100.cindex 11a884aa5082c1..90a2ba20e902b5 100644--- a/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=bd477b891a4fa084561234eed4afacb3001dd359)+++ b/[drivers/net/ethernet/intel/e100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/e100.c?id=b46f6144ab89d3d757ead940759c505091626a7d)@@ -1741,11 +1741,8 @@ static int e100\_xmit\_prepare(struct nic \*nic, struct cb \*cb, dma\_addr = dma\_map\_single(&nic->pdev->dev, skb->data, skb->len, DMA\_TO\_DEVICE); /\* If we can't map the skb, have the upper layer try later \*/- if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) {- dev\_kfree\_skb\_any(skb);- skb = NULL;+ if (dma\_mapping\_error(&nic->pdev->dev, dma\_addr)) return -ENOMEM;- }  /\* \* Use the last 4 bytes of the SKB payload packet as the CRC, used for |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:41:27 +0000


