<!DOCTYPE html>
<html lang='en'>
<head>
<title>bpf: Replace RET_XXX_OR_NULL with RET_XXX | PTR_MAYBE_NULL - kernel/git/torvalds/linux.git - Linux kernel source tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/torvalds/linux.git' title='kernel/git/torvalds/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/torvalds/linux.git/'>kernel/git/torvalds/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='3c4807322660d4290ac9062c034aed6b87243861'/><select name='h' onchange='this.form.submit();'>
<option value='for-next'>for-next</option>
<option value='master' selected='selected'>master</option>
<option value='vsnprintf'>vsnprintf</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel source tree</td><td class='sub right'>Linus Torvalds</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=3c4807322660d4290ac9062c034aed6b87243861'>refs</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3c4807322660d4290ac9062c034aed6b87243861'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c4807322660d4290ac9062c034aed6b87243861'>commit</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861'>diff</a><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/torvalds/linux.git/log/'>
<input type='hidden' name='id' value='3c4807322660d4290ac9062c034aed6b87243861'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='3c4807322660d4290ac9062c034aed6b87243861'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Hao Luo &lt;haoluo@google.com&gt;</td><td class='right'>2021-12-16 16:31:46 -0800</td></tr>
<tr><th>committer</th><td>Alexei Starovoitov &lt;ast@kernel.org&gt;</td><td class='right'>2021-12-18 12:48:08 -0800</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c4807322660d4290ac9062c034aed6b87243861'>3c4807322660d4290ac9062c034aed6b87243861</a> (<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=3c4807322660d4290ac9062c034aed6b87243861'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3c4807322660d4290ac9062c034aed6b87243861'>34dcf24073dcc2f9ff89e7459cc960412a26d97b</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=48946bd6a5d695c50b34546864b79c1f910a33c1'>48946bd6a5d695c50b34546864b79c1f910a33c1</a> (<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861&amp;id2=48946bd6a5d695c50b34546864b79c1f910a33c1'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-3c4807322660d4290ac9062c034aed6b87243861.tar.gz'>linux-3c4807322660d4290ac9062c034aed6b87243861.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>bpf: Replace RET_XXX_OR_NULL with RET_XXX | PTR_MAYBE_NULL</div><div class='commit-msg'>We have introduced a new type to make bpf_ret composable, by
reserving high bits to represent flags.

One of the flag is PTR_MAYBE_NULL, which indicates a pointer
may be NULL. When applying this flag to ret_types, it means
the returned value could be a NULL pointer. This patch
switches the qualified arg_types to use this flag.
The ret_types changed in this patch include:

1. RET_PTR_TO_MAP_VALUE_OR_NULL
2. RET_PTR_TO_SOCKET_OR_NULL
3. RET_PTR_TO_TCP_SOCK_OR_NULL
4. RET_PTR_TO_SOCK_COMMON_OR_NULL
5. RET_PTR_TO_ALLOC_MEM_OR_NULL
6. RET_PTR_TO_MEM_OR_BTF_ID_OR_NULL
7. RET_PTR_TO_BTF_ID_OR_NULL

This patch doesn't eliminate the use of these names, instead
it makes them aliases to 'RET_PTR_TO_XXX | PTR_MAYBE_NULL'.

Signed-off-by: Hao Luo &lt;haoluo@google.com&gt;
Signed-off-by: Alexei Starovoitov &lt;ast@kernel.org&gt;
Link: <a href="https://lore.kernel.org/bpf/20211217003152.48334-4-haoluo@google.com">https://lore.kernel.org/bpf/20211217003152.48334-4-haoluo@google.com</a>
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=3c4807322660d4290ac9062c034aed6b87243861'>include/linux/bpf.h</a></td><td class='right'>19</td><td class='graph'><table summary='file diffstat' width='52%'><tr><td class='add' style='width: 23.1%;'/><td class='rem' style='width: 13.5%;'/><td class='none' style='width: 63.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/helpers.c?id=3c4807322660d4290ac9062c034aed6b87243861'>kernel/bpf/helpers.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='52%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=3c4807322660d4290ac9062c034aed6b87243861'>kernel/bpf/verifier.c</a></td><td class='right'>52</td><td class='graph'><table summary='file diffstat' width='52%'><tr><td class='add' style='width: 50.0%;'/><td class='rem' style='width: 50.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>3 files changed, 39 insertions, 34 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/linux/bpf.h b/include/linux/bpf.h<br/>index 765bd7cc427251..975a1d5951bde1 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=48946bd6a5d695c50b34546864b79c1f910a33c1'>include/linux/bpf.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=3c4807322660d4290ac9062c034aed6b87243861'>include/linux/bpf.h</a></div><div class='hunk'>@@ -382,17 +382,22 @@ enum bpf_return_type {</div><div class='ctx'> 	RET_INTEGER,			/* function returns integer */</div><div class='ctx'> 	RET_VOID,			/* function doesn't return anything */</div><div class='ctx'> 	RET_PTR_TO_MAP_VALUE,		/* returns a pointer to map elem value */</div><div class='del'>-	RET_PTR_TO_MAP_VALUE_OR_NULL,	/* returns a pointer to map elem value or NULL */</div><div class='del'>-	RET_PTR_TO_SOCKET_OR_NULL,	/* returns a pointer to a socket or NULL */</div><div class='del'>-	RET_PTR_TO_TCP_SOCK_OR_NULL,	/* returns a pointer to a tcp_sock or NULL */</div><div class='del'>-	RET_PTR_TO_SOCK_COMMON_OR_NULL,	/* returns a pointer to a sock_common or NULL */</div><div class='del'>-	RET_PTR_TO_ALLOC_MEM_OR_NULL,	/* returns a pointer to dynamically allocated memory or NULL */</div><div class='del'>-	RET_PTR_TO_BTF_ID_OR_NULL,	/* returns a pointer to a btf_id or NULL */</div><div class='del'>-	RET_PTR_TO_MEM_OR_BTF_ID_OR_NULL, /* returns a pointer to a valid memory or a btf_id or NULL */</div><div class='add'>+	RET_PTR_TO_SOCKET,		/* returns a pointer to a socket */</div><div class='add'>+	RET_PTR_TO_TCP_SOCK,		/* returns a pointer to a tcp_sock */</div><div class='add'>+	RET_PTR_TO_SOCK_COMMON,		/* returns a pointer to a sock_common */</div><div class='add'>+	RET_PTR_TO_ALLOC_MEM,		/* returns a pointer to dynamically allocated memory */</div><div class='ctx'> 	RET_PTR_TO_MEM_OR_BTF_ID,	/* returns a pointer to a valid memory or a btf_id */</div><div class='ctx'> 	RET_PTR_TO_BTF_ID,		/* returns a pointer to a btf_id */</div><div class='ctx'> 	__BPF_RET_TYPE_MAX,</div><div class='ctx'> </div><div class='add'>+	/* Extended ret_types. */</div><div class='add'>+	RET_PTR_TO_MAP_VALUE_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_MAP_VALUE,</div><div class='add'>+	RET_PTR_TO_SOCKET_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_SOCKET,</div><div class='add'>+	RET_PTR_TO_TCP_SOCK_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_TCP_SOCK,</div><div class='add'>+	RET_PTR_TO_SOCK_COMMON_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_SOCK_COMMON,</div><div class='add'>+	RET_PTR_TO_ALLOC_MEM_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_ALLOC_MEM,</div><div class='add'>+	RET_PTR_TO_BTF_ID_OR_NULL	= PTR_MAYBE_NULL | RET_PTR_TO_BTF_ID,</div><div class='add'>+</div><div class='ctx'> 	/* This must be the last entry. Its purpose is to ensure the enum is</div><div class='ctx'> 	 * wide enough to hold the higher bits reserved for bpf_type_flag.</div><div class='ctx'> 	 */</div><div class='head'>diff --git a/kernel/bpf/helpers.c b/kernel/bpf/helpers.c<br/>index 34d6f91dec1c86..c49dc5cbe0a7b2 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1'>kernel/bpf/helpers.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=3c4807322660d4290ac9062c034aed6b87243861'>kernel/bpf/helpers.c</a></div><div class='hunk'>@@ -682,7 +682,7 @@ BPF_CALL_2(bpf_per_cpu_ptr, const void *, ptr, u32, cpu)</div><div class='ctx'> const struct bpf_func_proto bpf_per_cpu_ptr_proto = {</div><div class='ctx'> 	.func		= bpf_per_cpu_ptr,</div><div class='ctx'> 	.gpl_only	= false,</div><div class='del'>-	.ret_type	= RET_PTR_TO_MEM_OR_BTF_ID_OR_NULL,</div><div class='add'>+	.ret_type	= RET_PTR_TO_MEM_OR_BTF_ID | PTR_MAYBE_NULL,</div><div class='ctx'> 	.arg1_type	= ARG_PTR_TO_PERCPU_BTF_ID,</div><div class='ctx'> 	.arg2_type	= ARG_ANYTHING,</div><div class='ctx'> };</div><div class='head'>diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.c<br/>index 6095a75c111851..ccc068c5c5f24a 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1'>kernel/bpf/verifier.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=3c4807322660d4290ac9062c034aed6b87243861'>kernel/bpf/verifier.c</a></div><div class='hunk'>@@ -6473,6 +6473,7 @@ static int check_helper_call(struct bpf_verifier_env *env, struct bpf_insn *insn</div><div class='ctx'> 			     int *insn_idx_p)</div><div class='ctx'> {</div><div class='ctx'> 	const struct bpf_func_proto *fn = NULL;</div><div class='add'>+	enum bpf_return_type ret_type;</div><div class='ctx'> 	struct bpf_reg_state *regs;</div><div class='ctx'> 	struct bpf_call_arg_meta meta;</div><div class='ctx'> 	int insn_idx = *insn_idx_p;</div><div class='hunk'>@@ -6612,13 +6613,13 @@ static int check_helper_call(struct bpf_verifier_env *env, struct bpf_insn *insn</div><div class='ctx'> 	regs[BPF_REG_0].subreg_def = DEF_NOT_SUBREG;</div><div class='ctx'> </div><div class='ctx'> 	/* update return register (already marked as written above) */</div><div class='del'>-	if (fn-&gt;ret_type == RET_INTEGER) {</div><div class='add'>+	ret_type = fn-&gt;ret_type;</div><div class='add'>+	if (ret_type == RET_INTEGER) {</div><div class='ctx'> 		/* sets type to SCALAR_VALUE */</div><div class='ctx'> 		mark_reg_unknown(env, regs, BPF_REG_0);</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_VOID) {</div><div class='add'>+	} else if (ret_type == RET_VOID) {</div><div class='ctx'> 		regs[BPF_REG_0].type = NOT_INIT;</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_MAP_VALUE_OR_NULL ||</div><div class='del'>-		   fn-&gt;ret_type == RET_PTR_TO_MAP_VALUE) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_MAP_VALUE) {</div><div class='ctx'> 		/* There is no offset yet applied, variable or fixed */</div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='ctx'> 		/* remember map_ptr, so that check_map_access()</div><div class='hunk'>@@ -6632,28 +6633,27 @@ static int check_helper_call(struct bpf_verifier_env *env, struct bpf_insn *insn</div><div class='ctx'> 		}</div><div class='ctx'> 		regs[BPF_REG_0].map_ptr = meta.map_ptr;</div><div class='ctx'> 		regs[BPF_REG_0].map_uid = meta.map_uid;</div><div class='del'>-		if (fn-&gt;ret_type == RET_PTR_TO_MAP_VALUE) {</div><div class='add'>+		if (type_may_be_null(ret_type)) {</div><div class='add'>+			regs[BPF_REG_0].type = PTR_TO_MAP_VALUE_OR_NULL;</div><div class='add'>+		} else {</div><div class='ctx'> 			regs[BPF_REG_0].type = PTR_TO_MAP_VALUE;</div><div class='ctx'> 			if (map_value_has_spin_lock(meta.map_ptr))</div><div class='ctx'> 				regs[BPF_REG_0].id = ++env-&gt;id_gen;</div><div class='del'>-		} else {</div><div class='del'>-			regs[BPF_REG_0].type = PTR_TO_MAP_VALUE_OR_NULL;</div><div class='ctx'> 		}</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_SOCKET_OR_NULL) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_SOCKET) {</div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='ctx'> 		regs[BPF_REG_0].type = PTR_TO_SOCKET_OR_NULL;</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_SOCK_COMMON_OR_NULL) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_SOCK_COMMON) {</div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='ctx'> 		regs[BPF_REG_0].type = PTR_TO_SOCK_COMMON_OR_NULL;</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_TCP_SOCK_OR_NULL) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_TCP_SOCK) {</div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='ctx'> 		regs[BPF_REG_0].type = PTR_TO_TCP_SOCK_OR_NULL;</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_ALLOC_MEM_OR_NULL) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_ALLOC_MEM) {</div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='ctx'> 		regs[BPF_REG_0].type = PTR_TO_MEM_OR_NULL;</div><div class='ctx'> 		regs[BPF_REG_0].mem_size = meta.mem_size;</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_MEM_OR_BTF_ID_OR_NULL ||</div><div class='del'>-		   fn-&gt;ret_type == RET_PTR_TO_MEM_OR_BTF_ID) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_MEM_OR_BTF_ID) {</div><div class='ctx'> 		const struct btf_type *t;</div><div class='ctx'> </div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='hunk'>@@ -6672,28 +6672,28 @@ static int check_helper_call(struct bpf_verifier_env *env, struct bpf_insn *insn</div><div class='ctx'> 				return -EINVAL;</div><div class='ctx'> 			}</div><div class='ctx'> 			regs[BPF_REG_0].type =</div><div class='del'>-				fn-&gt;ret_type == RET_PTR_TO_MEM_OR_BTF_ID ?</div><div class='del'>-				PTR_TO_MEM : PTR_TO_MEM_OR_NULL;</div><div class='add'>+				(ret_type &amp; PTR_MAYBE_NULL) ?</div><div class='add'>+				PTR_TO_MEM_OR_NULL : PTR_TO_MEM;</div><div class='ctx'> 			regs[BPF_REG_0].mem_size = tsize;</div><div class='ctx'> 		} else {</div><div class='ctx'> 			regs[BPF_REG_0].type =</div><div class='del'>-				fn-&gt;ret_type == RET_PTR_TO_MEM_OR_BTF_ID ?</div><div class='del'>-				PTR_TO_BTF_ID : PTR_TO_BTF_ID_OR_NULL;</div><div class='add'>+				(ret_type &amp; PTR_MAYBE_NULL) ?</div><div class='add'>+				PTR_TO_BTF_ID_OR_NULL : PTR_TO_BTF_ID;</div><div class='ctx'> 			regs[BPF_REG_0].btf = meta.ret_btf;</div><div class='ctx'> 			regs[BPF_REG_0].btf_id = meta.ret_btf_id;</div><div class='ctx'> 		}</div><div class='del'>-	} else if (fn-&gt;ret_type == RET_PTR_TO_BTF_ID_OR_NULL ||</div><div class='del'>-		   fn-&gt;ret_type == RET_PTR_TO_BTF_ID) {</div><div class='add'>+	} else if (base_type(ret_type) == RET_PTR_TO_BTF_ID) {</div><div class='ctx'> 		int ret_btf_id;</div><div class='ctx'> </div><div class='ctx'> 		mark_reg_known_zero(env, regs, BPF_REG_0);</div><div class='del'>-		regs[BPF_REG_0].type = fn-&gt;ret_type == RET_PTR_TO_BTF_ID ?</div><div class='del'>-						     PTR_TO_BTF_ID :</div><div class='del'>-						     PTR_TO_BTF_ID_OR_NULL;</div><div class='add'>+		regs[BPF_REG_0].type = (ret_type &amp; PTR_MAYBE_NULL) ?</div><div class='add'>+						     PTR_TO_BTF_ID_OR_NULL :</div><div class='add'>+						     PTR_TO_BTF_ID;</div><div class='ctx'> 		ret_btf_id = *fn-&gt;ret_btf_id;</div><div class='ctx'> 		if (ret_btf_id == 0) {</div><div class='del'>-			verbose(env, "invalid return type %d of func %s#%d\n",</div><div class='del'>-				fn-&gt;ret_type, func_id_name(func_id), func_id);</div><div class='add'>+			verbose(env, "invalid return type %u of func %s#%d\n",</div><div class='add'>+				base_type(ret_type), func_id_name(func_id),</div><div class='add'>+				func_id);</div><div class='ctx'> 			return -EINVAL;</div><div class='ctx'> 		}</div><div class='ctx'> 		/* current BPF helper definitions are only coming from</div><div class='hunk'>@@ -6702,8 +6702,8 @@ static int check_helper_call(struct bpf_verifier_env *env, struct bpf_insn *insn</div><div class='ctx'> 		regs[BPF_REG_0].btf = btf_vmlinux;</div><div class='ctx'> 		regs[BPF_REG_0].btf_id = ret_btf_id;</div><div class='ctx'> 	} else {</div><div class='del'>-		verbose(env, "unknown return type %d of func %s#%d\n",</div><div class='del'>-			fn-&gt;ret_type, func_id_name(func_id), func_id);</div><div class='add'>+		verbose(env, "unknown return type %u of func %s#%d\n",</div><div class='add'>+			base_type(ret_type), func_id_name(func_id), func_id);</div><div class='ctx'> 		return -EINVAL;</div><div class='ctx'> 	}</div><div class='ctx'> </div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-05 16:27:56 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
