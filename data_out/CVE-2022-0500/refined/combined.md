=== Content from git.kernel.org_fe00ac41_20250108_114913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:45 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 12:47:24 -0800 |
| commit | [48946bd6a5d695c50b34546864b79c1f910a33c1](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=48946bd6a5d695c50b34546864b79c1f910a33c1) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)) | |
| tree | [d3862adb9cf035077ed58618c807cd930e2d70d8](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=48946bd6a5d695c50b34546864b79c1f910a33c1) | |
| parent | [d639b9d13a39cf15639cbe6e8b2c43eb60148a73](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d639b9d13a39cf15639cbe6e8b2c43eb60148a73) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=48946bd6a5d695c50b34546864b79c1f910a33c1&id2=d639b9d13a39cf15639cbe6e8b2c43eb60148a73)) | |
| download | [linux-48946bd6a5d695c50b34546864b79c1f910a33c1.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-48946bd6a5d695c50b34546864b79c1f910a33c1.tar.gz) | |

bpf: Replace ARG\_XXX\_OR\_NULL with ARG\_XXX | PTR\_MAYBE\_NULLWe have introduced a new type to make bpf\_arg composable, by
reserving high bits of bpf\_arg to represent flags of a type.
One of the flags is PTR\_MAYBE\_NULL which indicates a pointer
may be NULL. When applying this flag to an arg\_type, it means
the arg can take NULL pointer. This patch switches the
qualified arg\_types to use this flag. The arg\_types changed
in this patch include:
1. ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL
2. ARG\_PTR\_TO\_MEM\_OR\_NULL
3. ARG\_PTR\_TO\_CTX\_OR\_NULL
4. ARG\_PTR\_TO\_SOCKET\_OR\_NULL
5. ARG\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL
6. ARG\_PTR\_TO\_STACK\_OR\_NULL
This patch does not eliminate the use of these arg\_types, instead
it makes them an alias to the 'ARG\_XXX | PTR\_MAYBE\_NULL'.
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-3-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-3-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=48946bd6a5d695c50b34546864b79c1f910a33c1)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=48946bd6a5d695c50b34546864b79c1f910a33c1) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1) | 39 | |  |  |  | | --- | --- | --- | |

2 files changed, 23 insertions, 31 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex 41bb3687cc8524..765bd7cc427251 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=d639b9d13a39cf15639cbe6e8b2c43eb60148a73)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=48946bd6a5d695c50b34546864b79c1f910a33c1)@@ -331,13 +331,11 @@ enum bpf\_arg\_type { ARG\_PTR\_TO\_MAP\_KEY, /\* pointer to stack used as map key \*/ ARG\_PTR\_TO\_MAP\_VALUE, /\* pointer to stack used as map value \*/ ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE, /\* pointer to valid memory used to store a map value \*/- ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL, /\* pointer to stack used as map value or NULL \*/  /\* the following constraints used to prototype bpf\_memcmp() and other \* functions that access data on eBPF program stack \*/ ARG\_PTR\_TO\_MEM, /\* pointer to valid memory (stack, packet, map value) \*/- ARG\_PTR\_TO\_MEM\_OR\_NULL, /\* pointer to valid memory or NULL \*/ ARG\_PTR\_TO\_UNINIT\_MEM, /\* pointer to memory does not need to be initialized, \* helper function must fill all bytes or clear \* them in error case.@@ -347,26 +345,31 @@ enum bpf\_arg\_type { ARG\_CONST\_SIZE\_OR\_ZERO, /\* number of bytes accessed from memory or 0 \*/  ARG\_PTR\_TO\_CTX, /\* pointer to context \*/- ARG\_PTR\_TO\_CTX\_OR\_NULL, /\* pointer to context or NULL \*/ ARG\_ANYTHING, /\* any (initialized) argument is ok \*/ ARG\_PTR\_TO\_SPIN\_LOCK, /\* pointer to bpf\_spin\_lock \*/ ARG\_PTR\_TO\_SOCK\_COMMON, /\* pointer to sock\_common \*/ ARG\_PTR\_TO\_INT, /\* pointer to int \*/ ARG\_PTR\_TO\_LONG, /\* pointer to long \*/ ARG\_PTR\_TO\_SOCKET, /\* pointer to bpf\_sock (fullsock) \*/- ARG\_PTR\_TO\_SOCKET\_OR\_NULL, /\* pointer to bpf\_sock (fullsock) or NULL \*/ ARG\_PTR\_TO\_BTF\_ID, /\* pointer to in-kernel struct \*/ ARG\_PTR\_TO\_ALLOC\_MEM, /\* pointer to dynamically allocated memory \*/- ARG\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL, /\* pointer to dynamically allocated memory or NULL \*/ ARG\_CONST\_ALLOC\_SIZE\_OR\_ZERO, /\* number of allocated bytes requested \*/ ARG\_PTR\_TO\_BTF\_ID\_SOCK\_COMMON, /\* pointer to in-kernel sock\_common or bpf-mirrored bpf\_sock \*/ ARG\_PTR\_TO\_PERCPU\_BTF\_ID, /\* pointer to in-kernel percpu type \*/ ARG\_PTR\_TO\_FUNC, /\* pointer to a bpf program function \*/- ARG\_PTR\_TO\_STACK\_OR\_NULL, /\* pointer to stack or NULL \*/+ ARG\_PTR\_TO\_STACK, /\* pointer to stack \*/ ARG\_PTR\_TO\_CONST\_STR, /\* pointer to a null terminated read-only string \*/ ARG\_PTR\_TO\_TIMER, /\* pointer to bpf\_timer \*/ \_\_BPF\_ARG\_TYPE\_MAX, + /\* Extended arg\_types. \*/+ ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_MAP\_VALUE,+ ARG\_PTR\_TO\_MEM\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_MEM,+ ARG\_PTR\_TO\_CTX\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_CTX,+ ARG\_PTR\_TO\_SOCKET\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_SOCKET,+ ARG\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_ALLOC\_MEM,+ ARG\_PTR\_TO\_STACK\_OR\_NULL = PTR\_MAYBE\_NULL | ARG\_PTR\_TO\_STACK,+ /\* This must be the last entry. Its purpose is to ensure the enum is \* wide enough to hold the higher bits reserved for bpf\_type\_flag. \*/diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 07d7d6124a18b4..6095a75c111851 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=d639b9d13a39cf15639cbe6e8b2c43eb60148a73)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1)@@ -475,14 +475,9 @@ static bool arg\_type\_may\_be\_refcounted(enum bpf\_arg\_type type) return type == ARG\_PTR\_TO\_SOCK\_COMMON; } -static bool arg\_type\_may\_be\_null(enum bpf\_arg\_type type)+static bool type\_may\_be\_null(u32 type) {- return type == ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL ||- type == ARG\_PTR\_TO\_MEM\_OR\_NULL ||- type == ARG\_PTR\_TO\_CTX\_OR\_NULL ||- type == ARG\_PTR\_TO\_SOCKET\_OR\_NULL ||- type == ARG\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL ||- type == ARG\_PTR\_TO\_STACK\_OR\_NULL;+ return type & PTR\_MAYBE\_NULL; }  /\* Determine whether the function releases some resources allocated by another@@ -5016,9 +5011,8 @@ static int process\_timer\_func(struct bpf\_verifier\_env \*env, int regno,  static bool arg\_type\_is\_mem\_ptr(enum bpf\_arg\_type type) {- return type == ARG\_PTR\_TO\_MEM ||- type == ARG\_PTR\_TO\_MEM\_OR\_NULL ||- type == ARG\_PTR\_TO\_UNINIT\_MEM;+ return base\_type(type) == ARG\_PTR\_TO\_MEM ||+ base\_type(type) == ARG\_PTR\_TO\_UNINIT\_MEM; }  static bool arg\_type\_is\_mem\_size(enum bpf\_arg\_type type)@@ -5155,31 +5149,26 @@ static const struct bpf\_reg\_types \*compatible\_reg\_types[\_\_BPF\_ARG\_TYPE\_MAX] = { [ARG\_PTR\_TO\_MAP\_KEY] = &map\_key\_value\_types, [ARG\_PTR\_TO\_MAP\_VALUE] = &map\_key\_value\_types, [ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE] = &map\_key\_value\_types,- [ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL] = &map\_key\_value\_types, [ARG\_CONST\_SIZE] = &scalar\_types, [ARG\_CONST\_SIZE\_OR\_ZERO] = &scalar\_types, [ARG\_CONST\_ALLOC\_SIZE\_OR\_ZERO] = &scalar\_types, [ARG\_CONST\_MAP\_PTR] = &const\_map\_ptr\_types, [ARG\_PTR\_TO\_CTX] = &context\_types,- [ARG\_PTR\_TO\_CTX\_OR\_NULL] = &context\_types, [ARG\_PTR\_TO\_SOCK\_COMMON] = &sock\_types, #ifdef CONFIG\_NET [ARG\_PTR\_TO\_BTF\_ID\_SOCK\_COMMON] = &btf\_id\_sock\_common\_types, #endif [ARG\_PTR\_TO\_SOCKET] = &fullsock\_types,- [ARG\_PTR\_TO\_SOCKET\_OR\_NULL] = &fullsock\_types, [ARG\_PTR\_TO\_BTF\_ID] = &btf\_ptr\_types, [ARG\_PTR\_TO\_SPIN\_LOCK] = &spin\_lock\_types, [ARG\_PTR\_TO\_MEM] = &mem\_types,- [ARG\_PTR\_TO\_MEM\_OR\_NULL] = &mem\_types, [ARG\_PTR\_TO\_UNINIT\_MEM] = &mem\_types, [ARG\_PTR\_TO\_ALLOC\_MEM] = &alloc\_mem\_types,- [ARG\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL] = &alloc\_mem\_types, [ARG\_PTR\_TO\_INT] = &int\_ptr\_types, [ARG\_PTR\_TO\_LONG] = &int\_ptr\_types, [ARG\_PTR\_TO\_PERCPU\_BTF\_ID] = &percpu\_btf\_ptr\_types, [ARG\_PTR\_TO\_FUNC] = &func\_ptr\_types,- [ARG\_PTR\_TO\_STACK\_OR\_NULL] = &stack\_ptr\_types,+ [ARG\_PTR\_TO\_STACK] = &stack\_ptr\_types, [ARG\_PTR\_TO\_CONST\_STR] = &const\_str\_ptr\_types, [ARG\_PTR\_TO\_TIMER] = &timer\_types, };@@ -5193,7 +5182,7 @@ static int check\_reg\_type(struct bpf\_verifier\_env \*env, u32 regno, const struct bpf\_reg\_types \*compatible; int i, j; - compatible = compatible\_reg\_types[arg\_type];+ compatible = compatible\_reg\_types[base\_type(arg\_type)]; if (!compatible) { verbose(env, "verifier internal error: unsupported arg type %d\n", arg\_type); return -EFAULT;@@ -5274,15 +5263,14 @@ static int check\_func\_arg(struct bpf\_verifier\_env \*env, u32 arg, return -EACCES; } - if (arg\_type == ARG\_PTR\_TO\_MAP\_VALUE ||- arg\_type == ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE ||- arg\_type == ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL) {+ if (base\_type(arg\_type) == ARG\_PTR\_TO\_MAP\_VALUE ||+ base\_type(arg\_type) == ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE) { err = resolve\_map\_arg\_type(env, meta, &arg\_type); if (err) return err; } - if (register\_is\_null(reg) && arg\_type\_may\_be\_null(arg\_type))+ if (register\_is\_null(reg) && type\_may\_be\_null(arg\_type)) /\* A NULL register has a SCALAR\_VALUE type, so skip \* type checking. \*/@@ -5351,10 +5339,11 @@ skip\_type\_check: err = check\_helper\_mem\_access(env, regno, meta->map\_ptr->key\_size, false, NULL);- } else if (arg\_type == ARG\_PTR\_TO\_MAP\_VALUE ||- (arg\_type == ARG\_PTR\_TO\_MAP\_VALUE\_OR\_NULL &&- !register\_is\_null(reg)) ||- arg\_type == ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE) {+ } else if (base\_type(arg\_type) == ARG\_PTR\_TO\_MAP\_VALUE ||+ base\_type(arg\_type) == ARG\_PTR\_TO\_UNINIT\_MAP\_VALUE) {+ if (type\_may\_be\_null(arg\_type) && register\_is\_null(reg))+ return 0;+ /\* bpf\_map\_xxx(..., map\_ptr, ..., value) call: \* check [value, value + map->value\_size) validity \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:50 +0000



=== Content from git.kernel.org_ef2bc902_20250108_114913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=3c4807322660d4290ac9062c034aed6b87243861)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3c4807322660d4290ac9062c034aed6b87243861)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c4807322660d4290ac9062c034aed6b87243861)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:46 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 12:48:08 -0800 |
| commit | [3c4807322660d4290ac9062c034aed6b87243861](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c4807322660d4290ac9062c034aed6b87243861) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=3c4807322660d4290ac9062c034aed6b87243861)) | |
| tree | [34dcf24073dcc2f9ff89e7459cc960412a26d97b](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3c4807322660d4290ac9062c034aed6b87243861) | |
| parent | [48946bd6a5d695c50b34546864b79c1f910a33c1](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=48946bd6a5d695c50b34546864b79c1f910a33c1) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861&id2=48946bd6a5d695c50b34546864b79c1f910a33c1)) | |
| download | [linux-3c4807322660d4290ac9062c034aed6b87243861.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-3c4807322660d4290ac9062c034aed6b87243861.tar.gz) | |

bpf: Replace RET\_XXX\_OR\_NULL with RET\_XXX | PTR\_MAYBE\_NULLWe have introduced a new type to make bpf\_ret composable, by
reserving high bits to represent flags.
One of the flag is PTR\_MAYBE\_NULL, which indicates a pointer
may be NULL. When applying this flag to ret\_types, it means
the returned value could be a NULL pointer. This patch
switches the qualified arg\_types to use this flag.
The ret\_types changed in this patch include:
1. RET\_PTR\_TO\_MAP\_VALUE\_OR\_NULL
2. RET\_PTR\_TO\_SOCKET\_OR\_NULL
3. RET\_PTR\_TO\_TCP\_SOCK\_OR\_NULL
4. RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL
5. RET\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL
6. RET\_PTR\_TO\_MEM\_OR\_BTF\_ID\_OR\_NULL
7. RET\_PTR\_TO\_BTF\_ID\_OR\_NULL
This patch doesn't eliminate the use of these names, instead
it makes them aliases to 'RET\_PTR\_TO\_XXX | PTR\_MAYBE\_NULL'.
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-4-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-4-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3c4807322660d4290ac9062c034aed6b87243861)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=3c4807322660d4290ac9062c034aed6b87243861) | 19 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/helpers.c?id=3c4807322660d4290ac9062c034aed6b87243861) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=3c4807322660d4290ac9062c034aed6b87243861) | 52 | |  |  |  | | --- | --- | --- | |

3 files changed, 39 insertions, 34 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex 765bd7cc427251..975a1d5951bde1 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=48946bd6a5d695c50b34546864b79c1f910a33c1)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=3c4807322660d4290ac9062c034aed6b87243861)@@ -382,17 +382,22 @@ enum bpf\_return\_type { RET\_INTEGER, /\* function returns integer \*/ RET\_VOID, /\* function doesn't return anything \*/ RET\_PTR\_TO\_MAP\_VALUE, /\* returns a pointer to map elem value \*/- RET\_PTR\_TO\_MAP\_VALUE\_OR\_NULL, /\* returns a pointer to map elem value or NULL \*/- RET\_PTR\_TO\_SOCKET\_OR\_NULL, /\* returns a pointer to a socket or NULL \*/- RET\_PTR\_TO\_TCP\_SOCK\_OR\_NULL, /\* returns a pointer to a tcp\_sock or NULL \*/- RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL, /\* returns a pointer to a sock\_common or NULL \*/- RET\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL, /\* returns a pointer to dynamically allocated memory or NULL \*/- RET\_PTR\_TO\_BTF\_ID\_OR\_NULL, /\* returns a pointer to a btf\_id or NULL \*/- RET\_PTR\_TO\_MEM\_OR\_BTF\_ID\_OR\_NULL, /\* returns a pointer to a valid memory or a btf\_id or NULL \*/+ RET\_PTR\_TO\_SOCKET, /\* returns a pointer to a socket \*/+ RET\_PTR\_TO\_TCP\_SOCK, /\* returns a pointer to a tcp\_sock \*/+ RET\_PTR\_TO\_SOCK\_COMMON, /\* returns a pointer to a sock\_common \*/+ RET\_PTR\_TO\_ALLOC\_MEM, /\* returns a pointer to dynamically allocated memory \*/ RET\_PTR\_TO\_MEM\_OR\_BTF\_ID, /\* returns a pointer to a valid memory or a btf\_id \*/ RET\_PTR\_TO\_BTF\_ID, /\* returns a pointer to a btf\_id \*/ \_\_BPF\_RET\_TYPE\_MAX, + /\* Extended ret\_types. \*/+ RET\_PTR\_TO\_MAP\_VALUE\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_MAP\_VALUE,+ RET\_PTR\_TO\_SOCKET\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_SOCKET,+ RET\_PTR\_TO\_TCP\_SOCK\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_TCP\_SOCK,+ RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_SOCK\_COMMON,+ RET\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_ALLOC\_MEM,+ RET\_PTR\_TO\_BTF\_ID\_OR\_NULL = PTR\_MAYBE\_NULL | RET\_PTR\_TO\_BTF\_ID,+ /\* This must be the last entry. Its purpose is to ensure the enum is \* wide enough to hold the higher bits reserved for bpf\_type\_flag. \*/diff --git a/kernel/bpf/helpers.c b/kernel/bpf/helpers.cindex 34d6f91dec1c86..c49dc5cbe0a7b2 100644--- a/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1)+++ b/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=3c4807322660d4290ac9062c034aed6b87243861)@@ -682,7 +682,7 @@ BPF\_CALL\_2(bpf\_per\_cpu\_ptr, const void \*, ptr, u32, cpu) const struct bpf\_func\_proto bpf\_per\_cpu\_ptr\_proto = { .func = bpf\_per\_cpu\_ptr, .gpl\_only = false,- .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID\_OR\_NULL,+ .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID | PTR\_MAYBE\_NULL, .arg1\_type = ARG\_PTR\_TO\_PERCPU\_BTF\_ID, .arg2\_type = ARG\_ANYTHING, };diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 6095a75c111851..ccc068c5c5f24a 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=48946bd6a5d695c50b34546864b79c1f910a33c1)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=3c4807322660d4290ac9062c034aed6b87243861)@@ -6473,6 +6473,7 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn int \*insn\_idx\_p) { const struct bpf\_func\_proto \*fn = NULL;+ enum bpf\_return\_type ret\_type; struct bpf\_reg\_state \*regs; struct bpf\_call\_arg\_meta meta; int insn\_idx = \*insn\_idx\_p;@@ -6612,13 +6613,13 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn regs[BPF\_REG\_0].subreg\_def = DEF\_NOT\_SUBREG;  /\* update return register (already marked as written above) \*/- if (fn->ret\_type == RET\_INTEGER) {+ ret\_type = fn->ret\_type;+ if (ret\_type == RET\_INTEGER) { /\* sets type to SCALAR\_VALUE \*/ mark\_reg\_unknown(env, regs, BPF\_REG\_0);- } else if (fn->ret\_type == RET\_VOID) {+ } else if (ret\_type == RET\_VOID) { regs[BPF\_REG\_0].type = NOT\_INIT;- } else if (fn->ret\_type == RET\_PTR\_TO\_MAP\_VALUE\_OR\_NULL ||- fn->ret\_type == RET\_PTR\_TO\_MAP\_VALUE) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_MAP\_VALUE) { /\* There is no offset yet applied, variable or fixed \*/ mark\_reg\_known\_zero(env, regs, BPF\_REG\_0); /\* remember map\_ptr, so that check\_map\_access()@@ -6632,28 +6633,27 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn } regs[BPF\_REG\_0].map\_ptr = meta.map\_ptr; regs[BPF\_REG\_0].map\_uid = meta.map\_uid;- if (fn->ret\_type == RET\_PTR\_TO\_MAP\_VALUE) {+ if (type\_may\_be\_null(ret\_type)) {+ regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE\_OR\_NULL;+ } else { regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE; if (map\_value\_has\_spin\_lock(meta.map\_ptr)) regs[BPF\_REG\_0].id = ++env->id\_gen;- } else {- regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE\_OR\_NULL; }- } else if (fn->ret\_type == RET\_PTR\_TO\_SOCKET\_OR\_NULL) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_SOCKET) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0); regs[BPF\_REG\_0].type = PTR\_TO\_SOCKET\_OR\_NULL;- } else if (fn->ret\_type == RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_SOCK\_COMMON) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0); regs[BPF\_REG\_0].type = PTR\_TO\_SOCK\_COMMON\_OR\_NULL;- } else if (fn->ret\_type == RET\_PTR\_TO\_TCP\_SOCK\_OR\_NULL) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_TCP\_SOCK) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0); regs[BPF\_REG\_0].type = PTR\_TO\_TCP\_SOCK\_OR\_NULL;- } else if (fn->ret\_type == RET\_PTR\_TO\_ALLOC\_MEM\_OR\_NULL) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_ALLOC\_MEM) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0); regs[BPF\_REG\_0].type = PTR\_TO\_MEM\_OR\_NULL; regs[BPF\_REG\_0].mem\_size = meta.mem\_size;- } else if (fn->ret\_type == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID\_OR\_NULL ||- fn->ret\_type == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID) { const struct btf\_type \*t;  mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);@@ -6672,28 +6672,28 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn return -EINVAL; } regs[BPF\_REG\_0].type =- fn->ret\_type == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID ?- PTR\_TO\_MEM : PTR\_TO\_MEM\_OR\_NULL;+ (ret\_type & PTR\_MAYBE\_NULL) ?+ PTR\_TO\_MEM\_OR\_NULL : PTR\_TO\_MEM; regs[BPF\_REG\_0].mem\_size = tsize; } else { regs[BPF\_REG\_0].type =- fn->ret\_type == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID ?- PTR\_TO\_BTF\_ID : PTR\_TO\_BTF\_ID\_OR\_NULL;+ (ret\_type & PTR\_MAYBE\_NULL) ?+ PTR\_TO\_BTF\_ID\_OR\_NULL : PTR\_TO\_BTF\_ID; regs[BPF\_REG\_0].btf = meta.ret\_btf; regs[BPF\_REG\_0].btf\_id = meta.ret\_btf\_id; }- } else if (fn->ret\_type == RET\_PTR\_TO\_BTF\_ID\_OR\_NULL ||- fn->ret\_type == RET\_PTR\_TO\_BTF\_ID) {+ } else if (base\_type(ret\_type) == RET\_PTR\_TO\_BTF\_ID) { int ret\_btf\_id;  mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = fn->ret\_type == RET\_PTR\_TO\_BTF\_ID ?- PTR\_TO\_BTF\_ID :- PTR\_TO\_BTF\_ID\_OR\_NULL;+ regs[BPF\_REG\_0].type = (ret\_type & PTR\_MAYBE\_NULL) ?+ PTR\_TO\_BTF\_ID\_OR\_NULL :+ PTR\_TO\_BTF\_ID; ret\_btf\_id = \*fn->ret\_btf\_id; if (ret\_btf\_id == 0) {- verbose(env, "invalid return type %d of func %s#%d\n",- fn->ret\_type, func\_id\_name(func\_id), func\_id);+ verbose(env, "invalid return type %u of func %s#%d\n",+ base\_type(ret\_type), func\_id\_name(func\_id),+ func\_id); return -EINVAL; } /\* current BPF helper definitions are only coming from@@ -6702,8 +6702,8 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn regs[BPF\_REG\_0].btf = btf\_vmlinux; regs[BPF\_REG\_0].btf\_id = ret\_btf\_id; } else {- verbose(env, "unknown return type %d of func %s#%d\n",- fn->ret\_type, func\_id\_name(func\_id), func\_id);+ verbose(env, "unknown return type %u of func %s#%d\n",+ base\_type(ret\_type), func\_id\_name(func\_id), func\_id); return -EINVAL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 10:57:41 +0000



=== Content from git.kernel.org_48695a3b_20250108_114913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:51 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 13:27:41 -0800 |
| commit | [216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)) | |
| tree | [2f384f14c9f5cc1441c17ce395cefa9577b872ee](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | |
| parent | [34d3a78c681e8e7844b43d1a2f4671a04249c821](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20&id2=34d3a78c681e8e7844b43d1a2f4671a04249c821)) | |
| download | [linux-216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20.tar.gz) | |

bpf: Add MEM\_RDONLY for helper args that are pointers to rdonly mem.Some helper functions may modify its arguments, for example,
bpf\_d\_path, bpf\_get\_stack etc. Previously, their argument types
were marked as ARG\_PTR\_TO\_MEM, which is compatible with read-only
mem types, such as PTR\_TO\_RDONLY\_BUF. Therefore it's legitimate,
but technically incorrect, to modify a read-only memory by passing
it into one of such helper functions.
This patch tags the bpf\_args compatible with immutable memory with
MEM\_RDONLY flag. The arguments that don't have this flag will be
only compatible with mutable memory types, preventing the helper
from modifying a read-only memory. The bpf\_args that have
MEM\_RDONLY are compatible with both mutable memory and immutable
memory.
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-9-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-9-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/btf.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/cgroup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/cgroup.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/helpers.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/ringbuf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/ringbuf.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/syscall.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/syscall.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 20 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/trace/bpf\_trace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/trace/bpf_trace.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 26 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/core/filter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/core/filter.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20) | 64 | |  |  |  | | --- | --- | --- | |

9 files changed, 73 insertions, 57 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex 567d83bf28f90b..26753139d5b4d3 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -311,7 +311,9 @@ enum bpf\_type\_flag { /\* PTR may be NULL. \*/ PTR\_MAYBE\_NULL = BIT(0 + BPF\_BASE\_TYPE\_BITS), - /\* MEM is read-only. \*/+ /\* MEM is read-only. When applied on bpf\_arg, it indicates the arg is+ \* compatible with both mutable and immutable memory.+ \*/ MEM\_RDONLY = BIT(1 + BPF\_BASE\_TYPE\_BITS),  \_\_BPF\_TYPE\_LAST\_FLAG = MEM\_RDONLY,diff --git a/kernel/bpf/btf.c b/kernel/bpf/btf.cindex d948b5be3bb846..b3fddfb5bc8402 100644--- a/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -6353,7 +6353,7 @@ const struct bpf\_func\_proto bpf\_btf\_find\_by\_name\_kind\_proto = { .func = bpf\_btf\_find\_by\_name\_kind, .gpl\_only = false, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM,+ .arg1\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE, .arg3\_type = ARG\_ANYTHING, .arg4\_type = ARG\_ANYTHING,diff --git a/kernel/bpf/cgroup.c b/kernel/bpf/cgroup.cindex 43eb3501721b7b..514b4681a90ac0 100644--- a/[kernel/bpf/cgroup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/cgroup.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/cgroup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/cgroup.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -1789,7 +1789,7 @@ static const struct bpf\_func\_proto bpf\_sysctl\_set\_new\_value\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, }; diff --git a/kernel/bpf/helpers.c b/kernel/bpf/helpers.cindex 6a65e2a62b015b..01cfdf40c838c0 100644--- a/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -531,7 +531,7 @@ const struct bpf\_func\_proto bpf\_strtol\_proto = { .func = bpf\_strtol, .gpl\_only = false, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM,+ .arg1\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE, .arg3\_type = ARG\_ANYTHING, .arg4\_type = ARG\_PTR\_TO\_LONG,@@ -559,7 +559,7 @@ const struct bpf\_func\_proto bpf\_strtoul\_proto = { .func = bpf\_strtoul, .gpl\_only = false, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM,+ .arg1\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE, .arg3\_type = ARG\_ANYTHING, .arg4\_type = ARG\_PTR\_TO\_LONG,@@ -645,7 +645,7 @@ const struct bpf\_func\_proto bpf\_event\_output\_data\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -1026,7 +1026,7 @@ const struct bpf\_func\_proto bpf\_snprintf\_proto = { .arg1\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL, .arg2\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg3\_type = ARG\_PTR\_TO\_CONST\_STR,- .arg4\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg4\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; diff --git a/kernel/bpf/ringbuf.c b/kernel/bpf/ringbuf.cindex 9e0c10c6892ad9..638d7fd7b37545 100644--- a/[kernel/bpf/ringbuf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/ringbuf.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/ringbuf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/ringbuf.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -444,7 +444,7 @@ const struct bpf\_func\_proto bpf\_ringbuf\_output\_proto = { .func = bpf\_ringbuf\_output, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_CONST\_MAP\_PTR,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg4\_type = ARG\_ANYTHING, };diff --git a/kernel/bpf/syscall.c b/kernel/bpf/syscall.cindex da07bdf71697b8..fa4505f9b6119b 100644--- a/[kernel/bpf/syscall.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/syscall.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/syscall.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/syscall.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -4773,7 +4773,7 @@ static const struct bpf\_func\_proto bpf\_sys\_bpf\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_ANYTHING,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, }; diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex f49b3d334f4e5b..ca5cd0de804cd5 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -5113,7 +5113,6 @@ static const struct bpf\_reg\_types mem\_types = { PTR\_TO\_MAP\_VALUE, PTR\_TO\_MEM, PTR\_TO\_BUF,- PTR\_TO\_BUF | MEM\_RDONLY, }, }; @@ -5183,6 +5182,21 @@ static int check\_reg\_type(struct bpf\_verifier\_env \*env, u32 regno, return -EFAULT; } + /\* ARG\_PTR\_TO\_MEM + RDONLY is compatible with PTR\_TO\_MEM and PTR\_TO\_MEM + RDONLY,+ \* but ARG\_PTR\_TO\_MEM is compatible only with PTR\_TO\_MEM and NOT with PTR\_TO\_MEM + RDONLY+ \*+ \* Same for MAYBE\_NULL:+ \*+ \* ARG\_PTR\_TO\_MEM + MAYBE\_NULL is compatible with PTR\_TO\_MEM and PTR\_TO\_MEM + MAYBE\_NULL,+ \* but ARG\_PTR\_TO\_MEM is compatible only with PTR\_TO\_MEM but NOT with PTR\_TO\_MEM + MAYBE\_NULL+ \*+ \* Therefore we fold these flags depending on the arg\_type before comparison.+ \*/+ if (arg\_type & MEM\_RDONLY)+ type &= ~MEM\_RDONLY;+ if (arg\_type & PTR\_MAYBE\_NULL)+ type &= ~PTR\_MAYBE\_NULL;+ for (i = 0; i < ARRAY\_SIZE(compatible->types); i++) { expected = compatible->types[i]; if (expected == NOT\_INIT)@@ -5192,14 +5206,14 @@ static int check\_reg\_type(struct bpf\_verifier\_env \*env, u32 regno, goto found; } - verbose(env, "R%d type=%s expected=", regno, reg\_type\_str(env, type));+ verbose(env, "R%d type=%s expected=", regno, reg\_type\_str(env, reg->type)); for (j = 0; j + 1 < i; j++) verbose(env, "%s, ", reg\_type\_str(env, compatible->types[j])); verbose(env, "%s\n", reg\_type\_str(env, compatible->types[j])); return -EACCES;  found:- if (type == PTR\_TO\_BTF\_ID) {+ if (reg->type == PTR\_TO\_BTF\_ID) { if (!arg\_btf\_id) { if (!compatible->btf\_id) { verbose(env, "verifier internal error: missing arg compatible BTF ID\n");diff --git a/kernel/trace/bpf\_trace.c b/kernel/trace/bpf\_trace.cindex cea2ca6df949b6..21aa30644219e7 100644--- a/[kernel/trace/bpf\_trace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/trace/bpf_trace.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[kernel/trace/bpf\_trace.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/trace/bpf_trace.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -345,7 +345,7 @@ static const struct bpf\_func\_proto bpf\_probe\_write\_user\_proto = { .gpl\_only = true, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_ANYTHING,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, }; @@ -394,7 +394,7 @@ static const struct bpf\_func\_proto bpf\_trace\_printk\_proto = { .func = bpf\_trace\_printk, .gpl\_only = true, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM,+ .arg1\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE, }; @@ -450,9 +450,9 @@ static const struct bpf\_func\_proto bpf\_trace\_vprintk\_proto = { .func = bpf\_trace\_vprintk, .gpl\_only = true, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM,+ .arg1\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE,- .arg3\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg3\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -492,9 +492,9 @@ static const struct bpf\_func\_proto bpf\_seq\_printf\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_BTF\_ID, .arg1\_btf\_id = &btf\_seq\_file\_ids[0],- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE,- .arg4\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg4\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -509,7 +509,7 @@ static const struct bpf\_func\_proto bpf\_seq\_write\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_BTF\_ID, .arg1\_btf\_id = &btf\_seq\_file\_ids[0],- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -533,7 +533,7 @@ static const struct bpf\_func\_proto bpf\_seq\_printf\_btf\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_BTF\_ID, .arg1\_btf\_id = &btf\_seq\_file\_ids[0],- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg4\_type = ARG\_ANYTHING, };@@ -694,7 +694,7 @@ static const struct bpf\_func\_proto bpf\_perf\_event\_output\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -1004,7 +1004,7 @@ const struct bpf\_func\_proto bpf\_snprintf\_btf\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_MEM, .arg2\_type = ARG\_CONST\_SIZE,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE, .arg5\_type = ARG\_ANYTHING, };@@ -1334,7 +1334,7 @@ static const struct bpf\_func\_proto bpf\_perf\_event\_output\_proto\_tp = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -1556,7 +1556,7 @@ static const struct bpf\_func\_proto bpf\_perf\_event\_output\_proto\_raw\_tp = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -1610,7 +1610,7 @@ static const struct bpf\_func\_proto bpf\_get\_stack\_proto\_raw\_tp = { .gpl\_only = true, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg4\_type = ARG\_ANYTHING, };diff --git a/net/core/filter.c b/net/core/filter.cindex 3f656391af7e91..606ab5a98a1af4 100644--- a/[net/core/filter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/filter.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)+++ b/[net/core/filter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/filter.c?id=216e3cd2f28dbbf1fe86848e0e29e6693b9f0a20)@@ -1712,7 +1712,7 @@ static const struct bpf\_func\_proto bpf\_skb\_store\_bytes\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE, .arg5\_type = ARG\_ANYTHING, };@@ -2017,9 +2017,9 @@ static const struct bpf\_func\_proto bpf\_csum\_diff\_proto = { .gpl\_only = false, .pkt\_access = true, .ret\_type = RET\_INTEGER,- .arg1\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg1\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg2\_type = ARG\_CONST\_SIZE\_OR\_ZERO,- .arg3\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg3\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg5\_type = ARG\_ANYTHING, };@@ -2540,7 +2540,7 @@ static const struct bpf\_func\_proto bpf\_redirect\_neigh\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_ANYTHING,- .arg2\_type = ARG\_PTR\_TO\_MEM\_OR\_NULL,+ .arg2\_type = ARG\_PTR\_TO\_MEM | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE\_OR\_ZERO, .arg4\_type = ARG\_ANYTHING, };@@ -4173,7 +4173,7 @@ static const struct bpf\_func\_proto bpf\_skb\_event\_output\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -4187,7 +4187,7 @@ const struct bpf\_func\_proto bpf\_skb\_output\_proto = { .arg1\_btf\_id = &bpf\_skb\_output\_btf\_ids[0], .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -4370,7 +4370,7 @@ static const struct bpf\_func\_proto bpf\_skb\_set\_tunnel\_key\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, };@@ -4396,7 +4396,7 @@ static const struct bpf\_func\_proto bpf\_skb\_set\_tunnel\_opt\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, }; @@ -4566,7 +4566,7 @@ static const struct bpf\_func\_proto bpf\_xdp\_event\_output\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -4580,7 +4580,7 @@ const struct bpf\_func\_proto bpf\_xdp\_output\_proto = { .arg1\_btf\_id = &bpf\_xdp\_output\_btf\_ids[0], .arg2\_type = ARG\_CONST\_MAP\_PTR, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE\_OR\_ZERO, }; @@ -5066,7 +5066,7 @@ const struct bpf\_func\_proto bpf\_sk\_setsockopt\_proto = { .arg1\_type = ARG\_PTR\_TO\_BTF\_ID\_SOCK\_COMMON, .arg2\_type = ARG\_ANYTHING, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE, }; @@ -5100,7 +5100,7 @@ static const struct bpf\_func\_proto bpf\_sock\_addr\_setsockopt\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE, }; @@ -5134,7 +5134,7 @@ static const struct bpf\_func\_proto bpf\_sock\_ops\_setsockopt\_proto = { .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING, .arg3\_type = ARG\_ANYTHING,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE, }; @@ -5309,7 +5309,7 @@ static const struct bpf\_func\_proto bpf\_bind\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, }; @@ -5897,7 +5897,7 @@ static const struct bpf\_func\_proto bpf\_lwt\_in\_push\_encap\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE }; @@ -5907,7 +5907,7 @@ static const struct bpf\_func\_proto bpf\_lwt\_xmit\_push\_encap\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE }; @@ -5950,7 +5950,7 @@ static const struct bpf\_func\_proto bpf\_lwt\_seg6\_store\_bytes\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE }; @@ -6038,7 +6038,7 @@ static const struct bpf\_func\_proto bpf\_lwt\_seg6\_action\_proto = { .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX, .arg2\_type = ARG\_ANYTHING,- .arg3\_type = ARG\_PTR\_TO\_MEM,+ .arg3\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg4\_type = ARG\_CONST\_SIZE }; @@ -6263,7 +6263,7 @@ static const struct bpf\_func\_proto bpf\_skc\_lookup\_tcp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6282,7 +6282,7 @@ static const struct bpf\_func\_proto bpf\_sk\_lookup\_tcp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6301,7 +6301,7 @@ static const struct bpf\_func\_proto bpf\_sk\_lookup\_udp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6338,7 +6338,7 @@ static const struct bpf\_func\_proto bpf\_xdp\_sk\_lookup\_udp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6361,7 +6361,7 @@ static const struct bpf\_func\_proto bpf\_xdp\_skc\_lookup\_tcp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6384,7 +6384,7 @@ static const struct bpf\_func\_proto bpf\_xdp\_sk\_lookup\_tcp\_proto = { .pkt\_access = true, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6403,7 +6403,7 @@ static const struct bpf\_func\_proto bpf\_sock\_addr\_skc\_lookup\_tcp\_proto = { .gpl\_only = false, .ret\_type = RET\_PTR\_TO\_SOCK\_COMMON\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6422,7 +6422,7 @@ static const struct bpf\_func\_proto bpf\_sock\_addr\_sk\_lookup\_tcp\_proto = { .gpl\_only = false, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6441,7 +6441,7 @@ static const struct bpf\_func\_proto bpf\_sock\_addr\_sk\_lookup\_udp\_proto = { .gpl\_only = false, .ret\_type = RET\_PTR\_TO\_SOCKET\_OR\_NULL, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, .arg5\_type = ARG\_ANYTHING,@@ -6754,9 +6754,9 @@ static const struct bpf\_func\_proto bpf\_tcp\_check\_syncookie\_proto = { .pkt\_access = true, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_BTF\_ID\_SOCK\_COMMON,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE, }; @@ -6823,9 +6823,9 @@ static const struct bpf\_func\_proto bpf\_tcp\_gen\_syncookie\_proto = { .pkt\_access = true, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_BTF\_ID\_SOCK\_COMMON,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE,- .arg4\_type = ARG\_PTR\_TO\_MEM,+ .arg4\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg5\_type = ARG\_CONST\_SIZE, }; @@ -7054,7 +7054,7 @@ static const struct bpf\_func\_proto bpf\_sock\_ops\_store\_hdr\_opt\_proto = { .gpl\_only = false, .ret\_type = RET\_INTEGER, .arg1\_type = ARG\_PTR\_TO\_CTX,- .arg2\_type = ARG\_PTR\_TO\_MEM,+ .arg2\_type = ARG\_PTR\_TO\_MEM | MEM\_RDONLY, .arg3\_type = ARG\_CONST\_SIZE, .arg4\_type = ARG\_ANYTHING, }; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:50 +0000



=== Content from access.redhat.com_47864db1_20250108_151337.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=6KWELqm5Nn0&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDozMTM4JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMzEzOCkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=6KWELqm5Nn0&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDozMTM4JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMzEzOCkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=6KWELqm5Nn0&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDozMTM4JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMzEzOCkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_72a148ce_20250108_151336.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2040599%255D%2528show_bug.cgi%253Fid%253D2040599%2529)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2040599%255D%2528show_bug.cgi%253Fid%253D2040599%2529)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2040599%255D%2528show_bug.cgi%253Fid%253D2040599%2529)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Invalid Bug ID

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

'2040599](show\_bug.cgi?id=2040599)' is not a valid bug number
nor an alias to a bug.

Please press **Back** and try again.

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_1d648fc1_20250108_151336.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=whGf2tcjLM8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoxMDI2MiU1RChodHRwczovYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNCUzQTEwMjYyKSJ9)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=whGf2tcjLM8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoxMDI2MiU1RChodHRwczovYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNCUzQTEwMjYyKSJ9)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=whGf2tcjLM8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoxMDI2MiU1RChodHRwczovYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNCUzQTEwMjYyKSJ9)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_78f58d5b_20250108_151338.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from git.kernel.org_355a142c_20250108_114912.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:48 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 13:27:41 -0800 |
| commit | [20b2aff4bc15bda809f994761d5719827d66c0b4](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=20b2aff4bc15bda809f994761d5719827d66c0b4) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)) | |
| tree | [56ef53fccf3a9be91909c3dc2cd36068043acc68](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | |
| parent | [c25b2ae136039ffa820c26138ed4a5e5f3ab3841](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=20b2aff4bc15bda809f994761d5719827d66c0b4&id2=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)) | |
| download | [linux-20b2aff4bc15bda809f994761d5719827d66c0b4.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-20b2aff4bc15bda809f994761d5719827d66c0b4.tar.gz) | |

bpf: Introduce MEM\_RDONLY flagThis patch introduce a flag MEM\_RDONLY to tag a reg value
pointing to read-only memory. It makes the following changes:
1. PTR\_TO\_RDWR\_BUF -> PTR\_TO\_BUF
2. PTR\_TO\_RDONLY\_BUF -> PTR\_TO\_BUF | MEM\_RDONLY
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-6-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-6-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=20b2aff4bc15bda809f994761d5719827d66c0b4)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/btf.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/map_iter.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 84 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/core/bpf_sk_storage.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/core/sock_map.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4) | 2 | |  |  |  | | --- | --- | --- | |

6 files changed, 60 insertions, 43 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex c3de62267b84dc..126048110bdbde 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -311,7 +311,10 @@ enum bpf\_type\_flag { /\* PTR may be NULL. \*/ PTR\_MAYBE\_NULL = BIT(0 + BPF\_BASE\_TYPE\_BITS), - \_\_BPF\_TYPE\_LAST\_FLAG = PTR\_MAYBE\_NULL,+ /\* MEM is read-only. \*/+ MEM\_RDONLY = BIT(1 + BPF\_BASE\_TYPE\_BITS),++ \_\_BPF\_TYPE\_LAST\_FLAG = MEM\_RDONLY, };  /\* Max number of base types. \*/@@ -492,8 +495,7 @@ enum bpf\_reg\_type { \* an explicit null check is required for this struct. \*/ PTR\_TO\_MEM, /\* reg points to valid memory region \*/- PTR\_TO\_RDONLY\_BUF, /\* reg points to a readonly buffer \*/- PTR\_TO\_RDWR\_BUF, /\* reg points to a read/write buffer \*/+ PTR\_TO\_BUF, /\* reg points to a read/write buffer \*/ PTR\_TO\_PERCPU\_BTF\_ID, /\* reg points to a percpu kernel variable \*/ PTR\_TO\_FUNC, /\* reg points to a bpf program function \*/ \_\_BPF\_REG\_TYPE\_MAX,diff --git a/kernel/bpf/btf.c b/kernel/bpf/btf.cindex 4e2ca7bea6c4cb..d1447b075c736c 100644--- a/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -4944,8 +4944,7 @@ bool btf\_ctx\_access(int off, int size, enum bpf\_access\_type type,  type = base\_type(ctx\_arg\_info->reg\_type); flag = type\_flag(ctx\_arg\_info->reg\_type);- if (ctx\_arg\_info->offset == off &&- (type == PTR\_TO\_RDWR\_BUF || type == PTR\_TO\_RDONLY\_BUF) &&+ if (ctx\_arg\_info->offset == off && type == PTR\_TO\_BUF && (flag & PTR\_MAYBE\_NULL)) { info->reg\_type = ctx\_arg\_info->reg\_type; return true;diff --git a/kernel/bpf/map\_iter.c b/kernel/bpf/map\_iter.cindex 631f0e44b7a9e5..b0fa190b097903 100644--- a/[kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/map_iter.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/map_iter.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -174,9 +174,9 @@ static const struct bpf\_iter\_reg bpf\_map\_elem\_reg\_info = { .ctx\_arg\_info\_size = 2, .ctx\_arg\_info = { { offsetof(struct bpf\_iter\_\_bpf\_map\_elem, key),- PTR\_TO\_RDONLY\_BUF | PTR\_MAYBE\_NULL },+ PTR\_TO\_BUF | PTR\_MAYBE\_NULL | MEM\_RDONLY }, { offsetof(struct bpf\_iter\_\_bpf\_map\_elem, value),- PTR\_TO\_RDWR\_BUF | PTR\_MAYBE\_NULL },+ PTR\_TO\_BUF | PTR\_MAYBE\_NULL }, }, }; diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 97e9d3f31443e1..e0a8a55ea3df99 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -455,6 +455,11 @@ static bool reg\_type\_may\_be\_refcounted\_or\_null(enum bpf\_reg\_type type) base\_type(type) == PTR\_TO\_MEM; } +static bool type\_is\_rdonly\_mem(u32 type)+{+ return type & MEM\_RDONLY;+}+ static bool arg\_type\_may\_be\_refcounted(enum bpf\_arg\_type type) { return type == ARG\_PTR\_TO\_SOCK\_COMMON;@@ -530,7 +535,7 @@ static bool is\_cmpxchg\_insn(const struct bpf\_insn \*insn) static const char \*reg\_type\_str(struct bpf\_verifier\_env \*env, enum bpf\_reg\_type type) {- char postfix[16] = {0};+ char postfix[16] = {0}, prefix[16] = {0}; static const char \* const str[] = { [NOT\_INIT] = "?", [SCALAR\_VALUE] = "inv",@@ -550,8 +555,7 @@ static const char \*reg\_type\_str(struct bpf\_verifier\_env \*env, [PTR\_TO\_BTF\_ID] = "ptr\_", [PTR\_TO\_PERCPU\_BTF\_ID] = "percpu\_ptr\_", [PTR\_TO\_MEM] = "mem",- [PTR\_TO\_RDONLY\_BUF] = "rdonly\_buf",- [PTR\_TO\_RDWR\_BUF] = "rdwr\_buf",+ [PTR\_TO\_BUF] = "buf", [PTR\_TO\_FUNC] = "func", [PTR\_TO\_MAP\_KEY] = "map\_key", };@@ -564,8 +568,11 @@ static const char \*reg\_type\_str(struct bpf\_verifier\_env \*env, strncpy(postfix, "\_or\_null", 16); } - snprintf(env->type\_str\_buf, TYPE\_STR\_BUF\_LEN, "%s%s",- str[base\_type(type)], postfix);+ if (type & MEM\_RDONLY)+ strncpy(prefix, "rdonly\_", 16);++ snprintf(env->type\_str\_buf, TYPE\_STR\_BUF\_LEN, "%s%s%s",+ prefix, str[base\_type(type)], postfix); return env->type\_str\_buf; } @@ -2755,8 +2762,7 @@ static bool is\_spillable\_regtype(enum bpf\_reg\_type type) case PTR\_TO\_TCP\_SOCK: case PTR\_TO\_XDP\_SOCK: case PTR\_TO\_BTF\_ID:- case PTR\_TO\_RDONLY\_BUF:- case PTR\_TO\_RDWR\_BUF:+ case PTR\_TO\_BUF: case PTR\_TO\_PERCPU\_BTF\_ID: case PTR\_TO\_MEM: case PTR\_TO\_FUNC:@@ -4508,22 +4514,28 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn } else if (reg->type == CONST\_PTR\_TO\_MAP) { err = check\_ptr\_to\_map\_access(env, regs, regno, off, size, t, value\_regno);- } else if (reg->type == PTR\_TO\_RDONLY\_BUF) {- if (t == BPF\_WRITE) {- verbose(env, "R%d cannot write into %s\n",- regno, reg\_type\_str(env, reg->type));- return -EACCES;+ } else if (base\_type(reg->type) == PTR\_TO\_BUF) {+ bool rdonly\_mem = type\_is\_rdonly\_mem(reg->type);+ const char \*buf\_info;+ u32 \*max\_access;++ if (rdonly\_mem) {+ if (t == BPF\_WRITE) {+ verbose(env, "R%d cannot write into %s\n",+ regno, reg\_type\_str(env, reg->type));+ return -EACCES;+ }+ buf\_info = "rdonly";+ max\_access = &env->prog->aux->max\_rdonly\_access;+ } else {+ buf\_info = "rdwr";+ max\_access = &env->prog->aux->max\_rdwr\_access; }+ err = check\_buffer\_access(env, reg, regno, off, size, false,- "rdonly",- &env->prog->aux->max\_rdonly\_access);- if (!err && value\_regno >= 0)- mark\_reg\_unknown(env, regs, value\_regno);- } else if (reg->type == PTR\_TO\_RDWR\_BUF) {- err = check\_buffer\_access(env, reg, regno, off, size, false,- "rdwr",- &env->prog->aux->max\_rdwr\_access);- if (!err && t == BPF\_READ && value\_regno >= 0)+ buf\_info, max\_access);++ if (!err && value\_regno >= 0 && (rdonly\_mem || t == BPF\_READ)) mark\_reg\_unknown(env, regs, value\_regno); } else { verbose(env, "R%d invalid mem access '%s'\n", regno,@@ -4771,8 +4783,10 @@ static int check\_helper\_mem\_access(struct bpf\_verifier\_env \*env, int regno, struct bpf\_call\_arg\_meta \*meta) { struct bpf\_reg\_state \*regs = cur\_regs(env), \*reg = &regs[regno];+ const char \*buf\_info;+ u32 \*max\_access; - switch (reg->type) {+ switch (base\_type(reg->type)) { case PTR\_TO\_PACKET: case PTR\_TO\_PACKET\_META: return check\_packet\_access(env, regno, reg->off, access\_size,@@ -4791,18 +4805,20 @@ static int check\_helper\_mem\_access(struct bpf\_verifier\_env \*env, int regno, return check\_mem\_region\_access(env, regno, reg->off, access\_size, reg->mem\_size, zero\_size\_allowed);- case PTR\_TO\_RDONLY\_BUF:- if (meta && meta->raw\_mode)- return -EACCES;- return check\_buffer\_access(env, reg, regno, reg->off,- access\_size, zero\_size\_allowed,- "rdonly",- &env->prog->aux->max\_rdonly\_access);- case PTR\_TO\_RDWR\_BUF:+ case PTR\_TO\_BUF:+ if (type\_is\_rdonly\_mem(reg->type)) {+ if (meta && meta->raw\_mode)+ return -EACCES;++ buf\_info = "rdonly";+ max\_access = &env->prog->aux->max\_rdonly\_access;+ } else {+ buf\_info = "rdwr";+ max\_access = &env->prog->aux->max\_rdwr\_access;+ } return check\_buffer\_access(env, reg, regno, reg->off, access\_size, zero\_size\_allowed,- "rdwr",- &env->prog->aux->max\_rdwr\_access);+ buf\_info, max\_access); case PTR\_TO\_STACK: return check\_stack\_range\_initialized( env,@@ -5081,8 +5097,8 @@ static const struct bpf\_reg\_types mem\_types = { PTR\_TO\_MAP\_KEY, PTR\_TO\_MAP\_VALUE, PTR\_TO\_MEM,- PTR\_TO\_RDONLY\_BUF,- PTR\_TO\_RDWR\_BUF,+ PTR\_TO\_BUF,+ PTR\_TO\_BUF | MEM\_RDONLY, }, }; diff --git a/net/core/bpf\_sk\_storage.c b/net/core/bpf\_sk\_storage.cindex 4cb5ef8eddbc4c..ea61dfe19c869f 100644--- a/[net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/bpf_sk_storage.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/bpf_sk_storage.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -929,7 +929,7 @@ static struct bpf\_iter\_reg bpf\_sk\_storage\_map\_reg\_info = { { offsetof(struct bpf\_iter\_\_bpf\_sk\_storage\_map, sk), PTR\_TO\_BTF\_ID\_OR\_NULL }, { offsetof(struct bpf\_iter\_\_bpf\_sk\_storage\_map, value),- PTR\_TO\_RDWR\_BUF | PTR\_MAYBE\_NULL },+ PTR\_TO\_BUF | PTR\_MAYBE\_NULL }, }, .seq\_info = &iter\_seq\_info, };diff --git a/net/core/sock\_map.c b/net/core/sock\_map.cindex 96d4ea7e6918e9..9618ab6d7cc989 100644--- a/[net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/sock_map.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)+++ b/[net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/sock_map.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)@@ -1564,7 +1564,7 @@ static struct bpf\_iter\_reg sock\_map\_iter\_reg = { .ctx\_arg\_info\_size = 2, .ctx\_arg\_info = { { offsetof(struct bpf\_iter\_\_sockmap, key),- PTR\_TO\_RDONLY\_BUF | PTR\_MAYBE\_NULL },+ PTR\_TO\_BUF | PTR\_MAYBE\_NULL | MEM\_RDONLY }, { offsetof(struct bpf\_iter\_\_sockmap, sk), PTR\_TO\_BTF\_ID\_OR\_NULL }, }, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:50 +0000



=== Content from bugzilla.redhat.com_94e32b39_20250108_114912.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2044578)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2044578)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2044578)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2044578

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2044578**](show_bug.cgi?id=2044578)
(CVE-2022-0500)
- [CVE-2022-0500](https://access.redhat.com/security/cve/CVE-2022-0500) kernel: Linux ebpf logic vulnerability leads to critical memory read and write gaining root privileges

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2022-0500 kernel: Linux ebpf logic vulnerability leads to critical memory...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | NEW | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2022-0500 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Nobody | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2045103](show_bug.cgi?id=2045103) [2045104](show_bug.cgi?id=2045104) [2045105](show_bug.cgi?id=2045105) [2045106](show_bug.cgi?id=2045106) [2056248](show_bug.cgi?id=2056248 "CLOSED ERRATA - CVE-2022-0500 kernel: Linux ebpf logic vulnerability leads to critical memory read and write gaining root privileges [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2044579](show_bug.cgi?id=2044579) [2050770](show_bug.cgi?id=2050770) | | TreeView+ | [depends on](buglist.cgi?bug_id=2044578&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2044578&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2022-01-24 19:05 UTC by Pedro Sampaio | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2024-11-26 00:47 UTC ([History](show_activity.cgi?id=2044578)) | | [CC List:](page.cgi?id=fields.html#cclist) | 48 users (show)  acaringi adscvr airlied alciregi allarkin bhu carnil chwhite crwood dfreiber drow dvlasenk hdegoede hkrzesin jarod jarodwilson jburrell jeremy jfaracco jforbes jglisse jlelli joe.lawrence jonathan josef jshortt jstancek jwboyer jwyatt kcarcia kernel-maint kernel-mgr lgoncalv linville lzampier masami256 mchehab nmurray ptalbert qzhao rvrbovsk scweaver steved vkumar vmalik walters williams zulinx86 | | Fixed In Version: | Linux kernel 5.17-rc1 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A flaw was found in unrestricted eBPF usage by the BPF\_BTF\_LOAD, leading to a possible out-of-bounds memory write in the Linux kernel’s BPF subsystem due to the way a user loads BTF. This flaw allows a local user to crash or escalate their privileges on the system. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2024:0724](https://access.redhat.com/errata/RHSA-2024%3A0724) | 0 | None | None | None | 2024-02-07 16:28:26 UTC | | Red Hat Product Errata | [RHSA-2024:10262](https://access.redhat.com/errata/RHSA-2024%3A10262) | 0 | None | None | None | 2024-11-26 00:47:48 UTC | | Red Hat Product Errata | [RHSA-2024:2950](https://access.redhat.com/errata/RHSA-2024%3A2950) | 0 | None | None | None | 2024-05-22 09:12:26 UTC | | Red Hat Product Errata | [RHSA-2024:3138](https://access.redhat.com/errata/RHSA-2024%3A3138) | 0 | None | None | None | 2024-05-22 09:49:02 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2044578#c0)  Pedro Sampaio    2022-01-24 19:05:54 UTC  ``` Linux ebpf logic vulnerability leads to critical memory read and write,An attacker with cap_bpf can gain root privileges or container escape.  References:  [https://bugzilla.redhat.com/show_bug.cgi?id=2040599](show_bug.cgi?id=2040599)   ```  [Comment 8](show_bug.cgi?id=2044578#c8)  Alex    2022-02-20 13:50:08 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 2056248](show_bug.cgi?id=2056248 "CLOSED ERRATA - CVE-2022-0500 kernel: Linux ebpf logic vulnerability leads to critical memory read and write gaining root privileges [fedora-all]")]   ```  [Comment 10](show_bug.cgi?id=2044578#c10)  Salvatore Bonaccorso    2022-02-21 07:32:03 UTC  ``` Hi Pedro  The information is quite scarce here to determine which kernel versions are affected by the issue. Can you point to the upstream fix in 5.17-rc1 which fixes the issue? I'm interested to correctly track this CVE in another downstream distribution.  Many thanks already!  Regards, Salvatore   ```  [Comment 11](show_bug.cgi?id=2044578#c11)  Pedro Sampaio    2022-02-21 13:06:46 UTC  ``` In reply to [comment #10](show_bug.cgi?id=2044578#c10): > Hi Pedro >  > The information is quite scarce here to determine which kernel versions are > affected by the issue. Can you point to the upstream fix in 5.17-rc1 which > fixes the issue? I'm interested to correctly track this CVE in another > downstream distribution. >  > Many thanks already! >  > Regards, > Salvatore  You can find the related commits here:  <https://access.redhat.com/security/cve/CVE-2022-0500>   ```  [Comment 12](show_bug.cgi?id=2044578#c12)  Salvatore Bonaccorso    2022-02-21 13:14:23 UTC  ``` Hi Pedro,  (In reply to Pedro Sampaio from [comment #11](show_bug.cgi?id=2044578#c11)) > In reply to [comment #10](show_bug.cgi?id=2044578#c10): > > Hi Pedro > >  > > The information is quite scarce here to determine which kernel versions are > > affected by the issue. Can you point to the upstream fix in 5.17-rc1 which > > fixes the issue? I'm interested to correctly track this CVE in another > > downstream distribution. > >  > > Many thanks already! > >  > > Regards, > > Salvatore >  > You can find the related commits here: >  > <https://access.redhat.com/security/cve/CVE-2022-0500>  Thank you!   ```  [Comment 13](show_bug.cgi?id=2044578#c13)  Salvatore Bonaccorso    2022-02-21 13:18:35 UTC  ``` Pedro, I wonder this is not duplicating [CVE-2022-23222](https://access.redhat.com/security/cve/CVE-2022-23222) right because treating a different aspect?   ```  [Comment 14](show_bug.cgi?id=2044578#c14)  Salvatore Bonaccorso    2022-02-24 08:21:50 UTC  ``` Given [https://lore.kernel.org/stable/20220216225209.2196865-1-haoluo@google.com/](https://lore.kernel.org/stable/20220216225209.2196865-1-haoluo%40google.com/) this would be separate from [CVE-2022-23222](https://access.redhat.com/security/cve/CVE-2022-23222) and the fix for this vulnerability is the there mentioned 7th patch ("bpf: Make per_cpu_ptr return rdonly PTR_TO_MEM").   ```  [Comment 29](show_bug.cgi?id=2044578#c29)  errata-xmlrpc    2024-02-07 16:28:22 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8.6 Extended Update Support  Via RHSA-2024:0724 [https://access.redhat.com/errata/RHSA-2024:0724](https://access.redhat.com/errata/RHSA-2024%3A0724)   ```  [Comment 31](show_bug.cgi?id=2044578#c31)  errata-xmlrpc    2024-05-22 09:12:21 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2024:2950 [https://access.redhat.com/errata/RHSA-2024:2950](https://access.redhat.com/errata/RHSA-2024%3A2950)   ```  [Comment 32](show_bug.cgi?id=2044578#c32)  errata-xmlrpc    2024-05-22 09:48:58 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8  Via RHSA-2024:3138 [https://access.redhat.com/errata/RHSA-2024:3138](https://access.redhat.com/errata/RHSA-2024%3A3138)   ```  [Comment 33](show_bug.cgi?id=2044578#c33)  errata-xmlrpc    2024-11-26 00:47:44 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 8.8 Extended Update Support  Via RHSA-2024:10262 [https://access.redhat.com/errata/RHSA-2024:10262](https://access.redhat.com/errata/RHSA-2024%3A10262)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2044578&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_c758c61e_20250108_151335.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=NXw_wRj7FAI&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNzI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDcyNCkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=NXw_wRj7FAI&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNzI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDcyNCkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=NXw_wRj7FAI&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDowNzI0JTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMDcyNCkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_dffa2614_20250108_151337.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_75042a6d_20250108_151338.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2024 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_c0c7fcaf_20250108_151337.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=HSk4EwOtQL8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoyOTUwJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMjk1MCkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=HSk4EwOtQL8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoyOTUwJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMjk1MCkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=HSk4EwOtQL8&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyNDoyOTUwJTVEKGh0dHBzOi9hY2Nlc3MucmVkaGF0LmNvbS9lcnJhdGEvUkhTQS0yMDI0JTNBMjk1MCkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2022 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from security.netapp.com_6f14a04f_20250108_114914.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2022-0500 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20220519-0001)

## CVE-2022-0500 Linux Kernel Vulnerability in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20220519-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20220519-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20220519-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20220519-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20220519-0001
**Version:**
7.0

**Last updated:**
05/09/2024

**Status:**
Final.

**CVEs:** CVE-2022-0500

Overview
#### Summary

Multiple NetApp products incorporate Linux Kernel. Linux Kernel versions through 5.17 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2022-0500](https://nvd.nist.gov/vuln/detail/CVE-2022-0500) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=20b2aff4bc15bda809f994761d5719827d66c0b4>

Affected Products
#### Affected Products

* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C

#### Products Not Affected

* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - Cloud Insights Telegraf Agent
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Service Processor - 8080/8060/8040/8020
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM6 SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster Tiebreaker for clustered Data ONTAP
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112
* StorageGRID Baseboard Management Controller (BMC)
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20220519-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20220519 | Initial Public Release |
| 2.0 | 20220520 | FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400 moved to Products Not Affected |
| 3.0 | 20220523 | ONTAP tools for VMware vSphere moved to Products Not Affected |
| 4.0 | 20220531 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Products Not Affected |
| 5.0 | 20220602 | NetApp Converged Systems Advisor Agent moved to Products Not Affected |
| 6.0 | 20220620 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 7.0 | 20240509 | Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from git.kernel.org_3dac2140_20250108_114913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:47 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 13:27:23 -0800 |
| commit | [c25b2ae136039ffa820c26138ed4a5e5f3ab3841](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)) | |
| tree | [bfdb6805f2595026430786aab1bdda685143cc91](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | |
| parent | [3c4807322660d4290ac9062c034aed6b87243861](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3c4807322660d4290ac9062c034aed6b87243861) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841&id2=3c4807322660d4290ac9062c034aed6b87243861)) | |
| download | [linux-c25b2ae136039ffa820c26138ed4a5e5f3ab3841.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-c25b2ae136039ffa820c26138ed4a5e5f3ab3841.tar.gz) | |

bpf: Replace PTR\_TO\_XXX\_OR\_NULL with PTR\_TO\_XXX | PTR\_MAYBE\_NULLWe have introduced a new type to make bpf\_reg composable, by
allocating bits in the type to represent flags.
One of the flags is PTR\_MAYBE\_NULL which indicates a pointer
may be NULL. This patch switches the qualified reg\_types to
use this flag. The reg\_types changed in this patch include:
1. PTR\_TO\_MAP\_VALUE\_OR\_NULL
2. PTR\_TO\_SOCKET\_OR\_NULL
3. PTR\_TO\_SOCK\_COMMON\_OR\_NULL
4. PTR\_TO\_TCP\_SOCK\_OR\_NULL
5. PTR\_TO\_BTF\_ID\_OR\_NULL
6. PTR\_TO\_MEM\_OR\_NULL
7. PTR\_TO\_RDONLY\_BUF\_OR\_NULL
8. PTR\_TO\_RDWR\_BUF\_OR\_NULL
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/r/20211217003152.48334-5-haoluo@google.com](https://lore.kernel.org/r/20211217003152.48334-5-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 18 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/bpf\_verifier.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf_verifier.h?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/btf.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 7 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/map_iter.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 298 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/core/bpf_sk_storage.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/core/sock_map.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841) | 2 | |  |  |  | | --- | --- | --- | |

7 files changed, 147 insertions, 188 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex 975a1d5951bde1..c3de62267b84dc 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -465,18 +465,15 @@ enum bpf\_reg\_type { PTR\_TO\_CTX, /\* reg points to bpf\_context \*/ CONST\_PTR\_TO\_MAP, /\* reg points to struct bpf\_map \*/ PTR\_TO\_MAP\_VALUE, /\* reg points to map element value \*/- PTR\_TO\_MAP\_VALUE\_OR\_NULL,/\* points to map elem value or NULL \*/+ PTR\_TO\_MAP\_KEY, /\* reg points to a map element key \*/ PTR\_TO\_STACK, /\* reg == frame\_pointer + offset \*/ PTR\_TO\_PACKET\_META, /\* skb->data - meta\_len \*/ PTR\_TO\_PACKET, /\* reg points to skb->data \*/ PTR\_TO\_PACKET\_END, /\* skb->data + headlen \*/ PTR\_TO\_FLOW\_KEYS, /\* reg points to bpf\_flow\_keys \*/ PTR\_TO\_SOCKET, /\* reg points to struct bpf\_sock \*/- PTR\_TO\_SOCKET\_OR\_NULL, /\* reg points to struct bpf\_sock or NULL \*/ PTR\_TO\_SOCK\_COMMON, /\* reg points to sock\_common \*/- PTR\_TO\_SOCK\_COMMON\_OR\_NULL, /\* reg points to sock\_common or NULL \*/ PTR\_TO\_TCP\_SOCK, /\* reg points to struct tcp\_sock \*/- PTR\_TO\_TCP\_SOCK\_OR\_NULL, /\* reg points to struct tcp\_sock or NULL \*/ PTR\_TO\_TP\_BUFFER, /\* reg points to a writable raw tp's buffer \*/ PTR\_TO\_XDP\_SOCK, /\* reg points to struct xdp\_sock \*/ /\* PTR\_TO\_BTF\_ID points to a kernel struct that does not need@@ -494,18 +491,21 @@ enum bpf\_reg\_type { \* been checked for null. Used primarily to inform the verifier \* an explicit null check is required for this struct. \*/- PTR\_TO\_BTF\_ID\_OR\_NULL, PTR\_TO\_MEM, /\* reg points to valid memory region \*/- PTR\_TO\_MEM\_OR\_NULL, /\* reg points to valid memory region or NULL \*/ PTR\_TO\_RDONLY\_BUF, /\* reg points to a readonly buffer \*/- PTR\_TO\_RDONLY\_BUF\_OR\_NULL, /\* reg points to a readonly buffer or NULL \*/ PTR\_TO\_RDWR\_BUF, /\* reg points to a read/write buffer \*/- PTR\_TO\_RDWR\_BUF\_OR\_NULL, /\* reg points to a read/write buffer or NULL \*/ PTR\_TO\_PERCPU\_BTF\_ID, /\* reg points to a percpu kernel variable \*/ PTR\_TO\_FUNC, /\* reg points to a bpf program function \*/- PTR\_TO\_MAP\_KEY, /\* reg points to a map element key \*/ \_\_BPF\_REG\_TYPE\_MAX, + /\* Extended reg\_types. \*/+ PTR\_TO\_MAP\_VALUE\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_MAP\_VALUE,+ PTR\_TO\_SOCKET\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_SOCKET,+ PTR\_TO\_SOCK\_COMMON\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_SOCK\_COMMON,+ PTR\_TO\_TCP\_SOCK\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_TCP\_SOCK,+ PTR\_TO\_BTF\_ID\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_BTF\_ID,+ PTR\_TO\_MEM\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_MEM,+ /\* This must be the last entry. Its purpose is to ensure the enum is \* wide enough to hold the higher bits reserved for bpf\_type\_flag. \*/diff --git a/include/linux/bpf\_verifier.h b/include/linux/bpf\_verifier.hindex 34e4ceaca3c772..143401d4c9d9ac 100644--- a/[include/linux/bpf\_verifier.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf_verifier.h?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[include/linux/bpf\_verifier.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf_verifier.h?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -18,6 +18,8 @@ \* that converting umax\_value to int cannot overflow. \*/ #define BPF\_MAX\_VAR\_SIZ (1 << 29)+/\* size of type\_str\_buf in bpf\_verifier. \*/+#define TYPE\_STR\_BUF\_LEN 64  /\* Liveness marks, used for registers and spilled-regs (in stack slots). \* Read marks propagate upwards until they find a write mark; they record that@@ -484,6 +486,8 @@ struct bpf\_verifier\_env { /\* Same as scratched\_regs but for stack slots \*/ u64 scratched\_stack\_slots; u32 prev\_log\_len, prev\_insn\_print\_len;+ /\* buffer used in reg\_type\_str() to generate reg\_type string \*/+ char type\_str\_buf[TYPE\_STR\_BUF\_LEN]; };  \_\_printf(2, 0) void bpf\_verifier\_vlog(struct bpf\_verifier\_log \*log,diff --git a/kernel/bpf/btf.c b/kernel/bpf/btf.cindex a17de71abd2e6d..4e2ca7bea6c4cb 100644--- a/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -4940,10 +4940,13 @@ bool btf\_ctx\_access(int off, int size, enum bpf\_access\_type type, /\* check for PTR\_TO\_RDONLY\_BUF\_OR\_NULL or PTR\_TO\_RDWR\_BUF\_OR\_NULL \*/ for (i = 0; i < prog->aux->ctx\_arg\_info\_size; i++) { const struct bpf\_ctx\_arg\_aux \*ctx\_arg\_info = &prog->aux->ctx\_arg\_info[i];+ u32 type, flag; + type = base\_type(ctx\_arg\_info->reg\_type);+ flag = type\_flag(ctx\_arg\_info->reg\_type); if (ctx\_arg\_info->offset == off &&- (ctx\_arg\_info->reg\_type == PTR\_TO\_RDONLY\_BUF\_OR\_NULL ||- ctx\_arg\_info->reg\_type == PTR\_TO\_RDWR\_BUF\_OR\_NULL)) {+ (type == PTR\_TO\_RDWR\_BUF || type == PTR\_TO\_RDONLY\_BUF) &&+ (flag & PTR\_MAYBE\_NULL)) { info->reg\_type = ctx\_arg\_info->reg\_type; return true; }diff --git a/kernel/bpf/map\_iter.c b/kernel/bpf/map\_iter.cindex 6a9542af4212a1..631f0e44b7a9e5 100644--- a/[kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/map_iter.c?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[kernel/bpf/map\_iter.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/map_iter.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -174,9 +174,9 @@ static const struct bpf\_iter\_reg bpf\_map\_elem\_reg\_info = { .ctx\_arg\_info\_size = 2, .ctx\_arg\_info = { { offsetof(struct bpf\_iter\_\_bpf\_map\_elem, key),- PTR\_TO\_RDONLY\_BUF\_OR\_NULL },+ PTR\_TO\_RDONLY\_BUF | PTR\_MAYBE\_NULL }, { offsetof(struct bpf\_iter\_\_bpf\_map\_elem, value),- PTR\_TO\_RDWR\_BUF\_OR\_NULL },+ PTR\_TO\_RDWR\_BUF | PTR\_MAYBE\_NULL }, }, }; diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex ccc068c5c5f24a..97e9d3f31443e1 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -442,18 +442,6 @@ static bool reg\_type\_not\_null(enum bpf\_reg\_type type) type == PTR\_TO\_SOCK\_COMMON; } -static bool reg\_type\_may\_be\_null(enum bpf\_reg\_type type)-{- return type == PTR\_TO\_MAP\_VALUE\_OR\_NULL ||- type == PTR\_TO\_SOCKET\_OR\_NULL ||- type == PTR\_TO\_SOCK\_COMMON\_OR\_NULL ||- type == PTR\_TO\_TCP\_SOCK\_OR\_NULL ||- type == PTR\_TO\_BTF\_ID\_OR\_NULL ||- type == PTR\_TO\_MEM\_OR\_NULL ||- type == PTR\_TO\_RDONLY\_BUF\_OR\_NULL ||- type == PTR\_TO\_RDWR\_BUF\_OR\_NULL;-}- static bool reg\_may\_point\_to\_spin\_lock(const struct bpf\_reg\_state \*reg) { return reg->type == PTR\_TO\_MAP\_VALUE &&@@ -462,12 +450,9 @@ static bool reg\_may\_point\_to\_spin\_lock(const struct bpf\_reg\_state \*reg)  static bool reg\_type\_may\_be\_refcounted\_or\_null(enum bpf\_reg\_type type) {- return type == PTR\_TO\_SOCKET ||- type == PTR\_TO\_SOCKET\_OR\_NULL ||- type == PTR\_TO\_TCP\_SOCK ||- type == PTR\_TO\_TCP\_SOCK\_OR\_NULL ||- type == PTR\_TO\_MEM ||- type == PTR\_TO\_MEM\_OR\_NULL;+ return base\_type(type) == PTR\_TO\_SOCKET ||+ base\_type(type) == PTR\_TO\_TCP\_SOCK ||+ base\_type(type) == PTR\_TO\_MEM; }  static bool arg\_type\_may\_be\_refcounted(enum bpf\_arg\_type type)@@ -537,39 +522,52 @@ static bool is\_cmpxchg\_insn(const struct bpf\_insn \*insn) insn->imm == BPF\_CMPXCHG; } -/\* string representation of 'enum bpf\_reg\_type' \*/-static const char \* const reg\_type\_str[] = {- [NOT\_INIT] = "?",- [SCALAR\_VALUE] = "inv",- [PTR\_TO\_CTX] = "ctx",- [CONST\_PTR\_TO\_MAP] = "map\_ptr",- [PTR\_TO\_MAP\_VALUE] = "map\_value",- [PTR\_TO\_MAP\_VALUE\_OR\_NULL] = "map\_value\_or\_null",- [PTR\_TO\_STACK] = "fp",- [PTR\_TO\_PACKET] = "pkt",- [PTR\_TO\_PACKET\_META] = "pkt\_meta",- [PTR\_TO\_PACKET\_END] = "pkt\_end",- [PTR\_TO\_FLOW\_KEYS] = "flow\_keys",- [PTR\_TO\_SOCKET] = "sock",- [PTR\_TO\_SOCKET\_OR\_NULL] = "sock\_or\_null",- [PTR\_TO\_SOCK\_COMMON] = "sock\_common",- [PTR\_TO\_SOCK\_COMMON\_OR\_NULL] = "sock\_common\_or\_null",- [PTR\_TO\_TCP\_SOCK] = "tcp\_sock",- [PTR\_TO\_TCP\_SOCK\_OR\_NULL] = "tcp\_sock\_or\_null",- [PTR\_TO\_TP\_BUFFER] = "tp\_buffer",- [PTR\_TO\_XDP\_SOCK] = "xdp\_sock",- [PTR\_TO\_BTF\_ID] = "ptr\_",- [PTR\_TO\_BTF\_ID\_OR\_NULL] = "ptr\_or\_null\_",- [PTR\_TO\_PERCPU\_BTF\_ID] = "percpu\_ptr\_",- [PTR\_TO\_MEM] = "mem",- [PTR\_TO\_MEM\_OR\_NULL] = "mem\_or\_null",- [PTR\_TO\_RDONLY\_BUF] = "rdonly\_buf",- [PTR\_TO\_RDONLY\_BUF\_OR\_NULL] = "rdonly\_buf\_or\_null",- [PTR\_TO\_RDWR\_BUF] = "rdwr\_buf",- [PTR\_TO\_RDWR\_BUF\_OR\_NULL] = "rdwr\_buf\_or\_null",- [PTR\_TO\_FUNC] = "func",- [PTR\_TO\_MAP\_KEY] = "map\_key",-};+/\* string representation of 'enum bpf\_reg\_type'+ \*+ \* Note that reg\_type\_str() can not appear more than once in a single verbose()+ \* statement.+ \*/+static const char \*reg\_type\_str(struct bpf\_verifier\_env \*env,+ enum bpf\_reg\_type type)+{+ char postfix[16] = {0};+ static const char \* const str[] = {+ [NOT\_INIT] = "?",+ [SCALAR\_VALUE] = "inv",+ [PTR\_TO\_CTX] = "ctx",+ [CONST\_PTR\_TO\_MAP] = "map\_ptr",+ [PTR\_TO\_MAP\_VALUE] = "map\_value",+ [PTR\_TO\_STACK] = "fp",+ [PTR\_TO\_PACKET] = "pkt",+ [PTR\_TO\_PACKET\_META] = "pkt\_meta",+ [PTR\_TO\_PACKET\_END] = "pkt\_end",+ [PTR\_TO\_FLOW\_KEYS] = "flow\_keys",+ [PTR\_TO\_SOCKET] = "sock",+ [PTR\_TO\_SOCK\_COMMON] = "sock\_common",+ [PTR\_TO\_TCP\_SOCK] = "tcp\_sock",+ [PTR\_TO\_TP\_BUFFER] = "tp\_buffer",+ [PTR\_TO\_XDP\_SOCK] = "xdp\_sock",+ [PTR\_TO\_BTF\_ID] = "ptr\_",+ [PTR\_TO\_PERCPU\_BTF\_ID] = "percpu\_ptr\_",+ [PTR\_TO\_MEM] = "mem",+ [PTR\_TO\_RDONLY\_BUF] = "rdonly\_buf",+ [PTR\_TO\_RDWR\_BUF] = "rdwr\_buf",+ [PTR\_TO\_FUNC] = "func",+ [PTR\_TO\_MAP\_KEY] = "map\_key",+ };++ if (type & PTR\_MAYBE\_NULL) {+ if (base\_type(type) == PTR\_TO\_BTF\_ID ||+ base\_type(type) == PTR\_TO\_PERCPU\_BTF\_ID)+ strncpy(postfix, "or\_null\_", 16);+ else+ strncpy(postfix, "\_or\_null", 16);+ }++ snprintf(env->type\_str\_buf, TYPE\_STR\_BUF\_LEN, "%s%s",+ str[base\_type(type)], postfix);+ return env->type\_str\_buf;+}  static char slot\_type\_char[] = { [STACK\_INVALID] = '?',@@ -675,7 +673,7 @@ static void print\_verifier\_state(struct bpf\_verifier\_env \*env, continue; verbose(env, " R%d", i); print\_liveness(env, reg->live);- verbose(env, "=%s", reg\_type\_str[t]);+ verbose(env, "=%s", reg\_type\_str(env, t)); if (t == SCALAR\_VALUE && reg->precise) verbose(env, "P"); if ((t == SCALAR\_VALUE || t == PTR\_TO\_STACK) &&@@ -683,9 +681,8 @@ static void print\_verifier\_state(struct bpf\_verifier\_env \*env, /\* reg->off should be 0 for SCALAR\_VALUE \*/ verbose(env, "%lld", reg->var\_off.value + reg->off); } else {- if (t == PTR\_TO\_BTF\_ID ||- t == PTR\_TO\_BTF\_ID\_OR\_NULL ||- t == PTR\_TO\_PERCPU\_BTF\_ID)+ if (base\_type(t) == PTR\_TO\_BTF\_ID ||+ base\_type(t) == PTR\_TO\_PERCPU\_BTF\_ID) verbose(env, "%s", kernel\_type\_name(reg->btf, reg->btf\_id)); verbose(env, "(id=%d", reg->id); if (reg\_type\_may\_be\_refcounted\_or\_null(t))@@ -694,10 +691,9 @@ static void print\_verifier\_state(struct bpf\_verifier\_env \*env, verbose(env, ",off=%d", reg->off); if (type\_is\_pkt\_pointer(t)) verbose(env, ",r=%d", reg->range);- else if (t == CONST\_PTR\_TO\_MAP ||- t == PTR\_TO\_MAP\_KEY ||- t == PTR\_TO\_MAP\_VALUE ||- t == PTR\_TO\_MAP\_VALUE\_OR\_NULL)+ else if (base\_type(t) == CONST\_PTR\_TO\_MAP ||+ base\_type(t) == PTR\_TO\_MAP\_KEY ||+ base\_type(t) == PTR\_TO\_MAP\_VALUE) verbose(env, ",ks=%d,vs=%d", reg->map\_ptr->key\_size, reg->map\_ptr->value\_size);@@ -769,7 +765,7 @@ static void print\_verifier\_state(struct bpf\_verifier\_env \*env, if (is\_spilled\_reg(&state->stack[i])) { reg = &state->stack[i].spilled\_ptr; t = reg->type;- verbose(env, "=%s", reg\_type\_str[t]);+ verbose(env, "=%s", reg\_type\_str(env, t)); if (t == SCALAR\_VALUE && reg->precise) verbose(env, "P"); if (t == SCALAR\_VALUE && tnum\_is\_const(reg->var\_off))@@ -1202,8 +1198,7 @@ static void mark\_reg\_known\_zero(struct bpf\_verifier\_env \*env,  static void mark\_ptr\_not\_null\_reg(struct bpf\_reg\_state \*reg) {- switch (reg->type) {- case PTR\_TO\_MAP\_VALUE\_OR\_NULL: {+ if (base\_type(reg->type) == PTR\_TO\_MAP\_VALUE) { const struct bpf\_map \*map = reg->map\_ptr;  if (map->inner\_map\_meta) {@@ -1222,32 +1217,10 @@ static void mark\_ptr\_not\_null\_reg(struct bpf\_reg\_state \*reg) } else { reg->type = PTR\_TO\_MAP\_VALUE; }- break;- }- case PTR\_TO\_SOCKET\_OR\_NULL:- reg->type = PTR\_TO\_SOCKET;- break;- case PTR\_TO\_SOCK\_COMMON\_OR\_NULL:- reg->type = PTR\_TO\_SOCK\_COMMON;- break;- case PTR\_TO\_TCP\_SOCK\_OR\_NULL:- reg->type = PTR\_TO\_TCP\_SOCK;- break;- case PTR\_TO\_BTF\_ID\_OR\_NULL:- reg->type = PTR\_TO\_BTF\_ID;- break;- case PTR\_TO\_MEM\_OR\_NULL:- reg->type = PTR\_TO\_MEM;- break;- case PTR\_TO\_RDONLY\_BUF\_OR\_NULL:- reg->type = PTR\_TO\_RDONLY\_BUF;- break;- case PTR\_TO\_RDWR\_BUF\_OR\_NULL:- reg->type = PTR\_TO\_RDWR\_BUF;- break;- default:- WARN\_ONCE(1, "unknown nullable register type");+ return; }++ reg->type &= ~PTR\_MAYBE\_NULL; }  static bool reg\_is\_pkt\_pointer(const struct bpf\_reg\_state \*reg)@@ -2103,7 +2076,7 @@ static int mark\_reg\_read(struct bpf\_verifier\_env \*env, break; if (parent->live & REG\_LIVE\_DONE) { verbose(env, "verifier BUG type %s var\_off %lld off %d\n",- reg\_type\_str[parent->type],+ reg\_type\_str(env, parent->type), parent->var\_off.value, parent->off); return -EFAULT; }@@ -2768,9 +2741,8 @@ static int mark\_chain\_precision\_stack(struct bpf\_verifier\_env \*env, int spi)  static bool is\_spillable\_regtype(enum bpf\_reg\_type type) {- switch (type) {+ switch (base\_type(type)) { case PTR\_TO\_MAP\_VALUE:- case PTR\_TO\_MAP\_VALUE\_OR\_NULL: case PTR\_TO\_STACK: case PTR\_TO\_CTX: case PTR\_TO\_PACKET:@@ -2779,21 +2751,14 @@ static bool is\_spillable\_regtype(enum bpf\_reg\_type type) case PTR\_TO\_FLOW\_KEYS: case CONST\_PTR\_TO\_MAP: case PTR\_TO\_SOCKET:- case PTR\_TO\_SOCKET\_OR\_NULL: case PTR\_TO\_SOCK\_COMMON:- case PTR\_TO\_SOCK\_COMMON\_OR\_NULL: case PTR\_TO\_TCP\_SOCK:- case PTR\_TO\_TCP\_SOCK\_OR\_NULL: case PTR\_TO\_XDP\_SOCK: case PTR\_TO\_BTF\_ID:- case PTR\_TO\_BTF\_ID\_OR\_NULL: case PTR\_TO\_RDONLY\_BUF:- case PTR\_TO\_RDONLY\_BUF\_OR\_NULL: case PTR\_TO\_RDWR\_BUF:- case PTR\_TO\_RDWR\_BUF\_OR\_NULL: case PTR\_TO\_PERCPU\_BTF\_ID: case PTR\_TO\_MEM:- case PTR\_TO\_MEM\_OR\_NULL: case PTR\_TO\_FUNC: case PTR\_TO\_MAP\_KEY: return true;@@ -3633,7 +3598,7 @@ static int check\_ctx\_access(struct bpf\_verifier\_env \*env, int insn\_idx, int off, \*/ \*reg\_type = info.reg\_type; - if (\*reg\_type == PTR\_TO\_BTF\_ID || \*reg\_type == PTR\_TO\_BTF\_ID\_OR\_NULL) {+ if (base\_type(\*reg\_type) == PTR\_TO\_BTF\_ID) { \*btf = info.btf; \*btf\_id = info.btf\_id; } else {@@ -3701,7 +3666,7 @@ static int check\_sock\_access(struct bpf\_verifier\_env \*env, int insn\_idx, }  verbose(env, "R%d invalid %s access off=%d size=%d\n",- regno, reg\_type\_str[reg->type], off, size);+ regno, reg\_type\_str(env, reg->type), off, size);  return -EACCES; }@@ -4466,7 +4431,7 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn } else { mark\_reg\_known\_zero(env, regs, value\_regno);- if (reg\_type\_may\_be\_null(reg\_type))+ if (type\_may\_be\_null(reg\_type)) regs[value\_regno].id = ++env->id\_gen; /\* A load of ctx field could have different \* actual load size with the one encoded in the@@ -4474,8 +4439,7 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn \* a sub-register. \*/ regs[value\_regno].subreg\_def = DEF\_NOT\_SUBREG;- if (reg\_type == PTR\_TO\_BTF\_ID ||- reg\_type == PTR\_TO\_BTF\_ID\_OR\_NULL) {+ if (base\_type(reg\_type) == PTR\_TO\_BTF\_ID) { regs[value\_regno].btf = btf; regs[value\_regno].btf\_id = btf\_id; }@@ -4528,7 +4492,7 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn } else if (type\_is\_sk\_pointer(reg->type)) { if (t == BPF\_WRITE) { verbose(env, "R%d cannot write into %s\n",- regno, reg\_type\_str[reg->type]);+ regno, reg\_type\_str(env, reg->type)); return -EACCES; } err = check\_sock\_access(env, insn\_idx, regno, off, size, t);@@ -4547,7 +4511,7 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn } else if (reg->type == PTR\_TO\_RDONLY\_BUF) { if (t == BPF\_WRITE) { verbose(env, "R%d cannot write into %s\n",- regno, reg\_type\_str[reg->type]);+ regno, reg\_type\_str(env, reg->type)); return -EACCES; } err = check\_buffer\_access(env, reg, regno, off, size, false,@@ -4563,7 +4527,7 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn mark\_reg\_unknown(env, regs, value\_regno); } else { verbose(env, "R%d invalid mem access '%s'\n", regno,- reg\_type\_str[reg->type]);+ reg\_type\_str(env, reg->type)); return -EACCES; } @@ -4630,7 +4594,7 @@ static int check\_atomic(struct bpf\_verifier\_env \*env, int insn\_idx, struct bpf\_i is\_sk\_reg(env, insn->dst\_reg)) { verbose(env, "BPF\_ATOMIC stores into R%d %s is not allowed\n", insn->dst\_reg,- reg\_type\_str[reg\_state(env, insn->dst\_reg)->type]);+ reg\_type\_str(env, reg\_state(env, insn->dst\_reg)->type)); return -EACCES; } @@ -4850,9 +4814,9 @@ static int check\_helper\_mem\_access(struct bpf\_verifier\_env \*env, int regno, register\_is\_null(reg)) return 0; - verbose(env, "R%d type=%s expected=%s\n", regno,- reg\_type\_str[reg->type],- reg\_type\_str[PTR\_TO\_STACK]);+ verbose(env, "R%d type=%s ", regno,+ reg\_type\_str(env, reg->type));+ verbose(env, "expected=%s\n", reg\_type\_str(env, PTR\_TO\_STACK)); return -EACCES; } }@@ -4863,7 +4827,7 @@ int check\_mem\_reg(struct bpf\_verifier\_env \*env, struct bpf\_reg\_state \*reg, if (register\_is\_null(reg)) return 0; - if (reg\_type\_may\_be\_null(reg->type)) {+ if (type\_may\_be\_null(reg->type)) { /\* Assuming that the register contains a value check if the memory \* access is safe. Temporarily save and restore the register's state as \* the conversion shouldn't be visible to a caller.@@ -5197,10 +5161,10 @@ static int check\_reg\_type(struct bpf\_verifier\_env \*env, u32 regno, goto found; } - verbose(env, "R%d type=%s expected=", regno, reg\_type\_str[type]);+ verbose(env, "R%d type=%s expected=", regno, reg\_type\_str(env, type)); for (j = 0; j + 1 < i; j++)- verbose(env, "%s, ", reg\_type\_str[compatible->types[j]]);- verbose(env, "%s\n", reg\_type\_str[compatible->types[j]]);+ verbose(env, "%s, ", reg\_type\_str(env, compatible->types[j]));+ verbose(env, "%s\n", reg\_type\_str(env, compatible->types[j])); return -EACCES;  found:@@ -6474,6 +6438,7 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn { const struct bpf\_func\_proto \*fn = NULL; enum bpf\_return\_type ret\_type;+ enum bpf\_type\_flag ret\_flag; struct bpf\_reg\_state \*regs; struct bpf\_call\_arg\_meta meta; int insn\_idx = \*insn\_idx\_p;@@ -6614,6 +6579,7 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn  /\* update return register (already marked as written above) \*/ ret\_type = fn->ret\_type;+ ret\_flag = type\_flag(fn->ret\_type); if (ret\_type == RET\_INTEGER) { /\* sets type to SCALAR\_VALUE \*/ mark\_reg\_unknown(env, regs, BPF\_REG\_0);@@ -6633,25 +6599,23 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn } regs[BPF\_REG\_0].map\_ptr = meta.map\_ptr; regs[BPF\_REG\_0].map\_uid = meta.map\_uid;- if (type\_may\_be\_null(ret\_type)) {- regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE\_OR\_NULL;- } else {- regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE;- if (map\_value\_has\_spin\_lock(meta.map\_ptr))- regs[BPF\_REG\_0].id = ++env->id\_gen;+ regs[BPF\_REG\_0].type = PTR\_TO\_MAP\_VALUE | ret\_flag;+ if (!type\_may\_be\_null(ret\_type) &&+ map\_value\_has\_spin\_lock(meta.map\_ptr)) {+ regs[BPF\_REG\_0].id = ++env->id\_gen; } } else if (base\_type(ret\_type) == RET\_PTR\_TO\_SOCKET) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = PTR\_TO\_SOCKET\_OR\_NULL;+ regs[BPF\_REG\_0].type = PTR\_TO\_SOCKET | ret\_flag; } else if (base\_type(ret\_type) == RET\_PTR\_TO\_SOCK\_COMMON) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = PTR\_TO\_SOCK\_COMMON\_OR\_NULL;+ regs[BPF\_REG\_0].type = PTR\_TO\_SOCK\_COMMON | ret\_flag; } else if (base\_type(ret\_type) == RET\_PTR\_TO\_TCP\_SOCK) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = PTR\_TO\_TCP\_SOCK\_OR\_NULL;+ regs[BPF\_REG\_0].type = PTR\_TO\_TCP\_SOCK | ret\_flag; } else if (base\_type(ret\_type) == RET\_PTR\_TO\_ALLOC\_MEM) { mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = PTR\_TO\_MEM\_OR\_NULL;+ regs[BPF\_REG\_0].type = PTR\_TO\_MEM | ret\_flag; regs[BPF\_REG\_0].mem\_size = meta.mem\_size; } else if (base\_type(ret\_type) == RET\_PTR\_TO\_MEM\_OR\_BTF\_ID) { const struct btf\_type \*t;@@ -6671,14 +6635,10 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn tname, PTR\_ERR(ret)); return -EINVAL; }- regs[BPF\_REG\_0].type =- (ret\_type & PTR\_MAYBE\_NULL) ?- PTR\_TO\_MEM\_OR\_NULL : PTR\_TO\_MEM;+ regs[BPF\_REG\_0].type = PTR\_TO\_MEM | ret\_flag; regs[BPF\_REG\_0].mem\_size = tsize; } else {- regs[BPF\_REG\_0].type =- (ret\_type & PTR\_MAYBE\_NULL) ?- PTR\_TO\_BTF\_ID\_OR\_NULL : PTR\_TO\_BTF\_ID;+ regs[BPF\_REG\_0].type = PTR\_TO\_BTF\_ID | ret\_flag; regs[BPF\_REG\_0].btf = meta.ret\_btf; regs[BPF\_REG\_0].btf\_id = meta.ret\_btf\_id; }@@ -6686,9 +6646,7 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn int ret\_btf\_id;  mark\_reg\_known\_zero(env, regs, BPF\_REG\_0);- regs[BPF\_REG\_0].type = (ret\_type & PTR\_MAYBE\_NULL) ?- PTR\_TO\_BTF\_ID\_OR\_NULL :- PTR\_TO\_BTF\_ID;+ regs[BPF\_REG\_0].type = PTR\_TO\_BTF\_ID | ret\_flag; ret\_btf\_id = \*fn->ret\_btf\_id; if (ret\_btf\_id == 0) { verbose(env, "invalid return type %u of func %s#%d\n",@@ -6707,7 +6665,7 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn return -EINVAL; } - if (reg\_type\_may\_be\_null(regs[BPF\_REG\_0].type))+ if (type\_may\_be\_null(regs[BPF\_REG\_0].type)) regs[BPF\_REG\_0].id = ++env->id\_gen;  if (is\_ptr\_cast\_function(func\_id)) {@@ -6916,25 +6874,25 @@ static bool check\_reg\_sane\_offset(struct bpf\_verifier\_env \*env,  if (known && (val >= BPF\_MAX\_VAR\_OFF || val <= -BPF\_MAX\_VAR\_OFF)) { verbose(env, "math between %s pointer and %lld is not allowed\n",- reg\_type\_str[type], val);+ reg\_type\_str(env, type), val); return false; }  if (reg->off >= BPF\_MAX\_VAR\_OFF || reg->off <= -BPF\_MAX\_VAR\_OFF) { verbose(env, "%s pointer offset %d is not allowed\n",- reg\_type\_str[type], reg->off);+ reg\_type\_str(env, type), reg->off); return false; }  if (smin == S64\_MIN) { verbose(env, "math between %s pointer and register with unbounded min value is not allowed\n",- reg\_type\_str[type]);+ reg\_type\_str(env, type)); return false; }  if (smin >= BPF\_MAX\_VAR\_OFF || smin <= -BPF\_MAX\_VAR\_OFF) { verbose(env, "value %lld makes %s pointer be out of bounds\n",- smin, reg\_type\_str[type]);+ smin, reg\_type\_str(env, type)); return false; } @@ -7311,11 +7269,13 @@ static int adjust\_ptr\_min\_max\_vals(struct bpf\_verifier\_env \*env, return -EACCES; } - switch (ptr\_reg->type) {- case PTR\_TO\_MAP\_VALUE\_OR\_NULL:+ if (ptr\_reg->type & PTR\_MAYBE\_NULL) { verbose(env, "R%d pointer arithmetic on %s prohibited, null-check it first\n",- dst, reg\_type\_str[ptr\_reg->type]);+ dst, reg\_type\_str(env, ptr\_reg->type)); return -EACCES;+ }++ switch (base\_type(ptr\_reg->type)) { case CONST\_PTR\_TO\_MAP: /\* smin\_val represents the known value \*/ if (known && smin\_val == 0 && opcode == BPF\_ADD)@@ -7323,14 +7283,11 @@ static int adjust\_ptr\_min\_max\_vals(struct bpf\_verifier\_env \*env, fallthrough; case PTR\_TO\_PACKET\_END: case PTR\_TO\_SOCKET:- case PTR\_TO\_SOCKET\_OR\_NULL: case PTR\_TO\_SOCK\_COMMON:- case PTR\_TO\_SOCK\_COMMON\_OR\_NULL: case PTR\_TO\_TCP\_SOCK:- case PTR\_TO\_TCP\_SOCK\_OR\_NULL: case PTR\_TO\_XDP\_SOCK: verbose(env, "R%d pointer arithmetic on %s prohibited\n",- dst, reg\_type\_str[ptr\_reg->type]);+ dst, reg\_type\_str(env, ptr\_reg->type)); return -EACCES; default: break;@@ -9049,7 +9006,7 @@ static void mark\_ptr\_or\_null\_reg(struct bpf\_func\_state \*state, struct bpf\_reg\_state \*reg, u32 id, bool is\_null) {- if (reg\_type\_may\_be\_null(reg->type) && reg->id == id &&+ if (type\_may\_be\_null(reg->type) && reg->id == id && !WARN\_ON\_ONCE(!reg->id)) { /\* Old offset (both fixed and variable parts) should \* have been known-zero, because we don't allow pointer@@ -9427,7 +9384,7 @@ static int check\_cond\_jmp\_op(struct bpf\_verifier\_env \*env, \*/ if (!is\_jmp32 && BPF\_SRC(insn->code) == BPF\_K && insn->imm == 0 && (opcode == BPF\_JEQ || opcode == BPF\_JNE) &&- reg\_type\_may\_be\_null(dst\_reg->type)) {+ type\_may\_be\_null(dst\_reg->type)) { /\* Mark all identical registers in each branch as either \* safe or unknown depending R == 0 or R != 0 conditional. \*/@@ -9681,7 +9638,7 @@ static int check\_return\_code(struct bpf\_verifier\_env \*env) /\* enforce return zero from async callbacks like timer \*/ if (reg->type != SCALAR\_VALUE) { verbose(env, "In async callback the register R0 is not a known value (%s)\n",- reg\_type\_str[reg->type]);+ reg\_type\_str(env, reg->type)); return -EINVAL; } @@ -9695,7 +9652,7 @@ static int check\_return\_code(struct bpf\_verifier\_env \*env) if (is\_subprog) { if (reg->type != SCALAR\_VALUE) { verbose(env, "At subprogram exit the register R0 is not a scalar value (%s)\n",- reg\_type\_str[reg->type]);+ reg\_type\_str(env, reg->type)); return -EINVAL; } return 0;@@ -9759,7 +9716,7 @@ static int check\_return\_code(struct bpf\_verifier\_env \*env)  if (reg->type != SCALAR\_VALUE) { verbose(env, "At program exit the register R0 is not a known value (%s)\n",- reg\_type\_str[reg->type]);+ reg\_type\_str(env, reg->type)); return -EINVAL; } @@ -10616,7 +10573,7 @@ static bool regsafe(struct bpf\_verifier\_env \*env, struct bpf\_reg\_state \*rold, return true; if (rcur->type == NOT\_INIT) return false;- switch (rold->type) {+ switch (base\_type(rold->type)) { case SCALAR\_VALUE: if (env->explore\_alu\_limits) return false;@@ -10638,6 +10595,22 @@ static bool regsafe(struct bpf\_verifier\_env \*env, struct bpf\_reg\_state \*rold, } case PTR\_TO\_MAP\_KEY: case PTR\_TO\_MAP\_VALUE:+ /\* a PTR\_TO\_MAP\_VALUE could be safe to use as a+ \* PTR\_TO\_MAP\_VALUE\_OR\_NULL into the same map.+ \* However, if the old PTR\_TO\_MAP\_VALUE\_OR\_NULL then got NULL-+ \* checked, doing so could have affected others with the same+ \* id, and we can't check for that because we lost the id when+ \* we converted to a PTR\_TO\_MAP\_VALUE.+ \*/+ if (type\_may\_be\_null(rold->type)) {+ if (!type\_may\_be\_null(rcur->type))+ return false;+ if (memcmp(rold, rcur, offsetof(struct bpf\_reg\_state, id)))+ return false;+ /\* Check our ids match any regs they're supposed to \*/+ return check\_ids(rold->id, rcur->id, idmap);+ }+ /\* If the new min/max/var\_off satisfy the old ones and \* everything else matches, we are OK. \* 'id' is not compared, since it's only used for maps with@@ -10649,20 +10622,6 @@ static bool regsafe(struct bpf\_verifier\_env \*env, struct bpf\_reg\_state \*rold, return memcmp(rold, rcur, offsetof(struct bpf\_reg\_state, id)) == 0 && range\_within(rold, rcur) && tnum\_in(rold->var\_off, rcur->var\_off);- case PTR\_TO\_MAP\_VALUE\_OR\_NULL:- /\* a PTR\_TO\_MAP\_VALUE could be safe to use as a- \* PTR\_TO\_MAP\_VALUE\_OR\_NULL into the same map.- \* However, if the old PTR\_TO\_MAP\_VALUE\_OR\_NULL then got NULL-- \* checked, doing so could have affected others with the same- \* id, and we can't check for that because we lost the id when- \* we converted to a PTR\_TO\_MAP\_VALUE.- \*/- if (rcur->type != PTR\_TO\_MAP\_VALUE\_OR\_NULL)- return false;- if (memcmp(rold, rcur, offsetof(struct bpf\_reg\_state, id)))- return false;- /\* Check our ids match any regs they're supposed to \*/- return check\_ids(rold->id, rcur->id, idmap); case PTR\_TO\_PACKET\_META: case PTR\_TO\_PACKET: if (rcur->type != rold->type)@@ -10691,11 +10650,8 @@ static bool regsafe(struct bpf\_verifier\_env \*env, struct bpf\_reg\_state \*rold, case PTR\_TO\_PACKET\_END: case PTR\_TO\_FLOW\_KEYS: case PTR\_TO\_SOCKET:- case PTR\_TO\_SOCKET\_OR\_NULL: case PTR\_TO\_SOCK\_COMMON:- case PTR\_TO\_SOCK\_COMMON\_OR\_NULL: case PTR\_TO\_TCP\_SOCK:- case PTR\_TO\_TCP\_SOCK\_OR\_NULL: case PTR\_TO\_XDP\_SOCK: /\* Only valid matches are exact, which memcmp() above \* would have accepted@@ -11221,17 +11177,13 @@ next: /\* Return true if it's OK to have the same insn return a different type. \*/ static bool reg\_type\_mismatch\_ok(enum bpf\_reg\_type type) {- switch (type) {+ switch (base\_type(type)) { case PTR\_TO\_CTX: case PTR\_TO\_SOCKET:- case PTR\_TO\_SOCKET\_OR\_NULL: case PTR\_TO\_SOCK\_COMMON:- case PTR\_TO\_SOCK\_COMMON\_OR\_NULL: case PTR\_TO\_TCP\_SOCK:- case PTR\_TO\_TCP\_SOCK\_OR\_NULL: case PTR\_TO\_XDP\_SOCK: case PTR\_TO\_BTF\_ID:- case PTR\_TO\_BTF\_ID\_OR\_NULL: return false; default: return true;@@ -11457,7 +11409,7 @@ static int do\_check(struct bpf\_verifier\_env \*env) if (is\_ctx\_reg(env, insn->dst\_reg)) { verbose(env, "BPF\_ST stores into R%d %s is not allowed\n", insn->dst\_reg,- reg\_type\_str[reg\_state(env, insn->dst\_reg)->type]);+ reg\_type\_str(env, reg\_state(env, insn->dst\_reg)->type)); return -EACCES; } diff --git a/net/core/bpf\_sk\_storage.c b/net/core/bpf\_sk\_storage.cindex 68d2cbf8331ac5..4cb5ef8eddbc4c 100644--- a/[net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/bpf_sk_storage.c?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[net/core/bpf\_sk\_storage.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/bpf_sk_storage.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -929,7 +929,7 @@ static struct bpf\_iter\_reg bpf\_sk\_storage\_map\_reg\_info = { { offsetof(struct bpf\_iter\_\_bpf\_sk\_storage\_map, sk), PTR\_TO\_BTF\_ID\_OR\_NULL }, { offsetof(struct bpf\_iter\_\_bpf\_sk\_storage\_map, value),- PTR\_TO\_RDWR\_BUF\_OR\_NULL },+ PTR\_TO\_RDWR\_BUF | PTR\_MAYBE\_NULL }, }, .seq\_info = &iter\_seq\_info, };diff --git a/net/core/sock\_map.c b/net/core/sock\_map.cindex 4ca4b11f4e5ffd..96d4ea7e6918e9 100644--- a/[net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/sock_map.c?id=3c4807322660d4290ac9062c034aed6b87243861)+++ b/[net/core/sock\_map.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/core/sock_map.c?id=c25b2ae136039ffa820c26138ed4a5e5f3ab3841)@@ -1564,7 +1564,7 @@ static struct bpf\_iter\_reg sock\_map\_iter\_reg = { .ctx\_arg\_info\_size = 2, .ctx\_arg\_info = { { offsetof(struct bpf\_iter\_\_sockmap, key),- PTR\_TO\_RDONLY\_BUF\_OR\_NULL },+ PTR\_TO\_RDONLY\_BUF | PTR\_MAYBE\_NULL }, { offsetof(struct bpf\_iter\_\_sockmap, sk), PTR\_TO\_BTF\_ID\_OR\_NULL }, }, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:51 +0000



=== Content from git.kernel.org_81844507_20250108_114913.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:50 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 13:27:41 -0800 |
| commit | [34d3a78c681e8e7844b43d1a2f4671a04249c821](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)) | |
| tree | [d0a60ddfc12cc916d80923b04d80f01ae69c1301](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821) | |
| parent | [cf9f2f8d62eca810afbd1ee6cc0800202b000e57](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821&id2=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)) | |
| download | [linux-34d3a78c681e8e7844b43d1a2f4671a04249c821.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-34d3a78c681e8e7844b43d1a2f4671a04249c821.tar.gz) | |

bpf: Make per\_cpu\_ptr return rdonly PTR\_TO\_MEM.Tag the return type of {per, this}\_cpu\_ptr with RDONLY\_MEM. The
returned value of this pair of helpers is kernel object, which
can not be updated by bpf programs. Previously these two helpers
return PTR\_OT\_MEM for kernel objects of scalar type, which allows
one to directly modify the memory. Now with RDONLY\_MEM tagging,
the verifier will reject programs that write into RDONLY\_MEM.
Fixes: 63d9b80dcf2c ("bpf: Introducte bpf\_this\_cpu\_ptr()")
Fixes: eaa6bcb71ef6 ("bpf: Introduce bpf\_per\_cpu\_ptr()")
Fixes: 4976b718c355 ("bpf: Introduce pseudo\_btf\_id")
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-8-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-8-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)

| -rw-r--r-- | [kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/helpers.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821) | 30 | |  |  |  | | --- | --- | --- | |

2 files changed, 28 insertions, 6 deletions

| diff --git a/kernel/bpf/helpers.c b/kernel/bpf/helpers.cindex c49dc5cbe0a7b2..6a65e2a62b015b 100644--- a/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)+++ b/[kernel/bpf/helpers.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/helpers.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)@@ -682,7 +682,7 @@ BPF\_CALL\_2(bpf\_per\_cpu\_ptr, const void \*, ptr, u32, cpu) const struct bpf\_func\_proto bpf\_per\_cpu\_ptr\_proto = { .func = bpf\_per\_cpu\_ptr, .gpl\_only = false,- .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID | PTR\_MAYBE\_NULL,+ .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID | PTR\_MAYBE\_NULL | MEM\_RDONLY, .arg1\_type = ARG\_PTR\_TO\_PERCPU\_BTF\_ID, .arg2\_type = ARG\_ANYTHING, };@@ -695,7 +695,7 @@ BPF\_CALL\_1(bpf\_this\_cpu\_ptr, const void \*, percpu\_ptr) const struct bpf\_func\_proto bpf\_this\_cpu\_ptr\_proto = { .func = bpf\_this\_cpu\_ptr, .gpl\_only = false,- .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID,+ .ret\_type = RET\_PTR\_TO\_MEM\_OR\_BTF\_ID | MEM\_RDONLY, .arg1\_type = ARG\_PTR\_TO\_PERCPU\_BTF\_ID, }; diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 9073337ac66fcd..f49b3d334f4e5b 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=34d3a78c681e8e7844b43d1a2f4671a04249c821)@@ -4399,15 +4399,30 @@ static int check\_mem\_access(struct bpf\_verifier\_env \*env, int insn\_idx, u32 regn mark\_reg\_unknown(env, regs, value\_regno); } }- } else if (reg->type == PTR\_TO\_MEM) {+ } else if (base\_type(reg->type) == PTR\_TO\_MEM) {+ bool rdonly\_mem = type\_is\_rdonly\_mem(reg->type);++ if (type\_may\_be\_null(reg->type)) {+ verbose(env, "R%d invalid mem access '%s'\n", regno,+ reg\_type\_str(env, reg->type));+ return -EACCES;+ }++ if (t == BPF\_WRITE && rdonly\_mem) {+ verbose(env, "R%d cannot write into %s\n",+ regno, reg\_type\_str(env, reg->type));+ return -EACCES;+ }+ if (t == BPF\_WRITE && value\_regno >= 0 && is\_pointer\_value(env, value\_regno)) { verbose(env, "R%d leaks addr into mem\n", value\_regno); return -EACCES; }+ err = check\_mem\_region\_access(env, regno, off, size, reg->mem\_size, false);- if (!err && t == BPF\_READ && value\_regno >= 0)+ if (!err && value\_regno >= 0 && (t == BPF\_READ || rdonly\_mem)) mark\_reg\_unknown(env, regs, value\_regno); } else if (reg->type == PTR\_TO\_CTX) { enum bpf\_reg\_type reg\_type = SCALAR\_VALUE;@@ -6654,6 +6669,13 @@ static int check\_helper\_call(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn regs[BPF\_REG\_0].type = PTR\_TO\_MEM | ret\_flag; regs[BPF\_REG\_0].mem\_size = tsize; } else {+ /\* MEM\_RDONLY may be carried from ret\_flag, but it+ \* doesn't apply on PTR\_TO\_BTF\_ID. Fold it, otherwise+ \* it will confuse the check of PTR\_TO\_BTF\_ID in+ \* check\_mem\_access().+ \*/+ ret\_flag &= ~MEM\_RDONLY;+ regs[BPF\_REG\_0].type = PTR\_TO\_BTF\_ID | ret\_flag; regs[BPF\_REG\_0].btf = meta.ret\_btf; regs[BPF\_REG\_0].btf\_id = meta.ret\_btf\_id;@@ -9455,7 +9477,7 @@ static int check\_ld\_imm(struct bpf\_verifier\_env \*env, struct bpf\_insn \*insn) mark\_reg\_known\_zero(env, regs, insn->dst\_reg);  dst\_reg->type = aux->btf\_var.reg\_type;- switch (dst\_reg->type) {+ switch (base\_type(dst\_reg->type)) { case PTR\_TO\_MEM: dst\_reg->mem\_size = aux->btf\_var.mem\_size; break;@@ -11678,7 +11700,7 @@ static int check\_pseudo\_btf\_id(struct bpf\_verifier\_env \*env, err = -EINVAL; goto err\_put; }- aux->btf\_var.reg\_type = PTR\_TO\_MEM;+ aux->btf\_var.reg\_type = PTR\_TO\_MEM | MEM\_RDONLY; aux->btf\_var.mem\_size = tsize; } else { aux->btf\_var.reg\_type = PTR\_TO\_BTF\_ID; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:50 +0000



=== Content from git.kernel.org_9af4cf3b_20250108_114914.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hao Luo <haoluo@google.com> | 2021-12-16 16:31:49 -0800 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2021-12-18 13:27:41 -0800 |
| commit | [cf9f2f8d62eca810afbd1ee6cc0800202b000e57](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)) | |
| tree | [a0c62f903c10857e4bb6e0bbc1d2d77641b5b469](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) | |
| parent | [20b2aff4bc15bda809f994761d5719827d66c0b4](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=20b2aff4bc15bda809f994761d5719827d66c0b4) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57&id2=20b2aff4bc15bda809f994761d5719827d66c0b4)) | |
| download | [linux-cf9f2f8d62eca810afbd1ee6cc0800202b000e57.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-cf9f2f8d62eca810afbd1ee6cc0800202b000e57.tar.gz) | |

bpf: Convert PTR\_TO\_MEM\_OR\_NULL to composable types.Remove PTR\_TO\_MEM\_OR\_NULL and replace it with PTR\_TO\_MEM combined with
flag PTR\_MAYBE\_NULL.
Signed-off-by: Hao Luo <haoluo@google.com>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Link: [https://lore.kernel.org/bpf/20211217003152.48334-7-haoluo@google.com](https://lore.kernel.org/bpf/20211217003152.48334-7-haoluo%40google.com)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)

| -rw-r--r-- | [include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/bpf.h?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/btf.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/bpf/verifier.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57) | 2 | |  |  |  | | --- | --- | --- | |

3 files changed, 2 insertions, 3 deletions

| diff --git a/include/linux/bpf.h b/include/linux/bpf.hindex 126048110bdbde..567d83bf28f90b 100644--- a/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=20b2aff4bc15bda809f994761d5719827d66c0b4)+++ b/[include/linux/bpf.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/bpf.h?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)@@ -506,7 +506,6 @@ enum bpf\_reg\_type { PTR\_TO\_SOCK\_COMMON\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_SOCK\_COMMON, PTR\_TO\_TCP\_SOCK\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_TCP\_SOCK, PTR\_TO\_BTF\_ID\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_BTF\_ID,- PTR\_TO\_MEM\_OR\_NULL = PTR\_MAYBE\_NULL | PTR\_TO\_MEM,  /\* This must be the last entry. Its purpose is to ensure the enum is \* wide enough to hold the higher bits reserved for bpf\_type\_flag.diff --git a/kernel/bpf/btf.c b/kernel/bpf/btf.cindex d1447b075c736c..d948b5be3bb846 100644--- a/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)+++ b/[kernel/bpf/btf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/btf.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)@@ -5859,7 +5859,7 @@ int btf\_prepare\_func\_args(struct bpf\_verifier\_env \*env, int subprog, return -EINVAL; } - reg->type = PTR\_TO\_MEM\_OR\_NULL;+ reg->type = PTR\_TO\_MEM | PTR\_MAYBE\_NULL; reg->id = ++env->id\_gen;  continue;diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex e0a8a55ea3df99..9073337ac66fcd 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=20b2aff4bc15bda809f994761d5719827d66c0b4)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/bpf/verifier.c?id=cf9f2f8d62eca810afbd1ee6cc0800202b000e57)@@ -13578,7 +13578,7 @@ static int do\_check\_common(struct bpf\_verifier\_env \*env, int subprog) mark\_reg\_known\_zero(env, regs, i); else if (regs[i].type == SCALAR\_VALUE) mark\_reg\_unknown(env, regs, i);- else if (regs[i].type == PTR\_TO\_MEM\_OR\_NULL) {+ else if (base\_type(regs[i].type) == PTR\_TO\_MEM) { const u32 mem\_size = regs[i].mem\_size;  mark\_reg\_known\_zero(env, regs, i); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 11:47:51 +0000


