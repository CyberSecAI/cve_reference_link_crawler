=== Content from plugins.trac.wordpress.org_7194e836_20250110_144018.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3059375%2540wooshark-aliexpress-importer%26old%3D3059375%2540wooshark-aliexpress-importer)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3043739/wooshark-aliexpress-importer "Changeset 3043739 for wooshark-aliexpress-importer")
* [Next Change](/changeset/3059376/wooshark-aliexpress-importer "Changeset 3059376 for wooshark-aliexpress-importer") →

---

# Changeset [3059375](/changeset/3059375 "Show full changeset") for [wooshark-aliexpress-importer](/browser/wooshark-aliexpress-importer?rev=3059375 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
03/26/2024 11:12:45 PM
([10 months](/timeline?from=2024-03-26T23%3A12%3A45Z&precision=second "See timeline at 03/26/2024 11:12:45 PM") ago)

Author:
djamio1988
Message:

fix security issue & upload new version

Location:
[wooshark-aliexpress-importer](/browser/wooshark-aliexpress-importer?rev=3059375)
Files:

47 added
5 edited

* [tags/2.2.5](/browser/wooshark-aliexpress-importer/tags/2.2.5?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_InstallIndicator.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_InstallIndicator.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_LifeCycle.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_OptionsManager.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_OptionsManager.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_Plugin.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_Plugin.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_ShortCodeLoader.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_ShortCodeLoader.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/WoosharkAliexpressImporter\_ShortCodeScriptLoader.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/WoosharkAliexpressImporter_ShortCodeScriptLoader.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/aliexpress-custom.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/aliexpress-custom.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/bootstrap.min.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/bootstrap.min.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/configuration-custom.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/configuration-custom.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/extension-custom.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/extension-custom.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/font-awesome.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/font-awesome.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/jquery.toast.min.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/jquery.toast.min.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/main.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/main.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/mdb.min.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/mdb.min.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/products-custom.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/products-custom.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/css/quill.css](/browser/wooshark-aliexpress-importer/tags/2.2.5/css/quill.css?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/images](/browser/wooshark-aliexpress-importer/tags/2.2.5/images?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/images/chrome-extension-logo.png](/browser/wooshark-aliexpress-importer/tags/2.2.5/images/chrome-extension-logo.png?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/images/theshark\_27x27.png](/browser/wooshark-aliexpress-importer/tags/2.2.5/images/theshark_27x27.png?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/images/wooshark.png](/browser/wooshark-aliexpress-importer/tags/2.2.5/images/wooshark.png?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/images/wooshark\_1\_27x27.png](/browser/wooshark-aliexpress-importer/tags/2.2.5/images/wooshark_1_27x27.png?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/OriginalProductUrl.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/OriginalProductUrl.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/aliexpress.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/aliexpress.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/bootstrap.min.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/bootstrap.min.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/configuration.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/configuration.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/font-aesome.min.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/font-aesome.min.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/jquery.toast.min.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/jquery.toast.min.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/math.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/math.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/originalPro.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/originalPro.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/products.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/products.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/js/quill.js](/browser/wooshark-aliexpress-importer/tags/2.2.5/js/quill.js?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/languages](/browser/wooshark-aliexpress-importer/tags/2.2.5/languages?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/lib](/browser/wooshark-aliexpress-importer/tags/2.2.5/lib?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/lib/simple\_html\_dom.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/lib/simple_html_dom.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/readme.txt](/browser/wooshark-aliexpress-importer/tags/2.2.5/readme.txt?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/setting.txt](/browser/wooshark-aliexpress-importer/tags/2.2.5/setting.txt?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/templates](/browser/wooshark-aliexpress-importer/tags/2.2.5/templates?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/templates/aliexpress-product-template.html](/browser/wooshark-aliexpress-importer/tags/2.2.5/templates/aliexpress-product-template.html?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/templates/configuration-template.html](/browser/wooshark-aliexpress-importer/tags/2.2.5/templates/configuration-template.html?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/templates/extension-template.html](/browser/wooshark-aliexpress-importer/tags/2.2.5/templates/extension-template.html?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/templates/product-template.html](/browser/wooshark-aliexpress-importer/tags/2.2.5/templates/product-template.html?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/test.txt](/browser/wooshark-aliexpress-importer/tags/2.2.5/test.txt?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/wooshark-aliexpress-importer.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/wooshark-aliexpress-importer.php?rev=3059375 "Show entry in browser")
  (added)
* [tags/2.2.5/wooshark-aliexpress-importer\_init.php](/browser/wooshark-aliexpress-importer/tags/2.2.5/wooshark-aliexpress-importer_init.php?rev=3059375 "Show entry in browser")
  (added)
* [trunk/WoosharkAliexpressImporter\_LifeCycle.php](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375 "Show entry in browser")
  (modified)
  ([5 diffs](#file47 "Show differences"))
* [trunk/WoosharkAliexpressImporter\_OptionsManager.php](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php?rev=3059375 "Show entry in browser")
  (modified)
  ([2 diffs](#file48 "Show differences"))
* [trunk/WoosharkAliexpressImporter\_Plugin.php](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_Plugin.php?rev=3059375 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [trunk/wooshark-aliexpress-importer.php](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php?rev=3059375 "Show entry in browser")
  (modified)
  ([1 diff](#file50 "Show differences"))
* [trunk/wooshark-aliexpress-importer\_init.php](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375 "Show entry in browser")
  (modified)
  ([29 diffs](#file51 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter\_LifeCycle.php](/changeset/3059375/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php "Show the changeset 3059375 restricted to wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php")

  | [r2334487](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=2334487#L115 "Show revision 2334487 of this file in browser") | [r3059375](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375#L115 "Show revision 3059375 of this file in browser") |  |
  | --- | --- | --- |
  | 115 | 115 | } |
  | 116 | 116 |  |
  | 117 |  | /\*\* |
  | 118 |  | \* Puts the configuration page in the Plugins menu by default. |
  | 119 |  | \* Override to put it elsewhere or create a set of submenus |
  | 120 |  | \* Override with an empty implementation if you don't want a configuration page |
  | 121 |  | \* @return void |
  | 122 |  | \*/ |
  | 123 |  | public function addSettingsSubMenuPage() { |
  |  | 117 |  |
  |  | 118 |  |
  |  | 119 |  |
  |  | 120 |  |
  |  | 121 |  |
  |  | 122 |  |
  |  | 123 |  |
  |  | 124 |  |
  |  | 125 | public function addSettingsSubMenuPage() |
  |  | 126 | { |
  | 124 | 127 | $this->addSettingsSubMenuPageToPluginsMenu(); |
  | 125 | 128 | //$this->addSettingsSubMenuPageToSettingsMenu(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=2334487#L127) | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375#L130) |  |
  | 127 | 130 |  |
  | 128 | 131 |  |
  | 129 |  | protected function requireExtraPluginFiles() { |
  |  | 132 | protected function requireExtraPluginFiles() |
  |  | 133 | { |
  | 130 | 134 | require\_once(ABSPATH . 'wp-includes/pluggable.php'); |
  | 131 | 135 | require\_once(ABSPATH . 'wp-admin/includes/plugin.php'); |
  | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=2334487#L136) | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375#L140) |  |
  | 136 | 140 | \* (i.e. the page for setting options) |
  | 137 | 141 | \*/ |
  | 138 |  | protected function getSettingsSlug() { |
  |  | 142 | protected function getSettingsSlug() |
  |  | 143 | { |
  | 139 | 144 | return get\_class($this) . 'Settings'; |
  | 140 | 145 | } |
  | 141 |  |  |
  | 142 |  | ~~protected function addSettingsSubMenuPageToPluginsMenu()~~ { |
  |  | 146 | protected function addSettingsSubMenuPageToPluginsMenu() |
  |  | 147 | { |
  | 143 | 148 | $this->requireExtraPluginFiles(); |
  | 144 | 149 | $displayName = $this->getPluginDisplayName(); |
  |  | 150 |  |
  |  | 151 | $parentSlug = $this->getSettingsSlug(); // Get the slug of the parent menu |
  |  | 152 |  |
  | 145 | 153 | add\_menu\_page( |
  | 146 |  | $displayName, |
  | 147 |  | $displayName, |
  | 148 |  | 'manage\_options', |
  | 149 |  | $this->getSettingsSlug(), |
  | 150 |  | array(&$this, 'settingsPage'), |
  | 151 |  | plugin\_dir\_url(\_\_FILE\_\_) . 'images/wooshark\_1\_27x27.png'); |
  | 152 |  | } |
  | 153 |  |  |
  | 154 |  |  |
  | 155 |  | protected function addSettingsSubMenuPageToSettingsMenu() { |
  | 156 |  | $this->requireExtraPluginFiles(); |
  | 157 |  | $displayName = $this->getPluginDisplayName(); |
  | 158 |  | add\_options\_page($displayName, |
  | 159 |  | $displayName, |
  | 160 |  | 'manage\_options', |
  | 161 |  | $this->getSettingsSlug(), |
  | 162 |  | array(&$this, 'settingsPage')); |
  |  | 154 | $displayName, |
  |  | 155 | $displayName, |
  |  | 156 | 'manage\_options', |
  |  | 157 | $parentSlug, // Use the parent slug as the parent menu |
  |  | 158 | array(&$this, 'submenuPageCallback'), |
  |  | 159 | plugin\_dir\_url(\_\_FILE\_\_) . 'images/wooshark\_1\_27x27.png' |
  |  | 160 | ); |
  |  | 161 |  |
  |  | 162 | // Add a submenu under the parent menu |
  |  | 163 |  |
  |  | 164 |  |
  |  | 165 |  |
  |  | 166 |  |
  |  | 167 | add\_submenu\_page( |
  |  | 168 | $parentSlug, // Use the parent slug |
  |  | 169 | 'AliExpress Import', // Replace with your submenu title |
  |  | 170 | 'AliExpress Import', // Replace with your submenu title |
  |  | 171 | 'manage\_options', // Capability required to access the submenu |
  |  | 172 | 'aliexpress-slug', // Replace with your submenu slug |
  |  | 173 | array(&$this, 'submenuAliExpressCallback') // Callback function for the submenu page |
  |  | 174 | ); |
  |  | 175 |  |
  |  | 176 |  |
  |  | 177 |  |
  |  | 178 |  |
  |  | 179 |  |
  |  | 180 |  |
  |  | 181 |  |
  |  | 182 | add\_submenu\_page( |
  |  | 183 | $parentSlug, // Use the parent slug |
  |  | 184 | 'Products', // Replace with your submenu title |
  |  | 185 | 'Products', // Replace with your submenu title |
  |  | 186 | 'manage\_options', // Capability required to access the submenu |
  |  | 187 | 'products-slug', // Replace with your submenu slug |
  |  | 188 | array(&$this, 'submenuPageCallback') // Callback function for the submenu page |
  |  | 189 | ); |
  |  | 190 |  |
  |  | 191 |  |
  |  | 192 | add\_submenu\_page( |
  |  | 193 | $parentSlug, // Use the parent slug |
  |  | 194 | 'Configuration', // Replace with your submenu title |
  |  | 195 | 'Configuration', // Replace with your submenu title |
  |  | 196 | 'manage\_options', // Capability required to access the submenu |
  |  | 197 | 'Configuration-slug', // Replace with your submenu slug |
  |  | 198 | array(&$this, 'submenuConfigurationPageCallback') // Callback function for the submenu page |
  |  | 199 | ); |
  |  | 200 |  |
  |  | 201 | add\_submenu\_page( |
  |  | 202 | $parentSlug, // Use the parent slug |
  |  | 203 | 'Chrome extension', // Replace with your submenu title |
  |  | 204 | 'Chrome extension',  // Replace with your submenu title |
  |  | 205 | 'manage\_options', // Capability required to access the submenu |
  |  | 206 | 'extension-slug', // Replace with your submenu slug |
  |  | 207 | array(&$this, 'chromeExtensionCallbackPage') // Callback function for the submenu page |
  |  | 208 | ); |
  |  | 209 | update\_option('plugin\_license\_activated', false); |
  |  | 210 |  |
  |  | 211 |  |
  |  | 212 |  |
  |  | 213 | $isPremuim = false; |
  |  | 214 | if ($isPremuim) { |
  |  | 215 | add\_submenu\_page( |
  |  | 216 | $parentSlug, // Use the parent slug |
  |  | 217 | 'License Activation', // Replace with your submenu title |
  |  | 218 | 'License Activation', // Replace with your submenu title |
  |  | 219 | 'manage\_options', // Capability required to access the submenu |
  |  | 220 | 'license-activation-slug', // Replace with your submenu slug |
  |  | 221 | array(&$this, 'submenuLicenseActivationCallback') // Callback function for the submenu page |
  |  | 222 | ); |
  |  | 223 | } else { |
  |  | 224 | update\_option('plugin\_license\_activated', true); |
  |  | 225 |  |
  |  | 226 | add\_submenu\_page( |
  |  | 227 | $parentSlug, // Use the parent slug |
  |  | 228 | 'Go Pro', // page title |
  |  | 229 | 'Go Pro', // menu title |
  |  | 230 | 'manage\_options', // capability |
  |  | 231 | 'sharkdropship-go-pro', // menu slug |
  |  | 232 |  |
  |  | 233 | array(&$this, 'my\_plugin\_go\_pro\_page\_callback') // Callback function for the submenu page |
  |  | 234 |  |
  |  | 235 | ); |
  |  | 236 | } |
  |  | 237 | } |
  |  | 238 |  |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 | function my\_plugin\_go\_pro\_page\_callback() |
  |  | 242 | { |
  |  | 243 | ?> |
  |  | 244 | <div class="wrap"> |
  |  | 245 | <h1>Go Pro</h1> |
  |  | 246 | <p>Unlock more features with our Pro plan!</p> |
  |  | 247 | <div class="feature-cards"> |
  |  | 248 | <div class="card"> |
  |  | 249 | <h3>Chrome extension</h3> |
  |  | 250 | <p>Direct import from supplier website</p> |
  |  | 251 | </div> |
  |  | 252 |  |
  |  | 253 | <div class="card"> |
  |  | 254 | <h3>Continious Updates and support</h3> |
  |  | 255 | <p>Many New features are ongoing </p> |
  |  | 256 | </div> |
  |  | 257 |  |
  |  | 258 | <div class="card"> |
  |  | 259 | <h3>Import All Product Details</h3> |
  |  | 260 | <p>Comprehensive import options for every product detail.</p> |
  |  | 261 | </div> |
  |  | 262 | <div class="card"> |
  |  | 263 | <h3>1000 Product/supplier Imports per Day</h3> |
  |  | 264 | <p>Easily import up to 1000 products daily.</p> |
  |  | 265 | </div> |
  |  | 266 | <div class="card"> |
  |  | 267 | <h3>1000/supplier Product Updates per Day</h3> |
  |  | 268 | <p>Keep your product catalog up-to-date with daily updates.</p> |
  |  | 269 | </div> |
  |  | 270 |  |
  |  | 271 | <!-- Add more cards for other features --> |
  |  | 272 | </div> |
  |  | 273 | <a style="margin-top: 20px;" href="https://sharkdropship.com/wooshark-dropshipping/" target="\_blank" class="button button-primary">Upgrade Now</a> |
  |  | 274 | </div> |
  |  | 275 | <style> |
  |  | 276 | .feature-cards { |
  |  | 277 | display: flex; |
  |  | 278 | flex-wrap: wrap; |
  |  | 279 | gap: 20px; |
  |  | 280 | } |
  |  | 281 |  |
  |  | 282 | .card { |
  |  | 283 | flex-basis: calc(33% - 20px); |
  |  | 284 | border: 1px solid #ddd; |
  |  | 285 | padding: 20px; |
  |  | 286 | box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); |
  |  | 287 | } |
  |  | 288 |  |
  |  | 289 | .card h3 { |
  |  | 290 | margin-top: 0; |
  |  | 291 | } |
  |  | 292 | </style> |
  |  | 293 | <?php |
  |  | 294 | } |
  |  | 295 |  |
  |  | 296 |  |
  |  | 297 |  |
  |  | 298 |  |
  |  | 299 | public function submenuLicenseActivationCallback() |
  |  | 300 | { |
  |  | 301 | if ($\_SERVER['REQUEST\_METHOD'] === 'POST' && isset($\_POST['activate\_license'])) { |
  |  | 302 | $license\_key = sanitize\_text\_field($\_POST['license\_key']); |
  |  | 303 |  |
  |  | 304 | // Send a request to your backend server for license validation |
  |  | 305 | $validation\_result = $this->validateLicense($license\_key); |
  |  | 306 |  |
  |  | 307 | if ($validation\_result === true) { |
  |  | 308 | // License is valid, store activation status |
  |  | 309 | update\_option('plugin\_license\_activated', true); |
  |  | 310 | echo '<p style="color:green">License activated successfully!</p>'; |
  |  | 311 | } else { |
  |  | 312 | update\_option('plugin\_license\_activated', false); |
  |  | 313 | // License is not valid, display an error message |
  |  | 314 | echo '<p style="color:red">License activation failed. Please check your license key.</p>'; |
  |  | 315 | } |
  |  | 316 | } |
  |  | 317 |  |
  |  | 318 | // Display the license activation form |
  |  | 319 | ?> |
  |  | 320 | <div class="wrap"> |
  |  | 321 | <h2>License Activation</h2> |
  |  | 322 | <form method="post"> |
  |  | 323 | <label for="license\_key">Enter your license key:</label> |
  |  | 324 | <input type="text" id="license\_key" name="license\_key" required> |
  |  | 325 | <input type="submit" name="activate\_license" value="Activate License"> |
  |  | 326 | </form> |
  |  | 327 | </div> |
  |  | 328 | <?php |
  |  | 329 | } |
  |  | 330 |  |
  |  | 331 |  |
  |  | 332 | public function validateLicense($license\_key) |
  |  | 333 | { |
  |  | 334 | $url = 'https://wooshark.website:8002/getActiveHostAliexpressEbayAmazon'; |
  |  | 335 | $website = get\_site\_url(); // Get the current website's URL |
  |  | 336 | $activation\_code = $license\_key; |
  |  | 337 |  |
  |  | 338 | // Prepare the request body data |
  |  | 339 | $request\_data = array( |
  |  | 340 | 'clientWebsite' => $website, |
  |  | 341 | 'activationCode' => $activation\_code, |
  |  | 342 | ); |
  |  | 343 |  |
  |  | 344 | $response = wp\_remote\_post( |
  |  | 345 | $url, |
  |  | 346 | array( |
  |  | 347 | 'body' => json\_encode($request\_data), // Convert data to JSON format |
  |  | 348 | 'headers' => array('Content-Type' => 'application/json'), |
  |  | 349 | ) |
  |  | 350 | ); |
  |  | 351 |  |
  |  | 352 | if (is\_wp\_error($response)) { |
  |  | 353 | // Handle the error, e.g., log it or return an error message |
  |  | 354 | return false; |
  |  | 355 | } |
  |  | 356 |  |
  |  | 357 | // Check the HTTP response status code |
  |  | 358 | $response\_code = wp\_remote\_retrieve\_response\_code($response); |
  |  | 359 |  |
  |  | 360 | if ($response\_code === 200) { |
  |  | 361 | // License is valid |
  |  | 362 | return true; |
  |  | 363 | } else { |
  |  | 364 | // License is not valid |
  |  | 365 | return false; |
  |  | 366 | } |
  |  | 367 | } |
  |  | 368 |  |
  |  | 369 |  |
  |  | 370 |  |
  |  | 371 |  |
  |  | 372 | public function settingMenu() |
  |  | 373 | { |
  |  | 374 |  |
  |  | 375 | // $html\_file\_path = plugin\_dir\_path(\_\_FILE\_\_) . 'templates/product-template.html'; |
  |  | 376 |  |
  |  | 377 |  |
  |  | 378 | // if (file\_exists($html\_file\_path)) { |
  |  | 379 | //     include $html\_file\_path; |
  |  | 380 | // } else { |
  |  | 381 | //     echo 'HTML file not found.'; |
  |  | 382 | // } |
  |  | 383 |  |
  |  | 384 | // wp\_enqueue\_style('products-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/products-custom.css'); // Replace 'custom.css' with your CSS file name |
  |  | 385 |  |
  |  | 386 | // wp\_enqueue\_script('products', plugin\_dir\_url(\_\_FILE\_\_) . 'js/products.js', array('jquery'), NULL, false); |
  |  | 387 | // // wp\_enqueue\_script('startup', plugin\_dir\_url(\_\_FILE\_\_) . 'js/startup.js', array('jquery'), NULL, false); |
  |  | 388 | // // wp\_enqueue\_script('ebay', plugin\_dir\_url(\_\_FILE\_\_) . 'js/ebay-import.js', array('jquery'), NULL, false); |
  |  | 389 | // wp\_enqueue\_script('toast', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jquery.toast.min.js', array('jquery'), NULL, false); |
  |  | 390 | // wp\_enqueue\_script('bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . 'js/bootstrap.min.js', array('jquery'), NULL, false); |
  |  | 391 | // wp\_enqueue\_style('toastCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/jquery.toast.min.css'); |
  |  | 392 | // wp\_enqueue\_style('customcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/main.css'); |
  |  | 393 | // wp\_enqueue\_style('bootstrapCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/bootstrap.min.css'); |
  |  | 394 | // wp\_enqueue\_script('quill', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quill.js', array('jquery'), NULL, false); |
  |  | 395 | // wp\_enqueue\_style('quillCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quill.css'); |
  |  | 396 | // wp\_enqueue\_script('math', plugin\_dir\_url(\_\_FILE\_\_) . 'js/math.js', array('jquery'), NULL, false); |
  |  | 397 | // wp\_enqueue\_style('awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/font-awesome.css'); |
  |  | 398 | // wp\_enqueue\_style('mdbcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/mdb.min.css'); |
  |  | 399 | // wp\_enqueue\_script('fontawJs', plugin\_dir\_url(\_\_FILE\_\_) . 'js/font-aesome.min.js', array('jquery'), NULL, false); |
  |  | 400 |  |
  |  | 401 | // wp\_localize\_script( |
  |  | 402 | //     'products', |
  |  | 403 | //     'wooshark\_params', |
  |  | 404 | //     array( |
  |  | 405 | //         'ajaxurl' => admin\_url('admin-ajax.php'), |
  |  | 406 | //         'nonce' => wp\_create\_nonce('ajax-nonce') |
  |  | 407 | //     ) |
  |  | 408 | // ); |
  |  | 409 |  |
  |  | 410 | // wp\_enqueue\_script('my-submenu-script', plugins\_url('/js/my-submenu-script.js', \_\_FILE\_\_)); |
  |  | 411 |  |
  |  | 412 |  |
  |  | 413 | } |
  |  | 414 |  |
  |  | 415 |  |
  |  | 416 |  |
  |  | 417 |  |
  |  | 418 |  |
  |  | 419 |  |
  |  | 420 | public function chromeExtensionCallbackPage() |
  |  | 421 | { |
  |  | 422 | // Enqueue necessary scripts and styles |
  |  | 423 | wp\_enqueue\_script('extension', plugin\_dir\_url(\_\_FILE\_\_) . 'js/extension.js', array('jquery'), NULL, false); |
  |  | 424 | wp\_enqueue\_style('extension-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/extension-custom.css'); // Replace 'custom.css' with your CSS file name |
  |  | 425 |  |
  |  | 426 | // Fetch reference ID from the WordPress options |
  |  | 427 | $reference\_id = get\_option('my\_plugin\_reference\_id', ''); |
  |  | 428 | if (empty($reference\_id)) { |
  |  | 429 | $reference\_id = wp\_generate\_uuid4(); // Generates a random UUID |
  |  | 430 | update\_option('my\_plugin\_reference\_id', $reference\_id); |
  |  | 431 | } |
  |  | 432 |  |
  |  | 433 | // Localize the script with your data |
  |  | 434 | $data\_to\_pass = array('referenceId' => $reference\_id); |
  |  | 435 | wp\_localize\_script( |
  |  | 436 | 'extension', |
  |  | 437 | 'myPluginData', |
  |  | 438 | $data\_to\_pass |
  |  | 439 | ); |
  |  | 440 |  |
  |  | 441 | // Include the HTML template |
  |  | 442 | $html\_file\_path = plugin\_dir\_path(\_\_FILE\_\_) . 'templates/extension-template.html'; |
  |  | 443 | if (file\_exists($html\_file\_path)) { |
  |  | 444 | $html\_content = file\_get\_contents($html\_file\_path); |
  |  | 445 | $html\_content = str\_replace('{{REFERENCE\_ID}}', esc\_html($reference\_id), $html\_content); |
  |  | 446 | echo $html\_content; |
  |  | 447 | } else { |
  |  | 448 | echo 'HTML file not found.'; |
  |  | 449 | } |
  |  | 450 |  |
  |  | 451 | // Uncomment and include any additional scripts or styles if needed |
  |  | 452 | // wp\_enqueue\_style('extension-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/extension-custom.css'); |
  |  | 453 | // Additional enqueues if needed... |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 |  |
  |  | 457 | public function submenuConfigurationPageCallback() |
  |  | 458 | { |
  |  | 459 |  |
  |  | 460 | $html\_file\_path = plugin\_dir\_path(\_\_FILE\_\_) . 'templates/configuration-template.html'; |
  |  | 461 |  |
  |  | 462 | if (file\_exists($html\_file\_path)) { |
  |  | 463 | include $html\_file\_path; |
  |  | 464 | } else { |
  |  | 465 | echo 'HTML file not found.'; |
  |  | 466 | } |
  |  | 467 |  |
  |  | 468 | wp\_enqueue\_style('configuration-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/configuration-custom.css'); // Replace 'custom.css' with your CSS file name |
  |  | 469 |  |
  |  | 470 | wp\_enqueue\_script('configuration', plugin\_dir\_url(\_\_FILE\_\_) . 'js/configuration.js', array('jquery'), NULL, false); |
  |  | 471 | // wp\_enqueue\_script('common-multisupplier.js', plugin\_dir\_url(\_\_FILE\_\_) . 'js/common-multisupplier.js', array('jquery'), NULL, false); |
  |  | 472 |  |
  |  | 473 |  |
  |  | 474 | wp\_enqueue\_script('toast', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jquery.toast.min.js', array('jquery'), NULL, false); |
  |  | 475 | wp\_enqueue\_script('bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . 'js/bootstrap.min.js', array('jquery'), NULL, false); |
  |  | 476 | wp\_enqueue\_style('toastCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/jquery.toast.min.css'); |
  |  | 477 | wp\_enqueue\_style('customcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/main.css'); |
  |  | 478 | wp\_enqueue\_style('bootstrapCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/bootstrap.min.css'); |
  |  | 479 | wp\_enqueue\_script('quill', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quill.js', array('jquery'), NULL, false); |
  |  | 480 | wp\_enqueue\_style('quillCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quill.css'); |
  |  | 481 | wp\_enqueue\_script('math', plugin\_dir\_url(\_\_FILE\_\_) . 'js/math.js', array('jquery'), NULL, false); |
  |  | 482 | wp\_enqueue\_style('awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/font-awesome.css'); |
  |  | 483 | wp\_enqueue\_style('mdbcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/mdb.min.css'); |
  |  | 484 | wp\_enqueue\_script('fontawJs', plugin\_dir\_url(\_\_FILE\_\_) . 'js/font-aesome.min.js', array('jquery'), NULL, false); |
  |  | 485 |  |
  |  | 486 | wp\_localize\_script( |
  |  | 487 | 'configuration', |
  |  | 488 | 'wooshark\_params', |
  |  | 489 | array( |
  |  | 490 | 'ajaxurl' => admin\_url('admin-ajax.php'), |
  |  | 491 | 'nonce' => wp\_create\_nonce('ajax-nonce') |
  |  | 492 | ) |
  |  | 493 | ); |
  |  | 494 |  |
  |  | 495 | // wp\_enqueue\_script('my-submenu-script', plugins\_url('/js/my-submenu-script.js', \_\_FILE\_\_)); |
  |  | 496 |  |
  |  | 497 |  |
  |  | 498 | } |
  |  | 499 |  |
  |  | 500 |  |
  |  | 501 | public function submenuPageCallback() |
  |  | 502 | { |
  |  | 503 | $is\_activated = get\_option('plugin\_license\_activated'); |
  |  | 504 |  |
  |  | 505 | if (!$is\_activated) { |
  |  | 506 | echo '<p>You need to activate your license to access this feature.</p>'; |
  |  | 507 | return; |
  |  | 508 | } |
  |  | 509 |  |
  |  | 510 | $html\_file\_path = plugin\_dir\_path(\_\_FILE\_\_) . 'templates/product-template.html'; |
  |  | 511 |  |
  |  | 512 | if (file\_exists($html\_file\_path)) { |
  |  | 513 | include $html\_file\_path; |
  |  | 514 | } else { |
  |  | 515 | echo 'HTML file not found.'; |
  |  | 516 | } |
  |  | 517 |  |
  |  | 518 | wp\_enqueue\_style('products-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/products-custom.css'); // Replace 'custom.css' with your CSS file name |
  |  | 519 |  |
  |  | 520 | wp\_enqueue\_script('products', plugin\_dir\_url(\_\_FILE\_\_) . 'js/products.js', array('jquery'), NULL, false); |
  |  | 521 | // wp\_enqueue\_script('common-multisupplier.js', plugin\_dir\_url(\_\_FILE\_\_) . 'js/common-multisupplier.js', array('jquery'), NULL, false); |
  |  | 522 |  |
  |  | 523 | wp\_enqueue\_script('toast', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jquery.toast.min.js', array('jquery'), NULL, false); |
  |  | 524 | wp\_enqueue\_script('bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . 'js/bootstrap.min.js', array('jquery'), NULL, false); |
  |  | 525 | wp\_enqueue\_style('toastCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/jquery.toast.min.css'); |
  |  | 526 | wp\_enqueue\_style('customcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/main.css'); |
  |  | 527 | wp\_enqueue\_style('bootstrapCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/bootstrap.min.css'); |
  |  | 528 | wp\_enqueue\_script('quill', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quill.js', array('jquery'), NULL, false); |
  |  | 529 | wp\_enqueue\_style('quillCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quill.css'); |
  |  | 530 | wp\_enqueue\_script('math', plugin\_dir\_url(\_\_FILE\_\_) . 'js/math.js', array('jquery'), NULL, false); |
  |  | 531 | wp\_enqueue\_style('awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/font-awesome.css'); |
  |  | 532 | wp\_enqueue\_style('mdbcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/mdb.min.css'); |
  |  | 533 | wp\_enqueue\_script('fontawJs', plugin\_dir\_url(\_\_FILE\_\_) . 'js/font-aesome.min.js', array('jquery'), NULL, false); |
  |  | 534 |  |
  |  | 535 | wp\_localize\_script( |
  |  | 536 | 'products', |
  |  | 537 | 'wooshark\_params', |
  |  | 538 | array( |
  |  | 539 | 'ajaxurl' => admin\_url('admin-ajax.php'), |
  |  | 540 | 'nonce' => wp\_create\_nonce('ajax-nonce') |
  |  | 541 | ) |
  |  | 542 | ); |
  |  | 543 |  |
  |  | 544 | // wp\_enqueue\_script('my-submenu-script', plugins\_url('/js/my-submenu-script.js', \_\_FILE\_\_)); |
  |  | 545 |  |
  |  | 546 |  |
  |  | 547 | } |
  |  | 548 |  |
  |  | 549 |  |
  |  | 550 |  |
  |  | 551 |  |
  |  | 552 |  |
  |  | 553 |  |
  |  | 554 |  |
  |  | 555 |  |
  |  | 556 |  |
  |  | 557 |  |
  |  | 558 | public function submenuAliExpressCallback() |
  |  | 559 | { |
  |  | 560 |  |
  |  | 561 | $is\_activated = get\_option('plugin\_license\_activated'); |
  |  | 562 |  |
  |  | 563 | if (!$is\_activated) { |
  |  | 564 | echo '<p>You need to activate your license to access this feature.</p>'; |
  |  | 565 | return; |
  |  | 566 | } |
  |  | 567 |  |
  |  | 568 | $html\_file\_path = plugin\_dir\_path(\_\_FILE\_\_) . 'templates/aliexpress-product-template.html'; |
  |  | 569 |  |
  |  | 570 | if (file\_exists($html\_file\_path)) { |
  |  | 571 | include $html\_file\_path; |
  |  | 572 | } else { |
  |  | 573 | echo 'HTML file not found.'; |
  |  | 574 | } |
  |  | 575 |  |
  |  | 576 | wp\_enqueue\_style('aliexpress-custom.css', plugin\_dir\_url(\_\_FILE\_\_) . 'css/aliexpress-custom.css'); // Replace 'custom.css' with your CSS file name |
  |  | 577 |  |
  |  | 578 | wp\_enqueue\_script('aliexpress', plugin\_dir\_url(\_\_FILE\_\_) . 'js/aliexpress.js', array('jquery'), NULL, false); |
  |  | 579 | wp\_enqueue\_script('toast', plugin\_dir\_url(\_\_FILE\_\_) . 'js/jquery.toast.min.js', array('jquery'), NULL, false); |
  |  | 580 | wp\_enqueue\_script('bootstrap', plugin\_dir\_url(\_\_FILE\_\_) . 'js/bootstrap.min.js', array('jquery'), NULL, false); |
  |  | 581 | wp\_enqueue\_style('toastCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/jquery.toast.min.css'); |
  |  | 582 | wp\_enqueue\_style('customcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/main.css'); |
  |  | 583 | wp\_enqueue\_style('bootstrapCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/bootstrap.min.css'); |
  |  | 584 | wp\_enqueue\_script('quill', plugin\_dir\_url(\_\_FILE\_\_) . 'js/quill.js', array('jquery'), NULL, false); |
  |  | 585 | wp\_enqueue\_style('quillCss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/quill.css'); |
  |  | 586 | wp\_enqueue\_script('math', plugin\_dir\_url(\_\_FILE\_\_) . 'js/math.js', array('jquery'), NULL, false); |
  |  | 587 | wp\_enqueue\_style('awesome', plugin\_dir\_url(\_\_FILE\_\_) . 'css/font-awesome.css'); |
  |  | 588 | wp\_enqueue\_style('mdbcss', plugin\_dir\_url(\_\_FILE\_\_) . 'css/mdb.min.css'); |
  |  | 589 | wp\_enqueue\_script('fontawJs', plugin\_dir\_url(\_\_FILE\_\_) . 'js/font-aesome.min.js', array('jquery'), NULL, false); |
  |  | 590 |  |
  |  | 591 | wp\_localize\_script( |
  |  | 592 | 'aliexpress', |
  |  | 593 | 'wooshark\_params', |
  |  | 594 | array( |
  |  | 595 | 'ajaxurl' => admin\_url('admin-ajax.php'), |
  |  | 596 | 'nonce' => wp\_create\_nonce('ajax-nonce') |
  |  | 597 | ) |
  |  | 598 | ); |
  |  | 599 |  |
  |  | 600 | // wp\_enqueue\_script('my-submenu-script', plugins\_url('/js/my-submenu-script.js', \_\_FILE\_\_)); |
  |  | 601 |  |
  |  | 602 |  |
  |  | 603 | } |
  |  | 604 |  |
  |  | 605 |  |
  |  | 606 |  |
  |  | 607 |  |
  |  | 608 | protected function addSettingsSubMenuPageToSettingsMenu() |
  |  | 609 | { |
  |  | 610 | // $this->requireExtraPluginFiles(); |
  |  | 611 | // $displayName = $this->getPluginDisplayName(); |
  |  | 612 | // add\_options\_page( |
  |  | 613 | //     $displayName, |
  |  | 614 | //     $displayName, |
  |  | 615 | //     'manage\_options', |
  |  | 616 | //     $this->getSettingsSlug(), |
  |  | 617 | //     array(&$this, 'settingsPage') |
  |  | 618 | // ); |
  | 163 | 619 | } |
  | 164 | 620 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=2334487#L170) | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375#L626) |  |
  | 170 | 626 | \* avoid issues on some platforms |
  | 171 | 627 | \*/ |
  | 172 |  | protected function prefixTableName($name) { |
  |  | 628 | protected function prefixTableName($name) |
  |  | 629 | { |
  | 173 | 630 | global $wpdb; |
  | 174 | 631 | return $wpdb->prefix .  strtolower($this->prefix($name)); |
  | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=2334487#L192) | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_LifeCycle.php?rev=3059375#L649) |  |
  | 192 | 649 | \* @return string URL that can be used in a web page to make an Ajax call to $this->functionName |
  | 193 | 650 | \*/ |
  | 194 |  | public function getAjaxUrl($actionName) { |
  |  | 651 | public function getAjaxUrl($actionName) |
  |  | 652 | { |
  | 195 | 653 | return admin\_url('admin-ajax.php') . '?action=' . $actionName; |
  | 196 | 654 | } |
  | 197 |  |  |
  | 198 | 655 | } |
  | 199 |  |  |
* ## [wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter\_OptionsManager.php](/changeset/3059375/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php "Show the changeset 3059375 restricted to wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php")

  | [r2839431](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php?rev=2839431#L326 "Show revision 2839431 of this file in browser") | [r3059375](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php?rev=3059375#L326 "Show revision 3059375 of this file in browser") |  |
  | --- | --- | --- |
  | 326 | 326 |  |
  | 327 | 327 | wp\_localize\_script( |
  | 328 |  | '~~startup~~', |
  |  | 328 | 'custom-script', |
  | 329 | 329 | 'wooshark\_params', |
  | 330 | 330 | array( |
  | 331 | 331 | 'ajaxurl' => admin\_url('admin-ajax.php'), |
  | 332 | 332 | 'nonce' => wp\_create\_nonce('ajax-nonce') |
  | 333 |  | ) |
  |  | 333 | ) |
  | 334 | 334 | ); |
  | 335 | 335 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php?rev=2839431#L407) | […](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_OptionsManager.php?rev=3059375#L407) |  |
  | 407 | 407 | </div> |
  | 408 | 408 | <div class="search-form" style=" padding:2%;  margin: 1%;border-radius: 10px; background-color:white"> |
  | 409 |  | <h4 style="font-weight:bold">Search by keyword</h4> |
  |  | 409 | <h4 style="font-weight:bold">Search by keywords</h4> |
  | 410 | 410 |  |
  | 411 | 411 | <div style="display:flex"> |
* ## [wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter\_Plugin.php](/changeset/3059375/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_Plugin.php "Show the changeset 3059375 restricted to wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_Plugin.php")

  | [r2711547](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_Plugin.php?rev=2711547#L38 "Show revision 2711547 of this file in browser") | [r3059375](/browser/wooshark-aliexpress-importer/trunk/WoosharkAliexpressImporter_Plugin.php?rev=3059375#L38 "Show revision 3059375 of this file in browser") |  |
  | --- | --- | --- |
  | 38 | 38 |  |
  | 39 | 39 | public function getPluginDisplayName() { |
  | 40 |  | return '~~theShark~~ dropshipping for AliExpress'; |
  |  | 40 | return 'Sharkdropship Affiliate & dropshipping for AliExpress'; |
  | 41 | 41 | } |
  | 42 | 42 |  |
* ## [wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php](/changeset/3059375/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php "Show the changeset 3059375 restricted to wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php")

  | [r2919184](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php?rev=2919184#L1 "Show revision 2919184 of this file in browser") | [r3059375](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer.php?rev=3059375#L1 "Show revision 3059375 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 |  | Plugin Name: ~~theShark dropshipping for AliExpress and Woocommerce~~ |
  |  | 3 | Plugin Name: Sharkdropship Affiliate & dropshipping for AliExpress |
  | 4 | 4 | Plugin URI: http://wordpress.org/extend/plugins/wooshark-aliexpress-importer/ |
  | 5 |  | Version: 2.2.~~3~~ |
  |  | 5 | Version: 2.2.5 |
  | 6 | 6 | Author: wooproductimporter |
  | 7 | 7 | Description: Wooshark dropshipping for aliexpress and woocommerce |
* ## [wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer\_init.php](/changeset/3059375/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php "Show the changeset 3059375 restricted to wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php")

  | [r2839431](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1 "Show revision 2839431 of this file in browser") | [r3059375](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1 "Show revision 3059375 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  |  |
  | 3 |  |  |
  | 4 |  | add\_action('wp\_ajax\_wooshark-insert-product', 'wads\_insertProductInWoocommerce'); |
  | 5 |  | add\_action('wp\_ajax\_nopriv\_wooshark-insert-product', 'wads\_insertProductInWoocommerce'); |
  | 6 |  | add\_action('wp\_ajax\_get\_all\_products', 'wads\_get\_all\_Products'); |
  | 7 |  | add\_action('wp\_ajax\_nopriv\_get\_all\_products', 'wads\_get\_all\_Products'); |
  | 8 |  | add\_action('wp\_ajax\_search-category-by-name', 'wads\_searchCategoryByName'); |
  | 9 |  | add\_action('wp\_ajax\_nopriv\_search-category-by-name', 'wads\_searchCategoryByName'); |
  | 10 |  | add\_action('wp\_ajax\_getOrders', 'wads\_getOrders'); |
  | 11 |  | add\_action('wp\_ajax\_nopriv\_getOrders', 'wads\_getOrders'); |
  | 12 |  | add\_action('wp\_ajax\_get-sku-and-url-by-Category', 'wads\_getSKuAbdUrlByCategory'); |
  | 13 |  | add\_action('wp\_ajax\_nopriv\_get-sku-and-url-by-Category', 'wads\_getSKuAbdUrlByCategory'); |
  | 14 |  | add\_action('wp\_ajax\_get-already-imported-products', 'wads\_getAlreadyImportedProducts'); |
  | 15 |  | add\_action('wp\_ajax\_nopriv\_get-already-imported-products', 'wads\_getAlreadyImportedProducts'); |
  | 16 |  | add\_action('wp\_ajax\_insert-reviews-to-product', 'wads\_insertReviewsIntoProduct'); |
  | 17 |  | add\_action('wp\_ajax\_nopriv\_insert-reviews-to-product', 'wads\_insertReviewsIntoProduct'); |
  | 18 |  | add\_action('wp\_ajax\_remove-product-from-wp', 'wads\_removeProductFromShop'); |
  | 19 |  | add\_action('wp\_ajax\_nopriv\_remove-product-from-wp', 'wads\_removeProductFromShop'); |
  | 20 |  | add\_action('wp\_ajax\_search-product-by-sku', 'wads\_searchProductBySku'); |
  | 21 |  | add\_action('wp\_ajax\_nopriv\_search-product-by-sku', 'wads\_searchProductBySku'); |
  | 22 |  | add\_action('wp\_ajax\_get\_products-draft', 'wads\_getProductsDraft'); |
  | 23 |  | add\_action('wp\_ajax\_nopriv\_get\_products-draft', 'wads\_getProductsDraft'); |
  | 24 |  | add\_action('wp\_ajax\_get-old-product-details', 'wads\_getOldProductDetails'); |
  | 25 |  | add\_action('wp\_ajax\_nopriv\_get-old-product-details', 'wads\_getOldProductDetails'); |
  | 26 |  | add\_action('wp\_ajax\_get-product-by-id', 'wads\_searchProductByIdReviews'); |
  | 27 |  | add\_action('wp\_ajax\_nopriv\_get-product-by-id', 'wads\_searchProductByIdReviews'); |
  | 28 |  | add\_action('wp\_ajax\_saveOptionsDB', 'wads\_saveOptionsDB'); |
  | 29 |  | add\_action('wp\_ajax\_nopriv\_saveOptionsDB', 'wads\_wads\_saveOptionsDB'); |
  | 30 |  | add\_action('wp\_ajax\_getProductsCount', 'wads\_getProductsCount\_FROM\_WP'); |
  | 31 |  | add\_action('wp\_ajax\_nopriv\_getProductsCount', 'wads\_getProductsCount\_FROM\_WP'); |
  | 32 |  | add\_action('wp\_ajax\_get\_categories', 'wads\_get\_categories\_FROMWP'); |
  | 33 |  | add\_action('wp\_ajax\_nopriv\_get\_categories', 'wads\_get\_categories\_FROMWP'); |
  | 34 |  | add\_action('wp\_ajax\_insert-reviews-to-productRM', 'wads\_insertReviewsIntoProductRM\_PREMUIM\_PLUGIN'); |
  | 35 |  | add\_action('wp\_ajax\_nopriv\_insert-reviews-to-producRMt', 'wads\_insertReviewsIntoProductRM\_PREMUIM\_PLUGIN'); |
  | 36 |  | add\_action('wp\_ajax\_restoreConfiguration', 'wads\_restoreConfiguration'); |
  | 37 |  | add\_action('wp\_ajax\_nopriv\_restoreConfiguration', 'wads\_restoreConfiguration'); |
  |  | 2 | /\* |
  |  | 3 | "WordPress Plugin Template" Copyright (C) 2018 Michael Simpson  (email : michael.d.simpson@gmail.com) |
  |  | 4 |  |
  |  | 5 | This file is part of WordPress Plugin Template for WordPress. |
  |  | 6 |  |
  |  | 7 | WordPress Plugin Template is free software: you can redistribute it and/or modify |
  |  | 8 | it under the terms of the GNU General Public License as published by |
  |  | 9 | the Free Software Foundation, either version 3 of the License, or |
  |  | 10 | (at your option) any later version. |
  |  | 11 |  |
  |  | 12 | WordPress Plugin Template is distributed in the hope that it will be useful, |
  |  | 13 | but WITHOUT ANY WARRANTY; without even the implied warranty of |
  |  | 14 | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
  |  | 15 | GNU General Public License for more details. |
  |  | 16 |  |
  |  | 17 | You should have received a copy of the GNU General Public License |
  |  | 18 | along with Contact Form to Database Extension. |
  |  | 19 | If not, see http://www.gnu.org/licenses/gpl-3.0.html |
  |  | 20 | \*/ |
  |  | 21 |  |
  | 38 | 22 |  |
  | 39 | 23 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L43) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L27) |  |
  | 43 | 27 | require\_once('WoosharkAliexpressImporter\_Plugin.php'); |
  | 44 | 28 | $aPlugin = new WoosharkAliexpressImporter\_Plugin(); |
  |  | 29 |  |
  |  | 30 | // Install the plugin |
  |  | 31 | // NOTE: this file gets run each time you \*activate\* the plugin. |
  |  | 32 | // So in WP when you "install" the plugin, all that does it dump its files in the plugin-templates directory |
  |  | 33 | // but it does not call any of its code. |
  |  | 34 | // So here, the plugin tracks whether or not it has run its install operation, and we ensure it is run only once |
  |  | 35 | // on the first activation |
  | 45 | 36 | if (!$aPlugin->isInstalled()) { |
  | 46 | 37 | $aPlugin->install(); |
  | 47 | 38 | } else { |
  |  | 39 | // Perform any version-upgrade activities prior to activation (e.g. database changes) |
  | 48 | 40 | $aPlugin->upgrade(); |
  | 49 | 41 | } |
  |  | 42 |  |
  |  | 43 | // Add callbacks to hooks |
  | 50 | 44 | $aPlugin->addActionsAndFilters(); |
  |  | 45 |  |
  | 51 | 46 | if (!$file) { |
  | 52 | 47 | $file = \_\_FILE\_\_; |
  | 53 | 48 | } |
  |  | 49 | // Register the Plugin Activation Hook |
  | 54 | 50 | register\_activation\_hook($file, array(&$aPlugin, 'activate')); |
  |  | 51 |  |
  |  | 52 |  |
  |  | 53 | // Register the Plugin Deactivation Hook |
  | 55 | 54 | register\_deactivation\_hook($file, array(&$aPlugin, 'deactivate')); |
  | 56 | 55 | } |
  | 57 |  | add\_action('rest\_api\_init', function () { |
  | 58 |  | register\_rest\_route('myplugin/v1', '/author/(?P<id>\d+)', array('methods' => 'GET', 'callback' => 'wads\_my\_awesome\_func',)); |
  | 59 |  | }); |
  | 60 |  | function wads\_my\_awesome\_func($data) |
  | 61 |  | { |
  | 62 |  | $posts = get\_posts(array('author' => $data['id'],)); |
  | 63 |  | if (empty($posts)) { |
  | 64 |  | return null; |
  | 65 |  | } |
  | 66 |  | return $posts[0]->post\_title; |
  | 67 |  | } |
  | 68 |  |  |
  | 69 |  |  |
  | 70 |  |  |
  | 71 |  | function wads\_getProductsCount\_FROM\_WP() |
  | 72 |  | { |
  |  | 56 |  |
  |  | 57 |  |
  |  | 58 |  |
  |  | 59 |  |
  |  | 60 |  |
  |  | 61 |  |
  |  | 62 |  |
  |  | 63 | function theSharkAliExpress\_getProductsCount\_FROM\_WP() |
  |  | 64 | { |
  |  | 65 |  |
  |  | 66 | // Check if the user is authenticated and has the necessary permissions |
  |  | 67 | if (!current\_user\_can('manage\_options')) { |
  |  | 68 |  |
  |  | 69 | // Handle unauthorized access |
  |  | 70 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 71 | } |
  |  | 72 |  |
  |  | 73 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 74 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 75 | } |
  |  | 76 |  |
  |  | 77 |  |
  |  | 78 |  |
  |  | 79 |  |
  |  | 80 |  |
  | 73 | 81 |  |
  | 74 | 82 | $args = array( |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L76) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L84) |  |
  | 76 | 84 | 'post\_status' => array('publish', 'draft'), |
  | 77 | 85 | 'meta\_query' => array( |
  |  | 86 | 'relation' => 'OR', |
  | 78 | 87 | array( |
  | 79 | 88 | 'key' => 'productUrl', //meta key name here |
  | 80 |  | 'value' => 'aliexpress~~.com~~', |
  | 81 |  | 'compare' => 'LIKE'~~,~~ |
  |  | 89 | 'value' => 'aliexpress', |
  |  | 90 | 'compare' => 'LIKE' |
  | 82 | 91 | ) |
  | 83 |  | ), |
  |  | 92 |  |
  |  | 93 | ) |
  | 84 | 94 | ); |
  | 85 | 95 | $query = new WP\_Query($args); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L91) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L101) |  |
  | 91 | 101 |  |
  | 92 | 102 |  |
  | 93 |  | function wads\_get\_categories\_FROMWP() |
  | 94 |  | { |
  |  | 103 | function theSharkAliExpress\_get\_categories\_FROMWP() |
  |  | 104 | { |
  |  | 105 |  |
  |  | 106 |  |
  |  | 107 | // Check if the user is authenticated and has the necessary permissions |
  |  | 108 | if (!current\_user\_can('manage\_options')) { |
  |  | 109 |  |
  |  | 110 | // Handle unauthorized access |
  |  | 111 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 112 | } |
  |  | 113 |  |
  |  | 114 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 115 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 116 | } |
  |  | 117 |  |
  |  | 118 |  |
  |  | 119 |  |
  | 95 | 120 |  |
  | 96 | 121 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L109) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L134) |  |
  | 109 | 134 |  |
  | 110 | 135 | foreach ($product\_categories as $product\_category) { |
  | 111 |  | ~~// if ($product\_category->count > 0) {~~ |
  | 112 | 136 | array\_push($categoriesArray, array('name' => $product\_category->name, 'count' => $product\_category->count, 'term\_id' => $product\_category->term\_id)); |
  | 113 |  | // } |
  | 114 |  | } |
  | 115 |  |  |
  | 116 |  | // $response['message'] = $post\_id->get\_error\_message(); |
  |  | 137 | } |
  |  | 138 |  |
  |  | 139 |  |
  |  | 140 |  |
  |  | 141 |  |
  | 117 | 142 | wp\_send\_json($categoriesArray); |
  | 118 | 143 | } |
  | 119 | 144 |  |
  | 120 |  | function wads\_get\_all\_Products() |
  | 121 |  | { |
  | 122 |  |  |
  | 123 |  | $paged = isset($\_POST['paged']) ? wc\_clean($\_POST['paged']) : ''; |
  | 124 |  |  |
  | 125 |  | $args = array( |
  | 126 |  | 'post\_type'      => 'product', |
  | 127 |  | 'posts\_per\_page' => 20, |
  | 128 |  | 'paged' => $paged, |
  | 129 |  | 'meta\_query' => array( |
  | 130 |  | array( |
  | 131 |  | 'key' => 'productUrl', //meta key name here |
  | 132 |  | 'value' => 'aliexpress.com', |
  | 133 |  | 'compare' => 'LIKE', |
  | 134 |  | ) |
  | 135 |  | ) |
  | 136 |  |  |
  | 137 |  |  |
  | 138 |  | ); |
  | 139 |  |  |
  | 140 |  | $products = new WP\_Query($args); |
  | 141 |  | $finalList = array(); |
  | 142 |  |  |
  | 143 |  | if ($products->have\_posts()) { |
  | 144 |  | while ($products->have\_posts()) : $products->the\_post(); |
  | 145 |  | $theid = get\_the\_ID(); |
  | 146 |  | $product = new WC\_Product($theid); |
  | 147 |  | if (has\_post\_thumbnail()) { |
  | 148 |  | $thumbnail = get\_post\_thumbnail\_id(); |
  | 149 |  | $image = $thumbnail ? wp\_get\_attachment\_url($thumbnail) : ''; |
  | 150 |  | } |
  | 151 |  | $finalList[] = array( |
  | 152 |  | 'sku' => $product->get\_sku(), |
  | 153 |  | 'id' => $theid, |
  | 154 |  | // image => wp\_get\_attachment\_image\_src( get\_post\_thumbnail\_id($products->post->ID)), |
  | 155 |  | 'image' => $image, |
  | 156 |  | 'title' =>  $product->get\_title(), |
  | 157 |  | 'productUrl' => get\_post\_meta($theid, 'productUrl', true), |
  | 158 |  | 'lastUpdated' => get\_post\_meta($theid, 'lastUpdated', true), |
  | 159 |  | 'status' => $product->get\_status() |
  | 160 |  |  |
  | 161 |  |  |
  | 162 |  |  |
  | 163 |  | ); |
  | 164 |  | endwhile; |
  |  | 145 |  |
  |  | 146 | function checkDailyUpdatePemuim\_alibay() |
  |  | 147 | { |
  |  | 148 |  |
  |  | 149 | $currentUpdateCount = get\_option('alibay\_daily\_update\_count'); |
  |  | 150 | $lastUpdateDate = get\_option('alibay\_last\_update\_date'); |
  |  | 151 |  |
  |  | 152 | $today = date('Y-m-d'); |
  |  | 153 |  |
  |  | 154 | if ($lastUpdateDate !== $today || !$currentUpdateCount) { |
  |  | 155 | $currentUpdateCount = 0; |
  |  | 156 | update\_option('alibay\_daily\_update\_count', $currentUpdateCount); |
  |  | 157 | update\_option('alibay\_last\_update\_date', $today); |
  |  | 158 | } |
  |  | 159 |  |
  |  | 160 | if ($currentUpdateCount >= 500) { |
  |  | 161 | wp\_send\_json\_error(array('message' => 'Daily update of 500 products limit reached. Please use wisely our APIs. you can start again tomorrow.')); |
  |  | 162 | return; |
  |  | 163 | } |
  |  | 164 | } |
  |  | 165 |  |
  |  | 166 | function checkDailyUpdate\_alibay() |
  |  | 167 | { |
  |  | 168 |  |
  |  | 169 |  |
  |  | 170 | $currentUpdateCount = get\_option('alibay\_daily\_update\_count'); |
  |  | 171 | $lastUpdateDate = get\_option('alibay\_last\_update\_date'); |
  |  | 172 |  |
  |  | 173 | $today = date('Y-m-d'); |
  |  | 174 |  |
  |  | 175 | if ($lastUpdateDate !== $today || !$currentUpdateCount) { |
  |  | 176 | $currentUpdateCount = 0; |
  |  | 177 | update\_option('alibay\_daily\_update\_count', $currentUpdateCount); |
  |  | 178 | update\_option('alibay\_last\_update\_date', $today); |
  |  | 179 | } |
  |  | 180 |  |
  |  | 181 | if ($currentUpdateCount >= 30) { |
  |  | 182 | wp\_send\_json\_error(array('message' => 'Daily update of 30 products limit reached, you can start again tomorrow or upgrade to premuim plan')); |
  |  | 183 | return; |
  |  | 184 | } |
  |  | 185 | } |
  |  | 186 |  |
  |  | 187 | function checkDailyImportPremuim\_alibay() |
  |  | 188 | { |
  |  | 189 | $currentImportCount = get\_option('alibay\_daily\_import\_count'); |
  |  | 190 | $lastImportDate = get\_option('alibay\_last\_import\_date'); |
  |  | 191 |  |
  |  | 192 | $today = date('Y-m-d'); |
  |  | 193 |  |
  |  | 194 | if ($lastImportDate !== $today || !$currentImportCount) { |
  |  | 195 | $currentImportCount = 0; |
  |  | 196 | update\_option('alibay\_daily\_import\_count', $currentImportCount); |
  |  | 197 | update\_option('alibay\_last\_import\_date', $today); |
  |  | 198 | } |
  |  | 199 |  |
  |  | 200 | if ($currentImportCount >= 1500) { |
  |  | 201 | $results = array('error' => true, 'error\_msg' => 'Daily import limit of 1500 products reached. Please try again tomorrow.', 'data' => ''); |
  |  | 202 | wp\_send\_json($results); |
  |  | 203 | return; |
  |  | 204 | } |
  |  | 205 | } |
  |  | 206 |  |
  |  | 207 | function checkDailyImport\_alibay() |
  |  | 208 | { |
  |  | 209 | $currentImportCount = get\_option('alibay\_daily\_import\_count'); |
  |  | 210 | $lastImportDate = get\_option('alibay\_last\_import\_date'); |
  |  | 211 |  |
  |  | 212 | $today = date('Y-m-d'); |
  |  | 213 | if ($lastImportDate !== $today || !$currentImportCount) { |
  |  | 214 | $currentImportCount = 0; |
  |  | 215 | update\_option('alibay\_daily\_import\_count', $currentImportCount); |
  |  | 216 | update\_option('alibay\_last\_import\_date', $today); |
  |  | 217 | } |
  |  | 218 |  |
  |  | 219 | if ($currentImportCount >= 30) { |
  |  | 220 | $results = array('error' => true, 'error\_msg' => 'Daily import limit of 30 products reached. Please try again tomorrow or upgrade to premium plan', 'data' => ''); |
  |  | 221 | wp\_send\_json($results); |
  |  | 222 | return; |
  |  | 223 | } |
  |  | 224 |  |
  |  | 225 | // Presumably, the rest of your function continues here... |
  |  | 226 | } |
  |  | 227 |  |
  |  | 228 |  |
  |  | 229 | function checkVersionActivation\_alibay() |
  |  | 230 | { |
  |  | 231 | $isPremuim = false; |
  |  | 232 | if ($isPremuim) { |
  |  | 233 | checkDailyImportPremuim\_alibay(); |
  | 165 | 234 | } else { |
  | 166 |  | echo \_\_('No products found'); |
  | 167 |  | } |
  | 168 |  | wp\_reset\_postdata(); |
  | 169 |  |  |
  | 170 |  | wp\_send\_json($finalList); |
  | 171 |  | } |
  | 172 |  |  |
  | 173 |  |  |
  | 174 |  |  |
  | 175 |  |  |
  | 176 |  | function wads\_insertProductInWoocommerce() |
  | 177 |  | { |
  | 178 |  |  |
  | 179 |  |  |
  | 180 |  | if (isset($\_POST)) { |
  | 181 |  | $sku = isset($\_POST['sku']) ? wc\_clean($\_POST['sku']) : ''; |
  | 182 |  | $productType = isset($\_POST['productType']) ? wc\_clean($\_POST['productType']) : 'variable'; |
  | 183 |  | $regularPrice = isset($\_POST['regularPrice']) ? wc\_clean($\_POST['regularPrice']) : ''; |
  | 184 |  | $salePrice = isset($\_POST['salePrice']) ? wc\_clean($\_POST['salePrice']) : ''; |
  | 185 |  |  |
  | 186 |  |  |
  | 187 |  | $images = isset($\_POST['images']) ? wc\_clean($\_POST['images']) : array(); |
  | 188 |  | $categories = isset($\_POST['categories']) ? wc\_clean($\_POST['categories']) : array(); |
  | 189 |  | $title = isset($\_POST['title']) ? wc\_clean($\_POST['title']) : ''; |
  | 190 |  | $description = isset($\_POST['description']) ? wp\_kses\_post($\_POST['description']) : ''; |
  | 191 |  | $postStatus = isset($\_POST['postStatus']) ? wc\_clean($\_POST['postStatus']) : 'draft'; |
  | 192 |  | $variations = isset($\_POST['variations']) ? wc\_clean($\_POST['variations']) : array(); |
  | 193 |  | $attributes = isset($\_POST['attributes']) ? wc\_clean($\_POST['attributes']) : array(); |
  | 194 |  | $productUrl = isset($\_POST['productUrl']) ? wc\_clean($\_POST['productUrl']) : ''; |
  | 195 |  |  |
  | 196 |  | $shortDescription = isset($\_POST['shortDescription']) ? wc\_clean($\_POST['shortDescription']) : ''; |
  | 197 |  | $importVariationImages = isset($\_POST['importVariationImages']) ? wc\_clean($\_POST['importVariationImages']) : ''; |
  | 198 |  | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  | 199 |  | $tags = isset($\_POST['tags']) ? wc\_clean($\_POST['tags']) : array(); |
  | 200 |  |  |
  | 201 |  |  |
  | 202 |  | $currentImportedNumber = get\_option('isAllowedToImport'); |
  | 203 |  | if (isset($currentImportedNumber)) { |
  | 204 |  | $finalCounter = (int) $currentImportedNumber + 1; |
  | 205 |  | update\_option('isAllowedToImport',   $finalCounter); |
  | 206 |  | } else { |
  | 207 |  | update\_option('isAllowedToImport',   '1'); |
  | 208 |  | } |
  | 209 |  |  |
  | 210 |  | //Create main product |
  | 211 |  | if(isset($productType) && $productType == 'simple'){ |
  | 212 |  | $product = new WC\_Product\_Simple(); |
  |  | 235 | checkDailyImport\_alibay(); |
  |  | 236 | } |
  |  | 237 | } |
  |  | 238 | function theSharkAliExpress\_insertProductInWoocommerceAffiliate() |
  |  | 239 | { |
  |  | 240 |  |
  |  | 241 |  |
  |  | 242 |  |
  |  | 243 | // Check if the user is authenticated and has the necessary permissions |
  |  | 244 | if (!current\_user\_can('manage\_options')) { |
  |  | 245 |  |
  |  | 246 | // Handle unauthorized access |
  |  | 247 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 248 | } |
  |  | 249 |  |
  |  | 250 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 251 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 252 | } |
  |  | 253 |  |
  |  | 254 |  |
  |  | 255 |  |
  |  | 256 |  |
  |  | 257 |  |
  |  | 258 |  |
  |  | 259 | checkVersionActivation\_alibay(); |
  |  | 260 |  |
  |  | 261 | try { |
  |  | 262 | if (isset($\_POST)) { |
  |  | 263 | $sku = isset($\_POST['sku']) ? wc\_clean($\_POST['sku']) : ''; |
  |  | 264 | $external\_url = isset($\_POST['affiliateLink']) ? wc\_clean($\_POST['affiliateLink']) : ''; |
  |  | 265 |  |
  |  | 266 | $images = isset($\_POST['images']) ? wc\_clean($\_POST['images']) : array(); |
  |  | 267 | $categories = isset($\_POST['categories']) ? wc\_clean($\_POST['categories']) : array(); |
  |  | 268 | $remoteCategories = isset($\_POST['remoteCategories']) ? wc\_clean($\_POST['remoteCategories']) : array(); |
  |  | 269 | $selectedCurrency = wc\_clean($\_POST['selectedCurrency']); |
  |  | 270 | $title = isset($\_POST['title']) ? wc\_clean($\_POST['title']) : ''; |
  |  | 271 | $description = isset($\_POST['description']) ? wp\_kses\_post($\_POST['description']) : ''; |
  |  | 272 | $productType = 'external'; |
  |  | 273 | $regularPrice = isset($\_POST['regularPrice']) ? wc\_clean($\_POST['regularPrice']) : '0'; |
  |  | 274 | $salePrice = isset($\_POST['salePrice']) ? wc\_clean($\_POST['salePrice']) : '0'; |
  |  | 275 | $postStatus = isset($\_POST['postStatus']) ? wc\_clean($\_POST['postStatus']) : 'draft'; |
  |  | 276 | $isFeatured = isset($\_POST['isFeatured']) ? true : false; |
  |  | 277 |  |
  |  | 278 | $attributes = isset($\_POST['attributes']) ? wc\_clean($\_POST['attributes']) : array(); |
  |  | 279 | $productUrl = isset($\_POST['productUrl']) ? wc\_clean($\_POST['productUrl']) : ''; |
  |  | 280 | $shortDescription = isset($\_POST['shortDescription']) ? wc\_clean($\_POST['shortDescription']) : ''; |
  |  | 281 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  |  | 282 | $tags = isset($\_POST['tags']) ? wc\_clean($\_POST['tags']) : array(); |
  |  | 283 |  |
  |  | 284 | $currentImportedNumber = get\_option('isAllowedToImport\_alibay'); |
  |  | 285 | if (isset($currentImportedNumber)) { |
  |  | 286 | $finalCounter = (int) $currentImportedNumber + 1; |
  |  | 287 | update\_option('isAllowedToImport\_alibay', $finalCounter); |
  |  | 288 | } else { |
  |  | 289 | update\_option('isAllowedToImport\_alibay', '1'); |
  |  | 290 | } |
  |  | 291 |  |
  |  | 292 | if (null != get\_option('isAllowedToImport\_alibay') && (int) get\_option('isAllowedToImport\_alibay') > 200) { |
  |  | 293 | $results = array('error' => true, 'error\_msg' => 'You have reached the permitted usage limit for this week. You can upgrade to a premium plan.', 'data' => ''); |
  |  | 294 | wp\_send\_json($results); |
  |  | 295 | } |
  |  | 296 |  |
  |  | 297 | $product = new WC\_Product\_External(); |
  | 213 | 298 |  |
  | 214 | 299 | if (isset($title)) { |
  | 215 | 300 | $product->set\_name($title); |
  | 216 | 301 | } |
  |  | 302 | if (isset($isFeatured)) { |
  |  | 303 | $product->set\_featured(true); // Set to true to make it featured |
  |  | 304 | } |
  |  | 305 |  |
  |  | 306 |  |
  | 217 | 307 | if (isset($description)) { |
  | 218 | 308 | $product->set\_description($description); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L222) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L312) |  |
  | 222 | 312 | } |
  | 223 | 313 |  |
  |  | 314 | if (isset($sku)) { |
  |  | 315 | $product->set\_sku($sku); |
  |  | 316 | } |
  |  | 317 |  |
  |  | 318 | if (isset($postStatus)) { |
  |  | 319 | $product->set\_status($postStatus); |
  |  | 320 | } |
  |  | 321 |  |
  |  | 322 |  |
  |  | 323 |  |
  | 224 | 324 | if (isset($regularPrice)) { |
  | 225 | 325 | $product->set\_regular\_price($regularPrice); |
  |  | 326 | $product->set\_price($regularPrice); |
  | 226 | 327 | } |
  | 227 | 328 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L230) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L331) |  |
  | 230 | 331 | } |
  | 231 | 332 |  |
  |  | 333 | if (is\_array($categories) && count($categories)) { |
  |  | 334 | $product->set\_category\_ids($categories); |
  |  | 335 | } |
  |  | 336 |  |
  |  | 337 | // Save product images |
  |  | 338 | // $imageUploadErrors = theSharkAliExpress\_save\_product\_images\_for\_ebay\_alibay($product, $images); |
  |  | 339 |  |
  |  | 340 | $response = theSharkAliExpress\_save\_product\_images\_for\_ebay\_alibay($product, $images); |
  |  | 341 | $product = $response['product']; |
  |  | 342 | $imageUploadErrors = $response['errors']; |
  | 232 | 343 |  |
  | 233 | 344 |  |
  | 234 | 345 |  |
  | 235 | 346 | try { |
  |  | 347 | $post\_id = $product->save(); |
  |  | 348 | } catch (Exception $e) { |
  |  | 349 | $results = array( |
  |  | 350 | 'error' => false, |
  |  | 351 | 'error\_msg' => '', |
  |  | 352 | 'data' => 'Product inserted successfully', |
  |  | 353 | 'postId' => $post\_id, |
  |  | 354 | 'imageUploadErrors' => $imageUploadErrors // Add image upload errors to the response |
  |  | 355 | ); |
  |  | 356 | wp\_send\_json($results); |
  |  | 357 | } |
  |  | 358 |  |
  |  | 359 | if (isset($productUrl)) { |
  |  | 360 | update\_post\_meta($post\_id, 'productUrl', $productUrl); |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | if ($selectedCurrency) { |
  |  | 364 | update\_post\_meta($post\_id, 'selectedCurrency', $selectedCurrency); |
  |  | 365 | } |
  |  | 366 |  |
  |  | 367 | $lastUpdatedDate = current\_time('mysql', 1); |
  |  | 368 | update\_post\_meta($post\_id, 'lastUpdatedDate', $lastUpdatedDate); |
  |  | 369 |  |
  |  | 370 |  |
  |  | 371 | if ($external\_url) { |
  |  | 372 | update\_post\_meta($post\_id, '\_product\_url', esc\_url\_raw($external\_url)); |
  |  | 373 | } |
  |  | 374 |  |
  |  | 375 | if (isset($post\_id) && isset($tags) && count($tags)) { |
  |  | 376 | wp\_set\_post\_tags($post\_id, $tags, true); |
  |  | 377 | wp\_set\_object\_terms($post\_id, $tags, 'product\_tag'); |
  |  | 378 | } |
  |  | 379 |  |
  |  | 380 | // Create and save product attributes |
  |  | 381 | $product\_attributes = array(); |
  |  | 382 | if (is\_array($attributes) && count($attributes)) { |
  |  | 383 | foreach ($attributes as $attribute\_data) { |
  |  | 384 | $attribute\_name = sanitize\_title($attribute\_data['name']); |
  |  | 385 | $attribute\_values = array\_map('sanitize\_title', $attribute\_data['values']); |
  |  | 386 |  |
  |  | 387 | $attribute\_id = wc\_attribute\_taxonomy\_id\_by\_name($attribute\_name); |
  |  | 388 |  |
  |  | 389 | if (!$attribute\_id) { |
  |  | 390 | $attribute\_id = wc\_create\_attribute(array( |
  |  | 391 | 'name' => $attribute\_name, |
  |  | 392 | 'slug' => $attribute\_name, |
  |  | 393 | 'type' => 'select', // 'select' for dropdown, 'text' for text field, etc. |
  |  | 394 | 'order\_by' => 'menu\_order', // You can adjust this order if needed |
  |  | 395 | 'has\_archives' => true, |
  |  | 396 | )); |
  |  | 397 | } |
  |  | 398 |  |
  |  | 399 | if ($attribute\_id && !empty($attribute\_values)) { |
  |  | 400 | wp\_set\_object\_terms($post\_id, $attribute\_values, 'pa\_' . $attribute\_name); |
  |  | 401 | } |
  |  | 402 |  |
  |  | 403 | $product\_attributes['pa\_' . $attribute\_name] = array( |
  |  | 404 | 'name' => 'pa\_' . $attribute\_name, |
  |  | 405 | 'value' => implode(',', $attribute\_values), |
  |  | 406 | 'position' => 0, |
  |  | 407 | 'is\_visible' => 1, |
  |  | 408 | 'is\_variation' => $attribute\_data['variation'] ? 1 : 0, |
  |  | 409 | 'is\_taxonomy' => 1, |
  |  | 410 | ); |
  |  | 411 | } |
  |  | 412 | update\_post\_meta($post\_id, '\_product\_attributes', $product\_attributes); |
  |  | 413 | } |
  |  | 414 | $currentImportCount = get\_option('alibay\_daily\_import\_count', 0); |
  |  | 415 | update\_option('alibay\_daily\_import\_count', ++$currentImportCount); |
  |  | 416 |  |
  |  | 417 |  |
  |  | 418 | $category\_ids = theSharkAliExpress\_create\_woocommerce\_categories\_and\_get\_ids\_alibay($remoteCategories); |
  |  | 419 | $merged\_category\_ids = array\_merge($categories, $category\_ids); |
  |  | 420 |  |
  |  | 421 |  |
  |  | 422 | if (is\_array($merged\_category\_ids) && count($merged\_category\_ids)) { |
  |  | 423 |  |
  |  | 424 | wp\_set\_post\_terms($post\_id, $merged\_category\_ids, 'product\_cat'); |
  |  | 425 | } |
  |  | 426 |  |
  |  | 427 |  |
  |  | 428 | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  |  | 429 | foreach ($reviews as $review) { |
  |  | 430 | $comment\_content = $review['review']; |
  |  | 431 |  |
  |  | 432 | // Process and insert images into the comment content |
  |  | 433 | preg\_match\_all('/<img[^>]+src="([^"]+)"/i', $comment\_content, $matches); |
  |  | 434 |  |
  |  | 435 | if (isset($matches[1]) && !empty($matches[1])) { |
  |  | 436 | foreach ($matches[1] as $image\_url) { |
  |  | 437 | // Generate HTML for the image and insert it into the comment content |
  |  | 438 | $image\_html = '<img src="' . esc\_url($image\_url) . '" alt="" />'; |
  |  | 439 | $comment\_content .= $image\_html; |
  |  | 440 | } |
  |  | 441 | } |
  |  | 442 |  |
  |  | 443 | $comment\_id = wp\_insert\_comment(array( |
  |  | 444 | 'comment\_post\_ID' => sanitize\_text\_field($post\_id), |
  |  | 445 | 'comment\_author' => sanitize\_text\_field($review['username']), |
  |  | 446 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), |
  |  | 447 | 'comment\_author\_url' => '', |
  |  | 448 | 'comment\_content' => $comment\_content, |
  |  | 449 | 'comment\_type' => '', |
  |  | 450 | 'comment\_parent' => 0, |
  |  | 451 | 'user\_id' => 5, |
  |  | 452 | 'comment\_author\_IP' => '', |
  |  | 453 | 'comment\_agent' => '', |
  |  | 454 | 'comment\_date' => $review['datecreation'], |
  |  | 455 | 'comment\_approved' => 1, |
  |  | 456 | )); |
  |  | 457 |  |
  |  | 458 | // Inserting the rating (an integer from 1 to 5) |
  |  | 459 | update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  |  | 460 |  |
  |  | 461 | // array\_push($insertedSuccessfully, $comment\_id); |
  |  | 462 | } |
  |  | 463 |  |
  |  | 464 | // wp\_send\_json(array('insertedSuccessfully' => $insertedSuccessfully)); |
  |  | 465 | } |
  |  | 466 |  |
  |  | 467 |  |
  |  | 468 |  |
  |  | 469 |  |
  |  | 470 | $results = array( |
  |  | 471 | 'error' => false, |
  |  | 472 | 'error\_msg' => '', |
  |  | 473 | 'data' => 'Product inserted successfully', |
  |  | 474 | 'postId' => $post\_id, |
  |  | 475 | 'imageUploadErrors' => $imageUploadErrors // Add image upload errors to the response |
  |  | 476 | ); |
  |  | 477 | wp\_send\_json($results); |
  |  | 478 | } |
  |  | 479 | } catch (Exception $ex) { |
  |  | 480 | $results = array( |
  |  | 481 | 'error' => true, |
  |  | 482 | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  |  | 483 | 'data' => '', |
  |  | 484 | ); |
  |  | 485 | wp\_send\_json($results); |
  |  | 486 | } |
  |  | 487 | } |
  |  | 488 |  |
  |  | 489 |  |
  |  | 490 |  |
  |  | 491 |  |
  |  | 492 |  |
  |  | 493 |  |
  |  | 494 | function theSharkAliExpress\_insertProductInWoocommerce() |
  |  | 495 | { |
  |  | 496 |  |
  |  | 497 | // Check if the user is authenticated and has the necessary permissions |
  |  | 498 | if (!current\_user\_can('manage\_options')) { |
  |  | 499 |  |
  |  | 500 | // Handle unauthorized access |
  |  | 501 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 502 | } |
  |  | 503 |  |
  |  | 504 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 505 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 506 | } |
  |  | 507 |  |
  |  | 508 |  |
  |  | 509 |  |
  |  | 510 |  |
  |  | 511 |  |
  |  | 512 |  |
  |  | 513 | checkVersionActivation\_alibay(); |
  |  | 514 | try { |
  |  | 515 | if (isset($\_POST)) { |
  |  | 516 | $sku = isset($\_POST['sku']) ? wc\_clean($\_POST['sku']) : ''; |
  |  | 517 | $images = isset($\_POST['images']) ? wc\_clean($\_POST['images']) : array(); |
  |  | 518 | $categories = isset($\_POST['categories']) ? wc\_clean($\_POST['categories']) : array(); |
  |  | 519 | $remoteCategories = isset($\_POST['remoteCategories']) ? wc\_clean($\_POST['remoteCategories']) : array(); |
  |  | 520 | $selectedCurrency = wc\_clean($\_POST['selectedCurrency']); |
  |  | 521 | $title = isset($\_POST['title']) ? wc\_clean($\_POST['title']) : ''; |
  |  | 522 | $description = isset($\_POST['description']) ? wp\_kses\_post($\_POST['description']) : ''; |
  |  | 523 | $productType = isset($\_POST['productType']) ? wc\_clean($\_POST['productType']) : 'simple'; |
  |  | 524 | $regularPrice = isset($\_POST['regularPrice']) ? wc\_clean($\_POST['regularPrice']) : '0'; |
  |  | 525 | $salePrice = isset($\_POST['salePrice']) ? wc\_clean($\_POST['salePrice']) : '0'; |
  |  | 526 | $quantity = isset($\_POST['quantity']) ? wc\_clean($\_POST['quantity']) : '0'; |
  |  | 527 | $postStatus = isset($\_POST['postStatus']) ? wc\_clean($\_POST['postStatus']) : 'draft'; |
  |  | 528 | $variations = isset($\_POST['variations']) ? wc\_clean($\_POST['variations']) : array(); |
  |  | 529 | $attributes = isset($\_POST['attributes']) ? wc\_clean($\_POST['attributes']) : array(); |
  |  | 530 | $productUrl = isset($\_POST['productUrl']) ? wc\_clean($\_POST['productUrl']) : ''; |
  |  | 531 | $shortDescription = isset($\_POST['shortDescription']) ? wc\_clean($\_POST['shortDescription']) : ''; |
  |  | 532 | $importVariationImages = isset($\_POST['importVariationImages']) ? wc\_clean($\_POST['importVariationImages']) : ''; |
  |  | 533 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  |  | 534 | $tags = isset($\_POST['tags']) ? wc\_clean($\_POST['tags']) : array(); |
  |  | 535 | $isFeatured = isset($\_POST['isFeatured']) ? true : false; |
  |  | 536 |  |
  |  | 537 |  |
  |  | 538 |  |
  |  | 539 | $currentImportedNumber = get\_option('isAllowedToImport\_alibay'); |
  |  | 540 | if (isset($currentImportedNumber)) { |
  |  | 541 | $finalCounter = (int) $currentImportedNumber + 1; |
  |  | 542 | update\_option('isAllowedToImport\_alibay',   $finalCounter); |
  |  | 543 | } else { |
  |  | 544 | update\_option('isAllowedToImport\_alibay',   '1'); |
  |  | 545 | } |
  |  | 546 |  |
  |  | 547 | if (null != get\_option('isAllowedToImport\_alibay') && (int) get\_option('isAllowedToImport\_alibay') > 200) { |
  |  | 548 | $results = array('error' => true, 'error\_msg' => 'you have reached the permitted usage limit for this week you can upgrade to a premuim plan', 'data' => ''); |
  |  | 549 | wp\_send\_json($results); |
  |  | 550 | } |
  |  | 551 |  |
  |  | 552 |  |
  |  | 553 |  |
  |  | 554 | // if ($productType == 'simple') { |
  |  | 555 | if ($productType == 'simple') { |
  |  | 556 |  |
  |  | 557 | $product = new WC\_Product\_Simple(); |
  |  | 558 |  |
  |  | 559 | if (isset($title)) { |
  |  | 560 | $product->set\_name($title); |
  |  | 561 | } |
  |  | 562 | if (isset($description)) { |
  |  | 563 | $product->set\_description($description); |
  |  | 564 | } |
  |  | 565 | if (isset($shortDescription)) { |
  |  | 566 | $product->set\_short\_description($shortDescription); |
  |  | 567 | } |
  | 236 | 568 |  |
  | 237 | 569 | if (isset($sku)) { |
  | 238 | 570 | $product->set\_sku($sku); |
  | 239 | 571 | } |
  | 240 |  | } catch (Exception $ex) { |
  | 241 |  | /\* ERROR LIKE "SKU ALREADY EXISTS" \*/ |
  |  | 572 |  |
  |  | 573 | if (isset($postStatus)) { |
  |  | 574 | $product->set\_status($postStatus); |
  |  | 575 | } |
  |  | 576 |  |
  |  | 577 | if (isset($isFeatured)) { |
  |  | 578 | $product->set\_featured(true); // Set to true to make it featured |
  |  | 579 | } |
  |  | 580 |  |
  |  | 581 | if (isset($regularPrice)) { |
  |  | 582 | $product->set\_regular\_price($regularPrice); |
  |  | 583 | $product->set\_price($regularPrice); |
  |  | 584 | } |
  |  | 585 |  |
  |  | 586 | if (isset($salePrice)) { |
  |  | 587 | $product->set\_sale\_price($salePrice); |
  |  | 588 | // $product->set\_price($salePrice); |
  |  | 589 | } |
  |  | 590 |  |
  |  | 591 | if (isset($quantity)) { |
  |  | 592 | $product->set\_stock\_quantity($quantity); |
  |  | 593 | $product->set\_manage\_stock(true); |
  |  | 594 | } |
  |  | 595 |  |
  |  | 596 |  |
  |  | 597 |  |
  |  | 598 |  |
  |  | 599 | $imageUploadErrors = theSharkAliExpress\_save\_product\_images\_for\_ebay\_alibay($product, $images); |
  |  | 600 |  |
  |  | 601 |  |
  |  | 602 |  |
  |  | 603 |  |
  |  | 604 | try { |
  |  | 605 | $post\_id = $product->save(); |
  |  | 606 | } catch (Exception $e) { |
  |  | 607 | $results = array( |
  |  | 608 | 'error' => false, |
  |  | 609 | 'error\_msg' => '', |
  |  | 610 | 'data' => 'Product inserted successfully', |
  |  | 611 | 'postId' => $post\_id, |
  |  | 612 | 'imageUploadErrors' => $imageUploadErrors // Add image upload errors to the response |
  |  | 613 | ); |
  |  | 614 | wp\_send\_json($results); |
  |  | 615 | } |
  |  | 616 |  |
  |  | 617 |  |
  |  | 618 |  |
  |  | 619 | if (isset($productUrl)) { |
  |  | 620 | update\_post\_meta($post\_id, 'productUrl', $productUrl); |
  |  | 621 | } |
  |  | 622 | if (isset($selectedCurrency)) { |
  |  | 623 | update\_post\_meta($post\_id, 'selectedCurrency', $selectedCurrency); |
  |  | 624 | } |
  |  | 625 |  |
  |  | 626 |  |
  |  | 627 |  |
  |  | 628 | if (isset($post\_id) && isset($tags) && count($tags)) { |
  |  | 629 | wp\_set\_post\_tags($post\_id, $tags, true); |
  |  | 630 | wp\_set\_object\_terms($post\_id, $tags, 'product\_tag'); |
  |  | 631 | } |
  |  | 632 |  |
  |  | 633 | $lastUpdatedDate = current\_time('mysql', 1); |
  |  | 634 | update\_post\_meta($post\_id, 'lastUpdatedDate', $lastUpdatedDate); |
  |  | 635 |  |
  |  | 636 |  |
  |  | 637 |  |
  |  | 638 | $product\_attributes = array(); |
  |  | 639 | if (is\_array($attributes) && count($attributes)) { |
  |  | 640 | foreach ($attributes as $attribute\_data) { |
  |  | 641 | $attribute\_name = sanitize\_title($attribute\_data['name']); |
  |  | 642 | $attribute\_values = array\_map('sanitize\_title', $attribute\_data['values']); |
  |  | 643 |  |
  |  | 644 | $attribute\_id = wc\_attribute\_taxonomy\_id\_by\_name($attribute\_name); |
  |  | 645 |  |
  |  | 646 | if (!$attribute\_id) { |
  |  | 647 | $attribute\_id = wc\_create\_attribute(array( |
  |  | 648 | 'name' => $attribute\_name, |
  |  | 649 | 'slug' => $attribute\_name, |
  |  | 650 | 'type' => 'select', // 'select' for dropdown, 'text' for text field, etc. |
  |  | 651 | 'order\_by' => 'menu\_order', // You can adjust this order if needed |
  |  | 652 | 'has\_archives' => true, |
  |  | 653 | )); |
  |  | 654 | } |
  |  | 655 |  |
  |  | 656 | if ($attribute\_id && !empty($attribute\_values)) { |
  |  | 657 | wp\_set\_object\_terms($post\_id, $attribute\_values, 'pa\_' . $attribute\_name); |
  |  | 658 | } |
  |  | 659 |  |
  |  | 660 | $product\_attributes['pa\_' . $attribute\_name] = array( |
  |  | 661 | 'name' => 'pa\_' . $attribute\_name, |
  |  | 662 | 'value' => implode(',', $attribute\_values), |
  |  | 663 | 'position' => 0, |
  |  | 664 | 'is\_visible' => 1, |
  |  | 665 | 'is\_variation' => $attribute\_data['variation'] ? 1 : 0, |
  |  | 666 | 'is\_taxonomy' => 1, |
  |  | 667 | ); |
  |  | 668 | } |
  |  | 669 | update\_post\_meta($post\_id, '\_product\_attributes', $product\_attributes); |
  |  | 670 | } |
  |  | 671 |  |
  |  | 672 |  |
  |  | 673 |  |
  |  | 674 | $category\_ids = theSharkAliExpress\_create\_woocommerce\_categories\_and\_get\_ids\_alibay($remoteCategories); |
  |  | 675 | $merged\_category\_ids = array\_merge($categories, $category\_ids); |
  |  | 676 |  |
  |  | 677 |  |
  |  | 678 | if (is\_array($merged\_category\_ids) && count($merged\_category\_ids)) { |
  |  | 679 |  |
  |  | 680 | wp\_set\_post\_terms($post\_id, $merged\_category\_ids, 'product\_cat'); |
  |  | 681 | } |
  |  | 682 | $currentImportCount = get\_option('alibay\_daily\_import\_count', 0); |
  |  | 683 | update\_option('alibay\_daily\_import\_count', ++$currentImportCount); |
  |  | 684 |  |
  |  | 685 |  |
  |  | 686 | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  |  | 687 |  |
  |  | 688 | foreach ($reviews as $review) { |
  |  | 689 | $comment\_id = wp\_insert\_comment(array( |
  |  | 690 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 691 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 692 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  |  | 693 | 'comment\_author\_url'   => '', |
  |  | 694 | 'comment\_content'      => $review['review'], |
  |  | 695 | 'comment\_type'         => '', |
  |  | 696 | 'comment\_parent'       => 0, |
  |  | 697 | 'user\_id'              => 5, // <== Important |
  |  | 698 | 'comment\_author\_IP'    => '', |
  |  | 699 | 'comment\_agent'        => '', |
  |  | 700 | 'comment\_date'         => $review['datecreation'], |
  |  | 701 | 'comment\_approved'     => 1, |
  |  | 702 | )); |
  |  | 703 |  |
  |  | 704 | // HERE inserting the rating (an integer from 1 to 5) |
  |  | 705 | update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  |  | 706 | } |
  |  | 707 | } |
  |  | 708 |  |
  |  | 709 |  |
  |  | 710 |  |
  |  | 711 |  |
  |  | 712 | // variations |
  | 242 | 713 | $results = array( |
  | 243 |  | 'error' => true, |
  | 244 |  | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  | 245 |  | 'data' => '' |
  |  | 714 | 'error' => false, |
  |  | 715 | 'error\_msg' => '', |
  |  | 716 | 'data' => 'Product inserted successfully', |
  |  | 717 | 'postId' => $post\_id |
  |  | 718 |  |
  | 246 | 719 | ); |
  | 247 | 720 | wp\_send\_json($results); |
  | 248 |  | } |
  | 249 |  |  |
  | 250 |  | if (isset($postStatus)) { |
  | 251 |  | $product->set\_status($postStatus); |
  | 252 |  | } |
  | 253 |  |  |
  | 254 |  |  |
  | 255 |  | //   //categories |
  | 256 |  | if (is\_array($categories) && count($categories)) { |
  | 257 |  | $product->set\_category\_ids($categories); |
  | 258 |  | } |
  | 259 |  | //images |
  | 260 |  |  |
  | 261 |  |  |
  | 262 |  | wads\_save\_product\_images($product, $images); |
  | 263 |  |  |
  | 264 |  | // if (is\_array($images) && count($images)) { |
  | 265 |  | //   $attarray = array(); |
  | 266 |  | //   for ($j = 0; $j < count($images); $j++) { |
  | 267 |  | //     array\_push($attarray,  upload\_image($images[$j], $post\_id)); |
  | 268 |  | //   } |
  | 269 |  | //   // set\_post\_thumbnail($post\_id, $attarray[0]); |
  | 270 |  | //   $product->set\_image\_id($attarray[0]); |
  | 271 |  | //   if (sizeof($attarray) > 1) { |
  | 272 |  | //     array\_shift($attarray); //removes first item of the array (because it's been set as the featured image already) |
  | 273 |  | //     $product->set\_gallery\_image\_ids($attarray); //set the images id's left over after the array shift as the gallery images |
  | 274 |  | //   } |
  | 275 |  | // } |
  | 276 |  |  |
  | 277 |  |  |
  | 278 |  | }else if(isset($productType) && $productType == 'external'){ |
  | 279 |  |  |
  | 280 |  |  |
  |  | 721 | // if (isset($post\_id)) { |
  |  | 722 | //   // |
  |  | 723 | // } |
  |  | 724 | // } else { |
  |  | 725 | //   $response['message'] = $post\_id->get\_error\_message(); |
  |  | 726 | //   wp\_send\_json($response); |
  |  | 727 | // } |
  |  | 728 | } else { |
  |  | 729 | /\*--------VARIABLE------\*/ |
  |  | 730 | /\*--------VARIABLE------\*/ |
  |  | 731 | /\*---------VARIABLE-----\*/ |
  |  | 732 | /\*---------VARIABLE-----\*/ |
  |  | 733 | /\*----------VARIABLE----\*/ |
  |  | 734 | /\*----------VARIABLE----\*/ |
  |  | 735 | /\*----------VARIABLE----\*/ |
  |  | 736 | /\*-------VARIABLE-------\*/ |
  |  | 737 | /\*---------VARIABLE-----\*/ |
  |  | 738 | /\*--------VARIABLE------\*/ |
  |  | 739 | /\*--------VARIABLE------\*/ |
  |  | 740 | /\*--------VARIABLE------\*/ |
  |  | 741 | /\*----------VARIABLE----\*/ |
  |  | 742 |  |
  | 281 | 743 | //Create main product |
  | 282 |  | $product = new WC\_Product\_External(); |
  | 283 |  |  |
  | 284 |  | if (isset($title)) { |
  | 285 |  | $product->set\_name($title); |
  | 286 |  | } |
  | 287 |  | if (isset($description)) { |
  | 288 |  | $product->set\_description($description); |
  | 289 |  | } |
  | 290 |  | if (isset($shortDescription)) { |
  | 291 |  | $product->set\_short\_description($shortDescription); |
  | 292 |  | } |
  | 293 |  |  |
  | 294 |  | if (isset($regularPrice)) { |
  | 295 |  | $product->set\_regular\_price($regularPrice); |
  | 296 |  | } |
  | 297 |  |  |
  | 298 |  | if (isset($salePrice)) { |
  | 299 |  | $product->set\_sale\_price($salePrice); |
  | 300 |  | } |
  | 301 |  | if (isset($productUrl)) { |
  | 302 |  | $product->set\_product\_url($productUrl); |
  | 303 |  | } |
  | 304 |  |  |
  | 305 |  |  |
  | 306 |  | try { |
  | 307 |  |  |
  | 308 |  | if (isset($sku)) { |
  | 309 |  | $product->set\_sku($sku); |
  | 310 |  | } |
  | 311 |  | } catch (Exception $ex) { |
  | 312 |  | /\* ERROR LIKE "SKU ALREADY EXISTS" \*/ |
  | 313 |  | $results = array( |
  | 314 |  | 'error' => true, |
  | 315 |  | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  | 316 |  | 'data' => '' |
  | 317 |  | ); |
  | 318 |  | wp\_send\_json($results); |
  | 319 |  | } |
  | 320 |  |  |
  | 321 |  | if (isset($postStatus)) { |
  | 322 |  | $product->set\_status($postStatus); |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  |  |
  | 326 |  | //   //categories |
  | 327 |  | if (is\_array($categories) && count($categories)) { |
  | 328 |  | $product->set\_category\_ids($categories); |
  | 329 |  | } |
  | 330 |  | //images |
  | 331 |  |  |
  | 332 |  |  |
  | 333 |  | wads\_save\_product\_images($product, $images); |
  | 334 |  |  |
  | 335 |  | // if (is\_array($images) && count($images)) { |
  | 336 |  | //         $attarray = array(); |
  | 337 |  | //         for ($j = 0; $j < count($images); $j++) { |
  | 338 |  | //           array\_push($attarray,  upload\_image($images[$j], $post\_id)); |
  | 339 |  | //         } |
  | 340 |  | //         // set\_post\_thumbnail($post\_id, $attarray[0]); |
  | 341 |  | //         $product->set\_image\_id($attarray[0]); |
  | 342 |  | //         if (sizeof($attarray) > 1) { |
  | 343 |  | //           array\_shift($attarray); //removes first item of the array (because it's been set as the featured image already) |
  | 344 |  | //           $product->set\_gallery\_image\_ids($attarray); //set the images id's left over after the array shift as the gallery images |
  | 345 |  | //         } |
  | 346 |  | //       } |
  | 347 |  |  |
  | 348 |  |  |
  | 349 |  | } else{ |
  | 350 |  |  |
  | 351 |  |  |
  | 352 |  | try { |
  | 353 |  | $product = new WC\_Product\_Variable(); |
  | 354 |  | if (isset($title)) { |
  | 355 |  | $product->set\_name($title); |
  | 356 |  | } |
  | 357 |  | if (isset($description)) { |
  | 358 |  | $product->set\_description($description); |
  | 359 |  | } |
  | 360 |  | if (isset($shortDescription)) { |
  | 361 |  | $product->set\_short\_description($shortDescription); |
  | 362 |  | } |
  | 363 |  |  |
  | 364 |  | try { |
  | 365 |  |  |
  | 366 |  | if (isset($sku)) { |
  | 367 |  | $product->set\_sku($sku); |
  | 368 |  | } |
  | 369 |  | } catch (Exception $ex) { |
  | 370 |  | /\* ERROR LIKE "SKU ALREADY EXISTS" \*/ |
  |  | 744 |  |
  |  | 745 | try { |
  |  | 746 | $product = new WC\_Product\_Variable(); |
  |  | 747 | if (isset($title)) { |
  |  | 748 | $product->set\_name($title); |
  |  | 749 | } |
  |  | 750 | if (isset($description)) { |
  |  | 751 | $product->set\_description($description); |
  |  | 752 | } |
  |  | 753 | if (isset($shortDescription)) { |
  |  | 754 | $product->set\_short\_description($shortDescription); |
  |  | 755 | } |
  |  | 756 |  |
  |  | 757 | if (isset($isFeatured)) { |
  |  | 758 | $product->set\_featured(true); // Set to true to make it featured |
  |  | 759 | } |
  |  | 760 |  |
  |  | 761 | if (isset($sku)) { |
  |  | 762 | $product->set\_sku($sku); |
  |  | 763 | } |
  |  | 764 |  |
  |  | 765 | if (isset($postStatus)) { |
  |  | 766 | $product->set\_status($postStatus); |
  |  | 767 | } |
  |  | 768 |  |
  |  | 769 |  |
  |  | 770 | //   //categories |
  |  | 771 | if (is\_array($categories) && count($categories)) { |
  |  | 772 | $product->set\_category\_ids($categories); |
  |  | 773 | } |
  |  | 774 | //images |
  |  | 775 |  |
  |  | 776 | $imageUploadErrors =   theSharkAliExpress\_save\_product\_images\_for\_ebay\_alibay($product, $images); |
  |  | 777 |  |
  |  | 778 |  |
  |  | 779 |  |
  |  | 780 | $attributeArray = array(); |
  |  | 781 | if (is\_array($attributes) && count($attributes)) { |
  |  | 782 | foreach ($attributes as $attributeValue) { |
  |  | 783 | $values = $attributeValue['values']; |
  |  | 784 | $attr\_label = $attributeValue['name']; |
  |  | 785 | $isVariation = $attributeValue['variation']; |
  |  | 786 |  |
  |  | 787 | //Create the attribute object |
  |  | 788 | $attribute = new WC\_Product\_Attribute(); |
  |  | 789 |  |
  |  | 790 | //pa\_size tax id |
  |  | 791 | // $attribute->set\_id(0); // -> SET to 0 |
  |  | 792 |  |
  |  | 793 | //pa\_size slug |
  |  | 794 | $attribute->set\_name($attr\_label); // -> removed 'pa\_' prefix |
  |  | 795 |  |
  |  | 796 | //Set terms slugs |
  |  | 797 | $attribute->set\_options($values); |
  |  | 798 |  |
  |  | 799 | //If enabled |
  |  | 800 | $attribute->set\_visible(1); |
  |  | 801 |  |
  |  | 802 | //If we are going to use attribute in order to generate variations |
  |  | 803 | // $attribute->set\_variation(1); |
  |  | 804 |  |
  |  | 805 | if ($isVariation == 'true') { |
  |  | 806 | $attribute->set\_variation(1); |
  |  | 807 | } else { |
  |  | 808 | $attribute->set\_variation(0); |
  |  | 809 | } |
  |  | 810 |  |
  |  | 811 | array\_push($attributeArray, $attribute); |
  |  | 812 | } |
  |  | 813 | $product->set\_attributes($attributeArray); |
  |  | 814 | } else { |
  |  | 815 | $results = array( |
  |  | 816 | 'error' => false, |
  |  | 817 | 'error\_msg' => '', |
  |  | 818 | 'data' => 'Product inserted successfully', |
  |  | 819 | 'postId' => $post\_id, |
  |  | 820 | 'imageUploadErrors' => $imageUploadErrors // Add image upload errors to the response |
  |  | 821 | ); |
  |  | 822 | wp\_send\_json($results); |
  |  | 823 | } |
  |  | 824 | } catch (Exception $ex) { |
  |  | 825 | /\* ERROR LIKE "SKU ALREADY EXISTS" \*/ |
  |  | 826 | $results = array( |
  |  | 827 | 'error' => true, |
  |  | 828 | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  |  | 829 | 'data' => '' |
  |  | 830 | ); |
  |  | 831 | wp\_send\_json($results); |
  |  | 832 | } |
  |  | 833 |  |
  |  | 834 |  |
  |  | 835 | try { |
  |  | 836 | $post\_id = $product->save(); |
  |  | 837 | } catch (Exception $e) { |
  |  | 838 | $results = array( |
  |  | 839 | 'error' => true, |
  |  | 840 | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  |  | 841 | 'data' => '' |
  |  | 842 | ); |
  |  | 843 | wp\_send\_json($results); |
  |  | 844 | } |
  |  | 845 | if (isset($productUrl)) { |
  |  | 846 | update\_post\_meta($post\_id, 'productUrl', $productUrl); |
  |  | 847 | } |
  |  | 848 |  |
  |  | 849 | if (isset($selectedCurrency)) { |
  |  | 850 | update\_post\_meta($post\_id, 'selectedCurrency', $selectedCurrency); |
  |  | 851 | } |
  |  | 852 |  |
  |  | 853 | $lastUpdatedDate = current\_time('mysql', 1); |
  |  | 854 | update\_post\_meta($post\_id, 'lastUpdatedDate', $lastUpdatedDate); |
  |  | 855 |  |
  |  | 856 | if (is\_array($variations) && count($variations)) { |
  |  | 857 | array\_splice($variations, 1); |
  |  | 858 |  |
  |  | 859 | foreach ($variations as $variation) { |
  |  | 860 |  |
  |  | 861 | $attributesVariations = $variation['attributesVariations']; |
  |  | 862 | $variationToCreate = new WC\_Product\_Variation(); |
  |  | 863 | // $variationToCreate->set\_regular\_price(10); |
  |  | 864 | $variationToCreate->set\_parent\_id($post\_id); |
  |  | 865 | if (isset($variation['SKU']) && !empty($variation['SKU'])) { |
  |  | 866 | $variationToCreate->set\_sku($variation['SKU']); |
  |  | 867 | } |
  |  | 868 | if (!empty(sanitize\_text\_field($variation['regularPrice']))) { |
  |  | 869 | $variationToCreate->set\_regular\_price($variation['regularPrice']); |
  |  | 870 | } |
  |  | 871 |  |
  |  | 872 | if (!empty(sanitize\_text\_field($variation['salePrice']))) { |
  |  | 873 | $variationToCreate->set\_sale\_price($variation['salePrice']); |
  |  | 874 | } |
  |  | 875 |  |
  |  | 876 | //set image id |
  |  | 877 | // if (!empty(sanitize\_text\_field($variation['salePrice']))) { |
  |  | 878 | //   $variationToCreate->set\_image\_id($variation['salePrice']); |
  |  | 879 | // } |
  |  | 880 |  |
  |  | 881 |  |
  |  | 882 |  |
  |  | 883 |  |
  |  | 884 |  |
  |  | 885 | $stockProduct = sanitize\_text\_field($variation['availQuantity']); |
  |  | 886 | if (isset($stockProduct)) { |
  |  | 887 | $variationToCreate->set\_manage\_stock(true); |
  |  | 888 | $variationToCreate->set\_stock\_quantity($stockProduct); |
  |  | 889 | $variationToCreate->set\_stock\_status('instock'); |
  |  | 890 | } |
  |  | 891 | $variationsArray = array(); |
  |  | 892 | foreach ($attributesVariations as $attributesVariation) { |
  |  | 893 | $variationsArray[$attributesVariation['name']] = $attributesVariation['value']; |
  |  | 894 |  |
  |  | 895 | $arrayImageId = array(); |
  |  | 896 | if (($importVariationImages == 'true')) { |
  |  | 897 | // wp\_send\_json($importVariationImages); |
  |  | 898 |  |
  |  | 899 | $imageVariations = $attributesVariation['image']; |
  |  | 900 | if (isset($imageVariations)) { |
  |  | 901 | $imageId = false; |
  |  | 902 | foreach ($arrayImageId as $imageObject) { |
  |  | 903 | if ($imageObject->imageVariations == $imageVariations) { |
  |  | 904 | $imageId = $imageObject->id; |
  |  | 905 | break; |
  |  | 906 | } |
  |  | 907 | } |
  |  | 908 | if ($imageId != false) { |
  |  | 909 | $variationToCreate->set\_image\_id($imageId); |
  |  | 910 | } else { |
  |  | 911 | $imageIdVariation  =  theSharkAliExpress\_save\_single\_variation\_image\_alibay($variationToCreate, $imageVariations); |
  |  | 912 | array\_push($arrayImageId, array('image' => $imageVariations, 'id' => $imageIdVariation)); |
  |  | 913 | if (isset($imageIdVariation)) { |
  |  | 914 | $variationToCreate->set\_image\_id($imageIdVariation); |
  |  | 915 | } |
  |  | 916 | } |
  |  | 917 | } |
  |  | 918 | } |
  |  | 919 | }; |
  |  | 920 | // wp\_send\_json(array('variationsArray' =\\÷/> $variationsArray, 'ttt' => $attributesVariation['value'])); |
  |  | 921 |  |
  |  | 922 | $variationToCreate->set\_attributes($variationsArray); |
  |  | 923 | try { |
  |  | 924 | $variationToCreate->save(); |
  |  | 925 | } catch (Exception $e) { |
  |  | 926 | echo \_\_('Error while saving variation'); |
  |  | 927 | } |
  |  | 928 | } |
  |  | 929 | } |
  |  | 930 |  |
  |  | 931 |  |
  |  | 932 | if (isset($post\_id) && isset($tags) && count($tags)) { |
  |  | 933 | wp\_set\_post\_tags($post\_id, $tags, true); |
  |  | 934 | wp\_set\_object\_terms($post\_id, $tags, 'product\_tag'); |
  |  | 935 | } |
  |  | 936 |  |
  |  | 937 | $category\_ids = theSharkAliExpress\_create\_woocommerce\_categories\_and\_get\_ids\_alibay($remoteCategories); |
  |  | 938 | $merged\_category\_ids = array\_merge($categories, $category\_ids); |
  |  | 939 |  |
  |  | 940 |  |
  |  | 941 | if (is\_array($merged\_category\_ids) && count($merged\_category\_ids)) { |
  |  | 942 |  |
  |  | 943 | wp\_set\_post\_terms($post\_id, $merged\_category\_ids, 'product\_cat'); |
  |  | 944 | } |
  |  | 945 |  |
  |  | 946 |  |
  |  | 947 | $currentImportCount = get\_option('alibay\_daily\_import\_count', 0); |
  |  | 948 | update\_option('alibay\_daily\_import\_count', ++$currentImportCount); |
  |  | 949 | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  |  | 950 |  |
  |  | 951 | foreach ($reviews as $review) { |
  |  | 952 | $comment\_id = wp\_insert\_comment(array( |
  |  | 953 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 954 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 955 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  |  | 956 | 'comment\_author\_url'   => '', |
  |  | 957 | 'comment\_content'      => $review['review'], |
  |  | 958 | 'comment\_type'         => '', |
  |  | 959 | 'comment\_parent'       => 0, |
  |  | 960 | 'user\_id'              => 5, // <== Important |
  |  | 961 | 'comment\_author\_IP'    => '', |
  |  | 962 | 'comment\_agent'        => '', |
  |  | 963 | 'comment\_date'         => $review['datecreation'], |
  |  | 964 | 'comment\_approved'     => 1, |
  |  | 965 | )); |
  |  | 966 |  |
  |  | 967 | // HERE inserting the rating (an integer from 1 to 5) |
  |  | 968 | update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  |  | 969 | } |
  |  | 970 | } |
  |  | 971 |  |
  |  | 972 |  |
  |  | 973 |  |
  |  | 974 |  |
  |  | 975 |  |
  |  | 976 | // wp\_send\_json($variations); |
  |  | 977 |  |
  |  | 978 |  |
  | 371 | 979 | $results = array( |
  | 372 |  | 'error' => true, |
  | 373 |  | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  | 374 |  | 'data' => '' |
  |  | 980 | 'error' => false, |
  |  | 981 | 'error\_msg' => '', |
  |  | 982 | 'data' => 'Product inserted successfully', |
  |  | 983 | 'postId' => $post\_id, |
  |  | 984 | 'imageUploadErrors' => $imageUploadErrors // Add image upload errors to the response |
  | 375 | 985 | ); |
  | 376 | 986 | wp\_send\_json($results); |
  | 377 | 987 | } |
  | 378 |  |  |
  | 379 |  | if (isset($postStatus)) { |
  | 380 |  | $product->set\_status($postStatus); |
  | 381 |  | } |
  | 382 |  |  |
  | 383 |  |  |
  | 384 |  | //   //categories |
  | 385 |  | if (is\_array($categories) && count($categories)) { |
  | 386 |  | $product->set\_category\_ids($categories); |
  | 387 |  | } |
  | 388 |  | //images |
  | 389 |  |  |
  | 390 |  |  |
  | 391 |  | wads\_save\_product\_images($product, $images); |
  | 392 |  |  |
  | 393 |  | // if (is\_array($images) && count($images)) { |
  | 394 |  | //   $attarray = array(); |
  | 395 |  | //   for ($j = 0; $j < count($images); $j++) { |
  | 396 |  | //     array\_push($attarray,  upload\_image($images[$j], $post\_id)); |
  | 397 |  | //   } |
  | 398 |  | //   // set\_post\_thumbnail($post\_id, $attarray[0]); |
  | 399 |  | //   $product->set\_image\_id($attarray[0]); |
  | 400 |  | //   if (sizeof($attarray) > 1) { |
  | 401 |  | //     array\_shift($attarray); //removes first item of the array (because it's been set as the featured image already) |
  | 402 |  | //     $product->set\_gallery\_image\_ids($attarray); //set the images id's left over after the array shift as the gallery images |
  | 403 |  | //   } |
  | 404 |  | // } |
  | 405 |  |  |
  | 406 |  | $attributeArray = array(); |
  | 407 |  | if (is\_array($attributes) && count($attributes)) { |
  | 408 |  | foreach ($attributes as $attributeValue) { |
  | 409 |  | $values = $attributeValue['values']; |
  | 410 |  | $attr\_label = $attributeValue['name']; |
  | 411 |  | $isVariation = $attributeValue['variation']; |
  | 412 |  |  |
  | 413 |  | //Create the attribute object |
  | 414 |  | $attribute = new WC\_Product\_Attribute(); |
  | 415 |  |  |
  | 416 |  | //pa\_size tax id |
  | 417 |  | // $attribute->set\_id(0); // -> SET to 0 |
  | 418 |  |  |
  | 419 |  | //pa\_size slug |
  | 420 |  | $attribute->set\_name($attr\_label); // -> removed 'pa\_' prefix |
  | 421 |  |  |
  | 422 |  | //Set terms slugs |
  | 423 |  | $attribute->set\_options($values); |
  | 424 |  |  |
  | 425 |  | //If enabled |
  | 426 |  | $attribute->set\_visible(1); |
  | 427 |  |  |
  | 428 |  | //If we are going to use attribute in order to generate variations |
  | 429 |  | // $attribute->set\_variation(1); |
  | 430 |  |  |
  | 431 |  | if ($isVariation == 'true') { |
  | 432 |  | $attribute->set\_variation(1); |
  | 433 |  | } else { |
  | 434 |  | $attribute->set\_variation(0); |
  | 435 |  | } |
  | 436 |  |  |
  | 437 |  | array\_push($attributeArray, $attribute); |
  | 438 |  | } |
  | 439 |  | $product->set\_attributes($attributeArray); |
  | 440 |  | } else { |
  | 441 |  | $results = array( |
  | 442 |  | 'error' => true, |
  | 443 |  | 'error\_msg' => 'Missing attributes or variations, could not insert product ', |
  | 444 |  | 'data' => '' |
  | 445 |  | ); |
  | 446 |  | wp\_send\_json($results); |
  | 447 |  | } |
  | 448 |  | } catch (Exception $ex) { |
  | 449 |  | /\* ERROR LIKE "SKU ALREADY EXISTS" \*/ |
  | 450 |  | $results = array( |
  | 451 |  | 'error' => true, |
  | 452 |  | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  | 453 |  | 'data' => '' |
  | 454 |  | ); |
  | 455 |  | wp\_send\_json($results); |
  | 456 |  | } |
  | 457 |  | } |
  | 458 |  |  |
  | 459 |  | try { |
  | 460 |  | $post\_id = $product->save(); |
  | 461 |  |  |
  | 462 |  | // wads\_save\_product\_images($product, $images); |
  | 463 |  |  |
  | 464 |  | // if (is\_array($images) && count($images)) { |
  | 465 |  | //         $attarray = array(); |
  | 466 |  | //         for ($j = 0; $j < count($images); $j++) { |
  | 467 |  | //           array\_push($attarray,  upload\_image($images[$j], $post\_id)); |
  | 468 |  | //         } |
  | 469 |  | //         // set\_post\_thumbnail($post\_id, $attarray[0]); |
  | 470 |  | //         $product->set\_image\_id($attarray[0]); |
  | 471 |  | //         if (sizeof($attarray) > 1) { |
  | 472 |  | //           array\_shift($attarray); //removes first item of the array (because it's been set as the featured image already) |
  | 473 |  | //           $product->set\_gallery\_image\_ids($attarray); //set the images id's left over after the array shift as the gallery images |
  | 474 |  | //         } |
  | 475 |  | //       } |
  | 476 |  |  |
  | 477 |  | } catch (Exception $e) { |
  | 478 |  | $results = array( |
  | 479 |  | 'error' => true, |
  | 480 |  | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  | 481 |  | 'data' => '' |
  | 482 |  | ); |
  | 483 |  | wp\_send\_json($results); |
  | 484 |  | } |
  | 485 |  |  |
  | 486 |  | if (isset($productUrl)) { |
  | 487 |  | // $promotedUrm = 'https://alitems.site/g/1e8d114494bee1754d1816525dc3e8/?ulp=' . urlencode($productUrl); |
  | 488 |  | update\_post\_meta($post\_id, 'productUrl', $productUrl); |
  | 489 |  | } |
  | 490 |  | // https://alitems.site/g/1e8d114494bee1754d1816525dc3e8/?ulp=https%3A%2F%2Faliexpress.com%2Fitem%2F2255800758990879.html |
  | 491 |  |  |
  | 492 |  |  |
  | 493 |  |  |
  | 494 |  | if (isset($post\_id) && isset($tags) && count($tags)) { |
  | 495 |  | // wp\_set\_post\_tags( $post\_id, $tags, true ); |
  | 496 |  | wp\_set\_object\_terms($post\_id, $tags, 'product\_tag'); |
  | 497 |  | } |
  | 498 |  |  |
  | 499 |  | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  | 500 |  |  |
  | 501 |  | foreach ($reviews as $review) { |
  | 502 |  | $comment\_id = wp\_insert\_comment(array( |
  | 503 |  | 'comment\_post\_ID'      => wc\_clean($post\_id), // <=== The product ID where the review will show up |
  | 504 |  | 'comment\_author'       => wc\_clean($review['username']), |
  | 505 |  | 'comment\_author\_email' => wc\_clean($review['email']), // <== Important |
  | 506 |  | 'comment\_author\_url'   => '', |
  | 507 |  | 'comment\_content'      => $review['review'], |
  | 508 |  | 'comment\_type'         => '', |
  | 509 |  | 'comment\_parent'       => 0, |
  | 510 |  | 'user\_id'              => 5, // <== Important |
  | 511 |  | 'comment\_author\_IP'    => '', |
  | 512 |  | 'comment\_agent'        => '', |
  | 513 |  | 'comment\_date'         => $review['datecreation'], |
  | 514 |  | 'comment\_approved'     => 1, |
  | 515 |  | )); |
  | 516 |  |  |
  | 517 |  | // HERE inserting the rating (an integer from 1 to 5) |
  | 518 |  | update\_comment\_meta($comment\_id, 'rating', wc\_clean($review['rating'])); |
  | 519 |  | } |
  | 520 |  | } |
  | 521 |  |  |
  | 522 |  |  |
  | 523 |  |  |
  | 524 |  |  |
  | 525 |  |  |
  | 526 |  | // wp\_send\_json($variations); |
  | 527 |  |  |
  | 528 |  | if (is\_array($variations) && count($variations)) { |
  | 529 |  | array\_splice($variations, 1); |
  | 530 |  | foreach ($variations as $variation) { |
  | 531 |  |  |
  | 532 |  | $attributesVariations = $variation['attributesVariations']; |
  | 533 |  | $variationToCreate = new WC\_Product\_Variation(); |
  | 534 |  | // $variationToCreate->set\_regular\_price(10); |
  | 535 |  | $variationToCreate->set\_parent\_id($post\_id); |
  | 536 |  | if (!empty($variation['SKU'])) { |
  | 537 |  | $variationToCreate->set\_sku($variation['SKU']); |
  | 538 |  | } |
  | 539 |  | if (!empty(wc\_clean($variation['regularPrice']))) { |
  | 540 |  | $variationToCreate->set\_regular\_price(wc\_clean($variation['regularPrice'])); |
  | 541 |  | } |
  | 542 |  |  |
  | 543 |  | if (!empty(wc\_clean($variation['salePrice']))) { |
  | 544 |  | $variationToCreate->set\_sale\_price(wc\_clean($variation['salePrice'])); |
  | 545 |  | } |
  | 546 |  |  |
  | 547 |  |  |
  | 548 |  | $stockProduct = wc\_clean($variation['availQuantity']); |
  | 549 |  | if (isset($stockProduct)) { |
  | 550 |  | $variationToCreate->set\_manage\_stock(true); |
  | 551 |  | $variationToCreate->set\_stock\_quantity($stockProduct); |
  | 552 |  | $variationToCreate->set\_stock\_status('instock'); |
  | 553 |  | } |
  | 554 |  | $variationsArray = array(); |
  | 555 |  | foreach ($attributesVariations as $attributesVariation) { |
  | 556 |  | $variationsArray[$attributesVariation['name']] = $attributesVariation['value']; |
  | 557 |  |  |
  | 558 |  | $arrayImageId = array(); |
  | 559 |  | if (($importVariationImages == 'true')) { |
  | 560 |  | // wp\_send\_json($importVariationImages); |
  | 561 |  |  |
  | 562 |  | $imageVariations = $attributesVariation['image']; |
  | 563 |  | if (isset($imageVariations)) { |
  | 564 |  | $imageId = false; |
  | 565 |  | foreach ($arrayImageId as $imageObject) { |
  | 566 |  | if ($imageObject->imageVariations == $imageVariations) { |
  | 567 |  | $imageId = $imageObject->id; |
  | 568 |  | break; |
  | 569 |  | } |
  | 570 |  | } |
  | 571 |  | if ($imageId != false) { |
  | 572 |  | $variationToCreate->set\_image\_id($imageId); |
  | 573 |  | } else { |
  | 574 |  | $imageIdVariation  =  wads\_save\_single\_variation\_image($variationToCreate, $imageVariations); |
  | 575 |  | array\_push($arrayImageId, array('image' => $imageVariations, 'id' => $imageIdVariation)); |
  | 576 |  | if (isset($imageIdVariation)) { |
  | 577 |  | $variationToCreate->set\_image\_id($imageIdVariation); |
  | 578 |  | } |
  | 579 |  | } |
  | 580 |  | } |
  | 581 |  | } |
  | 582 |  | }; |
  | 583 |  |  |
  | 584 |  | $variationToCreate->set\_attributes($variationsArray); |
  | 585 |  | try { |
  | 586 |  | $variationToCreate->save(); |
  | 587 |  | } catch (Exception $e) { |
  | 588 |  | echo \_\_('Error while saving variation found'); |
  | 589 |  | } |
  | 590 |  | } |
  | 591 |  | } |
  |  | 988 | } |
  |  | 989 | } catch (Exception $ex) { |
  | 592 | 990 | $results = array( |
  | 593 |  | 'error' => ~~fals~~e, |
  | 594 |  | 'error\_msg' => '~~'~~, |
  | 595 |  | 'data' => '~~Product inserted successfully~~' |
  |  | 991 | 'error' => true, |
  |  | 992 | 'error\_msg' => 'Error received when trying to insert the product' . $ex->getMessage(), |
  |  | 993 | 'data' => '' |
  | 596 | 994 | ); |
  | 597 | 995 | wp\_send\_json($results); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L600) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L998) |  |
  | 600 | 998 |  |
  | 601 | 999 |  |
  | 602 |  |  |
  | 603 |  |  |
  | 604 |  |  |
  | 605 |  |  |
  | 606 |  |  |
  | 607 |  |  |
  | 608 |  |  |
  | 609 |  |  |
  | 610 |  |  |
  | 611 |  |  |
  | 612 |  |  |
  | 613 |  | function wads\_getProductsDraft() |
  | 614 |  | { |
  |  | 1000 | function theSharkAliExpress\_getProductsDraft() |
  |  | 1001 | { |
  |  | 1002 |  |
  |  | 1003 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1004 | if (!current\_user\_can('manage\_options')) { |
  |  | 1005 |  |
  |  | 1006 | // Handle unauthorized access |
  |  | 1007 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1008 | } |
  |  | 1009 |  |
  |  | 1010 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1011 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1012 | } |
  |  | 1013 |  |
  |  | 1014 |  |
  |  | 1015 |  |
  |  | 1016 |  |
  |  | 1017 |  |
  | 615 | 1018 |  |
  | 616 | 1019 | $paged = isset($\_POST['paged']) ? wc\_clean($\_POST['paged']) : ''; |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L631) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1034) |  |
  | 631 | 1034 | ); |
  | 632 | 1035 |  |
  |  | 1036 |  |
  | 633 | 1037 | $products = new WP\_Query($args); |
  | 634 | 1038 | $finalList = array(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L660) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1064) |  |
  | 660 | 1064 | } |
  | 661 | 1065 |  |
  | 662 |  | function wads\_getOldProductDetails() |
  | 663 |  | { |
  |  | 1066 |  |
  |  | 1067 |  |
  |  | 1068 |  |
  |  | 1069 |  |
  |  | 1070 | function theSharkAliExpress\_getOldProductDetails() |
  |  | 1071 | { |
  |  | 1072 |  |
  |  | 1073 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1074 | if (!current\_user\_can('manage\_options')) { |
  |  | 1075 |  |
  |  | 1076 | // Handle unauthorized access |
  |  | 1077 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1078 | } |
  |  | 1079 |  |
  |  | 1080 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1081 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1082 | } |
  |  | 1083 |  |
  |  | 1084 |  |
  |  | 1085 |  |
  |  | 1086 |  |
  |  | 1087 |  |
  |  | 1088 |  |
  | 664 | 1089 | // $productUrl = 'https://www.aliexpress.com/item/4001024639837.html'; |
  | 665 | 1090 | $post\_id = isset($\_POST['post\_id']) ? wc\_clean($\_POST['post\_id']) : ''; |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L674) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1099) |  |
  | 674 | 1099 |  |
  | 675 | 1100 |  |
  | 676 |  | function wads\_searchProductBySku() |
  | 677 |  | { |
  | 678 |  | $searchSkuValue = isset($\_POST['searchSkuValue']) ? wc\_clean($\_POST['searchSkuValue']) : ''; |
  | 679 |  |  |
  | 680 |  | if (isset($searchSkuValue)) { |
  | 681 |  | $args = array( |
  | 682 |  | 'post\_type'      => 'product', |
  | 683 |  | 'posts\_per\_page' => 1, |
  | 684 |  | 'meta\_query' => array( |
  | 685 |  | array( |
  | 686 |  | "key" => "\_sku", |
  | 687 |  | "value" => $searchSkuValue, |
  | 688 |  | "compare" => "LIKE" |
  | 689 |  | ), |
  | 690 |  | array( |
  | 691 |  | 'key' => 'productUrl', //meta key name here |
  | 692 |  | 'value' => 'aliexpress.com', |
  | 693 |  | 'compare' => 'LIKE', |
  | 694 |  | ) |
  | 695 |  | ) |
  | 696 |  | ); |
  | 697 |  |  |
  | 698 |  |  |
  | 699 |  |  |
  | 700 |  |  |
  | 701 |  |  |
  | 702 |  | $products = new WP\_Query($args); |
  | 703 |  | $finalList = array(); |
  | 704 |  |  |
  | 705 |  | if ($products->have\_posts()) { |
  | 706 |  | while ($products->have\_posts()) : $products->the\_post(); |
  | 707 |  | $theid = get\_the\_ID(); |
  | 708 |  | $product = new WC\_Product($theid); |
  | 709 |  | if (has\_post\_thumbnail()) { |
  | 710 |  | $thumbnail = get\_post\_thumbnail\_id(); |
  | 711 |  | $image = $thumbnail ? wp\_get\_attachment\_url($thumbnail) : ''; |
  | 712 |  | } |
  | 713 |  | $finalList[] = array( |
  | 714 |  | 'sku' => $product->get\_sku(), |
  | 715 |  | 'id' => $theid, |
  | 716 |  | // image => wp\_get\_attachment\_image\_src( get\_post\_thumbnail\_id($products->post->ID)), |
  | 717 |  | 'image' => $image, |
  | 718 |  | 'title' =>  $product->get\_title(), |
  | 719 |  | 'productUrl' => get\_post\_meta($theid, 'productUrl', true) |
  | 720 |  |  |
  | 721 |  | ); |
  | 722 |  | endwhile; |
  | 723 |  | } else { |
  | 724 |  | echo \_\_('No products found'); |
  | 725 |  | } |
  | 726 |  | wp\_reset\_postdata(); |
  | 727 |  |  |
  | 728 |  | wp\_send\_json($finalList); |
  | 729 |  | } else { |
  | 730 |  | $results = array( |
  | 731 |  | 'error' => true, |
  | 732 |  | 'error\_msg' => 'cannot find result for the introduced sku value, please make sure the product is imported using wooshark', |
  | 733 |  | 'data' => '' |
  | 734 |  | ); |
  | 735 |  | wp\_send\_json($results); |
  | 736 |  | } |
  | 737 |  | } |
  | 738 |  |  |
  | 739 |  |  |
  | 740 |  |  |
  | 741 |  | function wads\_removeProductFromShop() |
  | 742 |  | { |
  |  | 1101 |  |
  |  | 1102 |  |
  |  | 1103 |  |
  |  | 1104 |  |
  |  | 1105 |  |
  |  | 1106 |  |
  |  | 1107 | function theSharkAliExpress\_removeProductFromShop() |
  |  | 1108 | { |
  |  | 1109 |  |
  |  | 1110 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1111 | if (!current\_user\_can('manage\_options')) { |
  |  | 1112 |  |
  |  | 1113 | // Handle unauthorized access |
  |  | 1114 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1115 | } |
  |  | 1116 |  |
  |  | 1117 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1118 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1119 | } |
  |  | 1120 |  |
  |  | 1121 |  |
  |  | 1122 |  |
  |  | 1123 |  |
  |  | 1124 |  |
  |  | 1125 |  |
  | 743 | 1126 | $post\_id = isset($\_POST['post\_id']) ? wc\_clean($\_POST['post\_id']) : ''; |
  | 744 | 1127 | if (isset($post\_id)) { |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L765) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1148) |  |
  | 765 | 1148 |  |
  | 766 | 1149 |  |
  | 767 |  | function wads\_insertReviewsIntoProduct() |
  | 768 |  | { |
  |  | 1150 | function theSharkAliExpress\_insertReviewsIntoProduct() |
  |  | 1151 | { |
  |  | 1152 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1153 | if (!current\_user\_can('manage\_options')) { |
  |  | 1154 |  |
  |  | 1155 | // Handle unauthorized access |
  |  | 1156 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1157 | } |
  |  | 1158 |  |
  |  | 1159 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1160 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1161 | } |
  |  | 1162 |  |
  |  | 1163 |  |
  |  | 1164 |  |
  |  | 1165 |  |
  |  | 1166 |  |
  |  | 1167 |  |
  | 769 | 1168 | $post\_id = isset($\_POST['post\_id']) ? wc\_clean($\_POST['post\_id']) : ''; |
  | 770 | 1169 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L774) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1173) |  |
  | 774 | 1173 | foreach ($reviews as $review) { |
  | 775 | 1174 | $comment\_id = wp\_insert\_comment(array( |
  | 776 |  | 'comment\_post\_ID'      => ~~wc\_clean~~($post\_id), // <=== The product ID where the review will show up |
  | 777 |  | 'comment\_author'       => ~~wc\_clean~~($review['username']), |
  | 778 |  | 'comment\_author\_email' => ~~wc\_clean~~($review['email']), // <== Important |
  |  | 1175 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 1176 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 1177 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  | 779 | 1178 | 'comment\_author\_url'   => '', |
  | 780 |  | 'comment\_content'      => ~~wc\_clean~~($review['review']), |
  |  | 1179 | 'comment\_content'      => sanitize\_text\_field($review['review']), |
  | 781 | 1180 | 'comment\_type'         => '', |
  | 782 | 1181 | 'comment\_parent'       => 0, |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L789) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1188) |  |
  | 789 | 1188 |  |
  | 790 | 1189 | // HERE inserting the rating (an integer from 1 to 5) |
  | 791 |  | $response = update\_comment\_meta($comment\_id, 'rating', ~~wc\_clean~~($review['rating'])); |
  |  | 1190 | $response = update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  | 792 | 1191 | if ($response != false && isset($response)) { |
  | 793 | 1192 | array\_push($insertedSuccessfully, $comment\_id); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L802) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1201) |  |
  | 802 | 1201 |  |
  | 803 | 1202 |  |
  | 804 |  | function wads\_getAlreadyImportedProducts() |
  | 805 |  | { |
  |  | 1203 | function theSharkAliExpress\_getAlreadyImportedProducts() |
  |  | 1204 | { |
  |  | 1205 |  |
  |  | 1206 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1207 | if (!current\_user\_can('manage\_options')) { |
  |  | 1208 |  |
  |  | 1209 | // Handle unauthorized access |
  |  | 1210 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1211 | } |
  |  | 1212 |  |
  |  | 1213 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1214 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1215 | } |
  |  | 1216 |  |
  |  | 1217 |  |
  |  | 1218 |  |
  |  | 1219 |  |
  |  | 1220 |  |
  |  | 1221 |  |
  | 806 | 1222 | $listOfSkus = isset($\_POST['listOfSkus']) ? wc\_clean($\_POST['listOfSkus']) : array(); |
  | 807 | 1223 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L817) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1233) |  |
  | 817 | 1233 | ), array( |
  | 818 | 1234 | 'key' => 'productUrl', //meta key name here |
  | 819 |  | 'value' => 'aliexpress.com', |
  |  | 1235 | 'value' => 'aliexpress.com/item', |
  | 820 | 1236 | 'compare' => 'LIKE', |
  | 821 | 1237 | ) |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L851) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1267) |  |
  | 851 | 1267 |  |
  | 852 | 1268 |  |
  | 853 |  | function wads\_getSKuAbdUrlByCategory() |
  | 854 |  | { |
  |  | 1269 | function theSharkAliExpress\_getSKuAbdUrlByCategory\_alibay() |
  |  | 1270 | { |
  |  | 1271 |  |
  |  | 1272 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1273 | if (!current\_user\_can('manage\_options')) { |
  |  | 1274 |  |
  |  | 1275 | // Handle unauthorized access |
  |  | 1276 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1277 | } |
  |  | 1278 |  |
  |  | 1279 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1280 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1281 | } |
  |  | 1282 |  |
  |  | 1283 |  |
  |  | 1284 |  |
  |  | 1285 |  |
  |  | 1286 |  |
  | 855 | 1287 |  |
  | 856 | 1288 | $categoryId = isset($\_POST['categoryId']) ? wc\_clean($\_POST['categoryId']) : array(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L864) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1296) |  |
  | 864 | 1296 | array( |
  | 865 | 1297 | 'key' => 'productUrl', //meta key name here |
  | 866 |  | 'value' => 'aliexpress.com', |
  |  | 1298 | 'value' => 'aliexpress.com/item', |
  | 867 | 1299 | 'compare' => 'LIKE', |
  | 868 | 1300 | ) |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L903) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1335) |  |
  | 903 | 1335 |  |
  | 904 | 1336 |  |
  | 905 |  | function wads\_getOrders() |
  | 906 |  | { |
  | 907 |  | $query = new WC\_Order\_Query(array( |
  | 908 |  | 'limit' => 10, |
  | 909 |  | 'orderby' => 'date', |
  | 910 |  | 'order' => 'DESC', |
  | 911 |  | 'return' => 'ids', |
  | 912 |  | )); |
  | 913 |  | $orders = $query->get\_orders(); |
  | 914 |  | wp\_send\_json($orders); |
  | 915 |  | } |
  | 916 |  |  |
  | 917 |  |  |
  | 918 |  |  |
  | 919 |  |  |
  | 920 |  | function wads\_searchCategoryByName() |
  | 921 |  | { |
  | 922 |  | $searchCategoryByNameInput = isset($\_POST['searchCategoryByNameInput']) ? wc\_clean(($\_POST['searchCategoryByNameInput'])) : array(); |
  |  | 1337 |  |
  |  | 1338 |  |
  |  | 1339 |  |
  |  | 1340 |  |
  |  | 1341 |  |
  |  | 1342 | function theSharkAliExpress\_searchCategoryByName() |
  |  | 1343 | { |
  |  | 1344 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1345 | if (!current\_user\_can('manage\_options')) { |
  |  | 1346 |  |
  |  | 1347 | // Handle unauthorized access |
  |  | 1348 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1349 | } |
  |  | 1350 |  |
  |  | 1351 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1352 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1353 | } |
  |  | 1354 |  |
  |  | 1355 |  |
  |  | 1356 |  |
  |  | 1357 |  |
  |  | 1358 |  |
  |  | 1359 |  |
  |  | 1360 | $searchCategoryByNameInput = isset($\_POST['searchCategoryByNameInput']) ? wc\_clean($\_POST['searchCategoryByNameInput']) : array(); |
  | 923 | 1361 | $product\_categories  = get\_terms('category', array('search' => $searchCategoryByNameInput)); |
  | 924 | 1362 | wp\_send\_json($product\_categories); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L927) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1365) |  |
  | 927 | 1365 |  |
  | 928 | 1366 |  |
  | 929 |  | // helper |
  | 930 |  |  |
  | 931 |  | function upload\_image($imageurl) |
  | 932 |  | { |
  | 933 |  |  |
  | 934 |  | include\_once(ABSPATH . 'wp-admin/includes/image.php'); |
  | 935 |  | $imagetype = end(explode('/', getimagesize($imageurl)['mime'])); |
  | 936 |  | $uniq\_name = date('dmY') . '' . (int) microtime(true); |
  | 937 |  | $filename = $uniq\_name . '.' . $imagetype; |
  | 938 |  |  |
  | 939 |  | $uploaddir = wp\_upload\_dir(); |
  | 940 |  | $uploadfile = $uploaddir['path'] . '/' . $filename; |
  | 941 |  | $contents = file\_get\_contents($imageurl); |
  | 942 |  | $savefile = fopen($uploadfile, 'w'); |
  | 943 |  | fwrite($savefile, $contents); |
  | 944 |  | fclose($savefile); |
  | 945 |  |  |
  | 946 |  | $wp\_filetype = wp\_check\_filetype(basename($filename), null); |
  | 947 |  | $attachment = array( |
  | 948 |  | 'post\_mime\_type' => $wp\_filetype['type'], |
  | 949 |  | 'post\_title' => $filename, |
  | 950 |  | 'post\_content' => '', |
  | 951 |  | 'post\_status' => 'inherit' |
  | 952 |  | ); |
  | 953 |  |  |
  | 954 |  | $attach\_id = wp\_insert\_attachment($attachment, $uploadfile); |
  | 955 |  | // $imagenew = get\_post($attach\_id); |
  | 956 |  | // $fullsizepath = get\_attached\_file($imagenew->ID); |
  | 957 |  | // $attach\_data = wp\_generate\_attachment\_metadata($attach\_id, $fullsizepath); |
  | 958 |  | // wp\_update\_attachment\_metadata($attach\_id, $attach\_data); |
  | 959 |  |  |
  | 960 |  | // echo $attach\_id; |
  | 961 |  | return $attach\_id; |
  | 962 |  | } |
  | 963 |  |  |
  | 964 |  |  |
  | 965 |  | function wads\_save\_product\_images($product, $images) |
  |  | 1367 | function theSharkAliExpress\_save\_product\_images\_alibay($product, $images) |
  | 966 | 1368 | { |
  | 967 | 1369 | if (is\_array($images)) { |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L998) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1400) |  |
  | 998 | 1400 |  |
  | 999 | 1401 |  |
  | 1000 |  | // function wads\_save\_product\_images($product, $images) |
  | 1001 |  | // { |
  | 1002 |  | //   if (is\_array($images)) { |
  | 1003 |  | //     array\_splice($images, 1); |
  | 1004 |  |  |
  | 1005 |  | //     $gallery = array(); |
  | 1006 |  | //     foreach ($images as $key => $image) { |
  | 1007 |  | //       if (isset($image)) { |
  | 1008 |  | //         $upload = wc\_rest\_upload\_image\_from\_url(esc\_url\_raw($image)); |
  | 1009 |  | //         if (is\_wp\_error($upload)) { |
  | 1010 |  | //           if (!apply\_filters('woocommerce\_rest\_suppress\_image\_upload\_error', false, $upload, $product->get\_id(), $images)) { |
  | 1011 |  | //             throw new WC\_REST\_Exception('woocommerce\_product\_image\_upload\_error', $upload->get\_error\_message(), 400); |
  | 1012 |  | //           } else { |
  | 1013 |  | //             continue; |
  | 1014 |  | //           } |
  | 1015 |  | //         } |
  | 1016 |  | //         $attachment\_id = wc\_rest\_set\_uploaded\_image\_as\_attachment($upload, $product->get\_id()); |
  | 1017 |  | //       } |
  | 1018 |  | //       if ($key == 0) { |
  | 1019 |  | //         $product->set\_image\_id($attachment\_id); |
  | 1020 |  | //       } else { |
  | 1021 |  | //         array\_push($gallery, $attachment\_id); |
  | 1022 |  | //       } |
  | 1023 |  | //     } |
  | 1024 |  | //     if (!empty($gallery)) { |
  | 1025 |  | //       $product->set\_gallery\_image\_ids($gallery); |
  | 1026 |  | //     } |
  | 1027 |  | //   } else { |
  | 1028 |  | //     $product->set\_image\_id(''); |
  | 1029 |  | //     $product->set\_gallery\_image\_ids(array()); |
  | 1030 |  | //   } |
  | 1031 |  | //   return $product; |
  | 1032 |  | // } |
  | 1033 |  |  |
  | 1034 |  |  |
  | 1035 |  | function wads\_save\_single\_variation\_image($product, $image) |
  |  | 1402 | function theSharkAliExpress\_save\_single\_variation\_image\_alibay($product, $image) |
  | 1036 | 1403 | { |
  | 1037 | 1404 | $gallery = array(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1050) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1417) |  |
  | 1050 | 1417 |  |
  | 1051 | 1418 |  |
  | 1052 |  | function wads\_searchProductByIdReviews() |
  | 1053 |  | { |
  | 1054 |  | $searchSkuValue = isset($\_POST['searchSkuValue']) ? wc\_clean($\_POST['searchSkuValue']) : ''; |
  |  | 1419 | function theSharkAliExpress\_searchProductByIdReviews\_alibay() |
  |  | 1420 | { |
  |  | 1421 |  |
  |  | 1422 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1423 | if (!current\_user\_can('manage\_options')) { |
  |  | 1424 |  |
  |  | 1425 | // Handle unauthorized access |
  |  | 1426 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1427 | } |
  |  | 1428 |  |
  |  | 1429 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1430 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1431 | } |
  |  | 1432 |  |
  |  | 1433 |  |
  |  | 1434 |  |
  |  | 1435 |  |
  |  | 1436 |  |
  |  | 1437 |  |
  |  | 1438 | $searchSkuValue = isset($\_POST['searchSkuValue']) ? sanitize\_text\_field($\_POST['searchSkuValue']) : ''; |
  | 1055 | 1439 |  |
  | 1056 | 1440 | if (isset($searchSkuValue)) { |
  | 1057 | 1441 | $args = array( |
  | 1058 | 1442 | 'post\_type'      => 'product', |
  | 1059 |  | 'posts\_per\_page' => ~~1~~, |
  |  | 1443 | 'posts\_per\_page' => 20, |
  | 1060 | 1444 | 'p' => $searchSkuValue |
  | 1061 | 1445 | // 'meta\_query' => array( |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1105) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1489) |  |
  | 1105 | 1489 | $results = array( |
  | 1106 | 1490 | 'error' => true, |
  | 1107 |  | 'error\_msg' => 'cannot find result for the introduced sku value, please make sure the product is imported using ~~woos~~hark', |
  |  | 1491 | 'error\_msg' => 'cannot find result for the introduced sku value, please make sure the product is imported using theShark', |
  | 1108 | 1492 | 'data' => '' |
  | 1109 | 1493 | ); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1114) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1498) |  |
  | 1114 | 1498 |  |
  | 1115 | 1499 |  |
  | 1116 |  | function wads\_saveOptionsDB() |
  | 1117 |  | { |
  | 1118 |  | $isShippingCostEnabled = isset($\_POST['isShippingCostEnabled']) ? wc\_clean($\_POST['isShippingCostEnabled']) : 'N'; |
  | 1119 |  | $isEnableAutomaticUpdateForAvailability = isset($\_POST['isEnableAutomaticUpdateForAvailability']) ? wc\_clean($\_POST['isEnableAutomaticUpdateForAvailability']) : 'N'; |
  | 1120 |  | $isUpdateRegularPrice = isset($\_POST['isUpdateRegularPrice']) ? wc\_clean($\_POST['isUpdateRegularPrice']) : 'N'; |
  | 1121 |  | $isUpdateSalePrice = isset($\_POST['isUpdateSalePrice']) ? wc\_clean($\_POST['isUpdateSalePrice']) : 'N'; |
  | 1122 |  | $isUpdateStock = isset($\_POST['isUpdateStock']) ? wc\_clean($\_POST['isUpdateStock']) : 'N'; |
  |  | 1500 | function theSharkAliExpress\_saveOptionsDB\_alibay() |
  |  | 1501 | { |
  |  | 1502 |  |
  |  | 1503 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1504 | if (!current\_user\_can('manage\_options')) { |
  |  | 1505 |  |
  |  | 1506 | // Handle unauthorized access |
  |  | 1507 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1508 | } |
  |  | 1509 |  |
  |  | 1510 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1511 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1512 | } |
  |  | 1513 |  |
  |  | 1514 |  |
  |  | 1515 |  |
  |  | 1516 |  |
  |  | 1517 |  |
  |  | 1518 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1519 | if (!current\_user\_can('manage\_options')) { |
  |  | 1520 |  |
  |  | 1521 | // Handle unauthorized access |
  |  | 1522 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1523 | } |
  |  | 1524 |  |
  |  | 1525 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1526 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1527 | } |
  |  | 1528 |  |
  |  | 1529 |  |
  |  | 1530 |  |
  |  | 1531 |  |
  |  | 1532 |  |
  |  | 1533 |  |
  |  | 1534 | $isShippingCostEnabled = isset($\_POST['isShippingCostEnabled']) ? sanitize\_text\_field($\_POST['isShippingCostEnabled']) : 'N'; |
  |  | 1535 | $isEnableAutomaticUpdateForAvailability = isset($\_POST['isEnableAutomaticUpdateForAvailability']) ? sanitize\_text\_field($\_POST['isEnableAutomaticUpdateForAvailability']) : 'N'; |
  |  | 1536 | $isUpdateRegularPrice = isset($\_POST['isUpdateRegularPrice']) ? sanitize\_text\_field($\_POST['isUpdateRegularPrice']) : 'N'; |
  |  | 1537 | $isUpdateSalePrice = isset($\_POST['isUpdateSalePrice']) ? sanitize\_text\_field($\_POST['isUpdateSalePrice']) : 'N'; |
  |  | 1538 | $isUpdateStock = isset($\_POST['isUpdateStock']) ? sanitize\_text\_field($\_POST['isUpdateStock']) : 'N'; |
  | 1123 | 1539 | $priceFormulaIntervalls = isset($\_POST['priceFormulaIntervalls']) ? wc\_clean($\_POST['priceFormulaIntervalls']) : array(); |
  | 1124 |  | $onlyPublishProductWillSync = isset($\_POST['onlyPublishProductWillSync']) ? ~~wc\_clean~~($\_POST['onlyPublishProductWillSync']) : 'N'; |
  | 1125 |  | $enableAutomaticUpdates = isset($\_POST['enableAutomaticUpdates']) ? ~~wc\_clean~~($\_POST['enableAutomaticUpdates']) : 'N'; |
  | 1126 |  | $applyPriceFormulaAutomaticUpdate = isset($\_POST['applyPriceFormulaAutomaticUpdate']) ? ~~wc\_clean~~($\_POST['applyPriceFormulaAutomaticUpdate']) : 'N'; |
  | 1127 |  | $syncRegularPrice = isset($\_POST['syncRegularPrice']) ? ~~wc\_clean~~($\_POST['syncRegularPrice']) : 'N'; |
  | 1128 |  | $syncSalePrice = isset($\_POST['syncSalePrice']) ? ~~wc\_clean~~($\_POST['syncSalePrice']) : 'N'; |
  | 1129 |  | $syncStock = isset($\_POST['syncStock']) ? ~~wc\_clean~~($\_POST['syncStock']) : 'N'; |
  |  | 1540 | $onlyPublishProductWillSync = isset($\_POST['onlyPublishProductWillSync']) ? sanitize\_text\_field($\_POST['onlyPublishProductWillSync']) : 'N'; |
  |  | 1541 | $enableAutomaticUpdates = isset($\_POST['enableAutomaticUpdates']) ? sanitize\_text\_field($\_POST['enableAutomaticUpdates']) : 'N'; |
  |  | 1542 | $applyPriceFormulaAutomaticUpdate = isset($\_POST['applyPriceFormulaAutomaticUpdate']) ? sanitize\_text\_field($\_POST['applyPriceFormulaAutomaticUpdate']) : 'N'; |
  |  | 1543 | $syncRegularPrice = isset($\_POST['syncRegularPrice']) ? sanitize\_text\_field($\_POST['syncRegularPrice']) : 'N'; |
  |  | 1544 | $syncSalePrice = isset($\_POST['syncSalePrice']) ? sanitize\_text\_field($\_POST['syncSalePrice']) : 'N'; |
  |  | 1545 | $syncStock = isset($\_POST['syncStock']) ? sanitize\_text\_field($\_POST['syncStock']) : 'N'; |
  | 1130 | 1546 | $\_savedConfiguration = isset($\_POST['\_savedConfiguration']) ? wc\_clean($\_POST['\_savedConfiguration']) : null; |
  | 1131 | 1547 |  |
  | 1132 | 1548 | if (isset($\_savedConfiguration)) { |
  | 1133 |  | update\_option('\_savedConfiguration',   $\_savedConfiguration); |
  |  | 1549 | update\_option('\_savedConfiguration\_alibay',   $\_savedConfiguration); |
  | 1134 | 1550 | } |
  | 1135 | 1551 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1137) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1553) |  |
  | 1137 | 1553 |  |
  | 1138 | 1554 | if (isset($syncRegularPrice)) { |
  | 1139 |  | update\_option('syncRegularPrice', $syncRegularPrice); |
  |  | 1555 | update\_option('alibay\_aliexpress\_syncRegularPrice', $syncRegularPrice); |
  | 1140 | 1556 | } |
  | 1141 | 1557 |  |
  | 1142 | 1558 | if (isset($syncSalePrice)) { |
  | 1143 |  | update\_option('syncSalePrice', $syncSalePrice); |
  |  | 1559 | update\_option('alibay\_aliexpress\_syncSalePrice', $syncSalePrice); |
  | 1144 | 1560 | } |
  | 1145 | 1561 |  |
  | 1146 | 1562 | if (isset($syncStock)) { |
  | 1147 |  | update\_option('syncStock', $syncStock); |
  |  | 1563 | update\_option('alibay\_aliexpress\_syncStock', $syncStock); |
  | 1148 | 1564 | } |
  | 1149 | 1565 |  |
  | 1150 | 1566 | // wp\_send\_json($updateVariationsOnServer); |
  | 1151 | 1567 | if (isset($priceFormulaIntervalls)) { |
  | 1152 |  | update\_option('priceFormulaIntervalls', $priceFormulaIntervalls); |
  |  | 1568 | update\_option('alibay\_aliexpress\_priceFormulaIntervalls', $priceFormulaIntervalls); |
  | 1153 | 1569 | } |
  | 1154 | 1570 |  |
  | 1155 | 1571 | if (isset($isShippingCostEnabled)) { |
  | 1156 |  | update\_option('isShippingCostEnabled', $isShippingCostEnabled); |
  |  | 1572 | update\_option('alibay\_aliexpress\_isShippingCostEnabled', $isShippingCostEnabled); |
  | 1157 | 1573 | } |
  | 1158 | 1574 |  |
  | 1159 | 1575 | if (isset($isEnableAutomaticUpdateForAvailability)) { |
  | 1160 |  | update\_option('isEnableAutomaticUpdateForAvailability', $isEnableAutomaticUpdateForAvailability); |
  | 1161 |  | } |
  | 1162 |  |  |
  | 1163 |  |  |
  | 1164 |  | // if (isset($removeVariationIfStockIsEmpty)) { |
  | 1165 |  | //   update\_option('removeVariationIfStockIsEmpty', $removeVariationIfStockIsEmpty); |
  | 1166 |  | // } |
  | 1167 |  |  |
  | 1168 |  |  |
  | 1169 |  | // if (isset($setToOutOfStockIfVariationsDoesNotExist)) { |
  | 1170 |  | //   update\_option('setToOutOfStockIfVariationsDoesNotExist', $setToOutOfStockIfVariationsDoesNotExist); |
  | 1171 |  | // } |
  | 1172 |  |  |
  |  | 1576 | update\_option('alibay\_aliexpress\_isEnableAutomaticUpdateForAvailability', $isEnableAutomaticUpdateForAvailability); |
  |  | 1577 | } |
  | 1173 | 1578 |  |
  | 1174 | 1579 | if (isset($isUpdateRegularPrice)) { |
  | 1175 |  | update\_option('isUpdateRegularPrice', $isUpdateRegularPrice); |
  |  | 1580 | update\_option('alibay\_aliexpress\_isUpdateRegularPrice', $isUpdateRegularPrice); |
  | 1176 | 1581 | } |
  | 1177 | 1582 |  |
  | 1178 | 1583 |  |
  | 1179 | 1584 | if (isset($isUpdateSalePrice)) { |
  | 1180 |  | update\_option('isUpdateSalePrice', $isUpdateSalePrice); |
  |  | 1585 | update\_option('alibay\_aliexpress\_isUpdateSalePrice', $isUpdateSalePrice); |
  | 1181 | 1586 | } |
  | 1182 | 1587 |  |
  | 1183 | 1588 |  |
  | 1184 | 1589 | if (isset($isUpdateStock)) { |
  | 1185 |  | update\_option('isUpdateStock', $isUpdateStock); |
  |  | 1590 | update\_option('alibay\_aliexpress\_isUpdateStock', $isUpdateStock); |
  | 1186 | 1591 | } |
  | 1187 | 1592 | if (isset($onlyPublishProductWillSync)) { |
  | 1188 |  | update\_option('onlyPublishProductWillSync', $onlyPublishProductWillSync); |
  |  | 1593 | update\_option('alibay\_aliexpress\_onlyPublishProductWillSync', $onlyPublishProductWillSync); |
  | 1189 | 1594 | } |
  | 1190 | 1595 | if (isset($enableAutomaticUpdates)) { |
  | 1191 |  | update\_option('enableAutomaticUpdates', $enableAutomaticUpdates); |
  |  | 1596 | update\_option('alibay\_aliexpress\_enableAutomaticUpdates', $enableAutomaticUpdates); |
  | 1192 | 1597 | } |
  | 1193 | 1598 | if (isset($applyPriceFormulaAutomaticUpdate)) { |
  | 1194 |  | update\_option('applyPriceFormulaAutomaticUpdate', $applyPriceFormulaAutomaticUpdate); |
  |  | 1599 | update\_option('alibay\_aliexpress\_applyPriceFormulaAutomaticUpdate', $applyPriceFormulaAutomaticUpdate); |
  | 1195 | 1600 | } |
  | 1196 | 1601 |  |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1201) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1606) |  |
  | 1201 | 1606 |  |
  | 1202 | 1607 |  |
  | 1203 |  | function wads\_insertReviewsIntoProductRM\_PREMUIM\_PLUGIN() |
  | 1204 |  | { |
  | 1205 |  | $post\_id = isset($\_POST['post\_id']) ? wc\_clean($\_POST['post\_id']) : ''; |
  |  | 1608 |  |
  |  | 1609 |  |
  |  | 1610 |  |
  |  | 1611 | function theSharkAliExpress\_insertReviewsIntoProductRM\_PREMUIM\_PLUGIN\_alibay() |
  |  | 1612 | { |
  |  | 1613 |  |
  |  | 1614 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1615 | if (!current\_user\_can('manage\_options')) { |
  |  | 1616 |  |
  |  | 1617 | // Handle unauthorized access |
  |  | 1618 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1619 | } |
  |  | 1620 |  |
  |  | 1621 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1622 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1623 | } |
  |  | 1624 |  |
  |  | 1625 |  |
  |  | 1626 |  |
  |  | 1627 |  |
  |  | 1628 |  |
  |  | 1629 |  |
  |  | 1630 |  |
  |  | 1631 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  | 1206 | 1632 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  | 1207 | 1633 | $insertedSuccessfully = array(); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1210) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1636) |  |
  | 1210 | 1636 | foreach ($reviews as $review) { |
  | 1211 | 1637 | $comment\_id = wp\_insert\_comment(array( |
  | 1212 |  | 'comment\_post\_ID'      => ~~wc\_clean~~($post\_id), // <=== The product ID where the review will show up |
  | 1213 |  | 'comment\_author'       => ~~wc\_clean~~($review['username']), |
  | 1214 |  | 'comment\_author\_email' => ~~wc\_clean~~($review['email']), // <== Important |
  |  | 1638 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 1639 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 1640 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  | 1215 | 1641 | 'comment\_author\_url'   => '', |
  | 1216 | 1642 | 'comment\_content'      => $review['review'], |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1220) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1646) |  |
  | 1220 | 1646 | 'comment\_author\_IP'    => '', |
  | 1221 | 1647 | 'comment\_agent'        => '', |
  | 1222 |  | 'comment\_date'         => ~~wc\_clean($review['datecreation'])~~, |
  |  | 1648 | 'comment\_date'         => $review['datecreation'], |
  | 1223 | 1649 | 'comment\_approved'     => 1, |
  | 1224 | 1650 | )); |
  | 1225 | 1651 |  |
  | 1226 | 1652 | // HERE inserting the rating (an integer from 1 to 5) |
  | 1227 |  | $response = update\_comment\_meta($comment\_id, 'rating', ~~wc\_clean~~($review['rating'])); |
  |  | 1653 | $response = update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  | 1228 | 1654 | if ($response != false && isset($response)) { |
  | 1229 | 1655 | array\_push($insertedSuccessfully, $comment\_id); |
  | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=2839431#L1234) | […](/browser/wooshark-aliexpress-importer/trunk/wooshark-aliexpress-importer_init.php?rev=3059375#L1660) |  |
  | 1234 | 1660 | } |
  | 1235 | 1661 |  |
  | 1236 |  |  |
  | 1237 |  |  |
  | 1238 |  |  |
  | 1239 |  | function wads\_restoreConfiguration() |
  | 1240 |  | { |
  | 1241 |  | $\_savedConfiguration  = get\_option('\_savedConfiguration'); |
  | 1242 |  | wp\_send\_json(array('\_savedConfiguration' => $\_savedConfiguration)); |
  | 1243 |  | } |
  |  | 1662 | function theSharkAliExpress\_restoreConfiguration\_alibay() |
  |  | 1663 | { |
  |  | 1664 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1665 | if (!current\_user\_can('manage\_options')) { |
  |  | 1666 |  |
  |  | 1667 | // Handle unauthorized access |
  |  | 1668 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1669 | } |
  |  | 1670 |  |
  |  | 1671 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1672 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1673 | } |
  |  | 1674 |  |
  |  | 1675 |  |
  |  | 1676 |  |
  |  | 1677 |  |
  |  | 1678 |  |
  |  | 1679 |  |
  |  | 1680 |  |
  |  | 1681 | $\_savedConfiguration  = get\_option('\_savedConfiguration\_alibay'); |
  |  | 1682 | wp\_send\_json(array('\_savedConfiguration\_alibay' => $\_savedConfiguration)); |
  |  | 1683 | } |
  |  | 1684 |  |
  |  | 1685 |  |
  |  | 1686 |  |
  |  | 1687 | function theSharkAliExpress\_getProductsCount\_FROM\_WP\_for\_ebay\_alibay() |
  |  | 1688 | { |
  |  | 1689 |  |
  |  | 1690 |  |
  |  | 1691 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1692 | if (!current\_user\_can('manage\_options')) { |
  |  | 1693 |  |
  |  | 1694 | // Handle unauthorized access |
  |  | 1695 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1696 | } |
  |  | 1697 |  |
  |  | 1698 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1699 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1700 | } |
  |  | 1701 |  |
  |  | 1702 |  |
  |  | 1703 |  |
  |  | 1704 |  |
  |  | 1705 |  |
  |  | 1706 |  |
  |  | 1707 | $args = array( |
  |  | 1708 | 'post\_type'      => 'product', |
  |  | 1709 | 'post\_status' => array('publish', 'draft'), |
  |  | 1710 | 'meta\_query' => array( |
  |  | 1711 | array( |
  |  | 1712 | 'key' => 'productUrl', //meta key name here |
  |  | 1713 | 'value' => '.ebay.', |
  |  | 1714 | 'compare' => 'LIKE', |
  |  | 1715 | ) |
  |  | 1716 | ), |
  |  | 1717 | ); |
  |  | 1718 | $query = new WP\_Query($args); |
  |  | 1719 | $total = $query->found\_posts; |
  |  | 1720 | wp\_reset\_postdata(); |
  |  | 1721 | wp\_send\_json($total); |
  |  | 1722 | } |
  |  | 1723 |  |
  |  | 1724 | // Function to insert variations in batches |
  |  | 1725 | function theSharkAliExpress\_insertVariations() |
  |  | 1726 | { |
  |  | 1727 |  |
  |  | 1728 |  |
  |  | 1729 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1730 | if (!current\_user\_can('manage\_options')) { |
  |  | 1731 |  |
  |  | 1732 | // Handle unauthorized access |
  |  | 1733 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1734 | } |
  |  | 1735 |  |
  |  | 1736 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1737 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1738 | } |
  |  | 1739 |  |
  |  | 1740 |  |
  |  | 1741 |  |
  |  | 1742 |  |
  |  | 1743 |  |
  |  | 1744 |  |
  |  | 1745 |  |
  |  | 1746 | try { |
  |  | 1747 | // Get product ID and variations data from the POST request |
  |  | 1748 | $post\_id = wc\_clean($\_POST['postId']); |
  |  | 1749 | $variations = wc\_clean($\_POST['variations']); |
  |  | 1750 |  |
  |  | 1751 |  |
  |  | 1752 | if (is\_array($variations) && count($variations)) { |
  |  | 1753 | // array\_splice($variations, 2); |
  |  | 1754 |  |
  |  | 1755 | foreach ($variations as $variation) { |
  |  | 1756 |  |
  |  | 1757 | $attributesVariations = $variation['attributesVariations']; |
  |  | 1758 | $variationToCreate = new WC\_Product\_Variation(); |
  |  | 1759 | // $variationToCreate->set\_regular\_price(10); |
  |  | 1760 | $variationToCreate->set\_parent\_id($post\_id); |
  |  | 1761 | if (isset($variation['SKU']) && !empty($variation['SKU']) && $variation['SKU'] != 'undefined') { |
  |  | 1762 | $variationToCreate->set\_sku($variation['SKU']); |
  |  | 1763 | } |
  |  | 1764 |  |
  |  | 1765 | if (!empty(sanitize\_text\_field($variation['regularPrice']))) { |
  |  | 1766 | $variationToCreate->set\_regular\_price($variation['regularPrice']); |
  |  | 1767 | } |
  |  | 1768 |  |
  |  | 1769 | if (!empty(sanitize\_text\_field($variation['salePrice']))) { |
  |  | 1770 | $variationToCreate->set\_sale\_price($variation['salePrice']); |
  |  | 1771 | } |
  |  | 1772 |  |
  |  | 1773 |  |
  |  | 1774 | $stockProduct = sanitize\_text\_field($variation['availQuantity']); |
  |  | 1775 | if (isset($stockProduct)) { |
  |  | 1776 | $variationToCreate->set\_manage\_stock(true); |
  |  | 1777 | $variationToCreate->set\_stock\_quantity($stockProduct); |
  |  | 1778 | $variationToCreate->set\_stock\_status('instock'); |
  |  | 1779 | } |
  |  | 1780 | $variationsArray = array(); |
  |  | 1781 | foreach ($attributesVariations as $attributesVariation) { |
  |  | 1782 | $variationsArray[$attributesVariation['name']] = $attributesVariation['value']; |
  |  | 1783 |  |
  |  | 1784 | $arrayImageId = array(); |
  |  | 1785 | // if (($importVariationImages\_ebay == 'true')) { |
  |  | 1786 | // wp\_send\_json($importVariationImages); |
  |  | 1787 |  |
  |  | 1788 | $imageVariations = $attributesVariation['image']; |
  |  | 1789 | if (isset($imageVariations)) { |
  |  | 1790 | $imageId = false; |
  |  | 1791 | foreach ($arrayImageId as $imageObject) { |
  |  | 1792 | if ($imageObject->imageVariations == $imageVariations) { |
  |  | 1793 | $imageId = $imageObject->id; |
  |  | 1794 | break; |
  |  | 1795 | } |
  |  | 1796 | } |
  |  | 1797 | if ($imageId != false) { |
  |  | 1798 | $variationToCreate->set\_image\_id($imageId); |
  |  | 1799 | } else { |
  |  | 1800 | $imageIdVariation  =  theSharkAliExpress\_save\_single\_variation\_image\_alibay($variationToCreate, $imageVariations); |
  |  | 1801 | array\_push($arrayImageId, array('image' => $imageVariations, 'id' => $imageIdVariation)); |
  |  | 1802 | if (isset($imageIdVariation)) { |
  |  | 1803 | $variationToCreate->set\_image\_id($imageIdVariation); |
  |  | 1804 | } |
  |  | 1805 | } |
  |  | 1806 | } |
  |  | 1807 | // } |
  |  | 1808 | }; |
  |  | 1809 | // wp\_send\_json(array('variationsArray' =\\÷/> $variationsArray, 'ttt' => $attributesVariation['value'])); |
  |  | 1810 |  |
  |  | 1811 | $variationToCreate->set\_attributes($variationsArray); |
  |  | 1812 | try { |
  |  | 1813 | $variationToCreate->save(); |
  |  | 1814 | } catch (Exception $e) { |
  |  | 1815 | $results = array( |
  |  | 1816 | 'error' => true, |
  |  | 1817 | 'data' => 'Error while inserting variations ' . $e, |
  |  | 1818 | 'postId' => $post\_id |
  |  | 1819 |  |
  |  | 1820 | ); |
  |  | 1821 | wp\_send\_json($results); |
  |  | 1822 | } |
  |  | 1823 | } |
  |  | 1824 | $results = array( |
  |  | 1825 | 'error' => false, |
  |  | 1826 | 'error\_msg' => '', |
  |  | 1827 | 'data' => 'Product inserted successfully', |
  |  | 1828 | 'postId' => $post\_id |
  |  | 1829 |  |
  |  | 1830 | ); |
  |  | 1831 | wp\_send\_json($results); |
  |  | 1832 | } else { |
  |  | 1833 | $results = array( |
  |  | 1834 | 'error' => true, |
  |  | 1835 | 'data' => 'Cannot insert empty variations', |
  |  | 1836 | 'postId' => $post\_id |
  |  | 1837 |  |
  |  | 1838 | ); |
  |  | 1839 | wp\_send\_json($results); |
  |  | 1840 | } |
  |  | 1841 | } catch (Exception $e) { |
  |  | 1842 | $results = array( |
  |  | 1843 | 'error' => true, |
  |  | 1844 | 'data' => 'Error while inserting variations ' . $e, |
  |  | 1845 | 'postId' => $post\_id |
  |  | 1846 |  |
  |  | 1847 | ); |
  |  | 1848 | wp\_send\_json($results); |
  |  | 1849 | } |
  |  | 1850 | } |
  |  | 1851 |  |
  |  | 1852 |  |
  |  | 1853 |  |
  |  | 1854 |  |
  |  | 1855 | function theSharkAliExpress\_setProductToDraft\_for\_ebay\_alibay() |
  |  | 1856 | { |
  |  | 1857 |  |
  |  | 1858 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  |  | 1859 | if (isset($post\_id)) { |
  |  | 1860 | $result = update\_post\_meta($post\_id, 'isExpired', 'true'); |
  |  | 1861 | $post = array('ID' => $post\_id, 'post\_status' => 'draft'); |
  |  | 1862 | wp\_update\_post($post); |
  |  | 1863 | } |
  |  | 1864 |  |
  |  | 1865 | wp\_send\_json(array('result' => $result)); |
  |  | 1866 | } |
  |  | 1867 |  |
  |  | 1868 |  |
  |  | 1869 |  |
  |  | 1870 |  |
  |  | 1871 |  |
  |  | 1872 |  |
  |  | 1873 |  |
  |  | 1874 |  |
  |  | 1875 |  |
  |  | 1876 |  |
  |  | 1877 |  |
  |  | 1878 |  |
  |  | 1879 |  |
  |  | 1880 | function theSharkAliExpress\_updateProductSimple\_for\_ebay\_alibay() |
  |  | 1881 | { |
  |  | 1882 |  |
  |  | 1883 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1884 | if (!current\_user\_can('manage\_options')) { |
  |  | 1885 |  |
  |  | 1886 | // Handle unauthorized access |
  |  | 1887 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1888 | } |
  |  | 1889 |  |
  |  | 1890 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1891 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1892 | } |
  |  | 1893 |  |
  |  | 1894 |  |
  |  | 1895 |  |
  |  | 1896 |  |
  |  | 1897 |  |
  |  | 1898 |  |
  |  | 1899 |  |
  |  | 1900 | $newProduct = isset($\_POST['newProduct']) ? wc\_clean($\_POST['newProduct']) : array(); |
  |  | 1901 | if (isset($newProduct) && count($newProduct)) { |
  |  | 1902 | foreach ($newProduct as $product) { |
  |  | 1903 |  |
  |  | 1904 | if (isset($product['id'])) { |
  |  | 1905 |  |
  |  | 1906 |  |
  |  | 1907 |  |
  |  | 1908 | if (isset($product['regularPrice'])) { |
  |  | 1909 | update\_post\_meta($product['id'], '\_regular\_price', $product['regularPrice']); |
  |  | 1910 | update\_post\_meta($product['id'], '\_price',  $product['regularPrice']); |
  |  | 1911 | // wc\_delete\_product\_transients( $product['variation\_id'] ); |
  |  | 1912 |  |
  |  | 1913 | } |
  |  | 1914 |  |
  |  | 1915 |  |
  |  | 1916 | if (isset($product['availQuantity']) &&  $product['availQuantity'] > -1) { |
  |  | 1917 | // $isUpdateStockPriceOk = update\_post\_meta($product['variation\_id'], '\_stock', $product['availQuantity']); |
  |  | 1918 |  |
  |  | 1919 | update\_post\_meta($product['id'], '\_stock', $product['availQuantity']); |
  |  | 1920 | } |
  |  | 1921 |  |
  |  | 1922 |  |
  |  | 1923 |  |
  |  | 1924 | // if (isset($product['availQuantity']) &&  $product['availQuantity'] == 0) { |
  |  | 1925 | //   array\_push($outOfStock, $product['variation\_id']); |
  |  | 1926 | // } else { |
  |  | 1927 | //   array\_push($arrayOfSuccess, $product['variation\_id']); |
  |  | 1928 | // } |
  |  | 1929 | $results = array( |
  |  | 1930 | 'error' => false, |
  |  | 1931 | 'error\_msg' => '', |
  |  | 1932 |  |
  |  | 1933 | 'data' => array('success' => true, 'sku' => $product['productSku']) |
  |  | 1934 | ); |
  |  | 1935 | wp\_send\_json($results); |
  |  | 1936 | } else { |
  |  | 1937 | $results = array( |
  |  | 1938 | 'error' => false, |
  |  | 1939 | 'error\_msg' => '', |
  |  | 1940 | 'data' => array('success' => true, 'sku' => $product['productSku']), |
  |  | 1941 | ); |
  |  | 1942 | wp\_send\_json($results); |
  |  | 1943 | } |
  |  | 1944 | } |
  |  | 1945 | } |
  |  | 1946 | } |
  |  | 1947 |  |
  |  | 1948 | function theSharkAliExpress\_updateProductVariations\_for\_ebay\_alibay() |
  |  | 1949 | { |
  |  | 1950 |  |
  |  | 1951 | // Check if the user is authenticated and has the necessary permissions |
  |  | 1952 | if (!current\_user\_can('manage\_options')) { |
  |  | 1953 |  |
  |  | 1954 | // Handle unauthorized access |
  |  | 1955 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1956 | } |
  |  | 1957 |  |
  |  | 1958 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 1959 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 1960 | } |
  |  | 1961 |  |
  |  | 1962 |  |
  |  | 1963 |  |
  |  | 1964 |  |
  |  | 1965 |  |
  |  | 1966 |  |
  |  | 1967 | $arrayOfError = array(); |
  |  | 1968 | $arrayOfSuccess = array(); |
  |  | 1969 | $outOfStock = array(); |
  |  | 1970 |  |
  |  | 1971 | $updateVariationsOnServer = isset($\_POST['updateVariationsOnServer']) ? wc\_clean($\_POST['updateVariationsOnServer']) : array(); |
  |  | 1972 | $totalOldVariations = isset($\_POST['totalOldVariations']) ? wc\_clean($\_POST['totalOldVariations']) : 1; |
  |  | 1973 | // wp\_send\_json($updateVariationsOnServer); |
  |  | 1974 | if (isset($updateVariationsOnServer) && count($updateVariationsOnServer)) { |
  |  | 1975 | foreach ($updateVariationsOnServer as $product) { |
  |  | 1976 |  |
  |  | 1977 | if (isset($product['variation\_id'])) { |
  |  | 1978 | $isUpdateRegularPriceOk = false; |
  |  | 1979 | $isUpdateSalePriceOk = false; |
  |  | 1980 | $isUpdateStockPriceOk = false; |
  |  | 1981 |  |
  |  | 1982 | if (isset($product['salePrice'])) { |
  |  | 1983 | $isUpdateRegularPriceOk = update\_post\_meta($product['variation\_id'], '\_sale\_price', $product['salePrice']); |
  |  | 1984 | } |
  |  | 1985 | if (isset($product['regularPrice'])) { |
  |  | 1986 | $isUpdateSalePriceOk = update\_post\_meta($product['variation\_id'], '\_regular\_price', $product['regularPrice']); |
  |  | 1987 | update\_post\_meta($product['variation\_id'], '\_price',  $product['regularPrice']); |
  |  | 1988 | wc\_delete\_product\_transients($product['variation\_id']); |
  |  | 1989 | } |
  |  | 1990 | if (isset($product['availQuantity']) &&  $product['availQuantity'] > -1) { |
  |  | 1991 | $isUpdateStockPriceOk = update\_post\_meta($product['variation\_id'], '\_stock', $product['availQuantity']); |
  |  | 1992 | } |
  |  | 1993 |  |
  |  | 1994 | if (isset($product['availQuantity']) &&  $product['availQuantity'] == 0) { |
  |  | 1995 | array\_push($outOfStock, $product['variation\_id']); |
  |  | 1996 | } else { |
  |  | 1997 | array\_push($arrayOfSuccess, $product['variation\_id']); |
  |  | 1998 | } |
  |  | 1999 | } |
  |  | 2000 | } |
  |  | 2001 | } |
  |  | 2002 | $results = array( |
  |  | 2003 | 'error' => false, |
  |  | 2004 | 'error\_msg' => '', |
  |  | 2005 | 'data' => array('totalOldVariations' => $totalOldVariations, 'error' => $arrayOfError, 'success' => $arrayOfSuccess, 'outOfStock' => $outOfStock) |
  |  | 2006 | ); |
  |  | 2007 | wp\_send\_json($results); |
  |  | 2008 | } |
  |  | 2009 |  |
  |  | 2010 | function theSharkAliExpress\_getOldProductDetails\_for\_ebay\_alibay() |
  |  | 2011 | { |
  |  | 2012 |  |
  |  | 2013 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2014 | if (!current\_user\_can('manage\_options')) { |
  |  | 2015 |  |
  |  | 2016 | // Handle unauthorized access |
  |  | 2017 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2018 | } |
  |  | 2019 |  |
  |  | 2020 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2021 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2022 | } |
  |  | 2023 |  |
  |  | 2024 |  |
  |  | 2025 |  |
  |  | 2026 |  |
  |  | 2027 |  |
  |  | 2028 |  |
  |  | 2029 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  |  | 2030 | $product = wc\_get\_product($post\_id); |
  |  | 2031 |  |
  |  | 2032 | if ($product->get\_type() == 'simple') { |
  |  | 2033 | $regularPrice = $product->get\_regular\_price(); |
  |  | 2034 | $salePrice = $product->get\_sale\_price(); |
  |  | 2035 | $quantity = $product->get\_stock\_quantity(); |
  |  | 2036 | wp\_send\_json(array('type' => 'simple', 'quantity' => $quantity, 'regularPrice' => $regularPrice, 'salePrice' => $salePrice)); |
  |  | 2037 | } |
  |  | 2038 |  |
  |  | 2039 | if ($product->get\_type() == 'variable') { |
  |  | 2040 | $oldVariations = $product->get\_available\_variations(); |
  |  | 2041 | wp\_send\_json($oldVariations); |
  |  | 2042 | } |
  |  | 2043 | } |
  |  | 2044 |  |
  |  | 2045 |  |
  |  | 2046 | function theSharkAliExpress\_searchProductBySku\_for\_ebay\_alibay() |
  |  | 2047 | { |
  |  | 2048 |  |
  |  | 2049 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2050 | if (!current\_user\_can('manage\_options')) { |
  |  | 2051 |  |
  |  | 2052 | // Handle unauthorized access |
  |  | 2053 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2054 | } |
  |  | 2055 |  |
  |  | 2056 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2057 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2058 | } |
  |  | 2059 |  |
  |  | 2060 |  |
  |  | 2061 |  |
  |  | 2062 |  |
  |  | 2063 |  |
  |  | 2064 |  |
  |  | 2065 | $searchSkuValue = isset($\_POST['searchSkuValue']) ? sanitize\_text\_field($\_POST['searchSkuValue']) : ''; |
  |  | 2066 |  |
  |  | 2067 | if (isset($searchSkuValue)) { |
  |  | 2068 | $args = array( |
  |  | 2069 | 'post\_type'      => 'product', |
  |  | 2070 | 'posts\_per\_page' => 20, |
  |  | 2071 | 'meta\_query' => array( |
  |  | 2072 | array( |
  |  | 2073 | "key" => "\_sku", |
  |  | 2074 | "value" => $searchSkuValue, |
  |  | 2075 | "compare" => "LIKE" |
  |  | 2076 | ), |
  |  | 2077 | array( |
  |  | 2078 | 'key' => 'productUrl', //meta key name here |
  |  | 2079 | 'value' => 'ebay.', |
  |  | 2080 | 'compare' => 'LIKE', |
  |  | 2081 | ) |
  |  | 2082 | ) |
  |  | 2083 | ); |
  |  | 2084 |  |
  |  | 2085 |  |
  |  | 2086 |  |
  |  | 2087 |  |
  |  | 2088 |  |
  |  | 2089 | $products = new WP\_Query($args); |
  |  | 2090 | $finalList = array(); |
  |  | 2091 |  |
  |  | 2092 | if ($products->have\_posts()) { |
  |  | 2093 | while ($products->have\_posts()) : $products->the\_post(); |
  |  | 2094 | $theid = get\_the\_ID(); |
  |  | 2095 | $product = new WC\_Product($theid); |
  |  | 2096 | if (has\_post\_thumbnail()) { |
  |  | 2097 | $thumbnail = get\_post\_thumbnail\_id(); |
  |  | 2098 | $image = $thumbnail ? wp\_get\_attachment\_url($thumbnail) : ''; |
  |  | 2099 | } |
  |  | 2100 | $finalList[] = array( |
  |  | 2101 | 'sku' => $product->get\_sku(), |
  |  | 2102 | 'id' => $theid, |
  |  | 2103 | // image => wp\_get\_attachment\_image\_src( get\_post\_thumbnail\_id($products->post->ID)), |
  |  | 2104 | 'image' => $image, |
  |  | 2105 | 'title' =>  $product->get\_title(), |
  |  | 2106 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true) |
  |  | 2107 |  |
  |  | 2108 | ); |
  |  | 2109 | endwhile; |
  |  | 2110 | } else { |
  |  | 2111 | echo \_\_('No products found'); |
  |  | 2112 | } |
  |  | 2113 | wp\_reset\_postdata(); |
  |  | 2114 |  |
  |  | 2115 | wp\_send\_json($finalList); |
  |  | 2116 | } else { |
  |  | 2117 | $results = array( |
  |  | 2118 | 'error' => true, |
  |  | 2119 | 'error\_msg' => 'cannot find result for the introduced sku value, please make sure the product is imported using theShark', |
  |  | 2120 | 'data' => '' |
  |  | 2121 | ); |
  |  | 2122 | wp\_send\_json($results); |
  |  | 2123 | } |
  |  | 2124 | } |
  |  | 2125 |  |
  |  | 2126 |  |
  |  | 2127 |  |
  |  | 2128 |  |
  |  | 2129 |  |
  |  | 2130 |  |
  |  | 2131 | function theSharkAliExpress\_removeProductFromShop\_for\_ebay\_alibay() |
  |  | 2132 | { |
  |  | 2133 |  |
  |  | 2134 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2135 | if (!current\_user\_can('manage\_options')) { |
  |  | 2136 |  |
  |  | 2137 | // Handle unauthorized access |
  |  | 2138 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2139 | } |
  |  | 2140 |  |
  |  | 2141 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2142 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2143 | } |
  |  | 2144 |  |
  |  | 2145 |  |
  |  | 2146 |  |
  |  | 2147 |  |
  |  | 2148 |  |
  |  | 2149 |  |
  |  | 2150 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  |  | 2151 | if (isset($post\_id)) { |
  |  | 2152 | $id\_remove = wp\_delete\_post($post\_id); |
  |  | 2153 | if ($id\_remove != false && isset($id\_remove)) { |
  |  | 2154 | $results = array( |
  |  | 2155 | 'error' => false, |
  |  | 2156 | 'error\_msg' => '', |
  |  | 2157 | 'data' => 'removed successfully' |
  |  | 2158 | ); |
  |  | 2159 | wp\_send\_json($results); |
  |  | 2160 | } else { |
  |  | 2161 | $results = array( |
  |  | 2162 | 'error' => trye, |
  |  | 2163 | 'error\_msg' => 'error while removing the product', |
  |  | 2164 | 'data' => '' |
  |  | 2165 | ); |
  |  | 2166 | wp\_send\_json($results); |
  |  | 2167 | } |
  |  | 2168 | } |
  |  | 2169 | } |
  |  | 2170 |  |
  |  | 2171 | function theSharkAliExpress\_insertReviewsIntoProduct\_for\_ebay\_alibay() |
  |  | 2172 | { |
  |  | 2173 |  |
  |  | 2174 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2175 | if (!current\_user\_can('manage\_options')) { |
  |  | 2176 |  |
  |  | 2177 | // Handle unauthorized access |
  |  | 2178 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2179 | } |
  |  | 2180 |  |
  |  | 2181 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2182 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2183 | } |
  |  | 2184 |  |
  |  | 2185 |  |
  |  | 2186 |  |
  |  | 2187 |  |
  |  | 2188 |  |
  |  | 2189 |  |
  |  | 2190 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  |  | 2191 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  |  | 2192 | $insertedSuccessfully = array(); |
  |  | 2193 | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  |  | 2194 |  |
  |  | 2195 | foreach ($reviews as $review) { |
  |  | 2196 | $comment\_id = wp\_insert\_comment(array( |
  |  | 2197 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 2198 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 2199 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  |  | 2200 | 'comment\_author\_url'   => '', |
  |  | 2201 | 'comment\_content'      => sanitize\_text\_field($review['review']), |
  |  | 2202 | 'comment\_type'         => '', |
  |  | 2203 | 'comment\_parent'       => 0, |
  |  | 2204 | 'user\_id'              => 5, // <== Important |
  |  | 2205 | 'comment\_author\_IP'    => '', |
  |  | 2206 | 'comment\_agent'        => '', |
  |  | 2207 | 'comment\_date'         => date('Y-m-d H:i:s'), |
  |  | 2208 | 'comment\_approved'     => 1, |
  |  | 2209 | )); |
  |  | 2210 |  |
  |  | 2211 | // HERE inserting the rating (an integer from 1 to 5) |
  |  | 2212 | $response = update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  |  | 2213 | if ($response != false && isset($response)) { |
  |  | 2214 | array\_push($insertedSuccessfully, $comment\_id); |
  |  | 2215 | } |
  |  | 2216 | } |
  |  | 2217 | wp\_send\_json(array('insertedSuccessfully' => $insertedSuccessfully)); |
  |  | 2218 | } |
  |  | 2219 | } |
  |  | 2220 |  |
  |  | 2221 | function theSharkAliExpress\_getAlreadyImportedProducts\_for\_ebay\_alibay() |
  |  | 2222 | { |
  |  | 2223 |  |
  |  | 2224 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2225 | if (!current\_user\_can('manage\_options')) { |
  |  | 2226 |  |
  |  | 2227 | // Handle unauthorized access |
  |  | 2228 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2229 | } |
  |  | 2230 |  |
  |  | 2231 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2232 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2233 | } |
  |  | 2234 |  |
  |  | 2235 |  |
  |  | 2236 |  |
  |  | 2237 |  |
  |  | 2238 |  |
  |  | 2239 |  |
  |  | 2240 | $listOfSkus = isset($\_POST['listOfSkus']) ? wc\_clean($\_POST['listOfSkus']) : array(); |
  |  | 2241 |  |
  |  | 2242 | if (isset($listOfSkus) && count($listOfSkus)) { |
  |  | 2243 | $args = array( |
  |  | 2244 | 'post\_type'      => 'product', |
  |  | 2245 | 'posts\_per\_page' => 40, |
  |  | 2246 | 'meta\_query' => array( |
  |  | 2247 | array( |
  |  | 2248 | "key" => "\_sku", |
  |  | 2249 | "value" => $listOfSkus, |
  |  | 2250 | "compare" => "IN" |
  |  | 2251 | ), array( |
  |  | 2252 | 'key' => 'productUrl', //meta key name here |
  |  | 2253 | 'value' => 'ebay.', |
  |  | 2254 | 'compare' => 'LIKE', |
  |  | 2255 | ) |
  |  | 2256 | ) |
  |  | 2257 | ); |
  |  | 2258 | $products = new WP\_Query($args); |
  |  | 2259 | $finalList = array(); |
  |  | 2260 |  |
  |  | 2261 | if ($products->have\_posts()) { |
  |  | 2262 | while ($products->have\_posts()) : $products->the\_post(); |
  |  | 2263 | $theid = get\_the\_ID(); |
  |  | 2264 | $product = new WC\_Product($theid); |
  |  | 2265 |  |
  |  | 2266 | $finalList[] = array( |
  |  | 2267 | 'sku' => $product->get\_sku(), |
  |  | 2268 | 'id' => $theid, |
  |  | 2269 | 'title' =>  $product->get\_title(), |
  |  | 2270 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true) |
  |  | 2271 |  |
  |  | 2272 | ); |
  |  | 2273 | endwhile; |
  |  | 2274 | } else { |
  |  | 2275 | echo \_\_('No products found'); |
  |  | 2276 | } |
  |  | 2277 | wp\_reset\_postdata(); |
  |  | 2278 |  |
  |  | 2279 | wp\_send\_json($finalList); |
  |  | 2280 | } |
  |  | 2281 | } |
  |  | 2282 |  |
  |  | 2283 |  |
  |  | 2284 | function theSharkAliExpress\_getSKuAbdUrlByCategory\_for\_ebay\_alibay() |
  |  | 2285 | { |
  |  | 2286 |  |
  |  | 2287 |  |
  |  | 2288 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2289 | if (!current\_user\_can('manage\_options')) { |
  |  | 2290 |  |
  |  | 2291 | // Handle unauthorized access |
  |  | 2292 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2293 | } |
  |  | 2294 |  |
  |  | 2295 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2296 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2297 | } |
  |  | 2298 |  |
  |  | 2299 |  |
  |  | 2300 |  |
  |  | 2301 |  |
  |  | 2302 |  |
  |  | 2303 |  |
  |  | 2304 | $categoryId = isset($\_POST['categoryId']) ? wc\_clean($\_POST['categoryId']) : array(); |
  |  | 2305 |  |
  |  | 2306 | if (isset($categoryId)) { |
  |  | 2307 | $args = array( |
  |  | 2308 | 'post\_type'      => 'product', |
  |  | 2309 | 'posts\_per\_page' => -1, |
  |  | 2310 | 'post\_status' => array('publish'), |
  |  | 2311 | 'meta\_query' => array( |
  |  | 2312 | array( |
  |  | 2313 | 'key' => 'productUrl', //meta key name here |
  |  | 2314 | 'value' => 'ebay.', |
  |  | 2315 | 'compare' => 'LIKE', |
  |  | 2316 | ) |
  |  | 2317 | ), |
  |  | 2318 | 'tax\_query'             => array( |
  |  | 2319 | array( |
  |  | 2320 | 'taxonomy'      => 'product\_cat', |
  |  | 2321 | 'field' => 'term\_id', //This is optional, as it defaults to 'term\_id' |
  |  | 2322 | 'terms'         => $categoryId, |
  |  | 2323 | 'operator'      => 'IN' // Possible values are 'IN', 'NOT IN', 'AND'. |
  |  | 2324 | ) |
  |  | 2325 | ) |
  |  | 2326 |  |
  |  | 2327 |  |
  |  | 2328 | ); |
  |  | 2329 | $products = new WP\_Query($args); |
  |  | 2330 | $finalList = array(); |
  |  | 2331 |  |
  |  | 2332 | if ($products->have\_posts()) { |
  |  | 2333 | while ($products->have\_posts()) : $products->the\_post(); |
  |  | 2334 | $theid = get\_the\_ID(); |
  |  | 2335 | $product = new WC\_Product($theid); |
  |  | 2336 | $finalList[] = array( |
  |  | 2337 | sku => $product->get\_sku(), |
  |  | 2338 | id => $theid, |
  |  | 2339 | productUrl => get\_post\_meta($theid, 'productUrl', true) |
  |  | 2340 |  |
  |  | 2341 | ); |
  |  | 2342 | endwhile; |
  |  | 2343 | } else { |
  |  | 2344 | echo \_\_('No products found'); |
  |  | 2345 | } |
  |  | 2346 | wp\_reset\_postdata(); |
  |  | 2347 |  |
  |  | 2348 | wp\_send\_json($finalList); |
  |  | 2349 | } |
  |  | 2350 | } |
  |  | 2351 |  |
  |  | 2352 |  |
  |  | 2353 | function theSharkAliExpress\_save\_product\_images\_for\_ebay\_alibay($product, $images) |
  |  | 2354 | { |
  |  | 2355 | $imageUploadErrors = array(); // Array to hold any image upload errors |
  |  | 2356 | if (is\_array($images)) { |
  |  | 2357 | $gallery = array(); |
  |  | 2358 | foreach ($images as $key => $image) { |
  |  | 2359 | if (isset($image)) { |
  |  | 2360 | $upload = wc\_rest\_upload\_image\_from\_url(esc\_url\_raw($image)); |
  |  | 2361 |  |
  |  | 2362 | if (is\_wp\_error($upload)) { |
  |  | 2363 | // Collect the error message and continue with the next image |
  |  | 2364 | $error\_message = $upload->get\_error\_message(); |
  |  | 2365 | array\_push($imageUploadErrors, $error\_message); |
  |  | 2366 |  |
  |  | 2367 | if (!apply\_filters('woocommerce\_rest\_suppress\_image\_upload\_error', false, $upload, $product->get\_id(), $images)) { |
  |  | 2368 | continue; |
  |  | 2369 | } |
  |  | 2370 | } else { |
  |  | 2371 | $attachment\_id = wc\_rest\_set\_uploaded\_image\_as\_attachment($upload, $product->get\_id()); |
  |  | 2372 | if ($key == 0) { |
  |  | 2373 | $product->set\_image\_id($attachment\_id); |
  |  | 2374 | } else { |
  |  | 2375 | array\_push($gallery, $attachment\_id); |
  |  | 2376 | } |
  |  | 2377 | } |
  |  | 2378 | } |
  |  | 2379 | } |
  |  | 2380 | if (!empty($gallery)) { |
  |  | 2381 | $product->set\_gallery\_image\_ids($gallery); |
  |  | 2382 | } |
  |  | 2383 | } else { |
  |  | 2384 | $product->set\_image\_id(''); |
  |  | 2385 | $product->set\_gallery\_image\_ids(array()); |
  |  | 2386 | } |
  |  | 2387 | return array('product' => $product, 'errors' => $imageUploadErrors); // Return the product and any errors |
  |  | 2388 | } |
  |  | 2389 |  |
  |  | 2390 |  |
  |  | 2391 |  |
  |  | 2392 |  |
  |  | 2393 |  |
  |  | 2394 |  |
  |  | 2395 | function theSharkAliExpress\_insertReviewsIntoProductRM\_for\_ebay() |
  |  | 2396 | { |
  |  | 2397 |  |
  |  | 2398 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2399 | if (!current\_user\_can('manage\_options')) { |
  |  | 2400 |  |
  |  | 2401 | // Handle unauthorized access |
  |  | 2402 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2403 | } |
  |  | 2404 |  |
  |  | 2405 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2406 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2407 | } |
  |  | 2408 |  |
  |  | 2409 |  |
  |  | 2410 |  |
  |  | 2411 |  |
  |  | 2412 |  |
  |  | 2413 |  |
  |  | 2414 | $post\_id = isset($\_POST['post\_id']) ? sanitize\_text\_field($\_POST['post\_id']) : ''; |
  |  | 2415 | $reviews = isset($\_POST['reviews']) ? wc\_clean($\_POST['reviews']) : array(); |
  |  | 2416 | $insertedSuccessfully = array(); |
  |  | 2417 | if (isset($post\_id) && isset($reviews) && count($reviews)) { |
  |  | 2418 |  |
  |  | 2419 | foreach ($reviews as $review) { |
  |  | 2420 | $comment\_id = wp\_insert\_comment(array( |
  |  | 2421 | 'comment\_post\_ID'      => sanitize\_text\_field($post\_id), // <=== The product ID where the review will show up |
  |  | 2422 | 'comment\_author'       => sanitize\_text\_field($review['username']), |
  |  | 2423 | 'comment\_author\_email' => sanitize\_text\_field($review['email']), // <== Important |
  |  | 2424 | 'comment\_author\_url'   => '', |
  |  | 2425 | 'comment\_content'      => $review['review'], |
  |  | 2426 | 'comment\_type'         => '', |
  |  | 2427 | 'comment\_parent'       => 0, |
  |  | 2428 | 'user\_id'              => 5, // <== Important |
  |  | 2429 | 'comment\_author\_IP'    => '', |
  |  | 2430 | 'comment\_agent'        => '', |
  |  | 2431 | 'comment\_date'         => $review['datecreation'], |
  |  | 2432 | 'comment\_approved'     => 1, |
  |  | 2433 | )); |
  |  | 2434 |  |
  |  | 2435 | // HERE inserting the rating (an integer from 1 to 5) |
  |  | 2436 | $response = update\_comment\_meta($comment\_id, 'rating', sanitize\_text\_field($review['rating'])); |
  |  | 2437 | if ($response != false && isset($response)) { |
  |  | 2438 | array\_push($insertedSuccessfully, $comment\_id); |
  |  | 2439 | } |
  |  | 2440 | } |
  |  | 2441 | wp\_send\_json(array('insertedSuccessfully' => $insertedSuccessfully)); |
  |  | 2442 | } |
  |  | 2443 | } |
  |  | 2444 |  |
  |  | 2445 |  |
  |  | 2446 | function theSharkAliExpress\_stopAutomaticUpdates\_alibay() |
  |  | 2447 | { |
  |  | 2448 |  |
  |  | 2449 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2450 | if (!current\_user\_can('manage\_options')) { |
  |  | 2451 |  |
  |  | 2452 | // Handle unauthorized access |
  |  | 2453 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2454 | } |
  |  | 2455 |  |
  |  | 2456 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2457 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2458 | } |
  |  | 2459 |  |
  |  | 2460 |  |
  |  | 2461 |  |
  |  | 2462 |  |
  |  | 2463 |  |
  |  | 2464 |  |
  |  | 2465 |  |
  |  | 2466 | update\_option('stop\_automatic\_update\_for\_ebay', 'stop'); |
  |  | 2467 | wp\_send\_json(array('stop\_automatic' => true)); |
  |  | 2468 | } |
  |  | 2469 |  |
  |  | 2470 |  |
  |  | 2471 |  |
  |  | 2472 |  |
  |  | 2473 |  |
  |  | 2474 |  |
  |  | 2475 |  |
  |  | 2476 |  |
  |  | 2477 |  |
  |  | 2478 |  |
  |  | 2479 | function theSharkAliExpress\_removeProductFromShop\_forEBAY\_alibay() |
  |  | 2480 | { |
  |  | 2481 |  |
  |  | 2482 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2483 | if (!current\_user\_can('manage\_options')) { |
  |  | 2484 |  |
  |  | 2485 | // Handle unauthorized access |
  |  | 2486 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2487 | } |
  |  | 2488 |  |
  |  | 2489 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2490 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2491 | } |
  |  | 2492 |  |
  |  | 2493 |  |
  |  | 2494 |  |
  |  | 2495 |  |
  |  | 2496 |  |
  |  | 2497 |  |
  |  | 2498 | $post\_id = isset($\_POST['post\_id']) ? wc\_clean($\_POST['post\_id']) : ''; |
  |  | 2499 | if (isset($post\_id)) { |
  |  | 2500 | $id\_remove = wp\_delete\_post($post\_id); |
  |  | 2501 | if ($id\_remove != false && isset($id\_remove)) { |
  |  | 2502 | $results = array( |
  |  | 2503 | 'error' => false, |
  |  | 2504 | 'error\_msg' => '', |
  |  | 2505 | 'data' => 'removed successfully' |
  |  | 2506 | ); |
  |  | 2507 | wp\_send\_json($results); |
  |  | 2508 | } else { |
  |  | 2509 | $results = array( |
  |  | 2510 | 'error' => trye, |
  |  | 2511 | 'error\_msg' => 'error while removing the product', |
  |  | 2512 | 'data' => '' |
  |  | 2513 | ); |
  |  | 2514 | wp\_send\_json($results); |
  |  | 2515 | } |
  |  | 2516 | } |
  |  | 2517 | } |
  |  | 2518 |  |
  |  | 2519 |  |
  |  | 2520 |  |
  |  | 2521 |  |
  |  | 2522 | function theSharkAliExpress\_get\_aliexpress\_products\_alibay() |
  |  | 2523 | { |
  |  | 2524 |  |
  |  | 2525 |  |
  |  | 2526 |  |
  |  | 2527 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2528 | if (!current\_user\_can('manage\_options')) { |
  |  | 2529 |  |
  |  | 2530 | // Handle unauthorized access |
  |  | 2531 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2532 | } |
  |  | 2533 |  |
  |  | 2534 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2535 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2536 | } |
  |  | 2537 |  |
  |  | 2538 |  |
  |  | 2539 |  |
  |  | 2540 |  |
  |  | 2541 |  |
  |  | 2542 |  |
  |  | 2543 | $page = isset($\_POST['page']) ? intval($\_POST['page']) : 1; |
  |  | 2544 | $products\_per\_page = 20; |
  |  | 2545 |  |
  |  | 2546 | // Define arrays to store selected supplier and product type filters |
  |  | 2547 | $selected\_suppliers = isset($\_POST['suppliers']) ? $\_POST['suppliers'] : array('aliexpress'); |
  |  | 2548 | $selected\_product\_types = isset($\_POST['product\_types']) ? $\_POST['product\_types'] : array(); |
  |  | 2549 |  |
  |  | 2550 | // Query for products based on selected supplier and product type filters |
  |  | 2551 | $args = array( |
  |  | 2552 | 'post\_type' => 'product', // Adjust post type as needed |
  |  | 2553 | 'posts\_per\_page' => $products\_per\_page, |
  |  | 2554 | 'paged' => $page |
  |  | 2555 | ); |
  |  | 2556 |  |
  |  | 2557 | // If specific supplier filters are selected, modify the query accordingly |
  |  | 2558 | if (!empty($selected\_suppliers)) { |
  |  | 2559 | // Modify the meta\_query to include the selected supplier filters |
  |  | 2560 | $meta\_query\_suppliers = array('relation' => 'OR'); |
  |  | 2561 |  |
  |  | 2562 | foreach ($selected\_suppliers as $supplier) { |
  |  | 2563 | $meta\_query\_suppliers[] = array( |
  |  | 2564 | 'key' => 'productUrl', // Adjust metadata key as needed |
  |  | 2565 | 'value' => $supplier, |
  |  | 2566 | 'compare' => 'LIKE' // Use 'LIKE' for a partial match |
  |  | 2567 | ); |
  |  | 2568 | } |
  |  | 2569 |  |
  |  | 2570 | $args['meta\_query'] = $meta\_query\_suppliers; |
  |  | 2571 | } |
  |  | 2572 |  |
  |  | 2573 | // If specific product type filters are selected, modify the query accordingly |
  |  | 2574 | if (!empty($selected\_product\_types)) { |
  |  | 2575 | // Modify the tax\_query to include the selected product type filters |
  |  | 2576 | $tax\_query\_product\_types = array('relation' => 'OR'); |
  |  | 2577 |  |
  |  | 2578 | foreach ($selected\_product\_types as $product\_type) { |
  |  | 2579 | $tax\_query\_product\_types[] = array( |
  |  | 2580 | 'taxonomy' => 'product\_type', // Adjust taxonomy as needed |
  |  | 2581 | 'field' => 'slug', |
  |  | 2582 | 'terms' => $product\_type |
  |  | 2583 | ); |
  |  | 2584 | } |
  |  | 2585 |  |
  |  | 2586 | $args['tax\_query'] = $tax\_query\_product\_types; |
  |  | 2587 | } |
  |  | 2588 |  |
  |  | 2589 | $products\_query = new WP\_Query($args); |
  |  | 2590 |  |
  |  | 2591 | // Calculate total pages |
  |  | 2592 | $total\_pages = $products\_query->max\_num\_pages; |
  |  | 2593 | $total\_products = $products\_query->found\_posts; |
  |  | 2594 |  |
  |  | 2595 | // Process and prepare the products data |
  |  | 2596 | $products = array(); |
  |  | 2597 | if ($products\_query->have\_posts()) { |
  |  | 2598 | while ($products\_query->have\_posts()) { |
  |  | 2599 | $products\_query->the\_post(); |
  |  | 2600 | global $product; |
  |  | 2601 | $theid = get\_the\_ID(); |
  |  | 2602 |  |
  |  | 2603 | $product\_data = array( |
  |  | 2604 | 'image' => get\_the\_post\_thumbnail\_url(), |
  |  | 2605 | 'sku' => $product->get\_sku(), |
  |  | 2606 | 'id' => get\_the\_ID(), |
  |  | 2607 | 'title' => get\_the\_title(), |
  |  | 2608 | 'permalink' =>  get\_edit\_post\_link($theid), |
  |  | 2609 | 'permalink\_preview' => get\_permalink(), |
  |  | 2610 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true), |
  |  | 2611 | 'status' => get\_post\_status($theid), |
  |  | 2612 | 'lastUpdatedDate' => get\_post\_meta($theid, 'lastUpdatedDate', true), |
  |  | 2613 | 'productType' => $product->get\_type(), |
  |  | 2614 | 'variationCount' => 0, // Initialize variation count |
  |  | 2615 | 'selectedCurrency' => get\_post\_meta($theid, 'selectedCurrency', true) |
  |  | 2616 |  |
  |  | 2617 | // Add other product data fields as needed |
  |  | 2618 | ); |
  |  | 2619 |  |
  |  | 2620 | if ($product->is\_type('variable')) { |
  |  | 2621 | // Get variations |
  |  | 2622 | $variations = $product->get\_children(); |
  |  | 2623 |  |
  |  | 2624 | // Count the number of variations |
  |  | 2625 | $product\_data['variationCount'] = count($variations); |
  |  | 2626 | } |
  |  | 2627 |  |
  |  | 2628 |  |
  |  | 2629 | $products[] = $product\_data; |
  |  | 2630 | } |
  |  | 2631 | } |
  |  | 2632 |  |
  |  | 2633 | // Return the products data and total pages as a JSON response |
  |  | 2634 | wp\_send\_json(array( |
  |  | 2635 | 'products' => $products, |
  |  | 2636 | 'total\_pages' => $total\_pages, |
  |  | 2637 | 'total\_products' => $total\_products, // Add this line |
  |  | 2638 | )); |
  |  | 2639 |  |
  |  | 2640 | // Don't forget to exit |
  |  | 2641 | wp\_die(); |
  |  | 2642 | } |
  |  | 2643 |  |
  |  | 2644 |  |
  |  | 2645 |  |
  |  | 2646 |  |
  |  | 2647 |  |
  |  | 2648 | function getProduct\_FROMWP\_alibay() |
  |  | 2649 | { |
  |  | 2650 |  |
  |  | 2651 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2652 | if (!current\_user\_can('manage\_options')) { |
  |  | 2653 |  |
  |  | 2654 | // Handle unauthorized access |
  |  | 2655 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2656 | } |
  |  | 2657 |  |
  |  | 2658 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2659 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2660 | } |
  |  | 2661 |  |
  |  | 2662 |  |
  |  | 2663 |  |
  |  | 2664 |  |
  |  | 2665 |  |
  |  | 2666 |  |
  |  | 2667 | $page = isset($\_POST['page']) ? intval($\_POST['page']) : 1; |
  |  | 2668 | $products\_per\_page = 20; |
  |  | 2669 |  |
  |  | 2670 | // Query for products with metadata key 'productUrl' containing 'aliexpress' |
  |  | 2671 | $args = array( |
  |  | 2672 | 'post\_type'      => 'product', |
  |  | 2673 | 'post\_status' => array('publish', 'draft'), |
  |  | 2674 | 'paged' => $page, |
  |  | 2675 | 'posts\_per\_page' => 20, |
  |  | 2676 | 'meta\_query' => array( |
  |  | 2677 | 'relation' => 'OR', |
  |  | 2678 | array( |
  |  | 2679 | 'key' => 'productUrl', //meta key name here |
  |  | 2680 | 'value' => 'aliexpress', |
  |  | 2681 | 'compare' => 'LIKE' |
  |  | 2682 | ) |
  |  | 2683 |  |
  |  | 2684 | ) |
  |  | 2685 | ); |
  |  | 2686 |  |
  |  | 2687 | $products\_query = new WP\_Query($args); |
  |  | 2688 |  |
  |  | 2689 | // Calculate total pages |
  |  | 2690 | $total\_pages = $products\_query->max\_num\_pages; |
  |  | 2691 |  |
  |  | 2692 | // Process and prepare the products data |
  |  | 2693 | $products = array(); |
  |  | 2694 | if ($products\_query->have\_posts()) { |
  |  | 2695 | while ($products\_query->have\_posts()) { |
  |  | 2696 | $products\_query->the\_post(); |
  |  | 2697 | global $product; |
  |  | 2698 | $theid = get\_the\_ID(); |
  |  | 2699 |  |
  |  | 2700 | $product\_data = array( |
  |  | 2701 | 'image' => get\_the\_post\_thumbnail\_url(), |
  |  | 2702 | 'sku' => $product->get\_sku(), // Get SKU using WooCommerce's get\_sku() method |
  |  | 2703 | 'id' => get\_the\_ID(), |
  |  | 2704 | 'title' => get\_the\_title(), |
  |  | 2705 | 'permalink' =>  get\_edit\_post\_link($theid), |
  |  | 2706 | 'permalink\_preview' => get\_permalink(), |
  |  | 2707 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true), |
  |  | 2708 | 'status' => get\_post\_status($theid), // Get the product status |
  |  | 2709 | 'lastUpdatedDate' => get\_post\_meta($theid, 'lastUpdatedDate', true), |
  |  | 2710 | 'productType' => $product->get\_type(), |
  |  | 2711 |  |
  |  | 2712 |  |
  |  | 2713 |  |
  |  | 2714 | // Add other product data fields as needed |
  |  | 2715 | ); |
  |  | 2716 | $products[] = $product\_data; |
  |  | 2717 | } |
  |  | 2718 | } |
  |  | 2719 |  |
  |  | 2720 | // Return the products data and total pages as a JSON response |
  |  | 2721 | wp\_send\_json(array( |
  |  | 2722 | 'products' => $products, |
  |  | 2723 | 'total\_pages' => $total\_pages, |
  |  | 2724 | )); |
  |  | 2725 |  |
  |  | 2726 | // Don't forget to exit |
  |  | 2727 | wp\_die(); |
  |  | 2728 | } |
  |  | 2729 |  |
  |  | 2730 |  |
  |  | 2731 |  |
  |  | 2732 | function theSharkAliExpress\_searchProductBySku() |
  |  | 2733 | { |
  |  | 2734 |  |
  |  | 2735 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2736 | if (!current\_user\_can('manage\_options')) { |
  |  | 2737 |  |
  |  | 2738 | // Handle unauthorized access |
  |  | 2739 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2740 | } |
  |  | 2741 |  |
  |  | 2742 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2743 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2744 | } |
  |  | 2745 |  |
  |  | 2746 |  |
  |  | 2747 |  |
  |  | 2748 |  |
  |  | 2749 |  |
  |  | 2750 |  |
  |  | 2751 | $searchSkuValue = isset($\_POST['searchSkuValue']) ? wc\_clean($\_POST['searchSkuValue']) : ''; |
  |  | 2752 |  |
  |  | 2753 | if (isset($searchSkuValue)) { |
  |  | 2754 | $args = array( |
  |  | 2755 | 'post\_type'      => 'product', |
  |  | 2756 | 'posts\_per\_page' => 20, |
  |  | 2757 | 'meta\_query' => array( |
  |  | 2758 | array( |
  |  | 2759 | "key" => "\_sku", |
  |  | 2760 | "value" => $searchSkuValue, |
  |  | 2761 | "compare" => "LIKE" |
  |  | 2762 | ) |
  |  | 2763 |  |
  |  | 2764 | ) |
  |  | 2765 | ); |
  |  | 2766 |  |
  |  | 2767 |  |
  |  | 2768 |  |
  |  | 2769 |  |
  |  | 2770 |  |
  |  | 2771 | $products\_query = new WP\_Query($args); |
  |  | 2772 |  |
  |  | 2773 | // Calculate total pages |
  |  | 2774 | $total\_pages = $products\_query->max\_num\_pages; |
  |  | 2775 |  |
  |  | 2776 | // Process and prepare the products data |
  |  | 2777 | $products = array(); |
  |  | 2778 | if ($products\_query->have\_posts()) { |
  |  | 2779 | while ($products\_query->have\_posts()) { |
  |  | 2780 | $products\_query->the\_post(); |
  |  | 2781 | global $product; |
  |  | 2782 | $theid = get\_the\_ID(); |
  |  | 2783 |  |
  |  | 2784 | $product\_data = array( |
  |  | 2785 | 'image' => get\_the\_post\_thumbnail\_url(), |
  |  | 2786 | 'sku' => $product->get\_sku(), // Get SKU using WooCommerce's get\_sku() method |
  |  | 2787 | 'id' => get\_the\_ID(), |
  |  | 2788 | 'title' => get\_the\_title(), |
  |  | 2789 | 'permalink' =>  get\_edit\_post\_link($theid), |
  |  | 2790 | 'permalink\_preview' => get\_permalink(), |
  |  | 2791 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true), |
  |  | 2792 | 'status' => get\_post\_status($theid), // Get the product status |
  |  | 2793 | 'lastUpdatedDate' => get\_post\_meta($theid, 'lastUpdatedDate', true), |
  |  | 2794 | 'productType' => $product->get\_type(), |
  |  | 2795 |  |
  |  | 2796 |  |
  |  | 2797 |  |
  |  | 2798 | // Add other product data fields as needed |
  |  | 2799 | ); |
  |  | 2800 | $products[] = $product\_data; |
  |  | 2801 | } |
  |  | 2802 | } |
  |  | 2803 |  |
  |  | 2804 | // Return the products data and total pages as a JSON response |
  |  | 2805 | wp\_send\_json(array( |
  |  | 2806 | 'products' => $products, |
  |  | 2807 | 'total\_pages' => $total\_pages, |
  |  | 2808 | )); |
  |  | 2809 |  |
  |  | 2810 | // Don't forget to exit |
  |  | 2811 | wp\_die(); |
  |  | 2812 | } |
  |  | 2813 | } |
  |  | 2814 |  |
  |  | 2815 |  |
  |  | 2816 |  |
  |  | 2817 |  |
  |  | 2818 |  |
  |  | 2819 |  |
  |  | 2820 |  |
  |  | 2821 | function theSharkAliExpress\_get\_products\_by\_type\_alibay() |
  |  | 2822 | { |
  |  | 2823 |  |
  |  | 2824 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2825 | if (!current\_user\_can('manage\_options')) { |
  |  | 2826 |  |
  |  | 2827 | // Handle unauthorized access |
  |  | 2828 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2829 | } |
  |  | 2830 |  |
  |  | 2831 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2832 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2833 | } |
  |  | 2834 |  |
  |  | 2835 |  |
  |  | 2836 |  |
  |  | 2837 |  |
  |  | 2838 |  |
  |  | 2839 |  |
  |  | 2840 |  |
  |  | 2841 | $page = isset($\_POST['page']) ? intval($\_POST['page']) : 1; |
  |  | 2842 | $product\_type = isset($\_POST['product\_type']) ? wc\_clean($\_POST['product\_type']) : 'simple'; |
  |  | 2843 | // $product\_type  = 'external'; |
  |  | 2844 | $products\_per\_page = 20; |
  |  | 2845 |  |
  |  | 2846 |  |
  |  | 2847 |  |
  |  | 2848 |  |
  |  | 2849 | $args = array( |
  |  | 2850 | 'post\_type'      => 'product', |
  |  | 2851 | 'post\_status' => array('publish', 'draft'), |
  |  | 2852 | 'paged' => $page, |
  |  | 2853 | 'posts\_per\_page' => 20, |
  |  | 2854 |  |
  |  | 2855 | 'meta\_query' => array( |
  |  | 2856 | 'relation' => 'OR', |
  |  | 2857 | array( |
  |  | 2858 | 'key' => 'productUrl', //meta key name here |
  |  | 2859 | 'value' => 'aliexpress', |
  |  | 2860 | 'compare' => 'LIKE' |
  |  | 2861 | ), |
  |  | 2862 |  |
  |  | 2863 | ), |
  |  | 2864 | 'tax\_query' => array( |
  |  | 2865 | array( |
  |  | 2866 | 'taxonomy' => 'product\_type', // Taxonomy name for product type in WooCommerce |
  |  | 2867 | 'field' => 'slug', // You can also use 'term\_id', 'name', or 'id' here |
  |  | 2868 | 'terms' => $product\_type, // The product type you want to search for (e.g., 'simple') |
  |  | 2869 | 'operator' => 'IN', // Use 'IN' to search for an exact match |
  |  | 2870 | ) |
  |  | 2871 | ), |
  |  | 2872 | ); |
  |  | 2873 |  |
  |  | 2874 |  |
  |  | 2875 |  |
  |  | 2876 | $products\_query = new WP\_Query($args); |
  |  | 2877 |  |
  |  | 2878 | // Calculate total pages |
  |  | 2879 | $total\_pages = $products\_query->max\_num\_pages; |
  |  | 2880 |  |
  |  | 2881 | // Process and prepare the products data |
  |  | 2882 | $products = array(); |
  |  | 2883 | if ($products\_query->have\_posts()) { |
  |  | 2884 | while ($products\_query->have\_posts()) { |
  |  | 2885 | $products\_query->the\_post(); |
  |  | 2886 | global $product; |
  |  | 2887 | $theid = get\_the\_ID(); |
  |  | 2888 |  |
  |  | 2889 | $product\_data = array( |
  |  | 2890 | 'image' => get\_the\_post\_thumbnail\_url(), |
  |  | 2891 | 'sku' => $product->get\_sku(), // Get SKU using WooCommerce's get\_sku() method |
  |  | 2892 | 'id' => get\_the\_ID(), |
  |  | 2893 | 'title' => get\_the\_title(), |
  |  | 2894 | 'permalink' =>  get\_edit\_post\_link($theid), |
  |  | 2895 | 'permalink\_preview' => get\_permalink(), |
  |  | 2896 | 'productUrl' => get\_post\_meta($theid, 'productUrl', true), |
  |  | 2897 | 'status' => get\_post\_status($theid), // Get the product status |
  |  | 2898 | 'lastUpdatedDate' => get\_post\_meta($theid, 'lastUpdatedDate', true), |
  |  | 2899 | 'productType' => $product->get\_type(), |
  |  | 2900 |  |
  |  | 2901 | // Add other product data fields as needed |
  |  | 2902 | ); |
  |  | 2903 | $products[] = $product\_data; |
  |  | 2904 | } |
  |  | 2905 | } |
  |  | 2906 |  |
  |  | 2907 | // Return the products data and total pages as a JSON response |
  |  | 2908 | wp\_send\_json(array( |
  |  | 2909 | 'products' => $products, |
  |  | 2910 | 'total\_pages' => $total\_pages, |
  |  | 2911 | )); |
  |  | 2912 |  |
  |  | 2913 | // Don't forget to exit |
  |  | 2914 | wp\_die(); |
  |  | 2915 | } |
  |  | 2916 |  |
  |  | 2917 |  |
  |  | 2918 |  |
  |  | 2919 |  |
  |  | 2920 |  |
  |  | 2921 |  |
  |  | 2922 | // Define a function to retrieve product details |
  |  | 2923 | function theSharkAliExpress\_get\_product\_details\_alibay() |
  |  | 2924 | { |
  |  | 2925 |  |
  |  | 2926 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2927 | if (!current\_user\_can('manage\_options')) { |
  |  | 2928 |  |
  |  | 2929 | // Handle unauthorized access |
  |  | 2930 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2931 | } |
  |  | 2932 |  |
  |  | 2933 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2934 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2935 | } |
  |  | 2936 |  |
  |  | 2937 |  |
  |  | 2938 |  |
  |  | 2939 |  |
  |  | 2940 |  |
  |  | 2941 |  |
  |  | 2942 | try { |
  |  | 2943 | // Check if the productId parameter is provided in the AJAX request |
  |  | 2944 | if (isset($\_GET['productId'])) { |
  |  | 2945 | $product\_id = wc\_clean($\_GET['productId']); |
  |  | 2946 |  |
  |  | 2947 | // Get the product by ID |
  |  | 2948 | $product = wc\_get\_product($product\_id); |
  |  | 2949 |  |
  |  | 2950 | if ($product) { |
  |  | 2951 | $product\_data = array( |
  |  | 2952 | 'stock' => $product->get\_stock\_quantity(), |
  |  | 2953 | 'price' => $product->get\_price(), |
  |  | 2954 | 'salePrice' => $product->get\_sale\_price(), |
  |  | 2955 | ); |
  |  | 2956 |  |
  |  | 2957 | wp\_send\_json\_success($product\_data); |
  |  | 2958 | } else { |
  |  | 2959 | wp\_send\_json\_error(array('message' => 'Product not found')); |
  |  | 2960 | } |
  |  | 2961 | } else { |
  |  | 2962 | wp\_send\_json\_error(array('message' => 'Product ID not provided')); |
  |  | 2963 | } |
  |  | 2964 |  |
  |  | 2965 | // Always exit to prevent further WordPress processing |
  |  | 2966 | wp\_die(); |
  |  | 2967 | } catch (Exception $e) { |
  |  | 2968 | $results = array( |
  |  | 2969 | 'error' => true, |
  |  | 2970 | 'error\_msg' => 'Error while retrieving details' . $e->getMessage(), |
  |  | 2971 | 'data' => '' |
  |  | 2972 | ); |
  |  | 2973 | wp\_send\_json($results); |
  |  | 2974 | } |
  |  | 2975 | } |
  |  | 2976 |  |
  |  | 2977 |  |
  |  | 2978 |  |
  |  | 2979 |  |
  |  | 2980 |  |
  |  | 2981 | function theSharkAliExpress\_update\_variations\_on\_woocommerce\_alibay() |
  |  | 2982 | { |
  |  | 2983 |  |
  |  | 2984 |  |
  |  | 2985 |  |
  |  | 2986 | // Check if the user is authenticated and has the necessary permissions |
  |  | 2987 | if (!current\_user\_can('manage\_options')) { |
  |  | 2988 |  |
  |  | 2989 | // Handle unauthorized access |
  |  | 2990 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2991 | } |
  |  | 2992 |  |
  |  | 2993 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 2994 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 2995 | } |
  |  | 2996 |  |
  |  | 2997 |  |
  |  | 2998 |  |
  |  | 2999 |  |
  |  | 3000 |  |
  |  | 3001 |  |
  |  | 3002 |  |
  |  | 3003 | // Check if the user is logged in and has permission |
  |  | 3004 | if (!current\_user\_can('manage\_options')) { |
  |  | 3005 |  |
  |  | 3006 | wp\_send\_json\_error(array('message' => 'Permission denied')); |
  |  | 3007 | } |
  |  | 3008 | $isPremuim = false; |
  |  | 3009 | if ($isPremuim) { |
  |  | 3010 | checkDailyUpdatePemuim\_alibay(); |
  |  | 3011 | } else { |
  |  | 3012 | checkDailyUpdate\_alibay(); |
  |  | 3013 | } |
  |  | 3014 |  |
  |  | 3015 | // $post\_id = wc\_clean($\_POST['parentId']); |
  |  | 3016 | $post\_id = wc\_get\_product\_id\_by\_sku($\_POST['parentId']); |
  |  | 3017 |  |
  |  | 3018 | $lastUpdatedDate = current\_time('mysql', 1); |
  |  | 3019 | update\_post\_meta($post\_id, 'lastUpdatedDate', $lastUpdatedDate); |
  |  | 3020 |  |
  |  | 3021 | // Check if the AJAX request contains the update type parameter |
  |  | 3022 | $updateType =  wc\_clean($\_POST['updateType']); |
  |  | 3023 | // wp\_send\_json\_success($post\_id); |
  |  | 3024 |  |
  |  | 3025 | // Check if the AJAX request contains variations data |
  |  | 3026 | if ($updateType === 'variations' && isset($\_POST['variations'])) { |
  |  | 3027 | $variations = $\_POST['variations']; |
  |  | 3028 |  |
  |  | 3029 | // Loop through the variations and update them in WooCommerce |
  |  | 3030 | foreach ($variations as $variation) { |
  |  | 3031 | $sku = wc\_clean($variation['sku']); |
  |  | 3032 | $quantity = wc\_clean($variation['quantity']); |
  |  | 3033 | $price = wc\_clean($variation['regularPrice']); |
  |  | 3034 | $salePrice = wc\_clean($variation['salePrice']); |
  |  | 3035 | $regularPrice = wc\_clean($variation['regularPrice']); |
  |  | 3036 |  |
  |  | 3037 | // Get the product variation ID by SKU |
  |  | 3038 | $product\_variation\_id = wc\_get\_product\_id\_by\_sku($sku); |
  |  | 3039 |  |
  |  | 3040 | // Check if the product variation exists |
  |  | 3041 | if ($product\_variation\_id) { |
  |  | 3042 | $variation\_data = array(); |
  |  | 3043 |  |
  |  | 3044 | // Update stock quantity |
  |  | 3045 | update\_post\_meta($product\_variation\_id, '\_stock', $quantity); |
  |  | 3046 |  |
  |  | 3047 | // Update regular price and sale price if provided |
  |  | 3048 | if ($regularPrice !== '') { |
  |  | 3049 | update\_post\_meta($product\_variation\_id, '\_regular\_price', $regularPrice); |
  |  | 3050 | update\_post\_meta($product\_variation\_id, '\_price', $regularPrice); |
  |  | 3051 | } |
  |  | 3052 | if ($salePrice !== '') { |
  |  | 3053 | update\_post\_meta($product\_variation\_id, '\_sale\_price', $salePrice); |
  |  | 3054 | } |
  |  | 3055 |  |
  |  | 3056 | // Update the variation data using WooCommerce functions |
  |  | 3057 | wc\_delete\_product\_transients($product\_variation\_id); // Clear/refresh the variation cache |
  |  | 3058 | } |
  |  | 3059 | } |
  |  | 3060 | $currentUpdateCount = get\_option('alibay\_daily\_update\_count', 0); |
  |  | 3061 | update\_option('alibay\_daily\_update\_count', ++$currentUpdateCount); |
  |  | 3062 |  |
  |  | 3063 | wp\_send\_json\_success(array('message' => 'Variations updated successfully')); |
  |  | 3064 | } elseif ($updateType === 'simple' && isset($\_POST['variations'])) { |
  |  | 3065 | $variations = $\_POST['variations']; |
  |  | 3066 | // wp\_send\_json\_success($variations); |
  |  | 3067 |  |
  |  | 3068 | // Loop through the simple products and update them in WooCommerce |
  |  | 3069 | foreach ($variations as $simpleProduct) { |
  |  | 3070 | $product\_id = wc\_clean($simpleProduct['sku']); |
  |  | 3071 | $quantity = wc\_clean($simpleProduct['quantity']); |
  |  | 3072 | $price = wc\_clean($simpleProduct['regularPrice']); |
  |  | 3073 | $salePrice = wc\_clean($simpleProduct['salePrice']); |
  |  | 3074 | $regularPrice = wc\_clean($simpleProduct['regularPrice']); |
  |  | 3075 |  |
  |  | 3076 | // Get the simple product ID by SKU |
  |  | 3077 | // $product\_id = wc\_get\_product\_id\_by\_sku($sku); |
  |  | 3078 |  |
  |  | 3079 | // Check if the simple product exists |
  |  | 3080 | if ($product\_id) { |
  |  | 3081 | $product = wc\_get\_product($post\_id); |
  |  | 3082 |  |
  |  | 3083 | // Update stock quantity |
  |  | 3084 | update\_post\_meta($product\_id, '\_stock', $quantity); |
  |  | 3085 |  |
  |  | 3086 |  |
  |  | 3087 | if ($regularPrice !== '') { |
  |  | 3088 | $product->set\_regular\_price($regularPrice); |
  |  | 3089 | $product->set\_price($regularPrice); |
  |  | 3090 | } |
  |  | 3091 | if ($salePrice !== '') { |
  |  | 3092 | $product->set\_sale\_price($salePrice); |
  |  | 3093 | } |
  |  | 3094 |  |
  |  | 3095 | $product->save(); |
  |  | 3096 | } |
  |  | 3097 | } |
  |  | 3098 |  |
  |  | 3099 | $currentUpdateCount = get\_option('alibay\_daily\_update\_count', 0); |
  |  | 3100 | update\_option('alibay\_daily\_update\_count', ++$currentUpdateCount); |
  |  | 3101 |  |
  |  | 3102 | wp\_send\_json\_success(array('message' => 'Simple products updated successfully')); |
  |  | 3103 | } else { |
  |  | 3104 | wp\_send\_json\_error(array('message' => 'Invalid update type or no data provided')); |
  |  | 3105 | } |
  |  | 3106 |  |
  |  | 3107 | // Always exit to prevent further WordPress processing |
  |  | 3108 | wp\_die(); |
  |  | 3109 | } |
  |  | 3110 |  |
  |  | 3111 |  |
  |  | 3112 |  |
  |  | 3113 | function theSharkAliExpress\_set\_product\_to\_draft\_callback\_alibay() |
  |  | 3114 | { |
  |  | 3115 |  |
  |  | 3116 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3117 | if (!current\_user\_can('manage\_options')) { |
  |  | 3118 |  |
  |  | 3119 | // Handle unauthorized access |
  |  | 3120 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3121 | } |
  |  | 3122 |  |
  |  | 3123 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3124 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3125 | } |
  |  | 3126 |  |
  |  | 3127 |  |
  |  | 3128 |  |
  |  | 3129 |  |
  |  | 3130 |  |
  |  | 3131 |  |
  |  | 3132 |  |
  |  | 3133 | // Check if the user has the necessary permissions (e.g., manage\_options) |
  |  | 3134 | if (!current\_user\_can('manage\_options')) { |
  |  | 3135 |  |
  |  | 3136 | wp\_send\_json\_error(array('message' => 'Permission denied')); |
  |  | 3137 | } |
  |  | 3138 |  |
  |  | 3139 | // Get the product ID from the AJAX request |
  |  | 3140 | $product\_id = wc\_clean($\_POST['product\_id']); |
  |  | 3141 |  |
  |  | 3142 | // Check if the product ID is valid |
  |  | 3143 | if ($product\_id <= 0) { |
  |  | 3144 | wp\_send\_json\_error(array('message' => 'Invalid product ID')); |
  |  | 3145 | } |
  |  | 3146 |  |
  |  | 3147 | // Update the product status to "draft" |
  |  | 3148 | $update\_product = array( |
  |  | 3149 | 'ID' => $product\_id, |
  |  | 3150 | 'post\_status' => 'draft' |
  |  | 3151 | ); |
  |  | 3152 |  |
  |  | 3153 | $updated = wp\_update\_post($update\_product); |
  |  | 3154 |  |
  |  | 3155 | if ($updated !== 0) { |
  |  | 3156 | // Send a success response |
  |  | 3157 | wp\_send\_json\_success(array('message' => 'Product set to draft successfully')); |
  |  | 3158 | } else { |
  |  | 3159 | // Send an error response if the update fails |
  |  | 3160 | wp\_send\_json\_error(array('message' => 'Failed to set product to draft')); |
  |  | 3161 | } |
  |  | 3162 | } |
  |  | 3163 |  |
  |  | 3164 | require\_once(plugin\_dir\_path(\_\_FILE\_\_) . 'lib/simple\_html\_dom.php'); |
  |  | 3165 |  |
  |  | 3166 |  |
  |  | 3167 |  |
  |  | 3168 | function theSharkAliExpress\_fetchemote\_alibay() |
  |  | 3169 | { |
  |  | 3170 |  |
  |  | 3171 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3172 | if (!current\_user\_can('manage\_options')) { |
  |  | 3173 |  |
  |  | 3174 | // Handle unauthorized access |
  |  | 3175 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3176 | } |
  |  | 3177 |  |
  |  | 3178 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3179 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3180 | } |
  |  | 3181 |  |
  |  | 3182 |  |
  |  | 3183 |  |
  |  | 3184 |  |
  |  | 3185 |  |
  |  | 3186 |  |
  |  | 3187 | try { |
  |  | 3188 | // eBay URL to fetch HTML from |
  |  | 3189 | $ebay\_url = isset($\_POST['url']) ? sanitize\_text\_field($\_POST['url']) : ''; |
  |  | 3190 |  |
  |  | 3191 | // Check if the eBay URL is provided and valid |
  |  | 3192 | if (empty($ebay\_url) || !filter\_var($ebay\_url, FILTER\_VALIDATE\_URL)) { |
  |  | 3193 | wp\_send\_json\_error(array('message' => 'Invalid eBay URL')); |
  |  | 3194 | } |
  |  | 3195 |  |
  |  | 3196 | // Make an HTTP GET request to fetch the HTML content |
  |  | 3197 | $response = wp\_safe\_remote\_get($ebay\_url); |
  |  | 3198 |  |
  |  | 3199 | // Check for HTTP request errors |
  |  | 3200 | if (is\_wp\_error($response)) { |
  |  | 3201 | wp\_send\_json\_error(array('message' => 'Error fetching eBay product page')); |
  |  | 3202 | } |
  |  | 3203 |  |
  |  | 3204 | // Get the HTML content from the response |
  |  | 3205 | $html\_content = wp\_remote\_retrieve\_body($response); |
  |  | 3206 |  |
  |  | 3207 | // Load the HTML content into a DOMDocument |
  |  | 3208 | $dom = new DOMDocument; |
  |  | 3209 | libxml\_use\_internal\_errors(true); |
  |  | 3210 | $dom->loadHTML($html\_content); |
  |  | 3211 | libxml\_clear\_errors(); |
  |  | 3212 |  |
  |  | 3213 |  |
  |  | 3214 | // XPath query to locate the "Product not found" message |
  |  | 3215 | $xpath = new DOMXPath($dom); |
  |  | 3216 | $not\_found\_elements = $xpath->query('//p[@class="error-header\_\_headline" and text()="Nous avons cherché partout."]'); |
  |  | 3217 |  |
  |  | 3218 | // Check if the "Product not found" message is found |
  |  | 3219 | if ($not\_found\_elements->length > 0) { |
  |  | 3220 | wp\_send\_json\_error(array('message' => 'Product not found', 'status\_code' => 488)); |
  |  | 3221 | } else { |
  |  | 3222 | wp\_send\_json\_success(array('message' => 'Product found', 'status\_code' => 200)); |
  |  | 3223 | } |
  |  | 3224 | } catch (Exception $e) { |
  |  | 3225 | $results = array( |
  |  | 3226 | 'error' => true, |
  |  | 3227 | 'error\_msg' => 'Error received when trying to insert the product: ' . $e->getMessage(), |
  |  | 3228 | 'data' => '' |
  |  | 3229 | ); |
  |  | 3230 | wp\_send\_json($results); |
  |  | 3231 | } |
  |  | 3232 | } |
  |  | 3233 |  |
  |  | 3234 |  |
  |  | 3235 |  |
  |  | 3236 |  |
  |  | 3237 |  |
  |  | 3238 | function theSharkAliExpress\_load\_woocommerce\_variations\_alibay() |
  |  | 3239 | { |
  |  | 3240 |  |
  |  | 3241 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3242 | if (!current\_user\_can('manage\_options')) { |
  |  | 3243 |  |
  |  | 3244 | // Handle unauthorized access |
  |  | 3245 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3246 | } |
  |  | 3247 |  |
  |  | 3248 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3249 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3250 | } |
  |  | 3251 |  |
  |  | 3252 |  |
  |  | 3253 |  |
  |  | 3254 |  |
  |  | 3255 |  |
  |  | 3256 |  |
  |  | 3257 | // if (isset($\_POST['action']) && $\_POST['action'] === 'load\_woocommerce\_variations') { |
  |  | 3258 | // Get the product ID from the POST request |
  |  | 3259 | $product\_id = isset($\_POST['product\_id']) ? wc\_clean($\_POST['product\_id']) : 0; |
  |  | 3260 |  |
  |  | 3261 | // Check if the product ID is valid and exists |
  |  | 3262 | if ($product\_id > 0 && wc\_get\_product($product\_id)) { |
  |  | 3263 | // Get the product object |
  |  | 3264 | $product = wc\_get\_product($product\_id); |
  |  | 3265 |  |
  |  | 3266 | // Check if the product has variations (for variable products) |
  |  | 3267 | if ($product->is\_type('variable')) { |
  |  | 3268 | $variations = $product->get\_available\_variations(); |
  |  | 3269 |  |
  |  | 3270 | if (!empty($variations)) { |
  |  | 3271 | // Send the variations as a JSON response |
  |  | 3272 | wp\_send\_json\_success(['variations' => $variations]); |
  |  | 3273 | } else { |
  |  | 3274 | // Variations not found, send an error response if needed |
  |  | 3275 | wp\_send\_json\_error(['message' => 'Variations not found.']); |
  |  | 3276 | } |
  |  | 3277 | } else { |
  |  | 3278 | // This product type does not have variations |
  |  | 3279 | wp\_send\_json\_error(['message' => 'This product type does not have variations.']); |
  |  | 3280 | } |
  |  | 3281 | } else { |
  |  | 3282 | // Invalid or non-existent product ID, send an error response |
  |  | 3283 | wp\_send\_json\_error(['message' => 'Invalid or non-existent product ID.']); |
  |  | 3284 | } |
  |  | 3285 | // } |
  |  | 3286 | // wp\_die(); |
  |  | 3287 | } |
  |  | 3288 |  |
  |  | 3289 |  |
  |  | 3290 |  |
  |  | 3291 |  |
  |  | 3292 |  |
  |  | 3293 | // Add this PHP function to your WordPress plugin or theme functions.php file |
  |  | 3294 | function theSharkAliExpress\_delete\_product\_callback\_alibay() |
  |  | 3295 | { |
  |  | 3296 |  |
  |  | 3297 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3298 | if (!current\_user\_can('manage\_options')) { |
  |  | 3299 |  |
  |  | 3300 | // Handle unauthorized access |
  |  | 3301 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3302 | } |
  |  | 3303 |  |
  |  | 3304 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3305 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3306 | } |
  |  | 3307 |  |
  |  | 3308 |  |
  |  | 3309 |  |
  |  | 3310 |  |
  |  | 3311 |  |
  |  | 3312 |  |
  |  | 3313 |  |
  |  | 3314 | // if (isset($\_POST['action']) && $\_POST['action'] === 'delete\_product') { |
  |  | 3315 | // Get the product ID from the POST request |
  |  | 3316 | $product\_id = isset($\_POST['product\_id']) ? wc\_clean($\_POST['product\_id']) : 0; |
  |  | 3317 |  |
  |  | 3318 | if ($product\_id > 0) { |
  |  | 3319 | // Perform the product deletion operation here |
  |  | 3320 | // For example, you can use the WordPress function wp\_delete\_post |
  |  | 3321 | $result = wp\_delete\_post($product\_id, true); |
  |  | 3322 |  |
  |  | 3323 | if ($result) { |
  |  | 3324 | // Deletion was successful, send a success response if needed |
  |  | 3325 | wp\_send\_json\_success(['success' => true]); |
  |  | 3326 | } else { |
  |  | 3327 | // Deletion failed, send an error response if needed |
  |  | 3328 | wp\_send\_json\_error(['success' => false, 'message' => 'Product deletion failed']); |
  |  | 3329 | } |
  |  | 3330 | } |
  |  | 3331 | // } |
  |  | 3332 | // wp\_die(); |
  |  | 3333 | } |
  |  | 3334 |  |
  |  | 3335 |  |
  |  | 3336 |  |
  |  | 3337 |  |
  |  | 3338 |  |
  |  | 3339 | function theSharkAliExpress\_search\_product\_by\_store\_alibay($ebay\_url) |
  |  | 3340 | { |
  |  | 3341 |  |
  |  | 3342 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3343 | if (!current\_user\_can('manage\_options')) { |
  |  | 3344 |  |
  |  | 3345 | // Handle unauthorized access |
  |  | 3346 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3347 | } |
  |  | 3348 |  |
  |  | 3349 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3350 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3351 | } |
  |  | 3352 |  |
  |  | 3353 |  |
  |  | 3354 |  |
  |  | 3355 |  |
  |  | 3356 |  |
  |  | 3357 |  |
  |  | 3358 | try { |
  |  | 3359 | // eBay URL to fetch HTML from |
  |  | 3360 | $ebay\_url = isset($\_POST['ebay\_url']) ? sanitize\_text\_field($\_POST['ebay\_url']) : ''; |
  |  | 3361 |  |
  |  | 3362 | // Check if the eBay URL is provided and valid |
  |  | 3363 | if (empty($ebay\_url) || !filter\_var($ebay\_url, FILTER\_VALIDATE\_URL)) { |
  |  | 3364 | wp\_send\_json\_error(array('message' => 'Invalid eBay URL')); |
  |  | 3365 | } |
  |  | 3366 |  |
  |  | 3367 | // Make an HTTP GET request to fetch the HTML content |
  |  | 3368 | $response = wp\_safe\_remote\_get($ebay\_url); |
  |  | 3369 |  |
  |  | 3370 | // Check for HTTP request errors |
  |  | 3371 | if (is\_wp\_error($response)) { |
  |  | 3372 | wp\_send\_json\_error(array('message' => 'Error fetching eBay product page')); |
  |  | 3373 | } |
  |  | 3374 |  |
  |  | 3375 | // Get the HTML content from the response |
  |  | 3376 | $html\_content = wp\_remote\_retrieve\_body($response); |
  |  | 3377 |  |
  |  | 3378 |  |
  |  | 3379 | wp\_send\_json\_success($html\_content); |
  |  | 3380 | // } |
  |  | 3381 | } catch (Exception $e) { |
  |  | 3382 | $results = array( |
  |  | 3383 | 'error' => true, |
  |  | 3384 | 'error\_msg' => 'Error received when trying to insert the product: ' . $e->getMessage(), |
  |  | 3385 | 'data' => '' |
  |  | 3386 | ); |
  |  | 3387 | wp\_send\_json($results); |
  |  | 3388 | } |
  |  | 3389 | } |
  |  | 3390 |  |
  |  | 3391 |  |
  |  | 3392 | function theSharkAliExpress\_updateProductUrlAlibay() |
  |  | 3393 | { |
  |  | 3394 |  |
  |  | 3395 | // Check if the user is authenticated and has the necessary permissions |
  |  | 3396 | if (!current\_user\_can('manage\_options')) { |
  |  | 3397 |  |
  |  | 3398 | // Handle unauthorized access |
  |  | 3399 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3400 | } |
  |  | 3401 |  |
  |  | 3402 | if ( ! wp\_verify\_nonce( $\_POST['nonce'], 'ajax-nonce' ) ) { |
  |  | 3403 | wp\_die('Unauthorized access', 'Error', array('response' => 403)); |
  |  | 3404 | } |
  |  | 3405 |  |
  |  | 3406 |  |
  |  | 3407 |  |
  |  | 3408 |  |
  |  | 3409 |  |
  |  | 3410 |  |
  |  | 3411 | $productUrl = isset($\_POST['productUrl']) ? wc\_clean($\_POST['productUrl']) : ''; |
  |  | 3412 | $post\_id = isset($\_POST['product\_id']) ? wc\_clean($\_POST['product\_id']) : ''; |
  |  | 3413 | if (isset($productUrl)) { |
  |  | 3414 | update\_post\_meta($post\_id, 'productUrl', $productUrl); |
  |  | 3415 | } |
  |  | 3416 | } |
  |  | 3417 |  |
  |  | 3418 |  |
  |  | 3419 |  |
  |  | 3420 |  |
  |  | 3421 |  |
  |  | 3422 | function theSharkAliExpress\_create\_woocommerce\_categories\_and\_get\_ids\_alibay($categories) |
  |  | 3423 | { |
  |  | 3424 | $category\_ids = array(); |
  |  | 3425 |  |
  |  | 3426 | foreach ($categories as $category\_name) { |
  |  | 3427 | // Check if the product category already exists |
  |  | 3428 | $term = term\_exists($category\_name, 'product\_cat'); |
  |  | 3429 | if ($term) { |
  |  | 3430 | // If the category exists, add its ID to the array |
  |  | 3431 | $category\_ids[] = (int) $term['term\_id']; |
  |  | 3432 | } else { |
  |  | 3433 | // Create the product category if it does not exist and add its ID to the array |
  |  | 3434 | $new\_term = wp\_insert\_term( |
  |  | 3435 | $category\_name, // the term |
  |  | 3436 | 'product\_cat',  // the taxonomy for WooCommerce product categories |
  |  | 3437 | array( |
  |  | 3438 | 'description' => 'A description for this category', |
  |  | 3439 | 'slug'        => sanitize\_title($category\_name) |
  |  | 3440 | ) |
  |  | 3441 | ); |
  |  | 3442 |  |
  |  | 3443 | if (!is\_wp\_error($new\_term)) { |
  |  | 3444 | $category\_ids[] = $new\_term['term\_id']; |
  |  | 3445 | } |
  |  | 3446 | } |
  |  | 3447 | } |
  |  | 3448 |  |
  |  | 3449 | return $category\_ids; |
  |  | 3450 | } |
  |  | 3451 |  |
  |  | 3452 |  |
  |  | 3453 |  |
  |  | 3454 |  |
  |  | 3455 |  |
  |  | 3456 | function my\_plugin\_add\_webp\_support\_alibay($mime\_types) |
  |  | 3457 | { |
  |  | 3458 | // Add WebP to the list of mime types |
  |  | 3459 | $mime\_types['webp'] = 'image/webp'; |
  |  | 3460 |  |
  |  | 3461 | return $mime\_types; |
  |  | 3462 | } |
  |  | 3463 | add\_filter('mime\_types', 'my\_plugin\_add\_webp\_support\_alibay'); |
  |  | 3464 |  |
  |  | 3465 | function theSharkAliExpressmy\_plugin\_webp\_is\_displayable\_alibay($result, $path) |
  |  | 3466 | { |
  |  | 3467 | if ($result === false) { |
  |  | 3468 | $displayable\_image\_types = array(IMAGETYPE\_WEBP); |
  |  | 3469 | $info = @getimagesize($path); |
  |  | 3470 |  |
  |  | 3471 | if (empty($info)) { |
  |  | 3472 | $result = false; |
  |  | 3473 | } elseif (!in\_array($info[2], $displayable\_image\_types)) { |
  |  | 3474 | $result = false; |
  |  | 3475 | } else { |
  |  | 3476 | $result = true; |
  |  | 3477 | } |
  |  | 3478 | } |
  |  | 3479 |  |
  |  | 3480 | return $result; |
  |  | 3481 | } |
  |  | 3482 |  |
  |  | 3483 |  |
  |  | 3484 |  |
  |  | 3485 | add\_filter('file\_is\_displayable\_image', 'theSharkAliExpressmy\_plugin\_webp\_is\_displayable\_alibay', 10, 2); |
  |  | 3486 |  |
  |  | 3487 |  |
  |  | 3488 |  |
  |  | 3489 |  |
  |  | 3490 | add\_action('wp\_ajax\_sharkDropship-theShark-alibay-insertVariations', 'theSharkAliExpress\_insertVariations'); |
  |  | 3491 | add\_action('wp\_ajax\_sharkDropship-theShark\_alibay\_insertProductInWoocommerceAffiliate', 'theSharkAliExpress\_insertProductInWoocommerceAffiliate'); |
  |  | 3492 | add\_action('wp\_ajax\_sharkDropship-alibay-get-sku-and-url-by-Category\_for\_ebay', 'theSharkAliExpress\_getSKuAbdUrlByCategory\_for\_ebay\_alibay'); |
  |  | 3493 | add\_action('wp\_ajax\_sharkDropship-alibay-get-already-imported-products\_for\_ebay', 'theSharkAliExpress\_getAlreadyImportedProducts\_for\_ebay\_alibay'); |
  |  | 3494 | add\_action('wp\_ajax\_sharkDropship-alibay-insert-reviews-to-product\_for\_ebay', 'theSharkAliExpress\_insertReviewsIntoProduct\_for\_ebay\_alibay'); |
  |  | 3495 | add\_action('wp\_ajax\_sharkDropship-alibay-remove-product-from-wp\_for\_ebay', 'theSharkAliExpress\_removeProductFromShop\_for\_ebay\_alibay'); |
  |  | 3496 | add\_action('wp\_ajax\_sharkDropship-alibay-search-product-by-sku\_for\_ebay', 'theSharkAliExpress\_searchProductBySku\_for\_ebay\_alibay'); |
  |  | 3497 | add\_action('wp\_ajax\_sharkDropship-alibay-update-product-variations\_for\_ebay', 'theSharkAliExpress\_updateProductVariations\_for\_ebay\_alibay'); |
  |  | 3498 | add\_action('wp\_ajax\_sharkDropship-alibay-update-product-simple\_for\_ebay', 'theSharkAliExpress\_updateProductSimple\_for\_ebay\_alibay'); |
  |  | 3499 | add\_action('wp\_ajax\_sharkDropship-alibay-get-old-product-details\_for\_ebay', 'theSharkAliExpress\_getOldProductDetails\_for\_ebay\_alibay'); |
  |  | 3500 | add\_action('wp\_ajax\_sharkDropship-alibay-insert-reviews-to-productRM\_for\_ebay', 'theSharkAliExpress\_insertReviewsIntoProductRM\_for\_ebay'); |
  |  | 3501 | add\_action('wp\_ajax\_sharkDropship-alibay-stop\_automatic\_update\_for\_ebay', 'theSharkAliExpress\_stopAutomaticUpdates\_alibay'); |
  |  | 3502 | add\_action('wp\_ajax\_sharkDropship-remove-product-from-wp-for-ebay', 'theSharkAliExpress\_removeProductFromShop\_forEBAY\_alibay'); |
  |  | 3503 | add\_action('wp\_ajax\_sharkDropship-insert-reviews-to-productRM-alibay', 'theSharkAliExpress\_insertReviewsIntoProductRM\_PREMUIM\_PLUGIN\_alibay'); |
  |  | 3504 | add\_action('wp\_ajax\_sharkDropship-restoreConfiguration-alibay', 'theSharkAliExpress\_restoreConfiguration\_alibay'); |
  |  | 3505 | add\_action('wp\_ajax\_sharkDropship-wooshark-insert-product-alibay', 'theSharkAliExpress\_insertProductInWoocommerce'); |
  |  | 3506 | add\_action('wp\_ajax\_sharkDropship-get\_products-alibay', 'getProduct\_FROMWP\_alibay'); |
  |  | 3507 | add\_action('wp\_ajax\_sharkDropship-search-category-by-name-alibay', 'theSharkAliExpress\_searchCategoryByName'); |
  |  | 3508 | add\_action('wp\_ajax\_sharkDropship-get-sku-and-url-by-Category-alibay', 'theSharkAliExpress\_getSKuAbdUrlByCategory\_alibay'); |
  |  | 3509 | add\_action('wp\_ajax\_sharkDropship-get-already-imported-products-alibay', 'theSharkAliExpress\_getAlreadyImportedProducts'); |
  |  | 3510 | add\_action('wp\_ajax\_sharkDropship-insert-reviews-to-product-alibay', 'theSharkAliExpress\_insertReviewsIntoProduct'); |
  |  | 3511 | add\_action('wp\_ajax\_sharkDropship-remove-product-from-wp-alibay', 'theSharkAliExpress\_removeProductFromShop'); |
  |  | 3512 | add\_action('wp\_ajax\_sharkDropship-search-product-by-sku-alibay', 'theSharkAliExpress\_searchProductBySku'); |
  |  | 3513 | add\_action('wp\_ajax\_sharkDropship-get\_products-draft-alibay', 'theSharkAliExpress\_getProductsDraft'); |
  |  | 3514 | add\_action('wp\_ajax\_sharkDropship-get-old-product-details-alibay', 'theSharkAliExpress\_getOldProductDetails'); |
  |  | 3515 | add\_action('wp\_ajax\_sharkDropship-get-product-by-id-alibay', 'theSharkAliExpress\_searchProductByIdReviews\_alibay'); |
  |  | 3516 | add\_action('wp\_ajax\_sharkDropship-saveOptionsDB-alibay', 'theSharkAliExpress\_saveOptionsDB\_alibay'); |
  |  | 3517 | add\_action('wp\_ajax\_sharkDropship-getProductsCount-alibay', 'theSharkAliExpress\_getProductsCount\_FROM\_WP'); |
  |  | 3518 | add\_action('wp\_ajax\_sharkDropship-get\_categories-alibay', 'theSharkAliExpress\_get\_categories\_FROMWP'); |
  |  | 3519 | add\_action('wp\_ajax\_sharkDropship-getProductsCount\_for\_ebay', 'theSharkAliExpress\_getProductsCount\_FROM\_WP\_for\_ebay\_alibay'); |
  |  | 3520 | add\_action('wp\_ajax\_sharkDropship-search\_product\_by\_store\_alibay', 'theSharkAliExpress\_search\_product\_by\_store\_alibay'); |
  |  | 3521 | add\_action('wp\_ajax\_sharkDropship-load\_woocommerce\_variations\_alibay', 'theSharkAliExpress\_load\_woocommerce\_variations\_alibay'); |
  |  | 3522 | add\_action('wp\_ajax\_sharkDropship-get\_product\_details\_alibay', 'theSharkAliExpress\_get\_product\_details\_alibay'); |
  |  | 3523 | add\_action('wp\_ajax\_sharkDropship-get\_products\_by\_type\_alibay', 'theSharkAliExpress\_get\_products\_by\_type\_alibay'); |
  |  | 3524 | add\_action('wp\_ajax\_sharkDropship-get\_aliexpress\_products\_alibay', 'theSharkAliExpress\_get\_aliexpress\_products\_alibay'); |
  |  | 3525 | add\_action('wp\_ajax\_sharkDropship-update\_variations\_on\_woocommerce\_alibay', 'theSharkAliExpress\_update\_variations\_on\_woocommerce\_alibay'); |
  |  | 3526 | add\_action('wp\_ajax\_sharkDropship-set\_product\_to\_draft\_callback\_alibay', 'theSharkAliExpress\_set\_product\_to\_draft\_callback\_alibay'); |
  |  | 3527 | add\_action('wp\_ajax\_sharkDropship-fetchemote\_alibay', 'theSharkAliExpress\_fetchemote\_alibay'); |
  |  | 3528 | add\_action('wp\_ajax\_sharkDropship-delete\_product\_callback\_alibay', 'theSharkAliExpress\_delete\_product\_callback\_alibay'); |
  |  | 3529 | add\_action('wp\_ajax\_sharkDropship-updateProductUrlAlibay', 'theSharkAliExpress\_updateProductUrlAlibay'); |
  |  | 3530 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3059375)
* [Zip Archive](?format=zip&new=3059375)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_02579466_20250110_144019.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Sharkdropship for AliExpress Dropshipping and Affiliate <= 2.2.4 - Missing Authorization to Unauthenticated Arbitrary Post Deletion

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Sharkdropship for AliExpress Dropshipping and Affiliate <= 2.2.4 - Missing Authorization to Unauthenticated Arbitrary Post Deletion

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-1732](https://www.cve.org/CVERecord?id=CVE-2024-1732) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | April 1, 2024 |
| Last Updated | April 2, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The Sharkdropship for AliExpress Dropshipping and Affiliate plugin for WordPress is vulnerable to unauthorized loss of data due to a missing capability check on the wads\_removeProductFromShop() function in all versions up to, and including, 2.2.4. This makes it possible for unauthenticated attackers to delete arbitrary posts.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3059375%40wooshark-aliexpress-importer&new=3059375%40wooshark-aliexpress-importer&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwooshark-aliexpress-importer%2Fsharkdropship-for-aliexpress-dropshipping-and-affiliate-224-missing-authorization-to-unauthenticated-arbitrary-post-deletion&t=Sharkdropship%20for%20AliExpress%20Dropshipping%20and%20Affiliate%20%3C%3D%202.2.4%20-%20Missing%20Authorization%20to%20Unauthenticated%20Arbitrary%20Post%20Deletion "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwooshark-aliexpress-importer%2Fsharkdropship-for-aliexpress-dropshipping-and-affiliate-224-missing-authorization-to-unauthenticated-arbitrary-post-deletion&text=Sharkdropship%20for%20AliExpress%20Dropshipping%20and%20Affiliate%20%3C%3D%202.2.4%20-%20Missing%20Authorization%20to%20Unauthenticated%20Arbitrary%20Post%20Deletion "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwooshark-aliexpress-importer%2Fsharkdropship-for-aliexpress-dropshipping-and-affiliate-224-missing-authorization-to-unauthenticated-arbitrary-post-deletion "LinkedIn")
Email

## Vulnerability Details for Sharkdropship Dropshipping & Affiliate for for AliExpress

#### [Sharkdropship Dropshipping & Affiliate for for AliExpress](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wooshark-aliexpress-importer)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wooshark-aliexpress-importer [(view on wordpress.org)](https://wordpress.org/plugins/wooshark-aliexpress-importer) |
| Patched? | Yes |
| Remediation | Update to version 2.2.5, or a newer patched version |
| Affected Version | * <= 2.2.4 |
| Patched Version | * 2.2.5 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


