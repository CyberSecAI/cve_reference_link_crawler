=== Content from cs.opensource.google_8ad24aa2_20250111_112532.html ===
This site requires javascript.

=== Content from cs.opensource.google_d2c3a288_20250111_112532.html ===
This site requires javascript.

=== Content from github.com_936635c0_20250111_112534.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fblob%2F1591be276561bbdb019c0279f1d33cb18a650e1b%2Fsession.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fblob%2F1591be276561bbdb019c0279f1d33cb18a650e1b%2Fsession.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=huandu%2Ffacebook)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[huandu](/huandu)
/
**[facebook](/huandu/facebook)**
Public

* [Notifications](/login?return_to=%2Fhuandu%2Ffacebook) You must be signed in to change notification settings
* [Fork
  521](/login?return_to=%2Fhuandu%2Ffacebook)
* [Star
   1.3k](/login?return_to=%2Fhuandu%2Ffacebook)

* [Code](/huandu/facebook)
* [Issues
  0](/huandu/facebook/issues)
* [Pull requests
  1](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects
  0](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

Additional navigation options

* [Code](/huandu/facebook)
* [Issues](/huandu/facebook/issues)
* [Pull requests](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

## Files

 1591be2
## Breadcrumbs

1. [facebook](/huandu/facebook/tree/1591be276561bbdb019c0279f1d33cb18a650e1b)
/
# session.go

Copy path Blame  Blame
## Latest commit

## History

[History](/huandu/facebook/commits/1591be276561bbdb019c0279f1d33cb18a650e1b/session.go)687 lines (543 loc) · 17 KB 1591be2
## Breadcrumbs

1. [facebook](/huandu/facebook/tree/1591be276561bbdb019c0279f1d33cb18a650e1b)
/
# session.go

Top
## File metadata and controls

* Code
* Blame

687 lines (543 loc) · 17 KB[Raw](https://github.com/huandu/facebook/raw/1591be276561bbdb019c0279f1d33cb18a650e1b/session.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687// A facebook graph api client in go.// https://github.com/huandu/facebook///// Copyright 2012, Huan Du// Licensed under the MIT license// https://github.com/huandu/facebook/blob/master/LICENSE
package facebook
import ( "bytes" "context" "crypto/hmac" "crypto/sha256" "encoding/hex" "encoding/json" "fmt" "io" "net/http" "net/url" "regexp" "strings")
// Graph API debug mode values.const ( DEBUG\_OFF DebugMode = "" // turn off debug.
 DEBUG\_ALL DebugMode = "all" DEBUG\_INFO DebugMode = "info" DEBUG\_WARNING DebugMode = "warning")
var ( // Maps aliases to Facebook domains. // Copied from Facebook PHP SDK. domainMap = map[string]string{ "api": "https://api.facebook.com/", "api\_video": "https://api-video.facebook.com/", "api\_read": "https://api-read.facebook.com/", "graph": "https://graph.facebook.com/", "graph\_video": "https://graph-video.facebook.com/", "www": "https://www.facebook.com/", }
 // checks whether it's a video post. regexpIsVideoPost = regexp.MustCompile(`\/videos$`))
// Session holds a facebook session with an access token.// Session should be created by App.Session or App.SessionFromSignedRequest.type Session struct { HttpClient HttpClient Version string // facebook versioning. RFC3339Timestamps bool // set to true to send date\_format=Y-m-d\TH:i:sP on every request which will cause RFC3339 style timestamps to be returned BaseURL string // set to override API base URL - trailing slash is required, e.g. http://127.0.0.1:53453/
 accessToken string // facebook access token. can be empty. app \*App id string
 enableAppsecretProof bool // add "appsecret\_proof" parameter in every facebook API call. appsecretProof string // pre-calculated "appsecret\_proof" value. useAuthorizationHeader bool // pass accessToken in headers instead of query params
 debug DebugMode // using facebook debugging api in every request.
 context context.Context // Session context.}
// HttpClient is an interface to send http request.// This interface is designed to be compatible with type `\*http.Client`.type HttpClient interface { Do(req \*http.Request) (resp \*http.Response, err error) Get(url string) (resp \*http.Response, err error) Post(url string, bodyType string, body io.Reader) (resp \*http.Response, err error)}
// Api makes a facebook graph api call.//// If session access token is set, "access\_token" in params will be set to the token value.//// Returns facebook graph api call result.// If facebook returns error in response, returns error details in res and set err.func (session \*Session) Api(path string, method Method, params Params) (Result, error) { return session.graph(path, method, params)}
// Get is a short hand of Api(path, GET, params).func (session \*Session) Get(path string, params Params) (Result, error) { return session.Api(path, GET, params)}
// Post is a short hand of Api(path, POST, params).func (session \*Session) Post(path string, params Params) (Result, error) { return session.Api(path, POST, params)}
// Delete is a short hand of Api(path, DELETE, params).func (session \*Session) Delete(path string, params Params) (Result, error) { return session.Api(path, DELETE, params)}
// Put is a short hand of Api(path, PUT, params).func (session \*Session) Put(path string, params Params) (Result, error) { return session.Api(path, PUT, params)}
// BatchApi makes a batch call. Each params represent a single facebook graph api call.//// BatchApi supports most kinds of batch calls defines in facebook batch api document,// except uploading binary data. Use Batch to upload binary data.//// If session access token is set, the token will be used in batch api call.//// Returns an array of batch call result on success.//// Facebook document: https://developers.facebook.com/docs/graph-api/making-multiple-requestsfunc (session \*Session) BatchApi(params ...Params) ([]Result, error) { return session.Batch(nil, params...)}
// Batch makes a batch facebook graph api call.// Batch is designed for more advanced usage including uploading binary files.//// If session access token is set, "access\_token" in batchParams will be set to the token value.//// Facebook document: https://developers.facebook.com/docs/graph-api/making-multiple-requestsfunc (session \*Session) Batch(batchParams Params, params ...Params) ([]Result, error) { return session.graphBatch(batchParams, params...)}
// Request makes an arbitrary HTTP request.// It expects server responses a facebook Graph API response.//// request, \_ := http.NewRequest("https://graph.facebook.com/538744468", "GET", nil)// res, err := session.Request(request)// fmt.Println(res["gender"]) // get "male"func (session \*Session) Request(request \*http.Request) (res Result, err error) { var response \*http.Response var data []byte
 response, data, err = session.sendRequest(request)
 if err != nil { return }
 res, err = MakeResult(data) session.addDebugInfo(res, response) session.addUsageInfo(res, response)
 if res != nil { err = res.Err() }
 return}
// User gets current user id from access token.//// Returns error if access token is not set or invalid.//// It's a standard way to validate a facebook access token.func (session \*Session) User() (id string, err error) { if session.id != "" { id = session.id return }
 if session.accessToken == "" && session.HttpClient == nil { err = fmt.Errorf("facebook: access token is not set") return }
 var result Result result, err = session.Api("/me", GET, Params{"fields": "id"})
 if err != nil { return }
 err = result.DecodeField("id", &id)
 if err != nil { return }
 return}
// Validate validates Session access token.// Returns nil if access token is valid.func (session \*Session) Validate() (err error) { if session.accessToken == "" && session.HttpClient == nil { err = fmt.Errorf("facebook: access token is not set") return }
 var result Result result, err = session.Api("/me", GET, Params{"fields": "id"})
 if err != nil { return }
 if f := result.Get("id"); f == nil { err = fmt.Errorf("facebook: invalid access token %s", session.accessToken) return }
 return}
// Inspect Session access token.// Returns JSON array containing data about the inspected token.// See https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/#checktokenfunc (session \*Session) Inspect() (result Result, err error) { if session.accessToken == "" && session.HttpClient == nil { err = fmt.Errorf("facebook: access token is not set") return }
 if session.app == nil { err = fmt.Errorf("facebook: cannot inspect access token without binding an app") return }
 appAccessToken := session.app.AppAccessToken()
 if appAccessToken == "" { err = fmt.Errorf("facebook: app access token is not set") return }
 result, err = session.Api("/debug\_token", GET, Params{ "input\_token": session.accessToken, "access\_token": appAccessToken, })
 if err != nil { return }
 // facebook stores everything, including error, inside result["data"]. // make sure that result["data"] exists and doesn't contain error. if \_, ok := result["data"]; !ok { err = fmt.Errorf("facebook: facebook inspect api returns unexpected result") return }
 var data Result result.DecodeField("data", &data) result = data err = result.Err() return}
// AccessToken gets current access token.func (session \*Session) AccessToken() string { return session.accessToken}
// SetAccessToken sets a new access token.func (session \*Session) SetAccessToken(token string) { if token != session.accessToken { session.id = "" session.accessToken = token session.appsecretProof = "" }}
// UseAuthorizationHeader passes `access\_token` in HTTP Authorization header instead of query string.func (session \*Session) UseAuthorizationHeader() { session.useAuthorizationHeader = true}
// AppsecretProof checks appsecret proof is enabled or not.func (session \*Session) AppsecretProof() string { if !session.enableAppsecretProof { return "" }
 if session.accessToken == "" || session.app == nil { return "" }
 if session.appsecretProof == "" { hash := hmac.New(sha256.New, []byte(session.app.AppSecret)) hash.Write([]byte(session.accessToken)) session.appsecretProof = hex.EncodeToString(hash.Sum(nil)) }
 return session.appsecretProof}
// EnableAppsecretProof enables or disable appsecret proof status.// Returns error if there is no App associated with this Session.func (session \*Session) EnableAppsecretProof(enabled bool) error { if session.app == nil { return fmt.Errorf("facebook: cannot change appsecret proof status without an associated App") }
 if session.enableAppsecretProof != enabled { session.enableAppsecretProof = enabled
 // reset pre-calculated proof here to give caller a way to do so in some rare case, // e.g. associated app's secret is changed. session.appsecretProof = "" }
 return nil}
// App gets associated App.func (session \*Session) App() \*App { return session.app}
// Debug returns current debug mode.func (session \*Session) Debug() DebugMode { if session.debug != DEBUG\_OFF { return session.debug }
 return Debug}
// SetDebug updates per session debug mode and returns old mode.// If per session debug mode is DEBUG\_OFF, session will use global// Debug mode.func (session \*Session) SetDebug(debug DebugMode) DebugMode { old := session.debug session.debug = debug return old}
func (session \*Session) graph(path string, method Method, params Params) (res Result, err error) { var graphURL string
 if params == nil { params = Params{} }
 // always use JSON format. params["format"] = "json"
 if RFC3339Timestamps || session.RFC3339Timestamps { params["date\_format"] = `Y-m-d\TH:i:sP` }
 session.prepareParams(params)
 // parse path only if path contains '?'. // url.ParseRequestURI cannot parse uri without "/" like "me". if strings.Contains(path, "?") { // make sure the path starts with a slash. if path[0] != '/' { path = "/" + path }
 // parse query string in path. u, e := url.ParseRequestURI(path)
 if e != nil { err = e return }
 path = u.Path
 if u.RawQuery != "" { query, e := url.ParseQuery(u.RawQuery)
 if e != nil { err = e return }
 // use these queries to overwrite the value in params. for k := range query { params[k] = query.Get(k) } } }
 var urlParams Params
 if method == GET { urlParams = params }
 // get graph api url. if session.isVideoPost(path, method) { graphURL = session.getURL("graph\_video", path, urlParams) } else { graphURL = session.getURL("graph", path, urlParams) }
 var response \*http.Response
 if method == GET { response, err = session.sendGetRequest(graphURL, &res) } else { if method != POST { params["method"] = method }
 response, err = session.sendPostRequest(graphURL, params, &res) }
 if response != nil { session.addDebugInfo(res, response) session.addUsageInfo(res, response) }
 if res != nil { err = res.Err() }
 return}
func (session \*Session) graphBatch(batchParams Params, params ...Params) ([]Result, error) { if batchParams == nil { batchParams = Params{} }
 batchParams["batch"] = params session.prepareParams(batchParams)
 var res []Result graphURL := session.getURL("graph", "", nil) \_, err := session.sendPostRequest(graphURL, batchParams, &res) return res, err}
func (session \*Session) prepareParams(params Params) {
 if !session.useAuthorizationHeader { if \_, ok := params["access\_token"]; !ok && session.accessToken != "" { params["access\_token"] = session.accessToken } }
 if session.enableAppsecretProof && session.accessToken != "" && session.app != nil { params["appsecret\_proof"] = session.AppsecretProof() }
 debug := session.Debug()
 if debug != DEBUG\_OFF { params["debug"] = debug }}
func (session \*Session) sendGetRequest(uri string, res interface{}) (\*http.Response, error) { request, err := http.NewRequest("GET", uri, nil)
 if err != nil { return nil, err }
 response, data, err := session.sendRequest(request)
 if err != nil { return response, err }
 err = makeResult(data, res) return response, err}
func (session \*Session) sendPostRequest(uri string, params Params, res interface{}) (\*http.Response, error) { buf := &bytes.Buffer{} mime, err := params.Encode(buf)
 if err != nil { return nil, fmt.Errorf("facebook: cannot encode POST params; %w", err) }
 request, err := http.NewRequest("POST", uri, buf)
 if err != nil { return nil, err }
 request.Header.Set("Content-Type", mime) response, data, err := session.sendRequest(request)
 if err != nil { return response, err }
 err = makeResult(data, res) return response, err}
func (session \*Session) sendOauthRequest(uri string, params Params) (Result, error) { urlStr := session.getURL("graph", uri, nil) buf := &bytes.Buffer{} mime, err := params.Encode(buf)
 if err != nil { return nil, fmt.Errorf("facebook: cannot encode POST params; %w", err) }
 request, err := http.NewRequest("POST", urlStr, buf)
 if err != nil { return nil, err }
 request.Header.Set("Content-Type", mime) \_, data, err := session.sendRequest(request)
 if err != nil { return nil, err }
 if len(data) == 0 { return nil, fmt.Errorf("facebook: empty response from facebook") }
 // facebook may return a query string. if 'a' <= data[0] && data[0] <= 'z' { query, err := url.ParseQuery(string(data))
 if err != nil { return nil, err }
 // convert a query to Result. res := Result{}
 for k := range query { // json.Number is an alias of string and can be decoded as a string or number. // therefore, it's safe to convert all query values to this type for all purpose. res[k] = json.Number(query.Get(k)) }
 return res, nil }
 res, err := MakeResult(data) return res, err}
func (session \*Session) sendRequest(request \*http.Request) (response \*http.Response, data []byte, err error) { if session.context != nil { request = request.WithContext(session.context) }
 if session.useAuthorizationHeader { request.Header.Set("Authorization", "Bearer "+session.accessToken) }
 if session.HttpClient == nil { response, err = http.DefaultClient.Do(request) } else { response, err = session.HttpClient.Do(request) }
 if err != nil { err = fmt.Errorf("facebook: cannot reach facebook server; %w", err) return }
 buf := &bytes.Buffer{} \_, err = io.Copy(buf, response.Body) response.Body.Close()
 if err != nil { err = fmt.Errorf("facebook: cannot read facebook response; %w", err) }
 data = buf.Bytes() return}
func (session \*Session) isVideoPost(path string, method Method) bool { return method == POST && regexpIsVideoPost.MatchString(path)}
func (session \*Session) getURL(name, path string, params Params) string { offset := 0
 if path != "" && path[0] == '/' { offset = 1 }
 buf := &bytes.Buffer{} baseURL := domainMap[name] if session.BaseURL != "" { baseURL = session.BaseURL } buf.WriteString(baseURL)
 // facebook versioning. if session.Version == "" { if Version != "" { buf.WriteString(Version) buf.WriteRune('/') } } else { buf.WriteString(session.Version) buf.WriteRune('/') }
 buf.WriteString(string(path[offset:]))
 if params != nil { buf.WriteRune('?') params.Encode(buf) }
 return buf.String()}
func (session \*Session) addDebugInfo(res Result, response \*http.Response) Result { if session.Debug() == DEBUG\_OFF || res == nil || response == nil { return res }
 debugInfo := make(map[string]interface{})
 // save debug information in result directly. res.DecodeField(debugInfoKey, &debugInfo) debugInfo[debugProtoKey] = response.Proto debugInfo[debugHeaderKey] = response.Header
 res[debugInfoKey] = debugInfo return res}
func (session \*Session) addUsageInfo(res Result, response \*http.Response) Result { if res == nil || response == nil { return res }
 var usageInfo UsageInfo header := response.Header
 if usage := header.Get("X-App-Usage"); usage != "" { json.Unmarshal([]byte(usage), &usageInfo.App) }
 if usage := header.Get("X-Page-Usage"); usage != "" { json.Unmarshal([]byte(usage), &usageInfo.Page) }
 if usage := header.Get("X-Ad-Account-Usage"); usage != "" { json.Unmarshal([]byte(usage), &usageInfo.AdAccount) }
 if usage := header.Get("X-Business-Use-Case-Usage"); usage != "" { json.Unmarshal([]byte(usage), &usageInfo.BusinessUseCase) }
 if usage := header.Get("X-Fb-Ads-Insights-Throttle"); usage != "" { json.Unmarshal([]byte(usage), &usageInfo.AdsInsights) }
 res[usageInfoKey] = &usageInfo return res}
// Context returns the session's context.// To change the context, use `Session#WithContext`.//// The returned context is always non-nil; it defaults to the background context.// For outgoing Facebook API requests, the context controls timeout/deadline and cancelation.func (session \*Session) Context() context.Context { if session.context != nil { return session.context }
 return context.Background()}
// WithContext returns a shallow copy of session with its context changed to ctx.// The provided ctx must be non-nil.func (session \*Session) WithContext(ctx context.Context) \*Session { s := \*session s.context = ctx return &s}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_89c90334_20250111_112535.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fsecurity%2Fadvisories%2FGHSA-3f65-m234-9mxr)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fsecurity%2Fadvisories%2FGHSA-3f65-m234-9mxr)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=huandu%2Ffacebook)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[huandu](/huandu)
/
**[facebook](/huandu/facebook)**
Public

* [Notifications](/login?return_to=%2Fhuandu%2Ffacebook) You must be signed in to change notification settings
* [Fork
  521](/login?return_to=%2Fhuandu%2Ffacebook)
* [Star
   1.3k](/login?return_to=%2Fhuandu%2Ffacebook)

* [Code](/huandu/facebook)
* [Issues
  0](/huandu/facebook/issues)
* [Pull requests
  1](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects
  0](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

Additional navigation options

* [Code](/huandu/facebook)
* [Issues](/huandu/facebook/issues)
* [Pull requests](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

# access\_token can be exposed in error message.

Low

[huandu](/huandu)
published
GHSA-3f65-m234-9mxr
May 24, 2024

## Package

gomod

github.com/huandu/facebook/v2
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<=2.7.1

## Patched versions

2.7.2

## Description

### Summary

access\_token can be exposed in error message on fail in HTTP request.

### Details

Using this module, when HTTP request fails, error message can contain access\_token. This can be happen when:

* module is sending HTTP request with query parameter `?access_token=...`.
* and HTTP request fails (errors like `facebook: cannot reach facebook server`).

In such situation, error message is constucted like following.

[facebook/session.go](https://github.com/huandu/facebook/blob/1591be276561bbdb019c0279f1d33cb18a650e1b/session.go#L558-L567)

Lines 558 to 567
in
[1591be2](/huandu/facebook/commit/1591be276561bbdb019c0279f1d33cb18a650e1b)

|  | if session.HttpClient == nil { |
| --- | --- |
|  | response, err = http.DefaultClient.Do(request) |
|  | } else { |
|  | response, err = session.HttpClient.Do(request) |
|  | } |
|  |  |
|  | if err != nil { |
|  | err = fmt.Errorf("facebook: cannot reach facebook server; %w", err) |
|  | return |
|  | } |

Original error message contained in it comes from `net/http` module. And it can contain full URL, that can contain query parameter `access_token`:

[https://cs.opensource.google/go/go/+/refs/tags/go1.22.3:src/net/http/client.go;l=629-633](https://cs.opensource.google/go/go/%2B/refs/tags/go1.22.3%3Asrc/net/http/client.go;l=629-633)

[https://cs.opensource.google/go/go/+/refs/tags/go1.22.3:src/net/url/url.go;l=30](https://cs.opensource.google/go/go/%2B/refs/tags/go1.22.3%3Asrc/net/url/url.go;l=30)

It should be very common that applications log error message when they encounter errors. As a result, access\_token can be stored into log server and some other infrastructures. Of course other careless error handling in client code that causing other security problems can exist.

I'm not very sure that whether we can consider that github.com/huandu/facebook is vulnerable. Anyway, I think current error message, that can expose access\_token, is not desirble.

### PoC

Request me this section if you need complete instruction.

### Impact

Client applications with following conditions can be affected.

* logs error message from this module
* or returns error message to client as something like HTTP response.
* or uses error messages somewhere

### Severity

Low

3.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N

### CVE ID

CVE-2024-35232

### Weaknesses

[CWE-209](/advisories?query=cwe%3A209)

### Credits

* [![@seiyab](https://avatars.githubusercontent.com/u/20365512?s=40&v=4)](/seiyab)
  [seiyab](/seiyab)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_7f4400d0_20250111_112534.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fcommit%2F8b34431b91b32903c8821b1d7621bf81a029d8e4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fcommit%2F8b34431b91b32903c8821b1d7621bf81a029d8e4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=huandu%2Ffacebook)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[huandu](/huandu)
/
**[facebook](/huandu/facebook)**
Public

* [Notifications](/login?return_to=%2Fhuandu%2Ffacebook) You must be signed in to change notification settings
* [Fork
  521](/login?return_to=%2Fhuandu%2Ffacebook)
* [Star
   1.3k](/login?return_to=%2Fhuandu%2Ffacebook)

* [Code](/huandu/facebook)
* [Issues
  0](/huandu/facebook/issues)
* [Pull requests
  1](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects
  0](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

Additional navigation options

* [Code](/huandu/facebook)
* [Issues](/huandu/facebook/issues)
* [Pull requests](/huandu/facebook/pulls)
* [Actions](/huandu/facebook/actions)
* [Projects](/huandu/facebook/projects)
* [Security](/huandu/facebook/security)
* [Insights](/huandu/facebook/pulse)

## Commit

[Permalink](/huandu/facebook/commit/8b34431b91b32903c8821b1d7621bf81a029d8e4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-3f65-m234-9mxr](https://github.com/advisories/GHSA-3f65-m234-9mxr "GHSA-3f65-m234-9mxr")

[Browse files](/huandu/facebook/tree/8b34431b91b32903c8821b1d7621bf81a029d8e4)
Browse the repository at this point in the history

```
Exclude access_token from error message
```

* Loading branch information

[![@huandu](https://avatars.githubusercontent.com/u/239739?s=40&v=4)](/huandu)

[huandu](/huandu/facebook/commits?author=huandu "View all commits by huandu")
authored
May 24, 2024

2 parents
[1591be2](/huandu/facebook/commit/1591be276561bbdb019c0279f1d33cb18a650e1b)
+
[04fca0a](/huandu/facebook/commit/04fca0a71b4d10de9877b59790472f8161cc7799)

commit 8b34431

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**43 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* session.go
  [session.go](#diff-3d4a6b7d54b5107bc5694b7a06383f9ec4c68f9abe43ba0942f5d970f3a8ccac)
* session\_test.go
  [session\_test.go](#diff-f27c62978dcbd8717b591269e831e3cc0eec4fbdb8fbf53f66435cd8450c4557)

## There are no files selected for viewing

17 changes: 16 additions & 1 deletion

17
[session.go](#diff-3d4a6b7d54b5107bc5694b7a06383f9ec4c68f9abe43ba0942f5d970f3a8ccac "session.go")

Show comments

[View file](/huandu/facebook/blob/8b34431b91b32903c8821b1d7621bf81a029d8e4/session.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -562,7 +562,22 @@ func (session \*Session) sendRequest(request \*http.Request) (response \*http.Respo |
|  |  | } |
|  |  |  |
|  |  | if err != nil { |
|  |  | err = fmt.Errorf("facebook: cannot reach facebook server; %w", err) |
|  |  | originalErr := err |
|  |  | err = fmt.Errorf("facebook: cannot reach facebook server; %w", originalErr) |
|  |  | netUrlErr, ok := originalErr.(\*url.Error) |
|  |  | // \*url.Error can contain access\_token in the URL, so we need to exclude it. |
|  |  | if !ok || netUrlErr.URL == "" { |
|  |  | return |
|  |  | } |
|  |  | q := request.URL.Query() |
|  |  | if !q.Has("access\_token") { |
|  |  | return |
|  |  | } |
|  |  | q.Del("access\_token") |
|  |  | url := \*request.URL |
|  |  | url.RawQuery = q.Encode() |
|  |  | netUrlErr.URL = url.String() |
|  |  | err = fmt.Errorf("facebook: cannot reach facebook server; %w", netUrlErr) |
|  |  | return |
|  |  | } |
|  |  |  |
| Expand Down | |  |

27 changes: 27 additions & 0 deletions

27
[session\_test.go](#diff-f27c62978dcbd8717b591269e831e3cc0eec4fbdb8fbf53f66435cd8450c4557 "session_test.go")

Show comments

[View file](/huandu/facebook/blob/8b34431b91b32903c8821b1d7621bf81a029d8e4/session_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,8 +11,10 @@ import ( |
|  |  | "bytes" |
|  |  | "context" |
|  |  | "encoding/base64" |
|  |  | "errors" |
|  |  | "net/http" |
|  |  | "net/http/httptest" |
|  |  | "strings" |
|  |  | "testing" |
|  |  | ) |
|  |  |  |
| Expand Down  Expand Up | | @@ -400,3 +402,28 @@ func TestSessionGetWithQueryString(t \*testing.T) { |
|  |  |  |
|  |  | t.Logf("my extended info is: %v", result) |
|  |  | } |
|  |  |  |
|  |  | func TestSessionGetFailingWithoutExposingAccessToken(t \*testing.T) { |
|  |  | var accessToken = "CAACZA38ZAD8CoBAe2bDC6EdThnni3b56scyshKINjZARoC9ZAuEUTgYUkYnKdimqfA2ZAXcd2wLd7Rr8jLmMXTY9vqAhQGqObZBIUz1WwbqVoCsB3AAvLtwoWNhsxM76mK0eiJSLXHZCdPVpyhmtojvzXA7f69Bm6b5WZBBXia8iOpPZAUHTGp1UQLFMt47c7RqJTrYIl3VfAR0deN82GMFL2" |
|  |  | session := &Session{} |
|  |  | session.SetAccessToken(accessToken) |
|  |  | session.HttpClient = &http.Client{ |
|  |  | Transport: alwaysFailRoundTripper{}, |
|  |  | } |
|  |  |  |
|  |  | \_, err := session.Get("/me", nil) |
|  |  | if err == nil { |
|  |  | t.Fatalf("request should fail") |
|  |  | } |
|  |  | if strings.Contains(err.Error(), accessToken) { |
|  |  | t.Errorf("error message should not contain access token") |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | type alwaysFailRoundTripper struct{} |
|  |  |  |
|  |  | var \_ http.RoundTripper = alwaysFailRoundTripper{} |
|  |  |  |
|  |  | func (a alwaysFailRoundTripper) RoundTrip(req \*http.Request) (\*http.Response, error) { |
|  |  | return nil, errors.New("request failed since alwaysFailRoundTripper is used") |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8b34431`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhuandu%2Ffacebook%2Fcommit%2F8b34431b91b32903c8821b1d7621bf81a029d8e4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


