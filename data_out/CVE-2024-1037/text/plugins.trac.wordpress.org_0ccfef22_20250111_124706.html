

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3032127%2Fall-in-one-wp-security-and-firewall%2Ftags%2F5.2.6%2Fadmin%2Fwp-security-list-404.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2916015/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php "Changeset 2916015 for all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php")
* Next Change →

---

# Changeset [3032127](/changeset/3032127 "Show full changeset") for [all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/06/2024 11:24:44 AM
([11 months](/timeline?from=2024-02-06T11%3A24%3A44Z&precision=second "See timeline at 02/06/2024 11:24:44 AM") ago)

Author:
DavidAnderson
Message:

Release version 5.2.6

Location:
[all-in-one-wp-security-and-firewall/tags/5.2.6](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6?rev=3032127)
Files:

1 edited
1 copied

* [.](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6?rev=3032127 "Show entry in browser")
  (copied)
  *(copied from [all-in-one-wp-security-and-firewall/trunk](/browser/all-in-one-wp-security-and-firewall/trunk?rev=2983618 "Show original file (revision 3032126)"))*
* [admin/wp-security-list-404.php](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127 "Show entry in browser")
  (modified)
  ([18 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php](/changeset/3032127/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php "Show the changeset 3032127 restricted to all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php")

  | [r2916015](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L8 "Show revision 2916015 of this file in browser") | [r3032127](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L8 "Show revision 3032127 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 |  |
  | 9 | 9 | public function \_\_construct() { |
  | 10 |  | ~~global $status, $page;~~ |
  | 11 | 10 |  |
  | 12 | 11 | //Set parent defaults |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L18) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L17) |  |
  | 18 | 17 | } |
  | 19 | 18 |  |
  |  | 19 | /\*\* |
  |  | 20 | \* Returns created column in datetime format as per user setting time zone. |
  |  | 21 | \* |
  |  | 22 | \* @param array $item - data for the columns on the current row |
  |  | 23 | \* |
  |  | 24 | \* @return string - the datetime |
  |  | 25 | \*/ |
  |  | 26 | public function column\_created($item) { |
  |  | 27 | return AIOWPSecurity\_Utility::convert\_timestamp($item['created']); |
  |  | 28 | } |
  |  | 29 |  |
  | 20 | 30 | public function column\_default($item, $column\_name) { |
  | 21 | 31 | return $item[$column\_name]; |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L25) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L35) |  |
  | 25 | 35 | \* Returns id column html to be rendered. |
  | 26 | 36 | \* |
  | 27 |  | \* @param ~~Array~~ - data for the columns on the current row |
  | 28 |  | \* |
  | 29 |  | \* @return ~~String~~ |
  |  | 37 | \* @param array $item - data for the columns on the current row |
  |  | 38 | \* |
  |  | 39 | \* @return string - html string for column rendered |
  | 30 | 40 | \*/ |
  | 31 | 41 | public function column\_id($item) { |
  | 32 |  | $tab = ~~strip\_tags($\_REQUEST['tab'])~~; |
  |  | 42 | $tab = '404-detection'; |
  | 33 | 43 | $ip = $item['ip\_or\_host']; |
  | 34 | 44 |  |
  | 35 | 45 | $blocked\_ips\_tab = 'locked-ip'; |
  | 36 | 46 | //Check if this IP address is locked |
  | 37 |  | $is\_locked = AIOWPSecurity\_Utility::check\_locked\_ip($ip); |
  | 38 |  | $delete\_url = sprintf('admin.php?page=%s&tab=%s&action=%s&id=%s', AIOWPSEC\_~~FIREWALL~~\_MENU\_SLUG, $tab, 'delete\_event\_log', $item['id']); |
  |  | 47 | $is\_locked = AIOWPSecurity\_Utility::check\_locked\_ip($ip, '404'); |
  |  | 48 | $delete\_url = sprintf('admin.php?page=%s&tab=%s&action=%s&id=%s', AIOWPSEC\_BRUTE\_FORCE\_MENU\_SLUG, $tab, 'delete\_event\_log', $item['id']); |
  | 39 | 49 | //Add nonce to delete URL |
  | 40 | 50 | $delete\_url\_nonce = wp\_nonce\_url($delete\_url, "delete\_404\_log", "aiowps\_nonce"); |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L43) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L53) |  |
  | 43 | 53 | $actions = array( |
  | 44 | 54 | 'unblock' => sprintf('<a href="admin.php?page=%s&tab=%s">Unblock</a>', AIOWPSEC\_MAIN\_MENU\_SLUG, $blocked\_ips\_tab), |
  | 45 |  | 'delete' => '<a href="'.$delete\_url\_nonce.'" onclick="return confirm(\'~~Are you sure you want to delete this item?\')">Delete~~</a>', |
  |  | 55 | 'delete' => '<a href="'.$delete\_url\_nonce.'" onclick="return confirm(\'' . esc\_js(\_\_('Are you sure you want to delete this item?', 'all-in-one-wp-security-and-firewall')) . '\')">'. \_\_('Delete', 'all-in-one-wp-security-and-firewall') . '</a>', |
  | 46 | 56 | ); |
  | 47 | 57 | } else { |
  | 48 | 58 | //Build row actions |
  | 49 | 59 | $actions = array( |
  | 50 |  | 'temp\_block' => sprintf('<a href="admin.php?page=%s&tab=%s&action=%s&ip\_address=%s&username=%s" onclick="return confirm(\'~~Are you sure you want to block this IP address?\')">Temp block</a>', AIOWPSEC\_FIREWALL~~\_MENU\_SLUG, $tab, 'temp\_block', $item['ip\_or\_host'], $item['username']), |
  | 51 |  | 'blacklist\_ip' => sprintf('<a href="admin.php?page=%s&tab=%s&action=%s&ip\_address=%s&username=%s" onclick="return confirm(\'~~Are you sure you want to permanently block this IP address?\')">Blacklist IP</a>', AIOWPSEC\_FIREWALL~~\_MENU\_SLUG, $tab, 'blacklist\_ip', $item['ip\_or\_host'], $item['username']), |
  | 52 |  | 'delete' => '<a href="'.$delete\_url\_nonce.'" onclick="return confirm(\'~~Are you sure you want to delete this item?\')">Delete~~</a>', |
  |  | 60 | 'temp\_block' => sprintf('<a href="admin.php?page=%s&tab=%s&action=%s&ip\_address=%s&username=%s" onclick="return confirm(\'' . esc\_js(\_\_('Are you sure you want to block this IP address?', 'all-in-one-wp-security-and-firewall')) . '\')">'. \_\_('Temp block', 'all-in-one-wp-security-and-firewall') . '</a>', AIOWPSEC\_BRUTE\_FORCE\_MENU\_SLUG, $tab, 'temp\_block', $item['ip\_or\_host'], $item['username']), |
  |  | 61 | 'blacklist\_ip' => sprintf('<a href="admin.php?page=%s&tab=%s&action=%s&ip\_address=%s&username=%s" onclick="return confirm(\'' . esc\_js(\_\_('Are you sure you want to permanently block this IP address?', 'all-in-one-wp-security-and-firewall')) . '\')">'. \_\_('Blacklist IP', 'all-in-one-wp-security-and-firewall') . '</a>', AIOWPSEC\_BRUTE\_FORCE\_MENU\_SLUG, $tab, 'blacklist\_ip', $item['ip\_or\_host'], $item['username']), |
  |  | 62 | 'delete' => '<a href="'.$delete\_url\_nonce.'" onclick="return confirm(\'' . esc\_js(\_\_('Are you sure you want to delete this item?', 'all-in-one-wp-security-and-firewall')) . '\')">'. \_\_('Delete', 'all-in-one-wp-security-and-firewall') . '</a>', |
  | 53 | 63 | ); |
  | 54 | 64 | } |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L56) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L66) |  |
  | 56 | 66 | //Return the user\_login contents |
  | 57 | 67 | return sprintf('%1$s <span style="color:silver"></span>%2$s', |
  | 58 |  | /\* $1%s \*/ $item['id'], |
  | 59 |  | /\* $2%s \*/ $this->row\_actions($actions) |
  | 60 |  | ); |
  | 61 |  | } |
  | 62 |  |  |
  |  | 68 | /\* $1%s \*/ $item['id'], |
  |  | 69 | /\* $2%s \*/ $this->row\_actions($actions) |
  |  | 70 | ); |
  |  | 71 | } |
  |  | 72 |  |
  |  | 73 | /\*\* |
  |  | 74 | \* Returns status column html to be rendered. |
  |  | 75 | \* |
  |  | 76 | \* @param array $item - data for the columns on the current row |
  |  | 77 | \* |
  |  | 78 | \* @return string - html string for column rendered |
  |  | 79 | \*/ |
  | 63 | 80 | public function column\_status($item) { |
  | 64 | 81 | global $aio\_wp\_security; |
  | 65 | 82 | $ip = $item['ip\_or\_host']; |
  | 66 | 83 | //Check if this IP address is locked |
  | 67 |  | $is\_locked = AIOWPSecurity\_Utility::check\_locked\_ip($ip); |
  |  | 84 | $is\_locked = AIOWPSecurity\_Utility::check\_locked\_ip($ip, '404'); |
  | 68 | 85 | $blacklisted\_string = $aio\_wp\_security->configs->get\_value('aiowps\_banned\_ip\_addresses'); |
  | 69 | 86 | $banned = strpos($blacklisted\_string, $ip); |
  | 70 | 87 |  |
  | 71 |  | if (~~$banned !== false~~) { |
  |  | 88 | if (false !== $banned) { |
  | 72 | 89 | return 'blacklisted'; |
  | 73 |  | } elseif ($is\_locked) { |
  |  | 90 | } elseif ($is\_locked) { |
  | 74 | 91 | return 'temporarily blocked'; |
  | 75 | 92 | } else { |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L78) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L95) |  |
  | 78 | 95 | } |
  | 79 | 96 |  |
  |  | 97 | /\*\* |
  |  | 98 | \* Returns checkbox column html to be rendered. |
  |  | 99 | \* |
  |  | 100 | \* @param array $item - data for the columns on the current row |
  |  | 101 | \* |
  |  | 102 | \* @return string - html string for column rendered |
  |  | 103 | \*/ |
  | 80 | 104 | public function column\_cb($item) { |
  | 81 |  | return sprintf( |
  | 82 |  | '<input type="checkbox" name="%1$s[]" value="%2$s" />', |
  | 83 |  | /\* $1%s \*/ $this->\_args['singular'], //Let's simply repurpose the table's singular label |
  | 84 |  | /\* $2%s \*/ $item['id']                //The value of the checkbox should be the record's id |
  |  | 105 | return sprintf('<input type="checkbox" name="%1$s[]" value="%2$s" />', |
  |  | 106 | /\* $1%s \*/ $this->\_args['singular'], //Let's simply repurpose the table's singular label |
  |  | 107 | /\* $2%s \*/ $item['id']                //The value of the checkbox should be the record's id |
  | 85 | 108 | ); |
  | 86 | 109 | } |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L94) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L117) |  |
  | 94 | 117 | 'url' => \_\_('Attempted URL', 'all-in-one-wp-security-and-firewall'), |
  | 95 | 118 | 'referer\_info' => \_\_('Referer', 'all-in-one-wp-security-and-firewall'), |
  | 96 |  | '~~event\_date' => \_\_('Dat~~e', 'all-in-one-wp-security-and-firewall'), |
  |  | 119 | 'created' => \_\_('Date and time', 'all-in-one-wp-security-and-firewall'), |
  | 97 | 120 | 'status' => \_\_('Lock status', 'all-in-one-wp-security-and-firewall'), |
  | 98 | 121 | ); |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L108) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L131) |  |
  | 108 | 131 | 'url' => array('url', false), |
  | 109 | 132 | 'referer\_info' => array('referer\_info', false), |
  | 110 |  | '~~event\_date' => array('event\_date~~', false), |
  |  | 133 | 'created' => array('created', false), |
  | 111 | 134 | ); |
  | 112 | 135 | $sortable\_columns = apply\_filters('list\_404\_get\_sortable\_columns', $sortable\_columns); |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L154) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L177) |  |
  | 154 | 177 | \* Locks an IP address by adding it to the AIOWPSEC\_TBL\_LOGIN\_LOCKOUT table. |
  | 155 | 178 | \* |
  | 156 |  | \* @param ~~Array|String~~ - ids that correspond to ip addresses in the AIOWPSEC\_TBL\_EVENTS table or a single ip address |
  | 157 |  | \* @param ~~String~~  - (optional)username of user being locked |
  | 158 |  | \* |
  | 159 |  | \* @return ~~Boolean|V~~oid |
  |  | 179 | \* @param array|string $entries  - ids that correspond to ip addresses in the AIOWPSEC\_TBL\_EVENTS table or a single ip address |
  |  | 180 | \* @param string       $username - (optional)username of user being locked |
  |  | 181 | \* |
  |  | 182 | \* @return boolean|void |
  | 160 | 183 | \*/ |
  | 161 | 184 | public function block\_ip($entries, $username = '') { |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L164) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L187) |  |
  | 164 | 187 | //lock multiple records |
  | 165 | 188 | $entries = array\_filter($entries, 'is\_numeric'); //discard non-numeric ID values |
  | 166 |  | $id\_list = "(" .implode(",",$entries) .")"; //Create comma separate list for DB operation |
  |  | 189 | $id\_list = "(" .implode(",", $entries) .")"; //Create comma separate list for DB operation |
  | 167 | 190 | $events\_table = AIOWPSEC\_TBL\_EVENTS; |
  | 168 | 191 | $query = "SELECT ip\_or\_host FROM $events\_table WHERE ID IN ".$id\_list; |
  | 169 | 192 | $results = $wpdb->get\_col($query); |
  | 170 |  | if~~(empty($results))~~{ |
  | 171 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('Could not process the request because the IP addresses for the selected entries could not be found~~!', 'WPS~~')); |
  |  | 193 | if (empty($results)) { |
  |  | 194 | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('Could not process the request because the IP addresses for the selected entries could not be found.', 'all-in-one-wp-security-and-firewall')); |
  | 172 | 195 | return false; |
  | 173 |  | }~~else~~{ |
  | 174 |  | foreach~~($results as $entry)~~{ |
  | 175 |  | if~~(filter\_var($entry, FILTER\_VALIDATE\_IP))~~{ |
  |  | 196 | } else { |
  |  | 197 | foreach ($results as $entry) { |
  |  | 198 | if (filter\_var($entry, FILTER\_VALIDATE\_IP)) { |
  | 176 | 199 | AIOWPSecurity\_Utility::lock\_IP($entry, '404', $username); |
  | 177 | 200 | } |
  | 178 | 201 | } |
  | 179 | 202 | } |
  | 180 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP addresses are now temporarily blocked~~!', 'WPS~~')); |
  | 181 |  | } elseif (~~$entries != NULL~~) { |
  |  | 203 | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP addresses are now temporarily blocked.', 'all-in-one-wp-security-and-firewall')); |
  |  | 204 | } elseif (null != $entries) { |
  | 182 | 205 | //Block single record |
  | 183 |  | if~~(filter\_var($entries, FILTER\_VALIDATE\_IP))~~{ |
  |  | 206 | if (filter\_var($entries, FILTER\_VALIDATE\_IP)) { |
  | 184 | 207 | AIOWPSecurity\_Utility::lock\_IP($entries, '404', $username); |
  | 185 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP address is now temporarily blocked~~!', 'WPS~~')); |
  | 186 |  | }~~else~~{ |
  | 187 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('The selected entry is not a valid IP address~~!', 'WPS~~')); |
  |  | 208 | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP address is now temporarily blocked.', 'all-in-one-wp-security-and-firewall')); |
  |  | 209 | } else { |
  |  | 210 | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('The selected entry is not a valid IP address.', 'all-in-one-wp-security-and-firewall')); |
  | 188 | 211 | } |
  | 189 | 212 | } |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L193) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L216) |  |
  | 193 | 216 | \* Permanently blocks an IP address by adding it to the blacklist and writing rules to the htaccess file. |
  | 194 | 217 | \* |
  | 195 |  | \* @param ~~Array|String~~ - ids that correspond to ip addresses in the AIOWPSEC\_TBL\_EVENTS table or a single ip address |
  | 196 |  | \* |
  | 197 |  | \* @return ~~Boolean|V~~oid |
  |  | 218 | \* @param array|string $entries - ids that correspond to ip addresses in the AIOWPSEC\_TBL\_EVENTS table or a single ip address |
  |  | 219 | \* |
  |  | 220 | \* @return boolean|void |
  | 198 | 221 | \*/ |
  | 199 | 222 | public function blacklist\_ip\_address($entries) { |
  | 200 |  | global $wpdb, $aio\_wp\_security, $aiowps\_firewall\_config; |
  | 201 |  | $bl\_ip\_addresses = $aio\_wp\_security->configs->get\_value('aiowps\_banned\_ip\_addresses'); //get the currently saved blacklisted IPs |
  |  | 223 | global $wpdb, $aio\_wp\_security, $aiowps\_firewall\_config; |
  |  | 224 | $bl\_ip\_addresses = $aio\_wp\_security->configs->get\_value('aiowps\_banned\_ip\_addresses'); //get the currently saved blacklisted IPs |
  | 202 | 225 | $ip\_list\_array = AIOWPSecurity\_Utility\_IP::create\_ip\_list\_array\_from\_string\_with\_newline($bl\_ip\_addresses); |
  | 203 | 226 |  |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L205) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L228) |  |
  | 205 | 228 | //Get the selected IP addresses |
  | 206 | 229 | $entries = array\_filter($entries, 'is\_numeric'); //discard non-numeric ID values |
  | 207 |  | $id\_list = "(" .implode(",",$entries) .")"; //Create comma separate list for DB operation |
  |  | 230 | $id\_list = "(" .implode(",", $entries) .")"; //Create comma separate list for DB operation |
  | 208 | 231 | $events\_table = AIOWPSEC\_TBL\_EVENTS; |
  | 209 | 232 | $query = "SELECT ip\_or\_host FROM $events\_table WHERE ID IN ".$id\_list; |
  | 210 | 233 | $results = $wpdb->get\_col($query); |
  | 211 |  | if~~(empty($results))~~{ |
  | 212 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('Could not process the request because the IP addresses for the selected entries could not be found~~!', 'WPS~~')); |
  |  | 234 | if (empty($results)) { |
  |  | 235 | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(\_\_('Could not process the request because the IP addresses for the selected entries could not be found.', 'all-in-one-wp-security-and-firewall')); |
  | 213 | 236 | return false; |
  | 214 |  | }~~else~~{ |
  | 215 |  | foreach~~($results as $entry)~~{ |
  |  | 237 | } else { |
  |  | 238 | foreach ($results as $entry) { |
  | 216 | 239 | $ip\_list\_array[] = $entry; |
  | 217 | 240 | } |
  | 218 | 241 | } |
  | 219 |  | } elseif (~~$entries != NULL~~) { |
  |  | 242 | } elseif (null != $entries) { |
  | 220 | 243 | //Blacklist single record |
  | 221 | 244 | $ip\_list\_array[] = $entries; |
  | 222 | 245 | } |
  | 223 |  | $payload = AIOWPSecurity\_Utility\_IP::validate\_ip\_list($ip\_list\_array, 'blacklist'); |
  | 224 |  | if($payload[0] == 1){ |
  | 225 |  | //success case |
  | 226 |  | $result = 1; |
  | 227 |  | $list = $payload[1]; |
  | 228 |  | $banned\_ip\_data = implode("\n", $list); |
  | 229 |  | $aio\_wp\_security->configs->set\_value('aiowps\_enable\_blacklisting','1'); //Force blacklist feature to be enabled |
  | 230 |  | $aio\_wp\_security->configs->set\_value('aiowps\_banned\_ip\_addresses',$banned\_ip\_data); |
  | 231 |  | $aio\_wp\_security->configs->save\_config(); //Save the configuration |
  | 232 |  |  |
  | 233 |  | $aiowps\_firewall\_config->set\_value('aiowps\_blacklist\_ips', $list); |
  | 234 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP addresses have been added to the blacklist and will be permanently blocked.', 'all-in-one-wp-security-and-firewall')); |
  |  | 246 | $validated\_ip\_list\_array = AIOWPSecurity\_Utility\_IP::validate\_ip\_list($ip\_list\_array, 'blacklist'); |
  |  | 247 | if (is\_wp\_error($validated\_ip\_list\_array)) { |
  |  | 248 | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st(nl2br($validated\_ip\_list\_array->get\_error\_message())); |
  | 235 | 249 | } else { |
  | 236 |  | $result = -1; |
  | 237 |  | $error\_msg = $payload[1][0]; |
  | 238 |  | AIOWPSecurity\_Admin\_Menu::show\_msg\_error\_st($error\_msg); |
  |  | 250 | $banned\_ip\_data = implode("\n", $validated\_ip\_list\_array); |
  |  | 251 | $aio\_wp\_security->configs->set\_value('aiowps\_enable\_blacklisting', '1'); // Force blacklist feature to be enabled. |
  |  | 252 | $aio\_wp\_security->configs->set\_value('aiowps\_banned\_ip\_addresses', $banned\_ip\_data); |
  |  | 253 | $aio\_wp\_security->configs->save\_config(); |
  |  | 254 |  |
  |  | 255 | $aiowps\_firewall\_config->set\_value('aiowps\_blacklist\_ips', $validated\_ip\_list\_array); |
  |  | 256 | AIOWPSecurity\_Admin\_Menu::show\_msg\_updated\_st(\_\_('The selected IP addresses have been added to the blacklist and will be permanently blocked.', 'all-in-one-wp-security-and-firewall')); |
  | 239 | 257 | } |
  | 240 | 258 | } |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L243) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L261) |  |
  | 243 | 261 | \* Deletes one or more records from the AIOWPSEC\_TBL\_EVENTS table. |
  | 244 | 262 | \* |
  | 245 |  | \* @param ~~Array|String|Integer~~ - ids or a single id |
  | 246 |  | \* |
  | 247 |  | \* @return ~~V~~oid |
  |  | 263 | \* @param array|string|integer $entries - ids or a single id |
  |  | 264 | \* |
  |  | 265 | \* @return void |
  | 248 | 266 | \*/ |
  | 249 | 267 | public function delete\_404\_event\_records($entries) { |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L251) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L269) |  |
  | 251 | 269 | $events\_table = AIOWPSEC\_TBL\_EVENTS; |
  | 252 | 270 | if (is\_array($entries)) { |
  | 253 |  | if (isset($\_REQUEST['\_wp\_http\_referer'])) |
  | 254 |  | { |
  |  | 271 | if (isset($\_REQUEST['\_wp\_http\_referer'])) { |
  | 255 | 272 | //Delete multiple records |
  | 256 |  | $entries = array\_map('esc\_sql', $entries); //escape every array element |
  |  | 273 | $entries = array\_map('esc\_sql', $entries); //escape every array element |
  | 257 | 274 | $entries = array\_filter($entries, 'is\_numeric'); //discard non-numeric ID values |
  | 258 | 275 | $id\_list = "(" . implode(",", $entries) . ")"; //Create comma separate list for DB operation |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L268) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L285) |  |
  | 268 | 285 | } |
  | 269 | 286 |  |
  | 270 |  | } elseif ($entries != NULL) { |
  | 271 |  | $nonce=isset($\_GET['aiowps\_nonce'])?$\_GET['aiowps\_nonce']:''; |
  | 272 |  | if (!isset($nonce) ||!wp\_verify\_nonce($nonce, 'delete\_404\_log')) |
  | 273 |  | { |
  | 274 |  | $aio\_wp\_security->debug\_logger->log\_debug("Nonce check failed for delete selected 404 event logs operation!",4); |
  | 275 |  | die(\_\_('Nonce check failed for delete selected 404 event logs operation!','all-in-one-wp-security-and-firewall')); |
  |  | 287 | } elseif (null != $entries) { |
  |  | 288 | $nonce = isset($\_GET['aiowps\_nonce']) ? $\_GET['aiowps\_nonce'] : ''; |
  |  | 289 | if (!isset($nonce) || !wp\_verify\_nonce($nonce, 'delete\_404\_log')) { |
  |  | 290 | $aio\_wp\_security->debug\_logger->log\_debug("Nonce check failed for delete selected 404 event logs operation.", 4); |
  |  | 291 | die(\_\_('Nonce check failed for delete selected 404 event logs operation.', 'all-in-one-wp-security-and-firewall')); |
  | 276 | 292 | } |
  | 277 | 293 |  |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L282) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L298) |  |
  | 282 | 298 | if ($result) { |
  | 283 | 299 | AIOWPSecurity\_Admin\_Menu::show\_msg\_record\_deleted\_st(); |
  | 284 |  | } elseif (~~$result === false~~) { |
  |  | 300 | } elseif (false === $result) { |
  | 285 | 301 | // Error on single delete |
  | 286 | 302 | $aio\_wp\_security->debug\_logger->log\_debug('Database error occurred when deleting rows from Events table. Database error: '.$wpdb->last\_error, 4); |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L314) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L330) |  |
  | 314 | 330 | $events\_table\_name = AIOWPSEC\_TBL\_EVENTS; |
  | 315 | 331 |  |
  | 316 |  | /~~\* -- Ordering parameters -- \*/~~ |
  | 317 |  | //Parameters that are going to be used to order the result |
  | 318 |  | ~~isset($\_GET['orderby']) ? $orderby = strip\_tags($\_GET['orderby']): $orderby =~~ ''; |
  | 319 |  | ~~isset($\_GET['order']) ? $order = strip\_tags($\_GET['order']): $order =~~ ''; |
  |  | 332 | // Ordering parameters |
  |  | 333 | // Parameters that are going to be used to order the result |
  |  | 334 | $orderby = isset($\_GET['orderby']) ? strip\_tags($\_GET['orderby']) : ''; |
  |  | 335 | $order = isset($\_GET['order']) ? strip\_tags($\_GET['order']) : ''; |
  | 320 | 336 |  |
  | 321 | 337 | $orderby = !empty($orderby) ? esc\_sql($orderby) : 'id'; |
  | […](/browser/all-in-one-wp-security-and-firewall/trunk/admin/wp-security-list-404.php?rev=2916015#L345) | […](/browser/all-in-one-wp-security-and-firewall/tags/5.2.6/admin/wp-security-list-404.php?rev=3032127#L361) |  |
  | 345 | 361 | // Insert an empty status column - we will use later |
  | 346 | 362 | $data[$index]['status'] = ''; |
  | 347 |  | ~~$data[$index]['event\_date'] = get\_date\_from\_gmt(mysql2date('Y-m-d H:i:s', $row['event\_date']), $this->get\_wp\_date\_time\_format());~~ |
  | 348 | 363 | } |
  | 349 | 364 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3032127)
* [Zip Archive](?format=zip&new=3032127)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

