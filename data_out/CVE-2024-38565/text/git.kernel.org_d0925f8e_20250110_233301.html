

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nikita Zhandarovich <n.zhandarovich@fintech.ru> | 2024-04-08 05:14:25 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:32:07 +0200 |
| commit | [ee25389df80138907bc9dcdf4a2be2067cde9a81](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)) | |
| tree | [be957383e067412b9428097fbafd8aedb22aba9b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81) | |
| parent | [8650725bb0a48b206d5a8ddad3a7488f9a5985b7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8650725bb0a48b206d5a8ddad3a7488f9a5985b7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81&id2=8650725bb0a48b206d5a8ddad3a7488f9a5985b7)) | |
| download | [linux-ee25389df80138907bc9dcdf4a2be2067cde9a81.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ee25389df80138907bc9dcdf4a2be2067cde9a81.tar.gz) | |

wifi: ar5523: enable proper endpoint verification[ Upstream commit e120b6388d7d88635d67dcae6483f39c37111850 ]
Syzkaller reports [1] hitting a warning about an endpoint in use
not having an expected type to it.
Fix the issue by checking for the existence of all proper
endpoints with their according types intact.
Sadly, this patch has not been tested on real hardware.
[1] Syzkaller report:
------------[ cut here ]------------
usb 1-1: BOGUS urb xfer, pipe 3 != type 1
WARNING: CPU: 0 PID: 3643 at drivers/usb/core/urb.c:504 usb\_submit\_urb+0xed6/0x1880 drivers/usb/core/urb.c:504
...
Call Trace:
<TASK>
ar5523\_cmd+0x41b/0x780 drivers/net/wireless/ath/ar5523/ar5523.c:275
ar5523\_cmd\_read drivers/net/wireless/ath/ar5523/ar5523.c:302 [inline]
ar5523\_host\_available drivers/net/wireless/ath/ar5523/ar5523.c:1376 [inline]
ar5523\_probe+0x14b0/0x1d10 drivers/net/wireless/ath/ar5523/ar5523.c:1655
usb\_probe\_interface+0x30f/0x7f0 drivers/usb/core/driver.c:396
call\_driver\_probe drivers/base/dd.c:560 [inline]
really\_probe+0x249/0xb90 drivers/base/dd.c:639
\_\_driver\_probe\_device+0x1df/0x4d0 drivers/base/dd.c:778
driver\_probe\_device+0x4c/0x1a0 drivers/base/dd.c:808
\_\_device\_attach\_driver+0x1d4/0x2e0 drivers/base/dd.c:936
bus\_for\_each\_drv+0x163/0x1e0 drivers/base/bus.c:427
\_\_device\_attach+0x1e4/0x530 drivers/base/dd.c:1008
bus\_probe\_device+0x1e8/0x2a0 drivers/base/bus.c:487
device\_add+0xbd9/0x1e90 drivers/base/core.c:3517
usb\_set\_configuration+0x101d/0x1900 drivers/usb/core/message.c:2170
usb\_generic\_driver\_probe+0xbe/0x100 drivers/usb/core/generic.c:238
usb\_probe\_device+0xd8/0x2c0 drivers/usb/core/driver.c:293
call\_driver\_probe drivers/base/dd.c:560 [inline]
really\_probe+0x249/0xb90 drivers/base/dd.c:639
\_\_driver\_probe\_device+0x1df/0x4d0 drivers/base/dd.c:778
driver\_probe\_device+0x4c/0x1a0 drivers/base/dd.c:808
\_\_device\_attach\_driver+0x1d4/0x2e0 drivers/base/dd.c:936
bus\_for\_each\_drv+0x163/0x1e0 drivers/base/bus.c:427
\_\_device\_attach+0x1e4/0x530 drivers/base/dd.c:1008
bus\_probe\_device+0x1e8/0x2a0 drivers/base/bus.c:487
device\_add+0xbd9/0x1e90 drivers/base/core.c:3517
usb\_new\_device.cold+0x685/0x10ad drivers/usb/core/hub.c:2573
hub\_port\_connect drivers/usb/core/hub.c:5353 [inline]
hub\_port\_connect\_change drivers/usb/core/hub.c:5497 [inline]
port\_event drivers/usb/core/hub.c:5653 [inline]
hub\_event+0x26cb/0x45d0 drivers/usb/core/hub.c:5735
process\_one\_work+0x9bf/0x1710 kernel/workqueue.c:2289
worker\_thread+0x669/0x1090 kernel/workqueue.c:2436
kthread+0x2e8/0x3a0 kernel/kthread.c:376
ret\_from\_fork+0x1f/0x30 arch/x86/entry/entry\_64.S:306
</TASK>
Reported-and-tested-by: syzbot+1bc2c2afd44f820a669f@syzkaller.appspotmail.com
Fixes: b7d572e1871d ("ar5523: Add new driver")
Signed-off-by: Nikita Zhandarovich <n.zhandarovich@fintech.ru>
Signed-off-by: Kalle Valo <quic\_kvalo@quicinc.com>
Link: [https://msgid.link/20240408121425.29392-1-n.zhandarovich@fintech.ru](https://msgid.link/20240408121425.29392-1-n.zhandarovich%40fintech.ru)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)

| -rw-r--r-- | [drivers/net/wireless/ath/ar5523/ar5523.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ar5523/ar5523.c?id=ee25389df80138907bc9dcdf4a2be2067cde9a81) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 14 insertions, 0 deletions

| diff --git a/drivers/net/wireless/ath/ar5523/ar5523.c b/drivers/net/wireless/ath/ar5523/ar5523.cindex efe38b2c1df73e..71c2bf8817dc27 100644--- a/[drivers/net/wireless/ath/ar5523/ar5523.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ar5523/ar5523.c?id=8650725bb0a48b206d5a8ddad3a7488f9a5985b7)+++ b/[drivers/net/wireless/ath/ar5523/ar5523.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ar5523/ar5523.c?id=ee25389df80138907bc9dcdf4a2be2067cde9a81)@@ -1590,6 +1590,20 @@ static int ar5523\_probe(struct usb\_interface \*intf, struct ar5523 \*ar; int error = -ENOMEM; + static const u8 bulk\_ep\_addr[] = {+ AR5523\_CMD\_TX\_PIPE | USB\_DIR\_OUT,+ AR5523\_DATA\_TX\_PIPE | USB\_DIR\_OUT,+ AR5523\_CMD\_RX\_PIPE | USB\_DIR\_IN,+ AR5523\_DATA\_RX\_PIPE | USB\_DIR\_IN,+ 0};++ if (!usb\_check\_bulk\_endpoints(intf, bulk\_ep\_addr)) {+ dev\_err(&dev->dev,+ "Could not find all expected endpoints\n");+ error = -ENODEV;+ goto out;+ }+ /\* \* Load firmware if the device requires it. This will return \* -ENXIO on success and we'll get called back afer the usb |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 23:31:38 +0000

