

![](/static/v20241211.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1767590)
* [XML](/show_bug.cgi?ctype=xml&id=1767590)

Closed
[Bug 1767590](/show_bug.cgi?id=1767590)
(CVE-2022-31741)

Opened 3 years ago
Closed 3 years ago

# Uninitialized variable leads to invalid/arbitrary memory read in S/MIME decryption

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Uninitialized variable leads to invalid/arbitrary memory read in S/MIME decryption

## Categories

### (NSS :: Libraries, defect, P1)

[Product:](/describecomponents.cgi?product=NSS)

NSS
▾

NSS
Network Security Services - a cross-platform
security library ([more info](http://www.mozilla.org/projects/security/pki/nss/))
[See Open Bugs in This Product](/buglist.cgi?product=NSS&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=NSS)
Watch This Product

[Component:](/describecomponents.cgi?product=NSS&component=Libraries#Libraries)

Libraries
▾

NSS :: Libraries
Libraries for client support of SSL v2 and v3, TLS, PKCS #5,
PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 certificates,
and other security standards
[See Open Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=NSS&component=Libraries)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

## Tracking

### (firefox-esr91101+ fixed, firefox100 wontfix, firefox101+ fixed, firefox102+ fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

3.79

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr91 | [101+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=101%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed) |
| firefox100 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix) |
| firefox101 | [+](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed) |
| firefox102 | [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr91 | 101+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox100 |  | wontfix |
| firefox101 | + | fixed |
| firefox102 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: yaniv, Assigned: djackson)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/46fbd084ad1a893caecbb3d539951e40?d=mm&size=40)  [djackson](/user_profile?user_id=644159)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/732e697e1c2b60fc918c7cc8fa54b35c?d=mm&size=40)  [yaniv](/user_profile?user_id=705937)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/38f561698d679a724938d4600c0f8b52?d=mm&size=40)  [beurdouche](/user_profile?user_id=622637)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1767934](/show_bug.cgi?id=1767934 "RESOLVED FIXED - Upgrade Firefox 102 to use NSS 3.79"), [1770337](/show_bug.cgi?id=1770337 "RESOLVED FIXED - Upgrade Firefox 101 to use NSS 3.78.1"), [1770397](/show_bug.cgi?id=1770397 "RESOLVED FIXED - Upgrade Firefox 91esr to use NSS 3.68.4")

Dependency [tree](/showdependencytree.cgi?id=1767590&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1767590)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uninitialized, reporter-external, sec-high, Whiteboard: [adv-main101+][adv-esr91.10+][post-critsmash-triage])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-31741

[Keywords:](/describekeywords.cgi)

[csectype-uninitialized](/buglist.cgi?keywords=csectype-uninitialized&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main101+][adv-esr91.10+][post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a2368161_1689 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [mboldan](/user_profile?user_id=551058) | [qe-verify](#a4227847_551058 "3 years ago") | - |
| --- | --- | --- |
| [mboldan](/user_profile?user_id=551058) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [POC file](/attachment.cgi?id=9274927)  [3 years ago](#c0)  [yaniv](/user_profile?user_id=705937)   128 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=9274927&action=edit) |
| --- | --- | --- |
| [Bug 1767590 - Initialize pointers passed to NSS\_CMSDigestContext\_FinishMultiple r=#nss-reviewers,kaie](/attachment.cgi?id=9274964)  [3 years ago](#c3)  [Dennis Jackson](/user_profile?user_id=644159)   48 bytes, text/x-phabricator-request | tjr : [sec-approval+](#c11 "3 years ago") | [Details](/attachment.cgi?id=9274964&action=edit) | [Review](/attachment.cgi?id=9274964) |
| [advisory.txt](/attachment.cgi?id=9278230)  [3 years ago](#c14)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   200 bytes, text/plain |  | [Details](/attachment.cgi?id=9278230&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [yaniv](/user_profile?user_id=705937)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1767590#c0)• 3 years ago |
|  | |

Attached file
[POC file](attachment.cgi?id=9274927)
— [Details](attachment.cgi?id=9274927&action=edit)

This is a bug I encountered in the decryption process of CMS messages in NSS, triggerable by passing a malicious message to NSS\_CMSDecoder\_Update. This flow is used by Thunderbird and Evolution when attempting to read S/MIME encrypted emails.

In NSS\_CMSDigestContext\_FinishSingle, variable `dp` is supposed to be initialized by a successful call to NSS\_CMSDigestContext\_FinishMultiple, and then dereferenced and passed to SECITEM\_CopyItem as the third argument:

```
SECStatus
NSS_CMSDigestContext_FinishSingle(NSSCMSDigestContext *cmsdigcx,
                                  PLArenaPool *poolp,
                                  SECItem *digest)
{
    ...
    SECItem **dp;
    ...
    /* get the digests into arena, then copy the first digest into poolp */
    rv = NSS_CMSDigestContext_FinishMultiple(cmsdigcx, arena, &dp);
    if (rv == SECSuccess) {
        /* now copy it into poolp */
        rv = SECITEM_CopyItem(poolp, digest, dp[0]);
    }
    ...

```

However, NSS\_CMSDigestContext\_FinishMultiple can return SECSuccess without initializing the passed dp argument. This happens in case `cmsdigcx->saw_contents == 0`:

```
    /* no contents? do not finish digests */
    if (digestsp == NULL || !cmsdigcx->saw_contents) {
        rv = SECSuccess;
        goto cleanup;
    }

```

I'm not sure exactly what in the input causes the program to arrive to this state, but it seems to be some bug in the ASN.1 parsing code.

When this happens, dp remains uninitialized when SECITEM\_CopyItem is called, and one of following may happen:

1. Crash in NSS\_CMSDigestContext\_FinishSingle when attempting to read `dp[0]`.

2. Crash in SECITEM\_CopyItem when attempting to read from pointer `dp[0]->data`.

3. If stack memory is properly groomed by an attacker, valid memory of `dp[0]->len` bytes will be read from pointer `dp[0]->data` into an object.

I reproduced this on Thunderbird and Evolution (.p7m email attachment), and on cmsutil compiled from trunk.

Steps to reproduce:

`$ cmsutil -D -d . -i poc.cms`

MSan log:

```
==3958692==WARNING: MemorySanitizer: use-of-uninitialized-value
    #0 0x7ffff75a00eb in NSS_CMSDigestContext_FinishSingle ./lib/smime/cmsdigest.c:258:46
    #1 0x7ffff759b3f0 in NSS_CMSDigestedData_Decode_AfterData ./lib/smime/cmsdigdata.c:187:14
    #2 0x7ffff7594f84 in nss_cms_after_data ./lib/smime/cmsdecode.c:367:18
    #3 0x7ffff758da0a in nss_cms_decoder_notify ./lib/smime/cmsdecode.c:185:21
    #4 0x7ffff77eed10 in sec_asn1d_notify_after ./lib/util/secasn1d.c:437:5
    #5 0x7ffff77cea44 in sec_asn1d_next_in_sequence ./lib/util/secasn1d.c:2078:5
    #6 0x7ffff77b2e35 in SEC_ASN1DecoderUpdate_Util ./lib/util/secasn1d.c:2823:17
    #7 0x7ffff758e7a2 in NSS_CMSDecoder_Update ./lib/smime/cmsdecode.c:683:14
    #8 0x4ab1c3 in decode ./cmd/smimetools/cmsutil.c:191:10
    #9 0x4a678a in main ./cmd/smimetools/cmsutil.c:1455:24
    #10 0x7ffff6e35fcf in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16
    #11 0x7ffff6e3607c in __libc_start_main csu/../csu/libc-start.c:409:3
    #12 0x420db4 in _start (./dist/Debug/bin/cmsutil+0x420db4)

  Uninitialized value was created by an allocation of 'dp' in the stack frame of function 'NSS_CMSDigestContext_FinishSingle'
    #0 0x7ffff759fa90 in NSS_CMSDigestContext_FinishSingle ./lib/smime/cmsdigest.c:242

SUMMARY: MemorySanitizer: use-of-uninitialized-value ./lib/smime/cmsdigest.c:258:46 in NSS_CMSDigestContext_FinishSingle

```

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1767590#c1)• 3 years ago |
|  | |

Hi Yaniv, thank you for the report. I've confirmed the PoC works and I'm taking a look now.

Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1767590#c2)• 3 years ago |
|  | |

This issue may also impact Firefox, as we call into `NSS_CMSMessage_CreateFromDER` when verifying a PKCS#7 signature on an addon.

As the reporter notes `NSS_CMSDigestContext_FinishMultiple` can return SECSuccess but leave its out parameter `digestsp` unchanged, which is a memory safety violation for code which assumes it will be set if the function succeeds. The function contract is pretty ugly.`digestsp` is a pointer to an array of SECItems\* and the array is variously:

* is left as-is (if the digest context hasn't seen any data)
* is set, but points to a single element which is NULL (if we did see data, but digest count is set to 0),
* is set, points to a NULL-terminated array of SECItem pointers (otherwise).

Changing the callers (cmsdigest.c:`NSS_CMSDigestContext_FinishSingle`, cmsutil.c:`decode)` to properly initialise the outparam is sufficient to fix the test case, but I'm concerned about `NSS_CMSSignedData_Decode_AfterData` and `NSS_CMSSignedData_Encode_AfterData` where the outparam comes from and lives on in a struct (`NSSCMSSignedData`).

I'd prefer to update `NSS_CMSDigestContext_FinishMultiple` to ensure that the outparam is set to NULL if the function fails. This ensures that if that if there is a consumer of `NSSCMSSignedData` which is missing a null-check, the attacker gets a null pointer dereference rather than an arbitrary read. I'd also like to promote `cmsdigcx->saw_contents` being false to a failure, but I'm unsure what might be relying on that behaviour.

I've attached a patch which does all three. It could do with a lookover from someone that's more familiar with this codebase.

Flags: needinfo?(kaie)Flags: needinfo?(jschanck)

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1767590#c3)• 3 years ago |
|  | |

Attached file
[Bug 1767590 - Initialize pointers passed to NSS\_CMSDigestContext\_FinishMultiple r=#nss-reviewers,kaie](attachment.cgi?id=9274964)
— [Details](attachment.cgi?id=9274964&action=edit)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a28424_363267)• 3 years ago |

Assignee: nobody → djacksonStatus: NEW → ASSIGNEDPriority: -- → P1

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a39164_689878)• 3 years ago |

Flags: needinfo?(jschanck)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1767590#c4)• 3 years ago |
|  | |

Adding the bounty flag at the reporter's request.

Flags: sec-bounty?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1767590#c5)• 3 years ago |
|  | |

(In reply to Dennis Jackson from [comment #2](/show_bug.cgi?id=1767590#c2 "RESOLVED FIXED - Uninitialized variable leads to invalid/arbitrary memory read in S/MIME decryption"))

> It could do with a lookover from someone that's more familiar with this codebase.

I'm afraid we don't have any active contributors who are familiar with this code.

Flags: needinfo?(kaie)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a622753_600971)• 3 years ago |

[Attachment #9274964](/attachment.cgi?id=9274964&action=edit "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie") -
Attachment description: Bug 1767590 - Ensure NSS\_CMSDigestContext\_FinishMultiple outparam is NULL on failure. r=#nss-reviewers,kaie → Bug 1767590 - Initialize pointers passed to NSS\_CMSDigestContext\_FinishMultiple r=#nss-reviewers,kaie

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1767590#c6)• 3 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1767590&comment_id=15894344 "1 revision") |
|  | |

I found some time to take a further look at the smime codebase. I used [weggli](https://github.com/googleprojectzero/weggli) to audit for similar code patterns where the address of uninitialized values was being passed as a parameter which didn't turn up any new issues.

With respect to the bug in `NSS_CMSDigestContext_FinishSingle`, its only reachable when parsing DigestedData content and support for that content type has never properly been implemented ([code](https://searchfox.org/mozilla-central/source/security/nss/lib/smime/cmsdigdata.c#202)) and isn't part of the [smime standard](https://datatracker.ietf.org/doc/html/rfc8551). However, the code is still reachable from Firefox and Thunderbird because we fully parse the CMS data in `NSS_CMSMessage_CreateFromDER` and use the templates in `cmsasn1.c` prior to validating the format.

John pointed out that we can't NULL out `digestsp` if there's an error as the encoder is relying on the existing behaviour. As we're currently investigating if we can remove this code entirely, I've updated the patch to the sufficient fix outlined my earlier comment. With the fix, the missing data is noticed [here](https://searchfox.org/mozilla-central/source/security/nss/lib/util/secasn1d.c#2130) and the parser raises a decodeError.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1767590#c7)• 3 years ago |
|  | |

Do you plan to create a NSS 3.68.x release and uplift to ESR 91.x ?

|  | [John Schanck [:jschanck]](/user_profile?user_id=689878) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1767590#c8)• 3 years ago |
|  | |

I found a memory leak in an adjacent codepath.

```
$ ascii2der <<EOF | cmsutil -D -d .
SEQUENCE {
  # digestedData
  OBJECT_IDENTIFIER { 1.2.840.113549.1.7.5 }
  [0] {
    SEQUENCE {
      INTEGER { 0 }
      SEQUENCE {
        # sha256
        OBJECT_IDENTIFIER { 2.16.840.1.101.3.4.2.1 }
      }
      SEQUENCE {
        # signedData
        OBJECT_IDENTIFIER { 1.2.840.113549.1.7.2 }
        OCTET_STRING { \`aa\` }
      }
    }
  }
}
EOF
cmsutil: failed to decode message.
cmsutil: problem decoding: SEC_ERROR_BAD_DER: security library: improperly formatted DER-encoded message.

=================================================================
==468819==ERROR: LeakSanitizer: detected memory leaks

Direct leak of 72 byte(s) in 1 object(s) allocated from:
    #0 0x7fc457c5d037 in __interceptor_calloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cpp:154
    #1 0x7fc4574758c8 in PR_Calloc ../../../../pr/src/malloc/prmem.c:458
    #2 0x7fc45796d096 in PORT_ZAlloc_Util ../../lib/util/secport.c:116
    #3 0x7fc4578bcd4d in nss_cms_before_data ../../lib/smime/cmsdecode.c:253
    #4 0x7fc4578bc845 in nss_cms_decoder_notify ../../lib/smime/cmsdecode.c:169
    #5 0x7fc457955f1d in sec_asn1d_notify_before ../../lib/util/secasn1d.c:425
    #6 0x7fc45795e49c in sec_asn1d_next_in_sequence ../../lib/util/secasn1d.c:2175
    #7 0x7fc45796166f in SEC_ASN1DecoderUpdate_Util ../../lib/util/secasn1d.c:2832
    #8 0x7fc4578be73a in NSS_CMSDecoder_Update ../../lib/smime/cmsdecode.c:663
    #9 0x5651d59e980a in decode ../../cmd/smimetools/cmsutil.c:191
    #10 0x5651d59f0e92 in main ../../cmd/smimetools/cmsutil.c:1455
    #11 0x7fc45752fd09 in __libc_start_main ../csu/libc-start.c:308

SUMMARY: AddressSanitizer: 72 byte(s) leaked in 1 allocation(s).

```

If you change the final object identifier from PKCS#7 signedData (1.2.840.113549.1.7.2) to PKCS#7 data (1.2.840.113549.1.7.1) this example triggers the original bug.

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1767590#c9)• 3 years ago |
|  | |

Comment on [attachment 9274964](/attachment.cgi?id=9274964 "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie") [[details]](/attachment.cgi?id=9274964&action=edit "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie")

[Bug 1767590](/show_bug.cgi?id=1767590 "RESOLVED FIXED - Uninitialized variable leads to invalid/arbitrary memory read in S/MIME decryption") - Initialize pointers passed to NSS\_CMSDigestContext\_FinishMultiple r=#nss-reviewers,kaie

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Fairly easily. The changes clearly indicate an uninitialized read which can be reached from the addons signature verification code path in Firefox or from processing an SMIME message in Thunderbird.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Yes
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: Very unlikely to cause regressions as we're just initialising previously unset pointers.
* **Is Android affected?**: Unknown
[Attachment #9274964](/attachment.cgi?id=9274964&action=edit "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie") -
Flags: sec-approval?

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1767590#c10)• 3 years ago |
|  | |

[Tracking Requested - why for this release]:

This a sec-high memory safety bug in NSS which impacts Firefox, ESR & Thunderbird. Security approval has been requested.

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected)
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected)
[tracking-firefox100](/buglist.cgi?f1=cf_tracking_firefox100&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%3F)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1138681_690067)• 3 years ago |

[tracking-firefox100](/buglist.cgi?f1=cf_tracking_firefox100&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1139542_75935)• 3 years ago |

[tracking-firefox101](/buglist.cgi?f1=cf_tracking_firefox101&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox101&o1=equals&v1=%2B)
[tracking-firefox102](/buglist.cgi?f1=cf_tracking_firefox102&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox102&o1=equals&v1=%2B)
[tracking-firefox-esr91](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=%3F) → [101+](/buglist.cgi?f1=cf_tracking_firefox_esr91&o1=equals&v1=101%2B)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1153957_690067)• 3 years ago |

[tracking-firefox100](/buglist.cgi?f1=cf_tracking_firefox100&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox100&o1=equals&v1=%2B) → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1158092_75935)• 3 years ago |

[status-firefox100](/buglist.cgi?f1=cf_status_firefox100&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox100&o1=equals&v1=wontfix)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1767590#c11)• 3 years ago |
|  | |

Comment on [attachment 9274964](/attachment.cgi?id=9274964 "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie") [[details]](/attachment.cgi?id=9274964&action=edit "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie")

[Bug 1767590](/show_bug.cgi?id=1767590 "RESOLVED FIXED - Uninitialized variable leads to invalid/arbitrary memory read in S/MIME decryption") - Initialize pointers passed to NSS\_CMSDigestContext\_FinishMultiple r=#nss-reviewers,kaie

Approved to land and request uplift

[Attachment #9274964](/attachment.cgi?id=9274964&action=edit "Bug 1767590 - Initialize pointers passed to NSS_CMSDigestContext_FinishMultiple r=#nss-reviewers,kaie") -
Flags: sec-approval? → sec-approval+

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1377988_644159)• 3 years ago |

Blocks: [1770337](/show_bug.cgi?id=1770337 "RESOLVED FIXED - Upgrade Firefox 101 to use NSS 3.78.1")

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1393356_644159)• 3 years ago |

Blocks: [1770397](/show_bug.cgi?id=1770397 "RESOLVED FIXED - Upgrade Firefox 91esr to use NSS 3.68.4")

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1767590#c12)• 3 years ago |
|  | |

<https://hg.mozilla.org/projects/nss/rev/8bb2f26245b91be5e51a0278cf446814d620e05b>

Status: ASSIGNED → RESOLVEDClosed: 3 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1425625_75935)• 3 years ago |

Group: crypto-core-security → core-security-release
[status-firefox101](/buglist.cgi?f1=cf_status_firefox101&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox101&o1=equals&v1=fixed)
[status-firefox102](/buglist.cgi?f1=cf_status_firefox102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox102&o1=equals&v1=fixed)
[status-firefox-esr91](/buglist.cgi?f1=cf_status_firefox_esr91&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr91&o1=equals&v1=fixed)Target Milestone: --- → 3.79

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1425647_75935)• 3 years ago |

Blocks: [1767934](/show_bug.cgi?id=1767934 "RESOLVED FIXED - Upgrade Firefox 102 to use NSS 3.79")

|  | [Dennis Jackson](/user_profile?user_id=644159)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1767590#c13)• 3 years ago |
|  | |

Note on timelines: This will be fixed in the upcoming Firefox 101, ESR 91 and Thunderbird releases on May 31st. We'll also announce a new release of NSS on May 31st with the included bug fix and associated release notes.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1844714_578488)• 3 years ago |

Whiteboard: [adv-main101+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1767590#c14)• 3 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9278230)
— [Details](attachment.cgi?id=9278230&action=edit)

|  | [yaniv](/user_profile?user_id=705937)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1767590#c15)• 3 years ago |
|  | |

Can you please give credit to "Cybeats PSI Team" instead?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1929567_578488)• 3 years ago |

Whiteboard: [adv-main101+] → [adv-main101+][adv-esr91.10+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1931542_578488)• 3 years ago |

Alias: CVE-2022-31741

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a1935401_486634)• 3 years ago |

Keywords: [csectype-uninitialized](/buglist.cgi?keywords=csectype-uninitialized&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a2368161_1689)• 3 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a4227847_551058)• 3 years ago |

Flags: qe-verify-Whiteboard: [adv-main101+][adv-esr91.10+] → [adv-main101+][adv-esr91.10+][post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a22276857_1689)• 2 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767590#a65438919_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1767590&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [yaniv](/user_profile?user_id=705937)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

