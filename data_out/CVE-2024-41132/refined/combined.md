=== Content from docs.sixlabors.com_c491a052_20250111_061801.html ===

Toggle navigation

[![](../../logo.svg)](../../index.html)

* [Articles](../../articles/imagesharp/index.html "Articles")
* [API Documentation](../../api/index.html "API Documentation")

Search Results for

[Show / Hide Table of Contents](#sidetoggle)

* [ImageSharp](../imagesharp/index.html "ImageSharp")
  + [Getting Started](../imagesharp/gettingstarted.html "Getting Started")
    - [Pixel Formats](../imagesharp/pixelformats.html "Pixel Formats")
    - [Image Formats](../imagesharp/imageformats.html "Image Formats")
    - [Processing Images](../imagesharp/processing.html "Processing Images")
      * [Resizing Images](../imagesharp/resize.html "Resizing Images")
      * [Create an animated GIF](../imagesharp/animatedgif.html "Create an animated GIF")
    - [Working with Pixel Buffers](../imagesharp/pixelbuffers.html "Working with Pixel Buffers")
    - [Configuration](../imagesharp/configuration.html "Configuration")
    - [Memory Management](../imagesharp/memorymanagement.html "Memory Management")
    - [Security Considerations](../imagesharp/security.html "Security Considerations")
* [ImageSharp.Drawing](../imagesharp.drawing/index.html "ImageSharp.Drawing")
  + [Getting Started](../imagesharp.drawing/gettingstarted.html "Getting Started")
* [ImageSharp.Web](../imagesharp.web/index.html "ImageSharp.Web")
  + [Getting Started](../imagesharp.web/gettingstarted.html "Getting Started")
    - [Processing Commands](../imagesharp.web/processingcommands.html "Processing Commands")
    - [Image Providers](../imagesharp.web/imageproviders.html "Image Providers")
    - [Image Caches](../imagesharp.web/imagecaches.html "Image Caches")
* [Fonts](../fonts/index.html "Fonts")
  + [Getting Started](../fonts/gettingstarted.html "Getting Started")
  + [Custom Rendering](../fonts/customrendering.html "Custom Rendering")

# Security Considerations

Image processing is a memory-intensive application. Most image processing libraries (including ImageSharp, SkiaSharp, and Magick.NET) decode images into in-memory buffers for further processing. Without additional measures, any publicly facing service that consumes images coming from untrusted sources might be vulnerable to DoS attacks attempting to deplete process memory.

Such measures can be:

* Authentication, for example by using HMAC. See [Securing Processing Commands in ImageSharp.Web](../imagesharp.web/processingcommands.html#securing-processing-commands).
* Offloading to separate services/containers.
* Placing the solution behind a reverse proxy.
* Rate Limiting.
* Imposing conservative allocation limits by configuring a custom `MemoryAllocator`:

```
Configuration.Default.MemoryAllocator = MemoryAllocator.Create(new MemoryAllocatorOptions()
{
    // Note that this limits the maximum image size to 64 megapixels of Rgba32.
    // Any attempt to create a larger image will throw.
    AllocationLimitMegabytes = 256
});

```

* [Edit this page](https://github.com/SixLabors/docs/blob/main/articles/imagesharp/security.md/#L1)

##### In this article

[Back to top](#top)

Generated by **DocFX**



=== Content from docs.sixlabors.com_93236d0f_20250111_061801.html ===

Toggle navigation

[![](../../logo.svg)](../../index.html)

* [Articles](../../articles/imagesharp/index.html "Articles")
* [API Documentation](../../api/index.html "API Documentation")

Search Results for

[Show / Hide Table of Contents](#sidetoggle)

* [ImageSharp](../imagesharp/index.html "ImageSharp")
  + [Getting Started](../imagesharp/gettingstarted.html "Getting Started")
    - [Pixel Formats](../imagesharp/pixelformats.html "Pixel Formats")
    - [Image Formats](../imagesharp/imageformats.html "Image Formats")
    - [Processing Images](../imagesharp/processing.html "Processing Images")
      * [Resizing Images](../imagesharp/resize.html "Resizing Images")
      * [Create an animated GIF](../imagesharp/animatedgif.html "Create an animated GIF")
    - [Working with Pixel Buffers](../imagesharp/pixelbuffers.html "Working with Pixel Buffers")
    - [Configuration](../imagesharp/configuration.html "Configuration")
    - [Memory Management](../imagesharp/memorymanagement.html "Memory Management")
    - [Security Considerations](../imagesharp/security.html "Security Considerations")
* [ImageSharp.Drawing](../imagesharp.drawing/index.html "ImageSharp.Drawing")
  + [Getting Started](../imagesharp.drawing/gettingstarted.html "Getting Started")
* [ImageSharp.Web](../imagesharp.web/index.html "ImageSharp.Web")
  + [Getting Started](../imagesharp.web/gettingstarted.html "Getting Started")
    - [Processing Commands](../imagesharp.web/processingcommands.html "Processing Commands")
    - [Image Providers](../imagesharp.web/imageproviders.html "Image Providers")
    - [Image Caches](../imagesharp.web/imagecaches.html "Image Caches")
* [Fonts](../fonts/index.html "Fonts")
  + [Getting Started](../fonts/gettingstarted.html "Getting Started")
  + [Custom Rendering](../fonts/customrendering.html "Custom Rendering")

# Processing Commands

The ImageSharp.Web processing API is imperative. This means that the order in which you supply the individual processing operations is the order in which they are compiled and applied. This allows the API to be very flexible, allowing you to combine processes in any order.

##### Note

It is possible to configure your own processing command pipeline by implementing and registering your own version of the [IRequestParser](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.Commands.IRequestParser.html) interface.

The following processors are built into the middleware. In addition extension points are available to register your own command processors.

#### Resize

Allows the resizing of images.

##### Note

In V3 this processor will automatically correct the order of dimensional commands based on the presence of EXIF metadata indicating rotated (not flipped) images.
This behavior can be turned off per request.

```
{PATH_TO_YOUR_IMAGE}?width=300
{PATH_TO_YOUR_IMAGE}?width=300&height=120&rxy=0.37,0.78
{PATH_TO_YOUR_IMAGE}?width=50&height=50&rsampler=nearest&rmode=stretch
{PATH_TO_YOUR_IMAGE}?width=300&compand=true&orient=false

```

Resize commands represent the [ResizeOptions](../../api/ImageSharp/SixLabors.ImageSharp.Processing.ResizeOptions.html) class.

* `width` The width of the image in px. Use only one dimension to preseve the aspect ratio.
* `height` The height of the image in px. Use only one dimension to preseve the aspect ratio.
* `rmode` The [ResizeMode](../../api/ImageSharp/SixLabors.ImageSharp.Processing.ResizeMode.html) to use.
* `rsampler` The [IResampler](../../api/ImageSharp/SixLabors.ImageSharp.Processing.Processors.Transforms.IResampler.html)
  sampler to use.
  + `bicubic` [Bicubic](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Bicubic)
  + `nearest` [NearestNeighbor](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_NearestNeighbor)
  + `box` [Box](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Box)
  + `mitchell` [MitchellNetravali](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_MitchellNetravali)
  + `catmull` [CatmullRom](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_CatmullRom)
  + `lanczos2` [Lanczos2](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Lanczos2)
  + `lanczos3` [Lanczos3](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Lanczos3)
  + `lanczos5` [Lanczos5](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Lanczos5)
  + `lanczos8` [Lanczos8](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Lanczos8)
  + `welch` [Welch](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Welch)
  + `robidoux` [Robidoux](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Robidoux)
  + `robidouxsharp` [RobidouxSharp](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_RobidouxSharp)
  + `spline` [Spline](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Spline)
  + `triangle` [Triangle](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Triangle)
  + `hermite` [Hermite](../../api/ImageSharp/SixLabors.ImageSharp.Processing.KnownResamplers.html#SixLabors_ImageSharp_Processing_KnownResamplers_Hermite)
* `ranchor`The [AnchorPositionMode](../../api/ImageSharp/SixLabors.ImageSharp.Processing.AnchorPositionMode.html) to use.
* `rxy` Use an exact anchor position point. The comma-separated x and y values range from 0-1.
* `orient` Whether to swap command dimensions based on the presence of EXIF metadata indicating rotated (not flipped) images. Defaults to `true`
* `compand` Whether to compress and expand individual pixel colors values to/from a linear color space when processing. Defaults to `false`

#### Format

Allows the encoding of the output image to a new image format. The available formats depend on your configuration settings.

```
{PATH_TO_YOUR_IMAGE}?format=bmp
{PATH_TO_YOUR_IMAGE}?format=gif
{PATH_TO_YOUR_IMAGE}?format=jpg
{PATH_TO_YOUR_IMAGE}?format=pbm
{PATH_TO_YOUR_IMAGE}?format=png
{PATH_TO_YOUR_IMAGE}?format=tga
{PATH_TO_YOUR_IMAGE}?format=tiff
{PATH_TO_YOUR_IMAGE}?format=webp

```
#### Quality

Allows the encoding of the output image at the given quality.

* For Jpeg this ranges from 1â€”100.
* For WebP this ranges from 1â€”100.

```
{PATH_TO_YOUR_IMAGE}?quality=90
{PATH_TO_YOUR_IMAGE}?format=jpg&quality=42

```
##### Note

Only certain formats support adjustable quality. This is a constraint of individual image standards not the API.

#### Background Color

Allows the changing of the background color of transparent images.

```
{PATH_TO_YOUR_IMAGE}?bgcolor=FFFF00
{PATH_TO_YOUR_IMAGE}?bgcolor=C1FF0080
{PATH_TO_YOUR_IMAGE}?bgcolor=red
{PATH_TO_YOUR_IMAGE}?bgcolor=128,64,32
{PATH_TO_YOUR_IMAGE}?bgcolor=128,64,32,16

```
## Securing Processing Commands

With ImageSharp.Web it is possible to configure an action to generate an HMAC by setting the [HMACSecretKey](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.Middleware.ImageSharpMiddlewareOptions.html#SixLabors_ImageSharp_Web_Middleware_ImageSharpMiddlewareOptions_HMACSecretKey) property to any byte array value. This triggers checks in the middleware to look for and compare a HMAC hash of the request URL with the hash that is passed alongside the commands.

In cryptography, an HMAC (sometimes expanded as either keyed-hash message authentication code or hash-based message authentication code) is a specific type of message authentication code (MAC) involving a cryptographic hash function and a secret cryptographic key. As with any MAC, it may be used to simultaneously verify both the data integrity and authenticity of a message.

HMAC can provide authentication using a shared secret instead of using digital signatures with asymmetric cryptography. It trades off the need for a complex public key infrastructure by delegating the key exchange to the communicating parties, who are responsible for establishing and using a trusted channel to agree on the key prior to communication.

Any cryptographic hash function, such as SHA-2 or SHA-3, may be used in the calculation of an HMAC; the resulting MAC algorithm is termed HMAC-X, where X is the hash function used (e.g. HMAC-SHA256 or HMAC-SHA3-512). The cryptographic strength of the HMAC depends upon the cryptographic strength of the underlying hash function, the size of its hash output, and the size and quality of the key.

HMAC does not encrypt the message. Instead, the message (encrypted or not) must be sent alongside the HMAC hash. Parties with the secret key will hash the message again themselves, and if it is authentic, the received and computed hashes will match.

By default ImageSharp.Web will use a HMAC-SHA256 algorithm.

```
private Func<ImageCommandContext, byte[], Task<string>> onComputeHMACAsync = (context, secret) =>
{
    string uri = CaseHandlingUriBuilder.BuildRelative(
            CaseHandlingUriBuilder.CaseHandling.LowerInvariant,
            context.Context.Request.PathBase,
            context.Context.Request.Path,
            QueryString.Create(context.Commands));

    return Task.FromResult(HMACUtilities.ComputeHMACSHA256(uri, secret));
};

```

Users can replicate that key using the same [CaseHandlingUriBuilder](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.CaseHandlingUriBuilder.html) and [HMACUtilities](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.HMACUtilities.html) APIs to generate the HMAC hash on the client. The hash must be passed via a command using the [TokenCommand](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.HMACUtilities.html#SixLabors_ImageSharp_Web_HMACUtilities_TokenCommand) constant.

Any invalid matches are rejected at the very start of the processing pipeline with a 400 HttpResponse code.

## ImageTagHelper

ASP.NET tag helpers are useful because they provide a more natural syntax for creating HTML elements in server-side code. They allow developers to create HTML elements in a way that is similar to how they would write HTML markup in a Razor view.

Some of the benefits of using tag helpers include:

1. Improved readability: Tag helpers make it easier to understand the purpose of the code by providing a clear and concise syntax that is closer to HTML.
2. Reduced complexity: Tag helpers simplify the creation of complex HTML elements by reducing the amount of boilerplate code needed.
3. Type safety: Tag helpers are strongly typed, which means that the compiler can catch errors at compile time rather than at runtime.
4. Testability: Tag helpers make it easier to unit test server-side code by providing a cleaner separation of concerns between the server-side code and the HTML markup.
5. Code reuse: Tag helpers can be used to encapsulate commonly used HTML elements, making it easier to reuse code across multiple views and pages.

Overall, ASP.NET tag helpers provide a more efficient and maintainable way to create HTML elements in server-side code.

ImageSharp.Web v3.0.0 comes equipped with a custom tag helper that allows the generation of all the commands supported by the middleware in an easily accessible manner. This includes automatic generation of HMAC command tokens.

##### Note

Using [ImageTagHelper](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.TagHelpers.ImageTagHelper.html) is the recommended way to generate processing commands.

To use [ImageTagHelper](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.TagHelpers.ImageTagHelper.html), add the following imports command to `_ViewImports.cshtml` in your project.

```
@addTagHelper *, SixLabors.ImageSharp.Web

```

All ImageSharp.Web commands are strongly typed and prefixed with `imagesharp` to namespace them against potentially conflicting commands. Visual Studio intellisense with automatically provide guidance
once you start typing. For example, the following markup...

```
<img
    src="sixlabors.imagesharp.web.png"
    imagesharp-width="300"
    imagesharp-height="200"
    imagesharp-rmode="ResizeMode.Pad"
    imagesharp-rcolor="Color.LimeGreen" />

```

Will generate the following command when HMAC is enabled.

```
/sixlabors.imagesharp.web.png?width=300&height=200&rmode=Pad&rcolor=32CD32FF&hmac=21f93e41021df0d3f88b5e2a8753bb273f292598e1511df67ec7cfb63f0b2994

```

The [ImageTagHelper](../../api/ImageSharp.Web/SixLabors.ImageSharp.Web.TagHelpers.ImageTagHelper.html) type is unsealed so that you can inherit the type and support your own custom commands.

* [Edit this page](https://github.com/SixLabors/docs/blob/main/articles/imagesharp.web/processingcommands.md/#L1)

##### In this article

[Back to top](#top)

Generated by **DocFX**



=== Content from github.com_0934b570_20250111_061802.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F59de13c8cc47f2b402e2c43aa7024511d029d515)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F59de13c8cc47f2b402e2c43aa7024511d029d515)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

## Commit

[Permalink](/SixLabors/ImageSharp/commit/59de13c8cc47f2b402e2c43aa7024511d029d515)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2764](https://github.com/SixLabors/ImageSharp/pull/2764) from SixLabors/js/v4-merge-2758-fix

[Browse files](/SixLabors/ImageSharp/tree/59de13c8cc47f2b402e2c43aa7024511d029d515)
Browse the repository at this point in the history

```
v4 Fix 2758
```

* Loading branch information

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

[JimBobSquarePants](/SixLabors/ImageSharp/commits?author=JimBobSquarePants "View all commits by JimBobSquarePants")
authored
Jul 7, 2024

2 parents
[c9a29f0](/SixLabors/ImageSharp/commit/c9a29f0a61f90a1f44e1fc0f76826856d1ca4b41)
+
[00afbe8](/SixLabors/ImageSharp/commit/00afbe8e258966d390474cc209a707526da919eb)

commit 59de13c

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**295 additions**
and
**286 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/ImageSharp/Formats

  + Gif

    - src/ImageSharp/Formats/Gif/GifDecoderCore.cs
      [GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295)
    - src/ImageSharp/Formats/Gif/LzwDecoder.cs
      [LzwDecoder.cs](#diff-cc8ff121332562a85fa55e85ea87a44d94a0771d2fc9c97ac5a0c7e84c485f01)
  + Jpeg/Components

    - src/ImageSharp/Formats/Jpeg/Components/Quantization.cs
      [Quantization.cs](#diff-2fac2ef9245b225438655645008bb0aff0c07c96be2e9e5224aa35ecb89290fc)
* tests

  + ImageSharp.Tests

    - Formats

      * Gif

        + tests/ImageSharp.Tests/Formats/Gif/GifDecoderTests.cs
          [GifDecoderTests.cs](#diff-4bce8fda682fccceec79f799cdf2c93a6c93a4ea4a5d13c3650a8bdff55f617a)
      * Jpg

        + tests/ImageSharp.Tests/Formats/Jpg/JpegDecoderTests.Metadata.cs
          [JpegDecoderTests.Metadata.cs](#diff-e19d31e448b563c880c9b1816f6ae23b569dd928314e88042f4d52c6241d51c4)
    - tests/ImageSharp.Tests/TestImages.cs
      [TestImages.cs](#diff-e03a3dfed3cced318aa98cd8d039c18dba40e090899c4639f922738d7abeaf02)
  + Images

    - External/ReferenceOutput/GifDecoderTests

      * tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png
        [Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png](#diff-aad8bdae828b66c0a22a4a525367e4c4d02a86cbddc5bfedca373e8ed4fc0895)
      * Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/00.png
          [00.png](#diff-706146c0479a9d94d10a109d03cbeb8feb75e2a5a490f0fa60d296a3204b220c)
        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/01.png
          [01.png](#diff-fd8471b867a536a46cd35eac00bc8ee73ee6dee1ce38518c45d0a9ec109b058d)
      * IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif/07.png
          [07.png](#diff-969ed6ef7f7d576ab4748d9fc82ea57dd4770445527935e2d1d7a38939aa7e25)
    - Input

      * Gif/issues

        + tests/Images/Input/Gif/issues/issue\_2758.gif
          [issue\_2758.gif](#diff-2a82e1abd15bd8de7915a8a59ce9edf5f01d84273905d56b28c9f488c2fc4079)
      * Jpg/issues

        + tests/Images/Input/Jpg/issues/issue-2758.jpg
          [issue-2758.jpg](#diff-87bf646572def7fd79ded00a56a2c454e93c9e4d415a18d7fae2163cb54c1c48)

## There are no files selected for viewing

188 changes: 91 additions & 97 deletions

188
[src/ImageSharp/Formats/Gif/GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295 "src/ImageSharp/Formats/Gif/GifDecoderCore.cs")

Show comments

[View file](/SixLabors/ImageSharp/blob/59de13c8cc47f2b402e2c43aa7024511d029d515/src/ImageSharp/Formats/Gif/GifDecoderCore.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -427,68 +427,49 @@ private void ReadFrame<TPixel>(BufferedReadStream stream, ref Image<TPixel>? ima |
|  |  | { |
|  |  | this.ReadImageDescriptor(stream); |
|  |  |  |
|  |  | Buffer2D<byte>? indices = null; |
|  |  | try |
|  |  | { |
|  |  | // Determine the color table for this frame. If there is a local one, use it otherwise use the global color table. |
|  |  | bool hasLocalColorTable = this.imageDescriptor.LocalColorTableFlag; |
|  |  |  |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | // Read and store the local color table. We allocate the maximum possible size and slice to match. |
|  |  | int length = this.currentLocalColorTableSize = this.imageDescriptor.LocalColorTableSize \* 3; |
|  |  | this.currentLocalColorTable ??= this.configuration.MemoryAllocator.Allocate<byte>(768, AllocationOptions.Clean); |
|  |  | stream.Read(this.currentLocalColorTable.GetSpan()[..length]); |
|  |  | } |
|  |  |  |
|  |  | indices = this.configuration.MemoryAllocator.Allocate2D<byte>(this.imageDescriptor.Width, this.imageDescriptor.Height, AllocationOptions.Clean); |
|  |  | this.ReadFrameIndices(stream, indices); |
|  |  | // Determine the color table for this frame. If there is a local one, use it otherwise use the global color table. |
|  |  | bool hasLocalColorTable = this.imageDescriptor.LocalColorTableFlag; |
|  |  |  |
|  |  | Span<byte> rawColorTable = default; |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | rawColorTable = this.currentLocalColorTable!.GetSpan()[..this.currentLocalColorTableSize]; |
|  |  | } |
|  |  | else if (this.globalColorTable != null) |
|  |  | { |
|  |  | rawColorTable = this.globalColorTable.GetSpan(); |
|  |  | } |
|  |  |  |
|  |  | ReadOnlySpan<Rgb24> colorTable = MemoryMarshal.Cast<byte, Rgb24>(rawColorTable); |
|  |  | this.ReadFrameColors(ref image, ref previousFrame, indices, colorTable, this.imageDescriptor); |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | // Read and store the local color table. We allocate the maximum possible size and slice to match. |
|  |  | int length = this.currentLocalColorTableSize = this.imageDescriptor.LocalColorTableSize \* 3; |
|  |  | this.currentLocalColorTable ??= this.configuration.MemoryAllocator.Allocate<byte>(768, AllocationOptions.Clean); |
|  |  | stream.Read(this.currentLocalColorTable.GetSpan()[..length]); |
|  |  | } |
|  |  |  |
|  |  | // Skip any remaining blocks |
|  |  | SkipBlock(stream); |
|  |  | Span<byte> rawColorTable = default; |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | rawColorTable = this.currentLocalColorTable!.GetSpan()[..this.currentLocalColorTableSize]; |
|  |  | } |
|  |  | finally |
|  |  | else if (this.globalColorTable != null) |
|  |  | { |
|  |  | indices?.Dispose(); |
|  |  | rawColorTable = this.globalColorTable.GetSpan(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Reads the frame indices marking the color to use for each pixel. |
|  |  | /// </summary> |
|  |  | /// <param name="stream">The <see cref="BufferedReadStream"/> containing image data.</param> |
|  |  | /// <param name="indices">The 2D pixel buffer to write to.</param> |
|  |  | [MethodImpl(MethodImplOptions.AggressiveInlining)] |
|  |  | private void ReadFrameIndices(BufferedReadStream stream, Buffer2D<byte> indices) |
|  |  | { |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream); |
|  |  | lzwDecoder.DecodePixels(minCodeSize, indices); |
|  |  | ReadOnlySpan<Rgb24> colorTable = MemoryMarshal.Cast<byte, Rgb24>(rawColorTable); |
|  |  | this.ReadFrameColors(stream, ref image, ref previousFrame, colorTable, this.imageDescriptor); |
|  |  |  |
|  |  | // Skip any remaining blocks |
|  |  | SkipBlock(stream); |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Reads the frames colors, mapping indices to colors. |
|  |  | /// </summary> |
|  |  | /// <typeparam name="TPixel">The pixel format.</typeparam> |
|  |  | /// <param name="stream">The <see cref="BufferedReadStream"/> containing image data.</param> |
|  |  | /// <param name="image">The image to decode the information to.</param> |
|  |  | /// <param name="previousFrame">The previous frame.</param> |
|  |  | /// <param name="indices">The indexed pixels.</param> |
|  |  | /// <param name="colorTable">The color table containing the available colors.</param> |
|  |  | /// <param name="descriptor">The <see cref="GifImageDescriptor"/></param> |
|  |  | private void ReadFrameColors<TPixel>(ref Image<TPixel>? image, ref ImageFrame<TPixel>? previousFrame, Buffer2D<byte> indices, ReadOnlySpan<Rgb24> colorTable, in GifImageDescriptor descriptor) |
|  |  | private void ReadFrameColors<TPixel>( |
|  |  | BufferedReadStream stream, |
|  |  | ref Image<TPixel>? image, |
|  |  | ref ImageFrame<TPixel>? previousFrame, |
|  |  | ReadOnlySpan<Rgb24> colorTable, |
|  |  | in GifImageDescriptor descriptor) |
|  |  | where TPixel : unmanaged, IPixel<TPixel> |
|  |  | { |
|  |  | int imageWidth = this.logicalScreenDescriptor.Width; |
| Expand Down  Expand Up | | @@ -549,69 +530,79 @@ private void ReadFrameColors<TPixel>(ref Image<TPixel>? image, ref ImageFrame<TP |
|  |  | byte transIndex = this.graphicsControlExtension.TransparencyIndex; |
|  |  | int colorTableMaxIdx = colorTable.Length - 1; |
|  |  |  |
|  |  | for (int y = descriptorTop; y < descriptorBottom && y < imageHeight; y++) |
|  |  | // For a properly encoded gif the descriptor dimensions will never exceed the logical screen dimensions. |
|  |  | // However we have images that exceed this that can be decoded by other libraries. #1530 |
|  |  | using IMemoryOwner<byte> indicesRowOwner = this.memoryAllocator.Allocate<byte>(descriptor.Width); |
|  |  | Span<byte> indicesRow = indicesRowOwner.Memory.Span; |
|  |  | ref byte indicesRowRef = ref MemoryMarshal.GetReference(indicesRow); |
|  |  |  |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | if (LzwDecoder.IsValidMinCodeSize(minCodeSize)) |
|  |  | { |
|  |  | ref byte indicesRowRef = ref MemoryMarshal.GetReference(indices.DangerousGetRowSpan(y - descriptorTop)); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream, minCodeSize); |
|  |  |  |
|  |  | // Check if this image is interlaced. |
|  |  | int writeY; // the target y offset to write to |
|  |  | if (descriptor.InterlaceFlag) |
|  |  | for (int y = descriptorTop; y < descriptorBottom && y < imageHeight; y++) |
|  |  | { |
|  |  | // If so then we read lines at predetermined offsets. |
|  |  | // When an entire image height worth of offset lines has been read we consider this a pass. |
|  |  | // With each pass the number of offset lines changes and the starting line changes. |
|  |  | if (interlaceY >= descriptor.Height) |
|  |  | // Check if this image is interlaced. |
|  |  | int writeY; // the target y offset to write to |
|  |  | if (descriptor.InterlaceFlag) |
|  |  | { |
|  |  | interlacePass++; |
|  |  | switch (interlacePass) |
|  |  | // If so then we read lines at predetermined offsets. |
|  |  | // When an entire image height worth of offset lines has been read we consider this a pass. |
|  |  | // With each pass the number of offset lines changes and the starting line changes. |
|  |  | if (interlaceY >= descriptor.Height) |
|  |  | { |
|  |  | case 1: |
|  |  | interlaceY = 4; |
|  |  | break; |
|  |  | case 2: |
|  |  | interlaceY = 2; |
|  |  | interlaceIncrement = 4; |
|  |  | break; |
|  |  | case 3: |
|  |  | interlaceY = 1; |
|  |  | interlaceIncrement = 2; |
|  |  | break; |
|  |  | interlacePass++; |
|  |  | switch (interlacePass) |
|  |  | { |
|  |  | case 1: |
|  |  | interlaceY = 4; |
|  |  | break; |
|  |  | case 2: |
|  |  | interlaceY = 2; |
|  |  | interlaceIncrement = 4; |
|  |  | break; |
|  |  | case 3: |
|  |  | interlaceY = 1; |
|  |  | interlaceIncrement = 2; |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | writeY = interlaceY + descriptor.Top; |
|  |  | interlaceY += interlaceIncrement; |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | writeY = y; |
|  |  | } |
|  |  | writeY = Math.Min(interlaceY + descriptor.Top, image.Height); |
|  |  | interlaceY += interlaceIncrement; |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | writeY = y; |
|  |  | } |
|  |  |  |
|  |  | ref TPixel rowRef = ref MemoryMarshal.GetReference(imageFrame.PixelBuffer.DangerousGetRowSpan(writeY)); |
|  |  | lzwDecoder.DecodePixelRow(indicesRow); |
|  |  | ref TPixel rowRef = ref MemoryMarshal.GetReference(imageFrame.PixelBuffer.DangerousGetRowSpan(writeY)); |
|  |  |  |
|  |  | if (!transFlag) |
|  |  | { |
|  |  | // #403 The left + width value can be larger than the image width |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | if (!transFlag) |
|  |  | { |
|  |  | int index = Numerics.Clamp(Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)), 0, colorTableMaxIdx); |
|  |  | Unsafe.Add(ref rowRef, (uint)x) = TPixel.FromRgb24(colorTable[index]); |
|  |  | // #403 The left + width value can be larger than the image width |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | { |
|  |  | int index = Numerics.Clamp(Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)), 0, colorTableMaxIdx); |
|  |  | Unsafe.Add(ref rowRef, (uint)x) = TPixel.FromRgb24(colorTable[index]); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | else |
|  |  | { |
|  |  | int rawIndex = Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)); |
|  |  |  |
|  |  | // Treat any out of bounds values as transparent. |
|  |  | if (rawIndex > colorTableMaxIdx || rawIndex == transIndex) |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | { |
|  |  | continue; |
|  |  | } |
|  |  | int index = Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)); |
|  |  |  |
|  |  | // Treat any out of bounds values as transparent. |
|  |  | if (index > colorTableMaxIdx || index == transIndex) |
|  |  | { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | int index = Numerics.Clamp(rawIndex, 0, colorTableMaxIdx); |
|  |  | Unsafe.Add(ref rowRef, (uint)x) = TPixel.FromRgb24(colorTable[index]); |
|  |  | Unsafe.Add(ref rowRef, (uint)x) = TPixel.FromRgb24(colorTable[index]); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -652,8 +643,11 @@ private void ReadFrameMetadata(BufferedReadStream stream, List<ImageFrameMetadat |
|  |  | // Skip the frame indices. Pixels length + mincode size. |
|  |  | // The gif format does not tell us the length of the compressed data beforehand. |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream); |
|  |  | lzwDecoder.SkipIndices(minCodeSize, this.imageDescriptor.Width \* this.imageDescriptor.Height); |
|  |  | if (LzwDecoder.IsValidMinCodeSize(minCodeSize)) |
|  |  | { |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream, minCodeSize); |
|  |  | lzwDecoder.SkipIndices(this.imageDescriptor.Width \* this.imageDescriptor.Height); |
|  |  | } |
|  |  |  |
|  |  | ImageFrameMetadata currentFrame = new(); |
|  |  | frameMetadata.Add(currentFrame); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `59de13c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F59de13c8cc47f2b402e2c43aa7024511d029d515) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_b2d12919_20250111_061806.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2770)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2770)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)

By clicking â€œSign up for GitHubâ€, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). Weâ€™ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Backport 2759 to 2.1.x #2770

 Merged

[JimBobSquarePants](/JimBobSquarePants)
merged 7 commits into
[release/2.1.x](/SixLabors/ImageSharp/tree/release/2.1.x "SixLabors/ImageSharp:release/2.1.x")
from
[af/backport-2759-2.1.x](/SixLabors/ImageSharp/tree/af/backport-2759-2.1.x "SixLabors/ImageSharp:af/backport-2759-2.1.x")

Jul 15, 2024

 Merged

# [Backport 2759 to 2.1.x](#top) #2770

[JimBobSquarePants](/JimBobSquarePants)
merged 7 commits into
[release/2.1.x](/SixLabors/ImageSharp/tree/release/2.1.x "SixLabors/ImageSharp:release/2.1.x")
from
[af/backport-2759-2.1.x](/SixLabors/ImageSharp/tree/af/backport-2759-2.1.x "SixLabors/ImageSharp:af/backport-2759-2.1.x")

Jul 15, 2024

[Conversation
1](/SixLabors/ImageSharp/pull/2770)
[Commits
7](/SixLabors/ImageSharp/pull/2770/commits)
[Checks
13](/SixLabors/ImageSharp/pull/2770/checks)
[Files changed](/SixLabors/ImageSharp/pull/2770/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=60&v=4)](/antonfirsov)

Copy link

Member

### @antonfirsov **[antonfirsov](/antonfirsov)** commented [Jul 12, 2024](#issue-2406388232)

### Prerequisites

* I have written a descriptive pull-request title
* I have verified that there are no overlapping [pull-requests](https://github.com/SixLabors/ImageSharp/pulls) open
* I have verified that I am following the existing coding patterns and practice as demonstrated in the repository. These follow strict Stylecop rules ðŸ‘®.
* I have provided test coverage for my change (where applicable)

### Description

Implemented it by a full port of 3.1.x Gif Decoder, so it contains improvements and behavioral changes made since then. It also decodes some stuff 2.1 API doesn't expose.

I didn't fully understand what was the JPEG change about, but the 2.1 decoder detects it as an invalid image. Added the test as a skipped test.

Sorry, something went wrong.

All reactions

 [JimBobSquarePants](/JimBobSquarePants)
and others
added 7 commits
[July 11, 2024 04:08](#commits-pushed-4b910e7)

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants) [![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[Decode LZW row by row](/SixLabors/ImageSharp/pull/2770/commits/4b910e7f8400d89f1845761650cf64df687e73d5 "Decode LZW row by row

Signed-off-by: antonfirsov <antonfir@gmail.com>")`
 â€¦

`[4b910e7](/SixLabors/ImageSharp/pull/2770/commits/4b910e7f8400d89f1845761650cf64df687e73d5)`

```
Signed-off-by: antonfirsov <antonfir@gmail.com>
```

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants) [![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[Clamp JPEG quality estimation results.](/SixLabors/ImageSharp/pull/2770/commits/28c20ded87e2d81477a08a48e0d3a0717b3c4d5a "Clamp JPEG quality estimation results.

Signed-off-by: antonfirsov <antonfir@gmail.com>")`
 â€¦

`[28c20de](/SixLabors/ImageSharp/pull/2770/commits/28c20ded87e2d81477a08a48e0d3a0717b3c4d5a)`

```
Signed-off-by: antonfirsov <antonfir@gmail.com>
```

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[manual port of 3.1 gif decoder](/SixLabors/ImageSharp/pull/2770/commits/3bf8c572a0d82f18e005bf9882106552218a2c37 "manual port of 3.1 gif decoder")`

`[3bf8c57](/SixLabors/ImageSharp/pull/2770/commits/3bf8c572a0d82f18e005bf9882106552218a2c37)`

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[skip Issue2758_DecodeWorks](/SixLabors/ImageSharp/pull/2770/commits/1f5bf23b9e81f2dbeb51ed54f13cb3da94e67b6f "skip Issue2758_DecodeWorks")`

`[1f5bf23](/SixLabors/ImageSharp/pull/2770/commits/1f5bf23b9e81f2dbeb51ed54f13cb3da94e67b6f)`

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[Issue2012BadMinCode should decode now](/SixLabors/ImageSharp/pull/2770/commits/8ffad3f480ebe8c5b432bb24fe8377096eeb733b "Issue2012BadMinCode should decode now")`

`[8ffad3f](/SixLabors/ImageSharp/pull/2770/commits/8ffad3f480ebe8c5b432bb24fe8377096eeb733b)`

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[Merge branch 'release/2.1.x' into af/backport-2759-2.1.x](/SixLabors/ImageSharp/pull/2770/commits/6b2030b54927b09ed65f782c994d5c9faa7cef27 "Merge branch 'release/2.1.x' into af/backport-2759-2.1.x")`

`[6b2030b](/SixLabors/ImageSharp/pull/2770/commits/6b2030b54927b09ed65f782c994d5c9faa7cef27)`

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov)

`[handle DecodingMode](/SixLabors/ImageSharp/pull/2770/commits/b33d666ab725c8ae14f38c98ee5dfc4645753b16 "handle DecodingMode")`

`[b33d666](/SixLabors/ImageSharp/pull/2770/commits/b33d666ab725c8ae14f38c98ee5dfc4645753b16)`

[![JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=60&v=4)](/JimBobSquarePants)

**[JimBobSquarePants](/JimBobSquarePants)**
approved these changes
[Jul 15, 2024](#pullrequestreview-2177580092)

 [View reviewed changes](/SixLabors/ImageSharp/pull/2770/files/b33d666ab725c8ae14f38c98ee5dfc4645753b16)

Copy link

Member

### @JimBobSquarePants **[JimBobSquarePants](/JimBobSquarePants)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for doing this!

I think incorporating the full decoder was probably wise here. There were likely other critical issues missed over time that should be included.

The jpeg issue in v3.1.x was that the chrominance quality was being determined as zero. This led to the encoder trying to divide by that value. I'm fine with decoder throwing an exception here.

Sorry, something went wrong.

 ðŸ‘
1
 antonfirsov reacted with thumbs up emoji

All reactions

* ðŸ‘
  1 reaction

 Hide details
View details

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
merged commit [`9816ca4`](/SixLabors/ImageSharp/commit/9816ca45016c5d3859986f3c600e8934bc450a56)
into
release/2.1.x

[Jul 15, 2024](https://github.com/SixLabors/ImageSharp/pull/2770#event-13504803888)
14 checks passed

 [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
deleted the
af/backport-2759-2.1.x

branch
[July 15, 2024 12:28](#event-13504804272)

[![@parzivail](https://avatars.githubusercontent.com/u/8730127?s=40&v=4)](/parzivail)
[parzivail](/parzivail)
mentioned this pull request
[Jul 22, 2024](#ref-pullrequest-2423437813)

[Bump SixLabors.ImageSharp from 2.1.8 to 2.1.9 in /ReMarkable.NET
parzivail/ReMarkable.NET#13](/parzivail/ReMarkable.NET/pull/13)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2770)

Reviewers

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants) [JimBobSquarePants](/JimBobSquarePants)

JimBobSquarePants approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=52&v=4)](/antonfirsov) [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=52&v=4)](/JimBobSquarePants)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_e66a97bf_20250111_061804.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2759)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2759)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)

By clicking â€œSign up for GitHubâ€, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). Weâ€™ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# v3.1.x Fix 2758 #2759

 Merged

[JimBobSquarePants](/JimBobSquarePants)
merged 2 commits into
[release/3.1.x](/SixLabors/ImageSharp/tree/release/3.1.x "SixLabors/ImageSharp:release/3.1.x")
from
[js/fix-2758](/SixLabors/ImageSharp/tree/js/fix-2758 "SixLabors/ImageSharp:js/fix-2758")

Jul 7, 2024

 Merged

# [v3.1.x Fix 2758](#top) #2759

[JimBobSquarePants](/JimBobSquarePants)
merged 2 commits into
[release/3.1.x](/SixLabors/ImageSharp/tree/release/3.1.x "SixLabors/ImageSharp:release/3.1.x")
from
[js/fix-2758](/SixLabors/ImageSharp/tree/js/fix-2758 "SixLabors/ImageSharp:js/fix-2758")

Jul 7, 2024

[Conversation
2](/SixLabors/ImageSharp/pull/2759)
[Commits
2](/SixLabors/ImageSharp/pull/2759/commits)
[Checks
21](/SixLabors/ImageSharp/pull/2759/checks)
[Files changed](/SixLabors/ImageSharp/pull/2759/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=60&v=4)](/JimBobSquarePants)

Copy link

Member

### @JimBobSquarePants **[JimBobSquarePants](/JimBobSquarePants)** commented [Jun 27, 2024](#issue-2377236095) â€¢ edited Loading

### Prerequisites

* I have written a descriptive pull-request title
* I have verified that there are no overlapping [pull-requests](https://github.com/SixLabors/ImageSharp/pulls) open
* I have verified that I am following the existing coding patterns and practice as demonstrated in the repository. These follow strict Stylecop rules ðŸ‘®.
* I have provided test coverage for my change (where applicable)

### Description

Fixes [#2758](https://github.com/SixLabors/ImageSharp/issues/2758)

I cannot include the images in the tests as I was unable to open a FileExplorer instance containing them without crashing in my Windows 11 instance.

Still not sure what's going on with the provided repo, but I have added the relevant test images and tests.

Sorry, something went wrong.

All reactions

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
added
[bug](/SixLabors/ImageSharp/labels/bug)
[formats:gif](/SixLabors/ImageSharp/labels/formats%3Agif)
labels
[Jun 27, 2024](#event-13311592858)

 [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
requested review from
[antonfirsov](/antonfirsov),
[tocsoft](/tocsoft),
[dlemstra](/dlemstra) and
[brianpopow](/brianpopow)
[June 27, 2024 06:03](#event-13311594330)

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=80&u=2030f2f34c20a01db52f691505ba3fd467bd08b5&v=4)](/antonfirsov)

Copy link

Member

### **[antonfirsov](/antonfirsov)** commented [Jun 27, 2024](#issuecomment-2194588202)

| Looks like it's breaking other gif use-cases?  I plan to also take a look in the weekend and the add test images. For me File Explorer works on Win11 for the folder. |
| --- |

All reactions

Sorry, something went wrong.

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Decode LZW row by row](/SixLabors/ImageSharp/pull/2759/commits/e4ba5d30d770c24b23cfc8023ffdad2511cb15d1 "Decode LZW row by row")`

`[e4ba5d3](/SixLabors/ImageSharp/pull/2759/commits/e4ba5d30d770c24b23cfc8023ffdad2511cb15d1)`

 [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
[force-pushed](/SixLabors/ImageSharp/compare/5656e712c63b2b4313c4b618b20d97a5513b5a11..e4ba5d30d770c24b23cfc8023ffdad2511cb15d1)
the
js/fix-2758

branch
from
[`5656e71`](/SixLabors/ImageSharp/commit/5656e712c63b2b4313c4b618b20d97a5513b5a11) to
[`e4ba5d3`](/SixLabors/ImageSharp/commit/e4ba5d30d770c24b23cfc8023ffdad2511cb15d1)  [Compare](/SixLabors/ImageSharp/compare/5656e712c63b2b4313c4b618b20d97a5513b5a11..e4ba5d30d770c24b23cfc8023ffdad2511cb15d1)
[June 27, 2024 14:05](#event-13318098078)

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=80&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)

Copy link

Member

Author

### **[JimBobSquarePants](/JimBobSquarePants)** commented [Jun 27, 2024](#issuecomment-2194813977)

| Looks like it's breaking other gif use-cases?  I plan to also take a look in the weekend and the add test images. For me File Explorer works on Win11 for the folder.  [@antonfirsov](https://github.com/antonfirsov) My first attempt was bad as I misunderstood the problem.  I've now refactored the LZW decoder to run row-by-row, so we only allocate enough bytes for a single row rather than the full buffer. In this case this brings down the allocation from 4GB to 64K. This should mean a massive win across the board. |
| --- |

 ðŸ‘
2
 antonfirsov and tiesont reacted with thumbs up emoji

All reactions

* ðŸ‘
  2 reactions

Sorry, something went wrong.

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
mentioned this pull request
[Jun 27, 2024](#ref-issue-2375220705)

[Payloads that caused a DOS attack (GIF / JPEG)
#2758](/SixLabors/ImageSharp/issues/2758)

Closed

4 tasks

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
linked an issue
[Jun 28, 2024](#event-13324981861)
that may be
closed
by this pull request

[Payloads that caused a DOS attack (GIF / JPEG)
#2758](/SixLabors/ImageSharp/issues/2758)

Closed

4 tasks

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Clamp JPEG quality estimation results.](/SixLabors/ImageSharp/pull/2759/commits/fae857fb1cd3f97df9831b9bc06ac2c33f2245b6 "Clamp JPEG quality estimation results.")`

`[fae857f](/SixLabors/ImageSharp/pull/2759/commits/fae857fb1cd3f97df9831b9bc06ac2c33f2245b6)`

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
added
[formats:jpeg](/SixLabors/ImageSharp/labels/formats%3Ajpeg)
[security](/SixLabors/ImageSharp/labels/security)
labels
[Jun 28, 2024](#event-13326347637)

 Hide details
View details

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
merged commit [`b496109`](/SixLabors/ImageSharp/commit/b496109051cc39feee1f6cde48fca6481de17f9a)
into
release/3.1.x

[Jul 7, 2024](https://github.com/SixLabors/ImageSharp/pull/2759#event-13413370174)
22 checks passed

 [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
deleted the
js/fix-2758

branch
[July 7, 2024 06:09](#event-13413370209)

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
mentioned this pull request
[Jul 7, 2024](#ref-pullrequest-2393915364)

[v4 Fix 2758
#2764](/SixLabors/ImageSharp/pull/2764)
 Merged

4 tasks

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
mentioned this pull request
[Jul 31, 2024](#ref-issue-231032168)

[Encoding an animated image requires all frames to be loaded into memory, can lead to OutOfMemoryExceptions
#222](/SixLabors/ImageSharp/issues/222)

Closed

4 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2759)

Reviewers

[![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=40&v=4)](/antonfirsov) [antonfirsov](/antonfirsov)

 Awaiting requested review from antonfirsov

[![@tocsoft](https://avatars.githubusercontent.com/u/166440?s=40&v=4)](/tocsoft) [tocsoft](/tocsoft)

 Awaiting requested review from tocsoft

[![@dlemstra](https://avatars.githubusercontent.com/u/10426229?s=40&v=4)](/dlemstra) [dlemstra](/dlemstra)

 Awaiting requested review from dlemstra

[![@brianpopow](https://avatars.githubusercontent.com/u/38701097?s=40&v=4)](/brianpopow) [brianpopow](/brianpopow)

 Awaiting requested review from brianpopow

Assignees

No one assigned

Labels

[bug](/SixLabors/ImageSharp/labels/bug)
[formats:gif](/SixLabors/ImageSharp/labels/formats%3Agif)
[formats:jpeg](/SixLabors/ImageSharp/labels/formats%3Ajpeg)
[security](/SixLabors/ImageSharp/labels/security)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Payloads that caused a DOS attack (GIF / JPEG)](https://github.com/SixLabors/ImageSharp/issues/2758)

2 participants

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=52&v=4)](/JimBobSquarePants) [![@antonfirsov](https://avatars.githubusercontent.com/u/6835152?s=52&v=4)](/antonfirsov)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_2c895379_20250111_061803.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F9816ca45016c5d3859986f3c600e8934bc450a56)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F9816ca45016c5d3859986f3c600e8934bc450a56)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

## Commit

[Permalink](/SixLabors/ImageSharp/commit/9816ca45016c5d3859986f3c600e8934bc450a56)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2770](https://github.com/SixLabors/ImageSharp/pull/2770) from SixLabors/af/backport-2759-2.1.x

[Browse files](/SixLabors/ImageSharp/tree/9816ca45016c5d3859986f3c600e8934bc450a56)
Browse the repository at this point in the history

```
Backport 2759 to 2.1.x
```

* Loading branch information

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

[JimBobSquarePants](/SixLabors/ImageSharp/commits?author=JimBobSquarePants "View all commits by JimBobSquarePants")
authored
Jul 15, 2024

2 parents
[a1f2879](/SixLabors/ImageSharp/commit/a1f287977139109a987065643b8172c748abdadb)
+
[b33d666](/SixLabors/ImageSharp/commit/b33d666ab725c8ae14f38c98ee5dfc4645753b16)

commit 9816ca4

 Show file tree

 Hide file tree

Showing
**15 changed files**
with
**564 additions**
and
**278 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/ImageSharp/Formats

  + Gif

    - src/ImageSharp/Formats/Gif/GifDecoder.cs
      [GifDecoder.cs](#diff-3a17edb564eef5c46f9ee3c1605488ed94cdf13b817e859e7f35df24ec1d12f3)
    - src/ImageSharp/Formats/Gif/GifDecoderCore.cs
      [GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295)
    - src/ImageSharp/Formats/Gif/GifThrowHelper.cs
      [GifThrowHelper.cs](#diff-c18e7666a94ac095a54b4f499723e4d9b6235e5e3bb0118d31a7dc77dd8c276b)
    - src/ImageSharp/Formats/Gif/IGifDecoderOptions.cs
      [IGifDecoderOptions.cs](#diff-8a7093fcbc2572c5468c04c53f3397db8040d228f3c83ddcc0d26df598ec02c8)
    - src/ImageSharp/Formats/Gif/LzwDecoder.cs
      [LzwDecoder.cs](#diff-cc8ff121332562a85fa55e85ea87a44d94a0771d2fc9c97ac5a0c7e84c485f01)
  + Jpeg/Components

    - src/ImageSharp/Formats/Jpeg/Components/Quantization.cs
      [Quantization.cs](#diff-2fac2ef9245b225438655645008bb0aff0c07c96be2e9e5224aa35ecb89290fc)
* tests

  + ImageSharp.Tests

    - Formats

      * Gif

        + tests/ImageSharp.Tests/Formats/Gif/GifDecoderTests.cs
          [GifDecoderTests.cs](#diff-4bce8fda682fccceec79f799cdf2c93a6c93a4ea4a5d13c3650a8bdff55f617a)
      * Jpg

        + tests/ImageSharp.Tests/Formats/Jpg/JpegDecoderTests.Metadata.cs
          [JpegDecoderTests.Metadata.cs](#diff-e19d31e448b563c880c9b1816f6ae23b569dd928314e88042f4d52c6241d51c4)
    - tests/ImageSharp.Tests/TestImages.cs
      [TestImages.cs](#diff-e03a3dfed3cced318aa98cd8d039c18dba40e090899c4639f922738d7abeaf02)
  + Images

    - External/ReferenceOutput/GifDecoderTests

      * tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png
        [Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png](#diff-aad8bdae828b66c0a22a4a525367e4c4d02a86cbddc5bfedca373e8ed4fc0895)
      * Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/00.png
          [00.png](#diff-706146c0479a9d94d10a109d03cbeb8feb75e2a5a490f0fa60d296a3204b220c)
        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/01.png
          [01.png](#diff-fd8471b867a536a46cd35eac00bc8ee73ee6dee1ce38518c45d0a9ec109b058d)
      * IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif/07.png
          [07.png](#diff-969ed6ef7f7d576ab4748d9fc82ea57dd4770445527935e2d1d7a38939aa7e25)
    - Input

      * Gif/issues

        + tests/Images/Input/Gif/issues/issue\_2758.gif
          [issue\_2758.gif](#diff-2a82e1abd15bd8de7915a8a59ce9edf5f01d84273905d56b28c9f488c2fc4079)
      * Jpg/issues

        + tests/Images/Input/Jpg/issues/issue-2758.jpg
          [issue-2758.jpg](#diff-87bf646572def7fd79ded00a56a2c454e93c9e4d415a18d7fae2163cb54c1c48)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[src/ImageSharp/Formats/Gif/GifDecoder.cs](#diff-3a17edb564eef5c46f9ee3c1605488ed94cdf13b817e859e7f35df24ec1d12f3 "src/ImageSharp/Formats/Gif/GifDecoder.cs")

Show comments

[View file](/SixLabors/ImageSharp/blob/9816ca45016c5d3859986f3c600e8934bc450a56/src/ImageSharp/Formats/Gif/GifDecoder.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,6 +23,11 @@ public sealed class GifDecoder : IImageDecoder, IGifDecoderOptions, IImageInfoDe |
|  |  | /// </summary> |
|  |  | public FrameDecodingMode DecodingMode { get; set; } = FrameDecodingMode.All; |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets the maximum number of gif frames. |
|  |  | /// </summary> |
|  |  | public uint MaxFrames { get; set; } = uint.MaxValue; |
|  |  |  |
|  |  | /// <inheritdoc/> |
|  |  | public Image<TPixel> Decode<TPixel>(Configuration configuration, Stream stream, CancellationToken cancellationToken) |
|  |  | where TPixel : unmanaged, IPixel<TPixel> |
| Expand Down | |  |

465 changes: 284 additions & 181 deletions

465
[src/ImageSharp/Formats/Gif/GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295 "src/ImageSharp/Formats/Gif/GifDecoderCore.cs")

Show comments

Show annotations

[View file](/SixLabors/ImageSharp/blob/9816ca45016c5d3859986f3c600e8934bc450a56/src/ImageSharp/Formats/Gif/GifDecoderCore.cs)
Edit file

Delete file

Load diff

Large diffs are not rendered by default.

Oops, something went wrong.

Retry

7 changes: 7 additions & 0 deletions

7
[src/ImageSharp/Formats/Gif/GifThrowHelper.cs](#diff-c18e7666a94ac095a54b4f499723e4d9b6235e5e3bb0118d31a7dc77dd8c276b "src/ImageSharp/Formats/Gif/GifThrowHelper.cs")

Show comments

[View file](/SixLabors/ImageSharp/blob/9816ca45016c5d3859986f3c600e8934bc450a56/src/ImageSharp/Formats/Gif/GifThrowHelper.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ |
|  |  | // Licensed under the Apache License, Version 2.0. |
|  |  |  |
|  |  | using System; |
|  |  | using System.Diagnostics.CodeAnalysis; |
|  |  | using System.Runtime.CompilerServices; |
|  |  |  |
|  |  | namespace SixLabors.ImageSharp.Formats.Gif |
| Expand All | | @@ -24,5 +25,11 @@ public static void ThrowInvalidImageContentException(string errorMessage) |
|  |  | /// if no inner exception is specified.</param> |
|  |  | [MethodImpl(InliningOptions.ColdPath)] |
|  |  | public static void ThrowInvalidImageContentException(string errorMessage, Exception innerException) => throw new InvalidImageContentException(errorMessage, innerException); |
|  |  |  |
|  |  | [MethodImpl(InliningOptions.ColdPath)] |
|  |  | public static void ThrowNoHeader() => throw new InvalidImageContentException("Gif image does not contain a Logical Screen Descriptor."); |
|  |  |  |
|  |  | [MethodImpl(InliningOptions.ColdPath)] |
|  |  | public static void ThrowNoData() => throw new InvalidImageContentException("Unable to read Gif image data"); |
|  |  | } |
|  |  | } |

5 changes: 5 additions & 0 deletions

5
[src/ImageSharp/Formats/Gif/IGifDecoderOptions.cs](#diff-8a7093fcbc2572c5468c04c53f3397db8040d228f3c83ddcc0d26df598ec02c8 "src/ImageSharp/Formats/Gif/IGifDecoderOptions.cs")

Show comments

[View file](/SixLabors/ImageSharp/blob/9816ca45016c5d3859986f3c600e8934bc450a56/src/ImageSharp/Formats/Gif/IGifDecoderOptions.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,5 +19,10 @@ internal interface IGifDecoderOptions |
|  |  | /// Gets the decoding mode for multi-frame images. |
|  |  | /// </summary> |
|  |  | FrameDecodingMode DecodingMode { get; } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Gets or sets the maximum number of gif frames. |
|  |  | /// </summary> |
|  |  | uint MaxFrames { get; set; } |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9816ca4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2F9816ca45016c5d3859986f3c600e8934bc450a56) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_36ce322b_20250111_061806.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2764)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2764)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)

By clicking â€œSign up for GitHubâ€, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). Weâ€™ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FSixLabors%2FImageSharp%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# v4 Fix 2758 #2764

 Merged

[JimBobSquarePants](/JimBobSquarePants)
merged 4 commits into
[main](/SixLabors/ImageSharp/tree/main "SixLabors/ImageSharp:main")
from
[js/v4-merge-2758-fix](/SixLabors/ImageSharp/tree/js/v4-merge-2758-fix "SixLabors/ImageSharp:js/v4-merge-2758-fix")

Jul 7, 2024

 Merged

# [v4 Fix 2758](#top) #2764

[JimBobSquarePants](/JimBobSquarePants)
merged 4 commits into
[main](/SixLabors/ImageSharp/tree/main "SixLabors/ImageSharp:main")
from
[js/v4-merge-2758-fix](/SixLabors/ImageSharp/tree/js/v4-merge-2758-fix "SixLabors/ImageSharp:js/v4-merge-2758-fix")

Jul 7, 2024

[Conversation
0](/SixLabors/ImageSharp/pull/2764)
[Commits
4](/SixLabors/ImageSharp/pull/2764/commits)
[Checks
20](/SixLabors/ImageSharp/pull/2764/checks)
[Files changed](/SixLabors/ImageSharp/pull/2764/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=60&v=4)](/JimBobSquarePants)

Copy link

Member

### @JimBobSquarePants **[JimBobSquarePants](/JimBobSquarePants)** commented [Jul 7, 2024](#issue-2393915364)

### Prerequisites

* I have written a descriptive pull-request title
* I have verified that there are no overlapping [pull-requests](https://github.com/SixLabors/ImageSharp/pulls) open
* I have verified that I am following the existing coding patterns and practice as demonstrated in the repository. These follow strict Stylecop rules ðŸ‘®.
* I have provided test coverage for my change (where applicable)

### Description

[#2759](https://github.com/SixLabors/ImageSharp/pull/2759) for the V4 branch

Sorry, something went wrong.

All reactions

 [JimBobSquarePants](/JimBobSquarePants)
added 4 commits
[June 28, 2024 00:04](#commits-pushed-e4ba5d3)

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Decode LZW row by row](/SixLabors/ImageSharp/pull/2764/commits/e4ba5d30d770c24b23cfc8023ffdad2511cb15d1 "Decode LZW row by row")`

`[e4ba5d3](/SixLabors/ImageSharp/pull/2764/commits/e4ba5d30d770c24b23cfc8023ffdad2511cb15d1)`

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Clamp JPEG quality estimation results.](/SixLabors/ImageSharp/pull/2764/commits/fae857fb1cd3f97df9831b9bc06ac2c33f2245b6 "Clamp JPEG quality estimation results.")`

`[fae857f](/SixLabors/ImageSharp/pull/2764/commits/fae857fb1cd3f97df9831b9bc06ac2c33f2245b6)`

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Merge pull request](/SixLabors/ImageSharp/pull/2764/commits/b496109051cc39feee1f6cde48fca6481de17f9a "Merge pull request #2759 from SixLabors/js/fix-2758

v3.1.x Fix 2758") [#2759](https://github.com/SixLabors/ImageSharp/pull/2759) [from SixLabors/js/fix-2758](/SixLabors/ImageSharp/pull/2764/commits/b496109051cc39feee1f6cde48fca6481de17f9a "Merge pull request #2759 from SixLabors/js/fix-2758

v3.1.x Fix 2758")`
 â€¦

`[b496109](/SixLabors/ImageSharp/pull/2764/commits/b496109051cc39feee1f6cde48fca6481de17f9a)`

```
v3.1.x Fix 2758
```

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

`[Merge branch 'release/3.1.x' into js/v4-merge-2758-fix](/SixLabors/ImageSharp/pull/2764/commits/00afbe8e258966d390474cc209a707526da919eb "Merge branch 'release/3.1.x' into js/v4-merge-2758-fix")`

`[00afbe8](/SixLabors/ImageSharp/pull/2764/commits/00afbe8e258966d390474cc209a707526da919eb)`

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
added
[bug](/SixLabors/ImageSharp/labels/bug)
[formats:jpeg](/SixLabors/ImageSharp/labels/formats%3Ajpeg)
[formats:gif](/SixLabors/ImageSharp/labels/formats%3Agif)
[security](/SixLabors/ImageSharp/labels/security)
labels
[Jul 7, 2024](#event-13413401258)

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
added this to the [v4.0.0](/SixLabors/ImageSharp/milestone/13) milestone
[Jul 7, 2024](#event-13413401265)

 Hide details
View details

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
merged commit [`59de13c`](/SixLabors/ImageSharp/commit/59de13c8cc47f2b402e2c43aa7024511d029d515)
into
main

[Jul 7, 2024](https://github.com/SixLabors/ImageSharp/pull/2764#event-13413412068)
20 checks passed

 [![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&u=9ba4c7b1cfad18f5028e76ac704dcecbae372d4c&v=4)](/JimBobSquarePants)
[JimBobSquarePants](/JimBobSquarePants)
deleted the
js/v4-merge-2758-fix

branch
[July 7, 2024 06:40](#event-13413412113)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fpull%2F2764)

Reviewers

No reviews

Assignees

No one assigned

Labels

[bug](/SixLabors/ImageSharp/labels/bug)
[formats:gif](/SixLabors/ImageSharp/labels/formats%3Agif)
[formats:jpeg](/SixLabors/ImageSharp/labels/formats%3Ajpeg)
[security](/SixLabors/ImageSharp/labels/security)

Projects

None yet

Milestone

 [**v4.0.0**](/SixLabors/ImageSharp/milestone/13 "v4.0.0")

Development

Successfully merging this pull request may close these issues.

1 participant

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=52&v=4)](/JimBobSquarePants)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_1145dde7_20250111_061807.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fsecurity%2Fadvisories%2FGHSA-qxrv-gp6x-rc23)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fsecurity%2Fadvisories%2FGHSA-qxrv-gp6x-rc23)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

# Excessive Memory Allocation in Gif Decoder

Moderate

[JimBobSquarePants](/JimBobSquarePants)
published
GHSA-qxrv-gp6x-rc23
Jul 22, 2024

## Package

nuget

SixLabors.ImageSharp
([NuGet](/advisories?query=ecosystem%3Anuget))

## Affected versions

< 2.1.9
< 3.1.5

## Patched versions

2.1.9
3.1.5

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

A vulnerability discovered in the ImageSharp library, where the processing of specially crafted files can lead to excessive memory usage in the Gif decoder. The vulnerability is triggered when ImageSharp attempts to process image files that are designed to exploit this flaw.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

The problem has been patched. All users are advised to upgrade to v3.1.5 or v2.1.9.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

Before calling `Image.Decode(Async)`, use `Image.Identify` to determine the image dimensions in order to enforce a limit.

### References

*Are there any links users can visit to find out more?*

* [#2759](https://github.com/SixLabors/ImageSharp/pull/2759)
* [#2764](https://github.com/SixLabors/ImageSharp/pull/2764)
* [#2770](https://github.com/SixLabors/ImageSharp/pull/2770)
* ImageSharp: [Security Considerations](https://docs.sixlabors.com/articles/imagesharp/security.html)
* ImageSharp.Web: [Securing Processing Commands](https://docs.sixlabors.com/articles/imagesharp.web/processingcommands.html#securing-processing-commands)

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L

### CVE ID

CVE-2024-41132

### Weaknesses

[CWE-789](/advisories?query=cwe%3A789)

### Credits

* [![@ErazerBrecht](https://avatars.githubusercontent.com/u/6287467?s=40&v=4)](/ErazerBrecht)
  [ErazerBrecht](/ErazerBrecht)
  Reporter

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_a1698db6_20250111_061804.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2Fb496109051cc39feee1f6cde48fca6481de17f9a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2Fb496109051cc39feee1f6cde48fca6481de17f9a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=SixLabors%2FImageSharp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[SixLabors](/SixLabors)
/
**[ImageSharp](/SixLabors/ImageSharp)**
Public

* [Notifications](/login?return_to=%2FSixLabors%2FImageSharp) You must be signed in to change notification settings
* [Fork
  852](/login?return_to=%2FSixLabors%2FImageSharp)
* [Star
   7.5k](/login?return_to=%2FSixLabors%2FImageSharp)

* [Code](/SixLabors/ImageSharp)
* [Issues
  36](/SixLabors/ImageSharp/issues)
* [Pull requests
  8](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects
  0](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

Additional navigation options

* [Code](/SixLabors/ImageSharp)
* [Issues](/SixLabors/ImageSharp/issues)
* [Pull requests](/SixLabors/ImageSharp/pulls)
* [Discussions](/SixLabors/ImageSharp/discussions)
* [Actions](/SixLabors/ImageSharp/actions)
* [Projects](/SixLabors/ImageSharp/projects)
* [Wiki](/SixLabors/ImageSharp/wiki)
* [Security](/SixLabors/ImageSharp/security)
* [Insights](/SixLabors/ImageSharp/pulse)

## Commit

[Permalink](/SixLabors/ImageSharp/commit/b496109051cc39feee1f6cde48fca6481de17f9a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#2759](https://github.com/SixLabors/ImageSharp/pull/2759) from SixLabors/js/fix-2758

[Browse files](/SixLabors/ImageSharp/tree/b496109051cc39feee1f6cde48fca6481de17f9a)
Browse the repository at this point in the history

```
v3.1.x Fix 2758
```

* Loading branch information

[![@JimBobSquarePants](https://avatars.githubusercontent.com/u/385879?s=40&v=4)](/JimBobSquarePants)

[JimBobSquarePants](/SixLabors/ImageSharp/commits?author=JimBobSquarePants "View all commits by JimBobSquarePants")
authored
Jul 7, 2024

2 parents
[e0d4576](/SixLabors/ImageSharp/commit/e0d4576ff1e791bc12db628a1d03f5529e485ae6)
+
[fae857f](/SixLabors/ImageSharp/commit/fae857fb1cd3f97df9831b9bc06ac2c33f2245b6)

commit b496109

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**298 additions**
and
**290 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src/ImageSharp/Formats

  + Gif

    - src/ImageSharp/Formats/Gif/GifDecoderCore.cs
      [GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295)
    - src/ImageSharp/Formats/Gif/LzwDecoder.cs
      [LzwDecoder.cs](#diff-cc8ff121332562a85fa55e85ea87a44d94a0771d2fc9c97ac5a0c7e84c485f01)
  + Jpeg/Components

    - src/ImageSharp/Formats/Jpeg/Components/Quantization.cs
      [Quantization.cs](#diff-2fac2ef9245b225438655645008bb0aff0c07c96be2e9e5224aa35ecb89290fc)
* tests

  + ImageSharp.Tests

    - Formats

      * Gif

        + tests/ImageSharp.Tests/Formats/Gif/GifDecoderTests.cs
          [GifDecoderTests.cs](#diff-4bce8fda682fccceec79f799cdf2c93a6c93a4ea4a5d13c3650a8bdff55f617a)
      * Jpg

        + tests/ImageSharp.Tests/Formats/Jpg/JpegDecoderTests.Metadata.cs
          [JpegDecoderTests.Metadata.cs](#diff-e19d31e448b563c880c9b1816f6ae23b569dd928314e88042f4d52c6241d51c4)
    - tests/ImageSharp.Tests/TestImages.cs
      [TestImages.cs](#diff-e03a3dfed3cced318aa98cd8d039c18dba40e090899c4639f922738d7abeaf02)
  + Images

    - External/ReferenceOutput/GifDecoderTests

      * tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png
        [Issue2012BadMinCode\_Rgba32\_issue2012\_drona1.png](#diff-aad8bdae828b66c0a22a4a525367e4c4d02a86cbddc5bfedca373e8ed4fc0895)
      * Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/00.png
          [00.png](#diff-706146c0479a9d94d10a109d03cbeb8feb75e2a5a490f0fa60d296a3204b220c)
        + tests/Images/External/ReferenceOutput/GifDecoderTests/Issue2758\_BadDescriptorDimensions\_Rgba32\_issue\_2758.gif/01.png
          [01.png](#diff-fd8471b867a536a46cd35eac00bc8ee73ee6dee1ce38518c45d0a9ec109b058d)
      * IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif

        + tests/Images/External/ReferenceOutput/GifDecoderTests/IssueTooLargeLzwBits\_Rgba32\_issue\_2743.gif/07.png
          [07.png](#diff-969ed6ef7f7d576ab4748d9fc82ea57dd4770445527935e2d1d7a38939aa7e25)
    - Input

      * Gif/issues

        + tests/Images/Input/Gif/issues/issue\_2758.gif
          [issue\_2758.gif](#diff-2a82e1abd15bd8de7915a8a59ce9edf5f01d84273905d56b28c9f488c2fc4079)
      * Jpg/issues

        + tests/Images/Input/Jpg/issues/issue-2758.jpg
          [issue-2758.jpg](#diff-87bf646572def7fd79ded00a56a2c454e93c9e4d415a18d7fae2163cb54c1c48)

## There are no files selected for viewing

196 changes: 95 additions & 101 deletions

196
[src/ImageSharp/Formats/Gif/GifDecoderCore.cs](#diff-133c57ab6987fbc0cae0f5447a3ab4cb617c62cd507960e4dd99219a67b2a295 "src/ImageSharp/Formats/Gif/GifDecoderCore.cs")

Show comments

[View file](/SixLabors/ImageSharp/blob/b496109051cc39feee1f6cde48fca6481de17f9a/src/ImageSharp/Formats/Gif/GifDecoderCore.cs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -427,68 +427,49 @@ private void ReadFrame<TPixel>(BufferedReadStream stream, ref Image<TPixel>? ima |
|  |  | { |
|  |  | this.ReadImageDescriptor(stream); |
|  |  |  |
|  |  | Buffer2D<byte>? indices = null; |
|  |  | try |
|  |  | { |
|  |  | // Determine the color table for this frame. If there is a local one, use it otherwise use the global color table. |
|  |  | bool hasLocalColorTable = this.imageDescriptor.LocalColorTableFlag; |
|  |  |  |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | // Read and store the local color table. We allocate the maximum possible size and slice to match. |
|  |  | int length = this.currentLocalColorTableSize = this.imageDescriptor.LocalColorTableSize \* 3; |
|  |  | this.currentLocalColorTable ??= this.configuration.MemoryAllocator.Allocate<byte>(768, AllocationOptions.Clean); |
|  |  | stream.Read(this.currentLocalColorTable.GetSpan()[..length]); |
|  |  | } |
|  |  |  |
|  |  | indices = this.configuration.MemoryAllocator.Allocate2D<byte>(this.imageDescriptor.Width, this.imageDescriptor.Height, AllocationOptions.Clean); |
|  |  | this.ReadFrameIndices(stream, indices); |
|  |  | // Determine the color table for this frame. If there is a local one, use it otherwise use the global color table. |
|  |  | bool hasLocalColorTable = this.imageDescriptor.LocalColorTableFlag; |
|  |  |  |
|  |  | Span<byte> rawColorTable = default; |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | rawColorTable = this.currentLocalColorTable!.GetSpan()[..this.currentLocalColorTableSize]; |
|  |  | } |
|  |  | else if (this.globalColorTable != null) |
|  |  | { |
|  |  | rawColorTable = this.globalColorTable.GetSpan(); |
|  |  | } |
|  |  |  |
|  |  | ReadOnlySpan<Rgb24> colorTable = MemoryMarshal.Cast<byte, Rgb24>(rawColorTable); |
|  |  | this.ReadFrameColors(ref image, ref previousFrame, indices, colorTable, this.imageDescriptor); |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | // Read and store the local color table. We allocate the maximum possible size and slice to match. |
|  |  | int length = this.currentLocalColorTableSize = this.imageDescriptor.LocalColorTableSize \* 3; |
|  |  | this.currentLocalColorTable ??= this.configuration.MemoryAllocator.Allocate<byte>(768, AllocationOptions.Clean); |
|  |  | stream.Read(this.currentLocalColorTable.GetSpan()[..length]); |
|  |  | } |
|  |  |  |
|  |  | // Skip any remaining blocks |
|  |  | SkipBlock(stream); |
|  |  | Span<byte> rawColorTable = default; |
|  |  | if (hasLocalColorTable) |
|  |  | { |
|  |  | rawColorTable = this.currentLocalColorTable!.GetSpan()[..this.currentLocalColorTableSize]; |
|  |  | } |
|  |  | finally |
|  |  | else if (this.globalColorTable != null) |
|  |  | { |
|  |  | indices?.Dispose(); |
|  |  | rawColorTable = this.globalColorTable.GetSpan(); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Reads the frame indices marking the color to use for each pixel. |
|  |  | /// </summary> |
|  |  | /// <param name="stream">The <see cref="BufferedReadStream"/> containing image data.</param> |
|  |  | /// <param name="indices">The 2D pixel buffer to write to.</param> |
|  |  | [MethodImpl(MethodImplOptions.AggressiveInlining)] |
|  |  | private void ReadFrameIndices(BufferedReadStream stream, Buffer2D<byte> indices) |
|  |  | { |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream); |
|  |  | lzwDecoder.DecodePixels(minCodeSize, indices); |
|  |  | ReadOnlySpan<Rgb24> colorTable = MemoryMarshal.Cast<byte, Rgb24>(rawColorTable); |
|  |  | this.ReadFrameColors(stream, ref image, ref previousFrame, colorTable, this.imageDescriptor); |
|  |  |  |
|  |  | // Skip any remaining blocks |
|  |  | SkipBlock(stream); |
|  |  | } |
|  |  |  |
|  |  | /// <summary> |
|  |  | /// Reads the frames colors, mapping indices to colors. |
|  |  | /// </summary> |
|  |  | /// <typeparam name="TPixel">The pixel format.</typeparam> |
|  |  | /// <param name="stream">The <see cref="BufferedReadStream"/> containing image data.</param> |
|  |  | /// <param name="image">The image to decode the information to.</param> |
|  |  | /// <param name="previousFrame">The previous frame.</param> |
|  |  | /// <param name="indices">The indexed pixels.</param> |
|  |  | /// <param name="colorTable">The color table containing the available colors.</param> |
|  |  | /// <param name="descriptor">The <see cref="GifImageDescriptor"/></param> |
|  |  | private void ReadFrameColors<TPixel>(ref Image<TPixel>? image, ref ImageFrame<TPixel>? previousFrame, Buffer2D<byte> indices, ReadOnlySpan<Rgb24> colorTable, in GifImageDescriptor descriptor) |
|  |  | private void ReadFrameColors<TPixel>( |
|  |  | BufferedReadStream stream, |
|  |  | ref Image<TPixel>? image, |
|  |  | ref ImageFrame<TPixel>? previousFrame, |
|  |  | ReadOnlySpan<Rgb24> colorTable, |
|  |  | in GifImageDescriptor descriptor) |
|  |  | where TPixel : unmanaged, IPixel<TPixel> |
|  |  | { |
|  |  | int imageWidth = this.logicalScreenDescriptor.Width; |
| Expand Down  Expand Up | | @@ -549,73 +530,83 @@ private void ReadFrameColors<TPixel>(ref Image<TPixel>? image, ref ImageFrame<TP |
|  |  | byte transIndex = this.graphicsControlExtension.TransparencyIndex; |
|  |  | int colorTableMaxIdx = colorTable.Length - 1; |
|  |  |  |
|  |  | for (int y = descriptorTop; y < descriptorBottom && y < imageHeight; y++) |
|  |  | // For a properly encoded gif the descriptor dimensions will never exceed the logical screen dimensions. |
|  |  | // However we have images that exceed this that can be decoded by other libraries. #1530 |
|  |  | using IMemoryOwner<byte> indicesRowOwner = this.memoryAllocator.Allocate<byte>(descriptor.Width); |
|  |  | Span<byte> indicesRow = indicesRowOwner.Memory.Span; |
|  |  | ref byte indicesRowRef = ref MemoryMarshal.GetReference(indicesRow); |
|  |  |  |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | if (LzwDecoder.IsValidMinCodeSize(minCodeSize)) |
|  |  | { |
|  |  | ref byte indicesRowRef = ref MemoryMarshal.GetReference(indices.DangerousGetRowSpan(y - descriptorTop)); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream, minCodeSize); |
|  |  |  |
|  |  | // Check if this image is interlaced. |
|  |  | int writeY; // the target y offset to write to |
|  |  | if (descriptor.InterlaceFlag) |
|  |  | for (int y = descriptorTop; y < descriptorBottom && y < imageHeight; y++) |
|  |  | { |
|  |  | // If so then we read lines at predetermined offsets. |
|  |  | // When an entire image height worth of offset lines has been read we consider this a pass. |
|  |  | // With each pass the number of offset lines changes and the starting line changes. |
|  |  | if (interlaceY >= descriptor.Height) |
|  |  | // Check if this image is interlaced. |
|  |  | int writeY; // the target y offset to write to |
|  |  | if (descriptor.InterlaceFlag) |
|  |  | { |
|  |  | interlacePass++; |
|  |  | switch (interlacePass) |
|  |  | // If so then we read lines at predetermined offsets. |
|  |  | // When an entire image height worth of offset lines has been read we consider this a pass. |
|  |  | // With each pass the number of offset lines changes and the starting line changes. |
|  |  | if (interlaceY >= descriptor.Height) |
|  |  | { |
|  |  | case 1: |
|  |  | interlaceY = 4; |
|  |  | break; |
|  |  | case 2: |
|  |  | interlaceY = 2; |
|  |  | interlaceIncrement = 4; |
|  |  | break; |
|  |  | case 3: |
|  |  | interlaceY = 1; |
|  |  | interlaceIncrement = 2; |
|  |  | break; |
|  |  | interlacePass++; |
|  |  | switch (interlacePass) |
|  |  | { |
|  |  | case 1: |
|  |  | interlaceY = 4; |
|  |  | break; |
|  |  | case 2: |
|  |  | interlaceY = 2; |
|  |  | interlaceIncrement = 4; |
|  |  | break; |
|  |  | case 3: |
|  |  | interlaceY = 1; |
|  |  | interlaceIncrement = 2; |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | writeY = interlaceY + descriptor.Top; |
|  |  | interlaceY += interlaceIncrement; |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | writeY = y; |
|  |  | } |
|  |  | writeY = Math.Min(interlaceY + descriptor.Top, image.Height); |
|  |  | interlaceY += interlaceIncrement; |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | writeY = y; |
|  |  | } |
|  |  |  |
|  |  | ref TPixel rowRef = ref MemoryMarshal.GetReference(imageFrame.PixelBuffer.DangerousGetRowSpan(writeY)); |
|  |  | lzwDecoder.DecodePixelRow(indicesRow); |
|  |  | ref TPixel rowRef = ref MemoryMarshal.GetReference(imageFrame.PixelBuffer.DangerousGetRowSpan(writeY)); |
|  |  |  |
|  |  | if (!transFlag) |
|  |  | { |
|  |  | // #403 The left + width value can be larger than the image width |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | if (!transFlag) |
|  |  | { |
|  |  | int index = Numerics.Clamp(Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)), 0, colorTableMaxIdx); |
|  |  | ref TPixel pixel = ref Unsafe.Add(ref rowRef, (uint)x); |
|  |  | Rgb24 rgb = colorTable[index]; |
|  |  | pixel.FromRgb24(rgb); |
|  |  | // #403 The left + width value can be larger than the image width |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | { |
|  |  | int index = Numerics.Clamp(Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)), 0, colorTableMaxIdx); |
|  |  | ref TPixel pixel = ref Unsafe.Add(ref rowRef, (uint)x); |
|  |  | Rgb24 rgb = colorTable[index]; |
|  |  | pixel.FromRgb24(rgb); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | else |
|  |  | { |
|  |  | int rawIndex = Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)); |
|  |  |  |
|  |  | // Treat any out of bounds values as transparent. |
|  |  | if (rawIndex > colorTableMaxIdx || rawIndex == transIndex) |
|  |  | for (int x = descriptorLeft; x < descriptorRight && x < imageWidth; x++) |
|  |  | { |
|  |  | continue; |
|  |  | } |
|  |  | int index = Unsafe.Add(ref indicesRowRef, (uint)(x - descriptorLeft)); |
|  |  |  |
|  |  | // Treat any out of bounds values as transparent. |
|  |  | if (index > colorTableMaxIdx || index == transIndex) |
|  |  | { |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | int index = Numerics.Clamp(rawIndex, 0, colorTableMaxIdx); |
|  |  | ref TPixel pixel = ref Unsafe.Add(ref rowRef, (uint)x); |
|  |  | Rgb24 rgb = colorTable[index]; |
|  |  | pixel.FromRgb24(rgb); |
|  |  | ref TPixel pixel = ref Unsafe.Add(ref rowRef, (uint)x); |
|  |  | Rgb24 rgb = colorTable[index]; |
|  |  | pixel.FromRgb24(rgb); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -656,8 +647,11 @@ private void ReadFrameMetadata(BufferedReadStream stream, List<ImageFrameMetadat |
|  |  | // Skip the frame indices. Pixels length + mincode size. |
|  |  | // The gif format does not tell us the length of the compressed data beforehand. |
|  |  | int minCodeSize = stream.ReadByte(); |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream); |
|  |  | lzwDecoder.SkipIndices(minCodeSize, this.imageDescriptor.Width \* this.imageDescriptor.Height); |
|  |  | if (LzwDecoder.IsValidMinCodeSize(minCodeSize)) |
|  |  | { |
|  |  | using LzwDecoder lzwDecoder = new(this.configuration.MemoryAllocator, stream, minCodeSize); |
|  |  | lzwDecoder.SkipIndices(this.imageDescriptor.Width \* this.imageDescriptor.Height); |
|  |  | } |
|  |  |  |
|  |  | ImageFrameMetadata currentFrame = new(); |
|  |  | frameMetadata.Add(currentFrame); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b496109`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FSixLabors%2FImageSharp%2Fcommit%2Fb496109051cc39feee1f6cde48fca6481de17f9a) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


