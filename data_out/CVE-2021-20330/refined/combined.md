=== Content from jira.mongodb.org_9936e083_20250110_195241.html ===


[Log in](/login.jsp?os_destination=%2Fbrowse%2FSERVER-36263)[Skip to main content](#main)[Skip to sidebar](#sidebar)[![MongoDB Jira](/s/ub562g/9160001/fy41z4/_/jira-logo-scaled.png)](https://jira.mongodb.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")
* [eazyBI](/plugins/servlet/eazybi)

* Give feedback to Atlassian
* [Help](/secure/ViewKeyboardShortcuts%21default.jspa "Help")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FSERVER-36263)
  + [Acknowledged notifications](/plugins/servlet/wittified/profile/notifications)

![Uploaded image for project: 'Core Server'](https://jira.mongodb.org/secure/projectavatar?pid=10000&avatarId=13900)

1. [Core Server](/browse/SERVER)
2. [SERVER-36263](/browse/SERVER-36263)

## Bypassing operation validation in applyOps should require special privilege

Schedule Issue[Undo Transition](/secure/UndoTransition%21default.jspa?id=575778)ClosedExportnullXMLWordPrintableJSON
### Details

* **Type:**
  ![Icon: Improvement](/secure/viewavatar?size=xsmall&avatarId=14710&avatarType=issuetype "Improvement - An improvement or enhancement to an existing feature or task.") Improvement
* **Resolution:**
  Fixed
* **Priority:**
  ![Icon: Major - P3](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.") Major - P3
* **Fix Version/s:**
  [4.9.0](/issues/?jql=project+%3D+SERVER+AND+fixVersion+%3D+4.9.0 "4.9.0 "), [4.2.16](/issues/?jql=project+%3D+SERVER+AND+fixVersion+%3D+4.2.16 "4.2.16 "), [4.0.27](/issues/?jql=project+%3D+SERVER+AND+fixVersion+%3D+4.0.27 "4.0.27 "), [4.4.9](/issues/?jql=project+%3D+SERVER+AND+fixVersion+%3D+4.4.9 "4.4.9 ")
* **Affects Version/s:**
  None
* **Component/s:**
  [Replication](/issues/?jql=project+%3D+SERVER+AND+component+%3D+Replication "Replication "), [Security](/issues/?jql=project+%3D+SERVER+AND+component+%3D+Security "Security ")
* **Labels:**
  + [former-quick-wins](/issues/?jql=labels+%3D+former-quick-wins "former-quick-wins")
  + [nyc](/issues/?jql=labels+%3D+nyc "nyc")

* **Backwards Compatibility:**
  Major Change
* **Backport Requested:**
  v4.4, v4.2, v4.0
* **Sprint:**
  Repl 2021-03-08, Repl 2021-03-22

### Description

**CVE-2021-20330**

**Title**

Specific replication command with malformed oplog entries can crash secondaries

**CVE ID**

CVE-2021-20330

**Description**

An attacker with basic CRUD permissions on a replicated collection can run the applyOps command with specially malformed oplog entries, resulting in a potential denial of service on secondaries.

This issue affects MongoDB Server v4.0 versions prior to 4.0.27; MongoDB Server v4.2 versions prior to 4.2.16; MongoDB Server v4.4 versions prior to 4.4.9.

**CVSS score**

This issue's CVSS:3.1 severity is scored at 6.5 using the following scoring metrics:

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H

**Affected versions**

MongoDB Server v4.0 versions prior to 4.0.27;

MongoDB Server v4.2 versions prior to 4.2.16;

MongoDB Server v4.4 versions prior to 4.4.9.

**CWE**

CWE-20 Improper Input Validation

**Underlying operating systems affected**

ALL

As of [~~SERVER-25994~~](https://jira.mongodb.org/browse/SERVER-25994 "Allow applyOps to validate authorization permissions at the operation level "), a user can run applyOps if they have the privileges to perform each individual operation specified in the the applyOps command. However, applyOps is more powerful than other commands in that it avoids certain input validation (see [SERVER-27096](https://jira.mongodb.org/browse/SERVER-27096 "applyOps should validate its ops to ensure idempotency"), [SERVER-32941](https://jira.mongodb.org/browse/SERVER-32941 "applyOps command inserts documents without ever calling fixDocumentForInsert()"), [SERVER-32952](https://jira.mongodb.org/browse/SERVER-32952 "applyOps does not validate updates"), and [SERVER-32305](https://jira.mongodb.org/browse/SERVER-32305 "Able to create document with array as _id using applyOps")). This is done intentionally, since applyOps is supposed to behave similarly to oplog application, where the primary does all validation and the secondary applies the changes exactly as the primary specified without validation. This feature is important to products that mimic oplog application, such as mongomirror and mongorestore. However, users should not be able to bypass validation simply because they have permission to write to a collection. Instead, applyOps should require a special privilege for bypassing validation.

We will create a new privilege bypassing system-level invariants in applyOps. Today, this privilege will be required in order to run applyOps at all, since we have not implemented a version of applyOps that performs validation. The privilege will be included in dbAdminAnyDatabase, which is included in the custom role atlasAdmin and the temporary user that we create for Live Imports (mongomirror).

### Attachments

### Issue Links

is related to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[SERVER-32952](/browse/SERVER-32952)
applyOps does not validate updates

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Backlog

![Task - A task that needs to be done.](/secure/viewavatar?size=xsmall&avatarId=14718&avatarType=issuetype "Task - A task that needs to be done.")
[SERVER-33326](/browse/SERVER-33326)
Remove use of applyOps/doTxn from sharding chunk operations

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

![Improvement - An improvement or enhancement to an existing feature or task.](/secure/viewavatar?size=xsmall&avatarId=14710&avatarType=issuetype "Improvement - An improvement or enhancement to an existing feature or task.")
[SERVER-25994](/browse/SERVER-25994)
Allow applyOps to validate authorization permissions at the operation level

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

related to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[SERVER-50381](/browse/SERVER-50381)
3 way deadlock between applyOps cmd, prepared transaction and secondary oplog fetcher initiated find command

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[SERVER-53674](/browse/SERVER-53674)
Do not run applyOps commands in the fuzzer

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[SERVER-58247](/browse/SERVER-58247)
Using createIndexes in applyOps with the oplog application mode set on primary should uassert, not fassert

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=14703&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[SERVER-66651](/browse/SERVER-66651)
Role "restore" not sufficient for `mongorestore --preserveUUID`

* ![Major - P3 - Major loss of function.](/images/icons/priorities/major.svg "Major - P3 - Major loss of function.")
* Closed

Show 2 more links (2 related to)

### Activity

### People

Assignee:
![m.maher@mongodb.com](https://jira.mongodb.org/secure/useravatar?size=small&avatarId=10122)
Moustafa Maher

Reporter:
![tess.avitabile@mongodb.com](https://jira.mongodb.org/secure/useravatar?size=small&avatarId=10122)
Tess Avitabile (Inactive)

Participants:

[Eric Milkie](/secure/IssueNavigator.jspa?reset=true&customfield_10051=milkie%40mongodb.com "Find all issues Eric Milkie participated in"), [Githook User](/secure/IssueNavigator.jspa?reset=true&customfield_10051=xgen-internal-githook "Find all issues Githook User participated in"), [Ian Whalen](/secure/IssueNavigator.jspa?reset=true&customfield_10051=ian%40mongodb.com "Find all issues Ian Whalen participated in"), [Judah Schvimer](/secure/IssueNavigator.jspa?reset=true&customfield_10051=judah.schvimer%40mongodb.com "Find all issues Judah Schvimer participated in"), [Moustafa Maher](/secure/IssueNavigator.jspa?reset=true&customfield_10051=m.maher%40mongodb.com "Find all issues Moustafa Maher participated in"), [Spencer Jackson](/secure/IssueNavigator.jspa?reset=true&customfield_10051=spencer.jackson%40mongodb.com "Find all issues Spencer Jackson participated in"), [Tess Avitabile](/secure/IssueNavigator.jspa?reset=true&customfield_10051=tess.avitabile%40mongodb.com "Find all issues Tess Avitabile participated in"), [Tim Fogarty](/secure/IssueNavigator.jspa?reset=true&customfield_10051=tim.fogarty%40mongodb.com "Find all issues Tim Fogarty participated in"), [Xian Wei Zhang](/secure/IssueNavigator.jspa?reset=true&customfield_10051=xwzhang%40cn.ibm.com "Find all issues Xian Wei Zhang participated in")

Votes:
0
Vote for this issue

Watchers:
16
Start watching this issue

### Dates

Created:

Jul 24 2018 09:36:07 PM UTC

Updated:

Oct 29 2023 10:29:36 PM UTC

Resolved:

Mar 10 2021 04:08:37 PM UTC

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for MongoDB. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)


