

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Maciej Żenczykowski <maze@google.com> | 2021-06-07 21:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-16 11:53:03 +0200 |
| commit | [8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)) | |
| tree | [94db51effc334eaaf478fc3076793aecef1d09c7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | |
| parent | [29f13b2f28a6ab721aadb126878ed842ce278462](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=29f13b2f28a6ab721aadb126878ed842ce278462) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee&id2=29f13b2f28a6ab721aadb126878ed842ce278462)) | |
| download | [linux-8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee.tar.gz) | |

usb: fix various gadgets null ptr deref on 10gbps cabling.commit 90c4d05780d47e14a50e11a7f17373104cd47d25 upstream.
This avoids a null pointer dereference in
f\_{ecm,eem,hid,loopback,printer,rndis,serial,sourcesink,subset,tcm}
by simply reusing the 5gbps config for 10gbps.
Fixes: eaef50c76057 ("usb: gadget: Update usb\_assign\_descriptors for SuperSpeedPlus")
Cc: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Cc: Felipe Balbi <balbi@kernel.org>
Cc: Gustavo A. R. Silva <gustavoars@kernel.org>
Cc: Lorenzo Colitti <lorenzo@google.com>
Cc: Martin K. Petersen <martin.petersen@oracle.com>
Cc: Michael R Sweet <msweet@msweet.org>
Cc: Mike Christie <michael.christie@oracle.com>
Cc: Pawel Laszczak <pawell@cadence.com>
Cc: Peter Chen <peter.chen@nxp.com>
Cc: Sudhakar Panneerselvam <sudhakar.panneerselvam@oracle.com>
Cc: Wei Ming Chen <jj251510319013@gmail.com>
Cc: Will McVicker <willmcvicker@google.com>
Cc: Zqiang <qiang.zhang@windriver.com>
Reviewed-By: Lorenzo Colitti <lorenzo@google.com>
Cc: stable <stable@vger.kernel.org>
Signed-off-by: Maciej Żenczykowski <maze@google.com>
Link: [https://lore.kernel.org/r/20210608044141.3898496-1-zenczykowski@gmail.com](https://lore.kernel.org/r/20210608044141.3898496-1-zenczykowski%40gmail.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)

| -rw-r--r-- | [drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_ecm.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_eem.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_hid.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_loopback.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_printer.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_rndis.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_serial.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_sourcesink.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_subset.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_tcm.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee) | 3 | |  |  |  | | --- | --- | --- | |

10 files changed, 14 insertions, 10 deletions

| diff --git a/drivers/usb/gadget/function/f\_ecm.c b/drivers/usb/gadget/function/f\_ecm.cindex 8e3e443827854b..5bd80cb3635ce7 100644--- a/[drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_ecm.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_ecm.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -793,7 +793,7 @@ ecm\_bind(struct usb\_configuration \*c, struct usb\_function \*f) fs\_ecm\_notify\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, ecm\_fs\_function, ecm\_hs\_function,- ecm\_ss\_function, NULL);+ ecm\_ss\_function, ecm\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_eem.c b/drivers/usb/gadget/function/f\_eem.cindex 937038d3c97243..5abc27f12a418e 100644--- a/[drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_eem.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_eem.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -309,7 +309,7 @@ static int eem\_bind(struct usb\_configuration \*c, struct usb\_function \*f) eem\_ss\_out\_desc.bEndpointAddress = eem\_fs\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, eem\_fs\_function, eem\_hs\_function,- eem\_ss\_function, NULL);+ eem\_ss\_function, eem\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_hid.c b/drivers/usb/gadget/function/f\_hid.cindex 63f6e344d5b01d..77d1183775efc6 100644--- a/[drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_hid.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_hid.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -812,7 +812,8 @@ static int hidg\_bind(struct usb\_configuration \*c, struct usb\_function \*f) hidg\_fs\_out\_ep\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, hidg\_fs\_descriptors,- hidg\_hs\_descriptors, hidg\_ss\_descriptors, NULL);+ hidg\_hs\_descriptors, hidg\_ss\_descriptors,+ hidg\_ss\_descriptors); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_loopback.c b/drivers/usb/gadget/function/f\_loopback.cindex e70093835e14a2..8c1810d655983c 100644--- a/[drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_loopback.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_loopback.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -211,7 +211,7 @@ autoconf\_fail: ss\_loop\_sink\_desc.bEndpointAddress = fs\_loop\_sink\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_loopback\_descs, hs\_loopback\_descs,- ss\_loopback\_descs, NULL);+ ss\_loopback\_descs, ss\_loopback\_descs); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_printer.c b/drivers/usb/gadget/function/f\_printer.cindex fd2409d102d0e8..4e0afeabe8b8bd 100644--- a/[drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_printer.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_printer.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -1067,7 +1067,8 @@ autoconf\_fail: ss\_ep\_out\_desc.bEndpointAddress = fs\_ep\_out\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_printer\_function,- hs\_printer\_function, ss\_printer\_function, NULL);+ hs\_printer\_function, ss\_printer\_function,+ ss\_printer\_function); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_rndis.c b/drivers/usb/gadget/function/f\_rndis.cindex b35c1d27dc52b6..2a43c6395098f3 100644--- a/[drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_rndis.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_rndis.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -793,7 +793,7 @@ rndis\_bind(struct usb\_configuration \*c, struct usb\_function \*f) ss\_notify\_desc.bEndpointAddress = fs\_notify\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, eth\_fs\_function, eth\_hs\_function,- eth\_ss\_function, NULL);+ eth\_ss\_function, eth\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_serial.c b/drivers/usb/gadget/function/f\_serial.cindex cb00ada21d9c25..e1efb69c80badf 100644--- a/[drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_serial.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_serial.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -236,7 +236,7 @@ static int gser\_bind(struct usb\_configuration \*c, struct usb\_function \*f) gser\_ss\_out\_desc.bEndpointAddress = gser\_fs\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, gser\_fs\_function, gser\_hs\_function,- gser\_ss\_function, NULL);+ gser\_ss\_function, gser\_ss\_function); if (status) goto fail; dev\_dbg(&cdev->gadget->dev, "generic ttyGS%d: %s speed IN/%s OUT/%s\n",diff --git a/drivers/usb/gadget/function/f\_sourcesink.c b/drivers/usb/gadget/function/f\_sourcesink.cindex 6e9d958004a0db..1c5745f7abea18 100644--- a/[drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_sourcesink.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_sourcesink.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -435,7 +435,8 @@ no\_iso: ss\_iso\_sink\_desc.bEndpointAddress = fs\_iso\_sink\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_source\_sink\_descs,- hs\_source\_sink\_descs, ss\_source\_sink\_descs, NULL);+ hs\_source\_sink\_descs, ss\_source\_sink\_descs,+ ss\_source\_sink\_descs); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_subset.c b/drivers/usb/gadget/function/f\_subset.cindex 434b983f3b4c24..055bd0706cdd06 100644--- a/[drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_subset.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_subset.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -362,7 +362,7 @@ geth\_bind(struct usb\_configuration \*c, struct usb\_function \*f) fs\_subset\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, fs\_eth\_function, hs\_eth\_function,- ss\_eth\_function, NULL);+ ss\_eth\_function, ss\_eth\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_tcm.c b/drivers/usb/gadget/function/f\_tcm.cindex c41d09166a1d6d..864ed249ff8cf4 100644--- a/[drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_tcm.c?id=29f13b2f28a6ab721aadb126878ed842ce278462)+++ b/[drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_tcm.c?id=8cd5f45c1b769e3e9e0f4325dd08b6c3749dc7ee)@@ -2071,7 +2071,8 @@ static int tcm\_bind(struct usb\_configuration \*c, struct usb\_function \*f) uasp\_fs\_cmd\_desc.bEndpointAddress = uasp\_ss\_cmd\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, uasp\_fs\_function\_desc,- uasp\_hs\_function\_desc, uasp\_ss\_function\_desc, NULL);+ uasp\_hs\_function\_desc, uasp\_ss\_function\_desc,+ uasp\_ss\_function\_desc); if (ret) goto ep\_fail; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:59:05 +0000

