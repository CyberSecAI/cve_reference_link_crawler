

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Maciej Żenczykowski <maze@google.com> | 2021-06-07 21:41:41 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-16 12:01:42 +0200 |
| commit | [4b289a0f3033f465b4fd51ba995251a7867a2aa2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)) | |
| tree | [b241b6074559f0cc0e3e5ddb712f7d87079732d0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | |
| parent | [6bf8ff7d05204f0ec1842016280fedc00dd6b4d1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2&id2=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)) | |
| download | [linux-4b289a0f3033f465b4fd51ba995251a7867a2aa2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4b289a0f3033f465b4fd51ba995251a7867a2aa2.tar.gz) | |

usb: fix various gadgets null ptr deref on 10gbps cabling.commit 90c4d05780d47e14a50e11a7f17373104cd47d25 upstream.
This avoids a null pointer dereference in
f\_{ecm,eem,hid,loopback,printer,rndis,serial,sourcesink,subset,tcm}
by simply reusing the 5gbps config for 10gbps.
Fixes: eaef50c76057 ("usb: gadget: Update usb\_assign\_descriptors for SuperSpeedPlus")
Cc: Christophe JAILLET <christophe.jaillet@wanadoo.fr>
Cc: Felipe Balbi <balbi@kernel.org>
Cc: Gustavo A. R. Silva <gustavoars@kernel.org>
Cc: Lorenzo Colitti <lorenzo@google.com>
Cc: Martin K. Petersen <martin.petersen@oracle.com>
Cc: Michael R Sweet <msweet@msweet.org>
Cc: Mike Christie <michael.christie@oracle.com>
Cc: Pawel Laszczak <pawell@cadence.com>
Cc: Peter Chen <peter.chen@nxp.com>
Cc: Sudhakar Panneerselvam <sudhakar.panneerselvam@oracle.com>
Cc: Wei Ming Chen <jj251510319013@gmail.com>
Cc: Will McVicker <willmcvicker@google.com>
Cc: Zqiang <qiang.zhang@windriver.com>
Reviewed-By: Lorenzo Colitti <lorenzo@google.com>
Cc: stable <stable@vger.kernel.org>
Signed-off-by: Maciej Żenczykowski <maze@google.com>
Link: [https://lore.kernel.org/r/20210608044141.3898496-1-zenczykowski@gmail.com](https://lore.kernel.org/r/20210608044141.3898496-1-zenczykowski%40gmail.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)

| -rw-r--r-- | [drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_ecm.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_eem.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_hid.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_loopback.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_printer.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_rndis.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_serial.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_sourcesink.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_subset.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/f_tcm.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2) | 3 | |  |  |  | | --- | --- | --- | |

10 files changed, 14 insertions, 10 deletions

| diff --git a/drivers/usb/gadget/function/f\_ecm.c b/drivers/usb/gadget/function/f\_ecm.cindex 7f5cf488b2b1ed..ffe2486fce71c9 100644--- a/[drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_ecm.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_ecm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_ecm.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -791,7 +791,7 @@ ecm\_bind(struct usb\_configuration \*c, struct usb\_function \*f) fs\_ecm\_notify\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, ecm\_fs\_function, ecm\_hs\_function,- ecm\_ss\_function, NULL);+ ecm\_ss\_function, ecm\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_eem.c b/drivers/usb/gadget/function/f\_eem.cindex 28dd5f1fd10613..2cd9942707b46a 100644--- a/[drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_eem.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_eem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_eem.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -302,7 +302,7 @@ static int eem\_bind(struct usb\_configuration \*c, struct usb\_function \*f) eem\_ss\_out\_desc.bEndpointAddress = eem\_fs\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, eem\_fs\_function, eem\_hs\_function,- eem\_ss\_function, NULL);+ eem\_ss\_function, eem\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_hid.c b/drivers/usb/gadget/function/f\_hid.cindex 1125f4715830de..e556993081170f 100644--- a/[drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_hid.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_hid.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_hid.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -802,7 +802,8 @@ static int hidg\_bind(struct usb\_configuration \*c, struct usb\_function \*f) hidg\_fs\_out\_ep\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, hidg\_fs\_descriptors,- hidg\_hs\_descriptors, hidg\_ss\_descriptors, NULL);+ hidg\_hs\_descriptors, hidg\_ss\_descriptors,+ hidg\_ss\_descriptors); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_loopback.c b/drivers/usb/gadget/function/f\_loopback.cindex 1803646b367805..90215a81c178bb 100644--- a/[drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_loopback.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_loopback.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_loopback.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -207,7 +207,7 @@ autoconf\_fail: ss\_loop\_sink\_desc.bEndpointAddress = fs\_loop\_sink\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_loopback\_descs, hs\_loopback\_descs,- ss\_loopback\_descs, NULL);+ ss\_loopback\_descs, ss\_loopback\_descs); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_printer.c b/drivers/usb/gadget/function/f\_printer.cindex 2f1eb2e81d306b..236ecc96899854 100644--- a/[drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_printer.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_printer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_printer.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -1099,7 +1099,8 @@ autoconf\_fail: ss\_ep\_out\_desc.bEndpointAddress = fs\_ep\_out\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_printer\_function,- hs\_printer\_function, ss\_printer\_function, NULL);+ hs\_printer\_function, ss\_printer\_function,+ ss\_printer\_function); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_rndis.c b/drivers/usb/gadget/function/f\_rndis.cindex 0739b05a0ef7b3..ee95e8f5f9d489 100644--- a/[drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_rndis.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_rndis.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_rndis.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -789,7 +789,7 @@ rndis\_bind(struct usb\_configuration \*c, struct usb\_function \*f) ss\_notify\_desc.bEndpointAddress = fs\_notify\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, eth\_fs\_function, eth\_hs\_function,- eth\_ss\_function, NULL);+ eth\_ss\_function, eth\_ss\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_serial.c b/drivers/usb/gadget/function/f\_serial.cindex e6271384635045..1ed8ff0ac2d310 100644--- a/[drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_serial.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_serial.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_serial.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -233,7 +233,7 @@ static int gser\_bind(struct usb\_configuration \*c, struct usb\_function \*f) gser\_ss\_out\_desc.bEndpointAddress = gser\_fs\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, gser\_fs\_function, gser\_hs\_function,- gser\_ss\_function, NULL);+ gser\_ss\_function, gser\_ss\_function); if (status) goto fail; dev\_dbg(&cdev->gadget->dev, "generic ttyGS%d: %s speed IN/%s OUT/%s\n",diff --git a/drivers/usb/gadget/function/f\_sourcesink.c b/drivers/usb/gadget/function/f\_sourcesink.cindex ed68a4860b7d87..282737e4609ce8 100644--- a/[drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_sourcesink.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_sourcesink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_sourcesink.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -431,7 +431,8 @@ no\_iso: ss\_iso\_sink\_desc.bEndpointAddress = fs\_iso\_sink\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, fs\_source\_sink\_descs,- hs\_source\_sink\_descs, ss\_source\_sink\_descs, NULL);+ hs\_source\_sink\_descs, ss\_source\_sink\_descs,+ ss\_source\_sink\_descs); if (ret) return ret; diff --git a/drivers/usb/gadget/function/f\_subset.c b/drivers/usb/gadget/function/f\_subset.cindex 4d945254905d91..51c1cae162d9b0 100644--- a/[drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_subset.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_subset.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_subset.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -358,7 +358,7 @@ geth\_bind(struct usb\_configuration \*c, struct usb\_function \*f) fs\_subset\_out\_desc.bEndpointAddress;  status = usb\_assign\_descriptors(f, fs\_eth\_function, hs\_eth\_function,- ss\_eth\_function, NULL);+ ss\_eth\_function, ss\_eth\_function); if (status) goto fail; diff --git a/drivers/usb/gadget/function/f\_tcm.c b/drivers/usb/gadget/function/f\_tcm.cindex 410fa89eae8f65..5a2e9ce2bc352e 100644--- a/[drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_tcm.c?id=6bf8ff7d05204f0ec1842016280fedc00dd6b4d1)+++ b/[drivers/usb/gadget/function/f\_tcm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/f_tcm.c?id=4b289a0f3033f465b4fd51ba995251a7867a2aa2)@@ -2061,7 +2061,8 @@ static int tcm\_bind(struct usb\_configuration \*c, struct usb\_function \*f) uasp\_fs\_cmd\_desc.bEndpointAddress = uasp\_ss\_cmd\_desc.bEndpointAddress;  ret = usb\_assign\_descriptors(f, uasp\_fs\_function\_desc,- uasp\_hs\_function\_desc, uasp\_ss\_function\_desc, NULL);+ uasp\_hs\_function\_desc, uasp\_ss\_function\_desc,+ uasp\_ss\_function\_desc); if (ret) goto ep\_fail; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:59:04 +0000

