
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FKindSpells%2Fastro-shield%2Fcommit%2F41b84576d37fa486a57005ea297658d0bc38566d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FKindSpells%2Fastro-shield%2Fcommit%2F41b84576d37fa486a57005ea297658d0bc38566d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=kindspells%2Fastro-shield)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kindspells](/kindspells)
/
**[astro-shield](/kindspells/astro-shield)**
Public

* [Notifications](/login?return_to=%2Fkindspells%2Fastro-shield) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fkindspells%2Fastro-shield)
* [Star
   65](/login?return_to=%2Fkindspells%2Fastro-shield)

* [Code](/kindspells/astro-shield)
* [Issues
  31](/kindspells/astro-shield/issues)
* [Pull requests
  4](/kindspells/astro-shield/pulls)
* [Discussions](/kindspells/astro-shield/discussions)
* [Actions](/kindspells/astro-shield/actions)
* [Security](/kindspells/astro-shield/security)
* [Insights](/kindspells/astro-shield/pulse)

Additional navigation options

* [Code](/kindspells/astro-shield)
* [Issues](/kindspells/astro-shield/issues)
* [Pull requests](/kindspells/astro-shield/pulls)
* [Discussions](/kindspells/astro-shield/discussions)
* [Actions](/kindspells/astro-shield/actions)
* [Security](/kindspells/astro-shield/security)
* [Insights](/kindspells/astro-shield/pulse)

## Commit

[Permalink](/kindspells/astro-shield/commit/41b84576d37fa486a57005ea297658d0bc38566d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

feat: cross-origin resources allow-lists

[Browse files](/kindspells/astro-shield/tree/41b84576d37fa486a57005ea297658d0bc38566d)
Browse the repository at this point in the history

```
Signed-off-by: Andres Correa Casablanca <andreu@kindspells.dev>
```

* Loading branch information

[![@castarco](https://avatars.githubusercontent.com/u/251364?s=40&v=4)](/castarco)

[castarco](/kindspells/astro-shield/commits?author=castarco "View all commits by castarco")
committed
Mar 27, 2024

1 parent
[4f73ba8](/kindspells/astro-shield/commit/4f73ba8530e2568c9fd4060954a0ce1b37ae19a2)

commit 41b8457

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**485 additions**
and
**52 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* package.json
  [package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519)
* src

  + src/core.mjs
    [core.mjs](#diff-08426eb9e930f66461bea115ca0c872607eddff435aa7dc8bd85ea8f7c22a1bc)
  + src/headers.mjs
    [headers.mjs](#diff-352589719b7a488b9dde658ad6659a0dbf23fc8939b534573b0cae00341b53d5)
  + src/main.mjs
    [main.mjs](#diff-bdb7c6e508bc49c6d5091f329374fb3fec8f0a0c351f43a15b4676f22c03b865)
* tests

  + tests/core.test.mts
    [core.test.mts](#diff-c0e307d80a8c08b0fc12cbeca94448209d4c0ac6d01b16b4bb6d8af7b58e36ea)
  + tests/headers.test.mts
    [headers.test.mts](#diff-bbbf468541733ccd81357fd2489fb1b83cb80501ca071c24e774965913bdd59f)
  + tests/main.test.mts
    [main.test.mts](#diff-49d7b165dc791087b523e76883edfe0a7cfb234ee1c05d36647848a00faade27)
* vitest.config.unit.mts
  [vitest.config.unit.mts](#diff-7e4262a5708edbe6c2b88d815c425830becb5298f4dbcc83b723e5e83c63a1f9)

## There are no files selected for viewing

68 changes: 56 additions & 12 deletions

68
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/kindspells/astro-shield/blob/41b84576d37fa486a57005ea297658d0bc38566d/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -53,18 +53,62 @@ const rootDir = new URL('.', import.meta.url).pathname |
|  |  | export default defineConfig({ |
|  |  | integrations: [ |
|  |  | shield({ |
|  |  | // Enables SRI hashes generation for statically generated pages |
|  |  | enableStatic\_SRI: true, // true by default |
|  |  |  |
|  |  | // Enables a middleware that generates SRI hashes for dynamically |
|  |  | // generated pages |
|  |  | enableMiddleware\_SRI: false, // false by default |
|  |  |  |
|  |  | // This is the path where we'll generate the module containing the SRI |
|  |  | // hashes for your scripts and styles. There's no need to pass this |
|  |  | // parameter if you don't need this data, but it can be useful to |
|  |  | // configure your CSP policies. |
|  |  | sriHashesModule: resolve(rootDir, 'src', 'utils', 'sriHashes.mjs'), |
|  |  | sri: { |
|  |  | // Enables SRI hashes generation for statically generated pages |
|  |  | enableStatic: true, // true by default |
|  |  |  |
|  |  | // Enables a middleware that generates SRI hashes for dynamically |
|  |  | // generated pages |
|  |  | enableMiddleware: false, // false by default |
|  |  |  |
|  |  | // This is the path where we'll generate the module containing the SRI |
|  |  | // hashes for your scripts and styles. There's no need to pass this |
|  |  | // parameter if you don't need this data, but it can be useful to |
|  |  | // configure your CSP policies. |
|  |  | hashesModule: resolve(rootDir, 'src', 'utils', 'sriHashes.mjs'), |
|  |  |  |
|  |  | // For SSR content, Cross-Origin scripts must be explicitly allow-listed |
|  |  | // by URL in order to be allowed by the Content Security Policy. |
|  |  | // |
|  |  | // Defaults to [] |
|  |  | scriptsAllowListUrls: [ |
|  |  | 'https://code.jquery.com/jquery-3.7.1.slim.min.js', |
|  |  | ], |
|  |  |  |
|  |  | // For SSR content, Cross-Origin styles must be explicitly allow-listed |
|  |  | // by URL in order to be allowed by the Content Security Policy. |
|  |  | // |
|  |  | // Defaults to [] |
|  |  | stylesAllowListUrls: [ |
|  |  | 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css', |
|  |  | ], |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Inline styles are usually considered unsafe because they could make it |
|  |  | \* easier for an attacker to inject CSS rules in dynamic pages. However, they |
|  |  | \* don't pose a serious security risk for \_most\_ static pages. |
|  |  | \* |
|  |  | \* You can disable this option in case you want to enforce a stricter policy. |
|  |  | \* |
|  |  | \* @type {'all' | 'static' | false} |
|  |  | \* |
|  |  | \* Defaults to 'all'. |
|  |  | \*/ |
|  |  | allowInlineStyles: 'all', |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Inline scripts are usually considered unsafe because they could make it |
|  |  | \* easier for an attacker to inject JS code in dynamic pages. However, they |
|  |  | \* don't pose a serious security risk for \_most\_ static pages. |
|  |  | \* |
|  |  | \* You can disable this option in case you want to enforce a stricter policy. |
|  |  | \* |
|  |  | \* @type {'all' | 'static' | false} |
|  |  | \* |
|  |  | \* Defaults to 'all'. |
|  |  | \*/ |
|  |  | allowInlineScript: 'all', |
|  |  | }, |
|  |  |  |
|  |  | // - If set, it controls how the security headers will be generated in the |
|  |  | // middleware. |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[package.json](#diff-7ae45ad102eab3b6d7e7896acd08c427a9b25b346470d7bc6507b6481575d519 "package.json")

Show comments

[View file](/kindspells/astro-shield/blob/41b84576d37fa486a57005ea297658d0bc38566d/package.json)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | { |
|  |  | "name": "@kindspells/astro-shield", |
|  |  | "version": "1.2.0", |
|  |  | "version": "1.3.0", |
|  |  | "description": "Astro integration to enhance your website's security with SubResource Integrity hashes, Content-Security-Policy headers, and other techniques.", |
|  |  | "private": false, |
|  |  | "type": "module", |
| Expand Down | |  |

81 changes: 64 additions & 17 deletions

81
[src/core.mjs](#diff-08426eb9e930f66461bea115ca0c872607eddff435aa7dc8bd85ea8f7c22a1bc "src/core.mjs")

Show comments

[View file](/kindspells/astro-shield/blob/41b84576d37fa486a57005ea297658d0bc38566d/src/core.mjs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,7 +41,7 @@ export const generateSRIHash = data => { |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @typedef {( |
|  |  | \* hash: string, |
|  |  | \* hash: string | null, |
|  |  | \* attrs: string, |
|  |  | \* setCrossorigin: boolean, |
|  |  | \* content?: string | undefined, |
| Expand All | | @@ -50,19 +50,19 @@ export const generateSRIHash = data => { |
|  |  |  |
|  |  | /\*\* @type {ElemReplacer} \*/ |
|  |  | const scriptReplacer = (hash, attrs, setCrossorigin, content) => |
|  |  | `<script${attrs} integrity="${hash}"${ |
|  |  | `<script${attrs}${hash !== null ? ` integrity="${hash}"` : ''}${ |
|  |  | setCrossorigin ? ' crossorigin="anonymous"' : '' |
|  |  | }>${content ?? ''}</script>` |
|  |  |  |
|  |  | /\*\* @type {ElemReplacer} \*/ |
|  |  | const styleReplacer = (hash, attrs, setCrossorigin, content) => |
|  |  | `<style${attrs} integrity="${hash}"${ |
|  |  | `<style${attrs}${hash !== null ? ` integrity="${hash}"` : ''}${ |
|  |  | setCrossorigin ? ' crossorigin="anonymous"' : '' |
|  |  | }>${content ?? ''}</style>` |
|  |  |  |
|  |  | /\*\* @type {ElemReplacer} \*/ |
|  |  | const linkStyleReplacer = (hash, attrs, setCrossorigin) => |
|  |  | `<link${attrs} integrity="${hash}"${ |
|  |  | `<link${attrs}${hash !== null ? ` integrity="${hash}"` : ''}${ |
|  |  | setCrossorigin ? ' crossorigin="anonymous"' : '' |
|  |  | }/>` |
|  |  |  |
| Expand Down  Expand Up | | @@ -242,7 +242,7 @@ export const updateDynamicPageSriHashes = async ( |
|  |  | logger, |
|  |  | content, |
|  |  | globalHashes, |
|  |  | sri |
|  |  | sri, |
|  |  | ) => { |
|  |  | const processors = getRegexProcessors() |
|  |  |  |
| Expand Down  Expand Up | | @@ -331,12 +331,23 @@ export const updateDynamicPageSriHashes = async ( |
|  |  | if (sriHash) { |
|  |  | pageHashes[t2].add(sriHash) |
|  |  | } else { |
|  |  | const resourceResponse = await fetch(src, { method: 'GET' }) |
|  |  | const resourceContent = await resourceResponse.arrayBuffer() |
|  |  | logger.warn( |
|  |  | `Detected reference to not-allow-listed external resource "${src}"`, |
|  |  | ) |
|  |  | if (setCrossorigin) { |
|  |  | updatedContent = updatedContent.replace( |
|  |  | match[0], |
|  |  | replacer(null, attrs, true, ''), |
|  |  | ) |
|  |  | } |
|  |  | continue |
|  |  |  |
|  |  | sriHash = generateSRIHash(resourceContent) |
|  |  | globalHashes[t2].set(src, sriHash) |
|  |  | pageHashes[t2].add(sriHash) |
|  |  | // TODO: add scape hatch to allow fetching arbitrary external resources |
|  |  | // const resourceResponse = await fetch(src, { method: 'GET' }) |
|  |  | // const resourceContent = await resourceResponse.arrayBuffer() |
|  |  | // sriHash = generateSRIHash(resourceContent) |
|  |  | // globalHashes[t2].set(src, sriHash) |
|  |  | // pageHashes[t2].add(sriHash) |
|  |  | } |
|  |  | } else { |
|  |  | logger.warn(`Unable to process external resource: "${src}"`) |
| Expand Down  Expand Up | | @@ -517,6 +528,30 @@ export const scanForNestedResources = async (logger, dirPath, h) => { |
|  |  | ) |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param {Required<Pick<SRIOptions, 'scriptsAllowListUrls' | 'stylesAllowListUrls'>>} sri |
|  |  | \* @param {HashesCollection} h |
|  |  | \*/ |
|  |  | export const scanAllowLists = async (sri, h) => { |
|  |  | for (const scriptUrl of sri.scriptsAllowListUrls) { |
|  |  | const resourceResponse = await fetch(scriptUrl, { method: 'GET' }) |
|  |  | const resourceContent = await resourceResponse.arrayBuffer() |
|  |  | const sriHash = generateSRIHash(resourceContent) |
|  |  |  |
|  |  | h.extScriptHashes.add(sriHash) |
|  |  | h.perResourceSriHashes.scripts.set(scriptUrl, sriHash) |
|  |  | } |
|  |  |  |
|  |  | for (const styleUrl of sri.stylesAllowListUrls) { |
|  |  | const resourceResponse = await fetch(styleUrl, { method: 'GET' }) |
|  |  | const resourceContent = await resourceResponse.arrayBuffer() |
|  |  | const sriHash = generateSRIHash(resourceContent) |
|  |  |  |
|  |  | h.extStyleHashes.add(sriHash) |
|  |  | h.perResourceSriHashes.styles.set(styleUrl, sriHash) |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param {Logger} logger |
|  |  | \* @param {HashesCollection} h |
| Expand Down  Expand Up | | @@ -673,19 +708,22 @@ export const processStaticFiles = async (logger, { distDir, sri }) => { |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param {Logger} logger |
|  |  | \* @param {MiddlewareHashes} globalHashes |
|  |  | \* @param {Required<SRIOptions>} sri |
|  |  | \* @returns {import('astro').MiddlewareHandler} |
|  |  | \*/ |
|  |  | export const getMiddlewareHandler = globalHashes => { |
|  |  | export const getMiddlewareHandler = (logger, globalHashes, sri) => { |
|  |  | /\*\* @satisfies {import('astro').MiddlewareHandler} \*/ |
|  |  | return async (\_ctx, next) => { |
|  |  | const response = await next() |
|  |  | const content = await response.text() |
|  |  |  |
|  |  | const { updatedContent } = await updateDynamicPageSriHashes( |
|  |  | console, |
|  |  | logger, |
|  |  | content, |
|  |  | globalHashes, |
|  |  | sri, |
|  |  | ) |
|  |  |  |
|  |  | const patchedResponse = new Response(updatedContent, { |
| Expand All | | @@ -700,20 +738,28 @@ export const getMiddlewareHandler = globalHashes => { |
|  |  | /\*\* |
|  |  | \* Variant of `getMiddlewareHandler` that also applies security headers. |
|  |  | \* |
|  |  | \* @param {Logger} logger |
|  |  | \* @param {MiddlewareHashes} globalHashes |
|  |  | \* @param {SecurityHeadersOptions} securityHeadersOpts |
|  |  | \* @param {Required<SRIOptions>} sri |
|  |  | \* @returns {import('astro').MiddlewareHandler} |
|  |  | \*/ |
|  |  | export const getCSPMiddlewareHandler = (globalHashes, securityHeadersOpts) => { |
|  |  | export const getCSPMiddlewareHandler = ( |
|  |  | logger, |
|  |  | globalHashes, |
|  |  | securityHeadersOpts, |
|  |  | sri, |
|  |  | ) => { |
|  |  | /\*\* @satisfies {import('astro').MiddlewareHandler} \*/ |
|  |  | return async (\_ctx, next) => { |
|  |  | const response = await next() |
|  |  | const content = await response.text() |
|  |  |  |
|  |  | const { updatedContent, pageHashes } = await updateDynamicPageSriHashes( |
|  |  | console, |
|  |  | logger, |
|  |  | content, |
|  |  | globalHashes, |
|  |  | sri, |
|  |  | ) |
|  |  |  |
|  |  | const patchedResponse = new Response(updatedContent, { |
| Expand Down  Expand Up | | @@ -764,6 +810,7 @@ const loadVirtualMiddlewareModule = async ( |
|  |  | // We generate a provisional hashes module. It won't contain the hashes for |
|  |  | // resources created by Astro, but it can be useful nonetheless. |
|  |  | await scanForNestedResources(logger, publicDir, h) |
|  |  | await scanAllowLists(sri, h) |
|  |  | await generateSRIHashesModule( |
|  |  | logger, |
|  |  | h, |
| Expand Down  Expand Up | | @@ -821,10 +868,10 @@ export const onRequest = await (async () => { |
|  |  |  |
|  |  | return defineMiddleware(${ |
|  |  | securityHeadersOptions !== undefined |
|  |  | ? `getCSPMiddlewareHandler(globalHashes, ${JSON.stringify( |
|  |  | ? `getCSPMiddlewareHandler(console, globalHashes, ${JSON.stringify( |
|  |  | securityHeadersOptions, |
|  |  | )})` |
|  |  | : 'getMiddlewareHandler(globalHashes)' |
|  |  | )}, ${JSON.stringify(sri)})` |
|  |  | : `getMiddlewareHandler(console, globalHashes, ${JSON.stringify(sri)})` |
|  |  | }) |
|  |  | })() |
|  |  | ` |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[src/headers.mjs](#diff-352589719b7a488b9dde658ad6659a0dbf23fc8939b534573b0cae00341b53d5 "src/headers.mjs")

Show comments

[View file](/kindspells/astro-shield/blob/41b84576d37fa486a57005ea297658d0bc38566d/src/headers.mjs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,9 +96,13 @@ export const patchCspHeader = (plainHeaders, pageHashes, cspOpts) => { |
|  |  |  |
|  |  | if (pageHashes.scripts.size > 0) { |
|  |  | setSrcDirective(directives, 'script-src', pageHashes.scripts) |
|  |  | } else { |
|  |  | directives['script-src'] = "'none'" |
|  |  | } |
|  |  | if (pageHashes.styles.size > 0) { |
|  |  | setSrcDirective(directives, 'style-src', pageHashes.styles) |
|  |  | } else { |
|  |  | directives['style-src'] = "'none'" |
|  |  | } |
|  |  | if (Object.keys(directives).length > 0) { |
|  |  | plainHeaders['content-security-policy'] = serialiseCspDirectives(directives) |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/main.mjs](#diff-bdb7c6e508bc49c6d5091f329374fb3fec8f0a0c351f43a15b4676f22c03b865 "src/main.mjs")

Show comments

[View file](/kindspells/astro-shield/blob/41b84576d37fa486a57005ea297658d0bc38566d/src/main.mjs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -78,12 +78,12 @@ export const shield = ({ |
|  |  | return /\*\* @satisfies {AstroIntegration} \*/ { |
|  |  | name: '@kindspells/astro-shield', |
|  |  | hooks: { |
|  |  | ...((enableStatic\_SRI ?? true) === true |
|  |  | ...(\_sri.enableStatic === true |
|  |  | ? { |
|  |  | 'astro:build:done': getAstroBuildDone(\_sri), |
|  |  | } |
|  |  | : undefined), |
|  |  | ...(enableMiddleware\_SRI === true |
|  |  | ...(\_sri.enableMiddleware === true |
|  |  | ? { |
|  |  | 'astro:config:setup': getAstroConfigSetup(\_sri, securityHeaders), |
|  |  | } |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `41b8457`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FKindSpells%2Fastro-shield%2Fcommit%2F41b84576d37fa486a57005ea297658d0bc38566d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

