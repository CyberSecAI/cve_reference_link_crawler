=== Content from github.com_3fdb98c0_20250111_020822.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fethyca%2Ffides%2Fsecurity%2Fadvisories%2FGHSA-82vr-5769-6358)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fethyca%2Ffides%2Fsecurity%2Fadvisories%2FGHSA-82vr-5769-6358)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=ethyca%2Ffides)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ethyca](/ethyca)
/
**[fides](/ethyca/fides)**
Public

* [Notifications](/login?return_to=%2Fethyca%2Ffides) You must be signed in to change notification settings
* [Fork
  73](/login?return_to=%2Fethyca%2Ffides)
* [Star
   382](/login?return_to=%2Fethyca%2Ffides)

* [Code](/ethyca/fides)
* [Issues
  215](/ethyca/fides/issues)
* [Pull requests
  58](/ethyca/fides/pulls)
* [Actions](/ethyca/fides/actions)
* [Projects
  0](/ethyca/fides/projects)
* [Security](/ethyca/fides/security)
* [Insights](/ethyca/fides/pulse)

Additional navigation options

* [Code](/ethyca/fides)
* [Issues](/ethyca/fides/issues)
* [Pull requests](/ethyca/fides/pulls)
* [Actions](/ethyca/fides/actions)
* [Projects](/ethyca/fides/projects)
* [Security](/ethyca/fides/security)
* [Insights](/ethyca/fides/pulse)

# Cryptographically Weak Generation of One-Time Codes for Identity Verification

High

[daveqnet](/daveqnet)
published
GHSA-82vr-5769-6358
Nov 15, 2023

## Package

pip

ethyca-fides
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 2.24.0

## Patched versions

2.24.0

## Description

### Impact

The Fides Privacy Center allows data subject users to submit privacy and consent requests to data controller users of the Fides web application.

Privacy requests allow data subjects to submit a request to access all person data held by the data controller, or delete/erase it. Consent request allows data subject users to modify their privacy preferences for how the data controller uses their personal data e.g. data sales and sharing consent opt-in/opt-out.

If `subject_identity_verification_required` in the `[execution]` section of `fides.toml` or the env var `FIDES__EXECUTION__SUBJECT_IDENTITY_VERIFICATION_REQUIRED` is set to `True` on the fides webserver backend, data subjects are sent a one-time code to their email address or phone number, depending on messaging configuration, and the one-time code must be entered in the Privacy Center UI by the data subject before the privacy or consent request is submitted.

It was identified that the one-time code values for these requests were generated by the python `random` module, a cryptographically weak pseduo-random number generator (PNRG). If an attacker generates several hundred consecutive one-time codes, this vulnerability allows the attacker to predict all future one-time code values during the lifetime of the backend python process.

There is no security impact on data access requests as the personal data download package is not shared in the Privacy Center itself. However, this vulnerability allows an attacker to (i) submit a verified data erasure request, resulting in deletion of data for the targeted user and (ii) submit a verified consent request, modifying a user's privacy preferences.

### Patches

The vulnerability has been patched in Fides version `2.24.0`. Users are advised to upgrade to this version or later to secure their systems against this threat.

### Workarounds

None

### References

* <https://peps.python.org/pep-0506/>

### Severity

High

8.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:H

### CVE ID

CVE-2023-48224

### Weaknesses

[CWE-338](/advisories?query=cwe%3A338)

### Credits

* [![@RobertKeyser](https://avatars.githubusercontent.com/u/39230492?s=40&v=4)](/RobertKeyser)
  [RobertKeyser](/RobertKeyser)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_09873b0f_20250111_020822.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fethyca%2Ffides%2Fcommit%2F685bae61c203d29ed189f4b066a5223a9bb774c6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fethyca%2Ffides%2Fcommit%2F685bae61c203d29ed189f4b066a5223a9bb774c6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=ethyca%2Ffides)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ethyca](/ethyca)
/
**[fides](/ethyca/fides)**
Public

* [Notifications](/login?return_to=%2Fethyca%2Ffides) You must be signed in to change notification settings
* [Fork
  73](/login?return_to=%2Fethyca%2Ffides)
* [Star
   382](/login?return_to=%2Fethyca%2Ffides)

* [Code](/ethyca/fides)
* [Issues
  215](/ethyca/fides/issues)
* [Pull requests
  58](/ethyca/fides/pulls)
* [Actions](/ethyca/fides/actions)
* [Projects
  0](/ethyca/fides/projects)
* [Security](/ethyca/fides/security)
* [Insights](/ethyca/fides/pulse)

Additional navigation options

* [Code](/ethyca/fides)
* [Issues](/ethyca/fides/issues)
* [Pull requests](/ethyca/fides/pulls)
* [Actions](/ethyca/fides/actions)
* [Projects](/ethyca/fides/projects)
* [Security](/ethyca/fides/security)
* [Insights](/ethyca/fides/pulse)

## Commit

[Permalink](/ethyca/fides/commit/685bae61c203d29ed189f4b066a5223a9bb774c6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-82vr-5769-6358](https://github.com/advisories/GHSA-82vr-5769-6358 "GHSA-82vr-5769-6358")

[Browse files](/ethyca/fides/tree/685bae61c203d29ed189f4b066a5223a9bb774c6)
Browse the repository at this point in the history

```
* replace random.choice with secrets.choice for generating id verification code

* update changelog
```

* Loading branch information

[![@adamsachs](https://avatars.githubusercontent.com/u/9750285?s=40&v=4)](/adamsachs)

[adamsachs](/ethyca/fides/commits?author=adamsachs "View all commits by adamsachs")
committed
Nov 14, 2023

1 parent
[611b36b](/ethyca/fides/commit/611b36bc0119c9c24d826e8b56824dff0b8fb573)

commit 685bae6

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**5 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* src/fides/api/service/privacy\_request

  + src/fides/api/service/privacy\_request/request\_runner\_service.py
    [request\_runner\_service.py](#diff-b9a75e1bd68e587ed318909ec7fc93fadc1f7f6fd35d63e6e55a77a1dd93f35f)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/ethyca/fides/blob/685bae61c203d29ed189f4b066a5223a9bb774c6/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -51,6 +51,9 @@ The types of changes are: |
|  |  | - User preferences from cookie should always override experience preferences [#4405](https://github.com/ethyca/fides/pull/4405) |
|  |  | - Allow fides\_consent cookie to be set from a subdirectory [#4426](https://github.com/ethyca/fides/pull/4426) |
|  |  |  |
|  |  | ### Security |
|  |  | -- Use a more cryptographically secure random function for security code generation |
|  |  |  |
|  |  | ## [2.23.3](https://github.com/ethyca/fides/compare/2.23.2...2.23.3) |
|  |  |  |
|  |  | ### Fixed |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/fides/api/service/privacy\_request/request\_runner\_service.py](#diff-b9a75e1bd68e587ed318909ec7fc93fadc1f7f6fd35d63e6e55a77a1dd93f35f "src/fides/api/service/privacy_request/request_runner_service.py")

Show comments

[View file](/ethyca/fides/blob/685bae61c203d29ed189f4b066a5223a9bb774c6/src/fides/api/service/privacy_request/request_runner_service.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | import random |
|  |  | import secrets |
|  |  | from datetime import datetime, timedelta |
|  |  | from typing import Any, Dict, List, Optional, Set, Tuple |
|  |  |  |
| Expand Down  Expand Up | | @@ -627,7 +627,7 @@ def generate\_id\_verification\_code() -> str: |
|  |  | """ |
|  |  | Generate one-time identity verification code |
|  |  | """ |
|  |  | return str(random.choice(range(100000, 999999))) |
|  |  | return str(secrets.choice(range(100000, 999999))) |
|  |  |  |
|  |  |  |
|  |  | def \_retrieve\_child\_results( # pylint: disable=R0911 |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `685bae6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fethyca%2Ffides%2Fcommit%2F685bae61c203d29ed189f4b066a5223a9bb774c6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from peps.python.org_f3ff490e_20250111_020823.html ===

Following system colour scheme

Selected dark colour scheme

Selected light colour scheme

# Python Enhancement Proposals

* [Python](https://www.python.org/ "The Python Programming Language") »
* [PEP Index](../pep-0000/) »
* PEP 506

Toggle light / dark / auto colour theme

# PEP 506 – Adding A Secrets Module To The Standard Library

Author:
Steven D’Aprano <steve at pearwood.info>
Status:
Final
Type:
Standards Track
Created:
19-Sep-2015
Python-Version:
3.6
Post-History:

---

Table of Contents

* [Abstract](#abstract)
* [Definitions](#definitions)
* [Rationale](#rationale)
* [Proposal](#proposal)
* [API and Implementation](#api-and-implementation)
  + [Default arguments](#default-arguments)
  + [Naming conventions](#naming-conventions)
* [Alternatives](#alternatives)
* [Comparison To Other Languages](#comparison-to-other-languages)
* [What Should Be The Name Of The Module?](#what-should-be-the-name-of-the-module)
* [Frequently Asked Questions](#frequently-asked-questions)
* [References](#references)
* [Copyright](#copyright)

## [Abstract](#abstract)

This PEP proposes the addition of a module for common security-related
functions such as generating tokens to the Python standard library.

## [Definitions](#definitions)

Some common abbreviations used in this proposal:

* PRNG:

  Pseudo Random Number Generator. A deterministic algorithm used
  to produce random-looking numbers with certain desirable
  statistical properties.
* CSPRNG:

  Cryptographically Strong Pseudo Random Number Generator. An
  algorithm used to produce random-looking numbers which are
  resistant to prediction.
* MT:

  Mersenne Twister. An extensively studied PRNG which is currently
  used by the `random` module as the default.

## [Rationale](#rationale)

This proposal is motivated by concerns that Python’s standard library
makes it too easy for developers to inadvertently make serious security
errors. Theo de Raadt, the founder of OpenBSD, contacted Guido van Rossum
and expressed some concern [[1]](#id38) about the use of MT for generating sensitive
information such as passwords, secure tokens, session keys and similar.

Although the documentation for the `random` module explicitly states that
the default is not suitable for security purposes [[2]](#id39), it is strongly
believed that this warning may be missed, ignored or misunderstood by
many Python developers. In particular:

* developers may not have read the documentation and consequently
  not seen the warning;
* they may not realise that their specific use of the module has security
  implications; or
* not realising that there could be a problem, they have copied code
  (or learned techniques) from websites which don’t offer best
  practises.

The first [[3]](#id40) hit when searching for “python how to generate passwords” on
Google is a tutorial that uses the default functions from the `random`
module [[4]](#id41). Although it is not intended for use in web applications, it is
likely that similar techniques find themselves used in that situation.
The second hit is to a StackOverflow question about generating
passwords [[5]](#id42). Most of the answers given, including the accepted one, use
the default functions. When one user warned that the default could be
easily compromised, they were told “I think you worry too much.” [[6]](#id43)

This strongly suggests that the existing `random` module is an attractive
nuisance when it comes to generating (for example) passwords or secure
tokens.

Additional motivation (of a more philosophical bent) can be found in the
post which first proposed this idea [[7]](#id44).

## [Proposal](#proposal)

Alternative proposals have focused on the default PRNG in the `random`
module, with the aim of providing “secure by default” cryptographically
strong primitives that developers can build upon without thinking about
security. (See Alternatives below.) This proposes a different approach:

* The standard library already provides cryptographically strong
  primitives, but many users don’t know they exist or when to use them.
* Instead of requiring crypto-naive users to write secure code, the
  standard library should include a set of ready-to-use “batteries” for
  the most common needs, such as generating secure tokens. This code
  will both directly satisfy a need (“How do I generate a password reset
  token?”), and act as an example of acceptable practises which
  developers can learn from [[8]](#id45).

To do this, this PEP proposes that we add a new module to the standard
library, with the suggested name `secrets`. This module will contain a
set of ready-to-use functions for common activities with security
implications, together with some lower-level primitives.

The suggestion is that `secrets` becomes the go-to module for dealing
with anything which should remain secret (passwords, tokens, etc.)
while the `random` module remains backward-compatible.

## [API and Implementation](#api-and-implementation)

This PEP proposes the following functions for the `secrets` module:

* Functions for generating tokens suitable for use in (e.g.) password
  recovery, as session keys, etc., in the following formats:
  + as bytes, `secrets.token_bytes`;
  + as text, using hexadecimal digits, `secrets.token_hex`;
  + as text, using URL-safe base-64 encoding, `secrets.token_urlsafe`.
* A limited interface to the system CSPRNG, using either `os.urandom`
  directly or `random.SystemRandom`. Unlike the `random` module, this
  does not need to provide methods for seeding, getting or setting the
  state, or any non-uniform distributions. It should provide the
  following:
  + A function for choosing items from a sequence, `secrets.choice`.
  + A function for generating a given number of random bits and/or bytes
    as an integer, `secrets.randbits`.
  + A function for returning a random integer in the half-open range
    0 to the given upper limit, `secrets.randbelow` [[9]](#id46).
* A function for comparing text or bytes digests for equality while being
  resistant to timing attacks, `secrets.compare_digest`.

The consensus appears to be that there is no need to add a new CSPRNG to
the `random` module to support these uses, `SystemRandom` will be
sufficient.

Some illustrative implementations have been given by Alyssa (Nick) Coghlan [[10]](#id47)
and a minimalist API by Tim Peters [[11]](#id48). This idea has also been discussed
on the issue tracker for the “cryptography” module [[12]](#id49). The following
pseudo-code should be taken as the starting point for the real
implementation:

```
from random import SystemRandom
from hmac import compare_digest

_sysrand = SystemRandom()

randbits = _sysrand.getrandbits
choice = _sysrand.choice

def randbelow(exclusive_upper_bound):
    return _sysrand._randbelow(exclusive_upper_bound)

DEFAULT_ENTROPY = 32  # bytes

def token_bytes(nbytes=None):
    if nbytes is None:
        nbytes = DEFAULT_ENTROPY
    return os.urandom(nbytes)

def token_hex(nbytes=None):
    return binascii.hexlify(token_bytes(nbytes)).decode('ascii')

def token_urlsafe(nbytes=None):
    tok = token_bytes(nbytes)
    return base64.urlsafe_b64encode(tok).rstrip(b'=').decode('ascii')

```

The `secrets` module itself will be pure Python, and other Python
implementations can easily make use of it unchanged, or adapt it as
necessary. An implementation can be found on BitBucket [[13]](#id50).

### [Default arguments](#default-arguments)

One difficult question is “How many bytes should my token be?”. We can
help with this question by providing a default amount of entropy for the
“token\_\*” functions. If the `nbytes` argument is None or not given, the
default entropy will be used. This default value should be large enough
to be expected to be secure for medium-security uses, but is expected to
change in the future, possibly even in a maintenance release [[14]](#id51).

### [Naming conventions](#naming-conventions)

One question is the naming conventions used in the module [[15]](#id52), whether to
use C-like naming conventions such as “randrange” or more Pythonic names
such as “random\_range”.

Functions which are simply bound methods of the private `SystemRandom`
instance (e.g. `randrange`), or a thin wrapper around such, should keep
the familiar names. Those which are something new (such as the various
`token_*` functions) will use more Pythonic names.

## [Alternatives](#alternatives)

One alternative is to change the default PRNG provided by the `random`
module [[16]](#id53). This received considerable scepticism and outright opposition:

* There is fear that a CSPRNG may be slower than the current PRNG (which
  in the case of MT is already quite slow).
* Some applications (such as scientific simulations, and replaying
  gameplay) require the ability to seed the PRNG into a known state,
  which a CSPRNG lacks by design.
* Another major use of the `random` module is for simple “guess a number”
  games written by beginners, and many people are loath to make any
  change to the `random` module which may make that harder.
* Although there is no proposal to remove MT from the `random` module,
  there was considerable hostility to the idea of having to opt-in to
  a non-CSPRNG or any backwards-incompatible changes.
* Demonstrated attacks against MT are typically against PHP applications.
  It is believed that PHP’s version of MT is a significantly softer target
  than Python’s version, due to a poor seeding technique [[17]](#id54). Consequently,
  without a proven attack against Python applications, many people object
  to a backwards-incompatible change.

Alyssa Coghlan made an [earlier suggestion](../pep-0504/ "PEP 504 – Using the System RNG by default")
for a globally configurable PRNG
which uses the system CSPRNG by default, but has since withdrawn it
in favour of this proposal.

## [Comparison To Other Languages](#comparison-to-other-languages)

* PHP

  PHP includes a function `uniqid` [[18]](#id55) which by default returns a
  thirteen character string based on the current time in microseconds.
  Translated into Python syntax, it has the following signature:

  ```
  def uniqid(prefix='', more_entropy=False)->str

  ```

  The PHP documentation warns that this function is not suitable for
  security purposes. Nevertheless, various mature, well-known PHP
  applications use it for that purpose (citation needed).

  PHP 5.3 and better also includes a function `openssl_random_pseudo_bytes`
  [[19]](#id56). Translated into Python syntax, it has roughly the following
  signature:

  ```
  def openssl_random_pseudo_bytes(length:int)->Tuple[str, bool]

  ```

  This function returns a pseudo-random string of bytes of the given
  length, and a boolean flag giving whether the string is considered
  cryptographically strong. The PHP manual suggests that returning
  anything but True should be rare except for old or broken platforms.
* JavaScript

  Based on a rather cursory search [[20]](#id57), there do not appear to be any
  well-known standard functions for producing strong random values in
  JavaScript. `Math.random` is often used, despite serious weaknesses
  making it unsuitable for cryptographic purposes [[21]](#id58). In recent years
  the majority of browsers have gained support for `window.crypto.getRandomValues` [[22]](#id59).

  Node.js offers a rich cryptographic module, `crypto` [[23]](#id60), most of
  which is beyond the scope of this PEP. It does include a single function
  for generating random bytes, `crypto.randomBytes`.
* Ruby

  The Ruby standard library includes a module `SecureRandom` [[24]](#id61)
  which includes the following methods:

  + base64 - returns a Base64 encoded random string.
  + hex - returns a random hexadecimal string.
  + random\_bytes - returns a random byte string.
  + random\_number - depending on the argument, returns either a random
    integer in the range(0, n), or a random float between 0.0 and 1.0.
  + urlsafe\_base64 - returns a random URL-safe Base64 encoded string.
  + uuid - return a version 4 random Universally Unique IDentifier.

## [What Should Be The Name Of The Module?](#what-should-be-the-name-of-the-module)

There was a proposal to add a “random.safe” submodule, quoting the Zen
of Python “Namespaces are one honking great idea” koan. However, the
author of the Zen, Tim Peters, has come out against this idea [[25]](#id62), and
recommends a top-level module.

In discussion on the python-ideas mailing list so far, the name “secrets”
has received some approval, and no strong opposition.

There is already an existing third-party module with the same name [[26]](#id63),
but it appears to be unused and abandoned.

## [Frequently Asked Questions](#frequently-asked-questions)

* Q: Is this a real problem? Surely MT is random enough that nobody can
  predict its output.

  A: The consensus among security professionals is that MT is not safe
  in security contexts. It is not difficult to reconstruct the internal
  state of MT [[27]](#id64) [[28]](#id65) and so predict all past and future values. There
  are a number of known, practical attacks on systems using MT for
  randomness [[29]](#id66).
* Q: Attacks on PHP are one thing, but are there any known attacks on
  Python software?

  A: Yes. There have been vulnerabilities in Zope and Plone at the very
  least. Hanno Schlichting commented [[30]](#id67):

  ```
  "In the context of Plone and Zope a practical attack was
  demonstrated, but I can't find any good non-broken links about
  this anymore.  IIRC Plone generated a random number and exposed
  this on each error page along the lines of 'Sorry, you encountered
  an error, your problem has been filed as <random number>, please
  include this when you contact us'.  This allowed anyone to do large
  numbers of requests to this page and get enough random values to
  reconstruct the MT state.  A couple of security related modules used
  random instead of system random (cookie session ids, password reset
  links, auth token), so the attacker could break all of those."

  ```

  Christian Heimes reported this issue to the Zope security team in 2012 [[31]](#id68),
  there are at least two related CVE vulnerabilities [[32]](#id69), and at least one
  work-around for this issue in Django [[33]](#id70).
* Q: Is this an alternative to specialist cryptographic software such as SSL?

  A: No. This is a “batteries included” solution, not a full-featured
  “nuclear reactor”. It is intended to mitigate against some basic
  security errors, not be a solution to all security-related issues. To
  quote Alyssa Coghlan referring to her earlier proposal [[34]](#id71):

  ```
  "...folks really are better off learning to use things like
  cryptography.io for security sensitive software, so this change
  is just about harm mitigation given that it's inevitable that a
  non-trivial proportion of the millions of current and future
  Python developers won't do that."

  ```
* Q: What about a password generator?

  A: The consensus is that the requirements for password generators are too
  variable for it to be a good match for the standard library [[35]](#id72). No password
  generator will be included in the initial release of the module, instead it
  will be given in the documentation as a recipe (à la the recipes in the
  `itertools` module) [[36]](#id73).
* Q: Will `secrets` use /dev/random (which blocks) or /dev/urandom (which
  doesn’t block) on Linux? What about other platforms?

  A: `secrets` will be based on `os.urandom` and `random.SystemRandom`,
  which are interfaces to your operating system’s best source of cryptographic
  randomness. On Linux, that may be `/dev/urandom` [[37]](#id74), on Windows it may be
  `CryptGenRandom()`, but see the documentation and/or source code for the
  detailed implementation details.

## [References](#references)

[[1](#id1)]
<https://mail.python.org/pipermail/python-ideas/2015-September/035820.html>
[[2](#id2)]
<https://docs.python.org/3/library/random.html>
[[3](#id3)]
As of the date of writing. Also, as Google search terms may be
automatically customised for the user without their knowledge, some
readers may see different results.
[[4](#id4)]
<http://interactivepython.org/runestone/static/everyday/2013/01/3_password.html>
[[5](#id5)]
<http://stackoverflow.com/questions/3854692/generate-password-in-python>
[[6](#id6)]
<http://stackoverflow.com/questions/3854692/generate-password-in-python/3854766#3854766>
[[7](#id7)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036238.html>
[[8](#id8)]
At least those who are motivated to read the source code and documentation.
[[9](#id9)]
After considerable discussion, Guido ruled that the module need only
provide `randbelow`, and not similar functions `randrange` or
`randint`. <http://code.activestate.com/lists/python-dev/138375/>
[[10](#id10)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036271.html>
[[11](#id11)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036350.html>
[[12](#id12)]
<https://github.com/pyca/cryptography/issues/2347>
[[13](#id13)]
<https://bitbucket.org/sdaprano/secrets>
[[14](#id14)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036517.html>
<https://mail.python.org/pipermail/python-ideas/2015-September/036515.html>
[[15](#id15)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036474.html>
[[16](#id16)]
Link needed.
[[17](#id17)]
By default PHP seeds the MT PRNG with the time (citation needed),
which is exploitable by attackers, while Python seeds the PRNG with
output from the system CSPRNG, which is believed to be much harder to
exploit.
[[18](#id18)]
<http://php.net/manual/en/function.uniqid.php>
[[19](#id19)]
<http://php.net/manual/en/function.openssl-random-pseudo-bytes.php>
[[20](#id20)]
Volunteers and patches are welcome.
[[21](#id21)]
<http://ifsec.blogspot.fr/2012/05/cross-domain-mathrandom-prediction.html>
[[22](#id22)]
<https://developer.mozilla.org/en-US/docs/Web/API/RandomSource/getRandomValues>
[[23](#id23)]
<https://nodejs.org/api/crypto.html>
[[24](#id24)]
<http://ruby-doc.org/stdlib-2.1.2/libdoc/securerandom/rdoc/SecureRandom.html>
[[25](#id25)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036254.html>
[[26](#id26)]
<https://pypi.python.org/pypi/secrets>
[[27](#id27)]
<https://jazzy.id.au/2010/09/22/cracking_random_number_generators_part_3.html>
[[28](#id28)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036077.html>
[[29](#id29)]
<https://media.blackhat.com/bh-us-12/Briefings/Argyros/BH_US_12_Argyros_PRNG_WP.pdf>
[[30](#id30)]
Personal communication, 2016-08-24.
[[31](#id31)]
[https://bugs.launchpad.net/zope2/+bug/1071067](https://bugs.launchpad.net/zope2/%2Bbug/1071067)
[[32](#id32)]
<http://www.cvedetails.com/cve/CVE-2012-5508/>
<http://www.cvedetails.com/cve/CVE-2012-6661/>
[[33](#id33)]
<https://github.com/django/django/commit/1525874238fd705ec17a066291935a9316bd3044>
[[34](#id34)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036157.html>
[[35](#id35)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036476.html>
<https://mail.python.org/pipermail/python-ideas/2015-September/036478.html>
[[36](#id36)]
<https://mail.python.org/pipermail/python-ideas/2015-September/036488.html>
[[37](#id37)]
<http://sockpuppet.org/blog/2014/02/25/safely-generate-random-numbers/>
<http://www.2uo.de/myths-about-urandom/>

## [Copyright](#copyright)

This document has been placed in the public domain.

---

Source: <https://github.com/python/peps/blob/main/peps/pep-0506.rst>

Last modified: [2023-10-11 12:05:51 GMT](https://github.com/python/peps/commits/main/peps/pep-0506.rst)

## Contents

* [Abstract](#abstract)
* [Definitions](#definitions)
* [Rationale](#rationale)
* [Proposal](#proposal)
* [API and Implementation](#api-and-implementation)
  + [Default arguments](#default-arguments)
  + [Naming conventions](#naming-conventions)
* [Alternatives](#alternatives)
* [Comparison To Other Languages](#comparison-to-other-languages)
* [What Should Be The Name Of The Module?](#what-should-be-the-name-of-the-module)
* [Frequently Asked Questions](#frequently-asked-questions)
* [References](#references)
* [Copyright](#copyright)

[Page Source (GitHub)](https://github.com/python/peps/blob/main/peps/pep-0506.rst)


