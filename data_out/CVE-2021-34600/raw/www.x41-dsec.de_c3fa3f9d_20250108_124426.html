<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!-- As a source use a 512x512 png image, and then upload it to https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicons/site.webmanifest">
<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/images/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="X41 D-Sec">
<meta name="application-name" content="X41 D-Sec">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation | X41 D-Sec</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation" />
<meta name="author" content="Markus Vervier, YaÅar Klawohn" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The compasX parameterization software for complex alarm systems generated the AES keys used for both physical access control (via NFC tags) and remote management in an insecure fashion." />
<meta property="og:description" content="The compasX parameterization software for complex alarm systems generated the AES keys used for both physical access control (via NFC tags) and remote management in an insecure fashion." />
<link rel="canonical" href="https://x41-dsec.de/lab/advisories/x41-2021-003-telenot-complex-insecure-keygen/" />
<meta property="og:url" content="https://x41-dsec.de/lab/advisories/x41-2021-003-telenot-complex-insecure-keygen/" />
<meta property="og:site_name" content="X41 D-Sec" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-18T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation" />
<script type="application/ld+json">
{"datePublished":"2022-01-18T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://x41-dsec.de/lab/advisories/x41-2021-003-telenot-complex-insecure-keygen/"},"author":{"@type":"Person","name":"Markus Vervier, YaÅar Klawohn"},"@type":"BlogPosting","url":"https://x41-dsec.de/lab/advisories/x41-2021-003-telenot-complex-insecure-keygen/","description":"The compasX parameterization software for complex alarm systems generated the AES keys used for both physical access control (via NFC tags) and remote management in an insecure fashion.","headline":"Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation","dateModified":"2022-01-18T00:00:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  
        <meta name="image" content="https://x41-dsec.de/opengraph/c7e575c1cfa96c81ddd9197cf4d49722b42ccbc9.jpg">
        <meta name="twitter:image" content="https://x41-dsec.de/opengraph/c7e575c1cfa96c81ddd9197cf4d49722b42ccbc9.jpg">
        <meta name="twitter:image:alt" content="Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation">
        <meta property="og:image" content="https://x41-dsec.de/opengraph/c7e575c1cfa96c81ddd9197cf4d49722b42ccbc9.jpg">  
        <meta property="og:image:alt" content="Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation">
        <meta name="twitter:card" content="summary_large_image">
      
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link href='https://x41-dsec.de/feed.xml' rel='alternate' title='X41 Security News Feed' type='application/atom+xml'>
</head>

<body class="post-page">
  

<nav id="navbar">
  <div class="Navigation-main">
    <a class="Navigation-home" href="/">
      <img alt="X41 D-Sec logotype" src="/assets/images/svg/logo.svg">
    </a>
    <div class="Navigation-menu">
      <img alt="X41 D-Sec logotype" src="/assets/images/svg/hamburger.svg">
    </div>
    <ul class="Navigation-items">
      
        <li>
          <a  href="/company/">
            Company
          </a>
          
          
            <ul class="Navigation-subitems">
              
                <li>
                  <a href="/company/#company" >
                    Mission
                  </a>
                </li>
              
                <li>
                  <a href="/company/#locations" >
                    Locations
                  </a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a  href="/news/">
            News
          </a>
          
          
            <ul class="Navigation-subitems">
              
                <li>
                  <a href="/news/" >
                    ResearchBlog
                  </a>
                </li>
              
                <li>
                  <a href="/news/lab/" >
                    Lab
                  </a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a  href="/pethmr/">
            PetâHMR
          </a>
          
          
        </li>
      
        <li>
          <a  href="/services/">
            Services
          </a>
          
          
            <ul class="Navigation-subitems">
              
                <li>
                  <a href="/services/code-audit/" >
                    Code Audit
                  </a>
                </li>
              
                <li>
                  <a href="/services/red-teaming/" >
                    Red Teaming
                  </a>
                </li>
              
                <li>
                  <a href="/services/security-research/" >
                    Security Research
                  </a>
                </li>
              
                <li>
                  <a href="/services/penetration-testing/" >
                    Penetration Testing
                  </a>
                </li>
              
                <li>
                  <a href="/services/fuzzing/" >
                    Fuzzing
                  </a>
                </li>
              
                <li>
                  <a href="/services/appsec/" >
                    AppSec
                  </a>
                </li>
              
            </ul>
          
        </li>
      
        <li>
          <a  href="/references/">
            References
          </a>
          
          
        </li>
      
        <li>
          <a  href="/contact/">
            Contact
          </a>
          
          
        </li>
      
        <li>
          <a  href="/jobs/">
            Jobs
          </a>
          
          
        </li>
      
        <li>
          <a  href="/faq/">
            FAQ
          </a>
          
          
        </li>
      
    </ul>
  </div>
  





</nav>

  <main>
    <div class="post">
  <h1>NEWS</h1>
  <div class="post-content">
    <h1 id="advisory-x41-2021-003-telenot-complex---insecure-aes-key-generation">Advisory X41-2021-003: Telenot complex - Insecure AES Key Generation</h1>

<div class="post-infobox">

  <p><strong>Severity Rating:</strong> High</p>

  <p><strong>Confirmed Affected Versions:</strong> &lt;32.0</p>

  <p><strong>Confirmed Patched Versions:</strong> &gt;=32.0</p>

  <p><strong>Vendor:</strong> TELENOT ELECTRONIC GMBH</p>

  <p><strong>Vendor URL:</strong> <a href="https://www.telenot.com/">https://www.telenot.com/</a></p>

  <p><strong>Vendor Reference:</strong> -</p>

  <p><strong>Vector:</strong> Physical / Remote</p>

  <p><strong>Credit:</strong> X41 D-SEC GmbH, Markus Vervier, YaÅar Klawohn</p>

  <p><strong>Status:</strong> Public</p>

  <p><strong>CVE:</strong> CVE-2021-34600</p>

  <p><strong>CWE:</strong> 340, 338</p>

  <p><strong>CVSS Score:</strong> N/A</p>

  <p><strong>CVSS Vector:</strong> N/A</p>

  <p><strong>Advisory-URL:</strong> https://www.x41-dsec.de/lab/advisories/x41-2021-003-telenot-complex-insecure-keygen/</p>

</div>

<h2 id="summary-and-impact">Summary and Impact</h2>

<p>The <em>complex</em> alarm system manufactured by Telenot supports the use of NFC<br />
tags for the authorization of users using DESFire EV2[6] tags that support<br />
AES encryption.<br />
The supplied management software <em>compasX</em> can generate the secret AES keys<br />
that are stored both on the system and the NFC tag and are used for the mutual<br />
authentication between them.<br />
It was found that keys generated using compasX are predictable,<br />
which allows attackers to clone NFC tags and gain unauthorized access to<br />
secured areas, unless further security controls, like the requirement to provide<br />
a PIN, are in place.</p>

<p>Deployments which use both</p>

<ul>
  <li>NFC tags of type MIFARE DESFire EV1 or EV2</li>
  <li>AES keys generated with vulnerable compasX versions for use<br />
with the above tags</li>
</ul>

<p>are vulnerable. All such AES keys should be replaced (including those<br />
used for remote access) by either a manually generated key or<br />
by using a recent compasX software revision (32.0) that is using a cryptographically<br />
secure random number generator.</p>

<h2 id="root-cause-analysis">Root Cause Analysis</h2>

<p>compasX versions older than 32.0 use random numbers supplied by<br />
the cryptographically insecure PRNG implementation of the <code class="language-plaintext highlighter-rouge">rand()</code> function<br />
to create AES keys.<br />
The PRNG instance is seeded with the current system time as UNIX timestamp<br />
via calls to <code class="language-plaintext highlighter-rouge">srand(time())</code>. Because the supplied timestamp value is a<br />
32-bit number, the amount of possible seeds is bounded by the maximum<br />
unsigned 32 bit value of <code class="language-plaintext highlighter-rouge">4294967295</code>, down from<br />
2<sup>128</sup> possible keys for the used AES128. It is feasible<br />
to search the whole key space on a modern Desktop system in reasonable time.</p>

<p>The possible key space can be even further reduced when assuming that<br />
MIFARE DESFire EV1 seems to have first been introduced in 2006. Between<br />
2006-01-01 00:00:00 GMT (timestamp <code class="language-plaintext highlighter-rouge">1136073600</code>) and 2021-11-30 00:00:00 GMT<br />
(timestamp <code class="language-plaintext highlighter-rouge">1638230400</code>) there are <code class="language-plaintext highlighter-rouge">502156800</code> timestamps that could have been<br />
used as seeds.</p>

<p>The Borland C/C++ library used in compasX, states that ârand uses a multiplicative<br />
congruential random number generatorâ<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote">1</a></sup>, which is not a cryptographically secure<br />
pseudorandom number generator (CSPRNG).<br />
Itâs important to note that even if the seed hadnât been time-based, <code class="language-plaintext highlighter-rouge">rand()</code><br />
âgenerates a well-known sequence and isnât appropriate for use as a<br />
cryptographic functionâ<sup id="fnref:0" role="doc-noteref"><a href="#fn:0" class="footnote">2</a></sup>. While the previous quote is from Microsoftâs<br />
documentation about their own implementation, a comparable warning is missing<br />
from the documentation of the used implementation of <code class="language-plaintext highlighter-rouge">rand()</code>.</p>

<p>The current recommended CSPRNG on modern Windows systems is<br />
<code class="language-plaintext highlighter-rouge">BCryptGenRandom</code><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">3</a></sup>, which is part of the âCryptography API: Next<br />
Generationâ<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">4</a></sup>.</p>

<h2 id="proof-of-concept">Proof of Concept</h2>

<p>Head over to the <a href="/lab/blog/telenot-complex-insecure-keygen/">blog post</a> for a detailed description and our proof of concept!</p>

<h2 id="workaround">Workaround</h2>

<p>It is strongly recommended to raise the security level during the time window<br />
until the AES keys can be changed to securely generated ones.<br />
The complex alarm systems supports alternative authentication factors that<br />
can be combined with the Desfire NFC tag authentication.<br />
An example for such an additional factor is a requirement for a valid<br />
PIN entry on the complex alarm system in addition to a successful<br />
Desfire authentication to disarm the alarm.</p>

<h2 id="timeline">Timeline</h2>
<div class="post-infobox">

  <p><strong>2021-09-02</strong> Problem discovered during internal audit and impact assessed</p>

  <p><strong>2021-09-07</strong> Initial contact with Telenot</p>

  <p><strong>2021-09-20</strong> Disclosure and discussion of all technical details to Telenot</p>

  <p><strong>2021-12-01</strong> Telenot releases of a fixed version of compasX, notifies customers</p>

  <p><strong>2021-12-01</strong> CVE requested</p>

  <p><strong>2021-12-02</strong> CVE-2021-34600 assigned</p>

  <p><strong>2021-01-18</strong> Public disclosure</p>

</div>

<h1 id="about-x41-d-sec-gmbh">About X41 D-SEC GmbH</h1>

<p>X41 is an expert provider for application security services. Having extensive<br />
industry experience and expertise in the area of information security, a strong<br />
core security team of world class security experts enables X41 to perform<br />
premium security services.</p>

<p>Fields of expertise in the area of application security are security centered<br />
code reviews, binary reverse engineering and vulnerability discovery. Custom<br />
research and IT security consulting and support services are core competencies<br />
of X41.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:3" role="doc-endnote">
      <p>https://docwiki.embarcadero.com/RADStudio/Sydney/en/RandÂ <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:0" role="doc-endnote">
      <p>https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/rand?view=msvc-170Â <a href="#fnref:0" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:1" role="doc-endnote">
      <p>https://docs.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptgenrandomÂ <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>https://docs.microsoft.com/en-us/windows/win32/seccng/cng-portalÂ <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>
  <div class="post-author">
    Author:
    <a  href="mailto:info@x41-dsec.de" >Markus Vervier, YaÅar Klawohn</a>
  </div>

  <div class="post-date">
    Date: January 18, 2022
  </div>

</div>
<div class="post-related-outer">
  <div class="post-related">
    
      <div>
        <div>&laquo;</div>
        <a class="prev" href="/news/rustyhermit-missing-memory-protections/">
          RustyHermit Missing Memory Protections</a>
      </div>
    
    
      <div>
        <a class="next" href="/lab/blog/telenot-complex-insecure-keygen/">Telenot Complex: Insecure AES Key Generation</a>
        <div>&raquo;</div>
      </div>
    
  </div>
</div>
  </main>
  <footer>
  <div class="Footer-address">
    <div class="Footer-address-name">CONTACT</div>
    <div class="Address">
  <div>X41 D-Sec GmbH
Soerser Weg 20
52070 Aachen
</div>
  <div>
    <a href="tel:4924198094180">
      +49 (0) 241 9809418-0
    </a>
    <a href="tel:4924198094189">
      +49 (0) 241 9809418-9
    </a>
    <a href="mailto:info@x41-dsec.de">
      info@x41-dsec.de
    </a>
  </div>
</div>

    

<a href="/static/pgp/0x6746CF4698A7AB6Epub.asc.txt" target="_blank" rel="noopener">PGP Key</a>
  </div>
  <div class="Footer-social">
    <div>
      <div class="Footer-social-name">Connect</div>
      <div class="Footer-social-items">
        
  <a href="https://github.com/x41sec" target="_blank" rel="noopener" title="X41 Github">
    <div>Github</div>
    <img src="/assets/images/svg/github.svg" alt="X41 Github">
  </a>

  <a href="https://infosec.exchange/@x41sec" target="_blank" rel="noopener" title="X41 Mastodon">
    <div>Mastodon</div>
    <img src="/assets/images/svg/mastodon.svg" alt="X41 Mastodon">
  </a>

  <a href="https://twitter.com/X41Sec" target="_blank" rel="noopener" title="X41 Twitter">
    <div>Twitter</div>
    <img src="/assets/images/svg/twitter.svg" alt="X41 Twitter">
  </a>

  <a href="https://de.linkedin.com/company/x41" target="_blank" rel="noopener" title="X41 LinkedIn">
    <div>LinkedIn</div>
    <img src="/assets/images/svg/linkedin.svg" alt="X41 LinkedIn">
  </a>

      </div>
    </div>
  </div>
  <div class="Footer-links">
    
      <a href="/faq/">FAQ</a>
    
      <a href="/references/">Partners</a>
    
      <a href="/terms/">Terms of Use</a>
    
      <a href="/privacy/">Privacy</a>
    
      <a href="/imprint/">Imprint</a>
    
  </div>
</footer>
  <script src="/assets/js/main.js"></script>
</body>

</html>
