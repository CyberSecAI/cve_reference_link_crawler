
[![](https://www.equalexperts.com/wp-content/uploads/2024/10/2024-Logo.svg)](https://www.equalexperts.com)

* About us[About us](https://www.equalexperts.com/about-us/)

  Learn more about Equal Experts, who we are and our way of working.

  About us
  + [About us](https://www.equalexperts.com/about-us/)
  + [Consultant network](https://www.equalexperts.com/about-us/consultant-network/)
  + [The experience model](https://www.equalexperts.com/about-us/the-equal-experts-experience-model/)
  + [Equal Experts trust](https://www.equalexperts.com/about-us/equal-experts-trust/)
  + [Our team](https://www.equalexperts.com/about-us/our-team/)
  + [Values](https://www.equalexperts.com/about-us/our-values/)
  + [Partnerships](https://www.equalexperts.com/about-us/our-partnerships/)
* What we do[What we do](https://www.equalexperts.com/our-services/)

  Discover how our services have helped clients transform their organisations.

  What we do
  + [Our services](https://www.equalexperts.com/our-services/)
  + [Design](https://www.equalexperts.com/our-services/design/)
  + [Data](https://www.equalexperts.com/our-services/data/)
  + [AI](https://www.equalexperts.com/our-services/ai/)
  + [Deliver](https://www.equalexperts.com/our-services/deliver/)
  + [Scale](https://www.equalexperts.com/our-services/scale/)
* Our clients[Our clients](https://www.equalexperts.com/who-we-work-with/)

  Explore case studies and stories of how we have helped build and scale organisations around the globe.

  Our clients
  + [Case studies](https://www.equalexperts.com/case-studies/)
  + [Retail and ecommerce](https://www.equalexperts.com/retail-and-ecommerce/)
  + [Media and entertainment](https://www.equalexperts.com/media-and-entertainment/)
  + [Government and public sector](https://www.equalexperts.com/government-and-public-sector/)
  + [Financial services](https://www.equalexperts.com/financial-services/)
  + [Software and technology](https://www.equalexperts.com/software-and-technology/)
  + [Travel and transport](https://www.equalexperts.com/travel-and-transport/)
  + [Manufacturing](https://www.equalexperts.com/manufacturing/)
  + [Not-for-profit and third sector](https://www.equalexperts.com/charities-not-for-profit-and-third-sector/)
* Insights[Insights](https://www.equalexperts.com/insights/)

  Explore our take on industry trends and developments and our webinars, events and playbooks bought to you by our individuals across our network.

  Insights
  + [Blog](https://www.equalexperts.com/blog/)
  + [Network blogs](https://www.equalexperts.com/network-blogs/)
  + [Playbooks](https://www.equalexperts.com/playbooks/)
  + [Data – Use | Avoid | Explore](https://www.equalexperts.com/data-use-explore-avoid/)
  + [Events](https://www.equalexperts.com/events/)
* Join us[Join us](https://www.equalexperts.com/join-us/)

  Hear what it's like to work for us and how you can join our network.

  Join us
  + [Join us](https://www.equalexperts.com/join-us/)
  + [Current opportunities](https://www.equalexperts.com/current-opportunities/)
  + [Interview process](https://www.equalexperts.com/join-us/interview-process/)
  + [Network benefits](https://www.equalexperts.com/join-us/network-benefits/)
  + [Community events calendar](https://www.equalexperts.com/community-events-calendar/)
* Contact us[Contact us](https://www.equalexperts.com/contact-us/)

  Speak with your local team to find out how we can help you drive greater business value through high-quality technology solutions.

  Contact us
  + [Get in touch](https://www.equalexperts.com/contact-us/)
  + [Australia](https://www.equalexperts.com/contact-us/australia/)
  + [Germany](https://www.equalexperts.com/contact-us/germany/)
  + [India](https://www.equalexperts.com/contact-us/india/)
  + [Netherlands](https://www.equalexperts.com/contact-us/netherlands/)
  + [North America](https://www.equalexperts.com/contact-us/north-america/)
  + [Portugal](https://www.equalexperts.com/contact-us/portugal/)
  + [South Africa](https://www.equalexperts.com/contact-us/south-africa/)
  + [UK](https://www.equalexperts.com/contact-us/uk/)

Menu

Search

Search for:

Search Site

![](https://www.equalexperts.com/wp-content/uploads/2024/07/dbt-issue-THUMB.jpg)

![Paul Brabban](https://www.equalexperts.com/wp-content/uploads/2020/07/Paul-Brabban.jpg)

Paul Brabban

Data Engineer

Tech Focus

July 2, 2024

# Are you at risk from this critical dbt vulnerability?

**A newly discovered critical security vulnerability in the dbt ecosystem**

UPDATE 17th July 2024: [CVE-2024-40637](https://nvd.nist.gov/vuln/detail/CVE-2024-40637) assigned and noted in [GitHub](https://github.com/dbt-labs/dbt-core/security/advisories/GHSA-p3f3-5ccg-83xq).

CVSS score 4.2.

Today we’re sharing news of a critical security vulnerability that affects users of the dbt package ecosystem. This vulnerability, which I discovered with [Michal Czerwinski](https://www.linkedin.com/in/michalczerwinski/), highlights the challenges our industry faces around the security of new software package supply chains. We responsibly disclosed our concerns to [dbt Labs](https://www.getdbt.com/), who accepted the vulnerability and have implemented mitigations.

## Understanding the vulnerability

The dbt tool is widely used to transform data within data warehouses. It allows data analysts and engineers to write modular SQL queries, which can be used in data pipelines.

dbt’s power and flexibility has made it a popular choice in the analytics engineering space, but that same flexibility also introduces significant risks. Because dbt brings its own ecosystem of software packages, the core of this vulnerability is the trust model inherent in software supply chains.

The potential impact of this vulnerability is severe. An attacker could:

1. **Manipulate data:** alter or delete data, leading to data integrity issues
2. **Exfiltrate data:** extract sensitive information from or change permissions in the database

> *“During a threat assessment for one of our clients, we encountered several security concerns. As I explored how to securely expose the DBT ecosystem to our developers, it became clear that there are significant challenges in addressing software supply chain security within the current DBT module ecosystem.” – Michal Czerwinski*

When users install dbt packages from sources other than dbt Labs, they trust that these packages perform the advertised function and nothing more. In affected versions, the new vulnerability abuses the way dbt generates SQL, allowing a malicious dbt package to execute SQL injection attacks without any user interaction. An attacker could craft a dbt package that, once installed, could change, exfiltrate, or delete data within the victim database. We believe this vulnerability affects both dbt-core and the dbt Cloud hosted service.

We should note that dbt packages are not Python packages. They are a part of a dbt-specific package ecosystem that is largely unknown to the infosec community. Software Composition Analysis (SCA) tools like [safetycli](https://safetycli.com/product/safety-cli) and [Snyk](https://snyk.io/) can, along with Static Application Security Testing (SAST), scan third party and transient dependencies, alerting users to known vulnerabilities they might be exposed to.

**This is a critical blind spot for users who depend on such tooling to inform them of vulnerabilities they are exposed to.**

## Simple example: exfiltrating at scale on Google Cloud via dbt

Here’s a simple exploit we crafted to demonstrate the problem. An attacker creates a malicious dbt package that copies your data out of Google BigQuery in the background whilst performing its advertised function.

![](data:image/svg+xml...)![](https://www.equalexperts.com/wp-content/uploads/2024/07/AD_4nXcCQu296yDYOsDS7S9lQI567Nf68FqOIQW7g5VymImby-NNZCJQqZasQme4hMF_Xfmy0L1wrEJN6rV7qM0w4LoTSEWh1M8ZeT_J7g6Sm_FAv0jxaGszhmwogO81JbDWHvkoO3TFb3dwPeZrXZrZZ1izlLP9.png)

The attacker creates a project named “myco\_example\_project” in Google Cloud, and creates a dataset “example\_dataset” inside. This dataset is shared with public Data Editor permissions, so a table can be created in this dataset, and data copied into it from anywhere.

The attacker also creates or compromises a dbt package and publishes that in a public GitHub repository and [dbt Hub](https://hub.getdbt.com/), whilst also deploying marketing to tempt or trick unsuspecting victims into installing it. As with most such ecosystems, [the dbt Hub documentation explicitly states that they do not “certify or confirm the … security of any Packages”](https://docs.getdbt.com/docs/build/packages#hub-packages-recommended), as [reiterated in the disclaimer](https://hub.getdbt.com/disclaimer/). It is for the consumer to accept the risk of installing a specific package.

Within our exploit package’s directory structure is an innocuous-looking file “macros/example.sql”, starting with the following Jinja macro text:

![](data:image/svg+xml...)![](https://www.equalexperts.com/wp-content/uploads/2024/07/AD_4nXcD34lt1_f_P-yMzDfbyVakahhOyc6CLK535nE2KE6bw1LwTXqBof_HF14tHxPOVh94UCj4x3p-G2mvPsE84mypMzveFzIewQtWTGpIMENZeGNJxS3cmbUjJFnHCXFHBAFIqpX6E7rZbgbFdvpUKHShwoo.png)

An unsuspecting victim installs the package from GitHub or dbt Hub. With no further interaction, they execute `dbt run` as usual, or it is run by their automation.

In affected versions of dbt, this macro is run silently in place of the legitimate and [trusted BigQuery adapter’s version](https://docs.getdbt.com/docs/trusted-adapters). **The contents of whatever `SELECT \*` produces against this model (and for each of the set of models included in the run) is copied into a new table in the attacker’s dataset in seconds.** Evidence of the exfiltration would only be present in the dbt log files and GCP audit logging, neither of which would, by default, proactively alert the victim of the attack.

## How to mitigate against this dbt vulnerability

The vendor has provided mitigations for the issue with the config flag [require\_explicit\_package\_overrides\_for\_builtin\_materializations](https://docs.getdbt.com/reference/global-configs/legacy-behaviors#package-override-for-built-in-materialization). The behaviour of this flag varies by versions of dbt core and dbt Cloud, so refer to the [Legacy Behaviours documentation](https://docs.getdbt.com/reference/global-configs/legacy-behaviors) to understand your current position and upgrade options. We offer the following advice for any dbt users to assess and mitigate the risks posed by this vulnerability:

1. Explicitly set the config flag [require\_explicit\_package\_overrides\_for\_builtin\_materializations to True in dbt\_project.yml](https://docs.getdbt.com/reference/global-configs/legacy-behaviors#package-override-for-built-in-materialization) for all your dbt projects.
2. dbt-core versions are Python dependencies. dbt Labs have recently updated their documentation to [making a strong recommendation to keep versions up-to-date](https://docs.getdbt.com/docs/dbt-versions/core). Ensure dbt-core versions are actively updated to the latest versions as these fixes become available, including in [dbt Cloud](https://docs.getdbt.com/docs/dbt-versions/upgrade-dbt-version-in-cloud).
3. Review dbt package usage in your organisation. Ensure packages are obtained from trusted sources like dbt vendor itself, check that the value of a package outweighs the risk.
4. Ensure software dependencies are being scanned for known vulnerabilities, and that you have a vulnerability management process in place to respond to any alarms.
5. Review and minimise permissions that dbt is run with for human and unattended workloads.
6. Review the controls you have in place in your infrastructure that prevent transfer of data outside your organisational boundaries.

These assessments and mitigations can prove challenging to undertake in practice. Equal Experts has published a [Secure Delivery Playbook with lots of advice for applying security principles](https://playbooks.equalexperts.com/secure-delivery-playbook). I’ve also shared the practices I follow to [assess the risk a package represents](https://tempered.works/posts/2024/05/01/how-i-do-python-data-supply-chain-security/#assessing-dependency-risk) and to [automatically update dependencies without causing chaos in my teams](https://tempered.works/posts/2024/05/01/how-i-do-python-data-supply-chain-security/#updating-dependencies-automatically).

## You may also like

Previous

Next

![](data:image/svg+xml...)![](https://www.equalexperts.com/wp-content/uploads/2020/01/For-StuartGunter-Blog-Jan-2020-Thumbnail.jpg)
### Blog

Cybersecurity Strategy and the Secure Delivery Playbook

![](data:image/svg+xml...)![](https://www.equalexperts.com/wp-content/uploads/2023/10/cloud-secutity-feature.jpg)

### Case Study

Plan for the future with a tailored security health check

![](data:image/svg+xml...)![](https://www.equalexperts.com/wp-content/uploads/2023/10/290923-Feature-Image.jpg)

### Case Study

Reducing time-to-market in security architecture

## Get in touch

#### Solving a complex business problem? You need experts by your side.

All business models have their pros and cons. But, when you consider the type of problems we help our clients to solve at Equal Experts, it’s worth thinking about the level of experience and the best consultancy approach to solve them.

If you’d like to find out more about working with us – get in touch. We’d love to hear from you.

* [About us](https://www.equalexperts.com/about-us/)
* [Experience model](https://www.equalexperts.com/about-us/the-equal-experts-experience-model/)
* [Consultant network](https://www.equalexperts.com/about-us/consultant-network/)
* [Equal Experts Trust](https://www.equalexperts.com/about-us/equal-experts-trust/)
* [Our team](https://www.equalexperts.com/about-us/our-team/)

* [Design](https://www.equalexperts.com/our-services/design/)
* [Data](https://www.equalexperts.com/our-services/data/)
* [AI](https://www.equalexperts.com/our-services/ai/)
* [Deliver](https://www.equalexperts.com/our-services/deliver/)
* [Scale](https://www.equalexperts.com/our-services/scale/)

* [Blog](https://www.equalexperts.com/blog/)
* [Playbooks](https://www.equalexperts.com/playbooks/)
* [Events](https://www.equalexperts.com/events/)
* [Case studies](https://www.equalexperts.com/case-studies/)
* [Network blogs](https://www.equalexperts.com/network-blogs/)

* [Join us](https://www.equalexperts.com/join-us/)
* [Current opportunities](https://www.equalexperts.com/current-opportunities/)
* [Network benefits](https://www.equalexperts.com/join-us/network-benefits/)
* [Our Values](https://www.equalexperts.com/about-us/our-values/)
* [Contact us](https://www.equalexperts.com/contact-us/)

* [Privacy and cookies notice](https://www.equalexperts.com/privacy-notice/)
* [Modern Slavery Policy](https://www.equalexperts.com/modern-slavery-policy/)
* [Equality, Diversity and Inclusion](https://www.equalexperts.com/equality-diversity-inclusion/)
* [Carbon Reduction Plan](https://www.equalexperts.com/carbon-reduction-plan/)

[link to X
![x](data:image/svg+xml...)![x](https://www.equalexperts.com/wp-content/uploads/2024/10/X-Icon.svg)](https://x.com/EqualExperts)
[link to linkedin
![linkedin](data:image/svg+xml...)![linkedin](https://www.equalexperts.com/wp-content/uploads/2024/10/LinkedIn-Icon-min.svg)](https://www.linkedin.com/company/equal-experts/)
[link to Youtube
![youtube](data:image/svg+xml...)![youtube](https://www.equalexperts.com/wp-content/uploads/2024/10/Youtube-Icon.svg)](https://www.youtube.com/user/EqualExperts)

