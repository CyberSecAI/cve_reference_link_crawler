```
{
  "cveId": "CVE-2024-26891",
  "related": true,
  "cveDescription": "PLACEHOLDER - Implement CVE description retrieval",
  "vulnerabilityDetails": {
    "rootCause": "When a hot-pluggable PCIe device is removed (either safely or unexpectedly), the system may attempt to send an IOMMU device-TLB invalidation request (ATS Invalidation) to the device. If the device is already disconnected, this request can lead to a deadlock as the IOMMU retries the request after an ITE (Invalid Translation Entry) fault in the interrupt context.",
    "weaknesses": [
      "The system does not check if a device is still connected before sending an ATS Invalidation request.",
      "The IOMMU retries invalid requests leading to a deadlock condition."
    ],
    "impact": "The vulnerability leads to a system hard lockup and kernel panic, causing a denial of service.",
    "attackVectors": [
      "Hot-unplugging (surprise removal) a PCIe endpoint device connected through a hotplug capable port.",
      "Flapping the device's link through the slot's link control register causing a hot reset."
    ],
    "requiredCapabilities": "The attacker needs to have physical access to the system and be able to trigger hotplug events on PCIe devices."
  },
   "patchDetails": {
        "fixes": "The patch introduces a check using `pci_dev_is_disconnected()` within the `devtlb_invalidation_with_pasid()` function to determine if the target device is still connected. If disconnected, the ATS Invalidation request is skipped, preventing the deadlock.",
        "safeRemoval": "For safe removals, the device is removed after the software handling process, and the device state is not set to `pci_channel_io_perm_failure`. The check will return false in this case, not interrupting the process.",
        "surpriseRemoval": "For surprise removals, the device state is set to `pci_channel_io_perm_failure`, indicating that the device is disconnected, and the check will return true and stop the invalidation request"
    }
}
```