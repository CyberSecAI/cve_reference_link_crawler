
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F2fd95c365f8477b26e06d60b999ddd36882d5750)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F2fd95c365f8477b26e06d60b999ddd36882d5750)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  850](/nautobot/nautobot/issues)
* [Pull requests
  20](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/2fd95c365f8477b26e06d60b999ddd36882d5750)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[LTM] View authentication and permission fixes ([#5465](https://github.com/nautobot/nautobot/pull/5465))

[Browse files](/nautobot/nautobot/tree/2fd95c365f8477b26e06d60b999ddd36882d5750)
Browse the repository at this point in the history

* Loading branch information

[![@glennmatthews](https://avatars.githubusercontent.com/u/5603551?s=40&v=4)](/glennmatthews)

[glennmatthews](/nautobot/nautobot/commits?author=glennmatthews "View all commits by glennmatthews")
authored
Mar 25, 2024

1 parent
[64217c3](/nautobot/nautobot/commit/64217c351cf2538778b70fff9fb9ac152a70877a)

commit 2fd95c3

 Show file tree

 Hide file tree

Showing
**47 changed files**
with
**517 additions**
and
**226 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changes

  + changes/5465.added
    [5465.added](#diff-fd06429a409928fc0e53b4ca1ff9999585a8a2f79a808ec82a15267f38398aa5)
  + changes/5465.changed
    [5465.changed](#diff-68a55e4b15eb6e0dfa73792c5bab44493ed797c04fc6c981b1fd0c3a2c7c22bb)
  + changes/5465.documentation
    [5465.documentation](#diff-bd79d980ebb4a1373038a8ac68f9e2d0b712a6e948fa041e88dad71b240fbf49)
  + changes/5465.fixed
    [5465.fixed](#diff-a2e4e4b0a674cbcafd9ac4c4cba72131f558fbd377bf7347ac6a771cc4c303aa)
  + changes/5465.housekeeping
    [5465.housekeeping](#diff-cef016529233fb76afb5f6996aa78ae5314b22341773685de890b7ecc8b9b038)
  + changes/5465.security
    [5465.security](#diff-bce0ec7bad33d36d57545eba760aebbd2b16c48eb93d38e654da9f1b5c818213)
* examples

  + example\_plugin/example\_plugin

    - api

      * examples/example\_plugin/example\_plugin/api/urls.py
        [urls.py](#diff-ba8d68828e92a5583730386aa5ac69f083ab79b2ac8c77b4a288ba7c4d8a3674)
    - examples/example\_plugin/example\_plugin/views.py
      [views.py](#diff-afab01605c9fc1898b5fddf8d69774c0b7ee6ca9b1d9d037b6f9f1824ee18814)
  + example\_plugin\_with\_view\_override/example\_plugin\_with\_view\_override

    - examples/example\_plugin\_with\_view\_override/example\_plugin\_with\_view\_override/views.py
      [views.py](#diff-68505ced32b8ea2ad126c920105f3b1fe3601c56aad17ce8a1ec8be62b6ad4cd)
* mkdocs.yml
  [mkdocs.yml](#diff-98d0f806abc9af24e6a7c545d3d77e8f9ad57643e27211d7a7b896113e420ed2)
* nautobot

  + apps

    - nautobot/apps/utils.py
      [utils.py](#diff-655d52b71e937ebea734e456132839c7e196b09e7e9b5ae45944a0b0c1cfa687)
    - nautobot/apps/views.py
      [views.py](#diff-bace14f05a18554b24ce04ab10b8ab7b1095396b94648d2e926050d6b1ae58f5)
  + circuits/api

    - nautobot/circuits/api/urls.py
      [urls.py](#diff-619f5ae773026decbe3d2e42309ceb25d42aac96cb6c8bd30330094dd3e5cce4)
    - nautobot/circuits/api/views.py
      [views.py](#diff-3533c8202506215052cc30468633031c2c2bc1f46a13d321a235f3db37244960)
  + core

    - api

      * nautobot/core/api/routers.py
        [routers.py](#diff-81850a2ccad5814aab4f477d447f85cc0a82e9c10fd88fd72327cda51a750471)
      * nautobot/core/api/views.py
        [views.py](#diff-220b8706cba160bd531aa47d67ede85abbbba543c4ed97e59d4dd3512025b7df)
    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
    - tests

      * integration

        + nautobot/core/tests/integration/test\_view\_authentication.py
          [test\_view\_authentication.py](#diff-4e1143b64b622f42a7bd49f1ebfa78e12a27a5bde74e697d3bd5e0c74677227a)
      * nautobot/core/tests/test\_graphql.py
        [test\_graphql.py](#diff-87f71776a9a648f5bee79cbee088f78674fe27d87e2a4a5e8456f1fee79600ac)
      * nautobot/core/tests/test\_views.py
        [test\_views.py](#diff-00a6cfd44a817c7ab283eb0579d628b4a3babbae8a02287aecf8e82bc5072d79)
    - views

      * nautobot/core/views/\_\_init\_\_.py
        [\_\_init\_\_.py](#diff-a40fd2fee9095757b6a07846cdf48a3750d07601e84f1c8b561e958b25925d2e)
      * nautobot/core/views/generic.py
        [generic.py](#diff-6d6d85115c2145f877fca192b072690e4d8945d576ca00bff5ad903cce84c2bc)
      * nautobot/core/views/mixins.py
        [mixins.py](#diff-4932b9507690a60fb07d0e2a2dbb48547dfe5c78dc55985ff4dfddb31c84a5bd)
  + dcim

    - api

      * nautobot/dcim/api/urls.py
        [urls.py](#diff-b37e35dcc7f45087fea3a95ffb5f2e3d098a3eb4b99d23e5f201f1361d5f7cd3)
      * nautobot/dcim/api/views.py
        [views.py](#diff-de75fbd56569d7e52a558275aa0f1c03a812f24d8ef4e0f7a3b258efa5c99d1d)
    - tests

      * nautobot/dcim/tests/test\_api.py
        [test\_api.py](#diff-f90e95b91927a0dd4dc90f6c74983a5360115b9f7cf02f1ac1111bebbe159882)
    - nautobot/dcim/views.py
      [views.py](#diff-292c4e491fa8d2a6b999f52af45f55576703202fa9bd731438c815c0af769af5)
  + docs/plugins

    - nautobot/docs/plugins/development.md
      [development.md](#diff-edf877d62fda6c866d898c76e7af3469cd18e50393f22cb3b33338a9439a6ca7)
  + extras

    - api

      * nautobot/extras/api/urls.py
        [urls.py](#diff-04d53e5bc4c3e8509be757090e24a8aeb3a795059292f3f272c5395254dbcd24)
      * nautobot/extras/api/views.py
        [views.py](#diff-9a2bdd132c5e3a0e6947134b0ae99c641837ad953eb9f5585633bf33e4a60dc9)
    - plugins

      * nautobot/extras/plugins/views.py
        [views.py](#diff-941f7b7f8ab1933f8ef6a9997c7de653871a67a187ae500b641b9356c2bdf677)
    - tests

      * nautobot/extras/tests/test\_views.py
        [test\_views.py](#diff-63390a9316fbabcd9c87d7ea0980d9ff2738d5da7d7def31e8f152d5fcf92996)
    - nautobot/extras/views.py
      [views.py](#diff-6dd19ea99cb9defb4b43f5c663a2d2e13821f93e1429b6b372452c1ec3eb06c4)
  + ipam

    - api

      * nautobot/ipam/api/urls.py
        [urls.py](#diff-7fed411e7dc6a1d1af649d8321bb288c01f36fd61bffa71741ed7d2ca20505aa)
      * nautobot/ipam/api/views.py
        [views.py](#diff-449b75151a29c86fd2fcd1ba1ae9a79e8f2d2e11aeb1affc24bc55bb16a6b22a)
    - tests

      * nautobot/ipam/tests/test\_graphql.py
        [test\_graphql.py](#diff-3c5cea33256b8ef507baf339d91e1141562895105e4d28f25fa6401564efaa56)
    - nautobot/ipam/views.py
      [views.py](#diff-caf8a412a9f30295cacfae888c0fbc1bdc2a7cd2643df55f444414f363113a7b)
  + tenancy/api

    - nautobot/tenancy/api/urls.py
      [urls.py](#diff-ff05a07dcb396c9545d5d901325374c8c595f62a84f4cfbd1a3adce8583d4664)
    - nautobot/tenancy/api/views.py
      [views.py](#diff-dc4b198ffc20c3686bd2282c95569f483509abc93736a5b6738570ac1e1191df)
  + users

    - api

      * nautobot/users/api/urls.py
        [urls.py](#diff-6f5024880c6f312f5c3e9836031560564aa41e155b39d4c41b01ce0475305a4e)
      * nautobot/users/api/views.py
        [views.py](#diff-61ef4672e35f4b114b1dea4720355dcfd3daa85b9b8cc4484f52a336d929fa9f)
    - nautobot/users/views.py
      [views.py](#diff-e637377dc56e6068f0b8ed0633bdd629231a933fa30ceda4d2b633fe474b3fe5)
  + utilities

    - nautobot/utilities/api.py
      [api.py](#diff-43d860c3789e7afc8bec662c0393b00d43bf0d7a8ad91f027766dde9f07526ee)
    - tests

      * nautobot/utilities/tests/test\_api.py
        [test\_api.py](#diff-ce252f3e1b3b5c99a1de6b1c9852377611be1608b8f2856fd2d3ecfda16b382d)
    - nautobot/utilities/utils.py
      [utils.py](#diff-1163f5bad3157eeb8af809244f6b84ad3b27580d2ba6ba4907e4c32525025a2c)
  + virtualization/api

    - nautobot/virtualization/api/urls.py
      [urls.py](#diff-c8d49a5d4fe921eaf3461bfe71c26dc3cf287b5866de9b872e60c059a9780212)
    - nautobot/virtualization/api/views.py
      [views.py](#diff-a455432acec2cb87de43e02e94be3545fd5b5585d340f9d2e4f71bca1194c680)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[changes/5465.added](#diff-fd06429a409928fc0e53b4ca1ff9999585a8a2f79a808ec82a15267f38398aa5 "changes/5465.added")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.added)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,2 @@ |
|  |  | Added `nautobot.apps.utils.get\_url\_for\_url\_pattern` and `nautobot.apps.utils.get\_url\_patterns` lookup functions. |
|  |  | Added `nautobot.apps.views.GenericView` base class. |

3 changes: 3 additions & 0 deletions

3
[changes/5465.changed](#diff-68a55e4b15eb6e0dfa73792c5bab44493ed797c04fc6c981b1fd0c3a2c7c22bb "changes/5465.changed")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.changed)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,3 @@ |
|  |  | Added support for `view\_name` and `view\_description` optional parameters when instantiating a `nautobot.apps.api.OrderedDefaultRouter`. Specifying these parameters is to be preferred over defining a custom `APIRootView` subclass when defining App API URLs. |
|  |  | Added requirement for user authentication by default on the `nautobot.core.api.AuthenticatedAPIRootView` class. As a consequence, viewing the browsable REST API root endpoints (e.g. `/api/`, `/api/circuits/`, `/api/dcim/`, etc.) now requires user authentication. |
|  |  | Added requirement for user authentication to access `/api/docs/` and `/graphql/` even when `HIDE\_RESTRICTED\_UI` is False. |

1 change: 1 addition & 0 deletions

1
[changes/5465.documentation](#diff-bd79d980ebb4a1373038a8ac68f9e2d0b712a6e948fa041e88dad71b240fbf49 "changes/5465.documentation")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.documentation)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Updated example views in the App developer documentation to include `ObjectPermissionRequiredMixin` or `LoginRequiredMixin` as appropriate best practices. |

1 change: 1 addition & 0 deletions

1
[changes/5465.fixed](#diff-a2e4e4b0a674cbcafd9ac4c4cba72131f558fbd377bf7347ac6a771cc4c303aa "changes/5465.fixed")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.fixed)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Fixed a 500 error when accessing any of the `/dcim/<port-type>/<uuid>/connect/<termination\_b\_type>/` view endpoints with an invalid/nonexistent `termination\_b\_type` string. |

1 change: 1 addition & 0 deletions

1
[changes/5465.housekeeping](#diff-cef016529233fb76afb5f6996aa78ae5314b22341773685de890b7ecc8b9b038 "changes/5465.housekeeping")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.housekeeping)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1 @@ |
|  |  | Updated custom views in the `example\_plugin` to use the new `GenericView` base class as a best practice. |

8 changes: 8 additions & 0 deletions

8
[changes/5465.security](#diff-bce0ec7bad33d36d57545eba760aebbd2b16c48eb93d38e654da9f1b5c818213 "changes/5465.security")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/changes/5465.security)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,8 @@ |
|  |  | Added requirement for user authentication to access the endpoint `/extras/job-results/<uuid:pk>/log-table/`; furthermore it will not allow an authenticated user to view log entries for a JobResult they don't otherwise have permission to view. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added narrower permissions enforcement on the endpoints `/extras/git-repositories/<str:slug>/sync/` and `/extras/git-repositories/<str:slug>/dry-run/`; a user who has `change` permissions for a subset of Git repositories is no longer permitted to sync or dry-run other repositories for which they lack the appropriate permissions. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added narrower permissions enforcement on the `/api/dcim/connected-device/?peer\_device=...&?peer\_interface=...` REST API endpoint; a user who has `view` permissions for a subset of interfaces is no longer permitted to query other interfaces for which they lack permissions. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added narrower permissions enforcement on all `<app>/<model>/<lookup>/notes/` UI endpoints; a user must now have the appropriate `extras.view\_note` permissions to view existing notes. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added requirement for user authentication to access the REST API endpoints `/api/redoc/`, `/api/swagger/`, `/api/swagger.json`, and `/api/swagger.yaml`. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added requirement for user authentication to access the `/api/graphql` REST API endpoint, even when `EXEMPT\_VIEW\_PERMISSIONS` is configured. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added requirement for user authentication to access the endpoints `/dcim/racks/<uuid>/dynamic-groups/`, `/dcim/devices/<uuid>/dynamic-groups/`, `/ipam/prefixes/<uuid>/dynamic-groups/`, `/ipam/ip-addresses/<uuid>/dynamic-groups/`, `/virtualization/clusters/<uuid>/dynamic-groups/`, and `/virtualization/virtual-machines/<uuid>/dynamic-groups/`, even when `EXEMPT\_VIEW\_PERMISSIONS` is configured. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |
|  |  | Added requirement for user authentication to access the endpoint `/extras/secrets/provider/<str:provider\_slug>/form/`. ([GHSA-m732-wvh2-7cq4](https://github.com/nautobot/nautobot/security/advisories/GHSA-m732-wvh2-7cq4)) |

2 changes: 1 addition & 1 deletion

2
[examples/example\_plugin/example\_plugin/api/urls.py](#diff-ba8d68828e92a5583730386aa5ac69f083ab79b2ac8c77b4a288ba7c4d8a3674 "examples/example_plugin/example_plugin/api/urls.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/examples/example_plugin/example_plugin/api/urls.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | from example\_plugin.api.views import AnotherExampleModelViewSet, ExampleModelViewSet, ExampleModelWebhook |
|  |  |  |
|  |  |  |
|  |  | router = OrderedDefaultRouter() |
|  |  | router = OrderedDefaultRouter(view\_name="Example App") |
|  |  | router.register("models", ExampleModelViewSet) |
|  |  | router.register("other-models", AnotherExampleModelViewSet) |
|  |  |  |
| Expand Down | |  |

7 changes: 3 additions & 4 deletions

7
[examples/example\_plugin/example\_plugin/views.py](#diff-afab01605c9fc1898b5fddf8d69774c0b7ee6ca9b1d9d037b6f9f1824ee18814 "examples/example_plugin/example_plugin/views.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/examples/example_plugin/example_plugin/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,4 @@ |
|  |  | from django.shortcuts import HttpResponse, render |
|  |  | from django.views.generic import View |
|  |  |  |
|  |  | from nautobot.apps import views |
|  |  | from nautobot.circuits.models import Circuit |
| Expand Down  Expand Up | | @@ -45,12 +44,12 @@ class DeviceDetailPluginTabTwoView(views.ObjectView): |
|  |  | template\_name = "example\_plugin/tab\_device\_detail\_2.html" |
|  |  |  |
|  |  |  |
|  |  | class ExamplePluginHomeView(View): |
|  |  | class ExamplePluginHomeView(views.GenericView): |
|  |  | def get(self, request): |
|  |  | return render(request, "example\_plugin/home.html") |
|  |  |  |
|  |  |  |
|  |  | class ExamplePluginConfigView(View): |
|  |  | class ExamplePluginConfigView(views.GenericView): |
|  |  | def get(self, request): |
|  |  | """Render the configuration page for this plugin. |
|  |  |  |
| Expand Down  Expand Up | | @@ -103,6 +102,6 @@ class AnotherExampleModelUIViewSet( |
|  |  | table\_class = tables.AnotherExampleModelTable |
|  |  |  |
|  |  |  |
|  |  | class ViewToBeOverridden(View): |
|  |  | class ViewToBeOverridden(views.GenericView): |
|  |  | def get(self, request, \*args, \*\*kwargs): |
|  |  | return HttpResponse("I am a view in the example plugin which will be overridden by another plugin.") |

5 changes: 3 additions & 2 deletions

5
[examples/example\_plugin\_with\_view\_override/example\_plugin\_with\_view\_override/views.py](#diff-68505ced32b8ea2ad126c920105f3b1fe3601c56aad17ce8a1ec8be62b6ad4cd "examples/example_plugin_with_view_override/example_plugin_with_view_override/views.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/examples/example_plugin_with_view_override/example_plugin_with_view_override/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,10 +1,11 @@ |
|  |  | """Views for plugin\_with\_view\_override.""" |
|  |  |  |
|  |  | from django.shortcuts import HttpResponse |
|  |  | from django.views import generic |
|  |  |  |
|  |  | from nautobot.apps.views import GenericView |
|  |  |  |
|  |  | class ViewOverride(generic.View): |
|  |  |  |
|  |  | class ViewOverride(GenericView): |
|  |  | def get(self, request, \*args, \*\*kwargs): |
|  |  | return HttpResponse("Hello world! I'm an overridden view.") |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[mkdocs.yml](#diff-98d0f806abc9af24e6a7c545d3d77e8f9ad57643e27211d7a7b896113e420ed2 "mkdocs.yml")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/mkdocs.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -297,6 +297,7 @@ nav: |
|  |  | - nautobot.apps.testing: "code-reference/nautobot/apps/testing.md" |
|  |  | - nautobot.apps.ui: "code-reference/nautobot/apps/ui.md" |
|  |  | - nautobot.apps.urls: "code-reference/nautobot/apps/urls.md" |
|  |  | - nautobot.apps.utils: "code-reference/nautobot/apps/utils.md" |
|  |  | - nautobot.apps.views: "code-reference/nautobot/apps/views.md" |
|  |  | - Core Developer Guide: |
|  |  | - Introduction: "development/index.md" |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[nautobot/apps/utils.py](#diff-655d52b71e937ebea734e456132839c7e196b09e7e9b5ae45944a0b0c1cfa687 "nautobot/apps/utils.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/apps/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,11 @@ |
|  |  | """Nautobot utility functions.""" |
|  |  |  |
|  |  | from nautobot.utilities.utils import ( |
|  |  | get\_url\_for\_url\_pattern, |
|  |  | get\_url\_patterns, |
|  |  | ) |
|  |  |  |
|  |  | \_\_all\_\_ = ( |
|  |  | "get\_url\_for\_url\_pattern", |
|  |  | "get\_url\_patterns", |
|  |  | ) |

3 changes: 2 additions & 1 deletion

3
[nautobot/apps/views.py](#diff-bace14f05a18554b24ce04ab10b8ab7b1095396b94648d2e926050d6b1ae58f5 "nautobot/apps/views.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/apps/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,6 @@ |
|  |  | """Utilities for apps to implement UI views.""" |
|  |  |  |
|  |  | from nautobot.core.views.generic import ObjectView |
|  |  | from nautobot.core.views.generic import GenericView, ObjectView |
|  |  | from nautobot.core.views.mixins import ( |
|  |  | ObjectBulkCreateViewMixin, |
|  |  | ObjectBulkDestroyViewMixin, |
| Expand All | | @@ -15,6 +15,7 @@ |
|  |  | from nautobot.core.views.viewsets import NautobotUIViewSet |
|  |  |  |
|  |  | \_\_all\_\_ = ( |
|  |  | "GenericView", |
|  |  | "NautobotUIViewSet", |
|  |  | "ObjectBulkCreateViewMixin", |
|  |  | "ObjectBulkDestroyViewMixin", |
| Expand Down | |  |

3 changes: 1 addition & 2 deletions

3
[nautobot/circuits/api/urls.py](#diff-619f5ae773026decbe3d2e42309ceb25d42aac96cb6c8bd30330094dd3e5cce4 "nautobot/circuits/api/urls.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/circuits/api/urls.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,8 +2,7 @@ |
|  |  | from . import views |
|  |  |  |
|  |  |  |
|  |  | router = OrderedDefaultRouter() |
|  |  | router.APIRootView = views.CircuitsRootView |
|  |  | router = OrderedDefaultRouter(view\_name="Circuits") |
|  |  |  |
|  |  | # Providers |
|  |  | router.register("providers", views.ProviderViewSet) |
| Expand Down | |  |

12 changes: 0 additions & 12 deletions

12
[nautobot/circuits/api/views.py](#diff-3533c8202506215052cc30468633031c2c2bc1f46a13d321a235f3db37244960 "nautobot/circuits/api/views.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/circuits/api/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,22 +1,10 @@ |
|  |  | from rest\_framework.routers import APIRootView |
|  |  |  |
|  |  | from nautobot.circuits import filters |
|  |  | from nautobot.circuits.models import Provider, CircuitTermination, CircuitType, Circuit, ProviderNetwork |
|  |  | from nautobot.dcim.api.views import PathEndpointMixin |
|  |  | from nautobot.extras.api.views import NautobotModelViewSet, StatusViewSetMixin |
|  |  | from nautobot.utilities.utils import count\_related |
|  |  | from . import serializers |
|  |  |  |
|  |  |  |
|  |  | class CircuitsRootView(APIRootView): |
|  |  | """ |
|  |  | Circuits API root view |
|  |  | """ |
|  |  |  |
|  |  | def get\_view\_name(self): |
|  |  | return "Circuits" |
|  |  |  |
|  |  |  |
|  |  | # |
|  |  | # Providers |
|  |  | # |
| Expand Down | |  |

37 changes: 35 additions & 2 deletions

37
[nautobot/core/api/routers.py](#diff-81850a2ccad5814aab4f477d447f85cc0a82e9c10fd88fd72327cda51a750471 "nautobot/core/api/routers.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/core/api/routers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,12 +1,34 @@ |
|  |  | from collections import OrderedDict |
|  |  | import logging |
|  |  |  |
|  |  | from rest\_framework.routers import DefaultRouter |
|  |  | from rest\_framework.permissions import IsAuthenticated |
|  |  | from rest\_framework.routers import APIRootView, DefaultRouter |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
|  |  |  |
|  |  | class AuthenticatedAPIRootView(APIRootView): |
|  |  | """ |
|  |  | Extends DRF's base APIRootView class to enforce user authentication. |
|  |  | """ |
|  |  |  |
|  |  | permission\_classes = [IsAuthenticated] |
|  |  |  |
|  |  | name = None |
|  |  | description = None |
|  |  |  |
|  |  |  |
|  |  | class OrderedDefaultRouter(DefaultRouter): |
|  |  | def \_\_init\_\_(self, \*args, \*\*kwargs): |
|  |  | APIRootView = AuthenticatedAPIRootView |
|  |  |  |
|  |  | def \_\_init\_\_(self, \*args, view\_name=None, view\_description=None, \*\*kwargs): |
|  |  | super().\_\_init\_\_(\*args, \*\*kwargs) |
|  |  |  |
|  |  | self.view\_name = view\_name |
|  |  | if view\_name and not view\_description: |
|  |  | view\_description = f"{view\_name} API root view" |
|  |  | self.view\_description = view\_description |
|  |  |  |
|  |  | # Extend the list view mappings to support the DELETE operation |
|  |  | self.routes[0].mapping.update( |
|  |  | { |
| Expand All | | @@ -22,7 +44,18 @@ def get\_api\_root\_view(self, api\_urls=None): |
|  |  | """ |
|  |  | api\_root\_dict = OrderedDict() |
|  |  | list\_name = self.routes[0].name |
|  |  |  |
|  |  | for prefix, \_viewset, basename in sorted(self.registry, key=lambda x: x[0]): |
|  |  | api\_root\_dict[prefix] = list\_name.format(basename=basename) |
|  |  |  |
|  |  | if issubclass(self.APIRootView, AuthenticatedAPIRootView): |
|  |  | return self.APIRootView.as\_view( |
|  |  | api\_root\_dict=api\_root\_dict, name=self.view\_name, description=self.view\_description |
|  |  | ) |
|  |  | # Fallback for the established practice of overriding self.APIRootView with a custom class |
|  |  | logger.warning( |
|  |  | "Something has changed an OrderedDefaultRouter's APIRootView attribute to a custom class. " |
|  |  | "Please verify that class %s implements appropriate authentication controls.", |
|  |  | self.APIRootView.\_\_name\_\_, |
|  |  | ) |
|  |  | return self.APIRootView.as\_view(api\_root\_dict=api\_root\_dict) |

29 changes: 12 additions & 17 deletions

29
[nautobot/core/api/views.py](#diff-220b8706cba160bd531aa47d67ede85abbbba543c4ed97e59d4dd3512025b7df "nautobot/core/api/views.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/core/api/views.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -17,7 +17,7 @@ |
|  |  | from rest\_framework.views import APIView |
|  |  | from rest\_framework.viewsets import ModelViewSet as ModelViewSet\_ |
|  |  | from rest\_framework.viewsets import ReadOnlyModelViewSet as ReadOnlyModelViewSet\_ |
|  |  | from rest\_framework.permissions import AllowAny, IsAuthenticated |
|  |  | from rest\_framework.permissions import IsAuthenticated |
|  |  | from rest\_framework.exceptions import PermissionDenied, ParseError |
|  |  | from drf\_spectacular.plumbing import get\_relative\_url, set\_query\_parameters |
|  |  | from drf\_spectacular.renderers import OpenApiJsonRenderer |
| Expand All | | @@ -35,8 +35,8 @@ |
|  |  | from nautobot.core.celery import app as celery\_app |
|  |  | from nautobot.core.api import BulkOperationSerializer |
|  |  | from nautobot.core.api.exceptions import SerializerNotFound |
|  |  | from nautobot.core.api.routers import AuthenticatedAPIRootView |
|  |  | from nautobot.utilities.api import get\_serializer\_for\_model |
|  |  | from nautobot.utilities.config import get\_settings\_or\_config |
|  |  | from nautobot.utilities.utils import ( |
|  |  | get\_all\_lookup\_expr\_for\_field, |
|  |  | get\_filterset\_parameter\_form\_field, |
| Expand Down  Expand Up | | @@ -323,18 +323,17 @@ class ReadOnlyModelViewSet(NautobotAPIVersionMixin, ModelViewSetMixin, ReadOnlyM |
|  |  | # |
|  |  |  |
|  |  |  |
|  |  | class APIRootView(NautobotAPIVersionMixin, APIView): |
|  |  | """ |
|  |  | This is the root of the REST API. API endpoints are arranged by app and model name; e.g. `/api/dcim/sites/`. |
|  |  | class APIRootView(NautobotAPIVersionMixin, AuthenticatedAPIRootView): |
|  |  | """ |
|  |  | This is the root of the REST API. |
|  |  |  |
|  |  | \_ignore\_model\_permissions = True |
|  |  | API endpoints are arranged by app and model name; e.g. `/api/dcim/locations/`. |
|  |  | """ |
|  |  |  |
|  |  | def get\_view\_name(self): |
|  |  | return "API Root" |
|  |  | name = "API Root" |
|  |  |  |
|  |  | @extend\_schema(exclude=True) |
|  |  | def get(self, request, format=None): # pylint: disable=redefined-builtin |
|  |  | def get(self, request, \*args, format=None, \*\*kwargs): # pylint: disable=redefined-builtin |
|  |  | return Response( |
|  |  | OrderedDict( |
|  |  | ( |
| Expand Down  Expand Up | | @@ -478,11 +477,6 @@ class FakeOpenAPIRenderer(OpenApiJsonRenderer): |
|  |  | @extend\_schema(exclude=True) |
|  |  | def get(self, request, \*args, \*\*kwargs): |
|  |  | """Fix up the rendering of the Swagger UI to work with Nautobot's UI.""" |
|  |  | if not request.user.is\_authenticated and get\_settings\_or\_config("HIDE\_RESTRICTED\_UI"): |
|  |  | doc\_url = reverse("api\_docs") |
|  |  | login\_url = reverse(settings.LOGIN\_URL) |
|  |  | return redirect(f"{login\_url}?next={doc\_url}") |
|  |  |  |
|  |  | # For backward compatibility wtih drf-yasg, `/api/docs/?format=openapi` is a redirect to the JSON schema. |
|  |  | if request.GET.get("format") == "openapi": |
|  |  | return redirect("schema\_json", permanent=True) |
| Expand Down  Expand Up | | @@ -511,11 +505,12 @@ class NautobotSpectacularRedocView(APIVersioningGetSchemaURLMixin, SpectacularRe |
|  |  | class GraphQLDRFAPIView(NautobotAPIVersionMixin, APIView): |
|  |  | """ |
|  |  | API View for GraphQL to integrate properly with DRF authentication mechanism. |
|  |  | The code is a stripped down version of graphene-django default View |
|  |  | https://github.com/graphql-python/graphene-django/blob/main/graphene\_django/views.py#L57 |
|  |  | """ |
|  |  |  |
|  |  | permission\_classes = [AllowAny] |
|  |  | # The code is a stripped down version of graphene-django default View |
|  |  | # https://github.com/graphql-python/graphene-django/blob/main/graphene\_django/views.py#L57 |
|  |  |  |
|  |  | permission\_classes = [IsAuthenticated] |
|  |  | graphql\_schema = None |
|  |  | executor = None |
|  |  | backend = None |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -243,6 +243,7 @@ |
|  |  | # trim it from all of the individual paths correspondingly. |
|  |  | # See also https://github.com/nautobot/nautobot-ansible/pull/135 for an example of why this is desirable. |
|  |  | "SERVERS": [{"url": "/api"}], |
|  |  | "SERVE\_PERMISSIONS": ["rest\_framework.permissions.IsAuthenticated"], |
|  |  | "SCHEMA\_PATH\_PREFIX": "/api", |
|  |  | "SCHEMA\_PATH\_PREFIX\_TRIM": True, |
|  |  | # use sidecar - locally packaged UI files, not CDN |
| Expand Down | |  |

72 changes: 72 additions & 0 deletions

72
[nautobot/core/tests/integration/test\_view\_authentication.py](#diff-4e1143b64b622f42a7bd49f1ebfa78e12a27a5bde74e697d3bd5e0c74677227a "nautobot/core/tests/integration/test_view_authentication.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/core/tests/integration/test_view_authentication.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,72 @@ |
|  |  | import re |
|  |  |  |
|  |  | from django.test import override\_settings, tag |
|  |  |  |
|  |  | from nautobot.utilities.testing import TestCase |
|  |  | from nautobot.utilities.utils import get\_url\_for\_url\_pattern, get\_url\_patterns |
|  |  |  |
|  |  |  |
|  |  | @tag("integration") |
|  |  | class AuthenticationEnforcedTestCase(TestCase): |
|  |  | r""" |
|  |  | Test that all\\* registered views require authentication to access. |
|  |  |  |
|  |  | \\* with a very small number of known exceptions such as login and logout views. |
|  |  | """ |
|  |  |  |
|  |  | @override\_settings(HIDE\_RESTRICTED\_UI=True) |
|  |  | def test\_all\_views\_require\_authentication(self): |
|  |  | self.client.logout() |
|  |  | url\_patterns = get\_url\_patterns() |
|  |  |  |
|  |  | for url\_pattern in url\_patterns: |
|  |  | with self.subTest(url\_pattern=url\_pattern): |
|  |  | url = get\_url\_for\_url\_pattern(url\_pattern) |
|  |  | response = self.client.get(url, follow=True) |
|  |  |  |
|  |  | if response.status\_code == 405: # Method not allowed |
|  |  | response = self.client.post(url, follow=True) |
|  |  |  |
|  |  | # Is a view that \*should\* be open to unauthenticated users? |
|  |  | if url in [ |
|  |  | "/admin/login/", |
|  |  | "/api/plugins/example-plugin/webhook/", |
|  |  | "/health/", |
|  |  | "/login/", |
|  |  | "/media-failure/", |
|  |  | "/metrics/", |
|  |  | ]: |
|  |  | self.assertHttpStatus(response, 200, msg=url) |
|  |  | elif response.status\_code == 200: |
|  |  | # UI views generally should redirect unauthenticated users to the appropriate login page |
|  |  | if url.startswith("/extras/jobs/results/"): |
|  |  | redirect\_url = f"/login/?next={re.sub('jobs/results', 'job-results', url)}" |
|  |  | elif url.startswith("/admin"): |
|  |  | if "logout" in url: |
|  |  | # /admin/logout/ sets next=/admin/ because having login redirect to logout would be silly |
|  |  | redirect\_url = "/admin/login/?next=/admin/" |
|  |  | else: |
|  |  | redirect\_url = f"/admin/login/?next={url}" |
|  |  | else: |
|  |  | if "logout" in url: |
|  |  | # /logout/ sets next=/ because having login redirect back to logout would be silly |
|  |  | redirect\_url = "/login/?next=/" |
|  |  | else: |
|  |  | redirect\_url = f"/login/?next={url}" |
|  |  | self.assertRedirects(response, redirect\_url) |
|  |  | elif response.status\_code != 403: |
|  |  | if any( |
|  |  | url.startswith(path) |
|  |  | for path in [ |
|  |  | "/complete/", # social auth |
|  |  | "/login/", # social auth |
|  |  | "/media/", # MEDIA\_ROOT |
|  |  | "/plugins/example-plugin/docs/", # STATIC\_ROOT |
|  |  | ] |
|  |  | ): |
|  |  | self.assertEqual(response.status\_code, 404) |
|  |  | else: |
|  |  | self.fail( |
|  |  | f"Unexpected {response.status\_code} response at {url}: " |
|  |  | + response.content.decode(response.charset) |
|  |  | ) |

16 changes: 2 additions & 14 deletions

16
[nautobot/core/tests/test\_graphql.py](#diff-87f71776a9a648f5bee79cbee088f78674fe27d87e2a4a5e8456f1fee79600ac "nautobot/core/tests/test_graphql.py")

Show comments

[View file](/nautobot/nautobot/blob/2fd95c365f8477b26e06d60b999ddd36882d5750/nautobot/core/tests/test_graphql.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -593,21 +593,9 @@ def test\_graphql\_api\_token\_no\_group\_exempt(self): |
|  |  | self.assertEqual(names, ["Rack 1-1", "Rack 1-2", "Rack 2-1", "Rack 2-2"]) |
|  |  |  |
|  |  | def test\_graphql\_api\_no\_token(self): |
|  |  | """Validate unauthenticated users are not able to query anything by default.""" |
|  |  | """Validate unauthenticated users are not able to query anything.""" |
|  |  | response = self.client.post(self.api\_url, {"query": self.get\_racks\_query}, format="json") |
|  |  | self.assertEqual(response.status\_code, status.HTTP\_200\_OK) |
|  |  | self.assertIsInstance(response.data["data"]["racks"], list) |
|  |  | names = [item["name"] for item in response.data["data"]["racks"]] |
|  |  | self.assertEqual(names, []) |
|  |  |  |
|  |  | @override\_settings(EXEMPT\_VIEW\_PERMISSIONS=["\*"]) |
|  |  | def test\_graphql\_api\_no\_token\_exempt(self): |
|  |  | """Validate unauthenticated users are able to query based on the exempt permissions.""" |
|  |  | response = self.client.post(self.api\_url, {"query": self.get\_racks\_query}, format="json") |
|  |  | self.assertEqual(response.status\_code, status.HTTP\_200\_OK) |
|  |  | self.assertIsInstance(response.data["data"]["racks"], list) |
|  |  | names = [item["name"] for item in response.data["data"]["racks"]] |
|  |  | self.assertEqual(names, ["Rack 1-1", "Rack 1-2", "Rack 2-1", "Rack 2-2"]) |
|  |  | self.assertEqual(response.status\_code, status.HTTP\_403\_FORBIDDEN) |
|  |  |  |
|  |  | def test\_graphql\_api\_wrong\_token(self): |
|  |  | """Validate a wrong token return 403.""" |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2fd95c3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2F2fd95c365f8477b26e06d60b999ddd36882d5750) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

