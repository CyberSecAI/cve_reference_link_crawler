

| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jens Axboe <axboe@kernel.dk> | 2021-09-12 06:45:07 -0600 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@kernel.dk> | 2021-09-12 19:27:47 -0600 |
| commit | [16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)) | |
| tree | [0f4333c5ca72c75f502e78d4c806c5614a78dd37](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc) | |
| parent | [6880fa6c56601bb8ed59df6c30fd390cc5f6dd8f](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6880fa6c56601bb8ed59df6c30fd390cc5f6dd8f) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc&id2=6880fa6c56601bb8ed59df6c30fd390cc5f6dd8f)) | |
| download | [linux-16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc.tar.gz) | |

io\_uring: ensure symmetry in handling iter types in loop\_rw\_iter()When setting up the next segment, we check what type the iter is and
handle it accordingly. However, when incrementing and processed amount
we do not, and both iter advance and addr/len are adjusted, regardless
of type. Split the increment side just like we do on the setup side.
Fixes: 4017eb91a9e7 ("io\_uring: make loop\_rw\_iter() use original user supplied pointers")
Cc: stable@vger.kernel.org
Reported-by: Valentina Palmiotti <vpalmiotti@gmail.com>
Reviewed-by: Pavel Begunkov <asml.silence@gmail.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/io_uring.c?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 3 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex 16fb7436043c27..66a7414c375688 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/io_uring.c?id=6880fa6c56601bb8ed59df6c30fd390cc5f6dd8f)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/io_uring.c?id=16c8d2df7ec0eed31b7d3b61cb13206a7fb930cc)@@ -3263,12 +3263,15 @@ static ssize\_t loop\_rw\_iter(int rw, struct io\_kiocb \*req, struct iov\_iter \*iter) ret = nr; break; }+ if (!iov\_iter\_is\_bvec(iter)) {+ iov\_iter\_advance(iter, nr);+ } else {+ req->rw.len -= nr;+ req->rw.addr += nr;+ } ret += nr; if (nr != iovec.iov\_len) break;- req->rw.len -= nr;- req->rw.addr += nr;- iov\_iter\_advance(iter, nr); }  return ret; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-08 13:09:52 +0000

