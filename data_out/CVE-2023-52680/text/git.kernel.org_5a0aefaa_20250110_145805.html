

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Geoffrey D. Bennett <g@b4.vu> | 2023-12-20 04:07:37 +1030 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:35:39 -0800 |
| commit | [821fbaeaaae23d483d3df799fe91ec8045973ec3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)) | |
| tree | [a005769d1d2d1880c3d6be2c18b168476c48ea2b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3) | |
| parent | [66fb87fac545583bfb441bc4d6dffd99a7b38a48](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=66fb87fac545583bfb441bc4d6dffd99a7b38a48) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3&id2=66fb87fac545583bfb441bc4d6dffd99a7b38a48)) | |
| download | [linux-821fbaeaaae23d483d3df799fe91ec8045973ec3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-821fbaeaaae23d483d3df799fe91ec8045973ec3.tar.gz) | |

ALSA: scarlett2: Add missing error checks to \*\_ctl\_get()[ Upstream commit 50603a67daef161c78c814580d57f7f0be57167e ]
The \*\_ctl\_get() functions which call scarlett2\_update\_\*() were not
checking the return value. Fix to check the return value and pass to
the caller.
Signed-off-by: Geoffrey D. Bennett <g@b4.vu>
Fixes: 9e4d5c1be21f ("ALSA: usb-audio: Scarlett Gen 2 mixer interface")
Link: [https://lore.kernel.org/r/32a5fdc83b05fa74e0fcdd672fbf71d75c5f0a6d.1703001053.git.g@b4.vu](https://lore.kernel.org/r/32a5fdc83b05fa74e0fcdd672fbf71d75c5f0a6d.1703001053.git.g%40b4.vu)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)

| -rw-r--r-- | [sound/usb/mixer\_scarlett\_gen2.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/usb/mixer_scarlett_gen2.c?id=821fbaeaaae23d483d3df799fe91ec8045973ec3) | 182 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 130 insertions, 52 deletions

| diff --git a/sound/usb/mixer\_scarlett\_gen2.c b/sound/usb/mixer\_scarlett\_gen2.cindex 5e3118bd0dc1a1..087e120d710341 100644--- a/[sound/usb/mixer\_scarlett\_gen2.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/mixer_scarlett_gen2.c?id=66fb87fac545583bfb441bc4d6dffd99a7b38a48)+++ b/[sound/usb/mixer\_scarlett\_gen2.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/usb/mixer_scarlett_gen2.c?id=821fbaeaaae23d483d3df799fe91ec8045973ec3)@@ -1798,14 +1798,20 @@ static int scarlett2\_sync\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->sync\_updated)- scarlett2\_update\_sync(mixer);++ if (private->sync\_updated) {+ err = scarlett2\_update\_sync(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->sync;- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static const struct snd\_kcontrol\_new scarlett2\_sync\_ctl = {@@ -1888,14 +1894,20 @@ static int scarlett2\_master\_volume\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->vol\_updated)- scarlett2\_update\_volumes(mixer);- mutex\_unlock(&private->data\_mutex); + if (private->vol\_updated) {+ err = scarlett2\_update\_volumes(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->master\_vol;- return 0;++unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int line\_out\_remap(struct scarlett2\_data \*private, int index)@@ -1921,14 +1933,20 @@ static int scarlett2\_volume\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data; int index = line\_out\_remap(private, elem->control);+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->vol\_updated)- scarlett2\_update\_volumes(mixer);- mutex\_unlock(&private->data\_mutex); + if (private->vol\_updated) {+ err = scarlett2\_update\_volumes(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->vol[index];- return 0;++unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_volume\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -1995,14 +2013,20 @@ static int scarlett2\_mute\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data; int index = line\_out\_remap(private, elem->control);+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->vol\_updated)- scarlett2\_update\_volumes(mixer);- mutex\_unlock(&private->data\_mutex); + if (private->vol\_updated) {+ err = scarlett2\_update\_volumes(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->mute\_switch[index];- return 0;++unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_mute\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -2248,14 +2272,20 @@ static int scarlett2\_level\_enum\_ctl\_get(struct snd\_kcontrol \*kctl, const struct scarlett2\_device\_info \*info = private->info;  int index = elem->control + info->level\_input\_first;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->input\_other\_updated)- scarlett2\_update\_input\_other(mixer);++ if (private->input\_other\_updated) {+ err = scarlett2\_update\_input\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->level\_switch[index];- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_level\_enum\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -2306,15 +2336,21 @@ static int scarlett2\_pad\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->input\_other\_updated)- scarlett2\_update\_input\_other(mixer);++ if (private->input\_other\_updated) {+ err = scarlett2\_update\_input\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->pad\_switch[elem->control];- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_pad\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -2364,14 +2400,20 @@ static int scarlett2\_air\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->input\_other\_updated)- scarlett2\_update\_input\_other(mixer);++ if (private->input\_other\_updated) {+ err = scarlett2\_update\_input\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->air\_switch[elem->control];- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_air\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -2421,15 +2463,21 @@ static int scarlett2\_phantom\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->input\_other\_updated)- scarlett2\_update\_input\_other(mixer);++ if (private->input\_other\_updated) {+ err = scarlett2\_update\_input\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->phantom\_switch[elem->control];- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_phantom\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -2601,14 +2649,20 @@ static int scarlett2\_direct\_monitor\_ctl\_get( struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = elem->head.mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->monitor\_other\_updated)- scarlett2\_update\_monitor\_other(mixer);++ if (private->monitor\_other\_updated) {+ err = scarlett2\_update\_monitor\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->direct\_monitor\_switch;- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_direct\_monitor\_ctl\_put(@@ -2708,14 +2762,20 @@ static int scarlett2\_speaker\_switch\_enum\_ctl\_get( struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->monitor\_other\_updated)- scarlett2\_update\_monitor\_other(mixer);++ if (private->monitor\_other\_updated) {+ err = scarlett2\_update\_monitor\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->speaker\_switching\_switch;- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  /\* when speaker switching gets enabled, switch the main/alt speakers@@ -2863,14 +2923,20 @@ static int scarlett2\_talkback\_enum\_ctl\_get( struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->monitor\_other\_updated)- scarlett2\_update\_monitor\_other(mixer);++ if (private->monitor\_other\_updated) {+ err = scarlett2\_update\_monitor\_other(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->talkback\_switch;- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_talkback\_enum\_ctl\_put(@@ -3018,14 +3084,20 @@ static int scarlett2\_dim\_mute\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_elem\_info \*elem = kctl->private\_data; struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data;+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->vol\_updated)- scarlett2\_update\_volumes(mixer);- mutex\_unlock(&private->data\_mutex); + if (private->vol\_updated) {+ err = scarlett2\_update\_volumes(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.integer.value[0] = private->dim\_mute[elem->control];- return 0;++unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_dim\_mute\_ctl\_put(struct snd\_kcontrol \*kctl,@@ -3396,14 +3468,20 @@ static int scarlett2\_mux\_src\_enum\_ctl\_get(struct snd\_kcontrol \*kctl, struct usb\_mixer\_interface \*mixer = elem->head.mixer; struct scarlett2\_data \*private = mixer->private\_data; int index = line\_out\_remap(private, elem->control);+ int err = 0;  mutex\_lock(&private->data\_mutex);- if (private->mux\_updated)- scarlett2\_usb\_get\_mux(mixer);++ if (private->mux\_updated) {+ err = scarlett2\_usb\_get\_mux(mixer);+ if (err < 0)+ goto unlock;+ } ucontrol->value.enumerated.item[0] = private->mux[index];- mutex\_unlock(&private->data\_mutex); - return 0;+unlock:+ mutex\_unlock(&private->data\_mutex);+ return err; }  static int scarlett2\_mux\_src\_enum\_ctl\_put(struct snd\_kcontrol \*kctl, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:56:42 +0000

