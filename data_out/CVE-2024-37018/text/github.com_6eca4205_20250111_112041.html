
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmzc796%2Fmarionette_onos)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmzc796%2Fmarionette_onos)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=mzc796%2Fmarionette_onos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mzc796](/mzc796)
/
**[marionette\_onos](/mzc796/marionette_onos)**
Public

* [Notifications](/login?return_to=%2Fmzc796%2Fmarionette_onos) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fmzc796%2Fmarionette_onos)
* [Star
   1](/login?return_to=%2Fmzc796%2Fmarionette_onos)

demo code of marionette attack on onos cluster

### License

[MIT license](/mzc796/marionette_onos/blob/master/LICENSE)

[1
star](/mzc796/marionette_onos/stargazers) [0
forks](/mzc796/marionette_onos/forks) [Branches](/mzc796/marionette_onos/branches) [Tags](/mzc796/marionette_onos/tags) [Activity](/mzc796/marionette_onos/activity)
 [Star](/login?return_to=%2Fmzc796%2Fmarionette_onos)

 [Notifications](/login?return_to=%2Fmzc796%2Fmarionette_onos) You must be signed in to change notification settings

* [Code](/mzc796/marionette_onos)
* [Issues
  0](/mzc796/marionette_onos/issues)
* [Pull requests
  0](/mzc796/marionette_onos/pulls)
* [Actions](/mzc796/marionette_onos/actions)
* [Projects
  0](/mzc796/marionette_onos/projects)
* [Security](/mzc796/marionette_onos/security)
* [Insights](/mzc796/marionette_onos/pulse)

Additional navigation options

* [Code](/mzc796/marionette_onos)
* [Issues](/mzc796/marionette_onos/issues)
* [Pull requests](/mzc796/marionette_onos/pulls)
* [Actions](/mzc796/marionette_onos/actions)
* [Projects](/mzc796/marionette_onos/projects)
* [Security](/mzc796/marionette_onos/security)
* [Insights](/mzc796/marionette_onos/pulse)

# mzc796/marionette\_onos

    master[Branches](/mzc796/marionette_onos/branches)[Tags](/mzc796/marionette_onos/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[76 Commits](/mzc796/marionette_onos/commits/master/) | | |
| [LICENSE](/mzc796/marionette_onos/blob/master/LICENSE "LICENSE") | | [LICENSE](/mzc796/marionette_onos/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/mzc796/marionette_onos/blob/master/README.md "README.md") | | [README.md](/mzc796/marionette_onos/blob/master/README.md "README.md") |  |  |
| [build\_atomix\_dockers.sh](/mzc796/marionette_onos/blob/master/build_atomix_dockers.sh "build_atomix_dockers.sh") | | [build\_atomix\_dockers.sh](/mzc796/marionette_onos/blob/master/build_atomix_dockers.sh "build_atomix_dockers.sh") |  |  |
| [build\_onos\_dockers.sh](/mzc796/marionette_onos/blob/master/build_onos_dockers.sh "build_onos_dockers.sh") | | [build\_onos\_dockers.sh](/mzc796/marionette_onos/blob/master/build_onos_dockers.sh "build_onos_dockers.sh") |  |  |
| [del\_flow.sh](/mzc796/marionette_onos/blob/master/del_flow.sh "del_flow.sh") | | [del\_flow.sh](/mzc796/marionette_onos/blob/master/del_flow.sh "del_flow.sh") |  |  |
| [get\_devices.sh](/mzc796/marionette_onos/blob/master/get_devices.sh "get_devices.sh") | | [get\_devices.sh](/mzc796/marionette_onos/blob/master/get_devices.sh "get_devices.sh") |  |  |
| [get\_flows.sh](/mzc796/marionette_onos/blob/master/get_flows.sh "get_flows.sh") | | [get\_flows.sh](/mzc796/marionette_onos/blob/master/get_flows.sh "get_flows.sh") |  |  |
| [get\_links.py](/mzc796/marionette_onos/blob/master/get_links.py "get_links.py") | | [get\_links.py](/mzc796/marionette_onos/blob/master/get_links.py "get_links.py") |  |  |
| [get\_topo.sh](/mzc796/marionette_onos/blob/master/get_topo.sh "get_topo.sh") | | [get\_topo.sh](/mzc796/marionette_onos/blob/master/get_topo.sh "get_topo.sh") |  |  |
| [link\_pois.sh](/mzc796/marionette_onos/blob/master/link_pois.sh "link_pois.sh") | | [link\_pois.sh](/mzc796/marionette_onos/blob/master/link_pois.sh "link_pois.sh") |  |  |
| [link\_pois\_opposit.sh](/mzc796/marionette_onos/blob/master/link_pois_opposit.sh "link_pois_opposit.sh") | | [link\_pois\_opposit.sh](/mzc796/marionette_onos/blob/master/link_pois_opposit.sh "link_pois_opposit.sh") |  |  |
| [match\_inport\_vlan.sh](/mzc796/marionette_onos/blob/master/match_inport_vlan.sh "match_inport_vlan.sh") | | [match\_inport\_vlan.sh](/mzc796/marionette_onos/blob/master/match_inport_vlan.sh "match_inport_vlan.sh") |  |  |
| [match\_vlan.sh](/mzc796/marionette_onos/blob/master/match_vlan.sh "match_vlan.sh") | | [match\_vlan.sh](/mzc796/marionette_onos/blob/master/match_vlan.sh "match_vlan.sh") |  |  |
| [mn\_run.sh](/mzc796/marionette_onos/blob/master/mn_run.sh "mn_run.sh") | | [mn\_run.sh](/mzc796/marionette_onos/blob/master/mn_run.sh "mn_run.sh") |  |  |
| [motivating\_example\_topo.py](/mzc796/marionette_onos/blob/master/motivating_example_topo.py "motivating_example_topo.py") | | [motivating\_example\_topo.py](/mzc796/marionette_onos/blob/master/motivating_example_topo.py "motivating_example_topo.py") |  |  |
| [pop\_reflect\_vlan.sh](/mzc796/marionette_onos/blob/master/pop_reflect_vlan.sh "pop_reflect_vlan.sh") | | [pop\_reflect\_vlan.sh](/mzc796/marionette_onos/blob/master/pop_reflect_vlan.sh "pop_reflect_vlan.sh") |  |  |
| [pop\_vlan.sh](/mzc796/marionette_onos/blob/master/pop_vlan.sh "pop_vlan.sh") | | [pop\_vlan.sh](/mzc796/marionette_onos/blob/master/pop_vlan.sh "pop_vlan.sh") |  |  |
| [pop\_vlan\_outport.sh](/mzc796/marionette_onos/blob/master/pop_vlan_outport.sh "pop_vlan_outport.sh") | | [pop\_vlan\_outport.sh](/mzc796/marionette_onos/blob/master/pop_vlan_outport.sh "pop_vlan_outport.sh") |  |  |
| [push\_reflect\_vlan.sh](/mzc796/marionette_onos/blob/master/push_reflect_vlan.sh "push_reflect_vlan.sh") | | [push\_reflect\_vlan.sh](/mzc796/marionette_onos/blob/master/push_reflect_vlan.sh "push_reflect_vlan.sh") |  |  |
| [push\_vlan.sh](/mzc796/marionette_onos/blob/master/push_vlan.sh "push_vlan.sh") | | [push\_vlan.sh](/mzc796/marionette_onos/blob/master/push_vlan.sh "push_vlan.sh") |  |  |
| [restart\_onos\_cluster.sh](/mzc796/marionette_onos/blob/master/restart_onos_cluster.sh "restart_onos_cluster.sh") | | [restart\_onos\_cluster.sh](/mzc796/marionette_onos/blob/master/restart_onos_cluster.sh "restart_onos_cluster.sh") |  |  |
| [rm\_atomix.sh](/mzc796/marionette_onos/blob/master/rm_atomix.sh "rm_atomix.sh") | | [rm\_atomix.sh](/mzc796/marionette_onos/blob/master/rm_atomix.sh "rm_atomix.sh") |  |  |
| [rm\_onos.sh](/mzc796/marionette_onos/blob/master/rm_onos.sh "rm_onos.sh") | | [rm\_onos.sh](/mzc796/marionette_onos/blob/master/rm_onos.sh "rm_onos.sh") |  |  |
| [sys\_prep.sh](/mzc796/marionette_onos/blob/master/sys_prep.sh "sys_prep.sh") | | [sys\_prep.sh](/mzc796/marionette_onos/blob/master/sys_prep.sh "sys_prep.sh") |  |  |
| [topo\_poison.sh](/mzc796/marionette_onos/blob/master/topo_poison.sh "topo_poison.sh") | | [topo\_poison.sh](/mzc796/marionette_onos/blob/master/topo_poison.sh "topo_poison.sh") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# Artifact on Zenodo

<https://doi.org/10.5281/zenodo.12786197>

# Video Demo

<https://www.youtube.com/watch?v=lwAGYcCBOxc>

# Part 1: Marionette on ONOS Cluster with Motivating Example Topology

Marionette attacks the ONOS cluster from a malicious ONOS to manipulate links in Figure 1 motivating example topology with Mininet to demonstrate its capability of precise link manipulation while maintaining the same degree sequence. We also show the difference in the routings by ONOS reactive forwarding before and after the attack.

## Virtual Machine Platform

VMware Fusion

## Virtual Machine Summary

Memory: 8GB

Storage: 20GB

CPU: 2 cores, AMD64 Architecture

Installation Disc: ubuntu-22.04.4-desktop-amd64.iso

NOTE: After installation and rebooting the VM, please DO NOT select `Install Now` when the `Software Updater` window pops up. Otherwise, it may cause an error of 'not enough space' later.

## Software Dependencies

1. ONOS (v1.4 and after)
2. Mininet (any version supports OpenFlow v1.3)

## Build and Run an ONOS Cluster with Mininet:

1. Download the `marionette_onos.zip` and extract it to $HOME

   NOTE: If you download the code from GitHub and the name is `marionette_onos-master.zip`, please change the folder name to `marionette_onos` after extracting it to $HOME.
2. Change the privilege

   ```
   cd marionette_onos/
   sudo chmod 774 sys_prep.sh build_atomix_dockers.sh build_onos_dockers.sh mn_run.sh restart_onos_cluster.sh

   ```
3. Prepare the system

   `sudo ./sys_prep.sh`
4. Add and activate $USER to the docker group. $USER is the recent user of your Ubuntu system

   ```
   sudo usermod -aG docker $USER
   newgrp docker

   ```
5. Install and run atomix dockers. We give atomix-1, atomix-2, and atomix-3 IP Addresses 172.17.0.2, 172.17.0.3, and 172.17.0.4, respectively.

   `./build_atomix_dockers.sh`
6. Install and run onos dockers. The onos-1, onos-2, onos-3 have IP Addresses 172.17.0.5, 172.17.0.6, and 172.17.0.7, respectively.

   `./build_onos_dockers.sh`
7. Login the ONOS UI
   click Firefox, access <http://172.17.0.5:8181/onos/ui>, <http://172.17.0.6:8181/onos/ui>, <http://172.17.0.7:8181/onos/ui>

```
    user: onos
    password: rocks

```

8. After the ONOS UI is loaded, there should be three ONOS listed on each of the UIs as they build a cluster.
9. On <http://172.17.0.5:8181/onos/ui>, click the menu on the top left, go to Application, search openflow, choose OpenFlow Provider Suite, click the triangle on the top right to activate this application, confirm-> Okay.
10. Still on the Application list, search fwd, choose Reactive Forwarding, click the triangle on the top right to activate this application, confirm-> Okay.
11. Run Mininet to connect with ONOS-1 and ONOS-2 but not ONOS-3.

    Open another teriminal

    ```
    cd marionette_onos/
    sudo ./mn_run.sh

    ```

    Wait for seconds and go back to refresh the browsers for each of the three controllers, you should be able to see a 5-node topology.
12. Trigger Host Discovery
    on Mininet terminal:

    `mininet>h1 ping h2`

    On the UI, click Menu->Network->Hosts, we will find h1 and h2.
13. Host Discovery on UIs

    On Topology GUI, hit the 'H' key on the keyboard, and the hosts will show up. For details, see [https://wiki.onosproject.org/display/ONOS/Basic+ONOS+Tutorial#:~:text=To%20toggle%20between%20showing%20and,which%20they%20are%20the%20master](https://wiki.onosproject.org/display/ONOS/Basic%2BONOS%2BTutorial#:~:text=To%20toggle%20between%20showing%20and,which%20they%20are%20the%20master).

    NOTE: Now we can see the shortest path from h1 to h2 is `h1->sw1->sw4->sw5->h2` as shown on the Topology GUI.
14. Check Flow Entries and Shortest Path Routing

    On the UI, click Menu->Network->Devices. Choose `of:0000000000000001` (sw1). On the top right, click `show flow view for selected device`, we can see that sw1 has been configured two flow entries by `Application: fwd` to forward the packets of h1 ping h2. Similarly, we will find that sw4 and sw5 are also configured with flow entries to support h1 ping h2. `sw1->sw4->sw5` is the shortest path as we can see from the topology.
15. Stop h1 ping h2 with `Control+C` on the Mininet terminal to prepare for the next step demo.

## Marionette Attack

1. Open another terminal to initiate the attack on ONOS-3
   ```
   cd marionette_onos
   ./topo_poison.sh 7

   ```

   NOTE: 7 is the last digit of onos-3's IP address which means we want to attack from onos-3

### Result

1. The dynamic topology can be noticed on the ONOS UIs.
2. Refresh the Web UIs to clear cached expired links. The topology seems the same as before since the degree sequence is maintained. But now, sw1 connects to sw2 and sw3 is between s1 and sw4, showing the success of the Marionette attack.
3. Now we can see the shortest path from h1 to h2 is `h1->sw1->sw2->sw5->h2` as shown on the Topology GUI.
4. On Mininet terminal, `mininet> h1 ping h2`. On ONOS UIs, we will find that sw1, sw2, and sw5 have flow entries configured by `Application: fwd`, which means the legitimate ONOS-1, ONOS-2 discover

## Controller Impersonating Attack (Optional)

We also found that both the ONOS and OpenDaylight cluster implementations are insecure. If one of the controller peers is down, a malicious controller with an incomplete cluster configuration can join the cluster. This experiment strengthens the motivation of the Marionette work and validates the assumption of a malicious controller in the cluster.

In the case of this ONOS cluster:

On the docker terminal:

1. We shut down ONOS-3:
   `docker stop onos-3`

   Go back to the UIs, the onos-3 disappears.
2. Build onos-mal and check its IP Address

   ```
   docker run -t -d --name onos-mal onosproject/onos:2.2.2
   docker inspect onos-mal | grep -i ipaddress

   ```

   It should have the same IP Address as onos-3. If not, configure it to it (172.17.0.7).
3. Configure the cluster file for onos-mal

   Create a configuration directory for ONOS docker images

   ```
   docker exec onos-mal mkdir /root/onos/config

   ```

   Replicate cluster-3.json to cluster-mal.json and edit it by removing below (or any two of the three `atomix`s)

   ```
   ,
   {
      "id": "atomix-2",
      "ip": "172.17.0.2",
      "port": 5679
    },
    {
      "id": "atomix-3",
      "ip": "172.17.0.3",
      "port": 5679
    }

   ```

   Configure cluster-mal.json to the onos-mal

   ```
   docker cp ~/cluster-mal.json onos-mal:/root/onos/config/cluster.json

   ```
4. Restart the onos-mal

   ```
   docker restart onos-mal

   ```

   Wait for seconds and refresh the UIs. We will see onos-mal join the cluster successfully.

## Discussion

There are three vulnerabilities we explored in the Marionette work:

* Insecure controller implementation (Controller Impersonation Attack)
* Insecure cluster role management (Follower controller without direct connection with the network can still configure the network by altering the cluster datastore)
* Insecure topology discovery (Flow entries can alter topology discovery result)

## About

demo code of marionette attack on onos cluster

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/mzc796/marionette_onos/activity)
### Stars

[**1**
star](/mzc796/marionette_onos/stargazers)
### Watchers

[**1**
watching](/mzc796/marionette_onos/watchers)
### Forks

[**0**
forks](/mzc796/marionette_onos/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fmzc796%2Fmarionette_onos&report=mzc796+%28user%29)

## [Releases](/mzc796/marionette_onos/releases)

No releases published

## [Packages 0](/users/mzc796/packages?repo_name=marionette_onos)

No packages published

## Languages

* [Shell
  89.6%](/mzc796/marionette_onos/search?l=shell)
* [Python
  10.4%](/mzc796/marionette_onos/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

