=== Content from plugins.trac.wordpress.org_5bfb694f_20250111_074128.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3034934%2540password-protected%26old%3D3034934%2540password-protected)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3005634/password-protected "Changeset 3005634 for password-protected")
* [Next Change](/changeset/3034935/password-protected "Changeset 3034935 for password-protected") →

---

# Changeset [3034934](/changeset/3034934 "Show full changeset") for [password-protected](/browser/password-protected?rev=3034934 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/13/2024 06:31:55 AM
([11 months](/timeline?from=2024-02-13T06%3A31%3A55Z&precision=second "See timeline at 02/13/2024 06:31:55 AM") ago)

Author:
wpexpertsio
Message:

Release Password Protected v2.6.7 with few improvements

Location:
[password-protected/trunk](/browser/password-protected/trunk?rev=3034934)
Files:

5 edited

* [admin/admin-bar.php](/browser/password-protected/trunk/admin/admin-bar.php?rev=3034934 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [admin/class-recaptcha.php](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934 "Show entry in browser")
  (modified)
  ([29 diffs](#file1 "Show differences"))
* [freemius/assets/css/admin/common.css](/browser/password-protected/trunk/freemius/assets/css/admin/common.css?rev=3034934 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [password-protected.php](/browser/password-protected/trunk/password-protected.php?rev=3034934 "Show entry in browser")
  (modified)
  ([21 diffs](#file3 "Show differences"))
* [readme.txt](/browser/password-protected/trunk/readme.txt?rev=3034934 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [password-protected/trunk/admin/admin-bar.php](/changeset/3034934/password-protected/trunk/admin/admin-bar.php "Show the changeset 3034934 restricted to password-protected/trunk/admin/admin-bar.php")

  | [r2855201](/browser/password-protected/trunk/admin/admin-bar.php?rev=2855201#L23 "Show revision 2855201 of this file in browser") | [r3034934](/browser/password-protected/trunk/admin/admin-bar.php?rev=3034934#L23 "Show revision 3034934 of this file in browser") |  |
  | --- | --- | --- |
  | 23 | 23 | public static function load() { |
  | 24 | 24 |  |
  | 25 |  | add\_action( 'wp\_head', array( ~~get\_class()~~, 'styles' ) ); |
  | 26 |  | add\_action( 'admin\_head', array( ~~get\_class()~~, 'styles' ) ); |
  | 27 |  | add\_action( 'wp\_before\_admin\_bar\_render', array( ~~get\_class()~~, 'toolbar\_item' ) ); |
  |  | 25 | add\_action( 'wp\_head', array( self::class, 'styles' ) ); |
  |  | 26 | add\_action( 'admin\_head', array( self::class, 'styles' ) ); |
  |  | 27 | add\_action( 'wp\_before\_admin\_bar\_render', array( self::class, 'toolbar\_item' ) ); |
  | 28 | 28 |  |
  | 29 | 29 | } |
* ## [password-protected/trunk/admin/class-recaptcha.php](/changeset/3034934/password-protected/trunk/admin/class-recaptcha.php "Show the changeset 3034934 restricted to password-protected/trunk/admin/class-recaptcha.php")

  | [r2866424](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L1 "Show revision 2866424 of this file in browser") | [r3034934](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L1 "Show revision 3034934 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | if ( ! defined( 'ABSPATH' ) ) |
  | 4 |  | exit; // Exit if accessed directly |
  |  | 3 | if ( ! defined( 'ABSPATH' ) ) { |
  |  | 4 | exit; // Exit if accessed directly |
  |  | 5 | } |
  | 5 | 6 |  |
  | 6 | 7 | /\*\* |
  | 7 |  | \* @package     Password Protected |
  |  | 8 | \* @package     Password Protected |
  | 8 | 9 | \* @subpackage  reCAPTCHA |
  | 9 | 10 | \* |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L11) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L12) |  |
  | 11 | 12 | \*/ |
  | 12 | 13 |  |
  | 13 |  | class Password\_Protected\_reCAPTCHA { |
  | 14 |  |  |
  | 15 |  | ~~public $options\_group~~  = 'password-protected-recaptcha'; |
  | 16 |  | ~~public $options\_name~~   = 'password\_protected\_recaptcha'; |
  | 17 |  | ~~public $tab~~            = 'password-protected&tab=advanced'; |
  | 18 |  | ~~public $settings~~       = array(); |
  | 19 |  | /\*\* |
  |  | 14 | class Password\_Protected\_reCAPTCHA { |
  |  | 15 |  |
  |  | 16 | public $options\_group = 'password-protected-recaptcha'; |
  |  | 17 | public $options\_name  = 'password\_protected\_recaptcha'; |
  |  | 18 | public $tab           = 'password-protected&tab=advanced'; |
  |  | 19 | public $settings      = array(); |
  |  | 20 | /\*\* |
  | 20 | 21 | \* Constructor |
  | 21 | 22 | \* |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L24) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L25) |  |
  | 24 | 25 | \* @internal  public. This class should only be instantiated once by the plugin. |
  | 25 | 26 | \*/ |
  | 26 |  |  |
  | 27 | 27 | public function \_\_construct() { |
  | 28 |  |  |
  | 29 |  | $options = get\_option( $this->options\_name ); |
  | 30 |  |  |
  | 31 |  | if( empty($options) || !$options ) |
  | 32 |  | $this->settings = $this->get\_default\_reCAPTCHA\_settings(); |
  | 33 |  | else |
  | 34 |  | $this->settings = get\_option( $this->options\_name ); |
  | 35 |  |  |
  |  | 28 |  |
  |  | 29 | $options = get\_option( $this->options\_name ); |
  |  | 30 |  |
  |  | 31 | if ( empty( $options ) || ! $options ) { |
  |  | 32 | $this->settings = $this->get\_default\_reCAPTCHA\_settings(); |
  |  | 33 | } else { |
  |  | 34 | $this->settings = get\_option( $this->options\_name ); |
  |  | 35 | } |
  |  | 36 |  |
  | 36 | 37 | add\_action( 'admin\_init', array( $this, 'register\_reCAPTCHA\_settings' ), 6 ); |
  | 37 | 38 |  |
  | 38 |  | add\_action( 'password\_protected\_after\_password\_field', array( $this, 'add\_recaptcha' ) ); |
  | 39 |  |  |
  | 40 |  | add\_filter( 'password\_protected\_verify\_recaptcha', array( $this, 'verify\_recaptcha' ) ); |
  | 41 |  | } |
  | 42 |  |  |
  | 43 |  | /\*\* |
  |  | 39 | add\_action( 'password\_protected\_after\_password\_field', array( $this, 'add\_recaptcha' ) ); |
  |  | 40 |  |
  |  | 41 | add\_filter( 'password\_protected\_verify\_recaptcha', array( $this, 'verify\_recaptcha' ) ); |
  |  | 42 | } |
  |  | 43 |  |
  |  | 44 | /\*\* |
  | 44 | 45 | \* reCAPTCHA Default Settings |
  | 45 | 46 | \* |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L47) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L48) |  |
  | 47 | 48 | \* @since  2.6 |
  | 48 | 49 | \*/ |
  | 49 |  | private function get\_default\_reCAPTCHA\_settings(): array { |
  | 50 |  | return array( |
  | 51 |  | 'enable'        => 0, |
  | 52 |  | 'version'       => 'google\_recaptcha\_v2', |
  | 53 |  | 'v2\_site\_key'   => null, |
  | 54 |  | 'v3\_site\_key'   => null, |
  | 55 |  | 'v2\_secret\_key' => null, |
  | 56 |  | 'v3\_secret\_key' => null, |
  | 57 |  | 'v3\_score'      => 0.3, |
  | 58 |  | 'v3\_badge'      => 'bottomright', |
  | 59 |  | 'v2\_theme'      => 'light' |
  | 60 |  | ); |
  | 61 |  | } |
  | 62 |  |  |
  | 63 |  | /\*\* |
  |  | 50 | private function get\_default\_reCAPTCHA\_settings(): array { |
  |  | 51 | return array( |
  |  | 52 | 'enable'        => 0, |
  |  | 53 | 'version'       => 'google\_recaptcha\_v2', |
  |  | 54 | 'v2\_site\_key'   => null, |
  |  | 55 | 'v3\_site\_key'   => null, |
  |  | 56 | 'v2\_secret\_key' => null, |
  |  | 57 | 'v3\_secret\_key' => null, |
  |  | 58 | 'v3\_score'      => 0.3, |
  |  | 59 | 'v3\_badge'      => 'bottomright', |
  |  | 60 | 'v2\_theme'      => 'light', |
  |  | 61 | ); |
  |  | 62 | } |
  |  | 63 |  |
  |  | 64 | /\*\* |
  | 64 | 65 | \* reCAPTCHA  Settings Info |
  | 65 | 66 | \* |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L69) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L70) |  |
  | 69 | 70 | \* @since  2.6 |
  | 70 | 71 | \*/ |
  | 71 |  |  |
  | 72 |  | public function register\_reCAPTCHA\_settings() { |
  | 73 |  | // reCAPTCHA Section |
  |  | 72 | public function register\_reCAPTCHA\_settings() { |
  |  | 73 | // reCAPTCHA Section |
  | 74 | 74 | add\_settings\_section( |
  | 75 | 75 | $this->options\_group, |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L79) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L79) |  |
  | 79 | 79 | ); |
  | 80 | 80 |  |
  | 81 |  | // Enable reCAPTCHA |
  |  | 81 | // Enable reCAPTCHA |
  | 82 | 82 | add\_settings\_field( |
  | 83 | 83 | 'password\_protected\_enable\_recaptcha', |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L88) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L88) |  |
  | 88 | 88 | ); |
  | 89 | 89 |  |
  | 90 |  | // reCAPTCHA version v2/v3 |
  | 91 |  | add\_settings\_field( |
  |  | 90 | // reCAPTCHA version v2/v3 |
  |  | 91 | add\_settings\_field( |
  | 92 | 92 | 'password\_protected\_recaptcha\_settings', |
  | 93 | 93 | \_\_( 'Captcha Settings', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L97) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L97) |  |
  | 97 | 97 | ); |
  | 98 | 98 |  |
  | 99 |  | // reCAPTCHA v2/v3 sitekey |
  | 100 |  | add\_settings\_field( |
  |  | 99 | // reCAPTCHA v2/v3 sitekey |
  |  | 100 | add\_settings\_field( |
  | 101 | 101 | 'password\_protected\_recaptcha\_v2\_site\_key', |
  | 102 | 102 | \_\_( 'Site Key', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L106) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L106) |  |
  | 106 | 106 | ); |
  | 107 | 107 |  |
  | 108 |  | // reCAPTCHA v2/v3 secretkey |
  | 109 |  | add\_settings\_field( |
  |  | 108 | // reCAPTCHA v2/v3 secretkey |
  |  | 109 | add\_settings\_field( |
  | 110 | 110 | 'password\_protected\_recaptcha\_v2\_secret\_key', |
  | 111 | 111 | \_\_( 'Secret Key', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L114) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L114) |  |
  | 114 | 114 | $this->options\_group |
  | 115 | 115 | ); |
  | 116 |  |  |
  | 117 |  | // reCAPTCHA v3 score |
  | 118 |  | add\_settings\_field( |
  |  | 116 |  |
  |  | 117 | // reCAPTCHA v3 score |
  |  | 118 | add\_settings\_field( |
  | 119 | 119 | 'password\_protected\_recaptcha\_score', |
  | 120 | 120 | \_\_( 'Score', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L124) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L124) |  |
  | 124 | 124 | ); |
  | 125 | 125 |  |
  | 126 |  | // reCAPTCHA v3 badgeposition |
  | 127 |  | add\_settings\_field( |
  |  | 126 | // reCAPTCHA v3 badgeposition |
  |  | 127 | add\_settings\_field( |
  | 128 | 128 | 'password\_protected\_recaptcha\_badge\_position', |
  | 129 | 129 | \_\_( 'Badge Position', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L133) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L133) |  |
  | 133 | 133 | ); |
  | 134 | 134 |  |
  | 135 |  | // reCAPTCHA v2 theme |
  | 136 |  | add\_settings\_field( |
  |  | 135 | // reCAPTCHA v2 theme |
  |  | 136 | add\_settings\_field( |
  | 137 | 137 | 'password\_protected\_recaptcha\_theme', |
  | 138 | 138 | \_\_( 'Theme', 'password-protected' ), |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L142) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L142) |  |
  | 142 | 142 | ); |
  | 143 | 143 |  |
  | 144 |  | // register settings in an array group. |
  | 145 |  | ~~register\_setting( 'password-protected-advanced', $this->options\_name, array( 'type' => 'array'~~) ); |
  | 146 |  | } |
  | 147 |  |  |
  | 148 |  | /\*\* |
  |  | 144 | // register settings in an array group. |
  |  | 145 | register\_setting( 'password-protected-advanced', $this->options\_name, array( 'type' => 'array' ) ); |
  |  | 146 | } |
  |  | 147 |  |
  |  | 148 | /\*\* |
  | 149 | 149 | \* reCAPTCHA Screen |
  | 150 | 150 | \* |
  | 151 |  | ~~\*~~@since  2.6 |
  | 152 |  | \* |
  |  | 151 | \* @since  2.6 |
  |  | 152 | \* |
  | 153 | 153 | \* @return  void  password protected reCAPTCHA settings |
  | 154 | 154 | \*/ |
  | 155 |  | public static function recpatcha\_screen() { |
  | 156 |  | do\_settings\_sections( 'password-protected&tab=advanced' ); |
  | 157 |  | submit\_button(); |
  | 158 |  | } |
  | 159 |  |  |
  | 160 |  | /\*\* |
  |  | 155 | public static function recpatcha\_screen() { |
  |  | 156 | do\_settings\_sections( 'password-protected&tab=advanced' ); |
  |  | 157 | submit\_button(); |
  |  | 158 | } |
  |  | 159 |  |
  |  | 160 | /\*\* |
  | 161 | 161 | \* reCAPTCHA Section |
  | 162 | 162 | \* |
  | 163 | 163 | \* @return  void  password protected reCAPTCHA section |
  | 164 | 164 | \*/ |
  | 165 |  | public function reCAPTCHA\_section() { |
  | 166 |  | return 1; |
  | 167 |  | } |
  | 168 |  |  |
  | 169 |  | /\*\* |
  |  | 165 | public function reCAPTCHA\_section() { |
  |  | 166 | return 1; |
  |  | 167 | } |
  |  | 168 |  |
  |  | 169 | /\*\* |
  | 170 | 170 | \* ENable reCAPTCHA |
  | 171 | 171 | \* |
  | 172 |  | \* @since  2.6 |
  | 173 |  | \* |
  |  | 172 | \* @since  2.6 |
  |  | 173 | \* |
  | 174 | 174 | \* @return  void  password protected reCAPTCHA status field |
  | 175 | 175 | \*/ |
  | 176 |  | public function reCAPTCHA\_enable() { |
  | 177 |  | echo '<label> |
  | 178 |  | <input |
  | 179 |  | name="'~~.esc\_attr( $this->options\_name ) .~~'[enable]" |
  |  | 176 | public function reCAPTCHA\_enable() { |
  |  | 177 | echo '<label> |
  |  | 178 | <input |
  |  | 179 | name="' . esc\_attr( $this->options\_name ) . '[enable]" |
  | 180 | 180 | id="pp\_enable\_recaptcha" |
  | 181 | 181 | type="checkbox" |
  | 182 | 182 | value="1" ' . checked( 1, @$this->settings['enable'], false ) . ' |
  | 183 |  | /> ' . |
  | 184 |  | \_\_( 'Enabled', 'password-protected' ) . ' |
  |  | 183 | /> ' . |
  |  | 184 | \_\_( 'Enabled', 'password-protected' ) . ' |
  | 185 | 185 | </label>'; |
  | 186 |  | } |
  | 187 |  |  |
  | 188 |  | /\*\* |
  |  | 186 | } |
  |  | 187 |  |
  |  | 188 | /\*\* |
  | 189 | 189 | \* reCAPTCHA Version |
  | 190 | 190 | \* |
  | 191 |  | \* @since  2.6 |
  | 192 |  | \* |
  |  | 191 | \* @since  2.6 |
  |  | 192 | \* |
  | 193 | 193 | \* @return  void  password protected reCAPTCHA version field |
  | 194 | 194 | \*/ |
  | 195 |  | public function reCAPTCHA\_setting() { |
  | 196 |  | echo '<label> |
  |  | 195 | public function reCAPTCHA\_setting() { |
  |  | 196 | echo '<label> |
  | 197 | 197 | <input |
  | 198 | 198 | ' . checked( 'google\_recaptcha\_v2', $this->settings['version'], false ) . ' |
  | 199 | 199 | type="radio" |
  | 200 |  | name="'~~.~~esc\_attr( $this->options\_name ) . '[version]" |
  |  | 200 | name="' . esc\_attr( $this->options\_name ) . '[version]" |
  | 201 | 201 | value="google\_recaptcha\_v2" |
  | 202 | 202 | /> |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L208) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L208) |  |
  | 208 | 208 | ' . checked( 'google\_recaptcha\_v3', $this->settings['version'], false ) . ' |
  | 209 | 209 | type="radio" |
  | 210 |  | name="'~~.~~esc\_attr( $this->options\_name ) . '[version]" |
  |  | 210 | name="' . esc\_attr( $this->options\_name ) . '[version]" |
  | 211 | 211 | value="google\_recaptcha\_v3" |
  | 212 | 212 | /> |
  | 213 | 213 | <span>Google reCAPTCHA Version 3</span> |
  | 214 | 214 | </label>'; |
  | 215 |  | } |
  | 216 |  |  |
  | 217 |  | /\*\* |
  |  | 215 | } |
  |  | 216 |  |
  |  | 217 | /\*\* |
  | 218 | 218 | \* reCAPTCHA Site Key |
  | 219 | 219 | \* |
  | 220 |  | \* @since  2.6 |
  | 221 |  | \* |
  |  | 220 | \* @since  2.6 |
  |  | 221 | \* |
  | 222 | 222 | \* @return  void  password protected v2/v3 sitekey field |
  | 223 | 223 | \*/ |
  | 224 |  | public function reCAPTCHA\_site\_key() { |
  | 225 |  |  |
  | 226 |  | echo '<div> |
  | 227 |  | <input |
  | 228 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v2\_site\_key]" |
  |  | 224 | public function reCAPTCHA\_site\_key() { |
  |  | 225 |  |
  |  | 226 | echo '<div> |
  |  | 227 | <input |
  |  | 228 | name="' . esc\_attr( $this->options\_name ) . '[v2\_site\_key]" |
  | 229 | 229 | type="text" |
  | 230 | 230 | id="pp\_google\_recaptcha\_v2\_site\_key" |
  | 231 |  | value="' . ~~$this->settings['v2\_site\_key']~~ . '" |
  |  | 231 | value="' . esc\_attr( $this->settings['v2\_site\_key'] ) . '" |
  | 232 | 232 | class="regular-text" |
  | 233 | 233 | /> |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L240) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L240) |  |
  | 240 | 240 | </div>'; |
  | 241 | 241 |  |
  | 242 |  | echo '<div> |
  |  | 242 | echo '<div> |
  | 243 | 243 | <input |
  | 244 |  | name="' . esc\_attr( $this->options\_name )~~.~~'[v3\_site\_key]" |
  |  | 244 | name="' . esc\_attr( $this->options\_name ) . '[v3\_site\_key]" |
  | 245 | 245 | type="text" |
  | 246 | 246 | id="pp\_google\_recaptcha\_v3\_site\_key" |
  | 247 |  | value="' . ~~$this->settings['v3\_site\_key']~~ . '" |
  |  | 247 | value="' . esc\_attr( $this->settings['v3\_site\_key'] ) . '" |
  | 248 | 248 | class="regular-text" |
  | 249 | 249 | /> |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L255) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L255) |  |
  | 255 | 255 | </p> |
  | 256 | 256 | </div>'; |
  | 257 |  | } |
  | 258 |  |  |
  | 259 |  | /\*\* |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | /\*\* |
  | 260 | 260 | \* reCAPTCHA Secret Key |
  | 261 | 261 | \* |
  | 262 |  | \* @since  2.6 |
  | 263 |  | \* |
  |  | 262 | \* @since  2.6 |
  |  | 263 | \* |
  | 264 | 264 | \* @return  void  password protected v2/v3 secretkey field |
  | 265 | 265 | \*/ |
  | 266 |  | public function reCAPTCHA\_secret\_key() { |
  | 267 |  |  |
  | 268 |  | echo '<div> |
  | 269 |  | <input |
  | 270 |  | name="' . esc\_attr( $this->options\_name )~~.~~'[v2\_secret\_key]" |
  |  | 266 | public function reCAPTCHA\_secret\_key() { |
  |  | 267 |  |
  |  | 268 | echo '<div> |
  |  | 269 | <input |
  |  | 270 | name="' . esc\_attr( $this->options\_name ) . '[v2\_secret\_key]" |
  | 271 | 271 | type="text" |
  | 272 | 272 | id="pp\_google\_recaptcha\_v2\_secret\_key" |
  | 273 |  | value="' . ~~$this->settings['v2\_secret\_key']~~ . '" |
  |  | 273 | value="' . esc\_attr( $this->settings['v2\_secret\_key'] ) . '" |
  | 274 | 274 | class="regular-text" |
  | 275 | 275 | /> |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L281) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L281) |  |
  | 281 | 281 | </p> |
  | 282 | 282 | </div>'; |
  | 283 |  | echo '<div> |
  | 284 |  | <input |
  | 285 |  | name="' . esc\_attr( $this->options\_name )~~.~~'[v3\_secret\_key]" |
  |  | 283 | echo '<div> |
  |  | 284 | <input |
  |  | 285 | name="' . esc\_attr( $this->options\_name ) . '[v3\_secret\_key]" |
  | 286 | 286 | type="text" |
  | 287 | 287 | id="pp\_google\_recaptcha\_v3\_secret\_key" |
  | 288 |  | value="' . ~~$this->settings['v3\_secret\_key']~~ . '" |
  |  | 288 | value="' . esc\_attr( $this->settings['v3\_secret\_key'] ) . '" |
  | 289 | 289 | class="regular-text" |
  | 290 | 290 | /> |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L296) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L296) |  |
  | 296 | 296 | </p> |
  | 297 | 297 | </div>'; |
  | 298 |  | } |
  | 299 |  |  |
  | 300 |  | /\*\* |
  |  | 298 | } |
  |  | 299 |  |
  |  | 300 | /\*\* |
  | 301 | 301 | \* reCAPTCHA V3 Score |
  | 302 | 302 | \* |
  | 303 |  | \* @since  2.6 |
  | 304 |  | \* |
  |  | 303 | \* @since  2.6 |
  |  | 304 | \* |
  | 305 | 305 | \* @return  void  password protected v3 score field |
  | 306 | 306 | \*/ |
  | 307 |  | public function reCAPTCHA\_score() { |
  | 308 |  | echo '<fieldset id="pp\_google\_recpatcha\_v3\_score"> |
  |  | 307 | public function reCAPTCHA\_score() { |
  |  | 308 | echo '<fieldset id="pp\_google\_recpatcha\_v3\_score"> |
  | 309 | 309 | <label> |
  | 310 | 310 | <input |
  | 311 | 311 | type="radio" |
  | 312 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_score]" |
  |  | 312 | name="' . esc\_attr( $this->options\_name ) . '[v3\_score]" |
  | 313 | 313 | value="0.1" |
  | 314 | 314 | ' . checked( 0.1, $this->settings['v3\_score'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L320) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L320) |  |
  | 320 | 320 | <input |
  | 321 | 321 | type="radio" |
  | 322 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_score]" |
  |  | 322 | name="' . esc\_attr( $this->options\_name ) . '[v3\_score]" |
  | 323 | 323 | value="0.2" |
  | 324 | 324 | ' . checked( 0.2, $this->settings['v3\_score'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L330) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L330) |  |
  | 330 | 330 | <input |
  | 331 | 331 | type="radio" |
  | 332 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_score]" |
  |  | 332 | name="' . esc\_attr( $this->options\_name ) . '[v3\_score]" |
  | 333 | 333 | value="0.3" |
  | 334 | 334 | ' . checked( 0.3, $this->settings['v3\_score'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L340) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L340) |  |
  | 340 | 340 | <input |
  | 341 | 341 | type="radio" |
  | 342 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_score]" |
  |  | 342 | name="' . esc\_attr( $this->options\_name ) . '[v3\_score]" |
  | 343 | 343 | value="0.4" |
  | 344 | 344 | ' . checked( 0.4, $this->settings['v3\_score'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L350) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L350) |  |
  | 350 | 350 | <input |
  | 351 | 351 | type="radio" |
  | 352 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_score]" |
  |  | 352 | name="' . esc\_attr( $this->options\_name ) . '[v3\_score]" |
  | 353 | 353 | value="0.5" |
  | 354 | 354 | ' . checked( 0.5, $this->settings['v3\_score'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L359) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L359) |  |
  | 359 | 359 | <p class="description">Select Google Version 3 Score.</p> |
  | 360 | 360 | </fieldset>'; |
  | 361 |  | } |
  | 362 |  |  |
  | 363 |  | /\*\* |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | /\*\* |
  | 364 | 364 | \* reCAPTCHA V3 Badge Position |
  | 365 | 365 | \* |
  | 366 |  | \* @since  2.6 |
  | 367 |  | \* |
  |  | 366 | \* @since  2.6 |
  |  | 367 | \* |
  | 368 | 368 | \* @return  void  password protected v3 badgeposition field |
  | 369 | 369 | \*/ |
  | 370 |  | public function reCAPTCHA\_badge\_position() { |
  | 371 |  | echo '<fieldset id="pp\_google\_recpatcha\_v3\_badge"> |
  |  | 370 | public function reCAPTCHA\_badge\_position() { |
  |  | 371 | echo '<fieldset id="pp\_google\_recpatcha\_v3\_badge"> |
  | 372 | 372 | <label> |
  | 373 | 373 | <input |
  | 374 | 374 | type="radio" |
  | 375 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_badge]" |
  |  | 375 | name="' . esc\_attr( $this->options\_name ) . '[v3\_badge]" |
  | 376 | 376 | value="inline" |
  | 377 | 377 | ' . checked( 'inline', $this->settings['v3\_badge'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L383) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L383) |  |
  | 383 | 383 | <input |
  | 384 | 384 | type="radio" |
  | 385 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_badge]" |
  |  | 385 | name="' . esc\_attr( $this->options\_name ) . '[v3\_badge]" |
  | 386 | 386 | value="bottomleft" |
  | 387 | 387 | ' . checked( 'bottomleft', $this->settings['v3\_badge'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L393) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L393) |  |
  | 393 | 393 | <input |
  | 394 | 394 | type="radio" |
  | 395 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v3\_badge]" |
  |  | 395 | name="' . esc\_attr( $this->options\_name ) . '[v3\_badge]" |
  | 396 | 396 | value="bottomright" |
  | 397 | 397 | ' . checked( 'bottomright', $this->settings['v3\_badge'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L400) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L400) |  |
  | 400 | 400 | </label> |
  | 401 | 401 | </fieldset>'; |
  | 402 |  | } |
  | 403 |  |  |
  | 404 |  | /\*\* |
  |  | 402 | } |
  |  | 403 |  |
  |  | 404 | /\*\* |
  | 405 | 405 | \* reCAPTCHA V2 Theme |
  | 406 | 406 | \* |
  | 407 |  | \* @since  2.6 |
  | 408 |  | \* |
  |  | 407 | \* @since  2.6 |
  |  | 408 | \* |
  | 409 | 409 | \* @return  void  password protected v2 theme field |
  | 410 | 410 | \*/ |
  | 411 |  | public function reCAPTCHA\_theme() { |
  | 412 |  | echo '<label> |
  |  | 411 | public function reCAPTCHA\_theme() { |
  |  | 412 | echo '<label> |
  | 413 | 413 | <input |
  | 414 | 414 | checked="checked" |
  | 415 | 415 | type="radio" |
  | 416 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v2\_theme]" |
  |  | 416 | name="' . esc\_attr( $this->options\_name ) . '[v2\_theme]" |
  | 417 | 417 | value="light" |
  | 418 | 418 | ' . checked( 'light', $this->settings['v2\_theme'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L424) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L424) |  |
  | 424 | 424 | <input |
  | 425 | 425 | type="radio" |
  | 426 |  | name="'~~.esc\_attr( $this->options\_name ).~~'[v2\_theme]" |
  |  | 426 | name="' . esc\_attr( $this->options\_name ) . '[v2\_theme]" |
  | 427 | 427 | value="dark" |
  | 428 | 428 | ' . checked( 'dark', $this->settings['v2\_theme'], false ) . ' |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L431) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L431) |  |
  | 431 | 431 | </label> |
  | 432 | 432 | <p class="description">Select Google reCAPTCHA Version 2 Theme.</p>'; |
  | 433 |  | } |
  | 434 |  |  |
  | 435 |  | /\*\* |
  |  | 433 | } |
  |  | 434 |  |
  |  | 435 | /\*\* |
  | 436 | 436 | \* Add reCAPTCHA on Password Protected Form |
  | 437 | 437 | \* |
  | 438 |  | \* @since  2.6 |
  | 439 |  | \* |
  |  | 438 | \* @since  2.6 |
  |  | 439 | \* |
  | 440 | 440 | \* @return  void  password protected reCAPTCHA v2 OR v3 |
  | 441 | 441 | \*/ |
  | 442 |  | public function add\_recaptcha() { |
  | 443 |  | if( ! @$this->settings['enable'] ) |
  | 444 |  | return; //recpatcha is disabled |
  | 445 |  |  |
  | 446 |  | if( $this->settings['version'] === 'google\_recaptcha\_v2' ) |
  | 447 |  | $this->display\_recaptcha\_v2(); |
  | 448 |  |  |
  | 449 |  | if( $this->settings['version'] === 'google\_recaptcha\_v3' ) |
  | 450 |  | $this->display\_recaptcha\_v3(); |
  | 451 |  | } |
  | 452 |  |  |
  | 453 |  | /\*\* |
  |  | 442 | public function add\_recaptcha() { |
  |  | 443 | if ( ! @$this->settings['enable'] ) { |
  |  | 444 | return; // recpatcha is disabled |
  |  | 445 | } |
  |  | 446 |  |
  |  | 447 | if ( $this->settings['version'] === 'google\_recaptcha\_v2' ) { |
  |  | 448 | $this->display\_recaptcha\_v2(); |
  |  | 449 | } |
  |  | 450 |  |
  |  | 451 | if ( $this->settings['version'] === 'google\_recaptcha\_v3' ) { |
  |  | 452 | $this->display\_recaptcha\_v3(); |
  |  | 453 | } |
  |  | 454 | } |
  |  | 455 |  |
  |  | 456 | /\*\* |
  | 454 | 457 | \* Diaplay reCAPTCHA V2 |
  | 455 | 458 | \* |
  | 456 |  | \* @since  2.6 |
  | 457 |  | \* |
  |  | 459 | \* @since  2.6 |
  |  | 460 | \* |
  | 458 | 461 | \* @return  void  password protected reCAPTCHA v2 field |
  | 459 | 462 | \*/ |
  | 460 |  | public function display\_recaptcha\_v2() { |
  | 461 |  | ~~wp\_enqueue\_style( 'pp-recaptcha-style', plugin\_dir\_url( \_\_DIR\_\_ ) . "assets/css/recaptcha.css"~~, array(), '2.6.2' ); |
  | 462 |  | ~~wp\_enqueue\_script( 'pp-recaptcha-api-v2',~~  esc\_url( 'https://www.google.com/recaptcha/api.js' ), array(), null ); |
  | 463 |  | echo '<div |
  |  | 463 | public function display\_recaptcha\_v2() { |
  |  | 464 | wp\_enqueue\_style( 'pp-recaptcha-style', plugin\_dir\_url( \_\_DIR\_\_ ) . 'assets/css/recaptcha.css', array(), '2.6.2' ); |
  |  | 465 | wp\_enqueue\_script( 'pp-recaptcha-api-v2', esc\_url( 'https://www.google.com/recaptcha/api.js' ), array(), null ); |
  |  | 466 | echo '<div |
  | 464 | 467 | class="g-recaptcha" |
  | 465 |  | data-sitekey="' . esc\_attr( $this->settings['v2\_site\_key'] ) .'" |
  |  | 468 | data-sitekey="' . esc\_attr( $this->settings['v2\_site\_key'] ) . '" |
  | 466 | 469 | data-theme="' . esc\_attr( $this->settings['v2\_theme'] ) . '" |
  | 467 | 470 | > |
  | 468 | 471 | </div>'; |
  | 469 |  | } |
  | 470 |  |  |
  | 471 |  | /\*\* |
  |  | 472 | } |
  |  | 473 |  |
  |  | 474 | /\*\* |
  | 472 | 475 | \* Diaplay reCAPTCHA V3 |
  | 473 | 476 | \* |
  | 474 |  | \* @since  2.6 |
  | 475 |  | \* |
  |  | 477 | \* @since  2.6 |
  |  | 478 | \* |
  | 476 | 479 | \* @return  void  password protected reCAPTCHA v3 field |
  | 477 | 480 | \*/ |
  | 478 |  | public function display\_recaptcha\_v3() { |
  | 479 |  | $grecaptcha\_v3\_site\_key = isset( $this->settings['v3\_site\_key'] ) ? esc\_attr( $this->settings['v3\_site\_key'] ) : ''; |
  | 480 |  | $grecaptcha\_v3\_badge    = isset( $this->settings['v3\_badge'] ) ? esc\_attr( $this->settings['v3\_badge'] ) : 'bottomright'; |
  | 481 |  |  |
  | 482 |  | $script = <<<EOT |
  |  | 481 | public function display\_recaptcha\_v3() { |
  |  | 482 | $grecaptcha\_v3\_site\_key = isset( $this->settings['v3\_site\_key'] ) ? esc\_attr( $this->settings['v3\_site\_key'] ) : ''; |
  |  | 483 | $grecaptcha\_v3\_badge    = isset( $this->settings['v3\_badge'] ) ? esc\_attr( $this->settings['v3\_badge'] ) : 'bottomright'; |
  |  | 484 |  |
  |  | 485 | $script = <<<EOT |
  | 483 | 486 | if('function' !== typeof pprecaptcha) { |
  | 484 | 487 | function pprecaptcha() { |
  | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=2866424#L513) | […](/browser/password-protected/trunk/admin/class-recaptcha.php?rev=3034934#L516) |  |
  | 513 | 516 | EOT; |
  | 514 | 517 |  |
  | 515 |  | wp\_enqueue\_script( 'recaptcha-api-v3', ( 'https://www.google.com/recaptcha/api.js?onload=pprecaptcha&render=' . esc\_attr( $grecaptcha\_v3\_site\_key ) . '&badge=' . esc\_attr( $grecaptcha\_v3\_badge ) ), array(), null ); |
  | 516 |  | wp\_add\_inline\_script( 'recaptcha-api-v3', $script ); ?> |
  |  | 518 | wp\_enqueue\_script( 'recaptcha-api-v3', ( 'https://www.google.com/recaptcha/api.js?onload=pprecaptcha&render=' . esc\_attr( $grecaptcha\_v3\_site\_key ) . '&badge=' . esc\_attr( $grecaptcha\_v3\_badge ) ), array(), null ); |
  |  | 519 | wp\_add\_inline\_script( 'recaptcha-api-v3', $script ); ?> |
  | 517 | 520 | <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response-password\_protected" class="pp-g-recaptcha" data-action="password\_protected"> |
  | 518 | 521 | <?php |
  | 519 |  | } |
  | 520 |  |  |
  | 521 |  | /\*\* |
  |  | 522 | } |
  |  | 523 |  |
  |  | 524 | /\*\* |
  | 522 | 525 | \* Verify reCAPTCHA |
  | 523 |  | \* process reCAPTCHA |
  | 524 |  | \* |
  | 525 |  | \* @since  2.6 |
  | 526 |  | \* |
  |  | 526 | \* process reCAPTCHA |
  |  | 527 | \* |
  |  | 528 | \* @since  2.6 |
  |  | 529 | \* |
  | 527 | 530 | \* @return  object  WP\_Error |
  | 528 | 531 | \*/ |
  | 529 |  | public function verify\_recaptcha( $errors ) { |
  | 530 |  |  |
  | 531 |  | ~~if~~( ! @$this->settings['enable'] ) { |
  | 532 |  | return $errors; // return errors |
  | 533 |  | } |
  | 534 |  |  |
  | 535 |  | ~~if~~( $this->settings['version'] === 'google\_recaptcha\_v2' ) { |
  | 536 |  |  |
  | 537 |  | $grecaptcha\_v2\_site\_key   = isset( $this->settings['v2\_site\_key'] ) ? esc\_attr( $this->settings['v2\_site\_key'] ) : ''; |
  | 538 |  | $grecaptcha\_v2\_secret\_key = isset( $this->settings['v2\_secret\_key'] ) ? esc\_attr( $this->settings['v2\_secret\_key'] ) : ''; |
  | 539 |  |  |
  | 540 |  | if ( empty( $grecaptcha\_v2\_site\_key ) || empty( $grecaptcha\_v2\_secret\_key ) ) { |
  | 541 |  | $errors->add( 001, 'Google reCaptcha keys not found.' ); |
  | 542 |  | } |
  | 543 |  |  |
  | 544 |  | if ( isset( $\_POST['g-recaptcha-response'] ) && ! empty( $\_POST['g-recaptcha-response'] ) ) { |
  | 545 |  | $response = wp\_remote\_post( |
  | 546 |  | 'https://www.google.com/recaptcha/api/siteverify', |
  | 547 |  | array( |
  | 548 |  | 'body' => array( |
  | 549 |  | 'secret'   => $grecaptcha\_v2\_secret\_key, |
  | 550 |  | ~~'response' => sanitize\_text\_field(~~$\_POST['g-recaptcha-response'] ), |
  | 551 |  | ) |
  | 552 |  | ) |
  | 553 |  | ); |
  | 554 |  |  |
  | 555 |  | $data = wp\_remote\_retrieve\_body( $response ); |
  | 556 |  | $data = json\_decode( $data ); |
  | 557 |  |  |
  | 558 |  | if ( isset( $data->{'error-codes'} ) && is\_array( $data->{'error-codes'} ) && count( $data->{'error-codes'} ) ) { |
  | 559 |  | foreach ( $data->{'error-codes'} as $index => $error\_code ) { |
  | 560 |  | $errors->add( $index, $error\_code ); |
  | 561 |  | } |
  | 562 |  | } |
  | 563 |  |  |
  | 564 |  | if ( isset( $data->success ) && true === $data->success ) { |
  | 565 |  | return $errors; |
  | 566 |  | } |
  | 567 |  | } |
  | 568 |  | $error\_message = wp\_kses( \_\_( '<strong>ERROR:</strong> Please confirm you are not a robot.', 'password-protected' ), array( 'strong' => array() ) ); |
  | 569 |  | $errors->add( 'captcha\_invalid', $error\_message ); |
  | 570 |  |  |
  | 571 |  | return $errors; |
  | 572 |  |  |
  | 573 |  | ~~} else if~~( $this->settings['version'] === 'google\_recaptcha\_v3' ) { |
  | 574 |  |  |
  | 575 |  | $grecaptcha\_v3\_site\_key   = isset( $this->settings['v3\_site\_key'] ) ? esc\_attr( $this->settings['v3\_site\_key'] ) : ''; |
  | 576 |  | $grecaptcha\_v3\_secret\_key = isset( $this->settings['v3\_secret\_key'] ) ? esc\_attr( $this->settings['v3\_secret\_key'] ) : ''; |
  | 577 |  | $grecaptcha\_v3\_score      = isset( $this->settings['v3\_score'] ) ? esc\_attr( $this->settings['v3\_score'] ) : '0.3'; |
  | 578 |  |  |
  | 579 |  | if ( empty( $grecaptcha\_v3\_site\_key ) || empty( $grecaptcha\_v3\_secret\_key ) ) { |
  | 580 |  | $errors->add( 001, 'Google reCaptcha keys not found.' ); |
  | 581 |  | } |
  | 582 |  |  |
  | 583 |  | if ( isset( $\_POST['g-recaptcha-response'] ) && ! empty( $\_POST['g-recaptcha-response'] ) ) { |
  | 584 |  | $response = wp\_remote\_post( |
  | 585 |  | 'https://www.google.com/recaptcha/api/siteverify', |
  | 586 |  | array( |
  | 587 |  | 'body' => array( |
  | 588 |  | 'secret'   => $grecaptcha\_v3\_secret\_key, |
  | 589 |  | 'response' => sanitize\_text\_field( $\_POST['g-recaptcha-response'] ), |
  | 590 |  | 'remoteip' => self::get\_ip\_address(), |
  | 591 |  | ) |
  | 592 |  | ) |
  | 593 |  | ); |
  | 594 |  |  |
  | 595 |  | $data = wp\_remote\_retrieve\_body( $response ); |
  | 596 |  | $data = json\_decode( $data ); |
  | 597 |  |  |
  | 598 |  | if ( isset( $data->{'error-codes'} ) && is\_array( $data->{'error-codes'} ) && count( $data->{'error-codes'} ) ) { |
  | 599 |  | foreach ( $data->{'error-codes'} as $index => $error\_code ) { |
  | 600 |  | $errors->add( $index, $error\_code ); |
  | 601 |  | } |
  | 602 |  | } |
  | 603 |  |  |
  | 604 |  | if ( isset( $data->success ) && true === $data->success ) { |
  | 605 |  | $grecaptcha\_v3\_score = (float) $grecaptcha\_v3\_score; |
  | 606 |  | if ( isset( $data->action ) && ( 'password\_protected' === $data->action ) && isset( $data->score ) && $data->score >= $grecaptcha\_v3\_score ) { |
  | 607 |  | return $errors; |
  | 608 |  | } else { |
  | 609 |  | ~~$error\_message = wp\_kses( \_\_( '<strong>ERROR:</strong> Low Score ', 'password-protected' ) . ':' . esc\_html( $data->score )~~ , array( 'strong' => array() ) ); |
  | 610 |  | $errors->add( 002, $error\_message ); |
  | 611 |  | } |
  | 612 |  | } |
  | 613 |  | } |
  | 614 |  |  |
  | 615 |  | return $errors; |
  | 616 |  | } |
  | 617 |  |  |
  | 618 |  | } |
  | 619 |  |  |
  | 620 |  | /\*\* |
  |  | 532 | public function verify\_recaptcha( $errors ) { |
  |  | 533 |  |
  |  | 534 | if ( ! @$this->settings['enable'] ) { |
  |  | 535 | return $errors; // return errors |
  |  | 536 | } |
  |  | 537 |  |
  |  | 538 | if ( $this->settings['version'] === 'google\_recaptcha\_v2' ) { |
  |  | 539 |  |
  |  | 540 | $grecaptcha\_v2\_site\_key   = isset( $this->settings['v2\_site\_key'] ) ? esc\_attr( $this->settings['v2\_site\_key'] ) : ''; |
  |  | 541 | $grecaptcha\_v2\_secret\_key = isset( $this->settings['v2\_secret\_key'] ) ? esc\_attr( $this->settings['v2\_secret\_key'] ) : ''; |
  |  | 542 |  |
  |  | 543 | if ( empty( $grecaptcha\_v2\_site\_key ) || empty( $grecaptcha\_v2\_secret\_key ) ) { |
  |  | 544 | $errors->add( 001, 'Google reCaptcha keys not found.' ); |
  |  | 545 | } |
  |  | 546 |  |
  |  | 547 | if ( isset( $\_POST['g-recaptcha-response'] ) && ! empty( $\_POST['g-recaptcha-response'] ) ) { |
  |  | 548 | $response = wp\_remote\_post( |
  |  | 549 | 'https://www.google.com/recaptcha/api/siteverify', |
  |  | 550 | array( |
  |  | 551 | 'body' => array( |
  |  | 552 | 'secret'   => $grecaptcha\_v2\_secret\_key, |
  |  | 553 | 'response' => sanitize\_text\_field( $\_POST['g-recaptcha-response'] ), |
  |  | 554 | ), |
  |  | 555 | ) |
  |  | 556 | ); |
  |  | 557 |  |
  |  | 558 | $data = wp\_remote\_retrieve\_body( $response ); |
  |  | 559 | $data = json\_decode( $data ); |
  |  | 560 |  |
  |  | 561 | if ( isset( $data->{'error-codes'} ) && is\_array( $data->{'error-codes'} ) && count( $data->{'error-codes'} ) ) { |
  |  | 562 | foreach ( $data->{'error-codes'} as $index => $error\_code ) { |
  |  | 563 | $errors->add( $index, $error\_code ); |
  |  | 564 | } |
  |  | 565 | } |
  |  | 566 |  |
  |  | 567 | if ( isset( $data->success ) && true === $data->success ) { |
  |  | 568 | return $errors; |
  |  | 569 | } |
  |  | 570 | } |
  |  | 571 | $error\_message = wp\_kses( \_\_( '<strong>ERROR:</strong> Please confirm you are not a robot.', 'password-protected' ), array( 'strong' => array() ) ); |
  |  | 572 | $errors->add( 'captcha\_invalid', $error\_message ); |
  |  | 573 |  |
  |  | 574 | return $errors; |
  |  | 575 |  |
  |  | 576 | } elseif ( $this->settings['version'] === 'google\_recaptcha\_v3' ) { |
  |  | 577 |  |
  |  | 578 | $grecaptcha\_v3\_site\_key   = isset( $this->settings['v3\_site\_key'] ) ? esc\_attr( $this->settings['v3\_site\_key'] ) : ''; |
  |  | 579 | $grecaptcha\_v3\_secret\_key = isset( $this->settings['v3\_secret\_key'] ) ? esc\_attr( $this->settings['v3\_secret\_key'] ) : ''; |
  |  | 580 | $grecaptcha\_v3\_score      = isset( $this->settings['v3\_score'] ) ? esc\_attr( $this->settings['v3\_score'] ) : '0.3'; |
  |  | 581 |  |
  |  | 582 | if ( empty( $grecaptcha\_v3\_site\_key ) || empty( $grecaptcha\_v3\_secret\_key ) ) { |
  |  | 583 | $errors->add( 001, 'Google reCaptcha keys not found.' ); |
  |  | 584 | } |
  |  | 585 |  |
  |  | 586 | if ( isset( $\_POST['g-recaptcha-response'] ) && ! empty( $\_POST['g-recaptcha-response'] ) ) { |
  |  | 587 | $response = wp\_remote\_post( |
  |  | 588 | 'https://www.google.com/recaptcha/api/siteverify', |
  |  | 589 | array( |
  |  | 590 | 'body' => array( |
  |  | 591 | 'secret'   => $grecaptcha\_v3\_secret\_key, |
  |  | 592 | 'response' => sanitize\_text\_field( $\_POST['g-recaptcha-response'] ), |
  |  | 593 | 'remoteip' => self::get\_ip\_address(), |
  |  | 594 | ), |
  |  | 595 | ) |
  |  | 596 | ); |
  |  | 597 |  |
  |  | 598 | $data = wp\_remote\_retrieve\_body( $response ); |
  |  | 599 | $data = json\_decode( $data ); |
  |  | 600 |  |
  |  | 601 | if ( isset( $data->{'error-codes'} ) && is\_array( $data->{'error-codes'} ) && count( $data->{'error-codes'} ) ) { |
  |  | 602 | foreach ( $data->{'error-codes'} as $index => $error\_code ) { |
  |  | 603 | $errors->add( $index, $error\_code ); |
  |  | 604 | } |
  |  | 605 | } |
  |  | 606 |  |
  |  | 607 | if ( isset( $data->success ) && true === $data->success ) { |
  |  | 608 | $grecaptcha\_v3\_score = (float) $grecaptcha\_v3\_score; |
  |  | 609 | if ( isset( $data->action ) && ( 'password\_protected' === $data->action ) && isset( $data->score ) && $data->score >= $grecaptcha\_v3\_score ) { |
  |  | 610 | return $errors; |
  |  | 611 | } else { |
  |  | 612 | $error\_message = wp\_kses( \_\_( '<strong>ERROR:</strong> Low Score ', 'password-protected' ) . ':' . esc\_html( $data->score ), array( 'strong' => array() ) ); |
  |  | 613 | $errors->add( 002, $error\_message ); |
  |  | 614 | } |
  |  | 615 | } |
  |  | 616 | } |
  |  | 617 |  |
  |  | 618 | return $errors; |
  |  | 619 | } |
  |  | 620 |  |
  |  | 621 | } |
  |  | 622 |  |
  |  | 623 | /\*\* |
  | 621 | 624 | \* Get IP Address |
  | 622 | 625 | \* |
  | 623 |  | \* @since  2.6 |
  | 624 |  | \* |
  |  | 626 | \* @since  2.6 |
  |  | 627 | \* |
  | 625 | 628 | \* @return  string  client IP address |
  | 626 | 629 | \*/ |
  | 627 |  | private static function get\_ip\_address() { |
  | 628 |  | $ipaddress = ''; |
  | 629 |  | if (isset($\_SERVER['HTTP\_CLIENT\_IP'])) |
  | 630 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_CLIENT\_IP'] ); |
  | 631 |  | else if(isset($\_SERVER['HTTP\_X\_FORWARDED\_FOR'])) |
  | 632 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_X\_FORWARDED\_FOR'] ); |
  | 633 |  | else if(isset($\_SERVER['HTTP\_X\_FORWARDED'])) |
  | 634 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_X\_FORWARDED'] ); |
  | 635 |  | else if(isset($\_SERVER['HTTP\_FORWARDED\_FOR'])) |
  | 636 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_FORWARDED\_FOR'] ); |
  | 637 |  | else if(isset($\_SERVER['HTTP\_FORWARDED'])) |
  | 638 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_FORWARDED'] ); |
  | 639 |  | else if(isset($\_SERVER['REMOTE\_ADDR'])) |
  | 640 |  | $ipaddress = sanitize\_text\_field( $\_SERVER['REMOTE\_ADDR'] ); |
  | 641 |  | else |
  | 642 |  | $ipaddress = 'UNKNOWN'; |
  | 643 |  | return $ipaddress; |
  | 644 |  | } |
  |  | 630 | private static function get\_ip\_address() { |
  |  | 631 | $ipaddress = ''; |
  |  | 632 | if ( isset( $\_SERVER['HTTP\_CLIENT\_IP'] ) ) { |
  |  | 633 | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_CLIENT\_IP'] ); |
  |  | 634 | } elseif ( isset( $\_SERVER['HTTP\_X\_FORWARDED\_FOR'] ) ) { |
  |  | 635 | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_X\_FORWARDED\_FOR'] ); |
  |  | 636 | } elseif ( isset( $\_SERVER['HTTP\_X\_FORWARDED'] ) ) { |
  |  | 637 | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_X\_FORWARDED'] ); |
  |  | 638 | } elseif ( isset( $\_SERVER['HTTP\_FORWARDED\_FOR'] ) ) { |
  |  | 639 | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_FORWARDED\_FOR'] ); |
  |  | 640 | } elseif ( isset( $\_SERVER['HTTP\_FORWARDED'] ) ) { |
  |  | 641 | $ipaddress = sanitize\_text\_field( $\_SERVER['HTTP\_FORWARDED'] ); |
  |  | 642 | } elseif ( isset( $\_SERVER['REMOTE\_ADDR'] ) ) { |
  |  | 643 | $ipaddress = sanitize\_text\_field( $\_SERVER['REMOTE\_ADDR'] ); |
  |  | 644 | } else { |
  |  | 645 | $ipaddress = 'UNKNOWN'; |
  |  | 646 | } |
  |  | 647 | return $ipaddress; |
  |  | 648 | } |
  | 645 | 649 |  |
  | 646 | 650 | } |
* ## [password-protected/trunk/freemius/assets/css/admin/common.css](/changeset/3034934/password-protected/trunk/freemius/assets/css/admin/common.css "Show the changeset 3034934 restricted to password-protected/trunk/freemius/assets/css/admin/common.css")

  | [r2916027](/browser/password-protected/trunk/freemius/assets/css/admin/common.css?rev=2916027#L1 "Show revision 2916027 of this file in browser") | [r3034934](/browser/password-protected/trunk/freemius/assets/css/admin/common.css?rev=3034934#L1 "Show revision 3034934 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | ﻿.fs-badge{position:absolute;top:10px;right:0;background:#71ae00;color:#fff;text-transform:uppercase;padding:5px 10px;-moz-border-radius:3px 0 0 3px;-webkit-border-radius:3px 0 0 3px;border-radius:3px 0 0 3px;font-weight:bold;border-right:0;-moz-box-shadow:0 2px 1px -1px rgba(0,0,0,.3);-webkit-box-shadow:0 2px 1px -1px rgba(0,0,0,.3);box-shadow:0 2px 1px -1px rgba(0,0,0,.3)}.theme-browser .theme .fs-premium-theme-badge-container{position:absolute;right:0;top:0}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge{position:relative;top:0;margin-top:10px;text-align:center}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge.fs-premium-theme-badge{font-size:1.1em}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge.fs-beta-theme-badge{background:#00a0d2}.fs-switch{position:relative;display:inline-block;color:#ccc;text-shadow:0 1px 1px rgba(255,255,255,.8);height:18px;padding:6px 6px 5px 6px;border:1px solid #ccc;border:1px solid rgba(0,0,0,.2);background:#ececec;box-shadow:0 0 4px rgba(0,0,0,.1),inset 0 1px 3px 0 rgba(0,0,0,.1);cursor:pointer}.fs-switch span{display:inline-block;width:35px;text-transform:uppercase}.fs-switch .fs-toggle{position:absolute;top:1px;width:37px;height:25px;border:1px solid #ccc;border:1px solid rgba(0,0,0,.3);border-radius:4px;background:#fff;background-color:#fff;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0, #ececec), color-stop(1, #fff));background-image:-webkit-linear-gradient(top, #ececec, #fff);background-image:-moz-linear-gradient(top, #ececec, #fff);background-image:-ms-linear-gradient(top, #ececec, #fff);background-image:-o-linear-gradient(top, #ececec, #fff);background-image:linear-gradient(top, bottom, #ececec, #fff);box-shadow:inset 0 1px 0 0 rgba(255,255,255,.5);z-index:999;-moz-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-o-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-ms-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-webkit-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1)}.fs-switch.fs-off .fs-toggle{left:2%}.fs-switch.fs-on .fs-toggle{left:54%}.fs-switch.fs-round{top:8px;padding:4px 25px;-moz-border-radius:24px;-webkit-border-radius:24px;border-radius:24px}.fs-switch.fs-round .fs-toggle{top:0;width:24px;height:24px;-moz-border-radius:24px;-webkit-border-radius:24px;border-radius:24px}.fs-switch.fs-round.fs-off .fs-toggle{left:-1px}.fs-switch.fs-round.fs-on{background:#0085ba}.fs-switch.fs-round.fs-on .fs-toggle{left:25px}.fs-switch.fs-small.fs-round{padding:1px 19px}.fs-switch.fs-small.fs-round .fs-toggle{top:0;width:18px;height:18px;-moz-border-radius:18px;-webkit-border-radius:18px;border-radius:18px}.fs-switch.fs-small.fs-round.fs-on .fs-toggle{left:19px}body.fs-loading,body.fs-loading \*{cursor:wait !important}#fs\_frame{line-height:0;font-size:0}.fs-full-size-wrapper{margin:40px 0 -65px -20px}@media(max-width: 600px){.fs-full-size-wrapper{margin:0 0 -65px -10px}}.fs-notice{position:relative}.fs-notice.fs-has-title{margin-bottom:30px !important}.fs-notice.success{color:green}.fs-notice.promotion{border-color:#00a0d2 !important;background-color:#f2fcff !important}.fs-notice .fs-notice-body{margin:.5em 0;padding:2px}.fs-notice .fs-close{cursor:pointer;color:#aaa;float:right}.fs-notice .fs-close:hover{color:#666}.fs-notice .fs-close>\*{margin-top:7px;display:inline-block}.fs-notice label.fs-plugin-title{background:rgba(0,0,0,.3);color:#fff;padding:2px 10px;position:absolute;top:100%;bottom:auto;right:auto;-moz-border-radius:0 0 3px 3px;-webkit-border-radius:0 0 3px 3px;border-radius:0 0 3px 3px;left:10px;font-size:12px;font-weight:bold;cursor:auto}div.fs-notice.updated,div.fs-notice.success,div.fs-notice.promotion{display:block !important}#fs\_connect .fs-error ol,#fs\_connect .fs-error .fs-api-request-error-show-details-link,#fs\_connect .fs-error .fs-api-request-error-details,.fs-modal .notice-error ol,.fs-modal .notice-error .fs-api-request-error-show-details-link,.fs-modal .notice-error .fs-api-request-error-details,.fs-notice.error ol,.fs-notice.error .fs-api-request-error-show-details-link,.fs-notice.error .fs-api-request-error-details{text-align:left}#fs\_connect .fs-error ol,.fs-modal .notice-error ol,.fs-notice.error ol{list-style-type:disc}#fs\_connect .fs-error .fs-api-request-error-show-details-link,.fs-modal .notice-error .fs-api-request-error-show-details-link,.fs-notice.error .fs-api-request-error-show-details-link{text-decoration:none;color:#2271b1;box-shadow:none}#fs\_connect .fs-error .fs-api-request-error-details,.fs-modal .notice-error .fs-api-request-error-details,.fs-notice.error .fs-api-request-error-details{border:1px solid #ccc;padding:5px;overflow:auto;max-height:150px}.rtl .fs-notice .fs-close{float:left}.fs-secure-notice{position:fixed;top:32px;left:160px;right:0;background:#ebfdeb;padding:10px 20px;color:green;z-index:9999;-moz-box-shadow:0 2px 2px rgba(6,113,6,.3);-webkit-box-shadow:0 2px 2px rgba(6,113,6,.3);box-shadow:0 2px 2px rgba(6,113,6,.3);opacity:.95;filter:alpha(opacity=95)}.fs-secure-notice:hover{opacity:1;filter:alpha(opacity=100)}.fs-secure-notice a.fs-security-proof{color:green;text-decoration:none}@media screen and (max-width: 960px){.fs-secure-notice{left:36px}}@media screen and (max-width: 600px){.fs-secure-notice{display:none}}@media screen and (max-width: 1250px){#fs\_promo\_tab{display:none}}@media screen and (max-width: 782px){.fs-secure-notice{left:0;top:46px;text-align:center}}span.fs-submenu-item.fs-sub:before{content:"↳";padding:0 5px}.rtl span.fs-submenu-item.fs-sub:before{content:"↲"}.fs-submenu-item.pricing.upgrade-mode{color:#adff2f}.fs-submenu-item.pricing.trial-mode{color:#83e2ff}#adminmenu .update-plugins.fs-trial{background-color:#00b9eb}.fs-ajax-spinner{border:0;width:20px;height:20px;margin-right:5px;vertical-align:sub;display:inline-block;background:url("/wp-admin/~~images/wpspin\_light-2x.gif");background-size:contain;margin-bottom:-2px}.wrap.fs-section h2{text-align:left}~~.plugins p.fs-upgrade-notice{border:0;background-color:#d54e21;padding:10px;color:#f9f9f9;margin-top:10px} |
  |  | 1 | ﻿.fs-badge{position:absolute;top:10px;right:0;background:#71ae00;color:#fff;text-transform:uppercase;padding:5px 10px;-moz-border-radius:3px 0 0 3px;-webkit-border-radius:3px 0 0 3px;border-radius:3px 0 0 3px;font-weight:bold;border-right:0;-moz-box-shadow:0 2px 1px -1px rgba(0,0,0,.3);-webkit-box-shadow:0 2px 1px -1px rgba(0,0,0,.3);box-shadow:0 2px 1px -1px rgba(0,0,0,.3)}.theme-browser .theme .fs-premium-theme-badge-container{position:absolute;right:0;top:0}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge{position:relative;top:0;margin-top:10px;text-align:center}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge.fs-premium-theme-badge{font-size:1.1em}.theme-browser .theme .fs-premium-theme-badge-container .fs-badge.fs-beta-theme-badge{background:#00a0d2}.fs-switch{position:relative;display:inline-block;color:#ccc;text-shadow:0 1px 1px rgba(255,255,255,.8);height:18px;padding:6px 6px 5px 6px;border:1px solid #ccc;border:1px solid rgba(0,0,0,.2);background:#ececec;box-shadow:0 0 4px rgba(0,0,0,.1),inset 0 1px 3px 0 rgba(0,0,0,.1);cursor:pointer}.fs-switch span{display:inline-block;width:35px;text-transform:uppercase}.fs-switch .fs-toggle{position:absolute;top:1px;width:37px;height:25px;border:1px solid #ccc;border:1px solid rgba(0,0,0,.3);border-radius:4px;background:#fff;background-color:#fff;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0, #ececec), color-stop(1, #fff));background-image:-webkit-linear-gradient(top, #ececec, #fff);background-image:-moz-linear-gradient(top, #ececec, #fff);background-image:-ms-linear-gradient(top, #ececec, #fff);background-image:-o-linear-gradient(top, #ececec, #fff);background-image:linear-gradient(top, bottom, #ececec, #fff);box-shadow:inset 0 1px 0 0 rgba(255,255,255,.5);z-index:999;-moz-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-o-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-ms-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);-webkit-transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1);transition:.4s cubic-bezier(0.54, 1.6, 0.5, 1)}.fs-switch.fs-off .fs-toggle{left:2%}.fs-switch.fs-on .fs-toggle{left:54%}.fs-switch.fs-round{top:8px;padding:4px 25px;-moz-border-radius:24px;-webkit-border-radius:24px;border-radius:24px}.fs-switch.fs-round .fs-toggle{top:0;width:24px;height:24px;-moz-border-radius:24px;-webkit-border-radius:24px;border-radius:24px}.fs-switch.fs-round.fs-off .fs-toggle{left:-1px}.fs-switch.fs-round.fs-on{background:#0085ba}.fs-switch.fs-round.fs-on .fs-toggle{left:25px}.fs-switch.fs-small.fs-round{padding:1px 19px}.fs-switch.fs-small.fs-round .fs-toggle{top:0;width:18px;height:18px;-moz-border-radius:18px;-webkit-border-radius:18px;border-radius:18px}.fs-switch.fs-small.fs-round.fs-on .fs-toggle{left:19px}body.fs-loading,body.fs-loading \*{cursor:wait !important}#fs\_frame{line-height:0;font-size:0}.fs-full-size-wrapper{margin:40px 0 -65px -20px}@media(max-width: 600px){.fs-full-size-wrapper{margin:0 0 -65px -10px}}.fs-notice{position:relative}.fs-notice.fs-has-title{margin-bottom:30px !important}.fs-notice.success{color:green}.fs-notice.promotion{border-color:#00a0d2 !important;background-color:#f2fcff !important}.fs-notice .fs-notice-body{margin:.5em 0;padding:2px}.fs-notice .fs-close{cursor:pointer;color:#aaa;float:right}.fs-notice .fs-close:hover{color:#666}.fs-notice .fs-close>\*{margin-top:7px;display:inline-block}.fs-notice label.fs-plugin-title{background:rgba(0,0,0,.3);color:#fff;padding:2px 10px;position:absolute;top:100%;bottom:auto;right:auto;-moz-border-radius:0 0 3px 3px;-webkit-border-radius:0 0 3px 3px;border-radius:0 0 3px 3px;left:10px;font-size:12px;font-weight:bold;cursor:auto}div.fs-notice.updated,div.fs-notice.success,div.fs-notice.promotion{display:block !important}#fs\_connect .fs-error ol,#fs\_connect .fs-error .fs-api-request-error-show-details-link,#fs\_connect .fs-error .fs-api-request-error-details,.fs-modal .notice-error ol,.fs-modal .notice-error .fs-api-request-error-show-details-link,.fs-modal .notice-error .fs-api-request-error-details,.fs-notice.error ol,.fs-notice.error .fs-api-request-error-show-details-link,.fs-notice.error .fs-api-request-error-details{text-align:left}#fs\_connect .fs-error ol,.fs-modal .notice-error ol,.fs-notice.error ol{list-style-type:disc}#fs\_connect .fs-error .fs-api-request-error-show-details-link,.fs-modal .notice-error .fs-api-request-error-show-details-link,.fs-notice.error .fs-api-request-error-show-details-link{text-decoration:none;color:#2271b1;box-shadow:none}#fs\_connect .fs-error .fs-api-request-error-details,.fs-modal .notice-error .fs-api-request-error-details,.fs-notice.error .fs-api-request-error-details{border:1px solid #ccc;padding:5px;overflow:auto;max-height:150px}.rtl .fs-notice .fs-close{float:left}.fs-secure-notice{position:fixed;top:32px;left:160px;right:0;background:#ebfdeb;padding:10px 20px;color:green;z-index:9999;-moz-box-shadow:0 2px 2px rgba(6,113,6,.3);-webkit-box-shadow:0 2px 2px rgba(6,113,6,.3);box-shadow:0 2px 2px rgba(6,113,6,.3);opacity:.95;filter:alpha(opacity=95)}.fs-secure-notice:hover{opacity:1;filter:alpha(opacity=100)}.fs-secure-notice a.fs-security-proof{color:green;text-decoration:none}@media screen and (max-width: 960px){.fs-secure-notice{left:36px}}@media screen and (max-width: 600px){.fs-secure-notice{display:none}}@media screen and (max-width: 1250px){#fs\_promo\_tab{display:none}}@media screen and (max-width: 782px){.fs-secure-notice{left:0;top:46px;text-align:center}}span.fs-submenu-item.fs-sub:before{content:"↳";padding:0 5px}.rtl span.fs-submenu-item.fs-sub:before{content:"↲"}.fs-submenu-item.pricing.upgrade-mode{color:#adff2f}.fs-submenu-item.pricing.trial-mode{color:#83e2ff}#adminmenu .update-plugins.fs-trial{background-color:#00b9eb}.fs-ajax-spinner{border:0;width:20px;height:20px;margin-right:5px;vertical-align:sub;display:inline-block;background:url("/wp-admin/assets/images/wpspin\_light-2x.gif");background-size:contain;margin-bottom:-2px}  .wrap.fs-section h2{text-align:left}  .plugins p.fs-upgrade-notice{border:0;background-color:#d54e21;padding:10px;color:#f9f9f9;margin-top:10px} |
* ## [password-protected/trunk/password-protected.php](/changeset/3034934/password-protected/trunk/password-protected.php "Show the changeset 3034934 restricted to password-protected/trunk/password-protected.php")

  | [r3005632](/browser/password-protected/trunk/password-protected.php?rev=3005632#L4 "Show revision 3005632 of this file in browser") | [r3034934](/browser/password-protected/trunk/password-protected.php?rev=3034934#L4 "Show revision 3034934 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: https://wordpress.org/plugins/password-protected/ |
  | 5 | 5 | Description: A very simple way to quickly password protect your WordPress site with a single password. Please note: This plugin does not restrict access to uploaded files and images and does not work with some caching setups. |
  | 6 |  | Version: 2.6.~~6~~ |
  |  | 6 | Version: 2.6.7 |
  | 7 | 7 | Author: Password Protected |
  | 8 | 8 | Text Domain: password-protected |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L41) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L41) |  |
  | 41 | 41 | class Password\_Protected { |
  | 42 | 42 |  |
  | 43 |  | var $version ~~= '2.6.6~~'; |
  | 44 |  | var $admin      = null; |
  | 45 |  | var $errors     = null; |
  |  | 43 | var $version       = '2.6.7'; |
  |  | 44 | var $admin         = null; |
  |  | 45 | var $errors        = null; |
  | 46 | 46 | var $admin\_caching = null; |
  | 47 | 47 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L58) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L58) |  |
  | 58 | 58 |  |
  | 59 | 59 | add\_filter( 'password\_protected\_is\_active', array( $this, 'allow\_ip\_addresses' ) ); |
  |  | 60 | add\_filter( 'password\_protected\_is\_active', array( $this, 'compatibility\_elementor' ) ); |
  | 60 | 61 |  |
  | 61 | 62 | add\_action( 'init', array( $this, 'disable\_caching' ), 1 ); |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L72) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L73) |  |
  | 72 | 73 | add\_action( 'login\_enqueue\_scripts', array( $this, 'load\_theme\_stylesheet' ), 5 ); |
  | 73 | 74 |  |
  | 74 |  | add\_action('password\_protected\_above\_password\_field', array( $this, 'password\_protected\_above\_password\_field' )); |
  | 75 |  | add\_action('password\_protected\_below\_password\_field', array( $this, 'password\_protected\_below\_password\_field' )); |
  | 76 |  |  |
  |  | 75 | add\_action( 'password\_protected\_above\_password\_field', array( $this, 'password\_protected\_above\_password\_field' ) ); |
  |  | 76 | add\_action( 'password\_protected\_below\_password\_field', array( $this, 'password\_protected\_below\_password\_field' ) ); |
  | 77 | 77 |  |
  | 78 | 78 | // Available from WordPress 4.3+ |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L87) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L87) |  |
  | 87 | 87 | if ( is\_admin() ) { |
  | 88 | 88 |  |
  | 89 |  |  |
  | 90 | 89 | include\_once dirname( \_\_FILE\_\_ ) . '/admin/admin-caching.php'; |
  | 91 | 90 | include\_once dirname( \_\_FILE\_\_ ) . '/admin/admin.php'; |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L93) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L92) |  |
  | 93 | 92 | $this->admin\_caching = new Password\_Protected\_Admin\_Caching( $this ); |
  | 94 | 93 | $this->admin         = new Password\_Protected\_Admin(); |
  | 95 |  |  |
  | 96 | 94 |  |
  | 97 | 95 | } |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L248) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L246) |  |
  | 248 | 246 | } |
  | 249 | 247 |  |
  |  | 248 | /\*\* |
  |  | 249 | \* Compatibility with Elementor |
  |  | 250 | \* |
  |  | 251 | \* @param boolean $access Access for elementor. |
  |  | 252 | \* |
  |  | 253 | \* @return bool |
  |  | 254 | \*/ |
  |  | 255 | public function compatibility\_elementor( $access ) { |
  |  | 256 |  |
  |  | 257 | if ( class\_exists( 'Elementor\\Plugin' ) ) { |
  |  | 258 | if ( Elementor\Plugin::$instance->preview->is\_preview\_mode() ) { |
  |  | 259 | $access = false; |
  |  | 260 | } |
  |  | 261 | } |
  |  | 262 |  |
  |  | 263 | return $access; |
  |  | 264 | } |
  |  | 265 |  |
  | 250 | 266 | /\*\* |
  | 251 | 267 | \* Get Allowed IP Addresses |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L286) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L302) |  |
  | 286 | 302 | \*/ |
  | 287 | 303 | public function maybe\_process\_logout() { |
  | 288 |  |  |
  |  | 304 |  |
  | 289 | 305 | if ( isset( $\_REQUEST['password-protected'] ) && sanitize\_text\_field( $\_REQUEST['password-protected'] ) == 'logout' ) { |
  | 290 | 306 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L310) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L326) |  |
  | 310 | 326 |  |
  | 311 | 327 | if ( $this->is\_active() && isset( $\_REQUEST['password\_protected\_pwd'] ) ) { |
  | 312 |  |  |
  | 313 |  | $password\_protected\_pwd = sanitize\_text\_field( $\_REQUEST['password\_protected\_pwd'] ); |
  | 314 |  | $default\_password       = get\_option( 'password\_protected\_password' ); |
  | 315 |  |  |
  | 316 |  | $auth = false; |
  | 317 |  | $p\_id = 0; |
  |  | 328 |  |
  |  | 329 | $password\_protected\_pwd = sanitize\_text\_field( $\_REQUEST['password\_protected\_pwd'] ); |
  |  | 330 | $default\_password       = get\_option( 'password\_protected\_password' ); |
  |  | 331 |  |
  |  | 332 | $auth = false; |
  |  | 333 | $p\_id = 0; |
  | 318 | 334 |  |
  | 319 | 335 | if ( empty( $default\_password ) ) { |
  | 320 | 336 |  |
  | 321 | 337 | $authentication = $this->password\_protected\_check\_pro\_password( $password\_protected\_pwd ); |
  | 322 |  | $auth = $authentication['auth']; |
  | 323 |  | $p\_id = $authentication['p\_id']; |
  |  | 338 | $auth           = $authentication['auth']; |
  |  | 339 | $p\_id           = $authentication['p\_id']; |
  | 324 | 340 |  |
  | 325 | 341 | } else { |
  | 326 |  |  |
  |  | 342 |  |
  | 327 | 343 | if ( ( hash\_equals( $default\_password, $this->encrypt\_password( $password\_protected\_pwd ) ) && $default\_password != '' ) || apply\_filters( 'password\_protected\_process\_login', false, $password\_protected\_pwd ) ) { |
  | 328 | 344 | $auth = true; |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L332) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L348) |  |
  | 332 | 348 |  |
  | 333 | 349 | $authentication = $this->password\_protected\_check\_pro\_password( $password\_protected\_pwd ); |
  | 334 |  | $auth = $authentication['auth']; |
  | 335 |  | $p\_id = $authentication['p\_id']; |
  |  | 350 | $auth           = $authentication['auth']; |
  |  | 351 | $p\_id           = $authentication['p\_id']; |
  | 336 | 352 | } |
  | 337 |  |  |
  | 338 |  | } |
  | 339 |  |  |
  | 340 |  | $this->errors               = apply\_filters( 'password\_protected\_verify\_recaptcha', $this->errors ); |
  | 341 |  |  |
  | 342 |  | if( count( @$this->errors->errors ) > 0 ) return; |
  | 343 |  |  |
  |  | 353 | } |
  |  | 354 |  |
  |  | 355 | $this->errors = apply\_filters( 'password\_protected\_verify\_recaptcha', $this->errors ); |
  |  | 356 |  |
  |  | 357 | if ( count( @$this->errors->errors ) > 0 ) { |
  |  | 358 | return; |
  |  | 359 | } |
  |  | 360 |  |
  | 344 | 361 | $this->password\_protected\_process\_login( $auth, $password\_protected\_pwd, $p\_id ); |
  | 345 |  |  |
  |  | 362 |  |
  | 346 | 363 | } |
  | 347 | 364 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L349) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L366) |  |
  | 349 | 366 |  |
  | 350 | 367 | public function password\_protected\_process\_login( bool $auth, $requested\_password, $password\_id ) { |
  | 351 |  |  |
  | 352 |  | if~~( $auth )~~ |
  |  | 368 |  |
  |  | 369 | if ( $auth ) { |
  | 353 | 370 | $throttle = apply\_filters( 'password\_protected\_check\_for\_throttling', true ); |
  | 354 |  |  |
  | 355 |  |  |
  | 356 |  | if( $auth && $throttle ) { |
  | 357 |  |  |
  |  | 371 | } |
  |  | 372 |  |
  |  | 373 | if ( $auth && $throttle ) { |
  |  | 374 |  |
  | 358 | 375 | do\_action( 'password\_protected\_success\_login\_attempt', 'global', $requested\_password, $password\_id ); |
  | 359 | 376 | $remember = isset( $\_REQUEST['password\_protected\_rememberme'] ) ? boolval( $\_REQUEST['password\_protected\_rememberme'] ) : false; |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L363) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L380) |  |
  | 363 | 380 | } |
  | 364 | 381 | $this->set\_auth\_cookie( $remember ); |
  | 365 |  |  |
  | 366 |  | $redirect\_to = isset( $\_REQUEST['redirect\_to'] ) ? esc\_url(~~$\_REQUEST['redirect\_to']~~) : ''; |
  |  | 382 |  |
  |  | 383 | $redirect\_to = isset( $\_REQUEST['redirect\_to'] ) ? esc\_url( $\_REQUEST['redirect\_to'] ) : ''; |
  | 367 | 384 | $redirect\_to = apply\_filters( 'password\_protected\_login\_redirect', $redirect\_to, $requested\_password ); |
  | 368 | 385 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L382) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L399) |  |
  | 382 | 399 | // ... otherwise incorrect password |
  | 383 | 400 | $this->clear\_auth\_cookie(); |
  | 384 |  |  |
  |  | 401 |  |
  | 385 | 402 | $show\_default\_error = apply\_filters( 'password\_protected\_throttling\_error\_messages', true ); |
  | 386 |  |  |
  | 387 |  | if~~( $show\_default\_error )~~ |
  |  | 403 |  |
  |  | 404 | if ( $show\_default\_error ) { |
  | 388 | 405 | $this->errors->add( 'incorrect\_password', \_\_( 'Incorrect Password', 'password-protected' ) ); |
  | 389 |  | } |
  | 390 |  | } |
  | 391 |  |  |
  |  | 406 | } |
  |  | 407 | } |
  |  | 408 | } |
  |  | 409 |  |
  | 392 | 410 | /\*\* |
  | 393 | 411 | \* password\_protected\_check\_pro\_password |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L397) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L415) |  |
  | 397 | 415 | \*/ |
  | 398 | 416 | public function password\_protected\_check\_pro\_password( $requested\_password ) { |
  | 399 |  |  |
  | 400 |  | $pro\_passwords= apply\_filters( 'password\_protected\_passwords', array() ); |
  | 401 |  | $pro\_passwords = array\_filter( $pro\_passwords ); |
  | 402 |  | $auth= false; |
  | 403 |  | $p\_id          = 0; |
  | 404 |  |  |
  | 405 |  | if( is\_array( $pro\_passwords ) && count( $pro\_passwords ) > 0 ) { |
  | 406 |  |  |
  | 407 |  | foreach( $pro\_passwords as $i => $p ) { |
  |  | 417 |  |
  |  | 418 | $pro\_passwords = apply\_filters( 'password\_protected\_passwords', array() ); |
  |  | 419 | $pro\_passwords = array\_filter( $pro\_passwords ); |
  |  | 420 | $auth          = false; |
  |  | 421 | $p\_id          = 0; |
  |  | 422 |  |
  |  | 423 | if ( is\_array( $pro\_passwords ) && count( $pro\_passwords ) > 0 ) { |
  |  | 424 |  |
  |  | 425 | foreach ( $pro\_passwords as $i => $p ) { |
  | 408 | 426 |  |
  | 409 | 427 | if ( ( hash\_equals( $p, $this->encrypt\_password( $requested\_password ) ) && $pro\_passwords != '' ) || apply\_filters( 'password\_protected\_process\_login', false, $requested\_password ) ) { |
  | 410 |  |  |
  |  | 428 |  |
  | 411 | 429 | $auth = apply\_filters( 'password\_protected\_login\_password\_matched', $p, $this->errors ); |
  | 412 | 430 | $p\_id = $i; |
  | 413 | 431 | break; |
  | 414 |  |  |
  |  | 432 |  |
  | 415 | 433 | } |
  | 416 |  |  |
  | 417 |  | } |
  | 418 |  |  |
  |  | 434 | } |
  | 419 | 435 | } else { |
  | 420 | 436 |  |
  | 421 | 437 | $auth = false; |
  | 422 |  |  |
  |  | 438 |  |
  | 423 | 439 | } |
  | 424 | 440 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L453) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L469) |  |
  | 453 | 469 | // Filter for adding exceptions. |
  | 454 | 470 | $show\_login = apply\_filters( 'password\_protected\_show\_login', $this->is\_active() ); |
  | 455 |  |  |
  |  | 471 |  |
  | 456 | 472 | // Logged in |
  | 457 | 473 | if ( $this->is\_user\_logged\_in() ) { |
  | 458 | 474 | $show\_login = false; |
  | 459 | 475 | } |
  | 460 |  |  |
  |  | 476 |  |
  | 461 | 477 | if ( ! $show\_login ) { |
  | 462 | 478 | return 1; |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L481) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L497) |  |
  | 481 | 497 |  |
  | 482 | 498 | } else { |
  | 483 |  | global $wp; |
  |  | 499 | global $wp; |
  | 484 | 500 |  |
  | 485 | 501 | $redirect\_to = add\_query\_arg( 'password-protected', 'login', home\_url( $wp->request . '?' . $\_SERVER['QUERY\_STRING'] ) ); |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L516) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L532) |  |
  | 516 | 532 | \*/ |
  | 517 | 533 | public function login\_url() { |
  | 518 |  | global $wp; |
  |  | 534 | global $wp; |
  | 519 | 535 | return add\_query\_arg( 'password-protected', 'login', home\_url( $wp->request . '?' . $\_SERVER['QUERY\_STRING'] ) ); |
  | 520 | 536 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L685) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L701) |  |
  | 685 | 701 | if ( empty( $cookie ) ) { |
  | 686 | 702 |  |
  | 687 |  | $cookie\_name = $this->cookie\_name(); |
  |  | 703 | $cookie\_name   = $this->cookie\_name(); |
  | 688 | 704 | $use\_transient = get\_option( 'password\_protected\_use\_transient', '' ); |
  | 689 | 705 |  |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L926) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L942) |  |
  | 926 | 942 | \* and other admin/plugin compatibility. |
  | 927 | 943 | \* |
  | 928 |  | \* @param   ~~WP\_REST\_Request~~ $access  Full details about the request. |
  | 929 |  | \* @return  WP\_Error|~~boolean~~ |
  |  | 944 | \* @param   null|WP\_Error $access  Full details about the request. |
  |  | 945 | \* @return  WP\_Error|null |
  | 930 | 946 | \*/ |
  | 931 | 947 | public function only\_allow\_logged\_in\_rest\_access( $access ) { |
  | 932 |  |  |
  | 933 |  | // If user is not logged in |
  | 934 |  | if ( $this->is\_active() && ! $this->is\_user\_logged\_in() && ! is\_user\_logged\_in() && ! (bool) get\_option( 'password\_protected\_rest' ) ) { |
  | 935 |  | return new WP\_Error( 'rest\_cannot\_access', \_\_( 'Only authenticated users can access the REST API.', 'password-protected' ), array( 'status' => rest\_authorization\_required\_code() ) ); |
  | 936 |  | } |
  | 937 |  |  |
  | 938 |  | return $access; |
  |  | 948 | if ( $this->is\_active() ) { |
  |  | 949 | if ( is\_user\_logged\_in() ) { |
  |  | 950 | global $current\_user; |
  |  | 951 | if ( $current\_user->has\_cap( 'edit\_posts' ) || $current\_user->has\_cap( 'edit\_pages' ) ) { |
  |  | 952 | return $access; |
  |  | 953 | } |
  |  | 954 | } |
  |  | 955 |  |
  |  | 956 | if ( $this->is\_user\_logged\_in() ) { |
  |  | 957 | return $access; |
  |  | 958 | } |
  |  | 959 |  |
  |  | 960 | if ( get\_option( 'password\_protected\_rest' ) && is\_user\_logged\_in() ) { |
  |  | 961 | return $access; |
  |  | 962 | } |
  |  | 963 | } |
  |  | 964 |  |
  |  | 965 | return new WP\_Error( 'rest\_cannot\_access', \_\_( 'Only authenticated users can access the REST API.', 'password-protected' ), array( 'status' => rest\_authorization\_required\_code() ) ); |
  | 939 | 966 |  |
  | 940 | 967 | } |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L942) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L969) |  |
  | 942 | 969 | /\*\* |
  | 943 | 970 | \* Print text above password field |
  |  | 971 | \* |
  | 944 | 972 | \* @return  void. |
  | 945 | 973 | \*/ |
  | 946 | 974 | public function password\_protected\_above\_password\_field() { |
  | 947 |  | $text = get\_option(~~'password\_protected\_text\_above\_password'~~); |
  | 948 |  | if( ! empty( $text ) ) { |
  |  | 975 | $text = get\_option( 'password\_protected\_text\_above\_password' ); |
  |  | 976 | if ( ! empty( $text ) ) { |
  | 949 | 977 | echo '<div class="password-protected-text-above" style="width:100%;">' . wp\_kses\_post( $text ) . '</div>'; |
  | 950 | 978 | } |
  | […](/browser/password-protected/trunk/password-protected.php?rev=3005632#L953) | […](/browser/password-protected/trunk/password-protected.php?rev=3034934#L981) |  |
  | 953 | 981 | /\*\* |
  | 954 | 982 | \* Print text below password field |
  |  | 983 | \* |
  | 955 | 984 | \* @return  void. |
  | 956 | 985 | \*/ |
  | 957 | 986 | public function password\_protected\_below\_password\_field() { |
  | 958 |  | $text = get\_option(~~'password\_protected\_text\_below\_password'~~); |
  | 959 |  | if( ! empty( $text ) ) { |
  |  | 987 | $text = get\_option( 'password\_protected\_text\_below\_password' ); |
  |  | 988 | if ( ! empty( $text ) ) { |
  | 960 | 989 | echo '<div class="password-protected-text-below" style="width:100%">' . wp\_kses\_post( $text ) . '</div>'; |
  | 961 | 990 | } |
* ## [password-protected/trunk/readme.txt](/changeset/3034934/password-protected/trunk/readme.txt "Show the changeset 3034934 restricted to password-protected/trunk/readme.txt")

  | [r3005632](/browser/password-protected/trunk/readme.txt?rev=3005632#L3 "Show revision 3005632 of this file in browser") | [r3034934](/browser/password-protected/trunk/readme.txt?rev=3034934#L3 "Show revision 3034934 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: password, maintenance mode, coming soon page, password protect, login |
  | 4 | 4 | Requires at least: 4.6 |
  | 5 |  | Tested up to: 6.4.~~1~~ |
  |  | 5 | Tested up to: 6.4.3 |
  | 6 | 6 | Requires PHP: 5.6 |
  | 7 |  | Stable tag: 2.6.~~6~~ |
  |  | 7 | Stable tag: 2.6.7 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 |  |
  | […](/browser/password-protected/trunk/readme.txt?rev=3005632#L139) | […](/browser/password-protected/trunk/readme.txt?rev=3034934#L139) |  |
  | 139 | 139 |  |
  | 140 | 140 | == Changelog == |
  |  | 141 | = 2.6.7 = |
  |  | 142 | - Security: Patched two security improvements suggested by Wordfence team. |
  |  | 143 | - Fix: Updated depreciated PHP function to make it compatible with the latest PHP version. |
  |  | 144 | - Compatibility: Improved compatibility with Elementor. |
  |  | 145 |  |
  | 141 | 146 | = 2.6.6 = |
  | 142 | 147 | - Improvement - Added support for HTML in the above and bottom text displayed in the password screen. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3034934)
* [Zip Archive](?format=zip&new=3034934)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_3744475b_20250111_074129.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Password Protected <= 2.6.6 - Authenticated (Admin+) Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Password Protected <= 2.6.6 - Authenticated (Admin+) Stored Cross-Site Scripting

4.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-0656](https://www.cve.org/CVERecord?id=CVE-2024-0656) |
| --- | --- |
| CVSS | 4.4 (Medium) |
| Publicly Published | February 19, 2024 |
| Last Updated | May 31, 2024 |
| Researcher | [Felipe Restrepo Rodriguez (pfelilpe) - Pfelilpe](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/felipe-restrepo-rodriguez) |

### Description

The Password Protected – Ultimate Plugin to Password Protect Your WordPress Content with Ease plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the Google Captcha Site Key in all versions up to, and including, 2.6.6 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with administrator-level access, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page. This only affects multi-site installations and installations where unfiltered\_html has been disabled.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3034934%40password-protected&new=3034934%40password-protected&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpassword-protected%2Fpassword-protected-266-authenticated-admin-stored-cross-site-scripting&t=Password%20Protected%20%3C%3D%202.6.6%20-%20Authenticated%20%28Admin%2B%29%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpassword-protected%2Fpassword-protected-266-authenticated-admin-stored-cross-site-scripting&text=Password%20Protected%20%3C%3D%202.6.6%20-%20Authenticated%20%28Admin%2B%29%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpassword-protected%2Fpassword-protected-266-authenticated-admin-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Password Protected – Password Protect your WordPress Site, Pages, & WooCommerce Products – Restrict Content, Protect WooCommerce Category, and more

#### [Password Protected – Password Protect your WordPress Site, Pages, & WooCommerce Products – Restrict Content, Protect WooCommerce Category, and more](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/password-protected)

| Software Type | Plugin |
| --- | --- |
| Software Slug | password-protected [(view on wordpress.org)](https://wordpress.org/plugins/password-protected) |
| Patched? | Yes |
| Remediation | Update to version 2.6.7, or a newer patched version |
| Affected Version | * <= 2.6.6 |
| Patched Version | * 2.6.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


