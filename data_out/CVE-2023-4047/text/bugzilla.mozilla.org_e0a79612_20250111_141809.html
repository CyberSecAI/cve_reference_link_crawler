

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1839073)
* [XML](/show_bug.cgi?ctype=xml&id=1839073)

Closed
[Bug 1839073](/show_bug.cgi?id=1839073)
(CVE-2023-4047)

Opened 2 years ago
Closed 2 years ago

# Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired

## Categories

### (Toolkit :: PopupNotifications and Notification Bars, defect, P1)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars#PopupNotifications%20and%20Notification%20Bars)

PopupNotifications and Notification Bars
▾

Toolkit :: PopupNotifications and Notification Bars
The underlying mechanism that shows "doorhanger" panels as well as notification bars (sometimes referred to as "message bars").
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=PopupNotifications%20and%20Notification%20Bars)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

117 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | [116+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=116%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=verified) |
| firefox-esr115 | [116+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=116%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox114 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix) |
| firefox115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix) |
| firefox116 | [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=verified) |
| firefox117 | [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 | 116+ | verified |
| firefox-esr115 | 116+ | verified |
| firefox-esr128 | --- | --- |
| firefox114 |  | wontfix |
| firefox115 |  | wontfix |
| firefox116 | + | verified |
| firefox117 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: haxatron1, Assigned: emz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/46f58cc04758e80835820f0f1d5646bb?d=mm&size=40)  [emz](/user_profile?user_id=636491)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ece264081141db92a1ad0d985a5d3489?d=mm&size=40)  [haxatron1](/user_profile?user_id=704427)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/679f3fb3f1d10ec10892fd611fea5c14?d=mm&size=40)  [hjones](/user_profile?user_id=692246)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

### (Regression, [URL](https://haxatron1-bugs.glitch.me/b1839073/ "https://haxatron1-bugs.glitch.me/b1839073/") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1844776](/show_bug.cgi?id=1844776 "RESOLVED FIXED - Land test for Bug 1839073")

Dependency [tree](/showdependencytree.cgi?id=1839073&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1839073)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

[CVE-2023-32207](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)")

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1840785](/show_bug.cgi?id=1840785 "RESOLVED DUPLICATE - Firefox Browser Desktop Permission Prompt Tapjacking")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[haxatron1-bugs.glitch.me/b1839073](https://haxatron1-bugs.glitch.me/b1839073/ "https://haxatron1-bugs.glitch.me/b1839073/")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1840785](/show_bug.cgi?id=1840785 "RESOLVED DUPLICATE - Firefox Browser Desktop Permission Prompt Tapjacking"), [CVE-2023-6206](/show_bug.cgi?id=1857430 "VERIFIED FIXED - Clickjacking of permission prompts for camera, microphone, geolocation via full screen"), [1865914](/show_bug.cgi?id=1865914 "VERIFIED FIXED - PopupNotifications clickjacking by obscuring notification via full screen exit transition")

## Details

### (5 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?] [adv-main116+] [adv-ESR115.1+] [adv-ESR102.14+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-4047

[Keywords:](/describekeywords.cgi)

[csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---),
[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?] [adv-main116+] [adv-ESR115.1+] [adv-ESR102.14+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c39 "2 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 3 obsolete files)

| [Untitled\_ Jun 18, 2023 11\_22 PM.webm](/attachment.cgi?id=9339746)  [2 years ago](#c1)  [haxatron1](/user_profile?user_id=704427)   255.79 KB, video/webm |  | [Details](/attachment.cgi?id=9339746&action=edit) |
| --- | --- | --- |
| [clickjack.html](/attachment.cgi?id=9339748)  [2 years ago](#c2)  [haxatron1](/user_profile?user_id=704427)   469 bytes, text/html |  | [Details](/attachment.cgi?id=9339748&action=edit) |
| [Untitled\_ Jun 18, 2023 11\_30 PM.webm](/attachment.cgi?id=9339750)  [2 years ago](#c3)  [haxatron1](/user_profile?user_id=704427)   289.10 KB, video/webm |  | [Details](/attachment.cgi?id=9339750&action=edit) |
| [clickjack-long-delay.html](/attachment.cgi?id=9340027)  [2 years ago](#c14)  [haxatron1](/user_profile?user_id=704427)   529 bytes, text/html |  | [Details](/attachment.cgi?id=9340027&action=edit) |
| [Bug 1839073, r=Gijs!](/attachment.cgi?id=9340510)  [2 years ago](#c19)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c36 "2 years ago")  RyanVM : [approval-mozilla-esr102+](#c43 "2 years ago")  RyanVM : [approval-mozilla-esr115+](#c41 "2 years ago")  tjr : [sec-approval+](#c26 "2 years ago") | [Details](/attachment.cgi?id=9340510&action=edit) | [Review](/attachment.cgi?id=9340510) |
| [Bug 1839073 - Test. r=Gijs!](/attachment.cgi?id=9340511)  [2 years ago](#c20)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9340511&action=edit) | [Review](/attachment.cgi?id=9340511) |
| [Bug 1839073, r=Gijs!](/attachment.cgi?id=9342545)  [2 years ago](#c28)  [Emma Zühlcke [:emz]](/user_profile?user_id=636491)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9342545&action=edit) | [Review](/attachment.cgi?id=9342545) |
| [advisory.txt](/attachment.cgi?id=9346072)  [1 years ago](#c47)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   214 bytes, text/plain |  | [Details](/attachment.cgi?id=9346072&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1839073#c0)• 2 years ago |
|  | |

By opening a new window maintaining it for 500ms and closing it, it bypasses clickjacking protections.

1. Go to <https://haxatron1-bugs.glitch.me/clickjack.html> and spam click on button
Flags: sec-bounty?

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1839073#c1)• 2 years ago |
|  | |

Attached video
[Untitled\_ Jun 18, 2023 11\_22 PM.webm](attachment.cgi?id=9339746) (obsolete)
— [Details](attachment.cgi?id=9339746&action=edit)

video

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1839073#c2)• 2 years ago |
|  | |

Attached file
[clickjack.html](attachment.cgi?id=9339748)
— [Details](attachment.cgi?id=9339748&action=edit)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1839073#c3)• 2 years ago |
|  | |

Attached video
[Untitled\_ Jun 18, 2023 11\_30 PM.webm](attachment.cgi?id=9339750)
— [Details](attachment.cgi?id=9339750&action=edit)

[Attachment #9339746](/attachment.cgi?id=9339746&action=edit "Untitled_ Jun 18, 2023 11_22 PM.webm") -
Attachment is obsolete: true

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1839073#c4)• 2 years ago |
|  | |

I have a made a site for you to test the control setup so you can see the difference with opening a new window and without open a new window (bypass)

This URL is the site without opening a new window <https://haxatron1-bugs.glitch.me/clickjack2.html>.

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1839073#c5)• 2 years ago |
|  | |

For an even easier reproduction, go to about:config and set the activation delay parameter to 5000 =>

security.notification\_enable\_delay

Then reproduce the same on <https://haxatron1-bugs.glitch.me/clickjack3.html>, in this test case it is really obvious that the clickjacking protections are bypassed.

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1839073#c6)• 2 years ago |
|  | |

(In reply to haxatron1 from [comment #5](/show_bug.cgi?id=1839073#c5 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> For an even easier reproduction, go to about:config and set the activation delay parameter to 5000 =>
>
> security.notification\_enable\_delay
>
> Then reproduce the same on <https://haxatron1-bugs.glitch.me/clickjack3.html>, in this test case it is really obvious that the clickjacking protections are bypassed.

browser has to be restarted first before the configuration can be applied.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1839073#c7)• 2 years ago |
|  | |

Paul, can you take a look? I feel like [bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") should have fixed this.

Component: Security → Site PermissionsFlags: needinfo?(pbz)Summary: Bypass clickjacking protections on Desktop via opening a new window → Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1839073#c8)• 2 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #7](/show_bug.cgi?id=1839073#c7 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> Paul, can you take a look? I feel like [bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") should have fixed this.

You might be right. I can't reproduce this on Firefox release or Nightly. I've set my security delay to `5000` and tested with the page linked in [comment 0](/show_bug.cgi?id=1839073#c0 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired").

Reporter, which version of Firefox did you use to test this? Could you confirm that it still works on `114.0.1` or higher?

Flags: needinfo?(pbz) → needinfo?(haxatron1)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1839073#c9)• 2 years ago |
|  | |

Reproduced on Windows FF 114.0.1 (64-bit)

Please use <https://haxatron1-bugs.glitch.me/clickjack3.html> for the 5000 ms delay, [comment 0](/show_bug.cgi?id=1839073#c0 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired") is configured for the 500 ms delay

Flags: needinfo?(haxatron1)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1839073#c10)• 2 years ago |
|  | |

let me know if you are still not able to reproduce

Flags: needinfo?(pbz)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1839073#c11)• 2 years ago |
|  | |

If still not able to reproduce can also try, <https://haxatron1-bugs.glitch.me/clickjack4.html> which increases from 10ms to 50ms delay for the window.open() opens the new page. The important thing is that the geolocation pemission prompt must be registered first before the call to window.open()

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1839073#c12)• 2 years ago |
|  | |

The POC positioning also might be a bit off with the bookmarks bar. On my Firefox (both nightly and 114 build), I changed bookmarks bar to show only on new tab.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1839073#c13)• 2 years ago |
|  | |

(In reply to Paul Zühlcke [:pbz] from [comment #8](/show_bug.cgi?id=1839073#c8 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> (In reply to :Gijs (he/him) from [comment #7](/show_bug.cgi?id=1839073#c7 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))
>
> > Paul, can you take a look? I feel like [bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") should have fixed this.

For the avoidance of doubt, I can repro on 116. I just don't understand why/how, as I thought the other bug was supposed to have fixed this.

Is it possible that we either don't cancel the timeout when the popup is hidden, or don't restart the timer when the popup is reshown, or something?

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1839073#c14)• 2 years ago |
|  | |

Attached file
[clickjack-long-delay.html](attachment.cgi?id=9340027)
— [Details](attachment.cgi?id=9340027&action=edit)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a165266_704427)• 2 years ago |

URL: [https://haxatron1-bugs.glitch.me/clic...](https://haxatron1-bugs.glitch.me/clickjack.html) → [https://haxatron1-bugs.glitch.me/b183...](https://haxatron1-bugs.glitch.me/b1839073/)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1839073#c15)• 2 years ago |
|  | |

To prevent me from accidentally modifying my own PoC, I have deleted the test cases from my my hosted website and uploaded the 5000ms delay test case onto bugzilla so that you can test on bugzilla as well. I have also moved all test cases under <https://haxatron1-bugs.glitch.me/b1839073/>

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1839073#c16)• 2 years ago |
|  | |

Sorry, I had misunderstood the PoC, I can reproduce now. This is a regression of [Bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") where we changed when `timeShown` is set. I verified this by testing with that patch reverted.

I still need to look into it more but I suspect it's because we set `timeShown` before the `hidePanel` promise resolves.

Assignee: nobody → pbzStatus: NEW → ASSIGNEDFlags: needinfo?(pbz)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Regressed by: [CVE-2023-32207](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)")

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a328650_575867)• 2 years ago |

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=affected)
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected)
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1839073#c18)• 2 years ago |
|  | |

I think the problem is that we don't override `timeShown` when we call `_showPanel` for when we re-show it after a tab switch. See <https://searchfox.org/mozilla-central/rev/3424c000a7ff304b2d1efb8561a924232f7f12fc/toolkit/modules/PopupNotifications.sys.mjs#1262>

I'll submit a patch.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1839073#c19)• 2 years ago |
|  | |

Attached file
[Bug 1839073, r=Gijs!](attachment.cgi?id=9340510)
— [Details](attachment.cgi?id=9340510&action=edit)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1839073#c20)• 2 years ago |
|  | |

Attached file
[Bug 1839073 - Test. r=Gijs!](attachment.cgi?id=9340511) (obsolete)
— [Details](attachment.cgi?id=9340511&action=edit)

Depends on D181779

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a341652_636491)• 2 years ago |

Severity: -- → S2Priority: -- → P1

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a666778_600971)• 2 years ago |

[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Attachment description: WIP: Bug 1839073, r=Gijs! → Bug 1839073, r=Gijs!

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a666820_600971)• 2 years ago |

[Attachment #9340511](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!") -
Attachment description: WIP: Bug 1839073 - Test. r=Gijs! → Bug 1839073 - Test. r=Gijs!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a883926_1689)• 2 years ago |

See Also: → [1840785](/show_bug.cgi?id=1840785 "RESOLVED DUPLICATE - Firefox Browser Desktop Permission Prompt Tapjacking")

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1839073#c21)• 2 years ago |
|  | |

We have a fix, but I'm holding off from landing since this is still pending a sec rating.

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1839073#c22)• 2 years ago |
|  | |

(In reply to Paul Zühlcke [:pbz] from [comment #21](/show_bug.cgi?id=1839073#c21 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> We have a fix, but I'm holding off from landing since this is still pending a sec rating.

I think it should be the same as <https://bugzilla.mozilla.org/show_bug.cgi?id=1826116>?

Flags: needinfo?(dveditz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1839073#c23)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch makes it obvious that there is a bug with our security delay in PopupNotifications. It does however not show the exact conditions that are needed in order for this to be exploited.

  Similar to [Bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)").
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: all
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: I don't expect any merge conflicts since for [Bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") we already backported. This patch is a one-line change on top of that.
* **How likely is this patch to cause regressions; how much testing does it need?**: It's a very small change and has been verified locally.

  However updating the security delay comes with the risk of breaking PopupNotification buttons. There is also the risk that we further regress and break the security delay more.

  The test for [Bug 1826116](/show_bug.cgi?id=1826116 "VERIFIED FIXED - Clickjacking to allowed location permission (bypassing button-enable delay)") and the one included in the other patch for this bug increase our test coverage of the security delay mechanism.
* **Is Android affected?**: No
[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: sec-approval?

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1028190_636491)• 2 years ago |

[Attachment #9340511](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!") -
Flags: sec-approval?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1466382_575867)• 2 years ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1839073#c25)• 2 years ago |
|  | |

Comment on [attachment 9340511](/attachment.cgi?id=9340511 "Bug 1839073 - Test. r=Gijs!") [[details]](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired") - Test. r=Gijs!

Clearing flag for test

[Attachment #9340511](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1839073#c26)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

Approved to uplift and land

[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1473347_578488)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reminder-test 2023-09-12][reporter-external] [client-bounty-form] [verif?]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1487295_75935)• 2 years ago |

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix)
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix)
[tracking-firefox116](/buglist.cgi?f1=cf_tracking_firefox116&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B)
[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [116+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=116%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [116+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=116%2B)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1839073#c27)• 2 years ago |
|  | |

(In reply to haxatron1 from [comment #22](/show_bug.cgi?id=1839073#c22 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> (In reply to Paul Zühlcke [:pbz] from [comment #21](/show_bug.cgi?id=1839073#c21 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))
>
> > We have a fix, but I'm holding off from landing since this is still pending a sec rating.
>
> I think it should be the same as <https://bugzilla.mozilla.org/show_bug.cgi?id=1826116>?

For sec-severity, a attack scenario would be asking the user to open the new about:blank window to start a game, and when enough clicks occur in the game, the window closes and the victim accidentally clicks on the accept button of the prompt.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1839073#c28)• 2 years ago |
|  | |

Attached file
[Bug 1839073, r=Gijs!](attachment.cgi?id=9342545) (obsolete)
— [Details](attachment.cgi?id=9342545&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D181779>

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1839073#c29)• 2 years ago |
|  | |

Pushed by nerli@mozilla.com:
<https://hg.mozilla.org/mozilla-central/rev/75b8d8d5ea21>
r=emilio

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1620804_258347)• 2 years ago |

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 117 Branch

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1839073#c30)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

### Beta/Release Uplift Approval Request

* **User impact if declined**: Clickjacking sec-bug. Users may be tricked into accepting permission prompts, e.g. geolocation, camera, microphone, ...
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: See [comment 0](/show_bug.cgi?id=1839073#c0 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired")

  It should not be possible to interact with the prompt directly after it becomes visible. Users should only be able to interact with the Block/Allow buttons after the security delay (500 ms).

  To better test this you can also increase the security delay via pref, see <https://bugzilla.mozilla.org/show_bug.cgi?id=1839073#c5>
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: It's a very small change and has been verified locally and has test coverage (test landing separately).

  However updating the security delay comes with the risk of breaking PopupNotification buttons. There is also the risk that we further regress and break the security delay more.
* **String changes made/needed**:
* **Is Android affected?**: No

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: See beta uplift request
* **Fix Landed on Version**:
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: See beta uplift request
[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-esr115?
[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-esr102?
[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-beta?

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1621865_636491)• 2 years ago |

Flags: qe-verify+

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1839073#c31)• 2 years ago |
|  | |

It would be nice to get QA verification prior to the uplifts. I'm mentioning this because in the past we had uplifts done before the verification.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1647051_600971)• 2 years ago |

[Attachment #9342545](/attachment.cgi?id=9342545&action=edit "Bug 1839073, r=Gijs!") -
Attachment is obsolete: true

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1880801_553429)• 2 years ago |

QA Whiteboard: [qa-triaged]

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1839073#c32)• 2 years ago |
|  | |

I tried to reproduce using 116.0b3 and 114.0.1 on Windows 10 and Windows 11 but I only managed to reproduce twice from I don't know how many tries I had so I don't think I can reliably verify this as being fixed.

These are the steps I used:

1. Changed the `security.notification_enable_delay pref` to `5000`
2. Loaded <https://haxatron1-bugs.glitch.me/clickjack3.html> or the `clickjack-long-delay.html` file attached in the bug
3. Clicked the button (and kept clicking in the same spot where the Allow button from the notification is)
4. Closed the new blank opened window (using keyboard shortcut)

Result: Clicking on the Allow did nothing for a few seconds (the delay) only after the delay was over the click was registered on Allow and the coordinates were displayed.

I don't know if I missed something but if not, could you please verify that this is fixed for you using the latest Nightly 117.0a1 build? <https://archive.mozilla.org/pub/firefox/nightly/2023/07/2023-07-10-09-40-14-mozilla-central/firefox-117.0a1.en-US.win64.zip>

Flags: needinfo?(haxatron1)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1839073#c33)• 2 years ago |
|  | |

For Step 4, you have to wait the full 5000ms (when using the security pref) instead of closing the keyboard shortcut.

I can verify this as fixed on Build 17.0a1 (2023-07-10) (64-bit

Flags: needinfo?(haxatron1)

|  | [haxatron1](/user_profile?user_id=704427)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1839073#c34)• 2 years ago |
|  | |

build 117.0a1 (2023-07-10) (64-bit)\*

Status: RESOLVED → VERIFIED

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1839073#c35)• 2 years ago |
|  | |

(In reply to haxatron1 from [comment #33](/show_bug.cgi?id=1839073#c33 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"))

> For Step 4, you have to wait the full 5000ms (when using the security pref) instead of closing the keyboard shortcut.
>
> I can verify this as fixed on Build 17.0a1 (2023-07-10) (64-bit

I get it now, I was able to reproduce it myself on the old build! \o/

Thanks for verifying on above build, I was also able to verify that this is fixed using the latest Nightly from today 2023-07-11) on both Windows 10 64bit and Windows 11.

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=verified)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1839073#c36)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

Approved for 116.0b4

[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1839073#c37)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/b5dd2d4077b7>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1975710_690067)• 2 years ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1979556_636491)• 2 years ago |

Duplicate of this bug: [1840785](/show_bug.cgi?id=1840785 "RESOLVED DUPLICATE - Firefox Browser Desktop Permission Prompt Tapjacking")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a1998676_1689)• 2 years ago |

Flags: needinfo?(dveditz)Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1839073#c39)• 2 years ago |
|  | |

The test examples use the less scary geolocation prompt, but this applies to all similar prompts and the sec-high is given assuming scarier permissions like camera/mic ones.

Flags: sec-bounty? → sec-bounty+

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1839073#c40)• 2 years ago |
|  | |

Also verified as fixed using latest Beta build 116.0b4 across platforms (Windows 10, macOS 13.2 and Ubuntu 22.04).

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=verified)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1839073#c41)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

Approved for 115.1esr.

[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1839073#c42)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/ea939ed893bc>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1839073#c43)• 2 years ago |
|  | |

Comment on [attachment 9340510](/attachment.cgi?id=9340510 "Bug 1839073, r=Gijs!") [[details]](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired"), r=Gijs!

And 102.14esr.

[Attachment #9340510](/attachment.cgi?id=9340510&action=edit "Bug 1839073, r=Gijs!") -
Flags: approval-mozilla-esr102? → approval-mozilla-esr102+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1839073#c44)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/acd5ece8baec>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a2087503_75935)• 2 years ago |

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Bogdan Maris, Desktop Test Engineering [PTO until 13 Jan]](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1839073#c45)• 2 years ago |
|  | |

Verified on both esr102 and esr115 builds across platforms (Windows 10, macOS 13.2 and Ubuntu 22.04) from treeherder that contain the fix.

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=verified)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)Flags: qe-verify+

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a2844162_636491)• 1 years ago |

Blocks: [1844776](/show_bug.cgi?id=1844776 "RESOLVED FIXED - Land test for Bug 1839073")

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1839073#c46)• 1 years ago |
|  | |

Comment on [attachment 9340511](/attachment.cgi?id=9340511 "Bug 1839073 - Test. r=Gijs!") [[details]](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!")

[Bug 1839073](/show_bug.cgi?id=1839073 "VERIFIED FIXED - Bypass site permission clickjacking protections on Desktop by opening a new tab with window.open() and closing it after the permission timeout has expired") - Test. r=Gijs!

Revision D181780 was moved to [bug 1844776](/show_bug.cgi?id=1844776 "RESOLVED FIXED - Land test for Bug 1839073"). Setting [attachment 9340511](/attachment.cgi?id=9340511 "Bug 1839073 - Test. r=Gijs!") [[details]](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!") to obsolete.

[Attachment #9340511](/attachment.cgi?id=9340511&action=edit "Bug 1839073 - Test. r=Gijs!") -
Attachment is obsolete: true

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a3320065_486733)• 1 years ago |

Whiteboard: [reminder-test 2023-09-12][reporter-external] [client-bounty-form] [verif?] → [reminder-test 2023-09-12][reporter-external] [client-bounty-form] [verif?] [adv-main116+] [adv-ESR115.1+] [adv-ESR102.14+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1839073#c47)• 1 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9346072)
— [Details](attachment.cgi?id=9346072&action=edit)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1839073#c48)• 1 year ago |
|  | |

2 months ago, tjr placed a reminder on the bug using the whiteboard tag `[reminder-test 2023-09-12]` .

pbz, please refer to the original comment to better understand the reason for the reminder.

Flags: needinfo?(pbz)Whiteboard: [reminder-test 2023-09-12][reporter-external] [client-bounty-form] [verif?] [adv-main116+] [adv-ESR115.1+] [adv-ESR102.14+] → [reporter-external] [client-bounty-form] [verif?] [adv-main116+] [adv-ESR115.1+] [adv-ESR102.14+]

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1839073#c49)• 1 year ago |
|  | |

Queued the test for landing.

Flags: needinfo?(pbz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a9769184_159069)• 1 year ago |

See Also: → [CVE-2023-6206](/show_bug.cgi?id=1857430 "VERIFIED FIXED - Clickjacking of permission prompts for camera, microphone, geolocation via full screen")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a13563135_159069)• 1 year ago |

See Also: → [1865914](/show_bug.cgi?id=1865914 "VERIFIED FIXED - PopupNotifications clickjacking by obscuring notification via full screen exit transition")

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a14598651_636491)• 1 year ago |

Group: firefox-core-securityComponent: Site Permissions → PopupNotifications and Notification BarsProduct: Firefox → Toolkit

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a17251381_1689)• 1 year ago |

Group: firefox-core-security, core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a17257972_1689)• 1 year ago |

Alias: CVE-2023-4047

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a29990791_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839073#a30274939_1689)• 7 months ago |

Keywords: [csectype-spoof](/buglist.cgi?keywords=csectype-spoof&resolution=---) → [csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---)
You need to [log in](/show_bug.cgi?id=1839073&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [haxatron1](/user_profile?user_id=704427)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

