=== Content from plugins.trac.wordpress.org_b7f813f9_20250111_194231.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fuser-registration%2Ftags%2F3.1.5%2Fincludes%2Fclass-ur-ajax.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3016405 "Revision 3016405")
* [Next Revision](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439 "Revision 3070439") →
* [Blame](/browser/user-registration/trunk/includes/class-ur-ajax.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/user-registration/tags/3.1.5/includes/class-ur-ajax.php)

---

# [source:](/browser?order=name "Go to repository root") [user-registration](/browser/user-registration?order=name "View user-registration")/[tags](/browser/user-registration/tags?order=name "View tags")/[3.1.5](/browser/user-registration/tags/3.1.5?order=name "View 3.1.5")/[includes](/browser/user-registration/tags/3.1.5/includes?order=name "View includes")/[class-ur-ajax.php](/browser/user-registration/tags/3.1.5/includes/class-ur-ajax.php?order=name "View class-ur-ajax.php")

View diff against:

View revision:

| [Last change](/changeset/3034436/user-registration/trunk/includes/class-ur-ajax.php "View differences") on this file was [3034436](/changeset/3034436/ "View changeset 3034436"), checked in by wpeverestdev, [11 months ago](/timeline?from=2024-02-12T09%3A09%3A51Z&precision=second "See timeline at 02/12/2024 09:09:51 AM") |
| --- |
| Update to version 3.1.4 from GitHub |
| **File size:** 50.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* UserRegistration UR\_AJAX |
| [4](#L4) | \* |
| [5](#L5) | \* AJAX Event Handler |
| [6](#L6) | \* |
| [7](#L7) | \* @package UserRegistration/Classes |
| [8](#L8) | \* @class   UR\_AJAX |
| [9](#L9) | \* @version 1.0.0 |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | if ( ! defined( 'ABSPATH' ) ) { |
| [13](#L13) | exit; |
| [14](#L14) | } |
| [15](#L15) |  |
| [16](#L16) | /\*\* |
| [17](#L17) | \* UR\_AJAX Class |
| [18](#L18) | \*/ |
| [19](#L19) | class UR\_AJAX { |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* Field key array |
| [23](#L23) | \* |
| [24](#L24) | \* @var array |
| [25](#L25) | \*/ |
| [26](#L26) | private static $field\_key\_aray = array(); |
| [27](#L27) | /\*\* |
| [28](#L28) | \* Check whether is field key pass |
| [29](#L29) | \* |
| [30](#L30) | \* @var bool |
| [31](#L31) | \*/ |
| [32](#L32) | private static $is\_field\_key\_pass = true; |
| [33](#L33) | /\*\* |
| [34](#L34) | \* Field key value |
| [35](#L35) | \* |
| [36](#L36) | \* @var array |
| [37](#L37) | \*/ |
| [38](#L38) | private static $failed\_key\_value = array(); |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Initialization of ajax. |
| [42](#L42) | \*/ |
| [43](#L43) | public static function init() { |
| [44](#L44) | self::add\_ajax\_events(); |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Hook in methods - uses WordPress ajax handlers (admin-ajax) |
| [49](#L49) | \*/ |
| [50](#L50) | public static function add\_ajax\_events() { |
| [51](#L51) | $ajax\_events = array( |
| [52](#L52) | 'user\_input\_dropped'        => true, |
| [53](#L53) | 'form\_save\_action'          => false, |
| [54](#L54) | 'user\_form\_submit'          => true, |
| [55](#L55) | 'update\_profile\_details'    => true, |
| [56](#L56) | 'profile\_pic\_upload'        => true, |
| [57](#L57) | 'profile\_pic\_remove'        => true, |
| [58](#L58) | 'ajax\_login\_submit'         => true, |
| [59](#L59) | 'send\_test\_email'           => true, |
| [60](#L60) | 'rated'                     => false, |
| [61](#L61) | 'dashboard\_widget'          => false, |
| [62](#L62) | 'dismiss\_notice'            => false, |
| [63](#L63) | 'import\_form\_action'        => false, |
| [64](#L64) | 'template\_licence\_check'    => false, |
| [65](#L65) | 'captcha\_setup\_check'       => false, |
| [66](#L66) | 'install\_extension'         => false, |
| [67](#L67) | 'create\_form'               => true, |
| [68](#L68) | 'allow\_usage\_dismiss'       => false, |
| [69](#L69) | 'cancel\_email\_change'       => false, |
| [70](#L70) | 'email\_setting\_status'      => false, |
| [71](#L71) | 'locked\_form\_fields\_notice' => false, |
| [72](#L72) | 'search\_global\_settings'    => false, |
| [73](#L73) | 'php\_notice\_dismiss'        => false, |
| [74](#L74) | 'locate\_form\_action'        => false, |
| [75](#L75) | ); |
| [76](#L76) |  |
| [77](#L77) | foreach ( $ajax\_events as $ajax\_event => $nopriv ) { |
| [78](#L78) | add\_action( 'wp\_ajax\_user\_registration\_' . $ajax\_event, array( \_\_CLASS\_\_, $ajax\_event ) ); |
| [79](#L79) |  |
| [80](#L80) | if ( $nopriv ) { |
| [81](#L81) | add\_action( 'wp\_ajax\_nopriv\_user\_registration\_' . $ajax\_event, array( \_\_CLASS\_\_, $ajax\_event ) ); |
| [82](#L82) | } |
| [83](#L83) | } |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | /\*\* |
| [87](#L87) | \* Triggered when admin search for the global settings. |
| [88](#L88) | \*/ |
| [89](#L89) | public static function search\_global\_settings() { |
| [90](#L90) | check\_ajax\_referer( 'user\_registration\_search\_global\_settings', 'security' ); |
| [91](#L91) |  |
| [92](#L92) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [93](#L93) | wp\_die( -1 ); |
| [94](#L94) | } |
| [95](#L95) | UR\_Admin\_Settings::search\_settings(); |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Triggered when clicking the allow usage notice allow or deny buttons. |
| [100](#L100) | \*/ |
| [101](#L101) | public static function allow\_usage\_dismiss() { |
| [102](#L102) | check\_ajax\_referer( 'allow\_usage\_nonce', '\_wpnonce' ); |
| [103](#L103) |  |
| [104](#L104) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [105](#L105) | wp\_die( -1 ); |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) | $allow\_usage\_tracking = isset( $\_POST['allow\_usage\_tracking'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['allow\_usage\_tracking'] ) ) : false; |
| [109](#L109) |  |
| [110](#L110) | update\_option( 'user\_registration\_allow\_usage\_notice\_shown', true ); |
| [111](#L111) |  |
| [112](#L112) | if ( ur\_string\_to\_bool( $allow\_usage\_tracking ) ) { |
| [113](#L113) | update\_option( 'user\_registration\_allow\_usage\_tracking', true ); |
| [114](#L114) | } else { |
| [115](#L115) | update\_option( 'user\_registration\_allow\_usage\_tracking', false ); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | wp\_die(); |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* Get Post data on frontend form submit |
| [123](#L123) | \* |
| [124](#L124) | \* @return void |
| [125](#L125) | \*/ |
| [126](#L126) | public static function user\_form\_submit() { |
| [127](#L127) | /\*\* |
| [128](#L128) | \* Filter to modify user capability. |
| [129](#L129) | \* Default value is 'create\_users'. |
| [130](#L130) | \*/ |
| [131](#L131) | $current\_user\_capability = apply\_filters( 'ur\_registration\_user\_capability', 'create\_users' ); |
| [132](#L132) |  |
| [133](#L133) | if ( is\_user\_logged\_in() && ! current\_user\_can( 'administrator' ) && ! current\_user\_can( $current\_user\_capability ) ) { //phpcs:ignore |
| [134](#L134) | wp\_send\_json\_error( |
| [135](#L135) | array( |
| [136](#L136) | 'message' => \_\_( 'You are already logged in.', 'user-registration' ), |
| [137](#L137) | ) |
| [138](#L138) | ); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( ! check\_ajax\_referer( 'user\_registration\_form\_data\_save\_nonce', 'security', false ) ) { |
| [142](#L142) | wp\_send\_json\_error( |
| [143](#L143) | array( |
| [144](#L144) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [145](#L145) | ) |
| [146](#L146) | ); |
| [147](#L147) | } |
| [148](#L148) |  |
| [149](#L149) | $form\_id             = isset( $\_POST['form\_id'] ) ? absint( $\_POST['form\_id'] ) : 0; |
| [150](#L150) | $nonce               = isset( $\_POST['ur\_frontend\_form\_nonce'] ) ? wp\_unslash( sanitize\_key( $\_POST['ur\_frontend\_form\_nonce'] ) ) : ''; |
| [151](#L151) | $captcha\_response    = isset( $\_POST['captchaResponse'] ) ? ur\_clean( wp\_unslash( $\_POST['captchaResponse'] ) ) : ''; //phpcs:ignore |
| [152](#L152) | $flag                = wp\_verify\_nonce( $nonce, 'ur\_frontend\_form\_id-' . $form\_id ); |
| [153](#L153) | $recaptcha\_enabled   = ur\_string\_to\_bool( ur\_get\_form\_setting\_by\_key( $form\_id, 'user\_registration\_form\_setting\_enable\_recaptcha\_support', false ) ); |
| [154](#L154) | $recaptcha\_type      = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_version', 'v2' ); |
| [155](#L155) | $invisible\_recaptcha = ur\_option\_checked( 'user\_registration\_captcha\_setting\_invisible\_recaptcha\_v2', false ); |
| [156](#L156) |  |
| [157](#L157) | if ( 'v2' === $recaptcha\_type && ! $invisible\_recaptcha ) { |
| [158](#L158) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key' ); |
| [159](#L159) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret' ); |
| [160](#L160) | } elseif ( 'v2' === $recaptcha\_type && $invisible\_recaptcha ) { |
| [161](#L161) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_key' ); |
| [162](#L162) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_secret' ); |
| [163](#L163) | } elseif ( 'v3' === $recaptcha\_type ) { |
| [164](#L164) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_v3' ); |
| [165](#L165) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_v3' ); |
| [166](#L166) | } elseif ( 'hCaptcha' === $recaptcha\_type ) { |
| [167](#L167) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_hcaptcha' ); |
| [168](#L168) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_hcaptcha' ); |
| [169](#L169) | } elseif ( 'cloudflare' === $recaptcha\_type ) { |
| [170](#L170) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_cloudflare' ); |
| [171](#L171) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_cloudflare' ); |
| [172](#L172) | } |
| [173](#L173) | if ( $recaptcha\_enabled && ! empty( $site\_key ) && ! empty( $secret\_key ) ) { |
| [174](#L174) | if ( ! empty( $captcha\_response ) ) { |
| [175](#L175) | if ( 'hCaptcha' === $recaptcha\_type ) { |
| [176](#L176) | $data = wp\_safe\_remote\_get( 'https://hcaptcha.com/siteverify?secret=' . $secret\_key . '&response=' . $captcha\_response ); |
| [177](#L177) | $data = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [178](#L178) | /\*\* |
| [179](#L179) | \* Filter to modify hcaptcha threshold. |
| [180](#L180) | \* Default value is 0.5 |
| [181](#L181) | \*/ |
| [182](#L182) | if ( empty( $data->success ) || ( isset( $data->score ) && $data->score < apply\_filters( 'user\_registration\_hcaptcha\_threshold', 0.5 ) ) ) { |
| [183](#L183) | wp\_send\_json\_error( |
| [184](#L184) | array( |
| [185](#L185) | 'message' => \_\_( 'Error on hCaptcha. Contact your site administrator.', 'user-registration' ), |
| [186](#L186) | ) |
| [187](#L187) | ); |
| [188](#L188) | } |
| [189](#L189) | } elseif ( 'cloudflare' === $recaptcha\_type ) { |
| [190](#L190) | $url    = 'https://challenges.cloudflare.com/turnstile/v0/siteverify'; |
| [191](#L191) | $params = array( |
| [192](#L192) | 'method' => 'POST', |
| [193](#L193) | 'body'   => array( |
| [194](#L194) | 'secret'   => $secret\_key, |
| [195](#L195) | 'response' => $captcha\_response, |
| [196](#L196) | ), |
| [197](#L197) | ); |
| [198](#L198) | $data   = wp\_safe\_remote\_post( $url, $params ); |
| [199](#L199) | $data   = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [200](#L200) | if ( empty( $data->success ) ) { |
| [201](#L201) | wp\_send\_json\_error( |
| [202](#L202) | array( |
| [203](#L203) | 'message' => \_\_( 'Error on Cloudflare Turnstile. Contact your site administrator.', 'user-registration' ), |
| [204](#L204) | ) |
| [205](#L205) | ); |
| [206](#L206) | } |
| [207](#L207) | } else { |
| [208](#L208) | $data = wp\_remote\_get( 'https://www.google.com/recaptcha/api/siteverify?secret=' . $secret\_key . '&response=' . $captcha\_response ); |
| [209](#L209) | $data = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [210](#L210) | /\*\* |
| [211](#L211) | \* Filter to modify V3 recaptcha threshold. |
| [212](#L212) | \* Default value is 0.5 |
| [213](#L213) | \*/ |
| [214](#L214) | if ( empty( $data->success ) || ( isset( $data->score ) && $data->score < apply\_filters( 'user\_registration\_recaptcha\_v3\_threshold', 0.5 ) ) ) { |
| [215](#L215) | wp\_send\_json\_error( |
| [216](#L216) | array( |
| [217](#L217) | 'message' => \_\_( 'Error on google reCaptcha. Contact your site administrator.', 'user-registration' ), |
| [218](#L218) | ) |
| [219](#L219) | ); |
| [220](#L220) | } |
| [221](#L221) | } |
| [222](#L222) | } else { |
| [223](#L223) | wp\_send\_json\_error( |
| [224](#L224) | array( |
| [225](#L225) | 'message' => get\_option( 'user\_registration\_form\_submission\_error\_message\_recaptcha', \_\_( 'Captcha code error, please try again.', 'user-registration' ) ), |
| [226](#L226) | ) |
| [227](#L227) | ); |
| [228](#L228) | } |
| [229](#L229) | } |
| [230](#L230) |  |
| [231](#L231) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [232](#L232) | wp\_send\_json\_error( |
| [233](#L233) | array( |
| [234](#L234) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [235](#L235) | ) |
| [236](#L236) | ); |
| [237](#L237) | } |
| [238](#L238) | /\*\* |
| [239](#L239) | \* Filter to override the register settings. |
| [240](#L240) | \* Default value is the get\_option('users\_can\_register') |
| [241](#L241) | \*/ |
| [242](#L242) | $users\_can\_register = apply\_filters( 'ur\_register\_setting\_override', get\_option( 'users\_can\_register' ) ); |
| [243](#L243) |  |
| [244](#L244) | if ( ! is\_user\_logged\_in() ) { |
| [245](#L245) | if ( ! $users\_can\_register ) { |
| [246](#L246) | wp\_send\_json\_error( |
| [247](#L247) | array( |
| [248](#L248) | /\*\* |
| [249](#L249) | \* Filter to modify register pre form message. |
| [250](#L250) | \* Default value is the 'Only administrators can add new users'. |
| [251](#L251) | \*/ |
| [252](#L252) | 'message' => apply\_filters( 'ur\_register\_pre\_form\_message', \_\_( 'Only administrators can add new users.', 'user-registration' ) ), |
| [253](#L253) | ) |
| [254](#L254) | ); |
| [255](#L255) | } |
| [256](#L256) | } else { |
| [257](#L257) | /\*\* |
| [258](#L258) | \* Filter to modify user capability. |
| [259](#L259) | \* Default value is 'create\_users'. |
| [260](#L260) | \*/ |
| [261](#L261) | $current\_user\_capability = apply\_filters( 'ur\_registration\_user\_capability', 'create\_users' ); |
| [262](#L262) |  |
| [263](#L263) | if ( ! current\_user\_can( $current\_user\_capability ) ) { |
| [264](#L264) | global $wp; |
| [265](#L265) |  |
| [266](#L266) | $user\_ID      = get\_current\_user\_id(); |
| [267](#L267) | $user         = get\_user\_by( 'ID', $user\_ID ); |
| [268](#L268) | $current\_url  = home\_url( add\_query\_arg( array(), $wp->request ) ); |
| [269](#L269) | $display\_name = ! empty( $user->data->display\_name ) ? $user->data->display\_name : $user->data->user\_email; |
| [270](#L270) |  |
| [271](#L271) | wp\_send\_json\_error( |
| [272](#L272) | array( |
| [273](#L273) | /\*\* |
| [274](#L274) | \* Filter to modify register pre form message. |
| [275](#L275) | \*/ |
| [276](#L276) | 'message' => apply\_filters( |
| [277](#L277) | 'ur\_register\_pre\_form\_message', |
| [278](#L278) | '<p class="alert" id="ur\_register\_pre\_form\_message">' . |
| [279](#L279) | /\* translators: %1$1s - Link to logout. \*/ |
| [280](#L280) | sprintf( \_\_( 'You are currently logged in as %1$1s. %2$2s', 'user-registration' ), '<a href="#" title="' . $display\_name . '">' . $display\_name . '</a>', '<a href="' . wp\_logout\_url( $current\_url ) . '" title="' . \_\_( 'Log out of this account.', 'user-registration' ) . '">' . \_\_( 'Logout', 'user-registration' ) . '  &raquo;</a>' ) . '</p>', |
| [281](#L281) | $user\_ID |
| [282](#L282) | ), |
| [283](#L283) | ) |
| [284](#L284) | ); |
| [285](#L285) | } |
| [286](#L286) | } |
| [287](#L287) |  |
| [288](#L288) | $form\_data = array(); |
| [289](#L289) |  |
| [290](#L290) | if ( isset( $\_POST['form\_data'] ) ) { |
| [291](#L291) | $form\_data = json\_decode( wp\_unslash( $\_POST['form\_data'] ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | UR\_Frontend\_Form\_Handler::handle\_form( $form\_data, $form\_id ); |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) |  |
| [298](#L298) | /\*\* |
| [299](#L299) | \* Get Post data on frontend form submit |
| [300](#L300) | \* |
| [301](#L301) | \* @return void |
| [302](#L302) | \*/ |
| [303](#L303) | public static function update\_profile\_details() { |
| [304](#L304) |  |
| [305](#L305) | if ( ! check\_ajax\_referer( 'user\_registration\_profile\_details\_save\_nonce', 'security', false ) ) { |
| [306](#L306) | wp\_send\_json\_error( |
| [307](#L307) | array( |
| [308](#L308) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [309](#L309) | ) |
| [310](#L310) | ); |
| [311](#L311) | } |
| [312](#L312) |  |
| [313](#L313) | // Current user id. |
| [314](#L314) | $user\_id = get\_current\_user\_id(); |
| [315](#L315) |  |
| [316](#L316) | if ( $user\_id <= 0 ) { |
| [317](#L317) | return; |
| [318](#L318) | } |
| [319](#L319) |  |
| [320](#L320) | // Get form id of the form from which current user is registered. |
| [321](#L321) | $form\_id\_array = get\_user\_meta( $user\_id, 'ur\_form\_id' ); |
| [322](#L322) | $form\_id       = 0; |
| [323](#L323) |  |
| [324](#L324) | if ( isset( $form\_id\_array[0] ) ) { |
| [325](#L325) | $form\_id = $form\_id\_array[0]; |
| [326](#L326) | } |
| [327](#L327) |  |
| [328](#L328) | // Make the schema of form data compatible with processing below. |
| [329](#L329) | $form\_data    = array(); |
| [330](#L330) | $single\_field = array(); |
| [331](#L331) |  |
| [332](#L332) | if ( isset( $\_POST['form\_data'] ) ) { |
| [333](#L333) | $form\_data = json\_decode( wp\_unslash( $\_POST['form\_data'] ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [334](#L334) | foreach ( $form\_data as $data ) { |
| [335](#L335) | $single\_field[ $data->field\_name ] = isset( $data->value ) ? $data->value : ''; |
| [336](#L336) | $data->field\_name                  = substr( $data->field\_name, 18 ); |
| [337](#L337) | } |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | $profile = user\_registration\_form\_data( $user\_id, $form\_id ); |
| [341](#L341) |  |
| [342](#L342) | foreach ( $profile as $key => $field ) { |
| [343](#L343) | if ( ! isset( $field['type'] ) ) { |
| [344](#L344) | $field['type'] = 'text'; |
| [345](#L345) | } |
| [346](#L346) | // Unset hidden field value. |
| [347](#L347) | if ( 'hidden' === $field['type'] && 'hidden' === $field['field\_key'] || ( 'range' === $field['type'] && ur\_string\_to\_bool( $field['enable\_payment\_slider'] ) ) ) { |
| [348](#L348) | $key = array\_search( $field, $profile, true ); |
| [349](#L349) | if ( false !== ( $key ) ) { |
| [350](#L350) | unset( $profile[ $key ] ); |
| [351](#L351) | } |
| [352](#L352) | } |
| [353](#L353) | // Get Value. |
| [354](#L354) | switch ( $field['type'] ) { |
| [355](#L355) | case 'checkbox': |
| [356](#L356) | if ( isset( $single\_field[ $key ] ) ) { |
| [357](#L357) | // Serialize values fo checkbox field. |
| [358](#L358) | $single\_field[ $key ] = ( json\_decode( $single\_field[ $key ] ) !== null ) ? json\_decode( $single\_field[ $key ] ) : sanitize\_text\_field( $single\_field[ $key ] ); |
| [359](#L359) | } |
| [360](#L360) | break; |
| [361](#L361) | case 'wysiwyg': |
| [362](#L362) | if ( isset( $single\_field[ $key ] ) ) { |
| [363](#L363) | $single\_field[ $key ] = sanitize\_text\_field( htmlentities( $single\_field[ $key ] ) ); |
| [364](#L364) | } else { |
| [365](#L365) | $single\_field[ $key ] = ''; |
| [366](#L366) | } |
| [367](#L367) | break; |
| [368](#L368) | default: |
| [369](#L369) | $single\_field[ $key ] = isset( $single\_field[ $key ] ) ? $single\_field[ $key ] : ''; |
| [370](#L370) | break; |
| [371](#L371) | } |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | /\*\* |
| [375](#L375) | \* Action hook to perform validation of edit profile form. |
| [376](#L376) | \* |
| [377](#L377) | \* @param array $profile User profile data. |
| [378](#L378) | \* @param array $form\_data The form data. |
| [379](#L379) | \* @param int $form\_id The form ID. |
| [380](#L380) | \*/ |
| [381](#L381) | do\_action( 'user\_registration\_validate\_profile\_update', $profile, $form\_data, $form\_id ); |
| [382](#L382) |  |
| [383](#L383) | /\*\* |
| [384](#L384) | \* Action after the save profile validation. |
| [385](#L385) | \* |
| [386](#L386) | \* @param int The user ID. |
| [387](#L387) | \* @param array The profile data. |
| [388](#L388) | \*/ |
| [389](#L389) | do\_action( 'user\_registration\_after\_save\_profile\_validation', $user\_id, $profile ); |
| [390](#L390) |  |
| [391](#L391) | if ( 0 === ur\_notice\_count( 'error' ) ) { |
| [392](#L392) | $user\_data = array(); |
| [393](#L393) | /\*\* |
| [394](#L394) | \* Filter to modify the email change confirmation. |
| [395](#L395) | \* Default vallue is 'true'. |
| [396](#L396) | \*/ |
| [397](#L397) | $is\_email\_change\_confirmation = (bool) apply\_filters( 'user\_registration\_email\_change\_confirmation', true ); |
| [398](#L398) | $email\_updated                = false; |
| [399](#L399) | $pending\_email                = ''; |
| [400](#L400) | $user                         = wp\_get\_current\_user(); |
| [401](#L401) | /\*\* |
| [402](#L402) | \* Filter to modify the field settings. |
| [403](#L403) | \* |
| [404](#L404) | \* The dynamic portion of the hook name, $value->field\_key. |
| [405](#L405) | \* |
| [406](#L406) | \* @param array $value The field value. |
| [407](#L407) | \*/ |
| [408](#L408) | $profile = apply\_filters( 'user\_registration\_before\_save\_profile\_details', $profile, $user\_id, $form\_id ); |
| [409](#L409) |  |
| [410](#L410) | foreach ( $profile as $key => $field ) { |
| [411](#L411) | $new\_key = str\_replace( 'user\_registration\_', '', $key ); |
| [412](#L412) |  |
| [413](#L413) | if ( $is\_email\_change\_confirmation && 'user\_email' === $new\_key ) { |
| [414](#L414) | if ( $user ) { |
| [415](#L415) | if ( sanitize\_email( wp\_unslash( $single\_field[ $key ] ) ) !== $user->user\_email ) { |
| [416](#L416) | $email\_updated = true; |
| [417](#L417) | $pending\_email = sanitize\_email( wp\_unslash( $single\_field[ $key ] ) ); |
| [418](#L418) | } |
| [419](#L419) | continue; |
| [420](#L420) | } |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | if ( in\_array( $new\_key, ur\_get\_user\_table\_fields() ) ) { |
| [424](#L424) | if ( 'display\_name' === $new\_key ) { |
| [425](#L425) | $user\_data['display\_name'] = sanitize\_text\_field( ( $single\_field[ $key ] ) ); |
| [426](#L426) | } else { |
| [427](#L427) | $user\_data[ $new\_key ] = sanitize\_text\_field( $single\_field[ $key ] ); |
| [428](#L428) | } |
| [429](#L429) | } else { |
| [430](#L430) | $update\_key = $key; |
| [431](#L431) |  |
| [432](#L432) | if ( in\_array( $new\_key, ur\_get\_registered\_user\_meta\_fields() ) ) { |
| [433](#L433) | $update\_key = str\_replace( 'user\_', '', $new\_key ); |
| [434](#L434) | } |
| [435](#L435) | $disabled = isset( $field['custom\_attributes']['disabled'] ) ? $field['custom\_attributes']['disabled'] : ''; |
| [436](#L436) |  |
| [437](#L437) | if ( 'disabled' !== $disabled ) { |
| [438](#L438) | update\_user\_meta( $user\_id, $update\_key, $single\_field[ $key ] ); |
| [439](#L439) | } |
| [440](#L440) | } |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | if ( count( $user\_data ) > 0 ) { |
| [444](#L444) | $user\_data['ID'] = get\_current\_user\_id(); |
| [445](#L445) | wp\_update\_user( $user\_data ); |
| [446](#L446) | } |
| [447](#L447) | /\*\* |
| [448](#L448) | \* Filter to modify the profile update success message. |
| [449](#L449) | \*/ |
| [450](#L450) | $message = apply\_filters( 'user\_registration\_profile\_update\_success\_message', \_\_( 'User profile updated successfully.', 'user-registration' ) ); |
| [451](#L451) | /\*\* |
| [452](#L452) | \* Action to modify the save profile details. |
| [453](#L453) | \* |
| [454](#L454) | \* @param int $user\_id The user ID. |
| [455](#L455) | \* @param int $form\_id The form ID. |
| [456](#L456) | \*/ |
| [457](#L457) | do\_action( 'user\_registration\_save\_profile\_details', $user\_id, $form\_id ); |
| [458](#L458) |  |
| [459](#L459) | $profile\_pic\_id = get\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url' ); |
| [460](#L460) | $profile\_pic\_id = ! empty( $profile\_pic\_id ) ? $profile\_pic\_id[0] : ''; |
| [461](#L461) | $response       = array( |
| [462](#L462) | 'message'        => $message, |
| [463](#L463) | 'profile\_pic\_id' => $profile\_pic\_id, |
| [464](#L464) | ); |
| [465](#L465) |  |
| [466](#L466) | if ( $email\_updated ) { |
| [467](#L467) | UR\_Form\_Handler::send\_confirmation\_email( $user, $pending\_email, $form\_id ); |
| [468](#L468) | $response['oldUserEmail'] = $user->user\_email; |
| [469](#L469) | /\* translators: %s : user email \*/ |
| [470](#L470) | $response['userEmailUpdateMessage'] = sprintf( \_\_( 'Your email address has not been updated yet. Please check your inbox at <strong>%s</strong> for a confirmation email.', 'user-registration' ), $pending\_email ); |
| [471](#L471) |  |
| [472](#L472) | $cancel\_url = esc\_url( |
| [473](#L473) | add\_query\_arg( |
| [474](#L474) | array( |
| [475](#L475) | 'cancel\_email\_change' => $user\_id, |
| [476](#L476) | '\_wpnonce'            => wp\_create\_nonce( 'cancel\_email\_change\_nonce' ), |
| [477](#L477) | ), |
| [478](#L478) | ur\_get\_my\_account\_url() . get\_option( 'user\_registration\_myaccount\_edit\_profile\_endpoint', 'edit-profile' ) |
| [479](#L479) | ) |
| [480](#L480) | ); |
| [481](#L481) |  |
| [482](#L482) | $response['userEmailPendingMessage'] = sprintf( |
| [483](#L483) | /\* translators: %s - Email Change Pending Message. \*/ |
| [484](#L484) | '<div class="email-updated inline"><p>%s</p></div>', |
| [485](#L485) | sprintf( |
| [486](#L486) | /\* translators: 1: Pending email message 2: Cancel Link \*/ |
| [487](#L487) | \_\_( 'There is a pending change of your email to <code>%1$s</code>. <a href="%2$s">Cancel</a>', 'user-registration' ), |
| [488](#L488) | $pending\_email, |
| [489](#L489) | $cancel\_url |
| [490](#L490) | ) |
| [491](#L491) | ); |
| [492](#L492) | } |
| [493](#L493) | /\*\* |
| [494](#L494) | \* Filter to modify profile update response. |
| [495](#L495) | \* |
| [496](#L496) | \* @param array $response The profile update response. |
| [497](#L497) | \*/ |
| [498](#L498) | $response = apply\_filters( 'user\_registration\_profile\_update\_response', $response ); |
| [499](#L499) |  |
| [500](#L500) | wp\_send\_json\_success( |
| [501](#L501) | $response |
| [502](#L502) | ); |
| [503](#L503) | } else { |
| [504](#L504) | $errors = ur\_get\_notices( 'error' ); |
| [505](#L505) | ur\_clear\_notices(); |
| [506](#L506) | wp\_send\_json\_error( |
| [507](#L507) | array( |
| [508](#L508) | 'message' => $errors, |
| [509](#L509) | ) |
| [510](#L510) | ); |
| [511](#L511) | } |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | /\*\* |
| [515](#L515) | \* Get Post data on frontend form submit |
| [516](#L516) | \* |
| [517](#L517) | \* @return void |
| [518](#L518) | \*/ |
| [519](#L519) | public static function profile\_pic\_upload() { |
| [520](#L520) |  |
| [521](#L521) | check\_ajax\_referer( 'user\_registration\_profile\_picture\_upload\_nonce', 'security' ); |
| [522](#L522) |  |
| [523](#L523) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [524](#L524) |  |
| [525](#L525) | $flag = wp\_verify\_nonce( $nonce, 'user\_registration\_profile\_picture\_upload\_nonce' ); |
| [526](#L526) |  |
| [527](#L527) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [528](#L528) | wp\_send\_json\_error( |
| [529](#L529) | array( |
| [530](#L530) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [531](#L531) | ) |
| [532](#L532) | ); |
| [533](#L533) | } |
| [534](#L534) | $user\_id = get\_current\_user\_id(); |
| [535](#L535) |  |
| [536](#L536) | if ( $user\_id <= 0 ) { |
| [537](#L537) | return; |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | if ( isset( $\_FILES['file']['size'] ) && wp\_unslash( sanitize\_key( $\_FILES['file']['size'] ) ) ) { |
| [541](#L541) | if ( ! function\_exists( 'wp\_handle\_upload' ) ) { |
| [542](#L542) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [543](#L543) | } |
| [544](#L544) |  |
| [545](#L545) | $upload = isset( $\_FILES['file'] ) ? $\_FILES['file'] : array(); // phpcs:ignore |
| [546](#L546) |  |
| [547](#L547) | // valid extension for image. |
| [548](#L548) | $valid\_extensions = 'image/jpeg,image/gif,image/png'; |
| [549](#L549) | $form\_id          = ur\_get\_form\_id\_by\_userid( $user\_id ); |
| [550](#L550) |  |
| [551](#L551) | if ( class\_exists( 'UserRegistrationAdvancedFields' ) ) { |
| [552](#L552) | $field\_data       = ur\_get\_field\_data\_by\_field\_name( $form\_id, 'profile\_pic\_url' ); |
| [553](#L553) | $valid\_extensions = isset( $field\_data['advance\_setting']->valid\_file\_type ) ? implode( ', ', $field\_data['advance\_setting']->valid\_file\_type ) : $valid\_extensions; |
| [554](#L554) | } |
| [555](#L555) |  |
| [556](#L556) | $valid\_extension\_type = explode( ',', $valid\_extensions ); |
| [557](#L557) | $valid\_ext            = array(); |
| [558](#L558) |  |
| [559](#L559) | foreach ( $valid\_extension\_type as $key => $value ) { |
| [560](#L560) | $image\_extension   = explode( '/', $value ); |
| [561](#L561) | $valid\_ext[ $key ] = isset( $image\_extension[1] ) ? $image\_extension[1] : ''; |
| [562](#L562) |  |
| [563](#L563) | if ( 'jpeg' === $valid\_ext[ $key ] ) { |
| [564](#L564) | $index               = count( $valid\_extension\_type ); |
| [565](#L565) | $valid\_ext[ $index ] = 'jpg'; |
| [566](#L566) | } |
| [567](#L567) | } |
| [568](#L568) |  |
| [569](#L569) | $src\_file\_name  = isset( $upload['name'] ) ? $upload['name'] : ''; |
| [570](#L570) | $file\_extension = strtolower( pathinfo( $src\_file\_name, PATHINFO\_EXTENSION ) ); |
| [571](#L571) | $file\_mime\_type = isset( $upload['tmp\_name'] ) ? mime\_content\_type( $upload['tmp\_name'] ) : ''; |
| [572](#L572) |  |
| [573](#L573) | if ( ! in\_array( $file\_mime\_type, $valid\_extension\_type ) ) { |
| [574](#L574) | wp\_send\_json\_error( |
| [575](#L575) | array( |
| [576](#L576) | 'message' => \_\_( 'Invalid file type, please contact with site administrator.', 'user-registration' ), |
| [577](#L577) | ) |
| [578](#L578) | ); |
| [579](#L579) | } |
| [580](#L580) | // Validates if the uploaded file has the acceptable extension. |
| [581](#L581) | if ( ! in\_array( $file\_extension, $valid\_ext ) ) { |
| [582](#L582) | wp\_send\_json\_error( |
| [583](#L583) | array( |
| [584](#L584) | 'message' => \_\_( 'Invalid file type, please contact with site administrator.', 'user-registration' ), |
| [585](#L585) | ) |
| [586](#L586) | ); |
| [587](#L587) | } |
| [588](#L588) |  |
| [589](#L589) | $upload\_path = ur\_get\_tmp\_dir(); |
| [590](#L590) |  |
| [591](#L591) | // Checks if the upload directory has the write premission. |
| [592](#L592) | if ( ! wp\_is\_writable( $upload\_path ) ) { |
| [593](#L593) | wp\_send\_json\_error( |
| [594](#L594) | array( |
| [595](#L595) | 'message' => \_\_( 'Upload path permission deny.', 'user-registration' ), |
| [596](#L596) | ) |
| [597](#L597) | ); |
| [598](#L598) | } |
| [599](#L599) | $upload\_path = $upload\_path . '/'; |
| [600](#L600) | $file\_name   = wp\_unique\_filename( $upload\_path, $upload['name'] ); |
| [601](#L601) | $file\_path   = $upload\_path . sanitize\_file\_name( $file\_name ); |
| [602](#L602) | if ( move\_uploaded\_file( $upload['tmp\_name'], $file\_path ) ) { |
| [603](#L603) | $files = array( |
| [604](#L604) | 'file\_name'      => $file\_name, |
| [605](#L605) | 'file\_path'      => $file\_path, |
| [606](#L606) | 'file\_extension' => $file\_extension, |
| [607](#L607) | ); |
| [608](#L608) |  |
| [609](#L609) | $attachment\_id = wp\_rand(); |
| [610](#L610) |  |
| [611](#L611) | ur\_clean\_tmp\_files(); |
| [612](#L612) | $url = UR\_UPLOAD\_URL . 'temp-uploads/' . sanitize\_file\_name( $file\_name ); |
| [613](#L613) | wp\_send\_json\_success( |
| [614](#L614) | array( |
| [615](#L615) | 'attachment\_id' => $attachment\_id, |
| [616](#L616) | 'upload\_files'  => crypt\_the\_string( maybe\_serialize( $files ), 'e' ), |
| [617](#L617) | 'url'           => $url, |
| [618](#L618) | ) |
| [619](#L619) | ); |
| [620](#L620) | } else { |
| [621](#L621) | wp\_send\_json\_error( |
| [622](#L622) | array( |
| [623](#L623) | 'message' => \_\_( 'File cannot be uploaded.', 'user-registration' ), |
| [624](#L624) | ) |
| [625](#L625) | ); |
| [626](#L626) | } |
| [627](#L627) | } elseif ( isset( $\_FILES['file']['error'] ) && UPLOAD\_ERR\_NO\_FILE !== $\_FILES['file']['error'] ) { |
| [628](#L628) | switch ( $\_FILES['file']['error'] ) { |
| [629](#L629) | case UPLOAD\_ERR\_INI\_SIZE: |
| [630](#L630) | wp\_send\_json\_error( |
| [631](#L631) | array( |
| [632](#L632) | 'message' => \_\_( 'File size exceed, please check your file size.', 'user-registration' ), |
| [633](#L633) | ) |
| [634](#L634) | ); |
| [635](#L635) | break; |
| [636](#L636) | default: |
| [637](#L637) | wp\_send\_json\_error( |
| [638](#L638) | array( |
| [639](#L639) | 'message' => \_\_( 'Something went wrong while uploading, please contact your site administrator.', 'user-registration' ), |
| [640](#L640) | ) |
| [641](#L641) | ); |
| [642](#L642) | break; |
| [643](#L643) | } |
| [644](#L644) | } |
| [645](#L645) | } |
| [646](#L646) |  |
| [647](#L647) | /\*\* |
| [648](#L648) | \* Login from Using Ajax |
| [649](#L649) | \*/ |
| [650](#L650) | public static function ajax\_login\_submit() { |
| [651](#L651) |  |
| [652](#L652) | check\_ajax\_referer( 'ur\_login\_form\_save\_nonce', 'security' ); |
| [653](#L653) |  |
| [654](#L654) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [655](#L655) | $flag  = wp\_verify\_nonce( $nonce, 'ur\_login\_form\_save\_nonce' ); |
| [656](#L656) |  |
| [657](#L657) | if ( false === $flag || is\_wp\_error( $flag ) ) { |
| [658](#L658) |  |
| [659](#L659) | wp\_send\_json\_error( |
| [660](#L660) | array( |
| [661](#L661) | 'message' => esc\_html\_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [662](#L662) | ) |
| [663](#L663) | ); |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) | ur\_process\_login( $nonce ); |
| [667](#L667) | } |
| [668](#L668) | /\*\* |
| [669](#L669) | \* Send test email. |
| [670](#L670) | \* |
| [671](#L671) | \* @since 1.9.9 |
| [672](#L672) | \*/ |
| [673](#L673) | public static function send\_test\_email() { |
| [674](#L674) | check\_ajax\_referer( 'test\_email\_nonce', 'nonce' ); |
| [675](#L675) |  |
| [676](#L676) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [677](#L677) | wp\_send\_json\_error( array( 'message' => \_\_( 'You do not have permission to send test email.', 'user-registration' ) ) ); |
| [678](#L678) | wp\_die( -1 ); |
| [679](#L679) | } |
| [680](#L680) | /\*\* |
| [681](#L681) | \* Filter to test mail from name. |
| [682](#L682) | \* Default value is get\_option('user\_registration\_email\_from\_name'). |
| [683](#L683) | \*/ |
| [684](#L684) | $from\_name = apply\_filters( 'wp\_mail\_from\_name', get\_option( 'user\_registration\_email\_from\_name', esc\_attr( get\_bloginfo( 'name', 'display' ) ) ) ); |
| [685](#L685) | /\*\* |
| [686](#L686) | \* Filter to test mail from address. |
| [687](#L687) | \* Default value is get\_option('user\_registration\_email\_from\_address'). |
| [688](#L688) | \*/ |
| [689](#L689) | $sender\_email = apply\_filters( 'wp\_mail\_from', get\_option( 'user\_registration\_email\_from\_address', get\_option( 'admin\_email' ) ) ); |
| [690](#L690) | $email        = sanitize\_email( isset( $\_POST['email'] ) ? wp\_unslash( $\_POST['email'] ) : '' ); // phpcs:ignore WordPress.Security.NonceVerification |
| [691](#L691) | /\* translators: %s - WP mail from name \*/ |
| [692](#L692) | $subject = 'User Registration: ' . sprintf( esc\_html\_\_( 'Test email from %s', 'user-registration' ), $from\_name ); |
| [693](#L693) | $header  = array( |
| [694](#L694) | 'From:' . $from\_name . ' <' . $sender\_email . '>', |
| [695](#L695) | 'Reply-To:' . $sender\_email, |
| [696](#L696) | 'Content-Type:text/html; charset=UTF-8', |
| [697](#L697) | ); |
| [698](#L698) | $message = |
| [699](#L699) | 'Congratulations,<br> |
| [700](#L700) | Your test email has been received successfully.<br> |
| [701](#L701) | We thank you for trying out User Registration and joining our mission to make sure you get your emails delivered.<br> |
| [702](#L702) | Regards,<br> |
| [703](#L703) | User Registration Team'; |
| [704](#L704) |  |
| [705](#L705) | $status = wp\_mail( $email, $subject, $message, $header ); |
| [706](#L706) |  |
| [707](#L707) | if ( $status ) { |
| [708](#L708) | wp\_send\_json\_success( array( 'message' => \_\_( 'Test email was sent successfully! Please check your inbox to make sure it is delivered.', 'user-registration' ) ) ); |
| [709](#L709) | } { |
| [710](#L710) | wp\_send\_json\_error( array( 'message' => \_\_( 'Test email was unsuccessful! Something went wrong.', 'user-registration' ) ) ); |
| [711](#L711) | } |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Locate form. |
| [716](#L716) | \*/ |
| [717](#L717) | public static function locate\_form\_action() { |
| [718](#L718) | global $wpdb; |
| [719](#L719) | try { |
| [720](#L720) | check\_ajax\_referer( 'process-locate-ajax-nonce', 'security' ); |
| [721](#L721) | $id                          = isset( $\_POST['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) : ''; |
| [722](#L722) | $user\_registration\_shortcode = '%[user\_registration\_form id="' . $id . '"%'; |
| [723](#L723) | $form\_id\_shortcode           = '%{"formId":"' . $id . '"%'; |
| [724](#L724) | $pages                       = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}posts WHERE post\_content LIKE %s OR post\_content LIKE %s", $user\_registration\_shortcode, $form\_id\_shortcode ) ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared |
| [725](#L725) | $page\_list                   = array(); |
| [726](#L726) | foreach ( $pages as $page ) { |
| [727](#L727) | if ( '0' === $page->post\_parent ) { |
| [728](#L728) | $page\_title               = $page->post\_title; |
| [729](#L729) | $page\_guid                = $page->guid; |
| [730](#L730) | $page\_list[ $page\_title ] = $page\_guid; |
| [731](#L731) | } |
| [732](#L732) | } |
| [733](#L733) | wp\_send\_json\_success( $page\_list ); |
| [734](#L734) | } catch ( Exception $e ) { |
| [735](#L735) | wp\_send\_json\_error( |
| [736](#L736) | array( |
| [737](#L737) | 'message' => $e->getMessage(), |
| [738](#L738) | ) |
| [739](#L739) | ); |
| [740](#L740) | } |
| [741](#L741) | } |
| [742](#L742) |  |
| [743](#L743) | /\*\* |
| [744](#L744) | \* User input dropped function |
| [745](#L745) | \* |
| [746](#L746) | \* @throws Exception Throws If Empty Form Data. |
| [747](#L747) | \*/ |
| [748](#L748) | public static function user\_input\_dropped() { |
| [749](#L749) |  |
| [750](#L750) | try { |
| [751](#L751) | check\_ajax\_referer( 'user\_input\_dropped\_nonce', 'security' ); |
| [752](#L752) |  |
| [753](#L753) | $form\_field\_id = ( isset( $\_POST['form\_field\_id'] ) ) ? $\_POST['form\_field\_id'] : null; //phpcs:ignore |
| [754](#L754) |  |
| [755](#L755) | if ( null == $form\_field\_id || '' == $form\_field\_id ) { |
| [756](#L756) | throw new Exception( 'Empty form data' ); |
| [757](#L757) | } |
| [758](#L758) |  |
| [759](#L759) | $class\_file\_name = str\_replace( 'user\_registration\_', '', $form\_field\_id ); |
| [760](#L760) | $class\_name      = ur\_load\_form\_field\_class( $class\_file\_name ); |
| [761](#L761) |  |
| [762](#L762) | if ( empty( $class\_name ) ) { |
| [763](#L763) | throw new Exception( 'class not exists' ); |
| [764](#L764) | } |
| [765](#L765) |  |
| [766](#L766) | $templates = $class\_name::get\_instance()->get\_admin\_template(); |
| [767](#L767) |  |
| [768](#L768) | wp\_send\_json\_success( $templates ); |
| [769](#L769) | } catch ( Exception $e ) { |
| [770](#L770) | wp\_send\_json\_error( |
| [771](#L771) | array( |
| [772](#L772) | 'error' => $e->getMessage(), |
| [773](#L773) | ) |
| [774](#L774) | ); |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Import Form ajax. |
| [780](#L780) | \* |
| [781](#L781) | \* @throws Exception Post data mot set. |
| [782](#L782) | \*/ |
| [783](#L783) | public static function import\_form\_action() { |
| [784](#L784) | try { |
| [785](#L785) | check\_ajax\_referer( 'ur\_import\_form\_save\_nonce', 'security' ); |
| [786](#L786) | UR\_Admin\_Import\_Export\_Forms::import\_form(); |
| [787](#L787) | } catch ( Exception $e ) { |
| [788](#L788) | wp\_send\_json\_error( |
| [789](#L789) | array( |
| [790](#L790) | 'message' => $e->getMessage(), |
| [791](#L791) | ) |
| [792](#L792) | ); |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | /\*\* |
| [797](#L797) | \* Form save from backend |
| [798](#L798) | \* |
| [799](#L799) | \* @return void |
| [800](#L800) | \* |
| [801](#L801) | \* @throws Exception Throw if any issue while saving form data. |
| [802](#L802) | \*/ |
| [803](#L803) | public static function form\_save\_action() { |
| [804](#L804) |  |
| [805](#L805) | try { |
| [806](#L806) | check\_ajax\_referer( 'ur\_form\_save\_nonce', 'security' ); |
| [807](#L807) |  |
| [808](#L808) | if ( ! isset( $\_POST['data'] ) || ( isset( $\_POST['data'] ) && gettype( wp\_unslash( $\_POST['data'] ) ) != 'array' ) ) { //phpcs:ignore |
| [809](#L809) | throw new Exception( \_\_( 'post data not set', 'user-registration' ) ); |
| [810](#L810) | } elseif ( ! isset( $\_POST['data']['form\_data'] ) |
| [811](#L811) | || ( isset( $\_POST['data']['form\_data'] ) |
| [812](#L812) | && gettype( wp\_unslash( $\_POST['data']['form\_data'] ) ) != 'string' ) ) { //phpcs:ignore |
| [813](#L813) |  |
| [814](#L814) | throw new Exception( \_\_( 'post data not set', 'user-registration' ) ); |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | $post\_data = json\_decode( wp\_unslash( $\_POST['data']['form\_data'] ) ); //phpcs:ignore |
| [818](#L818) | self::sweep\_array( $post\_data ); |
| [819](#L819) |  |
| [820](#L820) | if ( isset( self::$failed\_key\_value['value'] ) && '' != self::$failed\_key\_value['value'] ) { |
| [821](#L821) | if ( in\_array( self::$failed\_key\_value['value'], self::$field\_key\_aray ) ) { |
| [822](#L822) | throw new Exception( sprintf( "Could not save form. Duplicate field name <span style='color:red'>%s</span>", self::$failed\_key\_value['value'] ) ); |
| [823](#L823) | } |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) | if ( false === self::$is\_field\_key\_pass ) { |
| [827](#L827) | throw new Exception( \_\_( 'Could not save form. Invalid field name. Please check all field name', 'user-registration' ) ); |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | $required\_fields = array( |
| [831](#L831) | 'user\_email', |
| [832](#L832) | 'user\_pass', |
| [833](#L833) | ); |
| [834](#L834) |  |
| [835](#L835) | $contains\_search = count( array\_intersect( $required\_fields, self::$field\_key\_aray ) ) == count( $required\_fields ); |
| [836](#L836) |  |
| [837](#L837) | if ( false === $contains\_search ) { |
| [838](#L838) | throw  new Exception( \_\_( 'Could not save form, ' . join( ', ', $required\_fields ) . ' fields are required.! ', 'user-registration' ) ); //phpcs:ignore |
| [839](#L839) | } |
| [840](#L840) |  |
| [841](#L841) | // check captcha configuration before form save action. |
| [842](#L842) | if ( isset( $\_POST['data']['form\_setting\_data'] ) ) { |
| [843](#L843) | foreach ( wp\_unslash( $\_POST['data']['form\_setting\_data'] )  as $setting\_data ) { //phpcs:ignore |
| [844](#L844) | if ( 'user\_registration\_form\_setting\_enable\_recaptcha\_support' === $setting\_data['name'] && ur\_string\_to\_bool( $setting\_data['value'] ) && ! ur\_check\_captch\_keys() ) { |
| [845](#L845) | throw new Exception( |
| [846](#L846) | sprintf( |
| [847](#L847) | /\* translators: %s - Integration tab url \*/ |
| [848](#L848) | '%s <a href="%s" class="ur-captcha-error" target="\_blank">here</a> to add them and save your form.', |
| [849](#L849) | esc\_html\_\_( 'Seems like you are trying to enable the captcha feature, but the captcha keys are empty. Please click', 'user-registration' ), |
| [850](#L850) | esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=captcha' ) ) ) ); //phpcs:ignore |
| [851](#L851) | } |
| [852](#L852) | } |
| [853](#L853) | } |
| [854](#L854) |  |
| [855](#L855) | /\*\* |
| [856](#L856) | \* Perform validation before form save from form builder. |
| [857](#L857) | \*/ |
| [858](#L858) | do\_action("user\_registration\_admin\_backend\_validation\_before\_form\_save"); |
| [859](#L859) |  |
| [860](#L860) | $form\_name    = sanitize\_text\_field( $\_POST['data']['form\_name'] ); //phpcs:ignore |
| [861](#L861) | $form\_row\_ids = sanitize\_text\_field( $\_POST['data']['form\_row\_ids'] ); //phpcs:ignore |
| [862](#L862) | $form\_id      = sanitize\_text\_field( $\_POST['data']['form\_id'] ); //phpcs:ignore |
| [863](#L863) |  |
| [864](#L864) | $post\_data = array( |
| [865](#L865) | 'post\_type'      => 'user\_registration', |
| [866](#L866) | 'post\_title'     => sanitize\_text\_field( $form\_name ), |
| [867](#L867) | 'post\_content'   => wp\_json\_encode( $post\_data, JSON\_UNESCAPED\_UNICODE | JSON\_UNESCAPED\_SLASHES ), |
| [868](#L868) | 'post\_status'    => 'publish', |
| [869](#L869) | 'comment\_status' => 'closed',   // if you prefer. |
| [870](#L870) | 'ping\_status'    => 'closed',      // if you prefer. |
| [871](#L871) | ); |
| [872](#L872) |  |
| [873](#L873) | if ( $form\_id > 0 && is\_numeric( $form\_id ) ) { |
| [874](#L874) | $post\_data['ID'] = $form\_id; |
| [875](#L875) | } |
| [876](#L876) |  |
| [877](#L877) | remove\_filter( 'content\_save\_pre', 'wp\_targeted\_link\_rel' ); |
| [878](#L878) |  |
| [879](#L879) | $post\_id = wp\_insert\_post( wp\_slash( $post\_data ) ); |
| [880](#L880) |  |
| [881](#L881) | if ( $post\_id > 0 ) { |
| [882](#L882) | $\_POST['data']['form\_id'] = $post\_id; // Form id for new form. |
| [883](#L883) |  |
| [884](#L884) | $post\_data\_setting = isset( $\_POST['data']['form\_setting\_data'] ) ? $\_POST['data']['form\_setting\_data'] : array(); //phpcs:ignore |
| [885](#L885) | ur\_update\_form\_settings( $post\_data\_setting, $post\_id ); |
| [886](#L886) |  |
| [887](#L887) | // Form row\_id save. |
| [888](#L888) | update\_post\_meta( $form\_id, 'user\_registration\_form\_row\_ids', $form\_row\_ids ); |
| [889](#L889) | } |
| [890](#L890) | /\*\* |
| [891](#L891) | \* Action after form setting save. |
| [892](#L892) | \* Default is the $\_POST['data']. |
| [893](#L893) | \*/ |
| [894](#L894) | do\_action( 'user\_registration\_after\_form\_settings\_save', wp\_unslash( $\_POST['data'] ) ); //phpcs:ignore |
| [895](#L895) |  |
| [896](#L896) | wp\_send\_json\_success( |
| [897](#L897) | array( |
| [898](#L898) | 'data'    => $post\_data, |
| [899](#L899) | 'post\_id' => $post\_id, |
| [900](#L900) | ) |
| [901](#L901) | ); |
| [902](#L902) | } catch ( Exception $e ) { |
| [903](#L903) | wp\_send\_json\_error( |
| [904](#L904) | array( |
| [905](#L905) | 'message' => $e->getMessage(), |
| [906](#L906) | ) |
| [907](#L907) | ); |
| [908](#L908) | }// End try(). |
| [909](#L909) | } |
| [910](#L910) |  |
| [911](#L911) | /\*\* |
| [912](#L912) | \* Dashboard Widget data. |
| [913](#L913) | \* |
| [914](#L914) | \* @since 1.5.8 |
| [915](#L915) | \*/ |
| [916](#L916) | public static function dashboard\_widget() { |
| [917](#L917) |  |
| [918](#L918) | check\_ajax\_referer( 'dashboard-widget', 'security' ); |
| [919](#L919) |  |
| [920](#L920) | $form\_id = isset( $\_POST['form\_id'] ) ? wp\_unslash( absint( $\_POST['form\_id'] ) ) : 0; |
| [921](#L921) |  |
| [922](#L922) | $user\_report = $form\_id ? ur\_get\_user\_report( $form\_id ) : array(); |
| [923](#L923) | $forms       = ! $form\_id ? ur\_get\_all\_user\_registration\_form() : array(); |
| [924](#L924) |  |
| [925](#L925) | wp\_send\_json( |
| [926](#L926) | array( |
| [927](#L927) | 'user\_report' => $user\_report, |
| [928](#L928) | 'forms'       => $forms, |
| [929](#L929) | ) |
| [930](#L930) | ); // WPCS: XSS OK. |
| [931](#L931) | } |
| [932](#L932) |  |
| [933](#L933) | /\*\* |
| [934](#L934) | \* Checks if the string passes the regex |
| [935](#L935) | \* |
| [936](#L936) | \* @param  string $value Value. |
| [937](#L937) | \* @return boolean |
| [938](#L938) | \*/ |
| [939](#L939) | private static function is\_regex\_pass( $value ) { |
| [940](#L940) |  |
| [941](#L941) | $field\_regex = "/[a-zA-Z\_\x7f-\xff][a-zA-Z0-9\_\x7f-\xff]\*/"; |
| [942](#L942) |  |
| [943](#L943) | if ( preg\_match( $field\_regex, $value, $match ) ) : |
| [944](#L944) | if ( null !== $match && count( $match ) == 1 && $match[0] === $value ) { |
| [945](#L945) | return true; |
| [946](#L946) | } |
| [947](#L947) | endif; |
| [948](#L948) |  |
| [949](#L949) | return false; |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | /\*\* |
| [953](#L953) | \* Sanitize values of form field in backend |
| [954](#L954) | \* |
| [955](#L955) | \* @param array $array Array. |
| [956](#L956) | \*/ |
| [957](#L957) | public static function sweep\_array( &$array ) { |
| [958](#L958) |  |
| [959](#L959) | foreach ( $array as $key => &$value ) { |
| [960](#L960) | if ( 'field\_key' === $key ) { |
| [961](#L961) | $field\_key = $value; |
| [962](#L962) | } |
| [963](#L963) |  |
| [964](#L964) | if ( isset( $field\_key ) && 'checkbox' === $field\_key ) { |
| [965](#L965) | if ( gettype( $value ) == 'object' ) { |
| [966](#L966) | if ( isset( $value->options ) && is\_array( $value->options ) && ! empty( $value->options ) ) { |
| [967](#L967) | $sanitized\_options = array(); |
| [968](#L968) | $allowed\_tags      = array( |
| [969](#L969) | array(), |
| [970](#L970) | 'a' => array( |
| [971](#L971) | 'href'      => true, |
| [972](#L972) | 'title'     => true, |
| [973](#L973) | 'target'    => true, |
| [974](#L974) | 'download'  => true, |
| [975](#L975) | 'rel'       => true, |
| [976](#L976) | 'hreflang'  => true, |
| [977](#L977) | 'type'      => true, |
| [978](#L978) | 'name'      => true, |
| [979](#L979) | 'accesskey' => true, |
| [980](#L980) | 'tabindex'  => true, |
| [981](#L981) | ), |
| [982](#L982) | ); |
| [983](#L983) |  |
| [984](#L984) | foreach ( $value->options as $index => $option\_value ) { |
| [985](#L985) | $option\_value = str\_replace( '"', "'", $option\_value ); |
| [986](#L986) | $option\_value = wp\_kses( trim( $option\_value ), $allowed\_tags ); |
| [987](#L987) |  |
| [988](#L988) | // Check if the option\_value contains an open <a> tag but not a closing </a> tag. |
| [989](#L989) | if ( preg\_match( '/<a\s[^>]\*>/i', $option\_value ) && ! preg\_match( '/<\/a>/i', $option\_value ) ) { |
| [990](#L990) | // Add a closing </a> tag to the end of the option\_value. |
| [991](#L991) | $option\_value .= '</a>'; |
| [992](#L992) | } |
| [993](#L993) |  |
| [994](#L994) | $sanitized\_options [] = $option\_value; |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | $value->options = $sanitized\_options; |
| [998](#L998) | } |
| [999](#L999) | } |
| [1000](#L1000) | } elseif ( is\_array( $value ) || gettype( $value ) === 'object' ) { |
| [1001](#L1001) | if ( isset( $value->field\_key ) ) { |
| [1002](#L1002) | /\*\* |
| [1003](#L1003) | \* Filter to modify the field settings. |
| [1004](#L1004) | \* |
| [1005](#L1005) | \* The dynamic portion of the hook name, $value->field\_key. |
| [1006](#L1006) | \* |
| [1007](#L1007) | \* @param array $value The field value. |
| [1008](#L1008) | \*/ |
| [1009](#L1009) | $value = apply\_filters( 'user\_registration\_field\_setting\_' . $value->field\_key, $value ); |
| [1010](#L1010) | } |
| [1011](#L1011) | self::sweep\_array( $value ); |
| [1012](#L1012) | } else { |
| [1013](#L1013) | if ( 'field\_name' === $key ) { |
| [1014](#L1014) | $regex\_status = self::is\_regex\_pass( $value ); |
| [1015](#L1015) |  |
| [1016](#L1016) | if ( ! $regex\_status || in\_array( $value, self::$field\_key\_aray ) ) { |
| [1017](#L1017) | self::$is\_field\_key\_pass = false; |
| [1018](#L1018) | self::$failed\_key\_value  = array( |
| [1019](#L1019) | 'key'   => $key, |
| [1020](#L1020) | 'value' => $value, |
| [1021](#L1021) | ); |
| [1022](#L1022) |  |
| [1023](#L1023) | return; |
| [1024](#L1024) | } |
| [1025](#L1025) | array\_push( self::$field\_key\_aray, $value ); |
| [1026](#L1026) | } |
| [1027](#L1027) | if ( 'description' === $key ) { |
| [1028](#L1028) | $value = str\_replace( '"', "'", $value ); |
| [1029](#L1029) | $value = wp\_kses( |
| [1030](#L1030) | $value, |
| [1031](#L1031) | array( |
| [1032](#L1032) | 'a'          => array( |
| [1033](#L1033) | 'href'   => array(), |
| [1034](#L1034) | 'title'  => array(), |
| [1035](#L1035) | 'target' => array(), |
| [1036](#L1036) | ), |
| [1037](#L1037) | 'br'         => array(), |
| [1038](#L1038) | 'em'         => array(), |
| [1039](#L1039) | 'strong'     => array(), |
| [1040](#L1040) | 'u'          => array(), |
| [1041](#L1041) | 'i'          => array(), |
| [1042](#L1042) | 'q'          => array(), |
| [1043](#L1043) | 'b'          => array(), |
| [1044](#L1044) | 'ul'         => array(), |
| [1045](#L1045) | 'ol'         => array(), |
| [1046](#L1046) | 'li'         => array(), |
| [1047](#L1047) | 'hr'         => array(), |
| [1048](#L1048) | 'blockquote' => array(), |
| [1049](#L1049) | 'del'        => array(), |
| [1050](#L1050) | 'strike'     => array(), |
| [1051](#L1051) | 'code'       => array(), |
| [1052](#L1052) | 'div'        => array(), |
| [1053](#L1053) | 'span'       => array(), |
| [1054](#L1054) | 'p'          => array(), |
| [1055](#L1055) | 'h1'         => array(), |
| [1056](#L1056) | 'h2'         => array(), |
| [1057](#L1057) | 'h3'         => array(), |
| [1058](#L1058) | 'h4'         => array(), |
| [1059](#L1059) | 'h5'         => array(), |
| [1060](#L1060) | 'h6'         => array(), |
| [1061](#L1061) | ) |
| [1062](#L1062) | ); |
| [1063](#L1063) | } elseif ( 'html' === $key ) { |
| [1064](#L1064) | if ( ! current\_user\_can( 'unfiltered\_html' ) ) { |
| [1065](#L1065) | $value = wp\_kses\_post( $value ); |
| [1066](#L1066) | } |
| [1067](#L1067) | } else { |
| [1068](#L1068) | $value = sanitize\_text\_field( $value ); |
| [1069](#L1069) | } |
| [1070](#L1070) | } |
| [1071](#L1071) | } |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | /\*\* |
| [1075](#L1075) | \* Triggered when clicking the rating footer. |
| [1076](#L1076) | \* |
| [1077](#L1077) | \* @since 1.1.2 |
| [1078](#L1078) | \*/ |
| [1079](#L1079) | public static function rated() { |
| [1080](#L1080) | if ( ! current\_user\_can( 'manage\_user\_registration' ) ) { |
| [1081](#L1081) | wp\_die( - 1 ); |
| [1082](#L1082) | } |
| [1083](#L1083) | update\_option( 'user\_registration\_admin\_footer\_text\_rated', 1 ); |
| [1084](#L1084) | wp\_die(); |
| [1085](#L1085) | } |
| [1086](#L1086) |  |
| [1087](#L1087) | /\*\* |
| [1088](#L1088) | \* Dismiss user registration notices. |
| [1089](#L1089) | \* |
| [1090](#L1090) | \* @since 1.5.8 |
| [1091](#L1091) | \* |
| [1092](#L1092) | \* @return void |
| [1093](#L1093) | \*\*/ |
| [1094](#L1094) | public static function dismiss\_notice() { |
| [1095](#L1095) | $notice\_type = isset( $\_POST['notice\_type'] ) ? wp\_unslash( sanitize\_key( $\_POST['notice\_type'] ) ) : '';   // phpcs:ignore WordPress.Security.NonceVerification |
| [1096](#L1096) | check\_admin\_referer( $notice\_type . '-nonce', 'security' ); |
| [1097](#L1097) |  |
| [1098](#L1098) | if ( ! empty( $\_POST['dismissed'] ) ) { |
| [1099](#L1099) | if ( ! empty( $\_POST['dismiss\_forever'] ) && ur\_string\_to\_bool( sanitize\_text\_field( wp\_unslash( $\_POST['dismiss\_forever'] ) ) ) ) { |
| [1100](#L1100) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed', true ); |
| [1101](#L1101) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed\_temporarily', '' ); |
| [1102](#L1102) | } else { |
| [1103](#L1103) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed\_temporarily', current\_time( 'Y-m-d' ) ); |
| [1104](#L1104) | } |
| [1105](#L1105) | } |
| [1106](#L1106) | } |
| [1107](#L1107) |  |
| [1108](#L1108) | /\*\* |
| [1109](#L1109) | \* Remove profile picture ajax method. |
| [1110](#L1110) | \*/ |
| [1111](#L1111) | public static function profile\_pic\_remove() { |
| [1112](#L1112) | check\_ajax\_referer( 'user\_registration\_profile\_picture\_remove\_nonce', 'security' ); |
| [1113](#L1113) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [1114](#L1114) |  |
| [1115](#L1115) | $flag = wp\_verify\_nonce( $nonce, 'user\_registration\_profile\_picture\_remove\_nonce' ); |
| [1116](#L1116) |  |
| [1117](#L1117) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [1118](#L1118) | wp\_send\_json\_error( |
| [1119](#L1119) | array( |
| [1120](#L1120) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [1121](#L1121) | ) |
| [1122](#L1122) | ); |
| [1123](#L1123) | } |
| [1124](#L1124) |  |
| [1125](#L1125) | $attachment\_id = isset( $\_POST['attachment\_id'] ) ? intval( wp\_unslash( $\_POST['attachment\_id'] ) ) : ''; |
| [1126](#L1126) |  |
| [1127](#L1127) | if ( file\_exists( get\_attached\_file( $attachment\_id ) ) && ! unlink( get\_attached\_file( $attachment\_id ) ) ) { |
| [1128](#L1128) | wp\_send\_json\_error( |
| [1129](#L1129) | array( |
| [1130](#L1130) | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
| [1131](#L1131) | ) |
| [1132](#L1132) | ); |
| [1133](#L1133) | } |
| [1134](#L1134) |  |
| [1135](#L1135) | $user\_id = get\_current\_user\_id(); |
| [1136](#L1136) |  |
| [1137](#L1137) | if ( $user\_id > 0 ) { |
| [1138](#L1138) | update\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url', '' ); |
| [1139](#L1139) | } |
| [1140](#L1140) |  |
| [1141](#L1141) | wp\_send\_json\_success( |
| [1142](#L1142) | array( |
| [1143](#L1143) | 'message' => \_\_( 'User profile picture removed successfully', 'user-registration' ), |
| [1144](#L1144) | ) |
| [1145](#L1145) | ); |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | /\*\* |
| [1149](#L1149) | \* Ajax handler for licence check. |
| [1150](#L1150) | \* |
| [1151](#L1151) | \* @global WP\_Filesystem\_Base $wp\_filesystem Subclass |
| [1152](#L1152) | \*/ |
| [1153](#L1153) | public static function template\_licence\_check() { |
| [1154](#L1154) | check\_ajax\_referer( 'user\_registration\_template\_licence\_check', 'security' ); |
| [1155](#L1155) |  |
| [1156](#L1156) | if ( empty( $\_POST['plan'] ) ) { |
| [1157](#L1157) | wp\_send\_json\_error( |
| [1158](#L1158) | array( |
| [1159](#L1159) | 'plan'         => '', |
| [1160](#L1160) | 'errorCode'    => 'no\_plan\_specified', |
| [1161](#L1161) | 'errorMessage' => esc\_html\_\_( 'No Plan specified.', 'user-registration' ), |
| [1162](#L1162) | ) |
| [1163](#L1163) | ); |
| [1164](#L1164) | } |
| [1165](#L1165) |  |
| [1166](#L1166) | $addons        = array(); |
| [1167](#L1167) | $template\_data = UR\_Admin\_Form\_Templates::get\_template\_data(); |
| [1168](#L1168) | $template\_data = is\_array( $template\_data ) ? $template\_data : array(); |
| [1169](#L1169) | if ( ! empty( $template\_data ) ) { |
| [1170](#L1170) | foreach ( $template\_data as $template ) { |
| [1171](#L1171) | if ( isset( $\_POST['slug'] ) && $template->slug === $\_POST['slug'] && in\_array( trim( $\_POST['plan'] ), $template->plan, true ) ) { |
| [1172](#L1172) | $addons = $template->addons; |
| [1173](#L1173) | } |
| [1174](#L1174) | } |
| [1175](#L1175) | } |
| [1176](#L1176) |  |
| [1177](#L1177) | $output  = '<div class="user-registration-recommend-addons">'; |
| [1178](#L1178) | $output .= '<h3>' . esc\_html\_\_( 'This form template requires the following addons.', 'user-registration' ) . '</h3>'; |
| [1179](#L1179) | $output .= '<table class="plugins-list-table widefat striped">'; |
| [1180](#L1180) | $output .= '<thead><tr><th scope="col" class="manage-column required-plugins" colspan="2">' . esc\_html\_\_( 'Required Addons', 'user-registration' ) . '</th></tr></thead><tbody id="the-list">'; |
| [1181](#L1181) | $output .= '</div>'; |
| [1182](#L1182) |  |
| [1183](#L1183) | $activated = true; |
| [1184](#L1184) |  |
| [1185](#L1185) | foreach ( $addons as $slug => $addon ) { |
| [1186](#L1186) | $plugin = 'user-registration-pro' === $slug ? $slug . '/user-registration.php' : $slug . '/' . $slug . '.php'; |
| [1187](#L1187) |  |
| [1188](#L1188) | if ( is\_plugin\_active( $plugin ) ) { |
| [1189](#L1189) | $class        = 'active'; |
| [1190](#L1190) | $parent\_class = ''; |
| [1191](#L1191) | } elseif ( file\_exists( WP\_PLUGIN\_DIR . '/' . $plugin ) ) { |
| [1192](#L1192) | $class        = 'activate-now'; |
| [1193](#L1193) | $parent\_class = 'inactive'; |
| [1194](#L1194) | $activated    = false; |
| [1195](#L1195) | } else { |
| [1196](#L1196) | $class        = 'install-now'; |
| [1197](#L1197) | $parent\_class = 'inactive'; |
| [1198](#L1198) | $activated    = false; |
| [1199](#L1199) | } |
| [1200](#L1200) |  |
| [1201](#L1201) | $output .= '<tr class="plugin-card-' . $slug . ' plugin ' . $parent\_class . '" data-slug="' . $slug . '" data-plugin="' . $plugin . '" data-name="' . $addon . '">'; |
| [1202](#L1202) | $output .= '<td class="plugin-name">' . $addon . '</td>'; |
| [1203](#L1203) | $output .= '<td class="plugin-status"><span class="' . esc\_attr( $class ) . '"></span></td>'; |
| [1204](#L1204) | $output .= '</tr>'; |
| [1205](#L1205) | } |
| [1206](#L1206) | $output .= '</tbody></table></div>'; |
| [1207](#L1207) |  |
| [1208](#L1208) | wp\_send\_json\_success( |
| [1209](#L1209) | array( |
| [1210](#L1210) | 'html'     => $output, |
| [1211](#L1211) | 'activate' => $activated, |
| [1212](#L1212) | ) |
| [1213](#L1213) | ); |
| [1214](#L1214) | } |
| [1215](#L1215) |  |
| [1216](#L1216) | /\*\* |
| [1217](#L1217) | \* Check for captcha setup. |
| [1218](#L1218) | \*/ |
| [1219](#L1219) | public static function captcha\_setup\_check() { |
| [1220](#L1220) | check\_ajax\_referer( 'user\_registration\_captcha\_setup\_check', 'security' ); |
| [1221](#L1221) |  |
| [1222](#L1222) | if ( ur\_check\_captch\_keys() ) { |
| [1223](#L1223) | wp\_send\_json\_success( |
| [1224](#L1224) | array( |
| [1225](#L1225) | 'is\_captcha\_setup' => true, |
| [1226](#L1226) | ) |
| [1227](#L1227) | ); |
| [1228](#L1228) | } |
| [1229](#L1229) |  |
| [1230](#L1230) | wp\_send\_json\_error( |
| [1231](#L1231) | array( |
| [1232](#L1232) | 'is\_captcha\_setup'        => false, |
| [1233](#L1233) | 'captcha\_setup\_error\_msg' => sprintf( |
| [1234](#L1234) | /\* translators: %s - Integration tab url \*/ |
| [1235](#L1235) | \_\_( 'Seems like you haven\'t added the reCAPTCHA Keys. <a href="%s" >Add Now.</a>', 'user-registration' ), |
| [1236](#L1236) | esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=captcha' ) ) |
| [1237](#L1237) | ), |
| [1238](#L1238) | ) |
| [1239](#L1239) | ); |
| [1240](#L1240) | } |
| [1241](#L1241) |  |
| [1242](#L1242) | /\*\* |
| [1243](#L1243) | \* Ajax handler for installing a extension. |
| [1244](#L1244) | \* |
| [1245](#L1245) | \* @since 1.2.0 |
| [1246](#L1246) | \* |
| [1247](#L1247) | \* @see Plugin\_Upgrader |
| [1248](#L1248) | \* |
| [1249](#L1249) | \* @global WP\_Filesystem\_Base $wp\_filesystem Subclass |
| [1250](#L1250) | \*/ |
| [1251](#L1251) | public static function install\_extension() { |
| [1252](#L1252) | check\_ajax\_referer( 'updates' ); |
| [1253](#L1253) |  |
| [1254](#L1254) | if ( empty( $\_POST['slug'] ) ) { |
| [1255](#L1255) | wp\_send\_json\_error( |
| [1256](#L1256) | array( |
| [1257](#L1257) | 'slug'         => '', |
| [1258](#L1258) | 'errorCode'    => 'no\_plugin\_specified', |
| [1259](#L1259) | 'errorMessage' => esc\_html\_\_( 'No plugin specified.', 'user-registration' ), |
| [1260](#L1260) | ) |
| [1261](#L1261) | ); |
| [1262](#L1262) | } |
| [1263](#L1263) |  |
| [1264](#L1264) | $slug     = sanitize\_key( wp\_unslash( $\_POST['slug'] ) ); |
| [1265](#L1265) | $plugin\_slug = 'user-registration-pro' === $slug ? wp\_unslash( $\_POST['slug'] . '/user-registration.php' ) : wp\_unslash( $\_POST['slug'] . '/' . $\_POST['slug'] . '.php' ); // phpcs:ignore |
| [1266](#L1266) | $plugin   = plugin\_basename( sanitize\_text\_field( $plugin\_slug ) ); |
| [1267](#L1267) | $status   = array( |
| [1268](#L1268) | 'install' => 'plugin', |
| [1269](#L1269) | 'slug'    => sanitize\_key( wp\_unslash( $\_POST['slug'] ) ), |
| [1270](#L1270) | ); |
| [1271](#L1271) |  |
| [1272](#L1272) | if ( ! current\_user\_can( 'install\_plugins' ) ) { |
| [1273](#L1273) | $status['errorMessage'] = esc\_html\_\_( 'Sorry, you are not allowed to install plugins on this site.', 'user-registration' ); |
| [1274](#L1274) | wp\_send\_json\_error( $status ); |
| [1275](#L1275) | } |
| [1276](#L1276) |  |
| [1277](#L1277) | include\_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; |
| [1278](#L1278) | include\_once ABSPATH . 'wp-admin/includes/plugin-install.php'; |
| [1279](#L1279) |  |
| [1280](#L1280) | if ( file\_exists( WP\_PLUGIN\_DIR . '/' . $slug ) ) { |
| [1281](#L1281) | $plugin\_data          = get\_plugin\_data( WP\_PLUGIN\_DIR . '/' . $plugin ); |
| [1282](#L1282) | $status['plugin']     = $plugin; |
| [1283](#L1283) | $status['pluginName'] = $plugin\_data['Name']; |
| [1284](#L1284) |  |
| [1285](#L1285) | if ( current\_user\_can( 'activate\_plugin', $plugin ) && is\_plugin\_inactive( $plugin ) ) { |
| [1286](#L1286) | $result = activate\_plugin( $plugin ); |
| [1287](#L1287) |  |
| [1288](#L1288) | if ( is\_wp\_error( $result ) ) { |
| [1289](#L1289) | $status['errorCode']    = $result->get\_error\_code(); |
| [1290](#L1290) | $status['errorMessage'] = $result->get\_error\_message(); |
| [1291](#L1291) | wp\_send\_json\_error( $status ); |
| [1292](#L1292) | } |
| [1293](#L1293) |  |
| [1294](#L1294) | wp\_send\_json\_success( $status ); |
| [1295](#L1295) | } |
| [1296](#L1296) | } |
| [1297](#L1297) |  |
| [1298](#L1298) | $api = json\_decode( |
| [1299](#L1299) | UR\_Updater\_Key\_API::version( |
| [1300](#L1300) | array( |
| [1301](#L1301) | 'license'   => get\_option( 'user-registration\_license\_key' ), |
| [1302](#L1302) | 'item\_name' => ! empty( $\_POST['name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['name'] ) ) : '', |
| [1303](#L1303) | ) |
| [1304](#L1304) | ) |
| [1305](#L1305) | ); |
| [1306](#L1306) |  |
| [1307](#L1307) | if ( is\_wp\_error( $api ) ) { |
| [1308](#L1308) | $status['errorMessage'] = $api->get\_error\_message(); |
| [1309](#L1309) | wp\_send\_json\_error( $status ); |
| [1310](#L1310) | } |
| [1311](#L1311) |  |
| [1312](#L1312) | $status['pluginName'] = $api->name; |
| [1313](#L1313) |  |
| [1314](#L1314) | $skin     = new WP\_Ajax\_Upgrader\_Skin(); |
| [1315](#L1315) | $upgrader = new Plugin\_Upgrader( $skin ); |
| [1316](#L1316) | $result   = $upgrader->install( $api->download\_link ); |
| [1317](#L1317) |  |
| [1318](#L1318) | if ( defined( 'WP\_DEBUG' ) && WP\_DEBUG ) { |
| [1319](#L1319) | $status['debug'] = $skin->get\_upgrade\_messages(); |
| [1320](#L1320) | } |
| [1321](#L1321) |  |
| [1322](#L1322) | if ( is\_wp\_error( $result ) ) { |
| [1323](#L1323) | $status['errorCode']    = $result->get\_error\_code(); |
| [1324](#L1324) | $status['errorMessage'] = $result->get\_error\_message(); |
| [1325](#L1325) | wp\_send\_json\_error( $status ); |
| [1326](#L1326) | } elseif ( is\_wp\_error( $skin->result ) ) { |
| [1327](#L1327) | $status['errorCode']    = $skin->result->get\_error\_code(); |
| [1328](#L1328) | $status['errorMessage'] = $skin->result->get\_error\_message(); |
| [1329](#L1329) | wp\_send\_json\_error( $status ); |
| [1330](#L1330) | } elseif ( $skin->get\_errors()->get\_error\_code() ) { |
| [1331](#L1331) | $status['errorMessage'] = $skin->get\_error\_messages(); |
| [1332](#L1332) | wp\_send\_json\_error( $status ); |
| [1333](#L1333) | } elseif ( is\_null( $result ) ) { |
| [1334](#L1334) | global $wp\_filesystem; |
| [1335](#L1335) |  |
| [1336](#L1336) | $status['errorCode']    = 'unable\_to\_connect\_to\_filesystem'; |
| [1337](#L1337) | $status['errorMessage'] = esc\_html\_\_( 'Unable to connect to the filesystem. Please confirm your credentials.', 'user-registration' ); |
| [1338](#L1338) |  |
| [1339](#L1339) | // Pass through the error from WP\_Filesystem if one was raised. |
| [1340](#L1340) | if ( $wp\_filesystem instanceof WP\_Filesystem\_Base && is\_wp\_error( $wp\_filesystem->errors ) && $wp\_filesystem->errors->get\_error\_code() ) { |
| [1341](#L1341) | $status['errorMessage'] = esc\_html( $wp\_filesystem->errors->get\_error\_message() ); |
| [1342](#L1342) | } |
| [1343](#L1343) |  |
| [1344](#L1344) | wp\_send\_json\_error( $status ); |
| [1345](#L1345) | } |
| [1346](#L1346) |  |
| [1347](#L1347) | $api->version   = isset( $api->new\_version ) ? $api->new\_version : ''; |
| [1348](#L1348) | $install\_status = install\_plugin\_install\_status( $api ); |
| [1349](#L1349) |  |
| [1350](#L1350) | if ( current\_user\_can( 'activate\_plugin', $install\_status['file'] ) && is\_plugin\_inactive( $install\_status['file'] ) ) { |
| [1351](#L1351) | if ( isset( $\_POST['page'] ) && 'user-registration\_page\_add-new-registration' === $\_POST['page'] ) { |
| [1352](#L1352) | activate\_plugin( $install\_status['file'] ); |
| [1353](#L1353) | } else { |
| [1354](#L1354) | $status['activateUrl'] = |
| [1355](#L1355) | esc\_url\_raw( |
| [1356](#L1356) | add\_query\_arg( |
| [1357](#L1357) | array( |
| [1358](#L1358) | 'action'   => 'activate', |
| [1359](#L1359) | 'plugin'   => $install\_status['file'], |
| [1360](#L1360) | '\_wpnonce' => wp\_create\_nonce( 'activate-plugin\_' . $install\_status['file'] ), |
| [1361](#L1361) | ), |
| [1362](#L1362) | admin\_url( 'admin.php?page=user-registration-addons' ) |
| [1363](#L1363) | ) |
| [1364](#L1364) | ); |
| [1365](#L1365) | } |
| [1366](#L1366) | } |
| [1367](#L1367) |  |
| [1368](#L1368) | wp\_send\_json\_success( $status ); |
| [1369](#L1369) | } |
| [1370](#L1370) |  |
| [1371](#L1371) | /\*\* |
| [1372](#L1372) | \* AJAX create new form. |
| [1373](#L1373) | \*/ |
| [1374](#L1374) | public static function create\_form() { |
| [1375](#L1375) | ob\_start(); |
| [1376](#L1376) |  |
| [1377](#L1377) | check\_ajax\_referer( 'user\_registration\_create\_form', 'security' ); |
| [1378](#L1378) |  |
| [1379](#L1379) | $title    = isset( $\_POST['title'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['title'] ) ) : esc\_html\_\_( 'Blank Form', 'user-registration' ); |
| [1380](#L1380) | $template = isset( $\_POST['template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['template'] ) ) : 'blank'; |
| [1381](#L1381) |  |
| [1382](#L1382) | $form\_id = UR()->form->create( $title, $template ); |
| [1383](#L1383) |  |
| [1384](#L1384) | if ( $form\_id ) { |
| [1385](#L1385) | $data = array( |
| [1386](#L1386) | 'id'       => $form\_id, |
| [1387](#L1387) | 'redirect' => add\_query\_arg( |
| [1388](#L1388) | array( |
| [1389](#L1389) | 'tab'     => 'fields', |
| [1390](#L1390) | 'form\_id' => $form\_id, |
| [1391](#L1391) | ), |
| [1392](#L1392) | admin\_url( 'admin.php?page=add-new-registration&edit-registration=' . $form\_id ) |
| [1393](#L1393) | ), |
| [1394](#L1394) | ); |
| [1395](#L1395) |  |
| [1396](#L1396) | wp\_send\_json\_success( $data ); |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) | wp\_send\_json\_error( |
| [1400](#L1400) | array( |
| [1401](#L1401) | 'error' => esc\_html\_\_( 'Something went wrong, please try again later', 'user-registration' ), |
| [1402](#L1402) | ) |
| [1403](#L1403) | ); |
| [1404](#L1404) | } |
| [1405](#L1405) |  |
| [1406](#L1406) | /\*\* |
| [1407](#L1407) | \* Cancel a pending email change. |
| [1408](#L1408) | \* |
| [1409](#L1409) | \* @return void |
| [1410](#L1410) | \*/ |
| [1411](#L1411) | public static function cancel\_email\_change() { |
| [1412](#L1412) | check\_ajax\_referer( 'cancel\_email\_change\_nonce', '\_wpnonce' ); |
| [1413](#L1413) |  |
| [1414](#L1414) | $user\_id = isset( $\_POST['cancel\_email\_change'] ) ? absint( wp\_unslash( $\_POST['cancel\_email\_change'] ) ) : false; |
| [1415](#L1415) |  |
| [1416](#L1416) | if ( ! $user\_id ) { |
| [1417](#L1417) | wp\_die( -1 ); |
| [1418](#L1418) | } |
| [1419](#L1419) |  |
| [1420](#L1420) | // Remove the confirmation key, pending email and expiry date. |
| [1421](#L1421) | UR\_Form\_Handler::delete\_pending\_email\_change( $user\_id ); |
| [1422](#L1422) |  |
| [1423](#L1423) | wp\_send\_json\_success( |
| [1424](#L1424) | array( |
| [1425](#L1425) | 'message' => \_\_( 'Changed email cancelled successfully.', 'user-registration' ), |
| [1426](#L1426) | ) |
| [1427](#L1427) | ); |
| [1428](#L1428) | } |
| [1429](#L1429) |  |
| [1430](#L1430) | /\*\* |
| [1431](#L1431) | \* Email setting status |
| [1432](#L1432) | \*/ |
| [1433](#L1433) | public static function email\_setting\_status() { |
| [1434](#L1434) | $security = isset( $\_POST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['security'] ) ) : ''; |
| [1435](#L1435) | if ( '' === $security || ! wp\_verify\_nonce( $security, 'email\_setting\_status\_nonce' ) ) { |
| [1436](#L1436) | wp\_send\_json\_error( 'Nonce verification failed' ); |
| [1437](#L1437) | return; |
| [1438](#L1438) | } |
| [1439](#L1439) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1440](#L1440) | wp\_send\_json\_error( 'Permision Denied' ); |
| [1441](#L1441) | return; |
| [1442](#L1442) | } |
| [1443](#L1443) | $status = isset( $\_POST['status'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['status'] ) ) : null; |
| [1444](#L1444) | $id     = isset( $\_POST['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) : null; |
| [1445](#L1445) | $value  = ur\_string\_to\_bool( $status ); |
| [1446](#L1446) | $key    = 'user\_registration\_enable\_' . $id; |
| [1447](#L1447) |  |
| [1448](#L1448) | $option = get\_option( $key, 'NO\_OPTION' ); |
| [1449](#L1449) | if ( 'NO\_OPTION' === $option ) { |
| [1450](#L1450) | $status = add\_option( $key, $value ); |
| [1451](#L1451) | } else { |
| [1452](#L1452) |  |
| [1453](#L1453) | $status = update\_option( $key, $value ); |
| [1454](#L1454) | } |
| [1455](#L1455) | if ( $status ) { |
| [1456](#L1456) | wp\_send\_json\_success( 'Successfully Updated' ); |
| [1457](#L1457) | } else { |
| [1458](#L1458) | wp\_send\_json\_error( 'Update failed !' ); |
| [1459](#L1459) | } |
| [1460](#L1460) | } |
| [1461](#L1461) | /\*\* |
| [1462](#L1462) | \* Install or upgrade to premium. |
| [1463](#L1463) | \*/ |
| [1464](#L1464) | public static function locked\_form\_fields\_notice() { |
| [1465](#L1465) | $security = isset( $\_POST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['security'] ) ) : ''; |
| [1466](#L1466) | if ( '' === $security || ! wp\_verify\_nonce( $security, 'locked\_form\_fields\_notice\_nonce' ) ) { |
| [1467](#L1467) | wp\_send\_json\_error( 'Nonce verification failed' ); |
| [1468](#L1468) | return; |
| [1469](#L1469) | } |
| [1470](#L1470) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1471](#L1471) | wp\_send\_json\_error( 'Permision Denied' ); |
| [1472](#L1472) | return; |
| [1473](#L1473) | } |
| [1474](#L1474) | $plan         = isset( $\_POST['plan'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['plan'] ) ) : null; |
| [1475](#L1475) | $slug         = isset( $\_POST['slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['slug'] ) ) : null; |
| [1476](#L1476) | $name         = isset( $\_POST['name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['name'] ) ) : null; |
| [1477](#L1477) | $license\_data = ur\_get\_license\_plan(); |
| [1478](#L1478) | $button       = ''; |
| [1479](#L1479) |  |
| [1480](#L1480) | if ( false === $license\_data ) { |
| [1481](#L1481) |  |
| [1482](#L1482) | if ( is\_plugin\_active( 'user-registration-pro/user-registration.php' ) ) { |
| [1483](#L1483) | $button = '<div class="action-buttons"><a class="button activate-license-now" href="' . esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=license' ) ) . '" target="\_blank">' . esc\_html\_\_( 'Activate License', 'user-registration' ) . '</a></div>'; |
| [1484](#L1484) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1485](#L1485) | } else { |
| [1486](#L1486) | $button = '<div class="action-buttons"><a class="button upgrade-now" href="https://wpuserregistration.com/pricing/?utm\_source=addons-page&utm\_medium=upgrade-button&utm\_campaign=ur-upgrade-to-pro" target="\_blank">' . esc\_html\_\_( 'Upgrade Plan', 'user-registration' ) . '</a></div>'; |
| [1487](#L1487) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1488](#L1488) | } |
| [1489](#L1489) | } |
| [1490](#L1490) | $license\_plan = ! empty( $license\_data->item\_plan ) ? $license\_data->item\_plan : false; |
| [1491](#L1491) |  |
| [1492](#L1492) | $license\_plan = $license\_plan . ' plan'; |
| [1493](#L1493) | $license\_plan = trim( $license\_plan ); |
| [1494](#L1494) |  |
| [1495](#L1495) | if ( 'themegrill agency plan' === $license\_plan || 'professional plan' === $license\_plan || 'plus plan' === $license\_plan ) { |
| [1496](#L1496) | $license\_plan = 'themegrill agency plan or professional plan or plus plan'; |
| [1497](#L1497) | } |
| [1498](#L1498) | if ( strtolower( $plan ) === $license\_plan ) { |
| [1499](#L1499) | if ( 'themegrill agency plan or professional plan or plus plan' === $license\_plan ) { |
| [1500](#L1500) | $plan\_list = array( 'plus', 'professional', 'personal', 'themegrill agency' ); |
| [1501](#L1501) | } else { |
| [1502](#L1502) | $plan\_list = array( 'personal' ); |
| [1503](#L1503) | } |
| [1504](#L1504) | } elseif ( strtolower( $plan ) === 'personal plan' && 'themegrill agency plan or professional plan or plus plan' === $license\_plan ) { |
| [1505](#L1505) | $plan\_list = array( 'plus', 'professional', 'personal', 'themegrill agency' ); |
| [1506](#L1506) | } else { |
| [1507](#L1507) | $plan\_list = array(); |
| [1508](#L1508) | } |
| [1509](#L1509) | if ( $plan ) { |
| [1510](#L1510) | $addon = (object) array( |
| [1511](#L1511) | 'title' => '', |
| [1512](#L1512) | 'slug'  => $slug, |
| [1513](#L1513) | 'name'  => $name, |
| [1514](#L1514) | 'plan'  => $plan\_list, |
| [1515](#L1515) | ); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) | ob\_start(); |
| [1519](#L1519) | /\*\* |
| [1520](#L1520) | \* Action after addon description. |
| [1521](#L1521) | \* |
| [1522](#L1522) | \* @param array $addon The addon's details. |
| [1523](#L1523) | \*/ |
| [1524](#L1524) | do\_action( 'user\_registration\_after\_addons\_description', $addon ); |
| [1525](#L1525) | $button = ob\_get\_clean(); |
| [1526](#L1526) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1527](#L1527) | } |
| [1528](#L1528) |  |
| [1529](#L1529) |  |
| [1530](#L1530) | /\*\* |
| [1531](#L1531) | \* Handle PHP Deprecated notice dismiss action. |
| [1532](#L1532) | \* |
| [1533](#L1533) | \* @return bool |
| [1534](#L1534) | \*/ |
| [1535](#L1535) | public static function php\_notice\_dismiss() { |
| [1536](#L1536) | $current\_date = gmdate( 'Y-m-d' ); |
| [1537](#L1537) | $prompt\_count = get\_option( 'user\_registration\_php\_deprecated\_notice\_prompt\_count', 0 ); |
| [1538](#L1538) |  |
| [1539](#L1539) | update\_option( 'user\_registration\_php\_deprecated\_notice\_last\_prompt\_date', $current\_date ); |
| [1540](#L1540) | update\_option( 'user\_registration\_php\_deprecated\_notice\_prompt\_count', ++$prompt\_count ); |
| [1541](#L1541) |  |
| [1542](#L1542) | return false; |
| [1543](#L1543) | } |
| [1544](#L1544) | } |
| [1545](#L1545) |  |
| [1546](#L1546) | UR\_AJAX::init(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/user-registration/tags/3.1.5/includes/class-ur-ajax.php?format=txt)
* [Original Format](/export/3220811/user-registration/tags/3.1.5/includes/class-ur-ajax.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_d4d57935_20250111_194236.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fuser-registration%2Ftrunk%2Fincludes%2Fclass-ur-ajax.php%3Frev%3D3070439)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3034436 "Revision 3034436")
* [Latest Revision](/browser/user-registration/trunk/includes/class-ur-ajax.php)
* [Next Revision](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3095484 "Revision 3095484") →
* [Blame](/browser/user-registration/trunk/includes/class-ur-ajax.php?annotate=blame&rev=3070439 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439)

---

# [source:](/browser?rev=3070439&order=name "Go to repository root") [user-registration](/browser/user-registration?rev=3070439&order=name "View user-registration")/[trunk](/browser/user-registration/trunk?rev=3070439&order=name "View trunk")/[includes](/browser/user-registration/trunk/includes?rev=3070439&order=name "View includes")/[class-ur-ajax.php](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439&order=name "View class-ur-ajax.php") @ [3070439](/changeset/3070439/ "View changeset 3070439")

View diff against:

View revision:

| [Last change](/changeset/3070439/user-registration/trunk/includes/class-ur-ajax.php "View differences") on this file since 3070439 was [3070439](/changeset/3070439/ "View changeset 3070439"), checked in by wpeverestdev, [9 months ago](/timeline?from=2024-04-15T05%3A24%3A45Z&precision=second "See timeline at 04/15/2024 05:24:45 AM") |
| --- |
| Update to version 3.2.0 from GitHub |
| **File size:** 51.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* UserRegistration UR\_AJAX |
| [4](#L4) | \* |
| [5](#L5) | \* AJAX Event Handler |
| [6](#L6) | \* |
| [7](#L7) | \* @package UserRegistration/Classes |
| [8](#L8) | \* @class   UR\_AJAX |
| [9](#L9) | \* @version 1.0.0 |
| [10](#L10) | \*/ |
| [11](#L11) |  |
| [12](#L12) | if ( ! defined( 'ABSPATH' ) ) { |
| [13](#L13) | exit; |
| [14](#L14) | } |
| [15](#L15) |  |
| [16](#L16) | /\*\* |
| [17](#L17) | \* UR\_AJAX Class |
| [18](#L18) | \*/ |
| [19](#L19) | class UR\_AJAX { |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* Field key array |
| [23](#L23) | \* |
| [24](#L24) | \* @var array |
| [25](#L25) | \*/ |
| [26](#L26) | private static $field\_key\_aray = array(); |
| [27](#L27) | /\*\* |
| [28](#L28) | \* Check whether is field key pass |
| [29](#L29) | \* |
| [30](#L30) | \* @var bool |
| [31](#L31) | \*/ |
| [32](#L32) | private static $is\_field\_key\_pass = true; |
| [33](#L33) | /\*\* |
| [34](#L34) | \* Field key value |
| [35](#L35) | \* |
| [36](#L36) | \* @var array |
| [37](#L37) | \*/ |
| [38](#L38) | private static $failed\_key\_value = array(); |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Initialization of ajax. |
| [42](#L42) | \*/ |
| [43](#L43) | public static function init() { |
| [44](#L44) | self::add\_ajax\_events(); |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Hook in methods - uses WordPress ajax handlers (admin-ajax) |
| [49](#L49) | \*/ |
| [50](#L50) | public static function add\_ajax\_events() { |
| [51](#L51) | $ajax\_events = array( |
| [52](#L52) | 'user\_input\_dropped'        => true, |
| [53](#L53) | 'form\_save\_action'          => false, |
| [54](#L54) | 'user\_form\_submit'          => true, |
| [55](#L55) | 'update\_profile\_details'    => true, |
| [56](#L56) | 'profile\_pic\_upload'        => true, |
| [57](#L57) | 'profile\_pic\_remove'        => false, |
| [58](#L58) | 'ajax\_login\_submit'         => true, |
| [59](#L59) | 'send\_test\_email'           => true, |
| [60](#L60) | 'rated'                     => false, |
| [61](#L61) | 'dashboard\_widget'          => false, |
| [62](#L62) | 'dismiss\_notice'            => false, |
| [63](#L63) | 'import\_form\_action'        => false, |
| [64](#L64) | 'template\_licence\_check'    => false, |
| [65](#L65) | 'captcha\_setup\_check'       => false, |
| [66](#L66) | 'install\_extension'         => false, |
| [67](#L67) | 'create\_form'               => true, |
| [68](#L68) | 'allow\_usage\_dismiss'       => false, |
| [69](#L69) | 'cancel\_email\_change'       => false, |
| [70](#L70) | 'email\_setting\_status'      => false, |
| [71](#L71) | 'locked\_form\_fields\_notice' => false, |
| [72](#L72) | 'search\_global\_settings'    => false, |
| [73](#L73) | 'php\_notice\_dismiss'        => false, |
| [74](#L74) | 'locate\_form\_action'        => false, |
| [75](#L75) | ); |
| [76](#L76) |  |
| [77](#L77) | foreach ( $ajax\_events as $ajax\_event => $nopriv ) { |
| [78](#L78) | add\_action( 'wp\_ajax\_user\_registration\_' . $ajax\_event, array( \_\_CLASS\_\_, $ajax\_event ) ); |
| [79](#L79) |  |
| [80](#L80) | if ( $nopriv ) { |
| [81](#L81) | add\_action( 'wp\_ajax\_nopriv\_user\_registration\_' . $ajax\_event, array( \_\_CLASS\_\_, $ajax\_event ) ); |
| [82](#L82) | } |
| [83](#L83) | } |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | /\*\* |
| [87](#L87) | \* Triggered when admin search for the global settings. |
| [88](#L88) | \*/ |
| [89](#L89) | public static function search\_global\_settings() { |
| [90](#L90) | check\_ajax\_referer( 'user\_registration\_search\_global\_settings', 'security' ); |
| [91](#L91) |  |
| [92](#L92) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [93](#L93) | wp\_die( -1 ); |
| [94](#L94) | } |
| [95](#L95) | UR\_Admin\_Settings::search\_settings(); |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Triggered when clicking the allow usage notice allow or deny buttons. |
| [100](#L100) | \*/ |
| [101](#L101) | public static function allow\_usage\_dismiss() { |
| [102](#L102) | check\_ajax\_referer( 'allow\_usage\_nonce', '\_wpnonce' ); |
| [103](#L103) |  |
| [104](#L104) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [105](#L105) | wp\_die( -1 ); |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) | $allow\_usage\_tracking = isset( $\_POST['allow\_usage\_tracking'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['allow\_usage\_tracking'] ) ) : false; |
| [109](#L109) |  |
| [110](#L110) | update\_option( 'user\_registration\_allow\_usage\_notice\_shown', true ); |
| [111](#L111) |  |
| [112](#L112) | if ( ur\_string\_to\_bool( $allow\_usage\_tracking ) ) { |
| [113](#L113) | update\_option( 'user\_registration\_allow\_usage\_tracking', true ); |
| [114](#L114) | } else { |
| [115](#L115) | update\_option( 'user\_registration\_allow\_usage\_tracking', false ); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | wp\_die(); |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | /\*\* |
| [122](#L122) | \* Get Post data on frontend form submit |
| [123](#L123) | \* |
| [124](#L124) | \* @return void |
| [125](#L125) | \*/ |
| [126](#L126) | public static function user\_form\_submit() { |
| [127](#L127) | /\*\* |
| [128](#L128) | \* Filter to modify user capability. |
| [129](#L129) | \* Default value is 'create\_users'. |
| [130](#L130) | \*/ |
| [131](#L131) | $current\_user\_capability = apply\_filters( 'ur\_registration\_user\_capability', 'create\_users' ); |
| [132](#L132) |  |
| [133](#L133) | if ( is\_user\_logged\_in() && ! current\_user\_can( 'administrator' ) && ! current\_user\_can( $current\_user\_capability ) ) { //phpcs:ignore |
| [134](#L134) | wp\_send\_json\_error( |
| [135](#L135) | array( |
| [136](#L136) | 'message' => \_\_( 'You are already logged in.', 'user-registration' ), |
| [137](#L137) | ) |
| [138](#L138) | ); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( ! check\_ajax\_referer( 'user\_registration\_form\_data\_save\_nonce', 'security', false ) ) { |
| [142](#L142) | wp\_send\_json\_error( |
| [143](#L143) | array( |
| [144](#L144) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [145](#L145) | ) |
| [146](#L146) | ); |
| [147](#L147) | } |
| [148](#L148) |  |
| [149](#L149) | $form\_id             = isset( $\_POST['form\_id'] ) ? absint( $\_POST['form\_id'] ) : 0; |
| [150](#L150) | $nonce               = isset( $\_POST['ur\_frontend\_form\_nonce'] ) ? wp\_unslash( sanitize\_key( $\_POST['ur\_frontend\_form\_nonce'] ) ) : ''; |
| [151](#L151) | $captcha\_response    = isset( $\_POST['captchaResponse'] ) ? ur\_clean( wp\_unslash( $\_POST['captchaResponse'] ) ) : ''; //phpcs:ignore |
| [152](#L152) | $flag                = wp\_verify\_nonce( $nonce, 'ur\_frontend\_form\_id-' . $form\_id ); |
| [153](#L153) | $recaptcha\_enabled   = ur\_string\_to\_bool( ur\_get\_form\_setting\_by\_key( $form\_id, 'user\_registration\_form\_setting\_enable\_recaptcha\_support', false ) ); |
| [154](#L154) | $recaptcha\_type      = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_version', 'v2' ); |
| [155](#L155) | $invisible\_recaptcha = ur\_option\_checked( 'user\_registration\_captcha\_setting\_invisible\_recaptcha\_v2', false ); |
| [156](#L156) |  |
| [157](#L157) | if ( 'v2' === $recaptcha\_type && ! $invisible\_recaptcha ) { |
| [158](#L158) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key' ); |
| [159](#L159) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret' ); |
| [160](#L160) | } elseif ( 'v2' === $recaptcha\_type && $invisible\_recaptcha ) { |
| [161](#L161) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_key' ); |
| [162](#L162) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_invisible\_site\_secret' ); |
| [163](#L163) | } elseif ( 'v3' === $recaptcha\_type ) { |
| [164](#L164) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_v3' ); |
| [165](#L165) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_v3' ); |
| [166](#L166) | } elseif ( 'hCaptcha' === $recaptcha\_type ) { |
| [167](#L167) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_hcaptcha' ); |
| [168](#L168) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_hcaptcha' ); |
| [169](#L169) | } elseif ( 'cloudflare' === $recaptcha\_type ) { |
| [170](#L170) | $site\_key   = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_key\_cloudflare' ); |
| [171](#L171) | $secret\_key = get\_option( 'user\_registration\_captcha\_setting\_recaptcha\_site\_secret\_cloudflare' ); |
| [172](#L172) | } |
| [173](#L173) | if ( $recaptcha\_enabled && ! empty( $site\_key ) && ! empty( $secret\_key ) ) { |
| [174](#L174) | if ( ! empty( $captcha\_response ) ) { |
| [175](#L175) | if ( 'hCaptcha' === $recaptcha\_type ) { |
| [176](#L176) | $data = wp\_safe\_remote\_get( 'https://hcaptcha.com/siteverify?secret=' . $secret\_key . '&response=' . $captcha\_response ); |
| [177](#L177) | $data = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [178](#L178) | /\*\* |
| [179](#L179) | \* Filter to modify hcaptcha threshold. |
| [180](#L180) | \* Default value is 0.5 |
| [181](#L181) | \*/ |
| [182](#L182) | if ( empty( $data->success ) || ( isset( $data->score ) && $data->score < apply\_filters( 'user\_registration\_hcaptcha\_threshold', 0.5 ) ) ) { |
| [183](#L183) | wp\_send\_json\_error( |
| [184](#L184) | array( |
| [185](#L185) | 'message' => \_\_( 'Error on hCaptcha. Contact your site administrator.', 'user-registration' ), |
| [186](#L186) | ) |
| [187](#L187) | ); |
| [188](#L188) | } |
| [189](#L189) | } elseif ( 'cloudflare' === $recaptcha\_type ) { |
| [190](#L190) | $url    = 'https://challenges.cloudflare.com/turnstile/v0/siteverify'; |
| [191](#L191) | $params = array( |
| [192](#L192) | 'method' => 'POST', |
| [193](#L193) | 'body'   => array( |
| [194](#L194) | 'secret'   => $secret\_key, |
| [195](#L195) | 'response' => $captcha\_response, |
| [196](#L196) | ), |
| [197](#L197) | ); |
| [198](#L198) | $data   = wp\_safe\_remote\_post( $url, $params ); |
| [199](#L199) | $data   = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [200](#L200) | if ( empty( $data->success ) ) { |
| [201](#L201) | wp\_send\_json\_error( |
| [202](#L202) | array( |
| [203](#L203) | 'message' => \_\_( 'Error on Cloudflare Turnstile. Contact your site administrator.', 'user-registration' ), |
| [204](#L204) | ) |
| [205](#L205) | ); |
| [206](#L206) | } |
| [207](#L207) | } else { |
| [208](#L208) | $data = wp\_remote\_get( 'https://www.google.com/recaptcha/api/siteverify?secret=' . $secret\_key . '&response=' . $captcha\_response ); |
| [209](#L209) | $data = json\_decode( wp\_remote\_retrieve\_body( $data ) ); |
| [210](#L210) | /\*\* |
| [211](#L211) | \* Filter to modify V3 recaptcha threshold. |
| [212](#L212) | \* Default value is 0.5 |
| [213](#L213) | \*/ |
| [214](#L214) | if ( empty( $data->success ) || ( isset( $data->score ) && $data->score < apply\_filters( 'user\_registration\_recaptcha\_v3\_threshold', 0.5 ) ) ) { |
| [215](#L215) | wp\_send\_json\_error( |
| [216](#L216) | array( |
| [217](#L217) | 'message' => \_\_( 'Error on google reCaptcha. Contact your site administrator.', 'user-registration' ), |
| [218](#L218) | ) |
| [219](#L219) | ); |
| [220](#L220) | } |
| [221](#L221) | } |
| [222](#L222) | } else { |
| [223](#L223) | wp\_send\_json\_error( |
| [224](#L224) | array( |
| [225](#L225) | 'message' => get\_option( 'user\_registration\_form\_submission\_error\_message\_recaptcha', \_\_( 'Captcha code error, please try again.', 'user-registration' ) ), |
| [226](#L226) | ) |
| [227](#L227) | ); |
| [228](#L228) | } |
| [229](#L229) | } |
| [230](#L230) |  |
| [231](#L231) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [232](#L232) | wp\_send\_json\_error( |
| [233](#L233) | array( |
| [234](#L234) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [235](#L235) | ) |
| [236](#L236) | ); |
| [237](#L237) | } |
| [238](#L238) | /\*\* |
| [239](#L239) | \* Filter to override the register settings. |
| [240](#L240) | \* Default value is the get\_option('users\_can\_register') |
| [241](#L241) | \*/ |
| [242](#L242) | $users\_can\_register = apply\_filters( 'ur\_register\_setting\_override', get\_option( 'users\_can\_register' ) ); |
| [243](#L243) |  |
| [244](#L244) | if ( ! is\_user\_logged\_in() ) { |
| [245](#L245) | if ( ! $users\_can\_register ) { |
| [246](#L246) | wp\_send\_json\_error( |
| [247](#L247) | array( |
| [248](#L248) | /\*\* |
| [249](#L249) | \* Filter to modify register pre form message. |
| [250](#L250) | \* Default value is the 'Only administrators can add new users'. |
| [251](#L251) | \*/ |
| [252](#L252) | 'message' => apply\_filters( 'ur\_register\_pre\_form\_message', \_\_( 'Only administrators can add new users.', 'user-registration' ) ), |
| [253](#L253) | ) |
| [254](#L254) | ); |
| [255](#L255) | } |
| [256](#L256) | } else { |
| [257](#L257) | /\*\* |
| [258](#L258) | \* Filter to modify user capability. |
| [259](#L259) | \* Default value is 'create\_users'. |
| [260](#L260) | \*/ |
| [261](#L261) | $current\_user\_capability = apply\_filters( 'ur\_registration\_user\_capability', 'create\_users' ); |
| [262](#L262) |  |
| [263](#L263) | if ( ! current\_user\_can( $current\_user\_capability ) ) { |
| [264](#L264) | global $wp; |
| [265](#L265) |  |
| [266](#L266) | $user\_ID      = get\_current\_user\_id(); |
| [267](#L267) | $user         = get\_user\_by( 'ID', $user\_ID ); |
| [268](#L268) | $current\_url  = home\_url( add\_query\_arg( array(), $wp->request ) ); |
| [269](#L269) | $display\_name = ! empty( $user->data->display\_name ) ? $user->data->display\_name : $user->data->user\_email; |
| [270](#L270) |  |
| [271](#L271) | wp\_send\_json\_error( |
| [272](#L272) | array( |
| [273](#L273) | /\*\* |
| [274](#L274) | \* Filter to modify register pre form message. |
| [275](#L275) | \*/ |
| [276](#L276) | 'message' => apply\_filters( |
| [277](#L277) | 'ur\_register\_pre\_form\_message', |
| [278](#L278) | '<p class="alert" id="ur\_register\_pre\_form\_message">' . |
| [279](#L279) | /\* translators: %1$1s - Link to logout. \*/ |
| [280](#L280) | sprintf( \_\_( 'You are currently logged in as %1$1s. %2$2s', 'user-registration' ), '<a href="#" title="' . $display\_name . '">' . $display\_name . '</a>', '<a href="' . wp\_logout\_url( $current\_url ) . '" title="' . \_\_( 'Log out of this account.', 'user-registration' ) . '">' . \_\_( 'Logout', 'user-registration' ) . '  &raquo;</a>' ) . '</p>', |
| [281](#L281) | $user\_ID |
| [282](#L282) | ), |
| [283](#L283) | ) |
| [284](#L284) | ); |
| [285](#L285) | } |
| [286](#L286) | } |
| [287](#L287) |  |
| [288](#L288) | $form\_data = array(); |
| [289](#L289) |  |
| [290](#L290) | if ( isset( $\_POST['form\_data'] ) ) { |
| [291](#L291) | $form\_data = json\_decode( wp\_unslash( $\_POST['form\_data'] ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | UR\_Frontend\_Form\_Handler::handle\_form( $form\_data, $form\_id ); |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) |  |
| [298](#L298) | /\*\* |
| [299](#L299) | \* Get Post data on frontend form submit |
| [300](#L300) | \* |
| [301](#L301) | \* @return void |
| [302](#L302) | \*/ |
| [303](#L303) | public static function update\_profile\_details() { |
| [304](#L304) |  |
| [305](#L305) | if ( ! check\_ajax\_referer( 'user\_registration\_profile\_details\_save\_nonce', 'security', false ) ) { |
| [306](#L306) | wp\_send\_json\_error( |
| [307](#L307) | array( |
| [308](#L308) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [309](#L309) | ) |
| [310](#L310) | ); |
| [311](#L311) | } |
| [312](#L312) |  |
| [313](#L313) | // Current user id. |
| [314](#L314) | $user\_id = get\_current\_user\_id(); |
| [315](#L315) |  |
| [316](#L316) | if ( $user\_id <= 0 ) { |
| [317](#L317) | return; |
| [318](#L318) | } |
| [319](#L319) |  |
| [320](#L320) | // Get form id of the form from which current user is registered. |
| [321](#L321) | $form\_id\_array = get\_user\_meta( $user\_id, 'ur\_form\_id' ); |
| [322](#L322) | $form\_id       = 0; |
| [323](#L323) |  |
| [324](#L324) | if ( isset( $form\_id\_array[0] ) ) { |
| [325](#L325) | $form\_id = $form\_id\_array[0]; |
| [326](#L326) | } |
| [327](#L327) |  |
| [328](#L328) | // Make the schema of form data compatible with processing below. |
| [329](#L329) | $form\_data    = array(); |
| [330](#L330) | $single\_field = array(); |
| [331](#L331) |  |
| [332](#L332) | if ( isset( $\_POST['form\_data'] ) ) { |
| [333](#L333) | $form\_data = json\_decode( wp\_unslash( $\_POST['form\_data'] ) ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [334](#L334) | foreach ( $form\_data as $data ) { |
| [335](#L335) | $single\_field[ $data->field\_name ] = isset( $data->value ) ? $data->value : ''; |
| [336](#L336) | $data->field\_name                  = substr( $data->field\_name, 18 ); |
| [337](#L337) | } |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | $profile = user\_registration\_form\_data( $user\_id, $form\_id ); |
| [341](#L341) |  |
| [342](#L342) | foreach ( $profile as $key => $field ) { |
| [343](#L343) | if ( ! isset( $field['type'] ) ) { |
| [344](#L344) | $field['type'] = 'text'; |
| [345](#L345) | } |
| [346](#L346) | // Unset hidden field value. |
| [347](#L347) | if ( 'hidden' === $field['type'] && 'hidden' === $field['field\_key'] || ( 'range' === $field['type'] && ur\_string\_to\_bool( $field['enable\_payment\_slider'] ) ) ) { |
| [348](#L348) | $key = array\_search( $field, $profile, true ); |
| [349](#L349) | if ( false !== ( $key ) ) { |
| [350](#L350) | unset( $profile[ $key ] ); |
| [351](#L351) | } |
| [352](#L352) | } |
| [353](#L353) | // Get Value. |
| [354](#L354) | switch ( $field['type'] ) { |
| [355](#L355) | case 'checkbox': |
| [356](#L356) | if ( isset( $single\_field[ $key ] ) ) { |
| [357](#L357) | // Serialize values fo checkbox field. |
| [358](#L358) | $single\_field[ $key ] = ( json\_decode( $single\_field[ $key ] ) !== null ) ? json\_decode( $single\_field[ $key ] ) : sanitize\_text\_field( $single\_field[ $key ] ); |
| [359](#L359) | } |
| [360](#L360) | break; |
| [361](#L361) | case 'wysiwyg': |
| [362](#L362) | if ( isset( $single\_field[ $key ] ) ) { |
| [363](#L363) | $single\_field[ $key ] = sanitize\_text\_field( htmlentities( $single\_field[ $key ] ) ); |
| [364](#L364) | } else { |
| [365](#L365) | $single\_field[ $key ] = ''; |
| [366](#L366) | } |
| [367](#L367) | break; |
| [368](#L368) | default: |
| [369](#L369) | $single\_field[ $key ] = isset( $single\_field[ $key ] ) ? $single\_field[ $key ] : ''; |
| [370](#L370) | break; |
| [371](#L371) | } |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | /\*\* |
| [375](#L375) | \* Action hook to perform validation of edit profile form. |
| [376](#L376) | \* |
| [377](#L377) | \* @param array $profile User profile data. |
| [378](#L378) | \* @param array $form\_data The form data. |
| [379](#L379) | \* @param int $form\_id The form ID. |
| [380](#L380) | \*/ |
| [381](#L381) | do\_action( 'user\_registration\_validate\_profile\_update', $profile, $form\_data, $form\_id ); |
| [382](#L382) |  |
| [383](#L383) | /\*\* |
| [384](#L384) | \* Action after the save profile validation. |
| [385](#L385) | \* |
| [386](#L386) | \* @param int The user ID. |
| [387](#L387) | \* @param array The profile data. |
| [388](#L388) | \*/ |
| [389](#L389) | do\_action( 'user\_registration\_after\_save\_profile\_validation', $user\_id, $profile ); |
| [390](#L390) |  |
| [391](#L391) | if ( 0 === ur\_notice\_count( 'error' ) ) { |
| [392](#L392) | $user\_data = array(); |
| [393](#L393) | /\*\* |
| [394](#L394) | \* Filter to modify the email change confirmation. |
| [395](#L395) | \* Default vallue is 'true'. |
| [396](#L396) | \*/ |
| [397](#L397) | $is\_email\_change\_confirmation = (bool) apply\_filters( 'user\_registration\_email\_change\_confirmation', true ); |
| [398](#L398) | $email\_updated                = false; |
| [399](#L399) | $pending\_email                = ''; |
| [400](#L400) | $user                         = wp\_get\_current\_user(); |
| [401](#L401) | /\*\* |
| [402](#L402) | \* Filter to modify the field settings. |
| [403](#L403) | \* |
| [404](#L404) | \* The dynamic portion of the hook name, $value->field\_key. |
| [405](#L405) | \* |
| [406](#L406) | \* @param array $value The field value. |
| [407](#L407) | \*/ |
| [408](#L408) | $profile = apply\_filters( 'user\_registration\_before\_save\_profile\_details', $profile, $user\_id, $form\_id ); |
| [409](#L409) |  |
| [410](#L410) | foreach ( $profile as $key => $field ) { |
| [411](#L411) | $new\_key = str\_replace( 'user\_registration\_', '', $key ); |
| [412](#L412) |  |
| [413](#L413) | if ( $is\_email\_change\_confirmation && 'user\_email' === $new\_key ) { |
| [414](#L414) | if ( $user ) { |
| [415](#L415) | if ( sanitize\_email( wp\_unslash( $single\_field[ $key ] ) ) !== $user->user\_email ) { |
| [416](#L416) | $email\_updated = true; |
| [417](#L417) | $pending\_email = sanitize\_email( wp\_unslash( $single\_field[ $key ] ) ); |
| [418](#L418) | } |
| [419](#L419) | continue; |
| [420](#L420) | } |
| [421](#L421) | } |
| [422](#L422) |  |
| [423](#L423) | if ( in\_array( $new\_key, ur\_get\_user\_table\_fields() ) ) { |
| [424](#L424) | if ( 'display\_name' === $new\_key ) { |
| [425](#L425) | $user\_data['display\_name'] = sanitize\_text\_field( ( $single\_field[ $key ] ) ); |
| [426](#L426) | } else { |
| [427](#L427) | $user\_data[ $new\_key ] = sanitize\_text\_field( $single\_field[ $key ] ); |
| [428](#L428) | } |
| [429](#L429) | } else { |
| [430](#L430) | $update\_key = $key; |
| [431](#L431) |  |
| [432](#L432) | if ( in\_array( $new\_key, ur\_get\_registered\_user\_meta\_fields() ) ) { |
| [433](#L433) | $update\_key = str\_replace( 'user\_', '', $new\_key ); |
| [434](#L434) | } |
| [435](#L435) | $disabled = isset( $field['custom\_attributes']['disabled'] ) ? $field['custom\_attributes']['disabled'] : ''; |
| [436](#L436) |  |
| [437](#L437) | if ( 'disabled' !== $disabled ) { |
| [438](#L438) | update\_user\_meta( $user\_id, $update\_key, $single\_field[ $key ] ); |
| [439](#L439) | } |
| [440](#L440) | } |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | if ( count( $user\_data ) > 0 ) { |
| [444](#L444) | $user\_data['ID'] = get\_current\_user\_id(); |
| [445](#L445) | wp\_update\_user( $user\_data ); |
| [446](#L446) | } |
| [447](#L447) | /\*\* |
| [448](#L448) | \* Filter to modify the profile update success message. |
| [449](#L449) | \*/ |
| [450](#L450) | $message = apply\_filters( 'user\_registration\_profile\_update\_success\_message', \_\_( 'User profile updated successfully.', 'user-registration' ) ); |
| [451](#L451) | /\*\* |
| [452](#L452) | \* Action to modify the save profile details. |
| [453](#L453) | \* |
| [454](#L454) | \* @param int $user\_id The user ID. |
| [455](#L455) | \* @param int $form\_id The form ID. |
| [456](#L456) | \*/ |
| [457](#L457) | do\_action( 'user\_registration\_save\_profile\_details', $user\_id, $form\_id ); |
| [458](#L458) |  |
| [459](#L459) | $profile\_pic\_id = get\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url' ); |
| [460](#L460) | $profile\_pic\_id = ! empty( $profile\_pic\_id ) ? $profile\_pic\_id[0] : ''; |
| [461](#L461) | $response       = array( |
| [462](#L462) | 'message'        => $message, |
| [463](#L463) | 'profile\_pic\_id' => $profile\_pic\_id, |
| [464](#L464) | ); |
| [465](#L465) |  |
| [466](#L466) | if ( $email\_updated ) { |
| [467](#L467) | UR\_Form\_Handler::send\_confirmation\_email( $user, $pending\_email, $form\_id ); |
| [468](#L468) | $response['oldUserEmail'] = $user->user\_email; |
| [469](#L469) | /\* translators: %s : user email \*/ |
| [470](#L470) | $response['userEmailUpdateMessage'] = sprintf( \_\_( 'Your email address has not been updated yet. Please check your inbox at <strong>%s</strong> for a confirmation email.', 'user-registration' ), $pending\_email ); |
| [471](#L471) |  |
| [472](#L472) | $cancel\_url = esc\_url( |
| [473](#L473) | add\_query\_arg( |
| [474](#L474) | array( |
| [475](#L475) | 'cancel\_email\_change' => $user\_id, |
| [476](#L476) | '\_wpnonce'            => wp\_create\_nonce( 'cancel\_email\_change\_nonce' ), |
| [477](#L477) | ), |
| [478](#L478) | ur\_get\_my\_account\_url() . get\_option( 'user\_registration\_myaccount\_edit\_profile\_endpoint', 'edit-profile' ) |
| [479](#L479) | ) |
| [480](#L480) | ); |
| [481](#L481) |  |
| [482](#L482) | $response['userEmailPendingMessage'] = sprintf( |
| [483](#L483) | /\* translators: %s - Email Change Pending Message. \*/ |
| [484](#L484) | '<div class="email-updated inline"><p>%s</p></div>', |
| [485](#L485) | sprintf( |
| [486](#L486) | /\* translators: 1: Pending email message 2: Cancel Link \*/ |
| [487](#L487) | \_\_( 'There is a pending change of your email to <code>%1$s</code>. <a href="%2$s">Cancel</a>', 'user-registration' ), |
| [488](#L488) | $pending\_email, |
| [489](#L489) | $cancel\_url |
| [490](#L490) | ) |
| [491](#L491) | ); |
| [492](#L492) | } |
| [493](#L493) | /\*\* |
| [494](#L494) | \* Filter to modify profile update response. |
| [495](#L495) | \* |
| [496](#L496) | \* @param array $response The profile update response. |
| [497](#L497) | \*/ |
| [498](#L498) | $response = apply\_filters( 'user\_registration\_profile\_update\_response', $response ); |
| [499](#L499) |  |
| [500](#L500) | wp\_send\_json\_success( |
| [501](#L501) | $response |
| [502](#L502) | ); |
| [503](#L503) | } else { |
| [504](#L504) | $errors = ur\_get\_notices( 'error' ); |
| [505](#L505) | ur\_clear\_notices(); |
| [506](#L506) | wp\_send\_json\_error( |
| [507](#L507) | array( |
| [508](#L508) | 'message' => $errors, |
| [509](#L509) | ) |
| [510](#L510) | ); |
| [511](#L511) | } |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | /\*\* |
| [515](#L515) | \* Get Post data on frontend form submit |
| [516](#L516) | \* |
| [517](#L517) | \* @return void |
| [518](#L518) | \*/ |
| [519](#L519) | public static function profile\_pic\_upload() { |
| [520](#L520) |  |
| [521](#L521) | check\_ajax\_referer( 'user\_registration\_profile\_picture\_upload\_nonce', 'security' ); |
| [522](#L522) |  |
| [523](#L523) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [524](#L524) |  |
| [525](#L525) | $flag = wp\_verify\_nonce( $nonce, 'user\_registration\_profile\_picture\_upload\_nonce' ); |
| [526](#L526) |  |
| [527](#L527) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [528](#L528) | wp\_send\_json\_error( |
| [529](#L529) | array( |
| [530](#L530) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [531](#L531) | ) |
| [532](#L532) | ); |
| [533](#L533) | } |
| [534](#L534) | $user\_id = get\_current\_user\_id(); |
| [535](#L535) |  |
| [536](#L536) | if ( $user\_id <= 0 ) { |
| [537](#L537) | return; |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) | if ( isset( $\_FILES['file']['size'] ) && wp\_unslash( sanitize\_key( $\_FILES['file']['size'] ) ) ) { |
| [541](#L541) | if ( ! function\_exists( 'wp\_handle\_upload' ) ) { |
| [542](#L542) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [543](#L543) | } |
| [544](#L544) |  |
| [545](#L545) | $upload = isset( $\_FILES['file'] ) ? $\_FILES['file'] : array(); // phpcs:ignore |
| [546](#L546) |  |
| [547](#L547) | // valid extension for image. |
| [548](#L548) | $valid\_extensions = 'image/jpeg,image/gif,image/png'; |
| [549](#L549) | $form\_id          = ur\_get\_form\_id\_by\_userid( $user\_id ); |
| [550](#L550) |  |
| [551](#L551) | if ( class\_exists( 'UserRegistrationAdvancedFields' ) ) { |
| [552](#L552) | $field\_data       = ur\_get\_field\_data\_by\_field\_name( $form\_id, 'profile\_pic\_url' ); |
| [553](#L553) | $valid\_extensions = isset( $field\_data['advance\_setting']->valid\_file\_type ) ? implode( ', ', $field\_data['advance\_setting']->valid\_file\_type ) : $valid\_extensions; |
| [554](#L554) | } |
| [555](#L555) |  |
| [556](#L556) | $valid\_extension\_type = explode( ',', $valid\_extensions ); |
| [557](#L557) | $valid\_ext            = array(); |
| [558](#L558) |  |
| [559](#L559) | foreach ( $valid\_extension\_type as $key => $value ) { |
| [560](#L560) | $image\_extension   = explode( '/', $value ); |
| [561](#L561) | $valid\_ext[ $key ] = isset( $image\_extension[1] ) ? $image\_extension[1] : ''; |
| [562](#L562) |  |
| [563](#L563) | if ( 'jpeg' === $valid\_ext[ $key ] ) { |
| [564](#L564) | $index               = count( $valid\_extension\_type ); |
| [565](#L565) | $valid\_ext[ $index ] = 'jpg'; |
| [566](#L566) | } |
| [567](#L567) | } |
| [568](#L568) |  |
| [569](#L569) | $src\_file\_name  = isset( $upload['name'] ) ? $upload['name'] : ''; |
| [570](#L570) | $file\_extension = strtolower( pathinfo( $src\_file\_name, PATHINFO\_EXTENSION ) ); |
| [571](#L571) | $file\_mime\_type = isset( $upload['tmp\_name'] ) ? mime\_content\_type( $upload['tmp\_name'] ) : ''; |
| [572](#L572) |  |
| [573](#L573) | if ( ! in\_array( $file\_mime\_type, $valid\_extension\_type ) ) { |
| [574](#L574) | wp\_send\_json\_error( |
| [575](#L575) | array( |
| [576](#L576) | 'message' => \_\_( 'Invalid file type, please contact with site administrator.', 'user-registration' ), |
| [577](#L577) | ) |
| [578](#L578) | ); |
| [579](#L579) | } |
| [580](#L580) | // Validates if the uploaded file has the acceptable extension. |
| [581](#L581) | if ( ! in\_array( $file\_extension, $valid\_ext ) ) { |
| [582](#L582) | wp\_send\_json\_error( |
| [583](#L583) | array( |
| [584](#L584) | 'message' => \_\_( 'Invalid file type, please contact with site administrator.', 'user-registration' ), |
| [585](#L585) | ) |
| [586](#L586) | ); |
| [587](#L587) | } |
| [588](#L588) |  |
| [589](#L589) | $upload\_path = ur\_get\_tmp\_dir(); |
| [590](#L590) |  |
| [591](#L591) | // Checks if the upload directory has the write premission. |
| [592](#L592) | if ( ! wp\_is\_writable( $upload\_path ) ) { |
| [593](#L593) | wp\_send\_json\_error( |
| [594](#L594) | array( |
| [595](#L595) | 'message' => \_\_( 'Upload path permission deny.', 'user-registration' ), |
| [596](#L596) | ) |
| [597](#L597) | ); |
| [598](#L598) | } |
| [599](#L599) | $upload\_path = $upload\_path . '/'; |
| [600](#L600) | $file\_name   = wp\_unique\_filename( $upload\_path, $upload['name'] ); |
| [601](#L601) | $file\_path   = $upload\_path . sanitize\_file\_name( $file\_name ); |
| [602](#L602) | if ( move\_uploaded\_file( $upload['tmp\_name'], $file\_path ) ) { |
| [603](#L603) | $files = array( |
| [604](#L604) | 'file\_name'      => $file\_name, |
| [605](#L605) | 'file\_path'      => $file\_path, |
| [606](#L606) | 'file\_extension' => $file\_extension, |
| [607](#L607) | ); |
| [608](#L608) |  |
| [609](#L609) | $attachment\_id = wp\_rand(); |
| [610](#L610) |  |
| [611](#L611) | ur\_clean\_tmp\_files(); |
| [612](#L612) | $url = UR\_UPLOAD\_URL . 'temp-uploads/' . sanitize\_file\_name( $file\_name ); |
| [613](#L613) | wp\_send\_json\_success( |
| [614](#L614) | array( |
| [615](#L615) | 'attachment\_id' => $attachment\_id, |
| [616](#L616) | 'upload\_files'  => crypt\_the\_string( maybe\_serialize( $files ), 'e' ), |
| [617](#L617) | 'url'           => $url, |
| [618](#L618) | ) |
| [619](#L619) | ); |
| [620](#L620) | } else { |
| [621](#L621) | wp\_send\_json\_error( |
| [622](#L622) | array( |
| [623](#L623) | 'message' => \_\_( 'File cannot be uploaded.', 'user-registration' ), |
| [624](#L624) | ) |
| [625](#L625) | ); |
| [626](#L626) | } |
| [627](#L627) | } elseif ( isset( $\_FILES['file']['error'] ) && UPLOAD\_ERR\_NO\_FILE !== $\_FILES['file']['error'] ) { |
| [628](#L628) | switch ( $\_FILES['file']['error'] ) { |
| [629](#L629) | case UPLOAD\_ERR\_INI\_SIZE: |
| [630](#L630) | wp\_send\_json\_error( |
| [631](#L631) | array( |
| [632](#L632) | 'message' => \_\_( 'File size exceed, please check your file size.', 'user-registration' ), |
| [633](#L633) | ) |
| [634](#L634) | ); |
| [635](#L635) | break; |
| [636](#L636) | default: |
| [637](#L637) | wp\_send\_json\_error( |
| [638](#L638) | array( |
| [639](#L639) | 'message' => \_\_( 'Something went wrong while uploading, please contact your site administrator.', 'user-registration' ), |
| [640](#L640) | ) |
| [641](#L641) | ); |
| [642](#L642) | break; |
| [643](#L643) | } |
| [644](#L644) | } |
| [645](#L645) | } |
| [646](#L646) |  |
| [647](#L647) | /\*\* |
| [648](#L648) | \* Login from Using Ajax |
| [649](#L649) | \*/ |
| [650](#L650) | public static function ajax\_login\_submit() { |
| [651](#L651) |  |
| [652](#L652) | check\_ajax\_referer( 'ur\_login\_form\_save\_nonce', 'security' ); |
| [653](#L653) |  |
| [654](#L654) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [655](#L655) | $flag  = wp\_verify\_nonce( $nonce, 'ur\_login\_form\_save\_nonce' ); |
| [656](#L656) |  |
| [657](#L657) | if ( false === $flag || is\_wp\_error( $flag ) ) { |
| [658](#L658) |  |
| [659](#L659) | wp\_send\_json\_error( |
| [660](#L660) | array( |
| [661](#L661) | 'message' => esc\_html\_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [662](#L662) | ) |
| [663](#L663) | ); |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) | ur\_process\_login( $nonce ); |
| [667](#L667) | } |
| [668](#L668) | /\*\* |
| [669](#L669) | \* Send test email. |
| [670](#L670) | \* |
| [671](#L671) | \* @since 1.9.9 |
| [672](#L672) | \*/ |
| [673](#L673) | public static function send\_test\_email() { |
| [674](#L674) | check\_ajax\_referer( 'test\_email\_nonce', 'nonce' ); |
| [675](#L675) |  |
| [676](#L676) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [677](#L677) | wp\_send\_json\_error( array( 'message' => \_\_( 'You do not have permission to send test email.', 'user-registration' ) ) ); |
| [678](#L678) | wp\_die( -1 ); |
| [679](#L679) | } |
| [680](#L680) | /\*\* |
| [681](#L681) | \* Filter to test mail from name. |
| [682](#L682) | \* Default value is get\_option('user\_registration\_email\_from\_name'). |
| [683](#L683) | \*/ |
| [684](#L684) | $from\_name = apply\_filters( 'wp\_mail\_from\_name', get\_option( 'user\_registration\_email\_from\_name', esc\_attr( get\_bloginfo( 'name', 'display' ) ) ) ); |
| [685](#L685) | /\*\* |
| [686](#L686) | \* Filter to test mail from address. |
| [687](#L687) | \* Default value is get\_option('user\_registration\_email\_from\_address'). |
| [688](#L688) | \*/ |
| [689](#L689) | $sender\_email = apply\_filters( 'wp\_mail\_from', get\_option( 'user\_registration\_email\_from\_address', get\_option( 'admin\_email' ) ) ); |
| [690](#L690) | $email        = sanitize\_email( isset( $\_POST['email'] ) ? wp\_unslash( $\_POST['email'] ) : '' ); // phpcs:ignore WordPress.Security.NonceVerification |
| [691](#L691) | /\* translators: %s - WP mail from name \*/ |
| [692](#L692) | $subject = 'User Registration: ' . sprintf( esc\_html\_\_( 'Test email from %s', 'user-registration' ), $from\_name ); |
| [693](#L693) | $header  = array( |
| [694](#L694) | 'From:' . $from\_name . ' <' . $sender\_email . '>', |
| [695](#L695) | 'Reply-To:' . $sender\_email, |
| [696](#L696) | 'Content-Type:text/html; charset=UTF-8', |
| [697](#L697) | ); |
| [698](#L698) | $message = |
| [699](#L699) | 'Congratulations,<br> |
| [700](#L700) | Your test email has been received successfully.<br> |
| [701](#L701) | We thank you for trying out User Registration and joining our mission to make sure you get your emails delivered.<br> |
| [702](#L702) | Regards,<br> |
| [703](#L703) | User Registration Team'; |
| [704](#L704) |  |
| [705](#L705) | $status = wp\_mail( $email, $subject, $message, $header ); |
| [706](#L706) |  |
| [707](#L707) | if ( $status ) { |
| [708](#L708) | wp\_send\_json\_success( array( 'message' => \_\_( 'Test email was sent successfully! Please check your inbox to make sure it is delivered.', 'user-registration' ) ) ); |
| [709](#L709) | } { |
| [710](#L710) | wp\_send\_json\_error( array( 'message' => \_\_( 'Test email was unsuccessful! Something went wrong.', 'user-registration' ) ) ); |
| [711](#L711) | } |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Locate form. |
| [716](#L716) | \*/ |
| [717](#L717) | public static function locate\_form\_action() { |
| [718](#L718) | global $wpdb; |
| [719](#L719) | try { |
| [720](#L720) | check\_ajax\_referer( 'process-locate-ajax-nonce', 'security' ); |
| [721](#L721) | $id                          = isset( $\_POST['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) : ''; |
| [722](#L722) | $user\_registration\_shortcode = '%[user\_registration\_form id="' . $id . '"%'; |
| [723](#L723) | $form\_id\_shortcode           = '%{"formId":"' . $id . '"%'; |
| [724](#L724) | $pages                       = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$wpdb->prefix}posts WHERE post\_content LIKE %s OR post\_content LIKE %s", $user\_registration\_shortcode, $form\_id\_shortcode ) ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared |
| [725](#L725) | $page\_list                   = array(); |
| [726](#L726) | foreach ( $pages as $page ) { |
| [727](#L727) | if ( '0' === $page->post\_parent ) { |
| [728](#L728) | $page\_title               = $page->post\_title; |
| [729](#L729) | $page\_guid                = $page->guid; |
| [730](#L730) | $page\_list[ $page\_title ] = $page\_guid; |
| [731](#L731) | } |
| [732](#L732) | } |
| [733](#L733) | wp\_send\_json\_success( $page\_list ); |
| [734](#L734) | } catch ( Exception $e ) { |
| [735](#L735) | wp\_send\_json\_error( |
| [736](#L736) | array( |
| [737](#L737) | 'message' => $e->getMessage(), |
| [738](#L738) | ) |
| [739](#L739) | ); |
| [740](#L740) | } |
| [741](#L741) | } |
| [742](#L742) |  |
| [743](#L743) | /\*\* |
| [744](#L744) | \* User input dropped function |
| [745](#L745) | \* |
| [746](#L746) | \* @throws Exception Throws If Empty Form Data. |
| [747](#L747) | \*/ |
| [748](#L748) | public static function user\_input\_dropped() { |
| [749](#L749) |  |
| [750](#L750) | try { |
| [751](#L751) | check\_ajax\_referer( 'user\_input\_dropped\_nonce', 'security' ); |
| [752](#L752) |  |
| [753](#L753) | $form\_field\_id = ( isset( $\_POST['form\_field\_id'] ) ) ? $\_POST['form\_field\_id'] : null; //phpcs:ignore |
| [754](#L754) |  |
| [755](#L755) | if ( null == $form\_field\_id || '' == $form\_field\_id ) { |
| [756](#L756) | throw new Exception( 'Empty form data' ); |
| [757](#L757) | } |
| [758](#L758) |  |
| [759](#L759) | $class\_file\_name = str\_replace( 'user\_registration\_', '', $form\_field\_id ); |
| [760](#L760) | $class\_name      = ur\_load\_form\_field\_class( $class\_file\_name ); |
| [761](#L761) |  |
| [762](#L762) | if ( empty( $class\_name ) ) { |
| [763](#L763) | throw new Exception( 'class not exists' ); |
| [764](#L764) | } |
| [765](#L765) |  |
| [766](#L766) | $templates = $class\_name::get\_instance()->get\_admin\_template(); |
| [767](#L767) |  |
| [768](#L768) | wp\_send\_json\_success( $templates ); |
| [769](#L769) | } catch ( Exception $e ) { |
| [770](#L770) | wp\_send\_json\_error( |
| [771](#L771) | array( |
| [772](#L772) | 'error' => $e->getMessage(), |
| [773](#L773) | ) |
| [774](#L774) | ); |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) |  |
| [778](#L778) | /\*\* |
| [779](#L779) | \* Import Form ajax. |
| [780](#L780) | \* |
| [781](#L781) | \* @throws Exception Post data mot set. |
| [782](#L782) | \*/ |
| [783](#L783) | public static function import\_form\_action() { |
| [784](#L784) | try { |
| [785](#L785) | check\_ajax\_referer( 'ur\_import\_form\_save\_nonce', 'security' ); |
| [786](#L786) | UR\_Admin\_Import\_Export\_Forms::import\_form(); |
| [787](#L787) | } catch ( Exception $e ) { |
| [788](#L788) | wp\_send\_json\_error( |
| [789](#L789) | array( |
| [790](#L790) | 'message' => $e->getMessage(), |
| [791](#L791) | ) |
| [792](#L792) | ); |
| [793](#L793) | } |
| [794](#L794) | } |
| [795](#L795) |  |
| [796](#L796) | /\*\* |
| [797](#L797) | \* Form save from backend |
| [798](#L798) | \* |
| [799](#L799) | \* @return void |
| [800](#L800) | \* |
| [801](#L801) | \* @throws Exception Throw if any issue while saving form data. |
| [802](#L802) | \*/ |
| [803](#L803) | public static function form\_save\_action() { |
| [804](#L804) |  |
| [805](#L805) | try { |
| [806](#L806) | check\_ajax\_referer( 'ur\_form\_save\_nonce', 'security' ); |
| [807](#L807) |  |
| [808](#L808) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [809](#L809) | throw new Exception( \_\_( "You don't have enough permission to perform this task. Please contact the Administrator.", 'user-registration' ) ); |
| [810](#L810) | } |
| [811](#L811) |  |
| [812](#L812) | if ( ! isset( $\_POST['data'] ) || ( isset( $\_POST['data'] ) && gettype( wp\_unslash( $\_POST['data'] ) ) != 'array' ) ) { //phpcs:ignore |
| [813](#L813) | throw new Exception( \_\_( 'post data not set', 'user-registration' ) ); |
| [814](#L814) | } elseif ( ! isset( $\_POST['data']['form\_data'] ) |
| [815](#L815) | || ( isset( $\_POST['data']['form\_data'] ) |
| [816](#L816) | && gettype( wp\_unslash( $\_POST['data']['form\_data'] ) ) != 'string' ) ) { //phpcs:ignore |
| [817](#L817) |  |
| [818](#L818) | throw new Exception( \_\_( 'post data not set', 'user-registration' ) ); |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | $post\_data = json\_decode( wp\_unslash( $\_POST['data']['form\_data'] ) ); //phpcs:ignore |
| [822](#L822) | self::sweep\_array( $post\_data ); |
| [823](#L823) |  |
| [824](#L824) | if ( isset( self::$failed\_key\_value['value'] ) && '' != self::$failed\_key\_value['value'] ) { |
| [825](#L825) | if ( in\_array( self::$failed\_key\_value['value'], self::$field\_key\_aray ) ) { |
| [826](#L826) | throw new Exception( sprintf( "Could not save form. Duplicate field name <span style='color:red'>%s</span>", self::$failed\_key\_value['value'] ) ); |
| [827](#L827) | } |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | if ( false === self::$is\_field\_key\_pass ) { |
| [831](#L831) | throw new Exception( \_\_( 'Could not save form. Invalid field name. Please check all field name', 'user-registration' ) ); |
| [832](#L832) | } |
| [833](#L833) |  |
| [834](#L834) | $required\_fields = array( |
| [835](#L835) | 'user\_email', |
| [836](#L836) | 'user\_pass', |
| [837](#L837) | ); |
| [838](#L838) |  |
| [839](#L839) | $contains\_search = count( array\_intersect( $required\_fields, self::$field\_key\_aray ) ) == count( $required\_fields ); |
| [840](#L840) |  |
| [841](#L841) | if ( false === $contains\_search ) { |
| [842](#L842) | throw  new Exception( \_\_( 'Could not save form, ' . join( ', ', $required\_fields ) . ' fields are required.! ', 'user-registration' ) ); //phpcs:ignore |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | // check captcha configuration before form save action. |
| [846](#L846) | if ( isset( $\_POST['data']['form\_setting\_data'] ) ) { |
| [847](#L847) | foreach ( wp\_unslash( $\_POST['data']['form\_setting\_data'] )  as $setting\_data ) { //phpcs:ignore |
| [848](#L848) | if ( 'user\_registration\_form\_setting\_enable\_recaptcha\_support' === $setting\_data['name'] && ur\_string\_to\_bool( $setting\_data['value'] ) && ! ur\_check\_captch\_keys() ) { |
| [849](#L849) | throw new Exception( |
| [850](#L850) | sprintf( |
| [851](#L851) | /\* translators: %s - Integration tab url \*/ |
| [852](#L852) | '%s <a href="%s" class="ur-captcha-error" target="\_blank">here</a> to add them and save your form.', |
| [853](#L853) | esc\_html\_\_( 'Seems like you are trying to enable the captcha feature, but the captcha keys are empty. Please click', 'user-registration' ), |
| [854](#L854) | esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=captcha' ) ) ) ); //phpcs:ignore |
| [855](#L855) | } |
| [856](#L856) | } |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | /\*\* |
| [860](#L860) | \* Perform validation before form save from form builder. |
| [861](#L861) | \*/ |
| [862](#L862) | do\_action( 'user\_registration\_admin\_backend\_validation\_before\_form\_save' ); |
| [863](#L863) |  |
| [864](#L864) | $form\_name    = sanitize\_text\_field( $\_POST['data']['form\_name'] ); //phpcs:ignore |
| [865](#L865) | $form\_row\_ids = sanitize\_text\_field( $\_POST['data']['form\_row\_ids'] ); //phpcs:ignore |
| [866](#L866) | $form\_id      = sanitize\_text\_field( $\_POST['data']['form\_id'] ); //phpcs:ignore |
| [867](#L867) |  |
| [868](#L868) | $post\_data = array( |
| [869](#L869) | 'post\_type'      => 'user\_registration', |
| [870](#L870) | 'post\_title'     => sanitize\_text\_field( $form\_name ), |
| [871](#L871) | 'post\_content'   => wp\_json\_encode( $post\_data, JSON\_UNESCAPED\_UNICODE | JSON\_UNESCAPED\_SLASHES ), |
| [872](#L872) | 'post\_status'    => 'publish', |
| [873](#L873) | 'comment\_status' => 'closed',   // if you prefer. |
| [874](#L874) | 'ping\_status'    => 'closed',      // if you prefer. |
| [875](#L875) | ); |
| [876](#L876) |  |
| [877](#L877) | if ( $form\_id > 0 && is\_numeric( $form\_id ) ) { |
| [878](#L878) | $post\_data['ID'] = $form\_id; |
| [879](#L879) | } |
| [880](#L880) |  |
| [881](#L881) | remove\_filter( 'content\_save\_pre', 'wp\_targeted\_link\_rel' ); |
| [882](#L882) |  |
| [883](#L883) | $post\_id = wp\_insert\_post( wp\_slash( $post\_data ) ); |
| [884](#L884) |  |
| [885](#L885) | if ( $post\_id > 0 ) { |
| [886](#L886) | $\_POST['data']['form\_id'] = $post\_id; // Form id for new form. |
| [887](#L887) |  |
| [888](#L888) | $post\_data\_setting = isset( $\_POST['data']['form\_setting\_data'] ) ? $\_POST['data']['form\_setting\_data'] : array(); //phpcs:ignore |
| [889](#L889) | ur\_update\_form\_settings( $post\_data\_setting, $post\_id ); |
| [890](#L890) |  |
| [891](#L891) | // Form row\_id save. |
| [892](#L892) | update\_post\_meta( $form\_id, 'user\_registration\_form\_row\_ids', $form\_row\_ids ); |
| [893](#L893) | } |
| [894](#L894) | /\*\* |
| [895](#L895) | \* Action after form setting save. |
| [896](#L896) | \* Default is the $\_POST['data']. |
| [897](#L897) | \*/ |
| [898](#L898) | do\_action( 'user\_registration\_after\_form\_settings\_save', wp\_unslash( $\_POST['data'] ) ); //phpcs:ignore |
| [899](#L899) |  |
| [900](#L900) | wp\_send\_json\_success( |
| [901](#L901) | array( |
| [902](#L902) | 'data'    => $post\_data, |
| [903](#L903) | 'post\_id' => $post\_id, |
| [904](#L904) | ) |
| [905](#L905) | ); |
| [906](#L906) | } catch ( Exception $e ) { |
| [907](#L907) | wp\_send\_json\_error( |
| [908](#L908) | array( |
| [909](#L909) | 'message' => $e->getMessage(), |
| [910](#L910) | ) |
| [911](#L911) | ); |
| [912](#L912) | }// End try(). |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | /\*\* |
| [916](#L916) | \* Dashboard Widget data. |
| [917](#L917) | \* |
| [918](#L918) | \* @since 1.5.8 |
| [919](#L919) | \*/ |
| [920](#L920) | public static function dashboard\_widget() { |
| [921](#L921) |  |
| [922](#L922) | check\_ajax\_referer( 'dashboard-widget', 'security' ); |
| [923](#L923) |  |
| [924](#L924) | $form\_id = isset( $\_POST['form\_id'] ) ? wp\_unslash( absint( $\_POST['form\_id'] ) ) : 0; |
| [925](#L925) |  |
| [926](#L926) | $user\_report = $form\_id ? ur\_get\_user\_report( $form\_id ) : array(); |
| [927](#L927) | $forms       = ! $form\_id ? ur\_get\_all\_user\_registration\_form() : array(); |
| [928](#L928) |  |
| [929](#L929) | wp\_send\_json( |
| [930](#L930) | array( |
| [931](#L931) | 'user\_report' => $user\_report, |
| [932](#L932) | 'forms'       => $forms, |
| [933](#L933) | ) |
| [934](#L934) | ); // WPCS: XSS OK. |
| [935](#L935) | } |
| [936](#L936) |  |
| [937](#L937) | /\*\* |
| [938](#L938) | \* Checks if the string passes the regex |
| [939](#L939) | \* |
| [940](#L940) | \* @param  string $value Value. |
| [941](#L941) | \* @return boolean |
| [942](#L942) | \*/ |
| [943](#L943) | private static function is\_regex\_pass( $value ) { |
| [944](#L944) |  |
| [945](#L945) | $field\_regex = "/[a-zA-Z\_\x7f-\xff][a-zA-Z0-9\_\x7f-\xff]\*/"; |
| [946](#L946) |  |
| [947](#L947) | if ( preg\_match( $field\_regex, $value, $match ) ) : |
| [948](#L948) | if ( null !== $match && count( $match ) == 1 && $match[0] === $value ) { |
| [949](#L949) | return true; |
| [950](#L950) | } |
| [951](#L951) | endif; |
| [952](#L952) |  |
| [953](#L953) | return false; |
| [954](#L954) | } |
| [955](#L955) |  |
| [956](#L956) | /\*\* |
| [957](#L957) | \* Sanitize values of form field in backend |
| [958](#L958) | \* |
| [959](#L959) | \* @param array $array Array. |
| [960](#L960) | \*/ |
| [961](#L961) | public static function sweep\_array( &$array ) { |
| [962](#L962) |  |
| [963](#L963) | foreach ( $array as $key => &$value ) { |
| [964](#L964) | if ( 'field\_key' === $key ) { |
| [965](#L965) | $field\_key = $value; |
| [966](#L966) | } |
| [967](#L967) |  |
| [968](#L968) | if ( isset( $field\_key ) && 'checkbox' === $field\_key ) { |
| [969](#L969) | if ( gettype( $value ) == 'object' ) { |
| [970](#L970) | if ( isset( $value->options ) && is\_array( $value->options ) && ! empty( $value->options ) ) { |
| [971](#L971) | $sanitized\_options = array(); |
| [972](#L972) | $allowed\_tags      = array( |
| [973](#L973) | array(), |
| [974](#L974) | 'a' => array( |
| [975](#L975) | 'href'      => true, |
| [976](#L976) | 'title'     => true, |
| [977](#L977) | 'target'    => true, |
| [978](#L978) | 'download'  => true, |
| [979](#L979) | 'rel'       => true, |
| [980](#L980) | 'hreflang'  => true, |
| [981](#L981) | 'type'      => true, |
| [982](#L982) | 'name'      => true, |
| [983](#L983) | 'accesskey' => true, |
| [984](#L984) | 'tabindex'  => true, |
| [985](#L985) | ), |
| [986](#L986) | ); |
| [987](#L987) |  |
| [988](#L988) | foreach ( $value->options as $index => $option\_value ) { |
| [989](#L989) | $option\_value = str\_replace( '"', "'", $option\_value ); |
| [990](#L990) | $option\_value = wp\_kses( trim( $option\_value ), $allowed\_tags ); |
| [991](#L991) |  |
| [992](#L992) | // Check if the option\_value contains an open <a> tag but not a closing </a> tag. |
| [993](#L993) | if ( preg\_match( '/<a\s[^>]\*>/i', $option\_value ) && ! preg\_match( '/<\/a>/i', $option\_value ) ) { |
| [994](#L994) | // Add a closing </a> tag to the end of the option\_value. |
| [995](#L995) | $option\_value .= '</a>'; |
| [996](#L996) | } |
| [997](#L997) |  |
| [998](#L998) | $sanitized\_options [] = $option\_value; |
| [999](#L999) | } |
| [1000](#L1000) |  |
| [1001](#L1001) | $value->options = $sanitized\_options; |
| [1002](#L1002) | } |
| [1003](#L1003) | } |
| [1004](#L1004) | } elseif ( is\_array( $value ) || gettype( $value ) === 'object' ) { |
| [1005](#L1005) | if ( isset( $value->field\_key ) ) { |
| [1006](#L1006) | /\*\* |
| [1007](#L1007) | \* Filter to modify the field settings. |
| [1008](#L1008) | \* |
| [1009](#L1009) | \* The dynamic portion of the hook name, $value->field\_key. |
| [1010](#L1010) | \* |
| [1011](#L1011) | \* @param array $value The field value. |
| [1012](#L1012) | \*/ |
| [1013](#L1013) | $value = apply\_filters( 'user\_registration\_field\_setting\_' . $value->field\_key, $value ); |
| [1014](#L1014) | } |
| [1015](#L1015) | self::sweep\_array( $value ); |
| [1016](#L1016) | } else { |
| [1017](#L1017) | if ( 'field\_name' === $key ) { |
| [1018](#L1018) | $regex\_status = self::is\_regex\_pass( $value ); |
| [1019](#L1019) |  |
| [1020](#L1020) | if ( ! $regex\_status || in\_array( $value, self::$field\_key\_aray ) ) { |
| [1021](#L1021) | self::$is\_field\_key\_pass = false; |
| [1022](#L1022) | self::$failed\_key\_value  = array( |
| [1023](#L1023) | 'key'   => $key, |
| [1024](#L1024) | 'value' => $value, |
| [1025](#L1025) | ); |
| [1026](#L1026) |  |
| [1027](#L1027) | return; |
| [1028](#L1028) | } |
| [1029](#L1029) | array\_push( self::$field\_key\_aray, $value ); |
| [1030](#L1030) | } |
| [1031](#L1031) | if ( 'description' === $key ) { |
| [1032](#L1032) | $value = str\_replace( '"', "'", $value ); |
| [1033](#L1033) | $value = wp\_kses( |
| [1034](#L1034) | $value, |
| [1035](#L1035) | array( |
| [1036](#L1036) | 'a'          => array( |
| [1037](#L1037) | 'href'   => array(), |
| [1038](#L1038) | 'title'  => array(), |
| [1039](#L1039) | 'target' => array(), |
| [1040](#L1040) | ), |
| [1041](#L1041) | 'br'         => array(), |
| [1042](#L1042) | 'em'         => array(), |
| [1043](#L1043) | 'strong'     => array(), |
| [1044](#L1044) | 'u'          => array(), |
| [1045](#L1045) | 'i'          => array(), |
| [1046](#L1046) | 'q'          => array(), |
| [1047](#L1047) | 'b'          => array(), |
| [1048](#L1048) | 'ul'         => array(), |
| [1049](#L1049) | 'ol'         => array(), |
| [1050](#L1050) | 'li'         => array(), |
| [1051](#L1051) | 'hr'         => array(), |
| [1052](#L1052) | 'blockquote' => array(), |
| [1053](#L1053) | 'del'        => array(), |
| [1054](#L1054) | 'strike'     => array(), |
| [1055](#L1055) | 'code'       => array(), |
| [1056](#L1056) | 'div'        => array(), |
| [1057](#L1057) | 'span'       => array(), |
| [1058](#L1058) | 'p'          => array(), |
| [1059](#L1059) | 'h1'         => array(), |
| [1060](#L1060) | 'h2'         => array(), |
| [1061](#L1061) | 'h3'         => array(), |
| [1062](#L1062) | 'h4'         => array(), |
| [1063](#L1063) | 'h5'         => array(), |
| [1064](#L1064) | 'h6'         => array(), |
| [1065](#L1065) | ) |
| [1066](#L1066) | ); |
| [1067](#L1067) | } elseif ( 'html' === $key ) { |
| [1068](#L1068) | if ( ! current\_user\_can( 'unfiltered\_html' ) ) { |
| [1069](#L1069) | $value = wp\_kses\_post( $value ); |
| [1070](#L1070) | } |
| [1071](#L1071) | } else { |
| [1072](#L1072) | $value = sanitize\_text\_field( $value ); |
| [1073](#L1073) | } |
| [1074](#L1074) | } |
| [1075](#L1075) | } |
| [1076](#L1076) | } |
| [1077](#L1077) |  |
| [1078](#L1078) | /\*\* |
| [1079](#L1079) | \* Triggered when clicking the rating footer. |
| [1080](#L1080) | \* |
| [1081](#L1081) | \* @since 1.1.2 |
| [1082](#L1082) | \*/ |
| [1083](#L1083) | public static function rated() { |
| [1084](#L1084) | if ( ! current\_user\_can( 'manage\_user\_registration' ) ) { |
| [1085](#L1085) | wp\_die( - 1 ); |
| [1086](#L1086) | } |
| [1087](#L1087) | update\_option( 'user\_registration\_admin\_footer\_text\_rated', 1 ); |
| [1088](#L1088) | wp\_die(); |
| [1089](#L1089) | } |
| [1090](#L1090) |  |
| [1091](#L1091) | /\*\* |
| [1092](#L1092) | \* Dismiss user registration notices. |
| [1093](#L1093) | \* |
| [1094](#L1094) | \* @since 1.5.8 |
| [1095](#L1095) | \* |
| [1096](#L1096) | \* @return void |
| [1097](#L1097) | \*\*/ |
| [1098](#L1098) | public static function dismiss\_notice() { |
| [1099](#L1099) | $notice\_type = isset( $\_POST['notice\_type'] ) ? wp\_unslash( sanitize\_key( $\_POST['notice\_type'] ) ) : '';   // phpcs:ignore WordPress.Security.NonceVerification |
| [1100](#L1100) | check\_admin\_referer( $notice\_type . '-nonce', 'security' ); |
| [1101](#L1101) |  |
| [1102](#L1102) | if ( ! empty( $\_POST['dismissed'] ) ) { |
| [1103](#L1103) | if ( ! empty( $\_POST['dismiss\_forever'] ) && ur\_string\_to\_bool( sanitize\_text\_field( wp\_unslash( $\_POST['dismiss\_forever'] ) ) ) ) { |
| [1104](#L1104) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed', true ); |
| [1105](#L1105) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed\_temporarily', '' ); |
| [1106](#L1106) | } else { |
| [1107](#L1107) | update\_option( 'user\_registration\_' . $notice\_type . '\_notice\_dismissed\_temporarily', current\_time( 'Y-m-d' ) ); |
| [1108](#L1108) | } |
| [1109](#L1109) | } |
| [1110](#L1110) | } |
| [1111](#L1111) |  |
| [1112](#L1112) | /\*\* |
| [1113](#L1113) | \* Remove profile picture ajax method. |
| [1114](#L1114) | \*/ |
| [1115](#L1115) | public static function profile\_pic\_remove() { |
| [1116](#L1116) | check\_ajax\_referer( 'user\_registration\_profile\_picture\_remove\_nonce', 'security' ); |
| [1117](#L1117) | $nonce = isset( $\_REQUEST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_REQUEST['security'] ) ) : false; |
| [1118](#L1118) |  |
| [1119](#L1119) | $flag = wp\_verify\_nonce( $nonce, 'user\_registration\_profile\_picture\_remove\_nonce' ); |
| [1120](#L1120) |  |
| [1121](#L1121) | if ( true != $flag || is\_wp\_error( $flag ) ) { |
| [1122](#L1122) | wp\_send\_json\_error( |
| [1123](#L1123) | array( |
| [1124](#L1124) | 'message' => \_\_( 'Nonce error, please reload.', 'user-registration' ), |
| [1125](#L1125) | ) |
| [1126](#L1126) | ); |
| [1127](#L1127) | } |
| [1128](#L1128) |  |
| [1129](#L1129) | $attachment\_id = isset( $\_POST['attachment\_id'] ) ? intval( wp\_unslash( $\_POST['attachment\_id'] ) ) : ''; |
| [1130](#L1130) |  |
| [1131](#L1131) | if ( is\_user\_logged\_in() ) { |
| [1132](#L1132) | $user\_id             = get\_current\_user\_id(); |
| [1133](#L1133) | $user\_profile\_pic\_id = get\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url' ); |
| [1134](#L1134) |  |
| [1135](#L1135) | if ( $user\_profile\_pic\_id == $attachment\_id ) { |
| [1136](#L1136) |  |
| [1137](#L1137) | if ( file\_exists( get\_attached\_file( $attachment\_id ) ) && ! unlink( get\_attached\_file( $attachment\_id ) ) ) { |
| [1138](#L1138) | wp\_send\_json\_error( |
| [1139](#L1139) | array( |
| [1140](#L1140) | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
| [1141](#L1141) | ) |
| [1142](#L1142) | ); |
| [1143](#L1143) | } |
| [1144](#L1144) | update\_user\_meta( $user\_id, 'user\_registration\_profile\_pic\_url', '' ); |
| [1145](#L1145) | } else { |
| [1146](#L1146) | wp\_send\_json\_error( |
| [1147](#L1147) | array( |
| [1148](#L1148) | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
| [1149](#L1149) | ) |
| [1150](#L1150) | ); |
| [1151](#L1151) | } |
| [1152](#L1152) | } else { |
| [1153](#L1153) | wp\_send\_json\_error( |
| [1154](#L1154) | array( |
| [1155](#L1155) | 'message' => esc\_html\_\_( 'File cannot be removed', 'user-registration' ), |
| [1156](#L1156) | ) |
| [1157](#L1157) | ); |
| [1158](#L1158) |  |
| [1159](#L1159) | } |
| [1160](#L1160) |  |
| [1161](#L1161) | wp\_send\_json\_success( |
| [1162](#L1162) | array( |
| [1163](#L1163) | 'message' => \_\_( 'User profile picture removed successfully', 'user-registration' ), |
| [1164](#L1164) | ) |
| [1165](#L1165) | ); |
| [1166](#L1166) | } |
| [1167](#L1167) |  |
| [1168](#L1168) | /\*\* |
| [1169](#L1169) | \* Ajax handler for licence check. |
| [1170](#L1170) | \* |
| [1171](#L1171) | \* @global WP\_Filesystem\_Base $wp\_filesystem Subclass |
| [1172](#L1172) | \*/ |
| [1173](#L1173) | public static function template\_licence\_check() { |
| [1174](#L1174) | check\_ajax\_referer( 'user\_registration\_template\_licence\_check', 'security' ); |
| [1175](#L1175) |  |
| [1176](#L1176) | if ( empty( $\_POST['plan'] ) ) { |
| [1177](#L1177) | wp\_send\_json\_error( |
| [1178](#L1178) | array( |
| [1179](#L1179) | 'plan'         => '', |
| [1180](#L1180) | 'errorCode'    => 'no\_plan\_specified', |
| [1181](#L1181) | 'errorMessage' => esc\_html\_\_( 'No Plan specified.', 'user-registration' ), |
| [1182](#L1182) | ) |
| [1183](#L1183) | ); |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | $addons        = array(); |
| [1187](#L1187) | $template\_data = UR\_Admin\_Form\_Templates::get\_template\_data(); |
| [1188](#L1188) | $template\_data = is\_array( $template\_data ) ? $template\_data : array(); |
| [1189](#L1189) | if ( ! empty( $template\_data ) ) { |
| [1190](#L1190) | foreach ( $template\_data as $template ) { |
| [1191](#L1191) | if ( isset( $\_POST['slug'] ) && $template->slug === $\_POST['slug'] && in\_array( trim( $\_POST['plan'] ), $template->plan, true ) ) { |
| [1192](#L1192) | $addons = $template->addons; |
| [1193](#L1193) | } |
| [1194](#L1194) | } |
| [1195](#L1195) | } |
| [1196](#L1196) |  |
| [1197](#L1197) | $output  = '<div class="user-registration-recommend-addons">'; |
| [1198](#L1198) | $output .= '<h3>' . esc\_html\_\_( 'This form template requires the following addons.', 'user-registration' ) . '</h3>'; |
| [1199](#L1199) | $output .= '<table class="plugins-list-table widefat striped">'; |
| [1200](#L1200) | $output .= '<thead><tr><th scope="col" class="manage-column required-plugins" colspan="2">' . esc\_html\_\_( 'Required Addons', 'user-registration' ) . '</th></tr></thead><tbody id="the-list">'; |
| [1201](#L1201) | $output .= '</div>'; |
| [1202](#L1202) |  |
| [1203](#L1203) | $activated = true; |
| [1204](#L1204) |  |
| [1205](#L1205) | foreach ( $addons as $slug => $addon ) { |
| [1206](#L1206) | $plugin = 'user-registration-pro' === $slug ? $slug . '/user-registration.php' : $slug . '/' . $slug . '.php'; |
| [1207](#L1207) |  |
| [1208](#L1208) | if ( is\_plugin\_active( $plugin ) ) { |
| [1209](#L1209) | $class        = 'active'; |
| [1210](#L1210) | $parent\_class = ''; |
| [1211](#L1211) | } elseif ( file\_exists( WP\_PLUGIN\_DIR . '/' . $plugin ) ) { |
| [1212](#L1212) | $class        = 'activate-now'; |
| [1213](#L1213) | $parent\_class = 'inactive'; |
| [1214](#L1214) | $activated    = false; |
| [1215](#L1215) | } else { |
| [1216](#L1216) | $class        = 'install-now'; |
| [1217](#L1217) | $parent\_class = 'inactive'; |
| [1218](#L1218) | $activated    = false; |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | $output .= '<tr class="plugin-card-' . $slug . ' plugin ' . $parent\_class . '" data-slug="' . $slug . '" data-plugin="' . $plugin . '" data-name="' . $addon . '">'; |
| [1222](#L1222) | $output .= '<td class="plugin-name">' . $addon . '</td>'; |
| [1223](#L1223) | $output .= '<td class="plugin-status"><span class="' . esc\_attr( $class ) . '"></span></td>'; |
| [1224](#L1224) | $output .= '</tr>'; |
| [1225](#L1225) | } |
| [1226](#L1226) | $output .= '</tbody></table></div>'; |
| [1227](#L1227) |  |
| [1228](#L1228) | wp\_send\_json\_success( |
| [1229](#L1229) | array( |
| [1230](#L1230) | 'html'     => $output, |
| [1231](#L1231) | 'activate' => $activated, |
| [1232](#L1232) | ) |
| [1233](#L1233) | ); |
| [1234](#L1234) | } |
| [1235](#L1235) |  |
| [1236](#L1236) | /\*\* |
| [1237](#L1237) | \* Check for captcha setup. |
| [1238](#L1238) | \*/ |
| [1239](#L1239) | public static function captcha\_setup\_check() { |
| [1240](#L1240) | check\_ajax\_referer( 'user\_registration\_captcha\_setup\_check', 'security' ); |
| [1241](#L1241) |  |
| [1242](#L1242) | if ( ur\_check\_captch\_keys() ) { |
| [1243](#L1243) | wp\_send\_json\_success( |
| [1244](#L1244) | array( |
| [1245](#L1245) | 'is\_captcha\_setup' => true, |
| [1246](#L1246) | ) |
| [1247](#L1247) | ); |
| [1248](#L1248) | } |
| [1249](#L1249) |  |
| [1250](#L1250) | wp\_send\_json\_error( |
| [1251](#L1251) | array( |
| [1252](#L1252) | 'is\_captcha\_setup'        => false, |
| [1253](#L1253) | 'captcha\_setup\_error\_msg' => sprintf( |
| [1254](#L1254) | /\* translators: %s - Integration tab url \*/ |
| [1255](#L1255) | \_\_( 'Seems like you haven\'t added the reCAPTCHA Keys. <a href="%s" >Add Now.</a>', 'user-registration' ), |
| [1256](#L1256) | esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=captcha' ) ) |
| [1257](#L1257) | ), |
| [1258](#L1258) | ) |
| [1259](#L1259) | ); |
| [1260](#L1260) | } |
| [1261](#L1261) |  |
| [1262](#L1262) | /\*\* |
| [1263](#L1263) | \* Ajax handler for installing a extension. |
| [1264](#L1264) | \* |
| [1265](#L1265) | \* @since 1.2.0 |
| [1266](#L1266) | \* |
| [1267](#L1267) | \* @see Plugin\_Upgrader |
| [1268](#L1268) | \* |
| [1269](#L1269) | \* @global WP\_Filesystem\_Base $wp\_filesystem Subclass |
| [1270](#L1270) | \*/ |
| [1271](#L1271) | public static function install\_extension() { |
| [1272](#L1272) | check\_ajax\_referer( 'updates' ); |
| [1273](#L1273) |  |
| [1274](#L1274) | if ( empty( $\_POST['slug'] ) ) { |
| [1275](#L1275) | wp\_send\_json\_error( |
| [1276](#L1276) | array( |
| [1277](#L1277) | 'slug'         => '', |
| [1278](#L1278) | 'errorCode'    => 'no\_plugin\_specified', |
| [1279](#L1279) | 'errorMessage' => esc\_html\_\_( 'No plugin specified.', 'user-registration' ), |
| [1280](#L1280) | ) |
| [1281](#L1281) | ); |
| [1282](#L1282) | } |
| [1283](#L1283) |  |
| [1284](#L1284) | $slug     = sanitize\_key( wp\_unslash( $\_POST['slug'] ) ); |
| [1285](#L1285) | $plugin\_slug = 'user-registration-pro' === $slug ? wp\_unslash( $\_POST['slug'] . '/user-registration.php' ) : wp\_unslash( $\_POST['slug'] . '/' . $\_POST['slug'] . '.php' ); // phpcs:ignore |
| [1286](#L1286) | $plugin   = plugin\_basename( sanitize\_text\_field( $plugin\_slug ) ); |
| [1287](#L1287) | $status   = array( |
| [1288](#L1288) | 'install' => 'plugin', |
| [1289](#L1289) | 'slug'    => sanitize\_key( wp\_unslash( $\_POST['slug'] ) ), |
| [1290](#L1290) | ); |
| [1291](#L1291) |  |
| [1292](#L1292) | if ( ! current\_user\_can( 'install\_plugins' ) ) { |
| [1293](#L1293) | $status['errorMessage'] = esc\_html\_\_( 'Sorry, you are not allowed to install plugins on this site.', 'user-registration' ); |
| [1294](#L1294) | wp\_send\_json\_error( $status ); |
| [1295](#L1295) | } |
| [1296](#L1296) |  |
| [1297](#L1297) | include\_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php'; |
| [1298](#L1298) | include\_once ABSPATH . 'wp-admin/includes/plugin-install.php'; |
| [1299](#L1299) |  |
| [1300](#L1300) | if ( file\_exists( WP\_PLUGIN\_DIR . '/' . $slug ) ) { |
| [1301](#L1301) | $plugin\_data          = get\_plugin\_data( WP\_PLUGIN\_DIR . '/' . $plugin ); |
| [1302](#L1302) | $status['plugin']     = $plugin; |
| [1303](#L1303) | $status['pluginName'] = $plugin\_data['Name']; |
| [1304](#L1304) |  |
| [1305](#L1305) | if ( current\_user\_can( 'activate\_plugin', $plugin ) && is\_plugin\_inactive( $plugin ) ) { |
| [1306](#L1306) | $result = activate\_plugin( $plugin ); |
| [1307](#L1307) |  |
| [1308](#L1308) | if ( is\_wp\_error( $result ) ) { |
| [1309](#L1309) | $status['errorCode']    = $result->get\_error\_code(); |
| [1310](#L1310) | $status['errorMessage'] = $result->get\_error\_message(); |
| [1311](#L1311) | wp\_send\_json\_error( $status ); |
| [1312](#L1312) | } |
| [1313](#L1313) |  |
| [1314](#L1314) | wp\_send\_json\_success( $status ); |
| [1315](#L1315) | } |
| [1316](#L1316) | } |
| [1317](#L1317) |  |
| [1318](#L1318) | $api = json\_decode( |
| [1319](#L1319) | UR\_Updater\_Key\_API::version( |
| [1320](#L1320) | array( |
| [1321](#L1321) | 'license'   => get\_option( 'user-registration\_license\_key' ), |
| [1322](#L1322) | 'item\_name' => ! empty( $\_POST['name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['name'] ) ) : '', |
| [1323](#L1323) | ) |
| [1324](#L1324) | ) |
| [1325](#L1325) | ); |
| [1326](#L1326) |  |
| [1327](#L1327) | if ( is\_wp\_error( $api ) ) { |
| [1328](#L1328) | $status['errorMessage'] = $api->get\_error\_message(); |
| [1329](#L1329) | wp\_send\_json\_error( $status ); |
| [1330](#L1330) | } |
| [1331](#L1331) |  |
| [1332](#L1332) | $status['pluginName'] = $api->name; |
| [1333](#L1333) |  |
| [1334](#L1334) | $skin     = new WP\_Ajax\_Upgrader\_Skin(); |
| [1335](#L1335) | $upgrader = new Plugin\_Upgrader( $skin ); |
| [1336](#L1336) | $result   = $upgrader->install( $api->download\_link ); |
| [1337](#L1337) |  |
| [1338](#L1338) | if ( defined( 'WP\_DEBUG' ) && WP\_DEBUG ) { |
| [1339](#L1339) | $status['debug'] = $skin->get\_upgrade\_messages(); |
| [1340](#L1340) | } |
| [1341](#L1341) |  |
| [1342](#L1342) | if ( is\_wp\_error( $result ) ) { |
| [1343](#L1343) | $status['errorCode']    = $result->get\_error\_code(); |
| [1344](#L1344) | $status['errorMessage'] = $result->get\_error\_message(); |
| [1345](#L1345) | wp\_send\_json\_error( $status ); |
| [1346](#L1346) | } elseif ( is\_wp\_error( $skin->result ) ) { |
| [1347](#L1347) | $status['errorCode']    = $skin->result->get\_error\_code(); |
| [1348](#L1348) | $status['errorMessage'] = $skin->result->get\_error\_message(); |
| [1349](#L1349) | wp\_send\_json\_error( $status ); |
| [1350](#L1350) | } elseif ( $skin->get\_errors()->get\_error\_code() ) { |
| [1351](#L1351) | $status['errorMessage'] = $skin->get\_error\_messages(); |
| [1352](#L1352) | wp\_send\_json\_error( $status ); |
| [1353](#L1353) | } elseif ( is\_null( $result ) ) { |
| [1354](#L1354) | global $wp\_filesystem; |
| [1355](#L1355) |  |
| [1356](#L1356) | $status['errorCode']    = 'unable\_to\_connect\_to\_filesystem'; |
| [1357](#L1357) | $status['errorMessage'] = esc\_html\_\_( 'Unable to connect to the filesystem. Please confirm your credentials.', 'user-registration' ); |
| [1358](#L1358) |  |
| [1359](#L1359) | // Pass through the error from WP\_Filesystem if one was raised. |
| [1360](#L1360) | if ( $wp\_filesystem instanceof WP\_Filesystem\_Base && is\_wp\_error( $wp\_filesystem->errors ) && $wp\_filesystem->errors->get\_error\_code() ) { |
| [1361](#L1361) | $status['errorMessage'] = esc\_html( $wp\_filesystem->errors->get\_error\_message() ); |
| [1362](#L1362) | } |
| [1363](#L1363) |  |
| [1364](#L1364) | wp\_send\_json\_error( $status ); |
| [1365](#L1365) | } |
| [1366](#L1366) |  |
| [1367](#L1367) | $api->version   = isset( $api->new\_version ) ? $api->new\_version : ''; |
| [1368](#L1368) | $install\_status = install\_plugin\_install\_status( $api ); |
| [1369](#L1369) |  |
| [1370](#L1370) | if ( current\_user\_can( 'activate\_plugin', $install\_status['file'] ) && is\_plugin\_inactive( $install\_status['file'] ) ) { |
| [1371](#L1371) | if ( isset( $\_POST['page'] ) && 'user-registration\_page\_add-new-registration' === $\_POST['page'] ) { |
| [1372](#L1372) | activate\_plugin( $install\_status['file'] ); |
| [1373](#L1373) | } else { |
| [1374](#L1374) | $status['activateUrl'] = |
| [1375](#L1375) | esc\_url\_raw( |
| [1376](#L1376) | add\_query\_arg( |
| [1377](#L1377) | array( |
| [1378](#L1378) | 'action'   => 'activate', |
| [1379](#L1379) | 'plugin'   => $install\_status['file'], |
| [1380](#L1380) | '\_wpnonce' => wp\_create\_nonce( 'activate-plugin\_' . $install\_status['file'] ), |
| [1381](#L1381) | ), |
| [1382](#L1382) | admin\_url( 'admin.php?page=user-registration-addons' ) |
| [1383](#L1383) | ) |
| [1384](#L1384) | ); |
| [1385](#L1385) | } |
| [1386](#L1386) | } |
| [1387](#L1387) |  |
| [1388](#L1388) | wp\_send\_json\_success( $status ); |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | /\*\* |
| [1392](#L1392) | \* AJAX create new form. |
| [1393](#L1393) | \*/ |
| [1394](#L1394) | public static function create\_form() { |
| [1395](#L1395) | ob\_start(); |
| [1396](#L1396) |  |
| [1397](#L1397) | check\_ajax\_referer( 'user\_registration\_create\_form', 'security' ); |
| [1398](#L1398) |  |
| [1399](#L1399) | $title    = isset( $\_POST['title'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['title'] ) ) : esc\_html\_\_( 'Blank Form', 'user-registration' ); |
| [1400](#L1400) | $template = isset( $\_POST['template'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['template'] ) ) : 'blank'; |
| [1401](#L1401) |  |
| [1402](#L1402) | $form\_id = UR()->form->create( $title, $template ); |
| [1403](#L1403) |  |
| [1404](#L1404) | if ( $form\_id ) { |
| [1405](#L1405) | $data = array( |
| [1406](#L1406) | 'id'       => $form\_id, |
| [1407](#L1407) | 'redirect' => add\_query\_arg( |
| [1408](#L1408) | array( |
| [1409](#L1409) | 'tab'     => 'fields', |
| [1410](#L1410) | 'form\_id' => $form\_id, |
| [1411](#L1411) | ), |
| [1412](#L1412) | admin\_url( 'admin.php?page=add-new-registration&edit-registration=' . $form\_id ) |
| [1413](#L1413) | ), |
| [1414](#L1414) | ); |
| [1415](#L1415) |  |
| [1416](#L1416) | wp\_send\_json\_success( $data ); |
| [1417](#L1417) | } |
| [1418](#L1418) |  |
| [1419](#L1419) | wp\_send\_json\_error( |
| [1420](#L1420) | array( |
| [1421](#L1421) | 'error' => esc\_html\_\_( 'Something went wrong, please try again later', 'user-registration' ), |
| [1422](#L1422) | ) |
| [1423](#L1423) | ); |
| [1424](#L1424) | } |
| [1425](#L1425) |  |
| [1426](#L1426) | /\*\* |
| [1427](#L1427) | \* Cancel a pending email change. |
| [1428](#L1428) | \* |
| [1429](#L1429) | \* @return void |
| [1430](#L1430) | \*/ |
| [1431](#L1431) | public static function cancel\_email\_change() { |
| [1432](#L1432) | check\_ajax\_referer( 'cancel\_email\_change\_nonce', '\_wpnonce' ); |
| [1433](#L1433) |  |
| [1434](#L1434) | $user\_id = isset( $\_POST['cancel\_email\_change'] ) ? absint( wp\_unslash( $\_POST['cancel\_email\_change'] ) ) : false; |
| [1435](#L1435) |  |
| [1436](#L1436) | if ( ! $user\_id ) { |
| [1437](#L1437) | wp\_die( -1 ); |
| [1438](#L1438) | } |
| [1439](#L1439) |  |
| [1440](#L1440) | // Remove the confirmation key, pending email and expiry date. |
| [1441](#L1441) | UR\_Form\_Handler::delete\_pending\_email\_change( $user\_id ); |
| [1442](#L1442) |  |
| [1443](#L1443) | wp\_send\_json\_success( |
| [1444](#L1444) | array( |
| [1445](#L1445) | 'message' => \_\_( 'Changed email cancelled successfully.', 'user-registration' ), |
| [1446](#L1446) | ) |
| [1447](#L1447) | ); |
| [1448](#L1448) | } |
| [1449](#L1449) |  |
| [1450](#L1450) | /\*\* |
| [1451](#L1451) | \* Email setting status |
| [1452](#L1452) | \*/ |
| [1453](#L1453) | public static function email\_setting\_status() { |
| [1454](#L1454) | $security = isset( $\_POST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['security'] ) ) : ''; |
| [1455](#L1455) | if ( '' === $security || ! wp\_verify\_nonce( $security, 'email\_setting\_status\_nonce' ) ) { |
| [1456](#L1456) | wp\_send\_json\_error( 'Nonce verification failed' ); |
| [1457](#L1457) | return; |
| [1458](#L1458) | } |
| [1459](#L1459) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1460](#L1460) | wp\_send\_json\_error( 'Permision Denied' ); |
| [1461](#L1461) | return; |
| [1462](#L1462) | } |
| [1463](#L1463) | $status = isset( $\_POST['status'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['status'] ) ) : null; |
| [1464](#L1464) | $id     = isset( $\_POST['id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['id'] ) ) : null; |
| [1465](#L1465) | $value  = ur\_string\_to\_bool( $status ); |
| [1466](#L1466) | $key    = 'user\_registration\_enable\_' . $id; |
| [1467](#L1467) |  |
| [1468](#L1468) | $option = get\_option( $key, 'NO\_OPTION' ); |
| [1469](#L1469) | if ( 'NO\_OPTION' === $option ) { |
| [1470](#L1470) | $status = add\_option( $key, $value ); |
| [1471](#L1471) | } else { |
| [1472](#L1472) |  |
| [1473](#L1473) | $status = update\_option( $key, $value ); |
| [1474](#L1474) | } |
| [1475](#L1475) | if ( $status ) { |
| [1476](#L1476) | wp\_send\_json\_success( 'Successfully Updated' ); |
| [1477](#L1477) | } else { |
| [1478](#L1478) | wp\_send\_json\_error( 'Update failed !' ); |
| [1479](#L1479) | } |
| [1480](#L1480) | } |
| [1481](#L1481) | /\*\* |
| [1482](#L1482) | \* Install or upgrade to premium. |
| [1483](#L1483) | \*/ |
| [1484](#L1484) | public static function locked\_form\_fields\_notice() { |
| [1485](#L1485) | $security = isset( $\_POST['security'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['security'] ) ) : ''; |
| [1486](#L1486) | if ( '' === $security || ! wp\_verify\_nonce( $security, 'locked\_form\_fields\_notice\_nonce' ) ) { |
| [1487](#L1487) | wp\_send\_json\_error( 'Nonce verification failed' ); |
| [1488](#L1488) | return; |
| [1489](#L1489) | } |
| [1490](#L1490) | if ( ! current\_user\_can( 'manage\_options' ) ) { |
| [1491](#L1491) | wp\_send\_json\_error( 'Permision Denied' ); |
| [1492](#L1492) | return; |
| [1493](#L1493) | } |
| [1494](#L1494) | $plan         = isset( $\_POST['plan'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['plan'] ) ) : null; |
| [1495](#L1495) | $slug         = isset( $\_POST['slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['slug'] ) ) : null; |
| [1496](#L1496) | $name         = isset( $\_POST['name'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['name'] ) ) : null; |
| [1497](#L1497) | $video\_id     = isset( $\_POST['video\_id'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['video\_id'] ) ) : null; |
| [1498](#L1498) | $license\_data = ur\_get\_license\_plan(); |
| [1499](#L1499) | $button       = ''; |
| [1500](#L1500) |  |
| [1501](#L1501) | if ( false === $license\_data ) { |
| [1502](#L1502) |  |
| [1503](#L1503) | if ( is\_plugin\_active( 'user-registration-pro/user-registration.php' ) ) { |
| [1504](#L1504) | $button = '<div class="action-buttons"><a class="button activate-license-now" href="' . esc\_url( admin\_url( 'admin.php?page=user-registration-settings&tab=license' ) ) . '" target="\_blank">' . esc\_html\_\_( 'Activate License', 'user-registration' ) . '</a></div>'; |
| [1505](#L1505) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1506](#L1506) | } else { |
| [1507](#L1507) | $button = '<div class="action-buttons"><a class="button upgrade-now" href="https://wpuserregistration.com/pricing/?utm\_source=builder-fields&utm\_medium=premium-field-popup&utm\_campaign=' . UR()->utm\_campaign . '" target="\_blank">' . esc\_html\_\_( 'Upgrade Plan', 'user-registration' ) . '</a></div>'; |
| [1508](#L1508) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1509](#L1509) | } |
| [1510](#L1510) | } |
| [1511](#L1511) | $license\_plan = ! empty( $license\_data->item\_plan ) ? $license\_data->item\_plan : false; |
| [1512](#L1512) |  |
| [1513](#L1513) | $license\_plan = $license\_plan . ' plan'; |
| [1514](#L1514) | $license\_plan = trim( $license\_plan ); |
| [1515](#L1515) |  |
| [1516](#L1516) | if ( 'themegrill agency plan' === $license\_plan || 'professional plan' === $license\_plan || 'plus plan' === $license\_plan ) { |
| [1517](#L1517) | $license\_plan = 'themegrill agency plan or professional plan or plus plan'; |
| [1518](#L1518) | } |
| [1519](#L1519) | if ( strtolower( $plan ) === $license\_plan ) { |
| [1520](#L1520) | if ( 'themegrill agency plan or professional plan or plus plan' === $license\_plan ) { |
| [1521](#L1521) | $plan\_list = array( 'plus', 'professional', 'personal', 'themegrill agency' ); |
| [1522](#L1522) | } else { |
| [1523](#L1523) | $plan\_list = array( 'personal' ); |
| [1524](#L1524) | } |
| [1525](#L1525) | } elseif ( strtolower( $plan ) === 'personal plan' && 'themegrill agency plan or professional plan or plus plan' === $license\_plan ) { |
| [1526](#L1526) | $plan\_list = array( 'plus', 'professional', 'personal', 'themegrill agency' ); |
| [1527](#L1527) | } else { |
| [1528](#L1528) | $plan\_list = array(); |
| [1529](#L1529) | } |
| [1530](#L1530) | if ( $plan ) { |
| [1531](#L1531) | $addon = (object) array( |
| [1532](#L1532) | 'title' => '', |
| [1533](#L1533) | 'slug'  => $slug, |
| [1534](#L1534) | 'name'  => $name, |
| [1535](#L1535) | 'plan'  => $plan\_list, |
| [1536](#L1536) | ); |
| [1537](#L1537) | } |
| [1538](#L1538) |  |
| [1539](#L1539) | ob\_start(); |
| [1540](#L1540) | /\*\* |
| [1541](#L1541) | \* Action after addon description. |
| [1542](#L1542) | \* |
| [1543](#L1543) | \* @param array $addon The addon's details. |
| [1544](#L1544) | \*/ |
| [1545](#L1545) | do\_action( 'user\_registration\_after\_addons\_description', $addon ); |
| [1546](#L1546) | $button = ob\_get\_clean(); |
| [1547](#L1547) | wp\_send\_json\_success( array( 'action\_button' => $button ) ); |
| [1548](#L1548) | } |
| [1549](#L1549) |  |
| [1550](#L1550) |  |
| [1551](#L1551) | /\*\* |
| [1552](#L1552) | \* Handle PHP Deprecated notice dismiss action. |
| [1553](#L1553) | \* |
| [1554](#L1554) | \* @return bool |
| [1555](#L1555) | \*/ |
| [1556](#L1556) | public static function php\_notice\_dismiss() { |
| [1557](#L1557) | $current\_date = gmdate( 'Y-m-d' ); |
| [1558](#L1558) | $prompt\_count = get\_option( 'user\_registration\_php\_deprecated\_notice\_prompt\_count', 0 ); |
| [1559](#L1559) |  |
| [1560](#L1560) | update\_option( 'user\_registration\_php\_deprecated\_notice\_last\_prompt\_date', $current\_date ); |
| [1561](#L1561) | update\_option( 'user\_registration\_php\_deprecated\_notice\_prompt\_count', ++$prompt\_count ); |
| [1562](#L1562) |  |
| [1563](#L1563) | return false; |
| [1564](#L1564) | } |
| [1565](#L1565) | } |
| [1566](#L1566) |  |
| [1567](#L1567) | UR\_AJAX::init(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439&format=txt)
* [Original Format](/export/3070439/user-registration/trunk/includes/class-ur-ajax.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_673ed9cb_20250111_194239.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3070439)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3070438 "Changeset 3070438")
* [Next Changeset](/changeset/3070440 "Changeset 3070440") →

---

# Changeset 3070439

Timestamp:
04/15/2024 05:24:45 AM
([9 months](/timeline?from=2024-04-15T05%3A24%3A45Z&precision=second "See timeline at 04/15/2024 05:24:45 AM") ago)

Author:
wpeverestdev
Message:

Update to version 3.2.0 from GitHub

Location:
[user-registration](/browser/user-registration?rev=3070439)
Files:

82 added
14 deleted
192 edited
1 copied

* [tags/3.2.0](/browser/user-registration/tags/3.2.0?rev=3070439 "Show entry in browser")
  (copied)
  *(copied from [user-registration/trunk](/browser/user-registration/trunk?rev=3045419 "Show original file (revision 3070436)"))*
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0 "Show differences"))
* [tags/3.2.0/CHANGELOG.txt](/browser/user-registration/tags/3.2.0/CHANGELOG.txt?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/assets/css/admin-rtl.css](/browser/user-registration/tags/3.2.0/assets/css/admin-rtl.css?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/css/admin-rtl.css "Show differences"))
* [tags/3.2.0/assets/css/admin.css](/browser/user-registration/tags/3.2.0/assets/css/admin.css?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/css/admin.css "Show differences"))
* [tags/3.2.0/assets/css/admin.scss](/browser/user-registration/tags/3.2.0/assets/css/admin.scss?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/css/admin.scss "Show differences"))
* [tags/3.2.0/assets/extensions-json/all-features.json](/browser/user-registration/tags/3.2.0/assets/extensions-json/all-features.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/assets/extensions-json/sections/all\_extensions.json](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/all_extensions.json?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/all_extensions.json "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/activecampaign.jpg](/browser/user-registration/trunk/assets/extensions-json/sections/images/activecampaign.jpg?rev=2842259 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/assets/extensions-json/sections/images/activecampaign.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/activecampaign.png?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/assets/extensions-json/sections/images/advanced-fields.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/advanced-fields.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/advanced-fields.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/conditional-logic.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/conditional-logic.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/conditional-logic.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/content-restriction.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/content-restriction.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/content-restriction.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/conversational-forms.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/conversational-forms.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/conversational-forms.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/customize-my-account.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/customize-my-account.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/customize-my-account.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/email-templates.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/email-templates.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/email-templates.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/extras.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/extras.png?rev=2653967 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/assets/extensions-json/sections/images/field-visibility.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/field-visibility.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/field-visibility.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/file.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/file.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/file.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/form-restriction.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/form-restriction.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/form-restriction.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/frontend-listing.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/frontend-listing.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/frontend-listing.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/geolocation.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/geolocation.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/geolocation.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/import-users.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/import-users.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/import-users.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/invite-codes.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/invite-codes.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/invite-codes.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/klaviyo.jpg](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/klaviyo.jpg?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/assets/extensions-json/sections/images/klaviyo.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/klaviyo.png?rev=2925707 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/assets/extensions-json/sections/images/learndash.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/learndash.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/learndash.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/mailchimp.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/mailchimp.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/mailchimp.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/mailerlite.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/mailerlite.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/mailerlite.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/multi-part.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/multi-part.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/multi-part.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/payment-paypal.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/payment-paypal.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/payment-paypal.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/pdf-form-submission.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/pdf-form-submission.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/pdf-form-submission.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/post-submission.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/post-submission.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/post-submission.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/private-notes.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/private-notes.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/private-notes.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/profile-completeness.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/profile-completeness.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/profile-completeness.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/profile-connect.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/profile-connect.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/profile-connect.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/save-and-continue.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/save-and-continue.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/save-and-continue.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/social.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/social.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/social.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/stripe.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/stripe.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/stripe.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/style-customizer.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/style-customizer.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/style-customizer.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/two-factor-authentication.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/two-factor-authentication.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/two-factor-authentication.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/woo-extension.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/woo-extension.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/woo-extension.png "Show differences"))
* [tags/3.2.0/assets/extensions-json/sections/images/zapier.png](/browser/user-registration/tags/3.2.0/assets/extensions-json/sections/images/zapier.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/extensions-json/sections/images/zapier.png "Show differences"))
* [tags/3.2.0/assets/js/admin/admin.js](/browser/user-registration/tags/3.2.0/assets/js/admin/admin.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/admin/admin.js "Show differences"))
* [tags/3.2.0/assets/js/admin/admin.min.js](/browser/user-registration/tags/3.2.0/assets/js/admin/admin.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/admin/admin.min.js "Show differences"))
* [tags/3.2.0/assets/js/admin/form-builder.js](/browser/user-registration/tags/3.2.0/assets/js/admin/form-builder.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/admin/form-builder.js "Show differences"))
* [tags/3.2.0/assets/js/admin/form-builder.min.js](/browser/user-registration/tags/3.2.0/assets/js/admin/form-builder.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/admin/form-builder.min.js "Show differences"))
* [tags/3.2.0/assets/js/admin/gutenberg/form-block.js](/browser/user-registration/tags/3.2.0/assets/js/admin/gutenberg/form-block.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/admin/gutenberg/form-block.js "Show differences"))
* [tags/3.2.0/assets/js/frontend/jquery.validate.js](/browser/user-registration/tags/3.2.0/assets/js/frontend/jquery.validate.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/frontend/jquery.validate.js "Show differences"))
* [tags/3.2.0/assets/js/frontend/user-registration-form-validator.js](/browser/user-registration/tags/3.2.0/assets/js/frontend/user-registration-form-validator.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/frontend/user-registration-form-validator.js "Show differences"))
* [tags/3.2.0/assets/js/frontend/user-registration-form-validator.min.js](/browser/user-registration/tags/3.2.0/assets/js/frontend/user-registration-form-validator.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/frontend/user-registration-form-validator.min.js "Show differences"))
* [tags/3.2.0/assets/js/frontend/user-registration.js](/browser/user-registration/tags/3.2.0/assets/js/frontend/user-registration.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/frontend/user-registration.js "Show differences"))
* [tags/3.2.0/assets/js/frontend/user-registration.min.js](/browser/user-registration/tags/3.2.0/assets/js/frontend/user-registration.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/assets/js/frontend/user-registration.min.js "Show differences"))
* [tags/3.2.0/chunks/blocks.js](/browser/user-registration/tags/3.2.0/chunks/blocks.js?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/blocks.js.LICENSE.txt](/browser/user-registration/tags/3.2.0/chunks/blocks.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/blocks.js.map](/browser/user-registration/tags/3.2.0/chunks/blocks.js.map?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/dashboard.js](/browser/user-registration/tags/3.2.0/chunks/dashboard.js?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/dashboard.js.LICENSE.txt](/browser/user-registration/tags/3.2.0/chunks/dashboard.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/dashboard.js.map](/browser/user-registration/tags/3.2.0/chunks/dashboard.js.map?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/edit-password](/browser/user-registration/tags/3.2.0/chunks/edit-password?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/edit-password/block.json](/browser/user-registration/tags/3.2.0/chunks/edit-password/block.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/edit-profile](/browser/user-registration/tags/3.2.0/chunks/edit-profile?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/edit-profile/block.json](/browser/user-registration/tags/3.2.0/chunks/edit-profile/block.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/formblock.js](/browser/user-registration/tags/3.2.0/chunks/formblock.js?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/formblock.js.map](/browser/user-registration/tags/3.2.0/chunks/formblock.js.map?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/login-form](/browser/user-registration/tags/3.2.0/chunks/login-form?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/login-form/block.json](/browser/user-registration/tags/3.2.0/chunks/login-form/block.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/main.js](/browser/user-registration/trunk/chunks/main.js?rev=3045419 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/chunks/main.js.LICENSE.txt](/browser/user-registration/trunk/chunks/main.js.LICENSE.txt?rev=3045419 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/chunks/main.js.map](/browser/user-registration/trunk/chunks/main.js.map?rev=3045419 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/chunks/myaccount](/browser/user-registration/tags/3.2.0/chunks/myaccount?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/myaccount/block.json](/browser/user-registration/tags/3.2.0/chunks/myaccount/block.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/registration-form](/browser/user-registration/tags/3.2.0/chunks/registration-form?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/registration-form/block.json](/browser/user-registration/tags/3.2.0/chunks/registration-form/block.json?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/welcome.js](/browser/user-registration/tags/3.2.0/chunks/welcome.js?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/welcome.js.LICENSE.txt](/browser/user-registration/tags/3.2.0/chunks/welcome.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/chunks/welcome.js.map](/browser/user-registration/tags/3.2.0/chunks/welcome.js.map?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/class-ur-rest-api.php](/browser/user-registration/tags/3.2.0/includes/RestApi/class-ur-rest-api.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/RestApi/class-ur-rest-api.php "Show differences"))
* [tags/3.2.0/includes/RestApi/controllers](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/controllers/version1](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers/version1?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/controllers/version1/class-ur-changelog.php](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers/version1/class-ur-changelog.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/controllers/version1/class-ur-getting-started.php](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers/version1/class-ur-getting-started.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/controllers/version1/class-ur-gutenberg-blocks.php](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers/version1/class-ur-gutenberg-blocks.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/RestApi/controllers/version1/class-ur-modules.php](/browser/user-registration/tags/3.2.0/includes/RestApi/controllers/version1/class-ur-modules.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/abstracts/abstract-ur-list-table.php](/browser/user-registration/tags/3.2.0/includes/abstracts/abstract-ur-list-table.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/abstracts/abstract-ur-list-table.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-addons.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-addons.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-addons.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-assets.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-assets.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-assets.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-dashboard.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-dashboard.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/admin/class-ur-admin-menus.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-menus.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-menus.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-notices.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-notices.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-notices.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-user-list-manager.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-user-list-manager.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-user-list-manager.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-user-manager.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-user-manager.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-user-manager.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin-welcome.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin-welcome.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin-welcome.php "Show differences"))
* [tags/3.2.0/includes/admin/class-ur-admin.php](/browser/user-registration/tags/3.2.0/includes/admin/class-ur-admin.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/class-ur-admin.php "Show differences"))
* [tags/3.2.0/includes/admin/functions-ur-admin.php](/browser/user-registration/tags/3.2.0/includes/admin/functions-ur-admin.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/functions-ur-admin.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-admin-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-admin-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-admin-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-approval-link-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-approval-link-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-approval-link-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-email-confirmation.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-email-confirmation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-email-confirmation.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-reset-password-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-reset-password-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-reset-password-email.php "Show differences"))
* [tags/3.2.0/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php](/browser/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php "Show differences"))
* [tags/3.2.0/includes/admin/updater/class-ur-addon-updater.php](/browser/user-registration/tags/3.2.0/includes/admin/updater/class-ur-addon-updater.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/updater/class-ur-addon-updater.php "Show differences"))
* [tags/3.2.0/includes/admin/views/html-admin-page-addons.php](/browser/user-registration/trunk/includes/admin/views/html-admin-page-addons.php?rev=3034436 "Show what was removed (content at revision 3070436)")
  (deleted)
* [tags/3.2.0/includes/admin/views/html-admin-page-forms.php](/browser/user-registration/tags/3.2.0/includes/admin/views/html-admin-page-forms.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/admin/views/html-admin-page-forms.php "Show differences"))
* [tags/3.2.0/includes/blocks](/browser/user-registration/tags/3.2.0/includes/blocks?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types](/browser/user-registration/tags/3.2.0/includes/blocks/block-types?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-abstract.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-abstract.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-edit-password.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-edit-password.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-edit-profile.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-edit-profile.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-login-form.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-login-form.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-myaccount.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-myaccount.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/block-types/class-ur-block-registration-form.php](/browser/user-registration/tags/3.2.0/includes/blocks/block-types/class-ur-block-registration-form.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/blocks/class-ur-blocks.php](/browser/user-registration/tags/3.2.0/includes/blocks/class-ur-blocks.php?rev=3070439 "Show entry in browser")
  (added)
* [tags/3.2.0/includes/class-ur-ajax.php](/browser/user-registration/tags/3.2.0/includes/class-ur-ajax.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-ajax.php "Show differences"))
* [tags/3.2.0/includes/class-ur-email-confirmation.php](/browser/user-registration/tags/3.2.0/includes/class-ur-email-confirmation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-email-confirmation.php "Show differences"))
* [tags/3.2.0/includes/class-ur-form-block.php](/browser/user-registration/tags/3.2.0/includes/class-ur-form-block.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-form-block.php "Show differences"))
* [tags/3.2.0/includes/class-ur-frontend-scripts.php](/browser/user-registration/tags/3.2.0/includes/class-ur-frontend-scripts.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-frontend-scripts.php "Show differences"))
* [tags/3.2.0/includes/class-ur-install.php](/browser/user-registration/tags/3.2.0/includes/class-ur-install.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-install.php "Show differences"))
* [tags/3.2.0/includes/class-ur-plugin-updater.php](/browser/user-registration/tags/3.2.0/includes/class-ur-plugin-updater.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-plugin-updater.php "Show differences"))
* [tags/3.2.0/includes/class-ur-user-approval.php](/browser/user-registration/tags/3.2.0/includes/class-ur-user-approval.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/class-ur-user-approval.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-checkbox.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-checkbox.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-checkbox.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-date.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-date.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-date.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-number.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-number.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-number.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-password.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-password.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-password.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-text.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-text.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-text.php "Show differences"))
* [tags/3.2.0/includes/form/class-ur-form-field-textarea.php](/browser/user-registration/tags/3.2.0/includes/form/class-ur-form-field-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/class-ur-form-field-textarea.php "Show differences"))
* [tags/3.2.0/includes/form/settings/class-ur-setting-text.php](/browser/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-text.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-text.php "Show differences"))
* [tags/3.2.0/includes/form/settings/class-ur-setting-textarea.php](/browser/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-textarea.php "Show differences"))
* [tags/3.2.0/includes/form/settings/class-ur-setting-user\_login.php](/browser/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-user_login.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/settings/class-ur-setting-user_login.php "Show differences"))
* [tags/3.2.0/includes/form/views/admin/admin-textarea.php](/browser/user-registration/tags/3.2.0/includes/form/views/admin/admin-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/form/views/admin/admin-textarea.php "Show differences"))
* [tags/3.2.0/includes/frontend/class-ur-frontend-form-handler.php](/browser/user-registration/tags/3.2.0/includes/frontend/class-ur-frontend-form-handler.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/frontend/class-ur-frontend-form-handler.php "Show differences"))
* [tags/3.2.0/includes/functions-ur-core.php](/browser/user-registration/tags/3.2.0/includes/functions-ur-core.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/functions-ur-core.php "Show differences"))
* [tags/3.2.0/includes/functions-ur-page.php](/browser/user-registration/tags/3.2.0/includes/functions-ur-page.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/functions-ur-page.php "Show differences"))
* [tags/3.2.0/includes/functions-ur-template.php](/browser/user-registration/tags/3.2.0/includes/functions-ur-template.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/functions-ur-template.php "Show differences"))
* [tags/3.2.0/includes/shortcodes/class-ur-shortcode-my-account.php](/browser/user-registration/tags/3.2.0/includes/shortcodes/class-ur-shortcode-my-account.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/shortcodes/class-ur-shortcode-my-account.php "Show differences"))
* [tags/3.2.0/includes/stats/class-ur-stats.php](/browser/user-registration/tags/3.2.0/includes/stats/class-ur-stats.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/stats/class-ur-stats.php "Show differences"))
* [tags/3.2.0/includes/validation/class-ur-validation.php](/browser/user-registration/tags/3.2.0/includes/validation/class-ur-validation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/includes/validation/class-ur-validation.php "Show differences"))
* [tags/3.2.0/languages/user-registration.pot](/browser/user-registration/tags/3.2.0/languages/user-registration.pot?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/languages/user-registration.pot "Show differences"))
* [tags/3.2.0/readme.txt](/browser/user-registration/tags/3.2.0/readme.txt?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/readme.txt "Show differences"))
* [tags/3.2.0/user-registration.php](/browser/user-registration/tags/3.2.0/user-registration.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/tags/3.2.0/user-registration.php "Show differences"))
* [trunk/CHANGELOG.txt](/browser/user-registration/trunk/CHANGELOG.txt?rev=3070439 "Show entry in browser")
  (added)
* [trunk/assets/css/admin-rtl.css](/browser/user-registration/trunk/assets/css/admin-rtl.css?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/css/admin-rtl.css "Show differences"))
* [trunk/assets/css/admin.css](/browser/user-registration/trunk/assets/css/admin.css?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/css/admin.css "Show differences"))
* [trunk/assets/css/admin.scss](/browser/user-registration/trunk/assets/css/admin.scss?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/css/admin.scss "Show differences"))
* [trunk/assets/extensions-json/all-features.json](/browser/user-registration/trunk/assets/extensions-json/all-features.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/assets/extensions-json/sections/all\_extensions.json](/browser/user-registration/trunk/assets/extensions-json/sections/all_extensions.json?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/all_extensions.json "Show differences"))
* [trunk/assets/extensions-json/sections/images/activecampaign.jpg](/browser/user-registration/trunk/assets/extensions-json/sections/images/activecampaign.jpg?rev=2842259 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/assets/extensions-json/sections/images/activecampaign.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/activecampaign.png?rev=3070439 "Show entry in browser")
  (added)
* [trunk/assets/extensions-json/sections/images/advanced-fields.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/advanced-fields.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/advanced-fields.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/conditional-logic.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/conditional-logic.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/conditional-logic.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/content-restriction.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/content-restriction.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/content-restriction.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/conversational-forms.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/conversational-forms.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/conversational-forms.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/customize-my-account.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/customize-my-account.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/customize-my-account.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/email-templates.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/email-templates.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/email-templates.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/extras.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/extras.png?rev=2653967 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/assets/extensions-json/sections/images/field-visibility.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/field-visibility.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/field-visibility.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/file.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/file.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/file.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/form-restriction.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/form-restriction.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/form-restriction.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/frontend-listing.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/frontend-listing.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/frontend-listing.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/geolocation.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/geolocation.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/geolocation.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/import-users.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/import-users.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/import-users.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/invite-codes.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/invite-codes.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/invite-codes.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/klaviyo.jpg](/browser/user-registration/trunk/assets/extensions-json/sections/images/klaviyo.jpg?rev=3070439 "Show entry in browser")
  (added)
* [trunk/assets/extensions-json/sections/images/klaviyo.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/klaviyo.png?rev=2925707 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/assets/extensions-json/sections/images/learndash.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/learndash.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/learndash.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/mailchimp.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/mailchimp.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/mailchimp.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/mailerlite.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/mailerlite.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/mailerlite.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/multi-part.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/multi-part.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/multi-part.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/payment-paypal.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/payment-paypal.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/payment-paypal.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/pdf-form-submission.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/pdf-form-submission.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/pdf-form-submission.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/post-submission.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/post-submission.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/post-submission.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/private-notes.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/private-notes.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/private-notes.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/profile-completeness.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/profile-completeness.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/profile-completeness.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/profile-connect.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/profile-connect.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/profile-connect.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/save-and-continue.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/save-and-continue.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/save-and-continue.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/social.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/social.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/social.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/stripe.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/stripe.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/stripe.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/style-customizer.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/style-customizer.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/style-customizer.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/two-factor-authentication.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/two-factor-authentication.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/two-factor-authentication.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/woo-extension.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/woo-extension.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/woo-extension.png "Show differences"))
* [trunk/assets/extensions-json/sections/images/zapier.png](/browser/user-registration/trunk/assets/extensions-json/sections/images/zapier.png?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/extensions-json/sections/images/zapier.png "Show differences"))
* [trunk/assets/js/admin/admin.js](/browser/user-registration/trunk/assets/js/admin/admin.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/admin/admin.js "Show differences"))
* [trunk/assets/js/admin/admin.min.js](/browser/user-registration/trunk/assets/js/admin/admin.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/admin/admin.min.js "Show differences"))
* [trunk/assets/js/admin/form-builder.js](/browser/user-registration/trunk/assets/js/admin/form-builder.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/admin/form-builder.js "Show differences"))
* [trunk/assets/js/admin/form-builder.min.js](/browser/user-registration/trunk/assets/js/admin/form-builder.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/admin/form-builder.min.js "Show differences"))
* [trunk/assets/js/admin/gutenberg/form-block.js](/browser/user-registration/trunk/assets/js/admin/gutenberg/form-block.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/admin/gutenberg/form-block.js "Show differences"))
* [trunk/assets/js/frontend/jquery.validate.js](/browser/user-registration/trunk/assets/js/frontend/jquery.validate.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/frontend/jquery.validate.js "Show differences"))
* [trunk/assets/js/frontend/user-registration-form-validator.js](/browser/user-registration/trunk/assets/js/frontend/user-registration-form-validator.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/frontend/user-registration-form-validator.js "Show differences"))
* [trunk/assets/js/frontend/user-registration-form-validator.min.js](/browser/user-registration/trunk/assets/js/frontend/user-registration-form-validator.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/frontend/user-registration-form-validator.min.js "Show differences"))
* [trunk/assets/js/frontend/user-registration.js](/browser/user-registration/trunk/assets/js/frontend/user-registration.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/frontend/user-registration.js "Show differences"))
* [trunk/assets/js/frontend/user-registration.min.js](/browser/user-registration/trunk/assets/js/frontend/user-registration.min.js?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/assets/js/frontend/user-registration.min.js "Show differences"))
* [trunk/chunks/blocks.js](/browser/user-registration/trunk/chunks/blocks.js?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/blocks.js.LICENSE.txt](/browser/user-registration/trunk/chunks/blocks.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/blocks.js.map](/browser/user-registration/trunk/chunks/blocks.js.map?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/dashboard.js](/browser/user-registration/trunk/chunks/dashboard.js?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/dashboard.js.LICENSE.txt](/browser/user-registration/trunk/chunks/dashboard.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/dashboard.js.map](/browser/user-registration/trunk/chunks/dashboard.js.map?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/edit-password](/browser/user-registration/trunk/chunks/edit-password?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/edit-password/block.json](/browser/user-registration/trunk/chunks/edit-password/block.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/edit-profile](/browser/user-registration/trunk/chunks/edit-profile?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/edit-profile/block.json](/browser/user-registration/trunk/chunks/edit-profile/block.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/formblock.js](/browser/user-registration/trunk/chunks/formblock.js?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/formblock.js.map](/browser/user-registration/trunk/chunks/formblock.js.map?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/login-form](/browser/user-registration/trunk/chunks/login-form?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/login-form/block.json](/browser/user-registration/trunk/chunks/login-form/block.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/main.js](/browser/user-registration/trunk/chunks/main.js?rev=3045419 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/chunks/main.js.LICENSE.txt](/browser/user-registration/trunk/chunks/main.js.LICENSE.txt?rev=3045419 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/chunks/main.js.map](/browser/user-registration/trunk/chunks/main.js.map?rev=3045419 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/chunks/myaccount](/browser/user-registration/trunk/chunks/myaccount?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/myaccount/block.json](/browser/user-registration/trunk/chunks/myaccount/block.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/registration-form](/browser/user-registration/trunk/chunks/registration-form?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/registration-form/block.json](/browser/user-registration/trunk/chunks/registration-form/block.json?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/welcome.js](/browser/user-registration/trunk/chunks/welcome.js?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/welcome.js.LICENSE.txt](/browser/user-registration/trunk/chunks/welcome.js.LICENSE.txt?rev=3070439 "Show entry in browser")
  (added)
* [trunk/chunks/welcome.js.map](/browser/user-registration/trunk/chunks/welcome.js.map?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/class-ur-rest-api.php](/browser/user-registration/trunk/includes/RestApi/class-ur-rest-api.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/RestApi/class-ur-rest-api.php "Show differences"))
* [trunk/includes/RestApi/controllers](/browser/user-registration/trunk/includes/RestApi/controllers?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/controllers/version1](/browser/user-registration/trunk/includes/RestApi/controllers/version1?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/controllers/version1/class-ur-changelog.php](/browser/user-registration/trunk/includes/RestApi/controllers/version1/class-ur-changelog.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/controllers/version1/class-ur-getting-started.php](/browser/user-registration/trunk/includes/RestApi/controllers/version1/class-ur-getting-started.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/controllers/version1/class-ur-gutenberg-blocks.php](/browser/user-registration/trunk/includes/RestApi/controllers/version1/class-ur-gutenberg-blocks.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/RestApi/controllers/version1/class-ur-modules.php](/browser/user-registration/trunk/includes/RestApi/controllers/version1/class-ur-modules.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/abstracts/abstract-ur-list-table.php](/browser/user-registration/trunk/includes/abstracts/abstract-ur-list-table.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/abstracts/abstract-ur-list-table.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-addons.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-addons.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-addons.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-assets.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-assets.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-assets.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-dashboard.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-dashboard.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/admin/class-ur-admin-menus.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-menus.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-menus.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-notices.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-notices.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-notices.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-user-list-manager.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-user-list-manager.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-user-list-manager.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-user-manager.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-user-manager.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-user-manager.php "Show differences"))
* [trunk/includes/admin/class-ur-admin-welcome.php](/browser/user-registration/trunk/includes/admin/class-ur-admin-welcome.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin-welcome.php "Show differences"))
* [trunk/includes/admin/class-ur-admin.php](/browser/user-registration/trunk/includes/admin/class-ur-admin.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/class-ur-admin.php "Show differences"))
* [trunk/includes/admin/functions-ur-admin.php](/browser/user-registration/trunk/includes/admin/functions-ur-admin.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/functions-ur-admin.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-admin-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-admin-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-admin-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-approval-link-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-approval-link-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-approval-link-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-awaiting-admin-approval-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-confirm-email-address-change-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-email-confirmation.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-email-confirmation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-email-confirmation.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-profile-details-changed-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-profile-details-updated-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-approved-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-denied-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-registration-pending-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-reset-password-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-reset-password-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-reset-password-email.php "Show differences"))
* [trunk/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php](/browser/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/settings/emails/class-ur-settings-successfully-registered-email.php "Show differences"))
* [trunk/includes/admin/updater/class-ur-addon-updater.php](/browser/user-registration/trunk/includes/admin/updater/class-ur-addon-updater.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/updater/class-ur-addon-updater.php "Show differences"))
* [trunk/includes/admin/views/html-admin-page-addons.php](/browser/user-registration/trunk/includes/admin/views/html-admin-page-addons.php?rev=3034436 "Show what was removed (content at revision 3070438)")
  (deleted)
* [trunk/includes/admin/views/html-admin-page-forms.php](/browser/user-registration/trunk/includes/admin/views/html-admin-page-forms.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/admin/views/html-admin-page-forms.php "Show differences"))
* [trunk/includes/blocks](/browser/user-registration/trunk/includes/blocks?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types](/browser/user-registration/trunk/includes/blocks/block-types?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-abstract.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-abstract.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-edit-password.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-edit-password.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-edit-profile.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-edit-profile.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-login-form.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-login-form.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-myaccount.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-myaccount.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/block-types/class-ur-block-registration-form.php](/browser/user-registration/trunk/includes/blocks/block-types/class-ur-block-registration-form.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/blocks/class-ur-blocks.php](/browser/user-registration/trunk/includes/blocks/class-ur-blocks.php?rev=3070439 "Show entry in browser")
  (added)
* [trunk/includes/class-ur-ajax.php](/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-ajax.php "Show differences"))
* [trunk/includes/class-ur-email-confirmation.php](/browser/user-registration/trunk/includes/class-ur-email-confirmation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-email-confirmation.php "Show differences"))
* [trunk/includes/class-ur-form-block.php](/browser/user-registration/trunk/includes/class-ur-form-block.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-form-block.php "Show differences"))
* [trunk/includes/class-ur-frontend-scripts.php](/browser/user-registration/trunk/includes/class-ur-frontend-scripts.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-frontend-scripts.php "Show differences"))
* [trunk/includes/class-ur-install.php](/browser/user-registration/trunk/includes/class-ur-install.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-install.php "Show differences"))
* [trunk/includes/class-ur-plugin-updater.php](/browser/user-registration/trunk/includes/class-ur-plugin-updater.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-plugin-updater.php "Show differences"))
* [trunk/includes/class-ur-user-approval.php](/browser/user-registration/trunk/includes/class-ur-user-approval.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/class-ur-user-approval.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-checkbox.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-checkbox.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-checkbox.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-date.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-date.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-date.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-number.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-number.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-number.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-password.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-password.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-password.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-text.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-text.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-text.php "Show differences"))
* [trunk/includes/form/class-ur-form-field-textarea.php](/browser/user-registration/trunk/includes/form/class-ur-form-field-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/class-ur-form-field-textarea.php "Show differences"))
* [trunk/includes/form/settings/class-ur-setting-text.php](/browser/user-registration/trunk/includes/form/settings/class-ur-setting-text.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/settings/class-ur-setting-text.php "Show differences"))
* [trunk/includes/form/settings/class-ur-setting-textarea.php](/browser/user-registration/trunk/includes/form/settings/class-ur-setting-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/settings/class-ur-setting-textarea.php "Show differences"))
* [trunk/includes/form/settings/class-ur-setting-user\_login.php](/browser/user-registration/trunk/includes/form/settings/class-ur-setting-user_login.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/settings/class-ur-setting-user_login.php "Show differences"))
* [trunk/includes/form/views/admin/admin-textarea.php](/browser/user-registration/trunk/includes/form/views/admin/admin-textarea.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/form/views/admin/admin-textarea.php "Show differences"))
* [trunk/includes/frontend/class-ur-frontend-form-handler.php](/browser/user-registration/trunk/includes/frontend/class-ur-frontend-form-handler.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/frontend/class-ur-frontend-form-handler.php "Show differences"))
* [trunk/includes/functions-ur-core.php](/browser/user-registration/trunk/includes/functions-ur-core.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/functions-ur-core.php "Show differences"))
* [trunk/includes/functions-ur-page.php](/browser/user-registration/trunk/includes/functions-ur-page.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/functions-ur-page.php "Show differences"))
* [trunk/includes/functions-ur-template.php](/browser/user-registration/trunk/includes/functions-ur-template.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/functions-ur-template.php "Show differences"))
* [trunk/includes/shortcodes/class-ur-shortcode-my-account.php](/browser/user-registration/trunk/includes/shortcodes/class-ur-shortcode-my-account.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/shortcodes/class-ur-shortcode-my-account.php "Show differences"))
* [trunk/includes/stats/class-ur-stats.php](/browser/user-registration/trunk/includes/stats/class-ur-stats.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/stats/class-ur-stats.php "Show differences"))
* [trunk/includes/validation/class-ur-validation.php](/browser/user-registration/trunk/includes/validation/class-ur-validation.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/includes/validation/class-ur-validation.php "Show differences"))
* [trunk/languages/user-registration.pot](/browser/user-registration/trunk/languages/user-registration.pot?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/languages/user-registration.pot "Show differences"))
* [trunk/readme.txt](/browser/user-registration/trunk/readme.txt?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/readme.txt "Show differences"))
* [trunk/user-registration.php](/browser/user-registration/trunk/user-registration.php?rev=3070439 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/3070439/user-registration/trunk/user-registration.php "Show differences"))

**Changeset view not shown**, since the total size (10.7 MB) exceeds
[4.0 MB](/wiki/TracIni#changeset-max_diff_bytes-option)

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3070439)
* [Zip Archive](?format=zip&new=3070439)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_4ad6190e_20250111_194240.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# User Registration – Custom Registration Form, Login Form, and User Profile WordPress Plugin <= 3.1.5 - Missing Authorization to Unauthenticated Media Deletion

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   User Registration – Custom Registration Form, Login Form, and User Profile WordPress Plugin <= 3.1.5 - Missing Authorization to Unauthenticated Media Deletion

6.5

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L)

| CVE | [CVE-2024-3295](https://www.cve.org/CVERecord?id=CVE-2024-3295) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | April 15, 2024 |
| Last Updated | May 2, 2024 |
| Researcher | [wesley (wcraft)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/wesley-jhon) |

### Description

The User Registration – Custom Registration Form, Login Form, and User Profile WordPress Plugin plugin for WordPress is vulnerable to unauthorized loss of data due to a missing capability check on the profile\_pic\_remove function in versions up to, and including, 3.1.5. This makes it possible for unauthenticated attackers to delete any media file.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/user-registration/tags/3.1.5/includes/class-ur-ajax.php#L1111)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/user-registration/trunk/includes/class-ur-ajax.php?rev=3070439#L1115)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3070439/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-custom-registration-form-login-form-and-user-profile-wordpress-plugin-315-missing-authorization-to-unauthenticated-media-deletion&t=User%20Registration%20%E2%80%93%20Custom%20Registration%20Form%2C%20Login%20Form%2C%20and%20User%20Profile%20WordPress%20Plugin%20%3C%3D%203.1.5%20-%20Missing%20Authorization%20to%20Unauthenticated%20Media%20Deletion "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-custom-registration-form-login-form-and-user-profile-wordpress-plugin-315-missing-authorization-to-unauthenticated-media-deletion&text=User%20Registration%20%E2%80%93%20Custom%20Registration%20Form%2C%20Login%20Form%2C%20and%20User%20Profile%20WordPress%20Plugin%20%3C%3D%203.1.5%20-%20Missing%20Authorization%20to%20Unauthenticated%20Media%20Deletion "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fuser-registration%2Fuser-registration-custom-registration-form-login-form-and-user-profile-wordpress-plugin-315-missing-authorization-to-unauthenticated-media-deletion "LinkedIn")
Email

## Vulnerability Details for User Registration & Membership – Custom Registration Form, Login Form, and User Profile

#### [User Registration & Membership – Custom Registration Form, Login Form, and User Profile](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/user-registration)

| Software Type | Plugin |
| --- | --- |
| Software Slug | user-registration [(view on wordpress.org)](https://wordpress.org/plugins/user-registration) |
| Patched? | Yes |
| Remediation | Update to version 3.2.0, or a newer patched version |
| Affected Version | * <= 3.1.5 |
| Patched Version | * 3.2.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


