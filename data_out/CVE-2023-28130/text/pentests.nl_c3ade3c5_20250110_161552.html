
   [![Pentests](/img/pentests_logo_powered_by_hackify.svg)](/)

* [Pentest](/pentest/wat-is-een-pentest/ "Wat is een pentest")
  + [Webapplicatie](/pentest/webapplicatie-pentest-website/ "Webapplicatie penetratietest")
  + [Bedrijfsnetwerk](/pentest/bedrijfsnetwerk-pentest-infrastructuur/ "Bedrijfsnetwerk pentest")
  + [Attack Surface](/pentest/attack-surface-pentest-exposure-onderzoek/ "Attack Surface pentest – Exposure onderzoek")
  + [Mobile app](/pentest/mobiele-app-pentest/ "Pentest mobiele applicatie")
  + [API pentest](/pentest/api-pentest-uitvoeren/ "API pentest uitvoeren")
  + [Ransomware](/pentest/pentest-ransomware-voorkomen-penetratietest/)
  + [Infrastructuur](/pentest/infrastructuur-pentest/)
  + [Azure pentest](/pentest/azure-pentest-uitvoeren/)
* [Compliance](/pentest/norea-digid-pentest-audit/ "Pentests voor regelgeving")
  + [DigiD pentest](/pentest/norea-digid-pentest-audit/ "DigiD penetratietest")
  + [BIO pentest](/pentest/wat-is-een-bio-ensia-penetratietest/ "BIO penetratietest")
  + [ISO 27001 pentest](/pentest/iso-27001-pentest/ "ISO pentest")
  + [PCI DSS pentest](/pentest/pci-dss-pentest-laten-uitvoeren/ "PCI DSS Pentest laten uitvoeren")
  + [NIS2 pentest](/pentest/nis2-pentest-het-wat-en-waarom/ "NIS2 pentest")
* [Overig](/pentest-begrippen/ "Pentest overig")
  + [Pentest uitvoeren](/pentest/pentest-uitvoeren/ "Pentest laten uitvoeren")
    - [White box pentest](/pentest/white-box-pentest-uitvoeren-de-voor-en-nadelen/ "White box pentest uitvoeren")
    - [Grey box pentest](/pentest/grey-box-pentest-uitvoeren-de-voor-en-nadelen/ "Grey box pentest uitvoeren")
    - [Black box pentest](/pentest/black-box-pentest-uitvoeren-de-voor-en-nadelen/ "Black box pentest uitvoeren")
  + [Pentest begrippen](/pentest-begrippen/ "Pentest begrippenlijst")
  + [Penetratietest](/penetratietest/ "Wat is een penetratietest?")
  + [Pentest bedrijven](/pentest/pentest-bedrijven-nederland/)
  + [Ethical hacker inhuren](/pentest/ethical-hacker-inhuren/)
  + [Pentest kosten](/pentest/pentest-kosten/ "Pentest kosten: wat kost een penetratietest")
  + [Vulnerability scan](/pentest/kwetsbaarheidsscan-uitvoeren-het-wat-en-waarom/ "Kwetsbaarheidsscan of vulnerability scan uitvoeren: het wat en waarom")
* [Blog](/pentest-blog/ "Pentest blog")
* [Pentest aanvragen](/contact/ "Pentest aanvragen")
 Select Page

# Wij zijn |

# CVE-2023-28130 – Command Injection in Check Point Gaia Portal

[Pentests.nl](https://pentests.nl/) has discovered a vulnerability in Check Point Gaia Portal which allows an authenticated user with write permissions on the DNS settings to inject commands in a cgi script to get remote code execution on the operating system.

### **About Check Point Gaia Portal**

[Gaia](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_AdminGuide/Topics-GAG/Gaia-Overview.htm)is a unified security Operating System that combines the best of Check Point original operating systems, and IPSO, the operating system from appliance security products. Gaia is available for all Check Point Security Appliances and Open Servers.

[Gaia Portal](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_Gaia_AdminGuide/Topics-GAG/Gaia-Portal-Introduction.htm) is an advanced, web-based interface for Gaia platform configuration. You can do almost all system configuration tasks through this Web-based interface.

### **Overview**

The parameter hostname in the web request /cgi-bin/hosts\_dns.tcl is vulnerable for command injection. This can be exploited by any user with a valid session, as long as the user has write permissions on the DNS settings. The injected commands are executed by the user ‘Admin’.

![Command injection - curl](data:image/svg+xml...)![Command injection - curl](/img/Command_injection_curl.gif)

### **Analysis**

The vulnerability was discovered during one of our routine [web application pentests](/pentest/webapplicatie-pentest-website/). During each [pentest](/pentest/wat-is-een-pentest/), we treat every input field as potentially vulnerable. Improper use of user input can lead to various types of injection vulnerabilities. Therefore, we often test input fields for various types of injections, such as SQL injection, Cross-Site Scripting, Template Injection, xxx injection, and Command Injection. The latter, Command Injection, is what is happening here.

By appending the following sequence behind the value of the hostname parameter: |`command here`, the command is executed. We discovered this during a [grey box pentest](/pentest/grey-box-pentest-uitvoeren-de-voor-en-nadelen/), without inspecting the code.

If we do inspect the code, we see the following.

cat /web/cgi-bin2/hosts\_dns.tcl

```
#!/usr/bin/ipstcl2

source debug.tcl
variable dFile "/tmp/hosts_dns.post.debug"

namespace eval ::hosts {

    if {[catch {libdb init -local} myDb]} {
        #failed to initialize!!!
        lappend err_list "Unable to connect to database ${myDb}"
        exit
    }
    ipso -nohtml
    set method [get_Method]
    MIME text
    printDebug

    # URL argument to indicate which data is needed
    set option [getVal option]

    global Q_Names
    if {$method == "POST"} {

        source validate.tcl
        source subs.tcl
        source showResult.tcl

        set result 0
        set error_flag 0
        set err_list [list]
        set set_list [list]

        set result [Validate $Q_Data err_list]
        if {$result == 0} {
            foreach var $Q_Names {

                if {$var == "domainname"} {
                    lappend set_list domainname [getVal $var]
                } elseif {$var == "suffix"} {
                    lappend set_list resolv:domain:1 [getVal $var]
                }
                [...]
                } elseif {$var == "hostname"} {
                    lappend set_list machine:hostname [getVal $var]
                }
                [...]

                if {$var == "save"} {
                    lappend set_list :save ""
                }
            }
        }

        dmsg "set_list: $set_list"
        if {[llength $set_list] > 0} {
            set cmd [concat [list libdb set $myDb -list ] $set_list]
            set result [catch $cmd err_list]
        }

        dmsg "Result: $result"
        dmsg "err_list: $err_list"
        set buf [::showResult::generateJson $result [getVal save] $err_list]

        HTML $buf
        dmsg $buf
    } else {
# GET
    source json.tcl
```

If it is a POST request, all variables are passed through an if elseif. We pass a total of 3 parameters: hostname, domainname, and save. With the hostname parameter, the value machine: hostname *<hostname\_value>* is added to the set\_list list. The other parameter we pass in the web request is domainname, which adds the value domainname *<domainname\_value>* to the list. Our last parameter, save, is set to true, which adds the value :save to the set\_list list. The final value of the set\_list list is:

```
machine:hostname <hostname_value> domainname <domainname_value> :save
```

Next, the line with set cmd [concat [list libdb set $myDb -list ] $set\_list] is executed. Here, the variable cmd is assigned the following value:

```
libdb set db_0 -list machine:hostname <hostname_value> domainname <domainname_value> :save.
```

In the subsequent line, catch is invoked with the value of the cmd list. catch executes a program/process and returns the exit code.

```
set result [catch $cmd err_list]
```

Down the chain, the input is used to modify the hostname. The input is used as is, without first sanitizing it. This makes it possible to specify an additional command using the pipe character and a backtick, which is then executed alongside the valid\_token\_checker process.

The vulnerability could be leveraged to gain access to the server, as can be seen in the following gif.

![Command injection reverse shell](data:image/svg+xml...)![Command injection reverse shell](/img/Command_injection_shell.gif)

### **Impact**

Successful exploitation allows an authenticated attacker to execute commands on the operating system.

CVSS score: *8.4 High*
CVSS string: [3.1/AV:A/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H)

### **Remediation**

Update to the latest version. JHF releases should be available for all affected versions by now. Detailed steps on how to update can be found [here](https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92449&partition=Basic&product=Multi-Domain).

### **Disclosure timeline**

08 Mar 2023 – Bug discovered, initial report to Check Point team
09 Mar 2023 – Vulnerability acknowledgement by Check Point
23 Mar 2023 – Check Point created a fix and getting it ready for release
03 Apr 2023 – Private fix was released
April/May/June 2023 – Public JHF releases for all affected versions
July 2023 – Full disclosure

### **References**

<https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk92449&partition=Basic&product=Multi-Domain>

<https://support.checkpoint.com/results/sk/sk181311>

### Hoe kunnen wij u helpen?

 [Contact](/contact/)

[![S Icon White](data:image/svg+xml...)![S Icon White](/img/Pentests-logo-S.svg)](/pentest/waarom-een-pentest-van-pentests-nl/)
#### [Waarom pentests.nl?](/pentest/waarom-een-pentest-van-pentests-nl/)

[![S Icon White](data:image/svg+xml...)![S Icon White](/img/Webapplicatie-pentest.svg)](/pentest/webapplicatie-pentest-website/)
#### [Webapplicatie pentest](/pentest/webapplicatie-pentest-website/)

[![Bedrijfsnetwerk Penetratietest](data:image/svg+xml...)![Bedrijfsnetwerk Penetratietest](/img/Bedrijfsnetwerk-pentest.svg)](/pentest/bedrijfsnetwerk-pentest-infrastructuur/)
#### [Bedrijfsnetwerk pentest](/pentest/bedrijfsnetwerk-pentest-infrastructuur/)

[![Digid Audit Icon](data:image/svg+xml...)![Digid Audit Icon](/img/DigiD-pentest.svg)](/pentest/norea-digid-pentest-audit/)
#### [DigiD pentest](/pentest/norea-digid-pentest-audit/)

[![API pentest icon](data:image/svg+xml...)![API pentest icon](/img/API_pentest.svg)](/pentest/api-pentest-uitvoeren/)
#### [API pentest](/pentest/api-pentest-uitvoeren/)

[![Attack Surface Pentest](data:image/svg+xml...)![Attack Surface Pentest](/img/Attack-Surface-pentest.svg)](/pentest/attack-surface-pentest-exposure-onderzoek/)
#### [Attack surface pentest](/pentest/attack-surface-pentest-exposure-onderzoek/)

[![Mobiele pentest icon](data:image/svg+xml...)![Mobiele pentest icon](/img/Icon-mobiele-app-pentest.svg)](/pentest/mobiele-app-pentest/)
#### [Mobiele app pentest](/pentest/mobiele-app-pentest/)

[![bio pentest](data:image/svg+xml...)![bio pentest](/img/checklist_bio.svg)](/pentest/wat-is-een-bio-ensia-penetratietest/)
#### [BIO pentest](/pentest/wat-is-een-bio-ensia-penetratietest/)

## [QR Codes: Het onverwachte wapen in Device Code Phishing](/pentest-blog/qr-codes-het-onverwachte-wapen-in-device-code-phishing/)

Device code phishing, net als aanvallen via Adversary-in-the-middle (AiTM), vertegenwoordigt een geavanceerde vorm van cyberdreiging die zich onderscheidt van traditionele phishing. Device code phishing exploiteert de ‘OAuth2 Device Authorization Grant flow‘ van Microsoft Azure, die gebruikers in staat stelt zich aan te melden bij apparaten met beperkte invoermogelijkheden.

[read more](/pentest-blog/qr-codes-het-onverwachte-wapen-in-device-code-phishing/)
## [Cross-Site Scripting (XSS): wat is het en hoe te voorkomen](/pentest-blog/cross-site-scripting-wat-is-het-en-hoe-te-voorkomen/)

In deze blogpost lees je alles over Cross-Site Scripting (XSS). Welke vormen van XSS er zijn. Wat de impact van een XSS-aanval kan zijn en hoe je het kan voorkomen.

[read more](/pentest-blog/cross-site-scripting-wat-is-het-en-hoe-te-voorkomen/)
## [CORS: het belang van Cross-Origin Resource Sharing](/pentest-blog/cors-het-belang-van-cross-origin-resource-sharing/)

Bij onze klanten zien we een toenemende implementatie van Cross-Origin Resource Sharing (CORS). Helaas constateren we ook een stijging in het aantal onveilig geconfigureerde CORS-implementaties. In deze blog duiken we dieper in wat CORS is, de meest voorkomende misconfiguraties en hun potentiële risico’s, en hoe je sterke CORS-regels kunt instellen om je webapplicaties te beschermen.

[read more](/pentest-blog/cors-het-belang-van-cross-origin-resource-sharing/)

 ![Logo van pentests in het wit](data:image/svg+xml... "pentests_logo_powered_by_hackify_white")![Logo van pentests in het wit](/img/pentests_logo_powered_by_hackify_white.svg "pentests_logo_powered_by_hackify_white")

+31 85 050 8055
[[email protected]](/cdn-cgi/l/email-protection#4c2f2322382d2f380c3c292238293f383f622220)
KVK: 85690449
BTW: NL863708377B01

### Pentest

[Ransomware Pentest](/pentest/pentest-ransomware-voorkomen-penetratietest/)
 [Infrastructuur Pentest](/pentest/infrastructuur-pentest/)
 [Webapplicatie Pentest](/pentest/webapplicatie-pentest-website/)
 [Bedrijfsnetwerk Pentest](/pentest/bedrijfsnetwerk-pentest-infrastructuur/)

### Compliance

[BIO / ENSIA Pentest](/pentest/wat-is-een-bio-ensia-penetratietest/)
[DigiD Pentest](/pentest/norea-digid-pentest-audit/)
[ISO 27001 Pentest](/pentest/iso-27001-pentest/)
[PCI DSS Pentest](/pentest/pci-dss-pentest-laten-uitvoeren/)

### Overig

[Pentest Uitvoeren](/pentest/pentest-uitvoeren/)
 [Pentest Begrippen](/pentest-begrippen/)
 [Pentest Blog](/pentest-blog/)
 [Penetratietest](/penetratietest/)
 [Pentest Bedrijven](/pentest/pentest-bedrijven-nederland/)

### Publicaties

## [QR Codes: Het onverwachte wapen in Device Code Phishing](/pentest-blog/qr-codes-het-onverwachte-wapen-in-device-code-phishing/)

## [Cross-Site Scripting (XSS): wat is het en hoe te voorkomen](/pentest-blog/cross-site-scripting-wat-is-het-en-hoe-te-voorkomen/)

## [CORS: het belang van Cross-Origin Resource Sharing](/pentest-blog/cors-het-belang-van-cross-origin-resource-sharing/)

[© Pentests.](//pentests.nl)All Rights Reserved. Powered by [Hackify B.V.](//hackify.nl)

* [Follow](https://www.youtube.com/channel/UCKO0N2S8rsT5DN0sA2lV1Tw "Follow on Youtube")
* [Follow](https://twitter.com/PentestsNL "Follow on Twitter")
* [Follow](https://linktr.ee/pentests.nl "Follow on Yelp")
* [Follow](https://pinterest.com/pentestsNL/ "Follow on Pinterest")
* [Follow](/sitemap.xml "Follow on Bandcamp")
* [Follow](https://nl.linkedin.com/company/hackify-nl "Follow on LinkedIn")

