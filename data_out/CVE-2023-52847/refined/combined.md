=== Content from git.kernel.org_09073570_20250111_151527.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 11:06:54 +0100 |
| commit | [2f3d9198cdae1cb079ec8652f4defacd481eab2b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)) | |
| tree | [f0e22135302da44d683c7e2094b0a5757fe9c447](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b) | |
| parent | [0627e8623eb5dbcbd54a30b3d3fd140b8eb95a6e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0627e8623eb5dbcbd54a30b3d3fd140b8eb95a6e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b&id2=0627e8623eb5dbcbd54a30b3d3fd140b8eb95a6e)) | |
| download | [linux-2f3d9198cdae1cb079ec8652f4defacd481eab2b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2f3d9198cdae1cb079ec8652f4defacd481eab2b.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 1f0e4b913a0534..5f1bd9b38e75fd 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=0627e8623eb5dbcbd54a30b3d3fd140b8eb95a6e)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=2f3d9198cdae1cb079ec8652f4defacd481eab2b)@@ -4258,6 +4258,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:05 +0000



=== Content from git.kernel.org_8363eed5_20250111_151528.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 11:08:27 +0100 |
| commit | [51c94256a83fe4e17406c66ff3e1ad7d242d8574](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)) | |
| tree | [8fcafa2f2071d6dc11164141617b8e5ada459937](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574) | |
| parent | [d3937f9e25d9060e5df81a27eefac2b63a2d3c4d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d3937f9e25d9060e5df81a27eefac2b63a2d3c4d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574&id2=d3937f9e25d9060e5df81a27eefac2b63a2d3c4d)) | |
| download | [linux-51c94256a83fe4e17406c66ff3e1ad7d242d8574.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-51c94256a83fe4e17406c66ff3e1ad7d242d8574.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 661ebfa7bf3f50..c4bf7b7109ce44 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=d3937f9e25d9060e5df81a27eefac2b63a2d3c4d)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=51c94256a83fe4e17406c66ff3e1ad7d242d8574)@@ -4250,6 +4250,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:05 +0000



=== Content from git.kernel.org_a261a4a6_20250111_151527.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=20568d06f6069cb835e05eed432edf962645d226)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20568d06f6069cb835e05eed432edf962645d226)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20568d06f6069cb835e05eed432edf962645d226)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20568d06f6069cb835e05eed432edf962645d226)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 11:52:14 +0100 |
| commit | [20568d06f6069cb835e05eed432edf962645d226](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20568d06f6069cb835e05eed432edf962645d226) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=20568d06f6069cb835e05eed432edf962645d226)) | |
| tree | [85c1ad92f649822fdf5e4031731075d52f735f2a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20568d06f6069cb835e05eed432edf962645d226) | |
| parent | [825a7a6a3a5e80bb46974c3894703a3b5486efce](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=825a7a6a3a5e80bb46974c3894703a3b5486efce) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20568d06f6069cb835e05eed432edf962645d226&id2=825a7a6a3a5e80bb46974c3894703a3b5486efce)) | |
| download | [linux-20568d06f6069cb835e05eed432edf962645d226.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-20568d06f6069cb835e05eed432edf962645d226.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20568d06f6069cb835e05eed432edf962645d226)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=20568d06f6069cb835e05eed432edf962645d226) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex d40b537f4e98be..24ba5729969dcf 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=825a7a6a3a5e80bb46974c3894703a3b5486efce)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=20568d06f6069cb835e05eed432edf962645d226)@@ -4248,6 +4248,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:04 +0000



=== Content from git.kernel.org_66467639_20250111_151526.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 11:57:20 +0100 |
| commit | [1871014d6ef4812ad11ef7d838d73ce09d632267](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1871014d6ef4812ad11ef7d838d73ce09d632267) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)) | |
| tree | [fe2e212c10a0a1af25b9b3f0cddb2c7e1599ee22](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1871014d6ef4812ad11ef7d838d73ce09d632267) | |
| parent | [b43848690b3f10407fb38ff290effdb36edae4ac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b43848690b3f10407fb38ff290effdb36edae4ac) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1871014d6ef4812ad11ef7d838d73ce09d632267&id2=b43848690b3f10407fb38ff290effdb36edae4ac)) | |
| download | [linux-1871014d6ef4812ad11ef7d838d73ce09d632267.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1871014d6ef4812ad11ef7d838d73ce09d632267.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1871014d6ef4812ad11ef7d838d73ce09d632267)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=1871014d6ef4812ad11ef7d838d73ce09d632267) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 734f02b91aa31c..a50cae25b54636 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=b43848690b3f10407fb38ff290effdb36edae4ac)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=1871014d6ef4812ad11ef7d838d73ce09d632267)@@ -3830,6 +3830,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:03 +0000



=== Content from git.kernel.org_09dc2057_20250111_151530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 10:29:20 +0100 |
| commit | [bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)) | |
| tree | [58ed6518196aad04ead8014a2e3c31f2ff087f88](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) | |
| parent | [ac6d92fbec0de6cad6b701bcb4ff35943baed69b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac6d92fbec0de6cad6b701bcb4ff35943baed69b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9&id2=ac6d92fbec0de6cad6b701bcb4ff35943baed69b)) | |
| download | [linux-bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 2a9d25431d7332..fce894574c4117 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=ac6d92fbec0de6cad6b701bcb4ff35943baed69b)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)@@ -4300,6 +4300,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:07 +0000



=== Content from git.kernel.org_f8fd3a1f_20250111_151529.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 10:30:15 +0100 |
| commit | [b35fdade92c5058a5e727e233fe263b828de2c9a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b35fdade92c5058a5e727e233fe263b828de2c9a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)) | |
| tree | [de6152ee34c93334356c2b25d4331560a2990eb5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b35fdade92c5058a5e727e233fe263b828de2c9a) | |
| parent | [0bc0e36fccc2785d0bde5612ef403a5fd0654df6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0bc0e36fccc2785d0bde5612ef403a5fd0654df6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b35fdade92c5058a5e727e233fe263b828de2c9a&id2=0bc0e36fccc2785d0bde5612ef403a5fd0654df6)) | |
| download | [linux-b35fdade92c5058a5e727e233fe263b828de2c9a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b35fdade92c5058a5e727e233fe263b828de2c9a.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b35fdade92c5058a5e727e233fe263b828de2c9a)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=b35fdade92c5058a5e727e233fe263b828de2c9a) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 6441e7d63d9718..a0be1ca89b29a5 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=0bc0e36fccc2785d0bde5612ef403a5fd0654df6)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=b35fdade92c5058a5e727e233fe263b828de2c9a)@@ -4258,6 +4258,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:07 +0000



=== Content from git.kernel.org_fe4d61c2_20250111_151530.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2023-09-27 09:40:01 +0200 |
| commit | [bd5b50b329e850d467e7bcc07b2b6bde3752fbda](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)) | |
| tree | [8cccb239731161cc5d012b33a1af0185cb3641c4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) | |
| parent | [56e9e480b6f2b8790798a89a5a8419683164cb17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56e9e480b6f2b8790798a89a5a8419683164cb17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda&id2=56e9e480b6f2b8790798a89a5a8419683164cb17)) | |
| download | [linux-bd5b50b329e850d467e7bcc07b2b6bde3752fbda.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bd5b50b329e850d467e7bcc07b2b6bde3752fbda.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timerThere may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex aa708a0e5eac67..09a193bb87df31 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=56e9e480b6f2b8790798a89a5a8419683164cb17)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)@@ -3474,6 +3474,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:08 +0000



=== Content from git.kernel.org_0a68ce45_20250111_151529.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=847599fffa528b2cdec4e21b6bf7586dad982132)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=847599fffa528b2cdec4e21b6bf7586dad982132)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=847599fffa528b2cdec4e21b6bf7586dad982132)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=847599fffa528b2cdec4e21b6bf7586dad982132)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 11:59:32 +0100 |
| commit | [847599fffa528b2cdec4e21b6bf7586dad982132](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=847599fffa528b2cdec4e21b6bf7586dad982132) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=847599fffa528b2cdec4e21b6bf7586dad982132)) | |
| tree | [8413a2931c479699a7757adeb4cfaf7adca14962](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=847599fffa528b2cdec4e21b6bf7586dad982132) | |
| parent | [f9f6e9cb998543c2610e3ba134256666beda8036](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f9f6e9cb998543c2610e3ba134256666beda8036) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=847599fffa528b2cdec4e21b6bf7586dad982132&id2=f9f6e9cb998543c2610e3ba134256666beda8036)) | |
| download | [linux-847599fffa528b2cdec4e21b6bf7586dad982132.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-847599fffa528b2cdec4e21b6bf7586dad982132.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=847599fffa528b2cdec4e21b6bf7586dad982132)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=847599fffa528b2cdec4e21b6bf7586dad982132) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex aa708a0e5eac67..09a193bb87df31 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=f9f6e9cb998543c2610e3ba134256666beda8036)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=847599fffa528b2cdec4e21b6bf7586dad982132)@@ -3474,6 +3474,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:06 +0000


