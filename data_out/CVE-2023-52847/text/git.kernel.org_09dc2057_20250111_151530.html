

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-11-20 10:29:20 +0100 |
| commit | [bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)) | |
| tree | [58ed6518196aad04ead8014a2e3c31f2ff087f88](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) | |
| parent | [ac6d92fbec0de6cad6b701bcb4ff35943baed69b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac6d92fbec0de6cad6b701bcb4ff35943baed69b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9&id2=ac6d92fbec0de6cad6b701bcb4ff35943baed69b)) | |
| download | [linux-bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timer[ Upstream commit bd5b50b329e850d467e7bcc07b2b6bde3752fbda ]
There may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex 2a9d25431d7332..fce894574c4117 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=ac6d92fbec0de6cad6b701bcb4ff35943baed69b)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=bbc3b8dd2cb7817e703f112d988e4f4728f0f2a9)@@ -4300,6 +4300,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:07 +0000

