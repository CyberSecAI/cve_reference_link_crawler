

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zheng Wang <zyytlz.wz@163.com> | 2023-04-13 11:49:42 +0800 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2023-09-27 09:40:01 +0200 |
| commit | [bd5b50b329e850d467e7bcc07b2b6bde3752fbda](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)) | |
| tree | [8cccb239731161cc5d012b33a1af0185cb3641c4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) | |
| parent | [56e9e480b6f2b8790798a89a5a8419683164cb17](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56e9e480b6f2b8790798a89a5a8419683164cb17) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda&id2=56e9e480b6f2b8790798a89a5a8419683164cb17)) | |
| download | [linux-bd5b50b329e850d467e7bcc07b2b6bde3752fbda.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bd5b50b329e850d467e7bcc07b2b6bde3752fbda.tar.gz) | |

media: bttv: fix use after free error due to btv->timeout timerThere may be some a race condition between timer function
bttv\_irq\_timeout and bttv\_remove. The timer is setup in
probe and there is no timer\_delete operation in remove
function. When it hit kfree btv, the function might still be
invoked, which will cause use after free bug.
This bug is found by static analysis, it may be false positive.
Fix it by adding del\_timer\_sync invoking to the remove function.
cpu0 cpu1
bttv\_probe
->timer\_setup
->bttv\_set\_dma
->mod\_timer;
bttv\_remove
->kfree(btv);
->bttv\_irq\_timeout
->USE btv
Fixes: 162e6376ac58 ("media: pci: Convert timers to use timer\_setup()")
Signed-off-by: Zheng Wang <zyytlz.wz@163.com>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)

| -rw-r--r-- | [drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/pci/bt8xx/bttv-driver.c?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/media/pci/bt8xx/bttv-driver.c b/drivers/media/pci/bt8xx/bttv-driver.cindex aa708a0e5eac67..09a193bb87df31 100644--- a/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=56e9e480b6f2b8790798a89a5a8419683164cb17)+++ b/[drivers/media/pci/bt8xx/bttv-driver.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/pci/bt8xx/bttv-driver.c?id=bd5b50b329e850d467e7bcc07b2b6bde3752fbda)@@ -3474,6 +3474,7 @@ static void bttv\_remove(struct pci\_dev \*pci\_dev)  /\* free resources \*/ free\_irq(btv->c.pci->irq,btv);+ del\_timer\_sync(&btv->timeout); iounmap(btv->bt848\_mmio); release\_mem\_region(pci\_resource\_start(btv->c.pci,0), pci\_resource\_len(btv->c.pci,0)); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:14:08 +0000

