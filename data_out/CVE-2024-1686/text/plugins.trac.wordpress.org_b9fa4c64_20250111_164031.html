

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3041096%2Fwoo-thank-you-page-customizer%2Ftrunk%2Ffrontend%2Ffrontend.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3036749/woo-thank-you-page-customizer/trunk/frontend/frontend.php "Changeset 3036749 for woo-thank-you-page-customizer/trunk/frontend/frontend.php")
* [Next Change](/changeset/3069970/woo-thank-you-page-customizer/trunk/frontend/frontend.php "Changeset 3069970 for woo-thank-you-page-customizer/trunk/frontend/frontend.php") →

---

# Changeset [3041096](/changeset/3041096 "Show full changeset") for [woo-thank-you-page-customizer/trunk/frontend/frontend.php](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/26/2024 09:02:09 AM
([11 months](/timeline?from=2024-02-26T09%3A02%3A09Z&precision=second "See timeline at 02/26/2024 09:02:09 AM") ago)

Author:
dragonlord47
Message:

Update security

File:

1 edited

* [woo-thank-you-page-customizer/trunk/frontend/frontend.php](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096 "Show entry in browser")
  (modified)
  ([8 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woo-thank-you-page-customizer/trunk/frontend/frontend.php](/changeset/3041096/woo-thank-you-page-customizer/trunk/frontend/frontend.php "Show the changeset 3041096 restricted to woo-thank-you-page-customizer/trunk/frontend/frontend.php")

  | [r3036749](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L84 "Show revision 3036749 of this file in browser") | [r3041096](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L84 "Show revision 3041096 of this file in browser") |  |
  | --- | --- | --- |
  | 84 | 84 | ) ); |
  | 85 | 85 |  |
  | 86 |  | add\_filter( 'page\_template\_hierarchy', array( $this, 'page\_template\_hierarchy' ), PHP\_INT\_MAX,1 ); |
  |  | 86 | add\_filter( 'page\_template\_hierarchy', array( $this, 'page\_template\_hierarchy' ), PHP\_INT\_MAX, 1 ); |
  | 87 | 87 | add\_filter( 'wc\_get\_template', array( $this, 'wc\_get\_template' ), 99, 5 ); |
  | 88 | 88 | add\_filter( 'woocommerce\_valid\_order\_statuses\_for\_order\_again', array( |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L91) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L91) |  |
  | 91 | 91 | ) ); |
  | 92 | 92 | } |
  | 93 |  | public function page\_template\_hierarchy($templates ) { |
  | 94 |  | if (is\_wc\_endpoint\_url( 'order-received' ) && in\_array('order-confirmation',$templates)) { |
  | 95 |  | unset( $templates[array\_search('order-confirmation', $templates)] ); |
  | 96 |  | } |
  |  | 93 |  |
  |  | 94 | public function page\_template\_hierarchy( $templates ) { |
  |  | 95 | if ( is\_wc\_endpoint\_url( 'order-received' ) && in\_array( 'order-confirmation', $templates ) ) { |
  |  | 96 | unset( $templates[ array\_search( 'order-confirmation', $templates ) ] ); |
  |  | 97 | } |
  |  | 98 |  |
  | 97 | 99 | return $templates; |
  | 98 | 100 | } |
  | 99 | 101 |  |
  | 100 | 102 | public function wc\_get\_template( $located, $template\_name, $args, $template\_path, $default\_path ) { |
  | 101 |  | if ( (~~$this->enable || (!empty($args['order']) && wc\_get\_order($args['order']))~~) && $template\_name === 'checkout/thankyou.php' ) { |
  |  | 103 | if ( ( $this->enable || ( ! empty( $args['order'] ) && wc\_get\_order( $args['order'] ) ) ) && $template\_name === 'checkout/thankyou.php' ) { |
  | 102 | 104 | $located = VI\_WOO\_THANK\_YOU\_PAGE\_TEMPLATES . 'thankyou.php'; |
  | 103 | 105 | } |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L107) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L109) |  |
  | 107 | 109 |  |
  | 108 | 110 | public function get\_text\_editor\_content() { |
  |  | 111 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 112 | return; |
  |  | 113 | } |
  |  | 114 | check\_ajax\_referer( 'viwtp\_send\_email\_ajax\_nonce', 'security' ); |
  | 109 | 115 | $shortcodes = isset( $\_POST['shortcodes'] ) ? array\_map( 'sanitize\_text\_field', $\_POST['shortcodes'] ) : array(); |
  | 110 | 116 | $shortcodes = ! empty( $shortcodes ) ? array\_map( 'stripslashes', $shortcodes ) : array(); |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L175) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L181) |  |
  | 175 | 181 | check\_ajax\_referer( 'viwtp\_send\_email\_ajax\_nonce', 'security' ); |
  | 176 | 182 |  |
  | 177 |  | $headers             = "Content-Type: text/html\r\n"; |
  |  | 183 | $headers             = "Content-Type: text/html\r\n"; |
  | 178 | 184 | $content             = stripslashes( $this->get\_params( 'coupon\_email\_content' ) ); |
  | 179 | 185 | $subject             = stripslashes( $this->get\_params( 'coupon\_email\_subject' ) ); |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L247) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L253) |  |
  | 247 | 253 | public function apply\_layout() { |
  | 248 | 254 | $this->is\_customize\_preview = true; |
  |  | 255 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 256 | return; |
  |  | 257 | } |
  | 249 | 258 | $order\_id                   = isset( $\_POST['order\_id'] ) ? (int) sanitize\_text\_field( $\_POST['order\_id'] ) : ''; |
  | 250 | 259 | $change\_url                 = isset( $\_POST['change\_url'] ) ? sanitize\_text\_field( $\_POST['change\_url'] ) : ''; |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L954) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L963) |  |
  | 954 | 963 | 'shortcodes'     => $this->shortcodes, |
  | 955 | 964 | 'copied\_message' => esc\_html\_\_( 'Coupon code is copied to clipboard.', 'woo-thank-you-page-customizer' ), |
  | 956 |  | 'nonce'           => wp\_create\_nonce( 'viwtp\_send\_email\_ajax\_nonce' ), |
  |  | 965 | 'nonce'          => wp\_create\_nonce( 'viwtp\_send\_email\_ajax\_nonce' ), |
  |  | 966 | 'ajax\_nonce'     => wp\_create\_nonce( 'viwtp\_ajax\_nonce' ), |
  | 957 | 967 | ) ); |
  | 958 | 968 |  |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L1284) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L1294) |  |
  | 1284 | 1294 | public function the\_content( $content ) { |
  | 1285 | 1295 | global $post, $wp\_query, $wp; |
  | 1286 |  | if (~~is\_null($this->is\_customize\_preview))~~{ |
  |  | 1296 | if ( is\_null( $this->is\_customize\_preview ) ) { |
  | 1287 | 1297 | $this->is\_customize\_preview = is\_customize\_preview(); |
  | 1288 | 1298 | } |
  | 1289 |  | if (~~is\_null($this->order\_id) && ! empty( $wp->query\_vars['order-received'] ))~~{ |
  |  | 1299 | if ( is\_null( $this->order\_id ) && ! empty( $wp->query\_vars['order-received'] ) ) { |
  | 1290 | 1300 | $this->order\_id = absint( $wp->query\_vars['order-received'] ); |
  | 1291 | 1301 | } |
  | 1292 |  | if (~~is\_null($this->key) && isset( $\_REQUEST['key'] ))~~{ |
  |  | 1302 | if ( is\_null( $this->key ) && isset( $\_REQUEST['key'] ) ) { |
  | 1293 | 1303 | $this->key = wc\_clean( $\_REQUEST['key'] ); |
  | 1294 | 1304 | } |
  | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3036749#L1923) | […](/browser/woo-thank-you-page-customizer/trunk/frontend/frontend.php?rev=3041096#L1933) |  |
  | 1923 | 1933 | <?php |
  | 1924 | 1934 | do\_action( 'woocommerce\_after\_order\_details', $order ); |
  |  | 1935 |  |
  | 1925 | 1936 | return ob\_get\_clean(); |
  | 1926 | 1937 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3041096)
* [Zip Archive](?format=zip&new=3041096)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

