

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=109e845c1184c9f786d41516348ba3efd9112792)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=109e845c1184c9f786d41516348ba3efd9112792)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=109e845c1184c9f786d41516348ba3efd9112792)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=109e845c1184c9f786d41516348ba3efd9112792)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Carlos Llamas <cmllamas@google.com> | 2024-08-22 18:23:52 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:13:07 +0200 |
| commit | [109e845c1184c9f786d41516348ba3efd9112792](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=109e845c1184c9f786d41516348ba3efd9112792) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=109e845c1184c9f786d41516348ba3efd9112792)) | |
| tree | [12ed3ac8eebfe045a2ec46c08a2e3bffd39b7909](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=109e845c1184c9f786d41516348ba3efd9112792) | |
| parent | [bfc1704d909dc9911a558b1a5833d3d61a43a1f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bfc1704d909dc9911a558b1a5833d3d61a43a1f2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=109e845c1184c9f786d41516348ba3efd9112792&id2=bfc1704d909dc9911a558b1a5833d3d61a43a1f2)) | |
| download | [linux-109e845c1184c9f786d41516348ba3efd9112792.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-109e845c1184c9f786d41516348ba3efd9112792.tar.gz) | |

binder: fix UAF caused by offsets overwritecommit 4df153652cc46545722879415937582028c18af5 upstream.
Binder objects are processed and copied individually into the target
buffer during transactions. Any raw data in-between these objects is
copied as well. However, this raw data copy lacks an out-of-bounds
check. If the raw data exceeds the data section size then the copy
overwrites the offsets section. This eventually triggers an error that
attempts to unwind the processed objects. However, at this point the
offsets used to index these objects are now corrupted.
Unwinding with corrupted offsets can result in decrements of arbitrary
nodes and lead to their premature release. Other users of such nodes are
left with a dangling pointer triggering a use-after-free. This issue is
made evident by the following KASAN report (trimmed):
==================================================================
BUG: KASAN: slab-use-after-free in \_raw\_spin\_lock+0xe4/0x19c
Write of size 4 at addr ffff47fc91598f04 by task binder-util/743
CPU: 9 UID: 0 PID: 743 Comm: binder-util Not tainted 6.11.0-rc4 #1
Hardware name: linux,dummy-virt (DT)
Call trace:
\_raw\_spin\_lock+0xe4/0x19c
binder\_free\_buf+0x128/0x434
binder\_thread\_write+0x8a4/0x3260
binder\_ioctl+0x18f0/0x258c
[...]
Allocated by task 743:
\_\_kmalloc\_cache\_noprof+0x110/0x270
binder\_new\_node+0x50/0x700
binder\_transaction+0x413c/0x6da8
binder\_thread\_write+0x978/0x3260
binder\_ioctl+0x18f0/0x258c
[...]
Freed by task 745:
kfree+0xbc/0x208
binder\_thread\_read+0x1c5c/0x37d4
binder\_ioctl+0x16d8/0x258c
[...]
==================================================================
To avoid this issue, let's check that the raw data copy is within the
boundaries of the data section.
Fixes: 6d98eb95b450 ("binder: avoid potential data leakage when copying txn")
Cc: Todd Kjos <tkjos@google.com>
Cc: stable@vger.kernel.org
Signed-off-by: Carlos Llamas <cmllamas@google.com>
Link: [https://lore.kernel.org/r/20240822182353.2129600-1-cmllamas@google.com](https://lore.kernel.org/r/20240822182353.2129600-1-cmllamas%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=109e845c1184c9f786d41516348ba3efd9112792)

| -rw-r--r-- | [drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/android/binder.c?id=109e845c1184c9f786d41516348ba3efd9112792) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/android/binder.c b/drivers/android/binder.cindex 2d0a24a5650846..2ca71b1d367809 100644--- a/[drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/android/binder.c?id=bfc1704d909dc9911a558b1a5833d3d61a43a1f2)+++ b/[drivers/android/binder.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/android/binder.c?id=109e845c1184c9f786d41516348ba3efd9112792)@@ -3342,6 +3342,7 @@ static void binder\_transaction(struct binder\_proc \*proc, \*/ copy\_size = object\_offset - user\_offset; if (copy\_size && (user\_offset > object\_offset ||+ object\_offset > tr->data\_size || binder\_alloc\_copy\_user\_to\_buffer( &target\_proc->alloc, t->buffer, user\_offset, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:31:20 +0000

