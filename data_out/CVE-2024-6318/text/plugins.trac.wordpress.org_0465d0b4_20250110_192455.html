

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3107741%2Fimgspider)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3076213/imgspider "Changeset 3076213 for imgspider")
* Next Change →

---

# Changeset [3107741](/changeset/3107741 "Show full changeset") for [imgspider](/browser/imgspider?rev=3107741 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
06/26/2024 04:04:33 AM
([7 months](/timeline?from=2024-06-26T04%3A04%3A33Z&precision=second "See timeline at 06/26/2024 04:04:33 AM") ago)

Author:
wbolt
Message:
# 2.3.11

* 紧急修复插件文件bug。

Location:
[imgspider](/browser/imgspider?rev=3107741)
Files:

55 added
3 edited

* [tags/2.3.11](/browser/imgspider/tags/2.3.11?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets](/browser/imgspider/tags/2.3.11/assets?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/block](/browser/imgspider/tags/2.3.11/assets/block?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/block/wb\_block.asset.php](/browser/imgspider/tags/2.3.11/assets/block/wb_block.asset.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/block/wb\_block.js](/browser/imgspider/tags/2.3.11/assets/block/wb_block.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font](/browser/imgspider/tags/2.3.11/assets/font?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font-face.css](/browser/imgspider/tags/2.3.11/assets/font-face.css?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Arial.ttf](/browser/imgspider/tags/2.3.11/assets/font/Arial.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Arial\_Black.ttf](/browser/imgspider/tags/2.3.11/assets/font/Arial_Black.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Comic\_Sans\_MS.ttf](/browser/imgspider/tags/2.3.11/assets/font/Comic_Sans_MS.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Courier\_New.ttf](/browser/imgspider/tags/2.3.11/assets/font/Courier_New.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Georgia.ttf](/browser/imgspider/tags/2.3.11/assets/font/Georgia.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Impact.ttf](/browser/imgspider/tags/2.3.11/assets/font/Impact.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Tahoma.ttf](/browser/imgspider/tags/2.3.11/assets/font/Tahoma.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Times\_New\_Roman.ttf](/browser/imgspider/tags/2.3.11/assets/font/Times_New_Roman.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Trebuchet\_MS.ttf](/browser/imgspider/tags/2.3.11/assets/font/Trebuchet_MS.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/Verdana.ttf](/browser/imgspider/tags/2.3.11/assets/font/Verdana.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/font/consolas-webfont.ttf](/browser/imgspider/tags/2.3.11/assets/font/consolas-webfont.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/img](/browser/imgspider/tags/2.3.11/assets/img?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/img/demo.jpeg](/browser/imgspider/tags/2.3.11/assets/img/demo.jpeg?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/img/icons.png](/browser/imgspider/tags/2.3.11/assets/img/icons.png?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/img/imgspider\_icon.png](/browser/imgspider/tags/2.3.11/assets/img/imgspider_icon.png?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/img/imgspider\_pro\_icon.png](/browser/imgspider/tags/2.3.11/assets/img/imgspider_pro_icon.png?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/wbp\_admin\_imgspy.css](/browser/imgspider/tags/2.3.11/assets/wbp_admin_imgspy.css?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/assets/wbp\_admin\_imgspy.js](/browser/imgspider/tags/2.3.11/assets/wbp_admin_imgspy.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes](/browser/imgspider/tags/2.3.11/classes?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/\_prompt.php](/browser/imgspider/tags/2.3.11/classes/_prompt.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/ajax.class.php](/browser/imgspider/tags/2.3.11/classes/ajax.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/base.class.php](/browser/imgspider/tags/2.3.11/classes/base.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/conf.class.php](/browser/imgspider/tags/2.3.11/classes/conf.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/down.class.php](/browser/imgspider/tags/2.3.11/classes/down.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/image.class.php](/browser/imgspider/tags/2.3.11/classes/image.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/imgspy.admin.php](/browser/imgspider/tags/2.3.11/classes/imgspy.admin.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/plugins\_assets.php](/browser/imgspider/tags/2.3.11/classes/plugins_assets.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/classes/post.class.php](/browser/imgspider/tags/2.3.11/classes/post.class.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/index.php](/browser/imgspider/tags/2.3.11/index.php?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/readme.txt](/browser/imgspider/tags/2.3.11/readme.txt?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting](/browser/imgspider/tags/2.3.11/setting?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets](/browser/imgspider/tags/2.3.11/setting/assets?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/css](/browser/imgspider/tags/2.3.11/setting/assets/css?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/css/app.7fa1ba71.css](/browser/imgspider/tags/2.3.11/setting/assets/css/app.7fa1ba71.css?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/fonts](/browser/imgspider/tags/2.3.11/setting/assets/fonts?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/fonts/element-icons.535877f5.woff](/browser/imgspider/tags/2.3.11/setting/assets/fonts/element-icons.535877f5.woff?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/fonts/element-icons.732389de.ttf](/browser/imgspider/tags/2.3.11/setting/assets/fonts/element-icons.732389de.ttf?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/img](/browser/imgspider/tags/2.3.11/setting/assets/img?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/img/icons.abf3bf80.png](/browser/imgspider/tags/2.3.11/setting/assets/img/icons.abf3bf80.png?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js](/browser/imgspider/tags/2.3.11/setting/assets/js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/app.1994e15f.js](/browser/imgspider/tags/2.3.11/setting/assets/js/app.1994e15f.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-2d0c796d.90ec63ba.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-2d0c796d.90ec63ba.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-2d213186.39311ac0.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-2d213186.39311ac0.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-2d21dc13.b955e2a9.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-2d21dc13.b955e2a9.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-2d21eb84.5fddacd0.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-2d21eb84.5fddacd0.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-f5319ac8.00219001.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-f5319ac8.00219001.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/assets/js/chunk-vendors.4d5ceb48.js](/browser/imgspider/tags/2.3.11/setting/assets/js/chunk-vendors.4d5ceb48.js?rev=3107741 "Show entry in browser")
  (added)
* [tags/2.3.11/setting/index.html](/browser/imgspider/tags/2.3.11/setting/index.html?rev=3107741 "Show entry in browser")
  (added)
* [trunk/classes/post.class.php](/browser/imgspider/trunk/classes/post.class.php?rev=3107741 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [trunk/index.php](/browser/imgspider/trunk/index.php?rev=3107741 "Show entry in browser")
  (modified)
  ([2 diffs](#file56 "Show differences"))
* [trunk/readme.txt](/browser/imgspider/trunk/readme.txt?rev=3107741 "Show entry in browser")
  (modified)
  ([2 diffs](#file57 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [imgspider/trunk/classes/post.class.php](/changeset/3107741/imgspider/trunk/classes/post.class.php "Show the changeset 3107741 restricted to imgspider/trunk/classes/post.class.php")

  | [r3076213](/browser/imgspider/trunk/classes/post.class.php?rev=3076213#L74 "Show revision 3076213 of this file in browser") | [r3107741](/browser/imgspider/trunk/classes/post.class.php?rev=3107741#L74 "Show revision 3107741 of this file in browser") |  |
  | --- | --- | --- |
  | 74 | 74 | $image\_path = wp\_parse\_url($image\_url, PHP\_URL\_PATH); |
  | 75 | 75 | $filename =  basename($image\_path); |
  | 76 |  | if(!preg\_match('#\.(jpg|jpeg|gif|png)$#i',$filename)){ |
  | 77 |  |  |
  |  | 76 | if(!preg\_match('#\.(jpg|jpeg|gif|png|webp)$#i',$filename)){ |
  |  | 77 | $ext = '.jpg'; |
  | 78 | 78 | if(preg\_match('#wx\_fmt=([a-z]+)#',$image\_url,$m)){ |
  | 79 |  | $filename .= '.'.$m[1]; |
  | 80 |  | }else{ |
  | 81 |  | $filename .= '.jpg'; |
  | 82 |  | } |
  | 83 |  | } |
  |  | 79 | if(preg\_match('#^(jpg|jpeg|gif|png|webp)$#i', $m[1])){ |
  |  | 80 | $ext = '.'.$m[1]; |
  |  | 81 | } |
  |  | 82 | } |
  |  | 83 | $filename .= $ext; |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 |  |
  | 84 | 87 |  |
  | 85 | 88 | $filename = urldecode($filename); |
  | 86 | 89 | $filename = str\_replace(array('%20',' '), '\_', $filename); |
  | 87 | 90 | $filename =  str\_replace('\*','',$filename); |
  |  | 91 |  |
  |  | 92 | add\_filter('upload\_mimes', function ( $mimes){ |
  |  | 93 | $site\_exts  = explode( ' ', 'jpg jpeg png gif webp' ); |
  |  | 94 | $site\_mimes = array(); |
  |  | 95 | foreach ( $site\_exts as $ext ) { |
  |  | 96 | foreach ( $mimes as $ext\_pattern => $mime ) { |
  |  | 97 | if ( '' !== $ext && str\_contains( $ext\_pattern, $ext ) ) { |
  |  | 98 | $site\_mimes[ $ext\_pattern ] = $mime; |
  |  | 99 | } |
  |  | 100 | } |
  |  | 101 | } |
  |  | 102 | return $site\_mimes; |
  |  | 103 | }); |
  |  | 104 | $validate = wp\_check\_filetype($filename); |
  |  | 105 | if($validate['type'] === false){ |
  |  | 106 | $filename .= '.jpg'; |
  |  | 107 | } |
  | 88 | 108 |  |
  | 89 | 109 |  |
* ## [imgspider/trunk/index.php](/changeset/3107741/imgspider/trunk/index.php "Show the changeset 3107741 restricted to imgspider/trunk/index.php")

  | [r3076213](/browser/imgspider/trunk/index.php?rev=3076213#L3 "Show revision 3076213 of this file in browser") | [r3107741](/browser/imgspider/trunk/index.php?rev=3107741#L3 "Show revision 3107741 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Plugin Name: IMGspider |
  | 4 | 4 | Plugin URI: http://wordpress.org/plugins/imgspider/ |
  | 5 |  | Version: 2.3.1~~0~~ |
  |  | 5 | Version: 2.3.11 |
  | 6 | 6 | Description: IMGspider（图片蜘蛛）是一款用于WordPress文章图片抓取的WordPress插件，支持JPG, JPEG, PNG, GIF, BMP, TIF等常见图片爬取下载，实现一键抓取文章内容所有引用图片到本地服务器。 |
  | 7 | 7 | Author: 闪电博 |
  | […](/browser/imgspider/trunk/index.php?rev=3076213#L16) | […](/browser/imgspider/trunk/index.php?rev=3107741#L16) |  |
  | 16 | 16 | define('IMGSPY\_PATH', dirname(\_\_FILE\_\_)); |
  | 17 | 17 | define('IMGSPY\_BASE\_FILE', \_\_FILE\_\_); |
  | 18 |  | define('IMGSPY\_VERSION', '2.3.1~~0~~'); |
  |  | 18 | define('IMGSPY\_VERSION', '2.3.11'); |
  | 19 | 19 | define('IMGSPY\_CODE', 'imgspider-pro'); |
  | 20 | 20 | define('IMGSPY\_URI', plugin\_dir\_url(IMGSPY\_BASE\_FILE)); |
* ## [imgspider/trunk/readme.txt](/changeset/3107741/imgspider/trunk/readme.txt "Show the changeset 3107741 restricted to imgspider/trunk/readme.txt")

  | [r3076213](/browser/imgspider/trunk/readme.txt?rev=3076213#L5 "Show revision 3076213 of this file in browser") | [r3107741](/browser/imgspider/trunk/readme.txt?rev=3107741#L5 "Show revision 3107741 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 5.6 |
  | 6 | 6 | Tested up to: 6.5 |
  | 7 |  | Stable tag: 2.3.1~~0~~ |
  |  | 7 | Stable tag: 2.3.11 |
  | 8 | 8 | License: GNU General Public License v2.0 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/imgspider/trunk/readme.txt?rev=3076213#L192) | […](/browser/imgspider/trunk/readme.txt?rev=3107741#L192) |  |
  | 192 | 192 |  |
  | 193 | 193 | == Changelog == |
  |  | 194 |  |
  |  | 195 | = 2.3.11 = |
  |  | 196 | \* 紧急修复插件文件bug。 |
  | 194 | 197 |  |
  | 195 | 198 | = 2.3.10 = |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3107741)
* [Zip Archive](?format=zip&new=3107741)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

