

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:04:48 +0100 |
| commit | [502e1146873d870f87da3b8f93d6bf2de5f38d0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)) | |
| tree | [1d20219f204b489867082eb691a7ea1aed983c4d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) | |
| parent | [8c64ae0b6e6126fda9c291ae18c21ee98e12f523](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c64ae0b6e6126fda9c291ae18c21ee98e12f523) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c&id2=8c64ae0b6e6126fda9c291ae18c21ee98e12f523)) | |
| download | [linux-502e1146873d870f87da3b8f93d6bf2de5f38d0c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-502e1146873d870f87da3b8f93d6bf2de5f38d0c.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex c2fb5198d5d566..43dda09b32855e 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=8c64ae0b6e6126fda9c291ae18c21ee98e12f523)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)@@ -173,7 +173,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -708,18 +708,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -756,7 +762,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -765,7 +771,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -778,7 +784,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:01 +0000

