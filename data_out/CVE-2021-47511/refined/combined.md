=== Content from git.kernel.org_1a1f9f5c_20250111_133327.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=be8869d388593e57223ad39297c8e54be632f2f2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be8869d388593e57223ad39297c8e54be632f2f2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be8869d388593e57223ad39297c8e54be632f2f2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be8869d388593e57223ad39297c8e54be632f2f2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:03:49 +0100 |
| commit | [be8869d388593e57223ad39297c8e54be632f2f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be8869d388593e57223ad39297c8e54be632f2f2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=be8869d388593e57223ad39297c8e54be632f2f2)) | |
| tree | [cbc79f2fb67b44aa5b2864dcbae41d87f57d8a83](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be8869d388593e57223ad39297c8e54be632f2f2) | |
| parent | [e35ddb1f575d584db3b97c920286ddc492512ea4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e35ddb1f575d584db3b97c920286ddc492512ea4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be8869d388593e57223ad39297c8e54be632f2f2&id2=e35ddb1f575d584db3b97c920286ddc492512ea4)) | |
| download | [linux-be8869d388593e57223ad39297c8e54be632f2f2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-be8869d388593e57223ad39297c8e54be632f2f2.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be8869d388593e57223ad39297c8e54be632f2f2)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=be8869d388593e57223ad39297c8e54be632f2f2) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 1d1faf1925173f..8e053ed9d72005 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=e35ddb1f575d584db3b97c920286ddc492512ea4)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=be8869d388593e57223ad39297c8e54be632f2f2)@@ -172,7 +172,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -707,18 +707,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -755,7 +761,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -764,7 +770,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -777,7 +783,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:04 +0000



=== Content from git.kernel.org_ab95c321_20250111_133322.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 11:32:38 +0100 |
| commit | [02b2b691b77cd7b951fa7b6c9d44d4e472cdc823](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)) | |
| tree | [adc9fccc7d3d8a469184619b4c91fbd0364024a7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823) | |
| parent | [6760e6ddeb48bc0086e1b7b3b213b9bd87cd811d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6760e6ddeb48bc0086e1b7b3b213b9bd87cd811d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823&id2=6760e6ddeb48bc0086e1b7b3b213b9bd87cd811d)) | |
| download | [linux-02b2b691b77cd7b951fa7b6c9d44d4e472cdc823.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-02b2b691b77cd7b951fa7b6c9d44d4e472cdc823.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 142fc751a84770..a99b187e6cc9e4 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=6760e6ddeb48bc0086e1b7b3b213b9bd87cd811d)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=02b2b691b77cd7b951fa7b6c9d44d4e472cdc823)@@ -147,7 +147,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -682,18 +682,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -730,7 +736,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -739,7 +745,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -752,7 +758,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:00 +0000



=== Content from git.kernel.org_f20d0252_20250111_133326.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Takashi Iwai <tiwai@suse.de> | 2021-12-02 09:01:46 +0100 |
| commit | [9d2479c960875ca1239bcb899f386970c13d9cfe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9d2479c960875ca1239bcb899f386970c13d9cfe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)) | |
| tree | [d3e390812b7c0c029dd805367618f9417a935c3f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9d2479c960875ca1239bcb899f386970c13d9cfe) | |
| parent | [289047db1143c42c81820352f195a393ff639a52](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=289047db1143c42c81820352f195a393ff639a52) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d2479c960875ca1239bcb899f386970c13d9cfe&id2=289047db1143c42c81820352f195a393ff639a52)) | |
| download | [linux-9d2479c960875ca1239bcb899f386970c13d9cfe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9d2479c960875ca1239bcb899f386970c13d9cfe.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizesThe period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9d2479c960875ca1239bcb899f386970c13d9cfe)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=9d2479c960875ca1239bcb899f386970c13d9cfe) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 82a818734a5f76..bec7590bc84bb6 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=289047db1143c42c81820352f195a393ff639a52)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=9d2479c960875ca1239bcb899f386970c13d9cfe)@@ -147,7 +147,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -682,18 +682,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -730,7 +736,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -739,7 +745,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -752,7 +758,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:03 +0000



=== Content from git.kernel.org_d7f22e9d_20250111_133330.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f96c0959c1ee92adc911c10d6ec209af50105049)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f96c0959c1ee92adc911c10d6ec209af50105049)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f96c0959c1ee92adc911c10d6ec209af50105049)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f96c0959c1ee92adc911c10d6ec209af50105049)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:18:06 +0100 |
| commit | [f96c0959c1ee92adc911c10d6ec209af50105049](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f96c0959c1ee92adc911c10d6ec209af50105049) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f96c0959c1ee92adc911c10d6ec209af50105049)) | |
| tree | [0dac025c460574db0efd8985e040c9f2af041629](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f96c0959c1ee92adc911c10d6ec209af50105049) | |
| parent | [fd753901ca921877cf585dc315dd5b36f672a404](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fd753901ca921877cf585dc315dd5b36f672a404) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f96c0959c1ee92adc911c10d6ec209af50105049&id2=fd753901ca921877cf585dc315dd5b36f672a404)) | |
| download | [linux-f96c0959c1ee92adc911c10d6ec209af50105049.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f96c0959c1ee92adc911c10d6ec209af50105049.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f96c0959c1ee92adc911c10d6ec209af50105049)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=f96c0959c1ee92adc911c10d6ec209af50105049) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 2a286167460f6c..7b3eec9fc13503 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=fd753901ca921877cf585dc315dd5b36f672a404)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=f96c0959c1ee92adc911c10d6ec209af50105049)@@ -162,7 +162,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -697,18 +697,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -745,7 +751,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -754,7 +760,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -767,7 +773,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:07 +0000



=== Content from git.kernel.org_5c175fc9_20250111_133324.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:04:48 +0100 |
| commit | [502e1146873d870f87da3b8f93d6bf2de5f38d0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)) | |
| tree | [1d20219f204b489867082eb691a7ea1aed983c4d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) | |
| parent | [8c64ae0b6e6126fda9c291ae18c21ee98e12f523](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c64ae0b6e6126fda9c291ae18c21ee98e12f523) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c&id2=8c64ae0b6e6126fda9c291ae18c21ee98e12f523)) | |
| download | [linux-502e1146873d870f87da3b8f93d6bf2de5f38d0c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-502e1146873d870f87da3b8f93d6bf2de5f38d0c.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex c2fb5198d5d566..43dda09b32855e 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=8c64ae0b6e6126fda9c291ae18c21ee98e12f523)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=502e1146873d870f87da3b8f93d6bf2de5f38d0c)@@ -173,7 +173,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -708,18 +708,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -756,7 +762,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -765,7 +771,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -778,7 +784,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:01 +0000



=== Content from git.kernel.org_d0fd93ab_20250111_133328.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f12c8a7515f641885677960af450082569a87243)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f12c8a7515f641885677960af450082569a87243)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f12c8a7515f641885677960af450082569a87243)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f12c8a7515f641885677960af450082569a87243)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 14:49:01 +0100 |
| commit | [f12c8a7515f641885677960af450082569a87243](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f12c8a7515f641885677960af450082569a87243) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f12c8a7515f641885677960af450082569a87243)) | |
| tree | [b599bda50b62f9c167fabd0c9978fbd19180aafa](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f12c8a7515f641885677960af450082569a87243) | |
| parent | [5b06fa0cd2bee9d5b77e495945d113d79a9f6e6a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b06fa0cd2bee9d5b77e495945d113d79a9f6e6a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f12c8a7515f641885677960af450082569a87243&id2=5b06fa0cd2bee9d5b77e495945d113d79a9f6e6a)) | |
| download | [linux-f12c8a7515f641885677960af450082569a87243.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f12c8a7515f641885677960af450082569a87243.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f12c8a7515f641885677960af450082569a87243)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=f12c8a7515f641885677960af450082569a87243) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 0b03777d011161..fde056e87a3f8b 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=5b06fa0cd2bee9d5b77e495945d113d79a9f6e6a)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=f12c8a7515f641885677960af450082569a87243)@@ -147,7 +147,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -682,18 +682,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -730,7 +736,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -739,7 +745,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -752,7 +758,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:06 +0000



=== Content from git.kernel.org_197d1585_20250111_133325.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:16:54 +0100 |
| commit | [8af815ab052eaf74addbbfb556d63ce2137c0e1b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)) | |
| tree | [4fd85a39c96c8a7301bea5573a5276ee4990c67f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b) | |
| parent | [9cfc42d875eba88080ed268b93d4ff196d34b684](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9cfc42d875eba88080ed268b93d4ff196d34b684) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b&id2=9cfc42d875eba88080ed268b93d4ff196d34b684)) | |
| download | [linux-8af815ab052eaf74addbbfb556d63ce2137c0e1b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8af815ab052eaf74addbbfb556d63ce2137c0e1b.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex f855c40b056777..721adffd657e17 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=9cfc42d875eba88080ed268b93d4ff196d34b684)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=8af815ab052eaf74addbbfb556d63ce2137c0e1b)@@ -162,7 +162,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -697,18 +697,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -745,7 +751,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -754,7 +760,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -767,7 +773,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:32:02 +0000



=== Content from git.kernel.org_303d4cf9_20250111_133321.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2021-12-01 08:36:04 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-14 10:57:12 +0100 |
| commit | [00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)) | |
| tree | [243e7775796be3c440e48e99d535df1482b3f2f7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc) | |
| parent | [c94a0d734c7bf4ffa5e72f3e66a12b5f36d3f4e2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c94a0d734c7bf4ffa5e72f3e66a12b5f36d3f4e2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc&id2=c94a0d734c7bf4ffa5e72f3e66a12b5f36d3f4e2)) | |
| download | [linux-00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc.tar.gz) | |

ALSA: pcm: oss: Fix negative period/buffer sizescommit 9d2479c960875ca1239bcb899f386970c13d9cfe upstream.
The period size calculation in OSS layer may receive a negative value
as an error, but the code there assumes only the positive values and
handle them with size\_t. Due to that, a too big value may be passed
to the lower layers.
This patch changes the code to handle with ssize\_t and adds the proper
error checks appropriately.
Reported-by: syzbot+bb348e9f9a954d42746f@syzkaller.appspotmail.com
Reported-by: Bixuan Cui <cuibixuan@linux.alibaba.com>
Cc: <stable@vger.kernel.org>
Link: [https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan@linux.alibaba.com](https://lore.kernel.org/r/1638270978-42412-1-git-send-email-cuibixuan%40linux.alibaba.com)
Link: [https://lore.kernel.org/r/20211201073606.11660-2-tiwai@suse.de](https://lore.kernel.org/r/20211201073606.11660-2-tiwai%40suse.de)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)

| -rw-r--r-- | [sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/oss/pcm_oss.c?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc) | 24 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 15 insertions, 9 deletions

| diff --git a/sound/core/oss/pcm\_oss.c b/sound/core/oss/pcm\_oss.cindex 82a818734a5f76..bec7590bc84bb6 100644--- a/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=c94a0d734c7bf4ffa5e72f3e66a12b5f36d3f4e2)+++ b/[sound/core/oss/pcm\_oss.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/oss/pcm_oss.c?id=00a860678098fcd9fa8db2b5fb9d2ddf4776d4cc)@@ -147,7 +147,7 @@ snd\_pcm\_hw\_param\_value\_min(const struct snd\_pcm\_hw\_params \*params, \* \* Return the maximum value for field PAR. \*/-static unsigned int+static int snd\_pcm\_hw\_param\_value\_max(const struct snd\_pcm\_hw\_params \*params, snd\_pcm\_hw\_param\_t var, int \*dir) {@@ -682,18 +682,24 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, struct snd\_pcm\_hw\_params \*oss\_params, struct snd\_pcm\_hw\_params \*slave\_params) {- size\_t s;- size\_t oss\_buffer\_size, oss\_period\_size, oss\_periods;- size\_t min\_period\_size, max\_period\_size;+ ssize\_t s;+ ssize\_t oss\_buffer\_size;+ ssize\_t oss\_period\_size, oss\_periods;+ ssize\_t min\_period\_size, max\_period\_size; struct snd\_pcm\_runtime \*runtime = substream->runtime; size\_t oss\_frame\_size;  oss\_frame\_size = snd\_pcm\_format\_physical\_width(params\_format(oss\_params)) \* params\_channels(oss\_params) / 8; + oss\_buffer\_size = snd\_pcm\_hw\_param\_value\_max(slave\_params,+ SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE,+ NULL);+ if (oss\_buffer\_size <= 0)+ return -EINVAL; oss\_buffer\_size = snd\_pcm\_plug\_client\_size(substream,- snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_BUFFER\_SIZE, NULL)) \* oss\_frame\_size;- if (!oss\_buffer\_size)+ oss\_buffer\_size \* oss\_frame\_size);+ if (oss\_buffer\_size <= 0) return -EINVAL; oss\_buffer\_size = rounddown\_pow\_of\_two(oss\_buffer\_size); if (atomic\_read(&substream->mmap\_count)) {@@ -730,7 +736,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  min\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_min(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (min\_period\_size) {+ if (min\_period\_size > 0) { min\_period\_size \*= oss\_frame\_size; min\_period\_size = roundup\_pow\_of\_two(min\_period\_size); if (oss\_period\_size < min\_period\_size)@@ -739,7 +745,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream,  max\_period\_size = snd\_pcm\_plug\_client\_size(substream, snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIOD\_SIZE, NULL));- if (max\_period\_size) {+ if (max\_period\_size > 0) { max\_period\_size \*= oss\_frame\_size; max\_period\_size = rounddown\_pow\_of\_two(max\_period\_size); if (oss\_period\_size > max\_period\_size)@@ -752,7 +758,7 @@ static int snd\_pcm\_oss\_period\_size(struct snd\_pcm\_substream \*substream, oss\_periods = substream->oss.setup.periods;  s = snd\_pcm\_hw\_param\_value\_max(slave\_params, SNDRV\_PCM\_HW\_PARAM\_PERIODS, NULL);- if (runtime->oss.maxfrags && s > runtime->oss.maxfrags)+ if (s > 0 && runtime->oss.maxfrags && s > runtime->oss.maxfrags) s = runtime->oss.maxfrags; if (oss\_periods > s) oss\_periods = s; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:31:58 +0000


