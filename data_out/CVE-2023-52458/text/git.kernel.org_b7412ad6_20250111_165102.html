

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Min Li <min15.li@samsung.com> | 2023-06-29 14:25:17 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:27:42 -0800 |
| commit | [ef31cc87794731ffcb578a195a2c47d744e25fb8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)) | |
| tree | [1ceb1836281fe73c9d104fe451c7b237218d0e13](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8) | |
| parent | [0c8d252d0a20a412ec30859afef6393aecfdd3cd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c8d252d0a20a412ec30859afef6393aecfdd3cd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8&id2=0c8d252d0a20a412ec30859afef6393aecfdd3cd)) | |
| download | [linux-ef31cc87794731ffcb578a195a2c47d744e25fb8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ef31cc87794731ffcb578a195a2c47d744e25fb8.tar.gz) | |

block: add check that partition length needs to be aligned with block sizecommit 6f64f866aa1ae6975c95d805ed51d7e9433a0016 upstream.
Before calling add partition or resize partition, there is no check
on whether the length is aligned with the logical block size.
If the logical block size of the disk is larger than 512 bytes,
then the partition size maybe not the multiple of the logical block size,
and when the last sector is read, bio\_truncate() will adjust the bio size,
resulting in an IO error if the size of the read command is smaller than
the logical block size.If integrity data is supported, this will also
result in a null pointer dereference when calling bio\_integrity\_free.
Cc: <stable@vger.kernel.org>
Signed-off-by: Min Li <min15.li@samsung.com>
Reviewed-by: Damien Le Moal <dlemoal@kernel.org>
Reviewed-by: Chaitanya Kulkarni <kch@nvidia.com>
Reviewed-by: Christoph Hellwig <hch@lst.de>
Link: [https://lore.kernel.org/r/20230629142517.121241-1-min15.li@samsung.com](https://lore.kernel.org/r/20230629142517.121241-1-min15.li%40samsung.com)
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)

| -rw-r--r-- | [block/ioctl.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/block/ioctl.c?id=ef31cc87794731ffcb578a195a2c47d744e25fb8) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 4 deletions

| diff --git a/block/ioctl.c b/block/ioctl.cindex 3c475e4166e9f7..ebe4a2653622be 100644--- a/[block/ioctl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/block/ioctl.c?id=0c8d252d0a20a412ec30859afef6393aecfdd3cd)+++ b/[block/ioctl.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/block/ioctl.c?id=ef31cc87794731ffcb578a195a2c47d744e25fb8)@@ -18,7 +18,7 @@ static int blkpg\_do\_ioctl(struct block\_device \*bdev, { struct gendisk \*disk = bdev->bd\_disk; struct blkpg\_partition p;- long long start, length;+ sector\_t start, length;  if (disk->flags & GENHD\_FL\_NO\_PART) return -EINVAL;@@ -35,14 +35,17 @@ static int blkpg\_do\_ioctl(struct block\_device \*bdev, if (op == BLKPG\_DEL\_PARTITION) return bdev\_del\_partition(disk, p.pno); + if (p.start < 0 || p.length <= 0 || p.start + p.length < 0)+ return -EINVAL;+ /\* Check that the partition is aligned to the block size \*/+ if (!IS\_ALIGNED(p.start | p.length, bdev\_logical\_block\_size(bdev)))+ return -EINVAL;+ start = p.start >> SECTOR\_SHIFT; length = p.length >> SECTOR\_SHIFT;  switch (op) { case BLKPG\_ADD\_PARTITION:- /\* check if partition is aligned to blocksize \*/- if (p.start & (bdev\_logical\_block\_size(bdev) - 1))- return -EINVAL; return bdev\_add\_partition(disk, p.pno, start, length); case BLKPG\_RESIZE\_PARTITION: return bdev\_resize\_partition(disk, p.pno, start, length); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:49:39 +0000

