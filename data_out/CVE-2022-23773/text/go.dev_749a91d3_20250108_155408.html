
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F35671)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F35671)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=golang%2Fgo)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[golang](/golang)
/
**[go](/golang/go)**
Public

* [Notifications](/login?return_to=%2Fgolang%2Fgo) You must be signed in to change notification settings
* [Fork
  17.8k](/login?return_to=%2Fgolang%2Fgo)
* [Star
   125k](/login?return_to=%2Fgolang%2Fgo)

* [Code](/golang/go)
* [Issues
  5k+](/golang/go/issues)
* [Pull requests
  504](/golang/go/pulls)
* [Discussions](/golang/go/discussions)
* [Actions](/golang/go/actions)
* [Projects
  4](/golang/go/projects)
* [Wiki](/golang/go/wiki)
* [Security](/golang/go/security)
* [Insights](/golang/go/pulse)

Additional navigation options

* [Code](/golang/go)
* [Issues](/golang/go/issues)
* [Pull requests](/golang/go/pulls)
* [Discussions](/golang/go/discussions)
* [Actions](/golang/go/actions)
* [Projects](/golang/go/projects)
* [Wiki](/golang/go/wiki)
* [Security](/golang/go/security)
* [Insights](/golang/go/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgolang%2Fgo%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgolang%2Fgo%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# cmd/go: do not treat branches with semantic-version names as releases #35671

Closed

[bcmills](/bcmills) opened this issue
Nov 18, 2019
¬∑ 14 comments

Closed

# [cmd/go: do not treat branches with semantic-version names as releases](#top) #35671

[bcmills](/bcmills) opened this issue
Nov 18, 2019
¬∑ 14 comments

Labels
[FrozenDueToAge](/golang/go/labels/FrozenDueToAge)
[modules](/golang/go/labels/modules)
[NeedsFix](/golang/go/labels/NeedsFix)
The path to resolution is known, but the work has not been done.
[Security](/golang/go/labels/Security)

Milestone
[Go1.18](/golang/go/milestone/201 "Go1.18")

## Comments

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=80&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)

Copy link

Contributor

### **[bcmills](/bcmills)** commented [Nov 18, 2019](#issue-524441199)

| [#33558 (comment)](https://github.com/golang/go/issues/33558#issuecomment-554879181) reports a situation in which a `v2.0.0` branch was created and subsequently removed, but `proxy.golang.org` cached a `v2.0.0+incompatible` release.  If someone creates a *branch* named `v2.0.0`, they probably intend for that branch to contain the development *leading up to* `v2.0.0`, not for that branch as first published to be the definitive final release of `v2.0.0`. The `go` command should not mistake the former for the latter.  CC [@jayconrod](https://github.com/jayconrod) [@mattn](https://github.com/mattn) [@thepudds](https://github.com/thepudds) |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëç
11
 dmitshur, mattn, aofei, rittneje, hajimehoshi, ccmtaylor, elad, nussjustin, pgaskin, komuw, and tomtwinkle reacted with thumbs up emoji

All reactions

* üëç
  11 reactions

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
added
[NeedsInvestigation](/golang/go/labels/NeedsInvestigation)
Someone must examine and confirm this is a valid issue and not a duplicate of an existing one.
[modules](/golang/go/labels/modules)
labels
[Nov 18, 2019](#event-2807962212)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
added this to the [Go1.15](/golang/go/milestone/114) milestone
[Nov 18, 2019](#event-2807962225)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=80&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)

Copy link

Contributor

Author

### **[bcmills](/bcmills)** commented [Nov 18, 2019](#issuecomment-555067041)

| See [#29731](https://github.com/golang/go/issues/29731), which also involves confusion between branches and versions. |
| --- |

All reactions

Sorry, something went wrong.

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
mentioned this issue
[Nov 18, 2019](#ref-issue-491010985)

[proxy.golang.org: accidentally publishing a major version interplays poorly with Go modules
#34189](/golang/go/issues/34189)

Closed

[![@mattn](https://avatars.githubusercontent.com/u/10111?s=40&v=4)](/mattn)
[mattn](/mattn)
mentioned this issue
[Dec 4, 2019](#ref-issue-522390526)

[cannot load github.com/mattn/go-sqlite3: module github.com/mattn/go-sqlite3@latest (v2.0.0+incompatible) found, but does not contain package github.com/mattn/go-sqlite3
mattn/go-sqlite3#755](/mattn/go-sqlite3/issues/755)

Closed

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
modified the milestones:
[Go1.15](/golang/go/milestone/114),
[Go1.16](/golang/go/milestone/145)
[Jun 4, 2020](#event-3408116819)

[![@hajimehoshi](https://avatars.githubusercontent.com/u/16950?s=80&u=ed7c5b7cfcec804ff78d1e3fa43c42ef9869f9c6&v=4)](/hajimehoshi)

Copy link

Member

### **[hajimehoshi](/hajimehoshi)** commented [Jun 18, 2020](#issuecomment-646034196)

| Any updates on this? I think this is a very scary issue, since if a collaborator created a vN branch deliberately or not once, the repository's versioning would be corrupted forever... |
| --- |

All reactions

Sorry, something went wrong.

[![@jayconrod](https://avatars.githubusercontent.com/u/164791?s=40&v=4)](/jayconrod)
[jayconrod](/jayconrod)
modified the milestones:
[Go1.16](/golang/go/milestone/145),
[Go1.17](/golang/go/milestone/163)
[Jan 7, 2021](#event-4180766679)

[![@ianlancetaylor](https://avatars.githubusercontent.com/u/3194333?s=80&v=4)](/ianlancetaylor)

Copy link

Member

### **[ianlancetaylor](/ianlancetaylor)** commented [Apr 21, 2021](#issuecomment-824438635)

| Is this going to happen for 1.17? Thanks. |
| --- |

All reactions

Sorry, something went wrong.

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
modified the milestones:
[Go1.17](/golang/go/milestone/163),
[Backlog](/golang/go/milestone/117)
[Apr 22, 2021](#event-4630986353)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
added
the
[help wanted](/golang/go/labels/help%20wanted)
label
[Apr 22, 2021](#event-4630988385)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
self-assigned this
[Dec 1, 2021](#event-5699677043)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
modified the milestones:
[Backlog](/golang/go/milestone/117),
[Go1.18](/golang/go/milestone/201)
[Dec 1, 2021](#event-5699677618)

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
added
[NeedsFix](/golang/go/labels/NeedsFix)
The path to resolution is known, but the work has not been done.
and removed
[help wanted](/golang/go/labels/help%20wanted)
labels
[Dec 1, 2021](#event-5699678172)

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=40&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)
[gopherbot](/gopherbot)
removed
the
[NeedsInvestigation](/golang/go/labels/NeedsInvestigation)
Someone must examine and confirm this is a valid issue and not a duplicate of an existing one.
label
[Dec 1, 2021](#event-5699786525)

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Jan 13, 2022](#issuecomment-1012513608)

| Change <https://golang.org/cl/378399> mentions this issue: `cmd/go/internal/modfetch: add a reproducer for #35671` |
| --- |

All reactions

Sorry, something went wrong.

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Jan 13, 2022](#issuecomment-1012584178)

| Change <https://golang.org/cl/378400> mentions this issue: `cmd/go/internal/modfetch: do not short-circuit canonical versions` |
| --- |

All reactions

Sorry, something went wrong.

[![@FiloSottile](https://avatars.githubusercontent.com/u/1225294?s=80&u=f9186107b90a6f746f8e7192ee7b1d5a68f4ab07&v=4)](/FiloSottile)

Copy link

Contributor

### **[FiloSottile](/FiloSottile)** commented [Jan 19, 2022](#issuecomment-1016719325)

| [@gopherbot](https://github.com/gopherbot) please open backport issues. Materializing versions from branches might be unexpected and bypass ACLs that limit the creation of tags but not branches. It's also better for the version list to be consistent across supported Go versions. |
| --- |

 üëç
3
 bcmills, creekorful, and dolmen reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

Sorry, something went wrong.

[![@FiloSottile](https://avatars.githubusercontent.com/u/1225294?s=40&u=f9186107b90a6f746f8e7192ee7b1d5a68f4ab07&v=4)](/FiloSottile)
[FiloSottile](/FiloSottile)
added
the
[Security](/golang/go/labels/Security)
label
[Jan 19, 2022](#event-5919543834)

This was referenced Jan 19, 2022

[cmd/go: do not treat branches with semantic-version names as releases [1.16 backport]
#50686](/golang/go/issues/50686)

Closed

[cmd/go: do not treat branches with semantic-version names as releases [1.17 backport]
#50687](/golang/go/issues/50687)

Closed

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Jan 19, 2022](#issuecomment-1016729389)

| Backport issue(s) opened: [#50686](https://github.com/golang/go/issues/50686) (for 1.16), [#50687](https://github.com/golang/go/issues/50687) (for 1.17).  Remember to create the cherry-pick CL(s) as soon as the patch is submitted to master, according to <https://golang.org/wiki/MinorReleases>. |
| --- |

All reactions

Sorry, something went wrong.

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Feb 2, 2022](#issuecomment-1028407889)

| Change <https://golang.org/cl/382594> mentions this issue: `vcs-test/README.md: warn about Google Cloud Storage default caching` |
| --- |

All reactions

Sorry, something went wrong.

[gopherbot](/gopherbot)
pushed a commit
to golang/build
that referenced
this issue
[Feb 3, 2022](#ref-commit-47640b7)

`[vcs-test/README.md: warn about Google Cloud Storage default caching](/golang/build/commit/47640b70b753861b0b67a82521080e3218898969 "vcs-test/README.md: warn about Google Cloud Storage default caching

I don't know when the default Cache-Control policy was added, but it
makes it very difficult to fix mistakes in zipfiles uploaded to
vcs-test. Fortunately, the docs for 'gsutil setmeta' give a recipe for
how to fix it, if the user remembers to do so.

For golang/go#35671

Change-Id: I86d365dfae127f3a5230ef4a3c772b17db261096
Reviewed-on: https://go-review.googlesource.com/c/build/+/382594
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>")`
‚Ä¶

`[47640b7](/golang/build/commit/47640b70b753861b0b67a82521080e3218898969)`

```
I don't know when the default Cache-Control policy was added, but it
makes it very difficult to fix mistakes in zipfiles uploaded to
vcs-test. Fortunately, the docs for 'gsutil setmeta' give a recipe for
how to fix it, if the user remembers to do so.

For [golang/go#35671](https://github.com/golang/go/issues/35671)

Change-Id: I86d365dfae127f3a5230ef4a3c772b17db261096
Reviewed-on: [https://go-review.googlesource.com/c/build/+/382594](https://go-review.googlesource.com/c/build/%2B/382594)
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>
```

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=40&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)
[gopherbot](/gopherbot)
closed this as [completed](/golang/go/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[fa4d9b8](/golang/go/commit/fa4d9b8e2bc2612960c80474fca83a4c85a974eb)`
[Feb 3, 2022](#event-6004174024)

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Feb 3, 2022](#issuecomment-1029212887)

| Change <https://golang.org/cl/382835> mentions this issue: `[release-branch.go1.17] cmd/go/internal/modfetch: do not short-circuit canonical versions` |
| --- |

All reactions

Sorry, something went wrong.

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=80&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)

Copy link

Contributor

### **[gopherbot](/gopherbot)** commented [Feb 3, 2022](#issuecomment-1029223251)

| Change <https://golang.org/cl/382839> mentions this issue: `[release-branch.go1.16] cmd/go/internal/modfetch: do not short-circuit canonical versions` |
| --- |

All reactions

Sorry, something went wrong.

[gopherbot](/gopherbot)
pushed a commit
that referenced
this issue
[Feb 7, 2022](#ref-commit-fbcc30a)
[![@cherrymui](https://avatars.githubusercontent.com/u/14119929?s=40&v=4)](/cherrymui)

`[[release-branch.go1.17] cmd/go/internal/modfetch: do not short-circui‚Ä¶](/golang/go/commit/fbcc30a2c9d076b27b4b411e2cec91ec13528081 "[release-branch.go1.17] cmd/go/internal/modfetch: do not short-circuit canonical versions

Since at least CL 121857, the conversion logic in
(*modfetch).codeRepo.Stat has had a short-circuit to use the version
requested by the caller if it successfully resolves and is already
canonical.

However, we should not use that version if it refers to a branch
instead of a tag, because branches (unlike tags) usually do not refer
to a single, stable release: a branch named \"v1.0.0\" may be for the
development of the v1.0.0 release, or for the development of patches
based on v1.0.0, but only one commit (perhaps at the end of that
branch ‚Äî but possibly not even written yet!) can be that specific
version.

We already have some logic to prefer tags that are semver-equivalent
to the version requested by the caller. That more general case
suffices for exact equality too ‚Äî so we can eliminate the
special-case, fixing the bug and (happily!) also somewhat simplifying
the code.

Updates #35671
Fixes #50687
Fixes CVE-2022-23773

Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
Reviewed-on: https://go-review.googlesource.com/c/go/+/378400
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Russ Cox <rsc@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>
(cherry picked from commit fa4d9b8e2bc2612960c80474fca83a4c85a974eb)
Reviewed-on: https://go-review.googlesource.com/c/go/+/382835")`
‚Ä¶

`[fbcc30a](/golang/go/commit/fbcc30a2c9d076b27b4b411e2cec91ec13528081)`

```
‚Ä¶t canonical versions

Since at least CL 121857, the conversion logic in
(*modfetch).codeRepo.Stat has had a short-circuit to use the version
requested by the caller if it successfully resolves and is already
canonical.

However, we should not use that version if it refers to a branch
instead of a tag, because branches (unlike tags) usually do not refer
to a single, stable release: a branch named "v1.0.0" may be for the
development of the v1.0.0 release, or for the development of patches
based on v1.0.0, but only one commit (perhaps at the end of that
branch ‚Äî but possibly not even written yet!) can be that specific
version.

We already have some logic to prefer tags that are semver-equivalent
to the version requested by the caller. That more general case
suffices for exact equality too ‚Äî so we can eliminate the
special-case, fixing the bug and (happily!) also somewhat simplifying
the code.

Updates [#35671](https://github.com/golang/go/issues/35671)
Fixes [#50687](https://github.com/golang/go/issues/50687)
Fixes [CVE-2022-23773](https://github.com/advisories/GHSA-52j8-p7r3-733m "CVE-2022-23773")

Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
Reviewed-on: [https://go-review.googlesource.com/c/go/+/378400](https://go-review.googlesource.com/c/go/%2B/378400)
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Russ Cox <rsc@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>
(cherry picked from commit [fa4d9b8](https://github.com/golang/go/commit/fa4d9b8e2bc2612960c80474fca83a4c85a974eb))
Reviewed-on: [https://go-review.googlesource.com/c/go/+/382835](https://go-review.googlesource.com/c/go/%2B/382835)
```

[gopherbot](/gopherbot)
pushed a commit
that referenced
this issue
[Feb 7, 2022](#ref-commit-de76489)
[![@cherrymui](https://avatars.githubusercontent.com/u/14119929?s=40&v=4)](/cherrymui)

`[[release-branch.go1.16] cmd/go/internal/modfetch: do not short-circui‚Ä¶](/golang/go/commit/de76489a1b1cfce6b1258040c15b18ed97847758 "[release-branch.go1.16] cmd/go/internal/modfetch: do not short-circuit canonical versions

Since at least CL 121857, the conversion logic in
(*modfetch).codeRepo.Stat has had a short-circuit to use the version
requested by the caller if it successfully resolves and is already
canonical.

However, we should not use that version if it refers to a branch
instead of a tag, because branches (unlike tags) usually do not refer
to a single, stable release: a branch named \"v1.0.0\" may be for the
development of the v1.0.0 release, or for the development of patches
based on v1.0.0, but only one commit (perhaps at the end of that
branch ‚Äî but possibly not even written yet!) can be that specific
version.

We already have some logic to prefer tags that are semver-equivalent
to the version requested by the caller. That more general case
suffices for exact equality too ‚Äî so we can eliminate the
special-case, fixing the bug and (happily!) also somewhat simplifying
the code.

Updates #35671
Fixes #50686
Fixes CVE-2022-23773

Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
Reviewed-on: https://go-review.googlesource.com/c/go/+/378400
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Russ Cox <rsc@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>
(cherry picked from commit fa4d9b8e2bc2612960c80474fca83a4c85a974eb)
Reviewed-on: https://go-review.googlesource.com/c/go/+/382839")`
‚Ä¶

`[de76489](/golang/go/commit/de76489a1b1cfce6b1258040c15b18ed97847758)`

```
‚Ä¶t canonical versions

Since at least CL 121857, the conversion logic in
(*modfetch).codeRepo.Stat has had a short-circuit to use the version
requested by the caller if it successfully resolves and is already
canonical.

However, we should not use that version if it refers to a branch
instead of a tag, because branches (unlike tags) usually do not refer
to a single, stable release: a branch named "v1.0.0" may be for the
development of the v1.0.0 release, or for the development of patches
based on v1.0.0, but only one commit (perhaps at the end of that
branch ‚Äî but possibly not even written yet!) can be that specific
version.

We already have some logic to prefer tags that are semver-equivalent
to the version requested by the caller. That more general case
suffices for exact equality too ‚Äî so we can eliminate the
special-case, fixing the bug and (happily!) also somewhat simplifying
the code.

Updates [#35671](https://github.com/golang/go/issues/35671)
Fixes [#50686](https://github.com/golang/go/issues/50686)
Fixes [CVE-2022-23773](https://github.com/advisories/GHSA-52j8-p7r3-733m "CVE-2022-23773")

Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
Reviewed-on: [https://go-review.googlesource.com/c/go/+/378400](https://go-review.googlesource.com/c/go/%2B/378400)
Trust: Bryan Mills <bcmills@google.com>
Run-TryBot: Bryan Mills <bcmills@google.com>
Reviewed-by: Russ Cox <rsc@golang.org>
TryBot-Result: Gopher Robot <gobot@golang.org>
(cherry picked from commit [fa4d9b8](https://github.com/golang/go/commit/fa4d9b8e2bc2612960c80474fca83a4c85a974eb))
Reviewed-on: [https://go-review.googlesource.com/c/go/+/382839](https://go-review.googlesource.com/c/go/%2B/382839)
```

[![@thepudds](https://avatars.githubusercontent.com/u/20628140?s=80&v=4)](/thepudds)

Copy link

Contributor

### **[thepudds](/thepudds)** commented [Feb 14, 2022](#issuecomment-1039492556) ‚Ä¢ edited Loading

| Is it expected that your local modules cache and proxy.golang.org continue to serve these types of 'bad' versions? My guess is yes, including to support reproducible builds, but wanted to confirm.  One related comment is it looks like rsc.io/quote might have deliberately tried to introduce this problem late last year, or at least it currently seems to have a v4.0.0 branch without a v4.0.0 tag, and proxy.golang.org serves v4.0.0 as a version:  [https://proxy.golang.org/rsc.io/quote/v4/@v/list](https://proxy.golang.org/rsc.io/quote/v4/%40v/list)  It also seems go1.17.7 will be OK with these types of versions if your local module cache has been polluted:  ``` export GOMODCACHE=$(mktemp -d) export GOPROXY=direct cd $(mktemp -d) go mod init temp  # go1.17.7 fails with the expected new error: #     rsc.io/quote/v4@v4.0.0: invalid version: resolves to version v4.0.0-20211101134634-bc30624959ad (v4.0.0 is not a tag)  go1.17.7 get rsc.io/quote/v4@v4.0.0  # go1.17.6 succeeds: go1.17.6 get rsc.io/quote/v4@v4.0.0  rm go.mod go mod init temp  # go1.17.7 now also succeeds in adding rsc.io/quote/v4@v4.0.0, presumably due to module cache: go1.17.7 get rsc.io/quote/v4@v4.0.0  ```  Again, probably expected, but wanted to check.  The new v4 also happens to now show up in one of the modules tutorials, which might mean a tweak to the tutorial ([#51188](https://github.com/golang/go/issues/51188)) if the proxy will continue to serve that v4 version.  Finally, sorry if any of this is off base or if I've forgotten something obvious. |
| --- |

 üëç
1
 dmitshur reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@thepudds](https://avatars.githubusercontent.com/u/20628140?s=40&v=4)](/thepudds)
[thepudds](/thepudds)
mentioned this issue
[Feb 14, 2022](#ref-issue-1137217563)

[x/website: On "Tutorial: Get started with Go" there is outdated information about the 'quote' package
#51188](/golang/go/issues/51188)

Open

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=80&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)

Copy link

Contributor

Author

### **[bcmills](/bcmills)** commented [Feb 14, 2022](#issuecomment-1039517988)

| Is it expected that your local modules cache and proxy.golang.org continue to serve these types of 'bad' versions? My guess is yes, including to support reproducible builds, but wanted to confirm. ‚Ä¶ It also seems go1.17.7 will be OK with these types of versions if your local module cache has been polluted:  Yes: any version that was already in the wild is already in the wild anyway; we don't have a mechanism to unpublish invalidated versions from module caches or proxies, although of course the author can `retract` the affected version(s) ‚Äî see [mattn/go-sqlite3#998](https://github.com/mattn/go-sqlite3/pull/998) for an example.  The new v4 also happens to now show up in one of the modules tutorials, which might mean a tweak to the tutorial ([#51188](https://github.com/golang/go/issues/51188)) if the proxy will continue to serve that v4 version.  Yeah, we should probably fix that. Thanks for flagging it! |
| --- |

All reactions

Sorry, something went wrong.

[![@dmitshur](https://avatars.githubusercontent.com/u/1924134?s=40&v=4)](/dmitshur)
[dmitshur](/dmitshur)
mentioned this issue
[Feb 22, 2022](#ref-issue-1146680743)

[cmd/go: "v1.x.y is not a tag" when .gitconfig sets `log.decorate` to `full`
#51312](/golang/go/issues/51312)

Closed

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
mentioned this issue
[Feb 23, 2022](#ref-issue-1147317632)

[cmd/go/internal/modfetch: erroneously resolves a `v2.‚Ä¶+incompatible` version when a `v2/go.mod` file exists
#51324](/golang/go/issues/51324)

Closed

This was referenced Feb 23, 2022

[cmd/go/internal/modfetch: erroneously resolves a `v2.‚Ä¶+incompatible` version when a `v2/go.mod` file exists [1.16 backport]
#51331](/golang/go/issues/51331)

Closed

[cmd/go/internal/modfetch: erroneously resolves a `v2.‚Ä¶+incompatible` version when a `v2/go.mod` file exists [1.17 backport]
#51332](/golang/go/issues/51332)

Closed

[![@jidicula](https://avatars.githubusercontent.com/u/12765385?s=40&v=4)](/jidicula)
[jidicula](/jidicula)
mentioned this issue
[Feb 23, 2022](#ref-pullrequest-1131220608)

[go 1.17.7
Homebrew/homebrew-core#94895](/Homebrew/homebrew-core/pull/94895)
 Closed

[![@jing-rui](https://avatars.githubusercontent.com/u/51155955?s=80&v=4)](/jing-rui)

Copy link

### **[jing-rui](/jing-rui)** commented [Mar 8, 2022](#issuecomment-1061465910)

| Is there any workaround for old versions(go1.15)? |
| --- |

All reactions

Sorry, something went wrong.

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=80&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)

Copy link

Contributor

Author

### **[bcmills](/bcmills)** commented [Mar 8, 2022](#issuecomment-1062157785)

| [@jing-rui](https://github.com/jing-rui), per the Go project's [release policy](https://go.dev/doc/devel/release#policy), only the two most recent Go releases receive backport fixes.  The only workarounds I'm aware of for older versions are to upgrade, or to configure your environment to use a `GOPROXY` that itself runs an upgraded or patched version of the `go` command. |
| --- |

 üëç
1
 dmitshur reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=40&u=8d0e68fb4cae59e43f7ffc32536637b25d61a49c&v=4)](/bcmills)
[bcmills](/bcmills)
mentioned this issue
[Jun 2, 2022](#ref-issue-1258078388)

[Invalid github.com/go-delve/liner version
go-delve/delve#3025](/go-delve/delve/issues/3025)

Closed

[![@rsc](https://avatars.githubusercontent.com/u/104030?s=40&u=7776f9d68ea1bc349af0227c03fca30350a05477&v=4)](/rsc)
[rsc](/rsc)
unassigned [bcmills](/bcmills)
[Jun 23, 2022](#event-6863829413)

[![@YangKeao](https://avatars.githubusercontent.com/u/5244316?s=40&v=4)](/YangKeao)
[YangKeao](/YangKeao)
mentioned this issue
[Oct 11, 2022](#ref-issue-1402183926)

[Fail to compile pd-server without goproxy because of invalid dependency branch name
tikv/pd#5574](/tikv/pd/issues/5574)

Open

[![@golang](https://avatars.githubusercontent.com/u/4314092?s=40&v=4)](/golang)
[golang](/golang)
locked and limited conversation to collaborators
[Jun 23, 2023](#event-9614941172)

[![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=40&u=be84be2341a1a28dc2ede61150f7ceaaf470b8ba&v=4)](/gopherbot)
[gopherbot](/gopherbot)
added
the
[FrozenDueToAge](/golang/go/labels/FrozenDueToAge)
label
[Jun 23, 2023](#event-9614941306)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgolang%2Fgo%2Fissues%2F35671).

Assignees

No one assigned

Labels

[FrozenDueToAge](/golang/go/labels/FrozenDueToAge)
[modules](/golang/go/labels/modules)
[NeedsFix](/golang/go/labels/NeedsFix)
The path to resolution is known, but the work has not been done.
[Security](/golang/go/labels/Security)

Projects

None yet

Milestone

 [**Go1.18**](/golang/go/milestone/201 "Go1.18")

Development

No branches or pull requests

8 participants

[![@hajimehoshi](https://avatars.githubusercontent.com/u/16950?s=52&v=4)](/hajimehoshi) [![@jayconrod](https://avatars.githubusercontent.com/u/164791?s=52&v=4)](/jayconrod) [![@FiloSottile](https://avatars.githubusercontent.com/u/1225294?s=52&v=4)](/FiloSottile) [![@ianlancetaylor](https://avatars.githubusercontent.com/u/3194333?s=52&v=4)](/ianlancetaylor) [![@bcmills](https://avatars.githubusercontent.com/u/5200974?s=52&v=4)](/bcmills) [![@gopherbot](https://avatars.githubusercontent.com/u/8566911?s=52&v=4)](/gopherbot) [![@thepudds](https://avatars.githubusercontent.com/u/20628140?s=52&v=4)](/thepudds) [![@jing-rui](https://avatars.githubusercontent.com/u/51155955?s=52&v=4)](/jing-rui)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

