
Toggle Navbar

* [Career](/career/)
* [About us](/about-us/)
* [Contact](/contact/)

* EN
  + [DE](/de/vulnerability-lab/advisory/local-privilege-escalation-ueber-msi-installer-in-softmaker-office-freeoffice/ "German")
Search

* Security Testing
  + [Web Application Security](/security-testing/web-application-security/)
  + [Penetration Testing](/security-testing/penetration-testing/)
  + [Mobile Security](/security-testing/mobile-security/)
  + [Cloud Security](/security-testing/cloud-security/)
  + [IT Infrastructure Security](/security-testing/it-infrastructure-security/)
  + [Security for SAP Services](/security-testing/security-for-sap-services/)
  + [IoT and Embedded Systems Security](/security-testing/iot-and-embedded-systems-security/)
  + [Red Teaming](/security-testing/red-teaming/)
* Processes & Organisation
  + [Information Security Management (ISM)](/processes-organisation/information-security-management-ism/)
  + [Network and Information Systems Security (NIS)](/processes-organisation/network-and-information-systems-security-nis/)
  + [OT Security](/processes-organisation/ot-security/)
  + [Secure Software Development Consulting](/processes-organisation/secure-software-development/)
  + [Red Teaming](/security-testing/red-teaming/)
  + [SEC Trainings](/processes-organisation/sec-trainings/)
  + [Project- und Program Management](/processes-organisation/project-und-program-management/)
* Incident Response
  + [SEC Defence](/incident-response/sec-defence/)
* [Vulnerability Lab](/vulnerability-lab/)
* [Blog](/blog/)
 [Incident?
Breached?
Report an incident](/incident-response/sec-defence/)

1. [Home](/)
2. [Vulnerability Lab](/vulnerability-lab/)
3. Local Privilege Escalation via MSI installer in SoftMaker Office / FreeOffice
# Local Privilege Escalation via MSI installer in SoftMaker Office / FreeOffice

Title

Local Privilege Escalation via MSI installer

Product

SoftMaker Office / FreeOffice

Vulnerable Version

SoftMaker Office 2024 / NX before revision 1214, FreeOffice 2021 Revision 1068, FreeOffice 2024 before revision 1215

Fixed Version

SoftMaker Office 2024 / NX - revision 1214, FreeOffice 2024 - revision 1215

CVE Number

CVE-2023-7270

Impact

high

Homepage

[https://www.softmaker.com/en/](https://www.softmaker.com/en/ "https://www.softmaker.com/en/")

Found

27.11.2023

By

Michael Baer (Office Fürth) | SEC Consult Vulnerability Lab

The MSI installers of SoftMaker Office and FreeOffice (SoftMaker) contained a privilege escalation vulnerability. This enabled a local, low-privileged attacker with GUI access to a system, where SoftMaker Office or FreeOffice are installed via MSI, to escalate the privileges to SYSTEM level.

## Vendor description

"*SoftMaker Office makes working with documents, spreadsheets and presentations a breeze – whether you're on Windows, Linux, Mac, iOS or Android.*"

Source: <https://www.softmaker.com/en/products/softmaker-office>

## Business recommendation

The vendor provides a patch which should be installed immediately.

SEC Consult highly recommends to perform a thorough security review of the product conducted by security professionals to identify and resolve potential further security issues.

## Vulnerability overview/description

### 1) Local Privilege Escalation via MSI installer (CVE-2023-7270)

The SoftMaker Office and FreeOffice MSI installer files were found to produce a visible conhost.exe window running as the SYSTEM user when using the repair function of msiexec.exe.

This allows a local, low-privileged attacker to use a chain of actions, to open a fully functional cmd.exe with the privileges of the SYSTEM user.

*Note*:
 This attack does not work using a recent version of the Edge Browser or Internet Explorer. A different browser, such as Chrome or Firefox, needs to be used. Also make sure, that Edge or IE have not been set as default browser and that Firefox or Chrome are not running before attempting to exploit it. Otherwise, the spawned process would be running with your own permissions and the installer will just add a new tab to the browser, instead of spawning a new process with SYSTEM.

## Proof of concept

### 1) Local Privilege Escalation via MSI installer (CVE-2023-7270)

For the exploit to work, SoftMaker Office or FreeOffice have to be installed via the MSI file. Afterwards, any low-privileged user can start the repair of the software by double-clicking the installer and trigger the vulnerable actions without a UAC popup. The installer, if deleted from it's original location, can be found in C:\Windows\Installer with a randomized name.

During the repair process, a console application gets called with SYSTEM privileges and performs a read action on some files.

SoftMaker Office: Executes 7z.exe, which reads

```
C:\Program Files\SoftMaker Office 2024\tb\7z.exe
```

FreeOffice: Executes syspin.exe, which reads

```
C:\Windows\SysWOW64\OneCoreCommonProxyStub.dll
```

This can be used by an attacker by simply setting an oplock on the files mentioned before.

As soon as it gets read, the process is blocked until the lock is released.

To do that, one can use the 'SetOpLock.exe' tool from "<https://github.com/googleprojectzero/symboliclink-testing-tools>" with the following parameters:

```
while ($true) { SetOpLock.exe "C:\Program Files\SoftMaker Office 2024\tb\7z.exe" x }
while ($true) { SetOpLock.exe "C:\Windows\SysWOW64\OneCoreCommonProxyStub.dll" x }
```
![](/fileadmin/_processed_/1/e/csm_sec-consult-c-softmaker-soft_lock_d08dbe5371.png)

Figure 1: Executing msiexec.exe to repair the SoftMaker Office MSI file, running "SetOpLock.exe" to set a lock

![](/fileadmin/_processed_/6/b/csm_sec-consult-c-softmaker-lock_7dc3203d7f.png)

Figure 2: Executing msiexec.exe to repair the FreeOffice MSI file, running "SetOpLock.exe" to set a lock

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_06/sec-consult-c-softmaker-soft_openbrowser.png)

Figure 3: Console window properties, clicking on "new console features", opening the browser "Firefox" (or Chrome), but others won't work

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_06/sec-consult-c-softmaker-openbrowser.png)

Figure 4: Same for FreeOffice 2021, just a different console window

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_06/sec-consult-c-softmaker-soft_cmd.png)

Figure 5: Gaining SYSTEM access rights via SoftMaker Office MSI installer

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_06/sec-consult-c-softmaker-sec-consult-c-softmaker-cmd.png)

Figure 6: Gaining SYSTEM access rights via FreeOffice MSI installer

![](/fileadmin/user_upload/sec-consult/Dynamisch/Advisories/2024_06/sec-consult-c-softmaker-taskbar.png)

Figure 7: Taskbar icon to look out for because the syspin.exe window is minimized

During the repair process, the locked file is accessed multiple times. The lock has to be released by pressing ENTER several times before the window opens.

If the window appears, the lock should not be released to keep the window open. The window that gets opened when the console program is executed doesn't close and can then be interacted with.

Note 1: The syspin.exe window is minimized. When the lock is triggered, it is advised to check the taskbar whether a window with a blue arrow [see figure 7] exists.

The attacker can then perform the following actions to spawn a SYSTEM shell:

* Right click on the top bar of the window
* Click on properties (see figure 3 and figure 4).
* Under options, click on the "new console features" link
* Open the link with e.g. firefox
* In the opened browser window press the key combination CTRL+o
* Type cmd.exe in the top bar and press Enter, see figure 5 and figure 6.

*Note 2*: This does not work using a recent version of the Edge Browser.

*Note 3*: The program syspin.exe is invoked several times, sometimes without elevated privileges. If the final cmd.exe is not elevated, release the lock and wait for the next syspin.exe invocation. During our test, the fifth window was run with elevated privileges.

## Vulnerable / tested versions

The following versions have been tested by SEC Consult which were the most recent versions available at the time of the test:

* SoftMaker Office 2024 - 24.0.6034
* FreeOffice 2021 Revision 1068

According to the vendor, all versions of SoftMaker Office NX/2024 before revision 1214 and FreeOffice 2024 before revision 1215 with the MSI installer are affected.

FreeOffice 2021 is unsupported and will not be fixed according to the vendor.

## Vendor contact timeline

| 2023-12-02 | Contacting vendor through sales@softmaker.de, asking for security contact. |
| --- | --- |
| 2023-12-07 | Contacting vendor through https://www.softmaker.com/en/support/customer-support asking for security contact. |
| 2024-01-11 | Contacting vendor through https://www.softmaker.com/en/support/customer-support asking for security contact. |
| 2024-01-11 | Vendor provides security contact and asks for advisory unencrypted |
| 2024-01-12 | Sending advisory draft unencrypted to security contact |
| 2024-02-17 | Asking for status of vulnerability, no response |
| 2024-03-06 | Asking for status of vulnerability, no response |
| 2024-04-08 | Asking for a status update, setting release date to 17th April. |
| 2024-04-08 | Vendor response, seems not to have received our previous mails. Asking for deadline extension as a release it already planned. |
| 2024-04-09 | Sending advisory draft again, extending deadline. |
| 2024-04-11 | Asking whether email was received, confirmed. Sent proposed solution. |
| 2024-04-22 | Asking when new release is planned and whether fixes could be incorporated. |
| 2024-04-23 | Vendor response, current service pack update not including fixes, planned in about 6 weeks. |
| 2024-05-27 | Vendor response, service pack / revision 1214 was published which fixes the issue for Office 2024 and Office NX. FreeOffice 2024 will be fixed in the next release mid June. FreeOffice 2021 is unsupported. |
| 2024-06-11 | Vendor: FreeOffice 2024 will be patched on 18th June, asks for advisory release to be postponed a bit. |
| 2024-06-17 | Setting advisory release date for 27th June, reserving CVE. |
| 2024-06-18 | Vendor releases FreeOffice 2024 revision 1215. |
| 2024-06-27 | Release of security advisory. |

## Solution

The vendor provides a service pack version 1214 for SoftMaker Office 2024 and SofMaker Office NX, which can be downloaded from:
<https://softmaker.de/download/servicepacks>

FreeOffice 2024 revision 1215:
<https://www.freeoffice.com/de/download/servicepacks>

FreeOffice 2021 is unsupported and will not be fixed according to the vendor.

## Workaround

None

## Advisory URL

<https://sec-consult.com/vulnerability-lab/>

EOF Michael Baer  @2024

*Interested to work with the experts of SEC Consult? Send us your [application](https://sec-consult.com/career/)*

*Interested in improving your cyber security with the experts of SEC Consult? Contact our [local offices](https://sec-consult.com/contact/)*

[Back](/vulnerability-lab/)

* [Legal Notice](/legalnotice/)
* [Privacy Statement](/privacy-statement/)
* [Jobs](/career/)

SEC Consult is one of the leading consultancies in the field of cyber and [application security](/security-testing/web-application-security/ "Web Application Security"). The company specializes in [information security management](/processes-organisation/information-security-management-ism/ "Information Security Management (ISM)"), [NIS security audits](/processes-organisation/network-and-information-systems-security-nis/ "NIS security audits"), [penetration testing](/security-testing/penetration-testing/ "Pentesting (Pentest)"), ISO 27001 certification support, [Cyber Defence](/incident-response/sec-defence/ "Cyber Defence") and [secure software certification](/processes-organisation/secure-software-development/ "Secure Software Development Consulting"). SEC Consult is part of [Eviden](https://eviden.com/ "Link to Eviden website").

[![bsi ISO/IEC 27001 Information Security Management CERTIFIED](/typo3temp/assets/_processed_/c/2/csm_bsi_9a24e74563.png)](/about-us/ "About us")[![ISO 27001 CREST certified](/typo3temp/assets/_processed_/0/6/csm_crest_0eb9c5864d.png)](/about-us/ "About us")[![Great Place To Work AT certified](/typo3temp/assets/_processed_/0/3/csm_great-place-to-work-at_773b265aa6.png)](/about-us/ "About us")[![Great Place To Work DE certified](/typo3temp/assets/_processed_/d/6/csm_great-place-to-work-de_2fcb537270.png)](/about-us/ "About us")

## We use Cookies

We use cookies to offer you a perfect visit experience. These include cookies that are necessary for the operation of the site and for the control of our commercial corporate goals, as well as those that are only used for anonymous statistical purposes, for convenience settings or to display personalized content. Decide for yourself which categories you want to allow. Please note that based on your settings, not all functions of the site may be available.

**[Legal Notice](/legalnotice/)** •  **[Privacy Statement](/privacy-statement/)**

### Technically required

(
0
Service
)

no

Technically required (
0
Service
)

yes

### Analysis / statistics

(
1
Service
)

Anonymous evaluation for troubleshooting and further development

no

Analysis / statistics (
1
Service
)

yes

#### Matomo

no

Matomo

yes

Matomo.org
Show details

Hide details

**Purpose**: Error analysis, statistical evaluation of our website accesses, campaign analysis, conversion tracking.
 **Processing operations**: collection of access data, data from your browser and data about the content accessed; execution of analysis software and storage of data on your terminal device, anonymization of the data collected; evaluation of the anonymous data in the form of statistics.
 **Storage period**: 1 year.
 **Joint controller**: LimeSoda Interactive Marketing GmbH.
 **Legal basis for data processing**: Art. 6 para. 1 lit. f of the DSGVO.
 **Consequences of non-consent**: This basic tracking is absolutely necessary for the operation of our website.
 **Data transfer**: The data collected with Matomo is stored on our own servers. It is not passed on to third parties.

Accept selected

Reject all

Accept all

