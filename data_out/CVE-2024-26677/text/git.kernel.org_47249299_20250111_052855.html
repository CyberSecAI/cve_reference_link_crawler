

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | David Howells <dhowells@redhat.com> | 2024-02-02 15:19:14 +0000 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-02-05 12:34:06 +0000 |
| commit | [e7870cf13d20f56bfc19f9c3e89707c69cf104ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)) | |
| tree | [fd1790607b5fe0337996204fd60f896a6e8621b9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef) | |
| parent | [f31041417bf7f4a4df8b3bfb52cb31bbe805b934](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f31041417bf7f4a4df8b3bfb52cb31bbe805b934) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef&id2=f31041417bf7f4a4df8b3bfb52cb31bbe805b934)) | |
| download | [linux-e7870cf13d20f56bfc19f9c3e89707c69cf104ef.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e7870cf13d20f56bfc19f9c3e89707c69cf104ef.tar.gz) | |

rxrpc: Fix delayed ACKs to not set the reference serial numberFix the construction of delayed ACKs to not set the reference serial number
as they can't be used as an RTT reference.
Fixes: 17926a79320a ("[AF\_RXRPC]: Provide secure RxRPC sockets for use by userspace and kernel both")
Signed-off-by: David Howells <dhowells@redhat.com>
cc: Marc Dionne <marc.dionne@auristor.com>
cc: "David S. Miller" <davem@davemloft.net>
cc: Eric Dumazet <edumazet@google.com>
cc: Jakub Kicinski <kuba@kernel.org>
cc: Paolo Abeni <pabeni@redhat.com>
cc: linux-afs@lists.infradead.org
cc: netdev@vger.kernel.org
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)

| -rw-r--r-- | [net/rxrpc/ar-internal.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/rxrpc/ar-internal.h?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/rxrpc/call\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/rxrpc/call_event.c?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef) | 6 | |  |  |  | | --- | --- | --- | |

2 files changed, 1 insertions, 6 deletions

| diff --git a/net/rxrpc/ar-internal.h b/net/rxrpc/ar-internal.hindex 31b0dd8c9b2d74..b4ab26c3718a47 100644--- a/[net/rxrpc/ar-internal.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/rxrpc/ar-internal.h?id=f31041417bf7f4a4df8b3bfb52cb31bbe805b934)+++ b/[net/rxrpc/ar-internal.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/rxrpc/ar-internal.h?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)@@ -696,7 +696,6 @@ struct rxrpc\_call { /\* Receive-phase ACK management (ACKs we send). \*/ u8 ackr\_reason; /\* reason to ACK \*/ u16 ackr\_sack\_base; /\* Starting slot in SACK table ring \*/- rxrpc\_serial\_t ackr\_serial; /\* serial of packet being ACK'd \*/ rxrpc\_seq\_t ackr\_window; /\* Base of SACK window \*/ rxrpc\_seq\_t ackr\_wtop; /\* Base of SACK window \*/ unsigned int ackr\_nr\_unacked; /\* Number of unacked packets \*/diff --git a/net/rxrpc/call\_event.c b/net/rxrpc/call\_event.cindex e363f21a20141b..c61efe08695d7f 100644--- a/[net/rxrpc/call\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/rxrpc/call_event.c?id=f31041417bf7f4a4df8b3bfb52cb31bbe805b934)+++ b/[net/rxrpc/call\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/rxrpc/call_event.c?id=e7870cf13d20f56bfc19f9c3e89707c69cf104ef)@@ -43,8 +43,6 @@ void rxrpc\_propose\_delay\_ACK(struct rxrpc\_call \*call, rxrpc\_serial\_t serial, unsigned long expiry = rxrpc\_soft\_ack\_delay; unsigned long now = jiffies, ack\_at; - call->ackr\_serial = serial;- if (rxrpc\_soft\_ack\_delay < expiry) expiry = rxrpc\_soft\_ack\_delay; if (call->peer->srtt\_us != 0)@@ -373,7 +371,6 @@ static void rxrpc\_send\_initial\_ping(struct rxrpc\_call \*call) bool rxrpc\_input\_call\_event(struct rxrpc\_call \*call, struct sk\_buff \*skb) { unsigned long now, next, t;- rxrpc\_serial\_t ackr\_serial; bool resend = false, expired = false; s32 abort\_code; @@ -423,8 +420,7 @@ bool rxrpc\_input\_call\_event(struct rxrpc\_call \*call, struct sk\_buff \*skb) if (time\_after\_eq(now, t)) { trace\_rxrpc\_timer(call, rxrpc\_timer\_exp\_ack, now); cmpxchg(&call->delay\_ack\_at, t, now + MAX\_JIFFY\_OFFSET);- ackr\_serial = xchg(&call->ackr\_serial, 0);- rxrpc\_send\_ACK(call, RXRPC\_ACK\_DELAY, ackr\_serial,+ rxrpc\_send\_ACK(call, RXRPC\_ACK\_DELAY, 0, rxrpc\_propose\_ack\_ping\_for\_lost\_ack); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 05:27:32 +0000

