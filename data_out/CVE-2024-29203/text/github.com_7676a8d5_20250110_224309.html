
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftinymce%2Ftinymce%2Fcommit%2Fbcdea2ad14e3c2cea40743fb48c63bba067ae6d1)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftinymce%2Ftinymce%2Fcommit%2Fbcdea2ad14e3c2cea40743fb48c63bba067ae6d1)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=tinymce%2Ftinymce)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tinymce](/tinymce)
/
**[tinymce](/tinymce/tinymce)**
Public

* [Notifications](/login?return_to=%2Ftinymce%2Ftinymce) You must be signed in to change notification settings
* [Fork
  2.3k](/login?return_to=%2Ftinymce%2Ftinymce)
* [Star
   15.2k](/login?return_to=%2Ftinymce%2Ftinymce)

* [Code](/tinymce/tinymce)
* [Issues
  510](/tinymce/tinymce/issues)
* [Pull requests
  39](/tinymce/tinymce/pulls)
* [Discussions](/tinymce/tinymce/discussions)
* [Actions](/tinymce/tinymce/actions)
* [Security](/tinymce/tinymce/security)
* [Insights](/tinymce/tinymce/pulse)

Additional navigation options

* [Code](/tinymce/tinymce)
* [Issues](/tinymce/tinymce/issues)
* [Pull requests](/tinymce/tinymce/pulls)
* [Discussions](/tinymce/tinymce/discussions)
* [Actions](/tinymce/tinymce/actions)
* [Security](/tinymce/tinymce/security)
* [Insights](/tinymce/tinymce/pulse)

## Commit

[Permalink](/tinymce/tinymce/commit/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[TINY-10348](https://ephocks.atlassian.net/browse/TINY-10348) & [TINY-10349](https://ephocks.atlassian.net/browse/TINY-10349): Add sandbox\_iframes and convert\_unsafe\_embed…

[Browse files](/tinymce/tinymce/tree/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1)
Browse the repository at this point in the history

```
…s options ([#9172](https://github.com/tinymce/tinymce/pull/9172))

* [TINY-10348](https://ephocks.atlassian.net/browse/TINY-10348): Add sandbox_iframes option

* [TINY-10349](https://ephocks.atlassian.net/browse/TINY-10349): Add convert_unsafe_embeds option

* [TINY-10348](https://ephocks.atlassian.net/browse/TINY-10348) & [TINY-10349](https://ephocks.atlassian.net/browse/TINY-10349): Add paste tests

* [TINY-10348](https://ephocks.atlassian.net/browse/TINY-10348) & [TINY-10349](https://ephocks.atlassian.net/browse/TINY-10349): Add changelog entries

* [TINY-10348](https://ephocks.atlassian.net/browse/TINY-10348): Add missing PageBreakPlugin dependency in SelectionToolbarTest

* [TINY-10349](https://ephocks.atlassian.net/browse/TINY-10349): Add attribute preservation tests for convert_unsafe_embeds
```

* Loading branch information

[![@mkzhx](https://avatars.githubusercontent.com/u/56149628?s=40&v=4)](/mkzhx)

[mkzhx](/tinymce/tinymce/commits?author=mkzhx "View all commits by mkzhx")
authored
Nov 21, 2023

1 parent
[693fef6](/tinymce/tinymce/commit/693fef6287304759bc2f3dc31f76e9e74a68d8d1)

commit bcdea2a

 Show file tree

 Hide file tree

Showing
**16 changed files**
with
**483 additions**
and
**60 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* modules/tinymce

  + modules/tinymce/CHANGELOG.md
    [CHANGELOG.md](#diff-230a1d97cb8ef9885f06853bfe2485250430fb50d576b83537e4fb71abbdf4e4)
  + src

    - core

      * main/ts

        + api

          - modules/tinymce/src/core/main/ts/api/OptionTypes.ts
            [OptionTypes.ts](#diff-3a5b506ec14523b8e2a53b4148dd463a7476ff37e4561d1a71255928a5c17010)
          - modules/tinymce/src/core/main/ts/api/Options.ts
            [Options.ts](#diff-e34dfce40b9093ab5ccc86e6a2f1a61241a7dec3dfc7fa003007dadbd7667da5)
          - html

            * modules/tinymce/src/core/main/ts/api/html/DomParser.ts
              [DomParser.ts](#diff-6f02c7b2bc90a7443c69cbcc401505fa683e4e4c09192fa3eb36629373bdfb4d)
        + content

          - modules/tinymce/src/core/main/ts/content/PrePostProcess.ts
            [PrePostProcess.ts](#diff-35a741ac438bca1978849658533b994dea12d31d5a405b02a96c01de4b62546c)
        + html

          - modules/tinymce/src/core/main/ts/html/ParserFilters.ts
            [ParserFilters.ts](#diff-5885a04874473bbd0dc350d6dd914db41017fedbaffcfb8a19ef062028bf800e)
        + init

          - modules/tinymce/src/core/main/ts/init/InitContentBody.ts
            [InitContentBody.ts](#diff-4d50af9bfaaca2456c692f1652d553a87df60792203d18efa95b65de9ebf98bc)
        + paste

          - modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts
            [ProcessFilters.ts](#diff-7b57e933f1faf9b695f4ea4061e60a0d8cb9a5e584fc2af2267d08cfc5f329aa)
      * test/ts/browser

        + content

          - modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts
            [EditorContentTest.ts](#diff-cb6422127ed3faea8111900271ba9ba7aea22fe051f8c0ef5bdb3c826a172378)
        + html

          - modules/tinymce/src/core/test/ts/browser/html/DomParserTest.ts
            [DomParserTest.ts](#diff-9acd202580b16b531d14ad5cd69ed1bf16a6a27a2ea26ae8460ee6cd13b91b1e)
        + paste

          - modules/tinymce/src/core/test/ts/browser/paste/PasteTest.ts
            [PasteTest.ts](#diff-64211e0a773312944335c8ca0ea2f565baf16d5496c5816a56d60fc64c815fc7)
    - plugins

      * media

        + main/ts/core

          - modules/tinymce/src/plugins/media/main/ts/core/Nodes.ts
            [Nodes.ts](#diff-35364dd9f8a0cdafe6252f5dd033f7504606f36f0498f6e87eff378b6a775db0)
        + test/ts/browser

          - modules/tinymce/src/plugins/media/test/ts/browser/ContentFormatsTest.ts
            [ContentFormatsTest.ts](#diff-e5fc6dcb0236022a13cf71e528611fc1812e350f2c5c94382ce6b7b8dc21e500)
          - modules/tinymce/src/plugins/media/test/ts/browser/LiveEmbedNodeTest.ts
            [LiveEmbedNodeTest.ts](#diff-a33d84b7480cefb3409ac05ebc5b10fb3497ee598f3df985ff631b46bc4cc2d3)
          - modules/tinymce/src/plugins/media/test/ts/browser/PlaceholderTest.ts
            [PlaceholderTest.ts](#diff-1deb012e934b594da58d83723026a0562d18e95aab81585be97512f40bfc1504)
      * quickbars/test/ts/browser

        + modules/tinymce/src/plugins/quickbars/test/ts/browser/SelectionToolbarTest.ts
          [SelectionToolbarTest.ts](#diff-807eb16e66da8017c90c2d98bfbe2354a1ae2a3293f8ef1eeb7107a5c24f7f9e)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[modules/tinymce/CHANGELOG.md](#diff-230a1d97cb8ef9885f06853bfe2485250430fb50d576b83537e4fb71abbdf4e4 "modules/tinymce/CHANGELOG.md")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -14,6 +14,8 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0 |
|  |  | - Added new `StylesheetLoader.unloadRawCss` API that can be used to unload CSS that was loaded into a style element. #TINY-10352 |
|  |  | - Added `force\_hex\_color` editor option. Option `'always'` converts all RGB & RGBA colours to hex, `'rgb\_only'` will only convert RGB and \*not\* RGBA colours to hex, `'off'` won't convert any colours to hex. #TINY-9819 |
|  |  | - Added `default\_font\_stack` editor option that makes it possible to define what is considered a system font stack. #TINY-10290 |
|  |  | - New `sandbox\_iframes` option that controls whether iframe elements will be added a `sandbox=""` attribute to mitigate malicious intent. #TINY-10348 |
|  |  | - New `convert\_unsafe\_embeds` option that controls whether `<object>` and `<embed>` elements will be converted to more restrictive alternatives, namely `<img>` for image MIME types, `<video>` for video MIME types, `<audio>` audio MIME types, or `<iframe>` for other or unspecified MIME types. #TINY-10349 |
|  |  |  |
|  |  |  |
|  |  | ### Improved |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[modules/tinymce/src/core/main/ts/api/OptionTypes.ts](#diff-3a5b506ec14523b8e2a53b4148dd463a7476ff37e4561d1a71255928a5c17010 "modules/tinymce/src/core/main/ts/api/OptionTypes.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/api/OptionTypes.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -86,6 +86,7 @@ interface BaseEditorOptions { |
|  |  | contextmenu?: string | string[] | false; |
|  |  | contextmenu\_never\_use\_native?: boolean; |
|  |  | convert\_fonts\_to\_spans?: boolean; |
|  |  | convert\_unsafe\_embeds?: boolean; |
|  |  | convert\_urls?: boolean; |
|  |  | custom\_colors?: boolean; |
|  |  | custom\_elements?: string; |
| Expand Down  Expand Up | | @@ -197,6 +198,7 @@ interface BaseEditorOptions { |
|  |  | resize?: boolean | 'both'; |
|  |  | resize\_img\_proportional?: boolean; |
|  |  | root\_name?: string; |
|  |  | sandbox\_iframes?: boolean; |
|  |  | schema?: SchemaType; |
|  |  | selector?: string; |
|  |  | setup?: SetupCallback; |
| Expand Down  Expand Up | | @@ -289,6 +291,7 @@ export interface EditorOptions extends NormalizedEditorOptions { |
|  |  | color\_default\_foreground: string; |
|  |  | content\_css: string[]; |
|  |  | contextmenu: string[]; |
|  |  | convert\_unsafe\_embeds: boolean; |
|  |  | custom\_colors: boolean; |
|  |  | default\_font\_stack: string[]; |
|  |  | document\_base\_url: string; |
| Expand Down  Expand Up | | @@ -336,6 +339,7 @@ export interface EditorOptions extends NormalizedEditorOptions { |
|  |  | promotion: boolean; |
|  |  | readonly: boolean; |
|  |  | removed\_menuitems: string; |
|  |  | sandbox\_iframes: boolean; |
|  |  | toolbar: boolean | string | string[] | Array<ToolbarGroup>; |
|  |  | toolbar\_groups: Record<string, Toolbar.GroupToolbarButtonSpec>; |
|  |  | toolbar\_location: ToolbarLocation; |
| Expand Down | |  |

39 changes: 20 additions & 19 deletions

39
[modules/tinymce/src/core/main/ts/api/Options.ts](#diff-e34dfce40b9093ab5ccc86e6a2f1a61241a7dec3dfc7fa003007dadbd7667da5 "modules/tinymce/src/core/main/ts/api/Options.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/api/Options.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -836,6 +836,16 @@ const register = (editor: Editor): void => { |
|  |  | default: 'off', |
|  |  | }); |
|  |  |  |
|  |  | registerOption('sandbox\_iframes', { |
|  |  | processor: 'boolean', |
|  |  | default: false |
|  |  | }); |
|  |  |  |
|  |  | registerOption('convert\_unsafe\_embeds', { |
|  |  | processor: 'boolean', |
|  |  | default: false |
|  |  | }); |
|  |  |  |
|  |  | // These options must be registered later in the init sequence due to their default values |
|  |  | editor.on('ScriptsLoaded', () => { |
|  |  | registerOption('directionality', { |
| Expand Down  Expand Up | | @@ -944,28 +954,17 @@ const shouldPreserveCData = option('preserve\_cdata'); |
|  |  | const shouldHighlightOnFocus = option('highlight\_on\_focus'); |
|  |  | const shouldSanitizeXss = option('xss\_sanitization'); |
|  |  | const shouldUseDocumentWrite = option('init\_content\_sync'); |
|  |  |  |
|  |  | const hasTextPatternsLookup = (editor: Editor): boolean => |
|  |  | editor.options.isSet('text\_patterns\_lookup'); |
|  |  |  |
|  |  | const getFontStyleValues = (editor: Editor): string[] => |
|  |  | Tools.explode(editor.options.get('font\_size\_style\_values')); |
|  |  |  |
|  |  | const getFontSizeClasses = (editor: Editor): string[] => |
|  |  | Tools.explode(editor.options.get('font\_size\_classes')); |
|  |  |  |
|  |  | const isEncodingXml = (editor: Editor): boolean => |
|  |  | editor.options.get('encoding') === 'xml'; |
|  |  |  |
|  |  | const getAllowedImageFileTypes = (editor: Editor): string[] => |
|  |  | Tools.explode(editor.options.get('images\_file\_types')); |
|  |  |  |
|  |  | const hasTextPatternsLookup = (editor: Editor): boolean => editor.options.isSet('text\_patterns\_lookup'); |
|  |  | const getFontStyleValues = (editor: Editor): string[] => Tools.explode(editor.options.get('font\_size\_style\_values')); |
|  |  | const getFontSizeClasses = (editor: Editor): string[] => Tools.explode(editor.options.get('font\_size\_classes')); |
|  |  | const isEncodingXml = (editor: Editor): boolean => editor.options.get('encoding') === 'xml'; |
|  |  | const getAllowedImageFileTypes = (editor: Editor): string[] => Tools.explode(editor.options.get('images\_file\_types')); |
|  |  | const hasTableTabNavigation = option('table\_tab\_navigation'); |
|  |  |  |
|  |  | const getDetailsInitialState = option('details\_initial\_state'); |
|  |  | const getDetailsSerializedState = option('details\_serialized\_state'); |
|  |  |  |
|  |  | const shouldForceHexColor = option('force\_hex\_color'); |
|  |  | const shouldSandboxIframes = option('sandbox\_iframes'); |
|  |  | const shouldConvertUnsafeEmbeds = option('convert\_unsafe\_embeds'); |
|  |  |  |
|  |  | export { |
|  |  | register, |
| Expand Down  Expand Up | | @@ -1071,5 +1070,7 @@ export { |
|  |  | getDetailsInitialState, |
|  |  | getDetailsSerializedState, |
|  |  | shouldUseDocumentWrite, |
|  |  | shouldForceHexColor |
|  |  | shouldForceHexColor, |
|  |  | shouldSandboxIframes, |
|  |  | shouldConvertUnsafeEmbeds |
|  |  | }; |

2 changes: 2 additions & 0 deletions

2
[modules/tinymce/src/core/main/ts/api/html/DomParser.ts](#diff-6f02c7b2bc90a7443c69cbcc401505fa683e4e4c09192fa3eb36629373bdfb4d "modules/tinymce/src/core/main/ts/api/html/DomParser.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/api/html/DomParser.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,6 +57,7 @@ export interface DomParserSettings { |
|  |  | allow\_unsafe\_link\_target?: boolean; |
|  |  | blob\_cache?: BlobCache; |
|  |  | convert\_fonts\_to\_spans?: boolean; |
|  |  | convert\_unsafe\_embeds?: boolean; |
|  |  | document?: Document; |
|  |  | fix\_list\_elements?: boolean; |
|  |  | font\_size\_legacy\_values?: string; |
| Expand All | | @@ -69,6 +70,7 @@ export interface DomParserSettings { |
|  |  | \* @deprecated Remove trailing <br> tags functionality has been added to tinymce.dom.Serializer and option will be removed in the next major release \*/ |
|  |  | remove\_trailing\_brs?: boolean; |
|  |  | root\_name?: string; |
|  |  | sandbox\_iframes?: boolean; |
|  |  | sanitize?: boolean; |
|  |  | validate?: boolean; |
|  |  | } |
| Expand Down | |  |

10 changes: 5 additions & 5 deletions

10
[modules/tinymce/src/core/main/ts/content/PrePostProcess.ts](#diff-35a741ac438bca1978849658533b994dea12d31d5a405b02a96c01de4b62546c "modules/tinymce/src/core/main/ts/content/PrePostProcess.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/content/PrePostProcess.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,7 @@ import { Result } from '@ephox/katamari'; |
|  |  |  |
|  |  | import Editor from '../api/Editor'; |
|  |  | import \* as Events from '../api/Events'; |
|  |  | import DomParser from '../api/html/DomParser'; |
|  |  | import DomParser, { DomParserSettings } from '../api/html/DomParser'; |
|  |  | import HtmlSerializer from '../api/html/Serializer'; |
|  |  | import \* as Options from '../api/Options'; |
|  |  | import { EditorEvent } from '../api/util/EventDispatcher'; |
| Expand All | | @@ -11,7 +11,7 @@ import { Content, GetContentArgs, isTreeNode, SetContentArgs } from './ContentTy |
|  |  | const serializeContent = (content: Content): string => |
|  |  | isTreeNode(content) ? HtmlSerializer({ validate: false }).serialize(content) : content; |
|  |  |  |
|  |  | const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, sanitize: boolean): R & { content: Content } => { |
|  |  | const withSerializedContent = <R extends EditorEvent<{ content: string }>>(content: Content, fireEvent: (content: string) => R, parserSettings: DomParserSettings): R & { content: Content } => { |
|  |  | const serializedContent = serializeContent(content); |
|  |  | const eventArgs = fireEvent(serializedContent); |
|  |  | if (eventArgs.isDefaultPrevented()) { |
| Expand All | | @@ -20,7 +20,7 @@ const withSerializedContent = <R extends EditorEvent<{ content: string }>>(conte |
|  |  | // Restore the content type back to being an AstNode. If the content has changed we need to |
|  |  | // re-parse the new content, otherwise we can return the input. |
|  |  | if (eventArgs.content !== serializedContent) { |
|  |  | const rootNode = DomParser({ validate: false, forced\_root\_block: false, sanitize }).parse(eventArgs.content, { context: content.name }); |
|  |  | const rootNode = DomParser({ validate: false, forced\_root\_block: false, ...parserSettings }).parse(eventArgs.content, { context: content.name }); |
|  |  | return { ...eventArgs, content: rootNode }; |
|  |  | } else { |
|  |  | return { ...eventArgs, content }; |
| Expand All | | @@ -47,7 +47,7 @@ const postProcessGetContent = <T extends GetContentArgs>(editor: Editor, content |
|  |  | if (args.no\_events) { |
|  |  | return content; |
|  |  | } else { |
|  |  | const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor)); |
|  |  | const processedEventArgs = withSerializedContent(content, (content) => Events.fireGetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox\_iframes: Options.shouldSandboxIframes(editor) }); |
|  |  | return processedEventArgs.content; |
|  |  | } |
|  |  | }; |
| Expand All | | @@ -56,7 +56,7 @@ const preProcessSetContent = <T extends SetContentArgs>(editor: Editor, args: T) |
|  |  | if (args.no\_events) { |
|  |  | return Result.value(args); |
|  |  | } else { |
|  |  | const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), Options.shouldSanitizeXss(editor)); |
|  |  | const processedEventArgs = withSerializedContent(args.content, (content) => Events.fireBeforeSetContent(editor, { ...args, content }), { sanitize: Options.shouldSanitizeXss(editor), sandbox\_iframes: Options.shouldSandboxIframes(editor) }); |
|  |  | if (processedEventArgs.isDefaultPrevented()) { |
|  |  | Events.fireSetContent(editor, processedEventArgs); |
|  |  | return Result.error(undefined); |
| Expand Down | |  |

49 changes: 48 additions & 1 deletion

49
[modules/tinymce/src/core/main/ts/html/ParserFilters.ts](#diff-5885a04874473bbd0dc350d6dd914db41017fedbaffcfb8a19ef062028bf800e "modules/tinymce/src/core/main/ts/html/ParserFilters.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/html/ParserFilters.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,4 @@ |
|  |  | import { Arr, Type } from '@ephox/katamari'; |
|  |  | import { Arr, Strings, Type } from '@ephox/katamari'; |
|  |  |  |
|  |  | import Env from '../api/Env'; |
|  |  | import DomParser, { DomParserSettings } from '../api/html/DomParser'; |
| Expand Down  Expand Up | | @@ -32,6 +32,36 @@ const registerBase64ImageFilter = (parser: DomParser, settings: DomParserSetting |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | const isMimeType = (mime: string, type: 'image' | 'video' | 'audio'): boolean => Strings.startsWith(mime, `${type}/`); |
|  |  |  |
|  |  | const createSafeEmbed = (mime?: string, src?: string, width?: string, height?: string, sandboxIframes?: boolean): AstNode => { |
|  |  | let name: 'iframe' | 'img' | 'video' | 'audio'; |
|  |  | if (Type.isUndefined(mime)) { |
|  |  | name = 'iframe'; |
|  |  | } else if (isMimeType(mime, 'image')) { |
|  |  | name = 'img'; |
|  |  | } else if (isMimeType(mime, 'video')) { |
|  |  | name = 'video'; |
|  |  | } else if (isMimeType(mime, 'audio')) { |
|  |  | name = 'audio'; |
|  |  | } else { |
|  |  | name = 'iframe'; |
|  |  | } |
|  |  |  |
|  |  | const embed = new AstNode(name, 1); |
|  |  | embed.attr(name === 'audio' ? { src } : { src, width, height }); |
|  |  |  |
|  |  | // TINY-10349: Show controls for audio and video so the replaced embed is visible in editor. |
|  |  | if (name === 'audio' || name === 'video') { |
|  |  | embed.attr('controls', ''); |
|  |  | } |
|  |  |  |
|  |  | if (name === 'iframe' && sandboxIframes) { |
|  |  | embed.attr('sandbox', ''); |
|  |  | } |
|  |  | return embed; |
|  |  | }; |
|  |  |  |
|  |  | const register = (parser: DomParser, settings: DomParserSettings): void => { |
|  |  | const schema = parser.schema; |
|  |  |  |
| Expand Down  Expand Up | | @@ -153,6 +183,23 @@ const register = (parser: DomParser, settings: DomParserSettings): void => { |
|  |  | } |
|  |  |  |
|  |  | registerBase64ImageFilter(parser, settings); |
|  |  |  |
|  |  | if (settings.convert\_unsafe\_embeds) { |
|  |  | parser.addNodeFilter('object,embed', (nodes) => Arr.each(nodes, (node) => { |
|  |  | node.replace( |
|  |  | createSafeEmbed( |
|  |  | node.attr('type'), |
|  |  | node.name === 'object' ? node.attr('data') : node.attr('src'), |
|  |  | node.attr('width'), |
|  |  | node.attr('height'), |
|  |  | settings.sandbox\_iframes |
|  |  | )); |
|  |  | })); |
|  |  | } |
|  |  |  |
|  |  | if (settings.sandbox\_iframes) { |
|  |  | parser.addNodeFilter('iframe', (nodes) => Arr.each(nodes, (node) => node.attr('sandbox', ''))); |
|  |  | } |
|  |  | }; |
|  |  |  |
|  |  | export { |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[modules/tinymce/src/core/main/ts/init/InitContentBody.ts](#diff-4d50af9bfaaca2456c692f1652d553a87df60792203d18efa95b65de9ebf98bc "modules/tinymce/src/core/main/ts/init/InitContentBody.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/init/InitContentBody.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -73,6 +73,7 @@ const mkParserSettings = (editor: Editor): DomParserSettings => { |
|  |  | allow\_html\_in\_named\_anchor: getOption('allow\_html\_in\_named\_anchor'), |
|  |  | allow\_script\_urls: getOption('allow\_script\_urls'), |
|  |  | allow\_unsafe\_link\_target: getOption('allow\_unsafe\_link\_target'), |
|  |  | convert\_unsafe\_embeds: getOption('convert\_unsafe\_embeds'), |
|  |  | convert\_fonts\_to\_spans: getOption('convert\_fonts\_to\_spans'), |
|  |  | fix\_list\_elements: getOption('fix\_list\_elements'), |
|  |  | font\_size\_legacy\_values: getOption('font\_size\_legacy\_values'), |
| Expand All | | @@ -81,6 +82,7 @@ const mkParserSettings = (editor: Editor): DomParserSettings => { |
|  |  | preserve\_cdata: getOption('preserve\_cdata'), |
|  |  | inline\_styles: getOption('inline\_styles'), |
|  |  | root\_name: getRootName(editor), |
|  |  | sandbox\_iframes: getOption('sandbox\_iframes'), |
|  |  | sanitize: getOption('xss\_sanitization'), |
|  |  | validate: true, |
|  |  | blob\_cache: blobCache, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts](#diff-7b57e933f1faf9b695f4ea4061e60a0d8cb9a5e584fc2af2267d08cfc5f329aa "modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/main/ts/paste/ProcessFilters.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,7 +11,7 @@ interface ProcessResult { |
|  |  | } |
|  |  |  |
|  |  | const preProcess = (editor: Editor, html: string): string => { |
|  |  | const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor) }, editor.schema); |
|  |  | const parser = DomParser({ sanitize: Options.shouldSanitizeXss(editor), sandbox\_iframes: Options.shouldSandboxIframes(editor) }, editor.schema); |
|  |  |  |
|  |  | // Strip meta elements |
|  |  | parser.addNodeFilter('meta', (nodes) => { |
| Expand Down | |  |

124 changes: 123 additions & 1 deletion

124
[modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts](#diff-cb6422127ed3faea8111900271ba9ba7aea22fe051f8c0ef5bdb3c826a172378 "modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts")

Show comments

[View file](/tinymce/tinymce/blob/bcdea2ad14e3c2cea40743fb48c63bba067ae6d1/modules/tinymce/src/core/test/ts/browser/content/EditorContentTest.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -350,6 +350,128 @@ describe('browser.tinymce.core.content.EditorContentTest', () => { |
|  |  | assert.equal(content, final, 'ZWNBSP should be stripped'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | context('iframe sandboxing', () => { |
|  |  | context('sandbox\_iframes default', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce' |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10348: Iframe should not be sandboxed by default', () => { |
|  |  | const editor = hook.editor(); |
|  |  | editor.setContent('<iframe src="about:blank"></iframe>'); |
|  |  | TinyAssertions.assertContent(editor, '<p><iframe src="about:blank"></iframe></p>'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | context('sandbox\_iframes: false', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce', |
|  |  | sandbox\_iframes: false |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10348: Iframe should not be sandboxed when sandbox\_iframes: false', () => { |
|  |  | const editor = hook.editor(); |
|  |  | editor.setContent('<iframe src="about:blank"></iframe>'); |
|  |  | TinyAssertions.assertContent(editor, '<p><iframe src="about:blank"></iframe></p>'); |
|  |  | }); |
|  |  |  |
|  |  | it('TINY-10348: Iframe with sandbox attribute should not be modified when sandbox\_iframes: false', () => { |
|  |  | const editor = hook.editor(); |
|  |  | editor.setContent('<iframe src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>'); |
|  |  | TinyAssertions.assertContent(editor, '<p><iframe src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms"></iframe></p>'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | context('sandbox\_iframes: true', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce', |
|  |  | sandbox\_iframes: true |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10348: Iframe should be sandboxed when sandbox\_iframes: true', () => { |
|  |  | const editor = hook.editor(); |
|  |  | editor.setContent('<iframe src="about:blank"></iframe>'); |
|  |  | TinyAssertions.assertContent(editor, '<p><iframe src="about:blank" sandbox=""></iframe></p>'); |
|  |  | }); |
|  |  |  |
|  |  | it('TINY-10348: Iframe with sandbox attribute should be sandboxed when sandbox\_iframes: true', () => { |
|  |  | const editor = hook.editor(); |
|  |  | editor.setContent('<iframe src="about:blank" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>'); |
|  |  | TinyAssertions.assertContent(editor, '<p><iframe src="about:blank" sandbox=""></iframe></p>'); |
|  |  | }); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | context('Convert unsafe embeds', () => { |
|  |  | const setAndAssertEmbed = (editor: Editor, embedHtml: string, expectedHtml: string) => { |
|  |  | editor.setContent(embedHtml); |
|  |  | TinyAssertions.assertContent(editor, `<p>${expectedHtml}</p>`); |
|  |  | }; |
|  |  |  |
|  |  | const testNoConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string) => () => { |
|  |  | const editor = hook.editor(); |
|  |  | setAndAssertEmbed(editor, embedHtml, embedHtml); |
|  |  | }; |
|  |  |  |
|  |  | const testConversion = (hook: TinyHooks.Hook<Editor>, embedHtml: string, expectedHtml: string) => () => { |
|  |  | const editor = hook.editor(); |
|  |  | setAndAssertEmbed(editor, embedHtml, expectedHtml); |
|  |  | }; |
|  |  |  |
|  |  | context('convert\_unsafe\_embeds default', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce' |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data="about:blank"></object>')); |
|  |  | it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src="about:blank">')); |
|  |  | }); |
|  |  |  |
|  |  | context('convert\_unsafe\_embeds: false', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce', |
|  |  | convert\_unsafe\_embeds: false |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10349: Object elements should not be converted', testNoConversion(hook, '<object data="about:blank"></object>')); |
|  |  | it('TINY-10349: Embed elements should not be converted', testNoConversion(hook, '<embed src="about:blank">')); |
|  |  | }); |
|  |  |  |
|  |  | context('convert\_unsafe\_embeds: true', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce', |
|  |  | convert\_unsafe\_embeds: true |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10349: Object elements should be converted to iframe', |
|  |  | testConversion(hook, '<object data="about:blank"></object>', '<iframe src="about:blank"></iframe>')); |
|  |  |  |
|  |  | it('TINY-10349: Embed elements should be converted to iframe', |
|  |  | testConversion(hook, '<embed src="about:blank">', '<iframe src="about:blank"></iframe>')); |
|  |  | }); |
|  |  |  |
|  |  | context('convert\_unsafe\_embeds: true, sandbox\_iframes: true', () => { |
|  |  | const hook = TinyHooks.bddSetupLight<Editor>({ |
|  |  | ...options, |
|  |  | base\_url: '/project/tinymce/js/tinymce', |
|  |  | convert\_unsafe\_embeds: true, |
|  |  | sandbox\_iframes: true |
|  |  | }, []); |
|  |  |  |
|  |  | it('TINY-10349: Object elements should be converted to sandboxed iframe', |
|  |  | testConversion(hook, '<object data="about:blank"></object>', '<iframe src="about:blank" sandbox=""></iframe>')); |
|  |  |  |
|  |  | it('TINY-10349: Embed elements should be converted to sandboxed iframe', |
|  |  | testConversion(hook, '<embed src="about:blank">', '<iframe src="about:blank" sandbox=""></iframe>')); |
|  |  | }); |
|  |  | }); |
|  |  | }); |
|  |  | } |
|  |  | ); |
| Expand Down  Expand Up | | @@ -433,7 +555,7 @@ describe('browser.tinymce.core.content.EditorContentTest', () => { |
|  |  | editor.setContent('<p><iframe><p>test</p></iframe></p>'); |
|  |  | const content = editor.getContent(); |
|  |  | assert.equal(content, |
|  |  | // TINY-9624: Investigate Safari-specific HTML output |
|  |  | // TINY-9624: Safari seems to encode the contents of iframes |
|  |  | isSafari |
|  |  | ? '<p><iframe>&lt;p&gt;test&lt;/p&gt;</iframe></p>' |
|  |  | : '<p><iframe><p>test</p></iframe></p>', |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bcdea2a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftinymce%2Ftinymce%2Fcommit%2Fbcdea2ad14e3c2cea40743fb48c63bba067ae6d1) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

