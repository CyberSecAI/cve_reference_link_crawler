<!DOCTYPE html>
<html lang="en">
<head>

    <title>Vulnerabilities in Tenda&#x27;s W15Ev2 AC1200 Router</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="preload" as="style" href="https://boschko.ca/assets/built/screen.css?v=4f517c742f" />
    <link rel="preload" as="script" href="https://boschko.ca/assets/built/casper.js?v=4f517c742f" />

    <link rel="stylesheet" type="text/css" href="https://boschko.ca/assets/built/screen.css?v=4f517c742f" />

    <meta name="description" content="Tenda AC1200 W15Ev2 Vulnerabilities: CVE-2022-40843 CVE-2022-40845 CVE-2022-40847 CVE-2022-40844 CVE-2022-40846 CVE-2022-41395 CVE-2022-41396...">
    <link rel="canonical" href="https://boschko.ca/tenda_ac1200_router/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="https://boschko.ca/tenda_ac1200_router/amp/">
    
    <meta property="og:site_name" content="Boschko Security Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Vulnerabilities in Tenda&#x27;s W15Ev2 AC1200 Router">
    <meta property="og:description" content="CVE-2022-40843 CVE-2022-40845 CVE-2022-40847 CVE-2022-40844 CVE-2022-40846 CVE-2022-41395 CVE-2022-41396 CVE-2022-42053 CVE-2022-42058 CVE-2022-42060">
    <meta property="og:url" content="https://boschko.ca/tenda_ac1200_router/">
    <meta property="og:image" content="https://boschko.ca/content/images/2022/10/Greenshot-2022-10-07-11.59.43-1.jpg">
    <meta property="article:published_time" content="2022-10-19T18:16:50.000Z">
    <meta property="article:modified_time" content="2024-11-25T22:15:12.000Z">
    <meta property="article:tag" content="Reverse Engineering">
    <meta property="article:tag" content="Web">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Vulnerabilities in Tenda&#x27;s W15Ev2 AC1200 Router">
    <meta name="twitter:description" content="CVE-2022-40843 CVE-2022-40845 CVE-2022-40847 CVE-2022-40844 CVE-2022-40846 CVE-2022-41395 CVE-2022-41396 CVE-2022-42053 CVE-2022-42058 CVE-2022-42060">
    <meta name="twitter:url" content="https://boschko.ca/tenda_ac1200_router/">
    <meta name="twitter:image" content="https://boschko.ca/content/images/2022/10/Greenshot-2022-10-07-11.59.43.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Olivier Laflamme">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Reverse Engineering, Web">
    <meta name="twitter:site" content="@olivier_boschko">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="355">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Boschko Security Blog",
        "url": "https://boschko.ca/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://boschko.ca/content/images/2021/09/Capture.PNG"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Olivier Laflamme",
        "image": {
            "@type": "ImageObject",
            "url": "https://boschko.ca/content/images/2021/09/119486535_632169284368147_173960549788702982_n-1.jpg",
            "width": 1080,
            "height": 1075
        },
        "url": "https://boschko.ca/author/olivier/",
        "sameAs": []
    },
    "headline": "Vulnerabilities in Tenda&#x27;s W15Ev2 AC1200 Router",
    "url": "https://boschko.ca/tenda_ac1200_router/",
    "datePublished": "2022-10-19T18:16:50.000Z",
    "dateModified": "2024-11-25T22:15:12.000Z",
    "keywords": "Reverse Engineering, Web",
    "description": "Reverse engineering Tenda&#x27;s W15Ev2 AC1200 SOHO router discovering 10 0-days (10 CVEs).",
    "mainEntityOfPage": "https://boschko.ca/tenda_ac1200_router/"
}
    </script>

    <meta name="generator" content="Ghost 5.105">
    <link rel="alternate" type="application/rss+xml" title="Boschko Security Blog" href="https://boschko.ca/rss/">
    <script defer src="https://cdn.jsdelivr.net/ghost/portal@~2.46/umd/portal.min.js" data-i18n="true" data-ghost="https://boschko.ca/" data-key="0ab6c89b32274048f7d9cc1298" data-api="https://boschko-security-blog.ghost.io/ghost/api/content/" data-locale="en" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.5/umd/sodo-search.min.js" data-key="0ab6c89b32274048f7d9cc1298" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.5/umd/main.css" data-sodo-search="https://boschko-security-blog.ghost.io/" data-locale="en" crossorigin="anonymous"></script>
    
    <link href="https://boschko.ca/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=4f517c742f"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=4f517c742f">
    <script defer src="/public/member-attribution.min.js?v=4f517c742f"></script><style>:root {--ghost-accent-color: #000000;}</style>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-209482797-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-209482797-1');
  gtag('set', {'user_id': 'USER_ID'}); // Set the user ID using signed-in user_id
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3GEFND46EZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3GEFND46EZ');
</script>

</head>
<body class="post-template tag-reverse-engineering tag-web is-head-left-logo has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <div class="gh-head-inner inner">
            <div class="gh-head-brand">
                <a class="gh-head-logo" href="https://boschko.ca">
                        <img src="https://boschko.ca/content/images/2021/09/Capture.PNG" alt="Boschko Security Blog">
                </a>
                <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger" aria-label="Main Menu"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://boschko.ca/">Home</a></li>
    <li class="nav-tags"><a href="https://boschko.ca/tags/">Tags</a></li>
    <li class="nav-about-boschko"><a href="https://boschko.ca/about/">About Boschko</a></li>
    <li class="nav-red-rain-security"><a href="https://boschko.ca/redrainsecurity/">Red Rain Security</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                    <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    <div class="gh-head-members">
                                <a class="gh-head-link" href="#/portal/signin" data-portal="signin">Sign in</a>
                                <a class="gh-head-button" href="#/portal/signup" data-portal="signup">Subscribe</a>
                    </div>
            </div>
        </div>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-reverse-engineering tag-web no-image ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/reverse-engineering/">Reverse Engineering</a>
                </span>
        </div>

        <h1 class="article-title">Vulnerabilities in Tenda&#x27;s W15Ev2 AC1200 Router</h1>

            <p class="article-excerpt">Reverse engineering Tenda&#x27;s W15Ev2 AC1200 SOHO router discovering 10 0-days (10 CVEs).</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list instapaper_ignore">
                <li class="author-list-item">
                    <a href="/author/olivier/" class="author-avatar" aria-label="Read more of Olivier Laflamme">
                        <img class="author-profile-image" src="/content/images/size/w100/2021/09/119486535_632169284368147_173960549788702982_n-1.jpg" alt="Olivier Laflamme" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/olivier/">Olivier Laflamme</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2022-10-19">19 Oct 2022</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 33 min read</span>
                </div>
            </div>

        </section>
        </div>


    </header>

    <section class="gh-content gh-canvas">
        <p>Lately, after work, I've really enjoyed hacking and reverse engineering funky IoT devices. In early May of 2022, I went on a little Amazon/AliExpress shopping spree and bought ~15 cheap IoT devices. Among them was this compact SOHO router by <a href="https://www.tendacn.com/?ref=boschko.ca">Tenda</a>. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-23.png" class="kg-image" alt="" loading="lazy" width="1506" height="984" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-23.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-23.png 1000w, https://boschko.ca/content/images/2022/09/image-23.png 1506w" sizes="(min-width: 720px) 720px"></figure><p>Shenzhen Tenda Technology Co., Ltd. hereafter referred to as Tenda is one of the leading suppliers of networking devices and equipment. Tenda has committed to delivering easy-to-install and affordable networking solutions, offering innovative, cutting-edge products to realize people's intelligent life. They are a Chinese company based in Shenzhen, China with R&amp;D centers, in Shenzhen and Chengdu. Reportedly with over ~1000 employees they're fairly well established in the industry and offer a wide variety of products. The company’s official website is <a href="https://www.tendacn.com/?ref=boschko.ca">www.tendacn.com</a>.</p><p>The router I purchased was the AC1200 SOHO router model <u>W15Ev2</u> with the <a href="https://www.tendacn.com/download/detail-3762.html?ref=boschko.ca">firmware V15.11.0.10(1576)</a>. The chip model for the device is <code>qca9531</code> (qca9531_wifi) by Qualcomm which is a 2.4 GHz System-on-a-Chip (SoC) that leverages a MIPS 24Kc processor. </p><p>Performing a <code>GET</code> request on <code>/goform/version</code> or <code>/common/macro_config.js</code> identifies the firmware version. Out-of-the-box mine was <code>CONFIG_FIRWARE_VERION: "V15.11.0.10(1576)"</code> which was released <strong>≤ </strong><code>2019-12-17</code></p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-112.png" class="kg-image" alt="" loading="lazy" width="1006" height="332" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-112.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-112.png 1000w, https://boschko.ca/content/images/2022/09/image-112.png 1006w" sizes="(min-width: 720px) 720px"></figure><p>Going to Tenda's firmware <a href="https://www.tenda.com.cn/product/download/W15E.html?ref=boschko.ca">downloads</a> page confirms we're on their latest Chinese deployment. Due to the seeming lack of interest, I will only be testing the <code>V15.11.0.10(1576)</code> firmware.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-26.png" class="kg-image" alt="" loading="lazy" width="658" height="503" srcset="https://boschko.ca/content/images/size/w600/2022/10/image-26.png 600w, https://boschko.ca/content/images/2022/10/image-26.png 658w"></figure><hr><p>Multiple attempts were made through numerous communication channels to contact this vendor, but all failed. I try my best to act in a transparent, responsible, and consistent manner, with the goal of building a safer online space. In order to achieve this, I adhere to a 90-day time frame from the initial contact to public disclosure. If you have any ethical dilemmas or moral qualms as a result of this publication, I urge you to read the section entitled "Thoughts On Responsible Disclosure" situated towards the end of the blog to better understand the events, my perspective, and reasons for disclosure.</p><h3 id="disclosure-timeline">Disclosure Timeline </h3><p><strong>July 18, 2022</strong>: Vulnerability discovered and first reported<br>
<strong>August 6, 2022</strong>: Second attempt to make contact, further informing the vendor of the severity of the vulnerability<br>
<strong>August 13, 2022</strong>: WeChat &amp; QQ attempt to contact the vendor<br>
<strong>September 2, 2022</strong>: A Third attempt to contact the vendor<br>
<strong>September 13, 2022</strong>: File for CVE assignment through Mitre.org<br>
<strong>September 19, 2022</strong>: File for additional CVE assignment through Mitre.org<br>
<strong>September 26, 2022</strong>: File for additional CVE assignment through Mitre.org<br>
<strong>September 26, 2022</strong>: Forth attempt to contact vendor, informing them of assigned 5 CVEs<br>
<strong>October 3, 2022</strong>: Fifth attempt to make contact, further informing vendors of the severity &amp; number of vulnerabilities<br>
<strong>October 10, 2022</strong>: Sixth attempt to contact the vendor<br>
<strong>October 17, 2022</strong>: Final contact attempted &amp; warning of public disclosure &amp; confirming 10 CVEs had been assigned to their product<br>
<strong>October 19, 2022</strong>: Public disclosure</p>
<hr><h3 id="vulnerabilities-list">Vulnerabilities List</h3><p>A total of 11 vulnerabilities were identified in Tenda's AC1200 W15Ev2 router and IoT cloud gateway peripheral:</p><pre><code>1. Improper Authorization (CVE-2022-40843)
2. Password Disclosure (CVE-2022-40845)
3. Improper Access Control 
4. OS Command Injection #1 (CVE-2022-40847)
5. OS Command Injection #2 (CVE-2022-41396)
6. OS Command Injection #3 (CVE-2022-41395)
7. OS Command Injection #4 (CVE-2022-42053)
8. Stack-based Buffer Overflow #1 (CVE-2022-42058)
9. Stack-based Buffer Overflow #2 (CVE-2022-42060)
10. Stored XSS in Website Filtering (CVE-2022-40844)
11. Stored XSS in Online Device Names (CVE-2022-40846)</code></pre><hr><h2 id="web-application"><strong>Web Application </strong></h2><h3 id="improper-authorization">Improper Authorization </h3><p>The Tenda AC1200 V-W15Ev2 router is affected by improper authorization/improper session management. The software does not perform or incorrectly perform an authorization check when a user attempts to access a resource or perform an action. This allows the router's login page to be bypassed. The improper validation of user sessions/authorization can lead to unauthenticated attackers having the ability to read the router's <code>syslog.log</code> file, which contains the MD5 password of the Administrator's user account. This vulnerability exists within the local web and hosted remote management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-40843
Access Vector: Remote/Local
Security Risk: Critical 
Vulnerability: CWE-287 / CWE-285 / CWE-228 
CVSS Base Score: 9.9
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:L</code></pre><p>This vulnerability is present locally out-of-the-box without any user/administrator configuration and remotely once an administrator user has enabled the "Remote Web Management" configuration as seen below. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-36.png" class="kg-image" alt="" loading="lazy" width="1454" height="1676" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-36.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-36.png 1000w, https://boschko.ca/content/images/2022/09/image-36.png 1454w" sizes="(min-width: 720px) 720px"></figure><p>Enabling this setting would allow the router's owner to manage the device from anywhere in the world via the provided public URL. Enabling this configuration creates a <a href="https://github.com/inconshreveable/ngrok?ref=boschko.ca">ngrok</a> tunnel to a predefined <code>could.tendacn.net</code> subdomain. </p><pre><code>ngrokc -Ser host:cloud.tendacn.net,port:4443  -AddTun type:http,lhost:192.168.0.1,lport:80,subdomain:6nyz4sf4  -Inf vlan2</code></pre><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-62.png" class="kg-image" alt="" loading="lazy" width="694" height="156" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-62.png 600w, https://boschko.ca/content/images/2022/09/image-62.png 694w"></figure><p>Once enable the router can be accessed through the public web as seen below. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-1.png" class="kg-image" alt="" loading="lazy" width="923" height="585" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-1.png 600w, https://boschko.ca/content/images/2022/09/image-1.png 923w" sizes="(min-width: 720px) 720px"></figure><p>If you're wondering how many of these devices are configured like this, the answer is, thankfully not many. With some inefficient Google dorking <code>"*.cloud.tendacn.net:8080"</code> I was able to find <code>~18</code> devices configured with the cloud gateway. There is no way of ethically knowing what these devices are.  </p><blockquote>
<p><em>DISCLAIMER</em></p>
<p>If you go hunting for these hosts with any malice and start testing what you see below, I'd consider your activities as active intrusion. Leveraging vulnerabilities against hosts you do not own is NOT something I endorse &amp; is unethical.<br>
Subsequently, all traffic that passed through 6nyz4sf4.cloud.tendacn.net did not target anything other than my own device. I was not directly attacking or affecting the availability &amp; integrity of the public/reserved gateway.<br>
*.cloud.tendacn.net is only a public-facing tunnel to the router I own. Traffic passing through this public-facing proxy is simply passed as regular traffic/requests. Additionally, I never attempted or performed any reconnaissance or automated tests against cloud.tendacn.net.</p>
</blockquote>
<p>The vulnerability in &amp; of itself stems from a complete lack of proper session token generation &amp; the presence of authentication levels that should be expected from a cookie. The following images will help demonstrate this.</p><p>After logging into the device, the user is provided with the following cookies.</p><pre><code>Cookie: bLanguage=cn; _:USERNAME:_=admin; W15Ev2_user=admin</code></pre><p>However, both the <code>bLanguage=cn;</code> and the <code>_:USERNAME<em>:</em>=admin;</code> cookies are not required. Additionally <code>W15Ev2_user=</code> can simply be left blank.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-26.png" class="kg-image" alt="" loading="lazy" width="1726" height="1658" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-26.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-26.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-26.png 1600w, https://boschko.ca/content/images/2022/09/image-26.png 1726w" sizes="(min-width: 720px) 720px"></figure><p>As seen below you do need the <code>W15Ev2_user=</code> cookie or else you'll be redirected to the login as seen below, which is quite interesting.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-35.png" class="kg-image" alt="" loading="lazy" width="2000" height="766" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-35.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-35.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-35.png 1600w, https://boschko.ca/content/images/2022/09/image-35.png 2312w" sizes="(min-width: 720px) 720px"></figure><p>This obviously isn't good. As seen in 2 images above, I was able to fetch the <code>/syslog.log</code> which should only be viewed/accessible once authenticated.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-33.png" class="kg-image" alt="" loading="lazy" width="1608" height="1686" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-33.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-33.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-33.png 1600w, https://boschko.ca/content/images/2022/09/image-33.png 1608w" sizes="(min-width: 720px) 720px"></figure><p>This endpoint can leak the admin login event containing the base64 password of the administrator user. This can easily be leveraged to gain access to the device. As seen below we have the ability to perform this both locally or remotely via our assigned Remote Web Management endpoint. To demo, we'll perform a GET request on <code>/goform/downloadSyslog/syslog.log</code> with the cookie set to <code>W15Ev2_user=</code>.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-27.png" class="kg-image" alt="" loading="lazy" width="1848" height="888" srcset="https://boschko.ca/content/images/size/w600/2022/10/image-27.png 600w, https://boschko.ca/content/images/size/w1000/2022/10/image-27.png 1000w, https://boschko.ca/content/images/size/w1600/2022/10/image-27.png 1600w, https://boschko.ca/content/images/2022/10/image-27.png 1848w" sizes="(min-width: 720px) 720px"></figure><p>Scrolling down (this is a big response) we'll see any failed/successful login attempts. Successful attempts will contain the base64 encoded admin password. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-34.png" class="kg-image" alt="" loading="lazy" width="2000" height="459" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-34.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-34.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-34.png 1600w, https://boschko.ca/content/images/size/w2400/2022/09/image-34.png 2400w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-30.png" class="kg-image" alt="" loading="lazy" width="666" height="182" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-30.png 600w, https://boschko.ca/content/images/2022/09/image-30.png 666w"></figure><p>The curl of exactly the same request is seen below. Some people don't seem to always trust Burp Suite/might think my target is pointed at my localhost. (Not that it would invalidate the vulnerability) </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-31.png" class="kg-image" alt="" loading="lazy" width="1978" height="850" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-31.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-31.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-31.png 1600w, https://boschko.ca/content/images/2022/09/image-31.png 1978w" sizes="(min-width: 720px) 720px"></figure><p>If you take the time to decompile the <code>httpd</code> binary the culprit is the <code>authSecurityHandler</code> function that I won't be going into here &amp; will leave as an exercise to the reader.</p><p>You might be thinking <em>"yeah, but who cares"</em>?<em> </em>With access to the router, you're able to perform internal network scans, obtain the wifi's PSK, set up your own port forwarding, etc,. Other attacks can be chained with this "improper session management" to perform command injections and obtain a shell on the device. Although unlikely, it would suck to see a small-medium-sized company use one of these devices as a random &amp; cheap AP/Switch for a small cluster of employees, thinking it was inherently safe.</p><hr><h3 id="password-exposure">Password Exposure </h3><p>The Tenda AC1200 V-W15Ev2 router is affected by a password exposure vulnerability. When combined with the improper authorization/improper session management vulnerability, an attacker with access to the router may be able to expose sensitive information which they're not explicitly authorized to have. This is performed via a direct request to <code>/cgi-bin/DownloadCfg/RouterCfm.cfg</code> without authorization. This vulnerability exists within the local web interface and the hosted remote web management console. An attacker would be able to retrieve a subset of passwords via this technique. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-1">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-40845
Access Vector: Remote/Local
Security Risk: High 
Vulnerability: CWE-200
CVSS Base Score: 8.8
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
</code></pre><p>Like the previous vulnerability, this can be performed both locally or remotely through the <code>cloud.tendacn.net</code> proxy tunnel. Generally, downloading backups could only be performed once authenticated. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-107.png" class="kg-image" alt="" loading="lazy" width="1009" height="481" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-107.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-107.png 1000w, https://boschko.ca/content/images/2022/09/image-107.png 1009w" sizes="(min-width: 720px) 720px"></figure><p>However, there isn't a need to have the device initiated to perform this. At its core, a backup file containing hashes of users’ passwords, PSK's, etc. can easily be downloaded. This is generally considered bad hygiene/practice. Realistically, the impact on organizations depends on many factors that are unique to each organization. You can decide this for yourself when presented with the information a little further down. </p><p>I was a little confused at first, I didn't think this router had a CGI interface. Taking a step back, I dug up this endpoint when scouring through the firmware dump. It's a weird subset that is mainly defined to make executables on the server respond to web requests.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-102.png" class="kg-image" alt="" loading="lazy" width="1152" height="359" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-102.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-102.png 1000w, https://boschko.ca/content/images/2022/09/image-102.png 1152w" sizes="(min-width: 720px) 720px"></figure><p>For all three requests seen in the images below this is more-or-less the action's performed in the backend. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-70.png" class="kg-image" alt="" loading="lazy" width="554" height="70"></figure><p>Here is the attack being performed locally with Burp Suite. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-68.png" class="kg-image" alt="" loading="lazy" width="941" height="556" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-68.png 600w, https://boschko.ca/content/images/2022/09/image-68.png 941w" sizes="(min-width: 720px) 720px"></figure><p>Remotely with Burp Suite. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-67.png" class="kg-image" alt="" loading="lazy" width="981" height="569" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-67.png 600w, https://boschko.ca/content/images/2022/09/image-67.png 981w" sizes="(min-width: 720px) 720px"></figure><p>Remotely with the curl command. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-69.png" class="kg-image" alt="" loading="lazy" width="711" height="566" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-69.png 600w, https://boschko.ca/content/images/2022/09/image-69.png 711w"></figure><p>The crucial information obtained is listed below. </p><pre><code>sys.rzadmin.username= rzadmin
sys.rzadmin.password= cnphZG1pbg==  (rzadmin)
sys.rzadmin.password.decoded= r***n
wlan0.0_bss_wpapsk_key= this_is_my_super_secret_ssid_password
sys.admin.username= admin
sys.admin.password.decoded= t***d
sys.admin.password= = base64 PSK 
usb.share.gst0.user= guest
usb.share.gst0.pwd= guest
sys.guest.password.decoded= g***t
sys.guest.password= Z3Vlc3Q=  (guest)</code></pre><hr><h3 id="improper-access-control">Improper Access Control</h3><p>The Tenda AC1200 V-W15Ev2 router is affected by improper access control. An attacker can start telnet without authorization by performing a <code>GET</code> request to the <code>/goform/telnet</code> endpoint, spawning the <code>telnetd</code> service on the device. This service is password protected; however, the default account credentials were identified as <code>root:Fireitup</code> which can be used to successfully login. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-2">Vulnerability Details</h3><pre><code>CVE ID: N/A (Already assigned to CVE-2018-5770)
Access Vector: Remote/Local
Security Risk: High 
Vulnerability: CWE-287 / CWE-284 
CVSS Base Score: 8.4
CVSS Vector: CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H</code></pre><p>There's not much to explain here. As seen below the device doesn't ship with telnet natively being spawned nor is it defined in <code>init.d</code>. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/Not-shown--65532-closed-top-ports--conn-refused-.png" class="kg-image" alt="" loading="lazy" width="762" height="170" srcset="https://boschko.ca/content/images/size/w600/2022/09/Not-shown--65532-closed-top-ports--conn-refused-.png 600w, https://boschko.ca/content/images/2022/09/Not-shown--65532-closed-top-ports--conn-refused-.png 762w" sizes="(min-width: 720px) 720px"></figure><p>A simple <code>POST</code> request to <code>/goform/telnet</code> will start telnet as seen in the requests below. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-47.png" class="kg-image" alt="" loading="lazy" width="2000" height="597" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-47.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-47.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-47.png 1600w, https://boschko.ca/content/images/2022/09/image-47.png 2044w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/STATE-SERVICE.png" class="kg-image" alt="" loading="lazy" width="494" height="214"></figure><p>Interestingly, this can be performed through the ngrok tunnel. However, I've deemed that this endpoint is out of scope as I'm not 100% confident this relays back to my device due to the unfamiliar motd. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-18.png" class="kg-image" alt="" loading="lazy" width="1560" height="620" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-18.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-18.png 1000w, https://boschko.ca/content/images/2022/09/image-18.png 1560w" sizes="(min-width: 720px) 720px"></figure><p>As seen below telnet is now up and accessible. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-22.png" class="kg-image" alt="" loading="lazy" width="2000" height="395" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-22.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-22.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-22.png 1600w, https://boschko.ca/content/images/2022/09/image-22.png 2118w" sizes="(min-width: 720px) 720px"></figure><p>I did some digging to identify the telnet password. The earliest mention I could find dates back to 2017 from <a href="https://www.linksysinfo.org/index.php?threads%2Ftenda-ac15-ac1900-tomato-firmware-support.71709%2Fpage-7=&ref=boschko.ca">this</a> forum by user Chaos99. This was for the AC15 and we've got an AC1200. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-59.png" class="kg-image" alt="" loading="lazy" width="1532" height="398" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-59.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-59.png 1000w, https://boschko.ca/content/images/2022/09/image-59.png 1532w" sizes="(min-width: 720px) 720px"></figure><p>This doesn't seem to matter. As seen below, Chaos99 was right; the password is still <code>Fireitup</code>. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-43.png" class="kg-image" alt="" loading="lazy" width="1226" height="384" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-43.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-43.png 1000w, https://boschko.ca/content/images/2022/09/image-43.png 1226w" sizes="(min-width: 720px) 720px"></figure><p>I did some digging to identify anything else that can be invoked via <code>/goform/*</code> but there doesn't appear to be anything of value.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-113.png" class="kg-image" alt="" loading="lazy" width="554" height="438"></figure><hr><h3 id="os-command-injection-1"><strong>OS Command Injection #1</strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by an OS Command Injection vulnerability that allows an authenticated attacker to run arbitrary commands on the affected system as the application user. This vulnerability exists within the ping function <code>formSetFixTools</code>. This is the result of improper input validation passed through the <code>hostName</code> parameter. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-3">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-40847
Access Vector: Remote/Local
Security Risk: High
Vulnerability: CWE-78
CVSS Base Score: 7.8
CVSS Vector: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></pre><p>This command injection vulnerability was discovered through the serial logging. These logs were viewable by simply connecting to the router's UART interface. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-108.png" class="kg-image" alt="" loading="lazy" width="1061" height="816" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-108.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-108.png 1000w, https://boschko.ca/content/images/2022/09/image-108.png 1061w" sizes="(min-width: 720px) 720px"></figure><p>If you're wondering why the serial interface is sending out all of our logs and actions, I'm not 100% sure. I'm assuming it's so that application-specific errors can be sent to the log using some API methods. Without this serial logging, I'm not sure I would've discovered this command injection vulnerability. </p><p>I somewhat got lucky and have a methodology that leads to these discoveries. I initially fizzed the <code>hostName</code> parameter with Burp Suite intruder using a mix of custom and common command injections mainly found in this <a href="https://github.com/omurugur/OS_Command_Payload_List/blob/master/OS-Command-Fuzzing.txt?ref=boschko.ca">GitHub</a> repository. It just so happened that I was paying attention to my serial connection terminal at the right time. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-124.png" class="kg-image" alt="" loading="lazy" width="806" height="268" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-124.png 600w, https://boschko.ca/content/images/2022/09/image-124.png 806w" sizes="(min-width: 720px) 720px"></figure><p>As seen below, the <code>hostName</code> parameter of the <code>setFixTools</code> is responsible for performing ping diagnostics and is vulnerable to OS command injection. The following payload was injected into the vulnerable <code>hostName</code> parameter <code>$(`cat /etc/passwd`)</code>. Once the request was sent, the contents of the <code>/etc/passwd</code> file was returned via the serial console.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-91.png" class="kg-image" alt="" loading="lazy" width="1092" height="450" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-91.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-91.png 1000w, https://boschko.ca/content/images/2022/09/image-91.png 1092w" sizes="(min-width: 720px) 720px"></figure><p>Digging deeper was quite amusing. The <code>$PATH</code> variable was blank but ~10% of native UNIX commands still appeared to be working.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-73.png" class="kg-image" alt="" loading="lazy" width="1027" height="488" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-73.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-73.png 1000w, https://boschko.ca/content/images/2022/09/image-73.png 1027w" sizes="(min-width: 720px) 720px"></figure><p>I sent the two following <code>POST</code> requests to fix this issue.</p><pre><code>$(`PATH=/sbin:/bin:/usr/sbin:/usr/bin/`)
$(`export PATH`)</code></pre><p>As seen below we now have proper path variables.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-71.png" class="kg-image" alt="" loading="lazy" width="1013" height="447" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-71.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-71.png 1000w, https://boschko.ca/content/images/2022/09/image-71.png 1013w" sizes="(min-width: 720px) 720px"></figure><p>How will we get a shell? If we look at all the commands at our disposal, we don't have <code>nc</code>, <code>netcat</code> and <code>wget</code> is in fact a broken binary in the system. Additionally, this is not a standard shell <code>enable</code> and <code>compgen -b</code> which always exist aren't there (if you know, you know).</p><p>We have <code>/bin/busybox</code> and by listing its capabilities, we discover that we have <code>telnetd</code>! </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-74.png" class="kg-image" alt="" loading="lazy" width="657" height="99" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-74.png 600w, https://boschko.ca/content/images/2022/09/image-74.png 657w"></figure><p>We can leverage our command injection to start <code>telnetd</code> with the <code>-l</code> flag pointing at <code>/bin/sh</code> to obtain a root shell without needing the telnet username and password.</p><p>Our attack path consists of the following 5 steps:</p><pre><code>Step #1 - identify telnet pid - we can't use `|` or `&amp;&amp;` or `;`
Payload 1: 'ps &gt;/tmp/a'   

Step #2 - move it to webroot so we can get it
Payload 2: 'cp /tmp/a /var/webroot'	

Step #3 - kill telnetd if its alive
Payload 3: 'kill -9 PID'      

Step #4 - copy sh executable in pwd 
Payload 4: 'cp /bin/sh .'    

Step #5 - restart telnetd binded on sh
Payload 5: 'telnetd -l sh'   </code></pre><p>First, we'll pipe the contents of the systems processes into a file in <code>/tmp</code>. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-83.png" class="kg-image" alt="" loading="lazy" width="823" height="460" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-83.png 600w, https://boschko.ca/content/images/2022/09/image-83.png 823w" sizes="(min-width: 720px) 720px"></figure><p>We'll then move our process listing into the webroot so we grab and analyze its contents.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-82.png" class="kg-image" alt="" loading="lazy" width="925" height="454" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-82.png 600w, https://boschko.ca/content/images/2022/09/image-82.png 925w" sizes="(min-width: 720px) 720px"></figure><p>Go to <code>192.168.0.1/a</code> to retrieve the file.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-79.png" class="kg-image" alt="" loading="lazy" width="492" height="92"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-81.png" class="kg-image" alt="" loading="lazy" width="375" height="40"></figure><p>Telnet is currently running with a PID of 3718. However, this telnet is no good because we need to know the credentials for it. So we'll kill this process.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-85.png" class="kg-image" alt="" loading="lazy" width="1057" height="455" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-85.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-85.png 1000w, https://boschko.ca/content/images/2022/09/image-85.png 1057w" sizes="(min-width: 720px) 720px"></figure><p>We'll then move the <code>sh</code> binary to our current working directory.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-86.png" class="kg-image" alt="" loading="lazy" width="850" height="448" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-86.png 600w, https://boschko.ca/content/images/2022/09/image-86.png 850w" sizes="(min-width: 720px) 720px"></figure><p>Lastly, we'll invoke <code>telnetd</code> with the <code>-l</code> flag set to execute <code>/bin/sh</code> at the login/connection attempt. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-89.png" class="kg-image" alt="" loading="lazy" width="1016" height="624" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-89.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-89.png 1000w, https://boschko.ca/content/images/2022/09/image-89.png 1016w" sizes="(min-width: 720px) 720px"></figure><p>Now we should just be able to telnet without requiring a password. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-90.png" class="kg-image" alt="" loading="lazy" width="508" height="175"></figure><p>Tada. </p><hr><h3 id="os-command-injection-2"><strong>OS Command Injection #2</strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by an OS Command Injection vulnerability that allows authenticated attackers to run arbitrary commands on the affected system as the application's user. This vulnerability exists within the IPsec router configuration, specifically via the <code>/goform/module</code> function <code>setIPsecTunnelList</code>. This vulnerability in part requires the router's VPN server to be enabled (which it is by default but can be disabled). At its core, the <code>httpd</code> binary contains the vulnerability and can occur when a malicious <code>formSetIpSecTunnel</code> parameter gets processed. During this process, inner process communication is established through the <code>netctrl</code> binary. This vulnerability is the result of improper input validation passed through the <code>IPsecLocalNet</code> or <code>IPsecRemoteNet</code> parameter. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-4">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-41396
Access Vector: Remote/Local
Security Risk: High
Vulnerability: CWE-78
CVSS Base Score: 7.8
CVSS Vector: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></pre><p>In the <code>formSetIpSecTunnel</code> function, both the <code>IPsecLocalNet</code> and <code>IPsecRemoteNet</code> parameters are passed directly to the application, which can be manipulated by the user. The <em>Local</em> (<code>IPsecLocalNet</code>) and <em>Remote</em>  (<code>IPsecRemoteNet</code>) network parameters can be maliciously injected into.</p><p>To understand what's going on, we need to reverse the application a little. This vulnerability occurs in the <code>setIpSecTunnel</code> function. Below, we enter the function <code>getIpSecTunnelSettings</code> and the rabbit hole begins.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-120.png" class="kg-image" alt="" loading="lazy" width="387" height="226"></figure><p>The parameters that receive our JSON user input are in the function <code>getIpSecTunnelSettings</code>.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-121.png" class="kg-image" alt="" loading="lazy" width="618" height="435" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-121.png 600w, https://boschko.ca/content/images/2022/09/image-121.png 618w"></figure><p>In the <code>setIpSecTunnelSettings</code> function, the input has not been checked. And then a call to the function <code>prod_cfm_set_init_val</code> is made to store this input.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-122.png" class="kg-image" alt="" loading="lazy" width="548" height="435"></figure><p>These are the function parameters passed through the <code>POST</code> command. But what's actually happening in <code>setIpSecTunnelSetting</code>? It isn't immediately apparent, but at the end of this decompilation there's a pretty significant block of code related to, and required for inter-process communication. This all happens in another binary that handles the passed input, leveraging the contents through other functions that write this new data and changes to the flash. Therefore, to see how we can inject, we need to look at that binary. After a little digging, it was discovered that the vulnerability would be triggered in <code>netctrl</code>.</p><p>If we want our <code>IPsecLocalNet</code> or <code>IPsecRemoteNet</code> input to be extracted, we have to have one of the following protocols initiated. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-150.png" class="kg-image" alt="" loading="lazy" width="438" height="432"></figure><p>I've had success with triggering this command injection by setting the <code>vpnServerType</code> to <code>l2tp</code>. However, this VPN stuff is all initiated by default and should just work out of the box with PPTP.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-128-1.png" class="kg-image" alt="" loading="lazy" width="938" height="459" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-128-1.png 600w, https://boschko.ca/content/images/2022/09/image-128-1.png 938w" sizes="(min-width: 720px) 720px"></figure><p>When you successfully write to the flash and <code>racoonmtc</code> gets initiated with the valid injection contents, then you know you've performed this successfully. Over the serial log, this looks like the following.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-134.png" class="kg-image" alt="" loading="lazy" width="651" height="245" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-134.png 600w, https://boschko.ca/content/images/2022/09/image-134.png 651w"></figure><p>Inside the <code>netctrl</code> binary, looking at the <code>vpn_ipsec_ini</code> function, the initial input will be extracted and injected into <code>%s</code>, which is how we will achieve our code execution. We can further use command separators to escape the <code>iptabes</code> command. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-135.png" class="kg-image" alt="" loading="lazy" width="731" height="539" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-135.png 600w, https://boschko.ca/content/images/2022/09/image-135.png 731w" sizes="(min-width: 720px) 720px"></figure><p>Let's visualize this by moving to a GUI. The front-end vulnerable input is tagged as "Remote Internet" and "Local Internet" which maps to <code>IPsecLocalNet</code> and <code>IPsecRemoteNet</code> respectively.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-117.png" class="kg-image" alt="" loading="lazy" width="1001" height="857" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-117.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-117.png 1000w, https://boschko.ca/content/images/2022/09/image-117.png 1001w" sizes="(min-width: 720px) 720px"></figure><p>To test that we have command injection let's enter a random string and see <code>/bin/sh</code> attempt to execute it.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-119.png" class="kg-image" alt="" loading="lazy" width="968" height="548" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-119.png 600w, https://boschko.ca/content/images/2022/09/image-119.png 968w" sizes="(min-width: 720px) 720px"></figure><p>As we can from the serial log, "badcommand" is not a valid binary.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-118.png" class="kg-image" alt="" loading="lazy" width="955" height="763" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-118.png 600w, https://boschko.ca/content/images/2022/09/image-118.png 955w" sizes="(min-width: 720px) 720px"></figure><p>If you mess up you'll have varying verbose output. Here are a few examples you can use to better craft a more sophisticated payload. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-129.png" class="kg-image" alt="" loading="lazy" width="424" height="31"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-130.png" class="kg-image" alt="" loading="lazy" width="213" height="22"></figure><p>Let's try starting telnet using this command injection.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-115.png" class="kg-image" alt="" loading="lazy" width="1003" height="550" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-115.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-115.png 1000w, https://boschko.ca/content/images/2022/09/image-115.png 1003w" sizes="(min-width: 720px) 720px"></figure><p>Viewing the serial log for this request shouldn't contain <code>/bin/sh</code> errors. As seen above and below, <code>telnetd</code> has been successfully started.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-116.png" class="kg-image" alt="" loading="lazy" width="985" height="731" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-116.png 600w, https://boschko.ca/content/images/2022/09/image-116.png 985w" sizes="(min-width: 720px) 720px"></figure><p>Tada. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-126.png" class="kg-image" alt="" loading="lazy" width="477" height="132"></figure><hr><h3 id="os-command-injection-3"><strong>OS Command Injection #3</strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by an OS Command Injection vulnerability that allows authenticated attackers to run arbitrary commands on the affected system as the application's user. This vulnerability exists within the DMZ router configuration, specifically via the <code>/goform/module</code> function <code>setDMZ</code>. The vulnerability was identified in the <code>netctrl</code> binary tracing preprocessing calls from the <code>httpd</code> binary. This vulnerability is the result of improper input validation passed through the <code>dmzHost</code> parameter. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-5">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-41395
Access Vector: Remote/Adjacent
Security Risk: High
Vulnerability: CWE-78
CVSS Base Score: 7.8
CVSS Vector: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></pre><p>Continuing the investigation into <code>netctrl</code>, the culprit for the injection above, I ended up finding more injections.</p><p>In the <code>formSetDMZ</code> function, <code>dmzHost</code> can be directly passed by the attacker. If we can control the <code>dmzHost</code> input, presumably we can attack the system. Looking into the <code>httpd</code> binary seen below, the JSON-provided input doesn't get checked or sanitized. After that, it calls the function <code>prod_cfm_set_value</code> to store this input. So the parameter <code>dmzIp</code> is what we're looking to inject into it.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-144.png" class="kg-image" alt="" loading="lazy" width="1086" height="808" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-144.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-144.png 1000w, https://boschko.ca/content/images/2022/09/image-144.png 1086w" sizes="(min-width: 720px) 720px"></figure><p>The <code>netctrl</code> binary <code>advance_set_dmz_cfg</code> function's input will grab the provided input passed to it by <code>httpd</code>.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-147.png" class="kg-image" alt="" loading="lazy" width="1460" height="898" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-147.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-147.png 1000w, https://boschko.ca/content/images/2022/09/image-147.png 1460w" sizes="(min-width: 720px) 720px"></figure><p>Eventually, in the <code>advance_set_dmz_cfg</code> function, this unchecked input could be leveraged to perform command injection when passed through <code>%s</code>. Looking at this in Burp Suite, we'll modify our injectable <code>dmzHost</code> parameter. We're testing with fake binary to see what gets acted on it/the errors we receive. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-138.png" class="kg-image" alt="" loading="lazy" width="940" height="511" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-138.png 600w, https://boschko.ca/content/images/2022/09/image-138.png 940w" sizes="(min-width: 720px) 720px"></figure><p>The <code>POST</code> request above will ultimately write these new configs to flash. Below you'll also see <code>/bin/sh</code> try and run the <code>boschko_is_hacking</code> binary, and fail because doesn't exist. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-140.png" class="kg-image" alt="" loading="lazy" width="951" height="267" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-140.png 600w, https://boschko.ca/content/images/2022/09/image-140.png 951w" sizes="(min-width: 720px) 720px"></figure><p>This is great information, we more or less know we should be able to spawn <code>telnetd</code>. As seen below telnet wasn't running a few seconds prior and then was. Disregard the date I'm too lazy to go change it.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-139.png" class="kg-image" alt="" loading="lazy" width="1169" height="684" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-139.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-139.png 1000w, https://boschko.ca/content/images/2022/09/image-139.png 1169w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-141.png" class="kg-image" alt="" loading="lazy" width="1031" height="448" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-141.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-141.png 1000w, https://boschko.ca/content/images/2022/09/image-141.png 1031w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="os-command-injection-4"><strong>OS Command Injection #4</strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by an OS Command Injection vulnerability that allows authenticated attackers to run arbitrary commands on the affected system as the application's user. This vulnerability exists within the Port Mapping router configuration, specifically via the <code>/goform/module</code> function <code>setPortMapping</code>. The vulnerability was identified in the <code>netctrl</code> binary tracing preprocessing calls from the <code>httpd</code> binary. This vulnerability is the result of improper input validation passed through the <code>portMappingServer</code> parameter. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-6">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-42053
Access Vector: Remote/Local
Security Risk: High
Vulnerability: CWE-78
CVSS Base Score: 7.8
CVSS Vector: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></pre><p>At this point, you get the idea. I just kept looking at the <code>netctrl</code> binary and stumbled onto the <code>advance_set_port_map_cfg</code> function which looks a lot like our previous command injections.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-162.png" class="kg-image" alt="" loading="lazy" width="1046" height="604" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-162.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-162.png 1000w, https://boschko.ca/content/images/2022/09/image-162.png 1046w" sizes="(min-width: 720px) 720px"></figure><p>The port mapping front-end looks like this, it's nothing crazy, so let's have a look at this request in Burp Suite.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-157.png" class="kg-image" alt="" loading="lazy" width="1240" height="635" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-157.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-157.png 1000w, https://boschko.ca/content/images/2022/09/image-157.png 1240w" sizes="(min-width: 720px) 720px"></figure><p>We're going to skip reversing the preprocessing from <code>httpd</code> to figure out which parameters are getting passed. We can use our better judgment to make an educated guess that the <code>portMappingServer</code> might be injectable. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-155.png" class="kg-image" alt="" loading="lazy" width="933" height="653" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-155.png 600w, https://boschko.ca/content/images/2022/09/image-155.png 933w" sizes="(min-width: 720px) 720px"></figure><p>In the image above we're starting the <code>telnetd</code>, which was previously not running seconds before. Looking at the serial log, we're presented with familiar error messages. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-156.png" class="kg-image" alt="" loading="lazy" width="1163" height="302" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-156.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-156.png 1000w, https://boschko.ca/content/images/2022/09/image-156.png 1163w" sizes="(min-width: 720px) 720px"></figure><p>Fun little fact. If we didn't own the hardware and were emulating <code>httpd</code> off of qemu it would be tedious work to find the proper web request and would require properly reversing the <code>httpd</code> binary. However, I actually found <a href="https://www.zybuluo.com/moshangxc/note/825998?ref=boschko.ca">this</a> enterprise documentation which perhaps unintentionally leaks the router functions? </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-159.png" class="kg-image" alt="" loading="lazy" width="991" height="816" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-159.png 600w, https://boschko.ca/content/images/2022/09/image-159.png 991w" sizes="(min-width: 720px) 720px"></figure><p>Regardless, this is nice to have.</p><hr><h3 id="stack-buffer-overflow-1"><strong>Stack  Buffer Overflow #1 </strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by a stack-based buffer overflow vulnerability that allows an unauthenticated attacker to run arbitrary commands on the affected system or cause a denial of service. This vulnerability exists within the "Remote WEB Management" router application, specifically via the <code>/goform/module</code> function <code>setRemoteWebManage</code>. The vulnerability was identified in the <code>netctrl</code> binary tracing preprocessing calls from the <code>httpd</code> binary via the vulnerable <code>remoteIP</code> parameter. This vulnerability is the result of mismanaged memory allocation. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-7">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-42058
Access Vector: Remote/Local
Security Risk: Medium
Vulnerability: CWE-121
CVSS Base Score: 5.3
CVSS Vector: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H</code></pre><p>The entire remote web management gateway piqued my interest early on. I decided to dig into it thinking that I might find a command injection vulnerability.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-172.png" class="kg-image" alt="" loading="lazy" width="821" height="506" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-172.png 600w, https://boschko.ca/content/images/2022/09/image-172.png 821w" sizes="(min-width: 720px) 720px"></figure><p>Going back to the <code>httpd</code> binary, running through <code>main_init</code> we discover  <code>FUN_0043c7b4</code>, a function containing which contains the <code>formSetRemoteWebManage</code> which sounds like it might relate to "Remote Web Management", our target.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-173.png" class="kg-image" alt="" loading="lazy" width="576" height="397"></figure><p>As seen below, in the <code>formSetSafeWanWebMan</code> function there exists the <code>remoteIp</code> parameter which is passing whatever is supplied. At first, I thought that this was a good start, if we can control the <code>remoteIp</code> value there's a potential to obtain command injection.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-175.png" class="kg-image" alt="" loading="lazy" width="626" height="522" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-175.png 600w, https://boschko.ca/content/images/2022/09/image-175.png 626w"></figure><p>As you can see above, the input isn't getting checked. After which a call to the function <code>SetValue</code> stores the input into <code>wans.wanwebip</code>. Let's figure out how this is all handled in the <code>netctrl</code> binary.</p><p>After a bit of digging, I discovered that the <code>advance_get_wan_access_cfg</code> function is where the input will be extracted.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-176.png" class="kg-image" alt="" loading="lazy" width="711" height="677" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-176.png 600w, https://boschko.ca/content/images/2022/09/image-176.png 711w"></figure><p>After this, the <code>advance_set_wan_access_cfg</code> will use the input to write the contents of the <code>POST</code> request to the flash. As you can see below the input from <code>remoteIp</code> should be passed into <code>%s</code> copying our command to the stack buffer.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-179.png" class="kg-image" alt="" loading="lazy" width="783" height="583" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-179.png 600w, https://boschko.ca/content/images/2022/09/image-179.png 783w" sizes="(min-width: 720px) 720px"></figure><p>So if we attempted to run <code>telnetd</code> we'd run the following <code>POST</code> request.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-182.png" class="kg-image" alt="" loading="lazy" width="963" height="486" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-182.png 600w, https://boschko.ca/content/images/2022/09/image-182.png 963w" sizes="(min-width: 720px) 720px"></figure><p>Looking at the serial logs, it doesn't quite work. After a lot of failed attempts, I came to the conclusion that there is no real way of escaping the <code>[ ]</code> brackets no matter what type of delimiters you use. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-29.png" class="kg-image" alt="" loading="lazy" width="540" height="262"></figure><p>At this point, I quickly glanced at the <code>advance_set_wan_access_cfg</code> function and noticed that the stack buffer was only <code>256 bytes</code>. If you go back up to the previous screenshot you'll notice that the function doesn't check the value of <code>iVar2</code> and simply calls it, which copies the POST parameter <code>remoteIp</code> to stack buffer <code>acStack520</code>.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-185.png" class="kg-image" alt="" loading="lazy" width="483" height="88"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-183.png" class="kg-image" alt="" loading="lazy" width="580" height="666"></figure><p>We should be able to crash this. I ended up overwriting the buffer with <code>~2000</code> characters the image below is <code>629</code> characters and intended to be more legible to the reader.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-181.png" class="kg-image" alt="" loading="lazy" width="926" height="670" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-181.png 600w, https://boschko.ca/content/images/2022/09/image-181.png 926w" sizes="(min-width: 720px) 720px"></figure><p>This causes a crash as seen below, the banner <code>****** WeLoveLinux ******</code> is displayed every time the device boots up, and crashed immediately after.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-178.png" class="kg-image" alt="" loading="lazy" width="708" height="818" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-178.png 600w, https://boschko.ca/content/images/2022/09/image-178.png 708w"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-184.png" class="kg-image" alt="" loading="lazy" width="849" height="492" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-184.png 600w, https://boschko.ca/content/images/2022/09/image-184.png 849w" sizes="(min-width: 720px) 720px"></figure><p>I've decided to remove my Golang and Python POCs. This is purely a DoS and my aim isn't to enable and commoditize DoS attacks.</p><p>The router crashes and cannot provide services correctly and persistently. The real question is how realistic obtaining a stable root shell through a carefully constructed payload would be. Let's find out. I'll be giving this a go from my QEMU + GDB debugging environment using the firmware I dumped from the SPI chip on the board.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-191.png" class="kg-image" alt="" loading="lazy" width="1180" height="866" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-191.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-191.png 1000w, https://boschko.ca/content/images/2022/09/image-191.png 1180w" sizes="(min-width: 720px) 720px"></figure><p>As you can see above, we have a little problem with <code>cfms_mib_proc_handle</code>. When running the program directly, it will output WeLoveLinux, and then it will crash/not initiate. I'm guessing that it has entered a state of suspended animation. </p><p>I'll use IDA for this next part because if I have to patch it I don't know how to do it with Ghidra. After a bit of digging to find the position where the string is used and set a breakpoint, then stepping through until something weird happens. I'm speculating that the culprit is this function, which is connected to a service that should return 1 under normal circumstances.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-189.png" class="kg-image" alt="" loading="lazy" width="746" height="364" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-189.png 600w, https://boschko.ca/content/images/2022/09/image-189.png 746w" sizes="(min-width: 720px) 720px"></figure><p>When we use the environment simulated by QEMU, it will return 0 if it cannot connect to the relevant service. We need to patch manually. I did this in IDA using the <a href="https://github.com/keystone-engine/keypatch?ref=boschko.ca">keypatch</a> plugin to patch the return value to 1. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-190.png" class="kg-image" alt="" loading="lazy" width="1522" height="424" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-190.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-190.png 1000w, https://boschko.ca/content/images/2022/09/image-190.png 1522w" sizes="(min-width: 720px) 720px"></figure><p>However, even with this patch set, it's not working. I'm almost 100% sure it should. Regardless, although upsetting, I decided not to peruse this any further.</p><hr><h3 id="stack-buffer-overflow-2"><strong>Stack  Buffer Overflow #2</strong></h3><p>The Tenda AC1200 V-W15Ev2 router is affected by a stack-based buffer overflow vulnerability that allows an unauthenticated attacker to run arbitrary commands on the affected system or cause a denial of service. This vulnerability exists within the Internet Settings, Interface Types application. It's leveraged via the <code>/goform/module</code> function <code>setNetwork</code>. This vulnerability is the result of mismanaged memory allocation. The vulnerable parameters are <code>wanUser</code> and <code>wanPwd</code>. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-8">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-42060
Access Vector: Remote/Local
Security Risk: Medium
Vulnerability: CWE-121
CVSS Base Score: 5.3
CVSS Vector: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H</code></pre><p>I'd like to start by saying that this overflow was quite tricky to understand given that I'm doing this statically. It would be much easier to debug this dynamically in my QEMU + GDB lab. As seen in the previous overflow, I wasn't "properly" patching <code>ConnectCfm</code>, so I'm stuck with this suboptimal method. </p><p>This stack buffer overflow is part of the Broadband Dialup configuration, which is part of the WAN device configuration. Point-to-Point Protocol over Ethernet (PPPoE) is a type of broadband connection and therefore is referenced as such. Initially, I thought the overflow stemmed from the screenshot below. From the <code>setWanPppoe</code> function, where the application reads user input into <code>uVar1</code> and <code>uVar2</code> without doing any proper length checks.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-193.png" class="kg-image" alt="" loading="lazy" width="1284" height="1410" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-193.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-193.png 1000w, https://boschko.ca/content/images/2022/09/image-193.png 1284w" sizes="(min-width: 720px) 720px"></figure><p>This turned out not to be the root cause. looking at the above, a crash could happen when it takes the address of <code>local24</code> and stores our user-provided JSON string into it, overflowing the <code>local_20</code>, <code>local_1c</code>, <code>local_18</code>, etc. I presume that <code>iVar5-9</code> are all status code checks. However, if <code>prod_cfm_set_val</code> returns <code>0</code> on success, this check seems to be irrelevant. I later came. to the conclusion that this wasn't the case, and that something else was responsible for the behavior observed further down.</p><p>Going along with this initial presumption, all of this information is called upon when the configs are pushed to flash, which is performed as a result of the following <code>POST</code> request with the below UI as input. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-21.png" class="kg-image" alt="" loading="lazy" width="473" height="328"></figure><p>I decided to flood the <code>wanPwd</code> parameter <code>Broadband Password</code> with a bunch of <code>AAAA</code> characters. Which caused a crash.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-19.png" class="kg-image" alt="" loading="lazy" width="793" height="672" srcset="https://boschko.ca/content/images/size/w600/2022/10/image-19.png 600w, https://boschko.ca/content/images/2022/10/image-19.png 793w" sizes="(min-width: 720px) 720px"></figure><p>So, the device crashed and rebooted not long after. What could be happening here? There are at least two ways the overflow could occur. It could occur if the password ever gets decoded. It could also happen if the program reads the user input into a variable without proper length checks, and writes it into memory. </p><p>Again, without the ability to attach GDB to the <code>httpd</code> process, it's really hard to reverse. I'd also like to mention that there are confusing behaviors in the <code>add_pppoe_config</code> function that occurs as part of <code>formGetNetwork</code> that may have obstructed my understanding of the entire BOF chain. </p><p>My final verdict is as follows, and it will make more sense when watching the POC video. The overflow process is:</p><p><code>user input</code> =&gt; <code>setWanPppoe</code> =&gt; <code>getPPPoEConnectStatus</code> =&gt; <code>crash</code></p><p>A boiled-down explanation of what happens is:</p><ol><li>JSON user-provided inputs get passed into the WAN config <code>setWanPppoe</code> a function that reads user input into <code>uVar1</code> and <code>uVar2</code> without doing any proper length checks.</li><li>At some point <code>getPPPoEConnectStatus</code> accepts input from<strong> </strong>(presumably from <code>setWanPppoe</code> via <code>prod_cfm_set_val</code>) which reads the unchecked user input during which it calls <code>FUN_00447674</code>  (renamed <code>CredentialCompareFunction</code>) that stores the user-provided input with <code>sprintf</code> to the char buffer.</li><li>A check on the validity of the credentials is performed at which point the overflow happens.</li></ol><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-17.png" class="kg-image" alt="" loading="lazy" width="661" height="467" srcset="https://boschko.ca/content/images/size/w600/2022/10/image-17.png 600w, https://boschko.ca/content/images/2022/10/image-17.png 661w"></figure><p>It actually takes a dword parameter WanID (which is a value wanNum=3) and stores it into <code>acStack264</code> (renamed UserPasswordString) this WanID stems from another function, <code>FUN_00447828</code> which is also invoked by the main credential check of the <code>getPPPoEConnectStatus</code> control flow specific to dialup initiation/integrity checks from a generated <code>/etc/ppp/wan%d_ppoe_auth_code</code>file at startup.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-13.png" class="kg-image" alt="" loading="lazy" width="284" height="230"></figure><p>Here's a video POC where you can see this in action. This BOF acts as a DOS and completely debilitates the router once the function is processed ~10 seconds after boot/login.</p><figure class="kg-card kg-embed-card"><iframe width="200" height="113" src="https://www.youtube.com/embed/Xd-lzsM3Gmg?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" title="20220928234526956"></iframe></figure><p>I won't be including a Golang or Python POC. This is purely a DoS and my aim isn't to enable and commoditize DoS attacks. Just like in the video, as soon as the device is logged in, it crashes and reboots in a perpetual never-ending cycle. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-196.png" class="kg-image" alt="" loading="lazy" width="1346" height="1692" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-196.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-196.png 1000w, https://boschko.ca/content/images/2022/09/image-196.png 1346w" sizes="(min-width: 720px) 720px"></figure><p>What made reversing this so much harder was not having a way of knowing what library functions were actually being imported. As you can imagine, this makes reversing all the more confusing.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/10/image-18.png" class="kg-image" alt="" loading="lazy" width="1321" height="333" srcset="https://boschko.ca/content/images/size/w600/2022/10/image-18.png 600w, https://boschko.ca/content/images/size/w1000/2022/10/image-18.png 1000w, https://boschko.ca/content/images/2022/10/image-18.png 1321w" sizes="(min-width: 720px) 720px"></figure><p>The blog is getting ridiculously long, so I will stop digging for these. If you follow <code>prod_cfm_set_val</code> you're bound to find another ~10 buffer overflows. It's honestly a clown fiesta. </p><hr><h2 id="stored-cross-site-scripting"><strong>Stored Cross-Site Scripting</strong></h2><p>The Tenda AC1200 V-W15Ev2 router does not perform proper validation on user-supplied input and is vulnerable to cross-site scripting attacks via the homepage's connected application hostname field. If a proper authorization mechanism was implemented, this vulnerability could be leveraged to perform actions on behalf of another user or the administrator. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-9">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-40846
Access Vector: Network
Security Risk: Medium
Vulnerability: CWE-79
CVSS Base Score: 6.5
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N</code></pre><p>On the homepage, an administrator will have the ability to see the top 5 devices that consume the most network resources. They'll also have the ability to rename these hosts. I attempted the following payload, which failed. </p><pre><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></pre><p>However, if you look at the page's source, it would be reasonable to assume that you could trigger a valid XSS by prepending <code>"&gt;</code> to your payload. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-103.png" class="kg-image" alt="" loading="lazy" width="844" height="377" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-103.png 600w, https://boschko.ca/content/images/2022/09/image-103.png 844w" sizes="(min-width: 720px) 720px"></figure><p>Since I'm testing in Firefox ill be using <code>marquee</code> tags, my payload can be seen below.</p><pre><code>"&gt;&lt;marquee onstart=alert(document.cookie)&gt;
</code></pre><p>In the page source the <code>title</code> string is now "handled" properly and closed leaving our malicious javascript outside of the element. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-104.png" class="kg-image" alt="" loading="lazy" width="786" height="345" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-104.png 600w, https://boschko.ca/content/images/2022/09/image-104.png 786w" sizes="(min-width: 720px) 720px"></figure><p>Here's a little Burp Suite visual differentiating the two requests.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-106.png" class="kg-image" alt="" loading="lazy" width="848" height="1032" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-106.png 600w, https://boschko.ca/content/images/2022/09/image-106.png 848w" sizes="(min-width: 720px) 720px"></figure><p>The QOS's requests will trigger every ~15 seconds. This is to obtain more accurate statistics of the hosts such as upload/download rates. This will call upon the hostname perpetually prompting the XSS triggering. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-105.png" class="kg-image" alt="" loading="lazy" width="978" height="502" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-105.png 600w, https://boschko.ca/content/images/2022/09/image-105.png 978w" sizes="(min-width: 720px) 720px"></figure><p>As seen below the XSS successfully triggers returning of the session cookies. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-57.png" class="kg-image" alt="" loading="lazy" width="2000" height="1161" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-57.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-57.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-57.png 1600w, https://boschko.ca/content/images/size/w2400/2022/09/image-57.png 2400w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="stored-cross-site-scripting-1"><strong>Stored Cross-Site Scripting</strong></h2><p>The Tenda AC1200 V-W15Ev2 router does not perform proper validation on user-supplied input and is vulnerable to cross-site scripting attacks through the web filtering group body. If the proper authorization was implemented, this vulnerability could be leveraged to perform actions on behalf of another user or the administrator. This vulnerability exists within the local web interface and the hosted remote web management console. The vulnerability affects version V15.11.0.10(1576). </p><h3 id="vulnerability-details-10">Vulnerability Details</h3><pre><code>CVE ID: CVE-2022-40844
Access Vector: Network
Security Risk: Medium
Vulnerability: CWE-79
CVSS Base Score: 6.5
CVSS Vector: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N</code></pre><p>There's another stored XSS in the Website filtering functionality. Navigating to the panel of "Website Filtering" you'll see the following. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-53.png" class="kg-image" alt="" loading="lazy" width="2000" height="1513" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-53.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-53.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-53.png 1600w, https://boschko.ca/content/images/2022/09/image-53.png 2006w" sizes="(min-width: 720px) 720px"></figure><p>Clicking on the "URL management" panel will pop-up the following window. </p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-55.png" class="kg-image" alt="" loading="lazy" width="2000" height="1446" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-55.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-55.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-55.png 1600w, https://boschko.ca/content/images/2022/09/image-55.png 2116w" sizes="(min-width: 720px) 720px"></figure><p>Anything injected within the URL body will reflect once its associated group name is clicked in the panel before. Pretty much any javascript here will work. </p><p>When I test in Firefox I personally prefer using Firefox-specific payloads such as <code>&lt;marquee onstart=alert(1)&gt;</code> for testing.</p><p>Since I don't blog a lot, I'll share my favorite payload which leverages the movie/video content tags which are never really filtered. Some of my goto payloads can be seen below and all work within this application.</p><pre><code>&lt;video controls oncanplay="alert(document.cookie)"&gt;&lt;source src="http://mirrors.standaloneinstaller.com/video-sample/lion-sample.mp4"&gt;&lt;/video&gt;

&lt;img src="test" OnError=prompt(document.cookie)&gt;

&lt;img src=x onerror=&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x64;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#46;&amp;#x63;&amp;#x6f;&amp;#x6f;&amp;#x6b;&amp;#x69;&amp;#x65;&amp;#x29;&gt;</code></pre><p>Once the popup is saved, one way to trigger it is to single-click the element as seen below or set it to an IP group config.</p><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-51.png" class="kg-image" alt="" loading="lazy" width="940" height="522" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-51.png 600w, https://boschko.ca/content/images/2022/09/image-51.png 940w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://boschko.ca/content/images/2022/09/image-54.png" class="kg-image" alt="" loading="lazy" width="1968" height="1476" srcset="https://boschko.ca/content/images/size/w600/2022/09/image-54.png 600w, https://boschko.ca/content/images/size/w1000/2022/09/image-54.png 1000w, https://boschko.ca/content/images/size/w1600/2022/09/image-54.png 1600w, https://boschko.ca/content/images/2022/09/image-54.png 1968w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="when-will-it-be-enough">When Will it be Enough?</h2><p>If I had to make an educated guess, I'd say there are roughly another ~10-15 CVEs laying around in the application. I won't personally be perusing them. Why? </p><ol><li>I'd like to spend my time reversing something a little more entertaining.</li><li>Due to not having been able to establish a channel of communication with the vendor, I don't see the value in further research &amp; potential additional impact on end-users given the nature of my disclosure. </li></ol><p>If you want to land some easy CVEs give this application a look. There are roughly another 5 command injections at large (mainly in the hotel mode, the guest SSID initiation). There are also a lot of bad <code>memset</code> that I presume can lead to overflows and crashes. I'm not sure how realistic obtaining a stable root shell through a carefully constructed payload would be. As a freebie, I'm 99% sure there is a buffer overflow in <code>GetWanAddress</code> via the <code>wanDns1</code> and <code>wanDns2</code> parameters that copy the user-provided input to the stack using <code>sprintf</code> where <code>%s</code> can't limit copy length, so it's possible to make the stack overflow there as well.</p><hr><h2 id="thoughts-on-responsible-disclosure">Thoughts on Responsible Disclosure </h2><p>I genuinely try my hardest to adhere to clear and transparent ethical principles in responsible vulnerability disclosure (RVD). In every case, I place top priority on the safety and security of end-users. I've written a handful of blogs that will never see the light of day because of vendor negligence, which would cause serious real-life end-user impact. </p><p>My blog is not intended to be malicious and isn't set out to damage brands or their reputations. I genuinely make these to educate, inform, and attempt to make the internet a safer place. </p><p>As mentioned above, I try my best to act in a transparent, responsible, and consistent manner. In order to achieve this, I adhere to 90 days from the initial contact disclosure deadline. This can be shortened if the vendor remediates the vulnerability sooner, and lengthened if the vendor requires additional time to patch the vulnerability.</p><ul><li>I will make at minimum 5 attempts to establish confidential and detailed communication with the vendor. This includes but is not limited to the vendor's "contact us" email address, key employee LinkedIn, Twitter, company telephone, etc,. I also make an effort to provide the vendor with multiple channels of communication (WeChat, LinkedIn, Email, Telegram, WhatsApp, and Telephone) for their overall convenience.</li><li>Once in contact with the vendor’s security team or designated company contact, I provide the details of the vulnerabilities. During the first contact, I also discuss my intentions to work along sides them / and help them with remediation &amp; retesting until the vulnerability is patched. Lastly, I discuss my intentions for public disclosure. </li><li>Once everything has been agreed upon, a secure communications channel will be established. Over this channel, all details and materials needed to reproduce the vulnerability are provided. </li><li>I try my best to provide reasonable assistance to the vendor to ensure the understanding of the significance of the discovered vulnerability.</li><li>Once a patch has been released, I'll retest the patch out of good faith. </li></ul><hr><p>With regard to this blog, there were two decisions I could take. Either disclose or don't. "Who cares, just post it," you may be thinking. I do. And my ethical dilemma was as follows:</p><p><u>Option A</u>: I don't disclose. As a consequence, there isn't a chance for the vendor or affected customers to be made aware of the underlying bugs. Furthermore, an unethical individual may find the issue first and exploit it, potentially compromising dozens of utilities.</p><p><u>Option B:</u> I publicly disclose the vulnerability, exposing the flaws in the product, and this blog-generated visibility prompts the vendor to take action (hopefully). As a consequence, low-life humans try and leverage these vulnerabilities against (in this case) a very small potential list of affected customers. Additionally, this blog could also rush affected customers to take their vulnerable systems down.</p><p><u>Underlying issue</u>: The vendor has no control over the remote devices, other than publishing firmware updates and alerting customers the vendor can't do much. </p><p>As mentioned multiple times, the goal/aim of my research has always been to make the internet a safer place. In this case, after evaluating the vendor's behavior or lack thereof, achieving my goal would require the vendor to change their current workflow &amp; work towards establishing fluid channels of communication with researchers. This may require the publication of blogs such as these. Having weighed the pros and cons, I've decided to publicly disclose. Hopefully, this will help the vendor go through the change it needs to better handle researchers and disclosure.</p><hr><p>It should be <u>blatantly</u> obvious that any past, present, or future employer cannot be held responsible for any personal research and disclosure conducted by me under my own name.</p><p>I find it unfortunate that a small majority of people remain hyper-sensitive to vulnerabilities and public disclosure. Therefore, I feel the need to add this disclaimer. I know my heart is in the right place, and that blogs far more damning than this go up all the time, without the author being judged and shamed.</p><p><strong>															<u>DISCLAIMER</u></strong></p><p>Any misuse derived from the information contained within this blog will be the exclusive responsibility of the person who carries it out. The owner of the blog, all present, past, and future employers, ghost.io, and any of its associates will not be liable for any consequences or damages resulting from reckless and malicious use. The vendor is solely responsible for its security errors, and any damage that may be caused to the user’s computer systems (hardware and software), or to the files &amp; documents stored on them, as a consequence.</p><p>Shenzhen Tenda Technology Co., Ltd., failed to establish a clear channel of communication despite my thorough and consistent attempts. They were given ample opportunity to respond to my contact attempts. Responsible disclosure allows vendors between 60 and 120 business days to patch a vulnerability. 90 days have passed since my initial contact attempts. </p><hr><h2 id="summary"><strong>Summary:</strong></h2><p>I hope you liked the blog post. I apologize for getting political toward the end. </p><p>Follow me on <a href="https://twitter.com/olivier_boschko?ref=boschko.ca">twitter</a> I sometimes post interesting stuff there too. Personally, I'd strongly recommend going on Amazon, Alibaba, or Aliexpress &amp; buying a bunch of odd IoT devices &amp; tearing them down. You never know what you will find :)</p><p>If you have any ethical dilemmas, hold anything against me, or disapprove of the contents of this blog, send me a DM, I'd love to see it from your perspective. Every day is a school day. </p><p><strong>Thank you for reading!</strong></p>
    </section>


</article>
</main>

    <section class="footer-cta outer">
        <div class="inner">
            <h2 class="footer-cta-title">Sign up for more like this.</h2>
            <a class="footer-cta-button" href="#/portal" data-portal>
                <div class="footer-cta-input">Enter your email</div>
                <span>Subscribe</span>
            </a>
        </div>
    </section>



            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post no-image keep-ratio">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/adversarial-ml/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Breaking Down Adversarial Machine Learning Attacks Through Red Team Challenges
                </h2>
            </header>
                <div class="post-card-excerpt">Learn how to craft and understand adversarial attacks on AI/ML models through hands-on challenges on Dreadnode’s Crucible CTF platform.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2024-11-27">27 Nov 2024</time>
                <span class="post-card-meta-length">25 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image keep-ratio">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/incinerator/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Incinerator: The Ultimate Android Malware Reversing Tool
                </h2>
            </header>
                <div class="post-card-excerpt">Master Android malware reversal with ease using Incinerator, your trusted ally in the fight against threat actors for experts and novices alike.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2024-04-03">03 Apr 2024</time>
                <span class="post-card-meta-length">15 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post no-image keep-ratio">


    <div class="post-card-content">

        <a class="post-card-content-link" href="/tp-link-tddp-bof/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    TP-Link TDDP Buffer Overflow Vulnerability
                </h2>
            </header>
                <div class="post-card-excerpt">TP-Link&#39;s TDDP programs listening on UDP port 1040, fails to properly verify data length during parsing, leading to memory overflow destroying the memory structure and causing a denial of service.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2024-03-19">19 Mar 2024</time>
                <span class="post-card-meta-length">8 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://boschko.ca">Boschko Security Blog</a> &copy; 2025</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div class="gh-powered-by"><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="https://boschko.ca/assets/built/casper.js?v=4f517c742f"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>



</body>
</html>
