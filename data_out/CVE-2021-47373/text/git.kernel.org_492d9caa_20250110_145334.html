

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kaige Fu <kaige.fu@linux.alibaba.com> | 2021-09-15 10:20:55 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-09-30 10:13:03 +0200 |
| commit | [e0c1c2e5da19685a20557a50f10c6aa4fa26aa84](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)) | |
| tree | [f8a46fe103e71e8ffeb1f7b965b0e0bb2b3737ce](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84) | |
| parent | [5468867001051570dc3d7ac0fc975ad56d64e02f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5468867001051570dc3d7ac0fc975ad56d64e02f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84&id2=5468867001051570dc3d7ac0fc975ad56d64e02f)) | |
| download | [linux-e0c1c2e5da19685a20557a50f10c6aa4fa26aa84.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e0c1c2e5da19685a20557a50f10c6aa4fa26aa84.tar.gz) | |

irqchip/gic-v3-its: Fix potential VPE leak on error[ Upstream commit 280bef512933b2dda01d681d8cbe499b98fc5bdd ]
In its\_vpe\_irq\_domain\_alloc, when its\_vpe\_init() returns an error,
there is an off-by-one in the number of VPEs to be freed.
Fix it by simply passing the number of VPEs allocated, which is the
index of the loop iterating over the VPEs.
Fixes: 7d75bbb4bc1a ("irqchip/gic-v3-its: Add VPE irq domain allocation/teardown")
Signed-off-by: Kaige Fu <kaige.fu@linux.alibaba.com>
[maz: fixed commit message]
Signed-off-by: Marc Zyngier <maz@kernel.org>
Link: [https://lore.kernel.org/r/d9e36dee512e63670287ed9eff884a5d8d6d27f2.1631672311.git.kaige.fu@linux.alibaba.com](https://lore.kernel.org/r/d9e36dee512e63670287ed9eff884a5d8d6d27f2.1631672311.git.kaige.fu%40linux.alibaba.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)

| -rw-r--r-- | [drivers/irqchip/irq-gic-v3-its.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/irqchip/irq-gic-v3-its.c?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/irqchip/irq-gic-v3-its.c b/drivers/irqchip/irq-gic-v3-its.cindex ba39668c3e0851..51584f4cccf465 100644--- a/[drivers/irqchip/irq-gic-v3-its.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/irqchip/irq-gic-v3-its.c?id=5468867001051570dc3d7ac0fc975ad56d64e02f)+++ b/[drivers/irqchip/irq-gic-v3-its.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/irqchip/irq-gic-v3-its.c?id=e0c1c2e5da19685a20557a50f10c6aa4fa26aa84)@@ -4501,7 +4501,7 @@ static int its\_vpe\_irq\_domain\_alloc(struct irq\_domain \*domain, unsigned int virq  if (err) { if (i > 0)- its\_vpe\_irq\_domain\_free(domain, virq, i - 1);+ its\_vpe\_irq\_domain\_free(domain, virq, i);  its\_lpi\_free(bitmap, base, nr\_ids); its\_free\_prop\_table(vprop\_page); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:52:12 +0000

