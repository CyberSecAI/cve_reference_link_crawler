Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT345680)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T345680
# CVE-2023-45370: SportsTeams: Special:SportsManagerLogo and Special:SportsTeamsManagerLogo should check for the "sportsteamsmanager" user rightClosed, Resolved[Public](/policy/explain/PHID-TASK-ox25wzwwautelrpv5hb2/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/345680/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/345680/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-ox25wzwwautelrpv5hb2/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-ox25wzwwautelrpv5hb2/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Protect as security issue](/wmf/escalate-task/345680/)
* [Award Token](/token/give/PHID-TASK-ox25wzwwautelrpv5hb2/)
* [Flag For Later](/flag/edit/PHID-TASK-ox25wzwwautelrpv5hb2/)

Assigned To

|  | [ashley](/p/ashley/) |
| --- | --- |

Authored By

|  | [ashley](/p/ashley/) |
| --- | --- |
| Sep 6 2023, 12:52 AM2023-09-06 00:52:30 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Incoming)](/project/board/1179/)
* [Security](/tag/security/)
* [Vuln-MissingAuthz](/tag/vuln-missingauthz/) [(Tracked)](/project/board/1343/)
* [Social-Tools](/tag/social-tools/) [(SportsTeams)](/project/board/1009/)
* [SportsTeams](/tag/sportsteams/)
Referenced FilesNoneSubscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [ashley](/p/ashley/) |
| --- | --- |

# Description

...but currently they don't. Oops. Or rather, they don't do that *properly*: both special pages' \_\_construct method calls the parent constructor with sportsteamsmanager as the 2nd argument, but this does **not** actually restrict access to the page and further checks should need to be done in either execute() or (preferably) executeLogo() (for consistency with existing similar checks).

To be precise, both special pages *do* check that the user has the basic upload user right as well as that the DB isn't locked, that the target directory is writable, etc. in executeLogo() but in terms of permissions, that's it. The thing is, most registered users on most sites will have the upload right whereas sportsteamsmanager (which grants access to its namesake special page, Special:SportsTeamsManager, which is used to add, edit and remove sports and sports teams) will likely be granted only to a handful of users. That's why this matters (in theory; in practise SportsTeams remains so site-specific that most sites are unlikely to ever even *consider* installing it).

On the other hand, this isn't super exploitable and a potential attacker would still need to manually set the correct id URL param to do any real damage; but then again the uploads done via these special pages aren't logged anywhere currently, which is kinda annoying and would make attacks harder to debug.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [[SECURITY] Uploading special pages should properly check that the user is allowed to access them](https://gerrit.wikimedia.org/r/c/959699) | [mediawiki/extensions/SportsTeams](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SportsTeams) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/SportsTeams/%2B/master) | +4 -0 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T345680)
# Related Objects

* Mentions

Mentioned In [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874)
### Event Timeline

[ashley](/p/ashley/) created this task.[Sep 6 2023, 12:52 AM2023-09-06 00:52:30 (UTC+0)](#9144626)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5541219/)[Sep 6 2023, 12:52 AM2023-09-06 00:52:32 (UTC+0)](#9144636)[ashley](/p/ashley/) changed the task status from Open to In Progress.[Sep 6 2023, 12:53 AM2023-09-06 00:53:34 (UTC+0)](#9144639)[ashley](/p/ashley/) claimed this task.[ashley](/p/ashley/) added projects: [Vuln-MissingAuthz](/tag/vuln-missingauthz/), [Social-Tools](/tag/social-tools/), [SportsTeams](/tag/sportsteams/).[ashley](/p/ashley/) moved this task from [Backlog](/project/board/1009/) to [SportsTeams](/project/board/1009/) on the [Social-Tools](/tag/social-tools/) board.[Sep 9 2023, 11:42 AM2023-09-09 11:42:50 (UTC+0)](#9154114)[ashley](/p/ashley/) closed this task as Resolved.[Sep 21 2023, 11:23 AM2023-09-21 11:23:28 (UTC+0)](#9186548)Comment Actions

[The patch](https://gerrit.wikimedia.org/r/959699) got merged and this is now resolved.

[Bawolff](/p/Bawolff/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-y4yzfg7c5mika72/)" to "Public (No Login Required)".[Sep 21 2023, 12:04 PM2023-09-21 12:04:33 (UTC+0)](#9186690)[Bawolff](/p/Bawolff/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-yfvaekxc7lwepzo/)" to "All Users".[sbassett](/p/sbassett/) mentioned this in [T340874: Write and send supplementary release announcement for extensions and skins with security patches (1.35.12/1.39.5/1.40.1)](/T340874).[Sep 21 2023, 5:01 PM2023-09-21 17:01:09 (UTC+0)](#9188572)[Mstyles](/p/Mstyles/) renamed this task from SportsTeams: Special:SportsManagerLogo and Special:SportsTeamsManagerLogo should check for the "sportsteamsmanager" user right to CVE-2023-45370: SportsTeams: Special:SportsManagerLogo and Special:SportsTeamsManagerLogo should check for the "sportsteamsmanager" user right.[Oct 10 2023, 4:02 PM2023-10-10 16:02:54 (UTC+0)](#9239485)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)