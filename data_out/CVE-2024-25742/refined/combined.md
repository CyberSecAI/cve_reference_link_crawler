=== Content from github.com_c17e053d_20250110_173812.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fe3ef461af35a8c74f2f4ce6616491ddb355a208f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fe3ef461af35a8c74f2f4ce6616491ddb355a208f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.7k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  433](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/e3ef461af35a8c74f2f4ce6616491ddb355a208f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

x86/sev: Harden #VC instruction emulation somewhat

[Browse files](/torvalds/linux/tree/e3ef461af35a8c74f2f4ce6616491ddb355a208f)
Browse the repository at this point in the history

```
Compare the opcode bytes at rIP for each #VC exit reason to verify the
instruction which raised the #VC exception is actually the right one.

Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20240105101407.11694-1-bp@alien8.de](https://lore.kernel.org/r/20240105101407.11694-1-bp%40alien8.de)
```

* Loading branch information

[![@bp3tk0v](https://avatars.githubusercontent.com/u/73170307?s=40&v=4)](/bp3tk0v)

[bp3tk0v](/torvalds/linux/commits?author=bp3tk0v "View all commits by bp3tk0v")
committed
Jan 29, 2024

1 parent
[41bccc9](/torvalds/linux/commit/41bccc98fb7931d63d03f326a746ac4d429c1dd3)

commit e3ef461

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**108 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* arch/x86

  + boot/compressed

    - arch/x86/boot/compressed/sev.c
      [sev.c](#diff-9960c56dbfee3ed639489560cfcfecd21f64dcf97ccf72bd448ae3369681e8dd)
  + kernel

    - arch/x86/kernel/sev-shared.c
      [sev-shared.c](#diff-9fa939733ca9773c8a8bc403a9d4ca739a98d01e5da538aea5d2e4e2c0f6b439)
    - arch/x86/kernel/sev.c
      [sev.c](#diff-bea8499b511ff61aefaf1d4a5be7c1eebeb46bf5cf572c0609639be6d9c53ef1)

## There are no files selected for viewing

4 changes: 4 additions & 0 deletions

4
[arch/x86/boot/compressed/sev.c](#diff-9960c56dbfee3ed639489560cfcfecd21f64dcf97ccf72bd448ae3369681e8dd "arch/x86/boot/compressed/sev.c")

Show comments

[View file](/torvalds/linux/blob/e3ef461af35a8c74f2f4ce6616491ddb355a208f/arch/x86/boot/compressed/sev.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -304,6 +304,10 @@ void do\_boot\_stage2\_vc(struct pt\_regs \*regs, unsigned long exit\_code) |
|  |  | if (result != ES\_OK) |
|  |  | goto finish; |
|  |  |  |
|  |  | result = vc\_check\_opcode\_bytes(&ctxt, exit\_code); |
|  |  | if (result != ES\_OK) |
|  |  | goto finish; |
|  |  |  |
|  |  | switch (exit\_code) { |
|  |  | case SVM\_EXIT\_RDTSC: |
|  |  | case SVM\_EXIT\_RDTSCP: |
| Expand Down | |  |

102 changes: 100 additions & 2 deletions

102
[arch/x86/kernel/sev-shared.c](#diff-9fa939733ca9773c8a8bc403a9d4ca739a98d01e5da538aea5d2e4e2c0f6b439 "arch/x86/kernel/sev-shared.c")

Show comments

[View file](/torvalds/linux/blob/e3ef461af35a8c74f2f4ce6616491ddb355a208f/arch/x86/kernel/sev-shared.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,11 +10,15 @@ |
|  |  | \*/ |
|  |  |  |
|  |  | #ifndef \_\_BOOT\_COMPRESSED |
|  |  | #define error(v) pr\_err(v) |
|  |  | #define has\_cpuflag(f) boot\_cpu\_has(f) |
|  |  | #define error(v) pr\_err(v) |
|  |  | #define has\_cpuflag(f) boot\_cpu\_has(f) |
|  |  | #define sev\_printk(fmt, ...) printk(fmt, ##\_\_VA\_ARGS\_\_) |
|  |  | #define sev\_printk\_rtl(fmt, ...) printk\_ratelimited(fmt, ##\_\_VA\_ARGS\_\_) |
|  |  | #else |
|  |  | #undef WARN |
|  |  | #define WARN(condition, format...) (!!(condition)) |
|  |  | #define sev\_printk(fmt, ...) |
|  |  | #define sev\_printk\_rtl(fmt, ...) |
|  |  | #endif |
|  |  |  |
|  |  | /\* I/O parameters for CPUID-related helpers \*/ |
| Expand Down  Expand Up | | @@ -574,13 +578,18 @@ void \_\_init do\_vc\_no\_ghcb(struct pt\_regs \*regs, unsigned long exit\_code) |
|  |  | { |
|  |  | unsigned int subfn = lower\_bits(regs->cx, 32); |
|  |  | unsigned int fn = lower\_bits(regs->ax, 32); |
|  |  | u16 opcode = \*(unsigned short \*)regs->ip; |
|  |  | struct cpuid\_leaf leaf; |
|  |  | int ret; |
|  |  |  |
|  |  | /\* Only CPUID is supported via MSR protocol \*/ |
|  |  | if (exit\_code != SVM\_EXIT\_CPUID) |
|  |  | goto fail; |
|  |  |  |
|  |  | /\* Is it really a CPUID insn? \*/ |
|  |  | if (opcode != 0xa20f) |
|  |  | goto fail; |
|  |  |  |
|  |  | leaf.fn = fn; |
|  |  | leaf.subfn = subfn; |
|  |  |  |
| Expand Down  Expand Up | | @@ -1170,3 +1179,92 @@ static int vmgexit\_psc(struct ghcb \*ghcb, struct snp\_psc\_desc \*desc) |
|  |  | out: |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | static enum es\_result vc\_check\_opcode\_bytes(struct es\_em\_ctxt \*ctxt, |
|  |  | unsigned long exit\_code) |
|  |  | { |
|  |  | unsigned int opcode = (unsigned int)ctxt->insn.opcode.value; |
|  |  | u8 modrm = ctxt->insn.modrm.value; |
|  |  |  |
|  |  | switch (exit\_code) { |
|  |  |  |
|  |  | case SVM\_EXIT\_IOIO: |
|  |  | case SVM\_EXIT\_NPF: |
|  |  | /\* handled separately \*/ |
|  |  | return ES\_OK; |
|  |  |  |
|  |  | case SVM\_EXIT\_CPUID: |
|  |  | if (opcode == 0xa20f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_INVD: |
|  |  | if (opcode == 0x080f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_MONITOR: |
|  |  | if (opcode == 0x010f && modrm == 0xc8) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_MWAIT: |
|  |  | if (opcode == 0x010f && modrm == 0xc9) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_MSR: |
|  |  | /\* RDMSR \*/ |
|  |  | if (opcode == 0x320f || |
|  |  | /\* WRMSR \*/ |
|  |  | opcode == 0x300f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_RDPMC: |
|  |  | if (opcode == 0x330f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_RDTSC: |
|  |  | if (opcode == 0x310f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_RDTSCP: |
|  |  | if (opcode == 0x010f && modrm == 0xf9) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_READ\_DR7: |
|  |  | if (opcode == 0x210f && |
|  |  | X86\_MODRM\_REG(ctxt->insn.modrm.value) == 7) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_VMMCALL: |
|  |  | if (opcode == 0x010f && modrm == 0xd9) |
|  |  | return ES\_OK; |
|  |  |  |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_WRITE\_DR7: |
|  |  | if (opcode == 0x230f && |
|  |  | X86\_MODRM\_REG(ctxt->insn.modrm.value) == 7) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | case SVM\_EXIT\_WBINVD: |
|  |  | if (opcode == 0x90f) |
|  |  | return ES\_OK; |
|  |  | break; |
|  |  |  |
|  |  | default: |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | sev\_printk(KERN\_ERR "Wrong/unhandled opcode bytes: 0x%x, exit\_code: 0x%lx, rIP: 0x%lx\n", |
|  |  | opcode, exit\_code, ctxt->regs->ip); |
|  |  |  |
|  |  | return ES\_UNSUPPORTED; |
|  |  | } |

5 changes: 4 additions & 1 deletion

5
[arch/x86/kernel/sev.c](#diff-bea8499b511ff61aefaf1d4a5be7c1eebeb46bf5cf572c0609639be6d9c53ef1 "arch/x86/kernel/sev.c")

Show comments

[View file](/torvalds/linux/blob/e3ef461af35a8c74f2f4ce6616491ddb355a208f/arch/x86/kernel/sev.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1752,7 +1752,10 @@ static enum es\_result vc\_handle\_exitcode(struct es\_em\_ctxt \*ctxt, |
|  |  | struct ghcb \*ghcb, |
|  |  | unsigned long exit\_code) |
|  |  | { |
|  |  | enum es\_result result; |
|  |  | enum es\_result result = vc\_check\_opcode\_bytes(ctxt, exit\_code); |
|  |  |  |
|  |  | if (result != ES\_OK) |
|  |  | return result; |
|  |  |  |
|  |  | switch (exit\_code) { |
|  |  | case SVM\_EXIT\_READ\_DR7: |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e3ef461`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fe3ef461af35a8c74f2f4ce6616491ddb355a208f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.amd.com_f9058809_20250110_173812.html ===

[AMD Website Accessibility Statement](/en/site-notifications/accessibility-statement.html)

[![AMD Logo](/content/dam/code/images/header/amd-header-logo.svg "AMD Logo")](/en.html)

* Products
   Processors

   Accelerators

   Graphics

   Adaptive SoCs, FPGAs, & SOMs

   Software, Tools, & Apps

  [Processors](#headerMenu-c4add7cc9c-item-7fd7783542-collapse)

  ###### Servers

  + [EPYC](https://www.amd.com/en/products/processors/server/epyc.html)

  ###### Business Systems

  + [Laptops](https://www.amd.com/en/products/processors/laptop/ryzen-for-business.html)
  + [Desktops](https://www.amd.com/en/products/processors/ryzen-for-professionals.html)
  + [Ryzen AI for Business](https://www.amd.com/en/products/processors/business-systems/ryzen-ai.html)

  ###### Workstations

  + [Ryzen Threadripper](https://www.amd.com/en/products/processors/workstations/ryzen-threadripper.html)
  + [Ryzen PRO for Mobile Workstations](https://www.amd.com/en/products/processors/workstations/mobile.html)
  + [Ryzen](https://www.amd.com/en/products/processors/ryzen-for-creators.html)

  ###### Embedded

  + [EPYC and Ryzen](https://www.amd.com/en/products/embedded.html)
  + [Partner Ecosystem](https://www.amd.com/en/products/embedded/ecosystem.html)
  + [Industry Solutions](https://www.amd.com/en/products/embedded/solutions.html)

  ###### Personal Laptops

  + [AMD Advantage Premium](https://www.amd.com/en/gaming/laptops/advantage-premium.html)
  + [Ryzen with Radeon Graphics](https://www.amd.com/en/products/processors/laptop/ryzen.html)
  + [Athlon with Radeon Graphics](https://www.amd.com/en/products/processors/laptop/athlon.html)
  + [Ryzen AI for Consumer](https://www.amd.com/en/products/processors/consumer/ryzen-ai.html)

  ###### Personal Desktops

  + [AMD Advantage Premium](https://www.amd.com/en/gaming/desktops/advantage-premium.html)
  + [Ryzen](https://www.amd.com/en/products/processors/desktops/ryzen.html)
  + [Athlon with Radeon Graphics](https://www.amd.com/en/products/processors/desktops/athlon.html)

  ###### Handheld

  + [Ryzen Z Series](https://www.amd.com/en/products/processors/handhelds/ryzen-z-series.html)

  ###### Resources

  + [Data Center Blogs & Insights](https://www.amd.com/en/solutions/data-center/insights.html)
  + [Client & Data Center Tech Docs](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_archive_status=Active&f-amd_audience=Technical)
  + [EPYC White Papers & Briefs](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Solution%20Briefs,Performance%20Briefs,White%20Papers,Product%20Briefs&f-amd_archive_status=Active&f-amd_product_brand=EPYC,Instinct&f-amd_form_factor=Servers)
  + [EPYC Tuning Guides](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Tuning%20Guides&f-amd_archive_status=Active&f-amd_product_brand=EPYC)
  + [Product Specifications](https://www.amd.com/en/products/specifications.html)

  [Accelerators](#headerMenu-c4add7cc9c-item-9a5ba2c03f-collapse)

  ###### GPU Accelerators

  + [Instinct Accelerators](https://www.amd.com/en/products/accelerators/instinct.html)
  + [Documentation](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_product_type=Accelerators)
  + [Cloud Graphics](https://www.amd.com/en/products/accelerators/radeon-pro.html)

  ###### Adaptive Accelerators

  + [Alveo Data Center Accelerator Cards](https://www.amd.com/en/products/accelerators/alveo.html)
  + [Telco Accelerator Cards](https://www.amd.com/en/solutions/telco-and-networking/telco-accelerators.html)

  ###### DPU Accelerators

  + [Pensando Salina](https://www.amd.com/en/products/accelerators/pensando.html)
  + [Aruba CX 10000 with Pensando](https://www.amd.com/en/products/accelerators/pensando.html)

  ###### Ethernet Adapters

  + [Pensando Pollara 400](https://www.amd.com/en/products/accelerators/pensando.html)
  + [Alveo X3 Series](https://www.amd.com/en/products/accelerators/alveo/x3/a-x3522-p08g-pq-g.html)
  + [NIC X2 Series Offload](https://www.amd.com/en/products/ethernet-adapters.html)

  [Graphics](#headerMenu-c4add7cc9c-item-a162ccaef2-collapse)

  ###### Workstations

  + [Radeon PRO](https://www.amd.com/en/products/graphics/workstations.html)

  ###### Desktops

  + [AMD Advantage Premium](https://www.amd.com/en/gaming/desktops/advantage-premium.html)
  + [Radeon RX](https://www.amd.com/en/products/graphics/desktops/radeon.html)

  ###### Laptops

  + [AMD Advantage Premium](https://www.amd.com/en/gaming/laptops/advantage-premium.html)
  + [Radeon Mobile Graphics](https://www.amd.com/en/products/graphics/laptops/radeon.html)

  ###### Resources

  + [Product Specifications](https://www.amd.com/en/products/specifications.html)
  + [Documentation](https://gpuopen.com/learn/)

  [Adaptive SoCs, FPGAs, & SOMs](#headerMenu-c4add7cc9c-item-89a4ef27bd-collapse)

  ###### Adaptive SoCs & FPGAs

  + [Versal Portfolio](https://www.amd.com/en/products/adaptive-socs-and-fpgas/versal.html)
  + [SoC Portfolio](https://www.amd.com/en/products/adaptive-socs-and-fpgas/soc.html)
  + [FPGA Portfolio](https://www.amd.com/en/products/adaptive-socs-and-fpgas/fpga.html)
  + [Cost-Optimized Portfolio](https://www.amd.com/en/products/adaptive-socs-and-fpgas/cost-optimized-portfolio.html)

  ###### System-on-Modules (SOMs)

  + [SOM Overview](https://www.amd.com/en/products/system-on-modules.html)
  + [Kria SOMs](https://www.amd.com/en/products/system-on-modules/kria.html)
  + [KD240 Drives Starter Kit](https://www.amd.com/en/products/system-on-modules/kria/k24/kd240-drives-starter-kit.html)
  + [KV260 Vision AI Starter Kit](https://www.amd.com/en/products/system-on-modules/kria/k26/kv260-vision-starter-kit.html)
  + [KR260 Robotics Starter Kit](https://www.amd.com/en/products/system-on-modules/kria/k26/kr260-robotics-starter-kit.html)

  ###### Technologies

  + [AI Engine](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/ai-engine.html)
  + [Design Security](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/design-security.html)
  + [Digital Signal Processing](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/digital-signal-processing.html)
  + [Functional Safety](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/functional-safety.html)
  + [High Speed Serial](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/high-speed-serial.html)
  + [Memory Solutions](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/memory.html)
  + [Power Efficiency](https://www.amd.com/en/products/adaptive-socs-and-fpgas/technologies/power-efficiency.html)

  ###### Resources

  + [Intellectual Property](https://www.xilinx.com/products/intellectual-property.html)
  + [Design Hubs](https://docs.amd.com/p/design-hubs)
  + [Developer Hub](https://www.amd.com/en/developer/browse-by-product-type/adaptive-resources.html)
  + [Customer Training](https://learningcatalog-amd.netexam.com/)

  ###### Evaluation Boards & Kits

  + [Evaluation Boards](https://www.xilinx.com/products/boards-and-kits.html)
  + [Boards & Kits Accessories](https://www.xilinx.com/products/boards-and-kits/board-and-kit-accessories.html)

  [Software, Tools, & Apps](#headerMenu-c4add7cc9c-item-bdabeadece-collapse)

  ###### Processor Tools

  + [Ryzen Master Overclocking Utility](https://www.amd.com/en/products/software/ryzen-master.html)
  + [PRO Manageability / DMTF DASH](https://www.amd.com/en/products/processors/technologies/pro-technologies.html)
  + [StoreMI](https://www.amd.com/en/products/software/storemi.html)
  + [Ryzen AI Software](https://www.amd.com/en/products/software/ryzen-ai-software.html)
  + [Zen Software Studio](/en/developer/zen-software-studio.html)

  ###### Graphics Tools & Apps

  + [AMD Software: Adrenalin Edition](https://www.amd.com/en/products/software/adrenalin.html)
  + [AMD Software: PRO Edition](https://www.amd.com/en/products/processors/technologies/pro-technologies.html)
  + [FidelityFX](https://www.amd.com/en/products/graphics/technologies/fidelityfx.html)
  + [Radeon ProRender](https://www.amd.com/en/products/graphics/software/radeon-prorender.html)

  ###### Adaptive SoC & FPGA Tools

  + [Design Tools](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas.html)
  + [Vivado Software](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/vivado.html)
  + [Vitis Software](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/vitis.html)
  + [Vitis Model Composer](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/vitis/vitis-model-composer.html)
  + [Vitis HLS](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/vitis/vitis-hls.html)
  + [Vitis AI](https://www.amd.com/en/products/software/vitis-ai.html)
  + [Embedded Software](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/embedded-software.html)
  + [Power Design Manager](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/power-design-manager.html)

  ###### Intellectual Property & Apps

  + [Pre-Built IP Cores](https://www.xilinx.com/products/intellectual-property.html)
  + [Alveo Accelerator App Store](https://www.amd.com/en/developer/resources/alveo-apps/all-apps.html)
  + [Kria SOM App Store](https://www.amd.com/en/developer/resources/kria-apps.html)

  ###### GPU Accelerator Tools & Apps

  + [ROCm Open Software](https://www.amd.com/en/products/software/rocm.html)
  + [Infinity Hub Software Containers](https://www.amd.com/en/developer/resources/infinity-hub.html)
* Solutions
   AI

   Industries

   Workloads

   Gaming

  [AI](#headerMenu-c13975b6ca-item-5f064e1f45-collapse)

  ###### Overview

  + [AI Solutions](/en/solutions/ai.html)
  + [Sovereign AI](https://www.amd.com/en/solutions/ai/sovereign-ai.html)
  + [Blogs](https://community.amd.com/t5/ai/bg-p/amd-ai)
  + [Case Studies](https://www.amd.com/en/resources/case-studies.html#q=AI)
  + [Press Releases](/en/newsroom/press-release-search.html#q=AI)

  ###### For Data Center & Cloud

  + [GPUÂ Accelerators](https://www.amd.com/en/products/accelerators/instinct/mi300.html)
  + [Adaptive Accelerators](https://www.xilinx.com/applications/data-center/v70.html)
  + [Adaptive SoCs for Data Center](https://www.amd.com/en/products/accelerators/alveo/v70.html)
  + [ServerÂ Processors](https://www.amd.com/en/products/processors/server/epyc/ai.html)

  ###### For Edge & Endpoints

  + [Ryzen AI for Business](https://www.amd.com/en/products/processors/business-systems/ryzen-ai.html)
  + [Ryzen AI for Consumer](https://www.amd.com/en/products/processors/consumer/ryzen-ai.html)
  + [Radeon Graphics Cards](https://www.amd.com/en/products/graphics/radeon-ai.html)
  + [Adaptive SoCsÂ forÂ Edge](https://www.amd.com/en/products/adaptive-socs-and-fpgas/versal/gen2/ai-edge-series.html)
  + [Adaptive SoCs for Embedded](https://www.amd.com/en/products/adaptive-socs-and-fpgas/soc.html)
  + [System-on-Modules (SOMs)](https://www.amd.com/en/products/system-on-modules/kria.html)

  ###### For Developers

  + [ROCm Developer Hub](https://www.amd.com/en/developer/resources/rocm-hub.html)
  + [Vitis AI DevelopmentÂ Platform](https://www.amd.com/en/products/software/vitis-ai.html)
  + [ZenDNNÂ Inference Libraries](https://www.amd.com/en/developer/zendnn.html)
  + [Ryzen AI Software](https://www.amd.com/en/developer/resources/ryzen-ai-software.html)

  [Industries](#headerMenu-c13975b6ca-item-473082234e-collapse)

  ###### Industries

  ###### Industries

  + [Aerospace & Defense](https://www.amd.com/en/solutions/aerospace-and-defense.html)
  + [Architecture, Engineering, & Construction](https://www.amd.com/en/solutions/architecture-engineering-and-construction.html)
  + [Automotive](/en/solutions/automotive.html)
  + [Broadcast & Pro AV](https://www.amd.com/en/solutions/broadcast-and-pro-av.html)
  + [Energy](https://www.amd.com/en/solutions/energy.html)

  ###### Industries

  + [Emulation & Prototyping](https://www.amd.com/en/solutions/emulation-prototyping.html)
  + [Financial Services](https://www.amd.com/en/solutions/financial-services.html)
  + [Healthcare](https://www.amd.com/en/solutions/healthcare.html)
  + [Home & Lifestyle](https://www.amd.com/en/solutions/home-and-lifestyle.html)
  + [Industrial & Vision](https://www.amd.com/en/solutions/industrial.html)

  ###### Industries

  + [Manufacturing](https://www.amd.com/en/solutions/manufacturing.html)
  + [Media & Entertainment](https://www.amd.com/en/solutions/media-and-entertainment.html)
  + [Product Design](https://www.amd.com/en/solutions/product-design.html)
  + [Public Sector](https://www.amd.com/en/solutions/public-sector.html)
  + [Retail & E-Commerce](https://www.amd.com/en/solutions/retail-and-ecommerce.html)

  ###### Industries

  + [Semiconductor](https://www.amd.com/en/solutions/semiconductor.html)
  + [Supercomputing & Research](https://www.amd.com/en/solutions/supercomputing-and-research.html)
  + [Telco & Networking](https://www.amd.com/en/solutions/telco-and-networking.html)
  + [Test & Measurement](https://www.amd.com/en/solutions/test-and-measurement.html)

  [Workloads](#headerMenu-c13975b6ca-item-7ace91741c-collapse)

  ###### Workloads

  + [AI](https://www.amd.com/en/solutions/ai.html)
  + [Cloud Computing](https://www.amd.com/en/solutions/data-center/cloud-computing.html)
  + [Database & Analytics](https://www.amd.com/en/solutions/database-and-analytics.html)

  + [Embedded Computing](https://www.amd.com/en/solutions/embedded-computing.html)
  + [HCI & Virtualization](https://www.amd.com/en/solutions/hci-and-virtualization.html)

  + [High Performance Computing](https://www.amd.com/en/solutions/high-performance-computing.html)
  + [Infrastructure Acceleration](https://www.amd.com/en/solutions/data-center/infrastructure-acceleration.html)

  [Gaming](#headerMenu-c13975b6ca-item-c7064786cc-collapse)

  ###### Gaming

  + [Gaming with AMD](https://www.amd.com/en/gaming.html)
  + [Featured Games](https://www.amd.com/en/gaming/featured-games.html)

  ###### Systems

  + [Advantage Gaming Systems](https://www.amd.com/en/gaming/advantage.html)
  + [Gaming Desktops](https://www.amd.com/en/gaming/desktops.html)
  + [Gaming Laptops](https://www.amd.com/en/gaming/laptops.html)
  + [Gaming Handhelds](https://www.amd.com/en/gaming/handhelds.html)

  ###### Technologies

  + [Smart Technologies](https://www.amd.com/en/gaming/technologies/smart-technologies.html)
  + [FidelityFX Super Resolution](https://www.amd.com/en/products/graphics/technologies/fidelityfx/super-resolution.html)
  + [FreeSync](https://www.amd.com/en/products/graphics/technologies/freesync.html)
  + [HYPR-RX](https://www.amd.com/en/products/software/adrenalin/hypr-rx.html)

  ###### Resources

  + [Red Team Community](https://community.amd.com/t5/red-team/ct-p/red-team)
  + [AMD Software: Adrenalin Edition](https://www.amd.com/en/products/software/adrenalin.html)
* Resources & Support
   Downloads

   Developer Resources

   Partner Resources

   Support

  [Downloads](#headerMenu-95dee59baf-item-f2931226c7-collapse)

  ###### EPYC Processors

  + [Client & Data Center Tech Docs](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_archive_status=Active&f-amd_audience=Technical)
  + [EPYC White Papers & Briefs](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Solution%20Briefs,Performance%20Briefs,White%20Papers,Product%20Briefs&f-amd_archive_status=Active&f-amd_product_brand=EPYC,Instinct&f-amd_form_factor=Servers)
  + [EPYC Tuning Guides](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Tuning%20Guides&f-amd_archive_status=Active&f-amd_product_brand=EPYC)

  ###### Radeon Graphics & AMD Chipsets

  + [Drivers](https://www.amd.com/en/support/download/drivers.html)
  + [Radeon ProRender Plug-ins](https://www.amd.com/en/products/graphics/software/radeon-prorender.html)
  + [PRO Certified ISV Applications](https://www.amd.com/en/search/certified-drivers.html)

  ###### Adaptive SoCs & FPGAs

  + [Vivado Design Suite](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vivado-design-tools.html)
  + [Vitis Software Platform](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vitis.html)
  + [Vitis Accelerated Libraries](https://github.com/Xilinx/Vitis_Libraries)
  + [Vitis Embedded Platforms](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-platforms.html)
  + [PetaLinux Tools](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools.html)
  + [Adaptive SoCs & FPGAs](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/device-models.html)
  + [Package Pinout Files](https://www.xilinx.com/support/package-pinout-files.html)
  + [Power Design Manger](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/power-design-manager.html)

  ###### Alveo Accelerators & Kria SOMs

  + [Alveo Package Files](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/alveo.html)
  + [Alveo App Store](https://www.amd.com/en/developer/resources/alveo-apps/all-apps.html)
  + [Kria App Store](https://www.amd.com/en/developer/resources/kria-apps.html)

  ###### Ryzen Processors

  + [Ryzen Master Overclocking Utility](https://www.amd.com/en/products/software/ryzen-master.html)
  + [StoreMI](https://www.amd.com/en/products/software/storemi.html)
  + [PRO Manageability Tools for IT Administrators](https://www.amd.com/en/support/downloads/manageability-tools.html)

  ###### Ethernet Adapters

  + [NIC Software & Downloads](https://www.xilinx.com/support/download/nic-software-and-drivers.html)

  [Developer Resources](#headerMenu-95dee59baf-item-8126f0ed47-collapse)

  ###### Overview

  + [Developer Central](/en/developer.html)

  ###### Processors

  + [Zen Software Studio](/en/developer/zen-software-studio.html)
  + [EPYC Tuning Guides](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Tuning%20Guides&f-amd_archive_status=Active&f-amd_product_brand=EPYC)
  + [EPYC Whitepapers & Briefs](https://www.amd.com/en/search/documentation/hub.html#sortCriteria=%40amd_release_date%20descending&f-amd_document_type=Solution%20Briefs,Performance%20Briefs,White%20Papers,Product%20Briefs&f-amd_archive_status=Active&f-amd_product_brand=EPYC,Instinct&f-amd_form_factor=Servers)
  + [Ryzen AI Software](https://www.amd.com/en/developer/resources/ryzen-ai-software.html)

  ###### Accelerators

  + [ROCm Developer Hub](https://www.amd.com/en/developer/resources/rocm-hub.html)
  + [ROCm Documentation](https://rocm.docs.amd.com/en/latest/)
  + [Infinity Hub Software Containers](https://www.amd.com/en/developer/resources/infinity-hub.html)
  + [Pensando DPUs](https://www.amd.com/en/developer/browse-by-resource-type/software-tools.html#dpu-accelerators)

  ###### Adaptive SoCs, FPGAs, & SOMs

  + [Vivado Design Suite](https://www.amd.com/en/developer/resources/vivado.html)
  + [Vitis Software Developer Tools](https://www.amd.com/en/developer/resources/vitis.html)
  + [Vitis AI Developer Tools](https://www.amd.com/en/developer/resources/vitis-ai.html)
  + [Documentation](https://docs.amd.com/)
  + [Product Training](https://learningcatalog-amd.netexam.com/)
  + [Partner Solutions](https://www.xilinx.com/xilinx-partner-program/partner-solutions.html)

  ###### Graphics

  + [GPUOpen Open Source Tools](https://gpuopen.com/)
  + [Documentation](https://gpuopen.com/learn/)

  [Partner Resources](#headerMenu-95dee59baf-item-1866eb47aa-collapse)

  ###### Overview

  + [Partner Hub Home](https://www.amd.com/en/partner.html)

  Â

  Â

  ###### Resources by Market Segment

  + [For Data Center Marketing Partners](/en/partner/market/data-center-partner-marketing.html)
  + [For PC Marketing Partners](/en/partner/market/pc-marketing-partners.html)

  ###### Resources by Product

  + [AMD Instinct](/en/partner/browse-by-product/instinct-resources.html)
  + [EPYC](/en/partner/browse-by-product/epyc-resources.html)
  + [Ryzen PRO](/en/partner/browse-by-product/ryzen-pro-resources.html)
  + [Ryzen](/en/partner/browse-by-product/ryzen-resources.html)
  + [Ryzen Threadripper](/en/partner/browse-by-product/ryzen-threadripper-resources.html)
  + [Radeon PRO](/en/partner/browse-by-product/radeon-pro-resources.html)
  + [Radeon](/en/partner/browse-by-product/radeon-resources.html)

  ###### Resources by Type

  + [Partner Enablement Doc Hub](/en/partner/browse-by-resource/partner-enablement-doc-hub.html)
  + [Partner Insights Articles](/en/partner/browse-by-resource/partner-insights-articles.html)
  + [AMD Arena Training](/en/partner/browse-by-resource/amd-arena-training.html)
  + [Meet the Experts Webinars](/en/partner/browse-by-resource/meet-the-experts-webinars.html)
  + [Marketing Materials](/en/partner/browse-by-resource/marketing-materials.html)
  + [Partner FAQs](/en/partner/browse-by-resource/faqs.html)

  ###### About Our Partners

  + [Authorized Distributors](/en/partner/about-partners/authorized-distributors.html)
  + [Partner Motherboard Specifications](/en/partner/about-partners/motherboard-specifications.html)
  + [Partner Graphics Card Specifications](/en/partner/about-partners/graphics-card-specifications.html)

  [Support](#headerMenu-95dee59baf-item-498b9948f9-collapse)

  ###### AMD Global Support

  + [Support Home](https://www.amd.com/en/support.html)
  + [Technical Information Portal](https://docs.amd.com/)
  + [Warranty Services](https://www.amd.com/en/support/warranty.html)
  + [Product Specifications](https://www.amd.com/en/products/specifications.html)
  + [Product Security (PSIRT)](https://www.amd.com/en/resources/product-security.html)

  ###### Processors & Graphics

  + [Product Support](https://www.amd.com/en/forms/contact-us/support.html)
  + [Knowledge Base](https://www.amd.com/en/resources/support-articles/knowledge-base-search.html)
  + [Technical & Warranty Help](https://www.amd.com/en/support.html)
  + [Support Forums](https://community.amd.com/t5/support-forums/ct-p/supprtforums)
  + [Drivers & Software Downloads](https://www.amd.com/en/support/download/drivers.html)

  ###### Accelerators

  + [Alveo Product Support](https://adaptivesupport.amd.com/s/?language=en_US)
  + [Pensando Product Support](https://www.amd.com/en/support/accelerators/pensando.html)

  Â

  ###### Adaptive SoCs & FPGAs

  + [Product Support](https://adaptivesupport.amd.com/)
  + [Knowledge Base](https://adaptivesupport.amd.com/s/knowledge-base)
  + [Community Forums](https://adaptivesupport.amd.com/s/topiccatalog)
  + [Design Hubs](https://docs.amd.com/p/design-hubs)
  + [Product Return](https://www.xilinx.com/support/quality/product-return.html)
* Shop
   Shop AMD

  [Shop AMD](#headerMenu-2240f775fe-item-de1bf49851-collapse)

  ###### Gaming & Personal Computing

  + [Ryzen Processors](https://shop-us-en.amd.com/processors)
  + [Radeon Graphics Cards](https://shop-us-en.amd.com/graphics-cards)
  + [Promotions & Bundles](https://shop-us-en.amd.com/amd-promotions/)
  + [Shop All](https://shop-us-en.amd.com/)

  ###### Adaptive & Embedded Computing

  + [System-on-Modules (SOMs)](https://shop-us-en.amd.com/adaptive-embedded-computing/system-on-modules/)
  + [Data Center Accelerator Cards](https://shop-us-en.amd.com/adaptive-embedded-computing/data-center-accelerator-cards/)
  + [Adaptive SoC & FPGA Evaluation Kits](https://shop-us-en.amd.com/adaptive-embedded-computing/soc-fpga-evaluation-kits/)

  ###### Get AMD Fan Gear

  + [Visit the Store](https://amdfanstore.com/)

  ###### Shop Our Retail Partners

  + [Ryzen Processors](/en/where-to-buy/processors/ryzen.html)
  + [Radeon Graphics Cards](/en/where-to-buy/graphics/radeon.html)
  + [Advantage Laptops](https://www.amd.com/en/gaming/laptops/advantage-premium.html)
  + [Advantage Desktops](https://www.amd.com/en/gaming/desktops/advantage-premium.html)
  + [Gaming Handhelds](https://www.amd.com/en/gaming/handhelds.html)

* + [My Account](https://account.amd.com/en/profile.html)
  + [Create Account](https://www.amd.com/en/registration/create-account.html)

* + [English](/en/resources/product-security/bulletin/amd-sb-3008.html)
  + [ç®ä½ä¸­æ](/zh-cn.html)
  + [ç¹é«ä¸­æ](/zh-tw.html)
  + [FranÃ§ais](/fr.html)
  + [Deutsch](/de.html)
  + [æ¥æ¬èª](/ja.html)
  + [íêµ­ì´](/ko.html)
  + [PortuguÃªs](/pt.html)
  + [EspaÃ±ol](/es.html)

ON THIS PAGE

* [Summary](#summary)
* [References](#references)
* [Acknowledgment](#acknowledgement)
* [Revisions](#revisions)

[Back to Security Bulletins and Briefs](/en/resources/product-security.html)
# Disrupting AMD SEV-SNP on LinuxÂ® With Interrupts

**AMD ID:**â¯â¯â¯â¯AMD-SB-3008

**Potential Impact:**Â N/A

**Severity:**Â N/A

## Summary

Researchers from ETH Zurich have shared with AMD a paper titled âHeckler: Disrupting AMD SEV-SNP with Interrupts.â

In their paper, the researchers report that a malicious hypervisor can potentially break confidentiality and integrity of LinuxÂ® SEV-SNP guests by injecting interrupts.Â

AMD believes that this vulnerability lies in the LinuxÂ® kernel implementation of SEV-SNP and mitigations addressing some of the vulnerability issues have been upstreamed to the main Linux kernel. Please refer to upstream kernel commit IDs f35e46631b28 ("Merge tag 'x86-int80-20231207' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip") and e3ef461af35a ("x86/sev: Harden #VC instruction emulation somewhat") "Â

AMD supports additional hardware security features that are designed to protect against the reported attack that are not currently supported in LinuxÂ®. The relevant features are described in AMD64 Architecture Programmerâs Manual Volume 2, Section 15.36.16.

<https://www.amd.com/content/dam/amd/en/documents/processor-tech-docs/programmer-references/24593.pdf>

Please refer to your LinuxÂ® provider for guidance.

CVE-2024-25742, CVE-2024-25743, CVE-2024-25744 has been assigned by CERT/CC.

## References

[https://www.amd.com/content/dam/amd/en/documents/processor-tech-docs/programmer-references/24593.pdf](/content/dam/amd/en/documents/processor-tech-docs/programmer-references/24593.pdf)

## Acknowledgement

AMD thanks Benedict SchlÃ¼ter, Supraja Sridhara, Mark Kuhne, Andrin Bertschi, and Shweta Shinde of ETH Zurich for reporting this issue and engaging in coordinated vulnerability disclosure.

## Revisionsâ¯

| Revision Dateâ¯ | Descriptionâ¯ |
| --- | --- |
| 2024-04-05 | Initial publicationâ¯ |

DISCLAIMER

The information contained herein is for informational purposes only and is subject to change without notice. While every precaution has been taken in the preparation of this document, it may contain technical inaccuracies, omissions and typographical errors, and AMD is under no obligation to update or otherwise correct this information. Advanced Micro Devices, Inc. makes no representations or warranties with respect to the accuracy or completeness of the contents of this document, and assumes no liability of any kind, including the implied warranties of noninfringement, merchantability or fitness for particular purposes, with respect to the operation or use of AMD hardware, software or other products described herein. Any computer system has risks of security vulnerabilities that cannot be completely prevented or mitigated. No license, including implied or arising by estoppel, to any intellectual property rights is granted by this document. Terms and limitations applicable to the purchase or use of AMDâs products are as set forth in a signed agreement between the parties or in AMD's Standard Terms and Conditions of Sale.

AMD, the AMD Arrow logo, and combinations thereof are trademarks of Advanced Micro Devices, Inc. CVE and the CVE logo are registered trademarks of The MITRE Corporation. LinuxÂ® is the registered trademark of Linus Torvalds in the U.S. and other countries. Other product names used in this publication are for identification purposes only and may be trademarks of their respective companies.

Third party content may be licensed to you directly by the third party that owns the content and is not licensed to you by AMD. ALL LINKED THIRD-PARTY CONTENT IS PROVIDED âAS ISâ WITHOUT A WARRANTY OF ANY KIND. USE OF SUCH THIRD-PARTY CONTENT IS DONE AT YOUR SOLE DISCRETION AND UNDER NO CIRCUMSTANCES WILL AMD BE LIABLE TO YOU FOR ANY THIRD-PARTY CONTENT. YOU ASSUME ALL RISK AND ARE SOLELY RESPONSIBILITY FOR ANY DAMAGES THAT MAY ARISE FROM YOUR USE OF THIRD-PARTY CONTENT.

Â© 2024 Advanced Micro Devices, Inc. All rights reserved.

[Subscribe to the latest news from AMD](/en/preferences/sign-up.html)

* [Facebook](http://www.facebook.com/amd)
* [Instagram](https://www.instagram.com/amd)
* [Linkedin](https://www.linkedin.com/company/amd)
* [Twitch](https://www.twitch.tv/amd)
* [Twitter](https://twitter.com/amd)
* [Youtube](https://www.youtube.com/user/amd?sub_confirmation=1)
* [Subscriptions](https://www.amd.com/en/preferences.html)

###### [Company](#!)

* [About AMD](/en/corporate.html)
* [Management Team](/en/corporate/leadership.html)
* [Corporate Responsibility](/en/corporate/corporate-responsibility.html)
* [Careers](https://careers.amd.com/careers-home)
* [Contact Us](/en/corporate/contacts.html)

###### [News & Events](#!)

* [Newsroom](/en/newsroom.html)
* [Events](https://www.amd.com/en/corporate/events.html)
* [Media Library](/en/newsroom/media-library.html)

###### [Community](#!)

* [Developer Central](https://www.amd.com/en/developer.html)
* [Blogs](https://community.amd.com/t5/blogs/ct-p/amd-blogs)
* [Forums](https://community.amd.com/)
* [AI Forum](https://community.amd.com/t5/ai-discussions/bd-p/amd-ai-discussions)
* [Red Team](https://community.amd.com/t5/red-team/ct-p/red-team)

###### [Partners](#!)

* [AMD Partner Hub](https://www.amd.com/en/partner.html)
* [Partner Resource Library](https://www.amd.com/en/partner/resources/resource-library.html)
* [Authorized Distributors](https://www.amd.com/en/partner/resources/distributors.html)
* [AMD University Program](https://www.amd.com/en/corporate/university-program.html)

###### [Investors](#!)

* [Investor Relations](https://ir.amd.com/)
* [Financial Information](https://ir.amd.com/financial-information)
* [Board of Directors](https://ir.amd.com/leadership-governance/board-of-directors)
* [Governance Documents](https://ir.amd.com/leadership-governance/governance-documents)
* [SEC Filings](https://ir.amd.com/sec-filings)

* [Terms and Conditions](/en/legal/copyright.html)
* [Privacy](/en/legal/privacy.html)
* [Trademarks](/en/legal/trademarks.html)
* [Supply Chain Transparency](https://www.amd.com/content/dam/amd/en/documents/corporate/cr/supply-chain-transparency.pdf)
* [Fair & Open Competition](/en/legal/competition.html)
* [UK Tax Strategy](https://www.amd.com/content/dam/amd/en/documents/corporate/amd-uk-tax-strategy.pdf)
* [Cookies Policy](/en/legal/cookies.html)
* [Cookie Settings](#cookiessettings)

Â© 2025 Advanced Micro Devices, Inc.



=== Content from git.kernel.org_a9b18a33_20250110_173810.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Borislav Petkov (AMD) <bp@alien8.de> | 2024-01-05 11:14:07 +0100 |
| --- | --- | --- |
| committer | Borislav Petkov (AMD) <bp@alien8.de> | 2024-01-29 17:08:22 +0100 |
| commit | [e3ef461af35a8c74f2f4ce6616491ddb355a208f](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)) | |
| tree | [105ccfe4c6c6774dfde29111f36ae23427f69227](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f) | |
| parent | [41bccc98fb7931d63d03f326a746ac4d429c1dd3](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=41bccc98fb7931d63d03f326a746ac4d429c1dd3) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f&id2=41bccc98fb7931d63d03f326a746ac4d429c1dd3)) | |
| download | [linux-e3ef461af35a8c74f2f4ce6616491ddb355a208f.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-e3ef461af35a8c74f2f4ce6616491ddb355a208f.tar.gz) | |

x86/sev: Harden #VC instruction emulation somewhatCompare the opcode bytes at rIP for each #VC exit reason to verify the
instruction which raised the #VC exception is actually the right one.
Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Acked-by: Tom Lendacky <thomas.lendacky@amd.com>
Link: [https://lore.kernel.org/r/20240105101407.11694-1-bp@alien8.de](https://lore.kernel.org/r/20240105101407.11694-1-bp%40alien8.de)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)

| -rw-r--r-- | [arch/x86/boot/compressed/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/boot/compressed/sev.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/x86/kernel/sev-shared.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/kernel/sev-shared.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f) | 102 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/x86/kernel/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/kernel/sev.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f) | 5 | |  |  |  | | --- | --- | --- | |

3 files changed, 108 insertions, 3 deletions

| diff --git a/arch/x86/boot/compressed/sev.c b/arch/x86/boot/compressed/sev.cindex 454acd7a2dafff..073291832f44d2 100644--- a/[arch/x86/boot/compressed/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/boot/compressed/sev.c?id=41bccc98fb7931d63d03f326a746ac4d429c1dd3)+++ b/[arch/x86/boot/compressed/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/boot/compressed/sev.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)@@ -304,6 +304,10 @@ void do\_boot\_stage2\_vc(struct pt\_regs \*regs, unsigned long exit\_code) if (result != ES\_OK) goto finish; + result = vc\_check\_opcode\_bytes(&ctxt, exit\_code);+ if (result != ES\_OK)+ goto finish;+ switch (exit\_code) { case SVM\_EXIT\_RDTSC: case SVM\_EXIT\_RDTSCP:diff --git a/arch/x86/kernel/sev-shared.c b/arch/x86/kernel/sev-shared.cindex 1d24ec6799157b..5db24d0fc557cd 100644--- a/[arch/x86/kernel/sev-shared.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kernel/sev-shared.c?id=41bccc98fb7931d63d03f326a746ac4d429c1dd3)+++ b/[arch/x86/kernel/sev-shared.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kernel/sev-shared.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)@@ -10,11 +10,15 @@ \*/  #ifndef \_\_BOOT\_COMPRESSED-#define error(v) pr\_err(v)-#define has\_cpuflag(f) boot\_cpu\_has(f)+#define error(v) pr\_err(v)+#define has\_cpuflag(f) boot\_cpu\_has(f)+#define sev\_printk(fmt, ...) printk(fmt, ##\_\_VA\_ARGS\_\_)+#define sev\_printk\_rtl(fmt, ...) printk\_ratelimited(fmt, ##\_\_VA\_ARGS\_\_) #else #undef WARN #define WARN(condition, format...) (!!(condition))+#define sev\_printk(fmt, ...)+#define sev\_printk\_rtl(fmt, ...) #endif  /\* I/O parameters for CPUID-related helpers \*/@@ -574,6 +578,7 @@ void \_\_init do\_vc\_no\_ghcb(struct pt\_regs \*regs, unsigned long exit\_code) { unsigned int subfn = lower\_bits(regs->cx, 32); unsigned int fn = lower\_bits(regs->ax, 32);+ u16 opcode = \*(unsigned short \*)regs->ip; struct cpuid\_leaf leaf; int ret; @@ -581,6 +586,10 @@ void \_\_init do\_vc\_no\_ghcb(struct pt\_regs \*regs, unsigned long exit\_code) if (exit\_code != SVM\_EXIT\_CPUID) goto fail; + /\* Is it really a CPUID insn? \*/+ if (opcode != 0xa20f)+ goto fail;+ leaf.fn = fn; leaf.subfn = subfn; @@ -1170,3 +1179,92 @@ static int vmgexit\_psc(struct ghcb \*ghcb, struct snp\_psc\_desc \*desc) out: return ret; }++static enum es\_result vc\_check\_opcode\_bytes(struct es\_em\_ctxt \*ctxt,+ unsigned long exit\_code)+{+ unsigned int opcode = (unsigned int)ctxt->insn.opcode.value;+ u8 modrm = ctxt->insn.modrm.value;++ switch (exit\_code) {++ case SVM\_EXIT\_IOIO:+ case SVM\_EXIT\_NPF:+ /\* handled separately \*/+ return ES\_OK;++ case SVM\_EXIT\_CPUID:+ if (opcode == 0xa20f)+ return ES\_OK;+ break;++ case SVM\_EXIT\_INVD:+ if (opcode == 0x080f)+ return ES\_OK;+ break;++ case SVM\_EXIT\_MONITOR:+ if (opcode == 0x010f && modrm == 0xc8)+ return ES\_OK;+ break;++ case SVM\_EXIT\_MWAIT:+ if (opcode == 0x010f && modrm == 0xc9)+ return ES\_OK;+ break;++ case SVM\_EXIT\_MSR:+ /\* RDMSR \*/+ if (opcode == 0x320f ||+ /\* WRMSR \*/+ opcode == 0x300f)+ return ES\_OK;+ break;++ case SVM\_EXIT\_RDPMC:+ if (opcode == 0x330f)+ return ES\_OK;+ break;++ case SVM\_EXIT\_RDTSC:+ if (opcode == 0x310f)+ return ES\_OK;+ break;++ case SVM\_EXIT\_RDTSCP:+ if (opcode == 0x010f && modrm == 0xf9)+ return ES\_OK;+ break;++ case SVM\_EXIT\_READ\_DR7:+ if (opcode == 0x210f &&+ X86\_MODRM\_REG(ctxt->insn.modrm.value) == 7)+ return ES\_OK;+ break;++ case SVM\_EXIT\_VMMCALL:+ if (opcode == 0x010f && modrm == 0xd9)+ return ES\_OK;++ break;++ case SVM\_EXIT\_WRITE\_DR7:+ if (opcode == 0x230f &&+ X86\_MODRM\_REG(ctxt->insn.modrm.value) == 7)+ return ES\_OK;+ break;++ case SVM\_EXIT\_WBINVD:+ if (opcode == 0x90f)+ return ES\_OK;+ break;++ default:+ break;+ }++ sev\_printk(KERN\_ERR "Wrong/unhandled opcode bytes: 0x%x, exit\_code: 0x%lx, rIP: 0x%lx\n",+ opcode, exit\_code, ctxt->regs->ip);++ return ES\_UNSUPPORTED;+}diff --git a/arch/x86/kernel/sev.c b/arch/x86/kernel/sev.cindex c67285824e8267..1ec753331524ab 100644--- a/[arch/x86/kernel/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kernel/sev.c?id=41bccc98fb7931d63d03f326a746ac4d429c1dd3)+++ b/[arch/x86/kernel/sev.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kernel/sev.c?id=e3ef461af35a8c74f2f4ce6616491ddb355a208f)@@ -1752,7 +1752,10 @@ static enum es\_result vc\_handle\_exitcode(struct es\_em\_ctxt \*ctxt, struct ghcb \*ghcb, unsigned long exit\_code) {- enum es\_result result;+ enum es\_result result = vc\_check\_opcode\_bytes(ctxt, exit\_code);++ if (result != ES\_OK)+ return result;  switch (exit\_code) { case SVM\_EXIT\_READ\_DR7: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:36:48 +0000


