=== Content from borelenzo.github.io_2a96c0e2_20250110_132506.html ===

## Skip links

* [Skip to primary navigation](#site-nav)
* [Skip to content](#main)
* [Skip to footer](#footer)

[![](/assets/res/avatar.png)](/)
[Testeur de stylos](/)

* [Research](/stuff.html)
* [Mutants](/mutant.html)
* [Malwares](/malwares.html)
* [Android Accessibility Service](/android.html)
* [Attacking mobile browsers with extensions](/thesis.html)

Toggle menu

###

Follow

# CVE-2024-27937 - CVE-2024-27930 - Walkthrough

I was recently tasked with auditing the application [GLPI](https://github.com/glpi-project), a few days after its latest release (10.0.12 at the time of writing). The latter stands for *Gestionnaire Libre de Parc Informatique*, and is a french software solution meant to manage various assets, such as machines, software, or licenses.

Since GLPI is a free piece of software, I decided to install my own local instance, and I have to admit, it was really straightforward. After a few minutes, I had it running on a fresh Ubuntu server VM. After a few days of research, a pair of vulnerabilities finally came to light: as a low-privileged user, it was possible to take over the super-adminâ€™s account.

## A first oddity

By using the built-in `post-only` account, features are quite limited. This account is only allowed to create tickets, but is not supposed to enumerate others users nor to see advanced settings.

![Create ticket in GLPI](/assets/res/stuff/glpi/glpi_new_ticket.png)

However, one can notice a first interesting thing by creating a new ticket, and trying to add watchers: an AJAX call is made to `/ajax/actors.php`, returning details about existing users and groups (while the `Users` menu was not available to this user) â€¦

![Dropdown with existing users](/assets/res/stuff/glpi/glpi_enum_users.png)

![Get users in tenant 0](/assets/res/stuff/glpi/glpi_tenant0.png)

One can see that the query contains a parameter named `entity_restrict`. If the application is used to manage multiple entities (kind of tenants), it can be abused to enumerate the users of another one, which is not supposed to be permitted. For instance, resending the same request with the `entity_restrict` equal to 1 would return additional users, belonging to another entity. This issue is tracked as CVE-2024-27937.

![Get users of tenant 1](/assets/res/stuff/glpi/glpi_tenant1.png)

By taking a look at the source code of `/ajax/actors.php`, one can see that such AJAX call would eventually trigger the function `User::getSqlSearchResult`, but only the following fields are returned to the user:

```
$results[] = [
    'id'                => "User_$ID",
    'text'              => $text,
    'title'             => sprintf(__('%1$s - %2$s'), $text, $user['name']),
    'itemtype'          => "User",
    'items_id'          => $ID,
    'use_notification'  => strlen($user['default_email'] ?? "") > 0 ? 1 : 0,
    'default_email'     => $user['default_email'],
    'alternative_email' => '',
];

```

Interesting, because one could therefore leak personal details of other users, but not sufficient ![:grin:](https://github.githubassets.com/images/icons/emoji/unicode/1f601.png ":grin:")

## Dropdowns

GLPI creates numerous relationships between objects, with `User`s creating `Ticket`s about `Computer`s, pieces of `Software`, etc. The application therefore heavily relies on *dropdown list* widgets to make it easy, the latter being populated based on the requested object types and userâ€™s rights. For instance, the `/ajax` folder contains the following scripts, meant to build such widgets:

* `getDropdownFindNum.php`
* `dropdownMassiveActionAddActor.php`
* `dropdownProjectTaskTicket.php`
* `getDropdownUsers.php`
* `dropdownValidator.php`
* `dropdownShowIPNetwork.php`
* `dropdownNotificationEvent.php`
* `dropdownMassiveActionAuthMethods.php`
* `dropdownConnectNetworkPort.php`
* `dropdownConnectNetworkPortDeviceType.php`
* `getDropdownConnect.php`
* `dropdownMassiveAction.php`
* `getDropdownNumber.php`
* `dropdownAllItems.php`
* `dropdownMassiveActionField.php`
* `dropdownUnicityFields.php`
* `getShareDashboardDropdownValue.php`
* `dropdownSoftwareLicense.php`
* `dropdownInstallVersion.php`
* `dropdownMassiveActionOs.php`
* `dropdownTrackingDeviceType.php`
* `dropdownTicketCategories.php`
* `dropdownFieldsBlacklist.php`
* `dropdownNotificationTemplate.php`
* `dropdownTypeCertificates.php`
* `dropdownLocation.php`
* `getAbstractRightDropdownValue.php`
* `dropdownValuesBlacklist.php`
* `dropdownMassiveActionAddValidator.php`
* `dropdownDelegationUsers.php`
* `dropdownConnect.php`
* `getDropdownValue.php`
* `dropdownRubDocument.php`
* `dropdownItilActors.php`

These scripts call routines of the class `Dropdown`, which is meant to *Print out an HTML â€œ<select>â€ for a dropdown with preselected value*, as said by a comment in the aforementionned class. Normally, these routines are supposed to only display specific types of objects, for example (in `dropdownLocation.php`) this one with `Location` instances:

```
echo Location::dropdown([
    'value'        => $locations_id,
    'entity'       => $entities_id,
    'entity_sons'  => $is_recursive,
]);

```

But what if we could ask for a dropdown containing arbitrary objects ?

## A suspicious parameter

GLPI offers a lot of menus, and I quickly got overwhelmed by the huge amount of requests that my browser sent. However, a request caught my attention, while trying to link a ticket to another one:

![Link a ticket to another](/assets/res/stuff/glpi/glpi_link_ticket.png)

![Request to enumerate the tickets](/assets/res/stuff/glpi/glpi_link_ticket1.png)

This request seemed to return a set of objects (`Ticket`) with some parameters. Interestingly enough, the field `id`, specified with the parameter `displaywith`, is returned in the answer. It really sounds like an SQL-query-as-a-service, so what if one asks for the item type `User`, displayed with the field `password` ?

The file `/ajax/getdropdownValue.php` is as follows, forwarding the POSTâ€™ed data to `Dropdown::getDropdownValue`:

![Code of getdropdownValue.php](/assets/res/stuff/glpi/glpi_getdropdownvalue.png)

![Code of getdropdownValue.php - 1](/assets/res/stuff/glpi/glpi_dropdown_1.png)

A first check against what is named an *IDOR token* is made (line 2â€™619), and if everything goes well, a new object is created based on the advertised `itemtype`. If the parameter `displaywith` exists, then it persists inside the `$post` array, and instructs the function to include specific additional fields in the response. By reading the code thoroughly, one can realise that the POSTâ€™ed data are used to build the query without checking the access rights regarding the expected table. So normally, I should have been able to enumerate the table `glpi_users` and ask for any field in this table, but obvisouly, there was a catch â€¦

*N.B. the value of `itemtype` is not exactly the name of a DB table. It is supposed to be the name of a PHP class, inherited from the class `CommonDBTM`. Each child class is supposed to have its matching DB table, therefore one should set it to `User` (the PHP class) to read from the table `glpi_users` (or equivalent).*

## A strange protection mechanism

To make it work, the request must be authenticated, and this is done with the cookies. Moreover, AJAX calls made through POST need to contain the header `X-Glpi-Csrf-Token`. The appropriate value can be found in the `meta` tag `glpi:csrf_token`, in HTML pages returned by the application:

```
<meta property="glpi:csrf_token" content="1fed5029e3d6a73af3352791f7ecff41e79c7644cbd89cf41d1b3e46e6ca99b6">

```

One important thing to notice is that dropdown lists are not directly written inside the HTML pages returned by the server. Instead, a piece of JavaScript code is returned, that would retrieve on-demand the list of the objects to display, and populate the dropdown lists. Therefore, an additional parameter named `_idor_token` must be put in the request body sent by JavaScript, in order to prevent from unauthorised access (hence the call to `validatIDOR`). The idea is that an *IDOR token* is tied to an object type, a set of rights, an entity, and for a limited time. Multiple `_idor_tokens` can be found in a page (one per dropdown list), and for instance, a first one is used to get the list of the tickets, another one for the list of the users, and another one for the list of the machines.

Different ways exist to obtain an IDOR token, and they can be found by searching for calls to `Session::getNewIDORToken` in the source code. One of them is done in `User::dropdown`, which can be called from `/ajax/dropdownValidator.php`.

![Code to get token for users](/assets/res/stuff/glpi/glpi_get_token_user.png)

In the response, one can see that an IDOR token to enumerate users is returned. However, querying the endpoint `/ajax/getdropdownValue.php` by specifying the parameter `_idor_token` and `itemtype` does not work, and returns a blank page. By debugging the programme, one can realise that it is because of a failing check during the IDOR token validation.

![Get a first IDOR token](/assets/res/stuff/glpi/glpi_idor_1.png)

![Use first IDOR token, not working](/assets/res/stuff/glpi/glpi_idor_2.png)

To investigate and get clues about what was going wrong, I added a few lines in the file `src/Session.php` to print the current state of each IDOR token (not the cleanest way to debug, but easier and sufficient enough):

![Debugging Session::validateIDOR](/assets/res/stuff/glpi/glpi_idor_3.png)

![Debug log file](/assets/res/stuff/glpi/glpi_idor_4.png)

By taking a look at the debug log, one can realise that the expected token is tied to an associative array with the keys `itemtype`, `right` and `entity_restrict` while our token only contains `itemtype`. I then asked for a new token, with the expected claims:

![Obtain complete token](/assets/res/stuff/glpi/glpi_idor_5.png)

![Enumerate users with valid toen](/assets/res/stuff/glpi/glpi_idor_6.png)

*N.B: note that the names of the POST parameters and the keys of the expected elements in the array of IDOR tokens are not the same, but this is how it works. To have an appropriate `entity_restrict`, the POST parameter to set in the first request is `entity`.*

Now, by setting the parameter `displaywith[]=password` (can be specified multiple times), one can therefore extract all the hashes from the database. However, there can be hashed with bcrypt, and if they are strong enough, they might be uncrackable.

![Get passwords hashes](/assets/res/stuff/glpi/glpi_get_passwords.png)

Yay ![:smile:](https://github.githubassets.com/images/icons/emoji/unicode/1f604.png ":smile:")

Another way to abuse such feature and compromise an account is to extract email addresses (first vulnerability), and ask for a password reset. The token would be stored as `password_forget_token` in the DB. The emails addresses are not stored in the same table, but as we saw at the beginning while requesting `/ajax/actors.php`, they can be easily obtained.

## Ask for any table

Since IDOR tokens are tied to an item type, one needs to obtain a valid one for each DB table. So far, it was possible because the script `/ajax/dropdownValidator.php` could return a piece of code to retrieve the list of the users, but what if we want to dump the content of the table `glpi_configs` ? A more generic way to obtain tokens exists, because of an arbitrary object creation. Letâ€™s take `/ajax/cable.php` as an example (not the only one):

![Source code /ajax/cable.php to get any token](/assets/res/stuff/glpi/glpi_get_token_any.png)

The item type is taken right from `$_POST["itemtype"]`, and the static routine `dropdown` is called on the advertised class, meaning that any child of `CommonDBTM` could be enumerated. To begin with, a request can be sent to `/ajax/cable.php`, specifying the appropriate `action` and `itemtype` parameters:

![Get an IDOR token for user, arbitrary - 1 ](/assets/res/stuff/glpi/glpi_any_token_for_user1.png)

![Get an IDOR token for user, arbitrary - 2](/assets/res/stuff/glpi/glpi_any_token_for_user2.png)

In the first request, one can see that application returns a token alongside the attributes `right=id` and `entity_restrict=-1`. In the second request, these attributes must match, otherwise nothing is returned.

Now, letâ€™s retry it with the table `glpi_configs`:

![Get an IDOR token for configs -1 ](/assets/res/stuff/glpi/glpi_any_token_for_configs1.png)

![Get an IDOR token for configs - 2](/assets/res/stuff/glpi/glpi_any_token_for_configs2.png)

This issue is tracked as CVE-2024-27930.

## So what ?

In a real world scenario, an attacker might try to enumerate the email addresses to find the adminâ€™s one, ask for a password reset link, and abuse the second vulnerability to recover it. Once connected as super admin, there is a plenty of interesting things to do. I guess that one of the most straightforward ways to RCE is to add a plugin, like [shellcommands](https://github.com/InfotelGLPI/shellcommands).

The issues were reported to the vendor and patched in a few days. Letâ€™s note that the description for CVE-2024-27930 was registered as:

> GLPI is a Free Asset and IT Management Software package, Data center management, ITIL Service Desk, licenses tracking and software auditing. An authenticated user can access sensitive fields data from items on which he has read access. This issue has been patched in version 10.0.13.

This is not entirely true, since an authenticated user can access any type of object (child of `CommonDBTM`), regardless of their privileges.

* [**2024** 4](#2024)
* [**2023** 13](#2023)
* [**2020** 12](#2020)

## 2024

## [Exploiting CVE-2024-37148](/stuff/2024/06/07/exploit-CVE-2024-37148.html)

3 minute read

Intro
When it comes to input sanitisation, who is responsible, the function or the caller ? Or both ? And if no one does, hoping that the other one will do t...

## [Exploiting CVE-2024-29889 and CVE-2024-31456](/stuff/2024/05/09/exploit-CVE-2024-29889-31456.html)

6 minute read

Intro
After being tasked with auditing GLPI 10.0.12, for which I uncovered two unknown vulnerabilities (CVE-2024-27930 and CVE-2024-27937), I became really i...

## [Exploiting CVE-2024-27096](/stuff/2024/03/24/exploit-CVE-2024-27096.html)

7 minute read

Intro
A few weeks ago, I discovered during an intrusion test two vulnerabilities affecting GLPI 10.0.12, that was the latest public version at this time. The...

## [CVE-2024-27937 - CVE-2024-27930 - Walkthrough](/stuff/2024/02/29/glpi-pwned.html)

8 minute read

I was recently tasked with auditing the application GLPI, a few days after its latest release (10.0.12 at the time of writing). The latter stands for Gestion...

[Back to Top â†‘](#page-title)

## 2023

## [From SSRF to authentication bypass](/stuff/2023/12/28/jwt_iss.html)

4 minute read

I wonâ€™t insult you by explaining once again what JSON Web Tokens (JWTs) are, and how to attack them. A plethora of awesome articles exists on the Web, descri...

## [Hidden in plain sight - Part 2](/stuff/2023/11/05/hidden-in-plain-sight-2.html)

12 minute read

A few days ago, I published a blog post about PHP webshells, ending with a discussion about filters evasion by getting rid of the pattern $\_. The latter is c...

## [Hidden in plain sight](/stuff/2023/10/31/hidden-in-plain-sight.html)

11 minute read

A few thoughts about PHP webshells â€¦

## [Tiny File Manager - Thereâ€™s no place like home](/stuff/2023/09/27/tfm_localhost_bypass.html)

2 minute read

I remember this carpet, at the entrance of the Computer Science faculty, with this message Thereâ€™s no place like 127.0.0.1/8. A joke that would create two ca...

## [I want to talk to your managed code](/mutant/2023/08/06/mixed-code.html)

12 minute read

TL;DR
A few experiments about mixed managed/unmanaged assemblies. To begin with, we start by presenting a C# programme that hides a part of its payload in an...

## [Qakbot JScript dropper analysis](/malware/2023/07/09/qakbot-dropper.html)

11 minute read

It was a sunny and warm summer afternoon, and while normal people would rush to the beach, I decided to devote myself to one of my favourite activities: suff...

## [CVE-2023-3064, CVE-2023-3065, and CVE-2023-3066](/stuff/2023/06/02/cve-2023-3064_65_66.html)

3 minute read

The reader should first take a look at the articles related to CVE-2023-3032 and CVE-2023-3033 that I published a few days ago to get more context.

## [CVE-2023-3033](/stuff/2023/06/01/cve-2023-3033.html)

3 minute read

This walkthrough presents another vulnerability discovered on the Mobatime web application (see CVE-2023-3032, same version 06.7.2022 affected). This vulnera...

## [CVE-2023-3032](/stuff/2023/06/01/cve-2023-3032.html)

less than 1 minute read

Mobatime offers various time-related products, such as check-in solutions. In versions up to 06.7.2022, an arbitrary file upload allowed an authenticated use...

## [CVE-2023-3031](/stuff/2023/06/01/cve-2023-3031.html)

less than 1 minute read

King-Avis is a Prestashop module developed by Webbax. In versions older than 17.3.15, the latter suffers from an authenticated path traversal, leading to loc...

## [FuckFastCGI made simpler](/stuff/2023/02/05/php-ffcgi.html)

3 minute read

Letâ€™s render unto Caesar the things that are Caesarâ€™s, the exploit FuckFastCGI is not mine and is a brilliant one, bypassing open\_basedir and disable\_functio...

## [PHP .user.ini risks](/stuff/2023/02/01/php-ini.html)

7 minute read

I have to admit, PHP is not my favourite, but such powerful language sometimes really amazes me. Two days ago, I found a bypass of the directive open\_basedir...

## [PHP open\_basedir bypass](/stuff/2023/01/30/php-bug.html)

3 minute read

PHP is a really powerful language, and as a wise man once said, with great power comes great responsibilities. There is nothing more frustrating than obtaini...

[Back to Top â†‘](#page-title)

## 2020

## [Self modifying C program - Polymorphic](/mutant/2020/05/05/polymorphic1.html)

17 minute read

A few weeks ago, a good friend of mine asked me if it was possible to create such a program, as it could modify itself. After some thoughts, I answered that ...

## [Self modifying C program - Metamorphic (Basic)](/mutant/2020/05/05/metamorphic1.html)

16 minute read

In the previous article, I described how I wrote a simple polymorphic program. â€œPolymorphicâ€ means that the program (the binary) changes its appearance every...

## [Diving into Viking Horde - Android malware analysis](/malware/2020/05/05/viking-horde.html)

4 minute read

The malware presented in this blog post appeared on Google Play in 2016. I heard about it thanks to this article published on checkpoint.com.
The malicious a...

## [Diving into SLocker - Android malware analysis](/malware/2020/05/05/slocker.html)

7 minute read

Ransomwares are really interesting malwares because of their very specific purpose. Indeed, a ransomware will not necessarily try to be stealth or persistent...

## [Diving into Sberbank Android banker - Android malware analysis](/malware/2020/05/05/sberbank.html)

5 minute read

A few days ago, I found this article about a malware targeting Sberbank,
a big Russian bank. The app disguises itself as a web application, stealing in backg...

## [Diving into ruMMS - Android malware analysis](/malware/2020/05/05/rumms.html)

6 minute read

RuMMS is a malware targetting Russian users, distributed via websites as a file named mms.apk [1]. This article is inspired by this analysis made by FireEye
...

## [Diving into dsencrypt - Android malware analysis](/malware/2020/05/05/dsencrypt.html)

10 minute read

Could a 5-classes Android app be so harmful ? dsencrypt says â€œyesâ€â€¦

## [Attacking Android Accessibility Service (AAS) - Part IV](/android/2020/05/05/android4.html)

3 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part4.txt

## [Attacking Android Accessibility Service (AAS) - Part III](/android/2020/05/05/android3.html)

3 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part3.txt

## [Attacking Android Accessibility Service (AAS) - Part II](/android/2020/05/05/android2.html)

5 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part2.txt

## [Attacking Android Accessibility Service (AAS) - Part I](/android/2020/05/05/android1.html)

5 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges.txt

## [Practical attacks against mobile browsers using extensions](/thesis/2020/05/01/thesis1.html)

17 minute read

Even if the thesis introduces the extensions internals, and analyses the difference between mobile and desktop browsers in terms of likelihood, efficiency an...

[Back to Top â†‘](#page-title)

* [Feed](/feed.xml)

Â© 2024 Borel Enzo. Powered by [Jekyll](https://jekyllrb.com) & [Minimal Mistakes](https://mademistakes.com/work/minimal-mistakes-jekyll-theme/).



=== Content from github.com_79a26f06_20250110_132509.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Fsecurity%2Fadvisories%2FGHSA-82vv-j9pr-qmwq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Fsecurity%2Fadvisories%2FGHSA-82vv-j9pr-qmwq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=glpi-project%2Fglpi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[glpi-project](/glpi-project)
/
**[glpi](/glpi-project/glpi)**
Public

* [Notifications](/login?return_to=%2Fglpi-project%2Fglpi) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fglpi-project%2Fglpi)
* [Star
   4.4k](/login?return_to=%2Fglpi-project%2Fglpi)

* [Code](/glpi-project/glpi)
* [Issues
  141](/glpi-project/glpi/issues)
* [Pull requests
  92](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects
  0](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

Additional navigation options

* [Code](/glpi-project/glpi)
* [Issues](/glpi-project/glpi/issues)
* [Pull requests](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

# Sensitive fields access through dropdowns

Moderate

[cedric-anne](/cedric-anne)
published
GHSA-82vv-j9pr-qmwq
Mar 18, 2024

## Package

glpi
(glpi)

## Affected versions

>= 0.78

## Patched versions

10.0.13

## Description

### Impact

An authenticated user can access sensitive fields data from any items.

### Patches

Upgrade to 10.0.13.

### For more information

If you have any questions or comments about this advisory, mail us at glpi-security@ow2.org.

### Severity

Moderate

6.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N

### CVE ID

CVE-2024-27930

### Weaknesses

[CWE-285](/advisories?query=cwe%3A285)

### Credits

* [![@BorelEnzo](https://avatars.githubusercontent.com/u/16661226?s=40&v=4)](/BorelEnzo)
  [BorelEnzo](/BorelEnzo)
  Reporter

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_7e900f74_20250110_132509.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Freleases%2Ftag%2F10.0.13)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Freleases%2Ftag%2F10.0.13)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=glpi-project%2Fglpi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[glpi-project](/glpi-project)
/
**[glpi](/glpi-project/glpi)**
Public

* [Notifications](/login?return_to=%2Fglpi-project%2Fglpi) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fglpi-project%2Fglpi)
* [Star
   4.4k](/login?return_to=%2Fglpi-project%2Fglpi)

* [Code](/glpi-project/glpi/tree/10.0.13)
* [Issues
  141](/glpi-project/glpi/issues)
* [Pull requests
  92](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects
  0](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

Additional navigation options

* [Code](/glpi-project/glpi/tree/10.0.13)
* [Issues](/glpi-project/glpi/issues)
* [Pull requests](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

1. [Releases](/glpi-project/glpi/releases)
2. [10.0.13](/glpi-project/glpi/releases/tag/10.0.13)

# 10.0.13

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/glpi-project/glpi/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...10.0.13)

 Loading

[View all tags](/glpi-project/glpi/tags)

![@trasher](https://avatars.githubusercontent.com/u/224733?s=40&v=4)
[trasher](/trasher)
released this
13 Mar 08:30

Â·
[397 commits](/glpi-project/glpi/compare/10.0.13...10.0/bugfixes)
to 10.0/bugfixes
since this release

[10.0.13](/glpi-project/glpi/tree/10.0.13)

[`ba1f4be`](/glpi-project/glpi/commit/ba1f4be9d43f7ec193ef3401f11cc79efc24ca56)

## This is a security release, upgrading is recommended

[![Download it](https://camo.githubusercontent.com/04a4dfa9de7ea965ed2cb822bbf7a4a280e3cf481405a08636b593d7cc2ce8c1/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f31302e302e31332d444f574e4c4f41445f474c50492d677265656e2e7376673f6c6f676f3d706870266c6f676f436f6c6f723d7768697465267374796c653d666f722d7468652d6261646765)](https://github.com/glpi-project/glpi/releases/download/10.0.13/glpi-10.0.13.tgz)

This release fixes a few security issues that have been recently discovered. Update is **recommended!**

You can download the [GLPI 10.0.13 archive](https://github.com/glpi-project/glpi/releases/download/10.0.13/glpi-10.0.13.tgz) on GitHub.

You will find below the list of security issues fixed in this bugfixes version:

* [SECURITY - high] SQL Injection in through the search engine (CVE-2024-27096)
* [SECURITY - moderate] Blind SSRF using Arbitrary Object Instantiation (CVE-2024-27098)
* [SECURITY - moderate] Stored XSS in dashboards (CVE-2024-27104)
* [SECURITY - moderate] Reflected XSS in debug mode (CVE-2024-27914)
* [SECURITY - moderate] Sensitive fields access through dropdowns (CVE-2024-27930)
* [SECURITY - moderate] Users emails enumeration (CVE-2024-27937)

Also, here is a short list of main changes done in this version:

* [FIX] Error when creating a Ticket with SLA/OLA.
* [FIX] Weekly recurrent reservations creation does not work.

The [full changelog is available](https://github.com/glpi-project/glpi/milestone/65?closed=1) for more details.

We would like to thank all people who contributed to this new version and all those who contributes regularly to the GLPI project!

Regards.

 Assets
3

 Loading

 ðŸ‘
5
 beatwinthewave, Wantuilxavier, str1ker49, RomelSan, and CrowMash reacted with thumbs up emoji
 â¤ï¸
3
 erique-souza, stonebuzz, and Peterfilho reacted with heart emoji

All reactions

* ðŸ‘
  5 reactions
* â¤ï¸
  3 reactions

 8 people reacted

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_9b9d3904_20250110_132508.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Fcommit%2F1942b70b2422fff51822f6eb3af500c94760871e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Fcommit%2F1942b70b2422fff51822f6eb3af500c94760871e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=glpi-project%2Fglpi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[glpi-project](/glpi-project)
/
**[glpi](/glpi-project/glpi)**
Public

* [Notifications](/login?return_to=%2Fglpi-project%2Fglpi) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Fglpi-project%2Fglpi)
* [Star
   4.4k](/login?return_to=%2Fglpi-project%2Fglpi)

* [Code](/glpi-project/glpi)
* [Issues
  141](/glpi-project/glpi/issues)
* [Pull requests
  92](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects
  0](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

Additional navigation options

* [Code](/glpi-project/glpi)
* [Issues](/glpi-project/glpi/issues)
* [Pull requests](/glpi-project/glpi/pulls)
* [Actions](/glpi-project/glpi/actions)
* [Projects](/glpi-project/glpi/projects)
* [Security](/glpi-project/glpi/security)
* [Insights](/glpi-project/glpi/pulse)

## Commit

[Permalink](/glpi-project/glpi/commit/1942b70b2422fff51822f6eb3af500c94760871e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-82vv-j9pr-qmwq](https://github.com/glpi-project/glpi/security/advisories/GHSA-82vv-j9pr-qmwq "GHSA-82vv-j9pr-qmwq")

[Browse files](/glpi-project/glpi/tree/1942b70b2422fff51822f6eb3af500c94760871e)
Browse the repository at this point in the history

```
* Check `displaywith` and `condition` in IDOR tokens

* Restrict AJAX endpoints to central interface

* Better filtering of sensitive fields
```

* Loading branch information

[![@cedric-anne](https://avatars.githubusercontent.com/u/33253653?s=40&v=4)](/cedric-anne)

[cedric-anne](/glpi-project/glpi/commits?author=cedric-anne "View all commits by cedric-anne")
authored
Mar 13, 2024

1 parent
[69e0dee](/glpi-project/glpi/commit/69e0dee8de0c0df139b42dbfa1a8997888c2af95)

commit 1942b70

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**331 additions**
and
**50 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* ajax

  + ajax/cable.php
    [cable.php](#diff-b2c0ea0172d0294b5b9168afd150003e884c9874676bd57170504d900d309ef7)
  + ajax/dropdownAllItems.php
    [dropdownAllItems.php](#diff-4f19b31cd53ba10fd77d6c529b4e814e299266062add8d6d744f387b95c00442)
  + ajax/socket.php
    [socket.php](#diff-afd7368052fc7f57413aa9bb801862381dfbecb1ae5fd10b0c1ad94539d840e2)
  + ajax/visibility.php
    [visibility.php](#diff-f7a3b7f66713d40841b3ee866a9664c4889cef16c5d01b4e3da407a1df68130a)
* src

  + src/Dropdown.php
    [Dropdown.php](#diff-a116d97698d0d2c01f95a28d8c46ceeb51e3bddecf90f0017a98654a891fdec7)
  + src/Session.php
    [Session.php](#diff-2ba5884bab6c9e8a5ee8ea4740bbb6d0c44f4340e4b86d532c7a0f36f17d2c25)
* templates/components/itilobject/actors

  + templates/components/itilobject/actors/field.html.twig
    [field.html.twig](#diff-e71c627002b9d0a29b90666e3a68b108189c36af589b5c4414c542e41f89188e)
* tests/functional

  + tests/functional/Dropdown.php
    [Dropdown.php](#diff-ec145215cd26c7cf5f4e3c6f5f0d921d8b0bc65980872568ace50375867c3ec5)
  + tests/functional/Session.php
    [Session.php](#diff-e8366b512ab8a1ede70bd6be5ab80b2d38083e9f4367c5aa80b1822e29a9b06b)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -18,6 +18,7 @@ The present file will list all changes made to the project; according to the |
|  |  | #### Added |
|  |  |  |
|  |  | #### Changes |
|  |  | - `condition` and `displaywith` parameters must now be added in IDOR token creation data when they are not empty. |
|  |  |  |
|  |  | #### Deprecated |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[ajax/cable.php](#diff-b2c0ea0172d0294b5b9168afd150003e884c9874676bd57170504d900d309ef7 "ajax/cable.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/ajax/cable.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -43,7 +43,7 @@ |
|  |  | // Send UTF8 Headers |
|  |  | header("Content-Type: text/html; charset=UTF-8"); |
|  |  | Html::header\_nocache(); |
|  |  | Session::checkLoginUser(); |
|  |  | Session::checkCentralAccess(); |
|  |  |  |
|  |  | $action = $\_POST['action'] ?? $\_GET["action"]; |
|  |  |  |
| Expand Down | |  |

16 changes: 11 additions & 5 deletions

16
[ajax/dropdownAllItems.php](#diff-4f19b31cd53ba10fd77d6c529b4e814e299266062add8d6d744f387b95c00442 "ajax/dropdownAllItems.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/ajax/dropdownAllItems.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -56,22 +56,27 @@ |
|  |  |  |
|  |  | $field\_id = Html::cleanId("dropdown\_" . $\_POST["name"] . $rand); |
|  |  |  |
|  |  | $p = [ |
|  |  | $displaywith = ['otherserial', 'serial']; |
|  |  | $p = [ |
|  |  | 'value' => 0, |
|  |  | 'valuename' => Dropdown::EMPTY\_VALUE, |
|  |  | 'itemtype' => $\_POST["idtable"], |
|  |  | 'display\_emptychoice' => true, |
|  |  | 'displaywith' => ['otherserial', 'serial'], |
|  |  | '\_idor\_token' => Session::getNewIDORToken($\_POST["idtable"]), |
|  |  | 'displaywith' => $displaywith, |
|  |  | ]; |
|  |  | $idor\_params = [ |
|  |  | 'displaywith' => $displaywith, |
|  |  | ]; |
|  |  | if (isset($\_POST['value'])) { |
|  |  | $p['value'] = $\_POST['value']; |
|  |  | } |
|  |  | if (isset($\_POST['entity\_restrict'])) { |
|  |  | $p['entity\_restrict'] = $\_POST['entity\_restrict']; |
|  |  | $p['entity\_restrict'] = $\_POST['entity\_restrict']; |
|  |  | $idor\_params['entity\_restrict'] = $\_POST['entity\_restrict']; |
|  |  | } |
|  |  | if (isset($\_POST['condition'])) { |
|  |  | $p['condition'] = $\_POST['condition']; |
|  |  | $p['condition'] = $\_POST['condition']; |
|  |  | $idor\_params['condition'] = $\_POST['condition']; |
|  |  | } |
|  |  | if (isset($\_POST['used'])) { |
|  |  | $\_POST['used'] = Toolbox::jsonDecode($\_POST['used'], true); |
| Expand All | | @@ -82,6 +87,7 @@ |
|  |  | if (isset($\_POST['width'])) { |
|  |  | $p['width'] = $\_POST['width']; |
|  |  | } |
|  |  | $p['\_idor\_token'] = Session::getNewIDORToken($\_POST["idtable"], $idor\_params); |
|  |  |  |
|  |  | echo Html::jsAjaxDropdown( |
|  |  | $\_POST["name"], |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[ajax/socket.php](#diff-afd7368052fc7f57413aa9bb801862381dfbecb1ae5fd10b0c1ad94539d840e2 "ajax/socket.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/ajax/socket.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,7 +39,7 @@ |
|  |  | header("Content-Type: text/html; charset=UTF-8"); |
|  |  | Html::header\_nocache(); |
|  |  |  |
|  |  | Session::checkLoginUser(); |
|  |  | Session::checkCentralAccess(); |
|  |  |  |
|  |  | switch ($\_POST['action']) { |
|  |  | case 'getItemsFromItemtype': |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[ajax/visibility.php](#diff-f7a3b7f66713d40841b3ee866a9664c4889cef16c5d01b4e3da407a1df68130a "ajax/visibility.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/ajax/visibility.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -44,7 +44,7 @@ |
|  |  | Html::header\_nocache(); |
|  |  | } |
|  |  |  |
|  |  | Session::checkLoginUser(); |
|  |  | Session::checkCentralAccess(); |
|  |  |  |
|  |  | if ( |
|  |  | isset($\_POST['type']) && !empty($\_POST['type']) |
| Expand Down | |  |

54 changes: 41 additions & 13 deletions

54
[src/Dropdown.php](#diff-a116d97698d0d2c01f95a28d8c46ceeb51e3bddecf90f0017a98654a891fdec7 "src/Dropdown.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/src/Dropdown.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -233,9 +233,14 @@ public static function show($itemtype, $options = []) |
|  |  | 'permit\_select\_parent' => $params['permit\_select\_parent'], |
|  |  | 'specific\_tags' => $params['specific\_tags'], |
|  |  | 'class' => $params['class'], |
|  |  | '\_idor\_token' => Session::getNewIDORToken($itemtype, [ |
|  |  | 'entity\_restrict' => $entity\_restrict, |
|  |  | ]), |
|  |  | '\_idor\_token' => Session::getNewIDORToken( |
|  |  | $itemtype, |
|  |  | [ |
|  |  | 'entity\_restrict' => $entity\_restrict, |
|  |  | 'displaywith' => $params['displaywith'], |
|  |  | 'condition' => $params['condition'], |
|  |  | ], |
|  |  | ), |
|  |  | 'order' => $params['order'] ?? null, |
|  |  | 'parent\_id\_field' => $params['parent\_id\_field'], |
|  |  | 'multiple' => $params['multiple'] ?? false, |
| Expand Down  Expand Up | | @@ -2650,12 +2655,8 @@ public static function getDropdownValue($post, $json = true) |
|  |  | $displaywith = false; |
|  |  | if (isset($post['displaywith'])) { |
|  |  | if (is\_array($post['displaywith']) && count($post['displaywith'])) { |
|  |  | $table = getTableForItemType($post['itemtype']); |
|  |  | foreach ($post['displaywith'] as $key => $value) { |
|  |  | if (!$DB->fieldExists($table, $value)) { |
|  |  | unset($post['displaywith'][$key]); |
|  |  | } |
|  |  | } |
|  |  | $post['displaywith'] = self::filterDisplayWith($item, $post['displaywith']); |
|  |  |  |
|  |  | if (count($post['displaywith'])) { |
|  |  | $displaywith = true; |
|  |  | } |
| Expand Down  Expand Up | | @@ -3467,6 +3468,28 @@ public static function getDropdownValue($post, $json = true) |
|  |  | return ($json === true) ? json\_encode($ret) : $ret; |
|  |  | } |
|  |  |  |
|  |  | private static function filterDisplayWith(CommonDBTM $item, array $fields): array |
|  |  | { |
|  |  | /\*\* @var \DBmysql $DB \*/ |
|  |  | global $DB; |
|  |  |  |
|  |  | // Filter invalid fields |
|  |  | $table = $item->getTable(); |
|  |  | foreach ($fields as $key => $value) { |
|  |  | if (!$DB->fieldExists($table, $value)) { |
|  |  | unset($fields[$key]); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Filter sensitive fields in `displaywith` |
|  |  | // `CommonDBTM::unsetUndisclosedFields()` expects a `$field => $value` format. |
|  |  | $key\_value\_fields = array\_fill\_keys($fields, 0); |
|  |  | $item::unsetUndisclosedFields($key\_value\_fields); |
|  |  | $fields = array\_keys($key\_value\_fields); |
|  |  |  |
|  |  | return $fields; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Get dropdown connect |
|  |  | \* |
| Expand Down  Expand Up | | @@ -4095,7 +4118,6 @@ public static function getDropdownActors($post, $json = true) |
|  |  | 'value' => 0, |
|  |  | 'page' => 1, |
|  |  | 'inactive\_deleted' => 0, |
|  |  | '\_idor\_token' => "", |
|  |  | 'searchText' => null, |
|  |  | 'itiltemplate\_class' => 'TicketTemplate', |
|  |  | 'itiltemplates\_id' => 0, |
| Expand Down  Expand Up | | @@ -4162,9 +4184,12 @@ public static function getDropdownActors($post, $json = true) |
|  |  | } |
|  |  | $post['condition'] = static::addNewCondition($cond); |
|  |  |  |
|  |  | // Bypass checks, idor token validation has already been made earlier in method |
|  |  | $group\_idor = Session::getNewIDORToken('Group', ['entity\_restrict' => $entity\_restrict, 'condition' => $post['condition']]); |
|  |  |  |
|  |  | $groups = Dropdown::getDropdownValue([ |
|  |  | 'itemtype' => 'Group', |
|  |  | '\_idor\_token' => $post['\_idor\_token'], |
|  |  | '\_idor\_token' => $group\_idor, |
|  |  | 'display\_emptychoice' => false, |
|  |  | 'searchText' => $post['searchText'], |
|  |  | 'entity\_restrict' => $entity\_restrict, |
| Expand All | | @@ -4191,17 +4216,20 @@ public static function getDropdownActors($post, $json = true) |
|  |  | && !$template->isHiddenField("\_suppliers\_id\_{$post['actortype']}") |
|  |  | && in\_array('Supplier', $post['returned\_itemtypes']) |
|  |  | ) { |
|  |  | $supplier\_obj = new Supplier(); |
|  |  | // Bypass checks, idor token validation has already been made earlier in method |
|  |  | $supplier\_idor = Session::getNewIDORToken('Group', ['entity\_restrict' => $entity\_restrict]); |
|  |  |  |
|  |  | $suppliers = Dropdown::getDropdownValue([ |
|  |  | 'itemtype' => 'Supplier', |
|  |  | '\_idor\_token' => $post['\_idor\_token'], |
|  |  | '\_idor\_token' => $supplier\_idor, |
|  |  | 'display\_emptychoice' => false, |
|  |  | 'searchText' => $post['searchText'], |
|  |  | 'entity\_restrict' => $entity\_restrict, |
|  |  | ], false); |
|  |  | foreach ($suppliers['results'] as $supplier) { |
|  |  | if (isset($supplier['children'])) { |
|  |  | foreach ($supplier['children'] as &$children) { |
|  |  | $supplier\_obj = new Supplier(); |
|  |  | $supplier\_obj->getFromDB($children['id']); |
|  |  |  |
|  |  | $children['items\_id'] = $children['id']; |
| Expand Down | |  |

23 changes: 21 additions & 2 deletions

23
[src/Session.php](#diff-2ba5884bab6c9e8a5ee8ea4740bbb6d0c44f4340e4b86d532c7a0f36f17d2c25 "src/Session.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/src/Session.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1637,7 +1637,7 @@ public static function checkCSRF($data) |
|  |  | \* Get new IDOR token |
|  |  | \* This token validates the itemtype used by an ajax request is the one asked by a dropdown. |
|  |  | \* So, we avoid IDOR request where an attacker asks for an another itemtype |
|  |  | \* than the originaly indtended |
|  |  | \* than the originaly intended |
|  |  | \* |
|  |  | \* @since 9.5.3 |
|  |  | \* |
| Expand All | | @@ -1648,6 +1648,11 @@ public static function checkCSRF($data) |
|  |  | \*\*/ |
|  |  | public static function getNewIDORToken(string $itemtype = "", array $add\_params = []): string |
|  |  | { |
|  |  | if ($itemtype === '' && count($add\_params) === 0) { |
|  |  | trigger\_error('IDOR token cannot be generated with empty criteria.', E\_USER\_WARNING); |
|  |  | return ''; |
|  |  | } |
|  |  |  |
|  |  | $token = ""; |
|  |  | do { |
|  |  | $token = bin2hex(random\_bytes(32)); |
| Expand Down  Expand Up | | @@ -1695,7 +1700,21 @@ public static function validateIDOR(array $data = []): bool |
|  |  | $idor\_data = $\_SESSION['glpiidortokens'][$token]; |
|  |  | unset($idor\_data['expires']); |
|  |  |  |
|  |  | // check all stored data for the idor token are present (and identifical) in the posted data |
|  |  | // Ensure that `displaywith` and `condition` is checked if passed in data |
|  |  | $mandatory\_properties = [ |
|  |  | 'displaywith' => [], |
|  |  | 'condition' => [], |
|  |  | ]; |
|  |  | foreach ($mandatory\_properties as $property\_name => $default\_value) { |
|  |  | if (!array\_key\_exists($property\_name, $data)) { |
|  |  | $data[$property\_name] = $default\_value; |
|  |  | } |
|  |  | if (!array\_key\_exists($property\_name, $idor\_data)) { |
|  |  | $idor\_data[$property\_name] = $default\_value; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // check all stored data for the idor token are present (and identical) in the posted data |
|  |  | $match\_expected = function ($expected, $given) use (&$match\_expected) { |
|  |  | if (is\_array($expected)) { |
|  |  | if (!is\_array($given)) { |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[templates/components/itilobject/actors/field.html.twig](#diff-e71c627002b9d0a29b90666e3a68b108189c36af589b5c4414c542e41f89188e "templates/components/itilobject/actors/field.html.twig")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/templates/components/itilobject/actors/field.html.twig)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -254,7 +254,7 @@ |
|  |  | users\_right: '{{ users\_right ?? 'all' }}', |
|  |  | entity\_restrict: (actors.requester.length == 0 && is\_new\_item) ? -1 : {{ entities\_id }}, |
|  |  | searchText: params.term, |
|  |  | \_idor\_token: '{{ idor\_token() }}', |
|  |  | \_idor\_token: '{{ idor\_token(item.getType(), {'users\_right': users\_right ?? 'all'}) }}', |
|  |  | itiltemplate\_class: '{{ itiltemplate.getType() }}', |
|  |  | itiltemplates\_id: {{ itiltemplate.fields['id'] ?? 0 }}, |
|  |  | itemtype: '{{ item.getType() }}', |
| Expand Down | |  |

79 changes: 75 additions & 4 deletions

79
[tests/functional/Dropdown.php](#diff-ec145215cd26c7cf5f4e3c6f5f0d921d8b0bc65980872568ace50375867c3ec5 "tests/functional/Dropdown.php")

Show comments

[View file](/glpi-project/glpi/blob/1942b70b2422fff51822f6eb3af500c94760871e/tests/functional/Dropdown.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,12 +35,16 @@ |
|  |  |  |
|  |  | namespace tests\units; |
|  |  |  |
|  |  | use CommonDBTM; |
|  |  | use Computer; |
|  |  | use DbTestCase; |
|  |  | use Generator; |
|  |  | use Glpi\Socket; |
|  |  | use Glpi\Toolbox\Sanitizer; |
|  |  | use Item\_DeviceSimcard; |
|  |  | use Session; |
|  |  | use State; |
|  |  | use User; |
|  |  |  |
|  |  | /\* Test for inc/dropdown.class.php \*/ |
|  |  |  |
| Expand Down  Expand Up | | @@ -1412,7 +1416,7 @@ public function testGetDropdownValuePaginate() |
|  |  | 'entity\_restrict' => 0, |
|  |  | 'page' => 1, |
|  |  | 'page\_limit' => 10, |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType()) |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType(), ['entity\_restrict' => 0]) |
|  |  | ]; |
|  |  | $values = \Dropdown::getDropdownValue($post); |
|  |  | $values = (array)json\_decode($values); |
| Expand Down  Expand Up | | @@ -1471,7 +1475,7 @@ public function testGetDropdownValuePaginate() |
|  |  | 'entity\_restrict' => 0, |
|  |  | 'page' => 1, |
|  |  | 'page\_limit' => 10, |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType()) |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType(), ['entity\_restrict' => 0, 'condition' => ['name' => ['LIKE', "%3%"]]]) |
|  |  | ]; |
|  |  | $values = \Dropdown::getDropdownValue($post); |
|  |  | $values = (array)json\_decode($values); |
| Expand All | | @@ -1485,7 +1489,8 @@ public function testGetDropdownValuePaginate() |
|  |  | // Put condition in session and post its key |
|  |  | $condition\_key = sha1(serialize($post['condition'])); |
|  |  | $\_SESSION['glpicondition'][$condition\_key] = $post['condition']; |
|  |  | $post['condition'] = $condition\_key; |
|  |  | $post['condition'] = $condition\_key; |
|  |  | $post['\_idor\_token'] = \Session::getNewIDORToken($location::getType(), ['entity\_restrict' => 0, 'condition' => $condition\_key]); |
|  |  | $values = \Dropdown::getDropdownValue($post); |
|  |  | $values = (array)json\_decode($values); |
|  |  |  |
| Expand All | | @@ -1502,7 +1507,7 @@ public function testGetDropdownValuePaginate() |
|  |  | 'entity\_restrict' => 0, |
|  |  | 'page' => 1, |
|  |  | 'page\_limit' => 10, |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType()) |
|  |  | '\_idor\_token' => \Session::getNewIDORToken($location::getType(), ['entity\_restrict' => 0, 'condition' => '`name` LIKE "%4%"']) |
|  |  | ]; |
|  |  | $values = \Dropdown::getDropdownValue($post); |
|  |  | $values = (array)json\_decode($values); |
| Expand Down  Expand Up | | @@ -1819,4 +1824,70 @@ public function testDropdownNumber(array $params, array $expected): void |
|  |  | $this->variable($dropdown\_entry['id'])->isEqualTo($expected[$key]); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | protected function displayWithProvider(): iterable |
|  |  | { |
|  |  | yield [ |
|  |  | 'item' => new Computer(), |
|  |  | 'displaywith' => [], |
|  |  | 'filtered' => [], |
|  |  | ]; |
|  |  |  |
|  |  | yield [ |
|  |  | 'item' => new Computer(), |
|  |  | 'displaywith' => ['id', 'notavalidfield', 'serial'], |
|  |  | 'filtered' => ['id', 'serial'], |
|  |  | ]; |
|  |  |  |
|  |  | $this->login('post-only', 'postonly'); |
|  |  | yield [ |
|  |  | 'item' => new Item\_DeviceSimcard(), |
|  |  | 'displaywith' => ['serial', 'pin', 'puk'], |
|  |  | 'filtered' => ['serial'], // pin and puk disallowed by profile |
|  |  | ]; |
|  |  |  |
|  |  | $this->login(); |
|  |  | yield [ |
|  |  | 'item' => new Item\_DeviceSimcard(), |
|  |  | 'displaywith' => ['serial', 'pin', 'puk'], |
|  |  | 'filtered' => ['serial', 'pin', 'puk'], // pin and puk allowed by profile |
|  |  | ]; |
|  |  |  |
|  |  | $this->logOut(); |
|  |  | yield [ |
|  |  | 'item' => new Item\_DeviceSimcard(), |
|  |  | 'displaywith' => ['serial', 'pin', 'puk'], |
|  |  | 'filtered' => ['serial'], // pin and puk disallowed when not connected |
|  |  | ]; |
|  |  |  |
|  |  | $this->login('post-only', 'postonly'); |
|  |  | yield [ |
|  |  | 'item' => new User(), |
|  |  | 'displaywith' => ['id', 'firstname', 'password', 'personal\_token', 'api\_token', 'cookie\_token', 'password\_forget\_token'], |
|  |  | 'filtered' => ['id', 'firstname'], // all sensitive fields removed, and password\_forget\_token disallowed by profile |
|  |  | ]; |
|  |  |  |
|  |  | $this->login(); |
|  |  | yield [ |
|  |  | 'item' => new User(), |
|  |  | 'displaywith' => ['id', 'firstname', 'password', 'personal\_token', 'api\_token', 'cookie\_token', 'password\_forget\_token'], |
|  |  | 'filtered' => ['id', 'firstname', 'password\_forget\_token'], // password\_forget\_token allowed by profile |
|  |  | ]; |
|  |  |  |
|  |  | $this->logOut(); |
|  |  | yield [ |
|  |  | 'item' => new User(), |
|  |  | 'displaywith' => ['id', 'firstname', 'password', 'personal\_token', 'api\_token', 'cookie\_token', 'password\_forget\_token'], |
|  |  | 'filtered' => ['id', 'firstname'], // all sensitive fields removed, and password\_forget\_token disallowed when not connected |
|  |  | ]; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dataProvider displayWithProvider |
|  |  | \*/ |
|  |  | public function testFilterDisplayWith(CommonDBTM $item, array $displaywith, array $filtered): void |
|  |  | { |
|  |  | $instance = $this->newTestedInstance(); |
|  |  | $this->array($this->callPrivateMethod($instance, 'filterDisplayWith', $item, $displaywith))->isEqualTo($filtered); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `1942b70`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fglpi-project%2Fglpi%2Fcommit%2F1942b70b2422fff51822f6eb3af500c94760871e) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


