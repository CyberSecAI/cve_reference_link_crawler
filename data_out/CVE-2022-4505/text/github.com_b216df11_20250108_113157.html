
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenemr%2Fopenemr%2Fcommit%2F235b1910ffe5296187667277d4e197a0c3a9ac33)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenemr%2Fopenemr%2Fcommit%2F235b1910ffe5296187667277d4e197a0c3a9ac33)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openemr%2Fopenemr)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openemr](/openemr)
/
**[openemr](/openemr/openemr)**
Public

* [Notifications](/login?return_to=%2Fopenemr%2Fopenemr) You must be signed in to change notification settings
* [Fork
  2.2k](/login?return_to=%2Fopenemr%2Fopenemr)
* [Star
   3.2k](/login?return_to=%2Fopenemr%2Fopenemr)

* [Code](/openemr/openemr)
* [Issues
  278](/openemr/openemr/issues)
* [Pull requests
  80](/openemr/openemr/pulls)
* [Actions](/openemr/openemr/actions)
* [Projects
  0](/openemr/openemr/projects)
* [Security](/openemr/openemr/security)
* [Insights](/openemr/openemr/pulse)

Additional navigation options

* [Code](/openemr/openemr)
* [Issues](/openemr/openemr/issues)
* [Pull requests](/openemr/openemr/pulls)
* [Actions](/openemr/openemr/actions)
* [Projects](/openemr/openemr/projects)
* [Security](/openemr/openemr/security)
* [Insights](/openemr/openemr/pulse)

## Commit

[Permalink](/openemr/openemr/commit/235b1910ffe5296187667277d4e197a0c3a9ac33)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

bring back [#5676](https://github.com/openemr/openemr/pull/5676), [#5689](https://github.com/openemr/openemr/pull/5689), and [#5674](https://github.com/openemr/openemr/pull/5674) to rel-700 ([#5694](https://github.com/openemr/openemr/pull/5694))

[Browse files](/openemr/openemr/tree/235b1910ffe5296187667277d4e197a0c3a9ac33)
Browse the repository at this point in the history

```
* php8.1 fixes ([#5676](https://github.com/openemr/openemr/pull/5676))

* php8 fixes for batch payments ([#5689](https://github.com/openemr/openemr/pull/5689))

* change int cast to ceil for little payments

* simplify with floatval()

* better comment

* fix other php8 maths

* bug fix ([#5674](https://github.com/openemr/openemr/pull/5674))

* bug fix

* check for empty eid

* consistently null with opener vars
```

* Loading branch information

[![@stephenwaite](https://avatars.githubusercontent.com/u/5618372?s=40&v=4)](/stephenwaite)

[stephenwaite](/openemr/openemr/commits?author=stephenwaite "View all commits by stephenwaite")
authored
Aug 20, 2022

1 parent
[ba39341](/openemr/openemr/commit/ba393415a133c21b20d0459b80c52d58f7ac1d3c)

commit 235b191

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**52 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* interface

  + billing

    - interface/billing/edit\_payment.php
      [edit\_payment.php](#diff-bfd1c086b0a9f40724fd3e30ccbc473c2b213f1a0a540dc3ce95be131b4e50a9)
  + patient\_tracker

    - interface/patient\_tracker/patient\_tracker.php
      [patient\_tracker.php](#diff-8a6e7c1707bd318b81dc2eb35507eb0867a5ea176e16cc31695670b460654df1)
* library

  + library/payment.inc.php
    [payment.inc.php](#diff-cadbfaeacae148b13b0db0cca677f8d82824f309f5e9f6c7cabe386520861b9c)
* portal

  + portal/add\_edit\_event\_user.php
    [add\_edit\_event\_user.php](#diff-9f6cca371c84d79b5b937c04dd3ece3f2493fb7890c7c0602a6ca23593d8dea9)
* src/Services

  + src/Services/PatientTrackerService.php
    [PatientTrackerService.php](#diff-e9681758c32f1de802cf199a6d4011fa40c8837713e28dcfe3a9e006171a624f)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[interface/billing/edit\_payment.php](#diff-bfd1c086b0a9f40724fd3e30ccbc473c2b213f1a0a540dc3ce95be131b4e50a9 "interface/billing/edit_payment.php")

Show comments

[View file](/openemr/openemr/blob/235b1910ffe5296187667277d4e197a0c3a9ac33/interface/billing/edit_payment.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -188,7 +188,7 @@ |
|  |  | //============================================================================================================================== |
|  |  |  |
|  |  | $where = "$where1 AND adj\_amount != 0"; |
|  |  | if (isset($\_POST["AdjAmount$CountRow"]) && $\_POST["AdjAmount$CountRow"] \* 1 !== 0) { |
|  |  | if (isset($\_POST["AdjAmount$CountRow"]) && floatval($\_POST["AdjAmount$CountRow"]) !== 0) { |
|  |  | if (trim($\_POST['type\_name']) == 'insurance') { |
|  |  | $AdjustString = "Ins adjust Ins" . trim($\_POST["HiddenIns$CountRow"]); |
|  |  | $AccountCode = "IA"; |
| Expand Down  Expand Up | | @@ -939,7 +939,7 @@ function DeletePaymentDistribution(DeleteId) {//Confirms deletion of payment dis |
|  |  | $ReasonCodeDB = $rowPayment['reason\_code']; |
|  |  |  |
|  |  | if ($Ins == 1) { |
|  |  | $AllowedDB = number\_format($Fee - $AdjAmountDB, 2); |
|  |  | $AllowedDB = number\_format($Fee - floatval($AdjAmountDB), 2); |
|  |  | } else { |
|  |  | $AllowedDB = 0; |
|  |  | } |
| Expand Down | |  |

44 changes: 24 additions & 20 deletions

44
[interface/patient\_tracker/patient\_tracker.php](#diff-8a6e7c1707bd318b81dc2eb35507eb0867a5ea176e16cc31695670b460654df1 "interface/patient_tracker/patient_tracker.php")

Show comments

[View file](/openemr/openemr/blob/235b1910ffe5296187667277d4e197a0c3a9ac33/interface/patient_tracker/patient_tracker.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -64,7 +64,7 @@ |
|  |  | //set default start date of flow board to value based on globals |
|  |  | if (!$GLOBALS['ptkr\_date\_range']) { |
|  |  | $from\_date = date('Y-m-d'); |
|  |  | } elseif (!is\_null($\_REQUEST['form\_from\_date'])) { |
|  |  | } elseif (!is\_null($\_REQUEST['form\_from\_date'] ?? null)) { |
|  |  | $from\_date = DateToYYYYMMDD($\_REQUEST['form\_from\_date']); |
|  |  | } elseif (($GLOBALS['ptkr\_start\_date']) == 'D0') { |
|  |  | $from\_date = date('Y-m-d'); |
| Expand Down  Expand Up | | @@ -101,13 +101,13 @@ |
|  |  | } |
|  |  |  |
|  |  | $to\_date = date('Y-m-d', $ptkr\_future\_time); |
|  |  | $to\_date = !is\_null($\_REQUEST['form\_to\_date']) ? DateToYYYYMMDD($\_REQUEST['form\_to\_date']) : $to\_date; |
|  |  | $to\_date = !is\_null($\_REQUEST['form\_to\_date'] ?? null) ? DateToYYYYMMDD($\_REQUEST['form\_to\_date']) : $to\_date; |
|  |  | } else { |
|  |  | $to\_date = date('Y-m-d'); |
|  |  | } |
|  |  |  |
|  |  | $form\_patient\_name = !is\_null($\_POST['form\_patient\_name']) ? $\_POST['form\_patient\_name'] : null; |
|  |  | $form\_patient\_id = !is\_null($\_POST['form\_patient\_id']) ? $\_POST['form\_patient\_id'] : null; |
|  |  | $form\_patient\_name = !is\_null($\_POST['form\_patient\_name'] ?? null) ? $\_POST['form\_patient\_name'] : null; |
|  |  | $form\_patient\_id = !is\_null($\_POST['form\_patient\_id'] ?? null) ? $\_POST['form\_patient\_id'] : null; |
|  |  |  |
|  |  |  |
|  |  | $lres = sqlStatement("SELECT option\_id, title FROM list\_options WHERE list\_id = ? AND activity=1", array('apptstat')); |
| Expand Down  Expand Up | | @@ -143,7 +143,7 @@ |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (!$\_REQUEST['flb\_table']) { |
|  |  | if (!($\_REQUEST['flb\_table'] ?? null)) { |
|  |  | ?> |
|  |  | <html> |
|  |  | <head> |
| Expand Down  Expand Up | | @@ -188,7 +188,7 @@ |
|  |  | echo "<option value=''>" . xlt("Visit Categories") . "</option>"; |
|  |  | while ($cat = sqlFetchArray($categories)) { |
|  |  | echo "<option value='" . attr($cat['id']) . "'"; |
|  |  | if ($cat['id'] == $\_POST['form\_apptcat']) { |
|  |  | if ($cat['id'] == ($\_POST['form\_apptcat'] ?? null)) { |
|  |  | echo " selected='true' "; |
|  |  | } |
|  |  | echo ">" . xlt($cat['category']) . "</option>"; |
| Expand All | | @@ -204,7 +204,7 @@ |
|  |  | $apptstats = sqlStatement("SELECT \* FROM list\_options WHERE list\_id = 'apptstat' AND activity = 1 ORDER BY seq"); |
|  |  | while ($apptstat = sqlFetchArray($apptstats)) { |
|  |  | echo "<option value='" . attr($apptstat['option\_id']) . "'"; |
|  |  | if ($apptstat['option\_id'] == $\_POST['form\_apptstatus']) { |
|  |  | if ($apptstat['option\_id'] == ($\_POST['form\_apptstatus'] ?? null)) { |
|  |  | echo " selected='true' "; |
|  |  | } |
|  |  | echo ">" . xlt($apptstat['title']) . "</option>"; |
| Expand All | | @@ -218,8 +218,10 @@ |
|  |  | <?php |
|  |  | $fac\_sql = sqlStatement("SELECT \* FROM facility ORDER BY id"); |
|  |  | while ($fac = sqlFetchArray($fac\_sql)) { |
|  |  | $true = ($fac['id'] == $\_POST['form\_facility']) ? "selected=true" : ''; |
|  |  | $true = ($fac['id'] == ($\_POST['form\_facility'] ?? null)) ? "selected=true" : ''; |
|  |  | ($select\_facs ?? null) ? $select\_facs : $select\_facs = ''; |
|  |  | $select\_facs .= "<option value=" . attr($fac['id']) . " " . $true . ">" . text($fac['name']) . "</option>\n"; |
|  |  | ($count ?? null) ? $count\_facs : $count\_facs = 0; |
|  |  | $count\_facs++; |
|  |  | } |
|  |  | if ($count\_facs < '1') { |
| Expand All | | @@ -238,13 +240,15 @@ |
|  |  | $ures = sqlStatement($query); |
|  |  | while ($urow = sqlFetchArray($ures)) { |
|  |  | $provid = $urow['id']; |
|  |  | ($select\_provs ?? null) ? $select\_provs : $select\_provs = ''; |
|  |  | $select\_provs .= " <option value='" . attr($provid) . "'"; |
|  |  | if (isset($\_POST['form\_provider']) && $provid == $\_POST['form\_provider']) { |
|  |  | $select\_provs .= " selected"; |
|  |  | } elseif (!isset($\_POST['form\_provider']) && $\_SESSION['userauthorized'] && $provid == $\_SESSION['authUserID']) { |
|  |  | $select\_provs .= " selected"; |
|  |  | } |
|  |  | $select\_provs .= ">" . text($urow['lname']) . ", " . text($urow['fname']) . "\n"; |
|  |  | ($count\_provs ?? null) ? $count\_provs : $count\_provs = 0; |
|  |  | $count\_provs++; |
|  |  | } |
|  |  | ?> |
| Expand Down  Expand Up | | @@ -284,7 +288,7 @@ |
|  |  |  |
|  |  | <div class="col-sm-12 mt-3 mx-auto"> |
|  |  | <button id="filter\_submit" class="btn btn-primary btn-sm btn-filter"><?php echo xlt('Filter'); ?></button> |
|  |  | <input type="hidden" id="kiosk" name="kiosk" value="<?php echo attr($\_REQUEST['kiosk']); ?>" /> |
|  |  | <input type="hidden" id="kiosk" name="kiosk" value="<?php echo attr($\_REQUEST['kiosk'] ?? ''); ?>" /> |
|  |  | </div> |
|  |  | </div> |
|  |  | <div class="col-4 mt-3 row"> |
| Expand Down  Expand Up | | @@ -464,7 +468,7 @@ |
|  |  | // Collect appt date and set up squashed date for use below |
|  |  | $date\_appt = $appointment['pc\_eventDate']; |
|  |  | $date\_squash = str\_replace("-", "", $date\_appt); |
|  |  | if (empty($appointment['room']) && ($logged\_in) && ($setting\_bootstrap\_submenu != 'hide')) { |
|  |  | if (empty($appointment['room']) && ($logged\_in ?? null) && ($setting\_bootstrap\_submenu != 'hide')) { |
|  |  | //Patient has not arrived yet, display MedEx Reminder info |
|  |  | //one icon per type of response. |
|  |  | //If there was a SMS dialog, display it as a mouseover/title |
| Expand Down  Expand Up | | @@ -697,21 +701,21 @@ class="text-small" |
|  |  | $to\_time = strtotime($newend); |
|  |  | $yestime = '0'; |
|  |  | } else { |
|  |  | $from\_time = strtotime($appointment['start\_datetime']); |
|  |  | $from\_time = (($appointment['start\_datetime'] ?? null) ? strtotime($appointment['start\_datetime']) : null); |
|  |  | $yestime = '1'; |
|  |  | } |
|  |  |  |
|  |  | $timecheck = round(abs($to\_time - $from\_time) / 60, 0); |
|  |  | $timecheck = round(abs($to\_time - ($from\_time ?? null)) / 60, 0); |
|  |  | if ($timecheck >= $statalert && ($statalert > '0')) { // Determine if the time in status limit has been reached. |
|  |  | echo "<td class='text-center js-blink-infinite small' nowrap> "; // and if so blink |
|  |  | } else { |
|  |  | echo "<td class='detail text-center' nowrap> "; // and if not do not blink |
|  |  | } |
|  |  | if (($yestime == '1') && ($timecheck >= 1) && (strtotime($newarrive) != '')) { |
|  |  | echo text($timecheck . ' ' . ($timecheck >= 2 ? xl('minutes') : xl('minute'))); |
|  |  | } elseif ($icon\_here || $icon2\_here || $icon\_CALL) { |
|  |  | } elseif (($icon\_here ?? null) || ($icon2\_here ?? null) || ($icon\_CALL ?? null)) { |
|  |  | echo "<span style='font-size:0.7rem;' onclick='return calendarpopup(" . attr\_js($appt\_eid) . "," . attr\_js($date\_squash) . ")'>" . implode($icon\_here) . $icon2\_here . "</span> " . $icon\_CALL; |
|  |  | } elseif ($logged\_in) { |
|  |  | } elseif ($logged\_in ?? null) { |
|  |  | $pat = $MedEx->display->possibleModalities($appointment); |
|  |  | echo "<span style='font-size:0.7rem;' onclick='return calendarpopup(" . attr\_js($appt\_eid) . "," . attr\_js($date\_squash) . ")'>" . $pat['SMS'] . $pat['AVM'] . $pat['EMAIL'] . "</span>"; |
|  |  | } |
| Expand Down  Expand Up | | @@ -743,7 +747,7 @@ class="text-small" |
|  |  | echo text($timecheck2 . ' ' . ($timecheck2 >= 2 ? xl('minutes') : xl('minute'))); |
|  |  | } |
|  |  | // end total time in practice |
|  |  | echo text($appointment['pc\_time']); ?> |
|  |  | echo text($appointment['pc\_time'] ?? ''); ?> |
|  |  | </td> |
|  |  | <td class="detail text-center"> |
|  |  | <?php |
| Expand Down  Expand Up | | @@ -803,7 +807,7 @@ class="text-small" |
|  |  |  |
|  |  | <?php |
|  |  | } |
|  |  | if (!$\_REQUEST['flb\_table']) { ?> |
|  |  | if (!($\_REQUEST['flb\_table'] ?? null)) { ?> |
|  |  | </div> |
|  |  | </div> |
|  |  | </div> |
| Expand Down  Expand Up | | @@ -1014,10 +1018,10 @@ function openNewTopWindow(newpid, newencounterid) { |
|  |  | \*/ |
|  |  | function SMS\_bot(pid) { |
|  |  | top.restoreSession(); |
|  |  | var from = <?php echo js\_escape($from\_date); ?>; |
|  |  | var to = <?php echo js\_escape($to\_date); ?>; |
|  |  | var oefrom = <?php echo js\_escape(oeFormatShortDate($from\_date)); ?>; |
|  |  | var oeto = <?php echo js\_escape(oeFormatShortDate($to\_date)); ?>; |
|  |  | var from = <?php echo js\_escape($from\_date ?? ''); ?>; |
|  |  | var to = <?php echo js\_escape($to\_date ?? ''); ?>; |
|  |  | var oefrom = <?php echo js\_escape(oeFormatShortDate($from\_date ?? null)); ?>; |
|  |  | var oeto = <?php echo js\_escape(oeFormatShortDate($to\_date ?? null)); ?>; |
|  |  | window.open('../main/messages/messages.php?nomenu=1&go=SMS\_bot&pid=' + encodeURIComponent(pid) + '&to=' + encodeURIComponent(to) + '&from=' + encodeURIComponent(from) + '&oeto=' + encodeURIComponent(oeto) + '&oefrom=' + encodeURIComponent(oefrom), 'SMS\_bot', 'width=370,height=600,resizable=0'); |
|  |  | return false; |
|  |  | } |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[library/payment.inc.php](#diff-cadbfaeacae148b13b0db0cca677f8d82824f309f5e9f6c7cabe386520861b9c "library/payment.inc.php")

Show comments

[View file](/openemr/openemr/blob/235b1910ffe5296187667277d4e197a0c3a9ac33/library/payment.inc.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,7 +61,8 @@ function DistributionInsert($CountRow, $created\_time, $user\_id) |
|  |  | //It automatically pushes to next insurance for billing. |
|  |  | //In the screen a drop down of Ins1,Ins2,Ins3,Pat are given.The posting can be done for any level. |
|  |  | $Affected = 'no'; |
|  |  | if (isset($\_POST["Payment$CountRow"]) && (int)$\_POST["Payment$CountRow"] > 0) { |
|  |  | // watch for payments less than $1, thanks @snailwell |
|  |  | if (isset($\_POST["Payment$CountRow"]) && (floatval($\_POST["Payment$CountRow"]) > 0)) { |
|  |  | if (trim(formData('type\_name')) == 'insurance') { |
|  |  | if (trim(formData("HiddenIns$CountRow")) == 1) { |
|  |  | $AccountCode = "IPP"; |
| Expand Down  Expand Up | | @@ -100,7 +101,7 @@ function DistributionInsert($CountRow, $created\_time, $user\_id) |
|  |  | $Affected = 'yes'; |
|  |  | } |
|  |  |  |
|  |  | if (!empty($\_POST["AdjAmount$CountRow"]) && (($\_POST["AdjAmount$CountRow"] ?? null) \* 1 != 0)) { |
|  |  | if (!empty($\_POST["AdjAmount$CountRow"]) && (floatval($\_POST["AdjAmount$CountRow"] ?? null)) != 0) { |
|  |  | if (trim(formData('type\_name')) == 'insurance') { |
|  |  | $AdjustString = "Ins adjust Ins" . trim(formData("HiddenIns$CountRow")); |
|  |  | $AccountCode = "IA"; |
| Expand Down  Expand Up | | @@ -132,7 +133,7 @@ function DistributionInsert($CountRow, $created\_time, $user\_id) |
|  |  | $Affected = 'yes'; |
|  |  | } |
|  |  |  |
|  |  | if (!empty($\_POST["Deductible$CountRow"]) && (($\_POST["Deductible$CountRow"] ?? null) \* 1 > 0)) { |
|  |  | if (!empty($\_POST["Deductible$CountRow"]) && (floatval($\_POST["Deductible$CountRow"] ?? null)) > 0) { |
|  |  | sqlBeginTrans(); |
|  |  | $sequence\_no = sqlQuery("SELECT IFNULL(MAX(sequence\_no),0) + 1 AS increment FROM ar\_activity WHERE pid = ? AND encounter = ?", array(trim(formData('hidden\_patient\_code')), trim(formData("HiddenEncounter$CountRow")))); |
|  |  | sqlStatement("insert into ar\_activity set " . |
| Expand All | | @@ -156,7 +157,7 @@ function DistributionInsert($CountRow, $created\_time, $user\_id) |
|  |  | $Affected = 'yes'; |
|  |  | } |
|  |  |  |
|  |  | if (!empty($\_POST["Takeback$CountRow"]) && (($\_POST["Takeback$CountRow"] ?? null) \* 1 > 0)) { |
|  |  | if (!empty($\_POST["Takeback$CountRow"]) && (floatval($\_POST["Takeback$CountRow"] ?? null)) > 0) { |
|  |  | sqlBeginTrans(); |
|  |  | $sequence\_no = sqlQuery("SELECT IFNULL(MAX(sequence\_no),0) + 1 AS increment FROM ar\_activity WHERE pid = ? AND encounter = ?", array(trim(formData('hidden\_patient\_code')), trim(formData("HiddenEncounter$CountRow")))); |
|  |  | sqlStatement("insert into ar\_activity set " . |
| Expand Down  Expand Up | | @@ -212,7 +213,7 @@ function DistributionInsert($CountRow, $created\_time, $user\_id) |
|  |  | //last\_level\_closed gets increased. unless a follow up is required. |
|  |  | // in which case we'll allow secondary to be re setup to current setup. |
|  |  | // just not advancing last closed. |
|  |  | $tmp = (((!empty($\_POST["Payment$CountRow"]) ? $\_POST["Payment$CountRow"] : null) \* 1) + ((!empty($\_POST["AdjAmount$CountRow"]) ? $\_POST["AdjAmount$CountRow"] : null) \* 1)); |
|  |  | $tmp = ((!empty($\_POST["Payment$CountRow"]) ? floatval($\_POST["Payment$CountRow"]) : null) + (!empty($\_POST["AdjAmount$CountRow"]) ? floatval($\_POST["AdjAmount$CountRow"]) : null)); |
|  |  | if ((empty($\_POST["FollowUp$CountRow"]) || ($\_POST["FollowUp$CountRow"] != 'y')) && $tmp !== 0) { |
|  |  | sqlStatement("update form\_encounter set last\_level\_closed='" . |
|  |  | trim(formData("HiddenIns$CountRow")) . |
| Expand Down | |  |

27 changes: 19 additions & 8 deletions

27
[portal/add\_edit\_event\_user.php](#diff-9f6cca371c84d79b5b937c04dd3ece3f2493fb7890c7c0602a6ca23593d8dea9 "portal/add_edit_event_user.php")

Show comments

[View file](/openemr/openemr/blob/235b1910ffe5296187667277d4e197a0c3a9ac33/portal/add_edit_event_user.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,18 +41,29 @@ |
|  |  | require\_once("../interface/globals.php"); |
|  |  | require\_once("$srcdir/patient.inc"); |
|  |  | require\_once("$srcdir/forms.inc"); |
|  |  | require\_once("$srcdir/appointments.inc.php"); |
|  |  |  |
|  |  | use OpenEMR\Core\Header; |
|  |  |  |
|  |  | // Things that might be passed by our opener. |
|  |  | // |
|  |  | $eid = $\_GET['eid']; // only for existing events |
|  |  | $date = $\_GET['date']; // this and below only for new events |
|  |  | $userid = $\_GET['userid']; |
|  |  | $default\_catid = $\_GET['catid'] ? $\_GET['catid'] : '5'; |
|  |  | $patientid = $\_GET['patid']; |
|  |  | $eid = $\_GET['eid'] ?? null; // only for existing events |
|  |  | $date = $\_GET['date'] ?? null; // this and below only for new events |
|  |  | $userid = $\_GET['userid'] ?? null; |
|  |  | $default\_catid = ($\_GET['catid'] ?? null) ? $\_GET['catid'] : '5'; |
|  |  | $patientid = $\_GET['patid'] ?? null; |
|  |  | // |
|  |  |  |
|  |  | // did someone tamper with eid? |
|  |  | $checkEidInAppt = false; |
|  |  | $patient\_appointments = fetchAppointments('1970-01-01', '2382-12-31', $\_SESSION['pid']); |
|  |  | $checkEidInAppt = array\_search($eid, array\_column($patient\_appointments, 'pc\_eid')); |
|  |  |  |
|  |  | if (!empty($eid) && !$checkEidInAppt) { |
|  |  | echo js\_escape("error"); |
|  |  | exit(); |
|  |  | } |
|  |  |  |
|  |  | if ($date) { |
|  |  | $date = substr($date, 0, 4) . '-' . substr($date, 4, 2) . '-' . substr($date, 6); |
|  |  | } else { |
| Expand Down  Expand Up | | @@ -118,7 +129,7 @@ |
|  |  |  |
|  |  | // If we are saving, then save and close the window. |
|  |  | // |
|  |  | if ($\_POST['form\_action'] == "save") { |
|  |  | if (($\_POST['form\_action'] ?? null) == "save") { |
|  |  | //print\_r($\_POST); |
|  |  | //exit(); |
|  |  | $event\_date = fixDate($\_POST['form\_date']); |
| Expand Down  Expand Up | | @@ -455,7 +466,7 @@ |
|  |  | "1, " . (int)$\_POST['facility'] . ")"); // FF stuff |
|  |  | } // INSERT single |
|  |  | } // else - insert |
|  |  | } elseif ($\_POST['form\_action'] == "delete") { |
|  |  | } elseif (($\_POST['form\_action'] ?? null) == "delete") { |
|  |  | // ======================================= |
|  |  | // multi providers case |
|  |  | // ======================================= |
| Expand Down  Expand Up | | @@ -696,7 +707,7 @@ |
|  |  | // default to the currently logged-in user |
|  |  | while ($urow = sqlFetchArray($ures)) { |
|  |  | echo "<option value='" . attr($urow['id']) . "'"; |
|  |  | if (($urow['id'] == $\_GET['userid']) || ($urow['id'] == $userid)) { |
|  |  | if (($urow['id'] == ($\_GET['userid'] ?? null)) || ($urow['id'] == $userid)) { |
|  |  | echo " selected"; |
|  |  | } |
|  |  | echo ">" . text($urow['lname']); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/Services/PatientTrackerService.php](#diff-e9681758c32f1de802cf199a6d4011fa40c8837713e28dcfe3a9e006171a624f "src/Services/PatientTrackerService.php")

Show comments

[View file](/openemr/openemr/blob/235b1910ffe5296187667277d4e197a0c3a9ac33/src/Services/PatientTrackerService.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -365,6 +365,7 @@ public function getApptStatus($appointments) |
|  |  | $astat['count\_all'] = count($appointments); |
|  |  | //group the appointment by status |
|  |  | foreach ($appointments as $appointment) { |
|  |  | ($astat[$appointment['pc\_apptstatus']] ?? null) ? $astat[$appointment['pc\_apptstatus']] : $astat[$appointment['pc\_apptstatus']] = 0; |
|  |  | $astat[$appointment['pc\_apptstatus']] += 1; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `235b191`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenemr%2Fopenemr%2Fcommit%2F235b1910ffe5296187667277d4e197a0c3a9ac33) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

