=== Content from git.kernel.org_52af51a3_20250110_164246.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-09-15 13:24:47 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:02:56 +0200 |
| commit | [eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)) | |
| tree | [7751479243d73480dfeab767c1839846e23f5560](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1) | |
| parent | [074218073f29e4114115a2f1f0a7db75e8f6a229](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=074218073f29e4114115a2f1f0a7db75e8f6a229) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1&id2=074218073f29e4114115a2f1f0a7db75e8f6a229)) | |
| download | [linux-eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1.tar.gz) | |

Bluetooth: hci\_codec: Fix leaking content of local\_codecscommit b938790e70540bf4f2e653dcd74b232494d06c8f upstream.
The following memory leak can be observed when the controller supports
codecs which are stored in local\_codecs list but the elements are never
freed:
unreferenced object 0xffff88800221d840 (size 32):
comm "kworker/u3:0", pid 36, jiffies 4294898739 (age 127.060s)
hex dump (first 32 bytes):
f8 d3 02 03 80 88 ff ff 80 d8 21 02 80 88 ff ff ..........!.....
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
backtrace:
[<ffffffffb324f557>] \_\_kmalloc+0x47/0x120
[<ffffffffb39ef37d>] hci\_codec\_list\_add.isra.0+0x2d/0x160
[<ffffffffb39ef643>] hci\_read\_codec\_capabilities+0x183/0x270
[<ffffffffb39ef9ab>] hci\_read\_supported\_codecs+0x1bb/0x2d0
[<ffffffffb39f162e>] hci\_read\_local\_codecs\_sync+0x3e/0x60
[<ffffffffb39ff1b3>] hci\_dev\_open\_sync+0x943/0x11e0
[<ffffffffb396d55d>] hci\_power\_on+0x10d/0x3f0
[<ffffffffb30c99b4>] process\_one\_work+0x404/0x800
[<ffffffffb30ca134>] worker\_thread+0x374/0x670
[<ffffffffb30d9108>] kthread+0x188/0x1c0
[<ffffffffb304db6b>] ret\_from\_fork+0x2b/0x50
[<ffffffffb300206a>] ret\_from\_fork\_asm+0x1a/0x30
Cc: stable@vger.kernel.org
Fixes: 8961987f3f5f ("Bluetooth: Enumerate local supported codec and cache details")
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)

| -rw-r--r-- | [net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_core.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_event.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_sync.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1) | 1 | |  |  |  | | --- | --- | --- | |

3 files changed, 3 insertions, 0 deletions

| diff --git a/net/bluetooth/hci\_core.c b/net/bluetooth/hci\_core.cindex 29ae9b254a34e6..56b0a1637bc8d7 100644--- a/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=074218073f29e4114115a2f1f0a7db75e8f6a229)+++ b/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)@@ -2784,6 +2784,7 @@ void hci\_release\_dev(struct hci\_dev \*hdev) hci\_conn\_params\_clear\_all(hdev); hci\_discovery\_filter\_clear(hdev); hci\_blocked\_keys\_clear(hdev);+ hci\_codec\_list\_clear(&hdev->local\_codecs); hci\_dev\_unlock(hdev);  ida\_simple\_remove(&hci\_index\_ida, hdev->id);diff --git a/net/bluetooth/hci\_event.c b/net/bluetooth/hci\_event.cindex 2358c1835d4756..a77234478b2c4f 100644--- a/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=074218073f29e4114115a2f1f0a7db75e8f6a229)+++ b/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)@@ -33,6 +33,7 @@  #include "hci\_request.h" #include "hci\_debugfs.h"+#include "hci\_codec.h" #include "a2mp.h" #include "amp.h" #include "smp.h"diff --git a/net/bluetooth/hci\_sync.c b/net/bluetooth/hci\_sync.cindex 402b8522c22282..5e2a162526faad 100644--- a/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=074218073f29e4114115a2f1f0a7db75e8f6a229)+++ b/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=eea5a8f0c3b7c884d2351e75fbdd0a3d7def5ae1)@@ -5095,6 +5095,7 @@ int hci\_dev\_close\_sync(struct hci\_dev \*hdev) memset(hdev->eir, 0, sizeof(hdev->eir)); memset(hdev->dev\_class, 0, sizeof(hdev->dev\_class)); bacpy(&hdev->random\_addr, BDADDR\_ANY);+ hci\_codec\_list\_clear(&hdev->local\_codecs);  hci\_dev\_put(hdev); return err; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:41:24 +0000



=== Content from git.kernel.org_42ec9d61_20250110_164246.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-09-15 13:24:47 -0700 |
| --- | --- | --- |
| committer | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-09-20 11:03:11 -0700 |
| commit | [b938790e70540bf4f2e653dcd74b232494d06c8f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b938790e70540bf4f2e653dcd74b232494d06c8f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)) | |
| tree | [681b6fb568bc9e0e179d6fd6f8ae09f4d6a574e1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b938790e70540bf4f2e653dcd74b232494d06c8f) | |
| parent | [dcda165706b9fbfd685898d46a6749d7d397e0c0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dcda165706b9fbfd685898d46a6749d7d397e0c0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b938790e70540bf4f2e653dcd74b232494d06c8f&id2=dcda165706b9fbfd685898d46a6749d7d397e0c0)) | |
| download | [linux-b938790e70540bf4f2e653dcd74b232494d06c8f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b938790e70540bf4f2e653dcd74b232494d06c8f.tar.gz) | |

Bluetooth: hci\_codec: Fix leaking content of local\_codecsThe following memory leak can be observed when the controller supports
codecs which are stored in local\_codecs list but the elements are never
freed:
unreferenced object 0xffff88800221d840 (size 32):
comm "kworker/u3:0", pid 36, jiffies 4294898739 (age 127.060s)
hex dump (first 32 bytes):
f8 d3 02 03 80 88 ff ff 80 d8 21 02 80 88 ff ff ..........!.....
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
backtrace:
[<ffffffffb324f557>] \_\_kmalloc+0x47/0x120
[<ffffffffb39ef37d>] hci\_codec\_list\_add.isra.0+0x2d/0x160
[<ffffffffb39ef643>] hci\_read\_codec\_capabilities+0x183/0x270
[<ffffffffb39ef9ab>] hci\_read\_supported\_codecs+0x1bb/0x2d0
[<ffffffffb39f162e>] hci\_read\_local\_codecs\_sync+0x3e/0x60
[<ffffffffb39ff1b3>] hci\_dev\_open\_sync+0x943/0x11e0
[<ffffffffb396d55d>] hci\_power\_on+0x10d/0x3f0
[<ffffffffb30c99b4>] process\_one\_work+0x404/0x800
[<ffffffffb30ca134>] worker\_thread+0x374/0x670
[<ffffffffb30d9108>] kthread+0x188/0x1c0
[<ffffffffb304db6b>] ret\_from\_fork+0x2b/0x50
[<ffffffffb300206a>] ret\_from\_fork\_asm+0x1a/0x30
Cc: stable@vger.kernel.org
Fixes: 8961987f3f5f ("Bluetooth: Enumerate local supported codec and cache details")
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b938790e70540bf4f2e653dcd74b232494d06c8f)

| -rw-r--r-- | [net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_core.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_event.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_sync.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f) | 1 | |  |  |  | | --- | --- | --- | |

3 files changed, 3 insertions, 0 deletions

| diff --git a/net/bluetooth/hci\_core.c b/net/bluetooth/hci\_core.cindex 9e89843c259b1f..195aea2198a963 100644--- a/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=dcda165706b9fbfd685898d46a6749d7d397e0c0)+++ b/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f)@@ -2786,6 +2786,7 @@ void hci\_release\_dev(struct hci\_dev \*hdev) hci\_conn\_params\_clear\_all(hdev); hci\_discovery\_filter\_clear(hdev); hci\_blocked\_keys\_clear(hdev);+ hci\_codec\_list\_clear(&hdev->local\_codecs); hci\_dev\_unlock(hdev);  ida\_simple\_remove(&hci\_index\_ida, hdev->id);diff --git a/net/bluetooth/hci\_event.c b/net/bluetooth/hci\_event.cindex 35f251041eeb9b..31d02b54eea119 100644--- a/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=dcda165706b9fbfd685898d46a6749d7d397e0c0)+++ b/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f)@@ -33,6 +33,7 @@  #include "hci\_request.h" #include "hci\_debugfs.h"+#include "hci\_codec.h" #include "a2mp.h" #include "amp.h" #include "smp.h"diff --git a/net/bluetooth/hci\_sync.c b/net/bluetooth/hci\_sync.cindex fd7c5d90285688..d06e07a0ea5a98 100644--- a/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=dcda165706b9fbfd685898d46a6749d7d397e0c0)+++ b/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=b938790e70540bf4f2e653dcd74b232494d06c8f)@@ -5074,6 +5074,7 @@ int hci\_dev\_close\_sync(struct hci\_dev \*hdev) memset(hdev->eir, 0, sizeof(hdev->eir)); memset(hdev->dev\_class, 0, sizeof(hdev->dev\_class)); bacpy(&hdev->random\_addr, BDADDR\_ANY);+ hci\_codec\_list\_clear(&hdev->local\_codecs);  hci\_dev\_put(hdev); return err; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:41:23 +0000



=== Content from git.kernel.org_b4cd8f4c_20250110_164245.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=626535077ba9dc110787540d1fe24881094c15a1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=626535077ba9dc110787540d1fe24881094c15a1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=626535077ba9dc110787540d1fe24881094c15a1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=626535077ba9dc110787540d1fe24881094c15a1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-09-15 13:24:47 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:00:38 +0200 |
| commit | [626535077ba9dc110787540d1fe24881094c15a1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=626535077ba9dc110787540d1fe24881094c15a1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=626535077ba9dc110787540d1fe24881094c15a1)) | |
| tree | [b4b7950d681ea9fd01bbcff2172422acbc8aeea5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=626535077ba9dc110787540d1fe24881094c15a1) | |
| parent | [01afbfb39585b8f74398b435c05767204d960b6c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=01afbfb39585b8f74398b435c05767204d960b6c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=626535077ba9dc110787540d1fe24881094c15a1&id2=01afbfb39585b8f74398b435c05767204d960b6c)) | |
| download | [linux-626535077ba9dc110787540d1fe24881094c15a1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-626535077ba9dc110787540d1fe24881094c15a1.tar.gz) | |

Bluetooth: hci\_codec: Fix leaking content of local\_codecscommit b938790e70540bf4f2e653dcd74b232494d06c8f upstream.
The following memory leak can be observed when the controller supports
codecs which are stored in local\_codecs list but the elements are never
freed:
unreferenced object 0xffff88800221d840 (size 32):
comm "kworker/u3:0", pid 36, jiffies 4294898739 (age 127.060s)
hex dump (first 32 bytes):
f8 d3 02 03 80 88 ff ff 80 d8 21 02 80 88 ff ff ..........!.....
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
backtrace:
[<ffffffffb324f557>] \_\_kmalloc+0x47/0x120
[<ffffffffb39ef37d>] hci\_codec\_list\_add.isra.0+0x2d/0x160
[<ffffffffb39ef643>] hci\_read\_codec\_capabilities+0x183/0x270
[<ffffffffb39ef9ab>] hci\_read\_supported\_codecs+0x1bb/0x2d0
[<ffffffffb39f162e>] hci\_read\_local\_codecs\_sync+0x3e/0x60
[<ffffffffb39ff1b3>] hci\_dev\_open\_sync+0x943/0x11e0
[<ffffffffb396d55d>] hci\_power\_on+0x10d/0x3f0
[<ffffffffb30c99b4>] process\_one\_work+0x404/0x800
[<ffffffffb30ca134>] worker\_thread+0x374/0x670
[<ffffffffb30d9108>] kthread+0x188/0x1c0
[<ffffffffb304db6b>] ret\_from\_fork+0x2b/0x50
[<ffffffffb300206a>] ret\_from\_fork\_asm+0x1a/0x30
Cc: stable@vger.kernel.org
Fixes: 8961987f3f5f ("Bluetooth: Enumerate local supported codec and cache details")
Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=626535077ba9dc110787540d1fe24881094c15a1)

| -rw-r--r-- | [net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_core.c?id=626535077ba9dc110787540d1fe24881094c15a1) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_event.c?id=626535077ba9dc110787540d1fe24881094c15a1) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/bluetooth/hci_sync.c?id=626535077ba9dc110787540d1fe24881094c15a1) | 1 | |  |  |  | | --- | --- | --- | |

3 files changed, 3 insertions, 0 deletions

| diff --git a/net/bluetooth/hci\_core.c b/net/bluetooth/hci\_core.cindex fa4dd5fab0d444..d13b498f148cc1 100644--- a/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=01afbfb39585b8f74398b435c05767204d960b6c)+++ b/[net/bluetooth/hci\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_core.c?id=626535077ba9dc110787540d1fe24881094c15a1)@@ -2783,6 +2783,7 @@ void hci\_release\_dev(struct hci\_dev \*hdev) hci\_conn\_params\_clear\_all(hdev); hci\_discovery\_filter\_clear(hdev); hci\_blocked\_keys\_clear(hdev);+ hci\_codec\_list\_clear(&hdev->local\_codecs); hci\_dev\_unlock(hdev);  ida\_simple\_remove(&hci\_index\_ida, hdev->id);diff --git a/net/bluetooth/hci\_event.c b/net/bluetooth/hci\_event.cindex 83eaf25ece465d..e4d8857716eb7b 100644--- a/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=01afbfb39585b8f74398b435c05767204d960b6c)+++ b/[net/bluetooth/hci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_event.c?id=626535077ba9dc110787540d1fe24881094c15a1)@@ -32,6 +32,7 @@  #include "hci\_request.h" #include "hci\_debugfs.h"+#include "hci\_codec.h" #include "a2mp.h" #include "amp.h" #include "smp.h"diff --git a/net/bluetooth/hci\_sync.c b/net/bluetooth/hci\_sync.cindex 2ae038dfc39f71..48dd1924991bee 100644--- a/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=01afbfb39585b8f74398b435c05767204d960b6c)+++ b/[net/bluetooth/hci\_sync.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/bluetooth/hci_sync.c?id=626535077ba9dc110787540d1fe24881094c15a1)@@ -5033,6 +5033,7 @@ int hci\_dev\_close\_sync(struct hci\_dev \*hdev) memset(hdev->eir, 0, sizeof(hdev->eir)); memset(hdev->dev\_class, 0, sizeof(hdev->dev\_class)); bacpy(&hdev->random\_addr, BDADDR\_ANY);+ hci\_codec\_list\_clear(&hdev->local\_codecs);  hci\_dev\_put(hdev); return err; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:41:22 +0000


