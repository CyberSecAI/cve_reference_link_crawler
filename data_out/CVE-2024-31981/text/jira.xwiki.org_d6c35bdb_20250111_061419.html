

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21337)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21337)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-21337](/browse/XWIKI-21337)

# Privilege escalation (PR) from user registration through PDFClass

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21337 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.10.20](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.20 "14.10.20 "), [15.5.4](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.5.4 "15.5.4 "), [15.10-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.10-rc-1 "15.10-rc-1 ")
* **Affects Version/s:**
  3.0.1
* **Component/s:**
  [Old Core - PDF export](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Old+Core+-+PDF+export%22 "Old Core - PDF export ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_guest](/issues/?jql=labels+%3D+attacker_guest "attacker_guest")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. Register a new user account with username PDFClass.
2. Switch your user account to advanced.
3. Use the class editor on the user profile and create a new "TextArea" property with name "style". Set the content type to "Plain Text".
4. Use the object editor on the user profile and add a new object of PDFClass. Set the "style" attribute to $services.logging.getLogger('PDFClass').error("I got programming: $services.security.authorization.hasAccess('programming')").
5. Open <xwiki-server>/xwiki/bin/export/Main/WebHome?format=pdf&pdfcover=1&pdfcover=0&pdftoc=1&pdftoc=0&pdfheader=1&pdfheader=0&pdffooter=1&pdffooter=0&comments=0&attachments=0&pdftemplate=XWiki.PDFClass where <xwiki-server> is the URL of your XWiki installation.

**Expected result:**

No error is logged.

**Actual result:**

An error message

```
2023-09-21 10:38:47,090 [qtp2005169944-130 - http://localhost:8080/xwiki/bin/export/Main/WebHome?format=pdf&pdfcover=1&pdfcover=0&pdftoc=1&pdftoc=0&pdfheader=1&pdfheader=0&pdffooter=1&pdffooter=0&comments=0&attachments=0&pdftemplate=XWiki.PDFClass] ERROR PDFClass                       - I got programming: true

```

is logged, showing that we have executed Velocity code with programming right.

I put 14.10 as affects version but I'm sure the vulnerability is older.

The demonstrated attack only works when user registration is enabled. When user registration is disabled, the attack could still work but in this case it is necessary that the PDFClass has already been created by an admin (to customize PDF or office export as [documented](https://www.xwiki.org/xwiki/bin/view/Documentation/AdminGuide/Configuration/#HCustomizingthePDFexportLook26Feel)). In this case, start at step 3 and adjust the export URL accordingly to reference the page where you created the object.

#### Attachments

#### Issue Links

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Security Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-vxwr-wpjv-qjq7)

#### Activity

#### People

Assignee:

![pjeanjean](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Pierre Jeanjean

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

21/Sep/23 10:59

Updated:

10/Apr/24 09:52

Resolved:

16/Nov/23 16:30

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

