

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Roger Pau Monne <roger.pau@citrix.com> | 2021-06-07 15:13:15 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-10 13:41:49 +0200 |
| commit | [caec9bcaeb1a5f03f2d406305355c853af10c13e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)) | |
| tree | [3cd95f83bd6b1aec763d5e3da828299359318fd1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e) | |
| parent | [2682184605848ae28866bf71c7d4774bda7badfc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2682184605848ae28866bf71c7d4774bda7badfc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e&id2=2682184605848ae28866bf71c7d4774bda7badfc)) | |
| download | [linux-caec9bcaeb1a5f03f2d406305355c853af10c13e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-caec9bcaeb1a5f03f2d406305355c853af10c13e.tar.gz) | |

xen-netback: take a reference to the RX task threadcommit 107866a8eb0b664675a260f1ba0655010fac1e08 upstream.
Do this in order to prevent the task from being freed if the thread
returns (which can be triggered by the frontend) before the call to
kthread\_stop done as part of the backend tear down. Not taking the
reference will lead to a use-after-free in that scenario. Such
reference was taken before but dropped as part of the rework done in
2ac061ce97f4.
Reintroduce the reference taking and add a comment this time
explaining why it's needed.
This is XSA-374 / CVE-2021-28691.
Fixes: 2ac061ce97f4 ('xen/netback: cleanup init and deinit code')
Signed-off-by: Roger Pau Monn√© <roger.pau@citrix.com>
Cc: stable@vger.kernel.org
Reviewed-by: Jan Beulich <jbeulich@suse.com>
Reviewed-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)

| -rw-r--r-- | [drivers/net/xen-netback/interface.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/xen-netback/interface.c?id=caec9bcaeb1a5f03f2d406305355c853af10c13e) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/drivers/net/xen-netback/interface.c b/drivers/net/xen-netback/interface.cindex 193b723fe3bd73..c58996c1e23093 100644--- a/[drivers/net/xen-netback/interface.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/xen-netback/interface.c?id=2682184605848ae28866bf71c7d4774bda7badfc)+++ b/[drivers/net/xen-netback/interface.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/xen-netback/interface.c?id=caec9bcaeb1a5f03f2d406305355c853af10c13e)@@ -684,6 +684,7 @@ static void xenvif\_disconnect\_queue(struct xenvif\_queue \*queue) { if (queue->task) { kthread\_stop(queue->task);+ put\_task\_struct(queue->task); queue->task = NULL; } @@ -745,6 +746,11 @@ int xenvif\_connect\_data(struct xenvif\_queue \*queue, if (IS\_ERR(task)) goto kthread\_err; queue->task = task;+ /\*+ \* Take a reference to the task in order to prevent it from being freed+ \* if the thread function returns before kthread\_stop is called.+ \*/+ get\_task\_struct(task);  task = kthread\_run(xenvif\_dealloc\_kthread, queue, "%s-dealloc", queue->name); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:05:02 +0000

