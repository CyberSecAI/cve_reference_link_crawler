=== Content from git.kernel.org_e0021f28_20250110_224215.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2021-06-30 08:49:10 -0400 |
| commit | [41b1e71a2c57366b08dcca1a28b0d45ca69429ce](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)) | |
| tree | [369d8e9b425159454719dcce32e31b9e2fd8b02c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce) | |
| parent | [5b7c925858f9eb5eda853488c46cdd2fc0d932b5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5b7c925858f9eb5eda853488c46cdd2fc0d932b5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce&id2=5b7c925858f9eb5eda853488c46cdd2fc0d932b5)) | |
| download | [linux-41b1e71a2c57366b08dcca1a28b0d45ca69429ce.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-41b1e71a2c57366b08dcca1a28b0d45ca69429ce.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 7838343eb37c54..b6600329a272d5 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=5b7c925858f9eb5eda853488c46cdd2fc0d932b5)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)@@ -372,7 +372,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 41c372573a2894..2ed6850356eadb 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=5b7c925858f9eb5eda853488c46cdd2fc0d932b5)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=41b1e71a2c57366b08dcca1a28b0d45ca69429ce)@@ -1127,8 +1127,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:52 +0000



=== Content from git.kernel.org_3cd0709a_20250110_224217.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-18 09:58:58 +0200 |
| commit | [7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)) | |
| tree | [8aa3c331d6049f48390284bcf2ece289d24a5758](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1) | |
| parent | [20fbcfaaa5715cfcb4a606670381081e3233c171](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20fbcfaaa5715cfcb4a606670381081e3233c171) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1&id2=20fbcfaaa5715cfcb4a606670381081e3233c171)) | |
| download | [linux-7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 17a638f150824a..1cfbbaf6901da6 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=20fbcfaaa5715cfcb4a606670381081e3233c171)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)@@ -374,7 +374,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex ae906deb42e878..85bedeb9ca9f21 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=20fbcfaaa5715cfcb4a606670381081e3233c171)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=7f5a4b24cdbd7372770a02f23e347d7d9a9ac8f1)@@ -1154,8 +1154,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:54 +0000



=== Content from git.kernel.org_f2a0a2f2_20250110_224216.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Jiri Kosina <jkosina@suse.cz> | 2021-05-05 15:52:34 +0200 |
| commit | [6be388f4a35d2ce5ef7dbf635a8964a5da7f799f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)) | |
| tree | [6e4a7f2bd3471fa91be4a74f4eeafe49d77598eb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f) | |
| parent | [48e33befe61a7d407753c53d1a06fc8d6b5dab80](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=48e33befe61a7d407753c53d1a06fc8d6b5dab80) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f&id2=48e33befe61a7d407753c53d1a06fc8d6b5dab80)) | |
| download | [linux-6be388f4a35d2ce5ef7dbf635a8964a5da7f799f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6be388f4a35d2ce5ef7dbf635a8964a5da7f799f.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrlIn hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 86257ce6d61982..4e9077363c962c 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=48e33befe61a7d407753c53d1a06fc8d6b5dab80)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)@@ -374,7 +374,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 271021e20a3f8d..10e922cee4ebbd 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=48e33befe61a7d407753c53d1a06fc8d6b5dab80)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=6be388f4a35d2ce5ef7dbf635a8964a5da7f799f)@@ -1167,8 +1167,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:53 +0000



=== Content from git.kernel.org_8128ab15_20250110_224213.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-18 10:02:48 +0200 |
| commit | [21883bff0fd854e07429a773ff18f1e9658f50e8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21883bff0fd854e07429a773ff18f1e9658f50e8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)) | |
| tree | [759213d2d615036b93c63350bdc932004afd203a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21883bff0fd854e07429a773ff18f1e9658f50e8) | |
| parent | [ed081fd87e8236bb6a0d501ed387695fbfe80834](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ed081fd87e8236bb6a0d501ed387695fbfe80834) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21883bff0fd854e07429a773ff18f1e9658f50e8&id2=ed081fd87e8236bb6a0d501ed387695fbfe80834)) | |
| download | [linux-21883bff0fd854e07429a773ff18f1e9658f50e8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-21883bff0fd854e07429a773ff18f1e9658f50e8.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21883bff0fd854e07429a773ff18f1e9658f50e8)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=21883bff0fd854e07429a773ff18f1e9658f50e8) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=21883bff0fd854e07429a773ff18f1e9658f50e8) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 86257ce6d61982..4e9077363c962c 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=ed081fd87e8236bb6a0d501ed387695fbfe80834)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=21883bff0fd854e07429a773ff18f1e9658f50e8)@@ -374,7 +374,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 3e33eb14118c85..5e79a21c696f1c 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=ed081fd87e8236bb6a0d501ed387695fbfe80834)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=21883bff0fd854e07429a773ff18f1e9658f50e8)@@ -1164,8 +1164,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:51 +0000



=== Content from git.kernel.org_0f01fc46_20250110_224212.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2021-06-30 08:48:10 -0400 |
| commit | [0e280502be1b003c3483ae03fc60dea554fcfa82](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e280502be1b003c3483ae03fc60dea554fcfa82) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)) | |
| tree | [48ecc802abe99c8c87bc4edfa4cb72284f515b7a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e280502be1b003c3483ae03fc60dea554fcfa82) | |
| parent | [e2d88292e7d09fce40ae38c5bf5fc5d26512382e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e2d88292e7d09fce40ae38c5bf5fc5d26512382e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e280502be1b003c3483ae03fc60dea554fcfa82&id2=e2d88292e7d09fce40ae38c5bf5fc5d26512382e)) | |
| download | [linux-0e280502be1b003c3483ae03fc60dea554fcfa82.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0e280502be1b003c3483ae03fc60dea554fcfa82.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e280502be1b003c3483ae03fc60dea554fcfa82)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=0e280502be1b003c3483ae03fc60dea554fcfa82) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=0e280502be1b003c3483ae03fc60dea554fcfa82) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 1e6f8b0d00fb6d..6b6db57b49d69b 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=e2d88292e7d09fce40ae38c5bf5fc5d26512382e)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=0e280502be1b003c3483ae03fc60dea554fcfa82)@@ -377,7 +377,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 4dcce83ca37847..c833948aade05c 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=e2d88292e7d09fce40ae38c5bf5fc5d26512382e)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=0e280502be1b003c3483ae03fc60dea554fcfa82)@@ -1151,8 +1151,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:49 +0000



=== Content from git.kernel.org_bfe6255e_20250110_224222.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2021-06-30 08:49:30 -0400 |
| commit | [c5d3c142f2d57d40c55e65d5622d319125a45366](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d3c142f2d57d40c55e65d5622d319125a45366) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)) | |
| tree | [79679822af6e75a1a1d55976d84757304d300f24](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | |
| parent | [d6fbb33d29cddd61cccf7c647fb41feb6526cf44](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366&id2=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)) | |
| download | [linux-c5d3c142f2d57d40c55e65d5622d319125a45366.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c5d3c142f2d57d40c55e65d5622d319125a45366.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex b0eeb5090c91ef..d51fc2be0e10cc 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=c5d3c142f2d57d40c55e65d5622d319125a45366)@@ -372,7 +372,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 19c53b64e07a11..6adea5a3972451 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=c5d3c142f2d57d40c55e65d5622d319125a45366)@@ -1119,8 +1119,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:59 +0000



=== Content from git.kernel.org_5b31a2bb_20250110_224219.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2021-06-30 08:48:45 -0400 |
| commit | [8c064eece9a51856f3f275104520c7e3017fc5c0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c064eece9a51856f3f275104520c7e3017fc5c0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)) | |
| tree | [0dd5ee04d297a6b9338c9894915574ce14e789cb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8c064eece9a51856f3f275104520c7e3017fc5c0) | |
| parent | [43ab41d973e3e3be389a2819477d8054b9e61903](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43ab41d973e3e3be389a2819477d8054b9e61903) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c064eece9a51856f3f275104520c7e3017fc5c0&id2=43ab41d973e3e3be389a2819477d8054b9e61903)) | |
| download | [linux-8c064eece9a51856f3f275104520c7e3017fc5c0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8c064eece9a51856f3f275104520c7e3017fc5c0.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8c064eece9a51856f3f275104520c7e3017fc5c0)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=8c064eece9a51856f3f275104520c7e3017fc5c0) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=8c064eece9a51856f3f275104520c7e3017fc5c0) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 98916fb4191a75..46b8f4c353deff 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=43ab41d973e3e3be389a2819477d8054b9e61903)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=8c064eece9a51856f3f275104520c7e3017fc5c0)@@ -373,7 +373,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex d07fe33a904572..5a2c55ed33fac9 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=43ab41d973e3e3be389a2819477d8054b9e61903)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=8c064eece9a51856f3f275104520c7e3017fc5c0)@@ -1114,8 +1114,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:56 +0000



=== Content from git.kernel.org_b1fab6f5_20250110_224220.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-18 10:00:03 +0200 |
| commit | [b1e3596416d74ce95cc0b7b38472329a3818f8a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)) | |
| tree | [bfdf54840ddb42fcf782d0f9f2cf67b7a590d57f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | |
| parent | [1dfd9f18ca64475d9d34e2b03955b6308b2282b1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9&id2=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)) | |
| download | [linux-b1e3596416d74ce95cc0b7b38472329a3818f8a9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b1e3596416d74ce95cc0b7b38472329a3818f8a9.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 17a29ee0ac6c23..8d4ac4b9fb9dad 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)@@ -374,7 +374,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 8578db50ad734b..6ed2a97eb55f1f 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)@@ -1156,8 +1156,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:58 +0000


