

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-18 10:00:03 +0200 |
| commit | [b1e3596416d74ce95cc0b7b38472329a3818f8a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)) | |
| tree | [bfdf54840ddb42fcf782d0f9f2cf67b7a590d57f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | |
| parent | [1dfd9f18ca64475d9d34e2b03955b6308b2282b1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9&id2=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)) | |
| download | [linux-b1e3596416d74ce95cc0b7b38472329a3818f8a9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b1e3596416d74ce95cc0b7b38472329a3818f8a9.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex 17a29ee0ac6c23..8d4ac4b9fb9dad 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)@@ -374,7 +374,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 8578db50ad734b..6ed2a97eb55f1f 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=1dfd9f18ca64475d9d34e2b03955b6308b2282b1)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=b1e3596416d74ce95cc0b7b38472329a3818f8a9)@@ -1156,8 +1156,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:58 +0000

