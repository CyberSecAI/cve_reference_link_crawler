

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anirudh Rayabharam <mail@anirudhrb.com> | 2021-04-25 23:03:53 +0530 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2021-06-30 08:49:30 -0400 |
| commit | [c5d3c142f2d57d40c55e65d5622d319125a45366](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c5d3c142f2d57d40c55e65d5622d319125a45366) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)) | |
| tree | [79679822af6e75a1a1d55976d84757304d300f24](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | |
| parent | [d6fbb33d29cddd61cccf7c647fb41feb6526cf44](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366&id2=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)) | |
| download | [linux-c5d3c142f2d57d40c55e65d5622d319125a45366.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c5d3c142f2d57d40c55e65d5622d319125a45366.tar.gz) | |

HID: usbhid: fix info leak in hid\_submit\_ctrl[ Upstream commit 6be388f4a35d2ce5ef7dbf635a8964a5da7f799f ]
In hid\_submit\_ctrl(), the way of calculating the report length doesn't
take into account that report->size can be zero. When running the
syzkaller reproducer, a report of size 0 causes hid\_submit\_ctrl) to
calculate transfer\_buffer\_length as 16384. When this urb is passed to
the usb core layer, KMSAN reports an info leak of 16384 bytes.
To fix this, first modify hid\_report\_len() to account for the zero
report size case by using DIV\_ROUND\_UP for the division. Then, call it
from hid\_submit\_ctrl().
Reported-by: syzbot+7c2bb71996f95a82524c@syzkaller.appspotmail.com
Signed-off-by: Anirudh Rayabharam <mail@anirudhrb.com>
Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c5d3c142f2d57d40c55e65d5622d319125a45366)

| -rw-r--r-- | [drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/hid/usbhid/hid-core.c?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/hid.h?id=c5d3c142f2d57d40c55e65d5622d319125a45366) | 3 | |  |  |  | | --- | --- | --- | |

2 files changed, 2 insertions, 3 deletions

| diff --git a/drivers/hid/usbhid/hid-core.c b/drivers/hid/usbhid/hid-core.cindex b0eeb5090c91ef..d51fc2be0e10cc 100644--- a/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)+++ b/[drivers/hid/usbhid/hid-core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/hid/usbhid/hid-core.c?id=c5d3c142f2d57d40c55e65d5622d319125a45366)@@ -372,7 +372,7 @@ static int hid\_submit\_ctrl(struct hid\_device \*hid) raw\_report = usbhid->ctrl[usbhid->ctrltail].raw\_report; dir = usbhid->ctrl[usbhid->ctrltail].dir; - len = ((report->size - 1) >> 3) + 1 + (report->id > 0);+ len = hid\_report\_len(report); if (dir == USB\_DIR\_OUT) { usbhid->urbctrl->pipe = usb\_sndctrlpipe(hid\_to\_usb\_dev(hid), 0); usbhid->urbctrl->transfer\_buffer\_length = len;diff --git a/include/linux/hid.h b/include/linux/hid.hindex 19c53b64e07a11..6adea5a3972451 100644--- a/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=d6fbb33d29cddd61cccf7c647fb41feb6526cf44)+++ b/[include/linux/hid.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/hid.h?id=c5d3c142f2d57d40c55e65d5622d319125a45366)@@ -1119,8 +1119,7 @@ static inline void hid\_hw\_wait(struct hid\_device \*hdev) \*/ static inline u32 hid\_report\_len(struct hid\_report \*report) {- /\* equivalent to DIV\_ROUND\_UP(report->size, 8) + !!(report->id > 0) \*/- return ((report->size - 1) >> 3) + 1 + (report->id > 0);+ return DIV\_ROUND\_UP(report->size, 8) + (report->id > 0); }  int hid\_report\_raw\_event(struct hid\_device \*hid, int type, u8 \*data, u32 size, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:40:59 +0000

