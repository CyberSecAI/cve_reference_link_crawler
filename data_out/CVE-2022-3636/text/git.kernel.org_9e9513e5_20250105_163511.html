

| [cgit logo](/) | [index](/) : [kernel/git/pabeni/net-next.git](/pub/scm/linux/kernel/git/pabeni/net-next.git/) | main master |
| --- | --- | --- |
| pabeni net-next tree | Paolo Abeni |

| [about](/pub/scm/linux/kernel/git/pabeni/net-next.git/about/)[summary](/pub/scm/linux/kernel/git/pabeni/net-next.git/)[refs](/pub/scm/linux/kernel/git/pabeni/net-next.git/refs/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)[log](/pub/scm/linux/kernel/git/pabeni/net-next.git/log/)[tree](/pub/scm/linux/kernel/git/pabeni/net-next.git/tree/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)[commit](/pub/scm/linux/kernel/git/pabeni/net-next.git/commit/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)[diff](/pub/scm/linux/kernel/git/pabeni/net-next.git/diff/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)[stats](/pub/scm/linux/kernel/git/pabeni/net-next.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@oracle.com> | 2022-04-12 12:24:19 +0300 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2022-04-13 12:24:20 +0100 |
| commit | [17a5f6a78dc7b8db385de346092d7d9f9dc24df6](/pub/scm/linux/kernel/git/pabeni/net-next.git/commit/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6) ([patch](/pub/scm/linux/kernel/git/pabeni/net-next.git/patch/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)) | |
| tree | [746342fbc4d2f007828d9eb7829c12ecdd330baa](/pub/scm/linux/kernel/git/pabeni/net-next.git/tree/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6) | |
| parent | [2240514cb6441641111ac1fabab03e9df9972d7f](/pub/scm/linux/kernel/git/pabeni/net-next.git/commit/?id=2240514cb6441641111ac1fabab03e9df9972d7f) ([diff](/pub/scm/linux/kernel/git/pabeni/net-next.git/diff/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6&id2=2240514cb6441641111ac1fabab03e9df9972d7f)) | |
| download | [net-next-17a5f6a78dc7b8db385de346092d7d9f9dc24df6.tar.gz](/pub/scm/linux/kernel/git/pabeni/net-next.git/snapshot/net-next-17a5f6a78dc7b8db385de346092d7d9f9dc24df6.tar.gz) | |

net: ethernet: mtk\_eth\_soc: use after free in \_\_mtk\_ppe\_check\_skb()The \_\_mtk\_foe\_entry\_clear() function frees "entry" so we have to use
the \_safe() version of hlist\_for\_each\_entry() to prevent a use after
free.
Fixes: 33fc42de3327 ("net: ethernet: mtk\_eth\_soc: support creating mac address based offload entries")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/pabeni/net-next.git/diff/?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)

| -rw-r--r-- | [drivers/net/ethernet/mediatek/mtk\_ppe.c](/pub/scm/linux/kernel/git/pabeni/net-next.git/diff/drivers/net/ethernet/mediatek/mtk_ppe.c?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/mediatek/mtk\_ppe.c b/drivers/net/ethernet/mediatek/mtk\_ppe.cindex 282a1f34a88a7f..683f89f8e3b2e2 100644--- a/[drivers/net/ethernet/mediatek/mtk\_ppe.c](/pub/scm/linux/kernel/git/pabeni/net-next.git/tree/drivers/net/ethernet/mediatek/mtk_ppe.c?id=2240514cb6441641111ac1fabab03e9df9972d7f)+++ b/[drivers/net/ethernet/mediatek/mtk\_ppe.c](/pub/scm/linux/kernel/git/pabeni/net-next.git/tree/drivers/net/ethernet/mediatek/mtk_ppe.c?id=17a5f6a78dc7b8db385de346092d7d9f9dc24df6)@@ -600,6 +600,7 @@ void \_\_mtk\_ppe\_check\_skb(struct mtk\_ppe \*ppe, struct sk\_buff \*skb, u16 hash) struct mtk\_foe\_entry \*hwe = &ppe->foe\_table[hash]; struct mtk\_flow\_entry \*entry; struct mtk\_foe\_bridge key = {};+ struct hlist\_node \*n; struct ethhdr \*eh; bool found = false; u8 \*tag;@@ -609,7 +610,7 @@ void \_\_mtk\_ppe\_check\_skb(struct mtk\_ppe \*ppe, struct sk\_buff \*skb, u16 hash) if (FIELD\_GET(MTK\_FOE\_IB1\_STATE, hwe->ib1) == MTK\_FOE\_STATE\_BIND) goto out; - hlist\_for\_each\_entry(entry, head, list) {+ hlist\_for\_each\_entry\_safe(entry, n, head, list) { if (entry->type == MTK\_FLOW\_TYPE\_L2\_SUBFLOW) { if (unlikely(FIELD\_GET(MTK\_FOE\_IB1\_STATE, hwe->ib1) == MTK\_FOE\_STATE\_BIND)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-05 16:33:48 +0000

