=== Content from git.kernel.org_4e283967_20250110_123542.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aa1f912712a109b6306746133de7e5343f016b26)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa1f912712a109b6306746133de7e5343f016b26)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa1f912712a109b6306746133de7e5343f016b26)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa1f912712a109b6306746133de7e5343f016b26)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2021-11-04 15:06:37 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-22 09:30:59 +0100 |
| commit | [aa1f912712a109b6306746133de7e5343f016b26](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aa1f912712a109b6306746133de7e5343f016b26) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aa1f912712a109b6306746133de7e5343f016b26)) | |
| tree | [563c563770b356df1cd1536a05b043beddda3252](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aa1f912712a109b6306746133de7e5343f016b26) | |
| parent | [6859985a2fbda5d1586bf44538853e1be69e85f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6859985a2fbda5d1586bf44538853e1be69e85f7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa1f912712a109b6306746133de7e5343f016b26&id2=6859985a2fbda5d1586bf44538853e1be69e85f7)) | |
| download | [linux-aa1f912712a109b6306746133de7e5343f016b26.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aa1f912712a109b6306746133de7e5343f016b26.tar.gz) | |

scsi: scsi\_debug: Don't call kcalloc() if size arg is zerocommit 3344b58b53a76199dae48faa396e9fc37bf86992 upstream.
If the size arg to kcalloc() is zero, it returns ZERO\_SIZE\_PTR. Because of
that, for a following NULL pointer check to work on the returned pointer,
kcalloc() must not be called with the size arg equal to zero. Return early
without error before the kcalloc() call if size arg is zero.
BUG: KASAN: null-ptr-deref in memcpy include/linux/fortify-string.h:191 [inline]
BUG: KASAN: null-ptr-deref in sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
Write of size 4 at addr 0000000000000010 by task syz-executor.1/22789
CPU: 1 PID: 22789 Comm: syz-executor.1 Not tainted 5.15.0-syzk #1
Hardware name: Red Hat KVM, BIOS 1.13.0-2
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:106
\_\_kasan\_report mm/kasan/report.c:446 [inline]
kasan\_report.cold.14+0x112/0x117 mm/kasan/report.c:459
check\_region\_inline mm/kasan/generic.c:183 [inline]
kasan\_check\_range+0x1a3/0x210 mm/kasan/generic.c:189
memcpy+0x3b/0x60 mm/kasan/shadow.c:66
memcpy include/linux/fortify-string.h:191 [inline]
sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2954 [inline]
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2946 [inline]
resp\_verify+0x49e/0x930 drivers/scsi/scsi\_debug.c:4276
schedule\_resp+0x4d8/0x1a70 drivers/scsi/scsi\_debug.c:5478
scsi\_debug\_queuecommand+0x8c9/0x1ec0 drivers/scsi/scsi\_debug.c:7533
scsi\_dispatch\_cmd drivers/scsi/scsi\_lib.c:1520 [inline]
scsi\_queue\_rq+0x16b0/0x2d40 drivers/scsi/scsi\_lib.c:1699
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1639
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1761
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1838
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:62
blk\_execute\_rq+0xdb/0x360 block/blk-exec.c:102
sg\_scsi\_ioctl drivers/scsi/scsi\_ioctl.c:621 [inline]
scsi\_ioctl+0x8bb/0x15c0 drivers/scsi/scsi\_ioctl.c:930
sg\_ioctl\_common+0x172d/0x2710 drivers/scsi/sg.c:1112
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1165
vfs\_ioctl fs/ioctl.c:51 [inline]
\_\_do\_sys\_ioctl fs/ioctl.c:874 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:860 [inline]
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:860
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy%40oracle.com)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aa1f912712a109b6306746133de7e5343f016b26)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=aa1f912712a109b6306746133de7e5343f016b26) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex 9188191433439b..b9db6c8225128e 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=6859985a2fbda5d1586bf44538853e1be69e85f7)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=aa1f912712a109b6306746133de7e5343f016b26)@@ -4238,6 +4238,8 @@ static int resp\_verify(struct scsi\_cmnd \*scp, struct sdebug\_dev\_info \*devip) mk\_sense\_invalid\_opcode(scp); return check\_condition\_result; }+ if (vnum == 0)+ return 0; /\* not an error \*/ a\_num = is\_bytchk3 ? 1 : vnum; /\* Treat following check like one for read (i.e. no write) access \*/ ret = check\_device\_access\_params(scp, lba, a\_num, false);@@ -4301,6 +4303,8 @@ static int resp\_report\_zones(struct scsi\_cmnd \*scp, } zs\_lba = get\_unaligned\_be64(cmd + 2); alloc\_len = get\_unaligned\_be32(cmd + 10);+ if (alloc\_len == 0)+ return 0; /\* not an error \*/ rep\_opts = cmd[14] & 0x3f; partial = cmd[14] & 0x80; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:18:34 +0000



=== Content from git.kernel.org_19abbdd1_20250110_123542.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3344b58b53a76199dae48faa396e9fc37bf86992)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3344b58b53a76199dae48faa396e9fc37bf86992)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3344b58b53a76199dae48faa396e9fc37bf86992)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3344b58b53a76199dae48faa396e9fc37bf86992)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2021-11-04 15:06:37 -0500 |
| --- | --- | --- |
| committer | Martin K. Petersen <martin.petersen@oracle.com> | 2021-11-04 23:41:21 -0400 |
| commit | [3344b58b53a76199dae48faa396e9fc37bf86992](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3344b58b53a76199dae48faa396e9fc37bf86992) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3344b58b53a76199dae48faa396e9fc37bf86992)) | |
| tree | [fb1fd82683252687fbdfa8ab29bbfcfce83c847c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3344b58b53a76199dae48faa396e9fc37bf86992) | |
| parent | [703535e6ae1e94c89a9c1396b4c7b6b41160ef0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=703535e6ae1e94c89a9c1396b4c7b6b41160ef0c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3344b58b53a76199dae48faa396e9fc37bf86992&id2=703535e6ae1e94c89a9c1396b4c7b6b41160ef0c)) | |
| download | [linux-3344b58b53a76199dae48faa396e9fc37bf86992.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3344b58b53a76199dae48faa396e9fc37bf86992.tar.gz) | |

scsi: scsi\_debug: Don't call kcalloc() if size arg is zeroIf the size arg to kcalloc() is zero, it returns ZERO\_SIZE\_PTR. Because of
that, for a following NULL pointer check to work on the returned pointer,
kcalloc() must not be called with the size arg equal to zero. Return early
without error before the kcalloc() call if size arg is zero.
BUG: KASAN: null-ptr-deref in memcpy include/linux/fortify-string.h:191 [inline]
BUG: KASAN: null-ptr-deref in sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
Write of size 4 at addr 0000000000000010 by task syz-executor.1/22789
CPU: 1 PID: 22789 Comm: syz-executor.1 Not tainted 5.15.0-syzk #1
Hardware name: Red Hat KVM, BIOS 1.13.0-2
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:106
\_\_kasan\_report mm/kasan/report.c:446 [inline]
kasan\_report.cold.14+0x112/0x117 mm/kasan/report.c:459
check\_region\_inline mm/kasan/generic.c:183 [inline]
kasan\_check\_range+0x1a3/0x210 mm/kasan/generic.c:189
memcpy+0x3b/0x60 mm/kasan/shadow.c:66
memcpy include/linux/fortify-string.h:191 [inline]
sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2954 [inline]
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2946 [inline]
resp\_verify+0x49e/0x930 drivers/scsi/scsi\_debug.c:4276
schedule\_resp+0x4d8/0x1a70 drivers/scsi/scsi\_debug.c:5478
scsi\_debug\_queuecommand+0x8c9/0x1ec0 drivers/scsi/scsi\_debug.c:7533
scsi\_dispatch\_cmd drivers/scsi/scsi\_lib.c:1520 [inline]
scsi\_queue\_rq+0x16b0/0x2d40 drivers/scsi/scsi\_lib.c:1699
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1639
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1761
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1838
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:62
blk\_execute\_rq+0xdb/0x360 block/blk-exec.c:102
sg\_scsi\_ioctl drivers/scsi/scsi\_ioctl.c:621 [inline]
scsi\_ioctl+0x8bb/0x15c0 drivers/scsi/scsi\_ioctl.c:930
sg\_ioctl\_common+0x172d/0x2710 drivers/scsi/sg.c:1112
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1165
vfs\_ioctl fs/ioctl.c:51 [inline]
\_\_do\_sys\_ioctl fs/ioctl.c:874 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:860 [inline]
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:860
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy%40oracle.com)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3344b58b53a76199dae48faa396e9fc37bf86992)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=3344b58b53a76199dae48faa396e9fc37bf86992) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex e008950c3e7f90..8c66e8a1a1f0ce 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=703535e6ae1e94c89a9c1396b4c7b6b41160ef0c)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=3344b58b53a76199dae48faa396e9fc37bf86992)@@ -4259,6 +4259,8 @@ static int resp\_verify(struct scsi\_cmnd \*scp, struct sdebug\_dev\_info \*devip) mk\_sense\_invalid\_opcode(scp); return check\_condition\_result; }+ if (vnum == 0)+ return 0; /\* not an error \*/ a\_num = is\_bytchk3 ? 1 : vnum; /\* Treat following check like one for read (i.e. no write) access \*/ ret = check\_device\_access\_params(scp, lba, a\_num, false);@@ -4322,6 +4324,8 @@ static int resp\_report\_zones(struct scsi\_cmnd \*scp, } zs\_lba = get\_unaligned\_be64(cmd + 2); alloc\_len = get\_unaligned\_be32(cmd + 10);+ if (alloc\_len == 0)+ return 0; /\* not an error \*/ rep\_opts = cmd[14] & 0x3f; partial = cmd[14] & 0x80; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:34:19 +0000



=== Content from git.kernel.org_3903b867_20250110_123542.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=47d11d35203b0aa13533634e270fe2c3610e531b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47d11d35203b0aa13533634e270fe2c3610e531b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47d11d35203b0aa13533634e270fe2c3610e531b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47d11d35203b0aa13533634e270fe2c3610e531b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2021-11-04 15:06:37 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-22 09:32:50 +0100 |
| commit | [47d11d35203b0aa13533634e270fe2c3610e531b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47d11d35203b0aa13533634e270fe2c3610e531b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=47d11d35203b0aa13533634e270fe2c3610e531b)) | |
| tree | [999accb0a185455277442360570ec51e372f79fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47d11d35203b0aa13533634e270fe2c3610e531b) | |
| parent | [d2ccdd4e4efab06178608a34d7bfb20a54104c02](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d2ccdd4e4efab06178608a34d7bfb20a54104c02) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47d11d35203b0aa13533634e270fe2c3610e531b&id2=d2ccdd4e4efab06178608a34d7bfb20a54104c02)) | |
| download | [linux-47d11d35203b0aa13533634e270fe2c3610e531b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-47d11d35203b0aa13533634e270fe2c3610e531b.tar.gz) | |

scsi: scsi\_debug: Don't call kcalloc() if size arg is zerocommit 3344b58b53a76199dae48faa396e9fc37bf86992 upstream.
If the size arg to kcalloc() is zero, it returns ZERO\_SIZE\_PTR. Because of
that, for a following NULL pointer check to work on the returned pointer,
kcalloc() must not be called with the size arg equal to zero. Return early
without error before the kcalloc() call if size arg is zero.
BUG: KASAN: null-ptr-deref in memcpy include/linux/fortify-string.h:191 [inline]
BUG: KASAN: null-ptr-deref in sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
Write of size 4 at addr 0000000000000010 by task syz-executor.1/22789
CPU: 1 PID: 22789 Comm: syz-executor.1 Not tainted 5.15.0-syzk #1
Hardware name: Red Hat KVM, BIOS 1.13.0-2
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:88 [inline]
dump\_stack\_lvl+0x89/0xb5 lib/dump\_stack.c:106
\_\_kasan\_report mm/kasan/report.c:446 [inline]
kasan\_report.cold.14+0x112/0x117 mm/kasan/report.c:459
check\_region\_inline mm/kasan/generic.c:183 [inline]
kasan\_check\_range+0x1a3/0x210 mm/kasan/generic.c:189
memcpy+0x3b/0x60 mm/kasan/shadow.c:66
memcpy include/linux/fortify-string.h:191 [inline]
sg\_copy\_buffer+0x138/0x240 lib/scatterlist.c:974
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2954 [inline]
do\_dout\_fetch drivers/scsi/scsi\_debug.c:2946 [inline]
resp\_verify+0x49e/0x930 drivers/scsi/scsi\_debug.c:4276
schedule\_resp+0x4d8/0x1a70 drivers/scsi/scsi\_debug.c:5478
scsi\_debug\_queuecommand+0x8c9/0x1ec0 drivers/scsi/scsi\_debug.c:7533
scsi\_dispatch\_cmd drivers/scsi/scsi\_lib.c:1520 [inline]
scsi\_queue\_rq+0x16b0/0x2d40 drivers/scsi/scsi\_lib.c:1699
blk\_mq\_dispatch\_rq\_list+0xb9b/0x2700 block/blk-mq.c:1639
\_\_blk\_mq\_sched\_dispatch\_requests+0x28f/0x590 block/blk-mq-sched.c:325
blk\_mq\_sched\_dispatch\_requests+0x105/0x190 block/blk-mq-sched.c:358
\_\_blk\_mq\_run\_hw\_queue+0xe5/0x150 block/blk-mq.c:1761
\_\_blk\_mq\_delay\_run\_hw\_queue+0x4f8/0x5c0 block/blk-mq.c:1838
blk\_mq\_run\_hw\_queue+0x18d/0x350 block/blk-mq.c:1891
blk\_mq\_sched\_insert\_request+0x3db/0x4e0 block/blk-mq-sched.c:474
blk\_execute\_rq\_nowait+0x16b/0x1c0 block/blk-exec.c:62
blk\_execute\_rq+0xdb/0x360 block/blk-exec.c:102
sg\_scsi\_ioctl drivers/scsi/scsi\_ioctl.c:621 [inline]
scsi\_ioctl+0x8bb/0x15c0 drivers/scsi/scsi\_ioctl.c:930
sg\_ioctl\_common+0x172d/0x2710 drivers/scsi/sg.c:1112
sg\_ioctl+0xa2/0x180 drivers/scsi/sg.c:1165
vfs\_ioctl fs/ioctl.c:51 [inline]
\_\_do\_sys\_ioctl fs/ioctl.c:874 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:860 [inline]
\_\_x64\_sys\_ioctl+0x19d/0x220 fs/ioctl.c:860
do\_syscall\_x64 arch/x86/entry/common.c:50 [inline]
do\_syscall\_64+0x3a/0x80 arch/x86/entry/common.c:80
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Link: [https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1636056397-13151-1-git-send-email-george.kennedy%40oracle.com)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Acked-by: Douglas Gilbert <dgilbert@interlog.com>
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47d11d35203b0aa13533634e270fe2c3610e531b)

| -rw-r--r-- | [drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/scsi/scsi_debug.c?id=47d11d35203b0aa13533634e270fe2c3610e531b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/scsi/scsi\_debug.c b/drivers/scsi/scsi\_debug.cindex 84d27938a3a609..0a74f2bf732aff 100644--- a/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=d2ccdd4e4efab06178608a34d7bfb20a54104c02)+++ b/[drivers/scsi/scsi\_debug.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/scsi/scsi_debug.c?id=47d11d35203b0aa13533634e270fe2c3610e531b)@@ -4259,6 +4259,8 @@ static int resp\_verify(struct scsi\_cmnd \*scp, struct sdebug\_dev\_info \*devip) mk\_sense\_invalid\_opcode(scp); return check\_condition\_result; }+ if (vnum == 0)+ return 0; /\* not an error \*/ a\_num = is\_bytchk3 ? 1 : vnum; /\* Treat following check like one for read (i.e. no write) access \*/ ret = check\_device\_access\_params(scp, lba, a\_num, false);@@ -4322,6 +4324,8 @@ static int resp\_report\_zones(struct scsi\_cmnd \*scp, } zs\_lba = get\_unaligned\_be64(cmd + 2); alloc\_len = get\_unaligned\_be32(cmd + 10);+ if (alloc\_len == 0)+ return 0; /\* not an error \*/ rep\_opts = cmd[14] & 0x3f; partial = cmd[14] & 0x80; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:18:37 +0000


