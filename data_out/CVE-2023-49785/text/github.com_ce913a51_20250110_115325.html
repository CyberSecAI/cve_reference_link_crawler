
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FChatGPTNextWeb%2FChatGPT-Next-Web%2Fpull%2F4285)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FChatGPTNextWeb%2FChatGPT-Next-Web%2Fpull%2F4285)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=ChatGPTNextWeb%2FChatGPT-Next-Web)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ChatGPTNextWeb](/ChatGPTNextWeb)
/
**[ChatGPT-Next-Web](/ChatGPTNextWeb/ChatGPT-Next-Web)**
Public

* [Notifications](/login?return_to=%2FChatGPTNextWeb%2FChatGPT-Next-Web) You must be signed in to change notification settings
* [Fork
  60k](/login?return_to=%2FChatGPTNextWeb%2FChatGPT-Next-Web)
* [Star
   78.5k](/login?return_to=%2FChatGPTNextWeb%2FChatGPT-Next-Web)

* [Code](/ChatGPTNextWeb/ChatGPT-Next-Web)
* [Issues
  484](/ChatGPTNextWeb/ChatGPT-Next-Web/issues)
* [Pull requests
  75](/ChatGPTNextWeb/ChatGPT-Next-Web/pulls)
* [Discussions](/ChatGPTNextWeb/ChatGPT-Next-Web/discussions)
* [Actions](/ChatGPTNextWeb/ChatGPT-Next-Web/actions)
* [Projects
  1](/ChatGPTNextWeb/ChatGPT-Next-Web/projects)
* [Security](/ChatGPTNextWeb/ChatGPT-Next-Web/security)
* [Insights](/ChatGPTNextWeb/ChatGPT-Next-Web/pulse)

Additional navigation options

* [Code](/ChatGPTNextWeb/ChatGPT-Next-Web)
* [Issues](/ChatGPTNextWeb/ChatGPT-Next-Web/issues)
* [Pull requests](/ChatGPTNextWeb/ChatGPT-Next-Web/pulls)
* [Discussions](/ChatGPTNextWeb/ChatGPT-Next-Web/discussions)
* [Actions](/ChatGPTNextWeb/ChatGPT-Next-Web/actions)
* [Projects](/ChatGPTNextWeb/ChatGPT-Next-Web/projects)
* [Security](/ChatGPTNextWeb/ChatGPT-Next-Web/security)
* [Insights](/ChatGPTNextWeb/ChatGPT-Next-Web/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FChatGPTNextWeb%2FChatGPT-Next-Web%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FChatGPTNextWeb%2FChatGPT-Next-Web%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Bugfix] Fix CORS SSRF security issue #4285

 Merged

[fred-bf](/fred-bf)
merged 7 commits into
[ChatGPTNextWeb:main](/ChatGPTNextWeb/ChatGPT-Next-Web/tree/main "ChatGPTNextWeb/ChatGPT-Next-Web:main")
from
[fred-bf:fix/cors-ssrf](/fred-bf/ChatGPT-Next-Web/tree/fix/cors-ssrf "fred-bf/ChatGPT-Next-Web:fix/cors-ssrf")

Mar 13, 2024

 Merged

# [[Bugfix] Fix CORS SSRF security issue](#top) #4285

[fred-bf](/fred-bf)
merged 7 commits into
[ChatGPTNextWeb:main](/ChatGPTNextWeb/ChatGPT-Next-Web/tree/main "ChatGPTNextWeb/ChatGPT-Next-Web:main")
from
[fred-bf:fix/cors-ssrf](/fred-bf/ChatGPT-Next-Web/tree/fix/cors-ssrf "fred-bf/ChatGPT-Next-Web:fix/cors-ssrf")

Mar 13, 2024

[Conversation
18](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285)
[Commits
7](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits)
[Checks
3](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/checks)
[Files changed](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![fred-bf](https://avatars.githubusercontent.com/u/157469842?s=60&v=4)](/fred-bf)

Copy link

Contributor

### @fred-bf **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issue-2184372665) ‚Ä¢ edited Loading

Fix CORS SSRF security issue reported by: [#4283](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/issues/4283)

* Migrate Upstash API
* Migrate WebDAV API
* Remove request to `CORS` api

Sorry, something went wrong.

All reactions

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: adjust upstash api](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/9a8497299d11706f096a4fc10ff0ab5af43465c7 "fix: adjust upstash api")`

`[9a84972](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/9a8497299d11706f096a4fc10ff0ab5af43465c7)`

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=80&v=4)](/apps/vercel)
[![Vercel](https://avatars.githubusercontent.com/in/8329?s=40&u=cd19897a18dc3e7a2b0b8be2c6ce135b726c5772&v=4)](https://github.com/apps/vercel)

Copy link

### **[vercel](/apps/vercel) bot** commented [Mar 13, 2024](#issuecomment-1994785034)

| [@fred-bf](https://github.com/fred-bf) is attempting to deploy a commit to the **NextChat** Team on [Vercel](https://vercel.com).  A member of the Team first needs to [authorize it](https://vercel.com/git/authorize?team=NextChat&type=github&job=%7B%22headInfo%22%3A%7B%22sha%22%3A%229a8497299d11706f096a4fc10ff0ab5af43465c7%22%7D%2C%22id%22%3A%22QmVdoaYpiagCZLcM8muhbszeMeKAcoTzHcTVxp2B4QuXwS%22%2C%22org%22%3A%22ChatGPTNextWeb%22%2C%22prId%22%3A4285%2C%22repo%22%3A%22ChatGPT-Next-Web%22%7D). |
| --- |

All reactions

Sorry, something went wrong.

 [![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
requested a review
from [Yidadaa](/Yidadaa)
[March 13, 2024 16:02](#event-12105854069)

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
self-assigned this
[Mar 13, 2024](#event-12105864557)

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)
[![GitHub Actions](https://avatars.githubusercontent.com/in/15368?s=40&u=167a342ed94d2a713daf64a8b476ead2cebe1852&v=4)](https://github.com/apps/github-actions)

Copy link

Contributor

### **[github-actions](/apps/github-actions) bot** commented [Mar 13, 2024](#issuecomment-1994795717)

| Your build has completed!  [Preview deployment](https://4285-vercelpreviewdeployment.pr.nextchat.dev) |
| --- |

All reactions

Sorry, something went wrong.

[![@H0llyW00dzZ](https://avatars.githubusercontent.com/u/17626300?s=80&u=104ae2435dc71b28482382b4ebae817e56bfc5c3&v=4)](/H0llyW00dzZ)

Copy link

Contributor

### **[H0llyW00dzZ](/H0llyW00dzZ)** commented [Mar 13, 2024](#issuecomment-1994810117)

| by the way, for the webdav its difficult to filter |
| --- |

 üëç
1
 jokester reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1994853326)

| by the way, for the webdav its difficult to filter  My current idea is to filter requests by folder and fileName |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1994859929)

| the folder name cannot be changed by user right now |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: add webdav request filter](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/038fa3b301794050ec7e59325aa00f25b3ce3257 "fix: add webdav request filter")`

`[038fa3b](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/038fa3b301794050ec7e59325aa00f25b3ce3257)`

[![@H0llyW00dzZ](https://avatars.githubusercontent.com/u/17626300?s=80&u=104ae2435dc71b28482382b4ebae817e56bfc5c3&v=4)](/H0llyW00dzZ)

Copy link

Contributor

### **[H0llyW00dzZ](/H0llyW00dzZ)** commented [Mar 13, 2024](#issuecomment-1994920999)

| by the way, for the webdav its difficult to filter  My current idea is to filter requests by folder and fileName  There's another approach beyond using folder/fileName.  This approach involves:  Verifying methods for requests. Then, in this [`one`](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/blob/main/app/api/cors/%5B...path%5D/route.ts), apply it exclusively only for syncing WebDAV, Upstah, or others syncing that for implementing in future.  Ref:   * <https://easy-software.com/en/glossary/webdav-protocol/> |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1994948325)

| by the way, for the webdav its difficult to filter  My current idea is to filter requests by folder and fileName  There's another approach beyond using folder/fileName.  This approach involves:  Verifying methods for requests. Then, in this [`one`](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/blob/main/app/api/cors/%5B...path%5D/route.ts), apply it exclusively only for syncing WebDAV, Upstah, or others syncing that for implementing in future.  Ref:   * <https://easy-software.com/en/glossary/webdav-protocol/>  Yes, it is indeed easier to maintain from a development perspective. I'm worried that the loopholes here may be overlooked in the future if we put them all together. It would be more intuitive for each specific interface to maintain the forwarding capability separately. |
| --- |

All reactions

Sorry, something went wrong.

[![@H0llyW00dzZ](https://avatars.githubusercontent.com/u/17626300?s=80&u=104ae2435dc71b28482382b4ebae817e56bfc5c3&v=4)](/H0llyW00dzZ)

Copy link

Contributor

### **[H0llyW00dzZ](/H0llyW00dzZ)** commented [Mar 13, 2024](#issuecomment-1994973013)

| by the way, for the webdav its difficult to filter  My current idea is to filter requests by folder and fileName  There's another approach beyond using folder/fileName. This approach involves: Verifying methods for requests. Then, in this [`one`](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/blob/main/app/api/cors/%5B...path%5D/route.ts), apply it exclusively only for syncing WebDAV, Upstah, or others syncing that for implementing in future. Ref:   * <https://easy-software.com/en/glossary/webdav-protocol/>  Yes, it is indeed easier to maintain from a development perspective. I'm worried that the loopholes here may be overlooked in the future if we put them all together. It would be more intuitive for each specific interface to maintain the forwarding capability separately.  No need to worry, it's possible to modularize it separately, like this example:  [image](https://private-user-images.githubusercontent.com/17626300/312550446-6923ad97-2187-4204-b3b6-572a853a4e43.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MTAzMDQsIm5iZiI6MTczNjUxMDAwNCwicGF0aCI6Ii8xNzYyNjMwMC8zMTI1NTA0NDYtNjkyM2FkOTctMjE4Ny00MjA0LWIzYjYtNTcyYTg1M2E0ZTQzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDExNTMyNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWMyYzc0NTQzYzk0M2I1MDcyNTRhZDRkZDJjMzIzZTdmODg2N2MwMDY5YmM2ZWIzNjdjMTgwN2IyYzc1MWI4MzImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.zbey4PBYfXk6bEPNDA3cJmQPVQIHuR9laau2mCXV-TE)  That method switch golang |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: remove corsFetch](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/eebc334e02e9f5d9f83203c97fbf4622a9141d0a "fix: remove corsFetch")`

`[eebc334](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/eebc334e02e9f5d9f83203c97fbf4622a9141d0a)`

[![jokester](https://avatars.githubusercontent.com/u/802130?s=60&v=4)](/jokester)

**[jokester](/jokester)**
reviewed
[Mar 13, 2024](#pullrequestreview-1934757586)

 [View reviewed changes](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/files/eebc334e02e9f5d9f83203c97fbf4622a9141d0a)

[app/api/upstash/[action]/[...key]/route.ts](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/files/eebc334e02e9f5d9f83203c97fbf4622a9141d0a#diff-fdaae158fa25c6ab2e6937089c510327d9847f8004c4560f33a09bc53a513116)
Outdated

Show resolved

Hide resolved

 [![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
requested a review
from [jokester](/jokester)
[March 13, 2024 17:25](#event-12106915539)

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: change matching pattern](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/86452146540a224a3242238dd07964a26b8df246 "fix: change matching pattern")`

`[8645214](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/86452146540a224a3242238dd07964a26b8df246)`

 [![@fredliang44](https://avatars.githubusercontent.com/u/22412638?s=40&u=3d9527da2691f5b4f7257afdc96ef28431545f89&v=4)](/fredliang44)
[fredliang44](/fredliang44)
[force-pushed](/ChatGPTNextWeb/ChatGPT-Next-Web/compare/1919e76a160f4123f90b7e2c2ca0c77b785a66ad..86452146540a224a3242238dd07964a26b8df246)
the
fix/cors-ssrf

branch
from
[`1919e76`](/ChatGPTNextWeb/ChatGPT-Next-Web/commit/1919e76a160f4123f90b7e2c2ca0c77b785a66ad) to
[`8645214`](/ChatGPTNextWeb/ChatGPT-Next-Web/commit/86452146540a224a3242238dd07964a26b8df246)  [Compare](/ChatGPTNextWeb/ChatGPT-Next-Web/compare/1919e76a160f4123f90b7e2c2ca0c77b785a66ad..86452146540a224a3242238dd07964a26b8df246)
[March 13, 2024 17:26](#event-12106926071)

[![@vercel](https://avatars.githubusercontent.com/in/8329?s=80&v=4)](/apps/vercel)
[![Vercel](https://avatars.githubusercontent.com/in/8329?s=40&u=cd19897a18dc3e7a2b0b8be2c6ce135b726c5772&v=4)](https://github.com/apps/vercel)

Copy link

### **[vercel](/apps/vercel) bot** commented [Mar 13, 2024](#issuecomment-1995097988) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| **The latest updates on your projects**. Learn more about [Vercel for Git ‚ÜóÔ∏é](https://vercel.link/github-learn-more)   | Name | Status | Preview | Comments | Updated (UTC) | | --- | --- | --- | --- | --- | | **nextchat** | ‚úÖ Ready ([Inspect](https://vercel.com/nextchat/nextchat/G1kCK7dp8Caiko8y7zrXnpB2svym)) | [Visit Preview](https://vercel.live/open-feedback/nextchat-git-fork-fred-bf-fix-cors-ssrf-nextchat.vercel.app?via=pr-comment-visit-preview-link&passThrough=1) | üí¨ [**Add feedback**](https://vercel.live/open-feedback/nextchat-git-fork-fred-bf-fix-cors-ssrf-nextchat.vercel.app?via=pr-comment-feedback-link) | Mar 13, 2024 6:22pm | |

All reactions

Sorry, something went wrong.

 [![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://nextchat-8xo5qnsni-nextchat.vercel.app "Deployment has completed")
to
[Preview](https://nextchat-8xo5qnsni-nextchat.vercel.app)
[March 13, 2024 17:31](#event-12106984322)
[View deployment](https://nextchat-8xo5qnsni-nextchat.vercel.app)

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[chore: update cors default path](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/133ce39a13cb90733bc0aac220ea179e34fd4430 "chore: update cors default path")`

`[133ce39](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/133ce39a13cb90733bc0aac220ea179e34fd4430)`

[![jokester](https://avatars.githubusercontent.com/u/802130?s=60&v=4)](/jokester)

**[jokester](/jokester)**
approved these changes
[Mar 13, 2024](#pullrequestreview-1934824187)

 [View reviewed changes](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/files/133ce39a13cb90733bc0aac220ea179e34fd4430)

Copy link

### @jokester **[jokester](/jokester)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

lgtm!!!

This should make it much harder to do bad things with `upstash` / `webdav` APIs.

for `app/api/cors/[...path]/route.ts` I suppose some fix is still needed.

Sorry, something went wrong.

All reactions

[![@Yidadaa](https://avatars.githubusercontent.com/u/16968934?s=80&u=c98e4b11a628e0d18b7774d62dd5c5da9b9dedd3&v=4)](/Yidadaa)

Copy link

Collaborator

### **[Yidadaa](/Yidadaa)** commented [Mar 13, 2024](#issuecomment-1995145175)

| Let's turn it into a RPC, here is a proposal:  ``` type WebDavConfig = {   type: 'webdav',   endpoint: string,   username: string,   password: string }  type UpstashConfig = {   type: 'upstash',   endpoint: string,   username: STORAGE_KEY,   apiKey: string }  type SyncAction = {   type: 'check' } | {   type: 'get',   key: string, } | {   type: 'set',   key: string,   value: string }  type SyncPayload = {   config: WebDavConfig | UpstashConfig,   action: SyncAction }  // client side function createUpstashClient() {   return async check() {     return await call('/api/sync', { /* webdav config */ })   },   // get(key), set(key, value) }  // server side, /api/sync/route.ts async function handle(req) {   const payload = JSON.parse(await req.json()) as SyncPayload;    // dispatch payload to server side check/get/set actions } ```  The main idea is to move all the sync actions that were previously done on the client side to the server side. The downside is that the desktop app can no longer use the sync feature unless we keep the official sync endpoint built in. |
| --- |

 üëç
1
 jokester reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

 [fred-bf](/fred-bf)
added 2 commits
[March 14, 2024 01:56](#commits-pushed-6aaf83f)

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: fix upstash sync issue](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/6aaf83f3c211b3efea63d20f39a58f0c1ab6fa17 "fix: fix upstash sync issue")`

`[6aaf83f](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/6aaf83f3c211b3efea63d20f39a58f0c1ab6fa17)`

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[fix: fix webdav sync issue](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/99aa064319991b6ee53eb9c75bcfeb5a6b0188cb "fix: fix webdav sync issue")`

`[99aa064](/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285/commits/99aa064319991b6ee53eb9c75bcfeb5a6b0188cb)`

[![@jokester](https://avatars.githubusercontent.com/u/802130?s=80&v=4)](/jokester)

Copy link

### **[jokester](/jokester)** commented [Mar 13, 2024](#issuecomment-1995198867)

| move all the sync actions that were previously done on the client side to the server side  Does that mean `/cors` API can be removed ? Because I don't see its other uses if browser can do sync without CORS-capable storage backends. |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1995202728)

| fix: remove corsFetch  cors api already removed in commit [eebc334](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/commit/eebc334e02e9f5d9f83203c97fbf4622a9141d0a) |
| --- |

 üëç
1
 jokester reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1995214892)

| [@Yidadaa](https://github.com/Yidadaa) for native client we can use tauri's http client to perform request without CORS issue. but it may take a while to refactor the code. My idea is that we release a patch version first, and then migrate the whole thing to the new interface. |
| --- |

All reactions

Sorry, something went wrong.

[![@H0llyW00dzZ](https://avatars.githubusercontent.com/u/17626300?s=80&u=104ae2435dc71b28482382b4ebae817e56bfc5c3&v=4)](/H0llyW00dzZ)

Copy link

Contributor

### **[H0llyW00dzZ](/H0llyW00dzZ)** commented [Mar 13, 2024](#issuecomment-1995217868)

| Let's turn it into a RPC, here is a proposal:  ``` type WebDavConfig = {   type: 'webdav',   endpoint: string,   username: string,   password: string }  type UpstashConfig = {   type: 'upstash',   endpoint: string,   username: STORAGE_KEY,   apiKey: string }  type SyncAction = {   type: 'check' } | {   type: 'get',   key: string, } | {   type: 'set',   key: string,   value: string }  type SyncPayload = {   config: WebDavConfig | UpstashConfig,   action: SyncAction }  // client side function createUpstashClient() {   return async check() {     return await call('/api/sync', { /* webdav config */ })   },   // get(key), set(key, value) }  // server side, /api/sync/route.ts async function handle(req) {   const payload = JSON.parse(await req.json()) as SyncPayload;    // dispatch payload to server side check/get/set actions } ```  The main idea is to move all the sync actions that were previously done on the client side to the server side. The downside is that the desktop app can no longer use the sync feature unless we keep the official sync endpoint built in.  It would be better to keep the official sync that can be used in the desktop app because it is more secure and safe (essentially built-in and isolated) in the desktop environment. |
| --- |

All reactions

Sorry, something went wrong.

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
linked an issue
[Mar 13, 2024](#event-12107391439)
that may be
closed
by this pull request

[[Bug] NextChat cors SSRF ÊºèÊ¥ûÔºàCVE-2023-49785Ôºâ
#4283](/ChatGPTNextWeb/ChatGPT-Next-Web/issues/4283)

Closed

 [![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
marked this pull request as ready for review
[March 13, 2024 18:21](#event-12107519736)

 [![@vercel](https://avatars.githubusercontent.com/in/8329?s=40&v=4)](/apps/vercel)
[vercel](/apps/vercel)
bot
[deployed](https://nextchat-km4nspt18-nextchat.vercel.app "Deployment has completed")
to
[Preview](https://nextchat-km4nspt18-nextchat.vercel.app)
[March 13, 2024 18:22](#event-12107530440)
[View deployment](https://nextchat-km4nspt18-nextchat.vercel.app)

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
mentioned this pull request
[Mar 13, 2024](#ref-issue-2184639503)

[[Feature Request]: Switching to unified sync protocol and using tauri http package for native client
#4286](/ChatGPTNextWeb/ChatGPT-Next-Web/issues/4286)

Open

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=80&v=4)](/fred-bf)

Copy link

Contributor

Author

### **[fred-bf](/fred-bf)** commented [Mar 13, 2024](#issuecomment-1995292693)

| Merge the current PR first, and if there is any other questions, you could comment here or file a new issue |
| --- |

All reactions

Sorry, something went wrong.

 Hide details
View details

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)
[fred-bf](/fred-bf)
merged commit [`a22141c`](/ChatGPTNextWeb/ChatGPT-Next-Web/commit/a22141c2ebd8d68d596073dd792cd71314110351)
into
ChatGPTNextWeb:main

[Mar 13, 2024](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285#event-12107586924)
3 checks passed

[gaogao1030](/gaogao1030)
pushed a commit
to gaogao1030/ChatGPT-Next-Web
that referenced
this pull request
[May 16, 2024](#ref-commit-5e99510)
[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf)

`[Merge pull request](/gaogao1030/ChatGPT-Next-Web/commit/5e99510eff8678a296a60f79363d7391e7ffbac6 "Merge pull request #4285 from fred-bf/fix/cors-ssrf

[Bugfix] Fix CORS SSRF security issue") [ChatGPTNextWeb#4285](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/pull/4285) [from fred-bf/fix/cors-ssrf](/gaogao1030/ChatGPT-Next-Web/commit/5e99510eff8678a296a60f79363d7391e7ffbac6 "Merge pull request #4285 from fred-bf/fix/cors-ssrf

[Bugfix] Fix CORS SSRF security issue")`
‚Ä¶

`[5e99510](/gaogao1030/ChatGPT-Next-Web/commit/5e99510eff8678a296a60f79363d7391e7ffbac6)`

```
[Bugfix] Fix CORS SSRF security issue
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FChatGPTNextWeb%2FChatGPT-Next-Web%2Fpull%2F4285)

Reviewers

[![@jokester](https://avatars.githubusercontent.com/u/802130?s=40&v=4)](/jokester) [jokester](/jokester)

jokester approved these changes

[![@Yidadaa](https://avatars.githubusercontent.com/u/16968934?s=40&v=4)](/Yidadaa) [Yidadaa](/Yidadaa)

 Awaiting requested review from Yidadaa

Assignees

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=40&v=4)](/fred-bf) [fred-bf](/fred-bf)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [[Bug] NextChat cors SSRF ÊºèÊ¥ûÔºàCVE-2023-49785Ôºâ](https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web/issues/4283)

4 participants

[![@fred-bf](https://avatars.githubusercontent.com/u/157469842?s=52&v=4)](/fred-bf) [![@H0llyW00dzZ](https://avatars.githubusercontent.com/u/17626300?s=52&v=4)](/H0llyW00dzZ) [![@Yidadaa](https://avatars.githubusercontent.com/u/16968934?s=52&v=4)](/Yidadaa) [![@jokester](https://avatars.githubusercontent.com/u/802130?s=52&v=4)](/jokester)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

