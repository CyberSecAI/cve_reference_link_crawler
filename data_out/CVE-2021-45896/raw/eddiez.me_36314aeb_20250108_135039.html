<!DOCTYPE html>
<html lang="en">
<head>

    <title>Hacking the Nokia Fastmile</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <link rel="preload" as="style" href="/blog/assets/built/screen.css?v=9c5f252c99" />
    <link rel="preload" as="script" href="/blog/assets/built/casper.js?v=9c5f252c99" />

    <link rel="stylesheet" type="text/css" href="/blog/assets/built/screen.css?v=9c5f252c99" />

    <meta name="description" content="Sometimes the best candidate for security research is the one right in front of you. This post summarises research conducted on Nokia Fastmile devices between 2021 and 2023.">
    <link rel="icon" href="https://projectblack.io/blog/content/images/size/w256h256/2023/06/prjblk-favicon.png" type="image/png">
    <link rel="canonical" href="https://projectblack.io/blog/hacking-the-nokia-fastmile/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Research Blog | Project Black ">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Hacking the Nokia Fastmile">
    <meta property="og:description" content="Sometimes the best candidate for security research is the one right in front of you. This post summarises research conducted on Nokia Fastmile devices between 2021 and 2023.">
    <meta property="og:url" content="https://projectblack.io/blog/hacking-the-nokia-fastmile/">
    <meta property="og:image" content="https://projectblack.io/blog/content/images/2024/07/fastmile-feature.png">
    <meta property="article:published_time" content="2024-07-09T01:30:00.000Z">
    <meta property="article:modified_time" content="2024-07-20T07:31:25.000Z">
    <meta property="article:tag" content="Blog Post">
    
    <meta property="article:publisher" content="https://www.facebook.com/ghost">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Hacking the Nokia Fastmile">
    <meta name="twitter:description" content="Sometimes the best candidate for security research is the one right in front of you. This post summarises research conducted on Nokia Fastmile devices between 2021 and 2023.">
    <meta name="twitter:url" content="https://projectblack.io/blog/hacking-the-nokia-fastmile/">
    <meta name="twitter:image" content="https://projectblack.io/blog/content/images/2024/07/fastmile-feature.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Eddie Zhang">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Blog Post">
    <meta name="twitter:site" content="@ghost">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="700">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Research Blog | Project Black ",
        "url": "https://projectblack.io/blog/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://projectblack.io/blog/content/images/2024/06/projectblack-logo.png"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Eddie Zhang",
        "image": {
            "@type": "ImageObject",
            "url": "https://projectblack.io/blog/content/images/2024/01/headshot1.jpg",
            "width": 400,
            "height": 400
        },
        "url": "https://projectblack.io/blog/author/eddie/",
        "sameAs": []
    },
    "headline": "Hacking the Nokia Fastmile",
    "url": "https://projectblack.io/blog/hacking-the-nokia-fastmile/",
    "datePublished": "2024-07-09T01:30:00.000Z",
    "dateModified": "2024-07-20T07:31:25.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://projectblack.io/blog/content/images/2024/07/fastmile-feature.png",
        "width": 1200,
        "height": 700
    },
    "keywords": "Blog Post",
    "description": "Sometimes the best candidate for security research is the one right in front of you. This post summarises research conducted on Nokia Fastmile devices between 2021 and 2023.",
    "mainEntityOfPage": "https://projectblack.io/blog/hacking-the-nokia-fastmile/"
}
    </script>

    <meta name="generator" content="Ghost 5.87">
    <link rel="alternate" type="application/rss+xml" title="Research Blog | Project Black " href="https://projectblack.io/blog/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="ebcd6671647ba1fa8be0a2b6ad" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://projectblack.io/blog/" crossorigin="anonymous"></script>
    
    <link href="https://projectblack.io/blog/webmentions/receive/" rel="webmention">
    <script defer src="/blog/public/cards.min.js?v=9c5f252c99"></script><style>:root {--ghost-accent-color: #000000;}</style>
    <link rel="stylesheet" type="text/css" href="/blog/public/cards.min.css?v=9c5f252c99">
    <style>
    .site-header-content .site-description { font-size: 3rem !important; }
    .site-header-content { min-height: 420px !important; }
    .article-title { font-weight: 700 !important; }
    .post-card-title { font-weight: 700 !important; }
    .post-card-image { background-color: white !important; }
    .post-card-image-link { grid-column: span 1 !important; }
    .post-card-content { grid-column: span 2 !important; }
    .site-footer { padding-bottom: 45px !important; }
    @media (min-width: 1001px) { .post-card-large .post-card-title { font-size: 3rem !important; }}
</style>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-W3QVN5D9');</script>
<!-- End Google Tag Manager -->

</head>
<body class="post-template tag-blog-post is-head-middle-logo has-sans-body has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <div class="gh-head-inner inner">
            <div class="gh-head-brand">
                <a class="gh-head-logo" href="https://projectblack.io/blog">
                        <img src="https://projectblack.io/blog/content/images/2024/06/projectblack-logo.png" alt="Research Blog | Project Black ">
                </a>
                <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger" aria-label="Main Menu"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-home"><a href="https://projectblack.io/">Home</a></li>
    <li class="nav-blog"><a href="https://projectblack.io/blog/">Blog</a></li>
    <li class="nav-about"><a href="https://projectblack.io/blog/about/">About</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                        <button class="gh-search gh-icon-btn" aria-label="Search this site" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
            </div>
        </div>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-blog-post featured image-small">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/blog/tag/blog-post/">Blog Post</a>
                </span>
                <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
        </div>

        <h1 class="article-title">Hacking the Nokia Fastmile</h1>

            <p class="article-excerpt">Sometimes the best candidate for security research is the one right in front of you. This post summarises research conducted on Nokia Fastmile devices between 2021 and 2023.</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list instapaper_ignore">
                <li class="author-list-item">
                    <a href="/blog/author/eddie/" class="author-avatar" aria-label="Read more of Eddie Zhang">
                        <img class="author-profile-image" src="/blog/content/images/size/w100/2024/01/headshot1.jpg" alt="Eddie Zhang" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/blog/author/eddie/">Eddie Zhang</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2024-07-09">Jul 9, 2024</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 17 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="/blog/content/images/size/w300/2024/07/fastmile-feature.png 300w,
                            /blog/content/images/size/w600/2024/07/fastmile-feature.png 600w,
                            /blog/content/images/size/w1000/2024/07/fastmile-feature.png 1000w,
                            /blog/content/images/size/w2000/2024/07/fastmile-feature.png 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="/blog/content/images/size/w2000/2024/07/fastmile-feature.png"
                    alt="Hacking the Nokia Fastmile"
                />
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <p>Optus in Australia used to bundle a 5G gateway called the Nokia Fastmile (1st gen) together with their home 5G broadband packages.</p><p>As of 2024, these devices are no longer used by Optus and have become quite affordable on the second-hand market. They serve as good candidates for backups to fixed-line connections or as replacements for portable devices like Netgear Nighthawks. With their directional antennas, they should offer better reception.</p><h1 id="key-findings">Key Findings</h1><p>If you're reading this article, you might be primarily interested in the key findings. To save you time, I've summarised the most important points from the original research below.</p><h2 id="the-device">The Device</h2><p>These 1st gen Nokia Fastmiles are actually made up of <strong>2 </strong>separate pieces of hardware with an interconnect between them. </p><p>It's effectively a 5G capable Android phone (Snapdragon 855 CPU - the Pixel 4 also uses this chip) + a traditional Nokia (Alcatel-Lucent) router.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Nokia-Fastmile.jpg" class="kg-image" alt="" loading="lazy" width="841" height="421" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Nokia-Fastmile.jpg 600w, https://projectblack.io/blog/content/images/2024/07/Nokia-Fastmile.jpg 841w" sizes="(min-width: 720px) 720px"></figure><p>The router utilises a 5G phone as an uplink to provide internet access to its clients.</p><h3 id="carrier-lock">Carrier Lock</h3><p>With the devices I've encountered, there has been no carrier lock on any of them.</p><p>If your device has a carrier lock you may have to do some of your own research to see if this can be bypassed. I don't have any insight about this and also do not use these devices anymore.</p><h3 id="device-firmware">Device Firmware</h3><p>I've taken the liberty of downloading several firmware versions for the device. Later versions are definitely more stable, but they also patch vulnerabilities that facilitate easier rooting. If you're aiming to obtain root access, be sure to do so before upgrading the firmware.</p>
<!--kg-card-begin: html-->
<table>
<thead>
  <tr>
    <th>Software Version</th>
    <th>Firmware File Name</th>
    <th>UBoot</th>
    <th>Notes</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>3TG00118ABGA31</td>
    <td><a href="https://mega.nz/file/aTA1QB4b#F9_GGPMeriY-sPo6SND2ZsjcqgujZaWqEafKeEDXlR8">5GGW_D010600B94T0101E0031_ota.tar.gz</a></td>
    <td>U-Boot Aug-09-2022--20:45:33</td>
    <td>Admin password F1P3@s+6!H</td>
  </tr>
  <tr>
    <td>3TG00118ABGA17</td>
    <td><a href="https://mega.nz/file/7aBXxI7S#iVinjIS2VAnkIqn_rmm0fgmtsorlcd51Hc9ZJMWBplo">5GGW_D010600B94T0101E0017_ota.tar.gz</a></td>
    <td>U-Boot Aug-12-2021--21:59:07</td>
    <td>ADB disabled, Admin password Nq+L5st7o</td>
  </tr>
  <tr>
    <td>3TG00118ABAD52</td>
    <td><a href="https://mega.nz/file/eHh0mTpD#xvSoaMp49QQasJN4bxrfyZiY13kEoq6cNYZrOwEOejc">5GGW_D010003B37T0101E0052_ota.tar.gz</a></td>
    <td>U-Boot Sep-27-2020--14:00:53</td>
    <td>Can upgrade to ABGA17</td>
  </tr>
  <tr>
    <td>3TG00118ABAC54</td>
    <td>?</td>
    <td>U-Boot Oct-24-2019--10:32:30</td>
    <td></td>
  </tr>
  <tr>
    <td>?</td>
    <td><a href="https://mega.nz/file/zXQAkB4K#3ainad3-FkOjh-6ZCQmL2cadYtCUzlLBkOOfhl9fwJU">5GGW_D010004B41T0101E0053_ota.tar.gz</a></td>
    <td>?</td>
    <td></td>
  </tr>
  <tr>
    <td>3TG00118CBAB08</td>
    <td>?</td>
    <td>?</td>
    <td>Can upgrade to ABAD52</td>
  </tr>
  <tr>
    <td>3TG00118BBAB83</td>
    <td>?</td>
    <td>U-Boot Aug-29-2019--06:31:55</td>
    <td>Cannot upgrade to ABAD52</td>
  </tr>
  <tr>
    <td>3TG00118BBAA55</td>
    <td>?</td>
    <td>U-Boot Jun-21-2019--04:30:38</td>
    <td>Cannot upgrade to ABAD52</td>
  </tr>
</tbody>
</table>
<!--kg-card-end: html-->
<h2 id="getting-superadmin-webui-access">Getting 'SuperAdmin' WebUI Access</h2><p>The WebUI has a superadmin privilege level which has access to additional advanced functionality. I found two ways to access this.</p><p><strong>Authenticated - Privilege Escalation: </strong><a href="https://www.cve.org/CVERecord?id=CVE-2021-45896" rel="noreferrer">CVE-2021-45896</a></p><p>In firmware versions prior to 3TG00118ABAD52, I found that access control is not enforced.</p><p>When logging in, a call is made to POST /login_web_app.cgi.</p><p>If you intercept the response you will see that there is a variable called "is_ctc_admin".</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://projectblack.io/blog/content/images/2024/07/image-2.png" class="kg-image" alt="" loading="lazy" width="857" height="398" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-2.png 600w, https://projectblack.io/blog/content/images/2024/07/image-2.png 857w" sizes="(min-width: 720px) 720px"><figcaption><span style="white-space: pre-wrap;">Change "is_ctc_admin" to 1</span></figcaption></figure><p>If you change this in the response to 1 additional UI elements will be rendered. The vulnerability is a classic access control issue where authorisation is handled only on the client side.</p><p><strong>Hardcoded Credentials - </strong><a href="https://nvd.nist.gov/vuln/detail/CVE-2022-36222">CVE-2022-36222</a></p><p><strong>All </strong>Fastmile devices with that firmware version 3TG00118ABGA17 or below have a 'admin' password of <code>Nq+L5st7o</code>. Use the username 'admin'.</p><p>Versions after that firmware version appear to have a password of <code>F1P3@s+6!H</code> however I'm unable to validate this.</p><h2 id="getting-root">Getting Root</h2><p>As this is 2 devices in 1, you need to obtain root <strong>twice</strong>.</p><h3 id="android-root">Android Root</h3><p>The device has a hidden USB-C port on it (top right circled in yellow on the photo). In older firmware versions, ADB is enabled.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/4032-3024-resize.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/4032-3024-resize.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/4032-3024-resize.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/4032-3024-resize.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/4032-3024-resize.jpg 2000w" sizes="(min-width: 720px) 720px"></figure><p>Plug in a USB-C cable and run <code>adb shell</code>.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-16-50-43.png" class="kg-image" alt="" loading="lazy" width="614" height="289" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-13-16-50-43.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-16-50-43.png 614w"></figure><p>In later firmware versions, ADB is disabled but can be re-enabled via Serial. These terminals are 1.8v logic level and the pins from inside to out are RX, TX, and ground with a baud rate of 115200.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/3024-4033-resize-canvas.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1344" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/3024-4033-resize-canvas.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/3024-4033-resize-canvas.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/3024-4033-resize-canvas.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/3024-4033-resize-canvas.jpg 2000w" sizes="(min-width: 720px) 720px"></figure><h3 id="router-root">Router Root</h3><p>In older versions of Fastmile firmware, when signed into the web UI via the 'admin' account, you can access a configuration backup/restore function.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-4.png" class="kg-image" alt="" loading="lazy" width="974" height="444" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-4.png 600w, https://projectblack.io/blog/content/images/2024/07/image-4.png 974w" sizes="(min-width: 720px) 720px"></figure><p>These backups are encrypted however @thedroidgeek has written a tool for other Nokia routers which also works for the Fastmile: <a href="https://gist.github.com/thedroidgeek/80c379aa43b71015d71da130f85a435a">https://gist.github.com/thedroidgeek/80c379aa43b71015d71da130f85a435a</a></p><p>Using the configuration tool, you need to modify two sections:</p><ol><li>Set <code>TelnetEnable</code> to true.</li><li>Enable the <code>TelnetSshAccount</code>, and set the UserName to <code>ONTUSER</code>.<ol><li>The password for this looks like gibberish but the script linked previously can also be used to decode/generate valid passwords.</li></ol></li></ol><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-18.png" class="kg-image" alt="" loading="lazy" width="749" height="104" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-18.png 600w, https://projectblack.io/blog/content/images/2024/07/image-18.png 749w" sizes="(min-width: 720px) 720px"></figure><p>Upon application of these configuration changes, you should be able to SSH to the device with your password.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-17.png" class="kg-image" alt="" loading="lazy" width="732" height="239" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-17.png 600w, https://projectblack.io/blog/content/images/2024/07/image-17.png 732w" sizes="(min-width: 720px) 720px"></figure><p>Unfortunately, in newer versions of firmware, changing this configuration is much more involved. You'll likely need to:</p><ol><li>Dump the firmware via serial. </li><li>Make changes to the firmware image.</li><li>Write it back to the device.</li></ol><h1 id="original-research">Original Research</h1><h2 id="part-1">Part 1</h2><p>As a part of my 5G home internet offering, Optus bundles a 5G gateway called the Nokia Fastmile. The same device seems to be shipped by T-Mobile for their 5G offering and is passionately known as the 'trashcan' in <a href="https://www.reddit.com/r/tmobileisp">r/tmobileisp</a>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://projectblack.io/blog/content/images/2024/07/ResrcID22518_GW_bottom.png" class="kg-image" alt="" loading="lazy" width="2000" height="1062" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/ResrcID22518_GW_bottom.png 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/ResrcID22518_GW_bottom.png 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/ResrcID22518_GW_bottom.png 1600w, https://projectblack.io/blog/content/images/2024/07/ResrcID22518_GW_bottom.png 2000w" sizes="(min-width: 720px) 720px"><figcaption><span style="white-space: pre-wrap;">Nokia Fastmile Stock Photo</span></figcaption></figure><p>Naturally, the first thing I tried to do is to obtain root access on it.</p><h3 id="finding-a-privilege-escalation-bug">Finding a Privilege Escalation Bug</h3><p>EDIT: This has been assigned <a href="https://www.cve.org/CVERecord?id=CVE-2021-45896">CVE-2021-45896</a>.</p><p>Immediately, the first thing I noticed is that the provided userAdmin credentials printed on the bottom of the device seem to be a low level account. </p><p>Taking a peak at the requests going on when logging in immediately reveals an authenticated privilege escalation vulnerability. This likely also affects other Nokia devices. My firmware version: 3TG00118ABAD52.</p><p>When logging in, a call is made to POST /login_web_app.cgi.</p><p>If you intercept the response you will see that there is a variable called "is_ctc_admin".</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://projectblack.io/blog/content/images/2024/07/image-2-2.png" class="kg-image" alt="" loading="lazy" width="857" height="398" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-2-2.png 600w, https://projectblack.io/blog/content/images/2024/07/image-2-2.png 857w" sizes="(min-width: 720px) 720px"><figcaption><span style="white-space: pre-wrap;">Change "is_ctc_admin" to 1</span></figcaption></figure><p>If you change this in the response to 1 you get access to additional functionality and full admin. The vulnerability is a classic access control issue where authorisation is handled only on the client side.</p><p>Now we have access to an additional tab but also more functionality in some existing tabs.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-4-1.png" class="kg-image" alt="" loading="lazy" width="974" height="444" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-4-1.png 600w, https://projectblack.io/blog/content/images/2024/07/image-4-1.png 974w" sizes="(min-width: 720px) 720px"></figure><h3 id="changing-config">Changing Config</h3><p>Doing some Googling I came across @droidgeeks' writeup about figuring out the format of Nokia's configuration file format and writing a tool to unpack, and pack configuration files so that you can make changes that aren't available through the web interface.</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://web.archive.org/web/20231215084044/https://0x41.cf/reversing/2019/10/08/unlocking-nokia-g240wa.html"><div class="kg-bookmark-content"><div class="kg-bookmark-title">Unlocking IAM’s Nokia G-240W-A router (Part 1) · 0x41.cf</div><div class="kg-bookmark-description"></div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://web.archive.org/web/20231215084044im_/https://0x41.cf/favicon.png" alt=""></div></div><div class="kg-bookmark-thumbnail"><img src="https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png" alt=""></div></a></figure><p>The tool he wrote also works for the Nokia Fastmile: <a href="https://gist.github.com/thedroidgeek/80c379aa43b71015d71da130f85a435a">https://gist.github.com/thedroidgeek/80c379aa43b71015d71da130f85a435a</a></p><p>Following the write-up gets us all the way to SSH/Telnet access to the device however we are stopped by this annoying password prompt for shell access. </p><p>None of the passwords in the configuration file work for this shell password.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-8.png" class="kg-image" alt="" loading="lazy" width="575" height="282"></figure><h3 id="looking-at-hardware">Looking at Hardware</h3><p><a href="https://forums.whirlpool.net.au/user/412332">randomsrvapps</a> over at <a href="https://forums.whirlpool.net.au/archive/3qqq56y3">Whirlpool</a> seems to have managed to get a trivial root shell via UART/ADB revealing that the device is Android based? Lets verify this.</p><p>Flipping the device over we see some ports that seem to be covered (circled in yellow on the photo).</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/4032-3024-resize-1.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/4032-3024-resize-1.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/4032-3024-resize-1.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/4032-3024-resize-1.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/4032-3024-resize-1.jpg 2016w" sizes="(min-width: 720px) 720px"></figure><p>These stickers can only be uncovered from the rear as the stickers they used are quite strong. By undoing circled bolts in red (Torx T15H) and removing the sim card, the feet come off and we can poke out the stickers.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/3024-4032-resize-crop.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="1134" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/3024-4032-resize-crop.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/3024-4032-resize-crop.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/3024-4032-resize-crop.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>As per the thread, plugging into the USB-C port and running ADB shell gives us an immediate root shell on the device.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-16-50-43-1.png" class="kg-image" alt="" loading="lazy" width="614" height="289" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-13-16-50-43-1.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-16-50-43-1.png 614w"></figure><p>Interestingly it has a Snapdragon 855 in it, the same processor that was in previous generation flagships like the Google Pixel 4.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-20-22-43-15.png" class="kg-image" alt="" loading="lazy" width="495" height="263"></figure><p>I also confirmed that you can get this same console access by plugging into the pins outlined in the thread. These terminals are 1.8v logic level and the pins from inside to out are RX, TX, and ground with a baud rate of 115200.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/3024-4033-resize-canvas-1.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1344" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/3024-4033-resize-canvas-1.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/3024-4033-resize-canvas-1.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/3024-4033-resize-canvas-1.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/3024-4033-resize-canvas-1.jpg 2000w" sizes="(min-width: 720px) 720px"></figure><p>Having a poke around via ADB shell reveals some oddities. </p><p>The most noteworthy being that the IP addressing scheme of my local network configured via the WEB-UI (172.10.0.0/24) is non-existent and some random private subnet 192.168.85.0/24 shows up.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-14-26.png" class="kg-image" alt="" loading="lazy" width="633" height="437" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-21-08-14-26.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-14-26.png 633w"></figure><p>Performing a traceroute from my local machine we see traffic get routed through this 192.168.85.1 gateway as well. The first hop is my pfsense firewall (I'm running double NAT).</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-24-13.png" class="kg-image" alt="" loading="lazy" width="580" height="129"></figure><p>This can also be verified by performing a tcpdump with a filter on the Fastmile whilst pinging 9.9.9.9.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-23-56.png" class="kg-image" alt="" loading="lazy" width="735" height="181" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-21-08-23-56.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-23-56.png 735w" sizes="(min-width: 720px) 720px"></figure><p>Why is our IP address 192.168.85.6??</p><p>I immediately copied over a precompiled binary of busybox onto the Fastmile to try to run ARP.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-21-08-28-12.png" class="kg-image" alt="" loading="lazy" width="571" height="190"></figure><p>Then the realisation came.</p><h3 id="two-devices-in-one-box">Two Devices in One Box</h3><p>Nokia have basically taped a 5G capable phone to one of their old Alcatel-Lucent routers and shipped it in a cylindrical box. This also explains why the configuration modification tool earlier worked flawlessly.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Nokia-Fastmile-1.jpg" class="kg-image" alt="" loading="lazy" width="841" height="421" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Nokia-Fastmile-1.jpg 600w, https://projectblack.io/blog/content/images/2024/07/Nokia-Fastmile-1.jpg 841w" sizes="(min-width: 720px) 720px"></figure><p>Having root on the Android side doesn't help at all with getting root on the router side!</p><p>Using this knowledge we can also enable remote Android debugging by first adding a firewall rule. </p><pre><code>iptables -I INPUT 1 -s 192.168.85.6 -j ACCEPT</code></pre><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-22-38-34.png" class="kg-image" alt="" loading="lazy" width="727" height="159" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-13-22-38-34.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-22-38-34.png 727w" sizes="(min-width: 720px) 720px"></figure><p>Enabling remote debugging on a port.</p><pre><code>adb tcpip 5555 //While connected via USB.
</code></pre><p>Then connecting remotely without having to be tethered to the device.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-22-43-12.png" class="kg-image" alt="" loading="lazy" width="701" height="222" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/Screenshot-from-2021-11-13-22-43-12.png 600w, https://projectblack.io/blog/content/images/2024/07/Screenshot-from-2021-11-13-22-43-12.png 701w"></figure><p>Looking back at the physical device again you can even see two different PCB types.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/4032-3026-resize-annotated-2.jpg" class="kg-image" alt="" loading="lazy" width="1144" height="858" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/4032-3026-resize-annotated-2.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/4032-3026-resize-annotated-2.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/4032-3026-resize-annotated-2.jpg 1144w" sizes="(min-width: 720px) 720px"></figure><p>UART pins are also provided for the router side that are easily accessible. These pins are 3.3v logic level and the pins from inside out are ground, RX, TX with a baud rate of 115200.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/4032-3027-resize.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/4032-3027-resize.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/4032-3027-resize.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/4032-3027-resize.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/4032-3027-resize.jpg 2016w" sizes="(min-width: 720px) 720px"></figure><p>Letting it boot whilst connected via UART drops us into the same restricted shell that we had earlier via SSH where we don't know the 'shell' password. Not helpful.</p><h2 id="part-2">Part 2</h2><p>I ordered a second Nokia Fastmile!</p><p>After receiving my second device, I noticed that the second device was on a newer firmware version with the authenticated privilege escalation vulnerability patched out. </p><h3 id="identical-super-admin-passwords">Identical Super Admin Passwords</h3><p>This locks us out of the configuration backup/restore utility.</p><p>Luckily, there's a higher privileged account with the same default password that seems to be baked into every Optus shipped device. </p><pre><code>&lt;WebAccount. n="WebAccount" t="staticObject"&gt;
    &lt;Enable rw="RW" t="boolean" v="True"&gt;&lt;/Enable&gt;
    &lt;Alias t="string" ml="64" rw="RW" dv="cpe-NokiaAlias2" v="cpe-NokiaAlias2"&gt;&lt;/Alias&gt;
    &lt;Priority max="10" min="1" rw="RW" t="unsignedInt" v="1"&gt;&lt;/Priority&gt;
    &lt;UserName ml="64" rw="RW" t="string" v="admin"&gt;&lt;/UserName&gt;
    &lt;Password ml="64" rw="RW" t="string" v="7hrGZUG0NX48jHEq3+Twog==" ealgo="ab"&gt;&lt;/Password&gt;
    &lt;PresetPassword ml="64" rw="RW" t="string" v="7hrGZUG0NX48jHEq3+Twog==" ealgo="ab"&gt;&lt;/PresetPassword&gt;
&lt;/WebAccount.&gt;</code></pre><p>Using the same tricks from last time the password 'decrypts' to <strong>Nq+L5st7o </strong>with the username being admin.</p><p>At least in my case, the password I obtained from my first device also worked on my second device.</p><p>UDPATE: Informed Nokia and as of U-Boot Aug-09-2022--20:45:33 patch version 3TG00118ABGA31 this is no longer available.</p><p>UPDATE 2: This has been assigned <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-36222">CVE-2022-36222</a>.</p><h3 id="diving-into-firmwarerooting-the-router">Diving Into Firmware - Rooting the Router</h3><p>When the device goes to update itself, it very nicely logs the download URL for the firmware.</p><p>Sifting through my own device's logs I managed to download some firmware only to find that it's encrypted.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-6.png" class="kg-image" alt="" loading="lazy" width="515" height="49"></figure><p>Luckily for us some nice person on the internet has posted a download URL for an older firmware version that isn't encrypted. </p><blockquote>https://whrl.pl/RgaV4d</blockquote><p>You'll probably need to be on the Optus network somewhere to reach this: <br><a href="http://macs.optusnet.com.au/firmware/Nokia/5GGW_D010003B37T0101E0052_ota.tar.gz">http://macs.optusnet.com.au/firmware/Nokia/5GGW_D010003B37T0101E0052_ota.tar.gz</a></p><p>Cracking open this older firmware file we see a couple of files. The highlighted one being relevant for the Router side with the zip file being relevant for the Android side.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-7.png" class="kg-image" alt="" loading="lazy" width="527" height="161"></figure><p>Trying to unpack this file we immediately run into a hurdle, it looks like a UBI image but fails to unpack with ubidump. </p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-8-1.png" class="kg-image" alt="" loading="lazy" width="449" height="224"></figure><p>Some Googling brings us to this <a href="https://github.com/nlitsme/ubidump/issues/8">issue</a> which seems to be what we ran into. Several Squashfs volumes inside a UBI image.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-11.png" class="kg-image" alt="" loading="lazy" width="696" height="203" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-11.png 600w, https://projectblack.io/blog/content/images/2024/07/image-11.png 696w"></figure><p>Unpacking the squashfs volume shows us the root filesystem.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-12.png" class="kg-image" alt="" loading="lazy" width="844" height="726" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-12.png 600w, https://projectblack.io/blog/content/images/2024/07/image-12.png 844w" sizes="(min-width: 720px) 720px"></figure><h4 id="configuration-manager">Configuration Manager</h4><p>After running strings on the config manager binary and sifting through the results, a single line caught my eye.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-16.png" class="kg-image" alt="" loading="lazy" width="782" height="617" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-16.png 600w, https://projectblack.io/blog/content/images/2024/07/image-16.png 782w" sizes="(min-width: 720px) 720px"></figure><p>Adding management users sounds like something I want to do.</p><p>In the middle of this script there's also a very interesting if statement (<a href="https://gist.github.com/eddiez9/e5dd711488a26d08ce14732983de6b07">full script</a> for those interested). </p><pre><code class="language-add_user_mgnt.sh">if [ -e /usr/sbin/vtysh -a "$user_name" != "ONTUSER" -a "$OPID" != "0000" -a "OPID" != "9999" ]; then
   adduser -D -h ${home_dir}/${user_name} -G wheel ${user_name} -s /usr/sbin/vtysh
else
   adduser -D -h ${home_dir}/${user_name} -G wheel ${user_name}
fi</code></pre><p>At this point, we know:</p><ul><li>We have access to change the config of the router including managing users</li><li>This script is called by the Configuration Manager at some point</li><li>If the username == ONTUSER OR if the OperatorID == (9999 OR 1111) then users are created with the <strong>default shell</strong> instead of the <strong>jail shell</strong></li></ul><p>Sure enough, by changing the "TelnetSshAccount" username to "ONTUSER" and SSHing we are greeted with full root access instead of a jail shell.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-17-1.png" class="kg-image" alt="" loading="lazy" width="732" height="239" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-17-1.png 600w, https://projectblack.io/blog/content/images/2024/07/image-17-1.png 732w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-18-1.png" class="kg-image" alt="" loading="lazy" width="749" height="104" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-18-1.png 600w, https://projectblack.io/blog/content/images/2024/07/image-18-1.png 749w" sizes="(min-width: 720px) 720px"></figure><h2 id="other">Other</h2><h3 id="firmware-dumping">Firmware Dumping</h3><h4 id="broadcom-firmware-dumping-via-cfe-bootloader">Broadcom Firmware Dumping via CFE Bootloader</h4><p>When connected via serial, the device conveniently prints out the partition table which will be useful for us.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image.png" class="kg-image" alt="" loading="lazy" width="582" height="221"></figure><p>For demonstration purposes we'll be dumping the <strong>cfgfs</strong> partition which contains things like the configuration files on the Fastmile. </p><p>If we want cfgfs, this means we want to extract all data between addresses: <strong>0x000008800000-0x000009000000</strong></p><p>If you reboot the device again while spamming any key you can interrupt the boot process to get into the CFE bootloader (this only applies to devices which have unlocked CFE bootloaders).</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-13.png" class="kg-image" alt="" loading="lazy" width="385" height="116"></figure><p>This exposes several commands. For the purposes of dumping partitions off the device <code>dn</code> is the one we're interested in.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-17--1-.png" class="kg-image" alt="" loading="lazy" width="527" height="134"></figure><p></p><p><strong><em>Figuring out Block Numbers/Pages</em></strong></p><p>NAND flash is laid out in Dies -&gt; Planes -&gt; Blocks -&gt; Pages, <a href="https://flashdba.com/2014/06/20/understanding-flash-blocks-pages-and-program-erases/">ref</a>. Without diving too deep into the topic, what you practically need to know is that:</p><ul>
<li>The <code>dn</code> command expects you to tell it what block/memory address to start dumping from along with how many subsequent pages to look at.</li>
<li>The Fastmile has 2048 blocks with 64 pages a block.</li>
<li>I figured out the above through trial and error:
<ul>
<li>Attemping to dump a large block number results in an error "Attempt to read block number (5000) beyond the nand max blk(2047), hence there are 2048 blocks.</li>
<li>Attemping to dump block 0 page 64 (index of 0) using <code>dn</code> will actually dump block 1 page 0, meaning each block has 64 pages.</li>
</ul>
</li>
</ul>
<p>Now we need to know how many pages to view starting from 0x8800000.</p><ul>
<li>By running <code>dn 0x8800000 1</code> (dump 1 page from memory address 0x8800000) the tool tells us that 0x8800000 is block 1088.</li>
<li>By running <code>dn 0x9000000 1</code> (dump 1 page from memory address 0x9000000) the tool tells us that 0x9000000 is block 1152.</li>
<li>Subtracting block 1152-1088 means we want to dump 64 blocks.</li>
<li>With 64 pages per block we are looking at dumping a total of 4096 pages.</li>
</ul>
<p>Therefore to dump the cfgfs partition the final command we want is: <code>dn 1088 0 4096</code></p><p><strong><em>Logging and Converting Output</em></strong></p><p>The <code>dn</code> command prints output in a hexdump like format. We want to capture this, remove things from the log we don't need and then convert it to a binary file for final file extraction.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-18--1-.png" class="kg-image" alt="" loading="lazy" width="527" height="134"></figure><p>Capturing the output is pretty simple. I used Putty to do this for me.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-15.png" class="kg-image" alt="" loading="lazy" width="657" height="286" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-15.png 600w, https://projectblack.io/blog/content/images/2024/07/image-15.png 657w"></figure><p>With logging setup, run the <code>dn</code> command from above to dump the pages and wait. </p><p>Once the capture is complete we need to filter the log for information we don't care about. The goal is to remove lines from the log that we don't care about e.g.:</p><ul>
<li>White space lines.</li>
<li>Other descriptive lines (e.g. ------ block blah).</li>
<li>Spare area data for each page.</li>
<li>Any NAND read errors.
<ul>
<li>In my case the entirety of block 1117 needed to be excluded.</li>
</ul>
</li>
</ul>
<p>I wrote a small <a href="https://gist.github.com/eddiez9/2b143adaeaff9f8e003b0e8b088c549b">script</a> to do this for me (you'll want to adjust my exclusion of block 1117 to a more generic error message if you're going to reuse it).</p><p>The cleaned output can be obtained like so:</p><p><code>python3 parse.py dump.log &gt; ~/Workspace/Fastmile/Config/output.log</code></p><p>We need to remove the first column and last column from our output log keeping only columns 2-5 and then convert it to a binary file. This blog here explains in detail what we're trying to do (<a href="https://nstarke.github.io/hexdump/binary/linux/2021/08/27/hexdump-to-binary.html">https://nstarke.github.io/hexdump/binary/linux/2021/08/27/hexdump-to-binary.html</a>).</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-23.png" class="kg-image" alt="" loading="lazy" width="620" height="151" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-23.png 600w, https://projectblack.io/blog/content/images/2024/07/image-23.png 620w"></figure><p>The modified oneliner for us looks like this: <code>cut -d' ' -f2-5 output.log | xxd -r -p &gt; output.bin</code></p><p>Finally, with a bit of luck, you can simply run ubidump on the binary file to extract files. </p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-24.png" class="kg-image" alt="" loading="lazy" width="489" height="105"></figure><p>Taking a browse through we see files like the config_encryption.cfg which is the configuration file that used to be accessible through the Web UI.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-28.png" class="kg-image" alt="" loading="lazy" width="1349" height="113" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-28.png 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/image-28.png 1000w, https://projectblack.io/blog/content/images/2024/07/image-28.png 1349w" sizes="(min-width: 720px) 720px"></figure><h4 id="android-firmware-dumping-via-edl">Android Firmware Dumping via EDL</h4><p><a href="https://www.thecustomdroid.com/qualcomm-edl-mode-guide/">EDL</a> stands for Emergency DownLoad Mode and is a special boot mode normally used by OEMs to allow recovery of bricked devices, force flashes of firmware or dumping of firmware. </p><p>The Fastmile can be put into this mode to obtain a live copy of the Android side's firmware in case the device becomes bricked or you want to analyse it.</p><p>To place the Fastmile into EDL mode, two headers (next to the UART ones) need to be shorted on boot. The power switch button pictured was just used to more conveniently short those 2 pins, but you can use a screwdriver to do this as well.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/WhatsApp-Image-2022-12-11-at-9.30.15-PM--2-.jpeg" class="kg-image" alt="" loading="lazy" width="1200" height="735" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/WhatsApp-Image-2022-12-11-at-9.30.15-PM--2-.jpeg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/WhatsApp-Image-2022-12-11-at-9.30.15-PM--2-.jpeg 1000w, https://projectblack.io/blog/content/images/2024/07/WhatsApp-Image-2022-12-11-at-9.30.15-PM--2-.jpeg 1200w" sizes="(min-width: 720px) 720px"></figure><p>When plugging in a USB-C cable you should then see a device with ID 05c6:9008 appear when you run lsusb.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/2022-12-11_15-45.png" class="kg-image" alt="" loading="lazy" width="855" height="182" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/2022-12-11_15-45.png 600w, https://projectblack.io/blog/content/images/2024/07/2022-12-11_15-45.png 855w" sizes="(min-width: 720px) 720px"></figure><p>From here you can use tools like: <a href="https://github.com/bkerler/edl">https://github.com/bkerler/edl</a> to dump LUNs/partitions from the device and write them back.</p><p>Running <code>edl printgpt --memory=ufs --lun=0</code> lists partitions for LUN0 on the fastmile.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-12--1-.png" class="kg-image" alt="" loading="lazy" width="869" height="353" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-12--1-.png 600w, https://projectblack.io/blog/content/images/2024/07/image-12--1-.png 869w" sizes="(min-width: 720px) 720px"></figure><p><code>edl rf lun0.bin --memory=ufs --lun=0</code> can be used to dump the first LUN to file.</p><p>Other commands: <a href="https://github.com/bkerler/edl#for-ufs-flash">https://github.com/bkerler/edl#for-ufs-flash</a></p><h3 id="teardown">Teardown</h3><p>Out of curiosity, I took the device apart a bit more as I hadn't seen any other write-ups detailing this.</p><p>Tracing back to the step where we'd removed the bottom of the device, the next step of disassembly is to bend back the clips around the perimeter circled in red. I've also circled the UART pins in yellow for clarity.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/clips_resize.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/clips_resize.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/clips_resize.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/clips_resize.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/clips_resize.jpg 2016w" sizes="(min-width: 720px) 720px"></figure><p>Now you can flip the device and lift up the white shell to reveal the antennas.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/antenna-resized.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="2016" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/antenna-resized.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/antenna-resized.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/antenna-resized.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>Every bolt from here on is a Torx T8H. Looking at the top there are 5 bolts to undo which loosen the LED indicator board.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/top-resized.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/top-resized.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/top-resized.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/top-resized.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/top-resized.jpg 2016w" sizes="(min-width: 720px) 720px"></figure><p>With the top LED indicator board off we can see where all the antenna's terminate. If you wanted to attach an external antenna, this is where you'd do it.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/antenna-resized-1.jpg" class="kg-image" alt="" loading="lazy" width="2000" height="1500" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/antenna-resized-1.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/antenna-resized-1.jpg 1000w, https://projectblack.io/blog/content/images/size/w1600/2024/07/antenna-resized-1.jpg 1600w, https://projectblack.io/blog/content/images/2024/07/antenna-resized-1.jpg 2000w" sizes="(min-width: 720px) 720px"></figure><p>Unfortunately, accessibility to the connectors is very limited as some snake under the heatsink. I did try removing the heatsink later but it was pretty solidly bound to the PCB so I'm not sure if it's held together with a thermal epoxy or if I missed some bolts.</p><p>Next up, looking at the side of the device with the smaller heatsink (Android side), there are two more bolts on the diagonal face to loosen.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/phone-side-resized.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="2016" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/phone-side-resized.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/phone-side-resized.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/phone-side-resized.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>This allows you to lift up 2/5 sides of the antenna assembly revealing the Android device.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/phone-resized.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="2016" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/phone-resized.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/phone-resized.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/phone-resized.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>Removing the 4 bolts that hold the Android side in allows you to lift and fold the device over like we've done with the antenna panels.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/phone-flipped-resized.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="2016" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/phone-flipped-resized.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/phone-flipped-resized.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/phone-flipped-resized.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>This also reveals the backside of the Alcatel-Lucent router and the only electrical interconnect between the two devices in the bottom right.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/router-backside-resized-3.jpg" class="kg-image" alt="" loading="lazy" width="1512" height="1134" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/router-backside-resized-3.jpg 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/router-backside-resized-3.jpg 1000w, https://projectblack.io/blog/content/images/2024/07/router-backside-resized-3.jpg 1512w" sizes="(min-width: 720px) 720px"></figure><p>I didn't go any further as the router side is mostly covered up by it's heatsink and if it's anything like the Android side then it was likely to also be difficult to remove.</p><h3 id="weird-stuff">Weird Stuff</h3><p><strong>Backdoor?</strong></p><p>There's a telnet script in the web directory which seems to spin up a telnet server that gives shell access without authentication.</p><p>Couldn't find anywhere this gets called though. ./telnet.sh on will turn the backdoor on and ./telnet.sh st checks the status of the backdoor</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-19.png" class="kg-image" alt="" loading="lazy" width="611" height="312" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-19.png 600w, https://projectblack.io/blog/content/images/2024/07/image-19.png 611w"></figure><h3 id="pipe-path-traversal"><strong>Pipe Path Traversal</strong></h3><p>UPDATE: This has been assigned <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-36221">CVE-2022-36221</a>.</p><p>The CGI script used to read the output of diagnostic pings is affected by a path traversal vulnerability.</p><p>Opening the command_web_app.cgi script up we see that it passes user input straight to the cat.sh script.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-20.png" class="kg-image" alt="" loading="lazy" width="359" height="317"></figure><p>This script performs a check to see if the file is a pipe but otherwise just returns the contents.</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-21.png" class="kg-image" alt="" loading="lazy" width="712" height="201" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-21.png 600w, https://projectblack.io/blog/content/images/2024/07/image-21.png 712w"></figure><p>The result? We have path traversal!</p><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-23-1.png" class="kg-image" alt="" loading="lazy" width="387" height="107"></figure><figure class="kg-card kg-image-card"><img src="https://projectblack.io/blog/content/images/2024/07/image-22.png" class="kg-image" alt="" loading="lazy" width="1057" height="407" srcset="https://projectblack.io/blog/content/images/size/w600/2024/07/image-22.png 600w, https://projectblack.io/blog/content/images/size/w1000/2024/07/image-22.png 1000w, https://projectblack.io/blog/content/images/2024/07/image-22.png 1057w" sizes="(min-width: 720px) 720px"></figure><p>The usefulness of this is dependent on the existence of pipes on the router that contain sensitive information. Also the endpoint is only available as an authenticated user (albeit full admin is not required).</p>
    </section>


</article>
</main>





    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://projectblack.io/blog">Research Blog | Project Black </a> &copy; 2025</section>
            <nav class="site-footer-nav">
                
            </nav>
            <div class="gh-powered-by"><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>

    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="pswp__bg"></div>

    <div class="pswp__scroll-wrap">
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/blog/assets/built/casper.js?v=9c5f252c99"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W3QVN5D9"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

</body>
</html>
