=== Content from git.kernel.org_bb643ada_20250111_184147.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e15f629036bac005fc758b4ad17896cf2312add4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e15f629036bac005fc758b4ad17896cf2312add4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e15f629036bac005fc758b4ad17896cf2312add4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e15f629036bac005fc758b4ad17896cf2312add4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vinicius Costa Gomes <vinicius.gomes@intel.com> | 2021-05-13 17:31:03 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-07-28 14:35:31 +0200 |
| commit | [e15f629036bac005fc758b4ad17896cf2312add4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e15f629036bac005fc758b4ad17896cf2312add4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e15f629036bac005fc758b4ad17896cf2312add4)) | |
| tree | [0e26af7128467a7e443b299be4124b71cb89f287](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e15f629036bac005fc758b4ad17896cf2312add4) | |
| parent | [71046eac2db9aeccf10763d034a1a123911c9a81](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71046eac2db9aeccf10763d034a1a123911c9a81) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e15f629036bac005fc758b4ad17896cf2312add4&id2=71046eac2db9aeccf10763d034a1a123911c9a81)) | |
| download | [linux-e15f629036bac005fc758b4ad17896cf2312add4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e15f629036bac005fc758b4ad17896cf2312add4.tar.gz) | |

igc: Fix use-after-free error during reset[ Upstream commit 56ea7ed103b46970e171eb1c95916f393d64eeff ]
Cleans the next descriptor to watch (next\_to\_watch) when cleaning the
TX ring.
Failure to do so can cause invalid memory accesses. If igc\_poll() runs
while the controller is being reset this can lead to the driver try to
free a skb that was already freed.
Log message:
[ 101.525242] refcount\_t: underflow; use-after-free.
[ 101.525251] WARNING: CPU: 1 PID: 646 at lib/refcount.c:28 refcount\_warn\_saturate+0xab/0xf0
[ 101.525259] Modules linked in: sch\_etf(E) sch\_mqprio(E) rfkill(E) intel\_rapl\_msr(E) intel\_rapl\_common(E)
x86\_pkg\_temp\_thermal(E) intel\_powerclamp(E) coretemp(E) binfmt\_misc(E) kvm\_intel(E) kvm(E) irqbypass(E) crc32\_pclmul(E)
ghash\_clmulni\_intel(E) aesni\_intel(E) mei\_wdt(E) libaes(E) crypto\_simd(E) cryptd(E) glue\_helper(E) snd\_hda\_codec\_hdmi(E)
rapl(E) intel\_cstate(E) snd\_hda\_intel(E) snd\_intel\_dspcfg(E) sg(E) soundwire\_intel(E) intel\_uncore(E) at24(E)
soundwire\_generic\_allocation(E) iTCO\_wdt(E) soundwire\_cadence(E) intel\_pmc\_bxt(E) serio\_raw(E) snd\_hda\_codec(E)
iTCO\_vendor\_support(E) watchdog(E) snd\_hda\_core(E) snd\_hwdep(E) snd\_soc\_core(E) snd\_compress(E) snd\_pcsp(E)
soundwire\_bus(E) snd\_pcm(E) evdev(E) snd\_timer(E) mei\_me(E) snd(E) soundcore(E) mei(E) configfs(E) ip\_tables(E) x\_tables(E)
autofs4(E) ext4(E) crc32c\_generic(E) crc16(E) mbcache(E) jbd2(E) sd\_mod(E) t10\_pi(E) crc\_t10dif(E) crct10dif\_generic(E)
i915(E) ahci(E) libahci(E) ehci\_pci(E) igb(E) xhci\_pci(E) ehci\_hcd(E)
[ 101.525303] drm\_kms\_helper(E) dca(E) xhci\_hcd(E) libata(E) crct10dif\_pclmul(E) cec(E) crct10dif\_common(E) tsn(E) igc(E)
e1000e(E) ptp(E) i2c\_i801(E) crc32c\_intel(E) psmouse(E) i2c\_algo\_bit(E) i2c\_smbus(E) scsi\_mod(E) lpc\_ich(E) pps\_core(E)
usbcore(E) drm(E) button(E) video(E)
[ 101.525318] CPU: 1 PID: 646 Comm: irq/37-enp7s0-T Tainted: G E 5.10.30-rt37-tsn1-rt-ipipe #ipipe
[ 101.525320] Hardware name: SIEMENS AG SIMATIC IPC427D/A5E31233588, BIOS V17.02.09 03/31/2017
[ 101.525322] RIP: 0010:refcount\_warn\_saturate+0xab/0xf0
[ 101.525325] Code: 05 31 48 44 01 01 e8 f0 c6 42 00 0f 0b c3 80 3d 1f 48 44 01 00 75 90 48 c7 c7 78 a8 f3 a6 c6 05 0f 48
44 01 01 e8 d1 c6 42 00 <0f> 0b c3 80 3d fe 47 44 01 00 0f 85 6d ff ff ff 48 c7 c7 d0 a8 f3
[ 101.525327] RSP: 0018:ffffbdedc0917cb8 EFLAGS: 00010286
[ 101.525329] RAX: 0000000000000000 RBX: ffff98fd6becbf40 RCX: 0000000000000001
[ 101.525330] RDX: 0000000000000001 RSI: ffffffffa6f2700c RDI: 00000000ffffffff
[ 101.525332] RBP: ffff98fd6becc14c R08: ffffffffa7463d00 R09: ffffbdedc0917c50
[ 101.525333] R10: ffffffffa74c3578 R11: 0000000000000034 R12: 00000000ffffff00
[ 101.525335] R13: ffff98fd6b0b1000 R14: 0000000000000039 R15: ffff98fd6be35c40
[ 101.525337] FS: 0000000000000000(0000) GS:ffff98fd6e240000(0000) knlGS:0000000000000000
[ 101.525339] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 101.525341] CR2: 00007f34135a3a70 CR3: 0000000150210003 CR4: 00000000001706e0
[ 101.525343] Call Trace:
[ 101.525346] sock\_wfree+0x9c/0xa0
[ 101.525353] unix\_destruct\_scm+0x7b/0xa0
[ 101.525358] skb\_release\_head\_state+0x40/0x90
[ 101.525362] skb\_release\_all+0xe/0x30
[ 101.525364] napi\_consume\_skb+0x57/0x160
[ 101.525367] igc\_poll+0xb7/0xc80 [igc]
[ 101.525376] ? sched\_clock+0x5/0x10
[ 101.525381] ? sched\_clock\_cpu+0xe/0x100
[ 101.525385] net\_rx\_action+0x14c/0x410
[ 101.525388] \_\_do\_softirq+0xe9/0x2f4
[ 101.525391] \_\_local\_bh\_enable\_ip+0xe3/0x110
[ 101.525395] ? irq\_finalize\_oneshot.part.47+0xe0/0xe0
[ 101.525398] irq\_forced\_thread\_fn+0x6a/0x80
[ 101.525401] irq\_thread+0xe8/0x180
[ 101.525403] ? wake\_threads\_waitq+0x30/0x30
[ 101.525406] ? irq\_thread\_check\_affinity+0xd0/0xd0
[ 101.525408] kthread+0x183/0x1a0
[ 101.525412] ? kthread\_park+0x80/0x80
[ 101.525415] ret\_from\_fork+0x22/0x30
Fixes: 13b5b7fd6a4a ("igc: Add support for Tx/Rx rings")
Reported-by: Erez Geva <erez.geva.ext@siemens.com>
Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@intel.com>
Tested-by: Dvora Fuxbrumer <dvorax.fuxbrumer@linux.intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e15f629036bac005fc758b4ad17896cf2312add4)

| -rw-r--r-- | [drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/igc/igc_main.c?id=e15f629036bac005fc758b4ad17896cf2312add4) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/intel/igc/igc\_main.c b/drivers/net/ethernet/intel/igc/igc\_main.cindex 7b822cdcc6c58d..4b58dd97a7c0fd 100644--- a/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=71046eac2db9aeccf10763d034a1a123911c9a81)+++ b/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=e15f629036bac005fc758b4ad17896cf2312add4)@@ -207,6 +207,8 @@ static void igc\_clean\_tx\_ring(struct igc\_ring \*tx\_ring) DMA\_TO\_DEVICE); } + tx\_buffer->next\_to\_watch = NULL;+ /\* move us one more past the eop\_desc for start of next pkt \*/ tx\_buffer++; i++; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:40:24 +0000



=== Content from git.kernel.org_f918e2e3_20250111_184148.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vinicius Costa Gomes <vinicius.gomes@intel.com> | 2021-05-13 17:31:03 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-07-28 14:37:19 +0200 |
| commit | [ea5e36b7367ea0a36ef73a163768f16d2977bd83](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)) | |
| tree | [dd0814a8f2a4a93493133119dc08b6bfa5cd5e96](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83) | |
| parent | [25423f4bd9a9ac3e6b0ce7ecfe56c36f4e514893](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25423f4bd9a9ac3e6b0ce7ecfe56c36f4e514893) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83&id2=25423f4bd9a9ac3e6b0ce7ecfe56c36f4e514893)) | |
| download | [linux-ea5e36b7367ea0a36ef73a163768f16d2977bd83.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ea5e36b7367ea0a36ef73a163768f16d2977bd83.tar.gz) | |

igc: Fix use-after-free error during reset[ Upstream commit 56ea7ed103b46970e171eb1c95916f393d64eeff ]
Cleans the next descriptor to watch (next\_to\_watch) when cleaning the
TX ring.
Failure to do so can cause invalid memory accesses. If igc\_poll() runs
while the controller is being reset this can lead to the driver try to
free a skb that was already freed.
Log message:
[ 101.525242] refcount\_t: underflow; use-after-free.
[ 101.525251] WARNING: CPU: 1 PID: 646 at lib/refcount.c:28 refcount\_warn\_saturate+0xab/0xf0
[ 101.525259] Modules linked in: sch\_etf(E) sch\_mqprio(E) rfkill(E) intel\_rapl\_msr(E) intel\_rapl\_common(E)
x86\_pkg\_temp\_thermal(E) intel\_powerclamp(E) coretemp(E) binfmt\_misc(E) kvm\_intel(E) kvm(E) irqbypass(E) crc32\_pclmul(E)
ghash\_clmulni\_intel(E) aesni\_intel(E) mei\_wdt(E) libaes(E) crypto\_simd(E) cryptd(E) glue\_helper(E) snd\_hda\_codec\_hdmi(E)
rapl(E) intel\_cstate(E) snd\_hda\_intel(E) snd\_intel\_dspcfg(E) sg(E) soundwire\_intel(E) intel\_uncore(E) at24(E)
soundwire\_generic\_allocation(E) iTCO\_wdt(E) soundwire\_cadence(E) intel\_pmc\_bxt(E) serio\_raw(E) snd\_hda\_codec(E)
iTCO\_vendor\_support(E) watchdog(E) snd\_hda\_core(E) snd\_hwdep(E) snd\_soc\_core(E) snd\_compress(E) snd\_pcsp(E)
soundwire\_bus(E) snd\_pcm(E) evdev(E) snd\_timer(E) mei\_me(E) snd(E) soundcore(E) mei(E) configfs(E) ip\_tables(E) x\_tables(E)
autofs4(E) ext4(E) crc32c\_generic(E) crc16(E) mbcache(E) jbd2(E) sd\_mod(E) t10\_pi(E) crc\_t10dif(E) crct10dif\_generic(E)
i915(E) ahci(E) libahci(E) ehci\_pci(E) igb(E) xhci\_pci(E) ehci\_hcd(E)
[ 101.525303] drm\_kms\_helper(E) dca(E) xhci\_hcd(E) libata(E) crct10dif\_pclmul(E) cec(E) crct10dif\_common(E) tsn(E) igc(E)
e1000e(E) ptp(E) i2c\_i801(E) crc32c\_intel(E) psmouse(E) i2c\_algo\_bit(E) i2c\_smbus(E) scsi\_mod(E) lpc\_ich(E) pps\_core(E)
usbcore(E) drm(E) button(E) video(E)
[ 101.525318] CPU: 1 PID: 646 Comm: irq/37-enp7s0-T Tainted: G E 5.10.30-rt37-tsn1-rt-ipipe #ipipe
[ 101.525320] Hardware name: SIEMENS AG SIMATIC IPC427D/A5E31233588, BIOS V17.02.09 03/31/2017
[ 101.525322] RIP: 0010:refcount\_warn\_saturate+0xab/0xf0
[ 101.525325] Code: 05 31 48 44 01 01 e8 f0 c6 42 00 0f 0b c3 80 3d 1f 48 44 01 00 75 90 48 c7 c7 78 a8 f3 a6 c6 05 0f 48
44 01 01 e8 d1 c6 42 00 <0f> 0b c3 80 3d fe 47 44 01 00 0f 85 6d ff ff ff 48 c7 c7 d0 a8 f3
[ 101.525327] RSP: 0018:ffffbdedc0917cb8 EFLAGS: 00010286
[ 101.525329] RAX: 0000000000000000 RBX: ffff98fd6becbf40 RCX: 0000000000000001
[ 101.525330] RDX: 0000000000000001 RSI: ffffffffa6f2700c RDI: 00000000ffffffff
[ 101.525332] RBP: ffff98fd6becc14c R08: ffffffffa7463d00 R09: ffffbdedc0917c50
[ 101.525333] R10: ffffffffa74c3578 R11: 0000000000000034 R12: 00000000ffffff00
[ 101.525335] R13: ffff98fd6b0b1000 R14: 0000000000000039 R15: ffff98fd6be35c40
[ 101.525337] FS: 0000000000000000(0000) GS:ffff98fd6e240000(0000) knlGS:0000000000000000
[ 101.525339] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 101.525341] CR2: 00007f34135a3a70 CR3: 0000000150210003 CR4: 00000000001706e0
[ 101.525343] Call Trace:
[ 101.525346] sock\_wfree+0x9c/0xa0
[ 101.525353] unix\_destruct\_scm+0x7b/0xa0
[ 101.525358] skb\_release\_head\_state+0x40/0x90
[ 101.525362] skb\_release\_all+0xe/0x30
[ 101.525364] napi\_consume\_skb+0x57/0x160
[ 101.525367] igc\_poll+0xb7/0xc80 [igc]
[ 101.525376] ? sched\_clock+0x5/0x10
[ 101.525381] ? sched\_clock\_cpu+0xe/0x100
[ 101.525385] net\_rx\_action+0x14c/0x410
[ 101.525388] \_\_do\_softirq+0xe9/0x2f4
[ 101.525391] \_\_local\_bh\_enable\_ip+0xe3/0x110
[ 101.525395] ? irq\_finalize\_oneshot.part.47+0xe0/0xe0
[ 101.525398] irq\_forced\_thread\_fn+0x6a/0x80
[ 101.525401] irq\_thread+0xe8/0x180
[ 101.525403] ? wake\_threads\_waitq+0x30/0x30
[ 101.525406] ? irq\_thread\_check\_affinity+0xd0/0xd0
[ 101.525408] kthread+0x183/0x1a0
[ 101.525412] ? kthread\_park+0x80/0x80
[ 101.525415] ret\_from\_fork+0x22/0x30
Fixes: 13b5b7fd6a4a ("igc: Add support for Tx/Rx rings")
Reported-by: Erez Geva <erez.geva.ext@siemens.com>
Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@intel.com>
Tested-by: Dvora Fuxbrumer <dvorax.fuxbrumer@linux.intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)

| -rw-r--r-- | [drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/igc/igc_main.c?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/intel/igc/igc\_main.c b/drivers/net/ethernet/intel/igc/igc\_main.cindex f1adf154ec4ae1..9cac1e74a2ba52 100644--- a/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=25423f4bd9a9ac3e6b0ce7ecfe56c36f4e514893)+++ b/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=ea5e36b7367ea0a36ef73a163768f16d2977bd83)@@ -217,6 +217,8 @@ static void igc\_clean\_tx\_ring(struct igc\_ring \*tx\_ring) DMA\_TO\_DEVICE); } + tx\_buffer->next\_to\_watch = NULL;+ /\* move us one more past the eop\_desc for start of next pkt \*/ tx\_buffer++; i++; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:40:25 +0000



=== Content from git.kernel.org_30fc646f_20250111_184144.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vinicius Costa Gomes <vinicius.gomes@intel.com> | 2021-05-13 17:31:03 -0700 |
| --- | --- | --- |
| committer | Tony Nguyen <anthony.l.nguyen@intel.com> | 2021-07-01 10:51:50 -0700 |
| commit | [56ea7ed103b46970e171eb1c95916f393d64eeff](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56ea7ed103b46970e171eb1c95916f393d64eeff) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)) | |
| tree | [6b742caf9e2649329b7694ee55a54a1c7c467154](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56ea7ed103b46970e171eb1c95916f393d64eeff) | |
| parent | [dbe69e43372212527abf48609aba7fc39a6daa27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=dbe69e43372212527abf48609aba7fc39a6daa27) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56ea7ed103b46970e171eb1c95916f393d64eeff&id2=dbe69e43372212527abf48609aba7fc39a6daa27)) | |
| download | [linux-56ea7ed103b46970e171eb1c95916f393d64eeff.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-56ea7ed103b46970e171eb1c95916f393d64eeff.tar.gz) | |

igc: Fix use-after-free error during resetCleans the next descriptor to watch (next\_to\_watch) when cleaning the
TX ring.
Failure to do so can cause invalid memory accesses. If igc\_poll() runs
while the controller is being reset this can lead to the driver try to
free a skb that was already freed.
Log message:
[ 101.525242] refcount\_t: underflow; use-after-free.
[ 101.525251] WARNING: CPU: 1 PID: 646 at lib/refcount.c:28 refcount\_warn\_saturate+0xab/0xf0
[ 101.525259] Modules linked in: sch\_etf(E) sch\_mqprio(E) rfkill(E) intel\_rapl\_msr(E) intel\_rapl\_common(E)
x86\_pkg\_temp\_thermal(E) intel\_powerclamp(E) coretemp(E) binfmt\_misc(E) kvm\_intel(E) kvm(E) irqbypass(E) crc32\_pclmul(E)
ghash\_clmulni\_intel(E) aesni\_intel(E) mei\_wdt(E) libaes(E) crypto\_simd(E) cryptd(E) glue\_helper(E) snd\_hda\_codec\_hdmi(E)
rapl(E) intel\_cstate(E) snd\_hda\_intel(E) snd\_intel\_dspcfg(E) sg(E) soundwire\_intel(E) intel\_uncore(E) at24(E)
soundwire\_generic\_allocation(E) iTCO\_wdt(E) soundwire\_cadence(E) intel\_pmc\_bxt(E) serio\_raw(E) snd\_hda\_codec(E)
iTCO\_vendor\_support(E) watchdog(E) snd\_hda\_core(E) snd\_hwdep(E) snd\_soc\_core(E) snd\_compress(E) snd\_pcsp(E)
soundwire\_bus(E) snd\_pcm(E) evdev(E) snd\_timer(E) mei\_me(E) snd(E) soundcore(E) mei(E) configfs(E) ip\_tables(E) x\_tables(E)
autofs4(E) ext4(E) crc32c\_generic(E) crc16(E) mbcache(E) jbd2(E) sd\_mod(E) t10\_pi(E) crc\_t10dif(E) crct10dif\_generic(E)
i915(E) ahci(E) libahci(E) ehci\_pci(E) igb(E) xhci\_pci(E) ehci\_hcd(E)
[ 101.525303] drm\_kms\_helper(E) dca(E) xhci\_hcd(E) libata(E) crct10dif\_pclmul(E) cec(E) crct10dif\_common(E) tsn(E) igc(E)
e1000e(E) ptp(E) i2c\_i801(E) crc32c\_intel(E) psmouse(E) i2c\_algo\_bit(E) i2c\_smbus(E) scsi\_mod(E) lpc\_ich(E) pps\_core(E)
usbcore(E) drm(E) button(E) video(E)
[ 101.525318] CPU: 1 PID: 646 Comm: irq/37-enp7s0-T Tainted: G E 5.10.30-rt37-tsn1-rt-ipipe #ipipe
[ 101.525320] Hardware name: SIEMENS AG SIMATIC IPC427D/A5E31233588, BIOS V17.02.09 03/31/2017
[ 101.525322] RIP: 0010:refcount\_warn\_saturate+0xab/0xf0
[ 101.525325] Code: 05 31 48 44 01 01 e8 f0 c6 42 00 0f 0b c3 80 3d 1f 48 44 01 00 75 90 48 c7 c7 78 a8 f3 a6 c6 05 0f 48
44 01 01 e8 d1 c6 42 00 <0f> 0b c3 80 3d fe 47 44 01 00 0f 85 6d ff ff ff 48 c7 c7 d0 a8 f3
[ 101.525327] RSP: 0018:ffffbdedc0917cb8 EFLAGS: 00010286
[ 101.525329] RAX: 0000000000000000 RBX: ffff98fd6becbf40 RCX: 0000000000000001
[ 101.525330] RDX: 0000000000000001 RSI: ffffffffa6f2700c RDI: 00000000ffffffff
[ 101.525332] RBP: ffff98fd6becc14c R08: ffffffffa7463d00 R09: ffffbdedc0917c50
[ 101.525333] R10: ffffffffa74c3578 R11: 0000000000000034 R12: 00000000ffffff00
[ 101.525335] R13: ffff98fd6b0b1000 R14: 0000000000000039 R15: ffff98fd6be35c40
[ 101.525337] FS: 0000000000000000(0000) GS:ffff98fd6e240000(0000) knlGS:0000000000000000
[ 101.525339] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 101.525341] CR2: 00007f34135a3a70 CR3: 0000000150210003 CR4: 00000000001706e0
[ 101.525343] Call Trace:
[ 101.525346] sock\_wfree+0x9c/0xa0
[ 101.525353] unix\_destruct\_scm+0x7b/0xa0
[ 101.525358] skb\_release\_head\_state+0x40/0x90
[ 101.525362] skb\_release\_all+0xe/0x30
[ 101.525364] napi\_consume\_skb+0x57/0x160
[ 101.525367] igc\_poll+0xb7/0xc80 [igc]
[ 101.525376] ? sched\_clock+0x5/0x10
[ 101.525381] ? sched\_clock\_cpu+0xe/0x100
[ 101.525385] net\_rx\_action+0x14c/0x410
[ 101.525388] \_\_do\_softirq+0xe9/0x2f4
[ 101.525391] \_\_local\_bh\_enable\_ip+0xe3/0x110
[ 101.525395] ? irq\_finalize\_oneshot.part.47+0xe0/0xe0
[ 101.525398] irq\_forced\_thread\_fn+0x6a/0x80
[ 101.525401] irq\_thread+0xe8/0x180
[ 101.525403] ? wake\_threads\_waitq+0x30/0x30
[ 101.525406] ? irq\_thread\_check\_affinity+0xd0/0xd0
[ 101.525408] kthread+0x183/0x1a0
[ 101.525412] ? kthread\_park+0x80/0x80
[ 101.525415] ret\_from\_fork+0x22/0x30
Fixes: 13b5b7fd6a4a ("igc: Add support for Tx/Rx rings")
Reported-by: Erez Geva <erez.geva.ext@siemens.com>
Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@intel.com>
Tested-by: Dvora Fuxbrumer <dvorax.fuxbrumer@linux.intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56ea7ed103b46970e171eb1c95916f393d64eeff)

| -rw-r--r-- | [drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/igc/igc_main.c?id=56ea7ed103b46970e171eb1c95916f393d64eeff) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/intel/igc/igc\_main.c b/drivers/net/ethernet/intel/igc/igc\_main.cindex 95323095094dd7..1d00a63eb935cc 100644--- a/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=dbe69e43372212527abf48609aba7fc39a6daa27)+++ b/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=56ea7ed103b46970e171eb1c95916f393d64eeff)@@ -232,6 +232,8 @@ static void igc\_clean\_tx\_ring(struct igc\_ring \*tx\_ring) igc\_unmap\_tx\_buffer(tx\_ring->dev, tx\_buffer); } + tx\_buffer->next\_to\_watch = NULL;+ /\* move us one more past the eop\_desc for start of next pkt \*/ tx\_buffer++; i++; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:40:21 +0000



=== Content from git.kernel.org_caa17166_20250111_184145.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Vinicius Costa Gomes <vinicius.gomes@intel.com> | 2021-05-13 17:31:03 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-07-28 13:30:52 +0200 |
| commit | [a9508e0edfe369ac95d0825bcdca976436ce780f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a9508e0edfe369ac95d0825bcdca976436ce780f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)) | |
| tree | [f6d1f309b0d0e4b8a9e656fa25ccd5dff818c046](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a9508e0edfe369ac95d0825bcdca976436ce780f) | |
| parent | [0a0beb1f9120cf49a429e12f4ea69ddd74471d68](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a0beb1f9120cf49a429e12f4ea69ddd74471d68) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a9508e0edfe369ac95d0825bcdca976436ce780f&id2=0a0beb1f9120cf49a429e12f4ea69ddd74471d68)) | |
| download | [linux-a9508e0edfe369ac95d0825bcdca976436ce780f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a9508e0edfe369ac95d0825bcdca976436ce780f.tar.gz) | |

igc: Fix use-after-free error during reset[ Upstream commit 56ea7ed103b46970e171eb1c95916f393d64eeff ]
Cleans the next descriptor to watch (next\_to\_watch) when cleaning the
TX ring.
Failure to do so can cause invalid memory accesses. If igc\_poll() runs
while the controller is being reset this can lead to the driver try to
free a skb that was already freed.
Log message:
[ 101.525242] refcount\_t: underflow; use-after-free.
[ 101.525251] WARNING: CPU: 1 PID: 646 at lib/refcount.c:28 refcount\_warn\_saturate+0xab/0xf0
[ 101.525259] Modules linked in: sch\_etf(E) sch\_mqprio(E) rfkill(E) intel\_rapl\_msr(E) intel\_rapl\_common(E)
x86\_pkg\_temp\_thermal(E) intel\_powerclamp(E) coretemp(E) binfmt\_misc(E) kvm\_intel(E) kvm(E) irqbypass(E) crc32\_pclmul(E)
ghash\_clmulni\_intel(E) aesni\_intel(E) mei\_wdt(E) libaes(E) crypto\_simd(E) cryptd(E) glue\_helper(E) snd\_hda\_codec\_hdmi(E)
rapl(E) intel\_cstate(E) snd\_hda\_intel(E) snd\_intel\_dspcfg(E) sg(E) soundwire\_intel(E) intel\_uncore(E) at24(E)
soundwire\_generic\_allocation(E) iTCO\_wdt(E) soundwire\_cadence(E) intel\_pmc\_bxt(E) serio\_raw(E) snd\_hda\_codec(E)
iTCO\_vendor\_support(E) watchdog(E) snd\_hda\_core(E) snd\_hwdep(E) snd\_soc\_core(E) snd\_compress(E) snd\_pcsp(E)
soundwire\_bus(E) snd\_pcm(E) evdev(E) snd\_timer(E) mei\_me(E) snd(E) soundcore(E) mei(E) configfs(E) ip\_tables(E) x\_tables(E)
autofs4(E) ext4(E) crc32c\_generic(E) crc16(E) mbcache(E) jbd2(E) sd\_mod(E) t10\_pi(E) crc\_t10dif(E) crct10dif\_generic(E)
i915(E) ahci(E) libahci(E) ehci\_pci(E) igb(E) xhci\_pci(E) ehci\_hcd(E)
[ 101.525303] drm\_kms\_helper(E) dca(E) xhci\_hcd(E) libata(E) crct10dif\_pclmul(E) cec(E) crct10dif\_common(E) tsn(E) igc(E)
e1000e(E) ptp(E) i2c\_i801(E) crc32c\_intel(E) psmouse(E) i2c\_algo\_bit(E) i2c\_smbus(E) scsi\_mod(E) lpc\_ich(E) pps\_core(E)
usbcore(E) drm(E) button(E) video(E)
[ 101.525318] CPU: 1 PID: 646 Comm: irq/37-enp7s0-T Tainted: G E 5.10.30-rt37-tsn1-rt-ipipe #ipipe
[ 101.525320] Hardware name: SIEMENS AG SIMATIC IPC427D/A5E31233588, BIOS V17.02.09 03/31/2017
[ 101.525322] RIP: 0010:refcount\_warn\_saturate+0xab/0xf0
[ 101.525325] Code: 05 31 48 44 01 01 e8 f0 c6 42 00 0f 0b c3 80 3d 1f 48 44 01 00 75 90 48 c7 c7 78 a8 f3 a6 c6 05 0f 48
44 01 01 e8 d1 c6 42 00 <0f> 0b c3 80 3d fe 47 44 01 00 0f 85 6d ff ff ff 48 c7 c7 d0 a8 f3
[ 101.525327] RSP: 0018:ffffbdedc0917cb8 EFLAGS: 00010286
[ 101.525329] RAX: 0000000000000000 RBX: ffff98fd6becbf40 RCX: 0000000000000001
[ 101.525330] RDX: 0000000000000001 RSI: ffffffffa6f2700c RDI: 00000000ffffffff
[ 101.525332] RBP: ffff98fd6becc14c R08: ffffffffa7463d00 R09: ffffbdedc0917c50
[ 101.525333] R10: ffffffffa74c3578 R11: 0000000000000034 R12: 00000000ffffff00
[ 101.525335] R13: ffff98fd6b0b1000 R14: 0000000000000039 R15: ffff98fd6be35c40
[ 101.525337] FS: 0000000000000000(0000) GS:ffff98fd6e240000(0000) knlGS:0000000000000000
[ 101.525339] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 101.525341] CR2: 00007f34135a3a70 CR3: 0000000150210003 CR4: 00000000001706e0
[ 101.525343] Call Trace:
[ 101.525346] sock\_wfree+0x9c/0xa0
[ 101.525353] unix\_destruct\_scm+0x7b/0xa0
[ 101.525358] skb\_release\_head\_state+0x40/0x90
[ 101.525362] skb\_release\_all+0xe/0x30
[ 101.525364] napi\_consume\_skb+0x57/0x160
[ 101.525367] igc\_poll+0xb7/0xc80 [igc]
[ 101.525376] ? sched\_clock+0x5/0x10
[ 101.525381] ? sched\_clock\_cpu+0xe/0x100
[ 101.525385] net\_rx\_action+0x14c/0x410
[ 101.525388] \_\_do\_softirq+0xe9/0x2f4
[ 101.525391] \_\_local\_bh\_enable\_ip+0xe3/0x110
[ 101.525395] ? irq\_finalize\_oneshot.part.47+0xe0/0xe0
[ 101.525398] irq\_forced\_thread\_fn+0x6a/0x80
[ 101.525401] irq\_thread+0xe8/0x180
[ 101.525403] ? wake\_threads\_waitq+0x30/0x30
[ 101.525406] ? irq\_thread\_check\_affinity+0xd0/0xd0
[ 101.525408] kthread+0x183/0x1a0
[ 101.525412] ? kthread\_park+0x80/0x80
[ 101.525415] ret\_from\_fork+0x22/0x30
Fixes: 13b5b7fd6a4a ("igc: Add support for Tx/Rx rings")
Reported-by: Erez Geva <erez.geva.ext@siemens.com>
Signed-off-by: Vinicius Costa Gomes <vinicius.gomes@intel.com>
Tested-by: Dvora Fuxbrumer <dvorax.fuxbrumer@linux.intel.com>
Signed-off-by: Tony Nguyen <anthony.l.nguyen@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a9508e0edfe369ac95d0825bcdca976436ce780f)

| -rw-r--r-- | [drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/igc/igc_main.c?id=a9508e0edfe369ac95d0825bcdca976436ce780f) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/intel/igc/igc\_main.c b/drivers/net/ethernet/intel/igc/igc\_main.cindex 6b43e1c5b1c3ed..8c2813963e5582 100644--- a/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=0a0beb1f9120cf49a429e12f4ea69ddd74471d68)+++ b/[drivers/net/ethernet/intel/igc/igc\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igc/igc_main.c?id=a9508e0edfe369ac95d0825bcdca976436ce780f)@@ -256,6 +256,8 @@ static void igc\_clean\_tx\_ring(struct igc\_ring \*tx\_ring) DMA\_TO\_DEVICE); } + tx\_buffer->next\_to\_watch = NULL;+ /\* move us one more past the eop\_desc for start of next pkt \*/ tx\_buffer++; i++; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:40:23 +0000


