<!DOCTYPE html>
<html lang='en'>
<head>
<title>net: enetc: deny offload of tc-based TSN features on VF interfaces - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Vladimir Oltean &lt;vladimir.oltean@nxp.com&gt;</td><td class='right'>2022-09-16 16:32:09 +0300</td></tr>
<tr><th>committer</th><td>Jakub Kicinski &lt;kuba@kernel.org&gt;</td><td class='right'>2022-09-20 11:27:10 -0700</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>bbf5bcbfd5bc1acb78d97da06e86567393597d58</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42&amp;id2=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42.tar.gz'>linux-5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>net: enetc: deny offload of tc-based TSN features on VF interfaces</div><div class='commit-msg'>TSN features on the ENETC (taprio, cbs, gate, police) are configured
through a mix of command BD ring messages and port registers:
enetc_port_rd(), enetc_port_wr().

Port registers are a region of the ENETC memory map which are only
accessible from the PCIe Physical Function. They are not accessible from
the Virtual Functions.

Moreover, attempting to access these registers crashes the kernel:

$ echo 1 &gt; /sys/bus/pci/devices/0000\:00\:00.0/sriov_numvfs
pci 0000:00:01.0: [1957:ef00] type 00 class 0x020001
fsl_enetc_vf 0000:00:01.0: Adding to iommu group 15
fsl_enetc_vf 0000:00:01.0: enabling device (0000 -&gt; 0002)
fsl_enetc_vf 0000:00:01.0 eno0vf0: renamed from eth0
$ tc qdisc replace dev eno0vf0 root taprio num_tc 8 map 0 1 2 3 4 5 6 7 \
	queues 1@0 1@1 1@2 1@3 1@4 1@5 1@6 1@7 base-time 0 \
	sched-entry S 0x7f 900000 sched-entry S 0x80 100000 flags 0x2
Unable to handle kernel paging request at virtual address ffff800009551a08
Internal error: Oops: 96000007 [#1] PREEMPT SMP
pc : enetc_setup_tc_taprio+0x170/0x47c
lr : enetc_setup_tc_taprio+0x16c/0x47c
Call trace:
 enetc_setup_tc_taprio+0x170/0x47c
 enetc_setup_tc+0x38/0x2dc
 taprio_change+0x43c/0x970
 taprio_init+0x188/0x1e0
 qdisc_create+0x114/0x470
 tc_modify_qdisc+0x1fc/0x6c0
 rtnetlink_rcv_msg+0x12c/0x390

Split enetc_setup_tc() into separate functions for the PF and for the
VF drivers. Also remove enetc_qos.o from being included into
enetc-vf.ko, since it serves absolutely no purpose there.

Fixes: 34c6adf1977b ("enetc: Configure the Time-Aware Scheduler via tc-taprio offload")
Signed-off-by: Vladimir Oltean &lt;vladimir.oltean@nxp.com&gt;
Link: <a href="https://lore.kernel.org/r/20220916133209.3351399-2-vladimir.oltean@nxp.com">https://lore.kernel.org/r/20220916133209.3351399-2-vladimir.oltean@nxp.com</a>
Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/enetc/Makefile?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/Makefile</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='21%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 4.8%;'/><td class='none' style='width: 95.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/enetc/enetc.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc.c</a></td><td class='right'>21</td><td class='graph'><table summary='file diffstat' width='21%'><tr><td class='add' style='width: 4.8%;'/><td class='rem' style='width: 95.2%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/enetc/enetc.h?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc.h</a></td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='21%'><tr><td class='add' style='width: 4.8%;'/><td class='rem' style='width: 9.5%;'/><td class='none' style='width: 85.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/enetc/enetc_pf.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc_pf.c</a></td><td class='right'>21</td><td class='graph'><table summary='file diffstat' width='21%'><tr><td class='add' style='width: 95.2%;'/><td class='rem' style='width: 4.8%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/enetc/enetc_vf.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc_vf.c</a></td><td class='right'>13</td><td class='graph'><table summary='file diffstat' width='21%'><tr><td class='add' style='width: 57.1%;'/><td class='rem' style='width: 4.8%;'/><td class='none' style='width: 38.1%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>5 files changed, 34 insertions, 25 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/ethernet/freescale/enetc/Makefile b/drivers/net/ethernet/freescale/enetc/Makefile<br/>index a139f2e9d59f05..e0e8dfd1379301 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/Makefile?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>drivers/net/ethernet/freescale/enetc/Makefile</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/Makefile?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/Makefile</a></div><div class='hunk'>@@ -9,7 +9,6 @@ fsl-enetc-$(CONFIG_FSL_ENETC_QOS) += enetc_qos.o</div><div class='ctx'> </div><div class='ctx'> obj-$(CONFIG_FSL_ENETC_VF) += fsl-enetc-vf.o</div><div class='ctx'> fsl-enetc-vf-y := enetc_vf.o $(common-objs)</div><div class='del'>-fsl-enetc-vf-$(CONFIG_FSL_ENETC_QOS) += enetc_qos.o</div><div class='ctx'> </div><div class='ctx'> obj-$(CONFIG_FSL_ENETC_IERB) += fsl-enetc-ierb.o</div><div class='ctx'> fsl-enetc-ierb-y := enetc_ierb.o</div><div class='head'>diff --git a/drivers/net/ethernet/freescale/enetc/enetc.c b/drivers/net/ethernet/freescale/enetc/enetc.c<br/>index 3df099f6cbe04d..9f5b921039bd4f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc.c?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>drivers/net/ethernet/freescale/enetc/enetc.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc.c</a></div><div class='hunk'>@@ -2432,7 +2432,7 @@ int enetc_close(struct net_device *ndev)</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static int enetc_setup_tc_mqprio(struct net_device *ndev, void *type_data)</div><div class='add'>+int enetc_setup_tc_mqprio(struct net_device *ndev, void *type_data)</div><div class='ctx'> {</div><div class='ctx'> 	struct enetc_ndev_priv *priv = netdev_priv(ndev);</div><div class='ctx'> 	struct tc_mqprio_qopt *mqprio = type_data;</div><div class='hunk'>@@ -2486,25 +2486,6 @@ static int enetc_setup_tc_mqprio(struct net_device *ndev, void *type_data)</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-int enetc_setup_tc(struct net_device *ndev, enum tc_setup_type type,</div><div class='del'>-		   void *type_data)</div><div class='del'>-{</div><div class='del'>-	switch (type) {</div><div class='del'>-	case TC_SETUP_QDISC_MQPRIO:</div><div class='del'>-		return enetc_setup_tc_mqprio(ndev, type_data);</div><div class='del'>-	case TC_SETUP_QDISC_TAPRIO:</div><div class='del'>-		return enetc_setup_tc_taprio(ndev, type_data);</div><div class='del'>-	case TC_SETUP_QDISC_CBS:</div><div class='del'>-		return enetc_setup_tc_cbs(ndev, type_data);</div><div class='del'>-	case TC_SETUP_QDISC_ETF:</div><div class='del'>-		return enetc_setup_tc_txtime(ndev, type_data);</div><div class='del'>-	case TC_SETUP_BLOCK:</div><div class='del'>-		return enetc_setup_tc_psfp(ndev, type_data);</div><div class='del'>-	default:</div><div class='del'>-		return -EOPNOTSUPP;</div><div class='del'>-	}</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static int enetc_setup_xdp_prog(struct net_device *dev, struct bpf_prog *prog,</div><div class='ctx'> 				struct netlink_ext_ack *extack)</div><div class='ctx'> {</div><div class='head'>diff --git a/drivers/net/ethernet/freescale/enetc/enetc.h b/drivers/net/ethernet/freescale/enetc/enetc.h<br/>index caa12509d06b25..2cfe6944ebd32b 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc.h?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>drivers/net/ethernet/freescale/enetc/enetc.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc.h?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc.h</a></div><div class='hunk'>@@ -395,8 +395,7 @@ netdev_tx_t enetc_xmit(struct sk_buff *skb, struct net_device *ndev);</div><div class='ctx'> struct net_device_stats *enetc_get_stats(struct net_device *ndev);</div><div class='ctx'> void enetc_set_features(struct net_device *ndev, netdev_features_t features);</div><div class='ctx'> int enetc_ioctl(struct net_device *ndev, struct ifreq *rq, int cmd);</div><div class='del'>-int enetc_setup_tc(struct net_device *ndev, enum tc_setup_type type,</div><div class='del'>-		   void *type_data);</div><div class='add'>+int enetc_setup_tc_mqprio(struct net_device *ndev, void *type_data);</div><div class='ctx'> int enetc_setup_bpf(struct net_device *dev, struct netdev_bpf *xdp);</div><div class='ctx'> int enetc_xdp_xmit(struct net_device *ndev, int num_frames,</div><div class='ctx'> 		   struct xdp_frame **frames, u32 flags);</div><div class='head'>diff --git a/drivers/net/ethernet/freescale/enetc/enetc_pf.c b/drivers/net/ethernet/freescale/enetc/enetc_pf.c<br/>index 201b5f3f634eb2..bb7750222691da 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc_pf.c?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>drivers/net/ethernet/freescale/enetc/enetc_pf.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc_pf.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc_pf.c</a></div><div class='hunk'>@@ -734,6 +734,25 @@ static int enetc_pf_set_features(struct net_device *ndev,</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+static int enetc_pf_setup_tc(struct net_device *ndev, enum tc_setup_type type,</div><div class='add'>+			     void *type_data)</div><div class='add'>+{</div><div class='add'>+	switch (type) {</div><div class='add'>+	case TC_SETUP_QDISC_MQPRIO:</div><div class='add'>+		return enetc_setup_tc_mqprio(ndev, type_data);</div><div class='add'>+	case TC_SETUP_QDISC_TAPRIO:</div><div class='add'>+		return enetc_setup_tc_taprio(ndev, type_data);</div><div class='add'>+	case TC_SETUP_QDISC_CBS:</div><div class='add'>+		return enetc_setup_tc_cbs(ndev, type_data);</div><div class='add'>+	case TC_SETUP_QDISC_ETF:</div><div class='add'>+		return enetc_setup_tc_txtime(ndev, type_data);</div><div class='add'>+	case TC_SETUP_BLOCK:</div><div class='add'>+		return enetc_setup_tc_psfp(ndev, type_data);</div><div class='add'>+	default:</div><div class='add'>+		return -EOPNOTSUPP;</div><div class='add'>+	}</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> static const struct net_device_ops enetc_ndev_ops = {</div><div class='ctx'> 	.ndo_open		= enetc_open,</div><div class='ctx'> 	.ndo_stop		= enetc_close,</div><div class='hunk'>@@ -748,7 +767,7 @@ static const struct net_device_ops enetc_ndev_ops = {</div><div class='ctx'> 	.ndo_set_vf_spoofchk	= enetc_pf_set_vf_spoofchk,</div><div class='ctx'> 	.ndo_set_features	= enetc_pf_set_features,</div><div class='ctx'> 	.ndo_eth_ioctl		= enetc_ioctl,</div><div class='del'>-	.ndo_setup_tc		= enetc_setup_tc,</div><div class='add'>+	.ndo_setup_tc		= enetc_pf_setup_tc,</div><div class='ctx'> 	.ndo_bpf		= enetc_setup_bpf,</div><div class='ctx'> 	.ndo_xdp_xmit		= enetc_xdp_xmit,</div><div class='ctx'> };</div><div class='head'>diff --git a/drivers/net/ethernet/freescale/enetc/enetc_vf.c b/drivers/net/ethernet/freescale/enetc/enetc_vf.c<br/>index 4048101c42be21..dfcaac302e2451 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc_vf.c?id=fed38e64d9b99d65a36c0dbadc3d3f8ddd9ea030'>drivers/net/ethernet/freescale/enetc/enetc_vf.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/enetc/enetc_vf.c?id=5641c751fe2f92d3d9e8a8e03c1263ac8caa0b42'>drivers/net/ethernet/freescale/enetc/enetc_vf.c</a></div><div class='hunk'>@@ -93,6 +93,17 @@ static int enetc_vf_set_features(struct net_device *ndev,</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+static int enetc_vf_setup_tc(struct net_device *ndev, enum tc_setup_type type,</div><div class='add'>+			     void *type_data)</div><div class='add'>+{</div><div class='add'>+	switch (type) {</div><div class='add'>+	case TC_SETUP_QDISC_MQPRIO:</div><div class='add'>+		return enetc_setup_tc_mqprio(ndev, type_data);</div><div class='add'>+	default:</div><div class='add'>+		return -EOPNOTSUPP;</div><div class='add'>+	}</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> /* Probing/ Init */</div><div class='ctx'> static const struct net_device_ops enetc_ndev_ops = {</div><div class='ctx'> 	.ndo_open		= enetc_open,</div><div class='hunk'>@@ -102,7 +113,7 @@ static const struct net_device_ops enetc_ndev_ops = {</div><div class='ctx'> 	.ndo_set_mac_address	= enetc_vf_set_mac_addr,</div><div class='ctx'> 	.ndo_set_features	= enetc_vf_set_features,</div><div class='ctx'> 	.ndo_eth_ioctl		= enetc_ioctl,</div><div class='del'>-	.ndo_setup_tc		= enetc_setup_tc,</div><div class='add'>+	.ndo_setup_tc		= enetc_vf_setup_tc,</div><div class='ctx'> };</div><div class='ctx'> </div><div class='ctx'> static void enetc_vf_netdev_setup(struct enetc_si *si, struct net_device *ndev,</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 12:27:50 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
