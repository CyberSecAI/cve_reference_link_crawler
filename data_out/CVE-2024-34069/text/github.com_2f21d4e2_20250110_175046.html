
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fwerkzeug%2Fcommit%2F3386395b24c7371db11a5b8eaac0c91da5362692)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fwerkzeug%2Fcommit%2F3386395b24c7371db11a5b8eaac0c91da5362692)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pallets%2Fwerkzeug)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pallets](/pallets)
/
**[werkzeug](/pallets/werkzeug)**
Public

* [Notifications](/login?return_to=%2Fpallets%2Fwerkzeug) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Fpallets%2Fwerkzeug)
* [Star
   6.7k](/login?return_to=%2Fpallets%2Fwerkzeug)

* [Code](/pallets/werkzeug)
* [Issues
  6](/pallets/werkzeug/issues)
* [Pull requests
  6](/pallets/werkzeug/pulls)
* [Discussions](/pallets/werkzeug/discussions)
* [Actions](/pallets/werkzeug/actions)
* [Security](/pallets/werkzeug/security)
* [Insights](/pallets/werkzeug/pulse)

Additional navigation options

* [Code](/pallets/werkzeug)
* [Issues](/pallets/werkzeug/issues)
* [Pull requests](/pallets/werkzeug/pulls)
* [Discussions](/pallets/werkzeug/discussions)
* [Actions](/pallets/werkzeug/actions)
* [Security](/pallets/werkzeug/security)
* [Insights](/pallets/werkzeug/pulse)

## Commit

[Permalink](/pallets/werkzeug/commit/3386395b24c7371db11a5b8eaac0c91da5362692)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-2g68-c3qc-8985](https://github.com/advisories/GHSA-2g68-c3qc-8985 "GHSA-2g68-c3qc-8985")

[Browse files](/pallets/werkzeug/tree/3386395b24c7371db11a5b8eaac0c91da5362692)
Browse the repository at this point in the history

```
restrict debugger trusted hosts
```

* Loading branch information

[![@davidism](https://avatars.githubusercontent.com/u/1242887?s=40&v=4)](/davidism)

[davidism](/pallets/werkzeug/commits?author=davidism "View all commits by davidism")
authored
May 5, 2024

2 parents
[d2d3869](/pallets/werkzeug/commit/d2d3869525a4ffb2c41dfb2c0e39d94dab2d870c)
+
[890b6b6](/pallets/werkzeug/commit/890b6b62634fa61224222aee31081c61b054ff01)

commit 3386395

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**69 additions**
and
**11 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGES.rst
  [CHANGES.rst](#diff-ff3c479edefad986d2fe6fe7ead575a46b086e3bbcf0ccc86d85efc4a4c63c79)
* docs

  + docs/debug.rst
    [debug.rst](#diff-9aa5920dede1502e3cd8ce6de1a8608aca69ea6e53a46dc5abaf57b41f909cec)
* src/werkzeug

  + debug

    - src/werkzeug/debug/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-83867b1c4c9b75c728654ed284dc98f7c8d4e8bd682fc31b977d122dd045178a)
    - shared

      * src/werkzeug/debug/shared/debugger.js
        [debugger.js](#diff-62dc15d1dc6cab01a972733b226d53a8c3b548e0231aa2705c7b9e8f91dfa757)
  + sansio

    - src/werkzeug/sansio/utils.py
      [utils.py](#diff-32b889e713f9b5346cff198fd82aabe162ae8c529f008fa2a7a8fc6dbff17570)
  + src/werkzeug/serving.py
    [serving.py](#diff-abeaeb33abe8954dc4551a4631392ac46ad65e8b9f8404cec0e276a0d345af3b)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[CHANGES.rst](#diff-ff3c479edefad986d2fe6fe7ead575a46b086e3bbcf0ccc86d85efc4a4c63c79 "CHANGES.rst")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/CHANGES.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -5,6 +5,11 @@ Version 3.0.3 |
|  |  |  |
|  |  | Unreleased |
|  |  |  |
|  |  | - Only allow ``localhost``, ``.localhost``, ``127.0.0.1``, or the specified |
|  |  | hostname when running the dev server, to make debugger requests. Additional |
|  |  | hosts can be added by using the debugger middleware directly. The debugger |
|  |  | UI makes requests using the full URL rather than only the path. |
|  |  | :ghsa:`2g68-c3qc-8985` |
|  |  | - Make reloader more robust when ``""`` is in ``sys.path``. :pr:`2823` |
|  |  | - Better TLS cert format with ``adhoc`` dev certs. :pr:`2891` |
|  |  | - Inform Python < 3.12 how to handle ``itms-services`` URIs correctly, rather |
| Expand Down | |  |

35 changes: 30 additions & 5 deletions

35
[docs/debug.rst](#diff-9aa5920dede1502e3cd8ce6de1a8608aca69ea6e53a46dc5abaf57b41f909cec "docs/debug.rst")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/docs/debug.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -16,7 +16,8 @@ interactive debug console to execute code in any frame. |
|  |  | The debugger allows the execution of arbitrary code which makes it a |
|  |  | major security risk. \*\*The debugger must never be used on production |
|  |  | machines. We cannot stress this enough. Do not enable the debugger |
|  |  | in production.\*\* |
|  |  | in production.\*\* Production means anything that is not development, |
|  |  | and anything that is publicly accessible. |
|  |  |  |
|  |  | .. note:: |
|  |  |  |
| Expand Down  Expand Up | | @@ -72,10 +73,9 @@ argument to get a detailed list of all the attributes it has. |
|  |  | Debugger PIN |
|  |  | ------------ |
|  |  |  |
|  |  | Starting with Werkzeug 0.11 the debug console is protected by a PIN. |
|  |  | This is a security helper to make it less likely for the debugger to be |
|  |  | exploited if you forget to disable it when deploying to production. The |
|  |  | PIN based authentication is enabled by default. |
|  |  | The debug console is protected by a PIN. This is a security helper to make it |
|  |  | less likely for the debugger to be exploited if you forget to disable it when |
|  |  | deploying to production. The PIN based authentication is enabled by default. |
|  |  |  |
|  |  | The first time a console is opened, a dialog will prompt for a PIN that |
|  |  | is printed to the command line. The PIN is generated in a stable way |
| Expand All | | @@ -92,6 +92,31 @@ intended to make it harder for an attacker to exploit the debugger. |
|  |  | Never enable the debugger in production.\*\* |
|  |  |  |
|  |  |  |
|  |  | Allowed Hosts |
|  |  | ------------- |
|  |  |  |
|  |  | The debug console will only be served if the request comes from a trusted host. |
|  |  | If a request comes from a browser page that is not served on a trusted URL, a |
|  |  | 400 error will be returned. |
|  |  |  |
|  |  | By default, ``localhost``, any ``.localhost`` subdomain, and ``127.0.0.1`` are |
|  |  | trusted. ``run\_simple`` will trust its ``hostname`` argument as well. To change |
|  |  | this further, use the debug middleware directly rather than through |
|  |  | ``use\_debugger=True``. |
|  |  |  |
|  |  | .. code-block:: python |
|  |  |  |
|  |  | if os.environ.get("USE\_DEBUGGER") in {"1", "true"}: |
|  |  | app = DebuggedApplication(app, evalex=True) |
|  |  | app.trusted\_hosts = [...] |
|  |  |  |
|  |  | run\_simple("localhost", 8080, app) |
|  |  |  |
|  |  | \*\*This feature is not meant to entirely secure the debugger. It is |
|  |  | intended to make it harder for an attacker to exploit the debugger. |
|  |  | Never enable the debugger in production.\*\* |
|  |  |  |
|  |  |  |
|  |  | Pasting Errors |
|  |  | -------------- |
|  |  |  |
| Expand Down | |  |

31 changes: 28 additions & 3 deletions

31
[src/werkzeug/debug/\_\_init\_\_.py](#diff-83867b1c4c9b75c728654ed284dc98f7c8d4e8bd682fc31b977d122dd045178a "src/werkzeug/debug/__init__.py")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/src/werkzeug/debug/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,7 +19,9 @@ |
|  |  |  |
|  |  | from ..\_internal import \_log |
|  |  | from ..exceptions import NotFound |
|  |  | from ..exceptions import SecurityError |
|  |  | from ..http import parse\_cookie |
|  |  | from ..sansio.utils import host\_is\_trusted |
|  |  | from ..security import gen\_salt |
|  |  | from ..utils import send\_file |
|  |  | from ..wrappers.request import Request |
| Expand Down  Expand Up | | @@ -298,6 +300,14 @@ def \_\_init\_\_( |
|  |  | else: |
|  |  | self.pin = None |
|  |  |  |
|  |  | self.trusted\_hosts: list[str] = [".localhost", "127.0.0.1"] |
|  |  | """List of domains to allow requests to the debugger from. A leading dot |
|  |  | allows all subdomains. This only allows ``".localhost"`` domains by |
|  |  | default. |
|  |  |  |
|  |  | .. versionadded:: 3.0.3 |
|  |  | """ |
|  |  |  |
|  |  | @property |
|  |  | def pin(self) -> str | None: |
|  |  | if not hasattr(self, "\_pin"): |
| Expand Down  Expand Up | | @@ -344,7 +354,7 @@ def debug\_application( |
|  |  |  |
|  |  | is\_trusted = bool(self.check\_pin\_trust(environ)) |
|  |  | html = tb.render\_debugger\_html( |
|  |  | evalex=self.evalex, |
|  |  | evalex=self.evalex and self.check\_host\_trust(environ), |
|  |  | secret=self.secret, |
|  |  | evalex\_trusted=is\_trusted, |
|  |  | ) |
| Expand Down  Expand Up | | @@ -372,6 +382,9 @@ def execute\_command( # type: ignore[return] |
|  |  | frame: DebugFrameSummary | \_ConsoleFrame, |
|  |  | ) -> Response: |
|  |  | """Execute a command in a console.""" |
|  |  | if not self.check\_host\_trust(request.environ): |
|  |  | return SecurityError() # type: ignore[return-value] |
|  |  |  |
|  |  | contexts = self.frame\_contexts.get(id(frame), []) |
|  |  |  |
|  |  | with ExitStack() as exit\_stack: |
| Expand All | | @@ -382,6 +395,9 @@ def execute\_command( # type: ignore[return] |
|  |  |  |
|  |  | def display\_console(self, request: Request) -> Response: |
|  |  | """Display a standalone shell.""" |
|  |  | if not self.check\_host\_trust(request.environ): |
|  |  | return SecurityError() # type: ignore[return-value] |
|  |  |  |
|  |  | if 0 not in self.frames: |
|  |  | if self.console\_init\_func is None: |
|  |  | ns = {} |
| Expand Down  Expand Up | | @@ -434,12 +450,18 @@ def check\_pin\_trust(self, environ: WSGIEnvironment) -> bool | None: |
|  |  | return None |
|  |  | return (time.time() - PIN\_TIME) < ts |
|  |  |  |
|  |  | def check\_host\_trust(self, environ: WSGIEnvironment) -> bool: |
|  |  | return host\_is\_trusted(environ.get("HTTP\_HOST"), self.trusted\_hosts) |
|  |  |  |
|  |  | def \_fail\_pin\_auth(self) -> None: |
|  |  | time.sleep(5.0 if self.\_failed\_pin\_auth > 5 else 0.5) |
|  |  | self.\_failed\_pin\_auth += 1 |
|  |  |  |
|  |  | def pin\_auth(self, request: Request) -> Response: |
|  |  | """Authenticates with the pin.""" |
|  |  | if not self.check\_host\_trust(request.environ): |
|  |  | return SecurityError() # type: ignore[return-value] |
|  |  |  |
|  |  | exhausted = False |
|  |  | auth = False |
|  |  | trust = self.check\_pin\_trust(request.environ) |
| Expand Down  Expand Up | | @@ -489,8 +511,11 @@ def pin\_auth(self, request: Request) -> Response: |
|  |  | rv.delete\_cookie(self.pin\_cookie\_name) |
|  |  | return rv |
|  |  |  |
|  |  | def log\_pin\_request(self) -> Response: |
|  |  | def log\_pin\_request(self, request: Request) -> Response: |
|  |  | """Log the pin if needed.""" |
|  |  | if not self.check\_host\_trust(request.environ): |
|  |  | return SecurityError() # type: ignore[return-value] |
|  |  |  |
|  |  | if self.pin\_logging and self.pin is not None: |
|  |  | \_log( |
|  |  | "info", " \* To enable the debugger you need to enter the security pin:" |
| Expand All | | @@ -517,7 +542,7 @@ def \_\_call\_\_( |
|  |  | elif cmd == "pinauth" and secret == self.secret: |
|  |  | response = self.pin\_auth(request) # type: ignore |
|  |  | elif cmd == "printpin" and secret == self.secret: |
|  |  | response = self.log\_pin\_request() # type: ignore |
|  |  | response = self.log\_pin\_request(request) # type: ignore |
|  |  | elif ( |
|  |  | self.evalex |
|  |  | and cmd is not None |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[src/werkzeug/debug/shared/debugger.js](#diff-62dc15d1dc6cab01a972733b226d53a8c3b548e0231aa2705c7b9e8f91dfa757 "src/werkzeug/debug/shared/debugger.js")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/src/werkzeug/debug/shared/debugger.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,7 +48,7 @@ function initPinBox() { |
|  |  | btn.disabled = true; |
|  |  |  |
|  |  | fetch( |
|  |  | `${document.location.pathname}?\_\_debugger\_\_=yes&cmd=pinauth&pin=${pin}&s=${encodedSecret}` |
|  |  | `${document.location}?\_\_debugger\_\_=yes&cmd=pinauth&pin=${pin}&s=${encodedSecret}` |
|  |  | ) |
|  |  | .then((res) => res.json()) |
|  |  | .then(({auth, exhausted}) => { |
| Expand Down  Expand Up | | @@ -79,7 +79,7 @@ function promptForPin() { |
|  |  | if (!EVALEX\_TRUSTED) { |
|  |  | const encodedSecret = encodeURIComponent(SECRET); |
|  |  | fetch( |
|  |  | `${document.location.pathname}?\_\_debugger\_\_=yes&cmd=printpin&s=${encodedSecret}` |
|  |  | `${document.location}?\_\_debugger\_\_=yes&cmd=printpin&s=${encodedSecret}` |
|  |  | ); |
|  |  | const pinPrompt = document.getElementsByClassName("pin-prompt")[0]; |
|  |  | fadeIn(pinPrompt); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/werkzeug/sansio/utils.py](#diff-32b889e713f9b5346cff198fd82aabe162ae8c529f008fa2a7a8fc6dbff17570 "src/werkzeug/sansio/utils.py")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/src/werkzeug/sansio/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,7 +8,7 @@ |
|  |  | from ..urls import uri\_to\_iri |
|  |  |  |
|  |  |  |
|  |  | def host\_is\_trusted(hostname: str, trusted\_list: t.Iterable[str]) -> bool: |
|  |  | def host\_is\_trusted(hostname: str | None, trusted\_list: t.Iterable[str]) -> bool: |
|  |  | """Check if a host matches a list of trusted names. |
|  |  |  |
|  |  | :param hostname: The name to check. |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[src/werkzeug/serving.py](#diff-abeaeb33abe8954dc4551a4631392ac46ad65e8b9f8404cec0e276a0d345af3b "src/werkzeug/serving.py")

Show comments

[View file](/pallets/werkzeug/blob/3386395b24c7371db11a5b8eaac0c91da5362692/src/werkzeug/serving.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1072,6 +1072,9 @@ def run\_simple( |
|  |  | from .debug import DebuggedApplication |
|  |  |  |
|  |  | application = DebuggedApplication(application, evalex=use\_evalex) |
|  |  | # Allow the specified hostname to use the debugger, in addition to |
|  |  | # localhost domains. |
|  |  | application.trusted\_hosts.append(hostname) |
|  |  |  |
|  |  | if not is\_running\_from\_reloader(): |
|  |  | fd = None |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `3386395`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpallets%2Fwerkzeug%2Fcommit%2F3386395b24c7371db11a5b8eaac0c91da5362692) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

