<!DOCTYPE html>
<html lang='en'>
<head>
<title>i40e: fix vf may be used uninitialized in this function warning - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='f37c4eac99c258111d414d31b740437e1925b8e8'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='f37c4eac99c258111d414d31b740437e1925b8e8'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='f37c4eac99c258111d414d31b740437e1925b8e8'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Aleksandr Loktionov &lt;aleksandr.loktionov@intel.com&gt;</td><td class='right'>2024-03-13 10:56:39 +0100</td></tr>
<tr><th>committer</th><td>Tony Nguyen &lt;anthony.l.nguyen@intel.com&gt;</td><td class='right'>2024-03-26 09:02:03 -0700</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>f37c4eac99c258111d414d31b740437e1925b8e8</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>e7b4482d503c8715a10f07fe11c11b12bb42fa05</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb58c598ce45b7e787568fe27016260417c3d807'>eb58c598ce45b7e787568fe27016260417c3d807</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f37c4eac99c258111d414d31b740437e1925b8e8&amp;id2=eb58c598ce45b7e787568fe27016260417c3d807'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f37c4eac99c258111d414d31b740437e1925b8e8.tar.gz'>linux-f37c4eac99c258111d414d31b740437e1925b8e8.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>i40e: fix vf may be used uninitialized in this function warning</div><div class='commit-msg'>To fix the regression introduced by commit 52424f974bc5, which causes
servers hang in very hard to reproduce conditions with resets races.
Using two sources for the information is the root cause.
In this function before the fix bumping v didn't mean bumping vf
pointer. But the code used this variables interchangeably, so stale vf
could point to different/not intended vf.

Remove redundant "v" variable and iterate via single VF pointer across
whole function instead to guarantee VF pointer validity.

Fixes: 52424f974bc5 ("i40e: Fix VF hang when reset is triggered on another VF")
Signed-off-by: Aleksandr Loktionov &lt;aleksandr.loktionov@intel.com&gt;
Reviewed-by: Arkadiusz Kubalewski &lt;arkadiusz.kubalewski@intel.com&gt;
Reviewed-by: Przemek Kitszel &lt;przemyslaw.kitszel@intel.com&gt;
Reviewed-by: Paul Menzel &lt;pmenzel@molgen.mpg.de&gt;
Tested-by: Rafal Romanowski &lt;rafal.romanowski@intel.com&gt;
Signed-off-by: Tony Nguyen &lt;anthony.l.nguyen@intel.com&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f37c4eac99c258111d414d31b740437e1925b8e8'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c?id=f37c4eac99c258111d414d31b740437e1925b8e8'>drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c</a></td><td class='right'>34</td><td class='graph'><table summary='file diffstat' width='34%'><tr><td class='add' style='width: 47.1%;'/><td class='rem' style='width: 52.9%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 16 insertions, 18 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c b/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c<br/>index 83a34e98bdc79d..4c13f78af67569 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c?id=eb58c598ce45b7e787568fe27016260417c3d807'>drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c?id=f37c4eac99c258111d414d31b740437e1925b8e8'>drivers/net/ethernet/intel/i40e/i40e_virtchnl_pf.c</a></div><div class='hunk'>@@ -1624,8 +1624,8 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> {</div><div class='ctx'> 	struct i40e_hw *hw = &amp;pf-&gt;hw;</div><div class='ctx'> 	struct i40e_vf *vf;</div><div class='del'>-	int i, v;</div><div class='ctx'> 	u32 reg;</div><div class='add'>+	int i;</div><div class='ctx'> </div><div class='ctx'> 	/* If we don't have any VFs, then there is nothing to reset */</div><div class='ctx'> 	if (!pf-&gt;num_alloc_vfs)</div><div class='hunk'>@@ -1636,11 +1636,10 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> 		return false;</div><div class='ctx'> </div><div class='ctx'> 	/* Begin reset on all VFs at once */</div><div class='del'>-	for (v = 0; v &lt; pf-&gt;num_alloc_vfs; v++) {</div><div class='del'>-		vf = &amp;pf-&gt;vf[v];</div><div class='add'>+	for (vf = &amp;pf-&gt;vf[0]; vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]; ++vf) {</div><div class='ctx'> 		/* If VF is being reset no need to trigger reset again */</div><div class='ctx'> 		if (!test_bit(I40E_VF_STATE_RESETTING, &amp;vf-&gt;vf_states))</div><div class='del'>-			i40e_trigger_vf_reset(&amp;pf-&gt;vf[v], flr);</div><div class='add'>+			i40e_trigger_vf_reset(vf, flr);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	/* HW requires some time to make sure it can flush the FIFO for a VF</div><div class='hunk'>@@ -1649,14 +1648,13 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> 	 * the VFs using a simple iterator that increments once that VF has</div><div class='ctx'> 	 * finished resetting.</div><div class='ctx'> 	 */</div><div class='del'>-	for (i = 0, v = 0; i &lt; 10 &amp;&amp; v &lt; pf-&gt;num_alloc_vfs; i++) {</div><div class='add'>+	for (i = 0, vf = &amp;pf-&gt;vf[0]; i &lt; 10 &amp;&amp; vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]; ++i) {</div><div class='ctx'> 		usleep_range(10000, 20000);</div><div class='ctx'> </div><div class='ctx'> 		/* Check each VF in sequence, beginning with the VF to fail</div><div class='ctx'> 		 * the previous check.</div><div class='ctx'> 		 */</div><div class='del'>-		while (v &lt; pf-&gt;num_alloc_vfs) {</div><div class='del'>-			vf = &amp;pf-&gt;vf[v];</div><div class='add'>+		while (vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]) {</div><div class='ctx'> 			if (!test_bit(I40E_VF_STATE_RESETTING, &amp;vf-&gt;vf_states)) {</div><div class='ctx'> 				reg = rd32(hw, I40E_VPGEN_VFRSTAT(vf-&gt;vf_id));</div><div class='ctx'> 				if (!(reg &amp; I40E_VPGEN_VFRSTAT_VFRD_MASK))</div><div class='hunk'>@@ -1666,7 +1664,7 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> 			/* If the current VF has finished resetting, move on</div><div class='ctx'> 			 * to the next VF in sequence.</div><div class='ctx'> 			 */</div><div class='del'>-			v++;</div><div class='add'>+			++vf;</div><div class='ctx'> 		}</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='hunk'>@@ -1676,39 +1674,39 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> 	/* Display a warning if at least one VF didn't manage to reset in</div><div class='ctx'> 	 * time, but continue on with the operation.</div><div class='ctx'> 	 */</div><div class='del'>-	if (v &lt; pf-&gt;num_alloc_vfs)</div><div class='add'>+	if (vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs])</div><div class='ctx'> 		dev_err(&amp;pf-&gt;pdev-&gt;dev, "VF reset check timeout on VF %d\n",</div><div class='del'>-			pf-&gt;vf[v].vf_id);</div><div class='add'>+			vf-&gt;vf_id);</div><div class='ctx'> 	usleep_range(10000, 20000);</div><div class='ctx'> </div><div class='ctx'> 	/* Begin disabling all the rings associated with VFs, but do not wait</div><div class='ctx'> 	 * between each VF.</div><div class='ctx'> 	 */</div><div class='del'>-	for (v = 0; v &lt; pf-&gt;num_alloc_vfs; v++) {</div><div class='add'>+	for (vf = &amp;pf-&gt;vf[0]; vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]; ++vf) {</div><div class='ctx'> 		/* On initial reset, we don't have any queues to disable */</div><div class='del'>-		if (pf-&gt;vf[v].lan_vsi_idx == 0)</div><div class='add'>+		if (vf-&gt;lan_vsi_idx == 0)</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='ctx'> 		/* If VF is reset in another thread just continue */</div><div class='ctx'> 		if (test_bit(I40E_VF_STATE_RESETTING, &amp;vf-&gt;vf_states))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		i40e_vsi_stop_rings_no_wait(pf-&gt;vsi[pf-&gt;vf[v].lan_vsi_idx]);</div><div class='add'>+		i40e_vsi_stop_rings_no_wait(pf-&gt;vsi[vf-&gt;lan_vsi_idx]);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	/* Now that we've notified HW to disable all of the VF rings, wait</div><div class='ctx'> 	 * until they finish.</div><div class='ctx'> 	 */</div><div class='del'>-	for (v = 0; v &lt; pf-&gt;num_alloc_vfs; v++) {</div><div class='add'>+	for (vf = &amp;pf-&gt;vf[0]; vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]; ++vf) {</div><div class='ctx'> 		/* On initial reset, we don't have any queues to disable */</div><div class='del'>-		if (pf-&gt;vf[v].lan_vsi_idx == 0)</div><div class='add'>+		if (vf-&gt;lan_vsi_idx == 0)</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='ctx'> 		/* If VF is reset in another thread just continue */</div><div class='ctx'> 		if (test_bit(I40E_VF_STATE_RESETTING, &amp;vf-&gt;vf_states))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		i40e_vsi_wait_queues_disabled(pf-&gt;vsi[pf-&gt;vf[v].lan_vsi_idx]);</div><div class='add'>+		i40e_vsi_wait_queues_disabled(pf-&gt;vsi[vf-&gt;lan_vsi_idx]);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	/* Hw may need up to 50ms to finish disabling the RX queues. We</div><div class='hunk'>@@ -1717,12 +1715,12 @@ bool i40e_reset_all_vfs(struct i40e_pf *pf, bool flr)</div><div class='ctx'> 	mdelay(50);</div><div class='ctx'> </div><div class='ctx'> 	/* Finish the reset on each VF */</div><div class='del'>-	for (v = 0; v &lt; pf-&gt;num_alloc_vfs; v++) {</div><div class='add'>+	for (vf = &amp;pf-&gt;vf[0]; vf &lt; &amp;pf-&gt;vf[pf-&gt;num_alloc_vfs]; ++vf) {</div><div class='ctx'> 		/* If VF is reset in another thread just continue */</div><div class='ctx'> 		if (test_bit(I40E_VF_STATE_RESETTING, &amp;vf-&gt;vf_states))</div><div class='ctx'> 			continue;</div><div class='ctx'> </div><div class='del'>-		i40e_cleanup_reset_vf(&amp;pf-&gt;vf[v]);</div><div class='add'>+		i40e_cleanup_reset_vf(vf);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	i40e_flush(hw);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 17:57:10 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
