

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1866100)
* [XML](/show_bug.cgi?ctype=xml&id=1866100)

Closed
[Bug 1866100](/show_bug.cgi?id=1866100)
(CVE-2024-2609)

Opened 1 year ago
Closed 11 months ago

# Firefox external protocol handler prompt is vulnerable to clickjacking

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Firefox external protocol handler prompt is vulnerable to clickjacking

## Categories

### (Firefox :: File Handling, defect, P2)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=File%20Handling#File%20Handling)

File Handling
▾

Firefox :: File Handling
For issues dealing with helper applications, and guessing Content Types when they aren't specified/known (ftp:, file:, jar:, but generally not http:). This component does not cover: backend networking issues, such as those covered by Networking: FTP or Networking: File, nor does it cover the Download Manager which has its own component in the Toolkit product.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=File%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=File%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=File%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Desktop

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

124 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [125+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=125%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox122 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix) |
| firefox123 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=verified) |
| firefox125 | [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr115 | 125+ | verified |
| firefox-esr128 | --- | --- |
| firefox122 |  | wontfix |
| firefox123 |  | wontfix |
| firefox124 | + | verified |
| firefox125 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: fazim.pentester, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/4894f6e6dda807a548d66213399b6dff?d=mm&size=40)  [fazim.pentester](/user_profile?user_id=720428)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1880209](/show_bug.cgi?id=1880209 "RESOLVED FIXED - Intermittent comm/mail/test/browser/attachment/browser_openAttachment.js | Test timed out")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-clickjacking, reporter-external, sec-moderate, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.10+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-2609

[Keywords:](/describekeywords.cgi)

[csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.10+]

QA Whiteboard:

[post-critsmash-triage][qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c10 "1 year ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [demo.mp4](/attachment.cgi?id=9365009)  [1 year ago](#c0)  [Shaheen Fazim](/user_profile?user_id=720428)   1017.36 KB, video/mp4 |  | [Details](/attachment.cgi?id=9365009&action=edit) |
| --- | --- | --- |
| [index.html](/attachment.cgi?id=9365010)  [1 year ago](#c1)  [Shaheen Fazim](/user_profile?user_id=720428)   846 bytes, text/html |  | [Details](/attachment.cgi?id=9365010&action=edit) |
| [popup.html](/attachment.cgi?id=9365011)  [1 year ago](#c2)  [Shaheen Fazim](/user_profile?user_id=720428)   850 bytes, text/html |  | [Details](/attachment.cgi?id=9365011&action=edit) |
| [Bug 1866100 - improve PromptUtils activeness handling, r?pbz](/attachment.cgi?id=9377418)  [1 year ago](#c7)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9377418&action=edit) | [Review](/attachment.cgi?id=9377418) |
| [advisory.txt](/attachment.cgi?id=9391563)  [10 months ago](#c18)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   221 bytes, text/plain |  | [Details](/attachment.cgi?id=9391563&action=edit) |
| [Bug 1866100 - improve PromptUtils activeness handling, r?pbz](/attachment.cgi?id=9394983)  [9 months ago](#c23)  [:Gijs (he/him)](/user_profile?user_id=159069)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a11567986_600971 "9 months ago") | [Details](/attachment.cgi?id=9394983&action=edit) | [Review](/attachment.cgi?id=9394983) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1866100#c0)• 1 year ago |
|  | |

Attached video
[demo.mp4](attachment.cgi?id=9365009)
— [Details](attachment.cgi?id=9365009&action=edit)

Opening a popup and initiating protocol URI on a hidden window; an attacker can lure the vicitim to clickjack the protocol handler prompt to allow the protocol unknowingly.

Steps to reproduce:

1. Download index.html and popup.html to a folder.
2. Open the index.html and start testing.
Flags: sec-bounty?

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1866100#c1)• 1 year ago |
|  | |

Attached file
[index.html](attachment.cgi?id=9365010)
— [Details](attachment.cgi?id=9365010&action=edit)

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1866100#c2)• 1 year ago |
|  | |

Attached file
[popup.html](attachment.cgi?id=9365011)
— [Details](attachment.cgi?id=9365011&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a540_159069)• 1 year ago |

Component: Security → File Handling

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a21373_406194)• 1 year ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1866100#c3)• 1 year ago |
|  | |

This prompt could be using shared code with the other vulnerable prompts... might be a duplicate in the end. But it's also possible the prompt was simply made following the same style guidelines.

Summary: Firefox protocol handler prompt is vulnerable to clickjacking → Firefox external protocol handler prompt is vulnerable to clickjacking

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1866100#c4)• 1 year ago |
|  | |

The severity field is not set for this bug.

:Gijs, could you have a look please?

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#workflow.2Fno_severity.py).

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1866100#c5)• 1 year ago |
|  | |

Hi, friendly ping.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1866100#c6)• 1 year ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #3](/show_bug.cgi?id=1866100#c3 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking"))

> This prompt could be using shared code with the other vulnerable prompts... might be a duplicate in the end. But it's also possible the prompt was simply made following the same style guidelines.

The prompt is already using the shared enable delay helper, but the delay helper doesn't detect that the dialog is opened inside a window that is inactive, and so the initial prompt delay expires while the popup window is obscuring the dialog. Then a focus event would re-enable the delay, but that focus event doesn't arrive before the click on the button, but after.

The straightforward fix is to make the enable delay not start "ticking" if the focus target's window is not the active window. This will keep the button disabled if the dialog/window is opened in the background.

The somewhat scary thing here is that this will affect all the consumers of the shared enable delay helper... and I don't know off-hand if there are edgecases where this wouldn't work well.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1866100#c7)• 1 year ago |
|  | |

Attached file
[Bug 1866100 - improve PromptUtils activeness handling, r?pbz](attachment.cgi?id=9377418)
— [Details](attachment.cgi?id=9377418&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a6043029_600971)• 1 year ago |

Assignee: nobody → gijskruitbosch+bugsStatus: NEW → ASSIGNED

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a6209944_159069)• 11 months ago |

Severity: -- → S3OS: Unspecified → AllPriority: -- → P2Hardware: Unspecified → Desktop

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1866100#c8)• 11 months ago |
|  | |

Pushed by gijskruitbosch@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/cc5ae1af4e17>
improve PromptUtils activeness handling, r=pbz

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1866100#c9)• 11 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/cc5ae1af4e17>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 11 months ago
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 124 Branch

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a7193650_159069)• 11 months ago |

[status-firefox122](/buglist.cgi?f1=cf_status_firefox122&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox122&o1=equals&v1=wontfix)
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)

|  | [Geoff Lankow (:darktrojan)](/user_profile?user_id=158464) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a7210346_158464)• 11 months ago |

Regressions: [1880209](/show_bug.cgi?id=1880209 "RESOLVED FIXED - Intermittent comm/mail/test/browser/attachment/browser_openAttachment.js | Test timed out")

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a7762807_551058)• 11 months ago |

Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1866100#c10)• 11 months ago |
|  | |

For just the protocol handler prompt this is not that severe a problem, but since it affects other prompts as well this is a good solid find.

Flags: sec-bounty? → sec-bounty+

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a7822936_488993)• 11 months ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1866100#c11)• 11 months ago |
|  | |

Thank you.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1866100#c12)• 10 months ago |
|  | |

Do we want this on ESR115 also? Please nominate if so - it grafts cleanly.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1866100#c13)• 10 months ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #12](/show_bug.cgi?id=1866100#c12 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking"))

> Do we want this on ESR115 also? Please nominate if so - it grafts cleanly.

I'd want this to bake on release at least for a bit before uplifting as I'm nervous we inadvertently break something here. Focus management is always finnicky/surprising. Ask me again 4 weeks after 124 has been released? :-)

Flags: needinfo?(gijskruitbosch+bugs) → needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1866100#c14)• 10 months ago |
|  | |

Can do!

[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [125+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=125%2B)Flags: needinfo?(ryanvm)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a9705585_486634)• 10 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main124+]

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1866100#c15)• 10 months ago |
|  | |

I am attempting to reproduce this issue in Windows10 and MacOS11, but the protocol handler prompt does not appear on the first window when the "Open Popup" button is clicked in an affected build (Release v122.0.1 or v123.0.1 or Nightly v124.0a1 from 2024-01-28). It would appear as if the test page is not working correctly.

@Gijs: Do you know why this happens? Is there some precondition I might be missing out on? Thank you.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Shaheen Fazim](/user_profile?user_id=720428)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1866100#c16)• 10 months ago |
|  | |

(In reply to Daniel Bodea [:danibodea] from [comment #15](/show_bug.cgi?id=1866100#c15 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking"))

> I am attempting to reproduce this issue in Windows10 and MacOS11, but the protocol handler prompt does not appear on the first window when the "Open Popup" button is clicked in an affected build (Release v122.0.1 or v123.0.1 or Nightly v124.0a1 from 2024-01-28). It would appear as if the test page is not working correctly.
>
> @Gijs: Do you know why this happens? Is there some precondition I might be missing out on? Thank you.

In the above proof-of-concept, I have used the VSCode protocol handler, so the victim should have installed the VSCode editor as a precondition for this exploit to work. However, there are other protocol handlers that support various applications or OS features.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1866100#c17)• 10 months ago |
|  | |

(In reply to Daniel Bodea [:danibodea] from [comment #15](/show_bug.cgi?id=1866100#c15 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking"))

> I am attempting to reproduce this issue in Windows10 and MacOS11, but the protocol handler prompt does not appear on the first window when the "Open Popup" button is clicked in an affected build (Release v122.0.1 or v123.0.1 or Nightly v124.0a1 from 2024-01-28). It would appear as if the test page is not working correctly.
>
> @Gijs: Do you know why this happens? Is there some precondition I might be missing out on? Thank you.

I think [comment 16](/show_bug.cgi?id=1866100#c16 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking") answered this but if not please let me know.

Flags: needinfo?(gijskruitbosch+bugs) → needinfo?(dbodea)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1866100#c18)• 10 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9391563)
— [Details](attachment.cgi?id=9391563&action=edit)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1866100#c19)• 10 months ago |
|  | |

I can confirm the issue, more exactly, I can confirm that the dialog can be "accidentally" confirmed if the second click falls on the confirmation button, in Nightly v124.0a1 from 2024-02-12. Furthermore, I can confirm the fix. This fix disabled the button in the first moments of the window being focused so it does not allow the user to click it. This behavior helps exclude the "accidental" second click. This fix has been verified in Windows 10 and MacOS 11.

Status: RESOLVED → VERIFIED
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=verified)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified)Flags: qe-verify+Flags: needinfo?(dbodea)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a10109113_428608)• 10 months ago |

Alias: CVE-2024-2609

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1866100#c20)• 10 months ago |
|  | |

Since nightly and release are affected, beta will likely be affected too.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#missing_beta_status.py).

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1866100#c21)• 10 months ago |
|  | |

Fixing up flags.

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=affected) → [verified](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=verified)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[verified](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=verified) → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1866100#c22)• 9 months ago |
|  | |

Circling back to this, how are we feeling about an ESR backport?

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1866100#c23)• 9 months ago |
|  | |

Attached file
[Bug 1866100 - improve PromptUtils activeness handling, r?pbz](attachment.cgi?id=9394983)
— [Details](attachment.cgi?id=9394983&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D200165>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11564473_600971)• 9 months ago |

[Attachment #9394983](/attachment.cgi?id=9394983&action=edit "Bug 1866100 - improve PromptUtils activeness handling, r?pbz") -
Flags: approval-mozilla-esr115?

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1866100#c24)• 9 months ago |
|  | |

### esr115 Uplift Approval Request

* **User impact if declined**: sec-moderate
* **Code covered by automated testing**: no
* **Fix verified in Nightly**: yes
* **Needs manual QE test**: yes
* **Steps to reproduce for manual QE testing**: see earlier comments in the bug
* **Risk associated with taking this patch**: Low-ish
* **Explanation of risk level**: , small change that has baked on release for a bit now
* **String changes made/needed**: No
* **Is Android affected?**: no
Flags: qe-verify+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11564517_159069)• 9 months ago |

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11567986_600971)• 9 months ago |

[Attachment #9394983](/attachment.cgi?id=9394983&action=edit "Bug 1866100 - improve PromptUtils activeness handling, r?pbz") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11568035_75935)• 9 months ago |

[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1866100#c25)• 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/887520530f6e>

|  | [Lando Automation](/user_profile?user_id=640478) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11568192_640478)• 9 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11638405_553429)• 9 months ago |

QA Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][qa-triaged]

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1866100#c26)• 9 months ago |
|  | |

I have also confirmed the fix in ESR v115.10.0esr on Windows 10 and MacOS 11. The behavior after the fix is described in [comment 19](/show_bug.cgi?id=1866100#c19 "VERIFIED FIXED - Firefox external protocol handler prompt is vulnerable to clickjacking").

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)

|  | [Daniel Bodea [:danibodea]](/user_profile?user_id=616104) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a11977164_616104)• 9 months ago |

Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a12159948_1689)• 9 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main124+] → [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.10+]

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a16423147_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a16708958_1689)• 7 months ago |

Keywords: [csectype-clickjacking](/buglist.cgi?keywords=csectype-clickjacking&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1866100#a25801793_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1866100&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Shaheen Fazim](/user_profile?user_id=720428)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

