
[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

December 7, 2023
# GHSL-2023-081\_GHSL-2023-082: Tar Slip vulnerabilities in Autolab - CVE-2023-32676, CVE-2023-32317

[![Author avatar](https://avatars.githubusercontent.com/u/176818)
Peter Stöckli](https://github.com/p-)

## Coordinated Disclosure Timeline

* 2023-04-12: Reported vulnerability via GitHub’s [private vulnerability reporting](https://docs.github.com/en/code-security/security-advisories/guidance-on-reporting-and-writing-information-about-vulnerabilities/privately-reporting-a-security-vulnerability) feature.
* 2023-05-21 Vulnerabilities were fixed and advisories were published [1](https://github.com/autolab/Autolab/security/advisories/GHSA-x9hj-r9q4-832c), [2](https://github.com/autolab/Autolab/security/advisories/GHSA-h8g5-vhm4-wx6g).

## Summary

Two Tar Slip vulnerabilities were found in Autolab. Those vulnerabilities could have allowed attackers to create or replace files on the file system that in the worst case could have been executed by the application or system itself.

## Product

Autolab

## Tested Version

[v2.10.0](https://github.com/autolab/Autolab/releases/tag/v2.10.0)

## Details

### Issue 1: Tar slip in Install Assessment functionality (`GHSL-2023-081`)

A Tar slip vulnerability was found in the Install assessment functionality of Autolab. To exploit this vulnerability an authenticated attacker with instructor permissions needs to upload a specially crafted Tar file.
Using the install assessment functionality an attacker can feed a Tar file that contain files with paths pointing outside of the target directory (e.g., `../../../../tmp/tarslipped1.sh`). When the Install assessment form is submitted the files inside of the archives are expanded to the attacker-chosen locations.

[Following line](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/assessments_controller.rb#L199-L199) inside the method [`importAsmtFromTar`](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/assessments_controller.rb#L146) writes the file to the destination defined by the attacker:

```
File.open(File.join(course_root, relative_pathname), "wb") do |f|

```

This `relative_pathname` variable uses the `full_name` [retrieved from the archive](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/assessments_controller.rb#L192).

```
relative_pathname = entry.full_name

```

This vulnerability was discovered with the help of [CodeQL](https://codeql.github.com/).

#### Proof of Concept

Preconditions:

1. Attacker needs to be logged in as instructor
2. There needs to be an existing course where the instructor has access permissions

The attacker can then visit the following link in the browser to install an assessment:

```
https://<autolab-host>/courses/<course-slug>/assessments/install_assessment

```

On this page the attacker can specify a specially crafted tar ball (see `exploitlab.tar` in Resources) in the “Import from tarball” section.
After selecting the malicious tar ball the form is submitted and the tar ball unzipped.

In the case of a successful exploitation, a file named `tarslipped1.sh` should appear in the `/tmp` folder of the exploited system.

#### Impact

This issue may lead to arbitrary file write. It may lead up to Remote Code Execution if it’s possible to write to a file which is later executed.

#### Resources

To reproduce the vulnerability a tar archive of an existing assessment can be extended as follows:

* Create a file in `/tmp/`:

```
touch /tmp/tarslipped1.sh

```

* Append the newly created file to the existing assessment tar archive (named `exploitlab.tar`):
  ```
  tar -rf exploitlab.tar ../../../../../../../../tmp/tarslipped1.sh

  ```

### Issue 2: Tar slip in cheat checker functionality (`GHSL-2023-082`)

A Tar slip vulnerability was found in the MOSS cheat checker functionality of Autolab. To exploit this vulnerability an authenticated attacker with instructor permissions needs to upload a specially crafted Tar file. Both “Base File Tar” and “Additional file archive” can be fed with Tar files that contain paths outside their target directories (e.g., `../../../../tmp/tarslipped2.sh`). When the MOSS cheat checker is started the files inside of the archives are expanded to the attacker-chosen locations.

[Following line](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/courses_controller.rb#L1109-L1109) inside the method [`extract_tar_for_moss`](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/courses_controller.rb#L1065) writes the file to the destination defined by the attacker:

```
File.open(destination, "wb") do |out|

```

This `destination` variable uses the `pathname` [retrieved from the archive](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/courses_controller.rb#L1098).

```
pathname = Archive.get_entry_name(entry)

```

It looks like the same method contains [a sanitizer of sorts](https://github.com/autolab/Autolab/blob/b31a620ea6e9c015fcd59f555c2e562734fe68d7/app/controllers/courses_controller.rb#L1107) that might have been intended to prevent such scenarios:

```
pathname.gsub!(%r{/}, "-")

```

Unfortunately, the variable `pathname` is not used anymore after this line.

This vulnerability was discovered with the help of [CodeQL](https://codeql.github.com/).

#### Proof of Concept

Preconditions:

1. Attacker needs to be logged in as instructor
2. There needs to be an existing course where the instructor has access permissions

The attacker can then visit the following in the browser to run the MOSS cheat checker:

```
https://<autolab-host>/courses/<course-slug>/moss

```

On this page the attacker can specify a specially crafted tar ball (see `tarslip.tar` in Resources). The Tar ball can either be submitted under “Step 2” as “Base file” (“Base File tar” needs to be enabled as well) or under “Step 3” as “Additional file archive”.
After specifying a malicious tar ball the attacker can submit the form by clicking on “GO!”.

In the case of a successful exploitation, a file named `tarslipped2.sh` should appear in the `/tmp` folder of the exploited system.

#### Impact

This issue may lead to arbitrary file write. It may lead up to Remote Code Execution if it’s possible to write to a file which is later executed.

#### Resources

To reproduce the vulnerability a tar archive can be created as follows:

* Create a file in `/tmp/`:

```
touch /tmp/tarslipped2.sh

```

* Create a tar file:
  ```
  tar -cvf tarslip.tar ../../../../../../../../tmp/tarslipped2.sh

  ```

In the case of a successful exploitation, a file named `tarslipped2.sh` should appear in the `/tmp` folder of the exploited system.

## CVE

* CVE-2023-32676 Tar slip in Install Assessment functionality
* CVE-2023-32317 Tar slip in cheat checker functionality

## Credit

These issues were discovered and reported by GHSL team member [@p- (Peter Stöckli)](https://github.com/p-).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-081` or `GHSL-2023-082` in any communication regarding these issues.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information

