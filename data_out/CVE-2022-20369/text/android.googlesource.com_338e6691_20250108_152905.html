
Commit Information:
------------------
Author: Chen-Yu Tsai  1639067883 +0100
Date: Lee Jones  1650877461 +0000
Bug ID: Bug: 223375145
Commit Message:
--------------
BACKPORT: media: v4l2-mem2mem: Apply DST\_QUEUE\_OFF\_BASE on MMAP buffers across ioctls[ Upstream commit 8310ca94075e784bbb06593cd6c068ee6b6e4ca6 ]DST\_QUEUE\_OFF\_BASE is applied to offset/mem\_offset on MMAP capture buffersonly for the VIDIOC\_QUERYBUF ioctl, while the userspace fields (includingoffset/mem\_offset) are filled in for VIDIOC\_{QUERY,PREPARE,Q,DQ}BUFioctls. This leads to differences in the values presented to userspace.If userspace attempts to mmap the capture buffer directly using valuesfrom DQBUF, it will fail.Move the code that applies the magic offset into a helper, and callthat helper from all four ioctl entry points.[hverkuil: drop unnecessary '= 0' in v4l2\_m2m\_querybuf() for ret]Bug: 223375145Fixes: 7f98639def42 ("V4L/DVB: add memory-to-memory device helper framework for videobuf")Fixes: 908a0d7c588e ("[media] v4l: mem2mem: port to videobuf2")Signed-off-by: Chen-Yu Tsai Signed-off-by: Hans Verkuil Signed-off-by: Mauro Carvalho Chehab Signed-off-by: Sasha Levin Signed-off-by: Lee Jones Change-Id: Ifab9933f85f4ba7e0fadddf52debaf837830a06d(cherry picked from commit 6def3a5ed8ee24465edf6b30cdbe4b27c6d4e1df)
