
            Commit Information:
            ------------------
            Author: Chen-Yu Tsai <wenst@chromium.org> 1639067883 +0100
            Date: Lee Jones <joneslee@google.com> 1650877461 +0000
            Bug ID: Bug: 223375145

            Commit Message:
            --------------
            BACKPORT: media: v4l2-mem2mem: Apply DST_QUEUE_OFF_BASE on MMAP buffers across ioctls[ Upstream commit 8310ca94075e784bbb06593cd6c068ee6b6e4ca6 ]DST_QUEUE_OFF_BASE is applied to offset/mem_offset on MMAP capture buffersonly for the VIDIOC_QUERYBUF ioctl, while the userspace fields (includingoffset/mem_offset) are filled in for VIDIOC_{QUERY,PREPARE,Q,DQ}BUFioctls. This leads to differences in the values presented to userspace.If userspace attempts to mmap the capture buffer directly using valuesfrom DQBUF, it will fail.Move the code that applies the magic offset into a helper, and callthat helper from all four ioctl entry points.[hverkuil: drop unnecessary '= 0' in v4l2_m2m_querybuf() for ret]Bug: 223375145Fixes: 7f98639def42 ("V4L/DVB: add memory-to-memory device helper framework for videobuf")Fixes: 908a0d7c588e ("[media] v4l: mem2mem: port to videobuf2")Signed-off-by: Chen-Yu Tsai <wenst@chromium.org>Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>Signed-off-by: Sasha Levin <sashal@kernel.org>Signed-off-by: Lee Jones <lee.jones@linaro.org>Change-Id: Ifab9933f85f4ba7e0fadddf52debaf837830a06d(cherry picked from commit 6def3a5ed8ee24465edf6b30cdbe4b27c6d4e1df)
            