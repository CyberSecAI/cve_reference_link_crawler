[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F476a4601d9b8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fr0h1rr1m.medium.com%2Fcomodo-antivirus-local-privilege-escalation-through-insecure-file-move-476a4601d9b8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fr0h1rr1m.medium.com%2Fcomodo-antivirus-local-privilege-escalation-through-insecure-file-move-476a4601d9b8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Comodo Antivirus Local Privilege Escalation Through Insecure File Move (CVE-2022–34008)

[![Furkan Göksel](https://miro.medium.com/v2/resize:fill:88:88/1*V7FgynBucXFGCaaNm2oJ8w.jpeg)](/?source=post_page---byline--476a4601d9b8--------------------------------)

[Furkan Göksel](/?source=post_page---byline--476a4601d9b8--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fff0f68c88db0&operation=register&redirect=https%3A%2F%2Fr0h1rr1m.medium.com%2Fcomodo-antivirus-local-privilege-escalation-through-insecure-file-move-476a4601d9b8&user=Furkan+G%C3%B6ksel&userId=ff0f68c88db0&source=post_page-ff0f68c88db0--byline--476a4601d9b8---------------------post_header-----------)

3 min read·Jun 20, 2022

--

Listen

Share

# Introduction

> *Comodo Antivirus has a quarantine flaw that allows privilege escalation. Exploitation uses an NTFS directory junction to restore a malicious DLL from quarantine into the System32 folder. By overwriting/putting a DLL which is used by a SYSTEM level process, one can elevate his/her privileges.*
>
> *I’m disclosing this vulnerability after waiting them for 60 days. They didn’t respond my emails.*

# Description of the Vulnerability

1. Title: Comodo Antivirus Local Privilege Escalation Through Insecure File Move
2. Product: Comodo Antivirus
3. Version: 12.2.2.8012 (Latest Version on June 2022)
4. Homepage: <https://antivirus.comodo.com/>
5. Test Platform: Windows 10 19044

![]()

Comodo Antivirus has a service called **“Comodo Internet Security Helper Service”** which runs as the **SYSTEM**.

![]()

One of the jobs that this service does is the quarantine feature.

When a malicious file is detected, it is first quarantined by the application with the default settings. In order to restore this malicious file, the user can unblock it from the unblock applications tab. While restoring the file, **the file is moved to its older location via SYSTEM privileges by the cmdagent.exe which is the process of that service**. For example, an EICAR file (test.txt in the screenshot) was moved to its original location by this process.

![]()

Because of this, a non-admin user can put any file he/she wants to privileged locations like System32 by abusing the NTFS junctions. After that, he/she can use this ability to escalate his/her privileges to SYSTEM by overwriting/putting malicious DLLs under the System32 folder to abuse DLL Search Order.

To illustrate, I used the [symboliclink-testing-tools](https://github.com/googleprojectzero/symboliclink-testing-tools) toolkit from James Forshaw.

To write an example file under the System32 directory from a low-privileged account, first, we can create a directory and a file on the Desktop. Then we can put Eicar content to this file to trigger the quarantine feature. After that, Comodo Antivirus detects this file and quarantines it.

When the file is in the quarantine, we can create an NTFS junction by using the CreateMountPoint tool from our symbolic link toolkit. **We can arrange this NTFS junction so that it redirects any write operation for the directory on the Desktop to the System32 directory.** When the NTFS junction is ready, if we restore the file, we can realize that it is now placed under the System32 directory.

I showed these steps in a Youtube video. You can watch it below. To escalate privilege, you can overwrite or put a malicious DLL, whose name is the same as a DLL imported by a SERVICE level process, under the System32 folder.

[Comodo Antivirus](https://medium.com/tag/comodo-antivirus?source=post_page-----476a4601d9b8--------------------------------)[Comodo](https://medium.com/tag/comodo?source=post_page-----476a4601d9b8--------------------------------)[Zero Day](https://medium.com/tag/zero-day?source=post_page-----476a4601d9b8--------------------------------)[Vulnerability](https://medium.com/tag/vulnerability?source=post_page-----476a4601d9b8--------------------------------)[Cve](https://medium.com/tag/cve?source=post_page-----476a4601d9b8--------------------------------)

--

--

[![Furkan Göksel](https://miro.medium.com/v2/resize:fill:96:96/1*V7FgynBucXFGCaaNm2oJ8w.jpeg)](/?source=post_page---post_author_info--476a4601d9b8--------------------------------)[![Furkan Göksel](https://miro.medium.com/v2/resize:fill:128:128/1*V7FgynBucXFGCaaNm2oJ8w.jpeg)](/?source=post_page---post_author_info--476a4601d9b8--------------------------------)Follow[## Written by Furkan Göksel](/?source=post_page---post_author_info--476a4601d9b8--------------------------------)[6 Followers](/followers?source=post_page---post_author_info--476a4601d9b8--------------------------------)·[3 Following](/following?source=post_page---post_author_info--476a4601d9b8--------------------------------)

Requiem for a dream

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----476a4601d9b8--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----476a4601d9b8--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----476a4601d9b8--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----476a4601d9b8--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----476a4601d9b8--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----476a4601d9b8--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----476a4601d9b8--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----476a4601d9b8--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----476a4601d9b8--------------------------------)[Teams](https://medium.com/business?source=post_page-----476a4601d9b8--------------------------------)

