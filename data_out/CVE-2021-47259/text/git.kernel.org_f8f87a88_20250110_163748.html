

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Anna Schumaker <Anna.Schumaker@Netapp.com> | 2021-06-02 14:31:20 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-16 12:01:46 +0200 |
| commit | [c3b6cf64dfe4ef96e7341508d50d6998da7062c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)) | |
| tree | [d57cde120839b334b94a5fbf4e8d9aa8f8951279](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7) | |
| parent | [9064c9d544b906a63e359db5f908594bc07580e6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9064c9d544b906a63e359db5f908594bc07580e6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7&id2=9064c9d544b906a63e359db5f908594bc07580e6)) | |
| download | [linux-c3b6cf64dfe4ef96e7341508d50d6998da7062c7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c3b6cf64dfe4ef96e7341508d50d6998da7062c7.tar.gz) | |

NFS: Fix use-after-free in nfs4\_init\_client()commit 476bdb04c501fc64bf3b8464ffddefc8dbe01577 upstream.
KASAN reports a use-after-free when attempting to mount two different
exports through two different NICs that belong to the same server.
Olga was able to hit this with kernels starting somewhere between 5.7
and 5.10, but I traced the patch that introduced the clear\_bit() call to
4.13. So something must have changed in the refcounting of the clp
pointer to make this call to nfs\_put\_client() the very last one.
Fixes: 8dcbec6d20 ("NFSv41: Handle EXCHID4\_FLAG\_CONFIRMED\_R during NFSv4.1 migration")
Cc: stable@vger.kernel.org # 4.13+
Signed-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)

| -rw-r--r-- | [fs/nfs/nfs4client.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/nfs/nfs4client.c?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/fs/nfs/nfs4client.c b/fs/nfs/nfs4client.cindex be7915c861cef6..7491323a582075 100644--- a/[fs/nfs/nfs4client.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4client.c?id=9064c9d544b906a63e359db5f908594bc07580e6)+++ b/[fs/nfs/nfs4client.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/nfs/nfs4client.c?id=c3b6cf64dfe4ef96e7341508d50d6998da7062c7)@@ -435,8 +435,8 @@ struct nfs\_client \*nfs4\_init\_client(struct nfs\_client \*clp, \*/ nfs\_mark\_client\_ready(clp, -EPERM); }- nfs\_put\_client(clp); clear\_bit(NFS\_CS\_TSM\_POSSIBLE, &clp->cl\_flags);+ nfs\_put\_client(clp); return old;  error: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:36:25 +0000

