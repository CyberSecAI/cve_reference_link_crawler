

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3061953%2Flearnpress%2Ftags%2F4.0.1%2Finc%2Fadmin%2Fclass-lp-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2528330/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php "Changeset 2528330 for learnpress/tags/4.0.1/inc/admin/class-lp-admin.php")
* Next Change →

---

# Changeset [3061953](/changeset/3061953 "Show full changeset") for [learnpress/tags/4.0.1/inc/admin/class-lp-admin.php](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/01/2024 08:22:49 AM
([10 months](/timeline?from=2024-04-01T08%3A22%3A49Z&precision=second "See timeline at 04/01/2024 08:22:49 AM") ago)

Author:
ThimPress
Message:
# 4.0.1

File:

1 edited

* [learnpress/tags/4.0.1/inc/admin/class-lp-admin.php](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953 "Show entry in browser")
  (modified)
  ([26 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [learnpress/tags/4.0.1/inc/admin/class-lp-admin.php](/changeset/3061953/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php "Show the changeset 3061953 restricted to learnpress/tags/4.0.1/inc/admin/class-lp-admin.php")

  | [r2528330](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L29 "Show revision 2528330 of this file in browser") | [r3061953](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L29 "Show revision 3061953 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | add\_action( 'delete\_user\_form', array( $this, 'delete\_user\_form' ) ); |
  | 30 | 30 | add\_action( 'wp\_ajax\_learn\_press\_rated', array( $this, 'rated' ) ); |
  | 31 |  | add\_action( 'admin\_notices', array( $this, 'notice\_outdated\_templates' ) ); |
  | 32 |  | add\_action( 'admin\_notices', array( $this, 'notice\_required\_permalink' ) ); |
  | 33 |  | add\_action( 'admin\_notices', array( $this, 'admin\_notices' ), 1 ); |
  | 34 |  | //add\_action( 'admin\_head', array( $this, 'admin\_colors' ) ); |
  | 35 |  | add\_action( 'admin\_init', array( $this, 'admin\_redirect' ) ); |
  |  | 31 | add\_action( 'admin\_notices', array( $this, 'admin\_notices' ) ); |
  | 36 | 32 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'load\_modal' ) ); |
  | 37 |  |  |
  | 38 | 33 | add\_filter( 'admin\_body\_class', array( $this, 'body\_class' ) ); |
  | 39 | 34 | add\_filter( 'manage\_users\_custom\_column', array( $this, 'users\_custom\_column' ), 10, 3 ); |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L51) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L46) |  |
  | 51 | 46 | add\_filter( 'learn-press/modal-search-items-args', array( $this, 'filter\_modal\_search' ) ); |
  | 52 | 47 |  |
  | 53 |  | add\_filter( |
  |  | 48 | /\*add\_filter( |
  | 54 | 49 | 'learn-press/dismissed-notice-response', |
  | 55 | 50 | array( |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L59) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L54) |  |
  | 59 | 54 | 10, |
  | 60 | 55 | 2 |
  | 61 |  | ); |
  |  | 56 | );\*/ |
  | 62 | 57 |  |
  | 63 | 58 | // get list items course of user | tungnx |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L67) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L62) |  |
  | 67 | 62 | // Set link item course when edit on Backend | tungnx |
  | 68 | 63 | add\_filter( 'get\_sample\_permalink\_html', array( $this, 'lp\_course\_set\_link\_item\_backend' ), 10, 5 ); |
  |  | 64 |  |
  |  | 65 | /\*add\_action( |
  |  | 66 | 'admin\_init', |
  |  | 67 | function () { |
  |  | 68 | // From LP v4.2.3 temporary run create pages to add page instructors, single instructor for client upgrade LP. |
  |  | 69 | // After a long time, will remove this code. |
  |  | 70 | if ( is\_admin() && ! defined( 'DOING\_AJAX' ) ) { |
  |  | 71 | LP\_Install::create\_pages(); |
  |  | 72 | } |
  |  | 73 | } |
  |  | 74 | );\*/ |
  | 69 | 75 | } |
  | 70 | 76 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L130) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L136) |  |
  | 130 | 136 |  |
  | 131 | 137 | if ( $s && false !== stripos( $s, 'learnpress' ) ) { |
  | 132 |  | $views['learnpress'] = sprintf( '<a href="%s" class="current">%s <span class="count">(%d/%d)</span></a>', |
  | 133 |  | admin\_url( 'plugins.php?s=learnpress' ), \_\_( 'LearnPress', 'learnpress' ), $count\_activated, |
  | 134 |  | sizeof( $search ) ); |
  |  | 138 | $views['learnpress'] = sprintf( |
  |  | 139 | '<a href="%s" class="current">%s <span class="count">(%d/%d)</span></a>', |
  |  | 140 | admin\_url( 'plugins.php?s=learnpress' ), |
  |  | 141 | \_\_( 'LearnPress', 'learnpress' ), |
  |  | 142 | $count\_activated, |
  |  | 143 | sizeof( $search ) |
  |  | 144 | ); |
  | 135 | 145 | } else { |
  | 136 |  | $views['learnpress'] = sprintf( '<a href="%s">%s <span class="count">(%d/%d)</span></a>', |
  | 137 |  | admin\_url( 'plugins.php?s=learnpress' ), \_\_( 'LearnPress', 'learnpress' ), $count\_activated, |
  | 138 |  | sizeof( $search ) ); |
  |  | 146 | $views['learnpress'] = sprintf( |
  |  | 147 | '<a href="%s">%s <span class="count">(%d/%d)</span></a>', |
  |  | 148 | admin\_url( 'plugins.php?s=learnpress' ), |
  |  | 149 | \_\_( 'LearnPress', 'learnpress' ), |
  |  | 150 | $count\_activated, |
  |  | 151 | sizeof( $search ) |
  |  | 152 | ); |
  | 139 | 153 | } |
  | 140 | 154 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L302) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L316) |  |
  | 302 | 316 |  |
  | 303 | 317 | $all\_pages = array( |
  | 304 |  | 'courses'          => \_\_( 'Courses', 'learnpress' ), |
  | 305 |  | 'profile'          => \_\_( 'Profile', 'learnpress' ), |
  | 306 |  | 'checkout'         => \_\_( 'Checkout', 'learnpress' ), |
  | 307 |  | 'become\_a\_teacher' => \_\_( 'Become a Teacher', 'learnpress' ), |
  |  | 318 | 'courses'           => \_\_( 'Courses', 'learnpress' ), |
  |  | 319 | 'instructors'       => \_\_( 'Instructors', 'learnpress' ), |
  |  | 320 | 'single\_instructor' => \_\_( 'Single Instructors', 'learnpress' ), |
  |  | 321 | 'profile'           => \_\_( 'Profile', 'learnpress' ), |
  |  | 322 | 'checkout'          => \_\_( 'Checkout', 'learnpress' ), |
  |  | 323 | 'become\_a\_teacher'  => \_\_( 'Become a Teacher', 'learnpress' ), |
  | 308 | 324 | ); |
  | 309 | 325 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L361) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L377) |  |
  | 361 | 377 | \* |
  | 362 | 378 | \* @param string $column\_name |
  | 363 |  | \* @param int $post |
  |  | 379 | \* @param int $post |
  | 364 | 380 | \*/ |
  | 365 | 381 | public function page\_columns\_content( $column\_name, $post ) { |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L368) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L384) |  |
  | 368 | 384 | case 'lp-page': |
  | 369 | 385 | if ( ! empty( $pages['learnpress'][ $post ] ) ) { |
  | 370 |  | echo ~~$pages['learnpress'][ $post ]~~; |
  |  | 386 | echo wp\_kses\_post( $pages['learnpress'][ $post ] ); |
  | 371 | 387 | } |
  | 372 | 388 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L377) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L393) |  |
  | 377 | 393 |  |
  | 378 | 394 | if ( ! empty( $pages[ $plugin ][ $post ] ) ) { |
  | 379 |  | echo sprintf( '<p class="for-plugin-page">(%s - %s)</p>', $plugin, |
  | 380 |  | $pages[ $plugin ][ $post ] ); |
  |  | 395 | echo sprintf( |
  |  | 396 | '<p class="for-plugin-page">(%s - %s)</p>', |
  |  | 397 | $plugin, |
  |  | 398 | $pages[ $plugin ][ $post ] |
  |  | 399 | ); |
  | 381 | 400 | } |
  | 382 | 401 | } |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L397) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L416) |  |
  | 397 | 416 | $text = sprintf( \_\_( 'LearnPress Pages (%d)', 'learnpress' ), sizeof( $pages ) ); |
  | 398 | 417 | if ( 'yes' !== LP\_Request::get( 'lp-page' ) ) { |
  | 399 |  | $actions['lp-page'] = sprintf( '<a href="%s">%s</a>', |
  | 400 |  | admin\_url( 'edit.php?post\_type=page&lp-page=yes' ), $text ); |
  |  | 418 | $actions['lp-page'] = sprintf( |
  |  | 419 | '<a href="%s">%s</a>', |
  |  | 420 | admin\_url( 'edit.php?post\_type=page&lp-page=yes' ), |
  |  | 421 | $text |
  |  | 422 | ); |
  | 401 | 423 | } else { |
  | 402 | 424 | $actions['lp-page'] = $text; |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L415) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L437) |  |
  | 415 | 437 | \*/ |
  | 416 | 438 | public function get\_pages\_of\_lp( $q ) { |
  | 417 |  | if ( 'page' == LP\_Request::get( 'post\_type' ) && 'yes' == LP\_Request::get( 'lp-page' ) ) { |
  |  | 439 | if ( ! is\_admin() || ! $q->is\_main\_query() ) { |
  |  | 440 | return $q; |
  |  | 441 | } |
  |  | 442 |  |
  |  | 443 | if ( 'page' == LP\_Request::get\_param( 'post\_type' ) && 'yes' == LP\_Request::get\_param( 'lp-page' ) ) { |
  | 418 | 444 | $ids = $this->\_get\_static\_pages( 'learnpress' ); |
  | 419 | 445 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L430) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L456) |  |
  | 430 | 456 | \* Add actions to users list |
  | 431 | 457 | \* |
  | 432 |  | \* @param array $actions |
  |  | 458 | \* @param array $actions |
  | 433 | 459 | \* @param WP\_User $user |
  | 434 | 460 | \* |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L439) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L465) |  |
  | 439 | 465 | if ( LP\_Request::get\_string( 'lp-action' ) == 'pending-request' && $pending\_request ) { |
  | 440 | 466 | $actions = array(); |
  |  | 467 | $nonce   = 'nonce=' . wp\_create\_nonce( 'lp-action-permit-role-teacher' ); |
  | 441 | 468 | if ( in\_array( $user->ID, $pending\_request ) ) { |
  | 442 |  | $actions['accept']      = sprintf( '<a href="' . admin\_url( 'users.php?lp-action=accept-request&user\_id=' . $user->ID ) . '">%s</a>', |
  | 443 |  | \_x( 'Accept', 'pending-request', 'learnpress' ) ); |
  | 444 |  | $actions['delete deny'] = sprintf( '<a class="submitdelete" href="' . admin\_url( 'users.php?lp-action=deny-request&user\_id=' . $user->ID ) . '">%s</a>', |
  | 445 |  | \_x( 'Deny', 'pending-request', 'learnpress' ) ); |
  |  | 469 | $actions['accept']      = sprintf( |
  |  | 470 | '<a href="%s">%s</a>', |
  |  | 471 | admin\_url( "users.php?lp-action=accept-request&user\_id={$user->ID}&{$nonce}" ), |
  |  | 472 | \_x( 'Accept', 'pending-request', 'learnpress' ) |
  |  | 473 | ); |
  |  | 474 | $actions['delete deny'] = sprintf( |
  |  | 475 | '<a class="submitdelete" href="%s">%s</a>', |
  |  | 476 | admin\_url( "users.php?lp-action=deny-request&user\_id={$user->ID}&{$nonce}" ), |
  |  | 477 | \_x( 'Deny', 'pending-request', 'learnpress' ) |
  |  | 478 | ); |
  | 446 | 479 | } |
  | 447 | 480 | } |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L461) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L494) |  |
  | 461 | 494 |  |
  | 462 | 495 | $user\_id = LP\_Request::get\_int( 'user\_id' ); |
  | 463 |  |  |
  | 464 | 496 | if ( ! $user\_id || ! get\_user\_by( 'id', $user\_id ) ) { |
  | 465 | 497 | return; |
  | 466 | 498 | } |
  | 467 | 499 |  |
  |  | 500 | $nonce = LP\_Request::get\_param( 'nonce' ); |
  |  | 501 | if ( ! wp\_verify\_nonce( $nonce, 'lp-action-permit-role-teacher' ) ) { |
  |  | 502 | return; |
  |  | 503 | } |
  |  | 504 |  |
  | 468 | 505 | $user\_data = get\_userdata( $user\_id ); |
  | 469 |  |  |
  | 470 | 506 | if ( in\_array( $action, array( 'accept-request', 'deny-request' ) ) ) { |
  | 471 | 507 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L511) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L547) |  |
  | 511 | 547 | $class = ''; |
  | 512 | 548 | } |
  | 513 |  | $views['pending-request'] = '<a href="' . admin\_url( 'users.php?lp-action=pending-request' ) . '"' . $class . '>' . sprintf( \_\_( 'Pending Request %s', |
  | 514 |  | 'learnpress' ), '<span class="count">(' . count( $pending\_request ) . ')</span>' ) . '</a>'; |
  |  | 549 | $views['pending-request'] = '<a href="' . admin\_url( 'users.php?lp-action=pending-request' ) . '"' . $class . '>' . sprintf( |
  |  | 550 | \_\_( |
  |  | 551 | 'Pending Request %s', |
  |  | 552 | 'learnpress' |
  |  | 553 | ), |
  |  | 554 | '<span class="count">(' . count( $pending\_request ) . ')</span>' |
  |  | 555 | ) . '</a>'; |
  | 515 | 556 | } |
  | 516 | 557 |  |
  | 517 | 558 | return $views; |
  | 518 |  | ~~}~~ |
  | 519 |  |  |
  | 520 |  | ~~/\*\*~~ |
  | 521 |  | ~~\* Display admin notices~~ |
  | 522 |  | ~~\*/~~ |
  | 523 |  | ~~public function admin\_notices() {~~ |
  | 524 |  | ~~if ( ! current\_user\_can( ADMIN\_ROLE ) ) {~~ |
  | 525 |  | ~~return;~~ |
  | 526 |  | ~~}~~ |
  | 527 |  |  |
  | 528 |  | ~~if ( 'yes' === get\_option( 'learn\_press\_install' ) ) {~~ |
  | 529 |  | ~~learn\_press\_admin\_view( 'setup/notice-setup' );~~ |
  | 530 |  | ~~}~~ |
  | 531 |  |  |
  | 532 |  | ~~$action  = LP\_Request::get( 'lp-action' );~~ |
  | 533 |  | ~~$user\_id = LP\_Request::get\_int( 'user\_id' );~~ |
  | 534 |  |  |
  | 535 |  | ~~if ( ( in\_array( $action,~~ |
  | 536 |  | ~~array( 'accepted-request', 'denied-request' ) ) ) && ( $user\_id ) && get\_user\_by( 'id',~~ |
  | 537 |  | ~~$user\_id ) ) {~~ |
  | 538 |  | ~~if ( ! current\_user\_can( 'promote\_user', $user\_id ) ) {~~ |
  | 539 |  | ~~wp\_die( \_\_( 'Sorry, you are not allowed to edit this user.', 'learnpress' ) );~~ |
  | 540 |  | ~~}~~ |
  | 541 |  | ~~?>~~ |
  | 542 |  |  |
  | 543 |  | ~~<div class="updated notice">~~ |
  | 544 |  | ~~<p><?php echo sprintf( \_\_( 'User has %s to become a teacher.', 'learnpress' ),~~ |
  | 545 |  | ~~$action == 'accepted-request' ? 'accepted' : 'denied' ); ?></p>~~ |
  | 546 |  | ~~</div>~~ |
  | 547 |  |  |
  | 548 |  | ~~<?php~~ |
  | 549 |  | ~~}~~ |
  | 550 |  | ~~}~~ |
  | 551 |  |  |
  | 552 |  | ~~/\*\*~~ |
  | 553 |  | ~~\* Redirect to setup page if we have just activated LP~~ |
  | 554 |  | ~~\*/~~ |
  | 555 |  | ~~public function admin\_redirect() {~~ |
  | 556 |  | ~~// Fix temporary, after release 4.0.0 release remove this.~~ |
  | 557 |  | ~~// Check extra\_value column exists.~~ |
  | 558 |  | ~~$lp\_db = LP\_Database::getInstance();~~ |
  | 559 |  | ~~$lp\_db->add\_col\_table($lp\_db->tb\_lp\_user\_itemmeta, 'extra\_value', 'longtext', 'meta\_value');~~ |
  | 560 |  | ~~// End.~~ |
  | 561 |  |  |
  | 562 |  | ~~if ( 'yes' === get\_transient( 'lp\_activation\_redirect' ) && current\_user\_can( 'install\_plugins' ) ) {~~ |
  | 563 |  | ~~delete\_transient( 'lp\_activation\_redirect' );~~ |
  | 564 |  |  |
  | 565 |  | ~~wp\_safe\_redirect( admin\_url( 'index.php?page=lp-setup' ) );~~ |
  | 566 |  | ~~}~~ |
  | 567 | 559 | } |
  | 568 | 560 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L593) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L585) |  |
  | 593 | 585 | } |
  | 594 | 586 |  |
  | 595 |  | public function notice\_required\_permalink() { |
  | 596 |  | if ( current\_user\_can( 'manage\_options' ) ) { |
  | 597 |  | if ( ! get\_option( 'permalink\_structure' ) ) { |
  | 598 |  | learn\_press\_add\_notice( sprintf( \_\_( 'LearnPress requires permalink option <strong>Post name</strong> is enabled. Please enable it <a href="%s">here</a> to ensure that all functions work properly.', |
  | 599 |  | 'learnpress' ), admin\_url( 'options-permalink.php' ) ), 'error' ); |
  | 600 |  | } |
  | 601 |  | } |
  | 602 |  | } |
  | 603 |  |  |
  | 604 |  | /\*\* |
  | 605 |  | \* Notices outdated templates. |
  | 606 |  | \*/ |
  | 607 |  | public function notice\_outdated\_templates() { |
  | 608 |  | if ( current\_user\_can( 'manage\_options' ) ) { |
  | 609 |  | $page = ''; |
  | 610 |  | $tab  = ''; |
  | 611 |  | if ( ! empty( $\_REQUEST['page'] ) ) { |
  | 612 |  | $page = $\_REQUEST['page']; |
  | 613 |  | } |
  | 614 |  |  |
  | 615 |  | if ( ! empty( $\_REQUEST['tab'] ) ) { |
  | 616 |  | $tab = $\_REQUEST['tab']; |
  | 617 |  | } |
  | 618 |  |  |
  | 619 |  | if ( $page == 'learn-press-tools' && $tab == 'templates' ) { |
  | 620 |  | return; |
  | 621 |  | } |
  | 622 |  |  |
  |  | 587 | /\*\* |
  |  | 588 | \* Display notices on Backend. |
  |  | 589 | \*/ |
  |  | 590 | public function admin\_notices() { |
  |  | 591 | // Show template file templates override. |
  |  | 592 | $page = LP\_Request::get\_param( 'page' ); |
  |  | 593 | $tab  = LP\_Request::get\_param( 'tab' ); |
  |  | 594 | if ( $page == 'learn-press-tools' && $tab == 'templates' ) { |
  | 623 | 595 | if ( LP\_Outdated\_Template\_Helper::detect\_outdated\_template() ) { |
  | 624 | 596 | learn\_press\_admin\_view( 'html-admin-notice-templates' ); |
  | 625 | 597 | } |
  | 626 | 598 | } |
  |  | 599 |  |
  |  | 600 | // Request accept/denied user can become a teacher. |
  |  | 601 | $action\_become\_teacher      = LP\_Request::get\_param( 'lp-action' ); |
  |  | 602 | $user\_id                    = LP\_Request::get\_param( 'user\_id', 0, 'int' ); |
  |  | 603 | $type\_action\_become\_teacher = array( 'accepted-request', 'denied-request' ); |
  |  | 604 | if ( in\_array( $action\_become\_teacher, $type\_action\_become\_teacher ) && $user\_id && get\_user\_by( 'id', $user\_id ) ) { |
  |  | 605 | ?> |
  |  | 606 | <div class="updated notice"> |
  |  | 607 | <p> |
  |  | 608 | <?php |
  |  | 609 | echo sprintf( |
  |  | 610 | \_\_( 'A user has %s to become a teacher.', 'learnpress' ), |
  |  | 611 | $action\_become\_teacher == 'accepted-request' ? 'accepted' : 'denied' |
  |  | 612 | ); |
  |  | 613 | ?> |
  |  | 614 | </p> |
  |  | 615 | </div> |
  |  | 616 | <?php |
  |  | 617 | } |
  |  | 618 |  |
  |  | 619 | learn\_press\_admin\_view( 'admin-notices.php', [], true ); |
  | 627 | 620 | } |
  | 628 | 621 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L646) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L639) |  |
  | 646 | 639 | $pages          = learn\_press\_get\_screens(); |
  | 647 | 640 |  |
  | 648 |  | if ( isset( $current\_screen->id ) && apply\_filters( 'learn\_press\_display\_admin\_footer\_text', |
  | 649 |  | in\_array( $current\_screen->id, $pages ) ) ) { |
  |  | 641 | if ( isset( $current\_screen->id ) && apply\_filters( |
  |  | 642 | 'learn\_press\_display\_admin\_footer\_text', |
  |  | 643 | in\_array( $current\_screen->id, $pages ) |
  |  | 644 | ) ) { |
  | 650 | 645 | if ( ! get\_option( 'learn\_press\_message\_user\_rated' ) ) { |
  | 651 |  | $footer\_text = sprintf( \_\_( 'If you like <strong>LearnPress</strong> please leave us a %1$s&#9733;&#9733;&#9733;&#9733;&#9733;%2$s rating. A huge thanks from LearnPress team for your generous.', |
  | 652 |  | 'learnpress' ), |
  | 653 |  | '<a href="https://wordpress.org/support/plugin/learnpress/reviews/?filter=5#postform" target="\_blank" class="lp-rating-link" data-rated="' . esc\_attr\_\_( 'Thanks :)', |
  | 654 |  | 'learnpress' ) . '">', '</a>' ); |
  |  | 646 | $footer\_text = sprintf( |
  |  | 647 | \_\_( |
  |  | 648 | 'If you like <strong>LearnPress</strong> please leave us a %1$s&#9733;&#9733;&#9733;&#9733;&#9733;%2$s rating. A huge thanks from the LearnPress team for your generosity.', |
  |  | 649 | 'learnpress' |
  |  | 650 | ), |
  |  | 651 | '<a href="https://wordpress.org/support/plugin/learnpress/reviews/?filter=5#postform" target="\_blank" class="lp-rating-link" data-rated="' . esc\_attr\_\_( |
  |  | 652 | 'Thanks :)', |
  |  | 653 | 'learnpress' |
  |  | 654 | ) . '">', |
  |  | 655 | '</a>' |
  |  | 656 | ); |
  | 655 | 657 |  |
  | 656 | 658 | ob\_start(); |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L697) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L699) |  |
  | 697 | 699 | \* Send data to join newsletter or dismiss. |
  | 698 | 700 | \* |
  | 699 |  | \* @param array $data |
  |  | 701 | \* @param array $data |
  | 700 | 702 | \* @param string $notice |
  | 701 | 703 | \* |
  | 702 | 704 | \* @return array |
  | 703 | 705 | \* @since 3.0.10 |
  | 704 |  | \*/ |
  | 705 |  | public function on\_dismissed\_notice\_response( $data, $notice ) { |
  |  | 706 | \* @deprecated 4.2.3.1 |
  |  | 707 | \*/ |
  |  | 708 | /\*public function on\_dismissed\_notice\_response( $data, $notice ) { |
  | 706 | 709 | switch ( $notice ) { |
  | 707 | 710 | case 'skip-setup-wizard': |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L716) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L719) |  |
  | 716 | 719 | $user = learn\_press\_get\_current\_user(); |
  | 717 | 720 | if ( ! $user || $user->get\_email() == '' ) { |
  | 718 |  | $data['error'] = \_\_( 'Fail~~while joining~~ newsletter! Please try again!', 'learnpress' ); |
  |  | 721 | $data['error'] = \_\_( 'Failed while joining the newsletter! Please try again!', 'learnpress' ); |
  | 719 | 722 | } |
  | 720 | 723 |  |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L744) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L747) |  |
  | 744 | 747 | $data['message'] = \_\_( 'Something went wrong: ', 'learnpress' ) . $error\_message; |
  | 745 | 748 | } else { |
  | 746 |  | $data['message'] = \_\_( 'Thank you for subscribing! Please check and click the confirmation link from the email we\'ve just sent to your mail box.', |
  | 747 |  | 'learnpress' ); |
  |  | 749 | $data['message'] = \_\_( |
  |  | 750 | 'Thank you for subscribing! Please check and click the confirmation link from the email that we\'ve just sent to your inbox.', |
  |  | 751 | 'learnpress' |
  |  | 752 | ); |
  | 748 | 753 | } |
  | 749 | 754 | } |
  | 750 | 755 |  |
  | 751 | 756 | return $data; |
  | 752 |  | } |
  |  | 757 | }\*/ |
  | 753 | 758 |  |
  | 754 | 759 | /\*\* |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L762) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L767) |  |
  | 762 | 767 | include\_once 'class-lp-admin-assets.php'; |
  | 763 | 768 | include\_once 'class-lp-admin-dashboard.php'; |
  | 764 |  | include\_once 'class-lp-admin-tools.php'; |
  |  | 769 | // include\_once 'class-lp-admin-tools.php'; |
  | 765 | 770 | include\_once 'class-lp-admin-ajax.php'; |
  | 766 | 771 | include\_once 'editor/class-lp-admin-editor.php'; |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L771) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L776) |  |
  | 771 | 776 | include\_once 'class-lp-modal-search-users.php'; |
  | 772 | 777 | include\_once 'class-lp-setup-wizard.php'; |
  | 773 |  | ~~//~~ include\_once 'class-lp-updater.php'; |
  |  | 778 | // include\_once 'class-lp-updater.php'; |
  | 774 | 779 | include\_once 'class-lp-install-sample-data.php'; |
  | 775 | 780 | include\_once 'class-lp-reset-data.php'; |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L785) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L790) |  |
  | 785 | 790 | \* @param WP\_Query $query |
  | 786 | 791 | \*/ |
  | 787 |  | public function get\_course\_items\_of\_user\_backend( $query ) { |
  |  | 792 | public function get\_course\_items\_of\_user\_backend( WP\_Query $query ) { |
  | 788 | 793 | if ( ! $query->is\_main\_query() ) { |
  | 789 | 794 | return; |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L792) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L797) |  |
  | 792 | 797 | global $post\_type, $pagenow; |
  | 793 | 798 |  |
  | 794 |  | if ( current\_user\_can( ~~'administrator'~~ ) ) { |
  |  | 799 | if ( current\_user\_can( ADMIN\_ROLE ) ) { |
  | 795 | 800 | return; |
  | 796 | 801 | } |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L813) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L818) |  |
  | 813 | 818 | $query = apply\_filters( 'learnpress/get-post-type-lp-on-backend', $query ); |
  | 814 | 819 |  |
  | 815 |  | add\_filter( 'views\_edit-' . $post\_type . '', '\_learn\_press\_restrict\_view\_items', 10 ); |
  |  | 820 | //add\_filter( 'views\_edit-' . $post\_type . '', '\_learn\_press\_restrict\_view\_items', 10 ); |
  | 816 | 821 | remove\_filter( 'pre\_get\_posts', array( $this, 'get\_course\_items\_of\_user\_backend' ), 10 ); |
  | 817 | 822 | } |
  | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=2528330#L820) | […](/browser/learnpress/tags/4.0.1/inc/admin/class-lp-admin.php?rev=3061953#L825) |  |
  | 820 | 825 | \* Set link item of course when edit item on Backend |
  | 821 | 826 | \* |
  | 822 |  | \* @param string $post\_link |
  | 823 |  | \* @param int $post\_id |
  | 824 |  | \* @param string $new\_title |
  | 825 |  | \* @param string $new\_slug |
  |  | 827 | \* @param string $post\_link |
  |  | 828 | \* @param int $post\_id |
  |  | 829 | \* @param string $new\_title |
  |  | 830 | \* @param string $new\_slug |
  | 826 | 831 | \* @param WP\_Post|null $post |
  | 827 | 832 | \* |
  | 828 |  | \* @return ~~array|int|mixed|string|void~~ |
  |  | 833 | \* @return string |
  | 829 | 834 | \* @author tungnx |
  | 830 | 835 | \* @since  3.2.7.5 |
  | 831 |  | \*/ |
  | 832 |  | public function lp\_course\_set\_link\_item\_backend( |
  | 833 |  | $post\_link = '', |
  | 834 |  | $post\_id = 0, |
  | 835 |  | $new\_title = '', |
  | 836 |  | $new\_slug = '', |
  | 837 |  | $post = null |
  | 838 |  | ) { |
  | 839 |  | if ( ! in\_array( $post->post\_type, learn\_press\_get\_course\_item\_types() ) ) { |
  | 840 |  | return $post\_link; |
  | 841 |  | } |
  | 842 |  |  |
  | 843 |  | $course            = null; |
  | 844 |  | $course\_id\_of\_item = LP\_Course\_DB::getInstance()->learn\_press\_get\_item\_course( $post->ID ); |
  | 845 |  |  |
  | 846 |  | if ( $course\_id\_of\_item ) { |
  | 847 |  | $course = learn\_press\_get\_course( $course\_id\_of\_item ); |
  | 848 |  |  |
  | 849 |  | if ( $course ) { |
  | 850 |  | $link\_item = $course->get\_item\_link( $post->ID ); |
  | 851 |  |  |
  | 852 |  | $post\_slug           = $post->post\_name; |
  | 853 |  | $link\_item\_edit\_slug = preg\_replace( '/' . $post\_slug . '(\/)/', '', $link\_item ); |
  | 854 |  |  |
  | 855 |  | // For update new slug |
  | 856 |  | if ( $new\_slug ) { |
  | 857 |  | $post\_slug = $new\_slug; |
  | 858 |  | } |
  | 859 |  |  |
  | 860 |  | $post\_link = '<strong>Permalink: </strong>'; |
  | 861 |  | $post\_link .= '<span id="sample-permalink">'; |
  | 862 |  | $post\_link .= '<a href="' . $link\_item . '">' . $link\_item\_edit\_slug . '<span id="editable-post-name">' . $post\_slug . '</span>/</a>'; |
  | 863 |  | $post\_link .= '</span>'; |
  | 864 |  | $post\_link .= '&lrm;<span id="edit-slug-buttons">'; |
  | 865 |  | $post\_link .= '<button type="button" class="edit-slug button button-small hide-if-no-js" aria-label="Edit permalink">Edit</button>'; |
  | 866 |  | $post\_link .= '</span>'; |
  | 867 |  | $post\_link .= '<span id="editable-post-name-full">' . $post\_slug . '</span>'; |
  | 868 |  | } |
  | 869 |  | } else { |
  | 870 |  | // $post\_link\_preview = sprintf( '<a class="button" href="%s" target="\_blank">%s</a>', learn\_press\_get\_preview\_url( $post\_id ), \_\_( 'Preview', 'learnpress' ) ); |
  | 871 |  | $post\_link\_message = '<span>' . \_\_( 'Permalink only available if the item is already assigned to a course.', |
  | 872 |  | 'learnpress' ) . '</span>'; |
  | 873 |  | $post\_link         = sprintf( '<div id="learn-press-box-edit-slug">%s</div>', $post\_link\_message ); |
  |  | 836 | \* @version 4.0.1 |
  |  | 837 | \*/ |
  |  | 838 | public function lp\_course\_set\_link\_item\_backend( $post\_link = '', $post\_id = 0, $new\_title = '', $new\_slug = '', $post = null ) { |
  |  | 839 | try { |
  |  | 840 | if ( in\_array( $post->post\_type, learn\_press\_get\_course\_item\_types() ) ) { |
  |  | 841 | $course\_id\_of\_item = LP\_Course\_DB::getInstance()->get\_course\_by\_item\_id( $post->ID ); |
  |  | 842 | if ( $course\_id\_of\_item ) { |
  |  | 843 | $course = learn\_press\_get\_course( $course\_id\_of\_item ); |
  |  | 844 | if ( $course ) { |
  |  | 845 | $link\_item           = $course->get\_item\_link( $post->ID ); |
  |  | 846 | $link\_item           = LP\_Helper::handle\_lp\_permalink\_structure( $link\_item, get\_post( $course\_id\_of\_item ) ); |
  |  | 847 | $post\_slug           = $post->post\_name; |
  |  | 848 | $link\_item\_edit\_slug = preg\_replace( '/' . $post\_slug . '$/', '', $link\_item ); |
  |  | 849 |  |
  |  | 850 | // For update new slug |
  |  | 851 | if ( $new\_slug ) { |
  |  | 852 | $post\_slug = $new\_slug; |
  |  | 853 | } |
  |  | 854 |  |
  |  | 855 | $slug\_arr   = explode( '/', $link\_item\_edit\_slug ); |
  |  | 856 | $count\_slug = count( $slug\_arr ); |
  |  | 857 | unset( $slug\_arr[ $count\_slug - 2 ] ); |
  |  | 858 | $link\_item\_edit\_slug = implode( '/', $slug\_arr ); |
  |  | 859 |  |
  |  | 860 | $post\_link  = '<strong>Permalink: </strong>'; |
  |  | 861 | $post\_link .= '<span id="sample-permalink">'; |
  |  | 862 | $post\_link .= '<a href="' . $link\_item . '">' . $link\_item\_edit\_slug . '<span id="editable-post-name">' . $post\_slug . '</span>/</a>'; |
  |  | 863 | $post\_link .= '</span>'; |
  |  | 864 | $post\_link .= '&lrm;<span id="edit-slug-buttons">'; |
  |  | 865 | $post\_link .= '<button type="button" class="edit-slug button button-small hide-if-no-js" aria-label="Edit permalink">Edit</button>'; |
  |  | 866 | $post\_link .= '</span>'; |
  |  | 867 | $post\_link .= '<span id="editable-post-name-full">' . $post\_slug . '</span>'; |
  |  | 868 | } |
  |  | 869 | } else { |
  |  | 870 | $post\_link\_message = '<span>' . \_\_( |
  |  | 871 | 'Permalink is only available if the item is already assigned to a course.', |
  |  | 872 | 'learnpress' |
  |  | 873 | ) . '</span>'; |
  |  | 874 | $post\_link         = sprintf( '<div id="learn-press-box-edit-slug">%s</div>', $post\_link\_message ); |
  |  | 875 | } |
  |  | 876 | } elseif ( LP\_COURSE\_CPT === get\_post\_type( $post ) ) { |
  |  | 877 | $post\_link = LP\_Helper::handle\_lp\_permalink\_structure( $post\_link, $post ); |
  |  | 878 | } |
  |  | 879 | } catch ( Throwable $e ) { |
  |  | 880 | error\_log( $e->getMessage() ); |
  | 874 | 881 | } |
  | 875 | 882 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3061953)
* [Zip Archive](?format=zip&new=3061953)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

