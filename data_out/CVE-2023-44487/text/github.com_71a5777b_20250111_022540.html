
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fcommit%2F58f75f665aa81a8cbcf6ffa74820042a285c5e61)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fcommit%2F58f75f665aa81a8cbcf6ffa74820042a285c5e61)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=netty%2Fnetty)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[netty](/netty)
/
**[netty](/netty/netty)**
Public

* [Notifications](/login?return_to=%2Fnetty%2Fnetty) You must be signed in to change notification settings
* [Fork
  16k](/login?return_to=%2Fnetty%2Fnetty)
* [Star
   33.7k](/login?return_to=%2Fnetty%2Fnetty)

* [Code](/netty/netty)
* [Issues
  575](/netty/netty/issues)
* [Pull requests
  39](/netty/netty/pulls)
* [Discussions](/netty/netty/discussions)
* [Actions](/netty/netty/actions)
* [Projects
  0](/netty/netty/projects)
* [Wiki](/netty/netty/wiki)
* [Security](/netty/netty/security)
* [Insights](/netty/netty/pulse)

Additional navigation options

* [Code](/netty/netty)
* [Issues](/netty/netty/issues)
* [Pull requests](/netty/netty/pulls)
* [Discussions](/netty/netty/discussions)
* [Actions](/netty/netty/actions)
* [Projects](/netty/netty/projects)
* [Wiki](/netty/netty/wiki)
* [Security](/netty/netty/security)
* [Insights](/netty/netty/pulse)

## Commit

[Permalink](/netty/netty/commit/58f75f665aa81a8cbcf6ffa74820042a285c5e61)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-xpw8-rcwv-8f8p](https://github.com/advisories/GHSA-xpw8-rcwv-8f8p "GHSA-xpw8-rcwv-8f8p")

[Browse files](/netty/netty/tree/58f75f665aa81a8cbcf6ffa74820042a285c5e61)
Browse the repository at this point in the history

```
Motivation:

It's possible for a remote peer to overload a remote system by issue a huge amount of RST frames. While this is completely valid in terms of the RFC we need to limit the amount to protect against DDOS attacks.

Modifications:

Add protection against RST floods which is enabled by default.

Result:

Protect against DDOS caused by RST floods ([CVE-2023-44487](https://github.com/advisories/GHSA-qppj-fm5r-hxr3 "CVE-2023-44487"))
```

* Loading branch information

[![@normanmaurer](https://avatars.githubusercontent.com/u/439362?s=40&v=4)](/normanmaurer)

[normanmaurer](/netty/netty/commits?author=normanmaurer "View all commits by normanmaurer")
authored
Oct 10, 2023

1 parent
[4911448](/netty/netty/commit/491144865ad683f43ef1db64256aed8fd84a50be)

commit 58f75f6

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**316 additions**
and
**41 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* codec-http2/src

  + main/java/io/netty/handler/codec/http2

    - codec-http2/src/main/java/io/netty/handler/codec/http2/AbstractHttp2ConnectionHandlerBuilder.java
      [AbstractHttp2ConnectionHandlerBuilder.java](#diff-02aec4cae3a7a1ed1edc710158e36621114b047a691deb3449caa58e8eacc4e0)
    - codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodecBuilder.java
      [Http2FrameCodecBuilder.java](#diff-fbc2b526700774712c86addb00833008e7cbf2a29ba8b4814a9049e587cb9c37)
    - codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameDecoder.java
      [Http2MaxRstFrameDecoder.java](#diff-532c2b53532c29acc527c8ee1ef52587ddc8635da05ad541413e26db0d778464)
    - codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameListener.java
      [Http2MaxRstFrameListener.java](#diff-82f568a075ff63e9727ce8622f3a2b1553099182edf1fd0b4f857226252b05ad)
    - codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MultiplexCodecBuilder.java
      [Http2MultiplexCodecBuilder.java](#diff-fba2cd287e562e8c1537b83f18c8a22af77ffdb0a363f62833bbc785ac609ad6)
  + test/java/io/netty/handler/codec/http2

    - codec-http2/src/test/java/io/netty/handler/codec/http2/AbstractDecoratingHttp2ConnectionDecoderTest.java
      [AbstractDecoratingHttp2ConnectionDecoderTest.java](#diff-8df3bfd17dc759d2ed529bbb076d46931edd19474c2c0e684094cbfee540092e)
    - codec-http2/src/test/java/io/netty/handler/codec/http2/Http2EmptyDataFrameConnectionDecoderTest.java
      [Http2EmptyDataFrameConnectionDecoderTest.java](#diff-27e3ab2ac3eb796584fbafc8f1fbffb3be2189a961cbc4e45b5f51ac1a6a84c0)
    - codec-http2/src/test/java/io/netty/handler/codec/http2/Http2MaxRstFrameConnectionDecoderTest.java
      [Http2MaxRstFrameConnectionDecoderTest.java](#diff-79f05d418856e6569da913d97e2c54ab2859b1f7f6fde0dc0cf7b21b07e0fa2b)
    - codec-http2/src/test/java/io/netty/handler/codec/http2/Http2MaxRstFrameListenerTest.java
      [Http2MaxRstFrameListenerTest.java](#diff-f24bcc65a0e873d935d0f20598b3410b0562785dcca676580d3634b245daca60)

## There are no files selected for viewing

24 changes: 22 additions & 2 deletions

24
[...tp2/src/main/java/io/netty/handler/codec/http2/AbstractHttp2ConnectionHandlerBuilder.java](#diff-02aec4cae3a7a1ed1edc710158e36621114b047a691deb3449caa58e8eacc4e0 "codec-http2/src/main/java/io/netty/handler/codec/http2/AbstractHttp2ConnectionHandlerBuilder.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/main/java/io/netty/handler/codec/http2/AbstractHttp2ConnectionHandlerBuilder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -109,6 +109,8 @@ public abstract class AbstractHttp2ConnectionHandlerBuilder<T extends Http2Conne |
|  |  | private boolean autoAckPingFrame = true; |
|  |  | private int maxQueuedControlFrames = Http2CodecUtil.DEFAULT\_MAX\_QUEUED\_CONTROL\_FRAMES; |
|  |  | private int maxConsecutiveEmptyFrames = 2; |
|  |  | private int maxRstFramesPerWindow = 200; |
|  |  | private int secondsPerWindow = 30; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sets the {@link Http2Settings} to use for the initial connection settings exchange. |
| Expand Down  Expand Up | | @@ -410,7 +412,7 @@ protected Http2PromisedRequestVerifier promisedRequestVerifier() { |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns the maximum number of consecutive empty DATA frames (without end\_of\_stream flag) that are allowed before |
|  |  | \* the connection is closed. This allows to protected against the remote peer flooding us with such frames and |
|  |  | \* the connection is closed. This allows to protect against the remote peer flooding us with such frames and |
|  |  | \* so use up a lot of CPU. There is no valid use-case for empty DATA frames without end\_of\_stream flag. |
|  |  | \* |
|  |  | \* {@code 0} means no protection is in place. |
| Expand All | | @@ -421,7 +423,7 @@ protected int decoderEnforceMaxConsecutiveEmptyDataFrames() { |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sets the maximum number of consecutive empty DATA frames (without end\_of\_stream flag) that are allowed before |
|  |  | \* the connection is closed. This allows to protected against the remote peer flooding us with such frames and |
|  |  | \* the connection is closed. This allows to protect against the remote peer flooding us with such frames and |
|  |  | \* so use up a lot of CPU. There is no valid use-case for empty DATA frames without end\_of\_stream flag. |
|  |  | \* |
|  |  | \* {@code 0} means no protection should be applied. |
| Expand All | | @@ -433,6 +435,21 @@ protected B decoderEnforceMaxConsecutiveEmptyDataFrames(int maxConsecutiveEmptyF |
|  |  | return self(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sets the maximum number RST frames that are allowed per window before |
|  |  | \* the connection is closed. This allows to protect against the remote peer flooding us with such frames and |
|  |  | \* so use up a lot of CPU. |
|  |  | \* |
|  |  | \* {@code 0} for any of the parameters means no protection should be applied. |
|  |  | \*/ |
|  |  | protected B decoderEnforceMaxRstFramesPerWindow(int maxRstFramesPerWindow, int secondsPerWindow) { |
|  |  | enforceNonCodecConstraints("decoderEnforceMaxRstFramesPerWindow"); |
|  |  | this.maxRstFramesPerWindow = checkPositiveOrZero( |
|  |  | maxRstFramesPerWindow, "maxRstFramesPerWindow"); |
|  |  | this.secondsPerWindow = checkPositiveOrZero(secondsPerWindow, "secondsPerWindow"); |
|  |  | return self(); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Determine if settings frame should automatically be acknowledged and applied. |
|  |  | \* @return this. |
| Expand Down  Expand Up | | @@ -575,6 +592,9 @@ private T buildFromCodec(Http2ConnectionDecoder decoder, Http2ConnectionEncoder |
|  |  | if (maxConsecutiveEmptyDataFrames > 0) { |
|  |  | decoder = new Http2EmptyDataFrameConnectionDecoder(decoder, maxConsecutiveEmptyDataFrames); |
|  |  | } |
|  |  | if (maxRstFramesPerWindow > 0 && secondsPerWindow > 0) { |
|  |  | decoder = new Http2MaxRstFrameDecoder(decoder, maxRstFramesPerWindow, secondsPerWindow); |
|  |  | } |
|  |  | final T handler; |
|  |  | try { |
|  |  | // Call the abstract build method |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodecBuilder.java](#diff-fbc2b526700774712c86addb00833008e7cbf2a29ba8b4814a9049e587cb9c37 "codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodecBuilder.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2FrameCodecBuilder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -194,6 +194,12 @@ public Http2FrameCodecBuilder decoderEnforceMaxConsecutiveEmptyDataFrames(int ma |
|  |  | return super.decoderEnforceMaxConsecutiveEmptyDataFrames(maxConsecutiveEmptyFrames); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public Http2FrameCodecBuilder decoderEnforceMaxRstFramesPerWindow( |
|  |  | int maxConsecutiveEmptyFrames, int secondsPerWindow) { |
|  |  | return super.decoderEnforceMaxRstFramesPerWindow(maxConsecutiveEmptyFrames, secondsPerWindow); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Build a {@link Http2FrameCodec} object. |
|  |  | \*/ |
| Expand Down | |  |

58 changes: 58 additions & 0 deletions

58
[codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameDecoder.java](#diff-532c2b53532c29acc527c8ee1ef52587ddc8635da05ad541413e26db0d778464 "codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameDecoder.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameDecoder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,58 @@ |
|  |  | /\* |
|  |  | \* Copyright 2023 The Netty Project |
|  |  | \* |
|  |  | \* The Netty Project licenses this file to you under the Apache License, |
|  |  | \* version 2.0 (the "License"); you may not use this file except in compliance |
|  |  | \* with the License. You may obtain a copy of the License at: |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, WITHOUT |
|  |  | \* WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the |
|  |  | \* License for the specific language governing permissions and limitations |
|  |  | \* under the License. |
|  |  | \*/ |
|  |  | package io.netty.handler.codec.http2; |
|  |  |  |
|  |  | import static io.netty.util.internal.ObjectUtil.checkPositive; |
|  |  |  |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Enforce a limit on the maximum number of RST frames that are allowed per a window |
|  |  | \* before the connection will be closed with a GO\_AWAY frame. |
|  |  | \*/ |
|  |  | final class Http2MaxRstFrameDecoder extends DecoratingHttp2ConnectionDecoder { |
|  |  | private final int maxRstFramesPerWindow; |
|  |  | private final int secondsPerWindow; |
|  |  |  |
|  |  | Http2MaxRstFrameDecoder(Http2ConnectionDecoder delegate, int maxRstFramesPerWindow, int secondsPerWindow) { |
|  |  | super(delegate); |
|  |  | this.maxRstFramesPerWindow = checkPositive(maxRstFramesPerWindow, "maxRstFramesPerWindow"); |
|  |  | this.secondsPerWindow = checkPositive(secondsPerWindow, "secondsPerWindow"); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public void frameListener(Http2FrameListener listener) { |
|  |  | if (listener != null) { |
|  |  | super.frameListener(new Http2MaxRstFrameListener(listener, maxRstFramesPerWindow, secondsPerWindow)); |
|  |  | } else { |
|  |  | super.frameListener(null); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public Http2FrameListener frameListener() { |
|  |  | Http2FrameListener frameListener = frameListener0(); |
|  |  | // Unwrap the original Http2FrameListener as we add this decoder under the hood. |
|  |  | if (frameListener instanceof Http2MaxRstFrameListener) { |
|  |  | return ((Http2MaxRstFrameListener) frameListener).listener; |
|  |  | } |
|  |  | return frameListener; |
|  |  | } |
|  |  |  |
|  |  | // Package-private for testing |
|  |  | Http2FrameListener frameListener0() { |
|  |  | return super.frameListener(); |
|  |  | } |
|  |  | } |

58 changes: 58 additions & 0 deletions

58
[codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameListener.java](#diff-82f568a075ff63e9727ce8622f3a2b1553099182edf1fd0b4f857226252b05ad "codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameListener.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MaxRstFrameListener.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,58 @@ |
|  |  | /\* |
|  |  | \* Copyright 2023 The Netty Project |
|  |  | \* |
|  |  | \* The Netty Project licenses this file to you under the Apache License, |
|  |  | \* version 2.0 (the "License"); you may not use this file except in compliance |
|  |  | \* with the License. You may obtain a copy of the License at: |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, WITHOUT |
|  |  | \* WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the |
|  |  | \* License for the specific language governing permissions and limitations |
|  |  | \* under the License. |
|  |  | \*/ |
|  |  | package io.netty.handler.codec.http2; |
|  |  |  |
|  |  | import io.netty.channel.ChannelHandlerContext; |
|  |  | import io.netty.util.internal.logging.InternalLogger; |
|  |  | import io.netty.util.internal.logging.InternalLoggerFactory; |
|  |  |  |
|  |  | import java.util.concurrent.TimeUnit; |
|  |  |  |
|  |  |  |
|  |  | final class Http2MaxRstFrameListener extends Http2FrameListenerDecorator { |
|  |  | private static final InternalLogger logger = InternalLoggerFactory.getInstance(Http2MaxRstFrameListener.class); |
|  |  |  |
|  |  | private final long nanosPerWindow; |
|  |  | private final int maxRstFramesPerWindow; |
|  |  | private long lastRstFrameNano = System.nanoTime(); |
|  |  | private int receivedRstInWindow; |
|  |  |  |
|  |  | Http2MaxRstFrameListener(Http2FrameListener listener, int maxRstFramesPerWindow, int secondsPerWindow) { |
|  |  | super(listener); |
|  |  | this.maxRstFramesPerWindow = maxRstFramesPerWindow; |
|  |  | this.nanosPerWindow = TimeUnit.SECONDS.toNanos(secondsPerWindow); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public void onRstStreamRead(ChannelHandlerContext ctx, int streamId, long errorCode) throws Http2Exception { |
|  |  | long currentNano = System.nanoTime(); |
|  |  | if (currentNano - lastRstFrameNano >= nanosPerWindow) { |
|  |  | lastRstFrameNano = currentNano; |
|  |  | receivedRstInWindow = 1; |
|  |  | } else { |
|  |  | receivedRstInWindow++; |
|  |  | if (receivedRstInWindow > maxRstFramesPerWindow) { |
|  |  | Http2Exception exception = Http2Exception.connectionError(Http2Error.ENHANCE\_YOUR\_CALM, |
|  |  | "Maximum number of RST frames reached"); |
|  |  | logger.debug("{} Maximum number {} of RST frames reached within {} seconds, " + |
|  |  | "closing connection with {} error", ctx.channel(), maxRstFramesPerWindow, |
|  |  | TimeUnit.NANOSECONDS.toSeconds(nanosPerWindow), exception.error(), exception); |
|  |  | throw exception; |
|  |  | } |
|  |  | } |
|  |  | super.onRstStreamRead(ctx, streamId, errorCode); |
|  |  | } |
|  |  | } |

6 changes: 6 additions & 0 deletions

6
[codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MultiplexCodecBuilder.java](#diff-fba2cd287e562e8c1537b83f18c8a22af77ffdb0a363f62833bbc785ac609ad6 "codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MultiplexCodecBuilder.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/main/java/io/netty/handler/codec/http2/Http2MultiplexCodecBuilder.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -211,6 +211,12 @@ public Http2MultiplexCodecBuilder decoderEnforceMaxConsecutiveEmptyDataFrames(in |
|  |  | return super.decoderEnforceMaxConsecutiveEmptyDataFrames(maxConsecutiveEmptyFrames); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public Http2MultiplexCodecBuilder decoderEnforceMaxRstFramesPerWindow( |
|  |  | int maxConsecutiveEmptyFrames, int secondsPerWindow) { |
|  |  | return super.decoderEnforceMaxRstFramesPerWindow(maxConsecutiveEmptyFrames, secondsPerWindow); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | public Http2MultiplexCodec build() { |
|  |  | Http2FrameWriter frameWriter = this.frameWriter; |
| Expand Down | |  |

63 changes: 63 additions & 0 deletions

63
[.../test/java/io/netty/handler/codec/http2/AbstractDecoratingHttp2ConnectionDecoderTest.java](#diff-8df3bfd17dc759d2ed529bbb076d46931edd19474c2c0e684094cbfee540092e "codec-http2/src/test/java/io/netty/handler/codec/http2/AbstractDecoratingHttp2ConnectionDecoderTest.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/test/java/io/netty/handler/codec/http2/AbstractDecoratingHttp2ConnectionDecoderTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,63 @@ |
|  |  | /\* |
|  |  | \* Copyright 2023 The Netty Project |
|  |  | \* |
|  |  | \* The Netty Project licenses this file to you under the Apache License, version 2.0 (the |
|  |  | \* "License"); you may not use this file except in compliance with the License. You may obtain a |
|  |  | \* copy of the License at: |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software distributed under the License |
|  |  | \* is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express |
|  |  | \* or implied. See the License for the specific language governing permissions and limitations under |
|  |  | \* the License. |
|  |  | \*/ |
|  |  | package io.netty.handler.codec.http2; |
|  |  |  |
|  |  | import org.hamcrest.CoreMatchers; |
|  |  | import org.junit.jupiter.api.Test; |
|  |  | import org.mockito.ArgumentCaptor; |
|  |  | import org.mockito.invocation.InvocationOnMock; |
|  |  | import org.mockito.stubbing.Answer; |
|  |  |  |
|  |  | import static org.junit.jupiter.api.Assertions.assertNull; |
|  |  | import static org.hamcrest.MatcherAssert.assertThat; |
|  |  | import static org.mockito.Mockito.mock; |
|  |  | import static org.mockito.Mockito.verify; |
|  |  | import static org.mockito.Mockito.when; |
|  |  |  |
|  |  | public abstract class AbstractDecoratingHttp2ConnectionDecoderTest { |
|  |  |  |
|  |  | protected abstract DecoratingHttp2ConnectionDecoder newDecoder(Http2ConnectionDecoder decoder); |
|  |  |  |
|  |  | protected abstract Class<? extends Http2FrameListener> delegatingFrameListenerType(); |
|  |  |  |
|  |  | @Test |
|  |  | public void testDecoration() { |
|  |  | Http2ConnectionDecoder delegate = mock(Http2ConnectionDecoder.class); |
|  |  | final ArgumentCaptor<Http2FrameListener> listenerArgumentCaptor = |
|  |  | ArgumentCaptor.forClass(Http2FrameListener.class); |
|  |  | when(delegate.frameListener()).then(new Answer<Http2FrameListener>() { |
|  |  | @Override |
|  |  | public Http2FrameListener answer(InvocationOnMock invocationOnMock) { |
|  |  | return listenerArgumentCaptor.getValue(); |
|  |  | } |
|  |  | }); |
|  |  | Http2FrameListener listener = mock(Http2FrameListener.class); |
|  |  | DecoratingHttp2ConnectionDecoder decoder = newDecoder(delegate); |
|  |  | decoder.frameListener(listener); |
|  |  | verify(delegate).frameListener(listenerArgumentCaptor.capture()); |
|  |  |  |
|  |  | assertThat(decoder.frameListener(), |
|  |  | CoreMatchers.not(CoreMatchers.instanceOf(delegatingFrameListenerType()))); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void testDecorationWithNull() { |
|  |  | Http2ConnectionDecoder delegate = mock(Http2ConnectionDecoder.class); |
|  |  |  |
|  |  | DecoratingHttp2ConnectionDecoder decoder = newDecoder(delegate); |
|  |  | decoder.frameListener(null); |
|  |  | assertNull(decoder.frameListener()); |
|  |  | } |
|  |  | } |

46 changes: 7 additions & 39 deletions

46
[.../src/test/java/io/netty/handler/codec/http2/Http2EmptyDataFrameConnectionDecoderTest.java](#diff-27e3ab2ac3eb796584fbafc8f1fbffb3be2189a961cbc4e45b5f51ac1a6a84c0 "codec-http2/src/test/java/io/netty/handler/codec/http2/Http2EmptyDataFrameConnectionDecoderTest.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2EmptyDataFrameConnectionDecoderTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,47 +14,15 @@ |
|  |  | \*/ |
|  |  | package io.netty.handler.codec.http2; |
|  |  |  |
|  |  | import org.hamcrest.CoreMatchers; |
|  |  | import org.junit.jupiter.api.Test; |
|  |  | import org.mockito.ArgumentCaptor; |
|  |  | import org.mockito.invocation.InvocationOnMock; |
|  |  | import org.mockito.stubbing.Answer; |
|  |  | public class Http2EmptyDataFrameConnectionDecoderTest extends AbstractDecoratingHttp2ConnectionDecoderTest { |
|  |  |  |
|  |  | import static org.hamcrest.MatcherAssert.assertThat; |
|  |  | import static org.junit.jupiter.api.Assertions.assertNull; |
|  |  | import static org.mockito.Mockito.mock; |
|  |  | import static org.mockito.Mockito.verify; |
|  |  | import static org.mockito.Mockito.when; |
|  |  |  |
|  |  | public class Http2EmptyDataFrameConnectionDecoderTest { |
|  |  |  |
|  |  | @Test |
|  |  | public void testDecoration() { |
|  |  | Http2ConnectionDecoder delegate = mock(Http2ConnectionDecoder.class); |
|  |  | final ArgumentCaptor<Http2FrameListener> listenerArgumentCaptor = |
|  |  | ArgumentCaptor.forClass(Http2FrameListener.class); |
|  |  | when(delegate.frameListener()).then(new Answer<Http2FrameListener>() { |
|  |  | @Override |
|  |  | public Http2FrameListener answer(InvocationOnMock invocationOnMock) { |
|  |  | return listenerArgumentCaptor.getValue(); |
|  |  | } |
|  |  | }); |
|  |  | Http2FrameListener listener = mock(Http2FrameListener.class); |
|  |  | Http2EmptyDataFrameConnectionDecoder decoder = new Http2EmptyDataFrameConnectionDecoder(delegate, 2); |
|  |  | decoder.frameListener(listener); |
|  |  | verify(delegate).frameListener(listenerArgumentCaptor.capture()); |
|  |  |  |
|  |  | assertThat(decoder.frameListener(), |
|  |  | CoreMatchers.not(CoreMatchers.instanceOf(Http2EmptyDataFrameListener.class))); |
|  |  | assertThat(decoder.frameListener0(), CoreMatchers.instanceOf(Http2EmptyDataFrameListener.class)); |
|  |  | @Override |
|  |  | protected DecoratingHttp2ConnectionDecoder newDecoder(Http2ConnectionDecoder decoder) { |
|  |  | return new Http2EmptyDataFrameConnectionDecoder(decoder, 2); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void testDecorationWithNull() { |
|  |  | Http2ConnectionDecoder delegate = mock(Http2ConnectionDecoder.class); |
|  |  |  |
|  |  | Http2EmptyDataFrameConnectionDecoder decoder = new Http2EmptyDataFrameConnectionDecoder(delegate, 2); |
|  |  | decoder.frameListener(null); |
|  |  | assertNull(decoder.frameListener()); |
|  |  | @Override |
|  |  | protected Class<? extends Http2FrameListener> delegatingFrameListenerType() { |
|  |  | return Http2EmptyDataFrameListener.class; |
|  |  | } |
|  |  | } |

28 changes: 28 additions & 0 deletions

28
[...tp2/src/test/java/io/netty/handler/codec/http2/Http2MaxRstFrameConnectionDecoderTest.java](#diff-79f05d418856e6569da913d97e2c54ab2859b1f7f6fde0dc0cf7b21b07e0fa2b "codec-http2/src/test/java/io/netty/handler/codec/http2/Http2MaxRstFrameConnectionDecoderTest.java")

Show comments

[View file](/netty/netty/blob/58f75f665aa81a8cbcf6ffa74820042a285c5e61/codec-http2/src/test/java/io/netty/handler/codec/http2/Http2MaxRstFrameConnectionDecoderTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,28 @@ |
|  |  | /\* |
|  |  | \* Copyright 2023 The Netty Project |
|  |  | \* |
|  |  | \* The Netty Project licenses this file to you under the Apache License, version 2.0 (the |
|  |  | \* "License"); you may not use this file except in compliance with the License. You may obtain a |
|  |  | \* copy of the License at: |
|  |  | \* |
|  |  | \* https://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software distributed under the License |
|  |  | \* is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express |
|  |  | \* or implied. See the License for the specific language governing permissions and limitations under |
|  |  | \* the License. |
|  |  | \*/ |
|  |  | package io.netty.handler.codec.http2; |
|  |  |  |
|  |  | public class Http2MaxRstFrameConnectionDecoderTest extends AbstractDecoratingHttp2ConnectionDecoderTest { |
|  |  |  |
|  |  | @Override |
|  |  | protected DecoratingHttp2ConnectionDecoder newDecoder(Http2ConnectionDecoder decoder) { |
|  |  | return new Http2MaxRstFrameDecoder(decoder, 200, 30); |
|  |  | } |
|  |  |  |
|  |  | @Override |
|  |  | protected Class<? extends Http2FrameListener> delegatingFrameListenerType() { |
|  |  | return Http2MaxRstFrameListener.class; |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `58f75f6`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty%2Fcommit%2F58f75f665aa81a8cbcf6ffa74820042a285c5e61) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

