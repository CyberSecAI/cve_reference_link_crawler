

| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D37837043) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [HAProxy is not affected by the HTTP/2 Rapid Reset Attack](https://www.haproxy.com/blog/haproxy-is-not-affected-by-the-http-2-rapid-reset-attack-cve-2023-44487) ([haproxy.com](from?site=haproxy.com)) | | --- | --- | --- | |  | | 166 points by [nickramirez](user?id=nickramirez) [on Oct 10, 2023](item?id=37837043)  | [hide](hide?id=37837043&goto=item%3Fid%3D37837043) | [past](https://hn.algolia.com/?query=HAProxy%20is%20not%20affected%20by%20the%20HTTP%2F2%20Rapid%20Reset%20Attack&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=37837043&auth=325213dcf669f0ec4e46f492c1f6e53b0e8477e9) | [33 comments](item?id=37837043) |  | |  |  | [tpmx](user?id=tpmx) [on Oct 10, 2023](item?id=37837507)   | [next](#37837509) [–]  I'm quite impressed with HAProxy. It takes a little effort to fully understand the configuration file format (hint: you've got to read the documentation, not just look at examples to fully grok it), but it's so worth it, IMO. It's also a nice treat to have the founder and technical leader (Willy Tarreau) of the HAProxy company being so active in the community, so many years later (the initital release was in 2001). I regularly see him answering e.g. newbie questions. (HAProxy docs: <https://docs.haproxy.org/> - pick 2.8/LTS) | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [exabrial](user?id=exabrial) [on Oct 10, 2023](item?id=37839076)   | [parent](#37837507) | [next](#37838311) [–]  It's become my swiss army knife of TCP. I nearly always terminate TCP first with haproxy "out of process" of whatever, then have it proxy over a unix socket to "whatever". This allows an immense amount of flexibility, from being able to "wiretap" whats going on in the real world, to default error pages, alarms, monitoring, handling CORS... tons of uses. | | --- | --- | --- | | | |  |  | [tpmx](user?id=tpmx) [on Oct 11, 2023](item?id=37848995)   | [root](#37837507) | [parent](#37839076) | [next](#37838311) [–]  Please write a blog post about this and submit it to HN! | | --- | --- | --- | | | |  |  | [chaps](user?id=chaps) [on Oct 10, 2023](item?id=37838311)   | [parent](#37837507) | [prev](#37839076) | [next](#37839128) [–]  Agreed. Haproxy is an absolute wonder compared to similar systems. It all just feels so much cleaner, thought out, and built from the ground up for many different use cases. It very much has a feel that reminds me a lot of the spirit of sqlite. | | --- | --- | --- | | | |  |  | [tpmx](user?id=tpmx) [on Oct 10, 2023](item?id=37838705)   | [root](#37837507) | [parent](#37838311) | [next](#37844735) [–]  Yeah. Stringency and rigor are words that come to mind. | | --- | --- | --- | | | |  |  | [xiasongh](user?id=xiasongh) [on Oct 11, 2023](item?id=37844735)   | [root](#37837507) | [parent](#37838311) | [prev](#37838705) | [next](#37840358) [–]  What about nginx? I'm not too familiar but I was under the impression that it was the safe choice | | --- | --- | --- | | | |  |  | [tpmx](user?id=tpmx) [on Oct 11, 2023](item?id=37848213)   | [root](#37837507) | [parent](#37844735) | [next](#37840358) [–]  It's primary focus is/was being a web server - a faster Apache. This shows. Also (after the acqusition by F5 in 2019?) more features are kept away from the open source version compared to HAProxy. | | --- | --- | --- | | | |  |  | [andyfleming](user?id=andyfleming) [on Oct 11, 2023](item?id=37840358)   | [root](#37837507) | [parent](#37838311) | [prev](#37844735) | [next](#37839128) [–]  How does it compare with Caddy? | | --- | --- | --- | | | |  |  | [superq](user?id=superq) [on Oct 11, 2023](item?id=37840773)   | [root](#37837507) | [parent](#37840358) | [next](#37839128) [–]  Caddy is a bit quick and dirty, rapidly-developing, with neat plugins but hard to configure for more complex scenarios and too light on the docs (IMO). HA Proxy is robust, comprehensive, mature, and bulletproof. It's basically boring because it works so well. If you have to choose only one to learn, choose HA Proxy. | | --- | --- | --- | | | |  |  | [frankjr](user?id=frankjr) [on Oct 11, 2023](item?id=37843593)   | [root](#37837507) | [parent](#37840773) | [next](#37839128) [–]  I wanted to try it out just now but hit a roadblock immediately - it cannot automatically obtain and maintain TLS certificates. You have to use an external client (e.g. acme.sh), set up a cron to check/renew them, and poke HAProxy to reload them if necessary. I'm way past doing this in 2023. <https://www.haproxy.com/blog/haproxy-and-let-s-encrypt> <https://github.com/haproxy/haproxy/issues/1864> | | --- | --- | --- | | | |  |  | [nickramirez](user?id=nickramirez) [on Oct 11, 2023](item?id=37850042)   | [root](#37837507) | [parent](#37843593) | [next](#37873070) [–]  If getting Let's Encrypt to work with HAProxy is your only struggle, you'll soon overcome it and be loving HAProxy. And there are multiple ways to set up Let's Encrypt, if you don't want to use acme.sh. For example, you could use certbot. There are blog posts that cover that pretty well. | | --- | --- | --- | | | |  |  | [superq](user?id=superq) [on Oct 13, 2023](item?id=37873070)   | [root](#37837507) | [parent](#37843593) | [prev](#37850042) | [next](#37839128) [–]  you may wish to use certbot instead: <https://github.com/acmesh-official/acme.sh/issues/4659> | | --- | --- | --- | | | |  |  | [scns](user?id=scns) [on Oct 10, 2023](item?id=37839128)   | [parent](#37837507) | [prev](#37838311) | [next](#37862950) [–]  That is some very well written documentation IMHO. | | --- | --- | --- | | | |  |  | [chasingtheflow](user?id=chasingtheflow) [on Oct 11, 2023](item?id=37839350)   | [root](#37837507) | [parent](#37839128) | [next](#37862950) [–]  Can’t seem to read it on mobile. | | --- | --- | --- | | | |  |  | [rrrix1](user?id=rrrix1) [on Oct 11, 2023](item?id=37842973)   | [root](#37837507) | [parent](#37839350) | [next](#37862950) [–]  You probably don't want to. Usually it needs at least a browser window, an editor and maybe an open TTY. haproxy.cfg can be ... tricky. | | --- | --- | --- | | | |  |  | [bkallus](user?id=bkallus) [on Oct 12, 2023](item?id=37862950)   | [parent](#37837507) | [prev](#37839128) | [next](#37837509) [–]  I had the privilege of reporting a few bugs in HAProxy in the last few months. Willy's a real treasure; he's friendly and knowledgeable, and he clearly cares a ton about HAProxy even after 22 years of development. | | --- | --- | --- | | | |  |  | [chatmasta](user?id=chatmasta) [on Oct 10, 2023](item?id=37837509)   | [prev](#37837507) | [next](#37837618) [–]  More details [0] about the mitigation are discussed on the mailing list: > So at first glance we indeed addressed this case in 2018 (1.9-dev) with this commit: > f210191dc ("BUG/MEDIUM: h2: don't accept new streams if conn\_streams are still in excess") > It was incomplete by then an later refined, but the idea is there. But I'll try to stress that area again to see. [0] [https://www.mail-archive.com/haproxy@formilux.org/msg44134.h...](https://www.mail-archive.com/haproxy%40formilux.org/msg44134.html) | | --- | --- | --- | | | |  |  | [jedberg](user?id=jedberg) [on Oct 10, 2023](item?id=37837618)   | [prev](#37837509) | [next](#37837466) [–]  Not all surprised by this, HaProxy is some of the best built software I've ever seen. But glad to know they checked. | | --- | --- | --- | | | |  |  | [stygiansonic](user?id=stygiansonic) [on Oct 10, 2023](item?id=37837466)   | [prev](#37837618) | [next](#37837825) [–]   ```     After rigorous testing, we have been able to confirm that our implementation of the HTTP/2 protocol can handle the Rapid Reset Attack without increasing the resource usage or compromising the parallelism of the protocol.  ``` But doesn’t this mean the servers behind the reverse proxy would still suffer from increased/wasted resources responding to the rapid reset requests? | | --- | --- | --- | | | |  |  | [crote](user?id=crote) [on Oct 10, 2023](item?id=37837877)   | [parent](#37837466) | [next](#37837681) [–]  Not by definition. Looking at Cloudflare's summary of the attack[0], part of it seems to rely on sending a request and then cancelling it in the very same packet. A trivial implementation might walk through the packet front-to-back, firing off requests and cancellations immediately as it encounters them. That would indeed still result in a lot of load on the servers behind the proxy. However, a reasonable alternative would be to only collect a set of actions to execute while walking through the packet, firing them off all at once when you finish. For example, a "launch request" could create a new entry in the backend requests list with a state of "NEW". The "cancel request" part immediately afterwards could then look in the backend request list and set the state of the corresponding request to "CANCEL". Now when the backend request list is being processed next, it'll only see a request marked "CANCEL" without a corresponding socket to a backend, shrug, and just delete the entry because there is nothing to do. [0]: [https://blog.cloudflare.com/technical-breakdown-http2-rapid-...](https://blog.cloudflare.com/technical-breakdown-http2-rapid-reset-ddos-attack/) | | --- | --- | --- | | | |  |  | [dylan604](user?id=dylan604) [on Oct 10, 2023](item?id=37837949)   | [root](#37837466) | [parent](#37837877) | [next](#37837681) [–]  I thought you were going to suggest it to be processed like one of those trick exams of reading all of the questions before answering any of the questions where the last question is something so obvious that like stand up sit down, then turn in the test with out writing anything on it. So in this case, read all of the instructions in the packet. If the last is CANCEL, do nothing. | | --- | --- | --- | | | |  |  | [bombcar](user?id=bombcar) [on Oct 11, 2023](item?id=37839821)   | [root](#37837466) | [parent](#37837949) | [next](#37837681) [–]  It's basically like that - the "fastest" servers will begin responding before processing the entire packet; but it's likely that's never *really* needed (and if it is, you'll know and can turn it on) but the smarter thing to do is process the whole packet at once. | | --- | --- | --- | | | |  |  | [carlhjerpe](user?id=carlhjerpe) [on Oct 10, 2023](item?id=37837681)   | [parent](#37837466) | [prev](#37837877) | [next](#37837825) [–]  If you're doing tcp load balancing sure, but http is terminated at the proxy and wouldn't be vulnerable. This is why you put $proxy or $webbserver in front of your application webserver. | | --- | --- | --- | | | |  |  | [abraae](user?id=abraae) [on Oct 10, 2023](item?id=37837825)   | [prev](#37837466) | [next](#37837451) [–]  Wondering if anyone knows the exposure when using an nginx proxy? | | --- | --- | --- | | | |  |  | [el\_duderino](user?id=el_duderino) [on Oct 10, 2023](item?id=37838245)   | [parent](#37837825) | [next](#37837878) [–]  [https://www.nginx.com/blog/http-2-rapid-reset-attack-impacti...](https://www.nginx.com/blog/http-2-rapid-reset-attack-impacting-f5-nginx-products/) | | --- | --- | --- | | | |  |  | [merlincorey](user?id=merlincorey) [on Oct 10, 2023](item?id=37837878)   | [parent](#37837825) | [prev](#37838245) | [next](#37837451) [–]  This is news because of an exploit found against NginX, I believe. That's why HAProxy did testing to see if they were vulnerable. | | --- | --- | --- | | | |  |  | [fragmede](user?id=fragmede) [on Oct 10, 2023](item?id=37838285)   | [root](#37837825) | [parent](#37837878) | [next](#37837451) [–]  This is news because of a massive DDoS against AWS/Cloudflare/Google, and isn't related to a particular flaw in NginX [https://cloud.google.com/blog/products/identity-security/how...](https://cloud.google.com/blog/products/identity-security/how-it-works-the-novel-http2-rapid-reset-ddos-attack) | | --- | --- | --- | | | |  |  | [tick\_tock\_tick](user?id=tick_tock_tick) [on Oct 10, 2023](item?id=37837451)   | [prev](#37837825) [7 more]  [flagged] | | --- | --- | --- | | | |  |  | [toast0](user?id=toast0) [on Oct 10, 2023](item?id=37837803)   | [parent](#37837451) | [next](#37837519) [–]  If you want lots of details, this specific post on the mailing list is there [https://www.mail-archive.com/haproxy@formilux.org/msg44136.h...](https://www.mail-archive.com/haproxy%40formilux.org/msg44136.html) | | --- | --- | --- | | | |  |  | [altairprime](user?id=altairprime) [on Oct 10, 2023](item?id=37837519)   | [parent](#37837451) | [prev](#37837803) | [next](#37837484) [–]  haproxy mitigated this attack in 2018 as an implementation bug: <https://news.ycombinator.com/item?id=37833365> | | --- | --- | --- | | | |  |  | [tick\_tock\_tick](user?id=tick_tock_tick) [on Oct 10, 2023](item?id=37838822)   | [root](#37837451) | [parent](#37837519) | [next](#37838889) [–]  That would have been wonderful context for them to include. | | --- | --- | --- | | | |  |  | [donutshop](user?id=donutshop) [on Oct 10, 2023](item?id=37838889)   | [root](#37837451) | [parent](#37837519) | [prev](#37838822) | [next](#37837484) [–]  Whoa. So they're 5 years ahead of everyone else? | | --- | --- | --- | | | |  |  | [notRobot](user?id=notRobot) [on Oct 10, 2023](item?id=37837484)   | [parent](#37837451) | [prev](#37837519) | [next](#37838127) [–]  > After rigorous testing, we have been able to confirm that our implementation of the HTTP/2 protocol can handle the Rapid Reset Attack without increasing the resource usage or compromising the parallelism of the protocol. You are free to conduct your own tests? AFAIK the software in question is free (both libre and commercially). | | --- | --- | --- | | | |  |  | [KomoD](user?id=KomoD) [on Oct 10, 2023](item?id=37838127)   | [parent](#37837451) | [prev](#37837484) [–]  > make anyone else think they just failed to properly test/verify their claim? Nope, not me. | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |

