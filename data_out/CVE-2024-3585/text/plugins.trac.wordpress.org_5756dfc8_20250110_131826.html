

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3074631%2Fsend-pdf-for-contact-form-7%2Ftrunk%3Fcontextall%3D1%26old%3D3069882%26old_path%3D%252Fsend-pdf-for-contact-form-7%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3069882/send-pdf-for-contact-form-7/trunk?old=3074631&old_path=%2Fsend-pdf-for-contact-form-7%2Ftrunk)

---

# Changes in [send-pdf-for-contact-form-7/trunk](/browser/send-pdf-for-contact-form-7/trunk?rev=3074631 "Show entry in browser") [[3069882:3074631]](/log/send-pdf-for-contact-form-7/trunk?rev=3074631&stop_rev=3069882 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[send-pdf-for-contact-form-7/trunk](/browser/send-pdf-for-contact-form-7/trunk?rev=3074631)
Files:

5 edited

* [classes/prepare-pdf.php](/browser/send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php?rev=3074531 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [classes/send-pdf.php](/browser/send-pdf-for-contact-form-7/trunk/classes/send-pdf.php?rev=3074531 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [readme.txt](/browser/send-pdf-for-contact-form-7/trunk/readme.txt?rev=3074531 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [views/send-pdf-admin.php](/browser/send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php?rev=3074631 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [wpcf7-send-pdf.php](/browser/send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php?rev=3074531 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php](/changeset/3074531/send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php?old=3069880&old_path=send-pdf-for-contact-form-7%2Ftrunk%2Fclasses%2Fprepare-pdf.php "Show the [3069882:3074631] differences restricted to send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php")

  | [r3069882](/browser/send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php?rev=3069880#L1 "Show revision 3069882 of this file in browser") | [r3074631](/browser/send-pdf-for-contact-form-7/trunk/classes/prepare-pdf.php?rev=3074531#L1 "Show revision 3074631 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 |  |
  | 4 | 4 | defined( 'ABSPATH' ) |
  | 5 | 5 | or die( 'No direct load ! ' ); |
  | 6 | 6 |  |
  | 7 | 7 |  |
  | 8 | 8 | /\*\* |
  | 9 | 9 | \* Prepare PDF Class for Contact Form 7. |
  | 10 | 10 | \* |
  | 11 | 11 | \* @link https://madeby.restezconnectes.fr/project/send-pdf-for-contact-form-7/ |
  | 12 | 12 | \* @author Florent Maillefaud <contact at restezconnectes.fr> |
  | 13 | 13 | \* @since 1.0.0.3 |
  | 14 | 14 | \* @license GPL3 or later |
  | 15 | 15 | \*/ |
  | 16 | 16 |  |
  | 17 | 17 | class WPCF7PDF\_prepare extends cf7\_sendpdf { |
  | 18 | 18 |  |
  | 19 | 19 |  |
  | 20 | 20 | public static function shortcodes($shotcodes\_tags='', $contentPdf = '') { |
  | 21 | 21 |  |
  | 22 | 22 | // Shortcodes? |
  | 23 | 23 | if( isset($shotcodes\_tags) && $shotcodes\_tags!='' && isset($contentPdf) && $contentPdf!='') { |
  | 24 | 24 |  |
  | 25 | 25 | $tagShortcodes = explode(',', esc\_html($shotcodes\_tags)); |
  | 26 | 26 | $countShortcodes = count($tagShortcodes); |
  | 27 | 27 | for($i = 0; $i < ($countShortcodes);  $i++) { |
  | 28 | 28 |  |
  | 29 | 29 | $pattern = '`\[([^\]]\*)\]`'; |
  | 30 | 30 | preg\_match\_all($pattern, $tagShortcodes[$i], $shortcodeTags); |
  | 31 | 31 | if( is\_array($shortcodeTags) && isset($shortcodeTags[1][0]) ) { |
  | 32 | 32 |  |
  | 33 | 33 | $shortcodeName = explode(' ', $shortcodeTags[1][0]); |
  | 34 | 34 | if( is\_plugin\_active('shortcoder/shortcoder.php') && class\_exists('Shortcoder') ) { |
  | 35 | 35 |  |
  | 36 | 36 | $shortcodes =  Shortcoder::get\_shortcodes(); |
  | 37 | 37 | $returnShortcode = Shortcoder::find\_shortcode(array('name'=>$shortcodeName[0]), $shortcodes); |
  | 38 | 38 | if( isset($returnShortcode['id']) ) { |
  | 39 | 39 | $contentPdf = str\_replace('['.$shortcodeName[0].']', do\_shortcode('[sc name="'.$shortcodeName[0].'"][/sc]'), $contentPdf); |
  | 40 | 40 | } |
  | 41 | 41 |  |
  | 42 | 42 | } |
  | 43 | 43 |  |
  | 44 | 44 | if( stripos($contentPdf, '['.$shortcodeName[0].']') !== false ) { |
  | 45 | 45 | $contentPdf = str\_replace('['.$shortcodeName[0].']', do\_shortcode($tagShortcodes[$i]), $contentPdf); |
  | 46 | 46 | } |
  | 47 | 47 |  |
  | 48 | 48 | } |
  | 49 | 49 | } |
  | 50 | 50 |  |
  | 51 | 51 | } |
  | 52 | 52 |  |
  | 53 | 53 | return $contentPdf; |
  | 54 | 54 |  |
  | 55 | 55 | } |
  | 56 | 56 |  |
  | 57 | 57 | public static function adjust\_image\_orientation($filename, $quality = 90) { |
  | 58 | 58 |  |
  | 59 | 59 | try { |
  | 60 | 60 | $exif = @exif\_read\_data($filename); |
  | 61 | 61 | } catch (\Exception $e) { |
  | 62 | 62 | $exif = false; |
  | 63 | 63 | } |
  | 64 | 64 |  |
  | 65 | 65 | // If no exif info, or no orientation info, or if orientation needs no adjustment |
  | 66 | 66 | if( isset($exif['Orientation']) ) { $orientation = $exif['Orientation']; } else { $orientation = 1; } |
  | 67 | 67 | if (!$orientation || $orientation === 1) { |
  | 68 | 68 | return false; |
  | 69 | 69 | } |
  | 70 | 70 |  |
  | 71 | 71 | switch ($fileType = @exif\_imagetype($filename)) { |
  | 72 | 72 | case 1: // gif |
  | 73 | 73 | $img = @imageCreateFromGif($filename); |
  | 74 | 74 | break; |
  | 75 | 75 | case 2: // jpg |
  | 76 | 76 | $img = @imageCreateFromJpeg($filename); |
  | 77 | 77 | break; |
  | 78 | 78 | case 3: // png |
  | 79 | 79 | $img = @imageCreateFromPng($filename); |
  | 80 | 80 | break; |
  | 81 | 81 | default: |
  | 82 | 82 | $img = @imagecreatefromjpeg($filename); |
  | 83 | 83 | } |
  | 84 | 84 |  |
  | 85 | 85 | if (!$img) { |
  | 86 | 86 | return false; |
  | 87 | 87 | } |
  | 88 | 88 |  |
  | 89 | 89 | $mirror = in\_array($orientation, [2, 5, 4, 7]); |
  | 90 | 90 | $deg = 0; |
  | 91 | 91 | switch ($orientation) { |
  | 92 | 92 | case 3: |
  | 93 | 93 | case 4: |
  | 94 | 94 | $deg = 180; |
  | 95 | 95 | break; |
  | 96 | 96 | case 6: |
  | 97 | 97 | case 5: |
  | 98 | 98 | $deg = 270; |
  | 99 | 99 | break; |
  | 100 | 100 | case 8: |
  | 101 | 101 | case 7: |
  | 102 | 102 | $deg = 90; |
  | 103 | 103 | break; |
  | 104 | 104 | } |
  | 105 | 105 |  |
  | 106 | 106 | if ($deg) { |
  | 107 | 107 | $img = imagerotate($img, $deg, 0); |
  | 108 | 108 | } |
  | 109 | 109 |  |
  | 110 | 110 | if ($mirror) { |
  | 111 | 111 | $img = imageflip($img, IMG\_FLIP\_HORIZONTAL); |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | 114 | 114 | switch ($fileType = @exif\_imagetype($filename)) { |
  | 115 | 115 | case 1: // gif |
  | 116 | 116 | imagegif($img, $filename); |
  | 117 | 117 | break; |
  | 118 | 118 | case 2: // jpg |
  | 119 | 119 | imagejpeg($img, $filename, $quality); |
  | 120 | 120 | break; |
  | 121 | 121 | case 3: // png |
  | 122 | 122 | imagepng($img, $filename, $quality); |
  | 123 | 123 | break; |
  | 124 | 124 | default: |
  | 125 | 125 | imagejpeg($img, $filename, $quality); |
  | 126 | 126 | } |
  | 127 | 127 |  |
  | 128 | 128 | return true; |
  | 129 | 129 | } |
  | 130 | 130 |  |
  | 131 | 131 | public static function wpcf7pdf\_autorizeHtml() { |
  | 132 | 132 |  |
  | 133 | 133 | return array( |
  | 134 | 134 | 'a' => array( |
  | 135 | 135 | 'href' => array(), |
  | 136 | 136 | 'title' => array() |
  | 137 | 137 | ), |
  | 138 | 138 | 'br' => array(), |
  | 139 | 139 | 'p' => array( |
  | 140 | 140 | 'id' => array(), |
  | 141 | 141 | 'style' => array(), |
  | 142 | 142 | 'class' => array() |
  | 143 | 143 | ), |
  | 144 | 144 | 'h1' => array( |
  | 145 | 145 | 'class' => array(), |
  | 146 | 146 | 'style' => array(), |
  | 147 | 147 | ), |
  | 148 | 148 | 'h2' => array( |
  | 149 | 149 | 'class' => array(), |
  | 150 | 150 | 'style' => array(), |
  | 151 | 151 | ), |
  | 152 | 152 | 'h3' => array( |
  | 153 | 153 | 'class' => array(), |
  | 154 | 154 | 'style' => array(), |
  | 155 | 155 | ), |
  | 156 | 156 | 'h4' => array( |
  | 157 | 157 | 'class' => array(), |
  | 158 | 158 | 'style' => array(), |
  | 159 | 159 | ), |
  | 160 | 160 | 'h5' => array( |
  | 161 | 161 | 'class' => array(), |
  | 162 | 162 | 'style' => array(), |
  | 163 | 163 | ), |
  | 164 | 164 | 'h6' => array( |
  | 165 | 165 | 'class' => array(), |
  | 166 | 166 | 'style' => array(), |
  | 167 | 167 | ), |
  | 168 | 168 | 'em' => array(), |
  | 169 | 169 | 'i' => array( |
  | 170 | 170 | 'style' => array(), |
  | 171 | 171 | 'class' => array() |
  | 172 | 172 | ), |
  | 173 | 173 | 'font-awesome-icon' => array( |
  | 174 | 174 | 'icon' => array(), |
  | 175 | 175 | 'class' => array() |
  | 176 | 176 | ), |
  | 177 | 177 | 'strong' => array(), |
  | 178 | 178 | 'small' => array(), |
  | 179 | 179 | 'img' => array( |
  | 180 | 180 | 'id' => array(), |
  | 181 | 181 | 'src' => array(), |
  | 182 | 182 | 'title' => array(), |
  | 183 | 183 | 'width' => array(), |
  | 184 | 184 | 'height' => array(), |
  | 185 | 185 | 'style' => array(), |
  | 186 | 186 | 'rotate' => array(), |
  | 187 | 187 | 'class' => array() |
  | 188 | 188 | ), |
  | 189 | 189 | 'div' => array( |
  | 190 | 190 | 'id' => array(), |
  | 191 | 191 | 'class' => array(), |
  | 192 | 192 | 'title' => array(), |
  | 193 | 193 | 'style' => array(), |
  | 194 | 194 | 'dir' => array() |
  | 195 | 195 | ), |
  | 196 | 196 | 'bdo' => array( |
  | 197 | 197 | 'id' => array(), |
  | 198 | 198 | 'class' => array(), |
  | 199 | 199 | 'title' => array(), |
  | 200 | 200 | 'style' => array(), |
  | 201 | 201 | 'dir' => array() |
  | 202 | 202 | ), |
  | 203 | 203 | 'span' => array( |
  | 204 | 204 | 'id' => array(), |
  | 205 | 205 | 'class' => array(), |
  | 206 | 206 | 'title' => array(), |
  | 207 | 207 | 'style' => array(), |
  | 208 | 208 | 'dir' => array() |
  | 209 | 209 | ), |
  | 210 | 210 | 'table' => array( |
  | 211 | 211 | 'id' => array(), |
  | 212 | 212 | 'style' => array(), |
  | 213 | 213 | 'class' => array(), |
  | 214 | 214 | 'colspan' => array(), |
  | 215 | 215 | 'rowspan' => array(), |
  | 216 | 216 | 'width' => array(), |
  | 217 | 217 | 'cellpadding' => array(), |
  | 218 | 218 | 'cellspacing' => array(), |
  | 219 | 219 | 'border' => array() |
  | 220 | 220 | ), |
  | 221 | 221 | 'td' => array( |
  | 222 | 222 | 'id' => array(), |
  | 223 | 223 | 'style' => array(), |
  | 224 | 224 | 'class' => array(), |
  | 225 | 225 | 'colspan' => array(), |
  | 226 | 226 | 'rowspan' => array(), |
  | 227 | 227 | 'width' => array(), |
  | 228 | 228 | 'cellpadding' => array(), |
  | 229 | 229 | 'cellspacing' => array(), |
  | 230 | 230 | 'border' => array(), |
  | 231 | 231 | 'text-rotate' => array(), |
  | 232 | 232 | 'valign' => array() |
  | 233 | 233 | ), |
  | 234 | 234 | 'tr' => array( |
  | 235 | 235 | 'id' => array(), |
  | 236 | 236 | 'style' => array(), |
  | 237 | 237 | 'class' => array(), |
  | 238 | 238 | 'colspan' => array(), |
  | 239 | 239 | 'rowspan' => array(), |
  | 240 | 240 | 'width' => array(), |
  | 241 | 241 | 'cellpadding' => array(), |
  | 242 | 242 | 'cellspacing' => array(), |
  | 243 | 243 | 'border' => array(), |
  | 244 | 244 | 'text-rotate' => array(), |
  | 245 | 245 | 'valign' => array() |
  | 246 | 246 | ), |
  | 247 | 247 | 'th' => array( |
  | 248 | 248 | 'style' => array(), |
  | 249 | 249 | 'class' => array(), |
  | 250 | 250 | 'colspan' => array(), |
  | 251 | 251 | 'rowspan' => array(), |
  | 252 | 252 | 'width' => array(), |
  | 253 | 253 | 'cellpadding' => array(), |
  | 254 | 254 | 'cellspacing' => array(), |
  | 255 | 255 | 'text-rotate' => array(), |
  | 256 | 256 | 'border' => array() |
  | 257 | 257 | ), |
  | 258 | 258 | 'tbody' => array( |
  | 259 | 259 | 'style' => array(), |
  | 260 | 260 | 'class' => array(), |
  | 261 | 261 | 'colspan' => array(), |
  | 262 | 262 | 'rowspan' => array(), |
  | 263 | 263 | 'width' => array(), |
  | 264 | 264 | 'cellpadding' => array(), |
  | 265 | 265 | 'cellspacing' => array(), |
  | 266 | 266 | 'text-rotate' => array(), |
  | 267 | 267 | 'border' => array() |
  | 268 | 268 | ), |
  | 269 | 269 | 'thead' => array( |
  | 270 | 270 | 'style' => array(), |
  | 271 | 271 | 'class' => array(), |
  | 272 | 272 | 'colspan' => array(), |
  | 273 | 273 | 'rowspan' => array(), |
  | 274 | 274 | 'width' => array(), |
  | 275 | 275 | 'cellpadding' => array(), |
  | 276 | 276 | 'cellspacing' => array(), |
  | 277 | 277 | 'text-rotate' => array(), |
  | 278 | 278 | 'border' => array() |
  | 279 | 279 | ), |
  | 280 | 280 | 'barcode' => array( |
  | 281 | 281 | 'code' => array(), |
  | 282 | 282 | 'class' => array(), |
  | 283 | 283 | 'type' => array() |
  | 284 | 284 | ), |
  | 285 | 285 | 'ul' => array( |
  | 286 | 286 | 'class' => array(), |
  | 287 | 287 | ), |
  | 288 | 288 | 'li' => array( |
  | 289 | 289 | 'class' => array(), |
  | 290 | 290 | ), |
  | 291 | 291 | 'ol' => array( |
  | 292 | 292 | 'class' => array(), |
  | 293 | 293 | ), |
  | 294 | 294 | 'b' => array(), |
  | 295 | 295 | 'blockquote' => array( |
  | 296 | 296 | 'cite'  => array(), |
  | 297 | 297 | ), |
  | 298 | 298 | 'cite' => array( |
  | 299 | 299 | 'title' => array(), |
  | 300 | 300 | ), |
  | 301 | 301 | 'code' => array(), |
  | 302 | 302 | 'del' => array( |
  | 303 | 303 | 'datetime' => array(), |
  | 304 | 304 | 'title' => array(), |
  | 305 | 305 | ), |
  | 306 | 306 | 'dd' => array(), |
  | 307 | 307 | 'dl' => array(), |
  | 308 | 308 | 'dt' => array(), |
  | 309 | 309 | 'em' => array(), |
  | 310 | 310 | 'dl' => array(), |
  | 311 | 311 | 'dt' => array(), |
  | 312 | 312 | 'em' => array(), |
  | 313 | 313 | 'bdi' => array(), |
  | 314 | 314 | /\*'html' => array( |
  | 315 | 315 | 'lang' => array(), |
  | 316 | 316 | ), |
  | 317 | 317 |  |
  | 318 | 318 | 'meta' => array( 'charset' => array()), |
  | 319 | 319 | 'title' => array(), |
  | 320 | 320 | 'body' => array( 'dir' => array()),\*/ |
  | 321 | 321 | ); |
  | 322 | 322 |  |
  | 323 | 323 | } |
  | 324 | 324 |  |
  | 325 | 325 | public static function returndate($id) { |
  | 326 | 326 |  |
  | 327 | 327 | if (empty($id)) |
  | 328 | 328 | return; |
  | 329 | 329 |  |
  | 330 | 330 | $meta\_values = get\_post\_meta(esc\_html($id), '\_wp\_cf7pdf', true); |
  | 331 | 331 | // Definition des dates par defaut |
  | 332 | 332 | $dateField = date\_i18n(esc\_html(get\_option( 'date\_format' )), current\_time('timestamp')); |
  | 333 | 333 | // On récupere la date et le format |
  | 334 | 334 | if( isset($meta\_values['date\_format']) && !empty($meta\_values['date\_format']) ) { |
  | 335 | 335 | $dateField = date\_i18n( esc\_html($meta\_values['date\_format']) ); |
  | 336 | 336 | } else { |
  | 337 | 337 | $dateField = date\_i18n( get\_option( 'date\_format' ) . ' ' . get\_option( 'time\_format' ), current\_time('timestamp') ); |
  | 338 | 338 | } |
  | 339 | 339 | return $dateField; |
  | 340 | 340 | } |
  | 341 | 341 |  |
  | 342 | 342 | public static function returntime($id) { |
  | 343 | 343 |  |
  | 344 | 344 | if (empty($id)) |
  | 345 | 345 | return; |
  | 346 | 346 |  |
  | 347 | 347 | $meta\_values = get\_post\_meta(esc\_html($id), '\_wp\_cf7pdf', true); |
  | 348 | 348 | // Definition des dates par defaut |
  | 349 | 349 | $timeField = date\_i18n(esc\_html(get\_option( 'time\_format' )), current\_time('timestamp')); |
  | 350 | 350 | // On récupere l'heure' et le format |
  | 351 | 351 | if( isset($meta\_values['time\_format']) && !empty($meta\_values['time\_format']) ) { |
  | 352 | 352 | $timeField = date\_i18n( esc\_html($meta\_values['time\_format']) ); |
  | 353 | 353 | } else { |
  | 354 | 354 | $timeField = date\_i18n( get\_option( 'time\_format' ), current\_time('timestamp') ); |
  | 355 | 355 | } |
  | 356 | 356 | return $timeField; |
  | 357 | 357 | } |
  | 358 | 358 |  |
  | 359 | 359 | public static function protect\_pdf($id) { |
  | 360 | 360 |  |
  | 361 | 361 | if (empty($id)) |
  | 362 | 362 | return; |
  | 363 | 363 |  |
  | 364 | 364 | $meta\_values = get\_post\_meta(esc\_html($id), '\_wp\_cf7pdf', true); |
  | 365 | 365 |  |
  | 366 | 366 | $pdfPassword = '--'; |
  | 367 | 367 | if( isset($meta\_values["protect\_password"]) && $meta\_values["protect\_password"]!='' ) { |
  | 368 | 368 | $pdfPassword = $meta\_values["protect\_password"]; |
  | 369 | 369 | } |
  | 370 | 370 | if( isset($meta\_values["protect\_uniquepassword"]) && $meta\_values["protect\_uniquepassword"]=='true' && (null!==get\_transient('pdf\_password') && get\_transient('pdf\_password')!='') ) { |
  | 371 | 371 | $pdfPassword = get\_transient('pdf\_password'); |
  | 372 | 372 | } |
  | 373 | 373 | if( isset($meta\_values["protect\_password\_tag"]) && $meta\_values["protect\_password\_tag"]!='' ) { |
  | 374 | 374 | $pdfPassword = wpcf7\_mail\_replace\_tags($meta\_values["protect\_password\_tag"]); |
  | 375 | 375 | } |
  | 376 | 376 | return $pdfPassword; |
  | 377 | 377 | } |
  | 378 | 378 |  |
  | 379 | 379 | public static function upload\_file($id, $valueTag, $name\_tags, $name\_tags1, $referenceOfPdf, $content) { |
  | 380 | 380 |  |
  | 381 | 381 | $upload\_dir = wp\_upload\_dir(); |
  | 382 | 382 | // On récupère le dossier upload de WP |
  | 383 | 383 | $createDirectory = cf7\_sendpdf::wpcf7pdf\_folder\_uploads(esc\_html($id)); |
  | 384 | 384 | $file\_location = cf7\_sendpdf::wpcf7pdf\_attachments($name\_tags); |
  | 385 | 385 |  |
  | 386 | 386 | if( isset($file\_location) && exif\_imagetype($file\_location) !=false ) { |
  | 387 | 387 | // remplace le tag d'une image |
  | 388 | 388 | $content = str\_replace($name\_tags, $valueTag, $content); |
  | 389 | 389 | // URL de l'image envoyée |
  | 390 | 390 | $chemin\_initial[$name\_tags1] = $createDirectory.'/'.sanitize\_text\_field($referenceOfPdf).'-'.wpcf7\_mail\_replace\_tags($name\_tags); |
  | 391 | 391 | // On copie l'image dans le dossier |
  | 392 | 392 | copy($file\_location, $chemin\_initial[$name\_tags1]); |
  | 393 | 393 | // rotation de l'image si besoin |
  | 394 | 394 | $rotate\_image[$name\_tags1] = self::adjust\_image\_orientation($chemin\_initial[$name\_tags1]); |
  | 395 | 395 | // retourne l'URL complete du tag |
  | 396 | 396 | $chemin\_final[$name\_tags1] = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $chemin\_initial[$name\_tags1]); |
  | 397 | 397 | } else if( isset($valueTag) && $valueTag!='') { |
  | 398 | 398 | // remplace le tag d'une image |
  | 399 | 399 | $content = str\_replace($name\_tags, $valueTag, $content); |
  | 400 | 400 | // URL du fichier envoyé |
  | 401 | 401 | $uploadingImg[$name\_tags1] = $createDirectory.'/'.sanitize\_text\_field($referenceOfPdf).'-'.wpcf7\_mail\_replace\_tags($name\_tags); |
  | 402 | 402 | $chemin\_final[$name\_tags1] = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $uploadingImg[$name\_tags1]); |
  | 403 | 403 |  |
  | 404 | 404 | } else { |
  | 405 | 405 | // On copie l'image ONE PIXEL dans le dossier si il n'existe pas déjà |
  | 406 | 406 | if( file\_exists($upload\_dir['basedir'] . '/sendpdfcf7\_uploads/'.$id.'/onepixel.png')===FALSE) { |
  | 407 | 407 | copy(esc\_url(WPCF7PDF\_URL.'images/onepixel.png'), esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory . '/onepixel.png'))); |
  | 408 | 408 | } |
  | 409 | 409 | $chemin\_final[$name\_tags1] = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory . '/onepixel.png'); |
  | 410 | 410 | } |
  | 411 | 411 | $content = str\_replace('[url-'.$name\_tags1.']', $chemin\_final[$name\_tags1], $content); |
  | 412 | 412 | return $content; |
  | 413 | 413 |  |
  | 414 | 414 | } |
  | 415 | 415 |  |
  | 416 | 416 | public static function tags\_parser($id, $nameOfPdf, $referenceOfPdf, $contentPdf, $mailcontent = 0, $preview = 0) { |
  | 417 | 417 |  |
  | 418 | 418 | if (empty($id)) |
  | 419 | 419 | return; |
  | 420 | 420 |  |
  | 421 | 421 | // On récupère le dossier upload de WP |
  | 422 | 422 | $upload\_dir = wp\_upload\_dir(); |
  | 423 | 423 | $createDirectory = cf7\_sendpdf::wpcf7pdf\_folder\_uploads($id); |
  | 424 | 424 |  |
  | 425 | 425 | $meta\_values = get\_post\_meta(esc\_html($id), '\_wp\_cf7pdf', true); |
  | 426 | 426 |  |
  | 427 | 427 | // Genere le nom du PDF |
  | 428 | 428 | $nameOfPdf = cf7\_sendpdf::wpcf7pdf\_name\_pdf($id); |
  | 429 | 429 |  |
  | 430 | 430 | // Definition des dates par defaut |
  | 431 | 431 | $dateField = self::returndate($id); |
  | 432 | 432 | $timeField = self::returntime($id); |
  | 433 | 433 |  |
  | 434 | 434 | // replace tag by avatar picture |
  | 435 | 435 | $user = wp\_get\_current\_user(); |
  | 436 | 436 | if ( $user ) : |
  | 437 | 437 | $contentPdf = str\_replace('[avatar]', esc\_url( get\_avatar\_url( $user->ID ) ), $contentPdf); |
  | 438 | 438 | endif; |
  | 439 | 439 | /\*\* |
  | 440 | 440 | \* FIN |
  | 441 | 441 | \*/ |
  | 442 | 442 |  |
  | 443 | 443 | // Recupère les dates Tags \_format\_ potentiels, et change le format définit par l'user |
  | 444 | 444 | if ( preg\_match\_all( '/\[(\_format\_.\*?)\]/',  $contentPdf, $outdate, PREG\_PATTERN\_ORDER ) ) { |
  | 445 | 445 |  |
  | 446 | 446 | for ($i = 0; $i < count($outdate[1]); $i++) { |
  | 447 | 447 |  |
  | 448 | 448 | $dateFormat = str\_replace('\_format\_', '', $outdate[1][$i]); |
  | 449 | 449 | $dateFormat = explode('"', $dateFormat); |
  | 450 | 450 |  |
  | 451 | 451 | if ( isset($preview) && $preview == 1 ) { |
  | 452 | 452 | $date = gmdate("d-m-Y"); |
  | 453 | 453 | $formatDate = new DateTime($date); |
  | 454 | 454 | $contentPdf = str\_replace('['.$outdate[1][$i].']', $formatDate->format($dateFormat[1]), $contentPdf); |
  | 455 | 455 | } else { |
  | 456 | 456 | $dateValue = wpcf7\_mail\_replace\_tags(esc\_html('['.trim($dateFormat[0]).']')); |
  | 457 | 457 | $formatDate = new DateTime($dateValue); |
  | 458 | 458 | $contentPdf = str\_replace('['.$outdate[1][$i].']', $formatDate->format($dateFormat[1]), $contentPdf); |
  | 459 | 459 | } |
  | 460 | 460 | } |
  | 461 | 461 |  |
  | 462 | 462 | } |
  | 463 | 463 |  |
  | 464 | 464 | // Si on trouve des shortcodes de prix |
  | 465 | 465 | if ( preg\_match\_all( '/\[(\_price.\*?)\]/',  $contentPdf, $outprice, PREG\_PATTERN\_ORDER ) ) { |
  | 466 | 466 |  |
  | 467 | 467 | for ($i = 0; $i < count($outprice[1]); $i++) { |
  | 468 | 468 |  |
  | 469 | 469 | // On separe les données |
  | 470 | 470 | $price = explode('|', $outprice[1][$i]); |
  | 471 | 471 |  |
  | 472 | 472 | if ( isset($preview) && $preview == 1 ) { |
  | 473 | 473 | $valueprice = 25000; |
  | 474 | 474 | } else { |
  | 475 | 475 | $valueprice = wpcf7\_mail\_replace\_tags(esc\_html('['.$price[1].']')); |
  | 476 | 476 | } |
  | 477 | 477 | // Nom du tag $price[1] / Decimals : $price[2] / Decimal\_separator : $price[3].' / Thousands\_separator : $price[4] |
  | 478 | 478 | if( isset($valueprice) && $valueprice>0 ) { |
  | 479 | 479 | $formatPrice = number\_format($valueprice, $price[2], $price[3], $price[4]); |
  | 480 | 480 | $contentPdf = str\_replace('['.$outprice[1][$i].']', $formatPrice, $contentPdf); |
  | 481 | 481 | } else { |
  | 482 | 482 | $contentPdf = str\_replace('['.$outprice[1][$i].']', '', $contentPdf); |
  | 483 | 483 | } |
  | 484 | 484 | } |
  | 485 | 485 |  |
  | 486 | 486 | } |
  | 487 | 487 |  |
  | 488 | 488 | if ( isset($preview) && $preview == 1 ) { |
  | 489 | 489 | $referenceOfPdf = uniqid(); |
  | 490 | 490 | } |
  | 491 | 491 | // Remplace le tag reference |
  | 492 | 492 | $contentPdf = str\_replace('[reference]', wp\_kses\_post($referenceOfPdf), $contentPdf); |
  | 493 | 493 | // Remplace le tag URL-PDF |
  | 494 | 494 | $contentPdf = str\_replace('[url-pdf]', esc\_url($upload\_dir['url'].'/'.$nameOfPdf.'-'.wp\_kses\_post($referenceOfPdf).'.pdf'), $contentPdf); |
  | 495 | 495 | if ( isset($preview) && $preview == 1 ) { |
  | 496 | 496 | // Remplace le tag ID |
  | 497 | 497 | $contentPdf = str\_replace('[ID]', '000'.gmdate('md'), $contentPdf); |
  | 498 | 498 | $contentPdf = str\_replace('[your-name]', 'John Doe', $contentPdf); |
  | 499 | 499 | $contentPdf = str\_replace('[your-email]', 'johndoe@nowhere.com', $contentPdf); |
  | 500 | 500 | $contentPdf = str\_replace('[your-subject]', \_\_("This is a subject test!", 'send-pdf-for-contact-form-7'), $contentPdf); |
  | 501 | 501 | $contentPdf = str\_replace('[your-message]', \_\_("I did not understand at first for what it was intended, but it appeared. Great!", 'send-pdf-for-contact-form-7'), $contentPdf); |
  | 502 | 502 | } |
  | 503 | 503 | // Remplace les tags date et time |
  | 504 | 504 | $contentPdf = str\_replace('[date]', $dateField, $contentPdf); |
  | 505 | 505 | $contentPdf = str\_replace('[time]', $timeField, $contentPdf); |
  | 506 | 506 |  |
  | 507 | 507 | // On gère les séparateurs avant et après les balise checkbox et radio |
  | 508 | 508 | $tagSeparate = ''; |
  | 509 | 509 | if( isset($meta\_values["separate"]) ) { |
  | 510 | 510 | if( $meta\_values["separate"] == 'none' ) { $tagSeparate = ''; } |
  | 511 | 511 | if( $meta\_values["separate"] == 'comma' ) { $tagSeparate = ', '; } |
  | 512 | 512 | if( $meta\_values["separate"] == 'space') { $tagSeparate = ' '; } |
  | 513 | 513 | if( $meta\_values["separate"] == 'dash') { $tagSeparate = '- '; } |
  | 514 | 514 | if( $meta\_values["separate"] == 'star') { $tagSeparate = '<i class="fas">&#xf621</i> '; } |
  | 515 | 515 | if( $meta\_values["separate"] == 'rightarrow') { $tagSeparate = '<i class="fas">&#xf061</i> '; } |
  | 516 | 516 | if( $meta\_values["separate"] == 'double-right-arrow') { $tagSeparate = '<i class="fas">&#xf101</i> '; } |
  | 517 | 517 | if( $meta\_values["separate"] == 'cornerarrow') { $tagSeparate = '<i class="fas">&#xf064</i> '; } |
  | 518 | 518 | } |
  | 519 | 519 | $tagSeparateAfter = ' '; |
  | 520 | 520 | if( isset($meta\_values["separate\_after"]) ) { |
  | 521 | 521 | if( $meta\_values["separate\_after"] == 'none' ) { $tagSeparateAfter = ''; } |
  | 522 | 522 | if( $meta\_values["separate\_after"] == 'comma' ) { $tagSeparateAfter = ', '; } |
  | 523 | 523 | if( $meta\_values["separate\_after"] == 'space') { $tagSeparateAfter = ' '; } |
  | 524 | 524 | if( $meta\_values["separate\_after"] == 'linebreak') { $tagSeparateAfter = '<br />'; } |
  | 525 | 525 | } |
  | 526 | 526 |  |
  | 527 | 527 | // Si option fillable, on genere les champs et remplace les données |
  | 528 | 528 | $contact\_form = WPCF7\_ContactForm::get\_instance(esc\_html($id)); |
  | 529 | 529 | $contact\_tag = $contact\_form->scan\_form\_tags(); |
  | 530 | 530 |  |
  | 531 | 531 | // Si le champ est checkbox ou radio en RAW |
  | 532 | 532 | $contentPdfTagsRaw = self::wpcf7pdf\_mailparser($contentPdf, 1); |
  | 533 | 533 | foreach ( (array) $contentPdfTagsRaw as $name\_raw ) { |
  | 534 | 534 |  |
  | 535 | 535 | $name1raw = str\_replace('\_raw\_', '', $name\_raw); |
  | 536 | 536 | $found\_key = cf7\_sendpdf::wpcf7pdf\_foundkey($contact\_tag, $name1raw); |
  | 537 | 537 | $baseTypeRaw = $contact\_tag[$found\_key]['basetype']; |
  | 538 | 538 |  |
  | 539 | 539 | if( isset($baseTypeRaw) && ($baseTypeRaw==='checkbox' || $baseTypeRaw==='radio') ) { |
  | 540 | 540 | // Exemple : CEO | sales@example.com |
  | 541 | 541 | // on remplace \_raw\_TAG par l'avant PIPE soit CEO |
  | 542 | 542 | $rawValue = wpcf7\_mail\_replace\_tags(esc\_html('['.$name\_raw.']')); |
  | 543 | 543 | $contentPdf = str\_replace(esc\_html('['.$name\_raw.']'), $rawValue, $contentPdf); |
  | 544 | 544 |  |
  | 545 | 545 | // on remplace TAG du raw par la valeur d'après PIPE soit sales@example.com |
  | 546 | 546 | $raw1Value = wpcf7\_mail\_replace\_tags(esc\_html('['.$name1raw.']')); |
  | 547 | 547 | $contentPdf = str\_replace(esc\_html('['.$name1raw.']'), $raw1Value, $contentPdf); |
  | 548 | 548 | } |
  | 549 | 549 | } |
  | 550 | 550 |  |
  | 551 | 551 | // Si le champ est un fichier ou checkbox ou radio normal |
  | 552 | 552 | $contentPdfTags = self::wpcf7pdf\_mailparser($contentPdf); |
  | 553 | 553 | foreach ( (array) $contentPdfTags as $name\_tags ) { |
  | 554 | 554 |  |
  | 555 | 555 | $name\_tags[1] = str\_replace('url-', '', $name\_tags[1]); |
  | 556 | 556 | $name\_tags[0] = str\_replace('url-', '', $name\_tags[0]); |
  | 557 | 557 | $found\_key = cf7\_sendpdf::wpcf7pdf\_foundkey($contact\_tag, $name\_tags[1]); |
  | 558 | 558 | $basetype = $contact\_tag[$found\_key]['basetype']; |
  | 559 | 559 |  |
  | 560 | 560 | $tagOptions = ''; |
  | 561 | 561 | if( isset( $contact\_tag[$found\_key]['options'] ) ) { |
  | 562 | 562 | $tagOptions = $contact\_tag[$found\_key]['options']; |
  | 563 | 563 | } |
  | 564 | 564 |  |
  | 565 | 565 | // Traitement si c'est une image |
  | 566 | 566 | if( isset($basetype) && $basetype==='file' ) { |
  | 567 | 567 |  |
  | 568 | 568 | if ( isset($preview) && $preview == 1 ) { |
  | 569 | 569 | preg\_match\_all('/<img[^>]+>/i', $contentPdf, $imgTags); |
  | 570 | 570 | for ($i = 0; $i < count($imgTags[0]); $i++) { |
  | 571 | 571 | // get the source string |
  | 572 | 572 | preg\_match('/src="([^"]+)/i', $imgTags[0][$i], $imageTag); |
  | 573 | 573 | // remove opening 'src=' tag, can`t get the regex right |
  | 574 | 574 | $origImageSrc = str\_ireplace( 'src="', '',  $imageTag[0]); |
  | 575 | 575 | if( strpos( $origImageSrc, 'http' ) === false ) { |
  | 576 | 576 | $contentPdf = str\_replace( $origImageSrc, WPCF7PDF\_URL.'images/temporary-image.jpg', $contentPdf); |
  | 577 | 577 | } |
  | 578 | 578 | } |
  | 579 | 579 | } else { |
  | 580 | 580 |  |
  | 581 | 581 | $valueTag = wpcf7\_mail\_replace\_tags($name\_tags[0]); |
  | 582 | 582 | $contentPdf = self::upload\_file($id, $valueTag, $name\_tags[0], $name\_tags[1], $referenceOfPdf, $contentPdf); |
  | 583 | 583 |  |
  | 584 | 584 | } |
  | 585 | 585 |  |
  | 586 | 586 | } else if(isset($basetype) && $basetype==='textarea') { |
  | 587 | 587 |  |
  | 588 | 588 | $valueTag = wpcf7\_mail\_replace\_tags(esc\_html($name\_tags[0])); |
  | 589 | 589 | // Si le contenu du PDF doit rester en brut et pas en HTML |
  | 590 | 590 | if( isset($meta\_values["linebreak"]) && $meta\_values['linebreak'] == 'false' ) { |
  | 591 | 591 | $linebreakText = str\_replace("\r\n", "<br />", $valueTag); |
  | 592 | 592 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $linebreakText, $contentPdf); |
  | 593 | 593 | } else if( $mailcontent==1 && (isset($meta\_values["disable-html"]) && $meta\_values['disable-html'] == 'false') ) { |
  | 594 | 594 | $linebreakText = str\_replace("\r\n", "<br />", $valueTag); |
  | 595 | 595 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $linebreakText, $contentPdf); |
  | 596 | 596 | } else { |
  | 597 | 597 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $valueTag, $contentPdf); |
  | 598 | 598 | } |
  | 599 | 599 |  |
  | 600 | 600 | } else if( isset($basetype) && $basetype==='select' ) { |
  | 601 | 601 |  |
  | 602 | 602 | $valueTag = wpcf7\_mail\_replace\_tags(esc\_html($name\_tags[0])); |
  | 603 | 603 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $valueTag, $contentPdf); |
  | 604 | 604 |  |
  | 605 | 605 | } else if( isset($basetype) && $basetype==='checkbox' ) { |
  | 606 | 606 |  |
  | 607 | 607 | $inputCheckbox = ''; |
  | 608 | 608 | $i = 1; |
  | 609 | 609 |  |
  | 610 | 610 | foreach( $contact\_tag[$found\_key]['values'] as $idCheckbox=>$valCheckbox ) { |
  | 611 | 611 |  |
  | 612 | 612 | $caseChecked = ''; |
  | 613 | 613 | $valueTag = wpcf7\_mail\_replace\_tags(esc\_html($name\_tags[0])); |
  | 614 | 614 | $emptyCheckInput = 0; |
  | 615 | 615 |  |
  | 616 | 616 | if (isset($meta\_values['data\_input']) && $meta\_values['data\_input']== 'true') { |
  | 617 | 617 |  |
  | 618 | 618 | // Si le tag est exclusive |
  | 619 | 619 | if( in\_array('exclusive', $tagOptions) ) { |
  | 620 | 620 | if( sanitize\_text\_field($valueTag)===sanitize\_text\_field($valCheckbox) ) { |
  | 621 | 621 | $caseChecked = 'checked="checked"'; |
  | 622 | 622 | } else if( (isset($meta\_values['empty\_input']) && $meta\_values['empty\_input']=='true') ) { |
  | 623 | 623 | $emptyCheckInput = 1; |
  | 624 | 624 | } |
  | 625 | 625 | } else { |
  | 626 | 626 | if( strpos($valueTag, trim($valCheckbox) )!== false ){ |
  | 627 | 627 | $caseChecked = 'checked="checked"'; |
  | 628 | 628 | } else if( (isset($meta\_values['empty\_input']) && $meta\_values['empty\_input']=='true') ) { |
  | 629 | 629 | $emptyCheckInput = 1; |
  | 630 | 630 | } |
  | 631 | 631 | } |
  | 632 | 632 |  |
  | 633 | 633 | if( in\_array('label\_first', $tagOptions) ) { |
  | 634 | 634 | if( $emptyCheckInput == 0 ) { |
  | 635 | 635 | $inputCheckbox .= ''.$tagSeparate.''.esc\_html($valCheckbox).' <input type="checkbox" class="wpcf7-checkbox" name="'.esc\_html($name\_tags[1].$idCheckbox).'" value="'.$i.'" '.$caseChecked.' />'.$tagSeparateAfter.''; |
  | 636 | 636 | } |
  | 637 | 637 | } else { |
  | 638 | 638 | if( $emptyCheckInput == 0 ) { |
  | 639 | 639 | $inputCheckbox .= ''.$tagSeparate.'<input type="checkbox" class="wpcf7-checkbox" name="'.esc\_html($name\_tags[1].$idCheckbox).'" value="'.$i.'" '.$caseChecked.'/> '.esc\_html($valCheckbox).''.$tagSeparateAfter.''; |
  | 640 | 640 | } |
  | 641 | 641 | } |
  | 642 | 642 |  |
  | 643 | 643 | } else { |
  | 644 | 644 |  |
  | 645 | 645 | if( in\_array('exclusive', $tagOptions) ) { |
  | 646 | 646 | if( sanitize\_text\_field($valueTag)===sanitize\_text\_field($valCheckbox) ) { |
  | 647 | 647 | if( $emptyCheckInput == 0 ) { |
  | 648 | 648 | $inputCheckbox .= ''.$tagSeparate.''.$valCheckbox.''.$tagSeparateAfter.''; |
  | 649 | 649 | } |
  | 650 | 650 | } |
  | 651 | 651 | } else { |
  | 652 | 652 | if( strpos($valueTag, trim($valCheckbox) )!== false ) { |
  | 653 | 653 | if( $emptyCheckInput == 0 ) { |
  | 654 | 654 | $inputCheckbox .= ''.$tagSeparate.''.$valCheckbox.''.$tagSeparateAfter.''; |
  | 655 | 655 | } |
  | 656 | 656 | } |
  | 657 | 657 | } |
  | 658 | 658 |  |
  | 659 | 659 | } |
  | 660 | 660 | $i++; |
  | 661 | 661 |  |
  | 662 | 662 | } |
  | 663 | 663 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $inputCheckbox, $contentPdf); |
  | 664 | 664 |  |
  | 665 | 665 | } else if( isset($basetype) && $basetype==='radio' ) { |
  | 666 | 666 |  |
  | 667 | 667 | $inputRadio = ''; |
  | 668 | 668 |  |
  | 669 | 669 | foreach( $contact\_tag[$found\_key]['values'] as $idRadio=>$valRadio ) { |
  | 670 | 670 |  |
  | 671 | 671 | $radioChecked = ''; |
  | 672 | 672 | $valueRadioTag = wpcf7\_mail\_replace\_tags(esc\_html($name\_tags[0])); |
  | 673 | 673 | $emptyRadioInput = 0; |
  | 674 | 674 |  |
  | 675 | 675 | if(isset($meta\_values['data\_input']) && $meta\_values['data\_input']=='true') { |
  | 676 | 676 |  |
  | 677 | 677 | if( sanitize\_text\_field($valueRadioTag)===sanitize\_text\_field($valRadio) ) { |
  | 678 | 678 | $radioChecked = ' checked="yes"'; |
  | 679 | 679 | } else if( (isset($meta\_values['empty\_input']) && $meta\_values['empty\_input']=='true') ) { |
  | 680 | 680 | $emptyRadioInput = 1; |
  | 681 | 681 | } |
  | 682 | 682 |  |
  | 683 | 683 | if(in\_array('label\_first', $tagOptions) ) { |
  | 684 | 684 | if( $emptyRadioInput == 0 ) { |
  | 685 | 685 | $inputRadio .= ''.$tagSeparate.''.$valRadio.' <input type="radio" class="wpcf7-radio" name="'.esc\_html($name\_tags[1]).'" value="'.$idRadio.'" '.$radioChecked.' >'.$tagSeparateAfter.''; |
  | 686 | 686 | } |
  | 687 | 687 | } else { |
  | 688 | 688 | if( $emptyRadioInput == 0 ) { |
  | 689 | 689 | $inputRadio .= ''.$tagSeparate.'<input type="radio" class="wpcf7-radio" name="'.esc\_html($name\_tags[1]).'" value="'.$idRadio.'" '.$radioChecked.' > '.$valRadio.''.$tagSeparateAfter.''; |
  | 690 | 690 | } |
  | 691 | 691 | } |
  | 692 | 692 |  |
  | 693 | 693 | } else { |
  | 694 | 694 |  |
  | 695 | 695 | if( sanitize\_text\_field($valueRadioTag)===sanitize\_text\_field($valRadio) ) { |
  | 696 | 696 | if( $emptyRadioInput == 0 ) { |
  | 697 | 697 | $inputRadio .= ''.$tagSeparate.''.$valRadio.''.$tagSeparateAfter.''; |
  | 698 | 698 | } |
  | 699 | 699 | } |
  | 700 | 700 | } |
  | 701 | 701 | } |
  | 702 | 702 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), $inputRadio, $contentPdf); |
  | 703 | 703 |  |
  | 704 | 704 | } else { |
  | 705 | 705 |  |
  | 706 | 706 | $valueTag = wpcf7\_mail\_replace\_tags(esc\_html($name\_tags[0])); |
  | 707 | 707 | $contentPdf = str\_replace(esc\_html($name\_tags[0]), esc\_html($valueTag), $contentPdf); |
  | 708 | 708 | } |
  | 709 | 709 | } |
  | 710 | 710 |  |
  | 711 | 711 | // Si le contenu du PDF doit rester en brut et pas en HTML |
  | 712 |  | if( isset($meta\_values["linebreak"]) && $meta\_values['linebreak'] == 'false' ) { |
  |  | 712 | /\*if( isset($meta\_values["linebreak"]) && $meta\_values['linebreak'] == 'false' ) { |
  | 713 | 713 | $contentPdf = str\_replace("\r\n", "<br />", $contentPdf); |
  | 714 | 714 | } else if( $mailcontent==1 && (isset($meta\_values["disable-html"]) && $meta\_values['disable-html'] == 'false') ) { |
  | 715 | 715 | $contentPdf = str\_replace("\r\n", "<br />", $contentPdf); |
  | 716 |  | } |
  |  | 716 | }\*/ |
  | 717 | 717 |  |
  | 718 | 718 | return $contentPdf; |
  | 719 | 719 | } |
  | 720 | 720 |  |
  | 721 | 721 |  |
  | 722 | 722 | } |
* ## [send-pdf-for-contact-form-7/trunk/classes/send-pdf.php](/changeset/3074531/send-pdf-for-contact-form-7/trunk/classes/send-pdf.php?old=3069880&old_path=send-pdf-for-contact-form-7%2Ftrunk%2Fclasses%2Fsend-pdf.php "Show the [3069882:3074631] differences restricted to send-pdf-for-contact-form-7/trunk/classes/send-pdf.php")

  | [r3069882](/browser/send-pdf-for-contact-form-7/trunk/classes/send-pdf.php?rev=3069880#L1 "Show revision 3069882 of this file in browser") | [r3074631](/browser/send-pdf-for-contact-form-7/trunk/classes/send-pdf.php?rev=3074531#L1 "Show revision 3074631 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | class cf7\_sendpdf { |
  | 4 | 4 |  |
  | 5 | 5 | protected static $instance; |
  | 6 | 6 | private $hidden\_fields = array(); |
  | 7 | 7 |  |
  | 8 | 8 | public static function init() { |
  | 9 | 9 | is\_null( self::$instance ) AND self::$instance = new self; |
  | 10 | 10 | return self::$instance; |
  | 11 | 11 | } |
  | 12 | 12 |  |
  | 13 | 13 | public function hooks() { |
  | 14 | 14 |  |
  | 15 | 15 | /\* Version du plugin \*/ |
  | 16 | 16 | $option['wpcf7pdf\_version'] = WPCF7PDF\_VERSION; |
  | 17 | 17 | if( !get\_option('wpcf7pdf\_version') ) { |
  | 18 | 18 | add\_option('wpcf7pdf\_version', $option); |
  | 19 | 19 | } else if ( get\_option('wpcf7pdf\_version') != WPCF7PDF\_VERSION ) { |
  | 20 | 20 | update\_option('wpcf7pdf\_version', WPCF7PDF\_VERSION); |
  | 21 | 21 | } |
  | 22 | 22 |  |
  | 23 | 23 | /\* Définition du répertoire TMP pour CF7 \*/ |
  | 24 | 24 | $upload\_dir = wp\_upload\_dir(); |
  | 25 | 25 | if ( defined( 'WPCF7\_UPLOADS\_TMP\_DIR' ) ) { |
  | 26 | 26 | update\_option('wpcf7pdf\_path\_temp', WPCF7\_UPLOADS\_TMP\_DIR); |
  | 27 | 27 | } else { |
  | 28 | 28 | update\_option('wpcf7pdf\_path\_temp', $upload\_dir['basedir'] . '/sendpdfcf7\_uploads/tmp'); |
  | 29 | 29 | } |
  | 30 | 30 |  |
  | 31 | 31 | // If you want to keep certain style properties you have to use this filter |
  | 32 | 32 | add\_filter( 'safe\_style\_css', function( $styles ) { |
  | 33 | 33 | $styles[] = 'text-rotate'; |
  | 34 | 34 | return $styles; |
  | 35 | 35 | } ); |
  | 36 | 36 |  |
  | 37 | 37 | // Maybe disable AJAX requests |
  | 38 | 38 | add\_filter( 'wpcf7\_mail\_components', array( $this, 'wpcf7pdf\_mail\_components' ), 10, 3 ); |
  | 39 | 39 | add\_action( 'wpcf7\_mail\_sent', array( $this, 'wpcf7pdf\_after\_mail\_actions' ), 10, 1 ); |
  | 40 | 40 | add\_action( 'admin\_menu', array( $this, 'wpcf7pdf\_add\_admin' ) ); |
  | 41 | 41 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'wpcf7pdf\_codemirror\_enqueue\_scripts' ) ); |
  | 42 | 42 | add\_filter( 'plugin\_action\_links', array( $this, 'wpcf7pdf\_plugin\_actions' ), 10, 2 ); |
  | 43 | 43 | add\_action( 'admin\_head', array( $this, 'wpcf7pdf\_admin\_head' ) ); |
  | 44 | 44 | add\_action( 'admin\_init', array( $this, 'wpcf7pdf\_process\_settings\_import' ) ); |
  | 45 | 45 | add\_action( 'admin\_init', array( $this, 'wpcf7pdf\_process\_settings\_export' ) ); |
  | 46 | 46 | add\_action( 'wpcf7\_before\_send\_mail', array( $this, 'wpcf7pdf\_send\_pdf' ) ); |
  | 47 | 47 | // Ajoute des champs cachés |
  | 48 | 48 | add\_filter('wpcf7\_form\_hidden\_fields', array( $this, 'wpcf7pdf\_form\_hidden\_fields'), 10, 1); |
  | 49 | 49 | // Use ajax |
  | 50 | 50 | add\_action( 'wp\_ajax\_wpcf7pdf\_js\_action', array( $this, 'wpcf7pdf\_js\_action' ) ); |
  | 51 | 51 | add\_action( 'wp\_ajax\_nopriv\_wpcf7pdf\_js\_action', array( $this, 'wpcf7pdf\_js\_action' ) ); |
  | 52 | 52 |  |
  | 53 | 53 | // on affiche les scripts footer |
  | 54 | 54 | add\_action( 'wp\_footer', array( $this, 'wpcf7\_add\_footer' ), 90 ); |
  | 55 | 55 |  |
  | 56 | 56 | if( isset($\_GET['csv\_security']) && wp\_verify\_nonce($\_GET['csv\_security'], 'go\_generate') ) { |
  | 57 |  | if( isset($\_GET['csv']) && intval($\_GET['csv']) && $\_GET['csv']==1 ) { |
  | 58 |  | $csv = $this->wpcf7\_export\_csv( esc\_html($\_GET['idform']) ); |
  | 59 |  |  |
  | 60 |  | header("Pragma: public"); |
  | 61 |  | header("Expires: 0"); |
  | 62 |  | header("Cache-Control: must-revalidate, post-check=0, pre-check=0"); |
  | 63 |  | header("Cache-Control: private", false); |
  | 64 |  | header("Content-Type: application/octet-stream"); |
  | 65 |  | header("Content-Disposition: attachment; filename=\"sendpdfcf7\_export\_".esc\_html($\_GET['idform']).".csv\";" ); |
  | 66 |  | header("Content-Transfer-Encoding: binary"); |
  | 67 |  |  |
  | 68 |  | echo esc\_html($csv); |
  | 69 |  | exit; |
  |  | 57 |  |
  |  | 58 | $capability = apply\_filters( 'wpcf7pdf\_modify\_capability', WPCF7\_ADMIN\_READ\_CAPABILITY ); |
  |  | 59 | if ( isset($capability) && !empty( $capability ) ) { |
  |  | 60 |  |
  |  | 61 | if( isset($\_GET['csv']) && intval($\_GET['csv']) && $\_GET['csv']==1 ) { |
  |  | 62 | $csv = $this->wpcf7\_export\_csv( esc\_html($\_GET['idform']) ); |
  |  | 63 |  |
  |  | 64 | header("Pragma: public"); |
  |  | 65 | header("Expires: 0"); |
  |  | 66 | header("Cache-Control: must-revalidate, post-check=0, pre-check=0"); |
  |  | 67 | header("Cache-Control: private", false); |
  |  | 68 | header("Content-Type: application/octet-stream"); |
  |  | 69 | header("Content-Disposition: attachment; filename=\"sendpdfcf7\_export\_".esc\_html($\_GET['idform']).".csv\";" ); |
  |  | 70 | header("Content-Transfer-Encoding: binary"); |
  |  | 71 |  |
  |  | 72 | echo esc\_html($csv); |
  |  | 73 | exit; |
  |  | 74 | } |
  | 70 | 75 | } |
  | 71 | 76 | } |
  | 72 | 77 |  |
  | 73 | 78 | } |
  | 74 | 79 |  |
  | 75 | 80 | // Add "Réglages" link on plugins page |
  | 76 | 81 | function wpcf7pdf\_plugin\_actions( $links, $file ) { |
  | 77 | 82 |  |
  | 78 | 83 | if ( $file != WPCF7PDF\_PLUGIN\_BASENAME ) { |
  | 79 | 84 | return $links; |
  | 80 | 85 | } else { |
  | 81 | 86 | $settings\_link = '<a href="admin.php?page=wpcf7-send-pdf">' |
  | 82 | 87 | . esc\_html( \_\_( 'Settings', 'send-pdf-for-contact-form-7' ) ) . '</a>'; |
  | 83 | 88 |  |
  | 84 | 89 | array\_unshift( $links, $settings\_link ); |
  | 85 | 90 |  |
  | 86 | 91 | return $links; |
  | 87 | 92 | } |
  | 88 | 93 | } |
  | 89 | 94 |  |
  | 90 | 95 |  |
  | 91 | 96 |  |
  | 92 | 97 | function wpcf7pdf\_js\_action() { |
  | 93 | 98 |  |
  | 94 | 99 | global $wpdb; |
  | 95 | 100 |  |
  | 96 | 101 | $id = sanitize\_text\_field($\_POST['element\_id']); |
  | 97 | 102 | $idform = sanitize\_text\_field($\_POST['form\_id']); |
  | 98 | 103 | $nonce = sanitize\_text\_field($\_POST['nonce']); |
  | 99 | 104 |  |
  | 100 | 105 | if( wp\_verify\_nonce($nonce, 'delete\_record-'.$id) ) { |
  | 101 | 106 |  |
  | 102 | 107 | // Supprime dans la table des PDF 'PREFIX\_wpcf7pdf\_files' |
  | 103 | 108 | $resultOptions = WPCF7PDF\_settings::delete($id); |
  | 104 | 109 |  |
  | 105 | 110 | if( isset($resultOptions) && $resultOptions == "true" ) { |
  | 106 | 111 |  |
  | 107 | 112 | // On récupère le dossier upload de WP |
  | 108 | 113 | $upload\_dir = wp\_upload\_dir(); |
  | 109 | 114 |  |
  | 110 | 115 | // va chercher le nom du PDF |
  | 111 | 116 | $resultFile = WPCF7PDF\_settings::get($id); |
  | 112 | 117 |  |
  | 113 | 118 | if( isset($resultFile) && !empty($resultFile) ) { |
  | 114 | 119 | // remplace par le PATH |
  | 115 | 120 | $chemin\_path = str\_replace($upload\_dir['baseurl'], $upload\_dir['basedir'], $resultFile->wpcf7pdf\_files); |
  | 116 | 121 | if( isset($chemin\_path) && file\_exists($chemin\_path) ) { |
  | 117 | 122 | wp\_delete\_file($chemin\_path); |
  | 118 | 123 | } |
  | 119 | 124 | } |
  | 120 | 125 | echo 'success'; |
  | 121 | 126 | } |
  | 122 | 127 |  |
  | 123 | 128 | } else { |
  | 124 | 129 | echo 'error js action'; |
  | 125 | 130 | } |
  | 126 | 131 |  |
  | 127 | 132 | die(); |
  | 128 | 133 | } |
  | 129 | 134 |  |
  | 130 | 135 | static function wpcf7pdf\_mailparser($data, $raw=0) { |
  | 131 | 136 |  |
  | 132 | 137 | if( isset($raw) && $raw==1) { |
  | 133 | 138 | preg\_match\_all( '/\[(\_raw\_.\*?)\]/', $data, $matches ); |
  | 134 | 139 | return $matches[1]; |
  | 135 | 140 | } else { |
  | 136 | 141 | preg\_match\_all('/\[(.\*?)\]/', $data, $contentPdfTags, PREG\_SET\_ORDER, 0); |
  | 137 | 142 | return $contentPdfTags; |
  | 138 | 143 | } |
  | 139 | 144 |  |
  | 140 | 145 | } |
  | 141 | 146 |  |
  | 142 | 147 | static function wpcf7pdf\_foundkey($data, $name) { |
  | 143 | 148 |  |
  | 144 | 149 | $found\_name = array\_column($data, 'name'); |
  | 145 | 150 | $found\_key = array\_search($name, $found\_name); |
  | 146 | 151 |  |
  | 147 | 152 | return $found\_key; |
  | 148 | 153 |  |
  | 149 | 154 | } |
  | 150 | 155 |  |
  | 151 | 156 | static function wpf7pdf\_tagsparser($id, $reference='') { |
  | 152 | 157 |  |
  | 153 | 158 | // nothing's here... do nothing... |
  | 154 | 159 | if (empty($id)) |
  | 155 | 160 | return; |
  | 156 | 161 |  |
  | 157 | 162 |  |
  | 158 | 163 | // On va cherche les champs du formulaire |
  | 159 | 164 | $meta\_tags = get\_post\_meta(esc\_html($id), '\_wp\_cf7pdf\_fields', true); |
  | 160 | 165 |  |
  | 161 | 166 | // Definition des dates par defaut |
  | 162 | 167 | $dateField = WPCF7PDF\_prepare::returndate($id); |
  | 163 | 168 | $timeField = WPCF7PDF\_prepare::returntime($id); |
  | 164 | 169 |  |
  | 165 | 170 | // Prepare les valeurs dans tableau CSV |
  | 166 | 171 | $tagsParser = array(sanitize\_text\_field($reference), $dateField.' '.$timeField); |
  | 167 | 172 | foreach($meta\_tags as $ntags => $vtags) { |
  | 168 | 173 | $returnValue = wpcf7\_mail\_replace\_tags($vtags); |
  | 169 | 174 | array\_push($tagsParser, $returnValue); |
  | 170 | 175 | } |
  | 171 | 176 |  |
  | 172 | 177 | return $tagsParser; |
  | 173 | 178 |  |
  | 174 | 179 | } |
  | 175 | 180 |  |
  | 176 | 181 | /\*\* |
  | 177 | 182 | \* Process a settings export that generates a .json file of the erident settings |
  | 178 | 183 | \*/ |
  | 179 | 184 | function wpcf7pdf\_process\_settings\_export() { |
  | 180 | 185 |  |
  | 181 | 186 | if(empty( $\_POST['wpcf7\_action']) || 'export\_settings' != $\_POST['wpcf7\_action']) |
  | 182 | 187 | return; |
  | 183 | 188 |  |
  | 184 | 189 | if(!wp\_verify\_nonce($\_POST['wpcf7\_export\_nonce'], 'go\_export\_nonce' )) |
  | 185 | 190 | return; |
  | 186 | 191 |  |
  | 187 | 192 | if(!current\_user\_can('manage\_options') ) |
  | 188 | 193 | return; |
  | 189 | 194 |  |
  | 190 | 195 | if(empty($\_POST['wpcf7pdf\_export\_id'])) |
  | 191 | 196 | return; |
  | 192 | 197 |  |
  | 193 | 198 | $settings = get\_post\_meta(sanitize\_text\_field($\_POST['wpcf7pdf\_export\_id']), '\_wp\_cf7pdf', true); |
  | 194 | 199 |  |
  | 195 | 200 | ignore\_user\_abort(true); |
  | 196 | 201 |  |
  | 197 | 202 | nocache\_headers(); |
  | 198 | 203 | header('Content-Type: application/json; charset=utf-8'); |
  | 199 | 204 | header('Content-Disposition: attachment; filename=wpcf7pdf-settings-export-'.esc\_html($\_POST['wpcf7pdf\_export\_id']).'-'.gmdate('m-d-Y').'.json'); |
  | 200 | 205 | header("Expires: 0"); |
  | 201 | 206 |  |
  | 202 | 207 | echo wp\_json\_encode($settings); |
  | 203 | 208 | exit; |
  | 204 | 209 | } |
  | 205 | 210 |  |
  | 206 | 211 |  |
  | 207 | 212 | /\*\* |
  | 208 | 213 | \* Process a settings import from a json file |
  | 209 | 214 | \*/ |
  | 210 | 215 | function wpcf7pdf\_process\_settings\_import() { |
  | 211 | 216 |  |
  | 212 | 217 | if(empty($\_POST['wpcf7\_action']) || 'import\_settings' != $\_POST['wpcf7\_action']) |
  | 213 | 218 | return; |
  | 214 | 219 |  |
  | 215 | 220 | if(!wp\_verify\_nonce( $\_POST['wpcf7\_import\_nonce'], 'go\_import\_nonce' )) |
  | 216 | 221 | return; |
  | 217 | 222 |  |
  | 218 | 223 | if(!current\_user\_can( 'manage\_options')) |
  | 219 | 224 | return; |
  | 220 | 225 |  |
  | 221 | 226 | if(empty($\_POST['wpcf7pdf\_import\_id'])) |
  | 222 | 227 | return; |
  | 223 | 228 |  |
  | 224 | 229 | $extension = strtolower(pathinfo($\_FILES['wpcf7\_import\_file']['name'], PATHINFO\_EXTENSION)); |
  | 225 | 230 | if($extension != 'json') { |
  | 226 | 231 | wp\_die( esc\_html\_\_( 'Please upload a valid .json file', 'send-pdf-for-contact-form-7' ) ); |
  | 227 | 232 | } |
  | 228 | 233 |  |
  | 229 | 234 | $import\_file = $\_FILES['wpcf7\_import\_file']['tmp\_name']; |
  | 230 | 235 |  |
  | 231 | 236 | if(empty($import\_file) ) { |
  | 232 | 237 | wp\_die( esc\_html\_\_( 'Please upload a file to import', 'send-pdf-for-contact-form-7' ) ); |
  | 233 | 238 | } |
  | 234 | 239 |  |
  | 235 | 240 | // Retrieve the settings from the file and convert the json object to an array. |
  | 236 | 241 | $settings = (array) json\_decode(file\_get\_contents($import\_file)); |
  | 237 | 242 |  |
  | 238 | 243 | update\_post\_meta(sanitize\_text\_field($\_POST['wpcf7pdf\_import\_id']), '\_wp\_cf7pdf', $settings); |
  | 239 | 244 |  |
  | 240 | 245 | echo '<div id="message" class="updated fade"><p><strong>' . esc\_html\_\_('New settings imported successfully!', 'send-pdf-for-contact-form-7') . '</strong></p></div>'; |
  | 241 | 246 |  |
  | 242 | 247 | } |
  | 243 | 248 |  |
  | 244 | 249 | function wpcf7pdf\_dashboard\_html\_page() { |
  | 245 | 250 | include(WPCF7PDF\_DIR."/views/send-pdf-admin.php"); |
  | 246 | 251 | } |
  | 247 | 252 |  |
  | 248 | 253 | /\* Ajout feuille CSS pour l'admin barre \*/ |
  | 249 | 254 | function wpcf7pdf\_admin\_head() { |
  | 250 | 255 |  |
  | 251 | 256 | global $current\_user; |
  | 252 | 257 | global $\_wp\_admin\_css\_colors; |
  | 253 | 258 |  |
  | 254 | 259 | if (isset($\_GET['page']) && $\_GET['page'] == 'wpcf7-send-pdf') { // phpcs:ignore |
  | 255 | 260 |  |
  | 256 | 261 | $admin\_color = get\_user\_option( 'admin\_color', get\_current\_user\_id() ); |
  | 257 | 262 | $colors      = $\_wp\_admin\_css\_colors[$admin\_color]->colors; |
  | 258 | 263 |  |
  | 259 | 264 | echo ' |
  | 260 | 265 | <style type="text/css"> |
  | 261 | 266 | .switch-field input:checked + label { background-color: '.esc\_html($colors[2]).'; } |
  | 262 | 267 | .wpcf7-form-field { |
  | 263 | 268 | border: 1px solid '.esc\_html($colors[2]).'!important; |
  | 264 | 269 | background: #fff; |
  | 265 | 270 | -webkit-border-radius: 4px; |
  | 266 | 271 | -moz-border-radius: 4px; |
  | 267 | 272 | border-radius: 4px; |
  | 268 | 273 | color: '.esc\_html($colors[2]).'!important; |
  | 269 | 274 | -webkit-box-shadow: rgba(255,255,255,0.4) 0 1px 0, inset rgba(000,000,000,0.7) 0 0px 0px; |
  | 270 | 275 | -moz-box-shadow: rgba(255,255,255,0.4) 0 1px 0, inset rgba(000,000,000,0.7) 0 0px 0px; |
  | 271 | 276 | box-shadow: rgba(255,255,255,0.4) 0 1px 0, inset rgba(000,000,000,0.7) 0 0px 0px; |
  | 272 | 277 | padding:8px; |
  | 273 | 278 | /\*margin-bottom:20px;\*/ |
  | 274 | 279 | } |
  | 275 | 280 | .wpcf7-form-field:focus { |
  | 276 | 281 | background: #fff!important; |
  | 277 | 282 | color: '.esc\_html($colors[0]).'!important; |
  | 278 | 283 | } |
  | 279 | 284 | .switch-field input:checked + label:last-of-type { |
  | 280 | 285 | background-color: '.esc\_html($colors[0]).'!important; |
  | 281 | 286 | color:#e4e4e4!important; |
  | 282 | 287 | } |
  | 283 | 288 | .switch-field-mini input:checked + label { background-color: '.esc\_html($colors[2]).'; } |
  | 284 | 289 | .switch-field-mini input:checked + label:last-of-type {background-color: '.esc\_html($colors[0]).'!important;color:#e4e4e4!important;} |
  | 285 | 290 | .preview-btn { |
  | 286 | 291 | background: '.esc\_html($colors[2]).'; |
  | 287 | 292 | } |
  | 288 | 293 | .preview-btn:hover, .preview-btn a:hover { |
  | 289 | 294 | background: '.esc\_html($colors[1]).'; |
  | 290 | 295 | } |
  | 291 | 296 | .postbox, .bottom-notices { |
  | 292 | 297 | max-width:none; |
  | 293 | 298 | background-color: #fafafa; |
  | 294 | 299 | } |
  | 295 | 300 | #wpcf7-bandeau { |
  | 296 | 301 | background-image:url('.esc\_url(plugins\_url('../images/bandeau-extension.gif',  \_\_FILE\_\_)).'); |
  | 297 | 302 | background-repeat:no-repeat; |
  | 298 | 303 | } |
  | 299 | 304 | #wpcf7-general h2 sup { |
  | 300 | 305 | font-size: 14px; |
  | 301 | 306 | position: relative; |
  | 302 | 307 | font-weight: 400; |
  | 303 | 308 | background: #0085ba; |
  | 304 | 309 | color: #fff !important; |
  | 305 | 310 | padding: 2px 4px !important; |
  | 306 | 311 | border-radius: 3px; |
  | 307 | 312 | top: 5px; |
  | 308 | 313 | left: 3px; |
  | 309 | 314 | border: none !important; |
  | 310 | 315 | } |
  | 311 | 316 | </style> |
  | 312 | 317 | '; |
  | 313 | 318 |  |
  | 314 | 319 | } |
  | 315 | 320 | } |
  | 316 | 321 |  |
  | 317 | 322 | function wpcf7pdf\_codemirror\_enqueue\_scripts($hook) { |
  | 318 | 323 |  |
  | 319 | 324 | if (isset($\_GET['page']) && $\_GET['page'] == 'wpcf7-send-pdf') { // phpcs:ignore |
  | 320 | 325 | wp\_enqueue\_code\_editor(array( 'type' => 'text/html')); |
  | 321 | 326 | wp\_enqueue\_script('js-code-editor', WPCF7PDF\_URL.'js/wpcf7pdf-code-editor.js', array( 'jquery' ), WPCF7PDF\_VERSION, true); |
  | 322 | 327 | } |
  | 323 | 328 |  |
  | 324 | 329 | } |
  | 325 | 330 |  |
  | 326 | 331 | function wpcf7pdf\_add\_admin() { |
  | 327 | 332 |  |
  | 328 | 333 | $capability = apply\_filters( 'wpcf7pdf\_modify\_capability', WPCF7\_ADMIN\_READ\_CAPABILITY ); |
  | 329 | 334 |  |
  | 330 | 335 | if ( isset($capability) && !empty( $capability ) ) { |
  | 331 | 336 | add\_submenu\_page( 'wpcf7', |
  | 332 | 337 | \_\_('Options for CF7 Send PDF', 'send-pdf-for-contact-form-7'), |
  | 333 | 338 | \_\_('Create PDF', 'send-pdf-for-contact-form-7'), |
  | 334 | 339 | $capability, 'wpcf7-send-pdf', |
  | 335 | 340 | array( $this, 'wpcf7pdf\_dashboard\_html\_page') ); |
  | 336 | 341 | } |
  | 337 | 342 |  |
  | 338 | 343 | // If you're not including an image upload then you can leave this function call out |
  | 339 | 344 | if (isset($\_GET['page']) && $\_GET['page'] == 'wpcf7-send-pdf') { // phpcs:ignore |
  | 340 | 345 |  |
  | 341 | 346 | wp\_enqueue\_media(); |
  | 342 | 347 |  |
  | 343 | 348 | wp\_enqueue\_script('media-upload'); |
  | 344 | 349 | wp\_enqueue\_script('thickbox'); |
  | 345 | 350 |  |
  | 346 | 351 | wp\_enqueue\_script('script', WPCF7PDF\_URL.'js/wpcf7pdf-action.js', array('jquery'), '1.0', true); |
  | 347 | 352 | /\*// pass Ajax Url to script.js |
  | 348 | 353 | wp\_localize\_script('script', 'ajaxurl', admin\_url( 'admin-ajax.php' ) );\*/ |
  | 349 | 354 | wp\_enqueue\_script('main'); |
  | 350 | 355 | $localize = array( |
  | 351 | 356 | 'ajaxurl' => admin\_url('admin-ajax.php') |
  | 352 | 357 | ); |
  | 353 | 358 | wp\_localize\_script('main', 'ajax\_params', $localize); |
  | 354 | 359 |  |
  | 355 | 360 | wp\_register\_script('wpcf7-my-upload', WPCF7PDF\_URL.'/js/wpcf7pdf-script.js', array('jquery','media-upload','thickbox'), WPCF7PDF\_VERSION, true); |
  | 356 | 361 | wp\_enqueue\_script('wpcf7-my-upload'); |
  | 357 | 362 |  |
  | 358 | 363 | $pcf7pdf\_settings['codeEditor'] = wp\_enqueue\_code\_editor(array('type' => 'text/html')); |
  | 359 | 364 | wp\_localize\_script('jquery', 'pcf7pdf\_settings', $pcf7pdf\_settings); |
  | 360 | 365 |  |
  | 361 | 366 | wp\_enqueue\_script('wp-theme-plugin-editor'); |
  | 362 | 367 | wp\_enqueue\_style('wp-codemirror'); |
  | 363 | 368 |  |
  | 364 | 369 | wp\_enqueue\_style('jquery-defaut-style', WPCF7PDF\_URL.'css/wpcf7-admin.css', array(), WPCF7PDF\_VERSION); |
  | 365 | 370 |  |
  | 366 | 371 | // Now we can localize the script with our data. |
  | 367 | 372 | wp\_localize\_script( 'wpcf7-my-upload', 'Data', array( |
  | 368 | 373 | 'textebutton'  =>  \_\_( 'Choose This Image', 'send-pdf-for-contact-form-7' ), |
  | 369 | 374 | 'title'  => \_\_( 'Choose Image', 'send-pdf-for-contact-form-7' ), |
  | 370 | 375 | ) ); |
  | 371 | 376 | } |
  | 372 | 377 |  |
  | 373 | 378 | global $wpdb; |
  | 374 | 379 | $wpdb->ma\_table\_wpcf7pdf = $wpdb->prefix.'wpcf7pdf\_files'; |
  | 375 | 380 | $wpdb->tables[] = 'ma\_table\_wpcf7pdf'; |
  | 376 | 381 | $showTable = $wpdb->get\_var("SHOW TABLES LIKE '".$wpdb->ma\_table\_wpcf7pdf."'"); // phpcs:ignore WordPress.DB.DirectDatabaseQuery |
  | 377 | 382 | /\* Création des tables nécessaires \*/ |
  | 378 | 383 | if( $showTable != $wpdb->ma\_table\_wpcf7pdf) { |
  | 379 | 384 |  |
  | 380 | 385 | $sql = "CREATE TABLE `".$wpdb->ma\_table\_wpcf7pdf."` ( |
  | 381 | 386 | `wpcf7pdf\_id` bigint(20) unsigned NOT NULL AUTO\_INCREMENT, |
  | 382 | 387 | `wpcf7pdf\_id\_form` bigint(20) unsigned NOT NULL, |
  | 383 | 388 | `wpcf7pdf\_reference` varchar(40) NOT NULL, |
  | 384 | 389 | `wpcf7pdf\_status` tinyint(2) NOT NULL DEFAULT '1', |
  | 385 | 390 | `wpcf7pdf\_data` text NOT NULL, |
  | 386 | 391 | `wpcf7pdf\_files` longtext NOT NULL, |
  | 387 | 392 | `wpcf7pdf\_files2` longtext NOT NULL, |
  | 388 | 393 | PRIMARY KEY (`wpcf7pdf\_id`) |
  | 389 | 394 | ) ;"; |
  | 390 | 395 | require\_once(ABSPATH . 'wp-admin/includes/upgrade.php'); |
  | 391 | 396 | dbDelta($sql); |
  | 392 | 397 | } |
  | 393 | 398 |  |
  | 394 | 399 | } |
  | 395 | 400 |  |
  | 396 | 401 | function save($id, $data, $reference='-', $file = '', $file2 = '') { |
  | 397 | 402 |  |
  | 398 | 403 | global $wpdb; |
  | 399 | 404 | $meta\_values = get\_post\_meta(sanitize\_text\_field($id), '\_wp\_cf7pdf', true); |
  | 400 | 405 |  |
  | 401 | 406 | if( isset($meta\_values["pdf-name"]) && !empty($meta\_values["pdf-name"]) ) { |
  | 402 | 407 | $namePDF = esc\_html(trim($meta\_values["pdf-name"])); |
  | 403 | 408 | $namePDF = str\_replace(' ', '-', $namePDF); |
  | 404 | 409 |  |
  | 405 | 410 | $data = array( |
  | 406 | 411 | 'wpcf7pdf\_id\_form' => sanitize\_text\_field($id), |
  | 407 | 412 | 'wpcf7pdf\_data' => sanitize\_textarea\_field($data), |
  | 408 | 413 | 'wpcf7pdf\_reference' => $reference, |
  | 409 | 414 | 'wpcf7pdf\_files' => sanitize\_url($file), |
  | 410 | 415 | 'wpcf7pdf\_files2' => sanitize\_url($file2) |
  | 411 | 416 | ); |
  | 412 | 417 | $result = $wpdb->insert($wpdb->prefix.'wpcf7pdf\_files', $data); // phpcs:ignore WordPress.DB.DirectDatabaseQuery |
  | 413 | 418 | if($result) { |
  | 414 | 419 | return $wpdb->insert\_id; |
  | 415 | 420 | } |
  | 416 | 421 | } |
  | 417 | 422 |  |
  | 418 | 423 | } |
  | 419 | 424 |  |
  | 420 | 425 | static function wpcf7pdf\_name\_pdf($id='', $reference = '') { |
  | 421 | 426 |  |
  | 422 | 427 | // On recupere l'ID du Formulaire current |
  | 423 | 428 | $wpcf7 = WPCF7\_ContactForm::get\_current(); |
  | 424 | 429 | if( $wpcf7 && $id=='') { |
  | 425 | 430 | $idForm = $wpcf7->id(); |
  | 426 | 431 | } else { |
  | 427 | 432 | $idForm = $id; |
  | 428 | 433 | } |
  | 429 | 434 |  |
  | 430 | 435 | if( empty($idForm) ) { wp\_redirect( 'admin.php?page=wpcf7-send-pdf&deleted=1' ); die('No ID Form'); } |
  | 431 | 436 |  |
  | 432 | 437 | // Je fais appelle aux fonctions pour donner une valeur au nom. |
  | 433 | 438 | $meta\_values = get\_post\_meta(sanitize\_textarea\_field($idForm), '\_wp\_cf7pdf', true); |
  | 434 | 439 | if( isset($meta\_values["pdf-name"]) && !empty($meta\_values["pdf-name"]) ) { |
  | 435 | 440 | $namePDF = esc\_html(trim($meta\_values["pdf-name"])); |
  | 436 | 441 | $namePDF = str\_replace(' ', '-', $namePDF); |
  | 437 | 442 | } else { |
  | 438 | 443 | $namePDF = 'document-pdf'; |
  | 439 | 444 | } |
  | 440 | 445 |  |
  | 441 | 446 | if(isset($meta\_values["pdf-add-name"]) && $meta\_values["pdf-add-name"]!= '') { |
  | 442 | 447 |  |
  | 443 | 448 | $addName = ''; |
  | 444 | 449 | $getNamePerso = explode(',', esc\_html($meta\_values["pdf-add-name"])); |
  | 445 | 450 | if(isset($meta\_values["date-for-name"]) && !empty($meta\_values["date-for-name"])) { |
  | 446 | 451 | $dateForName = date\_i18n($meta\_values["date-for-name"]); |
  | 447 | 452 | } else { |
  | 448 | 453 | $dateForName = date\_i18n('mdY', current\_time('timestamp')); |
  | 449 | 454 | } |
  | 450 | 455 |  |
  | 451 | 456 | $getNamePerso = str\_replace('[date]', $dateForName, $getNamePerso); |
  | 452 | 457 | $getNamePerso = str\_replace('[reference]', $reference, $getNamePerso); |
  | 453 | 458 | foreach ( $getNamePerso as $key => $value ) { |
  | 454 | 459 | $addNewName[$key] = wpcf7\_mail\_replace\_tags($value); |
  | 455 | 460 | $addNewName[$key] = str\_replace(' ', '-', $addNewName[$key]); |
  | 456 | 461 | $addNewName[$key] = str\_replace('.', '', $addNewName[$key]); |
  | 457 | 462 | $addNewName[$key] = strtolower($addNewName[$key]); |
  | 458 | 463 | $addName .= '-'.sanitize\_title($addNewName[$key]); |
  | 459 | 464 | } |
  | 460 | 465 | $namePDF = $namePDF.$addName; |
  | 461 | 466 |  |
  | 462 | 467 | $contact\_form = WPCF7\_ContactForm::get\_instance($id); |
  | 463 | 468 | if( $contact\_form ) { |
  | 464 | 469 | $contact\_tag = $contact\_form->scan\_form\_tags(); |
  | 465 | 470 | if( !empty($contact\_tag) ) { |
  | 466 | 471 | foreach ( $contact\_tag as $sh\_tag ) { |
  | 467 | 472 | $valueTag = wpcf7\_mail\_replace\_tags('['.esc\_html($sh\_tag["name"]).']'); |
  | 468 | 473 | $namePDF = str\_replace('['.esc\_html($sh\_tag["name"]).']', sanitize\_title($valueTag), $namePDF); |
  | 469 | 474 | } |
  | 470 | 475 | } |
  | 471 | 476 | } |
  | 472 | 477 |  |
  | 473 | 478 | } else { |
  | 474 | 479 |  |
  | 475 | 480 | $namePDF = $namePDF; |
  | 476 | 481 |  |
  | 477 | 482 | } |
  | 478 | 483 |  |
  | 479 | 484 | return $namePDF; |
  | 480 | 485 |  |
  | 481 | 486 | } |
  | 482 | 487 |  |
  | 483 | 488 | function uniqidReal($lenght = 13) { |
  | 484 | 489 | // uniqid gives 13 chars, but you could adjust it to your needs. |
  | 485 | 490 | if (function\_exists("random\_bytes")) { |
  | 486 | 491 | $bytes = random\_bytes(ceil($lenght / 2)); |
  | 487 | 492 | } elseif (function\_exists("openssl\_random\_pseudo\_bytes")) { |
  | 488 | 493 | $bytes = openssl\_random\_pseudo\_bytes(ceil($lenght / 2)); |
  | 489 | 494 | } else { |
  | 490 | 495 | $bytes = uniqid(); |
  | 491 | 496 | } |
  | 492 | 497 | return substr(bin2hex($bytes), 0, $lenght); |
  | 493 | 498 | } |
  | 494 | 499 |  |
  | 495 | 500 | function wpcf7pdf\_form\_hidden\_fields($fields) { |
  | 496 | 501 |  |
  | 497 | 502 | $current\_form = wpcf7\_get\_current\_contact\_form(); |
  | 498 | 503 | $current\_form\_id = $current\_form->id(); |
  | 499 | 504 |  |
  | 500 | 505 | $nonce = wp\_create\_nonce('cf7-redirect-id'); |
  | 501 | 506 | $fields['redirect\_nonce'] = $nonce; |
  | 502 | 507 | $fields['wpcf7cfpdf\_hidden\_name'] = self::wpcf7pdf\_name\_pdf($current\_form\_id); |
  | 503 | 508 | $fields['wpcf7cfpdf\_hidden\_reference'] = self::uniqidReal(8); |
  | 504 | 509 |  |
  | 505 | 510 | $meta\_values = get\_post\_meta( $current\_form\_id, '\_wp\_cf7pdf', true ); |
  | 506 | 511 |  |
  | 507 | 512 | if(isset($meta\_values["date-for-name"]) && !empty($meta\_values["date-for-name"])) { |
  | 508 | 513 | $dateForName = date\_i18n($meta\_values["date-for-name"]); |
  | 509 | 514 | } else { |
  | 510 | 515 | $dateForName = date\_i18n('mdY', current\_time('timestamp')); |
  | 511 | 516 | } |
  | 512 | 517 | $fields['wpcf7cfpdf\_hidden\_date'] = $dateForName; |
  | 513 | 518 |  |
  | 514 | 519 | return $fields; |
  | 515 | 520 |  |
  | 516 | 521 | } |
  | 517 | 522 |  |
  | 518 | 523 | static function wpcf7pdf\_folder\_uploads($id) { |
  | 519 | 524 |  |
  | 520 | 525 | global $post; |
  | 521 | 526 |  |
  | 522 | 527 | if( empty($id) ) { die('No ID Form'); } |
  | 523 | 528 | $meta\_values = get\_post\_meta( $id, '\_wp\_cf7pdf', true ); |
  | 524 | 529 |  |
  | 525 | 530 | $upload\_dir = wp\_upload\_dir(); |
  | 526 | 531 |  |
  | 527 | 532 | // Si on a déjà défini |
  | 528 | 533 | if ( defined( 'WPCF7\_UPLOADS\_TMP\_DIR' ) ) { |
  | 529 | 534 |  |
  | 530 | 535 | add\_option('wpcf7pdf\_path\_temp', sanitize\_url(WPCF7\_UPLOADS\_TMP\_DIR)); |
  | 531 | 536 |  |
  | 532 | 537 | } else { |
  | 533 | 538 |  |
  | 534 | 539 | $tmpDirectory = $upload\_dir['basedir'].'/sendpdfcf7\_uploads/tmp'; |
  | 535 | 540 | if( is\_dir($tmpDirectory) == false ) { |
  | 536 | 541 | $files = array( |
  | 537 | 542 | array( |
  | 538 | 543 | 'base'      => $upload\_dir['basedir'] . '/sendpdfcf7\_uploads/', |
  | 539 | 544 | 'file'      => 'index.php', |
  | 540 | 545 | 'content'   => '<?php // Silence is Golden' |
  | 541 | 546 | ), |
  | 542 | 547 | array( |
  | 543 | 548 | 'base'      => $upload\_dir['basedir'] . '/sendpdfcf7\_uploads/tmp', |
  | 544 | 549 | 'file'      => 'index.php', |
  | 545 | 550 | 'content'   => '<?php // Silence is Golden' |
  | 546 | 551 | ) |
  | 547 | 552 | ); |
  | 548 | 553 |  |
  | 549 | 554 | foreach ( $files as $file ) { |
  | 550 | 555 | if ( wp\_mkdir\_p( $file['base'] ) && ! file\_exists( trailingslashit( $file['base'] ) . $file['file'] ) ) { |
  | 551 | 556 | if ( $file\_handle = @fopen( trailingslashit( $file['base'] ) . $file['file'], 'w' ) ) { |
  | 552 | 557 | fwrite( $file\_handle, $file['content'] ); |
  | 553 | 558 | fclose( $file\_handle ); |
  | 554 | 559 | } |
  | 555 | 560 | } |
  | 556 | 561 | } |
  | 557 | 562 |  |
  | 558 | 563 | add\_option('wpcf7pdf\_path\_temp', sanitize\_url($upload\_dir['basedir'] . '/sendpdfcf7\_uploads/tmp')); |
  | 559 | 564 | } else if( empty(get\_option('wpcf7pdf\_path\_temp')) ) { |
  | 560 | 565 | add\_option('wpcf7pdf\_path\_temp', sanitize\_url($upload\_dir['basedir'] . '/sendpdfcf7\_uploads/tmp')); |
  | 561 | 566 | } |
  | 562 | 567 |  |
  | 563 | 568 | } |
  | 564 | 569 |  |
  | 565 | 570 | if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='true' ) { |
  | 566 | 571 |  |
  | 567 | 572 | $newDirectory = $upload\_dir['basedir'].'/sendpdfcf7\_uploads'; |
  | 568 | 573 | if( is\_dir($newDirectory) == false ) { |
  | 569 | 574 | //mkdir($newDirectory, 0755); |
  | 570 | 575 | $files = array( |
  | 571 | 576 | array( |
  | 572 | 577 | 'base'      => $upload\_dir['basedir'] . '/sendpdfcf7\_uploads/'.$id, |
  | 573 | 578 | 'file'      => 'index.php', |
  | 574 | 579 | 'content'   => '<?php // Silence is Golden' |
  | 575 | 580 | ) |
  | 576 | 581 | ); |
  | 577 | 582 |  |
  | 578 | 583 | foreach ( $files as $file ) { |
  | 579 | 584 | if ( wp\_mkdir\_p( $file['base'] ) && ! file\_exists( trailingslashit( $file['base'] ) . $file['file'] ) ) { |
  | 580 | 585 | if ( $file\_handle = @fopen( trailingslashit( $file['base'] ) . $file['file'], 'w' ) ) { |
  | 581 | 586 | fwrite( $file\_handle, $file['content'] ); |
  | 582 | 587 | fclose( $file\_handle ); |
  | 583 | 588 | } |
  | 584 | 589 | } |
  | 585 | 590 | } |
  | 586 | 591 | } |
  | 587 | 592 |  |
  | 588 | 593 | $subDirectory = $upload\_dir['basedir'].'/sendpdfcf7\_uploads/'.$id; |
  | 589 | 594 | if ( is\_dir($subDirectory) == false ) { |
  | 590 | 595 | $files = array( |
  | 591 | 596 | array( |
  | 592 | 597 | 'base'      => $subDirectory, |
  | 593 | 598 | 'file'      => 'index.php', |
  | 594 | 599 | 'content'   => '<?php // Silence is Golden' |
  | 595 | 600 | ) |
  | 596 | 601 | ); |
  | 597 | 602 |  |
  | 598 | 603 | foreach ( $files as $file ) { |
  | 599 | 604 | if ( wp\_mkdir\_p( $file['base'] ) && ! file\_exists( trailingslashit( $file['base'] ) . $file['file'] ) ) { |
  | 600 | 605 | if ( $file\_handle = @fopen( trailingslashit( $file['base'] ) . $file['file'], 'w' ) ) { |
  | 601 | 606 | fwrite( $file\_handle, $file['content'] ); |
  | 602 | 607 | fclose( $file\_handle ); |
  | 603 | 608 | } |
  | 604 | 609 | } |
  | 605 | 610 | } |
  | 606 | 611 |  |
  | 607 | 612 | } |
  | 608 | 613 | $createDirectory = $upload\_dir['basedir'].'/sendpdfcf7\_uploads/'.$id; |
  | 609 | 614 |  |
  | 610 | 615 |  |
  | 611 | 616 | } else { |
  | 612 | 617 | $createDirectory = $upload\_dir['basedir'].$upload\_dir['subdir']; |
  | 613 | 618 | } |
  | 614 | 619 |  |
  | 615 | 620 | // Je crée une image dans le dossier des uploads PDF. onepixel.png remplace l'image si pas d'upload du client |
  | 616 | 621 | if( filter\_var( ini\_get('allow\_url\_fopen'), FILTER\_VALIDATE\_BOOLEAN ) && file\_exists($createDirectory.'/onepixel.png')===FALSE) { |
  | 617 | 622 | copy(WPCF7PDF\_URL.'images/onepixel.png', $createDirectory . '/onepixel.png'); |
  | 618 | 623 | } |
  | 619 | 624 | return $createDirectory; |
  | 620 | 625 |  |
  | 621 | 626 | } |
  | 622 | 627 |  |
  | 623 | 628 | static function wpcf7pdf\_attachments( $tag = null ) { |
  | 624 | 629 |  |
  | 625 | 630 | if ( ! $tag ) { |
  | 626 | 631 | $tag = $this->get( 'attachments' ); |
  | 627 | 632 | } |
  | 628 | 633 |  |
  | 629 | 634 | $attachments = array(); |
  | 630 | 635 |  |
  | 631 | 636 | if ( $submission = WPCF7\_Submission::get\_instance() ) { |
  | 632 | 637 | $uploaded\_files = $submission->uploaded\_files(); |
  | 633 | 638 |  |
  | 634 | 639 | foreach ( (array) $uploaded\_files as $name => $paths ) { |
  | 635 | 640 | if ( false !== strpos( $tag, "[{$name}]" ) ) { |
  | 636 | 641 | $attachments = array\_merge( $attachments, (array) $paths ); |
  | 637 | 642 | } |
  | 638 | 643 | } |
  | 639 | 644 | } |
  | 640 | 645 |  |
  | 641 | 646 | foreach ( explode( "\n", $tag ) as $line ) { |
  | 642 | 647 | $line = trim( $line ); |
  | 643 | 648 |  |
  | 644 | 649 | if ( '[' == substr( $line, 0, 1 ) ) { |
  | 645 | 650 | continue; |
  | 646 | 651 | } |
  | 647 | 652 |  |
  | 648 | 653 | $path = path\_join( WP\_CONTENT\_DIR, $line ); |
  | 649 | 654 |  |
  | 650 | 655 | if ( ! wpcf7\_is\_file\_path\_in\_content\_dir( $path ) ) { |
  | 651 | 656 | // $path is out of WP\_CONTENT\_DIR |
  | 652 | 657 | continue; |
  | 653 | 658 | } |
  | 654 | 659 |  |
  | 655 | 660 | if ( is\_readable( $path ) && is\_file( $path ) ) { |
  | 656 | 661 | $attachments[] = $path; |
  | 657 | 662 | } |
  | 658 | 663 | } |
  | 659 | 664 |  |
  | 660 | 665 | if( isset($attachments[0]) ) { |
  | 661 | 666 | return $attachments[0]; |
  | 662 | 667 | } |
  | 663 | 668 | } |
  | 664 | 669 |  |
  | 665 | 670 | function \_mirrorImage ( $imgsrc) { |
  | 666 | 671 |  |
  | 667 | 672 | $width = imagesx ( $imgsrc ); |
  | 668 | 673 | $height = imagesy ( $imgsrc ); |
  | 669 | 674 |  |
  | 670 | 675 | $src\_x = $width -1; |
  | 671 | 676 | $src\_y = 0; |
  | 672 | 677 | $src\_width = -$width; |
  | 673 | 678 | $src\_height = $height; |
  | 674 | 679 |  |
  | 675 | 680 | $imgdest = imagecreatetruecolor ( $width, $height ); |
  | 676 | 681 |  |
  | 677 | 682 | if ( imagecopyresampled ( $imgdest, $imgsrc, 0, 0, $src\_x, $src\_y, $width, $height, $src\_width, $src\_height ) ) |
  | 678 | 683 | { |
  | 679 | 684 | return $imgdest; |
  | 680 | 685 | } |
  | 681 | 686 |  |
  | 682 | 687 | return $imgsrc; |
  | 683 | 688 | } |
  | 684 | 689 |  |
  | 685 | 690 | function wpcf7pdf\_send\_pdf($contact\_form) { |
  | 686 | 691 |  |
  | 687 | 692 | $submission = WPCF7\_Submission::get\_instance(); |
  | 688 | 693 |  |
  | 689 | 694 | if($submission) { |
  | 690 | 695 |  |
  | 691 | 696 | // get submission data |
  | 692 | 697 | $posted\_data = $submission->get\_posted\_data(); |
  | 693 | 698 |  |
  | 694 | 699 | // nothing's here... do nothing... |
  | 695 | 700 | if (empty($posted\_data)) |
  | 696 | 701 | return; |
  | 697 | 702 |  |
  | 698 | 703 | global $post; |
  | 699 | 704 |  |
  | 700 | 705 | //make sure the nonce is available too, |
  | 701 | 706 | if( !isset($\_POST['redirect\_nonce']) ) return; // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 702 | 707 |  |
  | 703 | 708 | // récupère le POST |
  | 704 | 709 | $post = $\_POST; // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 705 | 710 |  |
  | 706 | 711 | $upload\_dir = wp\_upload\_dir(); |
  | 707 | 712 | $uploaded\_files = $submission->uploaded\_files(); // this allows you access to the upload file in the temp location |
  | 708 | 713 |  |
  | 709 | 714 | $meta\_values = get\_post\_meta(esc\_html($post['\_wpcf7']), '\_wp\_cf7pdf', true); |
  | 710 | 715 |  |
  | 711 | 716 | // On récupère le dossier upload de WP |
  | 712 | 717 | $createDirectory = $this->wpcf7pdf\_folder\_uploads(esc\_html($post['\_wpcf7'])); |
  | 713 | 718 |  |
  | 714 | 719 | // On supprime le password en session |
  | 715 | 720 | if(null!==get\_transient('pdf\_password')) { |
  | 716 | 721 | delete\_transient('pdf\_password'); |
  | 717 | 722 | } |
  | 718 | 723 |  |
  | 719 | 724 | // Récupère la référence |
  | 720 | 725 | $referencePDF = esc\_html($post['wpcf7cfpdf\_hidden\_reference']); |
  | 721 | 726 | // Genere le nom du PDF |
  | 722 | 727 | $nameOfPdf = $this->wpcf7pdf\_name\_pdf(esc\_html($post['\_wpcf7']), esc\_html($referencePDF)); |
  | 723 | 728 |  |
  | 724 | 729 | $nbPassword = 12; |
  | 725 | 730 | if(isset($meta\_values["protect\_password\_nb"]) && $meta\_values["protect\_password\_nb"]!='' && is\_numeric($meta\_values["protect\_password\_nb"])) { |
  | 726 | 731 | $nbPassword = esc\_html($meta\_values["protect\_password\_nb"]); |
  | 727 | 732 | } |
  | 728 | 733 | set\_transient('pdf\_password', $this->wpcf7pdf\_generateRandomPassword($nbPassword), HOUR\_IN\_SECONDS); |
  | 729 | 734 |  |
  | 730 | 735 | // Si on a personnalisé le PDF, on recupère le contenu et on remplace les tags |
  | 731 | 736 | if( isset($meta\_values['generate\_pdf']) && !empty($meta\_values['generate\_pdf']) ) { |
  | 732 | 737 |  |
  | 733 | 738 | // définit le contenu du PDf |
  | 734 | 739 | $contentPdf = wp\_kses(trim($meta\_values['generate\_pdf']), WPCF7PDF\_prepare::wpcf7pdf\_autorizeHtml()); |
  | 735 | 740 | $contentPdf = apply\_filters( 'pl\_filter\_content', $contentPdf, $posted\_data ); |
  | 736 | 741 |  |
  | 737 | 742 | // Compatibilité avec CF7 Conditional Fields / Conditional Fields PRO |
  | 738 | 743 | if( class\_exists('Wpcf7cfMailParser') ){ |
  | 739 | 744 |  |
  | 740 | 745 | $hidden\_groups = json\_decode(stripslashes($\_POST['\_wpcf7cf\_hidden\_groups'])); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 741 | 746 | $visible\_groups = json\_decode(stripslashes($\_POST['\_wpcf7cf\_visible\_groups'])); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 742 | 747 | $repeaters = json\_decode(stripslashes($\_POST['\_wpcf7cf\_repeaters'])); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 743 | 748 | //$steps = json\_decode(stripslashes($\_POST['\_wpcf7cf\_steps'])); |
  | 744 | 749 |  |
  | 745 | 750 | $parser = new Wpcf7cfMailParser($contentPdf, $visible\_groups, $hidden\_groups, $repeaters, $\_POST); // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 746 | 751 | $contentPdf = $parser->getParsedMail(); |
  | 747 | 752 | } |
  | 748 | 753 |  |
  | 749 | 754 | // Je vais chercher le tableau des tags |
  | 750 | 755 | $csvTab = self::wpf7pdf\_tagsparser($post['\_wpcf7'], $referencePDF); |
  | 751 | 756 | // On insère dans la BDD |
  | 752 | 757 | if( isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"] == "false" ) { |
  | 753 | 758 | $insertPost = $this->save($post['\_wpcf7'], serialize($csvTab), $referencePDF, esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory ).'/'.$nameOfPdf.'-'.$referencePDF.'.pdf')); |
  | 754 | 759 | $contentPdf = str\_replace('[ID]', $insertPost, $contentPdf); |
  | 755 | 760 | } |
  | 756 | 761 |  |
  | 757 | 762 | // On génère le PDF |
  | 758 | 763 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false') { |
  | 759 | 764 |  |
  | 760 | 765 | $contentPdf = WPCF7PDF\_prepare::tags\_parser($post['\_wpcf7'], $nameOfPdf, $referencePDF, $contentPdf); |
  | 761 | 766 | // Si il existe des Shortcodes? |
  | 762 | 767 | $contentPdf = WPCF7PDF\_prepare::shortcodes($meta\_values['shotcodes\_tags'], $contentPdf); |
  | 763 | 768 | // On genere le PDF |
  | 764 | 769 | $generatePdfFile = WPCF7PDF\_generate::wpcf7pdf\_create\_pdf($post['\_wpcf7'], $contentPdf, $nameOfPdf, $referencePDF, $createDirectory); |
  | 765 | 770 |  |
  | 766 | 771 | } |
  | 767 | 772 | // END GENERATE PDF |
  | 768 | 773 | } |
  | 769 | 774 |  |
  | 770 | 775 | // If CSV is enable |
  | 771 | 776 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false') { |
  | 772 | 777 | $generateCsvFile = WPCF7PDF\_generate::wpcf7pdf\_create\_csv($post['\_wpcf7'], $nameOfPdf, $referencePDF, $createDirectory); |
  | 773 | 778 | } |
  | 774 | 779 |  |
  | 775 | 780 | } |
  | 776 | 781 | } |
  | 777 | 782 |  |
  | 778 | 783 | function wpcf7pdf\_mail\_components($components, $contact\_form, $mail) { |
  | 779 | 784 |  |
  | 780 | 785 | // see : http://plugin144.rssing.com/chan-8774780/all\_p511.html |
  | 781 | 786 | $submission = WPCF7\_Submission::get\_instance(); |
  | 782 | 787 | if( $submission ) { |
  | 783 | 788 |  |
  | 784 | 789 | //$posted\_data = $submission->get\_posted\_data(); |
  | 785 | 790 |  |
  | 786 | 791 | global $post; |
  | 787 | 792 |  |
  | 788 | 793 | //make sure the nonce is available too, |
  | 789 | 794 | if( !isset($\_POST['redirect\_nonce']) ) return; // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 790 | 795 |  |
  | 791 | 796 | // On récupère le dossier upload de WP (utile pour les autres pièces jointes) |
  | 792 | 797 | $upload\_dir = wp\_upload\_dir(); |
  | 793 | 798 | // On récupère le dossier upload de l'extension (/sendpdfcf7\_uploads/) |
  | 794 | 799 | $createDirectory = $this->wpcf7pdf\_folder\_uploads(esc\_html($post['\_wpcf7'])); |
  | 795 | 800 | //$uploaded\_files = $submission->uploaded\_files(); |
  | 796 | 801 |  |
  | 797 | 802 | // On recupere les donnees et le nom du pdf personnalisé |
  | 798 | 803 | $meta\_values = get\_post\_meta(esc\_html($post['\_wpcf7']), '\_wp\_cf7pdf', true); |
  | 799 | 804 | // Récupère la référence |
  | 800 | 805 | $referencePDF = esc\_html($post['wpcf7cfpdf\_hidden\_reference']); |
  | 801 | 806 | // Genere le nom du PDF |
  | 802 | 807 | $nameOfPdf = $this->wpcf7pdf\_name\_pdf(esc\_html($post['\_wpcf7']), esc\_html($referencePDF)); |
  | 803 | 808 | // PDF generé et envoyé |
  | 804 | 809 | $disablePDF = 0; |
  | 805 | 810 |  |
  | 806 | 811 | // On récupère les tags du formulaire |
  | 807 | 812 | $contact\_form = WPCF7\_ContactForm::get\_instance(esc\_html($post['\_wpcf7'])); |
  | 808 | 813 | $contact\_tag = $contact\_form->scan\_form\_tags(); |
  | 809 | 814 |  |
  | 810 | 815 | // Je déclare le contenu de l'email |
  | 811 | 816 | $messageText = $components['body']; |
  | 812 | 817 |  |
  | 813 | 818 | // Si la fonction envoi mail est activée |
  | 814 | 819 | if( empty($meta\_values['disable-attachments']) OR (isset($meta\_values['disable-attachments']) && $meta\_values['disable-attachments'] == 'false') && $disablePDF==0 ) { |
  | 815 | 820 |  |
  | 816 | 821 | // On envoi les mails |
  | 817 | 822 | if ( 'mail' == $mail->name() ) { |
  | 818 | 823 | // do something for 'Mail' |
  | 819 | 824 |  |
  | 820 | 825 | // Send just zip |
  | 821 | 826 | if( isset($meta\_values["pdf-to-zip"]) && $meta\_values["pdf-to-zip"] == 'true' ) { |
  | 822 | 827 |  |
  | 823 | 828 | // Création du zip |
  | 824 | 829 | $zip = new ZipArchive(); |
  | 825 | 830 | if($zip->open($createDirectory.'/'.$nameOfPdf.'-'.sanitize\_text\_field($referencePDF).'.zip', ZipArchive::CREATE) === true) { |
  | 826 | 831 | // Ajout des fichiers. |
  | 827 | 832 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false' ) { |
  | 828 | 833 | if( isset($meta\_values["send-attachment"]) && ($meta\_values["send-attachment"] == 'sender' OR $meta\_values["send-attachment"] == 'both') ) { |
  | 829 | 834 | $zip->addFile($createDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.pdf', $nameOfPdf.'-'.$referencePDF.'.pdf'); |
  | 830 | 835 | } |
  | 831 | 836 | } |
  | 832 | 837 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false' ) { |
  | 833 | 838 | if( isset($meta\_values["send-attachment2"]) && ($meta\_values["send-attachment2"] == 'sender' OR $meta\_values["send-attachment2"] == 'both') ) { |
  | 834 | 839 | $zip->addFile($createDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.csv', $nameOfPdf.'-'.$referencePDF.'.csv'); |
  | 835 | 840 | } |
  | 836 | 841 | } |
  | 837 | 842 | if( isset($meta\_values["send-attachment3"]) && ($meta\_values["send-attachment3"] == 'sender' OR $meta\_values["send-attachment3"] == 'both') ) { |
  | 838 | 843 |  |
  | 839 | 844 | $tabDocs = explode("\n", $meta\_values["pdf-files-attachments"]); |
  | 840 | 845 | $tabDocs = array\_map('trim',$tabDocs);// Enlève les espaces vides |
  | 841 | 846 | $tabDocs = array\_filter($tabDocs);// Supprime les éléments vides (= lignes vides) non |
  | 842 | 847 |  |
  | 843 | 848 | $nbDocs = count($tabDocs); |
  | 844 | 849 |  |
  | 845 | 850 | if( $nbDocs >= 1) { |
  | 846 | 851 | foreach($tabDocs as $urlDocs) { |
  | 847 | 852 | $urlDocs = str\_replace($upload\_dir['baseurl'], $upload\_dir['basedir'], $urlDocs); |
  | 848 | 853 | $nameFile = basename($urlDocs); |
  | 849 | 854 | $zip->addFile($urlDocs, $nameFile); |
  | 850 | 855 | } |
  | 851 | 856 | } |
  | 852 | 857 | } |
  | 853 | 858 | $zip->close(); |
  | 854 | 859 | } |
  | 855 | 860 |  |
  | 856 | 861 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'-'.sanitize\_text\_field($referencePDF).'.zip'; |
  | 857 | 862 |  |
  | 858 | 863 | } else { |
  | 859 | 864 |  |
  | 860 | 865 | // Send PDF |
  | 861 | 866 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false' ) { |
  | 862 | 867 | if( isset($meta\_values["send-attachment"]) && ($meta\_values["send-attachment"] == 'sender' OR $meta\_values["send-attachment"] == 'both') ) { |
  | 863 | 868 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'.pdf'; |
  | 864 | 869 | } |
  | 865 | 870 | } |
  | 866 | 871 |  |
  | 867 | 872 | // SEND CSV |
  | 868 | 873 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false' ) { |
  | 869 | 874 | if( isset($meta\_values["send-attachment2"]) && ($meta\_values["send-attachment2"] == 'sender' OR $meta\_values["send-attachment2"] == 'both') ) { |
  | 870 | 875 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'.csv'; |
  | 871 | 876 | } |
  | 872 | 877 | } |
  | 873 | 878 |  |
  | 874 | 879 | //SEND OTHER |
  | 875 | 880 | if( isset($meta\_values["pdf-files-attachments"]) ) { |
  | 876 | 881 | if( isset($meta\_values["send-attachment3"]) && ($meta\_values["send-attachment3"] == 'sender' OR $meta\_values["send-attachment3"] == 'both') ) { |
  | 877 | 882 |  |
  | 878 | 883 | $tabDocs = explode("\n", $meta\_values["pdf-files-attachments"]); |
  | 879 | 884 | $tabDocs = array\_map('trim',$tabDocs);// Enlève les espaces vides |
  | 880 | 885 | $tabDocs = array\_filter($tabDocs);// Supprime les éléments vides (= lignes vides) non |
  | 881 | 886 |  |
  | 882 | 887 | $nbDocs = count($tabDocs); |
  | 883 | 888 |  |
  | 884 | 889 | if( $nbDocs >= 1) { |
  | 885 | 890 | foreach($tabDocs as $urlDocs) { |
  | 886 | 891 | $urlDocs = str\_replace($upload\_dir['baseurl'], $upload\_dir['basedir'], $urlDocs); |
  | 887 | 892 | $components['attachments'][] = $urlDocs; |
  | 888 | 893 | } |
  | 889 | 894 | } |
  | 890 | 895 | } |
  | 891 | 896 | } |
  | 892 | 897 | } |
  | 893 | 898 |  |
  | 894 | 899 | } |
  | 895 | 900 | if ( 'mail\_2' == $mail->name() ) { |
  | 896 | 901 |  |
  | 897 | 902 | // do something for 'Mail (2)' |
  | 898 | 903 | if( isset($meta\_values["pdf-to-zip"]) && $meta\_values["pdf-to-zip"] == 'true' ) { |
  | 899 | 904 |  |
  | 900 | 905 | // Création du zip |
  | 901 | 906 | $zip = new ZipArchive(); |
  | 902 | 907 | if($zip->open($createDirectory.'/'.$nameOfPdf.'-2'.sanitize\_text\_field($referencePDF).'.zip', ZipArchive::CREATE) === true) { |
  | 903 | 908 |  |
  | 904 | 909 | // Ajout des fichiers. |
  | 905 | 910 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false' ) { |
  | 906 | 911 | if( isset($meta\_values["send-attachment"]) && ($meta\_values["send-attachment"] == 'recipient' OR $meta\_values["send-attachment"] == 'both') ) { |
  | 907 | 912 | $zip->addFile($createDirectory.'/'.$nameOfPdf.'.pdf', $nameOfPdf.'.pdf'); |
  | 908 | 913 | } |
  | 909 | 914 | } |
  | 910 | 915 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false' ) { |
  | 911 | 916 | if( isset($meta\_values["send-attachment2"]) && ($meta\_values["send-attachment2"] == 'recipient' OR $meta\_values["send-attachment2"] == 'both') ) { |
  | 912 | 917 | $zip->addFile($createDirectory.'/'.$nameOfPdf.'.csv', $nameOfPdf.'.csv'); |
  | 913 | 918 | } |
  | 914 | 919 | } |
  | 915 | 920 | if( isset($meta\_values["send-attachment3"]) && ($meta\_values["send-attachment3"] == 'recipient' OR $meta\_values["send-attachment3"] == 'both') ) { |
  | 916 | 921 |  |
  | 917 | 922 | $tabDocs = explode("\n", $meta\_values["pdf-files-attachments"]); |
  | 918 | 923 | $tabDocs = array\_map('trim',$tabDocs);// Enlève les espaces vides |
  | 919 | 924 | $tabDocs = array\_filter($tabDocs);// Supprime les éléments vides (= lignes vides) non |
  | 920 | 925 |  |
  | 921 | 926 | $nbDocs = count($tabDocs); |
  | 922 | 927 |  |
  | 923 | 928 | if( $nbDocs >= 1) { |
  | 924 | 929 | foreach($tabDocs as $urlDocs) { |
  | 925 | 930 | $urlDocs = str\_replace($upload\_dir['baseurl'], $upload\_dir['basedir'], $urlDocs); |
  | 926 | 931 | $nameFile = basename($urlDocs); |
  | 927 | 932 | $zip->addFile($urlDocs, $nameFile); |
  | 928 | 933 | } |
  | 929 | 934 | } |
  | 930 | 935 | } |
  | 931 | 936 | $zip->close(); |
  | 932 | 937 | } |
  | 933 | 938 |  |
  | 934 | 939 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'-'.sanitize\_text\_field($referencePDF).'.zip'; |
  | 935 | 940 |  |
  | 936 | 941 | } else { |
  | 937 | 942 |  |
  | 938 | 943 | // Send PDF |
  | 939 | 944 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false' ) { |
  | 940 | 945 | if( isset($meta\_values["send-attachment"]) && ($meta\_values["send-attachment"] == 'recipient' OR $meta\_values["send-attachment"] == 'both') ) { |
  | 941 | 946 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'.pdf'; |
  | 942 | 947 | } |
  | 943 | 948 | } |
  | 944 | 949 |  |
  | 945 | 950 | // SEND CSV |
  | 946 | 951 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false' ) { |
  | 947 | 952 | if( isset($meta\_values["send-attachment2"]) && ($meta\_values["send-attachment2"] == 'recipient' OR $meta\_values["send-attachment2"] == 'both') ) { |
  | 948 | 953 | $components['attachments'][] = $createDirectory.'/'.$nameOfPdf.'.csv'; |
  | 949 | 954 | } |
  | 950 | 955 | } |
  | 951 | 956 |  |
  | 952 | 957 | //SEND OTHER |
  | 953 | 958 | if( isset($meta\_values["pdf-files-attachments"]) ) { |
  | 954 | 959 | if( isset($meta\_values["send-attachment3"]) && ($meta\_values["send-attachment3"] == 'recipient' OR $meta\_values["send-attachment3"] == 'both') ) { |
  | 955 | 960 |  |
  | 956 | 961 | $tabDocs2 = explode("\n", $meta\_values["pdf-files-attachments"]); |
  | 957 | 962 | $tabDocs2 = array\_map('trim',$tabDocs2);// Enlève les espaces vides |
  | 958 | 963 | $tabDocs2 = array\_filter($tabDocs2);// Supprime les éléments vides (= lignes vides) non |
  | 959 | 964 |  |
  | 960 | 965 | $nbDocs2 = count($tabDocs2); |
  | 961 | 966 | if( $nbDocs2 >= 1) { |
  | 962 | 967 | foreach($tabDocs2 as $urlDocs2) { |
  | 963 | 968 | $urlDocs2 = str\_replace($upload\_dir['baseurl'], $upload\_dir['basedir'], $urlDocs2); |
  | 964 | 969 | $components['attachments'][] = $urlDocs2; |
  | 965 | 970 | } |
  | 966 | 971 | } |
  | 967 | 972 |  |
  | 968 | 973 | } |
  | 969 | 974 | } |
  | 970 | 975 | } |
  | 971 | 976 |  |
  | 972 | 977 | } |
  | 973 | 978 | } // Fin si la fonction envoi mail est activée |
  | 974 | 979 |  |
  | 975 | 980 | // Option for Protect PDF by Password |
  | 976 | 981 | $pdfPassword = ''; |
  | 977 | 982 | if ( isset($meta\_values["protect"]) && $meta\_values["protect"]=='true') { |
  | 978 | 983 | $pdfPassword = WPCF7PDF\_prepare::protect\_pdf($post['\_wpcf7']); |
  | 979 | 984 | } |
  | 980 | 985 |  |
  | 981 | 986 | // Si le contenu du PDF doit rester en brut et pas en HTML |
  | 982 |  | if( isset($meta\_values["disable-html"]) && $meta\_values['disable-html'] == 'false' ) { |
  |  | 987 | /\*if( isset($meta\_values["disable-html"]) && $meta\_values['disable-html'] == 'false' ) { |
  | 983 | 988 | $messageText = str\_replace("\r\n", "<br />", $messageText); |
  | 984 |  | } |
  |  | 989 | }\*/ |
  | 985 | 990 |  |
  | 986 | 991 | // Definition des dates par defaut |
  | 987 | 992 | $dateField = WPCF7PDF\_prepare::returndate($post['\_wpcf7']); |
  | 988 | 993 | $timeField = WPCF7PDF\_prepare::returntime($post['\_wpcf7']); |
  | 989 | 994 |  |
  | 990 | 995 | // Je remplace les codes courts dans le text |
  | 991 | 996 | if( isset($messageText) && !empty($messageText) ) { |
  | 992 | 997 |  |
  | 993 | 998 | if( isset($pdfPassword) && $pdfPassword!='' ) { |
  | 994 | 999 | $messageText = str\_replace('[pdf-password]', $pdfPassword, $messageText); |
  | 995 | 1000 | } else { |
  | 996 | 1001 | $messageText = str\_replace('[pdf-password]', \_\_('\*\*\* NO PASSWORD \*\*\*', 'send-pdf-for-contact-form-7'), $messageText); |
  | 997 | 1002 | } |
  | 998 | 1003 | $messageText = WPCF7PDF\_prepare::tags\_parser($post['\_wpcf7'], $nameOfPdf, $referencePDF, $messageText, 1); |
  | 999 | 1004 |  |
  | 1000 | 1005 | // Shortcodes? |
  | 1001 | 1006 | if( isset($meta\_values['shotcodes\_tags']) && !empty($meta\_values['shotcodes\_tags'])) { |
  | 1002 | 1007 | $messageText = WPCF7PDF\_prepare::shortcodes($meta\_values['shotcodes\_tags'], $messageText); |
  | 1003 | 1008 | } |
  | 1004 | 1009 |  |
  | 1005 | 1010 | $components['body'] = $messageText; |
  | 1006 | 1011 | } |
  | 1007 | 1012 |  |
  | 1008 | 1013 | // Je remplace les codes courts dans le sujet |
  | 1009 | 1014 | $subjectText = $components['subject']; |
  | 1010 | 1015 | if( isset($messageText) && !empty($messageText) ) { |
  | 1011 | 1016 |  |
  | 1012 | 1017 | $subjectText = str\_replace('[reference]', sanitize\_text\_field($referencePDF), $subjectText); |
  | 1013 | 1018 | if( isset($pdfPassword) && $pdfPassword!='' ) { |
  | 1014 | 1019 | $subjectText = str\_replace('[pdf-password]', $pdfPassword, $subjectText); |
  | 1015 | 1020 | } |
  | 1016 | 1021 | $subjectText = str\_replace('[date]', $dateField, $subjectText); |
  | 1017 | 1022 | $subjectText = str\_replace('[time]', $timeField, $subjectText); |
  | 1018 | 1023 |  |
  | 1019 | 1024 | $components['subject'] = $subjectText; |
  | 1020 | 1025 | } |
  | 1021 | 1026 |  |
  | 1022 | 1027 | return $components; |
  | 1023 | 1028 |  |
  | 1024 | 1029 | } |
  | 1025 | 1030 | } |
  | 1026 | 1031 |  |
  | 1027 | 1032 | /\* Run code after the email has been sent \*/ |
  | 1028 | 1033 | function wpcf7pdf\_after\_mail\_actions($wpcf7) { |
  | 1029 | 1034 |  |
  | 1030 | 1035 | $submission = WPCF7\_Submission::get\_instance(); |
  | 1031 | 1036 |  |
  | 1032 | 1037 | if ($submission) { |
  | 1033 | 1038 |  |
  | 1034 | 1039 | global $post; |
  | 1035 | 1040 |  |
  | 1036 | 1041 | // récupère le POST |
  | 1037 | 1042 | $post = $\_POST; // phpcs:ignore WordPress.Security.NonceVerification.Missing |
  | 1038 | 1043 | // Récupère la référence |
  | 1039 | 1044 | $referencePDF = esc\_html($post['wpcf7cfpdf\_hidden\_reference']); |
  | 1040 | 1045 | // Genere le nom du PDF |
  | 1041 | 1046 | $nameOfPdf = $this->wpcf7pdf\_name\_pdf(esc\_html($post['\_wpcf7']), $referencePDF); |
  | 1042 | 1047 | // On récupère le dossier upload de l'extension (/sendpdfcf7\_uploads/) |
  | 1043 | 1048 | $upload\_dir = wp\_upload\_dir(); |
  | 1044 | 1049 | $createDirectory = $this->wpcf7pdf\_folder\_uploads(esc\_html($post['\_wpcf7'])); |
  | 1045 | 1050 | $createPathDirectory = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory); |
  | 1046 | 1051 | // On recupere les donnees et le nom du pdf personnalisé |
  | 1047 | 1052 | $meta\_values = get\_post\_meta(esc\_html($post['\_wpcf7']), '\_wp\_cf7pdf', true ); |
  | 1048 | 1053 |  |
  | 1049 | 1054 | // Si l'option de supprimer les fichiers est activée |
  | 1050 | 1055 | if( isset($meta\_values["pdf-file-delete"]) && $meta\_values["pdf-file-delete"]=="true") { |
  | 1051 | 1056 |  |
  | 1052 | 1057 |  |
  | 1053 | 1058 | // Si fichier PDF activé, on les suprime disable-pdf |
  | 1054 | 1059 | if( isset($meta\_values["disable-pdf"]) && $meta\_values['disable-pdf'] == 'false') { |
  | 1055 | 1060 | if( file\_exists($createDirectory.'/'.$nameOfPdf.'.pdf') ) { |
  | 1056 | 1061 | wp\_delete\_file($createPathDirectory.'/'.$nameOfPdf.'.pdf'); |
  | 1057 | 1062 | } |
  | 1058 | 1063 | if( file\_exists($createDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.pdf') ) { |
  | 1059 | 1064 | wp\_delete\_file($createPathDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.pdf'); |
  | 1060 | 1065 | } |
  | 1061 | 1066 | } |
  | 1062 | 1067 |  |
  | 1063 | 1068 | // Si fichier CSV activé, on les suprime |
  | 1064 | 1069 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false') { |
  | 1065 | 1070 | if( file\_exists($createDirectory.'/'.$nameOfPdf.'.csv') ) { |
  | 1066 | 1071 | wp\_delete\_file($createPathDirectory.'/'.$nameOfPdf.'.csv'); |
  | 1067 | 1072 | } |
  | 1068 | 1073 | if( file\_exists($createDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.csv') ) { |
  | 1069 | 1074 | wp\_delete\_file($createPathDirectory.'/'.$nameOfPdf.'-'.$referencePDF.'.csv'); |
  | 1070 | 1075 | } |
  | 1071 | 1076 | } |
  | 1072 | 1077 |  |
  | 1073 | 1078 | // Si ZIP activé, on les suprime |
  | 1074 | 1079 | if( isset($meta\_values["pdf-to-zip"]) && $meta\_values['pdf-to-zip'] == 'true') { |
  | 1075 | 1080 | if( file\_exists($createDirectory.'/'.$nameOfPdf.'.zip') ) { |
  | 1076 | 1081 | wp\_delete\_file($createPathDirectory.'/'.$nameOfPdf.'.zip'); |
  | 1077 | 1082 | } |
  | 1078 | 1083 | } |
  | 1079 | 1084 |  |
  | 1080 | 1085 | } |
  | 1081 | 1086 |  |
  | 1082 | 1087 | delete\_transient('pdf\_password'); |
  | 1083 | 1088 |  |
  | 1084 | 1089 | } |
  | 1085 | 1090 |  |
  | 1086 | 1091 | } |
  | 1087 | 1092 |  |
  | 1088 | 1093 | /\* Récupère la liste des formulaires enregistrés \*/ |
  | 1089 | 1094 | function getForms() { |
  | 1090 | 1095 | global $wpdb; |
  | 1091 | 1096 |  |
  | 1092 | 1097 | $forms = get\_posts( array( |
  | 1093 | 1098 | 'post\_type'   => 'wpcf7\_contact\_form', |
  | 1094 | 1099 | 'orderby'     => 'ID', |
  | 1095 | 1100 | 'post\_parent' => 0, |
  | 1096 | 1101 | 'order'       => 'ASC', |
  | 1097 | 1102 | 'posts\_per\_page' => -1 |
  | 1098 | 1103 | ) ); |
  | 1099 | 1104 |  |
  | 1100 | 1105 | return $forms; |
  | 1101 | 1106 |  |
  | 1102 | 1107 | } |
  | 1103 | 1108 |  |
  | 1104 | 1109 |  |
  | 1105 | 1110 | public static function get\_byReference($ref) { |
  | 1106 | 1111 |  |
  | 1107 | 1112 | global $wpdb; |
  | 1108 | 1113 | if(!$ref or !$ref) { die('No reference!'); } |
  | 1109 | 1114 | $result = $wpdb->get\_row( $wpdb->prepare("SELECT wpcf7pdf\_id, wpcf7pdf\_id\_form, wpcf7pdf\_reference, wpcf7pdf\_files FROM ".$wpdb->prefix."wpcf7pdf\_files WHERE wpcf7pdf\_reference = %s LIMIT 1", $ref ), 'OBJECT' ); // phpcs:ignore WordPress.DB.DirectDatabaseQuery |
  | 1110 | 1115 | if($result) { |
  | 1111 | 1116 | return $result; |
  | 1112 | 1117 | } |
  | 1113 | 1118 | } |
  | 1114 | 1119 |  |
  | 1115 | 1120 | static function wpcf7pdf\_deactivation() { |
  | 1116 | 1121 |  |
  | 1117 | 1122 | if(get\_option('wpcf7pdf\_version')) { delete\_option('wpcf7pdf\_version'); } |
  | 1118 | 1123 | if(get\_option('wpcf7pdf\_path\_temp')) { delete\_option('wpcf7pdf\_path\_temp'); } |
  | 1119 | 1124 | } |
  | 1120 | 1125 |  |
  | 1121 | 1126 | static function wpcf7pdf\_uninstall() { |
  | 1122 | 1127 |  |
  | 1123 | 1128 | global $wpdb; |
  | 1124 | 1129 |  |
  | 1125 | 1130 | if(get\_option('wpcf7pdf\_version')) { delete\_option('wpcf7pdf\_version'); } |
  | 1126 | 1131 | if(get\_option('wpcf7pdf\_path\_temp')) { delete\_option('wpcf7pdf\_path\_temp'); } |
  | 1127 | 1132 |  |
  | 1128 | 1133 | $allposts = get\_posts( 'numberposts=-1&post\_type=wpcf7\_contact\_form&post\_status=any' ); |
  | 1129 | 1134 | foreach( $allposts as $postinfo ) { |
  | 1130 | 1135 | delete\_post\_meta( $postinfo->ID, '\_wp\_cf7pdf' ); |
  | 1131 | 1136 | delete\_post\_meta( $postinfo->ID, '\_wp\_cf7pdf\_fields' ); |
  | 1132 | 1137 | delete\_post\_meta( $postinfo->ID, '\_wp\_cf7pdf\_fields\_scan' ); |
  | 1133 | 1138 | } |
  | 1134 | 1139 | $dropTable = WPCF7PDF\_settings::drop(); |
  | 1135 | 1140 |  |
  | 1136 | 1141 | } |
  | 1137 | 1142 |  |
  | 1138 | 1143 | static function wpcf7pdf\_generateRandomPassword($nb\_car = 8, $chaine = 'azertyuiopqsdfghjklmwxcvbnAZERTYUIOPMLKJGFDNBD123456789') { |
  | 1139 | 1144 | // the finished password |
  | 1140 | 1145 | //return md5(time()); |
  | 1141 | 1146 | $nb\_lettres = strlen($chaine) - 1; |
  | 1142 | 1147 | $generation = ''; |
  | 1143 | 1148 | for($i=0; $i < $nb\_car; $i++) |
  | 1144 | 1149 | { |
  | 1145 | 1150 | $pos = wp\_rand(0, $nb\_lettres); |
  | 1146 | 1151 | $car = $chaine[$pos]; |
  | 1147 | 1152 | $generation .= $car; |
  | 1148 | 1153 | } |
  | 1149 | 1154 | return $generation; |
  | 1150 | 1155 | } |
  | 1151 | 1156 |  |
  | 1152 | 1157 | function wpcf7\_export\_csv($idform) { |
  | 1153 | 1158 |  |
  | 1154 | 1159 | $meta\_fields = get\_post\_meta( intval($idform), '\_wp\_cf7pdf\_fields', true ); |
  | 1155 | 1160 | //$nameOfPdf = $this->wpcf7pdf\_name\_pdf($idform); |
  | 1156 | 1161 | $nameOfPdf = get\_transient('pdf\_name'); |
  | 1157 | 1162 | $upload\_dir = wp\_upload\_dir(); |
  | 1158 | 1163 | $createDirectory = $this->wpcf7pdf\_folder\_uploads($idform); |
  | 1159 | 1164 | $createDirectory = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory); |
  | 1160 | 1165 |  |
  | 1161 | 1166 | $separateur = ";"; |
  | 1162 | 1167 | if( isset($meta\_fields) ) { |
  | 1163 | 1168 |  |
  | 1164 | 1169 | $csv\_output = ''; |
  | 1165 | 1170 | $entete = array("download", "reference", "date"); |
  | 1166 | 1171 | $lignes = array(); |
  | 1167 | 1172 | $pdfFormList = WPCF7PDF\_settings::get\_list( intval($idform) ); |
  | 1168 | 1173 |  |
  | 1169 | 1174 | if( isset($pdfFormList) ) { |
  | 1170 | 1175 |  |
  | 1171 | 1176 | foreach($meta\_fields as $field) { |
  | 1172 | 1177 |  |
  | 1173 | 1178 | preg\_match\_all( '#\[(.\*?)\]#', $field, $nameField ); |
  | 1174 | 1179 | $nb=count($nameField[1]); |
  | 1175 | 1180 |  |
  | 1176 | 1181 | for($i=0;$i<$nb;$i++) { |
  | 1177 | 1182 | array\_push($entete, $nameField[1][$i]); |
  | 1178 | 1183 | } |
  | 1179 | 1184 |  |
  | 1180 | 1185 | } |
  | 1181 | 1186 |  |
  | 1182 | 1187 | foreach( $pdfFormList as $pdfList) { |
  | 1183 | 1188 | $list = array(); |
  | 1184 | 1189 | $pdfData = unserialize($pdfList->wpcf7pdf\_data); |
  | 1185 | 1190 |  |
  | 1186 | 1191 | array\_push($list, $createDirectory.'/'.$nameOfPdf.'-'.$pdfData[0].'.pdf'); |
  | 1187 | 1192 | foreach($pdfData as $data) { |
  | 1188 | 1193 | array\_push($list, $data); |
  | 1189 | 1194 | } |
  | 1190 | 1195 |  |
  | 1191 | 1196 | array\_push($lignes, $list); |
  | 1192 | 1197 |  |
  | 1193 | 1198 | } |
  | 1194 | 1199 | } |
  | 1195 | 1200 |  |
  | 1196 | 1201 | // Affichage de la ligne de titre, terminée par un retour chariot |
  | 1197 | 1202 | $csv\_output .= implode($separateur, $entete)."\r\n"; |
  | 1198 | 1203 |  |
  | 1199 | 1204 | foreach( $lignes as $ligne ) { |
  | 1200 | 1205 | $csv\_output .= implode($separateur, $ligne)."\r\n"; |
  | 1201 | 1206 | } |
  | 1202 | 1207 | return $csv\_output; |
  | 1203 | 1208 | } |
  | 1204 | 1209 | } |
  | 1205 | 1210 |  |
  | 1206 | 1211 | function wpcf7\_add\_footer(){ |
  | 1207 | 1212 |  |
  | 1208 | 1213 | // Multi STEP plugin? |
  | 1209 | 1214 | global $cf7msm\_redirect\_urls; |
  | 1210 | 1215 |  |
  | 1211 | 1216 | $displayAddEventList = 0; |
  | 1212 | 1217 |  |
  | 1213 | 1218 | // On recupere l'ID du Formulaire |
  | 1214 | 1219 | $wpcf7 = WPCF7\_ContactForm::get\_current(); |
  | 1215 | 1220 | if( $wpcf7 ) { |
  | 1216 | 1221 | ?> |
  | 1217 | 1222 | <!-- Send PDF for CF7 --> |
  | 1218 | 1223 | <script type='text/javascript'> |
  | 1219 | 1224 |  |
  | 1220 | 1225 | //generates random id for reference; |
  | 1221 | 1226 | let wpcf7\_unique\_id = (type = 2) => { |
  | 1222 | 1227 | let dateuid = () => { |
  | 1223 | 1228 | return Date.now().toString(26) |
  | 1224 | 1229 | .toString(16) |
  | 1225 | 1230 | .substring(1); |
  | 1226 | 1231 | } |
  | 1227 | 1232 | let mathuid = () => { |
  | 1228 | 1233 | return Math.floor((1 + Math.random()) \* 0x10000) |
  | 1229 | 1234 | .toString(16) |
  | 1230 | 1235 | .substring(1); |
  | 1231 | 1236 | } |
  | 1232 | 1237 | //return id if type = 2 |
  | 1233 | 1238 | if( type == 2 ) { |
  | 1234 | 1239 | return dateuid() + mathuid(); |
  | 1235 | 1240 | } else { |
  | 1236 | 1241 | return dateuid(); |
  | 1237 | 1242 | } |
  | 1238 | 1243 |  |
  | 1239 | 1244 | } |
  | 1240 | 1245 |  |
  | 1241 | 1246 | <?php |
  | 1242 | 1247 | $id = $wpcf7->id(); |
  | 1243 | 1248 |  |
  | 1244 | 1249 | $meta\_values = get\_post\_meta( $id, '\_wp\_cf7pdf', true ); |
  | 1245 | 1250 | //$nameOfPdf = $this->wpcf7pdf\_name\_pdf($id); |
  | 1246 | 1251 | if (isset($meta\_values['pdf-name']) && is\_string($meta\_values['pdf-name'])) { |
  | 1247 | 1252 | $singleNamePDF = esc\_html(sanitize\_title($meta\_values['pdf-name'])); |
  | 1248 | 1253 | } else { |
  | 1249 | 1254 | // Handle the error or set a default value |
  | 1250 | 1255 | $singleNamePDF = 'document-pdf'; |
  | 1251 | 1256 | } |
  | 1252 | 1257 |  |
  | 1253 | 1258 | // On récupère le dossier upload de WP |
  | 1254 | 1259 | $createDirectory = $this->wpcf7pdf\_folder\_uploads($id); |
  | 1255 | 1260 | $upload\_dir = wp\_upload\_dir(); |
  | 1256 | 1261 |  |
  | 1257 | 1262 | $targetPDF = '\_self'; |
  | 1258 | 1263 |  |
  | 1259 | 1264 | //Définition possible de la page de redirection à partir de ce plugin (url relative réécrite). |
  | 1260 | 1265 | if( isset($meta\_values['page\_next']) && is\_numeric($meta\_values['page\_next']) ) { |
  | 1261 | 1266 | $displayAddEventList = 1; |
  | 1262 | 1267 | } |
  | 1263 | 1268 |  |
  | 1264 | 1269 | // Redirection direct ver le pdf après envoi du formulaire |
  | 1265 | 1270 | if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=="true" ) { |
  | 1266 | 1271 | $displayAddEventList = 1; |
  | 1267 | 1272 | } |
  | 1268 | 1273 |  |
  | 1269 | 1274 | if ( isset($cf7msm\_redirect\_urls) && !empty( $cf7msm\_redirect\_urls ) ) { |
  | 1270 | 1275 | $displayAddEventList = 0; |
  | 1271 | 1276 | } |
  | 1272 | 1277 | if( (isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='true') || (isset($meta\_values["pdf-file-delete"]) && $meta\_values["pdf-file-delete"]=='true') ) { |
  | 1273 | 1278 | $displayAddEventList == 0; |
  | 1274 | 1279 | } |
  | 1275 | 1280 |  |
  | 1276 | 1281 | if( $displayAddEventList == 1 ) { |
  | 1277 | 1282 | ?> |
  | 1278 | 1283 |  |
  | 1279 | 1284 | document.addEventListener( 'wpcf7mailsent', function( event ) { |
  | 1280 | 1285 |  |
  | 1281 | 1286 | // Fonction sanitize champs du formulaire |
  | 1282 | 1287 | var string\_to\_slug = function (str) { |
  | 1283 | 1288 | str = str.replace(/^\s+|\s+$/g, ''); // trim |
  | 1284 | 1289 | str = str.toLowerCase(); |
  | 1285 | 1290 |  |
  | 1286 | 1291 | // remove accents, swap ñ for n, etc |
  | 1287 | 1292 | var from = 'àáäâèéëêìíïîòóöôùúüûñçěščřžýúůďťň·/\_,:;'; |
  | 1288 | 1293 | var to   = 'aaaaeeeeiiiioooouuuuncescrzyuudtn------'; |
  | 1289 | 1294 |  |
  | 1290 | 1295 | for (var i=0, l=from.length ; i<l ; i++) { |
  | 1291 | 1296 | str = str.replace(new RegExp(from.charAt(i), 'g'), to.charAt(i)); |
  | 1292 | 1297 | } |
  | 1293 | 1298 |  |
  | 1294 | 1299 | str = str.replace('.', '') // replace a dot by a dash |
  | 1295 | 1300 | .replace(/[^a-z0-9 -]/g, '') // remove invalid chars |
  | 1296 | 1301 | .replace(/\s+/g, '-') // collapse whitespace and replace by a dash |
  | 1297 | 1302 | .replace(/-+/g, '-') // collapse dashes |
  | 1298 | 1303 | .replace( /\//g, '' ); // collapse all forward-slashes |
  | 1299 | 1304 |  |
  | 1300 | 1305 | return str; |
  | 1301 | 1306 | } |
  | 1302 | 1307 | // On va chercher la référence dans le retour du formulaire |
  | 1303 | 1308 | var inputs = event.detail.inputs; |
  | 1304 | 1309 | for ( var o = 0; o < inputs.length; o++ ) { |
  | 1305 | 1310 | if ( 'wpcf7cfpdf\_hidden\_reference' == inputs[o].name ) { |
  | 1306 | 1311 | var reference = string\_to\_slug(inputs[o].value); |
  | 1307 | 1312 | } |
  | 1308 | 1313 | } |
  | 1309 | 1314 | <?php |
  | 1310 | 1315 | $addName = ''; |
  | 1311 | 1316 | // On recupère les tags du nom du PDF |
  | 1312 | 1317 | if (isset($meta\_values["pdf-add-name"]) && $meta\_values["pdf-add-name"] != '') { |
  | 1313 | 1318 |  |
  | 1314 | 1319 | $getNamePerso = explode(',', esc\_html($meta\_values["pdf-add-name"])); |
  | 1315 | 1320 | $getNamePerso = str\_replace('[date]', 'wpcf7cfpdf\_hidden\_date', $getNamePerso); |
  | 1316 | 1321 | $getNamePerso = str\_replace('[reference]', 'wpcf7cfpdf\_hidden\_reference', $getNamePerso); |
  | 1317 | 1322 | foreach ( $getNamePerso as $key => $value ) { |
  | 1318 | 1323 | $addNewName[$key] = str\_replace(' ', '-', $value); |
  | 1319 | 1324 | $addNewName[$key] = strtolower($addNewName[$key]); |
  | 1320 | 1325 | $addName .= "'".esc\_html(sanitize\_title($addNewName[$key]))."',"; |
  | 1321 | 1326 | } |
  | 1322 | 1327 |  |
  | 1323 | 1328 | ?> |
  | 1324 | 1329 | var fieldname = [<?php echo wp\_kses\_data($addName, 0, -1); ?>]; |
  | 1325 | 1330 | let valuefield = ''; |
  | 1326 | 1331 |  |
  | 1327 | 1332 | for ( var ii = 0; ii < fieldname.length; ii++ ) { // je liste les champs du nom du PDF |
  | 1328 | 1333 | for ( var i = 0; i < inputs.length; i++ ) { // je liste les champs envoyé du form |
  | 1329 | 1334 | console.log( fieldname[ii] + ' == ' + inputs[i].name + ' : '+ inputs[i].value ); |
  | 1330 | 1335 | if ( fieldname[ii] == inputs[i].name ) { // je compare si le nom se trouve dans le form |
  | 1331 | 1336 | valuefield += '-' + string\_to\_slug(inputs[i].value); |
  | 1332 | 1337 | } |
  | 1333 | 1338 | } |
  | 1334 | 1339 |  |
  | 1335 | 1340 | }   let text = valuefield; |
  | 1336 | 1341 | <?php |
  | 1337 | 1342 | // Si on ne redirige pas sur une page, on construit la redirection |
  | 1338 | 1343 | if( isset($meta\_values['page\_next']) && $meta\_values['page\_next']=='' ) { |
  | 1339 | 1344 | // Si on redirige sur une popup |
  | 1340 | 1345 | if( (isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"] == 'true') && (isset($meta\_values["redirect-window"]) && $meta\_values["redirect-window"] == 'popup') ) { ?> |
  | 1341 | 1346 |  |
  | 1342 | 1347 | window.open('<?php echo esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory)); ?>/<?php echo esc\_html($singleNamePDF); ?>' + text + '-' + reference + '.pdf?ver=<?php esc\_html(wp\_rand()); ?>','text','menubar=no, status=no, scrollbars=yes, menubar=no, width=600, height=900'); |
  | 1343 | 1348 |  |
  | 1344 | 1349 | <?php } else if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"] == 'true' ) { ?> |
  | 1345 | 1350 | // Si option réglée sur nouvelle fenêtre mais avec des tags dans le nom du PDF |
  | 1346 | 1351 | var location = '<?php echo esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory)); ?>/<?php echo esc\_html($singleNamePDF); ?>' + text + '-' + reference + '.pdf?ver=<?php esc\_html(wp\_rand()); ?>'; |
  | 1347 | 1352 | window.open(location, text, '<?php echo esc\_html($targetPDF); ?>'); |
  | 1348 | 1353 |  |
  | 1349 | 1354 | <?php } } ?> |
  | 1350 | 1355 |  |
  | 1351 | 1356 |  |
  | 1352 | 1357 | <?php } else { |
  | 1353 | 1358 |  |
  | 1354 | 1359 | $urlRredirectPDF = str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory).'/'.$singleNamePDF; |
  | 1355 | 1360 |  |
  | 1356 | 1361 | if( (isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"] == 'true' ) && (isset($meta\_values["redirect-window"]) && $meta\_values["redirect-window"] == 'popup') ) { ?> |
  | 1357 | 1362 | // Si popup |
  | 1358 | 1363 | window.open('<?php echo esc\_url($urlRredirectPDF); ?>-' + reference + '.pdf?ver=<?php esc\_html(wp\_rand()); ?>', '<?php echo esc\_html($singleNamePDF); ?>','menubar=no, status=no, scrollbars=yes, menubar=no, width=600, height=900'); |
  | 1359 | 1364 |  |
  | 1360 | 1365 | <?php } else if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"] == 'true' ) { ?> |
  | 1361 | 1366 | // Si option réglée sur nouvelle fenêtre |
  | 1362 | 1367 | var location = '<?php echo esc\_url($urlRredirectPDF); ?>-' + reference + '.pdf?ver=<?php esc\_html(wp\_rand()); ?>'; |
  | 1363 | 1368 | window.open(location, '<?php echo esc\_url($singleNamePDF); ?>', '<?php echo esc\_html($targetPDF); ?>'); |
  | 1364 | 1369 |  |
  | 1365 | 1370 | <?php } |
  | 1366 | 1371 |  |
  | 1367 | 1372 | } |
  | 1368 | 1373 | if( (isset($meta\_values['page\_next']) && is\_numeric($meta\_values['page\_next'])) ) { |
  | 1369 | 1374 | $nonce\_url = wp\_nonce\_url( esc\_url(htmlspecialchars\_decode(get\_permalink($meta\_values['page\_next']))), 'go\_reference' ); |
  | 1370 | 1375 | ?> |
  | 1371 | 1376 | // Si option réglée sur redirection vers page externe |
  | 1372 | 1377 | location.replace("<?php echo esc\_url($nonce\_url); ?>&pdf-reference=" + reference); |
  | 1373 | 1378 | /\*location.replace("<?php //echo htmlspecialchars\_decode( esc\_url( get\_permalink($meta\_values['page\_next']).'?pdf-reference=')); ?>" + reference);\*/ |
  | 1374 | 1379 | <?php } |
  | 1375 | 1380 |  |
  | 1376 | 1381 | ?> |
  | 1377 | 1382 | }, false ); |
  | 1378 | 1383 |  |
  | 1379 | 1384 | <?php |
  | 1380 | 1385 | } |
  | 1381 | 1386 |  |
  | 1382 | 1387 | ?> |
  | 1383 | 1388 | <?php |
  | 1384 | 1389 | // Désactivation remplissage du formulaire |
  | 1385 | 1390 | if( isset($meta\_values["disabled-autocomplete-form"]) && $meta\_values["disabled-autocomplete-form"]=="true" ) { |
  | 1386 | 1391 | ?> |
  | 1387 | 1392 |  |
  | 1388 | 1393 | jQuery(document).ready(function( $ ){ |
  | 1389 | 1394 | $('form').attr('autocomplete', 'off'); |
  | 1390 | 1395 | }); |
  | 1391 | 1396 |  |
  | 1392 | 1397 | <?php } ?> |
  | 1393 | 1398 |  |
  | 1394 | 1399 | document.addEventListener( 'wpcf7submit', function( event ) { |
  | 1395 | 1400 | jQuery('input[name="wpcf7cfpdf\_hidden\_reference"]').val(wpcf7\_unique\_id(3)); |
  | 1396 | 1401 |  |
  | 1397 | 1402 | }, false ); |
  | 1398 | 1403 |  |
  | 1399 | 1404 | </script> |
  | 1400 | 1405 | <!-- END :: Send PDF for CF7 --> |
  | 1401 | 1406 | <?php } ?> |
  | 1402 | 1407 | <?php |
  | 1403 | 1408 |  |
  | 1404 | 1409 | } |
  | 1405 | 1410 | } |
* ## [send-pdf-for-contact-form-7/trunk/readme.txt](/changeset/3074531/send-pdf-for-contact-form-7/trunk/readme.txt?old=3069882&old_path=send-pdf-for-contact-form-7%2Ftrunk%2Freadme.txt "Show the [3069882:3074631] differences restricted to send-pdf-for-contact-form-7/trunk/readme.txt")

  | [r3069882](/browser/send-pdf-for-contact-form-7/trunk/readme.txt?rev=3069882#L1 "Show revision 3069882 of this file in browser") | [r3074631](/browser/send-pdf-for-contact-form-7/trunk/readme.txt?rev=3074531#L1 "Show revision 3074631 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Send PDF for Contact Form 7 === |
  | 2 | 2 | Contributors: Florent73 |
  | 3 | 3 | Donate link: https://www.paypal.me/RestezConnectes/ |
  | 4 | 4 | Tags: contact form 7, pdf, send, attachment, form |
  | 5 | 5 | Requires at least: 5.2 |
  | 6 | 6 | Tested up to: 6.5 |
  | 7 |  | Stable tag: 1.0.2.~~3~~ |
  |  | 7 | Stable tag: 1.0.2.4 |
  | 8 | 8 | License: GPLv3 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | 10 | 10 |  |
  | 11 | 11 | Create, customize and send PDF attachments with Contact Form 7 form |
  | 12 | 12 |  |
  | 13 | 13 | == Description == |
  | 14 | 14 |  |
  | 15 | 15 | This plugin adds conditional logic to <a href="https://wordpress.org/plugins/contact-form-7/">[Contact Form 7]</a>. |
  | 16 | 16 |  |
  | 17 | 17 | Send the PDF for Contact Form plugin will allow you to recover the data yourself via your form to insert them into a PDF built and prepared by you. |
  | 18 | 18 |  |
  | 19 | 19 | This plugin requires the installation and activation of the plugin Contact Form 7. |
  | 20 | 20 |  |
  | 21 | 21 | <a href="https://demo.restezconnectes.fr/send-pdf-for-contact-form-7/">DEMO HERE</a> |
  | 22 | 22 | <a href="https://restezconnectes.fr/tutoriel-wordpress-lextension-send-pdf-for-contact-form-7/">[Tutorial Here]</a> |
  | 23 | 23 |  |
  | 24 | 24 | Translations: <a href="https://translate.wordpress.org/projects/wp-plugins/send-pdf-for-contact-form-7/">Here</a> |
  | 25 | 25 |  |
  | 26 | 26 | == Installation == |
  | 27 | 27 |  |
  | 28 | 28 | 1. Upload the full directory into your '/wp-content/plugins' directory |
  | 29 | 29 | 2. Activate the plugin at the plugin administration page |
  | 30 | 30 | 3. Open the plugin configuration page, which is located under 'Contact->Send PDF with CF7' |
  | 31 | 31 |  |
  | 32 | 32 | == Screenshots == |
  | 33 | 33 |  |
  | 34 | 34 | 1. Choice of form Contact Form 7 |
  | 35 | 35 | 2. View general settings |
  | 36 | 36 | 3. Preparation view of your PDF |
  | 37 | 37 |  |
  | 38 | 38 | == Contribute == |
  | 39 | 39 | You can contribute with code, issues and ideas at the [GitHub repository](https://github.com/Florent73/send-pdf-for-contact-form-7). |
  | 40 | 40 |  |
  | 41 | 41 | If you like it, a review is appreciated :) |
  | 42 | 42 |  |
  | 43 | 43 | == Frequently Asked Questions == |
  | 44 | 44 |  |
  | 45 | 45 | = Is there a tutorial? = |
  | 46 | 46 |  |
  | 47 | 47 | Read here <a href="https://restezconnectes.fr/tutoriel-wordpress-lextension-send-pdf-for-contact-form-7/">Tutorial available (in french).</a> |
  | 48 | 48 |  |
  | 49 | 49 | = This plugin is free? = |
  | 50 | 50 |  |
  | 51 | 51 | Yes. If you want, you can support this project here: <a href="https://restezconnectes.fr/a-propos/">https://restezconnectes.fr/a-propos/</a> |
  | 52 | 52 |  |
  | 53 | 53 |  |
  | 54 | 54 | == Changelog == |
  |  | 55 |  |
  |  | 56 | = 1.0.2.4 = |
  |  | 57 | \* Fix bug with line break on PDF |
  |  | 58 | \* Secure plugin |
  | 55 | 59 |  |
  | 56 | 60 | = 1.0.2.3 = |
  | 57 | 61 | \* Fix bug format textarea CSV |
  | 58 | 62 | \* Secure plugin |
  | 59 | 63 |  |
  | 60 | 64 | = 1.0.2.2 = |
  | 61 | 65 | \* Fix bug format text |
  | 62 | 66 |  |
  | 63 | 67 | = 1.0.2.1 = |
  | 64 | 68 | \* Fix bug for shortcode prices |
  | 65 | 69 | \* Delete HTML for tags 'select' |
  | 66 | 70 |  |
  | 67 | 71 | = 1.0.2.0 = |
  | 68 | 72 | \* Modify generate ID length for reference |
  | 69 | 73 |  |
  | 70 | 74 | = 1.0.1.9 = |
  | 71 | 75 | \* Fix bug redirect PDF |
  | 72 | 76 | \* Fix bug footer PDF |
  | 73 | 77 | \* Adding Custom Fonts is now ready |
  | 74 | 78 | \* Adding shortcode for prices |
  | 75 | 79 |  |
  | 76 | 80 | = 1.0.1.8 = |
  | 77 | 81 | \* Fix bug with line break on PDF |
  | 78 | 82 |  |
  | 79 | 83 | = 1.0.1.7 = |
  | 80 | 84 | \* Fix bug and defined constants WPCF7\_ADMIN\_READ\_CAPABILITY / WPCF7\_ADMIN\_READ\_WRITE\_CAPABILITY |
  | 81 | 85 | \* Fix bug redirection page after sending form |
  | 82 | 86 | \* Fix bug "Desactivate line break auto" option reversed |
  | 83 | 87 | \* Adding a option for desactivated line break for mail content |
  | 84 | 88 |  |
  | 85 | 89 | = 1.0.1.6 = |
  | 86 | 90 | \* Fix bug headers with or without [addpage] shortcode |
  | 87 | 91 |  |
  | 88 | 92 | = 1.0.1.5 = |
  | 89 | 93 | \* Adding tag compatible [\_format\_{field name} "{date format}"] |
  | 90 | 94 |  |
  | 91 | 95 | = 1.0.1.4 = |
  | 92 | 96 | \* Bug fixed generate CSV |
  | 93 | 97 |  |
  | 94 | 98 | = 1.0.1.3 = |
  | 95 | 99 | \* Bug fixed tags name |
  | 96 | 100 | \* Remove TRANSIENTS for reference of PDF |
  | 97 | 101 | \* Adding form fields for reference and name of PDF |
  | 98 | 102 | \* Adding checking for fields settings in admin page |
  | 99 | 103 |  |
  | 100 | 104 | = 1.0.1.2 = |
  | 101 | 105 | \* Bug fixed if option "Delete all PDF" checked |
  | 102 | 106 | \* Bug fixed for download button shortcode [wpcf7pdf\_download] |
  | 103 | 107 |  |
  | 104 | 108 | = 1.0.1.1 = |
  | 105 | 109 | \* Bug Fixed generate PDF |
  | 106 | 110 | \* Bug Fixed redirect page or PDF |
  | 107 | 111 |  |
  | 108 | 112 | = 1.0.1.0 = |
  | 109 | 113 | \* Major version : reprogramming plugin |
  | 110 | 114 | \* Bug Fixed form image upload |
  | 111 | 115 |  |
  | 112 | 116 | = 1.0.0.3 = |
  | 113 | 117 | \* Bug Fixed form image upload |
  | 114 | 118 |  |
  | 115 | 119 | = 1.0.0.2 = |
  | 116 | 120 | \* Bug Fixed form tags in name PDF |
  | 117 | 121 |  |
  | 118 | 122 | = 1.0.0.1 = |
  | 119 | 123 | \* Bug Fixed upload image in mail |
  | 120 | 124 |  |
  | 121 | 125 | = 1.0.0.0 = |
  | 122 | 126 | \* Bug Fixed tags for name PDF |
  | 123 | 127 | \* Cleaning code |
  | 124 | 128 | \* Bug fixed supports channels pipes |
  | 125 | 129 | \* Compatibility with Shortcoder plugin |
  | 126 | 130 | \* Bug with images fixed |
  | 127 | 131 | \* Adding Directionality option |
  | 128 | 132 |  |
  | 129 | 133 | = 0.9.9.7 = |
  | 130 | 134 | \* Bug Fixed tags for name PDF |
  | 131 | 135 | \* Cleaning code |
  | 132 | 136 | \* Adding Cyrillic Time New roman Bulgarian font |
  | 133 | 137 | \* Autorized form tags in name of PDF |
  | 134 | 138 |  |
  | 135 | 139 | = 0.9.9.6 = |
  | 136 | 140 | \* Change name of generated PDF's |
  | 137 | 141 | \* Adding Directionality option |
  | 138 | 142 | \* Adding option for hidden the empty value for checkbox and radio |
  | 139 | 143 |  |
  | 140 | 144 | = 0.9.9.5 = |
  | 141 | 145 | \* Adding IPA (Japanese) fonts |
  | 142 | 146 |  |
  | 143 | 147 | = 0.9.9.4 = |
  | 144 | 148 | \* Autorize text-rotate tags in text editor |
  | 145 | 149 | \* Bug Fixed Image rotate |
  | 146 | 150 | \* Change name of PDF sent |
  | 147 | 151 |  |
  | 148 | 152 | = 0.9.9.3 = |
  | 149 | 153 | \* Adding apply\_filters() to use a query for PDF design |
  | 150 | 154 | \* Adding Lato font |
  | 151 | 155 |  |
  | 152 | 156 | = 0.9.9.2 = |
  | 153 | 157 | \* Vulnerability fixed |
  | 154 | 158 | \* Autorize ID tag in text editor |
  | 155 | 159 | \* Adding font |
  | 156 | 160 |  |
  | 157 | 161 | = 0.9.9.1 = |
  | 158 | 162 | \* Autorize ID tag in text editor |
  | 159 | 163 | \* Bug Fonts Fixed |
  | 160 | 164 | \* Bug checkbox fixed |
  | 161 | 165 |  |
  | 162 | 166 | = 0.9.9 = |
  | 163 | 167 | \* Adding deleted all settings form option |
  | 164 | 168 | \* Some Bug fixed |
  | 165 | 169 | \* Barcode & QrCode are now compatible |
  | 166 | 170 | \* Fixed bug import / export settings |
  | 167 | 171 |  |
  | 168 | 172 | = 0.9.8 = |
  | 169 | 173 | \* Add the u modifier to make UTF-8 work |
  | 170 | 174 |  |
  | 171 | 175 | = 0.9.7 = |
  | 172 | 176 | \* Autorize tags in text editor |
  | 173 | 177 |  |
  | 174 | 178 | = 0.9.6 = |
  | 175 | 179 | \* Bug fixed Checkbox |
  | 176 | 180 | \* Autorize colspans and rowspans in text editor |
  | 177 | 181 | \* Bug fixed date in PDF name |
  | 178 | 182 |  |
  | 179 | 183 | = 0.9.5 = |
  | 180 | 184 | \* Bug fixed CSV |
  | 181 | 185 | \* Remove usage SESSIONS, use TRANSIENT instead |
  | 182 | 186 |  |
  | 183 | 187 | = 0.9.4 = |
  | 184 | 188 | \* Bug fixed Conditional Fields PRO |
  | 185 | 189 |  |
  | 186 | 190 | = 0.9.3 = |
  | 187 | 191 | \* Bug Safari open PDF fixed |
  | 188 | 192 | \* Cleaner code, adding <thead>, <th>, <tbody> tags |
  | 189 | 193 | \* Adding Font Awesome and Dashicons |
  | 190 | 194 | \* Bug HTML footer fixed |
  | 191 | 195 | \* Adding tag [avatar] for user avatar URL |
  | 192 | 196 |  |
  | 193 | 197 | = 0.9.2 = |
  | 194 | 198 | \* Several security patches have been brought |
  | 195 | 199 |  |
  | 196 | 200 | = 0.9.1 = |
  | 197 | 201 | \* Adding Choice of separator for checkboxes or radio buttons |
  | 198 | 202 | \* Compatibility with Conditional Fields PRO |
  | 199 | 203 |  |
  | 200 | 204 | = 0.9 = |
  | 201 | 205 | \* Bug fixed upload image |
  | 202 | 206 | \* Bug fixed footer if is empty |
  | 203 | 207 |  |
  | 204 | 208 | = 0.8.9 = |
  | 205 | 209 | \* Bug fixed PDF password |
  | 206 | 210 |  |
  | 207 | 211 | = 0.8.8 = |
  | 208 | 212 | \* Adding Margin Left & Right |
  | 209 | 213 |  |
  | 210 | 214 | = 0.8.7 = |
  | 211 | 215 | \* Adding fields for customs shortcodes |
  | 212 | 216 | \* Adding ID tag from database |
  | 213 | 217 | \* Bug fixed upload logo and background |
  | 214 | 218 |  |
  | 215 | 219 |  |
  | 216 | 220 | = 0.8.6 = |
  | 217 | 221 | \* Adding change separator for CSV option |
  | 218 | 222 | \* Adding fields for margin auto top & bottom |
  | 219 | 223 | \* Adding reset TMP folder |
  | 220 | 224 | \* Upgrade mPDF v8.0.10 |
  | 221 | 225 | \* Adding filed for password with a TAG |
  | 222 | 226 | \* Bug with SESSION password |
  | 223 | 227 |  |
  | 224 | 228 | = 0.8.5 = |
  | 225 | 229 | \* Bug fixed with uploading files field |
  | 226 | 230 |  |
  | 227 | 231 | = 0.8.4 = |
  | 228 | 232 | \* Bug fixed with the 'wpcf7pdf\_path\_temp' option, you can remove this option by disabling plugin |
  | 229 | 233 | \* Adding disabling function for plugin : removed all options (not parameters) |
  | 230 | 234 | \* Remove COOKIE and use SESSION |
  | 231 | 235 |  |
  | 232 | 236 | = 0.8.3 = |
  | 233 | 237 | \* Bug fixed COOKIES |
  | 234 | 238 |  |
  | 235 | 239 | = 0.8.2 = |
  | 236 | 240 | \* Display Error Message if COOKIES are blocked |
  | 237 | 241 | \* Bug fixed margin top & Header : |
  | 238 | 242 | - Adding "Margin Bottom Header" setting for header picture |
  | 239 | 243 | - Adding "Global Margin PDF" setting for PDF |
  | 240 | 244 | \* Bug fixed Multiple Checkbox |
  | 241 | 245 | \* Bug Fixed Radio checked |
  | 242 | 246 |  |
  | 243 | 247 | = 0.8.1 = |
  | 244 | 248 | \* Use capability of CF7 |
  | 245 | 249 | \* Fixed typing error Donwload |
  | 246 | 250 |  |
  | 247 | 251 | = 0.8 = |
  | 248 | 252 | \* Bug fixed COOKIE |
  | 249 | 253 | \* Update mPDF Library |
  | 250 | 254 |  |
  | 251 | 255 | = 0.7.9.6 = |
  | 252 | 256 | \* Fixed bugs Header & Background Image |
  | 253 | 257 | \* Make the text filterable |
  | 254 | 258 |  |
  | 255 | 259 | = 0.7.9.6 = |
  | 256 | 260 | \* Fixed bugs codeEditor |
  | 257 | 261 |  |
  | 258 | 262 | = 0.7.9.5 = |
  | 259 | 263 | \* Adding Custom CSS |
  | 260 | 264 | \* Adding Background Image |
  | 261 | 265 |  |
  | 262 | 266 | = 0.7.9.4 = |
  | 263 | 267 | \* Fixed bug TMP directory |
  | 264 | 268 | \* Adding tags form in PDF name |
  | 265 | 269 | \* Fixed bugs minors |
  | 266 | 270 |  |
  | 267 | 271 | = 0.7.9.3 = |
  | 268 | 272 | \* Remove SESSION and use COOKIE |
  | 269 | 273 |  |
  | 270 | 274 | = 0.7.9.2 = |
  | 271 | 275 | \* Fixed bugs session |
  | 272 | 276 |  |
  | 273 | 277 | = 0.7.9.1 = |
  | 274 | 278 | \* Fixed bugs notice PHP |
  | 275 | 279 |  |
  | 276 | 280 | = 0.7.9 = |
  | 277 | 281 | \* Resolve bug delete record |
  | 278 | 282 |  |
  | 279 | 283 | = 0.7.8 = |
  | 280 | 284 | \* Change CodeMirror |
  | 281 | 285 | \* Add a CSS example for A4 page |
  | 282 | 286 |  |
  | 283 | 287 | = 0.7.7 = |
  | 284 | 288 | \* Fixed bugs notice PHP |
  | 285 | 289 | \* Adding PDF password length |
  | 286 | 290 | \* Tags [reference], [pdf-password], [date] and [time] is possible in the subject email |
  | 287 | 291 | \* Adding URL input for your stylesheet |
  | 288 | 292 |  |
  | 289 | 293 | = 0.7.6 = |
  | 290 | 294 | \* Adding choosing font for your PDF file |
  | 291 | 295 |  |
  | 292 | 296 | = 0.7.5 = |
  | 293 | 297 | \* Fixed bug checkbox |
  | 294 | 298 | \* Fixed bug CSV |
* ## [send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php](/changeset/3074631/send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php?old=3069880&old_path=send-pdf-for-contact-form-7%2Ftrunk%2Fviews%2Fsend-pdf-admin.php "Show the [3069882:3074631] differences restricted to send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php")

  | [r3069882](/browser/send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php?rev=3069880#L1 "Show revision 3069882 of this file in browser") | [r3074631](/browser/send-pdf-for-contact-form-7/trunk/views/send-pdf-admin.php?rev=3074631#L1 "Show revision 3074631 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | defined( 'ABSPATH' ) or die( 'Not allowed' ); |
  | 4 | 4 |  |
  | 5 | 5 | global $current\_user; |
  | 6 | 6 | global $\_wp\_admin\_css\_colors; |
  | 7 | 7 | global $post; |
  | 8 | 8 |  |
  | 9 | 9 | $admin\_color = get\_user\_option( 'admin\_color', get\_current\_user\_id() ); |
  | 10 | 10 | $colors      = $\_wp\_admin\_css\_colors[$admin\_color]->colors; |
  | 11 | 11 |  |
  | 12 | 12 | $upload\_dir = wp\_upload\_dir(); |
  | 13 | 13 | if ( defined( 'WPCF7\_UPLOADS\_TMP\_DIR' ) ) { |
  | 14 | 14 | $tmpDirectory = WPCF7\_UPLOADS\_TMP\_DIR; |
  | 15 | 15 | } else { |
  | 16 | 16 | $tmpDirectory = $upload\_dir['basedir'].'/sendpdfcf7\_uploads/tmp'; |
  | 17 | 17 | } |
  | 18 | 18 |  |
  | 19 | 19 | /\* Update des paramètres \*/ |
  | 20 | 20 | if( (isset($\_POST['action']) && isset($\_POST['idform']) && $\_POST['action'] == 'update') && isset($\_POST['security-sendform']) && wp\_verify\_nonce($\_POST['security-sendform'], 'go-sendform') ) { |
  | 21 | 21 |  |
  | 22 | 22 | if( isset($\_POST['deleteconfig']) && $\_POST['deleteconfig']=="true") { |
  | 23 | 23 |  |
  | 24 | 24 | delete\_post\_meta( $\_POST['idform'], '\_wp\_cf7pdf' ); |
  | 25 | 25 | delete\_post\_meta( $\_POST['idform'], '\_wp\_cf7pdf\_fields' ); |
  | 26 | 26 | delete\_post\_meta( $\_POST['idform'], '\_wp\_cf7pdf\_fields\_scan' ); |
  | 27 | 27 | $\_POST['idform'] = ''; |
  | 28 | 28 |  |
  | 29 | 29 | wp\_redirect( 'admin.php?page=wpcf7-send-pdf&deleted=1' ); |
  | 30 | 30 |  |
  | 31 | 31 | } else { |
  | 32 | 32 |  |
  | 33 | 33 | if( isset($\_POST['wp\_cf7pdf\_settings']['pdf-uploads-delete']) && $\_POST['wp\_cf7pdf\_settings']['pdf-uploads-delete']=="true" ) { |
  | 34 | 34 |  |
  | 35 | 35 | if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='true') { |
  | 36 | 36 | echo '<div id="message" class="notice notice-error"><p><strong>'.esc\_html\_\_("I can't deleted all files in this folder. Only in my folder. Thanks to check 'Change uploads folder?' option for this.", 'send-pdf-for-contact-form-7').'</strong></p></div>'; |
  | 37 | 37 | } else { |
  | 38 | 38 | $dossier\_traite = cf7\_sendpdf::wpcf7pdf\_folder\_uploads(esc\_html($\_POST['idform'])); |
  | 39 | 39 |  |
  | 40 | 40 | if( isset($dossier\_traite) && is\_dir($dossier\_traite) ) { |
  | 41 | 41 |  |
  | 42 | 42 | $repertoire = opendir($dossier\_traite); // On définit le répertoire dans lequel on souhaite travailler. |
  | 43 | 43 |  |
  | 44 | 44 | while (false !== ($fichier = readdir($repertoire))) // On lit chaque fichier du répertoire dans la boucle. |
  | 45 | 45 | { |
  | 46 | 46 | $chemin = $dossier\_traite."/".$fichier; // On définit le chemin du fichier à effacer. |
  | 47 | 47 |  |
  | 48 | 48 | // Si le fichier n'est pas un répertoire… |
  | 49 | 49 | if ($fichier != ".." AND $fichier != "." AND !is\_dir($fichier)) { |
  | 50 | 50 | wp\_delete\_file($chemin); |
  | 51 | 51 | } |
  | 52 | 52 | } |
  | 53 | 53 | closedir($repertoire); |
  | 54 | 54 |  |
  | 55 | 55 | echo '<div id="message" class="updated fade"><p><strong>'.esc\_html\_\_('The upload folder has been deleted.', 'send-pdf-for-contact-form-7').'</strong></p></div>'; |
  | 56 | 56 | } |
  | 57 | 57 | } |
  | 58 | 58 |  |
  | 59 | 59 | } |
  | 60 | 60 |  |
  | 61 | 61 | $updateSetting = WPCF7PDF\_settings::update\_settings(esc\_html($\_POST['idform']), $\_POST["wp\_cf7pdf\_settings"], '\_wp\_cf7pdf'); |
  | 62 | 62 |  |
  | 63 | 63 | if ( isset($\_POST["wp\_cf7pdf\_tags"]) ) { |
  | 64 | 64 | $updateSettingTags = WPCF7PDF\_settings::update\_settings(esc\_html($\_POST['idform']), $\_POST["wp\_cf7pdf\_tags"], '\_wp\_cf7pdf\_fields'); |
  | 65 | 65 | } |
  | 66 | 66 | if ( isset($\_POST["wp\_cf7pdf\_tags\_scan"]) ) { |
  | 67 | 67 | $updateSettingTagsScan = WPCF7PDF\_settings::update\_settings(esc\_html($\_POST['idform']), $\_POST["wp\_cf7pdf\_tags\_scan"], '\_wp\_cf7pdf\_fields\_scan'); |
  | 68 | 68 | } |
  | 69 | 69 |  |
  | 70 | 70 | if( isset($updateSetting) && $updateSetting == true) { |
  | 71 | 71 | $options\_saved = true; |
  | 72 | 72 | echo '<div id="message" class="updated fade"><p><strong>'.esc\_html\_\_('Options saved.', 'send-pdf-for-contact-form-7').'</strong></p></div>'; |
  | 73 | 73 | } |
  | 74 | 74 | } |
  | 75 | 75 |  |
  | 76 | 76 | } |
  | 77 | 77 |  |
  | 78 | 78 | if( isset($\_POST['idform']) && isset($\_POST['truncate\_table']) && $\_POST['truncate\_table'] == 'true' && wp\_verify\_nonce($\_POST['security-sendform'], 'go-sendform') ) { |
  | 79 | 79 |  |
  | 80 | 80 | $DeleteList = WPCF7PDF\_settings::truncate(); |
  | 81 | 81 | if( $DeleteList == true ) { |
  | 82 | 82 | echo '<div id="message" class="updated fade"><p><strong>'.esc\_html\_\_('All the data has been deleted.', 'send-pdf-for-contact-form-7').'</strong></p></div>'; |
  | 83 | 83 | } |
  | 84 | 84 | } |
  | 85 | 85 | if( (isset($\_POST['wpcf7\_action']) && isset($\_POST['idform']) && $\_POST['wpcf7\_action'] == 'listing\_settings') ) { |
  | 86 | 86 |  |
  | 87 | 87 | if(!wp\_verify\_nonce($\_POST['wpcf7\_listing\_nonce'], 'wpcf7\_listing\_nonce')) |
  | 88 | 88 | return; |
  | 89 | 89 |  |
  | 90 | 90 | if(!current\_user\_can('manage\_options')) |
  | 91 | 91 | return; |
  | 92 | 92 |  |
  | 93 | 93 | if(empty($\_POST['listing\_limit'])) |
  | 94 | 94 | return; |
  | 95 | 95 |  |
  | 96 | 96 | update\_post\_meta(sanitize\_text\_field($\_POST['idform']), '\_wp\_cf7pdf\_limit', sanitize\_text\_field($\_POST['listing\_limit'])); |
  | 97 | 97 |  |
  | 98 | 98 | echo '<div id="message" class="updated fade"><p><strong>' . esc\_html\_\_('Limit updating successfully!', 'send-pdf-for-contact-form-7') . '</strong></p></div>'; |
  | 99 | 99 | } |
  | 100 | 100 |  |
  | 101 | 101 | if( isset($\_POST['action']) && $\_POST['action'] == 'reset' ) { |
  | 102 | 102 |  |
  | 103 | 103 | if( ! wp\_verify\_nonce($\_POST['security-resettmp'], 'go-resettmp') ) |
  | 104 | 104 | return; |
  | 105 | 105 |  |
  | 106 | 106 | if ( defined( 'WPCF7\_UPLOADS\_TMP\_DIR' ) ) { |
  | 107 | 107 | update\_option('wpcf7pdf\_path\_temp', WPCF7\_UPLOADS\_TMP\_DIR); |
  | 108 | 108 | } else { |
  | 109 | 109 | update\_option('wpcf7pdf\_path\_temp', $upload\_dir['basedir'] . '/sendpdfcf7\_uploads/tmp'); |
  | 110 | 110 | } |
  | 111 | 111 |  |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | 114 | 114 | if( isset($\_GET['deleted']) && $\_GET['deleted']==1 ) { |
  | 115 | 115 | echo '<div id="message" class="updated fade"><p><strong>'.esc\_html\_\_('All settings hare been deleted.', 'send-pdf-for-contact-form-7').'</strong></p></div>'; |
  | 116 | 116 | } |
  | 117 | 117 | ?> |
  | 118 | 118 | <script type="text/javascript"> |
  | 119 | 119 | jQuery.fn.selectText = function () { |
  | 120 | 120 | return jQuery(this).each(function (index, el) { |
  | 121 | 121 | if (document.selection) { |
  | 122 | 122 | var range = document.body.createTextRange(); |
  | 123 | 123 | range.moveToElementText(el); |
  | 124 | 124 | range.select(); |
  | 125 | 125 | } else if (window.getSelection) { |
  | 126 | 126 | selection = window.getSelection(); |
  | 127 | 127 | range = document.createRange(); |
  | 128 | 128 | range.selectNodeContents(el); |
  | 129 | 129 | selection.removeAllRanges(); |
  | 130 | 130 | selection.addRange(range); |
  | 131 | 131 | } |
  | 132 | 132 | }); |
  | 133 | 133 | } |
  | 134 | 134 | jQuery(document).ready(function() { |
  | 135 | 135 |  |
  | 136 | 136 | jQuery( ".postbox .hndle" ).on( "mouseover", function() { |
  | 137 | 137 | jQuery( this ).css( "cursor", "pointer" ); |
  | 138 | 138 | }); |
  | 139 | 139 | /\* Sliding the panels \*/ |
  | 140 | 140 | jQuery(".postbox").on('click', '.handlediv', function(){ |
  | 141 | 141 | jQuery(this).siblings(".inside").slideToggle(); |
  | 142 | 142 | }); |
  | 143 | 143 | jQuery(".postbox").on('click', '.hndle', function(){ |
  | 144 | 144 | jQuery(this).siblings(".inside").slideToggle(); |
  | 145 | 145 | }); |
  | 146 | 146 |  |
  | 147 | 147 | }); |
  | 148 | 148 | </script> |
  | 149 | 149 | <style type="text/css"> |
  | 150 | 150 | .CodeMirror{border: 1px solid #eee;height: auto;} |
  | 151 | 151 | .customDashicons{color: #444444!important;box-sizing: content-box;padding: 15px;width: 40px;height: 40px;white-space: nowrap;font-size: 40px;line-height: 1;cursor: pointer;float: left;} |
  | 152 | 152 | </style> |
  | 153 | 153 | <div id="wpcf7-general" class="wrap"> |
  | 154 | 154 |  |
  | 155 | 155 | <h2 style="font-size: 23px;font-weight: 400;padding: 9px 15px 4px 0px;line-height: 29px;"> |
  | 156 | 156 | <?php esc\_html\_e('Send PDF for Contact Form 7 - Settings', 'send-pdf-for-contact-form-7'); ?><sup>V.<?php echo esc\_html(WPCF7PDF\_VERSION); ?></sup> |
  | 157 | 157 | </h2> |
  | 158 | 158 |  |
  | 159 | 159 | <?php if ( is\_plugin\_active( 'contact-form-7/wp-contact-form-7.php' ) ) { ?> |
  | 160 | 160 | <div id="wpcf7-bandeau"> |
  | 161 | 161 | <table width="100%" cellspacing="20"> |
  | 162 | 162 | <tr> |
  | 163 | 163 | <td style="text-align:center;" valign="middle" width="33%"> |
  | 164 | 164 | <?php |
  | 165 | 165 | $forms = WPCF7\_ContactForm::find(); |
  | 166 | 166 | if ( count($forms) == 0 ) { |
  | 167 | 167 | /\* translators: %s: lien pour créer un formulaire \*/ |
  | 168 | 168 | printf( esc\_html\_\_('No forms have not been found. %s', 'send-pdf-for-contact-form-7'), '<a href="'.esc\_url(admin\_url('admin.php?page=wpcf7')).'">'.esc\_html\_\_('Create your first form here.', 'send-pdf-for-contact-form-7').'</a>'); |
  | 169 | 169 | } else { |
  | 170 | 170 | ?> |
  | 171 | 171 | <form method="post" action="<?php echo esc\_url($\_SERVER['REQUEST\_URI']); ?>" name="displayform" id="displayform"> |
  | 172 | 172 | <input type="hidden" name="page" value="wpcf7-send-pdf"/> |
  | 173 | 173 | <?php wp\_nonce\_field('go-sendform', 'security-sendform'); ?> |
  | 174 | 174 | <select name="idform" id="idform" class="wpcf7-form-field" onchange="this.form.submit();"> |
  | 175 | 175 | <option value=""><?php esc\_html\_e('... Select a form ...', 'send-pdf-for-contact-form-7'); ?></option> |
  | 176 | 176 | <?php |
  | 177 | 177 | $selected = ''; |
  | 178 | 178 |  |
  | 179 | 179 | foreach($forms as $form) { |
  | 180 | 180 | if(isset($\_POST['idform']) ) { |
  | 181 | 181 | $selected = ($form->id() == sanitize\_text\_field($\_POST['idform'])) ? "selected" : ""; |
  | 182 | 182 | } |
  | 183 | 183 | $formPriority = ''; |
  | 184 | 184 | $formNameEscaped = htmlentities($form->title(), ENT\_QUOTES | ENT\_IGNORE, 'UTF-8'); |
  | 185 | 185 | echo '<option value="'.esc\_html($form->id()).'" '.esc\_html($selected).'>'.esc\_html($formNameEscaped).'</option>'; |
  | 186 | 186 | } |
  | 187 | 187 | ?> |
  | 188 | 188 | </select> |
  | 189 | 189 | </form> |
  | 190 | 190 | <?php |
  | 191 | 191 | if( $tmpDirectory != get\_option('wpcf7pdf\_path\_temp') ) { |
  | 192 | 192 | esc\_html\_e('Your TMP folder is bad.', 'send-pdf-for-contact-form-7'); |
  | 193 | 193 | ?> |
  | 194 | 194 | <form method="post" action="<?php echo esc\_url($\_SERVER['REQUEST\_URI']); ?>" name="resettmp" id="resettmp"> |
  | 195 | 195 | <?php wp\_nonce\_field('go-resettmp', 'security-resettmp'); ?> |
  | 196 | 196 | <input type="hidden" name="action" value="reset"/> |
  | 197 | 197 | <input type="submit" value="<?php esc\_html\_e('Fix it!', 'send-pdf-for-contact-form-7'); ?>" style="background-color:#656830;color:#fff;border:1px solid #656830;" /> |
  | 198 | 198 | </form> |
  | 199 | 199 | <?php |
  | 200 | 200 | } |
  | 201 | 201 | ?> |
  | 202 | 202 | <?php } ?> |
  | 203 | 203 | </td> |
  | 204 | 204 | <td style="text-align:center;" width="33%"> |
  | 205 | 205 | <div id="wpmimgcreated"> |
  | 206 | 206 | <a href="https://MadeBy.RestezConnectes.fr" title="Created by MadeByRestezConnectes.fr" class="wpcf7-link" alt="Created by MadeByRestezConnectes.fr" target="\_blank" onfocus="this.blur();"><img class="wpmresponsive" src="<?php echo esc\_url(plugins\_url('send-pdf-for-contact-form-7/images/logo-madeby-restezconnectes.png')); ?>" width="250" valign="bottom"  /></a> |
  | 207 | 207 | </div> |
  | 208 | 208 | <p><?php /\* translators: %s: lien pour lire le tutoriel \*/ printf( esc\_html\_\_('Read %s here !', 'send-pdf-for-contact-form-7'), '<a href="https://restezconnectes.fr/tutoriel-wordpress-lextension-send-pdf-for-contact-form-7/" class="wpcf7-link" target="\_blank" onfocus="this.blur();">'.esc\_html\_\_('Tutorial', 'send-pdf-for-contact-form-7').'</a>' ); ?> -  <a href="https://github.com/Florent73/send-pdf-for-contact-form-7/" class="wpcf7-link" target="\_blank" onfocus="this.blur();"><?php esc\_html\_e('GitHub version', 'send-pdf-for-contact-form-7'); ?></a></p> |
  | 209 | 209 | </td> |
  | 210 | 210 | <td style="text-align:right;" width="33%"> |
  | 211 | 211 | <!-- FAIRE UN DON SUR PAYPAL --> |
  | 212 | 212 | <div style="font-size:0.8em;"> |
  | 213 | 213 | <div style="width:350px;margin-left:auto;margin-right:auto;padding:5px;"> |
  | 214 | 214 | <a href="https://paypal.me/RestezConnectes/10" onfocus="this.blur();" target="\_blank" class="wpcf7pdfclassname"> |
  | 215 | 215 | <img src="<?php echo esc\_url(plugins\_url('send-pdf-for-contact-form-7/images/donate.png')); ?>" valign="bottom" width="64" /> <?php esc\_html\_e('Donate now!', 'send-pdf-for-contact-form-7'); ?> |
  | 216 | 216 | </a> |
  | 217 | 217 | </div> |
  | 218 | 218 | </div> |
  | 219 | 219 | <!-- FIN FAIRE UN DON --> |
  | 220 | 220 | </td> |
  | 221 | 221 | </tr> |
  | 222 | 222 | </table> |
  | 223 | 223 | </div> |
  | 224 | 224 |  |
  | 225 | 225 | <?php |
  | 226 | 226 | if( isset($\_POST['idform']) && ( (isset( $\_REQUEST['security-sendform'] ) && wp\_verify\_nonce($\_POST['security-sendform'], 'go-sendform')) || (isset( $\_REQUEST['wpcf7\_import\_nonce'] ) && wp\_verify\_nonce($\_POST['wpcf7\_import\_nonce'], 'go\_import\_nonce'))) ) { |
  | 227 | 227 |  |
  | 228 | 228 | $idForm = esc\_html($\_POST['idform']); |
  | 229 | 229 | $meta\_values = get\_post\_meta( $idForm, '\_wp\_cf7pdf', true ); |
  | 230 | 230 | $meta\_form = get\_post\_meta( $idForm, '\_form', true); |
  | 231 | 231 |  |
  | 232 | 232 | // Genere le nom du PDF |
  | 233 | 233 | $nameOfPdf = cf7\_sendpdf::wpcf7pdf\_name\_pdf($idForm); |
  | 234 | 234 |  |
  | 235 | 235 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 236 | 236 | /\*\*\*\*\*\*\*\* ON GENERE UN PDF DE PREVIEW \*\*\*\*\*\*\*\*\*/ |
  | 237 | 237 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
  | 238 | 238 | // On récupère le dossier upload de WP |
  | 239 | 239 | $upload\_dir = wp\_upload\_dir(); |
  | 240 | 240 | $createDirectory = cf7\_sendpdf::wpcf7pdf\_folder\_uploads($idForm); |
  | 241 | 241 |  |
  | 242 | 242 | // On récupère le format de date dans les paramètres |
  | 243 | 243 | $date\_format = get\_option( 'date\_format' ); |
  | 244 | 244 | $hour\_format = get\_option( 'time\_format' ); |
  | 245 | 245 |  |
  | 246 | 246 | // Definition des marges par defaut |
  | 247 | 247 | $marginHeader = 10; |
  | 248 | 248 | $marginTop = 40; |
  | 249 | 249 | $marginBottomHeader = 10; |
  | 250 | 250 | $marginLeft = 15; |
  | 251 | 251 | $marginRight = 15; |
  | 252 | 252 |  |
  | 253 | 253 | // Definition de la taille, le format de page et la font par defaut |
  | 254 | 254 | $fontsizePdf = 9; |
  | 255 | 255 | $fontPdf = 'dejavusanscondensed'; |
  | 256 | 256 | $formatPdf = 'A4-P'; |
  | 257 | 257 |  |
  | 258 | 258 | // Definition des dates par defaut |
  | 259 | 259 | $dateField = WPCF7PDF\_prepare::returndate($idForm); |
  | 260 | 260 | $timeField = WPCF7PDF\_prepare::returntime($idForm); |
  | 261 | 261 |  |
  | 262 | 262 | // Definition des dimensions du logo par defaut |
  | 263 | 263 | $width = 150; |
  | 264 | 264 | $height = 80; |
  | 265 | 265 |  |
  | 266 | 266 | // On efface l'ancien pdf renommé si il y a (on garde l'original) |
  | 267 | 267 | if( file\_exists($createDirectory.'/preview.pdf') ) { |
  | 268 | 268 | wp\_delete\_file($createDirectory.'/preview.pdf'); |
  | 269 | 269 | } |
  | 270 | 270 |  |
  | 271 | 271 | if( isset($meta\_values['generate\_pdf']) && !empty($meta\_values['generate\_pdf']) ) { |
  | 272 | 272 |  |
  | 273 | 273 | // définit le contenu du PDf |
  | 274 | 274 | $messageText = wp\_kses(trim($meta\_values['generate\_pdf']), WPCF7PDF\_prepare::wpcf7pdf\_autorizeHtml()); |
  | 275 | 275 |  |
  | 276 | 276 | // Preparation du contenu du PDF |
  | 277 | 277 | $messageText = WPCF7PDF\_prepare::tags\_parser($idForm, $nameOfPdf, '', $messageText, 0, 1); |
  | 278 | 278 |  |
  | 279 | 279 | // Shortcodes? |
  | 280 | 280 | $messageText = WPCF7PDF\_prepare::shortcodes($meta\_values['shotcodes\_tags'], $messageText); |
  | 281 | 281 | /\*error\_log('---- DEBUG ----'); |
  | 282 | 282 | error\_log(print\_r($messageText, true)); |
  | 283 | 283 | error\_log('---- FIN DEBUG ----');\*/ |
  | 284 | 284 | // En cas de plusieurs document à générer |
  | 285 | 285 | /\* preg\_match\_all('/\[add\_document([^\]]\*)\]/m', $messageText, $matches, PREG\_SET\_ORDER, 0); |
  | 286 | 286 | if( $matches ) { |
  | 287 | 287 |  |
  | 288 | 288 | foreach($matches as $document) { |
  | 289 | 289 | // Print the entire match result |
  | 290 | 290 | preg\_match\_all('/\"([^\]]\*)\"/m', $document[1], $suffix, PREG\_SET\_ORDER, 0); |
  | 291 | 291 | var\_dump = $suffix[0][1]; |
  | 292 | 292 | } |
  | 293 | 293 | } else { |
  | 294 | 294 |  |
  | 295 | 295 | $generatePdfFile = WPCF7PDF\_generate::wpcf7pdf\_create\_pdf($idForm, $messageText, $nameOfPdf, $createDirectory, 1); |
  | 296 | 296 | }\*/ |
  | 297 | 297 |  |
  | 298 | 298 | $generatePdfFile = WPCF7PDF\_generate::wpcf7pdf\_create\_pdf($idForm, $messageText, $nameOfPdf, '', $createDirectory, 1); |
  | 299 | 299 |  |
  | 300 | 300 | } |
  | 301 | 301 | if( isset($meta\_values["disable-csv"]) && $meta\_values['disable-csv'] == 'false') { |
  | 302 | 302 | $generateCsvFile = WPCF7PDF\_generate::wpcf7pdf\_create\_csv($idForm, $nameOfPdf, '', $createDirectory, 1); |
  | 303 | 303 | } |
  | 304 | 304 | // Contenu PDF par default |
  | 305 | 305 | $messagePdf = ' |
  | 306 | 306 | <p>Votre nom : [your-name]</p> |
  | 307 | 307 |  |
  | 308 | 308 | <p>Votre email : [your-email]</p> |
  | 309 | 309 |  |
  | 310 | 310 | <p>Sujet : [your-subject] </p> |
  | 311 | 311 |  |
  | 312 | 312 | <p>Votre message : [your-message]</p> |
  | 313 | 313 |  |
  | 314 | 314 | '; |
  | 315 | 315 |  |
  | 316 | 316 | // Liste Fonts |
  | 317 | 317 | $listFont = WPCF7PDF\_settings::getFontsTab(); |
  | 318 | 318 |  |
  | 319 | 319 | // Si custom fonts dans dossiers /pdffonts |
  | 320 | 320 | $pathFolder = serialize($createDirectory); |
  | 321 | 321 | if ( is\_dir(get\_stylesheet\_directory()."/pdffonts/") == true ) { |
  | 322 | 322 |  |
  | 323 | 323 | $dossier = new DirectoryIterator(get\_stylesheet\_directory()."/pdffonts/"); |
  | 324 | 324 |  |
  | 325 | 325 | foreach($dossier as $fichier){ |
  | 326 | 326 |  |
  | 327 | 327 | // continue; |
  | 328 | 328 | if(preg\_match("#\.(ttf)$#i", $fichier)){ |
  | 329 | 329 |  |
  | 330 | 330 | //on fusionne les fonts avec ceux définis dans getFontsTab() |
  | 331 | 331 | $addFontData = array( |
  | 332 | 332 | ''.substr($fichier->getFilename(), 0, -4).'' => ''.sanitize\_title(substr($fichier->getFilename(), 0, -4)).'', |
  | 333 | 333 | ); |
  | 334 | 334 | $listFont = array\_merge($listFont, $addFontData); |
  | 335 | 335 | } |
  | 336 | 336 | } |
  | 337 | 337 | } |
  | 338 | 338 | ?> |
  | 339 | 339 |  |
  | 340 | 340 | <form method="post" action="" name="valide\_settings"> |
  | 341 | 341 |  |
  | 342 | 342 | <input type="hidden" name="action" value="update" /> |
  | 343 | 343 | <input type="hidden" name="idform" value="<?php echo esc\_html($idForm); ?>"/> |
  | 344 | 344 | <input type="hidden" name="path\_uploads" value="<?php echo esc\_url($pathFolder); ?>" /> |
  | 345 | 345 | <?php wp\_nonce\_field('go-sendform', 'security-sendform'); ?> |
  | 346 | 346 |  |
  | 347 | 347 | <div style="text-align:right;"> |
  | 348 | 348 | <p> |
  | 349 | 349 | <input type="submit" name="wp\_cf7pdf\_update\_settings" class="button-primary" value="<?php esc\_html\_e('Save settings', 'send-pdf-for-contact-form-7'); ?>"/> |
  | 350 | 350 | <?php if( file\_exists($createDirectory.'/preview-'.esc\_html($idForm).'.pdf') ) { ?> |
  | 351 | 351 | <a class="button button-secondary" target="\_blank" href="<?php echo esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory)).'/preview-'.esc\_html($idForm).'.pdf?ver='.esc\_html(wp\_rand()); ?>" ><?php esc\_html\_e('Preview your PDF', 'send-pdf-for-contact-form-7'); ?></a> |
  | 352 | 352 | <?php } ?> |
  | 353 | 353 | </p> |
  | 354 | 354 | </div> |
  | 355 | 355 |  |
  | 356 | 356 | <!-- PARAMETRES GENERAUX --> |
  | 357 | 357 | <div class="postbox"> |
  | 358 | 358 | <div class="handlediv" style="height:1px!important;" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><br></div> |
  | 359 | 359 | <span class="dashicons customDashicons dashicons-admin-settings"></span> <h3 class="hndle" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e('General Settings', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 360 | 360 | <div class="inside"> |
  | 361 | 361 |  |
  | 362 | 362 | <!-- Disable GENERATE PDF --> |
  | 363 | 363 | <table class="wp-list-table widefat fixed" cellspacing="0"> |
  | 364 | 364 | <tbody id="the-list"> |
  | 365 | 365 |  |
  | 366 | 366 | <tr> |
  | 367 | 367 | <td style="vertical-align: middle;margin-top:15px;"><?php esc\_html\_e('Disable generate PDF?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 368 | 368 | <td style="text-align:left;"> |
  | 369 | 369 | <div> |
  | 370 | 370 | <div class="switch-field"> |
  | 371 | 371 | <input class="switch\_left" type="radio" id="switch\_left" name="wp\_cf7pdf\_settings[disable-pdf]" value="true" <?php if( isset($meta\_values["disable-pdf"]) && $meta\_values["disable-pdf"]=='true') { echo ' checked'; } ?>/> |
  | 372 | 372 | <label for="switch\_left"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 373 | 373 | <input class="switch\_right" type="radio" id="switch\_right" name="wp\_cf7pdf\_settings[disable-pdf]" value="false" <?php if( empty($meta\_values["disable-pdf"]) || (isset($meta\_values["disable-pdf"]) && $meta\_values["disable-pdf"]=='false') ) { echo ' checked'; } ?> /> |
  | 374 | 374 | <label for="switch\_right"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 375 | 375 | </div> |
  | 376 | 376 | </div> |
  | 377 | 377 | </td> |
  | 378 | 378 | </tr> |
  | 379 | 379 | <tr> |
  | 380 | 380 | <td><?php esc\_html\_e('Who send the PDF file?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 381 | 381 | <td> |
  | 382 | 382 | <select name="wp\_cf7pdf\_settings[send-attachment]" class="wpcf7-form-field"> |
  | 383 | 383 | <option value="sender"<?php if( isset($meta\_values["send-attachment"]) && $meta\_values["send-attachment"] == "sender" ) { echo ' selected'; } ?>><?php esc\_html\_e('Sender', 'send-pdf-for-contact-form-7'); ?></option> |
  | 384 | 384 | <option value="recipient"<?php if( isset($meta\_values["send-attachment"]) && $meta\_values["send-attachment"] == "recipient" ) { echo ' selected'; } ?>><?php esc\_html\_e('Recipient', 'send-pdf-for-contact-form-7'); ?></option> |
  | 385 | 385 | <option value="both"<?php if( (isset($meta\_values["send-attachment"]) && $meta\_values["send-attachment"] == "both") || empty($meta\_values["send-attachment"]) ) { echo ' selected'; } ?>><?php esc\_html\_e('Both', 'send-pdf-for-contact-form-7'); ?></option> |
  | 386 | 386 | </select> |
  | 387 | 387 | </td> |
  | 388 | 388 | </tr> |
  | 389 | 389 | <tr><td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td></tr> |
  | 390 | 390 | <tr style="vertical-align: middle;margin-top:15px;"> |
  | 391 | 391 | <td><?php esc\_html\_e("Disable data submit in a database?", 'send-pdf-for-contact-form-7'); ?></td> |
  | 392 | 392 | <td style="text-align:left;"> |
  | 393 | 393 | <div> |
  | 394 | 394 | <div class="switch-field"> |
  | 395 | 395 | <input class="switch\_left" type="radio" id="switch\_insert" name="wp\_cf7pdf\_settings[disable-insert]" value="true" <?php if( isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='true') { echo ' checked'; } ?>/> |
  | 396 | 396 | <label for="switch\_insert"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 397 | 397 | <input class="switch\_right" type="radio" id="switch\_insert\_no" name="wp\_cf7pdf\_settings[disable-insert]" value="false" <?php if( empty($meta\_values["disable-insert"]) || (isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='false') ) { echo ' checked'; } ?> /> |
  | 398 | 398 | <label for="switch\_insert\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 399 | 399 | </div> |
  | 400 | 400 | </div> |
  | 401 | 401 | </td> |
  | 402 | 402 | </tr> |
  | 403 | 403 | <tr> |
  | 404 | 404 | <td><?php esc\_html\_e('Truncate database?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 405 | 405 | <td> |
  | 406 | 406 | <div> |
  | 407 | 407 | <div class="switch-field"> |
  | 408 | 408 | <input class="switch\_left" type="radio" id="switch\_truncate" name="truncate\_table" value="true" /> |
  | 409 | 409 | <label for="switch\_truncate"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 410 | 410 | <input class="switch\_right" type="radio" id="switch\_truncate\_no" name="truncate\_table" value="false" checked /> |
  | 411 | 411 | <label for="switch\_truncate\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 412 | 412 | </div> |
  | 413 | 413 | </div> |
  | 414 | 414 | </td> |
  | 415 | 415 | </tr> |
  | 416 | 416 | <tr><td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td></tr> |
  | 417 | 417 | <tr> |
  | 418 | 418 | <td><?php esc\_html\_e('Disable generate CSV file?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 419 | 419 | <td> |
  | 420 | 420 | <div> |
  | 421 | 421 | <div class="switch-field"> |
  | 422 | 422 | <input class="switch\_left" type="radio" id="switch\_csv" name="wp\_cf7pdf\_settings[disable-csv]" value="true" <?php if( isset($meta\_values["disable-csv"]) && $meta\_values["disable-csv"]=='true') { echo ' checked'; } ?>/> |
  | 423 | 423 | <label for="switch\_csv"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 424 | 424 | <input class="switch\_right" type="radio" id="switch\_csv\_no" name="wp\_cf7pdf\_settings[disable-csv]" value="false" <?php if( empty($meta\_values["disable-csv"]) || (isset($meta\_values["disable-csv"]) && $meta\_values["disable-csv"]=='false') ) { echo ' checked'; } ?> /> |
  | 425 | 425 | <label for="switch\_csv\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 426 | 426 | </div> |
  | 427 | 427 | </div> |
  | 428 | 428 | </td> |
  | 429 | 429 | </tr> |
  | 430 | 430 | <tr> |
  | 431 | 431 | <td><?php esc\_html\_e('Who send the CSV file?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 432 | 432 | <td> |
  | 433 | 433 | <select name="wp\_cf7pdf\_settings[send-attachment2]" class="wpcf7-form-field"> |
  | 434 | 434 | <option value="sender"<?php if( isset($meta\_values["send-attachment2"]) && isset($meta\_values["send-pdf"]) && $meta\_values["send-pdf"] == "sender" ) { echo ' selected'; } ?>><?php esc\_html\_e('Sender', 'send-pdf-for-contact-form-7'); ?></option> |
  | 435 | 435 | <option value="recipient"<?php if( isset($meta\_values["send-attachment2"]) && $meta\_values["send-attachment2"] == "recipient" ) { echo ' selected'; } ?>><?php esc\_html\_e('Recipient', 'send-pdf-for-contact-form-7'); ?></option> |
  | 436 | 436 | <option value="both"<?php if( (isset($meta\_values["send-attachment2"]) && $meta\_values["send-attachment2"] == "both") || empty($meta\_values["send-attachment2"]) ) { echo ' selected'; } ?>><?php esc\_html\_e('Both', 'send-pdf-for-contact-form-7'); ?></option> |
  | 437 | 437 | </select> |
  | 438 | 438 | </td> |
  | 439 | 439 | </tr> |
  | 440 | 440 | <tr> |
  | 441 | 441 | <td><?php esc\_html\_e('Change CSV separator', 'send-pdf-for-contact-form-7'); ?><br /> |
  | 442 | 442 | <p><i><?php esc\_html\_e("By defaut it's separated by commas", 'send-pdf-for-contact-form-7'); ?></i></p></td> |
  | 443 | 443 | <td><input size="3" type= "text" name="wp\_cf7pdf\_settings[csv-separate]" class="wpcf7-form-field" value="<?php if( isset($meta\_values["csv-separate"]) && !empty($meta\_values["csv-separate"]) ) { echo esc\_html($meta\_values["csv-separate"]); } else { echo ','; } ?>" /></td> |
  | 444 | 444 | </tr> |
  | 445 | 445 | <tr><td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td></tr> |
  | 446 | 446 | <tr> |
  | 447 | 447 | <td> |
  | 448 | 448 | <?php esc\_html\_e('Enter a name for your PDF', 'send-pdf-for-contact-form-7'); ?><p>(<i><?php esc\_html\_e("By default, the file's name will be 'document-pdf'", 'send-pdf-for-contact-form-7'); ?></i>)</p> |
  | 449 | 449 | <br /> |
  | 450 | 450 | <p><?php esc\_html\_e("You can use this tags (separated by commas):", 'send-pdf-for-contact-form-7'); ?></p> |
  | 451 | 451 | <p> |
  | 452 | 452 | <span class="dashicons dashicons-arrow-right"></span> <?php /\* translators: %s: tag [reference] \*/ echo sprintf( esc\_html\_\_('Use %s in the name of your PDF', 'send-pdf-for-contact-form-7'), ' <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[reference]</strong></span>' ); ?><br /> |
  | 453 | 453 | <span class="dashicons dashicons-arrow-right"></span> <?php /\* translators: %s: tag [date] \*/ echo sprintf( esc\_html\_\_('Use %s in the name of your PDF', 'send-pdf-for-contact-form-7'), ' <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[date]</strong></span>' ); ?><br /> |
  | 454 | 454 | <?php |
  | 455 | 455 | if( isset($meta\_values["date-for-name"]) && !empty($meta\_values["date-for-name"]) ) { |
  | 456 | 456 | $dateForName = $meta\_values["date-for-name"]; |
  | 457 | 457 | } else { |
  | 458 | 458 | $dateForName = get\_option( 'date\_format' ); |
  | 459 | 459 | } |
  | 460 | 460 | $dateForName = str\_replace('-', '', $dateForName); |
  | 461 | 461 | $dateForName = str\_replace(' ', '', $dateForName); |
  | 462 | 462 | $dateForName = str\_replace('/', '', $dateForName); |
  | 463 | 463 | ?> |
  | 464 | 464 | &nbsp;&nbsp;<small><?php esc\_html\_e('Enter date format without space, -, /, \_, etc..', 'send-pdf-for-contact-form-7'); ?></small><input size="5" type= "text" name="wp\_cf7pdf\_settings[date-for-name]" value="<?php echo esc\_html($dateForName); ?>" /> <?php echo esc\_html(date\_i18n($dateForName), current\_time('timestamp')); ?> |
  | 465 | 465 | </p> |
  | 466 | 466 |  |
  | 467 | 467 | </td> |
  | 468 | 468 | <td> |
  | 469 | 469 | <input type= "text" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[pdf-name]" value="<?php if( isset($meta\_values["pdf-name"]) && !empty($meta\_values["pdf-name"]) ) { echo esc\_html(sanitize\_title($meta\_values["pdf-name"])); } else { echo esc\_html('document-pdf'); } ?>">.pdf<br /><br /><br /> |
  | 470 | 470 | <input type="text" class="wpcf7-form-field" size="30" name="wp\_cf7pdf\_settings[pdf-add-name]" value="<?php if( isset($meta\_values["pdf-add-name"]) && !empty($meta\_values["pdf-add-name"]) ) { echo esc\_html($meta\_values["pdf-add-name"]); } ?>" /> |
  | 471 | 471 | </td> |
  | 472 | 472 |  |
  | 473 | 473 | </tr> |
  | 474 | 474 | <tr> |
  | 475 | 475 | <td> |
  | 476 | 476 | <?php esc\_html\_e('Change uploads folder?', 'send-pdf-for-contact-form-7'); ?><p>(<i><?php if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='true') { esc\_html\_e("Great ! Now the upload folder's path is /wp-content/uploads/sendpdfcf7\_uploads/\*ID\_FORM\*/", 'send-pdf-for-contact-form-7'); } else { esc\_html\_e("By default, the upload folder's path is /wp-content/uploads/\*YEAR\*/\*MONTH\*/", 'send-pdf-for-contact-form-7'); } ?></i>)</p> |
  | 477 | 477 | </td> |
  | 478 | 478 | <td> |
  | 479 | 479 | <div> |
  | 480 | 480 | <div class="switch-field"> |
  | 481 | 481 | <input class="switch\_left" type="radio" id="switch\_uploads" name="wp\_cf7pdf\_settings[pdf-uploads]" value="true" <?php if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='true') { echo ' checked'; } ?>/> |
  | 482 | 482 | <label for="switch\_uploads"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 483 | 483 | <input class="switch\_right" type="radio" id="switch\_uploads\_no" name="wp\_cf7pdf\_settings[pdf-uploads]" value="false" <?php if( empty($meta\_values["pdf-uploads"]) || (isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='false') ) { echo ' checked'; } ?> /> |
  | 484 | 484 | <label for="switch\_uploads\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 485 | 485 | </div> |
  | 486 | 486 | </div> |
  | 487 | 487 | </td> |
  | 488 | 488 | </tr> |
  | 489 | 489 | <tr> |
  | 490 | 490 | <td> |
  | 491 | 491 | <?php esc\_html\_e('Delete all files into this uploads folder?', 'send-pdf-for-contact-form-7'); ?><?php if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='false') { ?><p><i style="color:#CC0000;">I can't deleted all files in this folder. Only in my folder. Thanks to check 'Change uploads folder?' option for this.</i></p><?php } ?> |
  | 492 | 492 | </td> |
  | 493 | 493 | <td><?php if( isset($meta\_values["pdf-uploads"]) && $meta\_values["pdf-uploads"]=='true') { ?> |
  | 494 | 494 | <div> |
  | 495 | 495 | <div class="switch-field"> |
  | 496 | 496 | <input class="switch\_left" type="radio" id="switch\_delete" name="wp\_cf7pdf\_settings[pdf-uploads-delete]" value="true" /> |
  | 497 | 497 | <label for="switch\_delete"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 498 | 498 | <input class="switch\_right" type="radio" id="switch\_delete\_no" name="wp\_cf7pdf\_settings[pdf-uploads-delete]" value="false" checked /> |
  | 499 | 499 | <label for="switch\_delete\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 500 | 500 | </div> |
  | 501 | 501 | </div> |
  | 502 | 502 | <?php } else { ?> |
  | 503 | 503 | <img src="<?php echo esc\_url(WPCF7PDF\_URL.'images/btn\_off.png'); ?>" /><br /> |
  | 504 | 504 | <input type="hidden" name="wp\_cf7pdf\_settings[pdf-uploads-delete]" value="false" /> |
  | 505 | 505 | <?php } ?> |
  | 506 | 506 | </td> |
  | 507 | 507 | </tr> |
  | 508 | 508 | <tr> |
  | 509 | 509 | <td> |
  | 510 | 510 | <?php esc\_html\_e('Delete each PDF file after send the email?', 'send-pdf-for-contact-form-7'); ?><?php if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=='true') { ?><p><i style="color:#CC0000;">I can't deleted each PDF file because the 'Redirects directly to the PDF after sending the form?' option is activated.</i></p><?php } ?> |
  | 511 | 511 | </td> |
  | 512 | 512 | <td> |
  | 513 | 513 | <?php if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=='false') { ?> |
  | 514 | 514 | <div class="switch-field"> |
  | 515 | 515 | <input class="switch\_left" type="radio" id="switch\_filedelete" name="wp\_cf7pdf\_settings[pdf-file-delete]" value="true" <?php if( isset($meta\_values["pdf-uploads-delete"]) && $meta\_values["pdf-file-delete"]=='true') { echo ' checked'; } ?>/> |
  | 516 | 516 | <label for="switch\_filedelete"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 517 | 517 | <input class="switch\_right" type="radio" id="switch\_filedelete\_no" name="wp\_cf7pdf\_settings[pdf-file-delete]" value="false" <?php if( (empty($meta\_values["pdf-file-delete"]) || (isset($meta\_values["pdf-file-delete"]) && $meta\_values["pdf-file-delete"]=='false')) || isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=='true' ) { echo ' checked'; } ?> /> |
  | 518 | 518 | <label for="switch\_filedelete\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 519 | 519 | </div> |
  | 520 | 520 | </div> |
  | 521 | 521 | <?php } else { ?> |
  | 522 | 522 | <img src="<?php echo esc\_url(WPCF7PDF\_URL.'images/btn\_off.png'); ?>" /><br /> |
  | 523 | 523 | <input type="hidden" name="wp\_cf7pdf\_settings[pdf-file-delete]" value="false" /> |
  | 524 | 524 | <?php } ?> |
  | 525 | 525 | <div> |
  | 526 | 526 | </td> |
  | 527 | 527 | </tr> |
  | 528 | 528 | <tr><td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td></tr> |
  | 529 | 529 | <tr> |
  | 530 | 530 | <td><?php esc\_html\_e('Other files attachments?', 'send-pdf-for-contact-form-7'); ?><p>(<i><?php esc\_html\_e("Enter one URL file by line", 'send-pdf-for-contact-form-7'); ?></i>)</p><textarea class="wpcf7-form-field" cols="100%" rows="5" name="wp\_cf7pdf\_settings[pdf-files-attachments]"><?php if( isset($meta\_values["pdf-files-attachments"]) ) { echo esc\_textarea($meta\_values["pdf-files-attachments"]); } ?></textarea> |
  | 531 | 531 | </td> |
  | 532 | 532 | </tr> |
  | 533 | 533 | <tr> |
  | 534 | 534 | <td><?php esc\_html\_e('Who send the attachments file?', 'send-pdf-for-contact-form-7'); ?></td> |
  | 535 | 535 | <td> |
  | 536 | 536 | <select name="wp\_cf7pdf\_settings[send-attachment3]" class="wpcf7-form-field" > |
  | 537 | 537 | <option value="sender"<?php if( isset($meta\_values["send-attachment3"]) && isset($meta\_values["send-pdf"]) && $meta\_values["send-pdf"] == "sender" ) { echo ' selected'; } ?>><?php esc\_html\_e('Sender', 'send-pdf-for-contact-form-7'); ?></option> |
  | 538 | 538 | <option value="recipient"<?php if( isset($meta\_values["send-attachment3"]) && $meta\_values["send-attachment3"] == "recipient" ) { echo ' selected'; } ?>><?php esc\_html\_e('Recipient', 'send-pdf-for-contact-form-7'); ?></option> |
  | 539 | 539 | <option value="both"<?php if( (isset($meta\_values["send-attachment2"]) && $meta\_values["send-attachment3"] == "both") || empty($meta\_values["send-attachment3"]) ) { echo ' selected'; } ?>><?php esc\_html\_e('Both', 'send-pdf-for-contact-form-7'); ?></option> |
  | 540 | 540 | </select> |
  | 541 | 541 | </td> |
  | 542 | 542 | </tr> |
  | 543 | 543 | <tr><td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td></tr> |
  | 544 | 544 | <tr> |
  | 545 | 545 | <td> |
  | 546 | 546 | <?php esc\_html\_e('Select a page to display after sending the form (optional)', 'send-pdf-for-contact-form-7'); ?> |
  | 547 | 547 | </td> |
  | 548 | 548 | <td><?php if( isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='false') { ?> |
  | 549 | 549 | <?php |
  | 550 | 550 | if( isset($meta\_values['page\_next']) ) { |
  | 551 | 551 | $idSelectPage = $meta\_values['page\_next']; |
  | 552 | 552 | } else { |
  | 553 | 553 | $idSelectPage = 0; |
  | 554 | 554 | } |
  | 555 | 555 | wp\_dropdown\_pages( array( |
  | 556 | 556 | 'name' => 'wp\_cf7pdf\_settings[page\_next]', |
  | 557 | 557 | 'class' => 'wpcf7-form-field', |
  | 558 | 558 | 'show\_option\_none' => esc\_html(\_\_('Please select a page', 'send-pdf-for-contact-form-7')), |
  | 559 | 559 | 'option\_none\_value' => '0', |
  | 560 | 560 | 'selected' => esc\_html($idSelectPage), |
  | 561 | 561 | )); |
  | 562 | 562 | ?> |
  | 563 | 563 | <?php } else { ?> |
  | 564 | 564 | <img src="<?php echo esc\_url(WPCF7PDF\_URL.'images/select\_off.png'); ?>" /><br /> |
  | 565 | 565 | <input type="hidden" name="wp\_cf7pdf\_settings[page\_next]" value="0" /> |
  | 566 | 566 | <?php } ?> |
  | 567 | 567 | </td> |
  | 568 | 568 | </tr> |
  | 569 | 569 | <tr> |
  | 570 | 570 | <td><!-- Rediriger sur cette page sans envoyer un e-mail? --> |
  | 571 | 571 | <?php esc\_html\_e('Send email without attachments?', 'send-pdf-for-contact-form-7'); ?><p></p> |
  | 572 | 572 | </td> |
  | 573 | 573 | <td> |
  | 574 | 574 | <div> |
  | 575 | 575 | <div class="switch-field"> |
  | 576 | 576 | <input class="switch\_left" type="radio" id="switch\_attachments" name="wp\_cf7pdf\_settings[disable-attachments]" value="true" <?php if( isset($meta\_values["disable-attachments"]) && $meta\_values["disable-attachments"]=='true') { echo ' checked'; } ?>/> |
  | 577 | 577 | <label for="switch\_attachments"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 578 | 578 | <input class="switch\_right" type="radio" id="switch\_attachments\_no" name="wp\_cf7pdf\_settings[disable-attachments]" value="false" <?php if( empty($meta\_values["disable-attachments"]) || (isset($meta\_values["disable-attachments"]) && $meta\_values["disable-attachments"]=='false') ) { echo ' checked'; } ?> /> |
  | 579 | 579 | <label for="switch\_attachments\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 580 | 580 | </div> |
  | 581 | 581 | </div> |
  | 582 | 582 | </td> |
  | 583 | 583 | </tr> |
  | 584 | 584 | <tr> |
  | 585 | 585 | <td><!-- Propose la redirection vers le pdf direct --> |
  | 586 | 586 | <?php esc\_html\_e('Redirects directly to the PDF after sending the form?', 'send-pdf-for-contact-form-7'); ?> |
  | 587 | 587 | <p><i><?php esc\_html\_e( 'This option disable the Page Redirection selected', 'send-pdf-for-contact-form-7'); ?> (<?php esc\_html\_e( 'Except the popup window option', 'send-pdf-for-contact-form-7'); ?>)</i></p><?php if( (isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='true') || (isset($meta\_values["pdf-file-delete"]) && $meta\_values["pdf-file-delete"]=='true') ) { ?><p><i style="color:#CC0000;">I can't redirect PDF file because the 'Disable data submit in a database?' option is activated.</i></p><?php } ?> |
  | 588 | 588 | <?php if( isset($idSelectPage) && $idSelectPage > 0) { ?><p><i style="color:#CC0000;">I can't redirect PDF file because you have choose a redirection page.</i></p><?php $meta\_values["redirect-to-pdf"]='false'; ?><input type="hidden"  name="wp\_cf7pdf\_settings[redirect-to-pdf]" value="false" /><?php } ?> |
  | 589 | 589 | </td> |
  | 590 | 590 | <td> |
  | 591 | 591 | <?php if( (isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=='false') || (isset($meta\_values["pdf-file-delete"]) && $meta\_values["pdf-file-delete"]=='false') ) { ?> |
  | 592 | 592 | <div> |
  | 593 | 593 | <div class="switch-field"> |
  | 594 | 594 | <input class="switch\_left" type="radio" id="switch\_redirect" name="wp\_cf7pdf\_settings[redirect-to-pdf]" value="true" <?php if( isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=='true') { echo ' checked'; } ?>/> |
  | 595 | 595 | <label for="switch\_redirect"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 596 | 596 | <input class="switch\_right" type="radio" id="switch\_redirect\_no" name="wp\_cf7pdf\_settings[redirect-to-pdf]" value="false" <?php if( empty($meta\_values["redirect-to-pdf"]) || (isset($meta\_values["redirect-to-pdf"]) && $meta\_values["redirect-to-pdf"]=='false') ) { echo ' checked'; } ?> /> |
  | 597 | 597 | <label for="switch\_redirect\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 598 | 598 | </div> |
  | 599 | 599 | </div><br /> |
  | 600 | 600 | <input type="radio" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[redirect-window]" value="on" <?php if( (isset($meta\_values["redirect-window"]) && $meta\_values["redirect-window"]=='on') or empty($meta\_values["redirect-window"]) ) { echo ' checked'; } ?>  /><?php esc\_html\_e('Same Window', 'send-pdf-for-contact-form-7'); ?> <input type="radio" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[redirect-window]" value="off" <?php if( isset($meta\_values["redirect-window"]) && $meta\_values["redirect-window"]=='off') { echo 'checked'; } ?> /><?php esc\_html\_e('New Window', 'send-pdf-for-contact-form-7'); ?> <input type="radio" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[redirect-window]" value="popup" <?php if( isset($meta\_values["redirect-window"]) && $meta\_values["redirect-window"]=='popup') { echo 'checked'; } ?> /><?php esc\_html\_e('Popup Window', 'send-pdf-for-contact-form-7'); ?> |
  | 601 | 601 | <?php } else { ?> |
  | 602 | 602 | <img src="<?php echo esc\_url(WPCF7PDF\_URL.'images/btn\_off.png'); ?>" /><br /> |
  | 603 | 603 | <input type="hidden" name="wp\_cf7pdf\_settings[redirect-to-pdf]" value="false" /> |
  | 604 | 604 | <?php } ?> |
  | 605 | 605 | <div> |
  | 606 | 606 |  |
  | 607 | 607 | </td> |
  | 608 | 608 | </tr> |
  | 609 | 609 | <tr> |
  | 610 | 610 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 611 | 611 | </tr> |
  | 612 | 612 | <tr> |
  | 613 | 613 | <td><!-- Propose l'envoi d'un zip dans l'email plutôt que le PDF --> |
  | 614 | 614 | <?php esc\_html\_e('Send a ZIP instead PDF?', 'send-pdf-for-contact-form-7'); ?> |
  | 615 | 615 | <p><i><?php esc\_html\_e( 'This option send all your files in a ZIP', 'send-pdf-for-contact-form-7'); ?></p> |
  | 616 | 616 | </td> |
  | 617 | 617 | <td> |
  | 618 | 618 | <div> |
  | 619 | 619 | <div class="switch-field"> |
  | 620 | 620 | <input class="switch\_left" type="radio" id="switch\_pdf\_zip" name="wp\_cf7pdf\_settings[pdf-to-zip]" value="true" <?php if( isset($meta\_values["pdf-to-zip"]) && $meta\_values["pdf-to-zip"]=='true') { echo ' checked'; } ?>/> |
  | 621 | 621 | <label for="switch\_pdf\_zip"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 622 | 622 | <input class="switch\_right" type="radio" id="switch\_pdf\_zip\_no" name="wp\_cf7pdf\_settings[pdf-to-zip]" value="false" <?php if( empty($meta\_values["pdf-to-zip"]) || (isset($meta\_values["pdf-to-zip"]) && $meta\_values["pdf-to-zip"]=='false') ) { echo ' checked'; } ?> /> |
  | 623 | 623 | <label for="switch\_pdf\_zip\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 624 | 624 | </div> |
  | 625 | 625 | </div> |
  | 626 | 626 | </td> |
  | 627 | 627 | </tr> |
  | 628 | 628 | <tr> |
  | 629 | 629 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 630 | 630 | </tr> |
  | 631 | 631 | <tr> |
  | 632 | 632 | <td> |
  | 633 | 633 | <?php esc\_html\_e('Select a date and time format', 'send-pdf-for-contact-form-7'); ?><br /><p><i><?php esc\_html\_e('By default, the date format is defined in the admin settings', 'send-pdf-for-contact-form-7'); ?> (<a href="https://codex.wordpress.org/Formatting\_Date\_and\_Time" target="\_blank"><?php esc\_html\_e('Formatting Date and Time', 'send-pdf-for-contact-form-7'); ?></a>)</i></p> |
  | 634 | 634 | </td> |
  | 635 | 635 | <td> |
  | 636 | 636 | <?php |
  | 637 | 637 |  |
  | 638 | 638 | $formatDate = stripslashes($date\_format); |
  | 639 | 639 | $formatTime = $hour\_format; |
  | 640 | 640 | if( isset($meta\_values['date\_format']) && !empty($meta\_values['date\_format']) ) { |
  | 641 | 641 | $formatDate = stripslashes($meta\_values['date\_format']); |
  | 642 | 642 | } |
  | 643 | 643 | if( isset($meta\_values['time\_format']) && !empty($meta\_values['time\_format']) ) { |
  | 644 | 644 | $formatTime = $meta\_values['time\_format']; |
  | 645 | 645 | } |
  | 646 | 646 | ?> |
  | 647 | 647 | <input id="date\_format" class="wpcf7-form-field" size="16" name="wp\_cf7pdf\_settings[date\_format]" value="<?php echo esc\_html($formatDate); ?>" type="text" /> <?php esc\_html\_e('Date:', 'send-pdf-for-contact-form-7'); ?> <?php echo esc\_html(date\_i18n($formatDate)); ?><br /> |
  | 648 | 648 | <input id="time\_format" size="16" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[time\_format]" value="<?php echo esc\_html($formatTime); ?>" type="text" /> <?php esc\_html\_e('Time:', 'send-pdf-for-contact-form-7'); ?> <?php echo esc\_html(date\_i18n($formatTime)); ?> |
  | 649 | 649 | </td> |
  | 650 | 650 | </tr> |
  | 651 | 651 | <!-- ENTETE PDF --> |
  | 652 | 652 | <tr> |
  | 653 | 653 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 654 | 654 | </tr> |
  | 655 | 655 | <tr> |
  | 656 | 656 | <td> |
  | 657 | 657 | <?php esc\_html\_e('Input encoding', 'send-pdf-for-contact-form-7'); ?><br /><p><i><?php esc\_html\_e('mPDF accepts UTF-8 encoded text by default for all functions', 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 658 | 658 | </td> |
  | 659 | 659 | <td> |
  | 660 | 660 | <?php |
  | 661 | 661 |  |
  | 662 | 662 | ?> |
  | 663 | 663 | <select name="wp\_cf7pdf\_settings[charset]"> |
  | 664 | 664 | <option value="utf-8" <?php if( empty($meta\_values["charset"]) || (isset($meta\_values["charset"]) && $meta\_values["charset"]=='utf-8') ) { echo ' selected'; } ?>>utf-8</option> |
  | 665 | 665 | <option value="windows-1252" <?php if( isset($meta\_values["charset"]) && $meta\_values["charset"]=='windows-1252"' ) { echo ' selected'; } ?>>windows-1252</option> |
  | 666 | 666 | </select> |
  | 667 | 667 | </td> |
  | 668 | 668 | </tr> |
  | 669 | 669 |  |
  | 670 | 670 | <!-- FONT DIRECTIONALITY PDF --> |
  | 671 | 671 | <tr> |
  | 672 | 672 | <td> |
  | 673 | 673 | <?php esc\_html\_e('PDF directionality', 'send-pdf-for-contact-form-7'); ?><br /><p><i><?php esc\_html\_e('Defines the directionality of the document', 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 674 | 674 | </td> |
  | 675 | 675 | <td> |
  | 676 | 676 | <?php |
  | 677 | 677 |  |
  | 678 | 678 | ?> |
  | 679 | 679 | <select name="wp\_cf7pdf\_settings[set\_directionality]"> |
  | 680 | 680 | <option value="ltr" <?php if( empty($meta\_values["set\_directionality"]) || (isset($meta\_values["set\_directionality"]) && $meta\_values["set\_directionality"]=='ltr') ) { echo ' selected'; } ?>>LTR</option> |
  | 681 | 681 | <option value="rtl" <?php if( isset($meta\_values["set\_directionality"]) && $meta\_values["set\_directionality"]=='rtl' ) { echo ' selected'; } ?>>RTL</option> |
  | 682 | 682 | </select> |
  | 683 | 683 | </td> |
  | 684 | 684 | </tr> |
  | 685 | 685 |  |
  | 686 | 686 | <tr> |
  | 687 | 687 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 688 | 688 | </tr> |
  | 689 | 689 | <tr> |
  | 690 | 690 | <td> |
  | 691 | 691 | <?php esc\_html\_e('Desactivate line break auto for PDF content?', 'send-pdf-for-contact-form-7'); ?> |
  | 692 | 692 | <p><i><?php esc\_html\_e('This disables automatic line break replacement (\n and \r) in PDF content', 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 693 | 693 | </td> |
  | 694 | 694 | <td> |
  | 695 | 695 | <div> |
  | 696 | 696 | <div class="switch-field"> |
  | 697 | 697 | <input class="switch\_left" type="radio" id="switch\_linebreak" name="wp\_cf7pdf\_settings[linebreak]" value="true" <?php if( isset($meta\_values["linebreak"]) && $meta\_values["linebreak"]=='true') { echo ' checked'; } ?>/> |
  | 698 | 698 | <label for="switch\_linebreak"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 699 | 699 | <input class="switch\_right" type="radio" id="switch\_linebreak\_no" name="wp\_cf7pdf\_settings[linebreak]" value="false" <?php if( empty($meta\_values["linebreak"]) || (isset($meta\_values["linebreak"]) && $meta\_values["linebreak"]=='false') ) { echo ' checked'; } ?> /> |
  | 700 | 700 | <label for="switch\_linebreak\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 701 | 701 | </div> |
  | 702 | 702 | </div> |
  | 703 | 703 | </td> |
  | 704 | 704 | </tr> |
  | 705 | 705 | <tr> |
  | 706 | 706 | <td> |
  | 707 | 707 | <?php esc\_html\_e('Desactivate line break auto for MAIL?', 'send-pdf-for-contact-form-7'); ?> |
  | 708 | 708 | <p><i><?php esc\_html\_e('This disables automatic line break replacement (\n and \r) in mail content', 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 709 | 709 | </td> |
  | 710 | 710 | <td> |
  | 711 | 711 | <div> |
  | 712 | 712 | <div class="switch-field"> |
  | 713 | 713 | <input class="switch\_left" type="radio" id="switch\_disable-html" name="wp\_cf7pdf\_settings[disable-html]" value="true" <?php if( isset($meta\_values["disable-html"]) && $meta\_values["disable-html"]=='true') { echo ' checked'; } ?>/> |
  | 714 | 714 | <label for="switch\_disable-html"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 715 | 715 | <input class="switch\_right" type="radio" id="switch\_disable-html\_no" name="wp\_cf7pdf\_settings[disable-html]" value="false" <?php if( empty($meta\_values["disable-html"]) || (isset($meta\_values["disable-html"]) && $meta\_values["disable-html"]=='false') ) { echo ' checked'; } ?> /> |
  | 716 | 716 | <label for="switch\_disable-html\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 717 | 717 | </div> |
  | 718 | 718 | </div> |
  | 719 | 719 | </td> |
  | 720 | 720 | </tr> |
  | 721 | 721 | <tr> |
  | 722 | 722 | <td><!-- Propose de désactiver le remplissage auto du formulaire --> |
  | 723 | 723 | <?php esc\_html\_e('Desactivate autocomplete form?', 'send-pdf-for-contact-form-7'); ?> |
  | 724 | 724 | </td> |
  | 725 | 725 | <td> |
  | 726 | 726 | <div> |
  | 727 | 727 | <div class="switch-field"> |
  | 728 | 728 | <input class="switch\_left" type="radio" id="switch\_autocomplete" name="wp\_cf7pdf\_settings[disabled-autocomplete-form]" value="true" <?php if( isset($meta\_values["disabled-autocomplete-form"]) && $meta\_values["disabled-autocomplete-form"]=='true') { echo ' checked'; } ?>/> |
  | 729 | 729 | <label for="switch\_autocomplete"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 730 | 730 | <input class="switch\_right" type="radio" id="switch\_autocomplete\_no" name="wp\_cf7pdf\_settings[disabled-autocomplete-form]" value="false" <?php if( empty($meta\_values["disabled-autocomplete-form"]) || (isset($meta\_values["disabled-autocomplete-form"]) && $meta\_values["disabled-autocomplete-form"]=='false') ) { echo ' checked'; } ?> /> |
  | 731 | 731 | <label for="switch\_autocomplete\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 732 | 732 | </div> |
  | 733 | 733 | </div> |
  | 734 | 734 | </td> |
  | 735 | 735 | <tr> |
  | 736 | 736 | <tr> |
  | 737 | 737 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 738 | 738 | </tr> |
  | 739 | 739 | <tr> |
  | 740 | 740 | <td><!-- Propose de mettre la cases réelles des Checkbox et Radio --> |
  | 741 | 741 | <?php esc\_html\_e('Enable display data in the checkbox or radio buttons of your PDF file?', 'send-pdf-for-contact-form-7'); ?> |
  | 742 | 742 | </td> |
  | 743 | 743 | <td> |
  | 744 | 744 | <div> |
  | 745 | 745 | <div class="switch-field"> |
  | 746 | 746 | <input class="switch\_left" type="radio" id="switch\_data\_input" name="wp\_cf7pdf\_settings[data\_input]" value="true" <?php if( isset($meta\_values["data\_input"]) && $meta\_values["data\_input"]=='true') { echo ' checked'; } ?>/> |
  | 747 | 747 | <label for="switch\_data\_input"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 748 | 748 | <input class="switch\_right" type="radio" id="switch\_data\_input\_no" name="wp\_cf7pdf\_settings[data\_input]" value="false" <?php if( empty($meta\_values["data\_input"]) || (isset($meta\_values["data\_input"]) && $meta\_values["data\_input"]=='false') ) { echo ' checked'; } ?> /> |
  | 749 | 749 | <label for="switch\_data\_input\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 750 | 750 | </div> |
  | 751 | 751 | </div> |
  | 752 | 752 | </td> |
  | 753 | 753 | </tr> |
  | 754 | 754 | <tr> |
  | 755 | 755 | <td><!-- Ne pas afficher les entrée vides des Checkbox et Radio --> |
  | 756 | 756 | <?php esc\_html\_e('Disable display empty data in the checkbox or radio buttons?', 'send-pdf-for-contact-form-7'); ?> |
  | 757 | 757 | </td> |
  | 758 | 758 | <td> |
  | 759 | 759 | <div> |
  | 760 | 760 | <div class="switch-field"> |
  | 761 | 761 | <input class="switch\_left" type="radio" id="switch\_empty\_input" name="wp\_cf7pdf\_settings[empty\_input]" value="true" <?php if( isset($meta\_values["empty\_input"]) && $meta\_values["empty\_input"]=='true') { echo ' checked'; } ?>/> |
  | 762 | 762 | <label for="switch\_empty\_input"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 763 | 763 | <input class="switch\_right" type="radio" id="switch\_empty\_input\_no" name="wp\_cf7pdf\_settings[empty\_input]" value="false" <?php if( empty($meta\_values["empty\_input"]) || (isset($meta\_values["empty\_input"]) && $meta\_values["empty\_input"]=='false') ) { echo ' checked'; } ?> /> |
  | 764 | 764 | <label for="switch\_empty\_input\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 765 | 765 | </div> |
  | 766 | 766 | </div> |
  | 767 | 767 | </td> |
  | 768 | 768 | </tr> |
  | 769 | 769 | <tr> |
  | 770 | 770 | <td><!-- Propose de mettre le PDF en mode éditable --> |
  | 771 | 771 | <?php esc\_html\_e('Enable fillable PDF Forms?', 'send-pdf-for-contact-form-7'); ?> |
  | 772 | 772 | <p><i><?php esc\_html\_e("Don't works if your PDF is protected.", 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 773 | 773 | </td> |
  | 774 | 774 | <td> |
  | 775 | 775 | <div> |
  | 776 | 776 | <div class="switch-field"> |
  | 777 | 777 | <input class="switch\_left" type="radio" id="switch\_fillable\_data" name="wp\_cf7pdf\_settings[fillable\_data]" value="true" <?php if( isset($meta\_values["fillable\_data"]) && $meta\_values["fillable\_data"]=='true') { echo ' checked'; } ?>/> |
  | 778 | 778 | <label for="switch\_fillable\_data"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 779 | 779 | <input class="switch\_right" type="radio" id="switch\_fillable\_data\_no" name="wp\_cf7pdf\_settings[fillable\_data]" value="false" <?php if( empty($meta\_values["fillable\_data"]) || (isset($meta\_values["fillable\_data"]) && $meta\_values["fillable\_data"]=='false') ) { echo ' checked'; } ?> /> |
  | 780 | 780 | <label for="switch\_fillable\_data\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 781 | 781 | </div> |
  | 782 | 782 | </div> |
  | 783 | 783 | </td> |
  | 784 | 784 | </tr> |
  | 785 | 785 | <tr> |
  | 786 | 786 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 787 | 787 | </tr> |
  | 788 | 788 | <tr> |
  | 789 | 789 | <td><!-- Proteger le pdf? --> |
  | 790 | 790 | <?php esc\_html\_e('Protect your PDF file?', 'send-pdf-for-contact-form-7'); ?> |
  | 791 | 791 | <p><i><?php esc\_html\_e('Use [pdf-password] tag in your emails.', 'send-pdf-for-contact-form-7'); ?></i></p> |
  | 792 | 792 | </td> |
  | 793 | 793 | <td> |
  | 794 | 794 | <div> |
  | 795 | 795 | <div class="switch-field"> |
  | 796 | 796 | <input class="switch\_left" type="radio" id="switch\_protect" name="wp\_cf7pdf\_settings[protect]" value="true" <?php if( isset($meta\_values["protect"]) && $meta\_values["protect"]=='true') { echo ' checked'; } ?>/> |
  | 797 | 797 | <label for="switch\_protect"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 798 | 798 | <input class="switch\_right" type="radio" id="switch\_protect\_no" name="wp\_cf7pdf\_settings[protect]" value="false" <?php if( empty($meta\_values["protect"]) || (isset($meta\_values["protect"]) && $meta\_values["protect"]=='false') ) { echo ' checked'; } ?> /> |
  | 799 | 799 | <label for="switch\_protect\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 800 | 800 | </div> |
  | 801 | 801 | </div> |
  | 802 | 802 | </td> |
  | 803 | 803 | </tr> |
  | 804 | 804 | <tr> |
  | 805 | 805 | <td><!-- Proteger le pdf? --> |
  | 806 | 806 | <?php esc\_html\_e('Generate and use a random password?', 'send-pdf-for-contact-form-7'); ?> |
  | 807 | 807 | <?php |
  | 808 | 808 | $nbPassword = 12; |
  | 809 | 809 | if( isset($meta\_values["protect\_password\_nb"]) && $meta\_values["protect\_password\_nb"]!='' && is\_numeric($meta\_values["protect\_password\_nb"]) ) { |
  | 810 | 810 | $nbPassword = esc\_html($meta\_values["protect\_password\_nb"]); |
  | 811 | 811 | } |
  | 812 | 812 | ?> |
  | 813 | 813 | <p><i><?php esc\_html\_e('Example (not working in preview mode):', 'send-pdf-for-contact-form-7'); ?> <strong><?php echo esc\_html(cf7\_sendpdf::wpcf7pdf\_generateRandomPassword($nbPassword)); ?></strong></i></p> |
  | 814 | 814 | </td> |
  | 815 | 815 | <td> |
  | 816 | 816 | <div> |
  | 817 | 817 | <div class="switch-field"> |
  | 818 | 818 | <input class="switch\_left" type="radio" id="switch\_protect\_uniquepassword" name="wp\_cf7pdf\_settings[protect\_uniquepassword]" value="true" <?php if( isset($meta\_values["protect\_uniquepassword"]) && $meta\_values["protect\_uniquepassword"]=='true') { echo ' checked'; } ?>/> |
  | 819 | 819 | <label for="switch\_protect\_uniquepassword"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 820 | 820 | <input class="switch\_right" type="radio" id="switch\_protect\_uniquepassword\_no" name="wp\_cf7pdf\_settings[protect\_uniquepassword]" value="false" <?php if( empty($meta\_values["protect\_uniquepassword"]) || (isset($meta\_values["protect\_uniquepassword"]) && $meta\_values["protect\_uniquepassword"]=='false') ) { echo ' checked'; } ?> /> |
  | 821 | 821 | <label for="switch\_protect\_uniquepassword\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 822 | 822 | </div> |
  | 823 | 823 | </div> |
  | 824 | 824 | </td> |
  | 825 | 825 | </tr> |
  | 826 | 826 |  |
  | 827 | 827 | <tr> |
  | 828 | 828 | <td><?php esc\_html\_e('Maximum number of characters for password?', 'send-pdf-for-contact-form-7'); ?><p><i><?php esc\_html\_e('By default : 12', 'send-pdf-for-contact-form-7'); ?></i></p></td> |
  | 829 | 829 | <td><input type="text" size="3" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[protect\_password\_nb]" value="<?php if( isset($meta\_values["protect\_password\_nb"]) && $meta\_values["protect\_password\_nb"]!='' && is\_numeric($meta\_values["protect\_password\_nb"]) ) { echo esc\_html($meta\_values["protect\_password\_nb"]); } else { echo esc\_html($nbPassword); } ?>" /></td> |
  | 830 | 830 | </tr> |
  | 831 | 831 |  |
  | 832 | 832 | <tr> |
  | 833 | 833 | <td><?php esc\_html\_e('Or enter your unique password for all PDF files.', 'send-pdf-for-contact-form-7'); ?></td> |
  | 834 | 834 | <td><input type="text" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[protect\_password]" value="<?php if( isset($meta\_values["protect\_password"]) && $meta\_values["protect\_password"]!='' ) { echo esc\_html(stripslashes($meta\_values["protect\_password"])); } ?>" /></td> |
  | 835 | 835 | </tr> |
  | 836 | 836 |  |
  | 837 | 837 | <tr> |
  | 838 | 838 | <td><?php esc\_html\_e('Or choose a tag for password for each PDF files.', 'send-pdf-for-contact-form-7'); ?><p><i><?php esc\_html\_e('Like: [tag]', 'send-pdf-for-contact-form-7'); ?></i></p></td> |
  | 839 | 839 | <td><input type="text" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[protect\_password\_tag]" value="<?php if( isset($meta\_values["protect\_password\_tag"]) && $meta\_values["protect\_password\_tag"]!='' ) { echo esc\_html( $meta\_values["protect\_password\_tag"] ); } ?>" /></td> |
  | 840 | 840 | </tr> |
  | 841 | 841 |  |
  | 842 | 842 | <tr> |
  | 843 | 843 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 844 | 844 | </tr> |
  | 845 | 845 |  |
  | 846 | 846 | <tr> |
  | 847 | 847 | <td><?php esc\_html\_e('Delete all config for this form?', 'send-pdf-for-contact-form-7'); ?><p><i><?php esc\_html\_e('Click Yes and save the form.', 'send-pdf-for-contact-form-7'); ?></i></p></td> |
  | 848 | 848 | <td> |
  | 849 | 849 | <div> |
  | 850 | 850 | <div class="switch-field"> |
  | 851 | 851 | <input class="switch\_left" type="radio" id="switch\_deleteconfig" name="deleteconfig" value="true"/> |
  | 852 | 852 | <label for="switch\_deleteconfig"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 853 | 853 | <input class="switch\_right" type="radio" id="switch\_deleteconfig\_no" name="deleteconfig" value="false" checked /> |
  | 854 | 854 | <label for="switch\_deleteconfig\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 855 | 855 | </div> |
  | 856 | 856 | </div> |
  | 857 | 857 | </td> |
  | 858 | 858 | </tr> |
  | 859 | 859 |  |
  | 860 | 860 | <tr> |
  | 861 | 861 | <td colspan="2"><hr style="background-color: <?php echo esc\_html($colors[2]); ?>; height: 1px; border: 0;"></td> |
  | 862 | 862 | </tr> |
  | 863 | 863 |  |
  | 864 | 864 |  |
  | 865 | 865 | </tbody> |
  | 866 | 866 | </table> |
  | 867 | 867 | </div> |
  | 868 | 868 | </div> |
  | 869 | 869 | <div class="clear">&nbsp;</div> |
  | 870 | 870 |  |
  | 871 | 871 | <!-- MISE EN PAGE --> |
  | 872 | 872 | <div class="postbox"> |
  | 873 | 873 | <div class="handlediv" style="height:1px!important;" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><br></div> |
  | 874 | 874 | <span class="dashicons customDashicons dashicons-pdf"></span> <h3 class="hndle" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e('Layout of your PDF', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 875 | 875 | <div class="inside openinside"> |
  | 876 | 876 |  |
  | 877 | 877 | <table class="wp-list-table widefat fixed" cellspacing="0"> |
  | 878 | 878 | <tbody id="the-list"> |
  | 879 | 879 | <tr> |
  | 880 | 880 | <td style="width: 60%;"> |
  | 881 | 881 | <h3 class="hndle"><span class="dashicons dashicons-format-image"></span>&nbsp;&nbsp;<?php esc\_html\_e('Image header', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 882 | 882 | <?php esc\_html\_e('Enter a URL or upload an image:', 'send-pdf-for-contact-form-7'); ?><br /> |
  | 883 | 883 | <input id="upload\_image" size="80%" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[image]" value="<?php if( isset($meta\_values['image']) ) { echo esc\_url($meta\_values['image']); } ?>" type="text" /> <a href="#" id="upload\_image\_button" class="button" OnClick="this.blur();"><span> <?php esc\_html\_e('Select or Upload your picture', 'send-pdf-for-contact-form-7'); ?> </span></a> <br /> |
  | 884 | 884 | <div style="margin-top:0.8em;"> |
  | 885 | 885 | <select name="wp\_cf7pdf\_settings[image-alignment]" class="wpcf7-form-field"> |
  | 886 | 886 | <option value="left" <?php if( isset($meta\_values['image-alignment']) && ($meta\_values['image-alignment']=='left') ) { echo 'selected'; } ?>><?php esc\_html\_e('Left', 'send-pdf-for-contact-form-7'); ?></option> |
  | 887 | 887 | <option value="center" <?php if( isset($meta\_values['image-alignment']) && ($meta\_values['image-alignment']=='center') ) { echo 'selected'; } ?>><?php esc\_html\_e('Center', 'send-pdf-for-contact-form-7'); ?></option> |
  | 888 | 888 | <option value="right" <?php if( isset($meta\_values['image-alignment']) && ($meta\_values['image-alignment']=='right') ) { echo 'selected'; } ?>><?php esc\_html\_e('Right', 'send-pdf-for-contact-form-7'); ?></option> |
  | 889 | 889 | </select> |
  | 890 | 890 | <?php esc\_html\_e('Size', 'send-pdf-for-contact-form-7'); ?> <input type="text" class="wpcf7-form-field" size="3" name="wp\_cf7pdf\_settings[image-width]" value="<?php if( isset($meta\_values['image-width']) ) { echo esc\_html($meta\_values['image-width']); } else { echo '150'; } ?>" />&nbsp;X&nbsp;<input type="text" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[image-height]" size="3" value="<?php if( isset($meta\_values['image-height']) ) { echo esc\_html($meta\_values['image-height']); } ?>" />px<br /><br /> |
  | 891 | 891 |  |
  | 892 | 892 | <div><?php esc\_html\_e('Display header on each page?', 'send-pdf-for-contact-form-7'); ?> |
  | 893 | 893 | <div class="switch-field-mini"> |
  | 894 | 894 | <input class="switch\_left" type="radio" id="switch\_page\_header" name="wp\_cf7pdf\_settings[page\_header]" value="1" <?php if( isset($meta\_values["page\_header"]) && $meta\_values["page\_header"]==1) { echo ' checked'; } ?>/> |
  | 895 | 895 | <label for="switch\_page\_header"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 896 | 896 | <input class="switch\_right" type="radio" id="switch\_page\_header\_no" name="wp\_cf7pdf\_settings[page\_header]" value="0" <?php if( empty($meta\_values["page\_header"]) || (isset($meta\_values["page\_header"]) && $meta\_values["page\_header"]==0) ) { echo ' checked'; } ?> /> |
  | 897 | 897 | <label for="switch\_page\_header\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 898 | 898 | </div><br /> |
  | 899 | 899 | <?php esc\_html\_e('Margin Bottom Header', 'send-pdf-for-contact-form-7'); ?> <input type="text" size="4" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[margin\_bottom\_header]" value="<?php if( isset($meta\_values["margin\_bottom\_header"]) && $meta\_values["margin\_bottom\_header"]!='' ) { echo esc\_html($meta\_values["margin\_bottom\_header"]); } else { echo esc\_html($marginBottomHeader); } ?>" /> |
  | 900 | 900 | </div> |
  | 901 | 901 | </div> |
  | 902 | 902 |  |
  | 903 | 903 | <h3 class="hndle"><span class="dashicons dashicons-images-alt2"></span>&nbsp;&nbsp;<?php esc\_html\_e('Image Background', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 904 | 904 | <?php esc\_html\_e('Enter a URL or upload an image:', 'send-pdf-for-contact-form-7'); ?><br /> |
  | 905 | 905 | <input id="upload\_background" size="80%" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[image\_background]" value="<?php if( isset($meta\_values['image\_background']) ) { echo esc\_url($meta\_values['image\_background']); } ?>" type="text" /> <a href="#" id="upload\_image\_background" class="button" OnClick="this.blur();"><span> <?php esc\_html\_e('Select or Upload your picture', 'send-pdf-for-contact-form-7'); ?> </span></a><br /><small><?php esc\_html\_e('Example for demo:', 'send-pdf-for-contact-form-7'); ?> <a href="<?php echo esc\_url(plugins\_url( '../images/background.jpg', \_\_FILE\_\_ )); ?>" target="\_blank"><?php esc\_html\_e('here', 'send-pdf-for-contact-form-7'); ?></a></small><br /> |
  | 906 | 906 | <div style="margin-top:0.8em;"> |
  | 907 | 907 | <div><?php esc\_html\_e('Display background on each page?', 'send-pdf-for-contact-form-7'); ?> |
  | 908 | 908 | <div class="switch-field-mini"> |
  | 909 | 909 | <input class="switch\_left" type="radio" id="switch\_page\_background" name="wp\_cf7pdf\_settings[page\_background]" value="1" <?php if( isset($meta\_values["page\_background"]) && $meta\_values["page\_background"]==1) { echo ' checked'; } ?>> |
  | 910 | 910 | <label for="switch\_page\_background"><?php esc\_html\_e('Yes', 'send-pdf-for-contact-form-7'); ?></label> |
  | 911 | 911 | <input class="switch\_right" type="radio" id="switch\_page\_background\_no" name="wp\_cf7pdf\_settings[page\_background]" value="0" <?php if( empty($meta\_values["page\_background"]) || (isset($meta\_values["page\_background"]) && $meta\_values["page\_background"]==0) ) { echo ' checked'; } ?>> |
  | 912 | 912 | <label for="switch\_page\_background\_no"><?php esc\_html\_e('No', 'send-pdf-for-contact-form-7'); ?></label> |
  | 913 | 913 | </div> |
  | 914 | 914 | </div> |
  | 915 | 915 | </div> |
  | 916 | 916 | </td> |
  | 917 | 917 | <td style="text-align:center;"> |
  | 918 | 918 | <div style="border:1px solid #CCCCCC;height:500px;padding:5px;<?php if( isset($meta\_values['image\_background']) ) { echo 'background: no-repeat url('.esc\_url($meta\_values['image\_background']); } ?>);background-size: cover;"> |
  | 919 | 919 | <div style="text-align:<?php if( isset($meta\_values['image-alignment']) ) { echo esc\_html($meta\_values['image-alignment']); } ?>;margin-top:<?php if( isset($meta\_values["margin\_header"]) && $meta\_values["margin\_header"]!='' ) { echo esc\_html($meta\_values["margin\_header"]); } else { echo esc\_html($marginHeader); } ?>px;"><?php if( isset($meta\_values['image']) ) { echo '<img src="'.esc\_url($meta\_values['image']).'" width="150">'; } ?> |
  | 920 | 920 | </div> |
  | 921 | 921 | <?php |
  | 922 | 922 |  |
  | 923 | 923 | if( isset($meta\_values["margin\_top"]) && $meta\_values["margin\_top"]!='' ) { |
  | 924 | 924 | $previewMargin = esc\_html($meta\_values["margin\_top"]); |
  | 925 | 925 | if($meta\_values["margin\_top"]<40) { $previewMargin = ($previewMargin-40); } |
  | 926 | 926 | if($meta\_values["margin\_top"]==0) { $previewMargin = -60; } |
  | 927 | 927 | } else { |
  | 928 | 928 | $previewMargin = esc\_html($marginTop); |
  | 929 | 929 | } |
  | 930 | 930 | ?> |
  | 931 | 931 | <div style="color:#cccccc;text-align:justify;margin-top:<?php echo esc\_html($previewMargin); ?>px;"> |
  | 932 | 932 | Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean commodo, neque nec vehicula molestie, lacus nunc ornare mi, nec aliquam libero dolor sed dolor. Quisque in lacinia lacus, ut tincidunt mauris. Integer vitae scelerisque dui. Curabitur pharetra et velit vitae interdum. Donec sollicitudin massa ante, nec malesuada quam scelerisque sit amet. Donec tristique semper diam vehicula auctor. Suspendisse venenatis porta odio eget consequat. Nullam nec lacus dapibus nulla auctor feugiat sit amet vel tortor.<br /><br /> |
  | 933 | 933 |  |
  | 934 | 934 | Nulla facilisi. Nam ullamcorper interdum efficitur. Etiam sollicitudin orci sit amet congue aliquam. Integer eu leo tempus, pellentesque eros at, cursus odio. Aliquam venenatis lectus tempus lacus pretium, sed tincidunt eros tempus. Pellentesque aliquet mollis risus, a auctor justo. Aliquam suscipit quis nisi et consectetur. Fusce tempus ex ac arcu dapibus scelerisque. In hendrerit convallis est non placerat. Fusce turpis sem, facilisis a mauris at, interdum imperdiet metus. Nullam lacus eros, tempor vel lectus id, tristique accumsan risus. Nunc ullamcorper ipsum ut accumsan fermentum. Nunc tempor est mauris. Vivamus eu tellus dictum felis pretium volutpat. Maecenas vitae tincidunt purus.<br /><br /> |
  | 935 | 935 |  |
  | 936 | 936 | Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Proin nec dolor eget diam ullamcorper pharetra. Aenean pulvinar interdum lacus, eu suscipit enim vehicula vitae. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aenean hendrerit urna id malesuada porttitor. Vestibulum laoreet hendrerit iaculis. Vestibulum id quam non lectus euismod vulputate porta eu purus. Etiam ultricies dolor ut turpis pellentesque faucibus. |
  | 937 | 937 | </div> |
  | 938 | 938 | </div> |
  | 939 | 939 | </td> |
  | 940 | 940 | </tr> |
  | 941 | 941 | <tr> |
  | 942 | 942 | <td> |
  | 943 | 943 |  |
  | 944 | 944 | </td> |
  | 945 | 945 | </tr> |
  | 946 | 946 | <tr> |
  | 947 | 947 | <td > |
  | 948 | 948 |  |
  | 949 | 949 | </td> |
  | 950 | 950 | </tr> |
  | 951 | 951 | </tbody> |
  | 952 | 952 | </table> |
  | 953 | 953 | <table class="wp-list-table widefat fixed" cellspacing="0"> |
  | 954 | 954 | <tbody id="the-list"> |
  | 955 | 955 | <tr> |
  | 956 | 956 | <td> |
  | 957 | 957 | <h3 class="hndle"><span class="dashicons dashicons-media-code"></span> <?php esc\_html\_e('Custom CSS', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 958 | 958 | </td> |
  | 959 | 959 | </tr> |
  | 960 | 960 | <tr> |
  | 961 | 961 | <td colspan="2"> |
  | 962 | 962 | <textarea name="wp\_cf7pdf\_settings[custom\_css]" id="wp\_cf7pdf\_pdf\_css" cols=70 rows=24 class="widefat textarea"style="height:250px;"><?php if( isset( $meta\_values['custom\_css']) ) { echo esc\_textarea($meta\_values['custom\_css']); } ?></textarea> |
  | 963 | 963 | </td> |
  | 964 | 964 | </tr> |
  | 965 | 965 | <tr> |
  | 966 | 966 | <td > |
  | 967 | 967 |  |
  | 968 | 968 | </td> |
  | 969 | 969 | </tr> |
  | 970 | 970 | </tbody> |
  | 971 | 971 | </table> |
  | 972 | 972 | <table class="wp-list-table widefat fixed" cellspacing="0"> |
  | 973 | 973 | <tbody id="the-list"> |
  | 974 | 974 | <tr> |
  | 975 | 975 | <td> |
  | 976 | 976 | <tr> |
  | 977 | 977 | <td> |
  | 978 | 978 | <h3 class="hndle"><span class="dashicons dashicons-arrow-down-alt"></span> <?php esc\_html\_e('Footer', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 979 | 979 | </td> |
  | 980 | 980 | </tr> |
  | 981 | 981 | <tr> |
  | 982 | 982 | <td colspan="2"> |
  | 983 | 983 | <?php esc\_html\_e('You can use this tags:', 'send-pdf-for-contact-form-7'); ?><br /> |
  | 984 | 984 | <ul> |
  | 985 | 985 | <li><?php esc\_html\_e('<strong>{PAGENO}/{nbpg}</strong> will be replaced by the current page number / total pages.', 'send-pdf-for-contact-form-7'); ?></li> |
  | 986 | 986 | <li><?php esc\_html\_e('<strong>{DATE j-m-Y}</strong> will be replaced by the current date. j-m-Y can be replaced by any of the valid formats used in the php <a href="http://www.php.net/manual/en/function.date.php" target="\_blank">date()</a> function.', 'send-pdf-for-contact-form-7'); ?></li> |
  | 987 | 987 | <li><?php esc\_html\_e('<strong>[reference] [date]</strong> and <strong>[time]</strong> tags works also.', 'send-pdf-for-contact-form-7'); ?></li> |
  | 988 | 988 | </ul> |
  | 989 | 989 | <textarea id="cf7pdf\_html\_footer" name="wp\_cf7pdf\_settings[footer\_generate\_pdf]" rows="15" cols="80%"><?php if( isset( $meta\_values['footer\_generate\_pdf']) ) { echo esc\_textarea($meta\_values['footer\_generate\_pdf']); } ?></textarea> |
  | 990 | 990 | </td> |
  | 991 | 991 | </tr> |
  | 992 | 992 | </tbody> |
  | 993 | 993 | </table> |
  | 994 | 994 | <table class="wp-list-table widefat fixed" cellspacing="0"> |
  | 995 | 995 | <tbody id="the-list"> |
  | 996 | 996 | <tr> |
  | 997 | 997 | <td> |
  | 998 | 998 | <h3 class="hndle"><span class="dashicons dashicons-tagcloud"></span> <?php esc\_html\_e('Personalize your PDF', 'send-pdf-for-contact-form-7'); ?></h3> |
  | 999 | 999 | </td> |
  | 1000 | 1000 | </tr> |
  | 1001 | 1001 | <tr> |
  | 1002 | 1002 | <tr> |
  | 1003 | 1003 | <td><?php esc\_html\_e('Page size & Orientation', 'send-pdf-for-contact-form-7'); ?></td> |
  | 1004 | 1004 | <td> |
  | 1005 | 1005 | <select name="wp\_cf7pdf\_settings[pdf-type]" class="wpcf7-form-field"> |
  | 1006 | 1006 | <option value="Letter" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Letter') ) { echo 'selected'; } ?>>Letter</option> |
  | 1007 | 1007 | <option value="Legal" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Legal') ) { echo 'selected'; } ?>>Legal</option> |
  | 1008 | 1008 | <option value="Executive" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Executive') ) { echo 'selected'; } ?>>Executive</option> |
  | 1009 | 1009 | <option value="Folio" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Folio') ) { echo 'selected'; } ?>>Folio</option> |
  | 1010 | 1010 | <option value="Demy" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Demy') ) { echo 'selected'; } ?>>Demy</option> |
  | 1011 | 1011 | <option value="Royal" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='Royal') ) { echo 'selected'; } ?>>Royal</option> |
  | 1012 | 1012 | <option value="4A0" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='4A0') ) { echo 'selected'; } ?>>4A0</option> |
  | 1013 | 1013 | <option value="2A0" <?php if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='2A0') ) { echo 'selected'; } ?>>2A0</option> |
  | 1014 | 1014 | <?php |
  | 1015 | 1015 | for ($typeA = 0; $typeA <= 10; $typeA++) { |
  | 1016 | 1016 | echo '<option value="A'.esc\_html($typeA).'"'; |
  | 1017 | 1017 | if( (isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='A'.$typeA)) OR (empty($meta\_values['pdf-type']) && $typeA==4) ) { echo 'selected'; } |
  | 1018 | 1018 | echo '>A'.esc\_html($typeA).'</option>'; |
  | 1019 | 1019 | } |
  | 1020 | 1020 | for ($typeB = 0; $typeB <= 10; $typeB++) { |
  | 1021 | 1021 | echo '<option value="B'.esc\_html($typeB).'"'; |
  | 1022 | 1022 | if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='B'.$typeB) ) { echo 'selected'; } |
  | 1023 | 1023 | echo '>B'.esc\_html($typeB).'</option>'; |
  | 1024 | 1024 | } |
  | 1025 | 1025 | for ($typeC = 0; $typeC <= 10; $typeC++) { |
  | 1026 | 1026 | echo '<option value="C'.esc\_html($typeC).'"'; |
  | 1027 | 1027 | if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='C'.$typeC) ) { echo 'selected'; } |
  | 1028 | 1028 | echo '>C'.esc\_html($typeC).'</option>'; |
  | 1029 | 1029 | } |
  | 1030 | 1030 | for ($typeRA = 0; $typeRA <= 4; $typeRA++) { |
  | 1031 | 1031 | echo '<option value="RA'.esc\_html($typeRA).'"'; |
  | 1032 | 1032 | if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='RA'.$typeRA) ) { echo 'selected'; } |
  | 1033 | 1033 | echo '>RA'.esc\_html($typeRA).'</option>'; |
  | 1034 | 1034 | } |
  | 1035 | 1035 | for ($typeSRA = 0; $typeSRA <= 4; $typeSRA++) { |
  | 1036 | 1036 | echo '<option value="SRA'.esc\_html($typeSRA).'"'; |
  | 1037 | 1037 | if( isset($meta\_values['pdf-type']) && ($meta\_values['pdf-type']=='SRA'.$typeSRA) ) { echo 'selected'; } |
  | 1038 | 1038 | echo '>SRA'.esc\_html($typeSRA).'</option>'; |
  | 1039 | 1039 | } |
  | 1040 | 1040 | ?> |
  | 1041 | 1041 | </select> |
  | 1042 | 1042 | <select name="wp\_cf7pdf\_settings[pdf-orientation]" class="wpcf7-form-field"> |
  | 1043 | 1043 | <option value="-P" <?php if( (isset($meta\_values['pdf-orientation']) && ($meta\_values['pdf-orientation']=='-P')) OR empty($meta\_values['pdf-orientation']) ) { echo 'selected'; } ?>><?php esc\_html\_e('Portrait', 'send-pdf-for-contact-form-7'); ?></option> |
  | 1044 | 1044 | <option value="-L" <?php if( isset($meta\_values['pdf-orientation']) && ($meta\_values['pdf-orientation']=='-L') ) { echo 'selected'; } ?>><?php esc\_html\_e('Landscape', 'send-pdf-for-contact-form-7'); ?></option> |
  | 1045 | 1045 | </select> |
  | 1046 | 1046 | </td> |
  | 1047 | 1047 | </tr> |
  | 1048 | 1048 | <tr> |
  | 1049 | 1049 | <td><?php esc\_html\_e('Font Family & Size', 'send-pdf-for-contact-form-7'); ?></td> |
  | 1050 | 1050 | <td> |
  | 1051 | 1051 | <select name="wp\_cf7pdf\_settings[pdf-font]" class="wpcf7-form-field"> |
  | 1052 | 1052 | <?php |
  | 1053 | 1053 | foreach($listFont as $font => $nameFont) { |
  | 1054 | 1054 | $selected =''; |
  | 1055 | 1055 | if( isset($meta\_values['pdf-font']) && $meta\_values['pdf-font']==$nameFont ) { $selected = 'selected'; } |
  | 1056 | 1056 | echo '<option value="'.esc\_html($nameFont).'" '.esc\_html($selected).'>'.esc\_html($font).'</option>'; |
  | 1057 | 1057 | } |
  | 1058 | 1058 | ?> |
  | 1059 | 1059 | </select> |
  | 1060 | 1060 | <input type="text" name="wp\_cf7pdf\_settings[pdf-fontsize]" class="wpcf7-form-field" size="2" value="<?php if( isset($meta\_values['pdf-fontsize']) && is\_numeric($meta\_values['pdf-fontsize']) ) { echo esc\_html($meta\_values['pdf-fontsize']); } else { echo esc\_html($fontsizePdf); } ?>"> |
  | 1061 | 1061 | </td> |
  | 1062 | 1062 | </tr> |
  | 1063 | 1063 | <tr> |
  | 1064 | 1064 | <td><?php esc\_html\_e('Add a CSS file', 'send-pdf-for-contact-form-7'); ?><br /><p><a href="<?php echo esc\_url(plugins\_url( '../css/mpdf-style-A4.css', \_\_FILE\_\_ )); ?>" target="\_blank"><small><i><?php esc\_html\_e('Download a example A4 page here', 'send-pdf-for-contact-form-7'); ?></i></small></a></p></td> |
  | 1065 | 1065 | <td> |
  | 1066 | 1066 | <input size="60%" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[stylesheet]" value="<?php if( isset($meta\_values['stylesheet']) ) { echo esc\_url($meta\_values['stylesheet']); } ?>" type="text" /><br /> |
  | 1067 | 1067 | </td> |
  | 1068 | 1068 | </tr> |
  | 1069 | 1069 |  |
  | 1070 | 1070 | <tr> |
  | 1071 | 1071 | <td> |
  | 1072 | 1072 | <?php esc\_html\_e('Global Margin PDF', 'send-pdf-for-contact-form-7'); ?><br /><p></p> |
  | 1073 | 1073 | </td> |
  | 1074 | 1074 | <td> |
  | 1075 | 1075 | <?php esc\_html\_e('Margin Header', 'send-pdf-for-contact-form-7'); ?> <input type="text" size="4" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[margin\_header]" value="<?php if( isset($meta\_values["margin\_header"]) && $meta\_values["margin\_header"]!='' ) { echo esc\_html($meta\_values["margin\_header"]); } else { echo esc\_html($marginHeader); } ?>" /> <?php esc\_html\_e('Margin Top Header', 'send-pdf-for-contact-form-7'); ?> <input type="text" class="wpcf7-form-field" size="4" name="wp\_cf7pdf\_settings[margin\_top]" value="<?php if( isset($meta\_values["margin\_top"]) && $meta\_values["margin\_top"]!='' ) { echo esc\_html($meta\_values["margin\_top"]); } else { echo esc\_html($marginTop); } ?>" /><br /><br /> |
  | 1076 | 1076 | <?php esc\_html\_e('Margin Left', 'send-pdf-for-contact-form-7'); ?> <input type="text" size="4" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[margin\_left]" value="<?php if( isset($meta\_values["margin\_left"]) && $meta\_values["margin\_left"]!='' ) { echo esc\_html($meta\_values["margin\_left"]); } else { echo esc\_html($marginLeft); } ?>" /> <?php esc\_html\_e('Margin Right', 'send-pdf-for-contact-form-7'); ?> <input type="text" class="wpcf7-form-field" size="4" name="wp\_cf7pdf\_settings[margin\_right]" value="<?php if( isset($meta\_values["margin\_right"]) && $meta\_values["margin\_right"]!='' ) { echo esc\_html($meta\_values["margin\_right"]); } else { echo esc\_html($marginRight); } ?>" /><br /><br /> |
  | 1077 | 1077 | <?php esc\_html\_e('Margin Header Auto', 'send-pdf-for-contact-form-7'); ?> <select name="wp\_cf7pdf\_settings[margin\_auto\_header]" class="wpcf7-form-field"> |
  | 1078 | 1078 | <option value="pad" <?php if( isset($meta\_values["margin\_auto\_header"]) && $meta\_values["margin\_auto\_header"] == 'pad' ) { echo 'selected'; } ?>>pad</option> |
  | 1079 | 1079 | <option value="stretch" <?php if( empty($meta\_values["margin\_auto\_header"]) || (isset($meta\_values["margin\_auto\_header"]) && $meta\_values["margin\_auto\_header"] == 'stretch') ) { echo 'selected'; } ?>>stretch</option> |
  | 1080 | 1080 | <option value="false" <?php if( isset($meta\_values["margin\_auto\_header"]) && $meta\_values["margin\_auto\_header"] == 'false' ) { echo 'selected'; } ?>>false</option> |
  | 1081 | 1081 | </select> <?php esc\_html\_e('Margin Bottom Auto', 'send-pdf-for-contact-form-7'); ?> |
  | 1082 | 1082 | <select name="wp\_cf7pdf\_settings[margin\_auto\_bottom]" class="wpcf7-form-field"> |
  | 1083 | 1083 | <option value="pad" <?php if( isset($meta\_values["margin\_auto\_bottom"]) && $meta\_values["margin\_auto\_bottom"] == 'pad' ) { echo 'selected'; } ?>>pad</option> |
  | 1084 | 1084 | <option value="stretch" <?php if( empty($meta\_values["margin\_auto\_bottom"]) || (isset($meta\_values["margin\_auto\_bottom"]) && $meta\_values["margin\_auto\_bottom"] == 'stretch') ) { echo 'selected'; } ?>>stretch</option> |
  | 1085 | 1085 | <option value="false" <?php if( isset($meta\_values["margin\_auto\_bottom"]) && $meta\_values["margin\_auto\_bottom"] == 'false' ) { echo 'selected'; } ?>>false</option> |
  | 1086 | 1086 | </select> |
  | 1087 | 1087 | </td> |
  | 1088 | 1088 | </tr> |
  | 1089 | 1089 |  |
  | 1090 | 1090 | <tr> |
  | 1091 | 1091 | <td> |
  | 1092 | 1092 | <?php esc\_html\_e('Choice of separator for checkboxes or radio buttons', 'send-pdf-for-contact-form-7'); ?><br /><p></p> |
  | 1093 | 1093 | </td> |
  | 1094 | 1094 | <td><?php esc\_html\_e("Before:", 'send-pdf-for-contact-form-7'); ?><br /> |
  | 1095 | 1095 | <select name="wp\_cf7pdf\_settings[separate]" class="wpcf7-form-field"> |
  | 1096 | 1096 | <option value="none" <?php if( empty($meta\_values["separate"]) || (isset($meta\_values["separate"]) && $meta\_values["separate"] == 'none') ) { echo 'selected'; } ?>><?php esc\_html\_e("None", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1097 | 1097 | <option value="dash" <?php if( isset($meta\_values["separate"]) && $meta\_values["separate"] == 'dash') { echo 'selected'; } ?>><?php esc\_html\_e("Dash", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1098 | 1098 | <option value="star" <?php if( isset($meta\_values["separate"]) && $meta\_values["separate"] == 'star') { echo 'selected'; } ?>><?php esc\_html\_e("Star", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1099 | 1099 | <option value="rightarrow" <?php if( isset($meta\_values["separate"]) && $meta\_values["separate"] == 'rightarrow') { echo 'selected'; } ?>><?php esc\_html\_e("Right Arrow", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1100 | 1100 | <option value="double-right-arrow" <?php if( isset($meta\_values["separate"]) && $meta\_values["separate"] == 'double-right-arrow') { echo 'selected'; } ?>><?php esc\_html\_e("Double Right Arrow", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1101 | 1101 | <option value="cornerarrow" <?php if( isset($meta\_values["separate"]) && $meta\_values["separate"] == 'cornerarrow') { echo 'selected'; } ?>><?php esc\_html\_e("Corner Arrow", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1102 | 1102 | </select><br /> |
  | 1103 | 1103 | <?php esc\_html\_e("After:", 'send-pdf-for-contact-form-7'); ?><br /> |
  | 1104 | 1104 | <select name="wp\_cf7pdf\_settings[separate\_after]" class="wpcf7-form-field"> |
  | 1105 | 1105 | <option value="comma" <?php if( isset($meta\_values["separate\_after"]) && $meta\_values["separate\_after"] == 'comma' ) { echo 'selected'; } ?>><?php esc\_html\_e("Comma", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1106 | 1106 | <option value="space" <?php if( empty($meta\_values["separate\_after"]) || (isset($meta\_values["separate\_after"]) && $meta\_values["separate\_after"] == 'space') ) { echo 'selected'; } ?>><?php esc\_html\_e("Space", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1107 | 1107 | <option value="linebreak" <?php if( isset($meta\_values["separate\_after"]) && $meta\_values["separate\_after"] == 'linebreak') { echo 'selected'; } ?>><?php esc\_html\_e("Line break", 'send-pdf-for-contact-form-7'); ?></option> |
  | 1108 | 1108 | </select><br /> |
  | 1109 | 1109 | <!--<?php esc\_html\_e('Other:', 'send-pdf-for-contact-form-7'); ?> <input type="text" size="4" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[separate\_other]" value="<?php if( isset($meta\_values["separate\_other"]) && $meta\_values["separate\_other"]!='' ) { echo esc\_html($meta\_values["separate\_other"]); } else { echo ''; } ?>" />--> |
  | 1110 | 1110 | </td> |
  | 1111 | 1111 | </tr> |
  | 1112 | 1112 |  |
  | 1113 | 1113 | <tr> |
  | 1114 | 1114 | <td colspan="2"> |
  | 1115 | 1115 | <legend> |
  | 1116 | 1116 | <?php esc\_html\_e('For personalize your PDF you can in the following text field, use these mail-tags:', 'send-pdf-for-contact-form-7'); ?><br /> |
  | 1117 | 1117 | <table> |
  | 1118 | 1118 | <tr> |
  | 1119 | 1119 | <td width="50%"> |
  | 1120 | 1120 | <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[addpage]</strong></span><br /><i><?php esc\_html\_e("[addpage] is a simple tag to force a page break anywhere in your PDF.", 'send-pdf-for-contact-form-7'); ?></i> |
  | 1121 | 1121 | </td> |
  | 1122 | 1122 | <td width="50%"> |
  | 1123 | 1123 | <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[date]</strong></span> <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[time]</strong></span><br /><i><?php esc\_html\_e("Use [date] and [time] to print the date and time anywhere in your PDF.", 'send-pdf-for-contact-form-7'); ?></i> |
  | 1124 | 1124 | </td> |
  | 1125 | 1125 | </tr> |
  | 1126 | 1126 | <tr> |
  | 1127 | 1127 | <td width="50%"> |
  | 1128 | 1128 | <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[reference]</strong></span><br /><i><?php esc\_html\_e("[reference] is a simple mail-tag who is used for create unique PDF. It's also recorded in the database. Every PDF is named like this : name-pdf-uniqid() and it's uploaded in the upload folder of WordPress.", 'send-pdf-for-contact-form-7'); ?></i><br /><br /> |
  | 1129 | 1129 | </td> |
  | 1130 | 1130 | <td width="50%"> |
  | 1131 | 1131 | <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[ID]</strong></span><br /><i><?php esc\_html\_e("[ID] is a simple tag that comes from the database ID if you have allowed registration in the options.", 'send-pdf-for-contact-form-7'); ?></i><br /><br /> |
  | 1132 | 1132 | <span class="mailtag code used" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[avatar]</strong></span><br /><i><?php esc\_html\_e("[avatar] is a simple mail-tag for the user Avatar URL.", 'send-pdf-for-contact-form-7'); ?></i> |
  | 1133 | 1133 | <br /><br /> |
  | 1134 | 1134 | <i><?php echo esc\_html\_\_('Enter here your Shortcodes', 'send-pdf-for-contact-form-7'); ?></i><br /><small><?php esc\_html\_e('It will then be necessary to put them in the PDF layout. Test with this shortcode: [wpcf7pdf\_test]', 'send-pdf-for-contact-form-7'); ?></small><br /><input type="text" class="wpcf7-form-field" name="wp\_cf7pdf\_settings[shotcodes\_tags]" size="80%" value="<?php if( isset($meta\_values['shotcodes\_tags'])) { echo esc\_html($meta\_values['shotcodes\_tags']); } ?>" /> |
  | 1135 | 1135 | </td> |
  | 1136 | 1136 |  |
  | 1137 | 1137 | </tr> |
  | 1138 | 1138 | <tr> |
  | 1139 | 1139 | <td width="50%"> |
  | 1140 | 1140 | <?php |
  | 1141 | 1141 | /\* |
  | 1142 | 1142 | \* ECRIT DANS UN POST-META LES TAGS DU FORMULAIRE |
  | 1143 | 1143 | \* |
  | 1144 | 1144 | \*/ |
  | 1145 | 1145 | $contact\_form = WPCF7\_ContactForm::get\_instance(esc\_html($idForm)); |
  | 1146 | 1146 | $fileTags = ''; |
  | 1147 | 1147 |  |
  | 1148 | 1148 | foreach ( (array) $contact\_form->collect\_mail\_tags() as $mail\_tag ) { |
  | 1149 | 1149 | $pattern = sprintf( '/\[(\_[a-z]+\_)?%s([ \t]+[^]]+)?\]/', |
  | 1150 | 1150 | preg\_quote( esc\_html($mail\_tag), '/' ) ); |
  | 1151 | 1151 | if( substr(esc\_html($mail\_tag), 0, 4) == 'file' ) { |
  | 1152 | 1152 | $fileTags .= '<span class="%1$s" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>['.esc\_html($mail\_tag).']</strong></span> '; |
  | 1153 | 1153 | } |
  | 1154 | 1154 | echo sprintf( |
  | 1155 | 1155 | '<span class="%1$s" onclick="jQuery(this).selectText()" style="cursor: pointer;"><strong>[%2$s]</strong></span> ', |
  | 1156 | 1156 | 'mailtag code used', |
  | 1157 | 1157 | esc\_html( $mail\_tag ) ); |
  | 1158 | 1158 | echo '<input type="hidden" name="wp\_cf7pdf\_tags[]" value="['.esc\_html( $mail\_tag ).']" />'; |
  | 1159 | 1159 | } |
  | 1160 | 1160 | /\* |
  | 1161 | 1161 | \* ECRIT DANS UN POST-META LES PROPRIETES DES TAGS DU FORMULAIRE |
  | 1162 | 1162 | \* |
  | 1163 | 1163 | \*/ |
  | 1164 | 1164 | $contact\_tag = $contact\_form->scan\_form\_tags(); |
  | 1165 | 1165 | $valOpt = ''; |
  | 1166 | 1166 | $valTag = ''; |
  | 1167 | 1167 | foreach ( $contact\_tag as $sh\_tag ) { |
  | 1168 | 1168 | //echo '<br /><br />'; |
  | 1169 | 1169 | //print\_r($sh\_tag); |
  | 1170 | 1170 | if( !empty($sh\_tag["options"]) ) { |
  | 1171 | 1171 | $valOpt = 'array('; |
  | 1172 | 1172 | foreach($sh\_tag["options"] as $idOpt=>$opt) { |
  | 1173 | 1173 | $valOpt .= '['.$idOpt.']=>'.$opt; |
  | 1174 | 1174 | } |
  | 1175 | 1175 | $valOpt .= ')'; |
  | 1176 | 1176 | } |
  | 1177 | 1177 | if( !empty($sh\_tag["values"]) ) { |
  | 1178 | 1178 | $valTag = 'array('; |
  | 1179 | 1179 | foreach($sh\_tag["values"] as $id=>$val) { |
  | 1180 | 1180 | $valTag .= '['.$id.']=>'.$val; |
  | 1181 | 1181 | } |
  | 1182 | 1182 | $valTag .= ')'; |
  | 1183 | 1183 | } |
  | 1184 | 1184 | $mail\_tag\_scan = '['.$sh\_tag["name"].'],'.$sh\_tag["basetype"].','.$valTag.','.$valOpt; |
  | 1185 | 1185 | echo '<input type="hidden" name="wp\_cf7pdf\_tags\_scan[]" value="'.esc\_html($mail\_tag\_scan).'" />'; |
  | 1186 | 1186 | } |
  | 1187 | 1187 | ?> |
  | 1188 | 1188 | </td> |
  | 1189 | 1189 | <td width="50%"></td> |
  | 1190 | 1190 | </tr> |
  | 1191 | 1191 | <tr> |
  | 1192 | 1192 | <td width="50%"><br /></td> |
  | 1193 | 1193 | <td width="50%" style="text-align:center;"> |
  | 1194 | 1194 | <div style="text-align:right;"> |
  | 1195 | 1195 | <p> |
  | 1196 | 1196 | <input type="submit" name="wp\_cf7pdf\_update\_settings" class="button-primary" value="<?php esc\_html\_e('Save settings', 'send-pdf-for-contact-form-7'); ?>"/> |
  | 1197 | 1197 | <?php if( file\_exists($createDirectory.'/preview-'.esc\_html($idForm).'.pdf') ) { ?> |
  | 1198 | 1198 | <a class="button button-secondary" target="\_blank" href="<?php echo esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory)).'/preview-'.esc\_html($idForm).'.pdf?ver='.esc\_html(wp\_rand()); ?>" ><?php esc\_html\_e('Preview your PDF', 'send-pdf-for-contact-form-7'); ?></a> |
  | 1199 | 1199 | <?php } ?> |
  | 1200 | 1200 | </p> |
  | 1201 | 1201 | </div> |
  | 1202 | 1202 | </td> |
  | 1203 | 1203 | </tr> |
  | 1204 | 1204 | </table> |
  | 1205 | 1205 | </legend> |
  | 1206 | 1206 | </td> |
  | 1207 | 1207 | </tr> |
  | 1208 | 1208 | <tr> |
  | 1209 | 1209 | <td colspan="2"> |
  | 1210 | 1210 | <textarea name="wp\_cf7pdf\_settings[generate\_pdf]" id="wp\_cf7pdf\_pdf" cols=70 rows=24 class="widefat textarea"style="height:250px;"><?php if( empty($meta\_values['generate\_pdf']) ) { echo esc\_textarea($messagePdf); } else { echo esc\_textarea($meta\_values['generate\_pdf']); } ?></textarea> |
  | 1211 | 1211 | </td> |
  | 1212 | 1212 | </tr> |
  | 1213 | 1213 |  |
  | 1214 | 1214 | </tbody> |
  | 1215 | 1215 | </table> |
  | 1216 | 1216 | </div> |
  | 1217 | 1217 | </div> |
  | 1218 | 1218 | <div class="clear">&nbsp;</div> |
  | 1219 | 1219 | <div style="text-align:left;"> |
  | 1220 | 1220 | <p> |
  | 1221 | 1221 | <input type="submit" name="wp\_cf7pdf\_update\_settings" class="button-primary" value="<?php esc\_html\_e('Save settings', 'send-pdf-for-contact-form-7'); ?>"/> |
  | 1222 | 1222 | <?php if( file\_exists($createDirectory.'/preview-'.esc\_html($idForm).'.pdf') ) { ?> |
  | 1223 | 1223 | <a class="button button-secondary" target="\_blank" href="<?php echo esc\_url(str\_replace($upload\_dir['basedir'], $upload\_dir['baseurl'], $createDirectory)).'/preview-'.esc\_html($idForm).'.pdf?ver='.esc\_html(wp\_rand()); ?>" ><?php esc\_html\_e('Preview your PDF', 'send-pdf-for-contact-form-7'); ?></a> |
  | 1224 | 1224 | <?php } ?> |
  | 1225 | 1225 | </p> |
  | 1226 | 1226 | </div> |
  | 1227 | 1227 |  |
  | 1228 | 1228 | </form> |
  | 1229 | 1229 | <?php if( isset($meta\_values["disable-insert"]) && $meta\_values["disable-insert"]=="false") { ?> |
  | 1230 | 1230 | <div class="clear" style="margin-bottom:15px;">&nbsp;</div> |
  | 1231 | 1231 | <div class="postbox"> |
  | 1232 | 1232 |  |
  | 1233 | 1233 | <div class="handlediv" style="height:1px!important;" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><br></div> |
  | 1234 | 1234 | <span class="dashicons customDashicons dashicons-list-view"></span> <h3 class="hndle"><?php esc\_html\_e( 'Last records', 'send-pdf-for-contact-form-7' ); ?></h3> |
  | 1235 | 1235 | <div class="inside"> |
  | 1236 | 1236 | <a name="listing"></a> |
  | 1237 | 1237 | <?php |
  | 1238 | 1238 | $limitList = 15; |
  | 1239 | 1239 | $settingsLimit = get\_post\_meta( esc\_html($idForm), '\_wp\_cf7pdf\_limit', true ); |
  | 1240 | 1240 | if( isset($settingsLimit) && $settingsLimit > 0 ) { $limitList = $settingsLimit; } |
  | 1241 | 1241 |  |
  | 1242 | 1242 | $list = WPCF7PDF\_settings::wpcf7pdf\_listing(esc\_html($idForm), esc\_html($limitList)); |
  | 1243 | 1243 | if( $list ) { ?> |
  | 1244 | 1244 | <div style="padding:5px;margin-bottom:10px;"> |
  | 1245 | 1245 | <div> |
  | 1246 | 1246 | <form method="post" action="#listing"> |
  | 1247 | 1247 |  |
  | 1248 | 1248 | <?php wp\_nonce\_field( 'wpcf7\_listing\_nonce', 'wpcf7\_listing\_nonce' ); ?> |
  | 1249 | 1249 | <input type="hidden" name="idform" value="<?php echo esc\_html($idForm); ?>"/> |
  | 1250 | 1250 | <input type="hidden" name="wpcf7\_action" value="listing\_settings" /> |
  | 1251 | 1251 | <input type="text" value="<?php echo esc\_html($limitList); ?>" size="4" name="listing\_limit" > <?php submit\_button( esc\_html\_\_( 'Change', 'send-pdf-for-contact-form-7' ), 'secondary', 'submit', false ); ?> |
  | 1252 | 1252 | </form> |
  | 1253 | 1253 | </div> |
  | 1254 | 1254 |  |
  | 1255 | 1255 | <?php |
  | 1256 | 1256 | echo '<table>'; |
  | 1257 | 1257 | echo '<th>&nbsp;</th><th>&nbsp;</th><th>&nbsp;</th>'; |
  | 1258 | 1258 |  |
  | 1259 | 1259 | foreach($list as $recorder) { |
  | 1260 | 1260 | echo '<tr width="100%">'; |
  | 1261 | 1261 | $datas = maybe\_unserialize($recorder->wpcf7pdf\_data); |
  | 1262 | 1262 | if( isset($datas) && $datas!=false) { |
  | 1263 | 1263 | echo '<td width="80%">'; |
  | 1264 | 1264 | echo '<a href="'.esc\_url($recorder->wpcf7pdf\_files).'" target="\_blank">'.esc\_html($datas[0]) .'</a> - '.esc\_html($datas[1]); |
  | 1265 | 1265 | echo '</td>'; |
  | 1266 | 1266 | echo '<td width="5%"><a href="'.esc\_url($recorder->wpcf7pdf\_files).'" target="\_blank"><img src="'.esc\_url(WPCF7PDF\_URL.'images/icon\_download.png').'" width="30" title="'.esc\_html\_\_('Download', 'send-pdf-for-contact-form-7').'" alt="'.esc\_html\_\_('Download', 'send-pdf-for-contact-form-7').'" /></a></td>'; |
  | 1267 | 1267 | ?><td width="5%"><a href="#" data-idform="<?php echo esc\_html($idForm); ?>" data-id="<?php echo esc\_html($recorder->wpcf7pdf\_id); ?>" data-message="<?php esc\_html\_e('Are you sure you want to delete this Record?', 'send-pdf-for-contact-form-7'); ?>" data-nonce="<?php echo esc\_html(wp\_create\_nonce('delete\_record-'.$recorder->wpcf7pdf\_id)); ?>" class="delete-record"><img src="<?php echo esc\_url(WPCF7PDF\_URL.'images/icon\_delete.png'); ?>" width="30" title="<?php esc\_html\_e('Delete', 'send-pdf-for-contact-form-7'); ?>" alt="<?php esc\_html\_e('Delete', 'send-pdf-for-contact-form-7'); ?>" /></a> |
  | 1268 | 1268 | <?php |
  | 1269 | 1269 | echo '</td><tr>'; |
  | 1270 | 1270 | } |
  | 1271 | 1271 | } |
  | 1272 | 1272 |  |
  | 1273 | 1273 | echo '</table>'; |
  | 1274 | 1274 |  |
  | 1275 | 1275 | ?> |
  | 1276 | 1276 | </div> |
  | 1277 | 1277 | <table width="100%"> |
  | 1278 | 1278 | <tbody> |
  | 1279 | 1279 | <tr> |
  | 1280 | 1280 | <td width="5%"> |
  | 1281 | 1281 | <div> |
  | 1282 |  | <span class="dashicons dashicons-download"></span> <a href="<?php e~~sc\_url(wp\_nonce\_url( admin\_url('admin.php?page=wpcf7-send-pdf&amp;idform='.esc\_html($\_POST['idform']).'&amp;csv=1'), 'go\_generate', 'csv\_security')~~); ?>" alt="<?php esc\_html\_e('Export list', 'send-pdf-for-contact-form-7'); ?>" title="<?php esc\_html\_e('Export list', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e('Export list in CSV file', 'send-pdf-for-contact-form-7'); ?></a> |
  |  | 1282 | <span class="dashicons dashicons-download"></span> <a href="<?php echo wp\_nonce\_url( admin\_url('admin.php?page=wpcf7-send-pdf&amp;idform='.esc\_html($\_POST['idform']).'&amp;csv=1'), 'go\_generate', 'csv\_security'); ?>" alt="<?php esc\_html\_e('Export list', 'send-pdf-for-contact-form-7'); ?>" title="<?php esc\_html\_e('Export list', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e('Export list in CSV file', 'send-pdf-for-contact-form-7'); ?></a> |
  | 1283 | 1283 | </div> |
  | 1284 | 1284 | </tr> |
  | 1285 | 1285 | </tbody> |
  | 1286 | 1286 | </table> |
  | 1287 | 1287 | <?php } else { esc\_html\_e('Data not found!', 'send-pdf-for-contact-form-7'); } ?> |
  | 1288 | 1288 | </div> |
  | 1289 | 1289 | </div> |
  | 1290 | 1290 | <?php } ?> |
  | 1291 | 1291 |  |
  | 1292 | 1292 | <div class="postbox"> |
  | 1293 | 1293 | <div class="handlediv" style="height:1px!important;" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><br></div> |
  | 1294 | 1294 | <span class="dashicons customDashicons dashicons-download"></span> <h3 class="hndle" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e( 'Export Settings', 'send-pdf-for-contact-form-7' ); ?></h3> |
  | 1295 | 1295 | <div class="inside"> |
  | 1296 | 1296 | <form method="post"> |
  | 1297 | 1297 | <p> |
  | 1298 | 1298 | <input type="hidden" name="wpcf7\_action" value="export\_settings" /> |
  | 1299 | 1299 | <input type="hidden" name="wpcf7pdf\_export\_id" value="<?php echo esc\_html($idForm); ?>" /> |
  | 1300 | 1300 | </p> |
  | 1301 | 1301 | <p> |
  | 1302 | 1302 | <?php wp\_nonce\_field( 'go\_export\_nonce', 'wpcf7\_export\_nonce' ); ?> |
  | 1303 | 1303 | <?php submit\_button( esc\_html\_\_( 'Export', 'send-pdf-for-contact-form-7' ), 'secondary', 'submit', false ); ?> |
  | 1304 | 1304 | </p> |
  | 1305 | 1305 | </form> |
  | 1306 | 1306 | </div> |
  | 1307 | 1307 | </div> |
  | 1308 | 1308 |  |
  | 1309 | 1309 | <div class="postbox"> |
  | 1310 | 1310 | <div class="handlediv" style="height:1px!important;" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><br></div> |
  | 1311 | 1311 | <span class="dashicons customDashicons dashicons-upload"></span> <h3 class="hndle" title="<?php esc\_html\_e('Click to toggle', 'send-pdf-for-contact-form-7'); ?>"><?php esc\_html\_e( 'Import Settings', 'send-pdf-for-contact-form-7' ); ?></h3> |
  | 1312 | 1312 | <div class="inside"> |
  | 1313 | 1313 | <p><?php esc\_html\_e( 'Import the plugin settings from a .json file. This file can be obtained by exporting the settings on another site using the form above.', 'send-pdf-for-contact-form-7' ); ?></p> |
  | 1314 | 1314 | <form method="post" enctype="multipart/form-data"> |
  | 1315 | 1315 | <p> |
  | 1316 | 1316 | <input type="file" name="wpcf7\_import\_file"/> |
  | 1317 | 1317 | </p> |
  | 1318 | 1318 | <p> |
  | 1319 | 1319 | <input type="hidden" name="wpcf7\_action" value="import\_settings" /> |
  | 1320 | 1320 | <input type="hidden" name="idform" value="<?php echo esc\_html($idForm); ?>"/> |
  | 1321 | 1321 | <input type="hidden" name="wpcf7pdf\_import\_id" value="<?php echo esc\_html($idForm); ?>" /> |
  | 1322 | 1322 | <?php wp\_nonce\_field( 'go\_import\_nonce', 'wpcf7\_import\_nonce' ); ?> |
  | 1323 | 1323 | <?php submit\_button( esc\_html\_\_( 'Import', 'send-pdf-for-contact-form-7' ), 'secondary', 'submit', false ); ?> |
  | 1324 | 1324 | </p> |
  | 1325 | 1325 | </form> |
  | 1326 | 1326 | </div> |
  | 1327 | 1327 | </div> |
  | 1328 | 1328 | <?php } ?> |
  | 1329 | 1329 | <?php } else { ?> |
  | 1330 | 1330 | <div style="margin-left: 0px;margin-top: 5px;background-color: #ffffff;border: 1px solid #cccccc;padding: 10px;"> |
  | 1331 | 1331 | <?php /\* translators: %s: lien vers Contact Form 7 \*/ printf( esc\_html\_\_('To work I need %s plugin, but it is apparently not installed or not enabled!', 'send-pdf-for-contact-form-7'), '<a href="https://wordpress.org/plugins/contact-form-7/" target="\_blank">Contact Form 7</a>' ); ?> |
  | 1332 | 1332 | </div> |
  | 1333 | 1333 | <?php } ?> |
  | 1334 | 1334 | <div style="margin-top:40px;"> |
  | 1335 | 1335 | <?php esc\_html\_e('Send PDF for Contact Form 7 is brought to you by', 'send-pdf-for-contact-form-7'); ?> <a href="https://madeby.restezconnectes.fr/" target="\_blank">MadeByRestezConnectes</a> - <?php esc\_html\_e('If you found this plugin useful', 'send-pdf-for-contact-form-7'); ?> <a href="https://wordpress.org/support/view/plugin-reviews/send-pdf-for-contact-form-7/" target="\_blank"><?php esc\_html\_e('give it 5 &#9733; on WordPress.org', 'send-pdf-for-contact-form-7'); ?></a> |
  | 1336 | 1336 | </div> |
  | 1337 | 1337 | </div> |
* ## [send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php](/changeset/3074531/send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php?old=3069880&old_path=send-pdf-for-contact-form-7%2Ftrunk%2Fwpcf7-send-pdf.php "Show the [3069882:3074631] differences restricted to send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php")

  | [r3069882](/browser/send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php?rev=3069880#L1 "Show revision 3069882 of this file in browser") | [r3074631](/browser/send-pdf-for-contact-form-7/trunk/wpcf7-send-pdf.php?rev=3074531#L1 "Show revision 3074631 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 | 3 | Plugin Name: Send PDF for Contact Form 7 |
  | 4 | 4 | Plugin URI:  https://restezconnectes.fr/tutoriel-wordpress-lextension-send-pdf-for-contact-form-7/ |
  | 5 | 5 | Description: Send a PDF with Contact Form 7. It is originally created for Contact Form 7 plugin. |
  | 6 |  | Version:     1.0.2.~~3~~ |
  |  | 6 | Version:     1.0.2.4 |
  | 7 | 7 | Author:      Florent Maillefaud |
  | 8 | 8 | Author URI:  https://restezconnectes.fr |
  | 9 | 9 | License:     GPL3 or later |
  | 10 | 10 | Domain Path: /languages |
  | 11 | 11 | Text Domain: send-pdf-for-contact-form-7 |
  | 12 | 12 | GitHub Plugin URI: https://github.com/Florent73/send-pdf-for-contact-form-7 |
  | 13 | 13 | \*/ |
  | 14 | 14 |  |
  | 15 | 15 | /\*  Copyright 2007-2024 Florent Maillefaud (email: contact at restezconnectes.fr) |
  | 16 | 16 |  |
  | 17 | 17 | This program is free software; you can redistribute it and/or modify |
  | 18 | 18 | it under the terms of the GNU General Public License as published by |
  | 19 | 19 | the Free Software Foundation; either version 2 of the License, or |
  | 20 | 20 | (at your option) any later version. |
  | 21 | 21 |  |
  | 22 | 22 | This program is distributed in the hope that it will be useful, |
  | 23 | 23 | but WITHOUT ANY WARRANTY; without even the implied warranty of |
  | 24 | 24 | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
  | 25 | 25 | GNU General Public License for more details. |
  | 26 | 26 |  |
  | 27 | 27 | You should have received a copy of the GNU General Public License |
  | 28 | 28 | along with this program; if not, write to the Free Software |
  | 29 | 29 | Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA |
  | 30 | 30 | \*/ |
  | 31 | 31 |  |
  | 32 | 32 | defined( 'ABSPATH' ) |
  | 33 | 33 | or die( 'No direct load ! ' ); |
  | 34 | 34 |  |
  | 35 | 35 | define( 'WPCF7PDF\_DIR', plugin\_dir\_path( \_\_FILE\_\_ ) ); |
  | 36 | 36 | define( 'WPCF7PDF\_URL', plugins\_url('/', \_\_FILE\_\_) ); |
  | 37 | 37 | define( 'WPCF7PDF\_PLUGIN\_BASENAME', plugin\_basename( \_\_FILE\_\_ ) ); |
  | 38 | 38 |  |
  | 39 |  | if( !defined( 'WPCF7PDF\_VERSION' )) { define( 'WPCF7PDF\_VERSION', '1.0.2.~~3~~' ); } |
  |  | 39 | if( !defined( 'WPCF7PDF\_VERSION' )) { define( 'WPCF7PDF\_VERSION', '1.0.2.4' ); } |
  | 40 | 40 | if( !defined( 'WPCF7PDF\_TEXT\_DOMAIN' )) { define( 'WPCF7PDF\_TEXT\_DOMAIN', 'send-pdf-for-contact-form-7' ); } |
  | 41 | 41 |  |
  | 42 | 42 | if ( ! defined( 'WPCF7\_ADMIN\_READ\_CAPABILITY' ) ) { define( 'WPCF7\_ADMIN\_READ\_CAPABILITY', 'manage\_options' ); } |
  | 43 | 43 | if ( ! defined( 'WPCF7\_ADMIN\_READ\_WRITE\_CAPABILITY' ) ) {define( 'WPCF7\_ADMIN\_READ\_WRITE\_CAPABILITY', 'manage\_options' ); } |
  | 44 | 44 |  |
  | 45 | 45 | require WPCF7PDF\_DIR . 'classes/send-pdf.php'; |
  | 46 | 46 | require WPCF7PDF\_DIR . 'classes/prepare-pdf.php'; |
  | 47 | 47 | require WPCF7PDF\_DIR . 'classes/generate.php'; |
  | 48 | 48 | require WPCF7PDF\_DIR . 'classes/settings.php'; |
  | 49 | 49 | require WPCF7PDF\_DIR . 'includes/shortcodes.php'; |
  | 50 | 50 |  |
  | 51 | 51 | add\_action( 'plugins\_loaded', '\_cf7\_sendpdf\_load' ); |
  | 52 | 52 | function \_cf7\_sendpdf\_load() { |
  | 53 | 53 | $cf7\_sendpdf = new cf7\_sendpdf(); |
  | 54 | 54 | $cf7\_sendpdf->hooks(); |
  | 55 | 55 | } |
  | 56 | 56 |  |
  | 57 | 57 | // Enable localization |
  | 58 | 58 | add\_action( 'init', '\_cf7\_load\_translation' ); |
  | 59 | 59 | function \_cf7\_load\_translation() { |
  | 60 | 60 | load\_plugin\_textdomain( 'send-pdf-for-contact-form-7', false, dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/' ); |
  | 61 | 61 | } |
  | 62 | 62 |  |
  | 63 | 63 | // Activate / desactivate / unnstall plugin |
  | 64 | 64 | register\_deactivation\_hook( \_\_FILE\_\_, array( 'cf7\_sendpdf', 'wpcf7pdf\_deactivation' ) ); |
  | 65 | 65 | register\_uninstall\_hook( \_\_FILE\_\_, array( 'cf7\_sendpdf', 'wpcf7pdf\_uninstall' ) ); |
  | 66 | 66 | add\_action( 'plugins\_loaded', array( 'cf7\_sendpdf', 'init' ) ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3074631&old=3069882&new_path=%2Fsend-pdf-for-contact-form-7%2Ftrunk&old_path=%2Fsend-pdf-for-contact-form-7%2Ftrunk)
* [Zip Archive](?format=zip&new=3074631&old=3069882&new_path=%2Fsend-pdf-for-contact-form-7%2Ftrunk&old_path=%2Fsend-pdf-for-contact-form-7%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

