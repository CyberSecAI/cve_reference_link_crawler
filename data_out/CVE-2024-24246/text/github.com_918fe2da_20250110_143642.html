
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fqpdf%2Fqpdf%2Fissues%2F1123)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fqpdf%2Fqpdf%2Fissues%2F1123)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=qpdf%2Fqpdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[qpdf](/qpdf)
/
**[qpdf](/qpdf/qpdf)**
Public

* [Notifications](/login?return_to=%2Fqpdf%2Fqpdf) You must be signed in to change notification settings
* [Fork
  287](/login?return_to=%2Fqpdf%2Fqpdf)
* [Star
   3.6k](/login?return_to=%2Fqpdf%2Fqpdf)

* [Code](/qpdf/qpdf)
* [Issues
  116](/qpdf/qpdf/issues)
* [Pull requests
  25](/qpdf/qpdf/pulls)
* [Discussions](/qpdf/qpdf/discussions)
* [Actions](/qpdf/qpdf/actions)
* [Projects
  0](/qpdf/qpdf/projects)
* [Wiki](/qpdf/qpdf/wiki)
* [Security](/qpdf/qpdf/security)
* [Insights](/qpdf/qpdf/pulse)

Additional navigation options

* [Code](/qpdf/qpdf)
* [Issues](/qpdf/qpdf/issues)
* [Pull requests](/qpdf/qpdf/pulls)
* [Discussions](/qpdf/qpdf/discussions)
* [Actions](/qpdf/qpdf/actions)
* [Projects](/qpdf/qpdf/projects)
* [Wiki](/qpdf/qpdf/wiki)
* [Security](/qpdf/qpdf/security)
* [Insights](/qpdf/qpdf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fqpdf%2Fqpdf%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fqpdf%2Fqpdf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# qpdf11.9.0 found a heap-buffer-overflow crash #1123

Closed

[Crspidey](/Crspidey) opened this issue
Jan 15, 2024
· 4 comments

Closed

# [qpdf11.9.0 found a heap-buffer-overflow crash](#top) #1123

[Crspidey](/Crspidey) opened this issue
Jan 15, 2024
· 4 comments

Labels
[bug](/qpdf/qpdf/labels/bug)
[next](/qpdf/qpdf/labels/next)

## Comments

[![@Crspidey](https://avatars.githubusercontent.com/u/51468842?s=80&u=d6f6129642c8b3dfb0eb8fa81b14ce726affbb11&v=4)](/Crspidey)

Copy link

### **[Crspidey](/Crspidey)** commented [Jan 15, 2024](#issue-2081133505)

| Description I found a heap-buffer-overflow crash when I use this instruction:  ``` /qpdf/build/qpdf/qpdf   --json-input  POC_qpdf11-9-0_heap-buffer-overflow  output_json.pdf #Changed the name of id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 to POC_qpdf11-9-0_heap-buffer-overflow ``` Version ``` chen@DESKTOP-9AK26R1:~/qpdf2/crashes$ /home/chen/qpdf2/qpdf/build/qpdf/qpdf --version qpdf version 11.9.0 Run qpdf --copyright to see copyright and license information. ``` Reference <https://github.com/qpdf/qpdf> **Actual Behavior** heap-buffer-overflow PoC <https://github.com/Crspidey/my-poc/blob/main/POC_qpdf11-9-0_heap-buffer-overflow> Reproduction ``` git clone https://github.com/qpdf/qpdf cd qpdf ./build-scripts/build-linux #Modified the instruction to add ASAN. #cmake -S . -B build -DCI_MODE=1 -DCMAKE_BUILD_TYPE=RelWithDebInfo \ #      -DREQUIRE_CRYPTO_OPENSSL=1 -DREQUIRE_CRYPTO_GNUTLS=1   \ #      -DCMAKE_C_FLAGS="${CMAKE_C_FLAGS} -fsanitize=address" \ #      -DCMAKE_CXX_FLAGS="${CMAKE_CXX_FLAGS} -fsanitize=address" \ ``` ASAN Log ``` chen@DESKTOP-9AK26R1:~/qpdf2/crashes$ /home/chen/qpdf2/qpdf/build/qpdf/qpdf --json-input id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 output_json.pdf WARNING: id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 (obj:3 0 R, offset 738): "stream.data" must be a string ================================================================= ==3736095==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60600000d2d8 at pc 0x7f929f1e4327 bp 0x7ffc280f2ac0 sp 0x7ffc280f2ab0 READ of size 8 at 0x60600000d2d8 thread T0     #0 0x7f929f1e4326 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() /usr/include/c++/11/bits/shared_ptr_base.h:704     #1 0x7f929f1e4326 in std::__shared_ptr<QPDFObject, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() /usr/include/c++/11/bits/shared_ptr_base.h:1154     #2 0x7f929f1e4326 in std::shared_ptr<QPDFObject>::~shared_ptr() /usr/include/c++/11/bits/shared_ptr.h:122     #3 0x7f929f1e4326 in QPDFObjectHandle::~QPDFObjectHandle() /home/chen/qpdf2/qpdf/include/qpdf/QPDFObjectHandle.hh:64     #4 0x7f929f1e4326 in void __gnu_cxx::new_allocator<QPDFObjectHandle>::destroy<QPDFObjectHandle>(QPDFObjectHandle*) /usr/include/c++/11/ext/new_allocator.h:168     #5 0x7f929f1e4326 in void std::allocator_traits<std::allocator<QPDFObjectHandle> >::destroy<QPDFObjectHandle>(std::allocator<QPDFObjectHandle>&, QPDFObjectHandle*) /usr/include/c++/11/bits/alloc_traits.h:535     #6 0x7f929f1e4326 in std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::pop_back() /usr/include/c++/11/bits/stl_vector.h:1229     #7 0x7f929f1e4326 in QPDF::JSONReactor::containerEnd(JSON const&) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:419     #8 0x7f929ec79cf2 in handleToken /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1188     #9 0x7f929ec7c96f in parse /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1335     #10 0x7f929ec7d1c6 in JSON::parse(InputSource&, JSON::Reactor*) /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1352     #11 0x7f929f1f5e32 in QPDF::importJSON(std::shared_ptr<InputSource>, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:806     #12 0x7f929f1f6d34 in QPDF::createFromJSON(std::shared_ptr<InputSource>) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:786     #13 0x7f929f1fb3e3 in QPDF::createFromJSON(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:779     #14 0x7f929ee8deba in QPDFJob::doProcessOnce(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, std::function<void (QPDF*, char const*)>, char const*, bool, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1725     #15 0x7f929ee8e73e in QPDFJob::doProcess(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, std::function<void (QPDF*, char const*)>, char const*, bool, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1763     #16 0x7f929ee90383 in QPDFJob::processFile(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, char const*, char const*, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1819     #17 0x7f929eefbcb3 in QPDFJob::createQPDF() /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:434     #18 0x7f929ef081d9 in QPDFJob::run() /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:516     #19 0x55dff954ba51 in realmain(int, char**) /home/chen/qpdf2/qpdf/qpdf/qpdf.cc:36     #20 0x7f929e5cdd8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58     #21 0x7f929e5cde3f in __libc_start_main_impl ../csu/libc-start.c:392     #22 0x55dff954b884 in _start (/home/chen/qpdf2/qpdf/build/qpdf/qpdf+0x2884)  0x60600000d2d8 is located 8 bytes to the left of 64-byte region [0x60600000d2e0,0x60600000d320) allocated by thread T0 here:     #0 0x7f929f5c91e7 in operator new(unsigned long) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:99     #1 0x7f929ed5361a in __gnu_cxx::new_allocator<QPDFObjectHandle>::allocate(unsigned long, void const*) /usr/include/c++/11/ext/new_allocator.h:127     #2 0x7f929ed5361a in std::allocator_traits<std::allocator<QPDFObjectHandle> >::allocate(std::allocator<QPDFObjectHandle>&, unsigned long) /usr/include/c++/11/bits/alloc_traits.h:464     #3 0x7f929ed5361a in std::_Vector_base<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::_M_allocate(unsigned long) /usr/include/c++/11/bits/stl_vector.h:346     #4 0x7f929ed5361a in void std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::_M_realloc_insert<QPDFObjectHandle const&>(__gnu_cxx::__normal_iterator<QPDFObjectHandle*, std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> > >, QPDFObjectHandle const&) /usr/include/c++/11/bits/vector.tcc:440  SUMMARY: AddressSanitizer: heap-buffer-overflow /usr/include/c++/11/bits/shared_ptr_base.h:704 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() Shadow bytes around the buggy address:   0x0c0c7fff9a00: 00 00 02 fa fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a10: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa   0x0c0c7fff9a20: fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00   0x0c0c7fff9a30: 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a40: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa =>0x0c0c7fff9a50: fd fd fd fd fd fd fd fd fa fa fa[fa]00 00 00 00   0x0c0c7fff9a60: 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a70: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa   0x0c0c7fff9a80: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00   0x0c0c7fff9a90: 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9aa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==3736095==ABORTING ``` GDB log ``` (gdb) set args --json-input id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 output_json.pdf (gdb) run Starting program: /home/chen/qpdf2/qpdf/build/qpdf/qpdf --json-input id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 output_json.pdf [Thread debugging using libthread_db enabled] Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1". WARNING: id:000002,sig:11,src:001030+000958,time:17469012,execs:8722360,op:splice,rep:15 (obj:3 0 R, offset 738): "stream.data" must be a string ================================================================= ==3736122==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60600000d2d8 at pc 0x7ffff7297327 bp 0x7fffffff7740 sp 0x7fffffff7730 READ of size 8 at 0x60600000d2d8 thread T0     #0 0x7ffff7297326 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() /usr/include/c++/11/bits/shared_ptr_base.h:704     #1 0x7ffff7297326 in std::__shared_ptr<QPDFObject, (__gnu_cxx::_Lock_policy)2>::~__shared_ptr() /usr/include/c++/11/bits/shared_ptr_base.h:1154     #2 0x7ffff7297326 in std::shared_ptr<QPDFObject>::~shared_ptr() /usr/include/c++/11/bits/shared_ptr.h:122     #3 0x7ffff7297326 in QPDFObjectHandle::~QPDFObjectHandle() /home/chen/qpdf2/qpdf/include/qpdf/QPDFObjectHandle.hh:64     #4 0x7ffff7297326 in void __gnu_cxx::new_allocator<QPDFObjectHandle>::destroy<QPDFObjectHandle>(QPDFObjectHandle*) /usr/include/c++/11/ext/new_allocator.h:168     #5 0x7ffff7297326 in void std::allocator_traits<std::allocator<QPDFObjectHandle> >::destroy<QPDFObjectHandle>(std::allocator<QPDFObjectHandle>&, QPDFObjectHandle*) /usr/include/c++/11/bits/alloc_traits.h:535     #6 0x7ffff7297326 in std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::pop_back() /usr/include/c++/11/bits/stl_vector.h:1229     #7 0x7ffff7297326 in QPDF::JSONReactor::containerEnd(JSON const&) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:419     #8 0x7ffff6d2ccf2 in handleToken /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1188     #9 0x7ffff6d2f96f in parse /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1335     #10 0x7ffff6d301c6 in JSON::parse(InputSource&, JSON::Reactor*) /home/chen/qpdf2/qpdf/libqpdf/JSON.cc:1352     #11 0x7ffff72a8e32 in QPDF::importJSON(std::shared_ptr<InputSource>, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:806     #12 0x7ffff72a9d34 in QPDF::createFromJSON(std::shared_ptr<InputSource>) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:786     #13 0x7ffff72ae3e3 in QPDF::createFromJSON(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /home/chen/qpdf2/qpdf/libqpdf/QPDF_json.cc:779     #14 0x7ffff6f40eba in QPDFJob::doProcessOnce(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, std::function<void (QPDF*, char const*)>, char const*, bool, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1725     #15 0x7ffff6f4173e in QPDFJob::doProcess(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, std::function<void (QPDF*, char const*)>, char const*, bool, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1763     #16 0x7ffff6f43383 in QPDFJob::processFile(std::unique_ptr<QPDF, std::default_delete<QPDF> >&, char const*, char const*, bool, bool) /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:1819     #17 0x7ffff6faecb3 in QPDFJob::createQPDF() /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:434     #18 0x7ffff6fbb1d9 in QPDFJob::run() /home/chen/qpdf2/qpdf/libqpdf/QPDFJob.cc:516     #19 0x555555556a51 in realmain(int, char**) /home/chen/qpdf2/qpdf/qpdf/qpdf.cc:36     #20 0x7ffff6680d8f in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:58     #21 0x7ffff6680e3f in __libc_start_main_impl ../csu/libc-start.c:392     #22 0x555555556884 in _start (/home/chen/qpdf2/qpdf/build/qpdf/qpdf+0x2884)  0x60600000d2d8 is located 8 bytes to the left of 64-byte region [0x60600000d2e0,0x60600000d320) allocated by thread T0 here:     #0 0x7ffff767c1e7 in operator new(unsigned long) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:99     #1 0x7ffff6e0661a in __gnu_cxx::new_allocator<QPDFObjectHandle>::allocate(unsigned long, void const*) /usr/include/c++/11/ext/new_allocator.h:127     #2 0x7ffff6e0661a in std::allocator_traits<std::allocator<QPDFObjectHandle> >::allocate(std::allocator<QPDFObjectHandle>&, unsigned long) /usr/include/c++/11/bits/alloc_traits.h:464     #3 0x7ffff6e0661a in std::_Vector_base<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::_M_allocate(unsigned long) /usr/include/c++/11/bits/stl_vector.h:346     #4 0x7ffff6e0661a in void std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> >::_M_realloc_insert<QPDFObjectHandle const&>(__gnu_cxx::__normal_iterator<QPDFObjectHandle*, std::vector<QPDFObjectHandle, std::allocator<QPDFObjectHandle> > >, QPDFObjectHandle const&) /usr/include/c++/11/bits/vector.tcc:440  SUMMARY: AddressSanitizer: heap-buffer-overflow /usr/include/c++/11/bits/shared_ptr_base.h:704 in std::__shared_count<(__gnu_cxx::_Lock_policy)2>::~__shared_count() Shadow bytes around the buggy address:   0x0c0c7fff9a00: 00 00 02 fa fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a10: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa   0x0c0c7fff9a20: fd fd fd fd fd fd fd fd fa fa fa fa 00 00 00 00   0x0c0c7fff9a30: 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a40: fa fa fa fa fd fd fd fd fd fd fd fd fa fa fa fa =>0x0c0c7fff9a50: fd fd fd fd fd fd fd fd fa fa fa[fa]00 00 00 00   0x0c0c7fff9a60: 00 00 00 00 fa fa fa fa fd fd fd fd fd fd fd fd   0x0c0c7fff9a70: fa fa fa fa 00 00 00 00 00 00 00 00 fa fa fa fa   0x0c0c7fff9a80: 00 00 00 00 00 00 00 00 fa fa fa fa 00 00 00 00   0x0c0c7fff9a90: 00 00 00 00 fa fa fa fa fa fa fa fa fa fa fa fa   0x0c0c7fff9aa0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==3736122==ABORTING [Inferior 1 (process 3736122) exited with code 01] ``` Environment ``` Distributor ID: Ubuntu Description:    Ubuntu 22.04.3 LTS Release:        22.04 Codename:       jammy   gcc version 11.4.0 (Ubuntu 11.4.0-1ubuntu1~22.04) clang version 11.0.0 (https://github.com/aflgo/aflgo fa125da5d70621daf7141c6279877c97708c8c1f)  afl-cc++4.09a  build-essential is already the newest version (12.9ubuntu3).  libjpeg-dev is already the newest version (8c-2ubuntu10).  ghostscript is already the newest version (9.55.0~dfsg1-0ubuntu5.6).  libgnutls28-dev is already the newest version (3.7.3-4ubuntu1.3).  libssl-dev is already the newest version (3.0.2-0ubuntu1.12).  zlib1g-dev is already the newest version (1:1.2.11.dfsg-2ubuntu9.2).  libtiff-tools is already the newest version (4.3.0-6ubuntu0.7).  cmake is already the newest version (3.22.1-1ubuntu1.22.04.1).  ``` Credit Chen zhiyuan (2507519957@qq.com/czy\_edu@whut.edu.cn) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@Crspidey](https://avatars.githubusercontent.com/u/51468842?s=80&u=d6f6129642c8b3dfb0eb8fa81b14ce726affbb11&v=4)](/Crspidey)

Copy link

Author

### **[Crspidey](/Crspidey)** commented [Jan 15, 2024](#issuecomment-1891219995) • edited Loading

| I found this poc when I used AFL++ to fuzz qpdf11.1.0,ASAN shows the result as segv on unknow address.I thought that the new version should not have this error,after trying to use the new version the error is heap-buffer-overflow. I am trying to analyze it further. (The commands used are the same) |
| --- |

All reactions

Sorry, something went wrong.

[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=80&v=4)](/jberkenbilt)

Copy link

Contributor

### **[jberkenbilt](/jberkenbilt)** commented [Jan 15, 2024](#issuecomment-1892153572)

| Thanks. I'll take a look. Could be deep recursion. I intend to add fuzzing tests for the JSON part of the code. It's been on my to-do list for a while, and coincidentally, I just bumped it up a few days ago. |
| --- |

All reactions

Sorry, something went wrong.

[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)
[jberkenbilt](/jberkenbilt)
added
[bug](/qpdf/qpdf/labels/bug)
[next](/qpdf/qpdf/labels/next)
labels
[Jan 15, 2024](#event-11488114809)

[![@Crspidey](https://avatars.githubusercontent.com/u/51468842?s=80&u=d6f6129642c8b3dfb0eb8fa81b14ce726affbb11&v=4)](/Crspidey)

Copy link

Author

### **[Crspidey](/Crspidey)** commented [Jan 15, 2024](#issuecomment-1892178383) • edited Loading

| deep recursion  Thanks for your reply, I used the command qpdf --json input.pdf output.json to generate the json files I needed.After that,I used AFL++ to fuzz qpdf by using that instruction(afl-fuzz -i in -o out -x json.dict -- /path/to/qpdf/build/qpdf/qpdf --json-input @@ output\_json.pdf) |
| --- |

All reactions

Sorry, something went wrong.

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 3, 2024](#ref-commit-664cfd1)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Handle parse error stream data (](/jberkenbilt/qpdf/commit/664cfd11a0c13de292e64a1ffb8b064941573168 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state.")[fixes](/jberkenbilt/qpdf/commit/664cfd11a0c13de292e64a1ffb8b064941573168 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)[)](/jberkenbilt/qpdf/commit/664cfd11a0c13de292e64a1ffb8b064941573168 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state.")`
…

`[664cfd1](/jberkenbilt/qpdf/commit/664cfd11a0c13de292e64a1ffb8b064941573168)`

```
A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 3, 2024](#ref-commit-ddffeea)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Create JSON fuzzer with file from issue](/jberkenbilt/qpdf/commit/ddffeea90a46f2030611e2e4005e6d7c796ba2ed "Create JSON fuzzer with file from issue #1123") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)`

`[ddffeea](/jberkenbilt/qpdf/commit/ddffeea90a46f2030611e2e4005e6d7c796ba2ed)`

[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=80&v=4)](/jberkenbilt)

Copy link

Contributor

### **[jberkenbilt](/jberkenbilt)** commented [Feb 3, 2024](#issuecomment-1925453648)

| I will be pushing a fix for this. I also added qpdf's JSON code to oss-fuzz. |
| --- |

All reactions

Sorry, something went wrong.

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 3, 2024](#ref-commit-518bdf6)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Create JSON fuzzer with file from issue](/jberkenbilt/qpdf/commit/518bdf631fdba74a3d1171620a1b18effa6f19b6 "Create JSON fuzzer with file from issue #1123") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)`

`[518bdf6](/jberkenbilt/qpdf/commit/518bdf631fdba74a3d1171620a1b18effa6f19b6)`

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-2cbd96f)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Handle parse error stream data (](/jberkenbilt/qpdf/commit/2cbd96f3b88f77dda78d00dd8e8e022eef5857be "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")[fixes](/jberkenbilt/qpdf/commit/2cbd96f3b88f77dda78d00dd8e8e022eef5857be "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)[)](/jberkenbilt/qpdf/commit/2cbd96f3b88f77dda78d00dd8e8e022eef5857be "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")`
…

`[2cbd96f](/jberkenbilt/qpdf/commit/2cbd96f3b88f77dda78d00dd8e8e022eef5857be)`

```
A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-b2d5c9b)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Add json fuzzer with seed files from](/jberkenbilt/qpdf/commit/b2d5c9b7f23cb2b871a478b4a604d70c0ab4c77d "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123) [and test suite](/jberkenbilt/qpdf/commit/b2d5c9b7f23cb2b871a478b4a604d70c0ab4c77d "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.")`
…

`[b2d5c9b](/jberkenbilt/qpdf/commit/b2d5c9b7f23cb2b871a478b4a604d70c0ab4c77d)`

```
...as well as some cases generated in CI from earlier attempts at
fixing this.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-0c5f770)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Handle parse error stream data (](/jberkenbilt/qpdf/commit/0c5f77032a6f55f704b39a9ea9fb87ced104a5d0 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")[fixes](/jberkenbilt/qpdf/commit/0c5f77032a6f55f704b39a9ea9fb87ced104a5d0 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)[)](/jberkenbilt/qpdf/commit/0c5f77032a6f55f704b39a9ea9fb87ced104a5d0 "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")`
…

`[0c5f770](/jberkenbilt/qpdf/commit/0c5f77032a6f55f704b39a9ea9fb87ced104a5d0)`

```
A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-d7e5822)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Add json fuzzer with seed files from](/jberkenbilt/qpdf/commit/d7e582206fea66b85a0cabdc69a182c1ce912853 "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123) [and test suite](/jberkenbilt/qpdf/commit/d7e582206fea66b85a0cabdc69a182c1ce912853 "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.")`
…

`[d7e5822](/jberkenbilt/qpdf/commit/d7e582206fea66b85a0cabdc69a182c1ce912853)`

```
...as well as some cases generated in CI from earlier attempts at
fixing this.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-db10031)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Handle parse error stream data (](/jberkenbilt/qpdf/commit/db10031b41700dc25ee692e03a427903096d3fdf "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")[fixes](/jberkenbilt/qpdf/commit/db10031b41700dc25ee692e03a427903096d3fdf "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123)[)](/jberkenbilt/qpdf/commit/db10031b41700dc25ee692e03a427903096d3fdf "Handle parse error stream data (fixes #1123)

A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.")`
…

`[db10031](/jberkenbilt/qpdf/commit/db10031b41700dc25ee692e03a427903096d3fdf)`

```
A parse error in stream data in which stream data contained a nested
object would cause a crash because qpdf was not correctly updating its
internal state. Rework the QPDF json reactor to not be sensitive to
parse errors in this way.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-3903811)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Add json fuzzer with seed files from](/jberkenbilt/qpdf/commit/3903811b906bf4ff62333a23d95a76b6a5b10f15 "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123) [and test suite](/jberkenbilt/qpdf/commit/3903811b906bf4ff62333a23d95a76b6a5b10f15 "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.")`
…

`[3903811](/jberkenbilt/qpdf/commit/3903811b906bf4ff62333a23d95a76b6a5b10f15)`

```
...as well as some cases generated in CI from earlier attempts at
fixing this.
```

[jberkenbilt](/jberkenbilt)
added a commit
to jberkenbilt/qpdf
that referenced
this issue
[Feb 4, 2024](#ref-commit-f0fb19d)
[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)

`[Add json fuzzer with seed files from](/jberkenbilt/qpdf/commit/f0fb19df9d31a550960fac12a6cc96432b885bba "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.") [qpdf#1123](https://github.com/qpdf/qpdf/issues/1123) [and test suite](/jberkenbilt/qpdf/commit/f0fb19df9d31a550960fac12a6cc96432b885bba "Add json fuzzer with seed files from #1123 and test suite

...as well as some cases generated in CI from earlier attempts at
fixing this.")`
…

`[f0fb19d](/jberkenbilt/qpdf/commit/f0fb19df9d31a550960fac12a6cc96432b885bba)`

```
...as well as some cases generated in CI from earlier attempts at
fixing this.
```

[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=40&v=4)](/jberkenbilt)
[jberkenbilt](/jberkenbilt)
closed this as [completed](/qpdf/qpdf/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[cb0f390](/qpdf/qpdf/commit/cb0f390cc1f98a8e82b27259f8f3cd5f162992eb)`
[Feb 4, 2024](#event-11696841757)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fqpdf%2Fqpdf%2Fissues%2F1123)

Assignees

No one assigned

Labels

[bug](/qpdf/qpdf/labels/bug)
[next](/qpdf/qpdf/labels/next)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@jberkenbilt](https://avatars.githubusercontent.com/u/997128?s=52&v=4)](/jberkenbilt) [![@Crspidey](https://avatars.githubusercontent.com/u/51468842?s=52&v=4)](/Crspidey)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

