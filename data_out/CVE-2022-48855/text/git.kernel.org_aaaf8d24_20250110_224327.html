

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2022-03-09 16:11:45 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-03-16 12:49:01 +0100 |
| commit | [3fc0fd724d199e061432b66a8d85b7d48fe485f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)) | |
| tree | [c3760e4f0a159dc3a311dcf046e3c0f386211edf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7) | |
| parent | [0c9a947a6818b3b0c52c49e40eceede597602e78](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c9a947a6818b3b0c52c49e40eceede597602e78) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7&id2=0c9a947a6818b3b0c52c49e40eceede597602e78)) | |
| download | [linux-3fc0fd724d199e061432b66a8d85b7d48fe485f7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3fc0fd724d199e061432b66a8d85b7d48fe485f7.tar.gz) | |

sctp: fix kernel-infoleak for SCTP sockets[ Upstream commit 633593a808980f82d251d0ca89730d8bb8b0220c ]
syzbot reported a kernel infoleak [1] of 4 bytes.
After analysis, it turned out r->idiag\_expires is not initialized
if inet\_sctp\_diag\_fill() calls inet\_diag\_msg\_common\_fill()
Make sure to clear idiag\_timer/idiag\_retrans/idiag\_expires
and let inet\_diag\_msg\_sctpasoc\_fill() fill them again if needed.
[1]
BUG: KMSAN: kernel-infoleak in instrument\_copy\_to\_user include/linux/instrumented.h:121 [inline]
BUG: KMSAN: kernel-infoleak in copyout lib/iov\_iter.c:154 [inline]
BUG: KMSAN: kernel-infoleak in \_copy\_to\_iter+0x6ef/0x25a0 lib/iov\_iter.c:668
instrument\_copy\_to\_user include/linux/instrumented.h:121 [inline]
copyout lib/iov\_iter.c:154 [inline]
\_copy\_to\_iter+0x6ef/0x25a0 lib/iov\_iter.c:668
copy\_to\_iter include/linux/uio.h:162 [inline]
simple\_copy\_to\_iter+0xf3/0x140 net/core/datagram.c:519
\_\_skb\_datagram\_iter+0x2d5/0x11b0 net/core/datagram.c:425
skb\_copy\_datagram\_iter+0xdc/0x270 net/core/datagram.c:533
skb\_copy\_datagram\_msg include/linux/skbuff.h:3696 [inline]
netlink\_recvmsg+0x669/0x1c80 net/netlink/af\_netlink.c:1977
sock\_recvmsg\_nosec net/socket.c:948 [inline]
sock\_recvmsg net/socket.c:966 [inline]
\_\_sys\_recvfrom+0x795/0xa10 net/socket.c:2097
\_\_do\_sys\_recvfrom net/socket.c:2115 [inline]
\_\_se\_sys\_recvfrom net/socket.c:2111 [inline]
\_\_x64\_sys\_recvfrom+0x19d/0x210 net/socket.c:2111
do\_syscall\_x64 arch/x86/entry/common.c:51 [inline]
do\_syscall\_64+0x54/0xd0 arch/x86/entry/common.c:82
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Uninit was created at:
slab\_post\_alloc\_hook mm/slab.h:737 [inline]
slab\_alloc\_node mm/slub.c:3247 [inline]
\_\_kmalloc\_node\_track\_caller+0xe0c/0x1510 mm/slub.c:4975
kmalloc\_reserve net/core/skbuff.c:354 [inline]
\_\_alloc\_skb+0x545/0xf90 net/core/skbuff.c:426
alloc\_skb include/linux/skbuff.h:1158 [inline]
netlink\_dump+0x3e5/0x16c0 net/netlink/af\_netlink.c:2248
\_\_netlink\_dump\_start+0xcf8/0xe90 net/netlink/af\_netlink.c:2373
netlink\_dump\_start include/linux/netlink.h:254 [inline]
inet\_diag\_handler\_cmd+0x2e7/0x400 net/ipv4/inet\_diag.c:1341
sock\_diag\_rcv\_msg+0x24a/0x620
netlink\_rcv\_skb+0x40c/0x7e0 net/netlink/af\_netlink.c:2494
sock\_diag\_rcv+0x63/0x80 net/core/sock\_diag.c:277
netlink\_unicast\_kernel net/netlink/af\_netlink.c:1317 [inline]
netlink\_unicast+0x1093/0x1360 net/netlink/af\_netlink.c:1343
netlink\_sendmsg+0x14d9/0x1720 net/netlink/af\_netlink.c:1919
sock\_sendmsg\_nosec net/socket.c:705 [inline]
sock\_sendmsg net/socket.c:725 [inline]
sock\_write\_iter+0x594/0x690 net/socket.c:1061
do\_iter\_readv\_writev+0xa7f/0xc70
do\_iter\_write+0x52c/0x1500 fs/read\_write.c:851
vfs\_writev fs/read\_write.c:924 [inline]
do\_writev+0x645/0xe00 fs/read\_write.c:967
\_\_do\_sys\_writev fs/read\_write.c:1040 [inline]
\_\_se\_sys\_writev fs/read\_write.c:1037 [inline]
\_\_x64\_sys\_writev+0xe5/0x120 fs/read\_write.c:1037
do\_syscall\_x64 arch/x86/entry/common.c:51 [inline]
do\_syscall\_64+0x54/0xd0 arch/x86/entry/common.c:82
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
Bytes 68-71 of 2508 are uninitialized
Memory access of size 2508 starts at ffff888114f9b000
Data copied to user address 00007f7fe09ff2e0
CPU: 1 PID: 3478 Comm: syz-executor306 Not tainted 5.17.0-rc4-syzkaller #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Fixes: 8f840e47f190 ("sctp: add the sctp\_diag.c file")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Reported-by: syzbot <syzkaller@googlegroups.com>
Cc: Vlad Yasevich <vyasevich@gmail.com>
Cc: Neil Horman <nhorman@tuxdriver.com>
Cc: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>
Reviewed-by: Xin Long <lucien.xin@gmail.com>
Link: [https://lore.kernel.org/r/20220310001145.297371-1-eric.dumazet@gmail.com](https://lore.kernel.org/r/20220310001145.297371-1-eric.dumazet%40gmail.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)

| -rw-r--r-- | [net/sctp/sctp\_diag.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sctp/sctp_diag.c?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 6 deletions

| diff --git a/net/sctp/sctp\_diag.c b/net/sctp/sctp\_diag.cindex e8f56b7c5afb1f..a044964fa80231 100644--- a/[net/sctp/sctp\_diag.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sctp/sctp_diag.c?id=0c9a947a6818b3b0c52c49e40eceede597602e78)+++ b/[net/sctp/sctp\_diag.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sctp/sctp_diag.c?id=3fc0fd724d199e061432b66a8d85b7d48fe485f7)@@ -45,10 +45,6 @@ static void inet\_diag\_msg\_sctpasoc\_fill(struct inet\_diag\_msg \*r, r->idiag\_timer = SCTP\_EVENT\_TIMEOUT\_T3\_RTX; r->idiag\_retrans = asoc->rtx\_data\_chunks; r->idiag\_expires = jiffies\_to\_msecs(t3\_rtx->expires - jiffies);- } else {- r->idiag\_timer = 0;- r->idiag\_retrans = 0;- r->idiag\_expires = 0; } } @@ -128,13 +124,14 @@ static int inet\_sctp\_diag\_fill(struct sock \*sk, struct sctp\_association \*asoc, r = nlmsg\_data(nlh); BUG\_ON(!sk\_fullsock(sk)); + r->idiag\_timer = 0;+ r->idiag\_retrans = 0;+ r->idiag\_expires = 0; if (asoc) { inet\_diag\_msg\_sctpasoc\_fill(r, sk, asoc); } else { inet\_diag\_msg\_common\_fill(r, sk); r->idiag\_state = sk->sk\_state;- r->idiag\_timer = 0;- r->idiag\_retrans = 0; }  if (inet\_diag\_msg\_attrs\_fill(sk, skb, r, ext, user\_ns, net\_admin)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:42:04 +0000

