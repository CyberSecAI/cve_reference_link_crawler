=== Content from github.com_644555b7_20250111_202006.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fblob%2Ff95222bdd22d2ac4e5b8ed6fe912b645e213c3b5%2Fmetadata%2Fmetadata.go)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fblob%2Ff95222bdd22d2ac4e5b8ed6fe912b645e213c3b5%2Fmetadata%2Fmetadata.go)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=theupdateframework%2Fgo-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[go-tuf](/theupdateframework/go-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fgo-tuf) You must be signed in to change notification settings
* [Fork
  110](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)
* [Star
   639](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)

* [Code](/theupdateframework/go-tuf)
* [Issues
  24](/theupdateframework/go-tuf/issues)
* [Pull requests
  2](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects
  1](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/go-tuf)
* [Issues](/theupdateframework/go-tuf/issues)
* [Pull requests](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

## Files

 f95222b
## Breadcrumbs

1. [go-tuf](/theupdateframework/go-tuf/tree/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5)
2. /[metadata](/theupdateframework/go-tuf/tree/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5/metadata)
/
# metadata.go

Copy path Blame  Blame
## Latest commit

## History

[History](/theupdateframework/go-tuf/commits/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5/metadata/metadata.go)920 lines (864 loc) · 28.5 KB f95222b
## Breadcrumbs

1. [go-tuf](/theupdateframework/go-tuf/tree/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5)
2. /[metadata](/theupdateframework/go-tuf/tree/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5/metadata)
/
# metadata.go

Top
## File metadata and controls

* Code
* Blame

920 lines (864 loc) · 28.5 KB[Raw](https://github.com/theupdateframework/go-tuf/raw/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5/metadata/metadata.go)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920// Copyright 2024 The Update Framework Authors//// Licensed under the Apache License, Version 2.0 (the "License");// you may not use this file except in compliance with the License.// You may obtain a copy of the License at//// http://www.apache.org/licenses/LICENSE-2.0//// Unless required by applicable law or agreed to in writing, software// distributed under the License is distributed on an "AS IS" BASIS,// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.// See the License for the specific language governing permissions and// limitations under the License//// SPDX-License-Identifier: Apache-2.0//
package metadata
import ( "bytes" "crypto" "crypto/hmac" "crypto/sha256" "crypto/sha512" "encoding/base64" "encoding/binary" "encoding/hex" "encoding/json" "fmt" "hash" "io" "math" "os" "path/filepath" "slices" "strconv" "strings" "time"
 "github.com/secure-systems-lab/go-securesystemslib/cjson" "github.com/sigstore/sigstore/pkg/signature")
// Root return new metadata instance of type Rootfunc Root(expires ...time.Time) \*Metadata[RootType] { // expire now if there's nothing set if len(expires) == 0 { expires = []time.Time{time.Now().UTC()} } // populate Roles roles := map[string]\*Role{} for \_, r := range []string{ROOT, SNAPSHOT, TARGETS, TIMESTAMP} { roles[r] = &Role{ KeyIDs: []string{}, Threshold: 1, } } log.Info("Created metadata", "type", ROOT) return &Metadata[RootType]{ Signed: RootType{ Type: ROOT, SpecVersion: SPECIFICATION\_VERSION, Version: 1, Expires: expires[0], Keys: map[string]\*Key{}, Roles: roles, ConsistentSnapshot: true, }, Signatures: []Signature{}, }}
// Snapshot return new metadata instance of type Snapshotfunc Snapshot(expires ...time.Time) \*Metadata[SnapshotType] { // expire now if there's nothing set if len(expires) == 0 { expires = []time.Time{time.Now().UTC()} } log.Info("Created metadata", "type", SNAPSHOT) return &Metadata[SnapshotType]{ Signed: SnapshotType{ Type: SNAPSHOT, SpecVersion: SPECIFICATION\_VERSION, Version: 1, Expires: expires[0], Meta: map[string]\*MetaFiles{ "targets.json": { Version: 1, }, }, }, Signatures: []Signature{}, }}
// Timestamp return new metadata instance of type Timestampfunc Timestamp(expires ...time.Time) \*Metadata[TimestampType] { // expire now if there's nothing set if len(expires) == 0 { expires = []time.Time{time.Now().UTC()} } log.Info("Created metadata", "type", TIMESTAMP) return &Metadata[TimestampType]{ Signed: TimestampType{ Type: TIMESTAMP, SpecVersion: SPECIFICATION\_VERSION, Version: 1, Expires: expires[0], Meta: map[string]\*MetaFiles{ "snapshot.json": { Version: 1, }, }, }, Signatures: []Signature{}, }}
// Targets return new metadata instance of type Targetsfunc Targets(expires ...time.Time) \*Metadata[TargetsType] { // expire now if there's nothing set if len(expires) == 0 { expires = []time.Time{time.Now().UTC()} } log.Info("Created metadata", "type", TARGETS) return &Metadata[TargetsType]{ Signed: TargetsType{ Type: TARGETS, SpecVersion: SPECIFICATION\_VERSION, Version: 1, Expires: expires[0], Targets: map[string]\*TargetFiles{}, }, Signatures: []Signature{}, }}
// TargetFile return new metadata instance of type TargetFilesfunc TargetFile() \*TargetFiles { return &TargetFiles{ Length: 0, Hashes: Hashes{}, }}
// MetaFile return new metadata instance of type MetaFilefunc MetaFile(version int64) \*MetaFiles { if version < 1 { // attempting to set incorrect version log.Info("Attempting to set incorrect version for MetaFile", "version", version) version = 1 } return &MetaFiles{ Length: 0, Hashes: Hashes{}, Version: version, }}
// FromFile load metadata from filefunc (meta \*Metadata[T]) FromFile(name string) (\*Metadata[T], error) { in, err := os.Open(name) if err != nil { return nil, err } defer in.Close() data, err := io.ReadAll(in) if err != nil { return nil, err } m, err := fromBytes[T](data) if err != nil { return nil, err } \*meta = \*m log.Info("Loaded metadata from file", "name", name) return meta, nil}
// FromBytes deserialize metadata from bytesfunc (meta \*Metadata[T]) FromBytes(data []byte) (\*Metadata[T], error) { m, err := fromBytes[T](data) if err != nil { return nil, err } \*meta = \*m log.Info("Loaded metadata from bytes") return meta, nil}
// ToBytes serialize metadata to bytesfunc (meta \*Metadata[T]) ToBytes(pretty bool) ([]byte, error) { log.Info("Writing metadata to bytes") if pretty { return json.MarshalIndent(\*meta, "", "\t") } return json.Marshal(\*meta)}
// ToFile save metadata to filefunc (meta \*Metadata[T]) ToFile(name string, pretty bool) error { log.Info("Writing metadata to file", "name", name) data, err := meta.ToBytes(pretty) if err != nil { return err } return os.WriteFile(name, data, 0644)}
// Sign create signature over Signed and assign it to Signaturesfunc (meta \*Metadata[T]) Sign(signer signature.Signer) (\*Signature, error) { // encode the Signed part to canonical JSON so signatures are consistent payload, err := cjson.EncodeCanonical(meta.Signed) if err != nil { return nil, err } // sign the Signed part sb, err := signer.SignMessage(bytes.NewReader(payload)) if err != nil { return nil, &ErrUnsignedMetadata{Msg: "problem signing metadata"} } // get the signer's PublicKey publ, err := signer.PublicKey() if err != nil { return nil, err } // convert to TUF Key type to get keyID key, err := KeyFromPublicKey(publ) if err != nil { return nil, err } // build signature sig := &Signature{ KeyID: key.ID(), Signature: sb, } // update the Signatures part meta.Signatures = append(meta.Signatures, \*sig) // return the new signature log.Info("Signed metadata with key", "ID", key.ID()) return sig, nil}
// VerifyDelegate verifies that delegatedMetadata is signed with the required// threshold of keys for the delegated role delegatedRolefunc (meta \*Metadata[T]) VerifyDelegate(delegatedRole string, delegatedMetadata any) error { i := any(meta) signingKeys := map[string]bool{} var keys map[string]\*Key var roleKeyIDs []string var roleThreshold int
 log.Info("Verifying", "role", delegatedRole)
 // collect keys, keyIDs and threshold based on delegator type switch i := i.(type) { // Root delegator case \*Metadata[RootType]: keys = i.Signed.Keys if role, ok := (\*i).Signed.Roles[delegatedRole]; ok { roleKeyIDs = role.KeyIDs roleThreshold = role.Threshold } else { // the delegated role was not found, no need to proceed return &ErrValue{Msg: fmt.Sprintf("no delegation found for %s", delegatedRole)} } // Targets delegator case \*Metadata[TargetsType]: if i.Signed.Delegations == nil { return &ErrValue{Msg: "no delegations found"} } keys = i.Signed.Delegations.Keys if i.Signed.Delegations.Roles != nil { found := false for \_, v := range i.Signed.Delegations.Roles { if v.Name == delegatedRole { found = true roleKeyIDs = v.KeyIDs roleThreshold = v.Threshold break } } // the delegated role was not found, no need to proceed if !found { return &ErrValue{Msg: fmt.Sprintf("no delegation found for %s", delegatedRole)} } } else if i.Signed.Delegations.SuccinctRoles != nil { roleKeyIDs = i.Signed.Delegations.SuccinctRoles.KeyIDs roleThreshold = i.Signed.Delegations.SuccinctRoles.Threshold } default: return &ErrType{Msg: "call is valid only on delegator metadata (should be either root or targets)"} } // if there are no keyIDs for that role it means there's no delegation found if len(roleKeyIDs) == 0 { return &ErrValue{Msg: fmt.Sprintf("no delegation found for %s", delegatedRole)} } // loop through each role keyID for \_, keyID := range roleKeyIDs { key, ok := keys[keyID] if !ok { return &ErrValue{Msg: fmt.Sprintf("key with ID %s not found in %s keyids", keyID, delegatedRole)} } sign := Signature{} var payload []byte // convert to a PublicKey type publicKey, err := key.ToPublicKey() if err != nil { return err } // use corresponding hash function for key type hash := crypto.Hash(0) if key.Type != KeyTypeEd25519 { switch key.Scheme { case KeySchemeECDSA\_SHA2\_P256: hash = crypto.SHA256 case KeySchemeECDSA\_SHA2\_P384: hash = crypto.SHA384 default: hash = crypto.SHA256 } } // load a verifier based on that key verifier, err := signature.LoadVerifier(publicKey, hash) if err != nil { return err } // collect the signature for that key and build the payload we'll verify // based on the Signed part of the delegated metadata switch d := delegatedMetadata.(type) { case \*Metadata[RootType]: for \_, signature := range d.Signatures { if signature.KeyID == keyID { sign = signature } } payload, err = cjson.EncodeCanonical(d.Signed) if err != nil { return err } case \*Metadata[SnapshotType]: for \_, signature := range d.Signatures { if signature.KeyID == keyID { sign = signature } } payload, err = cjson.EncodeCanonical(d.Signed) if err != nil { return err } case \*Metadata[TimestampType]: for \_, signature := range d.Signatures { if signature.KeyID == keyID { sign = signature } } payload, err = cjson.EncodeCanonical(d.Signed) if err != nil { return err } case \*Metadata[TargetsType]: for \_, signature := range d.Signatures { if signature.KeyID == keyID { sign = signature } } payload, err = cjson.EncodeCanonical(d.Signed) if err != nil { return err } default: return &ErrType{Msg: "unknown delegated metadata type"} } // verify if the signature for that payload corresponds to the given key if err := verifier.VerifySignature(bytes.NewReader(sign.Signature), bytes.NewReader(payload)); err != nil { // failed to verify the metadata with that key ID log.Info("Failed to verify %s with key ID %s", delegatedRole, keyID) } else { // save the verified keyID only if verification passed signingKeys[keyID] = true log.Info("Verified with key", "role", delegatedRole, "ID", keyID) } } // check if the amount of valid signatures is enough if len(signingKeys) < roleThreshold { log.Info("Verifying failed, not enough signatures", "role", delegatedRole, "got", len(signingKeys), "want", roleThreshold) return &ErrUnsignedMetadata{Msg: fmt.Sprintf("Verifying %s failed, not enough signatures, got %d, want %d", delegatedRole, len(signingKeys), roleThreshold)} } log.Info("Verified successfully", "role", delegatedRole) return nil}
// IsExpired returns true if metadata is expired.// It checks if referenceTime is after Signed.Expiresfunc (signed \*RootType) IsExpired(referenceTime time.Time) bool { return referenceTime.After(signed.Expires)}
// IsExpired returns true if metadata is expired.// It checks if referenceTime is after Signed.Expiresfunc (signed \*SnapshotType) IsExpired(referenceTime time.Time) bool { return referenceTime.After(signed.Expires)}
// IsExpired returns true if metadata is expired.// It checks if referenceTime is after Signed.Expiresfunc (signed \*TimestampType) IsExpired(referenceTime time.Time) bool { return referenceTime.After(signed.Expires)}
// IsExpired returns true if metadata is expired.// It checks if referenceTime is after Signed.Expiresfunc (signed \*TargetsType) IsExpired(referenceTime time.Time) bool { return referenceTime.After(signed.Expires)}
// VerifyLengthHashes checks whether the MetaFiles data matches its corresponding// length and hashesfunc (f \*MetaFiles) VerifyLengthHashes(data []byte) error { // hashes and length are optional for MetaFiles if len(f.Hashes) > 0 { err := verifyHashes(data, f.Hashes) if err != nil { return err } } if f.Length != 0 { err := verifyLength(data, f.Length) if err != nil { return err } } return nil}
// VerifyLengthHashes checks whether the TargetFiles data matches its corresponding// length and hashesfunc (f \*TargetFiles) VerifyLengthHashes(data []byte) error { err := verifyHashes(data, f.Hashes) if err != nil { return err } err = verifyLength(data, f.Length) if err != nil { return err } return nil}
// Equal checks whether the source target file matches anotherfunc (source \*TargetFiles) Equal(expected TargetFiles) bool { if source.Length == expected.Length && source.Hashes.Equal(expected.Hashes) { return true } return false}
// FromFile generate TargetFiles from filefunc (t \*TargetFiles) FromFile(localPath string, hashes ...string) (\*TargetFiles, error) { log.Info("Generating target file from file", "path", localPath) // open file in, err := os.Open(localPath) if err != nil { return nil, err } defer in.Close() // read file data, err := io.ReadAll(in) if err != nil { return nil, err } return t.FromBytes(localPath, data, hashes...)}
// FromBytes generate TargetFiles from bytesfunc (t \*TargetFiles) FromBytes(localPath string, data []byte, hashes ...string) (\*TargetFiles, error) { log.Info("Generating target file from bytes", "path", localPath) var hasher hash.Hash targetFile := &TargetFiles{ Hashes: map[string]HexBytes{}, } // use default hash algorithm if not set if len(hashes) == 0 { hashes = []string{"sha256"} } // calculate length len, err := io.Copy(io.Discard, bytes.NewReader(data)) if err != nil { return nil, err } targetFile.Length = len for \_, v := range hashes { switch v { case "sha256": hasher = sha256.New() case "sha512": hasher = sha512.New() default: return nil, &ErrValue{Msg: fmt.Sprintf("failed generating TargetFile - unsupported hashing algorithm - %s", v)} } \_, err := hasher.Write(data) if err != nil { return nil, err } targetFile.Hashes[v] = hasher.Sum(nil) } targetFile.Path = localPath return targetFile, nil}
// ClearSignatures clears Signaturesfunc (meta \*Metadata[T]) ClearSignatures() { log.Info("Cleared signatures") meta.Signatures = []Signature{}}
// IsDelegatedPath determines whether the given "targetFilepath" is in one of// the paths that "DelegatedRole" is trusted to providefunc (role \*DelegatedRole) IsDelegatedPath(targetFilepath string) (bool, error) { if len(role.Paths) > 0 { // standard delegations for \_, pathPattern := range role.Paths { // A delegated role path may be an explicit path or glob // pattern (Unix shell-style wildcards). if isTargetInPathPattern(targetFilepath, pathPattern) { return true, nil } } } else if len(role.PathHashPrefixes) > 0 { // hash bin delegations - calculate the hash of the filepath to determine in which bin to find the target. targetFilepathHash := sha256.Sum256([]byte(targetFilepath)) for \_, pathHashPrefix := range role.PathHashPrefixes { if strings.HasPrefix(base64.URLEncoding.EncodeToString(targetFilepathHash[:]), pathHashPrefix) { return true, nil } } } return false, nil}
// Determine whether “targetpath“ matches the “pathpattern“.func isTargetInPathPattern(targetpath string, pathpattern string) bool { // We need to make sure that targetpath and pathpattern are pointing to // the same directory as fnmatch doesn't threat "/" as a special symbol. targetParts := strings.Split(targetpath, "/") patternParts := strings.Split(pathpattern, "/") if len(targetParts) != len(patternParts) { return false }
 // Every part in the pathpattern could include a glob pattern, that's why // each of the target and pathpattern parts should match. for i := 0; i < len(targetParts); i++ { if ok, \_ := filepath.Match(patternParts[i], targetParts[i]); !ok { return false } }
 return true}
// GetRolesForTarget return the names and terminating status of all// delegated roles who are responsible for targetFilepathfunc (role \*Delegations) GetRolesForTarget(targetFilepath string) map[string]bool { res := map[string]bool{} // standard delegations if role.Roles != nil { for \_, r := range role.Roles { ok, err := r.IsDelegatedPath(targetFilepath) if err == nil && ok { res[r.Name] = r.Terminating } } } else if role.SuccinctRoles != nil { // SuccinctRoles delegations res = role.SuccinctRoles.GetRolesForTarget(targetFilepath) } return res}
// GetRolesForTarget calculate the name of the delegated role responsible for "targetFilepath".// The target at path "targetFilepath" is assigned to a bin by casting// the left-most "BitLength" of bits of the file path hash digest to// int, using it as bin index between 0 and “2\*\*BitLength - 1“.func (role \*SuccinctRoles) GetRolesForTarget(targetFilepath string) map[string]bool { // calculate the suffixLen value based on the total number of bins in // hex. If bit\_length = 10 then numberOfBins = 1024 or bin names will // have a suffix between "000" and "3ff" in hex and suffixLen will be 3 // meaning the third bin will have a suffix of "003" numberOfBins := math.Pow(2, float64(role.BitLength)) // suffixLen is calculated based on "numberOfBins - 1" as the name // of the last bin contains the number "numberOfBins -1" as a suffix. suffixLen := len(strconv.FormatInt(int64(numberOfBins-1), 16))
 targetFilepathHash := sha256.Sum256([]byte(targetFilepath)) // we can't ever need more than 4 bytes (32 bits) hashBytes := targetFilepathHash[:4]
 // right shift hash bytes, so that we only have the leftmost // bit\_length bits that we care about shiftValue := 32 - role.BitLength binNumber := binary.BigEndian.Uint32(hashBytes) >> shiftValue // add zero padding if necessary and cast to hex the suffix suffix := fmt.Sprintf("%0\*x", suffixLen, binNumber) // we consider all succinct\_roles as terminating. // for more information read TAP 15. return map[string]bool{fmt.Sprintf("%s-%s", role.NamePrefix, suffix): true}}
// GetRoles returns the names of all different delegated rolesfunc (role \*SuccinctRoles) GetRoles() []string { res := []string{} suffixLen, numberOfBins := role.GetSuffixLen()
 for binNumber := 0; binNumber < numberOfBins; binNumber++ { suffix := fmt.Sprintf("%0\*x", suffixLen, binNumber) res = append(res, fmt.Sprintf("%s-%s", role.NamePrefix, suffix)) } return res}
func (role \*SuccinctRoles) GetSuffixLen() (int, int) { numberOfBins := int(math.Pow(2, float64(role.BitLength))) return len(strconv.FormatInt(int64(numberOfBins-1), 16)), numberOfBins}
// IsDelegatedRole returns whether the given roleName is in one of// the delegated roles that “SuccinctRoles“ representsfunc (role \*SuccinctRoles) IsDelegatedRole(roleName string) bool { suffixLen, numberOfBins := role.GetSuffixLen()
 expectedPrefix := fmt.Sprintf("%s-", role.NamePrefix)
 // check if the roleName prefix is what we would expect if !strings.HasPrefix(roleName, expectedPrefix) { return false }
 // check if the roleName suffix length is what we would expect suffix := roleName[len(expectedPrefix):] if len(suffix) != suffixLen { return false }
 // make sure suffix is hex value and get bin number value, err := strconv.ParseInt(suffix, 16, 64) if err != nil { return false }
 // check if the bin we calculated is indeed within the range of what we support return (value >= 0) && (value < int64(numberOfBins))}
// AddKey adds new signing key for delegated role "role"// keyID: Identifier of the key to be added for “role“.// key: Signing key to be added for “role“.// role: Name of the role, for which “key“ is added.func (signed \*RootType) AddKey(key \*Key, role string) error { // verify role is present if \_, ok := signed.Roles[role]; !ok { return &ErrValue{Msg: fmt.Sprintf("role %s doesn't exist", role)} } // add keyID to role if !slices.Contains(signed.Roles[role].KeyIDs, key.ID()) { signed.Roles[role].KeyIDs = append(signed.Roles[role].KeyIDs, key.ID()) } // update Keys signed.Keys[key.ID()] = key // TODO: should we check if we don't accidentally override an existing keyID with another key value? return nil}
// RevokeKey revoke key from “role“ and updates the Keys store.// keyID: Identifier of the key to be removed for “role“.// role: Name of the role, for which a signing key is removed.func (signed \*RootType) RevokeKey(keyID, role string) error { // verify role is present if \_, ok := signed.Roles[role]; !ok { return &ErrValue{Msg: fmt.Sprintf("role %s doesn't exist", role)} } // verify keyID is present for given role if !slices.Contains(signed.Roles[role].KeyIDs, keyID) { return &ErrValue{Msg: fmt.Sprintf("key with id %s is not used by %s", keyID, role)} } // remove keyID from role filteredKeyIDs := []string{} for \_, k := range signed.Roles[role].KeyIDs { if k != keyID { filteredKeyIDs = append(filteredKeyIDs, k) } } // overwrite the old keyID slice signed.Roles[role].KeyIDs = filteredKeyIDs // check if keyID is used by other roles too for \_, r := range signed.Roles { if slices.Contains(r.KeyIDs, keyID) { return nil } } // delete the keyID from Keys if it's not used anywhere else delete(signed.Keys, keyID) return nil}
// AddKey adds new signing key for delegated role "role"// key: Signing key to be added for “role“.// role: Name of the role, for which “key“ is added.// If SuccinctRoles is used then the "role" argument can be ignored.func (signed \*TargetsType) AddKey(key \*Key, role string) error { // check if Delegations are even present if signed.Delegations == nil { return &ErrValue{Msg: fmt.Sprintf("delegated role %s doesn't exist", role)} } // standard delegated roles if signed.Delegations.Roles != nil { // loop through all delegated roles isDelegatedRole := false for i, d := range signed.Delegations.Roles { // if role is found if d.Name == role { isDelegatedRole = true // add key if keyID is not already part of keyIDs for that role if !slices.Contains(d.KeyIDs, key.ID()) { signed.Delegations.Roles[i].KeyIDs = append(signed.Delegations.Roles[i].KeyIDs, key.ID()) signed.Delegations.Keys[key.ID()] = key // TODO: should we check if we don't accidentally override an existing keyID with another key value? return nil } log.Info("Delegated role already has keyID", "role", role, "ID", key.ID()) } } if !isDelegatedRole { return &ErrValue{Msg: fmt.Sprintf("delegated role %s doesn't exist", role)} } } else if signed.Delegations.SuccinctRoles != nil { // add key if keyID is not already part of keyIDs for the SuccinctRoles role if !slices.Contains(signed.Delegations.SuccinctRoles.KeyIDs, key.ID()) { signed.Delegations.SuccinctRoles.KeyIDs = append(signed.Delegations.SuccinctRoles.KeyIDs, key.ID()) signed.Delegations.Keys[key.ID()] = key // TODO: should we check if we don't accidentally override an existing keyID with another key value? return nil } log.Info("SuccinctRoles role already has keyID", "ID", key.ID())
 } signed.Delegations.Keys[key.ID()] = key // TODO: should we check if we don't accidentally override an existing keyID with another key value? return nil}
// RevokeKey revokes key from delegated role "role" and updates the delegations key store// keyID: Identifier of the key to be removed for “role“.// role: Name of the role, for which a signing key is removed.func (signed \*TargetsType) RevokeKey(keyID string, role string) error { // check if Delegations are even present if signed.Delegations == nil { return &ErrValue{Msg: fmt.Sprintf("delegated role %s doesn't exist", role)} } // standard delegated roles if signed.Delegations.Roles != nil { // loop through all delegated roles for i, d := range signed.Delegations.Roles { // if role is found if d.Name == role { // check if keyID is present in keyIDs for that role if !slices.Contains(d.KeyIDs, keyID) { return &ErrValue{Msg: fmt.Sprintf("key with id %s is not used by %s", keyID, role)} } // remove keyID from role filteredKeyIDs := []string{} for \_, k := range signed.Delegations.Roles[i].KeyIDs { if k != keyID { filteredKeyIDs = append(filteredKeyIDs, k) } } // overwrite the old keyID slice for that role signed.Delegations.Roles[i].KeyIDs = filteredKeyIDs // check if keyID is used by other roles too for \_, r := range signed.Delegations.Roles { if slices.Contains(r.KeyIDs, keyID) { return nil } } // delete the keyID from Keys if it's not used anywhere else delete(signed.Delegations.Keys, keyID) return nil } } // we haven't found the delegated role return &ErrValue{Msg: fmt.Sprintf("delegated role %s doesn't exist", role)} } else if signed.Delegations.SuccinctRoles != nil { // check if keyID is used by SuccinctRoles role if !slices.Contains(signed.Delegations.SuccinctRoles.KeyIDs, keyID) { return &ErrValue{Msg: fmt.Sprintf("key with id %s is not used by SuccinctRoles", keyID)} } // remove keyID from the SuccinctRoles role filteredKeyIDs := []string{} for \_, k := range signed.Delegations.SuccinctRoles.KeyIDs { if k != keyID { filteredKeyIDs = append(filteredKeyIDs, k) } } // overwrite the old keyID slice for SuccinctRoles role signed.Delegations.SuccinctRoles.KeyIDs = filteredKeyIDs
 // delete the keyID from Keys since it can not be used anywhere else delete(signed.Delegations.Keys, keyID) return nil } return &ErrValue{Msg: fmt.Sprintf("delegated role %s doesn't exist", role)}}
// Equal checks whether one hash set equals anotherfunc (source Hashes) Equal(expected Hashes) bool { hashChecked := false for typ, hash := range expected { if h, ok := source[typ]; ok { // hash type match found hashChecked = true if !hmac.Equal(h, hash) { // hash values don't match return false } } } return hashChecked}
// verifyLength verifies if the passed data has the corresponding lengthfunc verifyLength(data []byte, length int64) error { len, err := io.Copy(io.Discard, bytes.NewReader(data)) if err != nil { return err } if length != len { return &ErrLengthOrHashMismatch{Msg: fmt.Sprintf("length verification failed - expected %d, got %d", length, len)} } return nil}
// verifyHashes verifies if the hash of the passed data corresponds to itfunc verifyHashes(data []byte, hashes Hashes) error { var hasher hash.Hash for k, v := range hashes { switch k { case "sha256": hasher = sha256.New() case "sha512": hasher = sha512.New() default: return &ErrLengthOrHashMismatch{Msg: fmt.Sprintf("hash verification failed - unknown hashing algorithm - %s", k)} } hasher.Write(data) if hex.EncodeToString(v) != hex.EncodeToString(hasher.Sum(nil)) { return &ErrLengthOrHashMismatch{Msg: fmt.Sprintf("hash verification failed - mismatch for algorithm %s", k)} } } return nil}
// fromBytes return a \*Metadata[T] object from bytes and verifies// that the data corresponds to the caller struct typefunc fromBytes[T Roles](data []byte) (\*Metadata[T], error) { meta := &Metadata[T]{} // verify that the type we used to create the object is the same as the type of the metadata file if err := checkType[T](data); err != nil { return nil, err } // if all is okay, unmarshal meta to the desired Metadata[T] type if err := json.Unmarshal(data, meta); err != nil { return nil, err } // Make sure signature key IDs are unique if err := checkUniqueSignatures(\*meta); err != nil { return nil, err } return meta, nil}
// checkUniqueSignatures verifies if the signature key IDs are unique for that metadatafunc checkUniqueSignatures[T Roles](meta Metadata[T]) error { signatures := []string{} for \_, sig := range meta.Signatures { if slices.Contains(signatures, sig.KeyID) { return &ErrValue{Msg: fmt.Sprintf("multiple signatures found for key ID %s", sig.KeyID)} } signatures = append(signatures, sig.KeyID) } return nil}
// checkType verifies if the generic type used to create the object is the same as the type of the metadata file in bytesfunc checkType[T Roles](data []byte) error { var m map[string]any i := any(new(T)) if err := json.Unmarshal(data, &m); err != nil { return err } signedType := m["signed"].(map[string]any)["\_type"].(string) switch i.(type) { case \*RootType: if ROOT != signedType { return &ErrValue{Msg: fmt.Sprintf("expected metadata type %s, got - %s", ROOT, signedType)} } case \*SnapshotType: if SNAPSHOT != signedType { return &ErrValue{Msg: fmt.Sprintf("expected metadata type %s, got - %s", SNAPSHOT, signedType)} } case \*TimestampType: if TIMESTAMP != signedType { return &ErrValue{Msg: fmt.Sprintf("expected metadata type %s, got - %s", TIMESTAMP, signedType)} } case \*TargetsType: if TARGETS != signedType { return &ErrValue{Msg: fmt.Sprintf("expected metadata type %s, got - %s", TARGETS, signedType)} } default: return &ErrValue{Msg: fmt.Sprintf("unrecognized metadata type - %s", signedType)} } // all okay return nil}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f4a6ed7f_20250111_202007.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Ff36420caba9edbfdfd64f95a9554c0836d9cf819)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Ff36420caba9edbfdfd64f95a9554c0836d9cf819)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theupdateframework%2Fgo-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[go-tuf](/theupdateframework/go-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fgo-tuf) You must be signed in to change notification settings
* [Fork
  110](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)
* [Star
   639](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)

* [Code](/theupdateframework/go-tuf)
* [Issues
  24](/theupdateframework/go-tuf/issues)
* [Pull requests
  2](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects
  1](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/go-tuf)
* [Issues](/theupdateframework/go-tuf/issues)
* [Pull requests](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

## Commit

[Permalink](/theupdateframework/go-tuf/commit/f36420caba9edbfdfd64f95a9554c0836d9cf819)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge commit from fork

[Browse files](/theupdateframework/go-tuf/tree/f36420caba9edbfdfd64f95a9554c0836d9cf819)
Browse the repository at this point in the history

```
Signed-off-by: Radoslav Dimitrov <radoslav@stacklok.com>
```

* Loading branch information

[![@rdimitrov](https://avatars.githubusercontent.com/u/16540482?s=40&v=4)](/rdimitrov)

[rdimitrov](/theupdateframework/go-tuf/commits?author=rdimitrov "View all commits by rdimitrov")
authored
Sep 30, 2024

1 parent
[f95222b](/theupdateframework/go-tuf/commit/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5)

commit f36420c

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**21 additions**
and
**13 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* metadata

  + metadata/metadata.go
    [metadata.go](#diff-bc1663385db50e33df147e8b0da3b8694f87707081a013c63bc8c6eacb9984d5)
  + metadata/types.go
    [types.go](#diff-bef7a44a54dcb191064cf994e7bf8c08a91c1264a2be18ba3b5e00f988576d89)
  + updater

    - metadata/updater/updater.go
      [updater.go](#diff-37e568c8b9961686e86bba1ff889a32092a12cd07cf2f672921b3b718c6a052a)

## There are no files selected for viewing

18 changes: 10 additions & 8 deletions

18
[metadata/metadata.go](#diff-bc1663385db50e33df147e8b0da3b8694f87707081a013c63bc8c6eacb9984d5 "metadata/metadata.go")

Show comments

[View file](/theupdateframework/go-tuf/blob/f36420caba9edbfdfd64f95a9554c0836d9cf819/metadata/metadata.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -562,28 +562,30 @@ func isTargetInPathPattern(targetpath string, pathpattern string) bool { |
|  |  |  |
|  |  | // GetRolesForTarget return the names and terminating status of all |
|  |  | // delegated roles who are responsible for targetFilepath |
|  |  | func (role \*Delegations) GetRolesForTarget(targetFilepath string) map[string]bool { |
|  |  | res := map[string]bool{} |
|  |  | // standard delegations |
|  |  | // Note the result should be an ordered list, ref. https://github.com/theupdateframework/go-tuf/security/advisories/GHSA-4f8r-qqr9-fq8j |
|  |  | func (role \*Delegations) GetRolesForTarget(targetFilepath string) []RoleResult { |
|  |  | var res []RoleResult |
|  |  | // Standard delegations |
|  |  | if role.Roles != nil { |
|  |  | for \_, r := range role.Roles { |
|  |  | ok, err := r.IsDelegatedPath(targetFilepath) |
|  |  | if err == nil && ok { |
|  |  | res[r.Name] = r.Terminating |
|  |  | res = append(res, RoleResult{Name: r.Name, Terminating: r.Terminating}) |
|  |  | } |
|  |  | } |
|  |  | } else if role.SuccinctRoles != nil { |
|  |  | // SuccinctRoles delegations |
|  |  | res = role.SuccinctRoles.GetRolesForTarget(targetFilepath) |
|  |  | } |
|  |  | // We preserve the same order as the actual roles list |
|  |  | return res |
|  |  | } |
|  |  |  |
|  |  | // GetRolesForTarget calculate the name of the delegated role responsible for "targetFilepath". |
|  |  | // The target at path "targetFilepath" is assigned to a bin by casting |
|  |  | // the left-most "BitLength" of bits of the file path hash digest to |
|  |  | // int, using it as bin index between 0 and “2\*\*BitLength - 1“. |
|  |  | func (role \*SuccinctRoles) GetRolesForTarget(targetFilepath string) map[string]bool { |
|  |  | // int, using it as bin index between 0 and “2\*\*BitLength-1”. |
|  |  | func (role \*SuccinctRoles) GetRolesForTarget(targetFilepath string) []RoleResult { |
|  |  | // calculate the suffixLen value based on the total number of bins in |
|  |  | // hex. If bit\_length = 10 then numberOfBins = 1024 or bin names will |
|  |  | // have a suffix between "000" and "3ff" in hex and suffixLen will be 3 |
| Expand All | | @@ -604,8 +606,8 @@ func (role \*SuccinctRoles) GetRolesForTarget(targetFilepath string) map[string]b |
|  |  | // add zero padding if necessary and cast to hex the suffix |
|  |  | suffix := fmt.Sprintf("%0\*x", suffixLen, binNumber) |
|  |  | // we consider all succinct\_roles as terminating. |
|  |  | // for more information read TAP 15. |
|  |  | return map[string]bool{fmt.Sprintf("%s-%s", role.NamePrefix, suffix): true} |
|  |  | // for more information, read TAP 15. |
|  |  | return []RoleResult{{Name: fmt.Sprintf("%s-%s", role.NamePrefix, suffix), Terminating: true}} |
|  |  | } |
|  |  |  |
|  |  | // GetRoles returns the names of all different delegated roles |
| Expand Down | |  |

6 changes: 6 additions & 0 deletions

6
[metadata/types.go](#diff-bef7a44a54dcb191064cf994e7bf8c08a91c1264a2be18ba3b5e00f988576d89 "metadata/types.go")

Show comments

[View file](/theupdateframework/go-tuf/blob/f36420caba9edbfdfd64f95a9554c0836d9cf819/metadata/types.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -171,3 +171,9 @@ type SuccinctRoles struct { |
|  |  | NamePrefix string `json:"name\_prefix"` |
|  |  | UnrecognizedFields map[string]any `json:"-"` |
|  |  | } |
|  |  |  |
|  |  | // RoleResult represents the name and terminating status of a delegated role that is responsible for targetFilepath |
|  |  | type RoleResult struct { |
|  |  | Name string |
|  |  | Terminating bool |
|  |  | } |

10 changes: 5 additions & 5 deletions

10
[metadata/updater/updater.go](#diff-37e568c8b9961686e86bba1ff889a32092a12cd07cf2f672921b3b718c6a052a "metadata/updater/updater.go")

Show comments

[View file](/theupdateframework/go-tuf/blob/f36420caba9edbfdfd64f95a9554c0836d9cf819/metadata/updater/updater.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -550,14 +550,14 @@ func (update \*Updater) preOrderDepthFirstWalk(targetFilePath string) (\*metadata. |
|  |  | // after pre-order check, add current role to set of visited roles |
|  |  | visitedRoleNames[delegation.Role] = true |
|  |  | if targets.Signed.Delegations != nil { |
|  |  | childRolesToVisit := []roleParentTuple{} |
|  |  | var childRolesToVisit []roleParentTuple |
|  |  | // note that this may be a slow operation if there are many |
|  |  | // delegated roles |
|  |  | roles := targets.Signed.Delegations.GetRolesForTarget(targetFilePath) |
|  |  | for child, terminating := range roles { |
|  |  | log.Info("Adding child role", "role", child) |
|  |  | childRolesToVisit = append(childRolesToVisit, roleParentTuple{Role: child, Parent: delegation.Role}) |
|  |  | if terminating { |
|  |  | for \_, rolesForTarget := range roles { |
|  |  | log.Info("Adding child role", "role", rolesForTarget.Name) |
|  |  | childRolesToVisit = append(childRolesToVisit, roleParentTuple{Role: rolesForTarget.Name, Parent: delegation.Role}) |
|  |  | if rolesForTarget.Terminating { |
|  |  | log.Info("Not backtracking to other roles") |
|  |  | delegationsToVisit = []roleParentTuple{} |
|  |  | break |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f36420c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Ff36420caba9edbfdfd64f95a9554c0836d9cf819) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0c41ed97_20250111_202008.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fsecurity%2Fadvisories%2FGHSA-4f8r-qqr9-fq8j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fsecurity%2Fadvisories%2FGHSA-4f8r-qqr9-fq8j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=theupdateframework%2Fgo-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[go-tuf](/theupdateframework/go-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fgo-tuf) You must be signed in to change notification settings
* [Fork
  110](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)
* [Star
   639](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)

* [Code](/theupdateframework/go-tuf)
* [Issues
  24](/theupdateframework/go-tuf/issues)
* [Pull requests
  2](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects
  1](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/go-tuf)
* [Issues](/theupdateframework/go-tuf/issues)
* [Pull requests](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

# Incorrect delegation lookups can make go-tuf download the wrong artifact

High

[rdimitrov](/rdimitrov)
published
GHSA-4f8r-qqr9-fq8j
Oct 1, 2024

## Package

gomod

github.com/theupdateframework/go-tuf/v2/metadata
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<=v2.0.0

## Patched versions

>v2.0.0

## Description

During the ongoing work on the TUF conformance test suite, we have come across a test that reveals what we believe is a bug in go-tuf with security implications. The bug exists in go-tuf delegation tracing and could result in downloading the wrong artifact.

We have come across this issue in the test in this PR: [theupdateframework/tuf-conformance#115](https://github.com/theupdateframework/tuf-conformance/pull/115).

The test - `test_graph_traversal` - sets up a repository with a series of delegations, invokes the clients `refresh()` and then checks the order in which the client traced the delegations. The test shows that the go-tuf client inconsistently traces the delegations in a wrong way. For example, [during one CI run](https://github.com/theupdateframework/tuf-conformance/pull/115#issuecomment-2275625542), the `two-level-delegations` test case triggered a wrong order. The delegations in this look as such:

```
"two-level-delegations": DelegationsTestCase(
        delegations=[
            DelegationTester("targets", "A"),
            DelegationTester("targets", "B"),
            DelegationTester("B", "C"),
        ],
        visited_order=["A", "B", "C"],
    ),
```

Here, `targets` delegate to `"A"`, and to `"B"`, and `"B"` delegates to `"C"`. The client should trace the delegations in the order `"A"` then `"B"` then `"C"` but in this particular CI run, go-tuf traced the delegations `"B"->"C"->"A"`.

In a subsequent CI run, this test case did not fail, but [another one did](https://github.com/theupdateframework/tuf-conformance/pull/115#issuecomment-2275640487).

[@jku](https://github.com/jku) has done a bit of debugging and believes that the returned map of `GetRolesForTarget` returns a map that causes this behavior:

[go-tuf/metadata/metadata.go](https://github.com/theupdateframework/go-tuf/blob/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5/metadata/metadata.go#L565-L580)

Lines 565 to 580
in
[f95222b](/theupdateframework/go-tuf/commit/f95222bdd22d2ac4e5b8ed6fe912b645e213c3b5)

|  | func (role \*Delegations) GetRolesForTarget(targetFilepath string) map[string]bool { |
| --- | --- |
|  | res := map[string]bool{} |
|  | // standard delegations |
|  | if role.Roles != nil { |
|  | for \_, r := range role.Roles { |
|  | ok, err := r.IsDelegatedPath(targetFilepath) |
|  | if err == nil && ok { |
|  | res[r.Name] = r.Terminating |
|  | } |
|  | } |
|  | } else if role.SuccinctRoles != nil { |
|  | // SuccinctRoles delegations |
|  | res = role.SuccinctRoles.GetRolesForTarget(targetFilepath) |
|  | } |
|  | return res |
|  | } |

We believe that this map should be an ordered list instead of a map.

### Severity

High

### CVE ID

CVE-2024-47534

### Weaknesses

No CWEs

### Credits

* [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)
  [AdamKorcz](/AdamKorcz)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_db44cf7f_20250111_202011.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Ftuf-conformance%2Fpull%2F115)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Ftuf-conformance%2Fpull%2F115)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=theupdateframework%2Ftuf-conformance)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[tuf-conformance](/theupdateframework/tuf-conformance)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Ftuf-conformance) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Ftheupdateframework%2Ftuf-conformance)
* [Star
   8](/login?return_to=%2Ftheupdateframework%2Ftuf-conformance)

* [Code](/theupdateframework/tuf-conformance)
* [Issues
  19](/theupdateframework/tuf-conformance/issues)
* [Pull requests
  1](/theupdateframework/tuf-conformance/pulls)
* [Actions](/theupdateframework/tuf-conformance/actions)
* [Security](/theupdateframework/tuf-conformance/security)
* [Insights](/theupdateframework/tuf-conformance/pulse)

Additional navigation options

* [Code](/theupdateframework/tuf-conformance)
* [Issues](/theupdateframework/tuf-conformance/issues)
* [Pull requests](/theupdateframework/tuf-conformance/pulls)
* [Actions](/theupdateframework/tuf-conformance/actions)
* [Security](/theupdateframework/tuf-conformance/security)
* [Insights](/theupdateframework/tuf-conformance/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftheupdateframework%2Ftuf-conformance%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftheupdateframework%2Ftuf-conformance%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add first graph and target search test #115

 Merged

[jku](/jku)
merged 3 commits into
[theupdateframework:main](/theupdateframework/tuf-conformance/tree/main "theupdateframework/tuf-conformance:main")
from
[AdamKorcz:graphs-test](/AdamKorcz/tuf-conformance/tree/graphs-test "AdamKorcz/tuf-conformance:graphs-test")

Aug 22, 2024

 Merged

# [Add first graph and target search test](#top) #115

[jku](/jku)
merged 3 commits into
[theupdateframework:main](/theupdateframework/tuf-conformance/tree/main "theupdateframework/tuf-conformance:main")
from
[AdamKorcz:graphs-test](/AdamKorcz/tuf-conformance/tree/graphs-test "AdamKorcz/tuf-conformance:graphs-test")

Aug 22, 2024

[Conversation
27](/theupdateframework/tuf-conformance/pull/115)
[Commits
3](/theupdateframework/tuf-conformance/pull/115/commits)
[Checks
3](/theupdateframework/tuf-conformance/pull/115/checks)
[Files changed](/theupdateframework/tuf-conformance/pull/115/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=60&v=4)](/AdamKorcz)

Copy link

Contributor

### @AdamKorcz **[AdamKorcz](/AdamKorcz)** commented [Aug 6, 2024](#issue-2451719515)

Adds the first graph and target search test as mentioned in [#101](https://github.com/theupdateframework/tuf-conformance/issues/101).

This adds the `get_targetinfo` client API for both clients too. This might need more work for tests that actually use the output. The test in this PR does not use the output.

Interestingly, go-tuf fails in an indeterministic manner from this test; Different test cases will fail each time you run the test. I have tried removing all the testcases except for the `"max-number-of-delegations"` one, and this still fails sometimes. [@rdimitrov](https://github.com/rdimitrov) could you check this? You can test it by cloning my branch and running `make test-go-tuf`. I have left some print statements for debugging assistance.

Sorry, something went wrong.

All reactions

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
requested review from
[rdimitrov](/rdimitrov) and
[jku](/jku)
[August 6, 2024 21:25](#event-13784135650)

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=80&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)

Copy link

Contributor

Author

### **[AdamKorcz](/AdamKorcz)** commented [Aug 6, 2024](#issuecomment-2272183309)

| I am putting this in draft. I am not getting the same failures locally. Will need to debug this. Please wait with the review. |
| --- |

All reactions

Sorry, something went wrong.

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
marked this pull request as draft
[August 6, 2024 21:28](#event-13784156560)

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/4473aec63c654ee37090ae942f1443c683b61181..ebc046da3bdd864e9451c7b93bd779e9dd118c6f)
the
graphs-test

branch
from
[`4473aec`](/theupdateframework/tuf-conformance/commit/4473aec63c654ee37090ae942f1443c683b61181) to
[`ebc046d`](/theupdateframework/tuf-conformance/commit/ebc046da3bdd864e9451c7b93bd779e9dd118c6f)  [Compare](/theupdateframework/tuf-conformance/compare/4473aec63c654ee37090ae942f1443c683b61181..ebc046da3bdd864e9451c7b93bd779e9dd118c6f)
[August 6, 2024 21:30](#event-13784169115)

[![@segiddins](https://avatars.githubusercontent.com/u/1946610?s=80&u=a3b5a8c410b2f492e84364b49ae235caef4ecb4f&v=4)](/segiddins)

Copy link

Contributor

### **[segiddins](/segiddins)** commented [Aug 7, 2024](#issuecomment-2272442703)

| I think it might be cleaner instead to have the `get_targetinfo` entry point write the target info to a provided path, rather than relying on STDOUT having nothing else printed? |
| --- |

All reactions

Sorry, something went wrong.

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/7dfbab4c552f74e39062d284c22f1da6e4a16447..51176a0c599d1e78707a228e124955259eb4c641)
the
graphs-test

branch
from
[`7dfbab4`](/theupdateframework/tuf-conformance/commit/7dfbab4c552f74e39062d284c22f1da6e4a16447) to
[`51176a0`](/theupdateframework/tuf-conformance/commit/51176a0c599d1e78707a228e124955259eb4c641)  [Compare](/theupdateframework/tuf-conformance/compare/7dfbab4c552f74e39062d284c22f1da6e4a16447..51176a0c599d1e78707a228e124955259eb4c641)
[August 7, 2024 11:14](#event-13790820326)

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=80&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)

Copy link

Contributor

Author

### **[AdamKorcz](/AdamKorcz)** commented [Aug 7, 2024](#issuecomment-2273236954)

| [@jku](https://github.com/jku) I am unable to reproduce the same outcome as the CI for python-tuf locally. Could you check if you can reproduce it? |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 7, 2024](#issuecomment-2273478534) • edited Loading

| I'll have a look at the failures but as a first comment: Let's not expand the CLI if at all possible -- I'm not sure we can assume that all libraries even expose API like this. Can we not use `download` command to achieve similar testable situations? I especially don't want any kind of structured output requirements for the CLI: it is just a pain for client developers |
| --- |

All reactions

Sorry, something went wrong.

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
reviewed
[Aug 7, 2024](#pullrequestreview-2225082048)

 [View reviewed changes](/theupdateframework/tuf-conformance/pull/115/files)

Copy link

Member

### @jku **[jku](/jku)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The issue at least with python-tuf can be reproduced with `--repository-dump-dir /tmp/dumps`. There's two issues that I can see :

1. The code added to clients/python-tuf assumes `get_targetinfo()` always returns TargetFile: this is untrue (maybe we should enable linting in clients, mypy would have complained about this: [lint: Add the python client to linted files #118](https://github.com/theupdateframework/tuf-conformance/pull/118))
2. The test also fails because the dumping code invoked by `--repository-dump-dir` uses fetch\_metadata() which ends up breaking FetchTracker.

If you use the already existing `metadata_statistics` and `artifact_statistics` instead of FetchTracker this should not be an issue (because those are bumped in `fetch()` that is only called by the http handler, not other code)

Sorry, something went wrong.

All reactions

[tuf\_conformance/repository\_simulator.py](/theupdateframework/tuf-conformance/pull/115/files#diff-14194f3ec16d9cbd8ebf0cc25b2a6a6040e4a56e620203f3373fd6cf426f946a)
Outdated

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/162296909c98f573e11053ec3120608ad385e687..7630ce612106fe63572c181ff0841223b6a547a9)
the
graphs-test

branch
2 times, most recently
from
[`1622969`](/theupdateframework/tuf-conformance/commit/162296909c98f573e11053ec3120608ad385e687) to
[`7630ce6`](/theupdateframework/tuf-conformance/commit/7630ce612106fe63572c181ff0841223b6a547a9)  [Compare](/theupdateframework/tuf-conformance/compare/162296909c98f573e11053ec3120608ad385e687..7630ce612106fe63572c181ff0841223b6a547a9)
[August 8, 2024 11:39](#event-13805518852)

[![@jku](https://avatars.githubusercontent.com/u/31889?s=80&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)

Copy link

Member

### **[jku](/jku)** commented [Aug 8, 2024](#issuecomment-2275625542)

| Is this the flaky failure for go-tuf:  `FAILED tuf_conformance/test_updater_delegation_graphs.py::test_graph_traversal[two-level-delegations] - AssertionError: assert [('B', 1), ('C', 1), ('A', 1)] == [('A', 1), ('B', 1), ('C', 1)]`  very interesting if it is really flaky... It could of course be a bug in our request tracking but I think that is pretty simple and should not lead to ordering issues |
| --- |

All reactions

Sorry, something went wrong.

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=80&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)

Copy link

Contributor

Author

### **[AdamKorcz](/AdamKorcz)** commented [Aug 8, 2024](#issuecomment-2275640487) • edited Loading

| Is this the flaky failure for go-tuf:  `FAILED tuf_conformance/test_updater_delegation_graphs.py::test_graph_traversal[two-level-delegations] - AssertionError: assert [('B', 1), ('C', 1), ('A', 1)] == [('A', 1), ('B', 1), ('C', 1)]`  very interesting if it is really flaky... It could of course be a bug in our request tracking but I think that is pretty simple and should not lead to ordering issues  In [this run](https://github.com/theupdateframework/tuf-conformance/actions/runs/10301546446/job/28513330957?pr=115) another test - three-level-terminating-ignores-all-but-roles-descendants - fails. I believe this is similar to the flakiness I described in [the initial PR message](https://github.com/theupdateframework/tuf-conformance/pull/115#issue-2451719515). |
| --- |

All reactions

Sorry, something went wrong.

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
mentioned this pull request
[Aug 12, 2024](#ref-issue-2460444101)

[tests for rolename/targetpath encoding
#125](/theupdateframework/tuf-conformance/issues/125)

Open

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
mentioned this pull request
[Aug 13, 2024](#ref-pullrequest-2463774656)

[Add target search test
#139](/theupdateframework/tuf-conformance/pull/139)
 Closed

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
mentioned this pull request
[Aug 14, 2024](#ref-pullrequest-2463818830)

[Add target search test
#140](/theupdateframework/tuf-conformance/pull/140)
 Merged

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
reviewed
[Aug 14, 2024](#pullrequestreview-2232181837)

 [View reviewed changes](/theupdateframework/tuf-conformance/pull/115/files)

Copy link

Member

### @jku **[jku](/jku)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I know you said don't review yet... I'm doing that anyway since this is kind of blocking the continuation like [#140](https://github.com/theupdateframework/tuf-conformance/pull/140).

All comments are minor -- the only issue preventing merging is go-tuf flakiness. I don't have great ideas for dealing with that. We would have to either

* support skipping in the action API like we do expected failures
* or add a hard coded special case in the test until go-tuf is fixed

  ```
    if ("clients/go-tuf/go-tuf" in client._cmd):
       pytest.skip("skip for flakiness")

  ```

maybe the hard coded skip (and filing an issue to remind us to remove it) makes sense so we can move and merge this?

Sorry, something went wrong.

All reactions

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)

Show resolved

Hide resolved

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/76b9e5a271e314a231e41830d487c7f95bca4b54..74f8aa76925786b9d44531817024b2931cb44454)
the
graphs-test

branch
from
[`76b9e5a`](/theupdateframework/tuf-conformance/commit/76b9e5a271e314a231e41830d487c7f95bca4b54) to
[`74f8aa7`](/theupdateframework/tuf-conformance/commit/74f8aa76925786b9d44531817024b2931cb44454)  [Compare](/theupdateframework/tuf-conformance/compare/76b9e5a271e314a231e41830d487c7f95bca4b54..74f8aa76925786b9d44531817024b2931cb44454)
[August 21, 2024 17:57](#event-13964453890)

[![AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=60&v=4)](/AdamKorcz)

**[AdamKorcz](/AdamKorcz)**
commented
[Aug 21, 2024](#pullrequestreview-2251540439)

 [View reviewed changes](/theupdateframework/tuf-conformance/pull/115/files)

[tuf\_conformance/repository\_simulator.py](/theupdateframework/tuf-conformance/pull/115/files#diff-14194f3ec16d9cbd8ebf0cc25b2a6a6040e4a56e620203f3373fd6cf426f946a)

|  |  | @@ -62,7 +62,7 @@ | |
| --- | --- | --- | --- |
|  |  | SPEC\_VER = ".".join(SPECIFICATION\_VERSION) |
|  |  |  |
|  |  | # Generate some signers once (to avoid all tests generating them) |
|  |  | NUM\_SIGNERS = 8 |
|  |  | NUM\_SIGNERS = 9 |

Copy link

Contributor

Author

### @AdamKorcz **[AdamKorcz](/AdamKorcz)** [Aug 21, 2024](#discussion_r1725500093)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

For info: The `cyclic-graph` test fails because there are not enough signers.

Sorry, something went wrong.

 👍
1
 jku reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/dacf9f90b3b7d728a5408b8cf063d0deb6377e6c..7d25dcf5829a6fc2b9219bb631a48dee8f74f675)
the
graphs-test

branch
2 times, most recently
from
[`dacf9f9`](/theupdateframework/tuf-conformance/commit/dacf9f90b3b7d728a5408b8cf063d0deb6377e6c) to
[`7d25dcf`](/theupdateframework/tuf-conformance/commit/7d25dcf5829a6fc2b9219bb631a48dee8f74f675)  [Compare](/theupdateframework/tuf-conformance/compare/dacf9f90b3b7d728a5408b8cf063d0deb6377e6c..7d25dcf5829a6fc2b9219bb631a48dee8f74f675)
[August 21, 2024 18:13](#event-13964623557)

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)

`[fix review comments](/theupdateframework/tuf-conformance/pull/115/commits/aa34fde06b73b1cb453bffd3d484a965d9f5e986 "fix review comments

Signed-off-by: Adam Korczynski <adam@adalogics.com>")`
 …

`[aa34fde](/theupdateframework/tuf-conformance/pull/115/commits/aa34fde06b73b1cb453bffd3d484a965d9f5e986)`

```
Signed-off-by: Adam Korczynski <adam@adalogics.com>
```

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/7d25dcf5829a6fc2b9219bb631a48dee8f74f675..aa34fde06b73b1cb453bffd3d484a965d9f5e986)
the
graphs-test

branch
from
[`7d25dcf`](/theupdateframework/tuf-conformance/commit/7d25dcf5829a6fc2b9219bb631a48dee8f74f675) to
[`aa34fde`](/theupdateframework/tuf-conformance/commit/aa34fde06b73b1cb453bffd3d484a965d9f5e986)  [Compare](/theupdateframework/tuf-conformance/compare/7d25dcf5829a6fc2b9219bb631a48dee8f74f675..aa34fde06b73b1cb453bffd3d484a965d9f5e986)
[August 21, 2024 18:16](#event-13964656726)

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)

`[disable test for go-tuf](/theupdateframework/tuf-conformance/pull/115/commits/990c5e933a48faa418df0cfc7f53731540434096 "disable test for go-tuf

Signed-off-by: Adam Korczynski <adam@adalogics.com>")`
 …

`[990c5e9](/theupdateframework/tuf-conformance/pull/115/commits/990c5e933a48faa418df0cfc7f53731540434096)`

```
Signed-off-by: Adam Korczynski <adam@adalogics.com>
```

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
marked this pull request as ready for review
[August 21, 2024 18:31](#event-13964811120)

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=80&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)

Copy link

Contributor

Author

### **[AdamKorcz](/AdamKorcz)** commented [Aug 21, 2024](#issuecomment-2302717276)

| if ("clients/go-tuf/go-tuf" in client.\_cmd): pytest.skip("skip for flakiness")  Added in [990c5e9](https://github.com/theupdateframework/tuf-conformance/commit/990c5e933a48faa418df0cfc7f53731540434096) |
| --- |

All reactions

Sorry, something went wrong.

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
requested a review
from [jku](/jku)
[August 21, 2024 18:53](#event-13965031210)

[![jku](https://avatars.githubusercontent.com/u/31889?s=60&v=4)](/jku)

**[jku](/jku)**
approved these changes
[Aug 22, 2024](#pullrequestreview-2253607591)

 [View reviewed changes](/theupdateframework/tuf-conformance/pull/115/files)

Copy link

Member

### @jku **[jku](/jku)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks, looks good.

* The 150 lines of setup data is not amazing but I don't see meaningful improvements (and some of it, like artifact support, is for future tests)
* left one comment on return values

Sorry, something went wrong.

All reactions

[tuf\_conformance/test\_updater\_delegation\_graphs.py](/theupdateframework/tuf-conformance/pull/115/files#diff-65e0093aadd7a48aa7d160ad760bf394200b4c191cc29b43eb913b3b362cacf7)
Outdated

Show resolved

Hide resolved

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&v=4)](/AdamKorcz)

`[add assert to client call](/theupdateframework/tuf-conformance/pull/115/commits/c9b930dfdb1bbddf3973c00985b2fba58dfcf81a "add assert to client call

Signed-off-by: Adam Korczynski <adam@adalogics.com>")`
 …

`[c9b930d](/theupdateframework/tuf-conformance/pull/115/commits/c9b930dfdb1bbddf3973c00985b2fba58dfcf81a)`

```
Signed-off-by: Adam Korczynski <adam@adalogics.com>
```

 [![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=40&u=c107a31c4b92a3b61bb09db50b3b9d1154371af1&v=4)](/AdamKorcz)
[AdamKorcz](/AdamKorcz)
[force-pushed](/theupdateframework/tuf-conformance/compare/cd7f676525d08c932dc044b3b96258a977bdbad2..c9b930dfdb1bbddf3973c00985b2fba58dfcf81a)
the
graphs-test

branch
from
[`cd7f676`](/theupdateframework/tuf-conformance/commit/cd7f676525d08c932dc044b3b96258a977bdbad2) to
[`c9b930d`](/theupdateframework/tuf-conformance/commit/c9b930dfdb1bbddf3973c00985b2fba58dfcf81a)  [Compare](/theupdateframework/tuf-conformance/compare/cd7f676525d08c932dc044b3b96258a977bdbad2..c9b930dfdb1bbddf3973c00985b2fba58dfcf81a)
[August 22, 2024 09:43](#event-13974345156)

 Hide details
View details

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&u=af88a3982b6671565a22febe0b18021f2c4a07f8&v=4)](/jku)
[jku](/jku)
merged commit [`f7d4604`](/theupdateframework/tuf-conformance/commit/f7d460452e9c41f1e2ed8baa0f0b52190f282786)
into
theupdateframework:main

[Aug 22, 2024](https://github.com/theupdateframework/tuf-conformance/pull/115#event-13974813052)
3 checks passed

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Oct 1, 2024](#ref-issue-2559768884)

[x/vulndb: potential Go vuln in github.com/theupdateframework/go-tuf: CVE-2024-47534
golang/vulndb#3166](/golang/vulndb/issues/3166)

Closed

This was referenced Oct 10, 2024

[chore(deps): update dependency chainguard-dev/melange to v0.13.4
uniget-org/tools#7623](/uniget-org/tools/pull/7623)
 Merged

[chore(deps): update dependency stacklok/minder to v0.0.65
uniget-org/tools#7634](/uniget-org/tools/pull/7634)
 Merged

[chore(deps): update dependency aquasecurity/trivy to v0.56.2
uniget-org/tools#7635](/uniget-org/tools/pull/7635)
 Merged

[Vulnerabilities detected
kyverno/kyverno#11382](/kyverno/kyverno/issues/11382)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Ftuf-conformance%2Fpull%2F115)

Reviewers

[![@jku](https://avatars.githubusercontent.com/u/31889?s=40&v=4)](/jku) [jku](/jku)

jku approved these changes

[![@rdimitrov](https://avatars.githubusercontent.com/u/16540482?s=40&v=4)](/rdimitrov) [rdimitrov](/rdimitrov)

 Awaiting requested review from rdimitrov

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@AdamKorcz](https://avatars.githubusercontent.com/u/44787359?s=52&v=4)](/AdamKorcz) [![@segiddins](https://avatars.githubusercontent.com/u/1946610?s=52&v=4)](/segiddins) [![@jku](https://avatars.githubusercontent.com/u/31889?s=52&v=4)](/jku)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2ba9336d_20250111_202007.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Fedc30b474f5afd4cc603e17149704d5aa605151d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Fedc30b474f5afd4cc603e17149704d5aa605151d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=theupdateframework%2Fgo-tuf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[theupdateframework](/theupdateframework)
/
**[go-tuf](/theupdateframework/go-tuf)**
Public

* [Notifications](/login?return_to=%2Ftheupdateframework%2Fgo-tuf) You must be signed in to change notification settings
* [Fork
  110](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)
* [Star
   639](/login?return_to=%2Ftheupdateframework%2Fgo-tuf)

* [Code](/theupdateframework/go-tuf)
* [Issues
  24](/theupdateframework/go-tuf/issues)
* [Pull requests
  2](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects
  1](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

Additional navigation options

* [Code](/theupdateframework/go-tuf)
* [Issues](/theupdateframework/go-tuf/issues)
* [Pull requests](/theupdateframework/go-tuf/pulls)
* [Discussions](/theupdateframework/go-tuf/discussions)
* [Actions](/theupdateframework/go-tuf/actions)
* [Projects](/theupdateframework/go-tuf/projects)
* [Security](/theupdateframework/go-tuf/security)
* [Insights](/theupdateframework/go-tuf/pulse)

## Commit

[Permalink](/theupdateframework/go-tuf/commit/edc30b474f5afd4cc603e17149704d5aa605151d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Initial commit

[Browse files](/theupdateframework/go-tuf/tree/edc30b474f5afd4cc603e17149704d5aa605151d)
Browse the repository at this point in the history

```
Signed-off-by: Radoslav Dimitrov <dimitrovr@vmware.com>
```

* Loading branch information

[![@rdimitrov](https://avatars.githubusercontent.com/u/16540482?s=40&v=4)](/rdimitrov)

[rdimitrov](/theupdateframework/go-tuf/commits?author=rdimitrov "View all commits by rdimitrov")
committed
Jan 29, 2024

1 parent
[572bb38](/theupdateframework/go-tuf/commit/572bb387df5b42b0ea42034fb6c14eef44ed262f)

commit edc30b4

 Show file tree

 Hide file tree

Showing
**18 changed files**
with
**1,919 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* NOTES.md
  [NOTES.md](#diff-99745d225ce143b02ff42aa535dd47e4e0bdf87c7a4aec1578415704e3a329c4)
* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* examples

  + examples/basic\_repo.go
    [basic\_repo.go](#diff-c4940c599a95357328d1383bbaaef1e51528bd70be4ef1609293a482f255ace8)
  + testdata

    - examples/testdata/1.python-scripts.json
      [1.python-scripts.json](#diff-4116874941fda1ad687fa375ac29099d25a40f7d0d417427aecc224e16ef78c4)
    - examples/testdata/1.root.json
      [1.root.json](#diff-afc3e13cb244afd4ffde10cae97defd01677ebec4665858970e7d48980d0fb5a)
    - examples/testdata/1.snapshot.json
      [1.snapshot.json](#diff-02edb104f5f923b880a8b594f55eede63b049b585869dd2102ac67ccec86531d)
    - examples/testdata/1.targets.json
      [1.targets.json](#diff-4d1318a3c0b22d7e83306c3b63f11d612ed5e90c075c3fa5c02e9d4f454a2386)
    - examples/testdata/2.root.json
      [2.root.json](#diff-04b6818341d5279fe782621c6676590830746168fd6a8392d693e63e61ac2fe3)
    - examples/testdata/2.snapshot.json
      [2.snapshot.json](#diff-72b2a3d94665df3b76a74f8bd99eb42afd51000944df2619f3dd60475739537a)
    - examples/testdata/2.targets.json
      [2.targets.json](#diff-479fe6d1e57c86b017662079a353df1462e8caccfb5add907cb9de842cb203d2)
    - examples/testdata/timestamp.json
      [timestamp.json](#diff-f5816bd5cb413434f0421d37c77efaa14bbcb665fe9624a9d1d30e302e53493e)
* go.mod
  [go.mod](#diff-33ef32bf6c23acb95f5902d7097b7a1d5128ca061167ec0716715b0b9eeaa5f6)
* go.sum
  [go.sum](#diff-3295df7234525439d778f1b282d146a4f1ff6b415248aaac074e8042d9f42d63)
* metadata

  + metadata/helpers.go
    [helpers.go](#diff-60c1c40db5de31d8a9aa8df2ca76d8851bc36f9a7de5169a804b44dd3129e787)
  + metadata/keys.go
    [keys.go](#diff-3c961eb66f92f035005ae0a811e10dfbb24958e14e1c08013b12363fd349c33a)
  + metadata/metadata.go
    [metadata.go](#diff-bc1663385db50e33df147e8b0da3b8694f87707081a013c63bc8c6eacb9984d5)
  + metadata/types.go
    [types.go](#diff-bef7a44a54dcb191064cf994e7bf8c08a91c1264a2be18ba3b5e00f988576d89)
* repo

  + repo/repo.go
    [repo.go](#diff-65e557a13cfc70927d6259fdf0113fff370ecddebb867153d67ef9d0877d8db4)

## There are no files selected for viewing

10 changes: 10 additions & 0 deletions

10
[NOTES.md](#diff-99745d225ce143b02ff42aa535dd47e4e0bdf87c7a4aec1578415704e3a329c4 "NOTES.md")

Show comments

[View file](/theupdateframework/go-tuf/blob/edc30b474f5afd4cc603e17149704d5aa605151d/NOTES.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,10 @@ |
|  |  | # Notes |
|  |  |  |
|  |  | \* Check fuzzing - https://go.dev/doc/tutorial/fuzz |
|  |  | \* Add the option to set custom key ID |
|  |  | \* Add creating a metadata from init struct |
|  |  | \* Support for hashbin delegations and succint roles |
|  |  | \* Make sure to not discard custom fields when converting, i.e. for keys and such |
|  |  | \* Verify and fix how rsa and ecdsa keys are stored |
|  |  | \* Revisit the design - should we use generics or just 4 different structs for each metadata type? |
|  |  | \* Investigate whether depending on `sigstore/signatures` can cause dependency cycle and if so, how to avoid it? |

72 changes: 72 additions & 0 deletions

72
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/theupdateframework/go-tuf/blob/edc30b474f5afd4cc603e17149704d5aa605151d/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,72 @@ |
|  |  | # <img src="https://cdn.rawgit.com/theupdateframework/artwork/3a649fa6/tuf-logo.svg" height="100" valign="middle" alt="TUF"/> A Framework for Securing Software Update Systems |
|  |  | ---------------------------- |
|  |  | [The Update Framework (TUF)](https://theupdateframework.io/) is a framework for |
|  |  | secure content delivery and updates. It protects against various types of |
|  |  | supply chain attacks and provides resilience to compromise. |
|  |  |  |
|  |  | NGO-TUF is started from the idea of providing a Go implementation of TUF that is heavily influenced by the |
|  |  | design decisions made in [python-tuf](https://github.com/theupdateframework/python-tuf). |
|  |  |  |
|  |  | About The Update Framework |
|  |  | -------------------------- |
|  |  | The Update Framework (TUF) design helps developers maintain the security of a |
|  |  | software update system, even against attackers that compromise the repository |
|  |  | or signing keys. |
|  |  | TUF provides a flexible |
|  |  | [specification](https://github.com/theupdateframework/specification/blob/master/tuf-spec.md) |
|  |  | defining functionality that developers can use in any software update system or |
|  |  | re-implement to fit their needs. |
|  |  |  |
|  |  | TUF is hosted by the [Linux Foundation](https://www.linuxfoundation.org/) as |
|  |  | part of the [Cloud Native Computing Foundation](https://www.cncf.io/) (CNCF) |
|  |  | and its design is [used in production](https://theupdateframework.io/adoptions/) |
|  |  | by various tech companies and open source organizations. |
|  |  |  |
|  |  | Please see [TUF's website](https://theupdateframework.com/) for more information about TUF! |
|  |  |  |
|  |  | How to use it |
|  |  | ------------- |
|  |  | See the [basic\_repo.go](examples/basic\_repo.go) example which demonstrates how to \*manually\* create and |
|  |  | maintain repository metadata using the low-level Metadata API. |
|  |  |  |
|  |  | The example highlights the following functionality supported by the metadata API: |
|  |  |  |
|  |  | \* creation of top-level metadata |
|  |  | \* target file handling |
|  |  | \* consistent snapshots |
|  |  | \* key management |
|  |  | \* top-level delegation and signing thresholds |
|  |  | \* metadata verification |
|  |  | \* target delegation |
|  |  | \* in-band and out-of-band metadata signing |
|  |  | \* writing and reading metadata files |
|  |  | \* root key rotation |
|  |  |  |
|  |  | Roadmap |
|  |  | ------------- |
|  |  | [x] Bootstrap a metadata API implementation |
|  |  |  |
|  |  | [x] Recreate the `basic\_repo.py` example |
|  |  |  |
|  |  | [] Verify the metadata API is complete |
|  |  |  |
|  |  | [] Implement a client (standalone package built on top of metadata, to be split into several other parts) |
|  |  |  |
|  |  | [] Implement a repository (standalone package built on top of metadata, to be split into several other parts) |
|  |  |  |
|  |  | Documentation |
|  |  | ------------- |
|  |  | \* [Introduction to TUF's Design](https://theupdateframework.io/overview/) |
|  |  | \* [The TUF Specification](https://theupdateframework.github.io/specification/latest/) |
|  |  |  |
|  |  | Contact |
|  |  | ------- |
|  |  | Questions, feedback, and suggestions are welcomed on the [#tuf] |
|  |  | (https://cloud-native.slack.com/archives/C8NMD3QJ3) channel on |
|  |  | [CNCF Slack](https://slack.cncf.io/). |
|  |  |  |
|  |  | We strive to make the specification easy to implement, so if you come across |
|  |  | any inconsistencies or experience any difficulty, do let us know by sending an |
|  |  | email, or by reporting an issue in the GitHub [specification |
|  |  | repo](https://github.com/theupdateframework/specification/issues). |
|  |  |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `edc30b4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftheupdateframework%2Fgo-tuf%2Fcommit%2Fedc30b474f5afd4cc603e17149704d5aa605151d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


