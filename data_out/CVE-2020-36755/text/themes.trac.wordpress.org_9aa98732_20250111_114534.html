

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Make WordPress Themes](//make.wordpress.org/themes/)

* [Blog](//make.wordpress.org/themes/)
* [Trac (Theme Reviews)](//themes.trac.wordpress.org/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fthemes.trac.wordpress.org%2Fbrowser%2Fcustomizr%2F4.3.1%2Fcore%2Fczr-admin-ccat.php%3Frev%3D135570)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)
* [Ticket Graph](/ticketgraph)

## Context Navigation

* ← Previous Revision
* [Latest Revision](/browser/customizr/4.3.1/core/czr-admin-ccat.php)
* Next Revision →
* [Blame](/browser/customizr/4.3.1/core/czr-admin-ccat.php?annotate=blame&rev=135570 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/customizr/4.3.1/core/czr-admin-ccat.php?rev=135570)

---

# [source:](/browser?rev=135570&order=name "Go to repository root") [customizr](/browser/customizr?rev=135570&order=name "View customizr")/[4.3.1](/browser/customizr/4.3.1?rev=135570&order=name "View 4.3.1")/[core](/browser/customizr/4.3.1/core?rev=135570&order=name "View core")/[czr-admin-ccat.php](/browser/customizr/4.3.1/core/czr-admin-ccat.php?rev=135570&order=name "View czr-admin-ccat.php") @ [135570](/changeset/135570/ "View changeset 135570")

View diff against:

View revision:

| [Last change](/changeset/135570/customizr/4.3.1/core/czr-admin-ccat.php "View differences") on this file since 135570 was [135570](/changeset/135570/ "View changeset 135570"), checked in by themedropbox, [4 years ago](/timeline?from=2020-08-28T17%3A18%3A57Z&precision=second "See timeline at 08/28/2020 05:18:57 PM") |
| --- |
| New version of Customizr - 4.3.1 |
| **File size:** 134.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Init admin actions : loads the meta boxes, |
| [4](#L4) | \* |
| [5](#L5) | \*/ |
| [6](#L6) | if ( ! class\_exists( 'CZR\_admin\_init' ) ) : |
| [7](#L7) | class CZR\_admin\_init { |
| [8](#L8) | static $instance; |
| [9](#L9) | function \_\_construct () { |
| [10](#L10) |  |
| [11](#L11) | self::$instance =& $this; |
| [12](#L12) | //enqueue additional styling for admin screens |
| [13](#L13) | add\_action( 'admin\_init'            , array( $this, 'czr\_fn\_admin\_style' ) ); |
| [14](#L14) |  |
| [15](#L15) | //Load the editor-style specific (post formats and RTL), the user style.css, the active skin |
| [16](#L16) | //add user defined fonts in the editor style (@see the query args add\_editor\_style below) |
| [17](#L17) | //The hook used to be after\_setup\_theme, but, don't know from whic WP version, is\_rtl() always returns false at that stage. |
| [18](#L18) | add\_action( 'init'                  , array( $this, 'czr\_fn\_add\_editor\_style') ); |
| [19](#L19) |  |
| [20](#L20) | add\_filter( 'tiny\_mce\_before\_init'  , array( $this, 'czr\_fn\_user\_defined\_tinymce\_css') ); |
| [21](#L21) | //refresh the post / CPT / page thumbnail on save. Since v3.3.2. |
| [22](#L22) | add\_action ( 'save\_post'            , array( $this, 'czr\_fn\_refresh\_thumbnail') , 10, 2); |
| [23](#L23) |  |
| [24](#L24) | //refresh the terms array (categories/tags pickers options) on term deletion |
| [25](#L25) | add\_action ( 'delete\_term'          , array( $this, 'czr\_fn\_refresh\_terms\_pickers\_options\_cb'), 10, 3 ); |
| [26](#L26) |  |
| [27](#L27) | //UPDATE NOTICE |
| [28](#L28) | add\_action( 'admin\_notices'         , array( $this, 'czr\_fn\_may\_be\_display\_update\_notice') ); |
| [29](#L29) | //always add the ajax action |
| [30](#L30) | add\_action( 'wp\_ajax\_dismiss\_customizr\_update\_notice'    , array( $this , 'czr\_fn\_dismiss\_update\_notice\_action' ) ); |
| [31](#L31) |  |
| [32](#L32) | add\_action( 'admin\_footer'                  , array( $this , 'czr\_fn\_write\_ajax\_dismis\_script' ) ); |
| [33](#L33) |  |
| [34](#L34) | /\* beautify admin notice text using some defaults the\_content filter callbacks \*/ |
| [35](#L35) | foreach ( array( 'wptexturize', 'convert\_smilies', 'wpautop') as $callback ) { |
| [36](#L36) | add\_filter( 'czr\_update\_notice', $callback ); |
| [37](#L37) | } |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) |  |
| [41](#L41) |  |
| [42](#L42) | /\* |
| [43](#L43) | \* @return void |
| [44](#L44) | \* updates the tc-thumb-fld post meta with the relevant thumb id and type |
| [45](#L45) | \* @package Customizr |
| [46](#L46) | \* @since Customizr 3.3.2 |
| [47](#L47) | \*/ |
| [48](#L48) | function czr\_fn\_refresh\_thumbnail( $post\_id, $post ) { |
| [49](#L49) | // If this is just a revision, don't send the email. |
| [50](#L50) | if ( wp\_is\_post\_revision( $post\_id ) || ( ! empty($post) && 'auto-draft' == $post->post\_status ) ) |
| [51](#L51) | return; |
| [52](#L52) |  |
| [53](#L53) | //if czr4 |
| [54](#L54) | if ( czr\_fn\_is\_ms() ) { |
| [55](#L55) |  |
| [56](#L56) | if ( function\_exists( 'czr\_fn\_set\_thumb\_info' ) ) |
| [57](#L57) | czr\_fn\_set\_thumb\_info( $post\_id ); |
| [58](#L58) |  |
| [59](#L59) | } |
| [60](#L60) | else { |
| [61](#L61) |  |
| [62](#L62) | if ( ! class\_exists( 'CZR\_post\_thumbnails' ) || ! is\_object(CZR\_post\_thumbnails::$instance) ) { |
| [63](#L63) | CZR\_\_\_::$instance -> czr\_fn\_req\_once( 'inc/czr-front-ccat.php' ); |
| [64](#L64) | new CZR\_post\_thumbnails(); |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | CZR\_post\_thumbnails::$instance -> czr\_fn\_set\_thumb\_info( $post\_id ); |
| [68](#L68) |  |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) |  |
| [74](#L74) |  |
| [75](#L75) | /\* |
| [76](#L76) | \* hook : 'delete\_term' |
| [77](#L77) | \* @return void |
| [78](#L78) | \* updates the term pickers related options |
| [79](#L79) | \* @package Customizr |
| [80](#L80) | \* @since Customizr 3.4.10 |
| [81](#L81) | \*/ |
| [82](#L82) | function czr\_fn\_refresh\_terms\_pickers\_options\_cb( $term, $tt\_id, $taxonomy ) { |
| [83](#L83) | switch ( $taxonomy ) { |
| [84](#L84) |  |
| [85](#L85) | //delete categories based options |
| [86](#L86) | case 'category': |
| [87](#L87) | $this -> czr\_fn\_refresh\_term\_picker\_options( $term, $option\_name = 'tc\_blog\_restrict\_by\_cat' ); |
| [88](#L88) | break; |
| [89](#L89) | } |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) |  |
| [93](#L93) | function czr\_fn\_refresh\_term\_picker\_options( $term, $option\_name, $option\_group = null ) { |
| [94](#L94) | // czr\_fn\_get\_opt and czr\_fn\_set\_option in core/utils/ class-fire-utils\_option |
| [95](#L95) | //home/blog posts category picker |
| [96](#L96) | $\_option = czr\_fn\_opt( $option\_name, $option\_group, $use\_default = false ); |
| [97](#L97) | if ( is\_array( $\_option ) && ! empty( $\_option ) && in\_array( $term, $\_option ) ) |
| [98](#L98) | //update the option |
| [99](#L99) | czr\_fn\_set\_option( $option\_name, array\_diff( $\_option, (array)$term ) ); |
| [100](#L100) |  |
| [101](#L101) | //alternative, cycle throughout the cats and keep just the existent ones |
| [102](#L102) | /\*if ( is\_array( $blog\_cats ) && ! empty( $blog\_cats ) ) { |
| [103](#L103) | //update the option |
| [104](#L104) | czr\_fn\_set\_option( 'tc\_blog\_restrict\_by\_cat', array\_filter( $blog\_cats, 'czr\_fn\_category\_id\_exists' ) ); |
| [105](#L105) | }\*/ |
| [106](#L106) | } |
| [107](#L107) |  |
| [108](#L108) |  |
| [109](#L109) | /\* |
| [110](#L110) | \* hook : 'czr\_add\_custom\_fonts\_to\_editor' |
| [111](#L111) | \* @return css string |
| [112](#L112) | \* |
| [113](#L113) | \* @package Customizr |
| [114](#L114) | \* @since Customizr 3.2.10 |
| [115](#L115) | \*/ |
| [116](#L116) | function czr\_fn\_maybe\_add\_gfonts\_to\_editor() { |
| [117](#L117) | $\_font\_pair         = esc\_attr( czr\_fn\_opt('tc\_fonts') ); |
| [118](#L118) | $\_all\_font\_pairs    = CZR\_\_\_::$instance -> font\_pairs; |
| [119](#L119) | if ( false === strpos($\_font\_pair,'\_g\_') ) |
| [120](#L120) | return; |
| [121](#L121) | //Commas in a URL need to be encoded before the string can be passed to add\_editor\_style. |
| [122](#L122) | //czr\_fn\_get\_font defined in core/utils/class-fire-utils |
| [123](#L123) | return array( |
| [124](#L124) | str\_replace( |
| [125](#L125) | ',', |
| [126](#L126) | '%2C', |
| [127](#L127) | sprintf( '//fonts.googleapis.com/css?family=%s', czr\_fn\_get\_font( 'single' , $\_font\_pair ) ) |
| [128](#L128) | ) |
| [129](#L129) | ); |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) |  |
| [133](#L133) |  |
| [134](#L134) | /\*\* |
| [135](#L135) | \* hook : 'admin\_init' |
| [136](#L136) | \* enqueue additional styling for admin screens |
| [137](#L137) | \* @package Customizr |
| [138](#L138) | \* @since Customizr 3.0.4 |
| [139](#L139) | \*/ |
| [140](#L140) | function czr\_fn\_admin\_style() { |
| [141](#L141) | wp\_enqueue\_style( |
| [142](#L142) | 'tc-admincss', |
| [143](#L143) | sprintf('%1$sback/css/tc\_admin%2$s.css' , |
| [144](#L144) | CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, |
| [145](#L145) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? '' : '.min' |
| [146](#L146) | ), |
| [147](#L147) | array(), |
| [148](#L148) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER |
| [149](#L149) | ); |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) |  |
| [153](#L153) |  |
| [154](#L154) | /\*\* |
| [155](#L155) | \* Extract changelog of latest version from readme.txt file |
| [156](#L156) | \* @package Customizr |
| [157](#L157) | \* @since Customizr 3.0.5 |
| [158](#L158) | \*/ |
| [159](#L159) | function czr\_fn\_extract\_changelog() { |
| [160](#L160) |  |
| [161](#L161) | if( ! file\_exists(CZR\_BASE."readme.txt") ) { |
| [162](#L162) | return; |
| [163](#L163) | } |
| [164](#L164) | if( ! is\_readable(CZR\_BASE."readme.txt") ) { |
| [165](#L165) | echo '<p>The changelog in readme.txt is not readable.</p>'; |
| [166](#L166) | return; |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | $stylelines = explode("\n", implode('', file(CZR\_BASE."readme.txt"))); |
| [170](#L170) | $read = false; |
| [171](#L171) | $i = 0; |
| [172](#L172) |  |
| [173](#L173) | foreach ($stylelines as $line) { |
| [174](#L174) | //echo 'i = '.$i.'|read = '.$read.'pos = '.strpos($line, '= ').'|line :'.$line.'<br/>'; |
| [175](#L175) | //we stop reading if we reach the next version change |
| [176](#L176) | if ($i == 1 && strpos($line, '= ') === 0 ) { |
| [177](#L177) | $read = false; |
| [178](#L178) | $i = 0; |
| [179](#L179) | } |
| [180](#L180) | //we write the line if between current and previous version |
| [181](#L181) | if ($read) { |
| [182](#L182) | echo $line.'<br/>'; |
| [183](#L183) | } |
| [184](#L184) | //we skip all lines before the current version changelog |
| [185](#L185) | if ($line != strpos($line, '= '.CUSTOMIZR\_VER)) { |
| [186](#L186) | if ($i == 0) { |
| [187](#L187) | $read = false; |
| [188](#L188) | } |
| [189](#L189) | } |
| [190](#L190) | //we begin to read after current version title |
| [191](#L191) | else { |
| [192](#L192) | $read = true; |
| [193](#L193) | $i = 1; |
| [194](#L194) | } |
| [195](#L195) | } |
| [196](#L196) | } |
| [197](#L197) |  |
| [198](#L198) |  |
| [199](#L199) | /\*\* |
| [200](#L200) | \* Customizr styles the visual editor to resemble the theme style, |
| [201](#L201) | \* Loads the editor-style specific (post formats and RTL), the active skin, the user style.css, the user\_defined fonts |
| [202](#L202) | \* @package Customizr |
| [203](#L203) | \* @since Customizr 3.2.11 |
| [204](#L204) | \* |
| [205](#L205) | \*/ |
| [206](#L206) | function czr\_fn\_add\_editor\_style() { |
| [207](#L207) | //array\_filter to remove empty array items is not needed as wp function get\_editor\_stylesheets() (since WP 4.0) |
| [208](#L208) | //will do that for us |
| [209](#L209) |  |
| [210](#L210) | //we need only the relative path, otherwise get\_editor\_stylesheets() will treat this as external CSS |
| [211](#L211) | //which means: |
| [212](#L212) | //a) child-themes cannot override it |
| [213](#L213) | //b) no check on the file existence will be made (producing the rtl error, for instance : https://github.com/presscustomizr/customizr/issues/926) |
| [214](#L214) |  |
| [215](#L215) | //as of v4.0.10 the editor-style.css is the classic editor style for the Customizr classic style |
| [216](#L216) | //4.1.23 block editor style introduced for the Customizr modern style only |
| [217](#L217) |  |
| [218](#L218) | //as of 4.1.38 block editor style introduced for the Customizr modern style too |
| [219](#L219) | $\_style\_suffix = CZR\_DEBUG\_MODE || CZR\_DEV\_MODE ? '.css' : '.min.css' ; |
| [220](#L220) | $\_stylesheets = czr\_fn\_is\_ms() ? array( CZR\_ASSETS\_PREFIX . 'back/css/block-editor-style' . $\_style\_suffix ) : array( CZR\_ASSETS\_PREFIX . 'back/css/editor-style' . $\_style\_suffix, CZR\_ASSETS\_PREFIX . 'back/css/block-editor-style-cs' . $\_style\_suffix ); |
| [221](#L221) |  |
| [222](#L222) | $\_stylesheets[] = 'style.css'; |
| [223](#L223) | if ( ! czr\_fn\_is\_ms() ) { |
| [224](#L224) | $\_stylesheets[] = 'inc/assets/css/' . esc\_attr( czr\_fn\_opt( 'tc\_skin' ) ); |
| [225](#L225) | } |
| [226](#L226) |  |
| [227](#L227) | if ( apply\_filters( 'czr\_add\_custom\_fonts\_to\_editor' , false != $this -> czr\_fn\_maybe\_add\_gfonts\_to\_editor() ) ) |
| [228](#L228) | $\_stylesheets = array\_merge( $\_stylesheets , $this -> czr\_fn\_maybe\_add\_gfonts\_to\_editor() ); |
| [229](#L229) | add\_editor\_style( $\_stylesheets ); |
| [230](#L230) |  |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) |  |
| [234](#L234) |  |
| [235](#L235) |  |
| [236](#L236) | /\*\* |
| [237](#L237) | \* Extend TinyMCE config with a setup function. |
| [238](#L238) | \* See http://www.tinymce.com/wiki.php/API3:event.tinymce.Editor.onInit |
| [239](#L239) | \* http://wordpress.stackexchange.com/questions/120831/how-to-add-custom-css-theme-option-to-tinymce |
| [240](#L240) | \* @package Customizr |
| [241](#L241) | \* @since Customizr 3.2.11 |
| [242](#L242) | \* |
| [243](#L243) | \*/ |
| [244](#L244) | function czr\_fn\_user\_defined\_tinymce\_css( $init ) { |
| [245](#L245) |  |
| [246](#L246) | if ( ! apply\_filters( 'czr\_add\_custom\_fonts\_to\_editor' , true ) ) |
| [247](#L247) | return $init; |
| [248](#L248) |  |
| [249](#L249) | if ( 'tinymce' != wp\_default\_editor() ) |
| [250](#L250) | return $init; |
| [251](#L251) |  |
| [252](#L252) | $\_css = ''; |
| [253](#L253) | //maybe add rtl class |
| [254](#L254) | $\_mce\_body\_context = is\_rtl() ? 'mce-content-body.rtl' : 'mce-content-body'; |
| [255](#L255) |  |
| [256](#L256) | //if modern |
| [257](#L257) | if ( czr\_fn\_is\_ms() ) { |
| [258](#L258) | //some plugins fire tiny mce editor in the customizer |
| [259](#L259) | //in this case, the CZR\_resources\_fonts class has to be loaded |
| [260](#L260) | if ( ! class\_exists('CZR\_resources\_fonts') || ! is\_object(CZR\_resources\_fonts::$instance) ) |
| [261](#L261) | CZR() -> czr\_fn\_load( array('fire' => array( array('core' , 'resources\_fonts') ) ), true ); |
| [262](#L262) |  |
| [263](#L263) | if ( class\_exists('CZR\_resources\_fonts') && is\_object(CZR\_resources\_fonts::$instance) ) { |
| [264](#L264) | //fonts |
| [265](#L265) | $\_css  .= CZR\_resources\_fonts::$instance -> czr\_fn\_write\_fonts\_inline\_css( '', $\_mce\_body\_context ); |
| [266](#L266) | } |
| [267](#L267) |  |
| [268](#L268) | //skin |
| [269](#L269) | //some plugins fire tiny mce editor in the customizer |
| [270](#L270) | //in this case, the CZR\_resources\_styles class has to be loaded |
| [271](#L271) | if ( ! class\_exists('CZR\_resources\_styles') || ! is\_object(CZR\_resources\_styles::$instance) ) |
| [272](#L272) | CZR() -> czr\_fn\_load( array('fire' => array( array('core' , 'resources\_styles') ) ), true ); |
| [273](#L273) |  |
| [274](#L274) | if ( class\_exists('CZR\_resources\_styles') && is\_object(CZR\_resources\_styles::$instance) ) { |
| [275](#L275) |  |
| [276](#L276) | //dynamic skin |
| [277](#L277) | $\_css  .= CZR\_resources\_styles::$instance -> czr\_fn\_maybe\_write\_skin\_inline\_css( '' ); |
| [278](#L278) |  |
| [279](#L279) | } |
| [280](#L280) |  |
| [281](#L281) | } |
| [282](#L282) | //classic |
| [283](#L283) | else { |
| [284](#L284) |  |
| [285](#L285) | //some plugins fire tiny mce editor in the customizer |
| [286](#L286) | //in this case, the CZR\_resource class has to be loaded |
| [287](#L287) | if ( ! class\_exists('CZR\_resources') || ! is\_object(CZR\_resources::$instance) ) { |
| [288](#L288) | CZR\_\_\_::$instance -> czr\_fn\_req\_once( 'inc/czr-init-ccat.php' ); |
| [289](#L289) | new CZR\_resources(); |
| [290](#L290) | } |
| [291](#L291) |  |
| [292](#L292) |  |
| [293](#L293) | //fonts |
| [294](#L294) | $\_css = CZR\_resources::$instance -> czr\_fn\_write\_fonts\_inline\_css( '', $\_mce\_body\_context ); |
| [295](#L295) |  |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | if ( $\_css ) |
| [299](#L299) | $init['content\_style'] = trim(preg\_replace('/\s+/', ' ', $\_css ) ); |
| [300](#L300) |  |
| [301](#L301) | return $init; |
| [302](#L302) |  |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) |  |
| [306](#L306) |  |
| [307](#L307) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [308](#L308) | \* UPDATE NOTICE |
| [309](#L309) | \* User gets notified when the version stores in the db option 'last\_update\_notice' |
| [310](#L310) | \* is < current version of the theme (CUSTOMIZR\_VER) |
| [311](#L311) | \* User can dismiss the notice and the option get updated by ajax to the current version |
| [312](#L312) | \* The notice will be displayed a maximum of 5 times and will be automatically dismissed until the next update. |
| [313](#L313) | \* => users won't be notified again until the next update. |
| [314](#L314) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [315](#L315) | /\*\* |
| [316](#L316) | \* hook : admin\_notices |
| [317](#L317) | \*/ |
| [318](#L318) | function czr\_fn\_may\_be\_display\_update\_notice() { |
| [319](#L319) | //don't display update notification for a list of versions |
| [320](#L320) | //typically useful when several versions are released in a short time interval |
| [321](#L321) | //to avoid hammering the wp admin dashboard with a new admin notice each time |
| [322](#L322) | if ( ( defined('DISPLAY\_UPDATE\_NOTIFICATION') && ! DISPLAY\_UPDATE\_NOTIFICATION ) || ( defined('DISPLAY\_PRO\_UPDATE\_NOTIFICATION') && ! DISPLAY\_PRO\_UPDATE\_NOTIFICATION ) ) |
| [323](#L323) | return; |
| [324](#L324) |  |
| [325](#L325) | $opt\_name                   = CZR\_IS\_PRO ? 'last\_update\_notice\_pro' : 'last\_update\_notice'; |
| [326](#L326) | $last\_update\_notice\_values  = czr\_fn\_opt($opt\_name); |
| [327](#L327) | $show\_new\_notice = false; |
| [328](#L328) | $display\_ct = 50; |
| [329](#L329) |  |
| [330](#L330) | if ( ! $last\_update\_notice\_values || ! is\_array($last\_update\_notice\_values) ) { |
| [331](#L331) | //first time user of the theme, the option does not exist |
| [332](#L332) | // 1) initialize it => set it to the current Customizr version, displayed 0 times. |
| [333](#L333) | // 2) update in db |
| [334](#L334) | $last\_update\_notice\_values = array( "version" => CUSTOMIZR\_VER, "display\_count" => 0 ); |
| [335](#L335) | czr\_fn\_set\_option( $opt\_name, $last\_update\_notice\_values ); |
| [336](#L336) | //already user of the theme ? |
| [337](#L337) | if ( czr\_fn\_user\_started\_before\_version( CUSTOMIZR\_VER, CUSTOMIZR\_VER ) ) |
| [338](#L338) | $show\_new\_notice = true; |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) | $\_db\_version          = $last\_update\_notice\_values["version"]; |
| [342](#L342) | $\_db\_displayed\_count  = $last\_update\_notice\_values["display\_count"]; |
| [343](#L343) |  |
| [344](#L344) | // user who just upgraded the theme will be notified until he clicks on the dismiss link |
| [345](#L345) | // when clicking on the dismiss link OR when the notice has been displayed n times. |
| [346](#L346) | // - version will be set to CUSTOMIZR\_VER |
| [347](#L347) | // - display\_count reset to 0 |
| [348](#L348) | if ( version\_compare( CUSTOMIZR\_VER, $\_db\_version , '>' ) ) { |
| [349](#L349) | //CASE 1 : displayed less than n times |
| [350](#L350) | if ( $\_db\_displayed\_count < $display\_ct ) { |
| [351](#L351) | $show\_new\_notice = true; |
| [352](#L352) | //increments the counter |
| [353](#L353) | (int) $\_db\_displayed\_count++; |
| [354](#L354) | $last\_update\_notice\_values["display\_count"] = $\_db\_displayed\_count; |
| [355](#L355) | //updates the option val with the new count |
| [356](#L356) | czr\_fn\_set\_option( $opt\_name, $last\_update\_notice\_values ); |
| [357](#L357) | } |
| [358](#L358) | //CASE 2 : displayed n times => automatic dismiss |
| [359](#L359) | else { |
| [360](#L360) | //reset option value with new version and counter to 0 |
| [361](#L361) | $new\_val  = array( "version" => CUSTOMIZR\_VER, "display\_count" => 0 ); |
| [362](#L362) | czr\_fn\_set\_option( $opt\_name, $new\_val ); |
| [363](#L363) | }//end else |
| [364](#L364) | }//end if |
| [365](#L365) |  |
| [366](#L366) | if ( ! $show\_new\_notice ) |
| [367](#L367) | return; |
| [368](#L368) |  |
| [369](#L369) | // prefixed CZR\_Plugin\_Activation because of the possible issue : https://github.com/presscustomizr/customizr/issues/1603 |
| [370](#L370) | if ( ! czr\_fn\_is\_plugin\_active('nimble-builder/nimble-builder.php') && class\_exists('CZR\_Plugin\_Activation') && ! CZR\_Plugin\_Activation::get\_instance()->czr\_fn\_is\_notice\_dismissed() ) |
| [371](#L371) | return; |
| [372](#L372) |  |
| [373](#L373) | ob\_start(); |
| [374](#L374) | ?> |
| [375](#L375) | <div class="updated czr-update-notice" style="position:relative"> |
| [376](#L376) | <?php |
| [377](#L377) | echo apply\_filters( |
| [378](#L378) | 'czr\_update\_notice', |
| [379](#L379) | sprintf('<h3>%1$s %2$s %3$s %4$s :D</h3>', |
| [380](#L380) | \_\_( "Good, you've recently upgraded to", "customizr"), |
| [381](#L381) | CZR\_IS\_PRO ? 'Customizr Pro' : 'Customizr', |
| [382](#L382) | \_\_( "version", "customizr"), |
| [383](#L383) | CUSTOMIZR\_VER |
| [384](#L384) | ) |
| [385](#L385) | ); |
| [386](#L386) | ?> |
| [387](#L387) | <?php |
| [388](#L388) | echo apply\_filters( |
| [389](#L389) | 'czr\_update\_notice', |
| [390](#L390) | sprintf( '<h4>%1$s <a class="" href="%2$s" title="%3$s" target="\_blank">%3$s &raquo;</a></h4>%4$s', |
| [391](#L391) | \_\_( "We'd like to introduce the new features we've been working on.", "customizr"), |
| [392](#L392) | CZR\_WEBSITE . "category/customizr-releases/", |
| [393](#L393) | \_\_( "Read the latest release notes" , "customizr" ), |
| [394](#L394) | ! CZR\_IS\_PRO ? sprintf( '<p style="position: absolute;right: 7px;top: 4px;"><a class="button button-primary upgrade-to-pro" href="%1$s" title="%2$s" target="\_blank">%2$s &raquo;</a></p>', |
| [395](#L395) | esc\_url('presscustomizr.com/customizr-pro?ref=a&utm\_source=usersite&utm\_medium=link&utm\_campaign=customizr-update-notice'), |
| [396](#L396) | \_\_( "Upgrade to Customizr Pro", "customizr" ) |
| [397](#L397) | ) : '' |
| [398](#L398) | ) |
| [399](#L399) | ); |
| [400](#L400) | ?> |
| [401](#L401) | <p style="text-align:right;position: absolute;font-size: 1.1em;<?php echo is\_rtl()? 'left' : 'right';?>: 7px;bottom: -5px;"> |
| [402](#L402) | <?php printf('<a href="#" title="%1$s" class="tc-dismiss-update-notice"> ( %1$s <strong>X</strong> ) </a>', |
| [403](#L403) | \_\_('close' , 'customizr') |
| [404](#L404) | ); |
| [405](#L405) | ?> |
| [406](#L406) | </p> |
| [407](#L407) | </div> |
| [408](#L408) | <?php |
| [409](#L409) | $\_html = ob\_get\_contents(); |
| [410](#L410) | if ($\_html) ob\_end\_clean(); |
| [411](#L411) | echo $\_html; |
| [412](#L412) | } |
| [413](#L413) |  |
| [414](#L414) |  |
| [415](#L415) | /\*\* |
| [416](#L416) | \* hook : wp\_ajax\_dismiss\_customizr\_update\_notice |
| [417](#L417) | \* => sets the last\_update\_notice to the current Customizr version when user click on dismiss notice link |
| [418](#L418) | \*/ |
| [419](#L419) | function czr\_fn\_dismiss\_update\_notice\_action() { |
| [420](#L420) | check\_ajax\_referer( 'dismiss-update-notice-nonce', 'dismissUpdateNoticeNonce' ); |
| [421](#L421) | $opt\_name = CZR\_IS\_PRO ? 'last\_update\_notice\_pro' : 'last\_update\_notice'; |
| [422](#L422) | //reset option value with new version and counter to 0 |
| [423](#L423) | $new\_val  = array( "version" => CUSTOMIZR\_VER, "display\_count" => 0 ); |
| [424](#L424) | czr\_fn\_set\_option( $opt\_name, $new\_val ); |
| [425](#L425) | wp\_die(); |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) |  |
| [429](#L429) |  |
| [430](#L430) | /\*\* |
| [431](#L431) | \* hook : admin\_footer |
| [432](#L432) | \*/ |
| [433](#L433) | function czr\_fn\_write\_ajax\_dismis\_script() { |
| [434](#L434) | ?> |
| [435](#L435) | <script type="text/javascript" id="tc-dismiss-update-notice"> |
| [436](#L436) | ( function($){ |
| [437](#L437) | var \_ajax\_action = function( $\_el ) { |
| [438](#L438) | var AjaxUrl = "<?php echo admin\_url( 'admin-ajax.php' ); ?>", |
| [439](#L439) | \_query  = { |
| [440](#L440) | action  : 'dismiss\_customizr\_update\_notice', |
| [441](#L441) | dismissUpdateNoticeNonce :  "<?php echo wp\_create\_nonce( 'dismiss-update-notice-nonce' ); ?>" |
| [442](#L442) | }, |
| [443](#L443) | $ = jQuery, |
| [444](#L444) | request = $.post( AjaxUrl, \_query ); |
| [445](#L445) |  |
| [446](#L446) | request.fail( function ( response ) { |
| [447](#L447) | //console.log('response when failed : ', response); |
| [448](#L448) | }); |
| [449](#L449) | request.done( function( response ) { |
| [450](#L450) | //console.log('RESPONSE DONE', $\_el, response); |
| [451](#L451) | // Check if the user is logged out. |
| [452](#L452) | if ( '0' === response ) |
| [453](#L453) | return; |
| [454](#L454) | // Check for cheaters. |
| [455](#L455) | if ( '-1' === response ) |
| [456](#L456) | return; |
| [457](#L457) |  |
| [458](#L458) | $\_el.closest('.updated').slideToggle('fast'); |
| [459](#L459) | }); |
| [460](#L460) | };//end of fn |
| [461](#L461) |  |
| [462](#L462) | //on load |
| [463](#L463) | $( function($) { |
| [464](#L464) | $('.tc-dismiss-update-notice').click( function( e ) { |
| [465](#L465) | e.preventDefault(); |
| [466](#L466) | \_ajax\_action( $(this) ); |
| [467](#L467) | } ); |
| [468](#L468) | } ); |
| [469](#L469) |  |
| [470](#L470) | } )( jQuery ); |
| [471](#L471) |  |
| [472](#L472) |  |
| [473](#L473) | </script> |
| [474](#L474) | <?php |
| [475](#L475) | } |
| [476](#L476) |  |
| [477](#L477) | }//end of class |
| [478](#L478) | endif; |
| [479](#L479) |  |
| [480](#L480) | ?><?php |
| [481](#L481) | /\*\* |
| [482](#L482) | \* Init admin page actions : Welcome, help page |
| [483](#L483) | \* |
| [484](#L484) | \*/ |
| [485](#L485) | if ( ! class\_exists( 'CZR\_admin\_page' ) ) : |
| [486](#L486) | class CZR\_admin\_page { |
| [487](#L487) | static $instance; |
| [488](#L488) | public $support\_url; |
| [489](#L489) |  |
| [490](#L490) | function \_\_construct () { |
| [491](#L491) | self::$instance =& $this; |
| [492](#L492) | //add welcome page in menu |
| [493](#L493) | add\_action( 'admin\_menu'             , array( $this , 'czr\_fn\_add\_welcome\_page' )); |
| [494](#L494) | //config infos |
| [495](#L495) | add\_action( '\_\_after\_welcome\_panel'  , array( $this , 'czr\_fn\_config\_infos' ), 10 ); |
| [496](#L496) | //changelog |
| [497](#L497) | add\_action( '\_\_after\_welcome\_panel'  , array( $this , 'czr\_fn\_print\_changelog' ), 20); |
| [498](#L498) | //build the support url |
| [499](#L499) | $this -> support\_url = CZR\_IS\_PRO ? esc\_url( sprintf('%ssupport' , CZR\_WEBSITE ) ) : esc\_url('wordpress.org/support/theme/customizr'); |
| [500](#L500) | //fix #wpfooter absolute positioning in the welcome and about pages |
| [501](#L501) | add\_action( 'admin\_print\_styles'     , array( $this, 'czr\_fn\_fix\_wp\_footer\_link\_style') ); |
| [502](#L502) | //knowledgebase |
| [503](#L503) | if ( CZR\_IS\_PRO ) { |
| [504](#L504) | add\_action( 'current\_screen'         , array( $this , 'czr\_schedule\_welcome\_page\_actions') ); |
| [505](#L505) | } |
| [506](#L506) | } |
| [507](#L507) |  |
| [508](#L508) |  |
| [509](#L509) |  |
| [510](#L510) | /\*\* |
| [511](#L511) | \* Add fallback admin page. |
| [512](#L512) | \* @package Customizr |
| [513](#L513) | \* @since Customizr 1.1 |
| [514](#L514) | \*/ |
| [515](#L515) | function czr\_fn\_add\_welcome\_page() { |
| [516](#L516) | $\_name = \_\_( 'About Customizr' , 'customizr' ); |
| [517](#L517) | $\_name = CZR\_IS\_PRO ? sprintf( '%s Pro', $\_name ) : $\_name; |
| [518](#L518) |  |
| [519](#L519) | $theme\_page = add\_theme\_page( |
| [520](#L520) | $\_name,   // Name of page |
| [521](#L521) | $\_name,   // Label in menu |
| [522](#L522) | 'edit\_theme\_options' ,          // Capability required |
| [523](#L523) | 'welcome.php' ,             // Menu slug, used to uniquely identify the page |
| [524](#L524) | array( $this , 'czr\_fn\_welcome\_panel' )         //function to be called to output the content of this page |
| [525](#L525) | ); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) |  |
| [529](#L529) |  |
| [530](#L530) | /\*\* |
| [531](#L531) | \* Render welcome admin page. |
| [532](#L532) | \* @package Customizr |
| [533](#L533) | \* @since Customizr 3.0.4 |
| [534](#L534) | \*/ |
| [535](#L535) | function czr\_fn\_welcome\_panel() { |
| [536](#L536) |  |
| [537](#L537) | $is\_help        = isset($\_GET['help'])  ?  true : false; |
| [538](#L538) | $\_faq\_url       = esc\_url('http://docs.presscustomizr.com/category/90-faq-and-common-issues'); |
| [539](#L539) | $\_support\_url   = $this -> support\_url; |
| [540](#L540) | $\_theme\_name    = CZR\_IS\_PRO ? 'Customizr Pro' : 'Customizr'; |
| [541](#L541) |  |
| [542](#L542) | do\_action('\_\_before\_welcome\_panel'); |
| [543](#L543) |  |
| [544](#L544) | ?> |
| [545](#L545) | <div id="customizr-admin-panel" class="wrap about-wrap"> |
| [546](#L546) | <?php |
| [547](#L547) | $title = sprintf( '<h1 class="need-help-title">%1$s %2$s %3$s :)</h1>', |
| [548](#L548) | \_\_( "Thank you for using", "customizr" ), |
| [549](#L549) | $\_theme\_name, |
| [550](#L550) | CUSTOMIZR\_VER |
| [551](#L551) | ); |
| [552](#L552) | echo convert\_smilies( $title ); |
| [553](#L553) | ?> |
| [554](#L554) |  |
| [555](#L555) | <?php if ( $is\_help && ! CZR\_IS\_PRO ) : ?> |
| [556](#L556) |  |
| [557](#L557) | <div class=""> |
| [558](#L558) |  |
| [559](#L559) | </div><!-- .changelog --> |
| [560](#L560) |  |
| [561](#L561) | <?php else : ?> |
| [562](#L562) |  |
| [563](#L563) | <div class="about-text tc-welcome"> |
| [564](#L564) | <?php |
| [565](#L565) | printf( '<p>%1$s</p>', |
| [566](#L566) | sprintf( \_\_( "The best way to start with %s is to read the %s and visit the %s.", "customizr"), |
| [567](#L567) | $\_theme\_name, |
| [568](#L568) | sprintf( '<a href="%1$s" title="%2$s" target="\_blank">%2$s</a>', esc\_url('docs.presscustomizr.com'), \_\_("documentation", "customizr") ), |
| [569](#L569) | sprintf( '<a href="%1$s" title="%2$s" target="\_blank">%2$s</a>', esc\_url('demo.presscustomizr.com'), \_\_("demo website", "customizr") ) |
| [570](#L570) | ) |
| [571](#L571) | ); |
| [572](#L572) | printf( '<p><a href="#customizr-changelog">%1$s</a></p>', |
| [573](#L573) | \_\_( "Read the changelog", "customizr") |
| [574](#L574) | ); |
| [575](#L575) | ?> |
| [576](#L576) | </div> |
| [577](#L577) |  |
| [578](#L578) | <?php endif; ?> |
| [579](#L579) |  |
| [580](#L580) | <?php if ( czr\_fn\_is\_child() ) : ?> |
| [581](#L581) | <div class="changelog point-releases"></div> |
| [582](#L582) |  |
| [583](#L583) | <div class="tc-upgrade-notice"> |
| [584](#L584) | <p> |
| [585](#L585) | <?php |
| [586](#L586) | printf( \_\_('You are using a child theme of Customizr %1$s : always check the %2$s after upgrading to see if a function or a template has been deprecated.' , 'customizr'), |
| [587](#L587) | 'v'.CUSTOMIZR\_VER, |
| [588](#L588) | '<strong><a href="#customizr-changelog">changelog</a></strong>' |
| [589](#L589) | ); |
| [590](#L590) | ?> |
| [591](#L591) | </p> |
| [592](#L592) | </div> |
| [593](#L593) | <?php endif; ?> |
| [594](#L594) |  |
| [595](#L595) | <?php do\_action( 'czr\_after\_welcome\_admin\_intro' ); ?> |
| [596](#L596) |  |
| [597](#L597) | <div class="changelog point-releases"></div> |
| [598](#L598) |  |
| [599](#L599) | <?php if ( ! CZR\_IS\_PRO ) : ?> |
| [600](#L600) | <div class="changelog"> |
| [601](#L601) |  |
| [602](#L602) | <div class="feature-section col two-col"> |
| [603](#L603) |  |
| [604](#L604) | <div class="col"> |
| [605](#L605) | <h3 style="font-size:1.3em;"><?php \_e( 'Happy user of Customizr?','customizr' ); ?></h3> |
| [606](#L606) | <p><?php \_e( 'If you are happy with the theme, say it on wordpress.org and give Customizr a nice review! <br />(We are addicted to your feedbacks...)','customizr' ) ?></br> |
| [607](#L607) | <a class="button-primary review-customizr" title="Customizr WordPress Theme" href="<?php echo esc\_url('wordpress.org/support/view/theme-reviews/customizr') ?>" target="\_blank">Review Customizr &raquo;</a></p> |
| [608](#L608) | </div> |
| [609](#L609) |  |
| [610](#L610) | <div class="last-feature col"> |
| [611](#L611) | <h3 style="font-size:1.3em;"><?php \_e( 'Follow us','customizr' ); ?></h3> |
| [612](#L612) | <p class="tc-follow"><a href="<?php echo esc\_url( CZR\_WEBSITE . 'blog' ); ?>" target="\_blank"><img style="border:none;width:auto;" src="<?php echo CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX.'back/img/pc.png?' . CUSTOMIZR\_VER ?>" alt="Press Customizr" /></a></p> |
| [613](#L613) | <!-- Place this tag where you want the widget to render. --> |
| [614](#L614) |  |
| [615](#L615) | </div><!-- .feature-section --> |
| [616](#L616) | </div><!-- .feature-section col three-col --> |
| [617](#L617) |  |
| [618](#L618) | </div><!-- .changelog --> |
| [619](#L619) |  |
| [620](#L620) | <div id="extend" class="changelog"> |
| [621](#L621) | <h3 style="text-align:left;font-size:1.3em;"><?php \_e("Go Customizr Pro" ,'customizr') ?></h3> |
| [622](#L622) |  |
| [623](#L623) | <div class="feature-section two-col images-stagger-right"> |
| [624](#L624) | <div class="col" style="float:right"> |
| [625](#L625) | <a class="" title="Go Pro" href="<?php echo esc\_url( CZR\_WEBSITE . 'customizr-pro?ref=a&utm\_source=usersite&utm\_medium=link&utm\_campaign=customizr-admin-page' ); ?>" target="\_blank"><img style="border:none;width:auto;" alt="Customizr Pro" src="<?php echo CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX.'back/img/customizr-pro.png?'.CUSTOMIZR\_VER ?>" class=""></a> |
| [626](#L626) | </div> |
| [627](#L627) | <div class="col" style="float:left"> |
| [628](#L628) | <h4 style="text-align: left;"><?php \_e('Easily take your web design one step further' ,'customizr') ?></h4></br> |
| [629](#L629) |  |
| [630](#L630) | <p style="text-align: left;"><?php \_e("The Customizr Pro WordPress theme allows anyone to create a beautiful, professional and mobile friendly website in a few minutes. In the Pro version, you'll get all features included in the free version plus many conversion oriented ones, to help you attract and retain more visitors on your websites." , 'customizr') ?> |
| [631](#L631) | </p> |
| [632](#L632) | <p style="text-align:left;"> |
| [633](#L633) | <a class="button-primary review-customizr hu-go-pro-btn" title="<?php \_e("Discover Customizr Pro",'customizr') ?>" href="<?php echo esc\_url( CZR\_WEBSITE . 'customizr-pro?ref=a&utm\_source=usersite&utm\_medium=link&utm\_campaign=customizr-admin-page' ); ?>" target="\_blank"><?php \_e("Discover Customizr Pro",'customizr') ?> &raquo;</a> |
| [634](#L634) | </p> |
| [635](#L635) | </div> |
| [636](#L636) | </div> |
| [637](#L637) | </div> |
| [638](#L638) | <?php endif; //end if ! is\_pro ?> |
| [639](#L639) |  |
| [640](#L640) | <?php do\_action( '\_\_after\_welcome\_panel' ); ?> |
| [641](#L641) |  |
| [642](#L642) | <div class="return-to-dashboard"> |
| [643](#L643) | <a href="<?php echo esc\_url( self\_admin\_url() ); ?>"><?php |
| [644](#L644) | is\_blog\_admin() ? \_e( 'Go to Dashboard &rarr; Home','customizr' ) : \_e( 'Go to Dashboard','customizr' ); ?></a> |
| [645](#L645) | </div> |
| [646](#L646) |  |
| [647](#L647) | </div><!-- //#customizr-admin-panel --> |
| [648](#L648) | <?php |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) |  |
| [652](#L652) |  |
| [653](#L653) |  |
| [654](#L654) | /\*\* |
| [655](#L655) | \* Extract changelog of latest version from readme.txt file |
| [656](#L656) | \* |
| [657](#L657) | \* @package Customizr |
| [658](#L658) | \* @since Customizr 3.0.5 |
| [659](#L659) | \*/ |
| [660](#L660) | function czr\_fn\_print\_changelog() { |
| [661](#L661) | if ( isset($\_GET['help']) ) |
| [662](#L662) | return; |
| [663](#L663) | if( ! file\_exists( CZR\_BASE . "readme.txt" ) ) { |
| [664](#L664) | return; |
| [665](#L665) | } |
| [666](#L666) | if( ! is\_readable( CZR\_BASE . "readme.txt" ) ) { |
| [667](#L667) | echo '<p>The changelog in readme.txt is not readable.</p>'; |
| [668](#L668) | return; |
| [669](#L669) | } |
| [670](#L670) |  |
| [671](#L671) | $html = ''; |
| [672](#L672) | $stylelines = explode("\n", implode('', file( CZR\_BASE . "readme.txt" ) ) ); |
| [673](#L673) | $read = false; |
| [674](#L674) | $is\_title = false; |
| [675](#L675) |  |
| [676](#L676) | foreach ($stylelines as $line) { |
| [677](#L677) | $is\_title = 0 === strpos($line, '= '); |
| [678](#L678) |  |
| [679](#L679) | //we start reading after current version title |
| [680](#L680) | if ( 0 === strpos($line, '= '. CUSTOMIZR\_VER) ) { |
| [681](#L681) | $read = true; |
| [682](#L682) | } |
| [683](#L683) |  |
| [684](#L684) | if ( ! $read ) |
| [685](#L685) | continue; |
| [686](#L686) |  |
| [687](#L687) | if ( $is\_title ) { |
| [688](#L688) | $html .= sprintf( '<strong>%1$s</strong><br/>', esc\_attr( $line ) ); |
| [689](#L689) | } else { |
| [690](#L690) | $html .= sprintf( '<i>%1$s</i><br/>', esc\_attr( $line ) ); |
| [691](#L691) | } |
| [692](#L692) | } |
| [693](#L693) | do\_action('\_\_before\_changelog') |
| [694](#L694) | ?> |
| [695](#L695) | <div id="customizr-changelog" class="changelog"> |
| [696](#L696) | <h3><?php printf( \_\_( 'Changelog in version %1$s' , 'customizr' ) , CUSTOMIZR\_VER ); ?></h3> |
| [697](#L697) | <p><?php echo $html ?></p> |
| [698](#L698) | </div> |
| [699](#L699) | <?php |
| [700](#L700) | } |
| [701](#L701) |  |
| [702](#L702) |  |
| [703](#L703) |  |
| [704](#L704) | /\* |
| [705](#L705) | \* Inspired by Easy Digital Download plugin by Pippin Williamson |
| [706](#L706) | \* @since 3.2.1 |
| [707](#L707) | \*/ |
| [708](#L708) | function czr\_fn\_config\_infos() { |
| [709](#L709) | global $wpdb; |
| [710](#L710) | $theme\_data   = wp\_get\_theme(); |
| [711](#L711) | $theme        = $theme\_data->Name . ' ' . $theme\_data->Version; |
| [712](#L712) | $parent\_theme = $theme\_data->Template; |
| [713](#L713) | if ( ! empty( $parent\_theme ) ) { |
| [714](#L714) | $parent\_theme\_data = wp\_get\_theme( $parent\_theme ); |
| [715](#L715) | $parent\_theme      = $parent\_theme\_data->Name . ' ' . $parent\_theme\_data->Version; |
| [716](#L716) | } |
| [717](#L717) | ?> |
| [718](#L718) | <div class="wrap tc-config-info"> |
| [719](#L719) | <h3><?php \_e( 'System Informations', 'customizr' ); ?></h3> |
| [720](#L720) | <h4 style="text-align: left"><?php \_e( 'Please include the following informations when posting support requests' , 'customizr' ) ?></h4> |
| [721](#L721) | <textarea readonly="readonly" onclick="this.focus();this.select()" id="system-info-textarea" name="tc-sysinfo" title="<?php \_e( 'To copy the system infos, click below then press Ctrl + C (PC) or Cmd + C (Mac).', 'customizr' ); ?>" style="width: 800px;min-height: 800px;font-family: Menlo,Monaco,monospace;background: 0 0;white-space: pre;overflow: auto;display:block;"> |
| [722](#L722) | <?php do\_action( '\_\_system\_config\_before' ); ?> |
| [723](#L723) | # SITE\_URL:                 <?php echo esc\_url( site\_url() ) . "\n"; ?> |
| [724](#L724) | # HOME\_URL:                 <?php echo esc\_url( home\_url() ) . "\n"; ?> |
| [725](#L725) | # IS MULTISITE :            <?php echo is\_multisite() ? 'Yes' . "\n" : 'No' . "\n" ?> |
| [726](#L726) |  |
| [727](#L727) | # ACTIVE THEME :            <?php echo $theme . "\n"; ?> |
| [728](#L728) | <?php if ( $parent\_theme !== $theme ) : ?> |
| [729](#L729) | # PARENT THEME :            <?php echo $parent\_theme . "\n"; ?> |
| [730](#L730) | <?php endif; ?> |
| [731](#L731) | # WP VERSION :              <?php echo get\_bloginfo( 'version' ) . "\n"; ?> |
| [732](#L732) | # PERMALINK STRUCTURE :     <?php echo get\_option( 'permalink\_structure' ) . "\n"; ?> |
| [733](#L733) |  |
| [734](#L734) | # ACTIVE PLUGINS : |
| [735](#L735) | <?php |
| [736](#L736) | $plugins = get\_plugins(); |
| [737](#L737) | $active\_plugins = get\_option( 'active\_plugins', array() ); |
| [738](#L738) |  |
| [739](#L739) | foreach ( $plugins as $plugin\_path => $plugin ) { |
| [740](#L740) | // If the plugin isn't active, don't show it. |
| [741](#L741) | if ( ! in\_array( $plugin\_path, $active\_plugins ) ) |
| [742](#L742) | continue; |
| [743](#L743) |  |
| [744](#L744) | echo $plugin['Name'] . ': ' . $plugin['Version'] ."\n"; |
| [745](#L745) | } |
| [746](#L746) |  |
| [747](#L747) | if ( is\_multisite() ) : |
| [748](#L748) | ?> |
| [749](#L749) | #  NETWORK ACTIVE PLUGINS: |
| [750](#L750) | <?php |
| [751](#L751) | $plugins = wp\_get\_active\_network\_plugins(); |
| [752](#L752) | $active\_plugins = get\_site\_option( 'active\_sitewide\_plugins', array() ); |
| [753](#L753) |  |
| [754](#L754) | foreach ( $plugins as $plugin\_path ) { |
| [755](#L755) | $plugin\_base = plugin\_basename( $plugin\_path ); |
| [756](#L756) |  |
| [757](#L757) | // If the plugin isn't active, don't show it. |
| [758](#L758) | if ( ! array\_key\_exists( $plugin\_base, $active\_plugins ) ) |
| [759](#L759) | continue; |
| [760](#L760) |  |
| [761](#L761) | $plugin = get\_plugin\_data( $plugin\_path ); |
| [762](#L762) |  |
| [763](#L763) | echo $plugin['Name'] . ' :' . $plugin['Version'] ."\n"; |
| [764](#L764) | } |
| [765](#L765) | endif; |
| [766](#L766) | //GET MYSQL VERSION |
| [767](#L767) | global $wpdb; |
| [768](#L768) | $mysql\_ver =  ( ! empty( $wpdb->use\_mysqli ) && $wpdb->use\_mysqli ) ? @mysqli\_get\_server\_info( $wpdb->dbh ) : ''; |
| [769](#L769) | ?> |
| [770](#L770) |  |
| [771](#L771) | PHP Version:              <?php echo PHP\_VERSION . "\n"; ?> |
| [772](#L772) | MySQL Version:            <?php echo $mysql\_ver . "\n"; ?> |
| [773](#L773) | Web Server Info:          <?php echo $\_SERVER['SERVER\_SOFTWARE'] . "\n"; ?> |
| [774](#L774) |  |
| [775](#L775) | WordPress Memory Limit:   <?php echo ( $this -> czr\_fn\_let\_to\_num( WP\_MEMORY\_LIMIT )/( 1024 ) )."MB"; ?><?php echo "\n"; ?> |
| [776](#L776) | PHP Memory Limit:         <?php echo ini\_get( 'memory\_limit' ) . "\n"; ?> |
| [777](#L777) | PHP Upload Max Size:      <?php echo ini\_get( 'upload\_max\_filesize' ) . "\n"; ?> |
| [778](#L778) | PHP Post Max Size:        <?php echo ini\_get( 'post\_max\_size' ) . "\n"; ?> |
| [779](#L779) | PHP Upload Max Filesize:  <?php echo ini\_get( 'upload\_max\_filesize' ) . "\n"; ?> |
| [780](#L780) | PHP Time Limit:           <?php echo ini\_get( 'max\_execution\_time' ) . "\n"; ?> |
| [781](#L781) | PHP Max Input Vars:       <?php echo ini\_get( 'max\_input\_vars' ) . "\n"; ?> |
| [782](#L782) | PHP Arg Separator:        <?php echo ini\_get( 'arg\_separator.output' ) . "\n"; ?> |
| [783](#L783) | PHP Allow URL File Open:  <?php echo ini\_get( 'allow\_url\_fopen' ) ? "Yes" : "No\n"; ?> |
| [784](#L784) |  |
| [785](#L785) | WP\_DEBUG:                 <?php echo defined( 'WP\_DEBUG' ) ? WP\_DEBUG ? 'Enabled' . "\n" : 'Disabled' . "\n" : 'Not set' . "\n" ?> |
| [786](#L786) |  |
| [787](#L787) | Show On Front:            <?php echo get\_option( 'show\_on\_front' ) . "\n" ?> |
| [788](#L788) | Page On Front:            <?php $id = get\_option( 'page\_on\_front' ); echo get\_the\_title( $id ) . ' (#' . $id . ')' . "\n" ?> |
| [789](#L789) | Page For Posts:           <?php $id = get\_option( 'page\_for\_posts' ); echo get\_the\_title( $id ) . ' (#' . $id . ')' . "\n" ?> |
| [790](#L790) | <?php do\_action( '\_\_system\_config\_after' ); ?> |
| [791](#L791) | </textarea> |
| [792](#L792) | </div> |
| [793](#L793) | </div> |
| [794](#L794) | <?php |
| [795](#L795) | }//end of function |
| [796](#L796) |  |
| [797](#L797) |  |
| [798](#L798) | /\*\* |
| [799](#L799) | \* TC Let To Num |
| [800](#L800) | \* |
| [801](#L801) | \* Does Size Conversions |
| [802](#L802) | \* |
| [803](#L803) | \* |
| [804](#L804) | \* @since 3.2.2 |
| [805](#L805) | \*/ |
| [806](#L806) | function czr\_fn\_let\_to\_num( $v ) { |
| [807](#L807) | $l   = substr( $v, -1 ); |
| [808](#L808) | $ret = substr( $v, 0, -1 ); |
| [809](#L809) |  |
| [810](#L810) | switch ( strtoupper( $l ) ) { |
| [811](#L811) | case 'P': // fall-through |
| [812](#L812) | case 'T': // fall-through |
| [813](#L813) | case 'G': // fall-through |
| [814](#L814) | case 'M': // fall-through |
| [815](#L815) | case 'K': // fall-through |
| [816](#L816) | $ret \*= 1024; |
| [817](#L817) | break; |
| [818](#L818) | default: |
| [819](#L819) | break; |
| [820](#L820) | } |
| [821](#L821) |  |
| [822](#L822) | return $ret; |
| [823](#L823) | } |
| [824](#L824) |  |
| [825](#L825) | /\*\* |
| [826](#L826) | \* hook : admin\_print\_styles |
| [827](#L827) | \* fix the absolute positioning of the wp footer admin link in the welcome pages |
| [828](#L828) | \* @return void |
| [829](#L829) | \*/ |
| [830](#L830) | function czr\_fn\_fix\_wp\_footer\_link\_style() { |
| [831](#L831) | $screen = get\_current\_screen(); |
| [832](#L832) | if ( ! is\_object($screen) ) |
| [833](#L833) | return; |
| [834](#L834) | if ( 'appearance\_page\_welcome' != $screen-> id ) |
| [835](#L835) | return; |
| [836](#L836) | ?> |
| [837](#L837) | <style type="text/css" id="tc-fix-wp-footer-position"> |
| [838](#L838) | .wp-admin #wpfooter {bottom: inherit;} |
| [839](#L839) | </style> |
| [840](#L840) | <?php |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | //hook : current\_screen |
| [844](#L844) | function czr\_schedule\_welcome\_page\_actions() { |
| [845](#L845) | $screen = get\_current\_screen(); |
| [846](#L846) | if ( 'appearance\_page\_welcome' != $screen-> id ) |
| [847](#L847) | return; |
| [848](#L848) |  |
| [849](#L849) | add\_action( 'czr\_after\_welcome\_admin\_intro', array( $this, 'czr\_print\_hs\_doc\_content') ); |
| [850](#L850) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'czr\_enqueue\_hs\_assets' ) ); |
| [851](#L851) | } |
| [852](#L852) |  |
| [853](#L853) | //hook : admin\_enqueue\_scripts |
| [854](#L854) | function czr\_enqueue\_hs\_assets() { |
| [855](#L855) | $screen = get\_current\_screen(); |
| [856](#L856) | if ( 'appearance\_page\_welcome' != $screen-> id ) |
| [857](#L857) | return; |
| [858](#L858) | wp\_enqueue\_style( |
| [859](#L859) | 'czr-admin-hs-css', |
| [860](#L860) | sprintf('%1$sback/css/czr-hs-doc%2$s.css' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? '' : '.min' ), |
| [861](#L861) | array(), |
| [862](#L862) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER |
| [863](#L863) | ); |
| [864](#L864) | wp\_enqueue\_script( |
| [865](#L865) | 'czr-hs-js', |
| [866](#L866) | sprintf('%1$sback/js/czr-hs-doc%2$s.js' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? '' : '.min' ), |
| [867](#L867) | array( 'jquery', 'underscore' ), |
| [868](#L868) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER, |
| [869](#L869) | $in\_footer = false |
| [870](#L870) | ); |
| [871](#L871) |  |
| [872](#L872) | $script\_settings = array( |
| [873](#L873) | 'debug' => false, // Print debug logs or not |
| [874](#L874) | 'searchDelay' => 750, // Delay time in ms after a user stops typing and before search is performed |
| [875](#L875) | 'minLength' => 3, // Minimum number of characters required to trigger search |
| [876](#L876) | 'limit' => 25, // Max limit for # of results to show |
| [877](#L877) | 'text' => array( |
| [878](#L878) | //@translators : keep the strings inside brackets ( like {count} and {minLength} ) untranslated as it will be replaced by a number when parsed in javascript |
| [879](#L879) | 'result\_found' => \_\_('We found {count} article that may help:' , 'customizr'), |
| [880](#L880) | 'results\_found' => \_\_('We found {count} articles that may help:' , 'customizr'), |
| [881](#L881) | 'no\_results\_found' => \_\_('No results found&hellip;' , 'customizr'), |
| [882](#L882) | 'enter\_search' => \_\_('Please enter a search term.' , 'customizr'), |
| [883](#L883) | 'not\_long\_enough' => \_\_('Search must be at least {minLength} characters.' , 'customizr'), |
| [884](#L884) | 'error' => \_\_('There was an error fetching search results.' , 'customizr'), |
| [885](#L885) | ), |
| [886](#L886) | 'template' => array( |
| [887](#L887) | 'wrap\_class' => 'docs-search-wrap', |
| [888](#L888) | 'before' => '<ul class="docs-search-results">', |
| [889](#L889) | 'item' => sprintf( '<li class="article"><a href="{url}" title="%1$s" target="\_blank">{name}<span class="article--open-original" ></span></a><p class="article-preview">{preview} ... <a href="{url}" title="%1$s" target="\_blank">%2$s</a></p></li>', |
| [890](#L890) | \_\_( 'Read the full article', 'customizr' ), |
| [891](#L891) | \_\_( 'read more', 'customizr' ) |
| [892](#L892) | ), |
| [893](#L893) | 'after' => '</ul>', |
| [894](#L894) | 'results\_found' => '<span class="{css\_class}">{text}</span>', |
| [895](#L895) | ), |
| [896](#L896) | 'collections' => array(), // The collection IDs to search in |
| [897](#L897) |  |
| [898](#L898) | // Do not modify |
| [899](#L899) | '\_subdomain' => 'presscustomizr', |
| [900](#L900) | ); |
| [901](#L901) |  |
| [902](#L902) | wp\_localize\_script( 'czr-hs-js', 'CZRHSParams', $script\_settings ); |
| [903](#L903) | } |
| [904](#L904) |  |
| [905](#L905) |  |
| [906](#L906) | //hook : czr\_after\_welcome\_admin\_intro |
| [907](#L907) | function czr\_print\_hs\_doc\_content() { |
| [908](#L908) | ?> |
| [909](#L909) | <form enctype="multipart/form-data" method="post" class="frm-show-form " id="form\_m3j26q22"> |
| [910](#L910) | <div class="frm\_form\_fields "> |
| [911](#L911) | <fieldset> |
| [912](#L912) | <div id="frm\_field\_335\_container" class="frm\_form\_field form-field  frm\_top\_container helpscout-docs"> |
| [913](#L913) | <label for="field\_6woxqa" class="frm\_primary\_label"> |
| [914](#L914) | <h2><?php \_e( 'Search the knowledge base', 'customizr' ); ?></h2> |
| [915](#L915) | <h4 style="text-align:center;font-style: italic;font-weight: normal;"><?php \_e( 'In a few keywords, describe the information you are looking for.', 'customizr' ); ?></h4> |
| [916](#L916) | <span class="frm\_required"></span> |
| [917](#L917) | </label> |
| [918](#L918) | <input type="text" id="field\_6woxqa" name="item\_meta[335]" value="" placeholder="<?php \_e( 'Ex. Logo upload', 'customizr' ) ;?>" autocomplete="off"> |
| [919](#L919) |  |
| [920](#L920) | <div class="frm\_description"><?php \_e('<u>Search tips</u> : If you get too many results, try to narrow down your search by prefixing it with "customizr" for example. If there are no results, try different keywords and / or spelling variations', 'customizr' ); ?> </div> |
| [921](#L921) | </div> |
| [922](#L922) | </fieldset> |
| [923](#L923) | </div> |
| [924](#L924) | </form> |
| [925](#L925) | <?php |
| [926](#L926) | } |
| [927](#L927) |  |
| [928](#L928) | }//end of class |
| [929](#L929) | endif; |
| [930](#L930) |  |
| [931](#L931) | ?><?php |
| [932](#L932) | /\*\* |
| [933](#L933) | \* Posts, pages and attachment actions and filters |
| [934](#L934) | \* |
| [935](#L935) | \*/ |
| [936](#L936) | if ( ! class\_exists( 'CZR\_meta\_boxes' ) ) : |
| [937](#L937) | class CZR\_meta\_boxes { |
| [938](#L938) | static $instance; |
| [939](#L939) |  |
| [940](#L940) | public $mixed\_meta\_boxes\_map; |
| [941](#L941) | public $post\_meta\_boxes\_map; |
| [942](#L942) |  |
| [943](#L943) | public $\_minify\_resources; |
| [944](#L944) | public $\_resouces\_version; |
| [945](#L945) |  |
| [946](#L946) |  |
| [947](#L947) | function \_\_construct () { |
| [948](#L948) | self::$instance =& $this; |
| [949](#L949) |  |
| [950](#L950) | $this->\_resouces\_version  = CZR\_DEBUG\_MODE || CZR\_DEV\_MODE ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER; |
| [951](#L951) |  |
| [952](#L952) | $this->\_minify\_resources  = CZR\_DEBUG\_MODE || CZR\_DEV\_MODE ? false : true ; |
| [953](#L953) |  |
| [954](#L954) |  |
| [955](#L955) | //mixed ( layout, slider ) displayed in various types of posts |
| [956](#L956) | add\_action( 'add\_meta\_boxes'                     , array( $this , 'czr\_fn\_mixed\_meta\_boxes' )) ; |
| [957](#L957) |  |
| [958](#L958) | //post ( post formats ) displayed only in post types |
| [959](#L959) | add\_action( 'add\_meta\_boxes\_post'                , array( $this , 'czr\_fn\_post\_formats\_meta\_boxes' )) ; |
| [960](#L960) |  |
| [961](#L961) | //attachment |
| [962](#L962) | add\_action( 'add\_meta\_boxes\_attachment'          , array( $this , 'czr\_fn\_attachment\_meta\_box' )); |
| [963](#L963) |  |
| [964](#L964) |  |
| [965](#L965) | add\_action( '\_\_post\_slider\_infos'                , array( $this , 'czr\_fn\_get\_post\_slider\_infos' )); |
| [966](#L966) |  |
| [967](#L967) | add\_action( 'save\_post'                          , array( $this , 'czr\_fn\_post\_fields\_save' ) ); |
| [968](#L968) |  |
| [969](#L969) | add\_action( '\_\_attachment\_slider\_infos'          , array( $this , 'czr\_fn\_get\_attachment\_slider\_infos' )); |
| [970](#L970) |  |
| [971](#L971) | add\_action( 'edit\_attachment'                    , array( $this , 'czr\_fn\_slide\_save' )); |
| [972](#L972) | add\_action( 'edit\_attachment'                    , array( $this , 'czr\_fn\_post\_fields\_save' )); |
| [973](#L973) |  |
| [974](#L974) | add\_action( '\_\_show\_slides'                      , array( $this , 'czr\_fn\_show\_slides' ), 10, 2); |
| [975](#L975) |  |
| [976](#L976) | add\_action( 'wp\_ajax\_slider\_action'              , array( $this , 'czr\_fn\_slider\_cb' )); |
| [977](#L977) |  |
| [978](#L978) | //enqueue slider scripts when needed (will be in the footer) |
| [979](#L979) | //czr\_slider\_metabox\_added is fired when |
| [980](#L980) | //a) the slider attachment metabox is printed: czr\_fn\_attachment\_meta\_box |
| [981](#L981) | //b) the slider post metabox is printed: czr\_fn\_post\_slider\_box |
| [982](#L982) | add\_action( 'czr\_slider\_metabox\_added'            , array( $this,  'czr\_fn\_slider\_admin\_scripts') ); |
| [983](#L983) |  |
| [984](#L984) | //enqueue post format script |
| [985](#L985) | add\_action( 'czr\_post\_formats\_metabox\_added'      , array( $this , 'czr\_fn\_post\_formats\_admin\_scripts' ) ); |
| [986](#L986) |  |
| [987](#L987) |  |
| [988](#L988) | /\*\* |
| [989](#L989) | \* checks if WP version strictly < 3.5 |
| [990](#L990) | \* before 3.5, attachments were not managed as posts. But two filter hooks can are very useful |
| [991](#L991) | \* @package Customizr |
| [992](#L992) | \* @since Customizr 2.0 |
| [993](#L993) | \*/ |
| [994](#L994) | global $wp\_version; |
| [995](#L995) | if (version\_compare( $wp\_version, '3.5' , '<' ) ) { |
| [996](#L996) | add\_filter( 'attachment\_fields\_to\_edit'          , array( $this , 'czr\_fn\_attachment\_filter' ), 11, 2 ); |
| [997](#L997) | add\_filter( 'attachment\_fields\_to\_save'          , array( $this , 'czr\_fn\_attachment\_save\_filter' ), 11, 2 ); |
| [998](#L998) | } |
| [999](#L999) |  |
| [1000](#L1000) | }//end of \_\_construct |
| [1001](#L1001) |  |
| [1002](#L1002) |  |
| [1003](#L1003) | function czr\_fn\_get\_mixed\_meta\_boxes\_map( $\_cache = true ) { |
| [1004](#L1004) | $\_meta\_boxes\_map = $this->mixed\_meta\_boxes\_map; |
| [1005](#L1005) |  |
| [1006](#L1006) | if ( !isset($this->mixed\_meta\_boxes\_map) ) { |
| [1007](#L1007) |  |
| [1008](#L1008) | $\_meta\_boxes\_map = array ( |
| [1009](#L1009) | //metabox      => disallowed screens |
| [1010](#L1010) | 'layout\_section' => array(), |
| [1011](#L1011) | //The slider section (slider in posts/pages) metabox MUST NOT be added in attachments |
| [1012](#L1012) | 'slider\_section' => array( 'attachment' ) |
| [1013](#L1013) | ); |
| [1014](#L1014) |  |
| [1015](#L1015) | if ( $\_cache ) |
| [1016](#L1016) | $this->mixed\_meta\_boxes\_map = $\_meta\_boxes\_map; |
| [1017](#L1017) |  |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | return apply\_filters( 'czr\_mixed\_meta\_boxes\_map', $\_meta\_boxes\_map ); |
| [1021](#L1021) | } |
| [1022](#L1022) |  |
| [1023](#L1023) |  |
| [1024](#L1024) | function czr\_fn\_get\_post\_meta\_boxes\_map( $\_cache = true ) { |
| [1025](#L1025) | $\_meta\_boxes\_map = $this->post\_meta\_boxes\_map; |
| [1026](#L1026) |  |
| [1027](#L1027) | if ( !isset($this->post\_meta\_boxes\_map) ) { |
| [1028](#L1028) |  |
| [1029](#L1029) | $\_meta\_boxes\_map = array ( |
| [1030](#L1030) | //Post formats |
| [1031](#L1031) | 'audio\_section', |
| [1032](#L1032) | 'video\_section', |
| [1033](#L1033) | 'quote\_section', |
| [1034](#L1034) | 'link\_section' |
| [1035](#L1035) | ); |
| [1036](#L1036) |  |
| [1037](#L1037) | if ( $\_cache ) |
| [1038](#L1038) | $this->post\_meta\_boxes\_map = $\_meta\_boxes\_map; |
| [1039](#L1039) |  |
| [1040](#L1040) | } |
| [1041](#L1041) |  |
| [1042](#L1042) | return apply\_filters( 'czr\_meta\_boxes\_map', $\_meta\_boxes\_map ); |
| [1043](#L1043) | } |
| [1044](#L1044) |  |
| [1045](#L1045) |  |
| [1046](#L1046) |  |
| [1047](#L1047) | /\* |
| [1048](#L1048) | ---------------------------------------------------------------- |
| [1049](#L1049) | -------- DEFINE POST/PAGE LAYOUT AND SLIDER META BOXES --------- |
| [1050](#L1050) | ---------------------------------------------------------------- |
| [1051](#L1051) | \*/ |
| [1052](#L1052) | function czr\_add\_metabox( $meta\_box\_key, $screen ) { |
| [1053](#L1053) |  |
| [1054](#L1054) | if ( ! method\_exists( $this , "czr\_fn\_{$meta\_box\_key}\_metabox" ) ) |
| [1055](#L1055) | return; |
| [1056](#L1056) |  |
| [1057](#L1057) | call\_user\_func\_array( 'add\_meta\_box', |
| [1058](#L1058) | $this->czr\_fn\_build\_metabox\_arguments ( |
| [1059](#L1059) | "{$meta\_box\_key}id", |
| [1060](#L1060) | call\_user\_func( array( $this, "czr\_fn\_{$meta\_box\_key}\_metabox" ), $screen ) |
| [1061](#L1061) | ) |
| [1062](#L1062) | ); |
| [1063](#L1063) |  |
| [1064](#L1064) | } |
| [1065](#L1065) |  |
| [1066](#L1066) | /\*\* |
| [1067](#L1067) | \* Adds layout and slider metaboxes to pages and posts |
| [1068](#L1068) | \* hook : add\_meta\_boxes |
| [1069](#L1069) | \* @package Customizr |
| [1070](#L1070) | \* @since Customizr 1.0 |
| [1071](#L1071) | \*/ |
| [1072](#L1072) | function czr\_fn\_mixed\_meta\_boxes( $id ) {//id, title, callback, post\_type, context, priority, callback\_args |
| [1073](#L1073) | /\*\*\* |
| [1074](#L1074) | Determines which screens we display the box |
| [1075](#L1075) | \*\*/ |
| [1076](#L1076) | //1 - retrieves the custom post types |
| [1077](#L1077) | $args                = array( |
| [1078](#L1078) | //we want our metaboxes added only to those custom post types that can be seen on front |
| [1079](#L1079) | //the parameter 'publicly\_queryable' should ensure this. |
| [1080](#L1080) | //Example: |
| [1081](#L1081) | // - In WooCommerce product post type our metaboxes are visibile while they're not in WooCommerce orders/coupons ... |
| [1082](#L1082) | //   that cannot be seen in front. |
| [1083](#L1083) | // - They're visible in Tribe Events Calendar's event post type |
| [1084](#L1084) | // - They're not visible in ACF(-pro) screens |
| [1085](#L1085) | // - They're not visbile in Ultime Responsive image slider post type |
| [1086](#L1086) | 'publicly\_queryable' => true, |
| [1087](#L1087) | '\_builtin'           => false |
| [1088](#L1088) | ); |
| [1089](#L1089) |  |
| [1090](#L1090) | $custom\_post\_types    = apply\_filters( 'czr\_post\_metaboxes\_cpt', get\_post\_types($args) ); |
| [1091](#L1091) |  |
| [1092](#L1092) | //2 - Merging with the builtin post types, pages and posts |
| [1093](#L1093) | $builtin\_post\_types   = array( |
| [1094](#L1094) | 'page' => 'page', |
| [1095](#L1095) | 'post' => 'post', |
| [1096](#L1096) | 'attachment' => 'attachment' |
| [1097](#L1097) | ); |
| [1098](#L1098) |  |
| [1099](#L1099) | $screens                   = array\_merge( $custom\_post\_types, $builtin\_post\_types ); |
| [1100](#L1100) |  |
| [1101](#L1101) | $mixed\_meta\_boxes          = $this->czr\_fn\_get\_mixed\_meta\_boxes\_map(); |
| [1102](#L1102) |  |
| [1103](#L1103) |  |
| [1104](#L1104) | //3- Adding the meta-boxes to those screens |
| [1105](#L1105) | foreach ( $screens as $key => $screen) { |
| [1106](#L1106) | foreach ( $mixed\_meta\_boxes as $meta\_box\_key => $disallowed\_screens\_array ) { |
| [1107](#L1107) | if ( in\_array( $screen, $disallowed\_screens\_array ) ) { |
| [1108](#L1108) | continue; |
| [1109](#L1109) | } |
| [1110](#L1110) | $this->czr\_add\_metabox( $meta\_box\_key, $screen ); |
| [1111](#L1111) | $\_metabox\_added       = true; |
| [1112](#L1112) | }//end foreach |
| [1113](#L1113) |  |
| [1114](#L1114) | }//end foreach |
| [1115](#L1115) |  |
| [1116](#L1116) | } |
| [1117](#L1117) |  |
| [1118](#L1118) | //hook : add\_meta\_boxes\_post |
| [1119](#L1119) | function czr\_fn\_post\_formats\_meta\_boxes( $post ) { |
| [1120](#L1120) | //if not czr4 return |
| [1121](#L1121) | if ( ! ( defined( 'CZR\_IS\_MODERN\_STYLE' ) && CZR\_IS\_MODERN\_STYLE ) ) |
| [1122](#L1122) | return; |
| [1123](#L1123) |  |
| [1124](#L1124) | $post\_meta\_boxes          = $this->czr\_fn\_get\_post\_meta\_boxes\_map(); |
| [1125](#L1125) |  |
| [1126](#L1126) | $\_metabox\_added           = false; |
| [1127](#L1127) |  |
| [1128](#L1128) | foreach ( $post\_meta\_boxes as $meta\_box\_key ) { |
| [1129](#L1129) | $this->czr\_add\_metabox( $meta\_box\_key, 'post' ); |
| [1130](#L1130) | $\_metabox\_added        = true; |
| [1131](#L1131) | }//end foreach |
| [1132](#L1132) |  |
| [1133](#L1133) | if ( $\_metabox\_added ) |
| [1134](#L1134) | do\_action( 'czr\_post\_formats\_metabox\_added', $post ); |
| [1135](#L1135) |  |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) |  |
| [1139](#L1139) |  |
| [1140](#L1140) |  |
| [1141](#L1141) | //helper |
| [1142](#L1142) | function czr\_fn\_build\_metabox\_arguments( $id, $args ) { |
| [1143](#L1143) | //order matters! |
| [1144](#L1144) | //'cause we use call\_user\_func\_array to pass args with a certain order to add\_metabox |
| [1145](#L1145) | $defaults = array( |
| [1146](#L1146) | 'id'            => $id, |
| [1147](#L1147) | 'title'         => '', |
| [1148](#L1148) | 'callback'       => null, |
| [1149](#L1149) | 'screen'         => null, |
| [1150](#L1150) | 'context'        => 'advanced', |
| [1151](#L1151) | 'priority'       => 'high', |
| [1152](#L1152) | 'callback\_args'  => null, |
| [1153](#L1153) | ); |
| [1154](#L1154) |  |
| [1155](#L1155) | $args = wp\_parse\_args( $args, $defaults ); |
| [1156](#L1156) |  |
| [1157](#L1157) | //Filtering |
| [1158](#L1158) | $args[ 'screen'  ]    = apply\_filters( "czr\_fn\_{$id}\_metabox\_screen", apply\_filters( 'czr\_fn\_metaboxes\_screen', $args['screen'], $args['id'] ), $args[ 'screen' ] ); |
| [1159](#L1159) | $args[ 'context' ]    = apply\_filters( "czr\_fn\_{$id}\_metabox\_context", apply\_filters( 'czr\_fn\_metaboxes\_context', $args['context'], $args['id'] ), $args[ 'context' ] ); |
| [1160](#L1160) | $args[ 'priority'  ]  = apply\_filters( "czr\_fn\_{$id}\_metabox\_priority", apply\_filters( 'czr\_fn\_metaboxes\_priority', $args['priority'], $args['id'] ), $args[ 'priority' ] ); |
| [1161](#L1161) |  |
| [1162](#L1162) | return $args; |
| [1163](#L1163) | } |
| [1164](#L1164) |  |
| [1165](#L1165) |  |
| [1166](#L1166) |  |
| [1167](#L1167) |  |
| [1168](#L1168) |  |
| [1169](#L1169) | function czr\_fn\_layout\_section\_metabox( $screen ) { |
| [1170](#L1170) |  |
| [1171](#L1171) | return array( |
| [1172](#L1172) | 'title'    => \_\_( 'Layout Options' , 'customizr' ), |
| [1173](#L1173) | 'callback' => array( $this , 'czr\_fn\_post\_layout\_box' ), |
| [1174](#L1174) | 'screen'   => $screen, |
| [1175](#L1175) | 'context'  => in\_array( $screen, array( 'page', 'post', 'attachment' ) ) ? 'side' : 'normal',//displays meta box below editor for custom post types |
| [1176](#L1176) | 'priority' => 'high', |
| [1177](#L1177) | ); |
| [1178](#L1178) |  |
| [1179](#L1179) | } |
| [1180](#L1180) |  |
| [1181](#L1181) |  |
| [1182](#L1182) | function czr\_fn\_slider\_section\_metabox( $screen ) { |
| [1183](#L1183) |  |
| [1184](#L1184) | return array( |
| [1185](#L1185) | 'title'    => \_\_( 'Slider Options' , 'customizr' ), |
| [1186](#L1186) | 'callback' => array( $this , 'czr\_fn\_post\_slider\_box' ), |
| [1187](#L1187) | 'screen'   => $screen, |
| [1188](#L1188) | 'context'  => 'normal',//displays meta box below editor for custom post types |
| [1189](#L1189) | 'priority' => 'high' |
| [1190](#L1190) | ); |
| [1191](#L1191) |  |
| [1192](#L1192) | } |
| [1193](#L1193) |  |
| [1194](#L1194) | function czr\_fn\_link\_section\_metabox( $screen ) { |
| [1195](#L1195) |  |
| [1196](#L1196) | return array( |
| [1197](#L1197) | 'title'    => \_\_( 'Format: link' , 'customizr' ), |
| [1198](#L1198) | 'callback' => array( $this , 'czr\_fn\_post\_format\_link\_box' ), |
| [1199](#L1199) | 'screen'   => 'post', |
| [1200](#L1200) | 'context'  => 'normal',//displays meta box below editor for custom post types |
| [1201](#L1201) | 'priority' => 'high' |
| [1202](#L1202) | ); |
| [1203](#L1203) |  |
| [1204](#L1204) | } |
| [1205](#L1205) |  |
| [1206](#L1206) | function czr\_fn\_quote\_section\_metabox( $screen ) { |
| [1207](#L1207) |  |
| [1208](#L1208) | return array( |
| [1209](#L1209) | 'title'    => \_\_( 'Format: quote' , 'customizr' ), |
| [1210](#L1210) | 'callback' => array( $this , 'czr\_fn\_post\_format\_quote\_box' ), |
| [1211](#L1211) | 'screen'   => 'post', |
| [1212](#L1212) | 'context'  => 'normal',//displays meta box below editor for custom post types |
| [1213](#L1213) | 'priority' => 'high' |
| [1214](#L1214) | ); |
| [1215](#L1215) |  |
| [1216](#L1216) | } |
| [1217](#L1217) |  |
| [1218](#L1218) | function czr\_fn\_video\_section\_metabox( $screen ) { |
| [1219](#L1219) |  |
| [1220](#L1220) | return array( |
| [1221](#L1221) | 'title'    => \_\_( 'Format: video' , 'customizr' ), |
| [1222](#L1222) | 'callback' => array( $this , 'czr\_fn\_post\_format\_video\_box' ), |
| [1223](#L1223) | 'screen'   => 'post', |
| [1224](#L1224) | 'context'  => 'normal',//displays meta box below editor for custom post types |
| [1225](#L1225) | 'priority' => 'high' |
| [1226](#L1226) | ); |
| [1227](#L1227) |  |
| [1228](#L1228) | } |
| [1229](#L1229) |  |
| [1230](#L1230) | function czr\_fn\_audio\_section\_metabox( $screen ) { |
| [1231](#L1231) |  |
| [1232](#L1232) | return array( |
| [1233](#L1233) | 'title'    => \_\_( 'Format: audio' , 'customizr' ), |
| [1234](#L1234) | 'callback' => array( $this , 'czr\_fn\_post\_format\_audio\_box' ), |
| [1235](#L1235) | 'screen'   => 'post', |
| [1236](#L1236) | 'context'  => 'normal',//displays meta box below editor for custom post types |
| [1237](#L1237) | 'priority' => 'high' |
| [1238](#L1238) | ); |
| [1239](#L1239) |  |
| [1240](#L1240) | } |
| [1241](#L1241) |  |
| [1242](#L1242) |  |
| [1243](#L1243) |  |
| [1244](#L1244) | //Build metabox html |
| [1245](#L1245) |  |
| [1246](#L1246) |  |
| [1247](#L1247) | function czr\_fn\_post\_format\_link\_box( $post, $args ) { |
| [1248](#L1248) |  |
| [1249](#L1249) | // Use nonce for verification |
| [1250](#L1250) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'format\_link\_noncename' ); |
| [1251](#L1251) |  |
| [1252](#L1252) | // The actual field for data entry |
| [1253](#L1253) | $link       = get\_post\_meta( $post->ID, $key = 'czr\_link\_meta' , $single = true ); |
| [1254](#L1254) |  |
| [1255](#L1255) | $link\_title = esc\_attr( isset( $link['link\_title'] ) ? $link['link\_title'] : '' ); |
| [1256](#L1256) | $link\_url   = esc\_url( isset( $link['link\_url'] ) ? $link['link\_url'] : '' ); |
| [1257](#L1257) |  |
| [1258](#L1258) |  |
| [1259](#L1259) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array( |
| [1260](#L1260) | 'input\_name'  => 'czr\_link\_title', |
| [1261](#L1261) | 'custom\_args' => 'style="max-width:50%"', |
| [1262](#L1262) | 'title'       => array( |
| [1263](#L1263) |  |
| [1264](#L1264) | 'title\_text'  => \_\_( 'Link title', 'customizr'), |
| [1265](#L1265) | 'title\_tag'   => 'h3', |
| [1266](#L1266) |  |
| [1267](#L1267) | ), |
| [1268](#L1268) | 'content\_before' => CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1269](#L1269) | 'title\_text'  => \_\_( 'Enter the title', 'customizr'), |
| [1270](#L1270) | 'title\_tag'   => 'h4', |
| [1271](#L1271) | 'echo'        => false, |
| [1272](#L1272) | 'boxed'       => false |
| [1273](#L1273) | ) |
| [1274](#L1274) | ), |
| [1275](#L1275) | 'input\_value' => $link\_title |
| [1276](#L1276) |  |
| [1277](#L1277) | )); |
| [1278](#L1278) |  |
| [1279](#L1279) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array( |
| [1280](#L1280) |  |
| [1281](#L1281) | 'input\_name'  => 'czr\_link\_url', |
| [1282](#L1282) | 'input\_type'  => 'url', |
| [1283](#L1283) | 'custom\_args' => 'style="max-width:50%"', |
| [1284](#L1284) | 'title'       => array( |
| [1285](#L1285) | 'title\_text'  => \_\_( 'Link URL', 'customizr'), |
| [1286](#L1286) | 'title\_tag'   => 'h3', |
| [1287](#L1287) | ), |
| [1288](#L1288) |  |
| [1289](#L1289) | 'content\_before' => CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1290](#L1290) | 'title\_text'  => \_\_( 'Enter the URL', 'customizr'), |
| [1291](#L1291) | 'title\_tag'   => 'h4', |
| [1292](#L1292) | 'echo'        => false, |
| [1293](#L1293) | 'boxed'       => false |
| [1294](#L1294) | ) |
| [1295](#L1295) | ), |
| [1296](#L1296) | 'input\_value' => $link\_url |
| [1297](#L1297) |  |
| [1298](#L1298) | )); |
| [1299](#L1299) |  |
| [1300](#L1300) | } |
| [1301](#L1301) |  |
| [1302](#L1302) | function czr\_fn\_post\_format\_quote\_box( $post, $args ) { |
| [1303](#L1303) |  |
| [1304](#L1304) | // Use nonce for verification |
| [1305](#L1305) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'format\_quote\_noncename' ); |
| [1306](#L1306) |  |
| [1307](#L1307) | // The actual field for data entry |
| [1308](#L1308) | $quote        = get\_post\_meta( $post->ID, $key = 'czr\_quote\_meta' , $single = true ); |
| [1309](#L1309) |  |
| [1310](#L1310) | $quote\_text   = esc\_attr( isset( $quote['quote\_text'] ) ? $quote['quote\_text'] : '' ); |
| [1311](#L1311) | $quote\_author = esc\_attr( isset( $quote['quote\_author'] ) ? $quote['quote\_author'] : '' ); |
| [1312](#L1312) |  |
| [1313](#L1313) | CZR\_meta\_boxes::czr\_fn\_textarea\_view( array( |
| [1314](#L1314) |  |
| [1315](#L1315) | 'input\_name'  =>  'czr\_quote\_text', |
| [1316](#L1316) | 'title'       =>  array( |
| [1317](#L1317) | 'title\_text'  => \_\_( 'Quote text', 'customizr'), |
| [1318](#L1318) | 'title\_tag'   => 'h3', |
| [1319](#L1319) | ), |
| [1320](#L1320) | 'custom\_args'    => 'style="max-width:50%"', |
| [1321](#L1321) | 'content\_before' =>  CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1322](#L1322) | 'title\_text'  => \_\_( 'Enter the text', 'customizr'), |
| [1323](#L1323) | 'title\_tag'   => 'h4', |
| [1324](#L1324) | 'echo'        => false, |
| [1325](#L1325) | 'boxed'       => false |
| [1326](#L1326) | ) |
| [1327](#L1327) | ), |
| [1328](#L1328) |  |
| [1329](#L1329) | 'input\_value' => $quote\_text |
| [1330](#L1330) |  |
| [1331](#L1331) | )); |
| [1332](#L1332) |  |
| [1333](#L1333) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array( |
| [1334](#L1334) |  |
| [1335](#L1335) | 'input\_name'  =>  'czr\_quote\_author', |
| [1336](#L1336) | 'title'       =>  array( |
| [1337](#L1337) | 'title\_text'  => \_\_( 'Quote author', 'customizr'), |
| [1338](#L1338) | 'title\_tag'   => 'h3', |
| [1339](#L1339) | ), |
| [1340](#L1340) |  |
| [1341](#L1341) | 'custom\_args' => 'style="max-width:50%"', |
| [1342](#L1342) | 'content\_before' => CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1343](#L1343) | 'title\_text'  => \_\_( 'Enter the author', 'customizr'), |
| [1344](#L1344) | 'title\_tag'   => 'h4', |
| [1345](#L1345) | 'echo'        => false, |
| [1346](#L1346) | 'boxed'       => false |
| [1347](#L1347) | ) |
| [1348](#L1348) | ), |
| [1349](#L1349) |  |
| [1350](#L1350) | 'input\_value' => $quote\_author |
| [1351](#L1351) | )); |
| [1352](#L1352) | } |
| [1353](#L1353) |  |
| [1354](#L1354) |  |
| [1355](#L1355) | function czr\_fn\_post\_format\_audio\_box( $post, $args ) { |
| [1356](#L1356) |  |
| [1357](#L1357) | // Use nonce for verification |
| [1358](#L1358) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'format\_audio\_noncename' ); |
| [1359](#L1359) |  |
| [1360](#L1360) | // The actual field for data entry |
| [1361](#L1361) | $audio        = get\_post\_meta( $post->ID, $key = 'czr\_audio\_meta' , $single = true ); |
| [1362](#L1362) |  |
| [1363](#L1363) | $audio\_url   = esc\_url( isset( $audio['audio\_url'] ) ? $audio['audio\_url'] : '' ); |
| [1364](#L1364) |  |
| [1365](#L1365) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array( |
| [1366](#L1366) |  |
| [1367](#L1367) | 'input\_name'  => 'czr\_audio\_url', |
| [1368](#L1368) | 'custom\_args' => 'style="max-width:50%"', |
| [1369](#L1369) | 'title'       => array( |
| [1370](#L1370) | 'title\_text'  => \_\_( 'Audio url', 'customizr'), |
| [1371](#L1371) | 'title\_tag'   => 'h3', |
| [1372](#L1372) | ), |
| [1373](#L1373) | 'content\_before' => CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1374](#L1374) | 'title\_text'  => \_\_( 'Enter the audio url', 'customizr'), |
| [1375](#L1375) | 'title\_tag'   => 'h4', |
| [1376](#L1376) | 'echo'        => false, |
| [1377](#L1377) | 'boxed'       => false |
| [1378](#L1378) | ) |
| [1379](#L1379) | ), |
| [1380](#L1380) | 'input\_value' => $audio\_url, |
| [1381](#L1381) | 'input\_type'  => 'url' |
| [1382](#L1382) |  |
| [1383](#L1383) | )); |
| [1384](#L1384) |  |
| [1385](#L1385) | } |
| [1386](#L1386) |  |
| [1387](#L1387) |  |
| [1388](#L1388) |  |
| [1389](#L1389) | function czr\_fn\_post\_format\_video\_box( $post, $args ) { |
| [1390](#L1390) |  |
| [1391](#L1391) | // Use nonce for verification |
| [1392](#L1392) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'format\_video\_noncename' ); |
| [1393](#L1393) |  |
| [1394](#L1394) | // The actual field for data entry |
| [1395](#L1395) | $video        = get\_post\_meta( $post->ID, $key = 'czr\_video\_meta' , $single = true ); |
| [1396](#L1396) |  |
| [1397](#L1397) | $video\_url   = esc\_url( isset( $video['video\_url'] ) ? $video['video\_url'] : '' ); |
| [1398](#L1398) |  |
| [1399](#L1399) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array( |
| [1400](#L1400) |  |
| [1401](#L1401) | 'input\_name'  => 'czr\_video\_url', |
| [1402](#L1402) | 'custom\_args' => 'style="max-width:50%"', |
| [1403](#L1403) | 'title'       => array( |
| [1404](#L1404) | 'title\_text'  => \_\_( 'Video url', 'customizr'), |
| [1405](#L1405) | 'title\_tag'   => 'h3', |
| [1406](#L1406) | ), |
| [1407](#L1407) | 'content\_before' => CZR\_meta\_boxes::czr\_fn\_title\_view( array( |
| [1408](#L1408) | 'title\_text'  => \_\_( 'Enter the video url', 'customizr'), |
| [1409](#L1409) | 'title\_tag'   => 'h4', |
| [1410](#L1410) | 'echo'        => false, |
| [1411](#L1411) | 'boxed'       => false |
| [1412](#L1412) | ) |
| [1413](#L1413) | ), |
| [1414](#L1414) | 'input\_value' => $video\_url, |
| [1415](#L1415) | 'input\_type'  => 'url' |
| [1416](#L1416) |  |
| [1417](#L1417) | )); |
| [1418](#L1418) |  |
| [1419](#L1419) | } |
| [1420](#L1420) |  |
| [1421](#L1421) |  |
| [1422](#L1422) |  |
| [1423](#L1423) |  |
| [1424](#L1424) | /\*\* |
| [1425](#L1425) | \* Prints the box content |
| [1426](#L1426) | \* @package Customizr |
| [1427](#L1427) | \* @since Customizr 1.0 |
| [1428](#L1428) | \*/ |
| [1429](#L1429) | function czr\_fn\_post\_layout\_box( $post ) { |
| [1430](#L1430) | // Use nonce for verification |
| [1431](#L1431) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'post\_layout\_noncename' ); |
| [1432](#L1432) |  |
| [1433](#L1433) | // The actual fields for data entry |
| [1434](#L1434) | // Use get\_post\_meta to retrieve an existing value from the database and use the value for the form |
| [1435](#L1435) | //Layout name setup |
| [1436](#L1436) | $layout\_id           = 'layout\_field'; |
| [1437](#L1437) |  |
| [1438](#L1438) | $layout\_value         = esc\_attr(get\_post\_meta( $post->ID, $key = 'layout\_key' , $single = true )); |
| [1439](#L1439) |  |
| [1440](#L1440) | //Generates layouts select list array |
| [1441](#L1441) | $layouts                    = array(); |
| [1442](#L1442) | $global\_layout              = apply\_filters( 'tc\_global\_layout' , CZR\_init::$instance->global\_layout ); |
| [1443](#L1443) | foreach ( $global\_layout as $key => $value ) { |
| [1444](#L1444) | $layouts[$key]            = call\_user\_func( '\_\_' , $value['metabox'] , 'customizr' ); |
| [1445](#L1445) | } |
| [1446](#L1446) |  |
| [1447](#L1447) | //by default we apply the global default layout |
| [1448](#L1448) | $tc\_sidebar\_default\_context\_layout  = esc\_attr( czr\_fn\_opt( 'page' == $post->post\_type ? 'tc\_sidebar\_page\_layout' : 'tc\_sidebar\_post\_layout' ) ); |
| [1449](#L1449) |  |
| [1450](#L1450) |  |
| [1451](#L1451) | ?> |
| [1452](#L1452) | <div class="meta-box-item-content"> |
| [1453](#L1453) | <?php if( $layout\_value == null) : ?> |
| [1454](#L1454) | <p><?php printf(\_\_( 'Default %1$s layout is set to : %2$s' , 'customizr' ), 'page' == $post->post\_type ? \_\_( 'pages' , 'customizr' ):\_\_( 'posts' , 'customizr' ), '<strong>'.$layouts[$tc\_sidebar\_default\_context\_layout].'</strong>' ) ?></p> |
| [1455](#L1455) | <?php endif; ?> |
| [1456](#L1456) |  |
| [1457](#L1457) | <i><?php printf(\_\_( 'You can define a specific layout for %1$s by using the pre-defined left and right sidebars. The default layouts can be defined in the WordPress customizer screen %2$s.<br />' , 'customizr' ), |
| [1458](#L1458) | $post->post\_type == 'page' ? \_\_( 'this page' , 'customizr' ):\_\_( 'this post' , 'customizr' ), |
| [1459](#L1459) | '<a href="'.admin\_url( 'customize.php' ).'" target="\_blank">'.\_\_( 'here' , 'customizr' ).'</a>' |
| [1460](#L1460) | ); ?> |
| [1461](#L1461) | </i> |
| [1462](#L1462) | <h4><?php printf(\_\_( 'Select a specific layout for %1$s' , 'customizr' ), |
| [1463](#L1463) | $post->post\_type == 'page' ? \_\_( 'this page' , 'customizr' ):\_\_( 'this post' , 'customizr' )); ?></h4> |
| [1464](#L1464) | <select name="<?php echo $layout\_id; ?>" id="<?php echo $layout\_id; ?>"> |
| [1465](#L1465) | <?php //no layout selected ?> |
| [1466](#L1466) | <option value="" <?php selected( $layout\_value, $current = null, $echo = true ) ?>> <?php printf(\_\_( 'Default layout %1s' , 'customizr' ), |
| [1467](#L1467) | '( '.$layouts[$tc\_sidebar\_default\_context\_layout].' )' |
| [1468](#L1468) | ); |
| [1469](#L1469) | ?></option> |
| [1470](#L1470) | <?php foreach( $layouts as $key => $l) : ?> |
| [1471](#L1471) | <option value="<?php echo $key; ?>" <?php selected( $layout\_value, $current = $key, $echo = true ) ?>><?php echo $l; ?></option> |
| [1472](#L1472) | <?php endforeach; ?> |
| [1473](#L1473) | </select> |
| [1474](#L1474) |  |
| [1475](#L1475) | </div> |
| [1476](#L1476) |  |
| [1477](#L1477) | <?php |
| [1478](#L1478) |  |
| [1479](#L1479) | do\_action( 'czr\_post\_metabox\_added', $post ); |
| [1480](#L1480) | do\_action( 'czr\_post\_layout\_metabox\_added', $post ); |
| [1481](#L1481) | } |
| [1482](#L1482) |  |
| [1483](#L1483) |  |
| [1484](#L1484) |  |
| [1485](#L1485) |  |
| [1486](#L1486) |  |
| [1487](#L1487) |  |
| [1488](#L1488) | /\* |
| [1489](#L1489) | ---------------------------------------------------------------- |
| [1490](#L1490) | ------------------ POST/PAGE SLIDER BOX ------------------------ |
| [1491](#L1491) | ---------------------------------------------------------------- |
| [1492](#L1492) | \*/ |
| [1493](#L1493) |  |
| [1494](#L1494) |  |
| [1495](#L1495) | /\*\* |
| [1496](#L1496) | \* Prints the slider box content |
| [1497](#L1497) | \* @package Customizr |
| [1498](#L1498) | \* @since Customizr 2.0 |
| [1499](#L1499) | \*/ |
| [1500](#L1500) | function czr\_fn\_post\_slider\_box( $post ) { |
| [1501](#L1501) | // Use nonce for verification |
| [1502](#L1502) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'post\_slider\_noncename' ); |
| [1503](#L1503) |  |
| [1504](#L1504) | // The actual fields for data entry |
| [1505](#L1505) | //title check field setup |
| [1506](#L1506) | $post\_slider\_check\_id       = 'post\_slider\_check\_field'; |
| [1507](#L1507) | $post\_slider\_check\_value    = esc\_attr(get\_post\_meta( $post->ID, $key = 'post\_slider\_check\_key' , $single = true )); |
| [1508](#L1508) |  |
| [1509](#L1509) | ?> |
| [1510](#L1510) | <input name="tc\_post\_id" id="tc\_post\_id" type="hidden" value="<?php echo $post-> ID ?>"/> |
| [1511](#L1511) | <div class="meta-box-item-title"> |
| [1512](#L1512) | <h4><label for="<?php echo $post\_slider\_check\_id; ?>"><?php \_e( 'Add a slider to this post/page' , 'customizr' ); ?></label></h4> |
| [1513](#L1513) | </div> |
| [1514](#L1514) | <div class="meta-box-item-content"> |
| [1515](#L1515) | <?php |
| [1516](#L1516) | $post\_slider\_checked = false; |
| [1517](#L1517) | if ( $post\_slider\_check\_value == 1) { |
| [1518](#L1518) | $post\_slider\_checked = true; |
| [1519](#L1519) | } |
| [1520](#L1520) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [1521](#L1521) | 'input\_name'   => $post\_slider\_check\_id, |
| [1522](#L1522) | 'input\_state'  => $post\_slider\_checked, |
| [1523](#L1523) | )); |
| [1524](#L1524) | ?> |
| [1525](#L1525) | </div> |
| [1526](#L1526) | <div id="slider-fields-box"> |
| [1527](#L1527) | <?php do\_action( '\_\_post\_slider\_infos' , $post->ID ); ?> |
| [1528](#L1528) | </div> |
| [1529](#L1529) | <?php |
| [1530](#L1530) |  |
| [1531](#L1531) | do\_action( 'czr\_post\_metabox\_added', $post ); |
| [1532](#L1532) | do\_action( 'czr\_slider\_metabox\_added', $post ); |
| [1533](#L1533) |  |
| [1534](#L1534) | }//end of function |
| [1535](#L1535) |  |
| [1536](#L1536) |  |
| [1537](#L1537) |  |
| [1538](#L1538) |  |
| [1539](#L1539) |  |
| [1540](#L1540) | /\*\* |
| [1541](#L1541) | \* Display post slider dynamic content |
| [1542](#L1542) | \* This function is also called by the ajax call back |
| [1543](#L1543) | \* @package Customizr |
| [1544](#L1544) | \* @since Customizr 2.0 |
| [1545](#L1545) | \*/ |
| [1546](#L1546) | function czr\_fn\_get\_post\_slider\_infos( $postid ) { |
| [1547](#L1547) | //check value is ajax saved ? |
| [1548](#L1548) | $post\_slider\_check\_value   = esc\_attr(get\_post\_meta( $postid, $key = 'post\_slider\_check\_key' , $single = true )); |
| [1549](#L1549) |  |
| [1550](#L1550) | //retrieve all sliders in option array |
| [1551](#L1551) | $options                  = get\_option( 'tc\_theme\_options' ); |
| [1552](#L1552) | if ( isset($options['tc\_sliders']) ) { |
| [1553](#L1553) | $sliders                  = $options['tc\_sliders']; |
| [1554](#L1554) | }else |
| [1555](#L1555) | $sliders                  = array(); |
| [1556](#L1556) |  |
| [1557](#L1557) | //post slider fields setup |
| [1558](#L1558) | $post\_slider\_id           = 'post\_slider\_field'; |
| [1559](#L1559) |  |
| [1560](#L1560) | //get current post slider |
| [1561](#L1561) | $current\_post\_slider       = esc\_attr(get\_post\_meta( $postid, $key = 'post\_slider\_key' , $single = true )); |
| [1562](#L1562) | if ( isset( $sliders[$current\_post\_slider])) { |
| [1563](#L1563) | $current\_post\_slides     = $sliders[$current\_post\_slider]; |
| [1564](#L1564) | } |
| [1565](#L1565) |  |
| [1566](#L1566) | //Delay field setup |
| [1567](#L1567) | $delay\_id                 = 'slider\_delay\_field'; |
| [1568](#L1568) | $delay\_value              = esc\_attr(get\_post\_meta( $postid, $key = 'slider\_delay\_key' , $single = true )); |
| [1569](#L1569) |  |
| [1570](#L1570) | //Layout field setup |
| [1571](#L1571) | $layout\_id                = 'slider\_layout\_field'; |
| [1572](#L1572) | $layout\_value             = esc\_attr(get\_post\_meta( $postid, $key = 'slider\_layout\_key' , $single = true )); |
| [1573](#L1573) |  |
| [1574](#L1574) | //overlay field setup |
| [1575](#L1575) | $overlay\_id               = 'slider\_overlay\_field'; |
| [1576](#L1576) | $overlay\_value            = esc\_attr(get\_post\_meta( $postid, $key = 'slider\_overlay\_key' , $single = true )); |
| [1577](#L1577) |  |
| [1578](#L1578) | //dots field setup |
| [1579](#L1579) | $dots\_id                  = 'slider\_dots\_field'; |
| [1580](#L1580) | $dots\_value               = esc\_attr(get\_post\_meta( $postid, $key = 'slider\_dots\_key' , $single = true )); |
| [1581](#L1581) |  |
| [1582](#L1582) | //sliders field |
| [1583](#L1583) | $slider\_id                = 'slider\_field'; |
| [1584](#L1584) |  |
| [1585](#L1585) | if( $post\_slider\_check\_value == true ): |
| [1586](#L1586) | $selectable\_sliders    = apply\_filters( 'czr\_post\_selectable\_sliders', $sliders ); |
| [1587](#L1587) | if ( isset( $selectable\_sliders ) && ! empty( $selectable\_sliders ) ): |
| [1588](#L1588) |  |
| [1589](#L1589) | ?> |
| [1590](#L1590) | <div class="meta-box-item-title"> |
| [1591](#L1591) | <h4><?php \_e("Choose a slider", 'customizr' ); ?></h4> |
| [1592](#L1592) | </div> |
| [1593](#L1593) | <?php |
| [1594](#L1594) | //build selectable slider->ID => label |
| [1595](#L1595) | //Default in head |
| [1596](#L1596) | $selectable\_sliders = array\_merge( array( |
| [1597](#L1597) | -1 => \_\_( '&mdash; Select a slider &mdash; ' , 'customizr' ) |
| [1598](#L1598) | ), $selectable\_sliders ); |
| [1599](#L1599) |  |
| [1600](#L1600) | //in case of sliders of images we set the label as the slider\_id |
| [1601](#L1601) | if ( isset($sliders) && !empty( $sliders) ) |
| [1602](#L1602) | foreach ( $sliders as $key => $value) { |
| [1603](#L1603) | if ( is\_array( $value ) ) |
| [1604](#L1604) | $selectable\_sliders[ $key ] = $key; |
| [1605](#L1605) | } |
| [1606](#L1606) | ?> |
| [1607](#L1607) | <div class="meta-box-item-content"> |
| [1608](#L1608) | <span class="spinner" style="float: left;visibility:visible;display: none;"></span> |
| [1609](#L1609) | <select name="<?php echo $post\_slider\_id; ?>" id="<?php echo $post\_slider\_id; ?>"> |
| [1610](#L1610) | <?php //sliders select choices |
| [1611](#L1611) | foreach ( $selectable\_sliders as $id => $label ) { |
| [1612](#L1612) | printf( '<option value="%1$s" %2$s> %3$s</option>', |
| [1613](#L1613) | esc\_attr( $id ), |
| [1614](#L1614) | selected( $current\_post\_slider, esc\_attr( $id ), $echo = false ), |
| [1615](#L1615) | $label |
| [1616](#L1616) | ); |
| [1617](#L1617) | } |
| [1618](#L1618) | ?> |
| [1619](#L1619) | </select> |
| [1620](#L1620) | <i><?php \_e( 'To create a new slider : open the media library, edit your images and add them to your new slider.' , 'customizr' ) ?></i> |
| [1621](#L1621) | </div> |
| [1622](#L1622) |  |
| [1623](#L1623) | <div class="meta-box-item-title"> |
| [1624](#L1624) | <h4><?php \_e("Delay between each slides in milliseconds (default : 5000 ms)", 'customizr' ); ?></h4> |
| [1625](#L1625) | </div> |
| [1626](#L1626) | <div class="meta-box-item-content"> |
| [1627](#L1627) | <input name="<?php echo esc\_attr( $delay\_id) ; ?>" id="<?php echo esc\_attr( $delay\_id); ?>" value="<?php if (empty( $delay\_value)) { echo '5000';} else {echo esc\_attr( $delay\_value);} ?>"/> |
| [1628](#L1628) | </div> |
| [1629](#L1629) |  |
| [1630](#L1630) | <div class="meta-box-item-title"> |
| [1631](#L1631) | <h4><?php \_e("Slider Layout : set the slider in full width", 'customizr' );  ?></h4> |
| [1632](#L1632) | </div> |
| [1633](#L1633) | <div class="meta-box-item-content"> |
| [1634](#L1634) | <?php |
| [1635](#L1635) | if ( $layout\_value ==null || $layout\_value ==1 ) |
| [1636](#L1636) | { |
| [1637](#L1637) | $layout\_check\_value = true; |
| [1638](#L1638) | } |
| [1639](#L1639) | else { |
| [1640](#L1640) | $layout\_check\_value = false; |
| [1641](#L1641) | } |
| [1642](#L1642) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [1643](#L1643) | 'input\_name'   => $layout\_id, |
| [1644](#L1644) | 'input\_state'  => $layout\_check\_value, |
| [1645](#L1645) | )); |
| [1646](#L1646) | ?> |
| [1647](#L1647) | </div> |
| [1648](#L1648) | <?php if ( CZR\_IS\_MODERN\_STYLE ) : ?> |
| [1649](#L1649) | <div class="meta-box-item-title"> |
| [1650](#L1650) | <h4><?php \_e("Apply a dark overlay on your slider's images", 'customizr' );  ?></h4> |
| [1651](#L1651) | </div> |
| [1652](#L1652) | <div class="meta-box-item-content"> |
| [1653](#L1653) | <?php |
| [1654](#L1654) | if ( $overlay\_value == null || 'on' == $overlay\_value || 1 === $overlay\_value || true === $overlay\_value ) |
| [1655](#L1655) | { |
| [1656](#L1656) | $overlay\_check\_value = true; |
| [1657](#L1657) | } |
| [1658](#L1658) | else { |
| [1659](#L1659) | $overlay\_check\_value = false; |
| [1660](#L1660) | } |
| [1661](#L1661) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [1662](#L1662) | 'input\_name'   => $overlay\_id, |
| [1663](#L1663) | 'input\_state'  => $overlay\_check\_value, |
| [1664](#L1664) | )); |
| [1665](#L1665) | ?> |
| [1666](#L1666) | </div> |
| [1667](#L1667) |  |
| [1668](#L1668) | <div class="meta-box-item-title"> |
| [1669](#L1669) | <h4><?php \_e("Display navigation dots at the bottom of your slider.", 'customizr' );  ?></h4> |
| [1670](#L1670) | </div> |
| [1671](#L1671) | <div class="meta-box-item-content"> |
| [1672](#L1672) | <?php |
| [1673](#L1673) | if ( $dots\_value == null || 'on' == $dots\_value || 1 === $dots\_value || true === $dots\_value ) { |
| [1674](#L1674) | $dots\_check\_value = true; |
| [1675](#L1675) | } |
| [1676](#L1676) | else { |
| [1677](#L1677) | $dots\_check\_value = false; |
| [1678](#L1678) | } |
| [1679](#L1679) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [1680](#L1680) | 'input\_name'   => $dots\_id, |
| [1681](#L1681) | 'input\_state'  => $dots\_check\_value, |
| [1682](#L1682) | )); |
| [1683](#L1683) | ?> |
| [1684](#L1684) | </div> |
| [1685](#L1685) | <?php endif; ?> |
| [1686](#L1686) | <?php if (isset( $current\_post\_slides)) : ?> |
| [1687](#L1687) | <div style="z-index: 1000;position: relative;"> |
| [1688](#L1688) | <p style="display: inline-block;float: right;"><a href="#TB\_inline?width=350&height=100&inlineId=post\_slider-warning-message" class="thickbox"><?php \_e( 'Delete this slider' , 'customizr' ) ?></a></p> |
| [1689](#L1689) | </div> |
| [1690](#L1690) | <div id="post\_slider-warning-message" style="display:none;"> |
| [1691](#L1691) | <div style="text-align:center"> |
| [1692](#L1692) | <p> |
| [1693](#L1693) | <?php \_e( 'The slider will be deleted permanently (images, call to actions and link will be kept).' , 'customizr' ) ?> |
| [1694](#L1694) | </p> |
| [1695](#L1695) | <br/> |
| [1696](#L1696) | <a class="button-secondary" id="delete-slider" href="#" title="<?php \_e( 'Delete slider' , 'customizr' ); ?>" onClick="javascript:window.parent.tb\_remove()"><?php \_e( 'Delete slider' , 'customizr' ); ?></a> |
| [1697](#L1697) | </div> |
| [1698](#L1698) | </div> |
| [1699](#L1699) | <?php  do\_action( '\_\_show\_slides' , $current\_post\_slides, $current\_attachement\_id = null); ?> |
| [1700](#L1700) | <?php else: //there are no slides |
| [1701](#L1701) | do\_action( '\_\_no\_slides', $postid, $current\_post\_slider ); |
| [1702](#L1702) | ?> |
| [1703](#L1703) | <?php endif; //slides? ?> |
| [1704](#L1704) | <?php else://if no slider created yet and no slider of posts addon?> |
| [1705](#L1705) |  |
| [1706](#L1706) | <div class="meta-box-item-content"> |
| [1707](#L1707) | <p class="description"> <?php \_e("You haven't create any slider yet. Go to the media library, edit your images and add them to your sliders.", "customizr" ) ?><br/> |
| [1708](#L1708) | </p> |
| [1709](#L1709) | <br /> |
| [1710](#L1710) | </div> |
| [1711](#L1711) | <?php endif; //sliders? ?> |
| [1712](#L1712) | <?php endif; //check slider? ?> |
| [1713](#L1713) | <?php |
| [1714](#L1714) | } |
| [1715](#L1715) |  |
| [1716](#L1716) |  |
| [1717](#L1717) |  |
| [1718](#L1718) |  |
| [1719](#L1719) |  |
| [1720](#L1720) |  |
| [1721](#L1721) | /\* |
| [1722](#L1722) | ---------------------------------------------------------------- |
| [1723](#L1723) | ------- SAVE POST/PAGE FIELDS (LAYOUT AND SLIDER FIELDS) ------- |
| [1724](#L1724) | ---------------------------------------------------------------- |
| [1725](#L1725) | \*/ |
| [1726](#L1726) | /\*\* |
| [1727](#L1727) | \* When the post/page is saved, saves our custom data for slider and layout options |
| [1728](#L1728) | \* @package Customizr |
| [1729](#L1729) | \* @since Customizr 1.0 |
| [1730](#L1730) | \*/ |
| [1731](#L1731) | function czr\_fn\_post\_fields\_save( $post\_id, $post\_object = null ) { |
| [1732](#L1732) | // verify if this is an auto save routine. |
| [1733](#L1733) | // If it is our form has not been submitted, so we dont want to do anything |
| [1734](#L1734) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [1735](#L1735) | return; |
| [1736](#L1736) |  |
| [1737](#L1737) | // Check permissions |
| [1738](#L1738) | if ( isset( $\_POST['post\_type']) && 'page' == $\_POST['post\_type'] ) |
| [1739](#L1739) | { |
| [1740](#L1740) | if ( !current\_user\_can( 'edit\_page' , $post\_id ) ) |
| [1741](#L1741) | return; |
| [1742](#L1742) | } |
| [1743](#L1743) | else |
| [1744](#L1744) | { |
| [1745](#L1745) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [1746](#L1746) | return; |
| [1747](#L1747) | } |
| [1748](#L1748) |  |
| [1749](#L1749) | //LINK |
| [1750](#L1750) | $this->czr\_fn\_link\_save( $post\_id, $post\_object ); |
| [1751](#L1751) |  |
| [1752](#L1752) |  |
| [1753](#L1753) | //QUOTE |
| [1754](#L1754) | $this->czr\_fn\_quote\_save( $post\_id, $post\_object ); |
| [1755](#L1755) |  |
| [1756](#L1756) | //AUDIO |
| [1757](#L1757) | $this->czr\_fn\_audio\_save( $post\_id, $post\_object ); |
| [1758](#L1758) |  |
| [1759](#L1759) | //VIDEO |
| [1760](#L1760) | $this->czr\_fn\_video\_save( $post\_id, $post\_object ); |
| [1761](#L1761) |  |
| [1762](#L1762) | ################# LAYOUT BOX ################# |
| [1763](#L1763) | // verify this came from our screen and with proper authorization, |
| [1764](#L1764) | if ( isset( $\_POST['post\_layout\_noncename']) && !wp\_verify\_nonce( $\_POST['post\_layout\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1765](#L1765) | return; |
| [1766](#L1766) |  |
| [1767](#L1767) | // OK, we're authenticated: we need to find and save the data |
| [1768](#L1768) | //set up the fields array |
| [1769](#L1769) | $tc\_post\_layout\_fields = array( |
| [1770](#L1770) | 'layout\_field'             =>  'layout\_key' |
| [1771](#L1771) | ); |
| [1772](#L1772) |  |
| [1773](#L1773) | //if saving in a custom table, get post\_ID |
| [1774](#L1774) | if ( isset( $\_POST['post\_ID'])) { |
| [1775](#L1775) | $post\_ID = $\_POST['post\_ID']; |
| [1776](#L1776) | //sanitize user input by looping on the fields |
| [1777](#L1777) | foreach ( $tc\_post\_layout\_fields as $tcid => $tckey) { |
| [1778](#L1778) | if ( isset( $\_POST[$tcid])) { |
| [1779](#L1779) | $mydata = sanitize\_text\_field( $\_POST[$tcid] ); |
| [1780](#L1780) |  |
| [1781](#L1781) | // Do something with $mydata |
| [1782](#L1782) | // either using |
| [1783](#L1783) | add\_post\_meta( $post\_ID, $tckey, $mydata, true) or |
| [1784](#L1784) | update\_post\_meta( $post\_ID, $tckey , $mydata); |
| [1785](#L1785) | // or a custom table (see Further Reading section below) |
| [1786](#L1786) | } |
| [1787](#L1787) | } |
| [1788](#L1788) | } |
| [1789](#L1789) |  |
| [1790](#L1790) | ################# SLIDER BOX ################# |
| [1791](#L1791) | // verify this came from our screen and with proper authorization, |
| [1792](#L1792) | if ( isset( $\_POST['post\_slider\_noncename']) && !wp\_verify\_nonce( $\_POST['post\_slider\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1793](#L1793) | return; |
| [1794](#L1794) |  |
| [1795](#L1795) |  |
| [1796](#L1796) | // OK, we're authenticated: we need to find and save the data |
| [1797](#L1797) | //set up the fields array |
| [1798](#L1798) | $tc\_post\_slider\_fields = array( |
| [1799](#L1799) | 'post\_slider\_check\_field'   => 'post\_slider\_check\_key', |
| [1800](#L1800) | 'slider\_delay\_field'        => 'slider\_delay\_key', |
| [1801](#L1801) | 'slider\_layout\_field'       => 'slider\_layout\_key', |
| [1802](#L1802) | 'slider\_overlay\_field'      => 'slider\_overlay\_key', |
| [1803](#L1803) | 'slider\_dots\_field'         => 'slider\_dots\_key', |
| [1804](#L1804) | 'post\_slider\_field'         => 'post\_slider\_key', |
| [1805](#L1805) | ); |
| [1806](#L1806) |  |
| [1807](#L1807) | //if saving in a custom table, get post\_ID |
| [1808](#L1808) | if ( isset( $\_POST['post\_ID'])) { |
| [1809](#L1809) | do\_action( '\_\_before\_save\_post\_slider\_fields', $\_POST, $tc\_post\_slider\_fields ); |
| [1810](#L1810) | $post\_ID = $\_POST['post\_ID']; |
| [1811](#L1811) | //sanitize user input by looping on the fields |
| [1812](#L1812) | foreach ( $tc\_post\_slider\_fields as $tcid => $tckey) { |
| [1813](#L1813) | if ( isset( $\_POST[$tcid])) { |
| [1814](#L1814) | if ( in\_array( $tcid, array( 'slider\_overlay\_field', 'slider\_dots\_field' ) ) ) { |
| [1815](#L1815) | $mydata = 0 == $\_POST[$tcid] ? 'off' : 'on'; |
| [1816](#L1816) | $mydata = sanitize\_text\_field( $mydata ); |
| [1817](#L1817) | } else { |
| [1818](#L1818) | $mydata = sanitize\_text\_field( $\_POST[$tcid] ); |
| [1819](#L1819) | } |
| [1820](#L1820) |  |
| [1821](#L1821) | // Do something with $mydata |
| [1822](#L1822) | // either using |
| [1823](#L1823) | add\_post\_meta( $post\_ID, $tckey, $mydata, true) or |
| [1824](#L1824) | update\_post\_meta( $post\_ID, $tckey , $mydata); |
| [1825](#L1825) | // or a custom table (see Further Reading section below) |
| [1826](#L1826) | } |
| [1827](#L1827) | } |
| [1828](#L1828) | do\_action( '\_\_after\_save\_post\_slider\_fields', $\_POST, $tc\_post\_slider\_fields ); |
| [1829](#L1829) | } |
| [1830](#L1830) |  |
| [1831](#L1831) |  |
| [1832](#L1832) | } |
| [1833](#L1833) |  |
| [1834](#L1834) |  |
| [1835](#L1835) |  |
| [1836](#L1836) | /\*\* |
| [1837](#L1837) | \* When the post/page is saved, saves our custom data for link |
| [1838](#L1838) | \*/ |
| [1839](#L1839) | function czr\_fn\_link\_save( $post\_id ) { |
| [1840](#L1840) |  |
| [1841](#L1841) | // verify if this is an auto save routine. |
| [1842](#L1842) | // If it is our form has not been submitted, so we dont want to do anything |
| [1843](#L1843) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [1844](#L1844) | return $post\_id; |
| [1845](#L1845) |  |
| [1846](#L1846) | // Check permissions |
| [1847](#L1847) | if ( !isset($post\_id) || !isset( $\_POST['post\_type'] ) || !isset( $\_POST['format\_link\_noncename'] ) ) |
| [1848](#L1848) | return $post\_id; |
| [1849](#L1849) |  |
| [1850](#L1850) | if ( !wp\_verify\_nonce( $\_POST['format\_link\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1851](#L1851) | return $post\_id; |
| [1852](#L1852) |  |
| [1853](#L1853) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [1854](#L1854) | return $post\_id; |
| [1855](#L1855) |  |
| [1856](#L1856) | //check field existence |
| [1857](#L1857) | if ( !( isset( $\_POST[ 'czr\_link\_title' ] ) && isset( $\_POST[ 'czr\_link\_url' ] ) ) ) |
| [1858](#L1858) | return $post\_id; |
| [1859](#L1859) |  |
| [1860](#L1860) | if ( 'post' != $\_POST[ 'post\_type' ] ) |
| [1861](#L1861) | return $post\_id; |
| [1862](#L1862) |  |
| [1863](#L1863) | if ( 'link' != get\_post\_format( $post\_id ) ) |
| [1864](#L1864) | return $post\_id; |
| [1865](#L1865) |  |
| [1866](#L1866) |  |
| [1867](#L1867) | //build custom post meta |
| [1868](#L1868) | $czr\_link\_format\_meta = array( |
| [1869](#L1869) | 'link\_title' => sanitize\_text\_field( $\_POST[ 'czr\_link\_title' ] ), |
| [1870](#L1870) | 'link\_url'   => esc\_url( $\_POST[ 'czr\_link\_url' ] ) |
| [1871](#L1871) | ); |
| [1872](#L1872) |  |
| [1873](#L1873) | //update |
| [1874](#L1874) | add\_post\_meta( $post\_id, 'czr\_link\_meta', $czr\_link\_format\_meta, true ) or |
| [1875](#L1875) | update\_post\_meta( $post\_id, 'czr\_link\_meta', $czr\_link\_format\_meta ); |
| [1876](#L1876) |  |
| [1877](#L1877) | } |
| [1878](#L1878) |  |
| [1879](#L1879) |  |
| [1880](#L1880) |  |
| [1881](#L1881) | /\*\* |
| [1882](#L1882) | \* When the post/page is saved, saves our custom data for quote |
| [1883](#L1883) | \*/ |
| [1884](#L1884) | function czr\_fn\_quote\_save( $post\_id ) { |
| [1885](#L1885) |  |
| [1886](#L1886) | // verify if this is an auto save routine. |
| [1887](#L1887) | // If it is our form has not been submitted, so we dont want to do anything |
| [1888](#L1888) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [1889](#L1889) | return $post\_id; |
| [1890](#L1890) |  |
| [1891](#L1891) | // Check permissions |
| [1892](#L1892) | if ( !isset($post\_id) || !isset( $\_POST['post\_type'] ) || !isset( $\_POST['format\_quote\_noncename'] ) ) |
| [1893](#L1893) | return $post\_id; |
| [1894](#L1894) |  |
| [1895](#L1895) | if ( !wp\_verify\_nonce( $\_POST['format\_link\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1896](#L1896) | return $post\_id; |
| [1897](#L1897) |  |
| [1898](#L1898) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [1899](#L1899) | return $post\_id; |
| [1900](#L1900) |  |
| [1901](#L1901) | //check field existence |
| [1902](#L1902) | if ( !( isset( $\_POST[ 'czr\_quote\_text' ] ) && isset( $\_POST[ 'czr\_quote\_author' ] ) ) ) |
| [1903](#L1903) | return $post\_id; |
| [1904](#L1904) |  |
| [1905](#L1905) | if ( 'post' != $\_POST[ 'post\_type' ] ) |
| [1906](#L1906) | return $post\_id; |
| [1907](#L1907) |  |
| [1908](#L1908) | if ( 'quote' != get\_post\_format( $post\_id ) ) |
| [1909](#L1909) | return $post\_id; |
| [1910](#L1910) |  |
| [1911](#L1911) | //build custom post meta |
| [1912](#L1912) | $czr\_quote\_format\_meta = array( |
| [1913](#L1913) | 'quote\_text'   => sanitize\_text\_field( $\_POST[ 'czr\_quote\_text' ] ), |
| [1914](#L1914) | 'quote\_author' => sanitize\_text\_field( $\_POST[ 'czr\_quote\_author' ] ) |
| [1915](#L1915) | ); |
| [1916](#L1916) |  |
| [1917](#L1917) | //update |
| [1918](#L1918) | add\_post\_meta( $post\_id, 'czr\_quote\_meta', $czr\_quote\_format\_meta, true ) or |
| [1919](#L1919) | update\_post\_meta( $post\_id, 'czr\_quote\_meta', $czr\_quote\_format\_meta ); |
| [1920](#L1920) |  |
| [1921](#L1921) | } |
| [1922](#L1922) |  |
| [1923](#L1923) | /\*\* |
| [1924](#L1924) | \* When the post/page is saved, saves our custom data for audio |
| [1925](#L1925) | \*/ |
| [1926](#L1926) | function czr\_fn\_audio\_save( $post\_id ) { |
| [1927](#L1927) |  |
| [1928](#L1928) | // verify if this is an auto save routine. |
| [1929](#L1929) | // If it is our form has not been submitted, so we dont want to do anything |
| [1930](#L1930) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [1931](#L1931) | return $post\_id; |
| [1932](#L1932) |  |
| [1933](#L1933) | // Check permissions |
| [1934](#L1934) | if ( !isset($post\_id) || !isset( $\_POST['post\_type'] ) || !isset( $\_POST['format\_audio\_noncename'] ) ) |
| [1935](#L1935) | return $post\_id; |
| [1936](#L1936) |  |
| [1937](#L1937) | if ( !wp\_verify\_nonce( $\_POST['format\_audio\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1938](#L1938) | return $post\_id; |
| [1939](#L1939) |  |
| [1940](#L1940) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [1941](#L1941) | return $post\_id; |
| [1942](#L1942) |  |
| [1943](#L1943) | //check field existence |
| [1944](#L1944) | if ( !( isset( $\_POST[ 'czr\_audio\_url' ] ) ) ) |
| [1945](#L1945) | return $post\_id; |
| [1946](#L1946) |  |
| [1947](#L1947) | if ( 'post' != $\_POST[ 'post\_type' ] ) |
| [1948](#L1948) | return $post\_id; |
| [1949](#L1949) |  |
| [1950](#L1950) | if ( 'audio' != get\_post\_format( $post\_id ) ) |
| [1951](#L1951) | return $post\_id; |
| [1952](#L1952) |  |
| [1953](#L1953) |  |
| [1954](#L1954) | //build custom post meta |
| [1955](#L1955) | $czr\_audio\_format\_meta = array( |
| [1956](#L1956) | 'audio\_url'   => esc\_url( $\_POST[ 'czr\_audio\_url' ] ) |
| [1957](#L1957) | ); |
| [1958](#L1958) |  |
| [1959](#L1959) | //update |
| [1960](#L1960) | add\_post\_meta( $post\_id, 'czr\_audio\_meta', $czr\_audio\_format\_meta, true ) or |
| [1961](#L1961) | update\_post\_meta( $post\_id, 'czr\_audio\_meta', $czr\_audio\_format\_meta ); |
| [1962](#L1962) |  |
| [1963](#L1963) | } |
| [1964](#L1964) |  |
| [1965](#L1965) |  |
| [1966](#L1966) |  |
| [1967](#L1967) | /\*\* |
| [1968](#L1968) | \* When the post/page is saved, saves our custom data for video |
| [1969](#L1969) | \*/ |
| [1970](#L1970) | function czr\_fn\_video\_save( $post\_id ) { |
| [1971](#L1971) |  |
| [1972](#L1972) | // verify if this is an auto save routine. |
| [1973](#L1973) | // If it is our form has not been submitted, so we dont want to do anything |
| [1974](#L1974) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [1975](#L1975) | return $post\_id; |
| [1976](#L1976) |  |
| [1977](#L1977) | // Check permissions |
| [1978](#L1978) | if ( !isset($post\_id) || !isset( $\_POST['post\_type'] ) || !isset( $\_POST['format\_video\_noncename'] ) ) |
| [1979](#L1979) | return $post\_id; |
| [1980](#L1980) |  |
| [1981](#L1981) | if ( !wp\_verify\_nonce( $\_POST['format\_video\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [1982](#L1982) | return $post\_id; |
| [1983](#L1983) |  |
| [1984](#L1984) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [1985](#L1985) | return $post\_id; |
| [1986](#L1986) |  |
| [1987](#L1987) | //check field existence |
| [1988](#L1988) | if ( !( isset( $\_POST[ 'czr\_video\_url' ] ) ) ) |
| [1989](#L1989) | return $post\_id; |
| [1990](#L1990) |  |
| [1991](#L1991) | if ( 'post' != $\_POST[ 'post\_type' ] ) |
| [1992](#L1992) | return $post\_id; |
| [1993](#L1993) |  |
| [1994](#L1994) | if ( 'video' != get\_post\_format( $post\_id ) ) |
| [1995](#L1995) | return $post\_id; |
| [1996](#L1996) |  |
| [1997](#L1997) |  |
| [1998](#L1998) | //build custom post meta |
| [1999](#L1999) | $czr\_video\_format\_meta = array( |
| [2000](#L2000) | 'video\_url'   => esc\_url( $\_POST[ 'czr\_video\_url' ] ) |
| [2001](#L2001) | ); |
| [2002](#L2002) |  |
| [2003](#L2003) | //update |
| [2004](#L2004) | add\_post\_meta( $post\_id, 'czr\_video\_meta', $czr\_video\_format\_meta, true ) or |
| [2005](#L2005) | update\_post\_meta( $post\_id, 'czr\_video\_meta', $czr\_video\_format\_meta ); |
| [2006](#L2006) |  |
| [2007](#L2007) | } |
| [2008](#L2008) |  |
| [2009](#L2009) |  |
| [2010](#L2010) | /\* |
| [2011](#L2011) | ---------------------------------------------------------------- |
| [2012](#L2012) | ------------------ ATTACHMENT SLIDER META BOX ------------------ |
| [2013](#L2013) | ---------------------------------------------------------------- |
| [2014](#L2014) | \*/ |
| [2015](#L2015) | /\*\* |
| [2016](#L2016) | \* Add a slider metabox to attachments |
| [2017](#L2017) | \* @package Customizr |
| [2018](#L2018) | \* @since Customizr 2.0 |
| [2019](#L2019) | \*/ |
| [2020](#L2020) | function czr\_fn\_attachment\_meta\_box( $id ) {//id, title, callback, post\_type, context, priority, callback\_args |
| [2021](#L2021) | if ( ! wp\_attachment\_is\_image( $id ) ) |
| [2022](#L2022) | return; |
| [2023](#L2023) |  |
| [2024](#L2024) | add\_meta\_box( |
| [2025](#L2025) | 'slider\_sectionid' , |
| [2026](#L2026) | \_\_( 'Slider Options' , 'customizr' ), |
| [2027](#L2027) | array( $this , 'czr\_fn\_attachment\_slider\_box' ) |
| [2028](#L2028) | ); |
| [2029](#L2029) |  |
| [2030](#L2030) | } |
| [2031](#L2031) |  |
| [2032](#L2032) |  |
| [2033](#L2033) |  |
| [2034](#L2034) |  |
| [2035](#L2035) |  |
| [2036](#L2036) |  |
| [2037](#L2037) |  |
| [2038](#L2038) | /\*\* |
| [2039](#L2039) | \* Prints the slider box content |
| [2040](#L2040) | \* @package Customizr |
| [2041](#L2041) | \* @since Customizr 2.0 |
| [2042](#L2042) | \*/ |
| [2043](#L2043) | function czr\_fn\_attachment\_slider\_box( $post ) { |
| [2044](#L2044) | // Use nonce for verification |
| [2045](#L2045) | //wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'slider\_noncename' ); |
| [2046](#L2046) | // The actual fields for data entry |
| [2047](#L2047) | //title check field setup |
| [2048](#L2048) | $slider\_check\_id       = 'slider\_check\_field'; |
| [2049](#L2049) | $slider\_check\_value    = esc\_attr(get\_post\_meta( $post->ID, $key = 'slider\_check\_key' , $single = true )); |
| [2050](#L2050) |  |
| [2051](#L2051) | ?> |
| [2052](#L2052) | <div class="meta-box-item-title"> |
| [2053](#L2053) | <h4><label for="<?php echo $slider\_check\_id; ?>"><?php \_e( 'Add to a slider (create one if needed)' , 'customizr' ) ?></label></h4> |
| [2054](#L2054) | </div> |
| [2055](#L2055) | <div class="meta-box-item-content"> |
| [2056](#L2056) | <input name="tc\_post\_id" id="tc\_post\_id" type="hidden" value="<?php echo $post->ID ?>"/> |
| [2057](#L2057) | <?php |
| [2058](#L2058) | $slider\_checked = false; |
| [2059](#L2059) | if ( $slider\_check\_value == 1) { |
| [2060](#L2060) | $slider\_checked = true; |
| [2061](#L2061) | } |
| [2062](#L2062) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [2063](#L2063) | 'input\_name'   => $slider\_check\_id, |
| [2064](#L2064) | 'input\_state'  => $slider\_checked, |
| [2065](#L2065) | )); |
| [2066](#L2066) | ?> |
| [2067](#L2067) | </div> |
| [2068](#L2068) | <div id="slider-fields-box"> |
| [2069](#L2069) | <?php do\_action( '\_\_attachment\_slider\_infos' , $post->ID); ?> |
| [2070](#L2070) | </div> |
| [2071](#L2071) | <?php |
| [2072](#L2072) |  |
| [2073](#L2073) | do\_action( 'czr\_attachment\_metabox\_added', $post ); |
| [2074](#L2074) | do\_action( 'czr\_slider\_metabox\_added', $post ); |
| [2075](#L2075) | } |
| [2076](#L2076) |  |
| [2077](#L2077) |  |
| [2078](#L2078) |  |
| [2079](#L2079) |  |
| [2080](#L2080) |  |
| [2081](#L2081) |  |
| [2082](#L2082) |  |
| [2083](#L2083) | /\*\* |
| [2084](#L2084) | \* Display attachment slider dynamic content |
| [2085](#L2085) | \* This function is also called by the ajax call back function |
| [2086](#L2086) | \* @package Customizr |
| [2087](#L2087) | \* @since Customizr 2.0 |
| [2088](#L2088) | \*/ |
| [2089](#L2089) | function czr\_fn\_get\_attachment\_slider\_infos( $postid ) { |
| [2090](#L2090) | //check value is ajax saved ? |
| [2091](#L2091) | $slider\_check\_value     = esc\_attr(get\_post\_meta( $postid, $key = 'slider\_check\_key' , $single = true )); |
| [2092](#L2092) |  |
| [2093](#L2093) | //post slider fields setup |
| [2094](#L2094) | $post\_slider\_id         = 'post\_slider\_field'; |
| [2095](#L2095) |  |
| [2096](#L2096) | //sliders field |
| [2097](#L2097) | $slider\_id             = 'slider\_field'; |
| [2098](#L2098) |  |
| [2099](#L2099) | //retrieve all sliders in option array |
| [2100](#L2100) | $options               = get\_option( 'tc\_theme\_options' ); |
| [2101](#L2101) | $sliders               = array(); |
| [2102](#L2102) | if ( isset( $options['tc\_sliders'])) { |
| [2103](#L2103) | $sliders             = $options['tc\_sliders']; |
| [2104](#L2104) | } |
| [2105](#L2105) |  |
| [2106](#L2106) | //get\_attachment details for default slide values |
| [2107](#L2107) | $attachment            = get\_post( $postid); |
| [2108](#L2108) | $default\_title         = $attachment->post\_title; |
| [2109](#L2109) | $default\_description    = $attachment->post\_excerpt; |
| [2110](#L2110) |  |
| [2111](#L2111) | //title field setup |
| [2112](#L2112) | $title\_id              = 'slide\_title\_field'; |
| [2113](#L2113) | $title\_value           = esc\_attr(get\_post\_meta( $postid, $key = 'slide\_title\_key' , $single = true )); |
| [2114](#L2114) | //we define a filter for the slide\_text\_length |
| [2115](#L2115) | $default\_title\_length   = apply\_filters( 'tc\_slide\_title\_length', apply\_filters( 'czr\_slide\_title\_length', 80 ) ); |
| [2116](#L2116) |  |
| [2117](#L2117) | //check if we already have a custom key created for this field, if not apply default value |
| [2118](#L2118) | if(!in\_array( 'slide\_title\_key' ,get\_post\_custom\_keys( $postid))) { |
| [2119](#L2119) | $title\_value = $default\_title; |
| [2120](#L2120) | } |
| [2121](#L2121) | $title\_value = esc\_html( czr\_fn\_text\_truncate( $title\_value, $default\_title\_length, '...' ) ); |
| [2122](#L2122) |  |
| [2123](#L2123) |  |
| [2124](#L2124) | //text\_field setup : sanitize and limit length |
| [2125](#L2125) | $text\_id        = 'slide\_text\_field'; |
| [2126](#L2126) | $text\_value     = esc\_html(get\_post\_meta( $postid, $key = 'slide\_text\_key' , $single = true )); |
| [2127](#L2127) | //we define a filter for the slide\_title\_length |
| [2128](#L2128) | $default\_text\_length   = apply\_filters( 'tc\_slide\_text\_length', apply\_filters( 'czr\_slide\_text\_length', 250 ) ); |
| [2129](#L2129) |  |
| [2130](#L2130) | //check if we already have a custom key created for this field, if not apply default value |
| [2131](#L2131) | if(!in\_array( 'slide\_text\_key' ,get\_post\_custom\_keys( $postid))) |
| [2132](#L2132) | $text\_value = $default\_description; |
| [2133](#L2133) | $text\_value = czr\_fn\_text\_truncate( $text\_value, $default\_text\_length, '...' ); |
| [2134](#L2134) |  |
| [2135](#L2135) |  |
| [2136](#L2136) | //Color field setup |
| [2137](#L2137) | $color\_id       = 'slide\_color\_field'; |
| [2138](#L2138) | $color\_value    = esc\_attr(get\_post\_meta( $postid, $key = 'slide\_color\_key' , $single = true )); |
| [2139](#L2139) |  |
| [2140](#L2140) | //button field setup |
| [2141](#L2141) | $button\_id      = 'slide\_button\_field'; |
| [2142](#L2142) | $button\_value   = esc\_attr(get\_post\_meta( $postid, $key = 'slide\_button\_key' , $single = true )); |
| [2143](#L2143) |  |
| [2144](#L2144) | //we define a filter for the slide text\_button length |
| [2145](#L2145) | $default\_button\_length   = apply\_filters( 'tc\_slide\_button\_length', apply\_filters( 'czr\_slide\_button\_length', 80 ) ); |
| [2146](#L2146) | $button\_value   = czr\_fn\_text\_truncate( $button\_value, $default\_button\_length, '...' ); |
| [2147](#L2147) |  |
| [2148](#L2148) |  |
| [2149](#L2149) |  |
| [2150](#L2150) | //link field setup |
| [2151](#L2151) | $link\_id        = 'slide\_link\_field'; |
| [2152](#L2152) | $link\_value     = esc\_attr(get\_post\_meta( $postid, $key = 'slide\_link\_key' , $single = true )); |
| [2153](#L2153) |  |
| [2154](#L2154) | //retrieve post, pages and custom post types (if any) and generate the ordered select list for the button link |
| [2155](#L2155) | $post\_types     = get\_post\_types(array( 'public' => true)); |
| [2156](#L2156) | $excludes       = array( 'attachment' ); |
| [2157](#L2157) |  |
| [2158](#L2158) |  |
| [2159](#L2159) | foreach ( $post\_types as $t) { |
| [2160](#L2160) | if (!in\_array( $t, $excludes)) { |
| [2161](#L2161) | //get the posts a tab of types |
| [2162](#L2162) | $tc\_all\_posts[$t] = get\_posts(  array( |
| [2163](#L2163) | 'numberposts'     =>  100, |
| [2164](#L2164) | 'orderby'         =>  'date' , |
| [2165](#L2165) | 'order'          =>  'DESC' , |
| [2166](#L2166) | 'post\_type'       =>  $t, |
| [2167](#L2167) | 'post\_status'     =>  'publish' ) |
| [2168](#L2168) | ); |
| [2169](#L2169) | } |
| [2170](#L2170) | }; |
| [2171](#L2171) |  |
| [2172](#L2172) | //custom link field setup |
| [2173](#L2173) | $custom\_link\_id    = 'slide\_custom\_link\_field'; |
| [2174](#L2174) | $custom\_link\_value = esc\_url( get\_post\_meta( $postid, $key = 'slide\_custom\_link\_key', $single = true ) ); |
| [2175](#L2175) |  |
| [2176](#L2176) | //link target setup |
| [2177](#L2177) | $link\_target\_id    = 'slide\_link\_target\_field'; |
| [2178](#L2178) | $link\_target\_value = esc\_attr( get\_post\_meta( $postid, $key = 'slide\_link\_target\_key', $single = true ) ) ; |
| [2179](#L2179) |  |
| [2180](#L2180) | //link whole slide setup |
| [2181](#L2181) | $link\_whole\_slide\_id    = 'slide\_link\_whole\_slide\_field'; |
| [2182](#L2182) | $link\_whole\_slide\_value = esc\_attr( get\_post\_meta( $postid, $key = 'slide\_link\_whole\_slide\_key', $single = true ) ) ; |
| [2183](#L2183) |  |
| [2184](#L2184) | //display fields if slider button is checked |
| [2185](#L2185) | if ( $slider\_check\_value == true )  { |
| [2186](#L2186) | ?> |
| [2187](#L2187) | <div class="meta-box-item-title"> |
| [2188](#L2188) | <h4><?php \_e( 'Title text (80 char. max length)' , 'customizr' ); ?></h4> |
| [2189](#L2189) | </div> |
| [2190](#L2190) | <div class="meta-box-item-content"> |
| [2191](#L2191) | <input class="widefat" name="<?php echo esc\_attr( $title\_id); ?>" id="<?php echo esc\_attr( $title\_id); ?>" value="<?php echo esc\_attr( $title\_value); ?>" style="width:50%"> |
| [2192](#L2192) | </div> |
| [2193](#L2193) |  |
| [2194](#L2194) | <div class="meta-box-item-title"> |
| [2195](#L2195) | <h4><?php \_e( 'Description text (below the title, 250 char. max length)' , 'customizr' ); ?></h4> |
| [2196](#L2196) | </div> |
| [2197](#L2197) | <div class="meta-box-item-content"> |
| [2198](#L2198) | <textarea name="<?php echo esc\_attr( $text\_id); ?>" id="<?php echo esc\_attr( $text\_id); ?>" style="width:50%"><?php echo esc\_html( $text\_value); ?></textarea> |
| [2199](#L2199) | </div> |
| [2200](#L2200) |  |
| [2201](#L2201) | <div class="meta-box-item-title"> |
| [2202](#L2202) | <h4><?php \_e("Title and text color", 'customizr' );  ?></h4> |
| [2203](#L2203) | </div> |
| [2204](#L2204) | <div class="meta-box-item-content"> |
| [2205](#L2205) | <input id="<?php echo esc\_attr( $color\_id); ?>" name="<?php echo esc\_attr( $color\_id); ?>" value="<?php echo esc\_attr( $color\_value); ?>"/> |
| [2206](#L2206) | <div id="colorpicker"></div> |
| [2207](#L2207) | </div> |
| [2208](#L2208) |  |
| [2209](#L2209) | <div class="meta-box-item-title"> |
| [2210](#L2210) | <h4><?php \_e( 'Button text (80 char. max length)' , 'customizr' ); ?></h4> |
| [2211](#L2211) | </div> |
| [2212](#L2212) | <div class="meta-box-item-content"> |
| [2213](#L2213) | <input class="widefat" name="<?php echo esc\_attr( $button\_id); ?>" id="<?php echo esc\_attr( $button\_id); ?>" value="<?php echo esc\_attr( $button\_value); ?>" style="width:50%"> |
| [2214](#L2214) | </div> |
| [2215](#L2215) |  |
| [2216](#L2216) | <div class="meta-box-item-title"> |
| [2217](#L2217) | <h4><?php \_e("Choose a linked page or post (among the last 100).", 'customizr' ); ?></h4> |
| [2218](#L2218) | </div> |
| [2219](#L2219) | <div class="meta-box-item-content"> |
| [2220](#L2220) | <select name="<?php echo esc\_attr( $link\_id); ?>" id="<?php echo esc\_attr( $link\_id); ?>"> |
| [2221](#L2221) | <?php //no link option ?> |
| [2222](#L2222) | <option value="" <?php selected( $link\_value, $current = null, $echo = true ) ?>> <?php \_e( 'No link' , 'customizr' ); ?></option> |
| [2223](#L2223) | <?php foreach( $tc\_all\_posts as $type) : ?> |
| [2224](#L2224) | <?php foreach ( $type as $key => $item) : ?> |
| [2225](#L2225) | <option value="<?php echo esc\_attr( $item->ID); ?>" <?php selected( $link\_value, $current = $item->ID, $echo = true ) ?>>{<?php echo esc\_attr( $item->post\_type) ;?>}&nbsp;<?php echo esc\_attr( $item->post\_title); ?></option> |
| [2226](#L2226) | <?php endforeach; ?> |
| [2227](#L2227) | <?php endforeach; ?> |
| [2228](#L2228) | </select><br /> |
| [2229](#L2229) | </div> |
| [2230](#L2230) | <div class="meta-box-item-title"> |
| [2231](#L2231) | <h4><?php \_e("or a custom link (leave this empty if you already selected a page or post above)", 'customizr' ); ?></h4> |
| [2232](#L2232) | </div> |
| [2233](#L2233) | <div class="meta-box-item-content"> |
| [2234](#L2234) | <input class="widefat" name="<?php echo $custom\_link\_id; ?>" id="<?php echo $custom\_link\_id; ?>" value="<?php echo $custom\_link\_value; ?>" style="width:50%"> |
| [2235](#L2235) | </div> |
| [2236](#L2236) | <div class="meta-box-item-title"> |
| [2237](#L2237) | <h4><?php \_e("Open link in a new page/tab", 'customizr' );  ?></h4> |
| [2238](#L2238) | </div> |
| [2239](#L2239) | <div class="meta-box-item-content"> |
| [2240](#L2240) | <?php |
| [2241](#L2241) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [2242](#L2242) | 'input\_name'   => $link\_target\_id, |
| [2243](#L2243) | 'input\_state'  => $link\_target\_value, |
| [2244](#L2244) | )); |
| [2245](#L2245) | ?> |
| [2246](#L2246) | </div> |
| [2247](#L2247) | <div class="meta-box-item-title"> |
| [2248](#L2248) | <h4><?php \_e("Link the whole slide", 'customizr' );  ?></h4> |
| [2249](#L2249) | </div> |
| [2250](#L2250) | <div class="meta-box-item-content"> |
| [2251](#L2251) | <?php |
| [2252](#L2252) | CZR\_meta\_boxes::czr\_fn\_checkbox\_view( array( |
| [2253](#L2253) | 'input\_name'   => $link\_whole\_slide\_id, |
| [2254](#L2254) | 'input\_state'  => $link\_whole\_slide\_value, |
| [2255](#L2255) | )); |
| [2256](#L2256) | ?> |
| [2257](#L2257) | </div> |
| [2258](#L2258) | <div class="meta-box-item-title"> |
| [2259](#L2259) | <h4><?php \_e("Choose a slider", 'customizr' ); ?></h4> |
| [2260](#L2260) | </div> |
| [2261](#L2261) | <?php if (!empty( $sliders)) : ?> |
| [2262](#L2262) | <div class="meta-box-item-content"> |
| [2263](#L2263) | <?php //get current post slider |
| [2264](#L2264) | $current\_post\_slider = null; |
| [2265](#L2265) | foreach( $sliders as $slider\_name => $slider\_posts) { |
| [2266](#L2266) | if (in\_array( $postid, $slider\_posts)) { |
| [2267](#L2267) | $current\_post\_slider = $slider\_name; |
| [2268](#L2268) | $current\_post\_slides = $slider\_posts; |
| [2269](#L2269) | } |
| [2270](#L2270) | } |
| [2271](#L2271) | ?> |
| [2272](#L2272) | <select name="<?php echo esc\_attr( $post\_slider\_id); ?>" id="<?php echo esc\_attr( $post\_slider\_id); ?>"> |
| [2273](#L2273) | <?php //no link option ?> |
| [2274](#L2274) | <option value="" <?php selected( $current\_post\_slider, $current = null, $echo = true ) ?>> <?php \_e( '&mdash; Select a slider &mdash; ' , 'customizr' ); ?></option> |
| [2275](#L2275) | <?php foreach( $sliders as $slider\_name => $slider\_posts) : ?> |
| [2276](#L2276) | <option value="<?php echo $slider\_name ?>" <?php selected( $slider\_name, $current = $current\_post\_slider, $echo = true ) ?>><?php echo $slider\_name?></option> |
| [2277](#L2277) | <?php endforeach; ?> |
| [2278](#L2278) | </select> |
| [2279](#L2279) | <input name="<?php echo $slider\_id  ?>" id="<?php echo $slider\_id ?>" value=""/> |
| [2280](#L2280) | <span class="button-primary" id="tc\_create\_slider"><?php \_e( 'Add a slider' , 'customizr' ) ?></span> |
| [2281](#L2281) | <span class="spinner" style="float: left;visibility:visible;display: none;"></span> |
| [2282](#L2282) | <?php if (isset( $current\_post\_slides)) : ?> |
| [2283](#L2283) | <p style="text-align:right"><a href="#TB\_inline?width=350&height=100&inlineId=slider-warning-message" class="thickbox"><?php \_e( 'Delete this slider' , 'customizr' ) ?></a></p> |
| [2284](#L2284) | <div id="slider-warning-message" style="display:none;"> |
| [2285](#L2285) | <div style="text-align:center"> |
| [2286](#L2286) | <p> |
| [2287](#L2287) | <?php \_e( 'The slider will be deleted permanently (images, call to actions and link will be kept).' , 'customizr' ) ?> |
| [2288](#L2288) | </p> |
| [2289](#L2289) | <br/> |
| [2290](#L2290) | <a class="button-secondary" id="delete-slider" href="#" title="<?php \_e( 'Delete slider' , 'customizr' ); ?>" onClick="javascript:window.parent.tb\_remove()"><?php \_e( 'Delete slider' , 'customizr' ); ?></a> |
| [2291](#L2291) | </div> |
| [2292](#L2292) | </div> |
| [2293](#L2293) | <?php endif; ?> |
| [2294](#L2294) | </div> |
| [2295](#L2295) |  |
| [2296](#L2296) |  |
| [2297](#L2297) | <?php |
| [2298](#L2298) | if ( isset( $current\_post\_slides) ) { |
| [2299](#L2299) | $current\_attachement\_id = $postid; |
| [2300](#L2300) | do\_action( '\_\_show\_slides' ,$current\_post\_slides, $current\_attachement\_id); |
| [2301](#L2301) | } |
| [2302](#L2302) | ?> |
| [2303](#L2303) |  |
| [2304](#L2304) | <?php else : //if no slider created yet ?> |
| [2305](#L2305) |  |
| [2306](#L2306) | <div class="meta-box-item-content"> |
| [2307](#L2307) | <p class="description"> <?php \_e("You haven't create any slider yet. Write a slider name and click on the button to add you first slider.", "customizr" ) ?><br/> |
| [2308](#L2308) | <input name="<?php echo $slider\_id  ?>" id="<?php echo $slider\_id ?>" value=""/> |
| [2309](#L2309) | <span class="button-primary" id="tc\_create\_slider"><?php \_e( 'Add a slider' , 'customizr' ) ?></span> |
| [2310](#L2310) | <span class="spinner" style="float: left; diplay:none;"></span> |
| [2311](#L2311) | </p> |
| [2312](#L2312) | <br /> |
| [2313](#L2313) | </div> |
| [2314](#L2314) | <?php endif; ?> |
| [2315](#L2315) | <?php |
| [2316](#L2316) | }//endif slider checked (used for ajax call back!) |
| [2317](#L2317) | } |
| [2318](#L2318) |  |
| [2319](#L2319) |  |
| [2320](#L2320) |  |
| [2321](#L2321) |  |
| [2322](#L2322) |  |
| [2323](#L2323) | /\* |
| [2324](#L2324) | ---------------------------------------------------------------- |
| [2325](#L2325) | -------------------- SAVE ATTACHMENT FIELDS -------------------- |
| [2326](#L2326) | ---------------------------------------------------------------- |
| [2327](#L2327) | \*/ |
| [2328](#L2328) |  |
| [2329](#L2329) | /\*\* |
| [2330](#L2330) | \* When the attachment is saved, saves our custom slider data |
| [2331](#L2331) | \* @package Customizr |
| [2332](#L2332) | \* @since Customizr 2.0 |
| [2333](#L2333) | \*/ |
| [2334](#L2334) | function czr\_fn\_slide\_save( $post\_id ) { |
| [2335](#L2335) | // verify if this is an auto save routine. |
| [2336](#L2336) | // If it is our form has not been submitted, so we dont want to do anything |
| [2337](#L2337) |  |
| [2338](#L2338) |  |
| [2339](#L2339) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [2340](#L2340) | return; |
| [2341](#L2341) |  |
| [2342](#L2342) | // verify this came from our screen and with proper authorization, |
| [2343](#L2343) | // because save\_post can be triggered at other times |
| [2344](#L2344) |  |
| [2345](#L2345) | if ( isset( $\_POST['slider\_noncename']) && !wp\_verify\_nonce( $\_POST['slider\_noncename'], plugin\_basename( \_\_FILE\_\_ ) ) ) |
| [2346](#L2346) | return; |
| [2347](#L2347) |  |
| [2348](#L2348) | // Check permissions |
| [2349](#L2349) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [2350](#L2350) | return; |
| [2351](#L2351) |  |
| [2352](#L2352) | // OK, we're authenticated: we need to find and save the data |
| [2353](#L2353) |  |
| [2354](#L2354) | //set up the fields array |
| [2355](#L2355) | $tc\_slider\_fields = array( |
| [2356](#L2356) | 'slide\_title\_field'            => 'slide\_title\_key' , |
| [2357](#L2357) | 'slide\_text\_field'             => 'slide\_text\_key' , |
| [2358](#L2358) | 'slide\_color\_field'            => 'slide\_color\_key' , |
| [2359](#L2359) | 'slide\_button\_field'           => 'slide\_button\_key' , |
| [2360](#L2360) | 'slide\_link\_field'             => 'slide\_link\_key' , |
| [2361](#L2361) | 'slide\_custom\_link\_field'       => 'slide\_custom\_link\_key', |
| [2362](#L2362) | 'slide\_link\_target\_field'       => 'slide\_link\_target\_key', |
| [2363](#L2363) | 'slide\_link\_whole\_slide\_field'  => 'slide\_link\_whole\_slide\_key' |
| [2364](#L2364) | ); |
| [2365](#L2365) |  |
| [2366](#L2366) | //if saving in a custom table, get post\_ID |
| [2367](#L2367) | if ( $post\_id == null) |
| [2368](#L2368) | return; |
| [2369](#L2369) |  |
| [2370](#L2370) | //sanitize user input by looping on the fields |
| [2371](#L2371) | foreach ( $tc\_slider\_fields as $tcid => $tckey) { |
| [2372](#L2372) | if ( isset( $\_POST[$tcid])) { |
| [2373](#L2373) | $mydata = sanitize\_text\_field( $\_POST[$tcid] ); |
| [2374](#L2374) |  |
| [2375](#L2375) | switch ( $tckey) { |
| [2376](#L2376) | //different sanitizations |
| [2377](#L2377) | case 'slide\_text\_key': |
| [2378](#L2378) | $default\_text\_length = apply\_filters( 'tc\_slide\_text\_length', apply\_filters( 'czr\_slide\_text\_length', 250 ) ); |
| [2379](#L2379) | $mydata = esc\_html( czr\_fn\_text\_truncate( $mydata, $default\_text\_length, '...' ) ); |
| [2380](#L2380) | break; |
| [2381](#L2381) |  |
| [2382](#L2382) | case 'slide\_title\_key': |
| [2383](#L2383) | $default\_title\_length = apply\_filters( 'tc\_slide\_title\_length', apply\_filters( 'czr\_slide\_title\_length', 80 ) ); |
| [2384](#L2384) | $mydata = esc\_html( czr\_fn\_text\_truncate( $mydata, $default\_title\_length, '...' ) ); |
| [2385](#L2385) | break; |
| [2386](#L2386) |  |
| [2387](#L2387) | case 'slide\_button\_key': |
| [2388](#L2388) | $default\_button\_text\_length = apply\_filters( 'tc\_slide\_button\_length', apply\_filters( 'czr\_slide\_button\_length', 80 ) ); |
| [2389](#L2389) | $mydata = esc\_html( czr\_fn\_text\_truncate( $mydata, $default\_button\_text\_length, '...' ) ); |
| [2390](#L2390) | break; |
| [2391](#L2391) |  |
| [2392](#L2392) | case 'slide\_custom\_link\_key': |
| [2393](#L2393) | $mydata = esc\_url( $\_POST[$tcid] ); |
| [2394](#L2394) | break; |
| [2395](#L2395) |  |
| [2396](#L2396) | case 'slide\_link\_target\_key'; |
| [2397](#L2397) | case 'slide\_link\_whole\_slide\_key': |
| [2398](#L2398) | $mydata = esc\_attr( $mydata ); |
| [2399](#L2399) | break; |
| [2400](#L2400) |  |
| [2401](#L2401) | default://for color, post link field (actually not a link but an id) |
| [2402](#L2402) | $mydata = esc\_attr( $mydata ); |
| [2403](#L2403) | break; |
| [2404](#L2404) | }//end switch |
| [2405](#L2405) | //write in DB |
| [2406](#L2406) | add\_post\_meta( $post\_id, $tckey, $mydata, true) or |
| [2407](#L2407) | update\_post\_meta( $post\_id, $tckey , $mydata); |
| [2408](#L2408) | }//end if isset $tckey |
| [2409](#L2409) | }//end foreach |
| [2410](#L2410) | } |
| [2411](#L2411) |  |
| [2412](#L2412) |  |
| [2413](#L2413) |  |
| [2414](#L2414) |  |
| [2415](#L2415) |  |
| [2416](#L2416) |  |
| [2417](#L2417) | /\* |
| [2418](#L2418) | ---------------------------------------------------------------- |
| [2419](#L2419) | ---------- DISPLAY SLIDES TABLE (post and attachment) ---------- |
| [2420](#L2420) | ---------------------------------------------------------------- |
| [2421](#L2421) | \*/ |
| [2422](#L2422) |  |
| [2423](#L2423) | /\*\* |
| [2424](#L2424) | \* Display slides table dynamic content for the selected slider |
| [2425](#L2425) | \* @package Customizr |
| [2426](#L2426) | \* @since Customizr 2.0 |
| [2427](#L2427) | \*/ |
| [2428](#L2428) | function czr\_fn\_show\_slides ( $current\_post\_slides,$current\_attachement\_id) { |
| [2429](#L2429) | //check if we have slides to show |
| [2430](#L2430) | ?> |
| [2431](#L2431) | <?php if(empty( $current\_post\_slides)) : ?> |
| [2432](#L2432) | <div class="meta-box-item-content"> |
| [2433](#L2433) | <p class="description"> <?php \_e("This slider has not slides to show. Go to the media library and start adding images to it.", "customizr" ) ?><br/> |
| [2434](#L2434) | </p> |
| [2435](#L2435) | <br /> |
| [2436](#L2436) | </div> |
| [2437](#L2437) | <?php else : // render?> |
| [2438](#L2438) | <div id="tc\_slides\_table"> |
| [2439](#L2439) | <div id="update-status"></div> |
| [2440](#L2440) | <table class="wp-list-table widefat fixed media" cellspacing="0"> |
| [2441](#L2441) | <thead> |
| [2442](#L2442) | <tr> |
| [2443](#L2443) | <th scope="col"><?php \_e( 'Slide Image' , 'customizr' ) ?></th> |
| [2444](#L2444) | <th scope="col"><?php \_e( 'Title' , 'customizr' ) ?></th> |
| [2445](#L2445) | <th scope="col" style="width: 35%"><?php \_e( 'Slide Text' , 'customizr' ) ?></th> |
| [2446](#L2446) | <th scope="col"><?php \_e( 'Button Text' , 'customizr' ) ?></th> |
| [2447](#L2447) | <th scope="col"><?php \_e( 'Link' , 'customizr' ) ?></th> |
| [2448](#L2448) | <th scope="col"><?php \_e( 'Edit' , 'customizr' ) ?></th> |
| [2449](#L2449) | </tr> |
| [2450](#L2450) | </thead> |
| [2451](#L2451) | <tbody id="sortable"> |
| [2452](#L2452) | <?php |
| [2453](#L2453) | //loop on the slides and render if the selected slider is checked |
| [2454](#L2454) | foreach ( $current\_post\_slides as $index => $slide) { |
| [2455](#L2455) | //get the attachment object |
| [2456](#L2456) | $tc\_slide = get\_post( $slide ); |
| [2457](#L2457) |  |
| [2458](#L2458) | //check if $tc\_slide object exists otherwise go to the next iteration |
| [2459](#L2459) | if (!isset( $tc\_slide)) |
| [2460](#L2460) | continue; |
| [2461](#L2461) |  |
| [2462](#L2462) | //check if slider is checked for this attachment => otherwise go to the next iteration |
| [2463](#L2463) | $slider\_check\_value     = esc\_attr(get\_post\_meta( $tc\_slide->ID, $key = 'slider\_check\_key' , $single = true )); |
| [2464](#L2464) | if ( $slider\_check\_value == false) |
| [2465](#L2465) | continue; |
| [2466](#L2466) |  |
| [2467](#L2467) | //set up variables |
| [2468](#L2468) | $id                   = $tc\_slide->ID; |
| [2469](#L2469) | $slide\_src             = wp\_get\_attachment\_image\_src( $id, 'thumbnail' ); |
| [2470](#L2470) | $slide\_url             = $slide\_src[0]; |
| [2471](#L2471) | $title                 = esc\_attr(get\_post\_meta( $id, $key = 'slide\_title\_key' , $single = true )); |
| [2472](#L2472) | $text                  = esc\_html(get\_post\_meta( $id, $key = 'slide\_text\_key' , $single = true )); |
| [2473](#L2473) | $text\_color            = esc\_attr(get\_post\_meta( $id, $key = 'slide\_color\_key' , $single = true )); |
| [2474](#L2474) | $button\_text           = esc\_attr(get\_post\_meta( $id, $key = 'slide\_button\_key' , $single = true )); |
| [2475](#L2475) | $link                  = esc\_url(get\_post\_meta( $id, $key = 'slide\_custom\_link\_key' , $single = true )); |
| [2476](#L2476) | $button\_link           = esc\_attr(get\_post\_meta( $id, $key = 'slide\_link\_key' , $single = true )); |
| [2477](#L2477) |  |
| [2478](#L2478) | //check if $text\_color is set and create an html style attribute |
| [2479](#L2479) | $color\_style =''; |
| [2480](#L2480) | if( $text\_color != null) { |
| [2481](#L2481) | $color\_style = 'style="color:'.$text\_color.'"'; |
| [2482](#L2482) | } |
| [2483](#L2483) | ?> |
| [2484](#L2484) | <tr id="<?php echo $index ?>" class="ui-state-default" valign="middle"> |
| [2485](#L2485) | <td style="vertical-align:middle" class="column-icon"> |
| [2486](#L2486) | <?php if( $slide\_url != null) : ?> |
| [2487](#L2487) | <img width="100" height="100" src="<?php echo $slide\_url; ?>" class="attachment-80x60" alt="Hydrangeas"> |
| [2488](#L2488) | <?php else : ?> |
| [2489](#L2489) | <div style="height:100px;width:100px;background:#eee;text-align:center;line-height:100px;vertical-align:middle"> |
| [2490](#L2490) | <?php \_e( 'No Image Selected' , 'customizr' ); ?> |
| [2491](#L2491) | </div> |
| [2492](#L2492) | <?php endif; ?> |
| [2493](#L2493) | </td> |
| [2494](#L2494) | <td style="vertical-align:middle" class=""> |
| [2495](#L2495) | <?php if( $title != null) : ?> |
| [2496](#L2496) | <p <?php echo $color\_style ?>><strong><?php echo $title ?></strong></p> |
| [2497](#L2497) | <?php endif; ?> |
| [2498](#L2498) | </td> |
| [2499](#L2499) | <td style="vertical-align:middle" class=""> |
| [2500](#L2500) | <?php if( $text != null) : ?> |
| [2501](#L2501) | <p <?php echo $color\_style ?> class="lead"><?php echo $text ?></p> |
| [2502](#L2502) | <?php endif; ?> |
| [2503](#L2503) | </td> |
| [2504](#L2504) | <td style="vertical-align:middle" class=""> |
| [2505](#L2505) | <?php if( $button\_text != null) : ?> |
| [2506](#L2506) | <p class="btn btn-large btn-primary"><?php echo $button\_text; ?></p> |
| [2507](#L2507) | <?php endif; ?> |
| [2508](#L2508) | </td> |
| [2509](#L2509) | <td style="vertical-align:middle" class=""> |
| [2510](#L2510) | <?php if( $button\_link != null || $link != null ) : ?> |
| [2511](#L2511) | <p class="btn btn-large btn-primary" href="<?php echo $link ? $link : get\_permalink( $button\_link); ?>"><?php echo $link ? $link : get\_the\_title( $button\_link); ?></p> |
| [2512](#L2512) | <?php endif; ?> |
| [2513](#L2513) | </td> |
| [2514](#L2514) | <td style="vertical-align:middle" class=""> |
| [2515](#L2515) | <?php if( $id != $current\_attachement\_id) : ?> |
| [2516](#L2516) | <a class="button-primary" href="<?php echo admin\_url( 'post.php?post='.$id.'&action=edit' ) ?>" target="\_blank"><?php \_e( 'Edit this slide' , 'customizr' )?></a> |
| [2517](#L2517) | <?php else : ?> |
| [2518](#L2518) | <span style="color:#999898"><?php \_e( 'Current slide' , 'customizr' )?></span> |
| [2519](#L2519) | <?php endif; ?> |
| [2520](#L2520) | </td> |
| [2521](#L2521) | </tr> |
| [2522](#L2522) | <?php |
| [2523](#L2523) | }//end foreach |
| [2524](#L2524) | echo '</tbody></table><br/>'; |
| [2525](#L2525) | ?> |
| [2526](#L2526) | <div class="tc-add-slide-notice"> |
| [2527](#L2527) | <?php |
| [2528](#L2528) | printf('<p>%1$s</p><p>%2$s <a href="%3$s" title="%4$s" target="\_blank">%4$s &raquo;</a>.</p>', |
| [2529](#L2529) | \_\_('To add another slide : navigate to your media library (click on Media), open the edit screen of an image ( or add a new image ), and add it to your desired slider by using the dedicated option block at the bottom of the page.' , 'customizr'), |
| [2530](#L2530) | \_\_('For more informations about sliders, check the documentation page :' , 'customizr'), |
| [2531](#L2531) | esc\_url('http://docs.presscustomizr.com/search?query=slider'), |
| [2532](#L2532) | \_\_('Slider documentation' , 'customizr') |
| [2533](#L2533) | ); |
| [2534](#L2534) | ?> |
| [2535](#L2535) | </div> |
| [2536](#L2536) | </div><!-- //#tc\_slides\_table --> |
| [2537](#L2537) | <?php endif; // empty( $current\_post\_slides? ?> |
| [2538](#L2538) | <?php |
| [2539](#L2539) | } |
| [2540](#L2540) |  |
| [2541](#L2541) |  |
| [2542](#L2542) |  |
| [2543](#L2543) |  |
| [2544](#L2544) |  |
| [2545](#L2545) | /\* |
| [2546](#L2546) | ---------------------------------------------------------------- |
| [2547](#L2547) | ---------------- AJAX SAVE (post and attachment) --------------- |
| [2548](#L2548) | ---------------------------------------------------------------- |
| [2549](#L2549) | \*/ |
| [2550](#L2550) | /\*\* |
| [2551](#L2551) | \* Ajax saving of options and meta fields in DB for post and attachement screens |
| [2552](#L2552) | \* works along with tc\_ajax\_slider.js |
| [2553](#L2553) | \* @package Customizr |
| [2554](#L2554) | \* @since Customizr 2.0 |
| [2555](#L2555) | \*/ |
| [2556](#L2556) | function czr\_fn\_slider\_ajax\_save( $post\_id ) { |
| [2557](#L2557) |  |
| [2558](#L2558) | //We check the ajax nonce (common for post and attachment) |
| [2559](#L2559) | if ( isset( $\_POST['SliderCheckNonce']) && !wp\_verify\_nonce( $\_POST['SliderCheckNonce'], 'tc-slider-check-nonce' ) ) |
| [2560](#L2560) | return; |
| [2561](#L2561) |  |
| [2562](#L2562) | // Check permissions |
| [2563](#L2563) | if ( !current\_user\_can( 'edit\_post' , $post\_id ) ) |
| [2564](#L2564) | return; |
| [2565](#L2565) |  |
| [2566](#L2566) | // Do we have a post\_id? |
| [2567](#L2567) | if ( !isset( $\_POST['tc\_post\_id'])) { |
| [2568](#L2568) | return; |
| [2569](#L2569) | } |
| [2570](#L2570) | else { |
| [2571](#L2571) | $post\_ID = $\_POST['tc\_post\_id']; |
| [2572](#L2572) | } |
| [2573](#L2573) |  |
| [2574](#L2574) | //OPTION FIELDS |
| [2575](#L2575) | //get options and some useful $\_POST vars |
| [2576](#L2576) | $czr\_options                = get\_option( 'tc\_theme\_options' ); |
| [2577](#L2577) |  |
| [2578](#L2578) | if (isset( $\_POST['tc\_post\_type'])) |
| [2579](#L2579) | $tc\_post\_type            = esc\_attr( $\_POST['tc\_post\_type']); |
| [2580](#L2580) | if (isset( $\_POST['currentpostslider'])) |
| [2581](#L2581) | $current\_post\_slider      = esc\_attr( $\_POST['currentpostslider']); |
| [2582](#L2582) | if (isset( $\_POST['new\_slider\_name'])) |
| [2583](#L2583) | $new\_slider\_name         = esc\_attr( $\_POST['new\_slider\_name'] ); |
| [2584](#L2584) |  |
| [2585](#L2585) | //Save user input by looping on the fields |
| [2586](#L2586) | foreach ( $\_POST as $tckey => $tcvalue) { |
| [2587](#L2587) | switch ( $tckey) { |
| [2588](#L2588) | //delete slider |
| [2589](#L2589) | case 'delete\_slider': |
| [2590](#L2590) | //first we delete the meta fields related to the deleted slider |
| [2591](#L2591) | //which screen are we coming from? |
| [2592](#L2592) | if( $tc\_post\_type == 'attachment' ) { |
| [2593](#L2593) | query\_posts( 'meta\_key=post\_slider\_key&meta\_value='.$current\_post\_slider); |
| [2594](#L2594) | //we loop the posts with the deleted slider meta key |
| [2595](#L2595) | if(have\_posts()) { |
| [2596](#L2596) | while ( have\_posts() ) : the\_post(); |
| [2597](#L2597) | //delete the post meta |
| [2598](#L2598) | delete\_post\_meta(get\_the\_ID(), $key = 'post\_slider\_key' ); |
| [2599](#L2599) | endwhile; |
| [2600](#L2600) | } |
| [2601](#L2601) | wp\_reset\_query(); |
| [2602](#L2602) | } |
| [2603](#L2603) |  |
| [2604](#L2604) | //we delete from the post/page screen |
| [2605](#L2605) | else { |
| [2606](#L2606) | $post\_slider\_meta = esc\_attr(get\_post\_meta( $post\_ID, $key = 'post\_slider\_key' , $single = true )); |
| [2607](#L2607) | if(!empty( $post\_slider\_meta)) { |
| [2608](#L2608) | delete\_post\_meta( $post\_ID, $key = 'post\_slider\_key' ); |
| [2609](#L2609) | } |
| [2610](#L2610) | } |
| [2611](#L2611) |  |
| [2612](#L2612) | //in all cases, delete DB option |
| [2613](#L2613) | unset( $czr\_options['tc\_sliders'][$current\_post\_slider]); |
| [2614](#L2614) | //update DB with new slider array |
| [2615](#L2615) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2616](#L2616) | break; |
| [2617](#L2617) |  |
| [2618](#L2618) |  |
| [2619](#L2619) | //reorder slides |
| [2620](#L2620) | case 'newOrder': |
| [2621](#L2621) | //turn new order into array |
| [2622](#L2622) | if(!empty( $tcvalue)) |
| [2623](#L2623) |  |
| [2624](#L2624) | $neworder = explode( ',' , esc\_attr( $tcvalue )); |
| [2625](#L2625) |  |
| [2626](#L2626) | //initialize the newslider array |
| [2627](#L2627) | $newslider = array(); |
| [2628](#L2628) |  |
| [2629](#L2629) | foreach ( $neworder as $new\_key => $new\_index) { |
| [2630](#L2630) | $newslider[$new\_index] =  $czr\_options['tc\_sliders'][$current\_post\_slider][$new\_index]; |
| [2631](#L2631) | } |
| [2632](#L2632) |  |
| [2633](#L2633) | $czr\_options['tc\_sliders'][$current\_post\_slider] = $newslider; |
| [2634](#L2634) |  |
| [2635](#L2635) | //update DB with new slider array |
| [2636](#L2636) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2637](#L2637) | break; |
| [2638](#L2638) |  |
| [2639](#L2639) |  |
| [2640](#L2640) |  |
| [2641](#L2641) |  |
| [2642](#L2642) | //sliders are added in options |
| [2643](#L2643) | case 'new\_slider\_name': |
| [2644](#L2644) | //check if we have something to save |
| [2645](#L2645) | $new\_slider\_name                               = esc\_attr( $tcvalue ); |
| [2646](#L2646) | $delete\_slider                                 = false; |
| [2647](#L2647) | if ( isset( $\_POST['delete\_slider'])) |
| [2648](#L2648) | $delete\_slider                             = $\_POST['delete\_slider']; |
| [2649](#L2649) |  |
| [2650](#L2650) | //prevent saving if we delete |
| [2651](#L2651) | if (!empty( $new\_slider\_name) && $delete\_slider != true) { |
| [2652](#L2652) | $new\_slider\_name                           = wp\_filter\_nohtml\_kses( $tcvalue ); |
| [2653](#L2653) | //remove spaces and special char |
| [2654](#L2654) | $new\_slider\_name                           = strtolower(preg\_replace("![^a-z0-9]+!i", "-", $new\_slider\_name)); |
| [2655](#L2655) |  |
| [2656](#L2656) | $czr\_options['tc\_sliders'][$new\_slider\_name]      = array( $post\_ID); |
| [2657](#L2657) | //adds the new slider name in DB options |
| [2658](#L2658) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2659](#L2659) | //associate the current post with the new saved slider |
| [2660](#L2660) |  |
| [2661](#L2661) | //looks for a previous slider entry and delete it |
| [2662](#L2662) | foreach ( $czr\_options['tc\_sliders'] as $slider\_name => $slider) { |
| [2663](#L2663) |  |
| [2664](#L2664) | foreach ( $slider as $key => $tc\_post) { |
| [2665](#L2665) | //clean empty values if necessary |
| [2666](#L2666) | if ( is\_null( $czr\_options['tc\_sliders'][$slider\_name][$key])) |
| [2667](#L2667) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2668](#L2668) |  |
| [2669](#L2669) | //delete previous slider entries for this post |
| [2670](#L2670) | if ( $tc\_post == $post\_ID ) |
| [2671](#L2671) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2672](#L2672) | } |
| [2673](#L2673) | } |
| [2674](#L2674) |  |
| [2675](#L2675) | //update DB with clean option table |
| [2676](#L2676) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2677](#L2677) |  |
| [2678](#L2678) | //push new post value for the new slider and write in DB |
| [2679](#L2679) | array\_push( $czr\_options['tc\_sliders'][$new\_slider\_name], $post\_ID); |
| [2680](#L2680) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2681](#L2681) |  |
| [2682](#L2682) | } |
| [2683](#L2683) |  |
| [2684](#L2684) | break; |
| [2685](#L2685) |  |
| [2686](#L2686) | //post slider value |
| [2687](#L2687) | case 'post\_slider\_name': |
| [2688](#L2688) | //check if we display the attachment screen |
| [2689](#L2689) | if (!isset( $\_POST['slider\_check\_field'])) { |
| [2690](#L2690) | break; |
| [2691](#L2691) | } |
| [2692](#L2692) | //we are in the attachment screen and we uncheck slider options checkbox |
| [2693](#L2693) | elseif ( $\_POST['slider\_check\_field'] == 0) { |
| [2694](#L2694) | break; |
| [2695](#L2695) | } |
| [2696](#L2696) |  |
| [2697](#L2697) | //if we are in the slider creation case, the selected slider has to be the new one! |
| [2698](#L2698) | if (!empty( $new\_slider\_name)) |
| [2699](#L2699) | break; |
| [2700](#L2700) |  |
| [2701](#L2701) | //check if we have something to save |
| [2702](#L2702) | $post\_slider\_name                  = esc\_attr( $tcvalue ); |
| [2703](#L2703) |  |
| [2704](#L2704) | //check if we have an input and if we are not in the slider creation case |
| [2705](#L2705) | if (!empty( $post\_slider\_name)) { |
| [2706](#L2706) |  |
| [2707](#L2707) | $post\_slider\_name               = wp\_filter\_nohtml\_kses( $post\_slider\_name ); |
| [2708](#L2708) | //looks for a previous slider entry and delete it. |
| [2709](#L2709) | //Important : we check if the slider has slides first! |
| [2710](#L2710) | foreach ( $czr\_options['tc\_sliders'] as $slider\_name => $slider) { |
| [2711](#L2711) | foreach ( $slider as $key => $tc\_post) { |
| [2712](#L2712) |  |
| [2713](#L2713) | //clean empty values if necessary |
| [2714](#L2714) | if ( is\_null( $czr\_options['tc\_sliders'][$slider\_name][$key])) { |
| [2715](#L2715) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2716](#L2716) | } |
| [2717](#L2717) |  |
| [2718](#L2718) | //clean slides with no images |
| [2719](#L2719) | $slide\_img = wp\_get\_attachment\_image( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2720](#L2720) | if (isset($slide\_img) && empty($slide\_img)) { |
| [2721](#L2721) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2722](#L2722) | } |
| [2723](#L2723) |  |
| [2724](#L2724) | //delete previous slider entries for this post |
| [2725](#L2725) | if ( $tc\_post == $post\_ID ) { |
| [2726](#L2726) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2727](#L2727) | } |
| [2728](#L2728) |  |
| [2729](#L2729) | }//end for each |
| [2730](#L2730) | } |
| [2731](#L2731) | //update DB with clean option table |
| [2732](#L2732) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2733](#L2733) |  |
| [2734](#L2734) | //check if the selected slider is empty and set it as array |
| [2735](#L2735) | if( empty( $czr\_options['tc\_sliders'][$post\_slider\_name]) ) { |
| [2736](#L2736) | $czr\_options['tc\_sliders'][$post\_slider\_name] = array(); |
| [2737](#L2737) | } |
| [2738](#L2738) |  |
| [2739](#L2739) | //push new post value for the slider and write in DB |
| [2740](#L2740) | array\_push( $czr\_options['tc\_sliders'][$post\_slider\_name], $post\_ID); |
| [2741](#L2741) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2742](#L2742) | }//end if !empty( $post\_slider\_name) |
| [2743](#L2743) |  |
| [2744](#L2744) | //No slider selected |
| [2745](#L2745) | else { |
| [2746](#L2746) | //looks for a previous slider entry and delete it |
| [2747](#L2747) | foreach ( $czr\_options['tc\_sliders'] as $slider\_name => $slider) { |
| [2748](#L2748) | foreach ( $slider as $key => $tc\_post) { |
| [2749](#L2749) | //clean empty values if necessary |
| [2750](#L2750) | if ( is\_null( $czr\_options['tc\_sliders'][$slider\_name][$key])) |
| [2751](#L2751) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2752](#L2752) | //delete previous slider entries for this post |
| [2753](#L2753) | if ( $tc\_post == $post\_ID ) |
| [2754](#L2754) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2755](#L2755) | } |
| [2756](#L2756) | } |
| [2757](#L2757) | //update DB with clean option table |
| [2758](#L2758) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2759](#L2759) | } |
| [2760](#L2760) | break; |
| [2761](#L2761) | }//end switch |
| [2762](#L2762) | }//end foreach |
| [2763](#L2763) |  |
| [2764](#L2764) | //POST META FIELDS |
| [2765](#L2765) | //set up the fields array |
| [2766](#L2766) | $tc\_slider\_fields = array( |
| [2767](#L2767) | //posts & pages |
| [2768](#L2768) | 'post\_slider\_name'           => 'post\_slider\_key' , |
| [2769](#L2769) | 'post\_slider\_check\_field'     => 'post\_slider\_check\_key' , |
| [2770](#L2770) | //attachments |
| [2771](#L2771) | 'slider\_check\_field'         => 'slider\_check\_key' , |
| [2772](#L2772) | ); |
| [2773](#L2773) |  |
| [2774](#L2774) | do\_action( "\_\_before\_ajax\_save\_slider\_{$tc\_post\_type}", $\_POST, $tc\_slider\_fields ); |
| [2775](#L2775) | //sanitize user input by looping on the fields |
| [2776](#L2776) | foreach ( $tc\_slider\_fields as $tcid => $tckey) { |
| [2777](#L2777) | if ( isset( $\_POST[$tcid])) { |
| [2778](#L2778) | switch ( $tckey) { |
| [2779](#L2779) | //different sanitizations |
| [2780](#L2780) | //the slider name custom field for a post/page |
| [2781](#L2781) | case 'post\_slider\_key' : |
| [2782](#L2782) | $mydata = esc\_attr( $\_POST[$tcid] ); |
| [2783](#L2783) | //Does the selected slider still exists in options? (we first check if the selected slider is not empty) |
| [2784](#L2784) | if(!empty( $mydata) && !isset( $czr\_options['tc\_sliders'][$mydata])) |
| [2785](#L2785) | break; |
| [2786](#L2786) |  |
| [2787](#L2787) | //write in DB |
| [2788](#L2788) | add\_post\_meta( $post\_ID, $tckey, $mydata, true) or |
| [2789](#L2789) | update\_post\_meta( $post\_ID, $tckey , $mydata); |
| [2790](#L2790) | break; |
| [2791](#L2791) |  |
| [2792](#L2792) |  |
| [2793](#L2793) | //inserted/updated in all cases |
| [2794](#L2794) | case 'post\_slider\_check\_key': |
| [2795](#L2795) | case 'slider\_check\_key': |
| [2796](#L2796) | $mydata = esc\_attr( $\_POST[$tcid] ); |
| [2797](#L2797) | //write in DB |
| [2798](#L2798) | add\_post\_meta( $post\_ID, $tckey, $mydata, true) or |
| [2799](#L2799) | update\_post\_meta( $post\_ID, $tckey , $mydata); |
| [2800](#L2800) |  |
| [2801](#L2801) | //check if we are in the attachment screen AND slider unchecked |
| [2802](#L2802) | if( $tckey == 'slider\_check\_key' && esc\_attr( $\_POST[$tcid] ) == 0) { |
| [2803](#L2803) |  |
| [2804](#L2804) | //if we uncheck the attachement slider, looks for a previous entry and delete it. |
| [2805](#L2805) | //Important : we check if the slider has slides first! |
| [2806](#L2806) | if ( isset( $czr\_options['tc\_sliders'])) { |
| [2807](#L2807) | foreach ( $czr\_options['tc\_sliders'] as $slider\_name => $slider) { |
| [2808](#L2808) | foreach ( $slider as $key => $tc\_post) { |
| [2809](#L2809) | //clean empty values if necessary |
| [2810](#L2810) | if ( is\_null( $czr\_options['tc\_sliders'][$slider\_name][$key])) |
| [2811](#L2811) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2812](#L2812) | //delete previous slider entries for this post |
| [2813](#L2813) | if ( $tc\_post == $post\_ID ) |
| [2814](#L2814) | unset( $czr\_options['tc\_sliders'][$slider\_name][$key]); |
| [2815](#L2815) | } |
| [2816](#L2816) | } |
| [2817](#L2817) | } |
| [2818](#L2818) | //update DB with clean option table |
| [2819](#L2819) | update\_option( 'tc\_theme\_options' , $czr\_options ); |
| [2820](#L2820) |  |
| [2821](#L2821) | }//endif; |
| [2822](#L2822) |  |
| [2823](#L2823) | break; |
| [2824](#L2824) | }//end switchendif; |
| [2825](#L2825) | }//end if ( isset( $\_POST[$tcid])) { |
| [2826](#L2826) | }//end foreach |
| [2827](#L2827) | //attachments |
| [2828](#L2828) | if( $tc\_post\_type == 'attachment' ) |
| [2829](#L2829) | $this->czr\_fn\_slide\_save( $post\_ID ); |
| [2830](#L2830) |  |
| [2831](#L2831) | do\_action( "\_\_after\_ajax\_save\_slider\_{$tc\_post\_type}", $\_POST, $tc\_slider\_fields ); |
| [2832](#L2832) | }//function |
| [2833](#L2833) |  |
| [2834](#L2834) |  |
| [2835](#L2835) |  |
| [2836](#L2836) |  |
| [2837](#L2837) |  |
| [2838](#L2838) |  |
| [2839](#L2839) | /\* |
| [2840](#L2840) | ---------------------------------------------------------------- |
| [2841](#L2841) | -------- AJAX CALL BACK FUNCTION (post and attachment) --------- |
| [2842](#L2842) | ---------------------------------------------------------------- |
| [2843](#L2843) | \*/ |
| [2844](#L2844) |  |
| [2845](#L2845) | /\*\* |
| [2846](#L2846) | \* Global slider ajax call back function : 1-Saves options and fields, 2-Renders |
| [2847](#L2847) | \* Used in post or attachment context => uses post\_slider var to check the context |
| [2848](#L2848) | \* Works along with tc\_ajax\_slider.js |
| [2849](#L2849) | \* @package Customizr |
| [2850](#L2850) | \* @since Customizr 2.0 |
| [2851](#L2851) | \*/ |
| [2852](#L2852) | function czr\_fn\_slider\_cb() { |
| [2853](#L2853) |  |
| [2854](#L2854) | $nonce = $\_POST['SliderCheckNonce']; |
| [2855](#L2855) | // check if the submitted nonce matches with the generated nonce we created earlier |
| [2856](#L2856) | if ( ! wp\_verify\_nonce( $nonce, 'tc-slider-check-nonce' ) ) { |
| [2857](#L2857) | die(); |
| [2858](#L2858) | } |
| [2859](#L2859) |  |
| [2860](#L2860) | Try{ |
| [2861](#L2861) | //get the post\_id with the hidden input field |
| [2862](#L2862) | $tc\_post\_id         = $\_POST['tc\_post\_id']; |
| [2863](#L2863) |  |
| [2864](#L2864) | //save $\_POST var in DB |
| [2865](#L2865) | $this->czr\_fn\_slider\_ajax\_save( $tc\_post\_id); |
| [2866](#L2866) |  |
| [2867](#L2867) | //check if we are in the post or attachment screen and select the appropriate rendering |
| [2868](#L2868) | //we use the post\_slider var defined in tc\_ajax\_slider.js |
| [2869](#L2869) | if ( isset( $\_POST['tc\_post\_type'])) { |
| [2870](#L2870) | if( $\_POST['tc\_post\_type'] == 'post' ) { |
| [2871](#L2871) | $this->czr\_fn\_get\_post\_slider\_infos( $tc\_post\_id ); |
| [2872](#L2872) | } |
| [2873](#L2873) | else { |
| [2874](#L2874) | $this->czr\_fn\_get\_attachment\_slider\_infos( $tc\_post\_id ); |
| [2875](#L2875) | } |
| [2876](#L2876) | } |
| [2877](#L2877) | //echo $\_POST['slider\_id']; |
| [2878](#L2878) | } catch (Exception $e){ |
| [2879](#L2879) | exit; |
| [2880](#L2880) | } |
| [2881](#L2881) | exit; |
| [2882](#L2882) | } |
| [2883](#L2883) |  |
| [2884](#L2884) |  |
| [2885](#L2885) |  |
| [2886](#L2886) |  |
| [2887](#L2887) |  |
| [2888](#L2888) |  |
| [2889](#L2889) | /\*\* |
| [2890](#L2890) | \* Loads the necessary scripts and stylesheets to display slider options |
| [2891](#L2891) | \* @package Customizr |
| [2892](#L2892) | \* @since Customizr 1.0 |
| [2893](#L2893) | \* @hook czr\_slider\_metabox\_added |
| [2894](#L2894) | \*/ |
| [2895](#L2895) | function czr\_fn\_slider\_admin\_scripts( $post ) { |
| [2896](#L2896) |  |
| [2897](#L2897) | $\_min\_version = ( !$this->\_minify\_resources ) ? '' : '.min'; |
| [2898](#L2898) |  |
| [2899](#L2899) |  |
| [2900](#L2900) | //load scripts only for creating and editing slides options in pages and posts |
| [2901](#L2901) | if ( did\_action( 'tc\_attachment\_metabox\_added' ) ) { |
| [2902](#L2902) | wp\_enqueue\_script( 'jquery-ui-sortable' ); |
| [2903](#L2903) | } |
| [2904](#L2904) |  |
| [2905](#L2905) |  |
| [2906](#L2906) | do\_action( 'tc\_enqueue\_ajax\_slider\_before' ); |
| [2907](#L2907) |  |
| [2908](#L2908) | //ajax refresh for slider options |
| [2909](#L2909) | wp\_enqueue\_script( 'czr\_ajax\_slider' , |
| [2910](#L2910) | sprintf('%1$sback/js/tc\_ajax\_slider%2$s.js' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, $\_min\_version ), |
| [2911](#L2911) | array( 'jquery' ), |
| [2912](#L2912) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER, |
| [2913](#L2913) | true |
| [2914](#L2914) | ); |
| [2915](#L2915) |  |
| [2916](#L2916) | // Tips to declare javascript variables http://www.garyc40.com/2010/03/5-tips-for-using-ajax-in-wordpress/#bad-ways |
| [2917](#L2917) | wp\_localize\_script( 'czr\_ajax\_slider' , 'SliderAjax' , array( |
| [2918](#L2918) | // URL to wp-admin/admin-ajax.php to process the request |
| [2919](#L2919) | //'ajaxurl'         => admin\_url( 'admin-ajax.php' ), |
| [2920](#L2920) | // generate a nonce with a unique ID "myajax-post-comment-nonce" |
| [2921](#L2921) | // so that you can check it later when an AJAX request is sent |
| [2922](#L2922) | 'SliderNonce' => wp\_create\_nonce( 'tc-slider-nonce' ), |
| [2923](#L2923) | 'SliderCheckNonce' => wp\_create\_nonce( 'tc-slider-check-nonce' ), |
| [2924](#L2924) | ) |
| [2925](#L2925) | ); |
| [2926](#L2926) |  |
| [2927](#L2927) | //thickbox |
| [2928](#L2928) | wp\_admin\_css( 'thickbox' ); |
| [2929](#L2929) | add\_thickbox(); |
| [2930](#L2930) |  |
| [2931](#L2931) | //sortable stuffs |
| [2932](#L2932) | wp\_enqueue\_style( 'sortablecss' , |
| [2933](#L2933) | sprintf('%1$sback/css/tc\_sortable%2$s.css' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, $\_min\_version ) |
| [2934](#L2934) | ); |
| [2935](#L2935) |  |
| [2936](#L2936) | //wp built-in color picker style and script |
| [2937](#L2937) | //Access the global $wp\_version variable to see which version of WordPress is installed. |
| [2938](#L2938) | global $wp\_version; |
| [2939](#L2939) |  |
| [2940](#L2940) | //If the WordPress version is greater than or equal to 3.5, then load the new WordPress color picker. |
| [2941](#L2941) | if ( 3.5 <= $wp\_version ){ |
| [2942](#L2942) | //Both the necessary css and javascript have been registered already by WordPress, so all we have to do is load them with their handle. |
| [2943](#L2943) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [2944](#L2944) | wp\_enqueue\_script( 'wp-color-picker' ); |
| [2945](#L2945) | // load the minified version of custom script |
| [2946](#L2946) | wp\_enqueue\_script( 'cp\_demo-custom' , |
| [2947](#L2947) | sprintf('%1$sback/js/color-picker%2$s.js' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX , $\_min\_version ), |
| [2948](#L2948) | array( 'jquery' , 'wp-color-picker' ), |
| [2949](#L2949) | true |
| [2950](#L2950) | ); |
| [2951](#L2951) | } |
| [2952](#L2952) | //If the WordPress version is less than 3.5 load the older farbtasic color picker. |
| [2953](#L2953) | else { |
| [2954](#L2954) | //As with wp-color-picker the necessary css and javascript have been registered already by WordPress, so all we have to do is load them with their handle. |
| [2955](#L2955) | wp\_enqueue\_style( 'farbtastic' ); |
| [2956](#L2956) | wp\_enqueue\_script( 'farbtastic' ); |
| [2957](#L2957) | // load the minified version of custom script |
| [2958](#L2958) | wp\_enqueue\_script( |
| [2959](#L2959) | 'cp\_demo-custom' , |
| [2960](#L2960) | sprintf('%1$sback/js/color-picker%2$s.js' ,  CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, $\_min\_version ), |
| [2961](#L2961) | array( 'jquery' , 'farbtastic' ), |
| [2962](#L2962) | ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? CUSTOMIZR\_VER . time() : CUSTOMIZR\_VER, |
| [2963](#L2963) | true |
| [2964](#L2964) | ); |
| [2965](#L2965) | } |
| [2966](#L2966) |  |
| [2967](#L2967) | do\_action( 'tc\_enqueue\_ajax\_slider\_after' ); |
| [2968](#L2968) |  |
| [2969](#L2969) | } |
| [2970](#L2970) |  |
| [2971](#L2971) | /\*\* |
| [2972](#L2972) | \* Loads the necessary scripts for the post formats metaboxes |
| [2973](#L2973) | \* @package Customizr |
| [2974](#L2974) | \* @since Customizr 4.0 |
| [2975](#L2975) | \* @hook czr\_post\_formats\_metabox\_added |
| [2976](#L2976) | \*/ |
| [2977](#L2977) |  |
| [2978](#L2978) | function czr\_fn\_post\_formats\_admin\_scripts( $post ) { |
| [2979](#L2979) |  |
| [2980](#L2980) | $\_ext = $this->\_minify\_resources ? '.min.js' : '.js'; |
| [2981](#L2981) |  |
| [2982](#L2982) | wp\_enqueue\_script( 'czr-post-formats' , |
| [2983](#L2983) | sprintf('%1$sback/js/czr\_post\_formats%2$s' , CZR\_BASE\_URL . CZR\_ASSETS\_PREFIX, $\_ext ), |
| [2984](#L2984) | array( 'jquery', 'underscore' ), |
| [2985](#L2985) | $this->\_resouces\_version, |
| [2986](#L2986) | $in\_footer = true |
| [2987](#L2987) |  |
| [2988](#L2988) | ); |
| [2989](#L2989) |  |
| [2990](#L2990) | wp\_localize\_script( 'czr-post-formats', |
| [2991](#L2991) | 'CZRPostFormatsParams' , |
| [2992](#L2992) | array( |
| [2993](#L2993) | 'postFormatSections' => $this->czr\_fn\_get\_post\_meta\_boxes\_map(), |
| [2994](#L2994) | 'currentPostFormat' => get\_post\_format( $post ), |
| [2995](#L2995) | ) |
| [2996](#L2996) | ); |
| [2997](#L2997) |  |
| [2998](#L2998) | } |
| [2999](#L2999) |  |
| [3000](#L3000) |  |
| [3001](#L3001) |  |
| [3002](#L3002) |  |
| [3003](#L3003) |  |
| [3004](#L3004) | /\* |
| [3005](#L3005) | ---------------------------------------------------------------- |
| [3006](#L3006) | ------------- ATTACHMENT FIELDS FILTER IF WP < 3.5 ------------- |
| [3007](#L3007) | ---------------------------------------------------------------- |
| [3008](#L3008) | \*/ |
| [3009](#L3009) | function czr\_fn\_attachment\_filter( $form\_fields, $post = null) { |
| [3010](#L3010) | $this->czr\_fn\_attachment\_slider\_box ( $post); |
| [3011](#L3011) | return $form\_fields; |
| [3012](#L3012) | } |
| [3013](#L3013) |  |
| [3014](#L3014) |  |
| [3015](#L3015) | function czr\_fn\_attachment\_save\_filter( $post, $attachment ) { |
| [3016](#L3016) | if ( isset( $\_POST['tc\_post\_id'])) |
| [3017](#L3017) | $postid = $\_POST['tc\_post\_id']; |
| [3018](#L3018) |  |
| [3019](#L3019) | $this->czr\_fn\_slide\_save( $postid ); |
| [3020](#L3020) |  |
| [3021](#L3021) | return $post; |
| [3022](#L3022) | } |
| [3023](#L3023) |  |
| [3024](#L3024) |  |
| [3025](#L3025) |  |
| [3026](#L3026) | /\* |
| [3027](#L3027) | ---------------------------------------------------------------- |
| [3028](#L3028) | ---------------------- STATIC FIELDS VIEWS --------------------- |
| [3029](#L3029) | ---------------------------------------------------------------- |
| [3030](#L3030) | \*/ |
| [3031](#L3031) | /\*\* |
| [3032](#L3032) | \* Build title element html |
| [3033](#L3033) | \* |
| [3034](#L3034) | \* @package Customizr |
| [3035](#L3035) | \*/ |
| [3036](#L3036) | public static function czr\_fn\_title\_view( $args ) { |
| [3037](#L3037) |  |
| [3038](#L3038) | $defaults = array( |
| [3039](#L3039) | 'title\_tag'     => 'h4', |
| [3040](#L3040) | 'wrapper\_class' => 'meta-box-item-title', |
| [3041](#L3041) | 'wrapper\_tag'   => 'div', |
| [3042](#L3042) | 'title\_text'    => '', |
| [3043](#L3043) | 'echo'          => 1, |
| [3044](#L3044) | 'boxed'         => 1, |
| [3045](#L3045) | ); |
| [3046](#L3046) |  |
| [3047](#L3047) | $args    = wp\_parse\_args( $args, $defaults ); |
| [3048](#L3048) | extract($args); |
| [3049](#L3049) |  |
| [3050](#L3050) | $content = sprintf( '<%1$s>%2$s</%1$s>', $title\_tag, $title\_text ); |
| [3051](#L3051) |  |
| [3052](#L3052) | $html    = $boxed ? CZR\_meta\_boxes::czr\_fn\_wrapper\_view( |
| [3053](#L3053) | compact( 'content', 'wrapper\_tag', 'wrapper\_class') |
| [3054](#L3054) | ) : $content; |
| [3055](#L3055) |  |
| [3056](#L3056) | if ( ! $echo ) |
| [3057](#L3057) | return $html; |
| [3058](#L3058) |  |
| [3059](#L3059) | echo $html; |
| [3060](#L3060) |  |
| [3061](#L3061) | } |
| [3062](#L3062) |  |
| [3063](#L3063) |  |
| [3064](#L3064) | /\*\* |
| [3065](#L3065) | \* Build checkbox element html |
| [3066](#L3066) | \* |
| [3067](#L3067) | \* @package Customizr |
| [3068](#L3068) | \*/ |
| [3069](#L3069) | public static function czr\_fn\_checkbox\_view( $args ) { |
| [3070](#L3070) |  |
| [3071](#L3071) | $defaults = array( |
| [3072](#L3072) | 'input\_name'     => '', |
| [3073](#L3073) | 'input\_class'    => 'czr-toggle-check\_\_input', |
| [3074](#L3074) | 'input\_state'    => '', |
| [3075](#L3075) | 'echo'          => 1, |
| [3076](#L3076) | 'boxed'         => 1, |
| [3077](#L3077) | 'input\_type'     => 'checkbox', |
| [3078](#L3078) | 'input\_value'    => '1', |
| [3079](#L3079) | 'content\_before' => '', |
| [3080](#L3080) | ); |
| [3081](#L3081) |  |
| [3082](#L3082) | $args = wp\_parse\_args( $args, $defaults ); |
| [3083](#L3083) | extract( $args ); |
| [3084](#L3084) |  |
| [3085](#L3085) | CZR\_meta\_boxes::czr\_fn\_generic\_input\_view( array\_merge( $args, array( |
| [3086](#L3086) | 'content\_before' => $content\_before . '<input name="'. $input\_name .'" type="hidden" value = "0" /><span class="czr-toggle-check">', |
| [3087](#L3087) | 'custom\_args'    => checked( $input\_state, $current = true, $c\_echo = false), |
| [3088](#L3088) | 'content\_after'  => '<span class="czr-toggle-check\_\_track"></span><span class="czr-toggle-check\_\_thumb"></span></span>' |
| [3089](#L3089) | ))); |
| [3090](#L3090) | } |
| [3091](#L3091) |  |
| [3092](#L3092) |  |
| [3093](#L3093) |  |
| [3094](#L3094) | /\*\* |
| [3095](#L3095) | \* Build selectbox element html |
| [3096](#L3096) | \* |
| [3097](#L3097) | \* @package Customizr |
| [3098](#L3098) | \*/ |
| [3099](#L3099) | public static function czr\_fn\_selectbox\_view( $args ) { |
| [3100](#L3100) | $defaults = array( |
| [3101](#L3101) | 'select\_name'    => '', |
| [3102](#L3102) | 'select\_class'   => '', |
| [3103](#L3103) | 'echo'          => 1, |
| [3104](#L3104) | 'boxed'         => 1, |
| [3105](#L3105) | 'content\_before' => '', |
| [3106](#L3106) | 'content\_after'  => '', |
| [3107](#L3107) | 'choices'        => array(), |
| [3108](#L3108) | 'selected'       => '', |
| [3109](#L3109) | 'wrapper\_tag'   => 'div', |
| [3110](#L3110) | 'wrapper\_class' => 'meta-box-item-content', |
| [3111](#L3111) | ); |
| [3112](#L3112) |  |
| [3113](#L3113) | $args = wp\_parse\_args( $args, $defaults ); |
| [3114](#L3114) | extract($args); |
| [3115](#L3115) |  |
| [3116](#L3116) | if ( ! $choices ) return; |
| [3117](#L3117) |  |
| [3118](#L3118) | $select\_id = isset($select\_id) ? $select\_id : $select\_name; |
| [3119](#L3119) |  |
| [3120](#L3120) | $options\_html = ''; |
| [3121](#L3121) |  |
| [3122](#L3122) | foreach( $choices as $key => $label ) |
| [3123](#L3123) | $options\_html .= sprintf('<option value=%1$s %2$s>%3$s</option>', |
| [3124](#L3124) | esc\_attr( $key ), |
| [3125](#L3125) | selected( $selected, esc\_attr( $key ), $s\_echo = false ), |
| [3126](#L3126) | $label |
| [3127](#L3127) | ); |
| [3128](#L3128) |  |
| [3129](#L3129) | $content = sprintf('<select name="%1$s" id ="%2$s">%3$s</select>', |
| [3130](#L3130) | $select\_name, |
| [3131](#L3131) | $select\_id, |
| [3132](#L3132) | $options\_html |
| [3133](#L3133) | ); |
| [3134](#L3134) |  |
| [3135](#L3135) | $content = $content\_before . $content . $content\_after; |
| [3136](#L3136) |  |
| [3137](#L3137) | $html    = $boxed ? CZR\_meta\_boxes::czr\_fn\_wrapper\_view( |
| [3138](#L3138) | compact( 'content', 'wrapper\_tag', 'wrapper\_class') |
| [3139](#L3139) | ) : $content; |
| [3140](#L3140) |  |
| [3141](#L3141) | $html     = ! ( isset($title) && is\_array( $title ) && ! empty( $title ) ) ? $html : |
| [3142](#L3142) | sprintf( "%s%s", |
| [3143](#L3143) | CZR\_meta\_boxes::czr\_fn\_title\_view( array\_merge($title, array( 'echo' => 0 ) ) ), |
| [3144](#L3144) | $html |
| [3145](#L3145) | ); |
| [3146](#L3146) |  |
| [3147](#L3147) | if ( ! $echo ) |
| [3148](#L3148) | return $html; |
| [3149](#L3149) |  |
| [3150](#L3150) | echo $html ; |
| [3151](#L3151) | } |
| [3152](#L3152) |  |
| [3153](#L3153) |  |
| [3154](#L3154) | /\*\* |
| [3155](#L3155) | \* Build generic input element html |
| [3156](#L3156) | \* |
| [3157](#L3157) | \* @package Customizr |
| [3158](#L3158) | \*/ |
| [3159](#L3159) | public static function czr\_fn\_generic\_input\_view( $args ) { |
| [3160](#L3160) | $defaults = array( |
| [3161](#L3161) | 'input\_name'     => '', |
| [3162](#L3162) | 'input\_class'    => 'widefat', |
| [3163](#L3163) | 'input\_type'     => 'text', |
| [3164](#L3164) | 'input\_value'    => '0', |
| [3165](#L3165) | 'custom\_args'    => '', |
| [3166](#L3166) | 'echo'          => 1, |
| [3167](#L3167) | 'boxed'         => 1, |
| [3168](#L3168) | 'content\_before' => '', |
| [3169](#L3169) | 'content\_after'  => '', |
| [3170](#L3170) | 'wrapper\_tag'   => 'div', |
| [3171](#L3171) | 'wrapper\_class' => 'meta-box-item-content', |
| [3172](#L3172) | ); |
| [3173](#L3173) |  |
| [3174](#L3174) | $args = wp\_parse\_args( $args, $defaults ); |
| [3175](#L3175) | extract($args); |
| [3176](#L3176) |  |
| [3177](#L3177) | $input\_id = isset($input\_id) ? $input\_id : $input\_name; |
| [3178](#L3178) |  |
| [3179](#L3179) | $content = sprintf('<input name="%1$s" id="%2$s" value="%3$s" %4$s class="%5$s" type="%6$s" />', |
| [3180](#L3180) | esc\_attr( $input\_name ), |
| [3181](#L3181) | esc\_attr( $input\_id ), |
| [3182](#L3182) | esc\_attr( $input\_value ), |
| [3183](#L3183) | $custom\_args, |
| [3184](#L3184) | $input\_class, |
| [3185](#L3185) | $input\_type |
| [3186](#L3186) | ); |
| [3187](#L3187) |  |
| [3188](#L3188) | $content = $content\_before . $content . $content\_after; |
| [3189](#L3189) |  |
| [3190](#L3190) | $html = $boxed ? CZR\_meta\_boxes::czr\_fn\_wrapper\_view( |
| [3191](#L3191) | compact( 'content', 'wrapper\_tag', 'wrapper\_class') |
| [3192](#L3192) | ) : $content; |
| [3193](#L3193) |  |
| [3194](#L3194) | $html = ! ( isset($title) && is\_array( $title ) && ! empty( $title ) ) ? $html : |
| [3195](#L3195) | sprintf( "%s%s", |
| [3196](#L3196) | CZR\_meta\_boxes::czr\_fn\_title\_view( array\_merge($title, array( 'echo' => 0 ) ) ), |
| [3197](#L3197) | $html |
| [3198](#L3198) | ); |
| [3199](#L3199) |  |
| [3200](#L3200) | if ( ! $echo ) |
| [3201](#L3201) | return $html; |
| [3202](#L3202) |  |
| [3203](#L3203) | echo $html ; |
| [3204](#L3204) | } |
| [3205](#L3205) |  |
| [3206](#L3206) |  |
| [3207](#L3207) | /\*\* |
| [3208](#L3208) | \* Build generic input element html |
| [3209](#L3209) | \* |
| [3210](#L3210) | \* @package Customizr |
| [3211](#L3211) | \*/ |
| [3212](#L3212) | public static function czr\_fn\_textarea\_view( $args ) { |
| [3213](#L3213) | $defaults = array( |
| [3214](#L3214) | 'input\_name'     => '', |
| [3215](#L3215) | 'input\_class'    => 'widefat', |
| [3216](#L3216) | 'input\_value'    => '0', |
| [3217](#L3217) | 'custom\_args'    => '', |
| [3218](#L3218) | 'echo'          => 1, |
| [3219](#L3219) | 'boxed'         => 1, |
| [3220](#L3220) | 'content\_before' => '', |
| [3221](#L3221) | 'content\_after'  => '', |
| [3222](#L3222) | 'rows'          => '5', |
| [3223](#L3223) | 'cols'          => '40', |
| [3224](#L3224) | 'wrapper\_tag'   => 'div', |
| [3225](#L3225) | 'wrapper\_class' => 'meta-box-item-content', |
| [3226](#L3226) | ); |
| [3227](#L3227) |  |
| [3228](#L3228) | $args = wp\_parse\_args( $args, $defaults ); |
| [3229](#L3229) | extract($args); |
| [3230](#L3230) |  |
| [3231](#L3231) | $input\_id = isset($input\_id) ? $input\_id : $input\_name; |
| [3232](#L3232) |  |
| [3233](#L3233) | $content = sprintf('<textarea name="%1$s" d="%2$s" %4$s class="%5$s" type="%6$s" rows="%6$s" cols="%7$s">%3$s</textarea>', |
| [3234](#L3234) | esc\_attr( $input\_name ), |
| [3235](#L3235) | esc\_attr( $input\_id ), |
| [3236](#L3236) | esc\_attr( $input\_value ), |
| [3237](#L3237) | $custom\_args, |
| [3238](#L3238) | $input\_class, |
| [3239](#L3239) | $rows, |
| [3240](#L3240) | $cols |
| [3241](#L3241) | ); |
| [3242](#L3242) |  |
| [3243](#L3243) | $content = $content\_before . $content . $content\_after; |
| [3244](#L3244) |  |
| [3245](#L3245) | $html = $boxed ? CZR\_meta\_boxes::czr\_fn\_wrapper\_view( |
| [3246](#L3246) | compact( 'content', 'wrapper\_tag', 'wrapper\_class') |
| [3247](#L3247) | ) : $content; |
| [3248](#L3248) |  |
| [3249](#L3249) | $html = ! ( isset($title) && is\_array( $title ) && ! empty( $title ) ) ? $html : |
| [3250](#L3250) | sprintf( "%s%s", |
| [3251](#L3251) | CZR\_meta\_boxes::czr\_fn\_title\_view( array\_merge($title, array( 'echo' => 0 ) ) ), |
| [3252](#L3252) | $html |
| [3253](#L3253) | ); |
| [3254](#L3254) |  |
| [3255](#L3255) | if ( ! $echo ) |
| [3256](#L3256) | return $html; |
| [3257](#L3257) |  |
| [3258](#L3258) | echo $html ; |
| [3259](#L3259) | } |
| [3260](#L3260) |  |
| [3261](#L3261) |  |
| [3262](#L3262) | /\*\* |
| [3263](#L3263) | \* Build generic content wrapper html |
| [3264](#L3264) | \* |
| [3265](#L3265) | \* @package Customizr |
| [3266](#L3266) | \*/ |
| [3267](#L3267) | public static function czr\_fn\_wrapper\_view( $args ) { |
| [3268](#L3268) | $defaults = array( |
| [3269](#L3269) | 'wrapper\_tag'   => 'div', |
| [3270](#L3270) | 'wrapper\_class' => 'meta-box-item-content', |
| [3271](#L3271) | 'echo'         => false, |
| [3272](#L3272) | 'content'       => '' |
| [3273](#L3273) | ); |
| [3274](#L3274) |  |
| [3275](#L3275) | $args = wp\_parse\_args( $args, $defaults ); |
| [3276](#L3276) | extract($args); |
| [3277](#L3277) |  |
| [3278](#L3278) | $html = sprintf('<%1$s class="%2$s">%3$s</%1$s>', |
| [3279](#L3279) | $wrapper\_tag, |
| [3280](#L3280) | $wrapper\_class, |
| [3281](#L3281) | $content |
| [3282](#L3282) | ); |
| [3283](#L3283) |  |
| [3284](#L3284) | if ( ! $echo ) |
| [3285](#L3285) | return $html; |
| [3286](#L3286) | echo $html; |
| [3287](#L3287) | } |
| [3288](#L3288) |  |
| [3289](#L3289) | }//end of class |
| [3290](#L3290) | endif; |
| [3291](#L3291) |  |
| [3292](#L3292) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/customizr/4.3.1/core/czr-admin-ccat.php?rev=135570&format=txt)
* [Original Format](/export/135570/customizr/4.3.1/core/czr-admin-ccat.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

