

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Krzysztof Wilczyński <kwilczynski@kernel.org> | 2024-07-04 14:40:53 +0000 |
| commit | [8e0f5a96c534f781e8c57ca30459448b3bfe5429](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)) | |
| tree | [517101e711fd5a87317239352330598fc85eb70c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) | |
| parent | [03377a698926e829321fcd42789892cb5974b6b6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=03377a698926e829321fcd42789892cb5974b6b6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429&id2=03377a698926e829321fcd42789892cb5974b6b6)) | |
| download | [linux-8e0f5a96c534f781e8c57ca30459448b3bfe5429.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8e0f5a96c534f781e8c57ca30459448b3bfe5429.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex 8e779eecd62d41..7f05a44e9a9fde 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=03377a698926e829321fcd42789892cb5974b6b6)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)@@ -1018,8 +1018,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1338,10 +1340,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:03 +0000

