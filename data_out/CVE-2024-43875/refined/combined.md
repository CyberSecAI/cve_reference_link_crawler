=== Content from git.kernel.org_feb38c5d_20250111_104924.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:54:00 +0200 |
| commit | [0e27e2e8697b8ce96cdef43f135426525d9d1f8f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)) | |
| tree | [4a5267b4b540487a9360dff13fb36249987a606e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f) | |
| parent | [99b642dac24f6d09ba3ebf1d690be8aefff86164](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=99b642dac24f6d09ba3ebf1d690be8aefff86164) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f&id2=99b642dac24f6d09ba3ebf1d690be8aefff86164)) | |
| download | [linux-0e27e2e8697b8ce96cdef43f135426525d9d1f8f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0e27e2e8697b8ce96cdef43f135426525d9d1f8f.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()[ Upstream commit 8e0f5a96c534f781e8c57ca30459448b3bfe5429 ]
Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex 2b7bc5a731dd68..1a4cdf98df7035 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=99b642dac24f6d09ba3ebf1d690be8aefff86164)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=0e27e2e8697b8ce96cdef43f135426525d9d1f8f)@@ -1029,8 +1029,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1352,10 +1354,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:01 +0000



=== Content from git.kernel.org_75daf3e2_20250111_104925.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:49:21 +0200 |
| commit | [7d368de78b60088ec9031c60c88976c0063ea4c0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d368de78b60088ec9031c60c88976c0063ea4c0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)) | |
| tree | [0d7891fe3197071273e4bc32677f47550c614fd8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7d368de78b60088ec9031c60c88976c0063ea4c0) | |
| parent | [1ba9856cf7f6492b47c1edf853137f320d583db5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1ba9856cf7f6492b47c1edf853137f320d583db5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d368de78b60088ec9031c60c88976c0063ea4c0&id2=1ba9856cf7f6492b47c1edf853137f320d583db5)) | |
| download | [linux-7d368de78b60088ec9031c60c88976c0063ea4c0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7d368de78b60088ec9031c60c88976c0063ea4c0.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()[ Upstream commit 8e0f5a96c534f781e8c57ca30459448b3bfe5429 ]
Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7d368de78b60088ec9031c60c88976c0063ea4c0)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=7d368de78b60088ec9031c60c88976c0063ea4c0) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex b4c1a4f6029d43..3725cdfae1efa6 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=1ba9856cf7f6492b47c1edf853137f320d583db5)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=7d368de78b60088ec9031c60c88976c0063ea4c0)@@ -1032,8 +1032,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1355,10 +1357,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:02 +0000



=== Content from git.kernel.org_9c29d599_20250111_104926.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 09:00:14 +0200 |
| commit | [b9e8695246bcfc028341470cbf92630cdc1ba36b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)) | |
| tree | [dc8d641901e9d9f337516fbe34844812d3815a13](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b) | |
| parent | [4275b46b75731910d771bbe89ef40cb04230c002](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4275b46b75731910d771bbe89ef40cb04230c002) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b&id2=4275b46b75731910d771bbe89ef40cb04230c002)) | |
| download | [linux-b9e8695246bcfc028341470cbf92630cdc1ba36b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b9e8695246bcfc028341470cbf92630cdc1ba36b.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()[ Upstream commit 8e0f5a96c534f781e8c57ca30459448b3bfe5429 ]
Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=b9e8695246bcfc028341470cbf92630cdc1ba36b) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex 8e779eecd62d41..7f05a44e9a9fde 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=4275b46b75731910d771bbe89ef40cb04230c002)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=b9e8695246bcfc028341470cbf92630cdc1ba36b)@@ -1018,8 +1018,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1338,10 +1340,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:03 +0000



=== Content from git.kernel.org_0e255cc4_20250111_104925.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Krzysztof Wilczyński <kwilczynski@kernel.org> | 2024-07-04 14:40:53 +0000 |
| commit | [8e0f5a96c534f781e8c57ca30459448b3bfe5429](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)) | |
| tree | [517101e711fd5a87317239352330598fc85eb70c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) | |
| parent | [03377a698926e829321fcd42789892cb5974b6b6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=03377a698926e829321fcd42789892cb5974b6b6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429&id2=03377a698926e829321fcd42789892cb5974b6b6)) | |
| download | [linux-8e0f5a96c534f781e8c57ca30459448b3bfe5429.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8e0f5a96c534f781e8c57ca30459448b3bfe5429.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex 8e779eecd62d41..7f05a44e9a9fde 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=03377a698926e829321fcd42789892cb5974b6b6)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=8e0f5a96c534f781e8c57ca30459448b3bfe5429)@@ -1018,8 +1018,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1338,10 +1340,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:03 +0000



=== Content from git.kernel.org_4e2e7809_20250111_104924.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dan Carpenter <dan.carpenter@linaro.org> | 2024-06-10 12:33:39 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:45:06 +0200 |
| commit | [24414c842a24d0fd498f9db6d2a762a8dddf1832](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)) | |
| tree | [50beed37cbf61e8dfc8b9863a8058d8135a224c7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832) | |
| parent | [a32c9d72025db7d95678bb9c1fc7a9c4419003d0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a32c9d72025db7d95678bb9c1fc7a9c4419003d0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832&id2=a32c9d72025db7d95678bb9c1fc7a9c4419003d0)) | |
| download | [linux-24414c842a24d0fd498f9db6d2a762a8dddf1832.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-24414c842a24d0fd498f9db6d2a762a8dddf1832.tar.gz) | |

PCI: endpoint: Clean up error handling in vpci\_scan\_bus()[ Upstream commit 8e0f5a96c534f781e8c57ca30459448b3bfe5429 ]
Smatch complains about inconsistent NULL checking in vpci\_scan\_bus():
drivers/pci/endpoint/functions/pci-epf-vntb.c:1024 vpci\_scan\_bus() error: we previously assumed 'vpci\_bus' could be null (see line 1021)
Instead of printing an error message and then crashing we should return
an error code and clean up.
Also the NULL check is reversed so it prints an error for success
instead of failure.
Fixes: e35f56bb0330 ("PCI: endpoint: Support NTB transfer between RC and EP")
Link: [https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86@moroto.mountain](https://lore.kernel.org/linux-pci/68e0f6a4-fd57-45d0-945b-0876f2c8cb86%40moroto.mountain)
Signed-off-by: Dan Carpenter <dan.carpenter@linaro.org>
Signed-off-by: Krzysztof Wilczyński <kwilczynski@kernel.org>
Reviewed-by: Ilpo Järvinen <ilpo.jarvinen@linux.intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=24414c842a24d0fd498f9db6d2a762a8dddf1832) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 3 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-vntb.c b/drivers/pci/endpoint/functions/pci-epf-vntb.cindex d4cd4bd4a08811..fb926b300c9511 100644--- a/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=a32c9d72025db7d95678bb9c1fc7a9c4419003d0)+++ b/[drivers/pci/endpoint/functions/pci-epf-vntb.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-vntb.c?id=24414c842a24d0fd498f9db6d2a762a8dddf1832)@@ -993,8 +993,10 @@ static int vpci\_scan\_bus(void \*sysdata) struct epf\_ntb \*ndev = sysdata;  vpci\_bus = pci\_scan\_bus(ndev->vbus\_number, &vpci\_ops, sysdata);- if (vpci\_bus)- pr\_err("create pci bus\n");+ if (!vpci\_bus) {+ pr\_err("create pci bus failed\n");+ return -EINVAL;+ }  pci\_bus\_add\_devices(vpci\_bus); @@ -1313,10 +1315,14 @@ static int epf\_ntb\_bind(struct pci\_epf \*epf) goto err\_bar\_alloc; } - vpci\_scan\_bus(ntb);+ ret = vpci\_scan\_bus(ntb);+ if (ret)+ goto err\_unregister;  return 0; +err\_unregister:+ pci\_unregister\_driver(&vntb\_pci\_driver); err\_bar\_alloc: epf\_ntb\_config\_spad\_bar\_free(ntb); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:48:01 +0000


